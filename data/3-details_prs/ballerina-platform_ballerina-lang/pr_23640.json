{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1Nzc2MTgw", "number": 23640, "title": "Fix failure when iterating over empty array", "bodyText": "Purpose\n\nResolve #23499\n\nApproach\n\nFix in the TypeChecker\n\nSamples\n\nN/A\n\nRemarks\n\nN/A\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-06-01T06:10:31Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640", "merged": true, "mergeCommit": {"oid": "54511b0ead11620d99e5191b468ec62f92a7a600"}, "closed": true, "closedAt": "2020-06-03T11:45:30Z", "author": {"login": "riyafa"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcm6TcQAFqTQyMTYyMDExMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnl8VXgBqjM0MDEyNTA4OTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNjIwMTEx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#pullrequestreview-421620111", "createdAt": "2020-06-01T06:30:29Z", "commit": {"oid": "05eb7439b2cec87b430590e313b3b8087fbf070e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNjozMDoyOVrOGdAGGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNjozMDo1MFrOGdAGiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA2MzQ0OQ==", "bodyText": "I'm not sure if this is the correct fix. IMO, we should only be creating a union type if there's at least two members. So ideally we wouldn't have a union with no members.\nThis is the approach we usually take in the compiler too. See https://github.com/ballerina-platform/ballerina-lang/blob/master/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java#L3831", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#discussion_r433063449", "createdAt": "2020-06-01T06:30:29Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/TypeChecker.java", "diffHunk": "@@ -2193,6 +2193,9 @@ private static boolean checkFillerValue(BUnionType type) {\n         if (type.isNullable()) {\n             return true;\n         }\n+        if (type.getMemberTypes().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05eb7439b2cec87b430590e313b3b8087fbf070e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA2MzU2MA==", "bodyText": "Shall we move the assertion logic to the bal source?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#discussion_r433063560", "createdAt": "2020-06-01T06:30:50Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/jvm/ForeachArrayTests.java", "diffHunk": "@@ -218,4 +218,11 @@ public void testArrayWithNullElements() {\n         Assert.assertEquals(returns.length, 1);\n         Assert.assertEquals(returns[0].stringValue(), \"0:d0 1: 2:d2 3: \");\n     }\n+\n+    @Test\n+    public void testEmptyArray() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05eb7439b2cec87b430590e313b3b8087fbf070e"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05eb7439b2cec87b430590e313b3b8087fbf070e", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/05eb7439b2cec87b430590e313b3b8087fbf070e", "committedDate": "2020-06-01T06:10:10Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}, "afterCommit": {"oid": "e9915dead0e03ae1eebac9aacc3ad554466eaae9", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e9915dead0e03ae1eebac9aacc3ad554466eaae9", "committedDate": "2020-06-01T09:59:25Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9915dead0e03ae1eebac9aacc3ad554466eaae9", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e9915dead0e03ae1eebac9aacc3ad554466eaae9", "committedDate": "2020-06-01T09:59:25Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}, "afterCommit": {"oid": "6f6e0c2e28805d28933678430762c262fc271cab", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6f6e0c2e28805d28933678430762c262fc271cab", "committedDate": "2020-06-01T10:18:01Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxODA4NjI0", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#pullrequestreview-421808624", "createdAt": "2020-06-01T12:37:16Z", "commit": {"oid": "6f6e0c2e28805d28933678430762c262fc271cab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMjozNzoxNlrOGdI9Qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMjozNzoxNlrOGdI9Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzIwODY0Mw==", "bodyText": "Wouldn't this cause issues when the source type has just a rest-descriptor?\nI think the following will produce an incorrect result with this change.\nimport ballerina/io;\n\npublic function main() {\n    [int...] x = [1, 2];\n    any y = x;\n    io:println(y is string[]);\n}\nWe should ideally have tests for the same too.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#discussion_r433208643", "createdAt": "2020-06-01T12:37:16Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/TypeChecker.java", "diffHunk": "@@ -974,6 +974,9 @@ private static boolean checkIsArrayType(BType sourceType, BArrayType targetType,\n             sourceArrayType = (BArrayType) sourceType;\n         } else {\n             BTupleType sourceTupleType = (BTupleType) sourceType;\n+            if (sourceTupleType.getTupleTypes().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f6e0c2e28805d28933678430762c262fc271cab"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f6e0c2e28805d28933678430762c262fc271cab", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6f6e0c2e28805d28933678430762c262fc271cab", "committedDate": "2020-06-01T10:18:01Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}, "afterCommit": {"oid": "0b0d7cb97f478cdad21bda9c667da582197e2111", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0b0d7cb97f478cdad21bda9c667da582197e2111", "committedDate": "2020-06-01T15:03:23Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b0d7cb97f478cdad21bda9c667da582197e2111", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0b0d7cb97f478cdad21bda9c667da582197e2111", "committedDate": "2020-06-01T15:03:23Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}, "afterCommit": {"oid": "7f69ee4fd6e574be68101a7ebee52b083d74ba21", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7f69ee4fd6e574be68101a7ebee52b083d74ba21", "committedDate": "2020-06-01T15:04:07Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMzY2NTM2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#pullrequestreview-422366536", "createdAt": "2020-06-02T06:07:17Z", "commit": {"oid": "7f69ee4fd6e574be68101a7ebee52b083d74ba21"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNjowNzoxN1rOGdjRtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNjowNzoxN1rOGdjRtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzYzOTg2MA==", "bodyText": "This will not work for something like\nimport ballerina/io;\n\npublic function main() {\n    var x = [];\n\n    any a = x;\n    io:println(x is int[2]); // should be false\n}\nI think if tupleTypes.isEmpty() we should return true only if the target array state is ArrayState.UNSEALED or the target size is also 0.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#discussion_r433639860", "createdAt": "2020-06-02T06:07:17Z", "author": {"login": "MaryamZi"}, "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/TypeChecker.java", "diffHunk": "@@ -978,6 +978,9 @@ private static boolean checkIsArrayType(BType sourceType, BArrayType targetType,\n             if (sourceTupleType.getRestType() != null) {\n                 tupleTypes.add(sourceTupleType.getRestType());\n             }\n+            if (tupleTypes.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f69ee4fd6e574be68101a7ebee52b083d74ba21"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f69ee4fd6e574be68101a7ebee52b083d74ba21", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7f69ee4fd6e574be68101a7ebee52b083d74ba21", "committedDate": "2020-06-01T15:04:07Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}, "afterCommit": {"oid": "52aea5e94bf306c3e3d368a0e92ad95669fe4d19", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/52aea5e94bf306c3e3d368a0e92ad95669fe4d19", "committedDate": "2020-06-02T08:15:24Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "52aea5e94bf306c3e3d368a0e92ad95669fe4d19", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/52aea5e94bf306c3e3d368a0e92ad95669fe4d19", "committedDate": "2020-06-02T08:15:24Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}, "afterCommit": {"oid": "e48b9c3cee705277c1357c5bfeb6fb81b1c44afc", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e48b9c3cee705277c1357c5bfeb6fb81b1c44afc", "committedDate": "2020-06-02T08:30:11Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNTA5NDcw", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#pullrequestreview-422509470", "createdAt": "2020-06-02T09:37:54Z", "commit": {"oid": "e48b9c3cee705277c1357c5bfeb6fb81b1c44afc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwOTozNzo1NFrOGdp79g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwOTozNzo1NFrOGdp79g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc0ODk4Mg==", "bodyText": "Not due to the changes you introduced, but this should also fail. :( Seems like there are issues in the checkIsTupleType logic too.\nThe is check looks for the belongs-to relationship\n\na value belongs to a type if it looks like the type, and it will necessarily continue to look like the type no matter how the value is mutated.\n\nShould we fix that check in this PR too?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#discussion_r433748982", "createdAt": "2020-06-02T09:37:54Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/jvm/types.bal", "diffHunk": "@@ -157,6 +157,31 @@ function tupleTest() returns int {\n    return 10;\n }\n \n+public function testRestType() {\n+    [int...] x = [1, 2];\n+    any y = x;\n+    assertEquality(y is string[], false);\n+    assertEquality(y is [int], true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e48b9c3cee705277c1357c5bfeb6fb81b1c44afc"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNTA5NzUx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#pullrequestreview-422509751", "createdAt": "2020-06-02T09:38:15Z", "commit": {"oid": "e48b9c3cee705277c1357c5bfeb6fb81b1c44afc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwOTozODoxNVrOGdp83g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwOTozODoxNVrOGdp83g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc0OTIxNA==", "bodyText": "Extra new line.", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#discussion_r433749214", "createdAt": "2020-06-02T09:38:15Z", "author": {"login": "MaryamZi"}, "path": "tests/jballerina-unit-test/src/test/resources/test-src/jvm/types.bal", "diffHunk": "@@ -157,6 +157,31 @@ function tupleTest() returns int {\n    return 10;\n }\n \n+public function testRestType() {\n+    [int...] x = [1, 2];\n+    any y = x;\n+    assertEquality(y is string[], false);\n+    assertEquality(y is [int], true);\n+}\n+\n+public function testEmptyArrayType() {\n+    var x = [];\n+    any a = x;\n+    assertEquality(a is int[2], false);\n+    assertEquality(a is int[], true);\n+\n+    string[] sa = [];\n+    any arr = sa;\n+    assertEquality(arr is string[], true);\n+    assertEquality(arr is int[], false);\n+\n+    int[0] ia = [];\n+    any iarr = ia;\n+    assertEquality(iarr is int[0], true);\n+    assertEquality(iarr is int[], true);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e48b9c3cee705277c1357c5bfeb6fb81b1c44afc"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e48b9c3cee705277c1357c5bfeb6fb81b1c44afc", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e48b9c3cee705277c1357c5bfeb6fb81b1c44afc", "committedDate": "2020-06-02T08:30:11Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}, "afterCommit": {"oid": "13f592ca7c1567c6440f5147bb93d8a7afe8d3eb", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/13f592ca7c1567c6440f5147bb93d8a7afe8d3eb", "committedDate": "2020-06-03T01:54:39Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMjg0Mzk1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#pullrequestreview-423284395", "createdAt": "2020-06-03T07:25:51Z", "commit": {"oid": "13f592ca7c1567c6440f5147bb93d8a7afe8d3eb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "13f592ca7c1567c6440f5147bb93d8a7afe8d3eb", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/13f592ca7c1567c6440f5147bb93d8a7afe8d3eb", "committedDate": "2020-06-03T01:54:39Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}, "afterCommit": {"oid": "520d82ba957835d1b0b7d471be0c74bb5fae00be", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/520d82ba957835d1b0b7d471be0c74bb5fae00be", "committedDate": "2020-06-03T05:30:07Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c7a746d32710036015caf91d3cabb9a2d4e85c5", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4c7a746d32710036015caf91d3cabb9a2d4e85c5", "committedDate": "2020-06-03T09:21:17Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "520d82ba957835d1b0b7d471be0c74bb5fae00be", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/520d82ba957835d1b0b7d471be0c74bb5fae00be", "committedDate": "2020-06-03T05:30:07Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}, "afterCommit": {"oid": "4c7a746d32710036015caf91d3cabb9a2d4e85c5", "author": {"user": {"login": "riyafa", "name": "Riyafa Abdul Hameed"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4c7a746d32710036015caf91d3cabb9a2d4e85c5", "committedDate": "2020-06-03T09:21:17Z", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4484, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}