{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1MDMzMDI3", "number": 24189, "title": "Extend JWT validator configuration [master]", "bodyText": "Purpose\nThis PR updates the signature validation fields of JwtValidatorConfg.\nThe current record has JwtTrustStoreConfig|JwksConfig signatureConfig? field which validates the signature either from one of these. But with the new config, user can configure either one of these or both. Then the signature can be validated depending on the kid property of the provided/inbound JWT. With this change, we only need to update the field name from signatureConfig to jwksConfig if using JWK for signature validation. Also, this will remove the breaking changes from 1.2.x to latest.\nThis is an extension of PR #22982 which provided the JWT signature validation support with JWKs.\nFixes #24190\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-06-16T07:41:32Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24189", "merged": true, "mergeCommit": {"oid": "1e982649a7f654374eef87ea6d428f76b5d356b3"}, "closed": true, "closedAt": "2020-06-16T14:31:52Z", "author": {"login": "ldclakmal"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrwJ-jAH2gAyNDM1MDMzMDI3OjExMDhiY2MwM2YwZGI3NzU4MDkzMjk3MmExZTcyNzNiOGExNzIxZjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr0VawgFqTQzMTQ0Njc3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1108bcc03f0db77580932972a1e7273b8a1721f7", "author": {"user": {"login": "ldclakmal", "name": "Chanaka Lakmal"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1108bcc03f0db77580932972a1e7273b8a1721f7", "committedDate": "2020-06-16T07:31:10Z", "message": "Improve jwt validator config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "554ae069499771c0ce95239fcb2c2af1b5334fe1", "author": {"user": {"login": "ldclakmal", "name": "Chanaka Lakmal"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/554ae069499771c0ce95239fcb2c2af1b5334fe1", "committedDate": "2020-06-16T07:36:13Z", "message": "Update docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e71c2fab3b84ca5c2465b57856b5ec331116ece", "author": {"user": {"login": "ldclakmal", "name": "Chanaka Lakmal"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8e71c2fab3b84ca5c2465b57856b5ec331116ece", "committedDate": "2020-06-16T07:36:27Z", "message": "Update test cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMjQzODQy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24189#pullrequestreview-431243842", "createdAt": "2020-06-16T07:47:47Z", "commit": {"oid": "8e71c2fab3b84ca5c2465b57856b5ec331116ece"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNzo0Nzo0N1rOGkPSJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNzo0Nzo0N1rOGkPSJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDY1MjMyNw==", "bodyText": "I think we need to move this as else if statement", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24189#discussion_r440652327", "createdAt": "2020-06-16T07:47:47Z", "author": {"login": "daneshk"}, "path": "stdlib/jwt/src/main/ballerina/src/jwt/jwt_validator.bal", "diffHunk": "@@ -270,18 +272,21 @@ function validateJwtRecords(string jwt, JwtHeader jwtHeader, JwtPayload jwtPaylo\n     }\n     JwtSigningAlgorithm alg = <JwtSigningAlgorithm>jwtHeader?.alg;  // The `()` value is already validated.\n \n-    JwtTrustStoreConfig|JwksConfig? signatureConfig = config?.signatureConfig;\n-    if (signatureConfig is JwtTrustStoreConfig) {\n-        _ = check validateSignatureByTrustStore(jwt, alg, signatureConfig);\n-    } else if (signatureConfig is JwksConfig) {\n+    JwksConfig? jwksConfig = config?.jwksConfig;\n+    if (jwksConfig is JwksConfig) {\n         string? kid = jwtHeader?.kid;\n         if (kid is string) {\n-            _ = check validateSignatureByJwks(jwt, kid, alg, signatureConfig);\n+            _ = check validateSignatureByJwks(jwt, kid, alg, jwksConfig);\n         } else {\n             return prepareError(\"Key ID (kid) is not provided in JOSE header.\");\n         }\n     }\n \n+    JwtTrustStoreConfig? trustStoreConfig = config?.trustStoreConfig;\n+    if (trustStoreConfig is JwtTrustStoreConfig) {\n+        _ = check validateSignatureByTrustStore(jwt, alg, trustStoreConfig);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e71c2fab3b84ca5c2465b57856b5ec331116ece"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e01271244dbee2138599cabba063b0d02b9facab", "author": {"user": {"login": "ldclakmal", "name": "Chanaka Lakmal"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e01271244dbee2138599cabba063b0d02b9facab", "committedDate": "2020-06-16T10:13:53Z", "message": "Fix the signature validation logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95b66bbf5e137621b2e67ac52e2cacf98e9df9aa", "author": {"user": {"login": "ldclakmal", "name": "Chanaka Lakmal"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/95b66bbf5e137621b2e67ac52e2cacf98e9df9aa", "committedDate": "2020-06-16T11:56:08Z", "message": "Add integration tests for JWT signature validation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dba0b304c31a8f674e20a08c8736638925d219c8", "author": {"user": {"login": "ldclakmal", "name": "Chanaka Lakmal"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dba0b304c31a8f674e20a08c8736638925d219c8", "committedDate": "2020-06-16T08:06:21Z", "message": "Fix the signature validation logic"}, "afterCommit": {"oid": "95b66bbf5e137621b2e67ac52e2cacf98e9df9aa", "author": {"user": {"login": "ldclakmal", "name": "Chanaka Lakmal"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/95b66bbf5e137621b2e67ac52e2cacf98e9df9aa", "committedDate": "2020-06-16T11:56:08Z", "message": "Add integration tests for JWT signature validation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNDQ2Nzcz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24189#pullrequestreview-431446773", "createdAt": "2020-06-16T12:23:17Z", "commit": {"oid": "95b66bbf5e137621b2e67ac52e2cacf98e9df9aa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4261, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}