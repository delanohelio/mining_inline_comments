{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMDE3MTI0", "number": 20949, "title": "Fix cleaning of entire target directory during a single module build", "bodyText": "Purpose\n\nCurrently, when a Ballerina build is done on a single module, the entire target gets deleted. This PR fixes this issue by deleting only the resources relevant to the module that is being built.\n\nFixes #20732\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-02-10T09:06:48Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20949", "merged": true, "mergeCommit": {"oid": "0600850882f874a300dd73db7cbe1b26ece31af5"}, "closed": true, "closedAt": "2020-02-11T03:09:33Z", "author": {"login": "IrushiL"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcC4_qWgH2gAyMzczMDE3MTI0OmY0MTk5YzUyZWQzMDhlYWNlNTI0N2ZiYmQ2MmQwMmM3MjdjODk0YTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDI5FlgFqTM1NjM5ODg0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f4199c52ed308eace5247fbbd62d02c727c894a0", "author": {"user": {"login": "IrushiL", "name": "Irushi Liyanage"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f4199c52ed308eace5247fbbd62d02c727c894a0", "committedDate": "2020-02-10T08:38:09Z", "message": "Fix cleaning of entire target directory during a single module build"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1ODUxMjk5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20949#pullrequestreview-355851299", "createdAt": "2020-02-10T11:04:13Z", "commit": {"oid": "f4199c52ed308eace5247fbbd62d02c727c894a0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMTowNDoxM1rOFniC7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMTowNzowOVrOFniICw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5NjU5MA==", "bodyText": "Where we build the mytemplate module. Another test?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20949#discussion_r376996590", "createdAt": "2020-02-10T11:04:13Z", "author": {"login": "warunalakshitha"}, "path": "cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java", "diffHunk": "@@ -717,6 +717,24 @@ public void testTargetCacheDirectory() throws IOException {\n         // check if each module has a bit in cache directory\n     }\n \n+    @Test(description = \"Test the cleaning of target resources in the build command.\",\n+            dependsOnMethods = {\"testBuildCommand\"})\n+    public void testTargetClean() {\n+        // If a single module is built only the relevant module's resources should be cleaned,\n+        // else the entire target will be deleted.\n+        String[] compileArgs = {\"mymodule\", \"--skip-tests\"};\n+        Path target = this.testResources.resolve(\"valid-project\").resolve(ProjectDirConstants.TARGET_DIR_NAME);\n+\n+        BuildCommand buildCommand = new BuildCommand(this.testResources.resolve(\"valid-project\"),\n+                printStream, printStream, false, true);\n+        new CommandLine(buildCommand).parse(compileArgs);\n+        buildCommand.execute();\n+\n+        // Executable of a module that is not built.\n+        Path executablePath = target.resolve(ProjectDirConstants.BIN_DIR_NAME).resolve(\"mytemplate.jar\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4199c52ed308eace5247fbbd62d02c727c894a0"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5Nzg5OQ==", "bodyText": "Also shall we check whether the target directory stuff cleaned ( ex. balo, jar etc)", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20949#discussion_r376997899", "createdAt": "2020-02-10T11:07:09Z", "author": {"login": "warunalakshitha"}, "path": "cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java", "diffHunk": "@@ -717,6 +717,24 @@ public void testTargetCacheDirectory() throws IOException {\n         // check if each module has a bit in cache directory\n     }\n \n+    @Test(description = \"Test the cleaning of target resources in the build command.\",\n+            dependsOnMethods = {\"testBuildCommand\"})\n+    public void testTargetClean() {\n+        // If a single module is built only the relevant module's resources should be cleaned,\n+        // else the entire target will be deleted.\n+        String[] compileArgs = {\"mymodule\", \"--skip-tests\"};\n+        Path target = this.testResources.resolve(\"valid-project\").resolve(ProjectDirConstants.TARGET_DIR_NAME);\n+\n+        BuildCommand buildCommand = new BuildCommand(this.testResources.resolve(\"valid-project\"),\n+                printStream, printStream, false, true);\n+        new CommandLine(buildCommand).parse(compileArgs);\n+        buildCommand.execute();\n+\n+        // Executable of a module that is not built.\n+        Path executablePath = target.resolve(ProjectDirConstants.BIN_DIR_NAME).resolve(\"mytemplate.jar\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njk5NjU5MA=="}, "originalCommit": {"oid": "f4199c52ed308eace5247fbbd62d02c727c894a0"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2Mzk4ODQ2", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20949#pullrequestreview-356398846", "createdAt": "2020-02-11T03:09:27Z", "commit": {"oid": "f4199c52ed308eace5247fbbd62d02c727c894a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4210, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}