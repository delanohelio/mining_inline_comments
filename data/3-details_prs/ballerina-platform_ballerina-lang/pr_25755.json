{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2MTQwMjYx", "number": 25755, "title": "Remove `CompileResultDiagnosticListener` and update the tests to compatible with new diagnostic api", "bodyText": "Purpose\n\nRemove CompileResultDiagnosticListener and update the tests to compatible with new diagnostic API\n\nTODO: implement diagnostic sorting\nFixes #\nApproach\n\nDescribe how you are implementing the solutions along with the design details.\n\nSamples\n\nProvide high-level details about the samples related to this feature.\n\nRemarks\n\nList any other known issues, related PRs, TODO items, or any other notes related to the PR.\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-09-13T06:57:10Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25755", "merged": true, "mergeCommit": {"oid": "02f52bfb2c89cefdf08b4107c3dde234924c4f94"}, "closed": true, "closedAt": "2020-09-15T05:53:03Z", "author": {"login": "dulajdilshan"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIe4SqAFqTQ4NzMwODUyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJBSswgFqTQ4ODM0NDMyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzA4NTI5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25755#pullrequestreview-487308529", "createdAt": "2020-09-13T13:44:51Z", "commit": {"oid": "a10f988b54760e8b071091a891b965e01cce7243"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxMzo0NDo1MVrOHQ8jkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxMzo0NzowOFrOHQ8ktQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMTQwOA==", "bodyText": "This might give check styles issues. Shall we fix all the check-styles/find-bugs issues?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25755#discussion_r487531408", "createdAt": "2020-09-13T13:44:51Z", "author": {"login": "SupunS"}, "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/javainterop/RefTypeNegativeTests.java", "diffHunk": "@@ -24,7 +24,7 @@\n import org.ballerinalang.test.util.BAssertUtil;\n import org.ballerinalang.test.util.BCompileUtil;\n import org.ballerinalang.test.util.CompileResult;\n-import org.ballerinalang.util.diagnostic.Diagnostic;\n+import io.ballerina.tools.diagnostics.Diagnostic;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a10f988b54760e8b071091a891b965e01cce7243"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMTcwMQ==", "bodyText": "Shall we use an ordered list in the bLangPackage to store diagnostics? Then we don't have to sort it everytime..", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25755#discussion_r487531701", "createdAt": "2020-09-13T13:47:08Z", "author": {"login": "SupunS"}, "path": "tests/ballerina-test-utils/src/main/java/org/ballerinalang/test/util/CompileResult.java", "diffHunk": "@@ -34,27 +32,25 @@\n public class CompileResult {\n \n     private PackageNode pkgNode;\n-    private CompileResultDiagnosticListener diagnosticListener;\n \n     URLClassLoader classLoader;\n \n-    public CompileResult(CompileResultDiagnosticListener diagnosticListener) {\n-        this.diagnosticListener = diagnosticListener;\n+    public CompileResult() {\n     }\n \n     public Diagnostic[] getDiagnostics() {\n-        List<Diagnostic> diagnostics = this.diagnosticListener.getDiagnostics();\n-        diagnostics.sort(Comparator.comparing((Diagnostic d) -> d.getSource().getCompilationUnitName()).\n-                thenComparingInt(d -> d.getPosition().getStartLine()));\n+        List<Diagnostic> diagnostics = ((BLangPackage) this.pkgNode).getDiagnostics();\n+        diagnostics.sort(Comparator.comparing((Diagnostic d) -> d.location().lineRange().filePath()).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a10f988b54760e8b071091a891b965e01cce7243"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08aa3e97fb94ba0ab0a2e2f05b9c57ff50a34fc8", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/08aa3e97fb94ba0ab0a2e2f05b9c57ff50a34fc8", "committedDate": "2020-09-14T09:06:05Z", "message": "Remove diagnostic console print"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8ecf2fbaffc036759fbb992d0ea3ade723a8dd7", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d8ecf2fbaffc036759fbb992d0ea3ade723a8dd7", "committedDate": "2020-09-14T09:10:19Z", "message": "Remove `CompileResultDiagnosticListener` and update the `CompileResult` to get the diagnostics from the `BLangPackage`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46c72cbd65f96d612b746b0ff5a7c20f03652992", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/46c72cbd65f96d612b746b0ff5a7c20f03652992", "committedDate": "2020-09-14T09:10:20Z", "message": "Update ballerina-test-utils/build.gradle with `ballerina-tools-api`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaecbd7c273ded617fbefeddf0d0933ebbd2478a", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/aaecbd7c273ded617fbefeddf0d0933ebbd2478a", "committedDate": "2020-09-14T09:10:20Z", "message": "Update tests with new diagnostic api"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6cf2f67fb1f8ecd01dc6d3d93cb6c23a877f8996", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6cf2f67fb1f8ecd01dc6d3d93cb6c23a877f8996", "committedDate": "2020-09-14T08:31:49Z", "message": "Remove checkstyle issues and refactor some tests"}, "afterCommit": {"oid": "bf32b5e1b993fad5445e95b4caa100585694d5d5", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bf32b5e1b993fad5445e95b4caa100585694d5d5", "committedDate": "2020-09-14T11:45:32Z", "message": "Remove checkstyle issues and refactor some tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3ODE3NTEx", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25755#pullrequestreview-487817511", "createdAt": "2020-09-14T14:17:47Z", "commit": {"oid": "bf32b5e1b993fad5445e95b4caa100585694d5d5"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNDoxNzo0N1rOHRXFQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNDoxODo0N1rOHRXJXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk2NjAxNw==", "bodyText": "no need of the listener parameter", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25755#discussion_r487966017", "createdAt": "2020-09-14T14:17:47Z", "author": {"login": "SupunS"}, "path": "tests/ballerina-test-utils/src/main/java/org/ballerinalang/test/util/BCompileUtil.java", "diffHunk": "@@ -499,18 +496,16 @@ public static CompileResult compile(String sourceRoot, String packageName, Compi\n     private static CompileResult compile(CompilerContext context, String packageName,\n                                          CompilerPhase compilerPhase, boolean withTests) {\n \n-        CompileResult.CompileResultDiagnosticListener listener = new CompileResult.CompileResultDiagnosticListener();\n-        context.put(DiagnosticListener.class, listener);\n-        return compile(context, listener, packageName, compilerPhase, withTests);\n+        return compile(context, null, packageName, compilerPhase, withTests);\n     }\n \n     private static CompileResult compile(CompilerContext context,\n-                                         CompileResult.CompileResultDiagnosticListener listener,\n+                                         String listener,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf32b5e1b993fad5445e95b4caa100585694d5d5"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk2NzA3MQ==", "bodyText": "lets remove this", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25755#discussion_r487967071", "createdAt": "2020-09-14T14:18:47Z", "author": {"login": "SupunS"}, "path": "misc/ballerinalang-data-mapper/src/test/java/org/ballerinalang/datamapper/util/TestUtil.java", "diffHunk": "@@ -61,6 +60,8 @@\n import java.util.concurrent.CompletableFuture;\n import java.util.concurrent.ExecutionException;\n \n+//import io.ballerina.tools.diagnostics.Diagnostic;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf32b5e1b993fad5445e95b4caa100585694d5d5"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b68488c50760ef29db4e1100f7c17febe36a1a3", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0b68488c50760ef29db4e1100f7c17febe36a1a3", "committedDate": "2020-09-15T03:39:57Z", "message": "Remove checkstyle issues and refactor some tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bf32b5e1b993fad5445e95b4caa100585694d5d5", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bf32b5e1b993fad5445e95b4caa100585694d5d5", "committedDate": "2020-09-14T11:45:32Z", "message": "Remove checkstyle issues and refactor some tests"}, "afterCommit": {"oid": "0b68488c50760ef29db4e1100f7c17febe36a1a3", "author": {"user": {"login": "dulajdilshan", "name": "Dulaj Dilshan"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0b68488c50760ef29db4e1100f7c17febe36a1a3", "committedDate": "2020-09-15T03:39:57Z", "message": "Remove checkstyle issues and refactor some tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MzQ0MzIy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25755#pullrequestreview-488344322", "createdAt": "2020-09-15T05:52:53Z", "commit": {"oid": "0b68488c50760ef29db4e1100f7c17febe36a1a3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4727, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}