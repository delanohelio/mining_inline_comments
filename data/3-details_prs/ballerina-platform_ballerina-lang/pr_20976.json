{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNTI2MjQ5", "number": 20976, "title": "Add chain invocation support for 'create variable' code action", "bodyText": "Purpose\n\nAdd chain invocation support for 'create variable' code action\n\nFixes #18326\nRemarks\n\nRelated PR #20977\n\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-02-11T08:22:16Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20976", "merged": true, "mergeCommit": {"oid": "3ac2f0e04c3fc44a12bac88da0fd0efbe1b0efe4"}, "closed": true, "closedAt": "2020-02-12T07:06:02Z", "author": {"login": "rasika"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDNyjHAFqTM1NjQ4Njk4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDgOTBAFqTM1NzIxMTE3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NDg2OTgz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20976#pullrequestreview-356486983", "createdAt": "2020-02-11T08:51:42Z", "commit": {"oid": "c6f87b672a18e46163c654225ccbe53d98f4b611"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwODo1MTo0M1rOFoA7cQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwODo1MTo0M1rOFoA7cQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzUwMjU3Nw==", "bodyText": "Shall we update the logic to handle(ignore) characters inside string literals?", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20976#discussion_r377502577", "createdAt": "2020-02-11T08:51:43Z", "author": {"login": "NipunaRanasinghe"}, "path": "language-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/codeaction/providers/VariableAssignmentCodeAction.java", "diffHunk": "@@ -223,16 +223,44 @@ private static String getDiagnosedContent(Diagnostic diagnostic, LSContext conte\n     }\n \n     private static Position offsetInvocation(String diagnosedContent, Position position) {\n+//        Need to capture the correct function invocation position in chain & nested invocations\n+//        eg. General Invocations: lorry.get_color()\n+//            Chain invocations: lorry.get_color().print(10),\n+//            Package Prefixes: http:lorry.get_color()\n+//            Action invocations: http:lorry->action()\n+//            Nested invocations: crypto:hashMd5(str.toBytes())\n+//            Field accesses: http:lorry.get_color\n+        String content = diagnosedContent;\n+        int pendingLParenthesis = 0;\n+        boolean loop = true;\n+        int count = 0;\n+        while (loop) {\n+            if (content.length() == 2) {\n+                break;\n+            }\n+            char tailChar = content.charAt(content.length() - 1);\n+            char tailPrevChar = content.charAt(content.length() - 2);\n+            if (pendingLParenthesis <= 0) {\n+                if (tailChar == '.' || tailChar == ':') {\n+                    count++;\n+                    break;\n+                } else if ((tailPrevChar == '-' && tailChar == '>')) {\n+                    count += 2;\n+                    break;\n+                }\n+            }\n+            if (tailChar == '(') {\n+                pendingLParenthesis--;\n+            } else if (tailChar == ')') {\n+                pendingLParenthesis++;\n+            }\n+            content = content.substring(0, content.length() - 1);\n+            count++;\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6f87b672a18e46163c654225ccbe53d98f4b611"}, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c6f87b672a18e46163c654225ccbe53d98f4b611", "author": {"user": {"login": "rasika", "name": "Rasika Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c6f87b672a18e46163c654225ccbe53d98f4b611", "committedDate": "2020-02-11T08:19:03Z", "message": "Add chain invocation support for 'create variable' code action\n\nSigned-off-by: Rasika <info.rasika@gmail.com>"}, "afterCommit": {"oid": "7eeda180e1bb12898eab144e09783d8db6533470", "author": {"user": {"login": "rasika", "name": "Rasika Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7eeda180e1bb12898eab144e09783d8db6533470", "committedDate": "2020-02-11T11:03:04Z", "message": "Add chain invocation support for 'create variable' code action\n\nSigned-off-by: Rasika <info.rasika@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98def71c9b4598333ff1d6f7ad63e22fd705eaaa", "author": {"user": {"login": "rasika", "name": "Rasika Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/98def71c9b4598333ff1d6f7ad63e22fd705eaaa", "committedDate": "2020-02-11T11:30:20Z", "message": "Add chain invocation support for 'create variable' code action\n\nSigned-off-by: Rasika <info.rasika@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7eeda180e1bb12898eab144e09783d8db6533470", "author": {"user": {"login": "rasika", "name": "Rasika Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7eeda180e1bb12898eab144e09783d8db6533470", "committedDate": "2020-02-11T11:03:04Z", "message": "Add chain invocation support for 'create variable' code action\n\nSigned-off-by: Rasika <info.rasika@gmail.com>"}, "afterCommit": {"oid": "98def71c9b4598333ff1d6f7ad63e22fd705eaaa", "author": {"user": {"login": "rasika", "name": "Rasika Perera"}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/98def71c9b4598333ff1d6f7ad63e22fd705eaaa", "committedDate": "2020-02-11T11:30:20Z", "message": "Add chain invocation support for 'create variable' code action\n\nSigned-off-by: Rasika <info.rasika@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MjExMTc5", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20976#pullrequestreview-357211179", "createdAt": "2020-02-12T06:20:27Z", "commit": {"oid": "98def71c9b4598333ff1d6f7ad63e22fd705eaaa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4229, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}