{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwODA1MTk0", "number": 25354, "title": "Add expression evaluation integration tests", "bodyText": "Purpose\nThis PR add debugger test framework support and integration test scenarios for debug expression evaluation support.\nFixes #25237.\nCheck List\n\n Read the Contributing Guide\n Updated Change Log\n Checked Tooling Support (#)\n Added necessary tests\n\n Unit Tests\n Spec Conformance Tests\n Integration Tests\n Ballerina By Example Tests\n\n\n Increased Test Coverage\n Added necessary documentation\n\n API documentation\n Module documentation in Module.md files\n Ballerina By Examples", "createdAt": "2020-08-20T10:07:28Z", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25354", "merged": true, "mergeCommit": {"oid": "d70d44070e598b0fdf553a830a28c0dd87435bb0"}, "closed": true, "closedAt": "2020-08-21T14:15:04Z", "author": {"login": "NipunaRanasinghe"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9LEfBgH2gAyNDcwODA1MTk0OjI3MjM2ZmIzOGQ3YmY5Y2RmNTM1NTc3NDFmYjAyYzQ5ZDEyYWNkNTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBFfWwAFqTQ3MjUyNjc1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "27236fb38d7bf9cdf53557741fb02c49d12acd58", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/27236fb38d7bf9cdf53557741fb02c49d12acd58", "committedDate": "2020-08-09T10:29:19Z", "message": "Add debugger test framework support for expression evaluation tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45dfcc54b097b9d5824cbb2e40546a8511d959ec", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/45dfcc54b097b9d5824cbb2e40546a8511d959ec", "committedDate": "2020-08-19T10:02:26Z", "message": "Fix issue when evaluating nill variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e99b95ab34996fb8aba987858722296df255e2cd", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e99b95ab34996fb8aba987858722296df255e2cd", "committedDate": "2020-08-16T10:29:19Z", "message": "Add variable evaluation and arithmetic operation evaluation tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32853e0fd7c3fa9f54ab62af88f880892c3b88cf", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/32853e0fd7c3fa9f54ab62af88f880892c3b88cf", "committedDate": "2020-08-20T09:36:02Z", "message": "Add negative test scenarios"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d61c409a984f11112766ce4a1a1b695be36236", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f7d61c409a984f11112766ce4a1a1b695be36236", "committedDate": "2020-08-20T10:05:32Z", "message": "Add minor improvements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNDU3MjYy", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25354#pullrequestreview-471457262", "createdAt": "2020-08-20T10:21:06Z", "commit": {"oid": "f7d61c409a984f11112766ce4a1a1b695be36236"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMDoyMTowNlrOHD5zgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMDoyMTowNlrOHD5zgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg1NDg1MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        throw new BallerinaTestException(\"Connection error is occurred when trying to fet information from the \" +\n          \n          \n            \n                        throw new BallerinaTestException(\"Connection error occurred when trying to get information from the \" +", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25354#discussion_r473854851", "createdAt": "2020-08-20T10:21:06Z", "author": {"login": "praveennadarajah"}, "path": "tests/jballerina-debugger-integration-test/src/test/java/org/ballerinalang/debugger/test/DebugAdapterBaseTestCase.java", "diffHunk": "@@ -403,6 +405,78 @@ protected void assertVariable(Variable variable, String variableName, String var\n         Assert.assertEquals(variable.getType(), variableType);\n     }\n \n+    /**\n+     * Can be used to assert any expression evaluation result.\n+     *\n+     * @param context     suspended context.\n+     * @param expression  expression.\n+     * @param resultValue result value.\n+     * @param resultType  result type.\n+     * @throws BallerinaTestException if an error occurs when evaluating the expression.\n+     */\n+    protected void assertExpression(StoppedEventArguments context, String expression, String resultValue,\n+                                    String resultType) throws BallerinaTestException {\n+        Variable result = evaluateExpression(context, expression);\n+        Assert.assertEquals(result.getValue(), resultValue);\n+        Assert.assertEquals(result.getType(), resultType);\n+    }\n+\n+    /**\n+     * Can be used to evaluate any given evaluation failure, against its expected error message.\n+     *\n+     * @param context    suspended context.\n+     * @param expression expression.\n+     * @throws BallerinaTestException if an error occurs when evaluating the expression.\n+     */\n+    protected void assertEvaluationError(StoppedEventArguments context, String expression, String errorMessage)\n+            throws BallerinaTestException {\n+        Variable result = evaluateExpression(context, expression);\n+        Assert.assertEquals(result.getValue(), errorMessage);\n+        Assert.assertEquals(result.getType(), \"string\");\n+    }\n+\n+    /**\n+     * Can be used to evaluate any given expression, when a debug hit is occurred.\n+     *\n+     * @param args debug stopped event arguments.\n+     * @return the evaluation result as a variable.\n+     * @throws BallerinaTestException if an error occurs when evaluating the expression.\n+     */\n+    private Variable evaluateExpression(StoppedEventArguments args, String expr) throws BallerinaTestException {\n+        if (!DebugHitListener.connector.isConnected()) {\n+            throw new BallerinaTestException(\"Connection error is occurred when trying to fet information from the \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7d61c409a984f11112766ce4a1a1b695be36236"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNDcyNTkz", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25354#pullrequestreview-471472593", "createdAt": "2020-08-20T10:39:15Z", "commit": {"oid": "f7d61c409a984f11112766ce4a1a1b695be36236"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMDozOToxNlrOHD6r8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMDozOToxNlrOHD6r8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg2OTI5OQ==", "bodyText": "Shall we change the above lines to use Paths.get since File.sperator is a pre-1.7 JDK way?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    testProjectPath = testProjectBaseDir.toString() + File.separator + testProjectName;\n          \n          \n            \n                    testProjectPath = Paths.get(testProjectBaseDir.toString(), testProjectName).toString();", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25354#discussion_r473869299", "createdAt": "2020-08-20T10:39:16Z", "author": {"login": "praveennadarajah"}, "path": "tests/jballerina-debugger-integration-test/src/test/java/org/ballerinalang/debugger/test/adapter/evaluation/ExpressionEvaluationTest.java", "diffHunk": "@@ -0,0 +1,283 @@\n+/*\n+ * Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.ballerinalang.debugger.test.adapter.evaluation;\n+\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.ballerinalang.debugger.test.DebugAdapterBaseTestCase;\n+import org.ballerinalang.debugger.test.utils.BallerinaTestDebugPoint;\n+import org.ballerinalang.debugger.test.utils.DebugUtils;\n+import org.ballerinalang.test.context.BallerinaTestException;\n+import org.eclipse.lsp4j.debug.StoppedEventArguments;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import java.io.File;\n+import java.nio.file.Paths;\n+\n+/**\n+ * Test implementation for debug expression evaluation scenarios.\n+ */\n+public class ExpressionEvaluationTest extends DebugAdapterBaseTestCase {\n+\n+    private StoppedEventArguments context;\n+\n+    private static final String nilVar = \"v01_varVariable\";\n+    private static final String booleanVar = \"v02_booleanVar\";\n+    private static final String intVar = \"v03_intVar\";\n+    private static final String floatVar = \"v04_floatVar\";\n+    private static final String decimalVar = \"v05_decimalVar\";\n+    private static final String stringVar = \"v06_stringVar\";\n+    private static final String xmlVar = \"v07_xmlVar\";\n+    private static final String arrayVar = \"v08_arrayVar\";\n+    private static final String tupleVar = \"v09_tupleVar\";\n+    private static final String mapVar = \"v10_mapVar\";\n+    private static final String recordVar = \"v11_john\";\n+    private static final String anonRecordVar = \"v12_anonRecord\";\n+    private static final String errorVar = \"v13_errorVar\";\n+    private static final String anonFunctionVar = \"v14_anonFunctionVar\";\n+    private static final String futureVar = \"v15_futureVar\";\n+    private static final String objectVar = \"v16_objectVar\";\n+    private static final String anonObjectVar = \"v17_anonObjectVar\";\n+    private static final String typeDescVar = \"v18_typedescVar\";\n+    private static final String unionVar = \"v19_unionVar\";\n+    private static final String optionalVar = \"v20_optionalVar\";\n+    private static final String anyVar = \"v21_anyVar\";\n+    private static final String anydataVar = \"v22_anydataVar\";\n+    private static final String byteVar = \"v23_byteVar\";\n+    private static final String jsonVar = \"v24_jsonVar\";\n+    private static final String tableVar = \"v25_tableVar\";\n+    private static final String streamVar = \"v26_oddNumberStream\";\n+    private static final String neverVar = \"v27_neverVar\";\n+\n+    @BeforeClass\n+    public void setup() throws BallerinaTestException {\n+        testProjectName = \"basic-project\";\n+        testModuleName = \"advanced\";\n+        testModuleFileName = \"main.bal\";\n+        testProjectPath = testProjectBaseDir.toString() + File.separator + testProjectName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7d61c409a984f11112766ce4a1a1b695be36236"}, "originalPosition": 74}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7ffedb0b1ce27985c4bb37d6076cfe8ce63f805", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c7ffedb0b1ce27985c4bb37d6076cfe8ce63f805", "committedDate": "2020-08-20T10:49:10Z", "message": "Add review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4aab4d3d4e8cbc5a01188a8318666912e8256643", "author": {"user": {"login": "NipunaRanasinghe", "name": "Nipuna Ransinghe "}}, "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4aab4d3d4e8cbc5a01188a8318666912e8256643", "committedDate": "2020-08-21T07:12:29Z", "message": "Sync with master branch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNTI2NzU1", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25354#pullrequestreview-472526755", "createdAt": "2020-08-21T14:14:56Z", "commit": {"oid": "4aab4d3d4e8cbc5a01188a8318666912e8256643"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4899, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}