{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwODIwMjcw", "number": 6702, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNTo1NToyN1rOD-SNJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDowOTo0M1rOD-i27A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NjM2NTgxOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/bpartner/service/impl/BPartnerDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNTo1NToyN1rOGYSp4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNTo1NToyN1rOGYSp4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODEyNDY0MA==", "bodyText": "use AdMessageKey instead of String", "url": "https://github.com/metasfresh/metasfresh/pull/6702#discussion_r428124640", "createdAt": "2020-05-20T15:55:27Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/bpartner/service/impl/BPartnerDAO.java", "diffHunk": "@@ -119,6 +123,8 @@\n \n \tprivate final GLNLoadingCache glnsLoadingCache = new GLNLoadingCache();\n \n+\tprivate static final String MSG_ADDRESS_INACTIVE = \"webui.salesorder.clone.inactivelocation\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bb095e9589f1592e99dbf416d58b1415cdea1c6"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NjM2ODk5OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/bpartner/service/impl/BPartnerDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNTo1NjoxNVrOGYSsEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNTo1NjoxNVrOGYSsEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODEyNTIwMw==", "bodyText": "declare locationRepos as a class field", "url": "https://github.com/metasfresh/metasfresh/pull/6702#discussion_r428125203", "createdAt": "2020-05-20T15:56:15Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/bpartner/service/impl/BPartnerDAO.java", "diffHunk": "@@ -492,11 +496,21 @@ else if (bpLocations.size() == 1)\n \t@Override\n \tpublic CountryId retrieveBPartnerLocationCountryId(@NonNull final BPartnerLocationId bpLocationId)\n \t{\n-\t\tfinal I_C_BPartner_Location bpLocation = getBPartnerLocationById(bpLocationId);\n-\t\tfinal LocationId locationId = LocationId.ofRepoId(bpLocation.getC_Location_ID());\n+\t\ttry\n+\t\t{\n+\t\t\tfinal I_C_BPartner_Location bpLocation = getBPartnerLocationById(bpLocationId);\n+\t\t\tfinal LocationId locationId = LocationId.ofRepoId(bpLocation.getC_Location_ID());\n+\n+\t\t\tfinal ILocationDAO locationRepos = Services.get(ILocationDAO.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bb095e9589f1592e99dbf416d58b1415cdea1c6"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NjM3MDAzOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/bpartner/service/impl/BPartnerDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNTo1NjozMlrOGYSszg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNTo1OToxOFrOGYS0iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODEyNTM5MA==", "bodyText": "declare msgBL as a class field", "url": "https://github.com/metasfresh/metasfresh/pull/6702#discussion_r428125390", "createdAt": "2020-05-20T15:56:32Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/bpartner/service/impl/BPartnerDAO.java", "diffHunk": "@@ -492,11 +496,21 @@ else if (bpLocations.size() == 1)\n \t@Override\n \tpublic CountryId retrieveBPartnerLocationCountryId(@NonNull final BPartnerLocationId bpLocationId)\n \t{\n-\t\tfinal I_C_BPartner_Location bpLocation = getBPartnerLocationById(bpLocationId);\n-\t\tfinal LocationId locationId = LocationId.ofRepoId(bpLocation.getC_Location_ID());\n+\t\ttry\n+\t\t{\n+\t\t\tfinal I_C_BPartner_Location bpLocation = getBPartnerLocationById(bpLocationId);\n+\t\t\tfinal LocationId locationId = LocationId.ofRepoId(bpLocation.getC_Location_ID());\n+\n+\t\t\tfinal ILocationDAO locationRepos = Services.get(ILocationDAO.class);\n+\t\t\treturn locationRepos.getCountryIdByLocationId(locationId);\n+\t\t}\n+\t\tcatch (NullPointerException ex)\n+\t\t{\n+\t\t\tfinal IMsgBL msgBL = Services.get(IMsgBL.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bb095e9589f1592e99dbf416d58b1415cdea1c6"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODEyNzM3MQ==", "bodyText": "also avoid catching NPE. better check where is thrown", "url": "https://github.com/metasfresh/metasfresh/pull/6702#discussion_r428127371", "createdAt": "2020-05-20T15:59:18Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/bpartner/service/impl/BPartnerDAO.java", "diffHunk": "@@ -492,11 +496,21 @@ else if (bpLocations.size() == 1)\n \t@Override\n \tpublic CountryId retrieveBPartnerLocationCountryId(@NonNull final BPartnerLocationId bpLocationId)\n \t{\n-\t\tfinal I_C_BPartner_Location bpLocation = getBPartnerLocationById(bpLocationId);\n-\t\tfinal LocationId locationId = LocationId.ofRepoId(bpLocation.getC_Location_ID());\n+\t\ttry\n+\t\t{\n+\t\t\tfinal I_C_BPartner_Location bpLocation = getBPartnerLocationById(bpLocationId);\n+\t\t\tfinal LocationId locationId = LocationId.ofRepoId(bpLocation.getC_Location_ID());\n+\n+\t\t\tfinal ILocationDAO locationRepos = Services.get(ILocationDAO.class);\n+\t\t\treturn locationRepos.getCountryIdByLocationId(locationId);\n+\t\t}\n+\t\tcatch (NullPointerException ex)\n+\t\t{\n+\t\t\tfinal IMsgBL msgBL = Services.get(IMsgBL.class);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODEyNTM5MA=="}, "originalCommit": {"oid": "7bb095e9589f1592e99dbf416d58b1415cdea1c6"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2OTA5NDIwOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/bpartner/service/impl/BPartnerDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDowOTo0M1rOGYtcGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDo1Mjo0OVrOGYujTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU2MzQ4Mw==", "bodyText": "u can pass directly the MSG_ADDRESS_INACTIVE.\nNo need to call msgBL", "url": "https://github.com/metasfresh/metasfresh/pull/6702#discussion_r428563483", "createdAt": "2020-05-21T10:09:43Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/bpartner/service/impl/BPartnerDAO.java", "diffHunk": "@@ -493,6 +499,11 @@ else if (bpLocations.size() == 1)\n \tpublic CountryId retrieveBPartnerLocationCountryId(@NonNull final BPartnerLocationId bpLocationId)\n \t{\n \t\tfinal I_C_BPartner_Location bpLocation = getBPartnerLocationById(bpLocationId);\n+\t\tif (bpLocation == null)\n+\t\t{\n+\t\t\tfinal ITranslatableString message = msgBL.getTranslatableMsgText(MSG_ADDRESS_INACTIVE, Collections.emptyList());\n+\t\t\tthrow new AdempiereException(message).markAsUserValidationError();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "282ec218600d7aee1d3f5b32a4b920c6371c2ea1"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU4MTcxMA==", "bodyText": "i.e. new AdempiereException(MSG_ADDRESS_INACTIVE).markAsUserValidationError();", "url": "https://github.com/metasfresh/metasfresh/pull/6702#discussion_r428581710", "createdAt": "2020-05-21T10:52:49Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/bpartner/service/impl/BPartnerDAO.java", "diffHunk": "@@ -493,6 +499,11 @@ else if (bpLocations.size() == 1)\n \tpublic CountryId retrieveBPartnerLocationCountryId(@NonNull final BPartnerLocationId bpLocationId)\n \t{\n \t\tfinal I_C_BPartner_Location bpLocation = getBPartnerLocationById(bpLocationId);\n+\t\tif (bpLocation == null)\n+\t\t{\n+\t\t\tfinal ITranslatableString message = msgBL.getTranslatableMsgText(MSG_ADDRESS_INACTIVE, Collections.emptyList());\n+\t\t\tthrow new AdempiereException(message).markAsUserValidationError();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU2MzQ4Mw=="}, "originalCommit": {"oid": "282ec218600d7aee1d3f5b32a4b920c6371c2ea1"}, "originalPosition": 79}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1544, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}