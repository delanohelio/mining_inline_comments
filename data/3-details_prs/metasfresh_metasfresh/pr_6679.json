{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5MzcxNTMy", "number": 6679, "title": "Frontend 6653 selection", "bodyText": "", "createdAt": "2020-05-18T09:23:36Z", "url": "https://github.com/metasfresh/metasfresh/pull/6679", "merged": true, "mergeCommit": {"oid": "053f47dd0217ca56d157b2e6d5b2349682b367ac"}, "closed": true, "closedAt": "2020-05-19T06:32:21Z", "author": {"login": "petrican"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchOg3SgH2gAyNDE5MzcxNTMyOmUxZjhkODM0ZWFiZDFlZmQ1MTdkMmU2NDdhNjcyOTA4MGUzNmIzYzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABciuH4egH2gAyNDE5MzcxNTMyOmQ5MGQwYmQyMDllOGZhNDQ2YzQyMjY5ZjM0ODFmMjJiYTJkMWRlZjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e1f8d834eabd1efd517d2e647a6729080e36b3c0", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/e1f8d834eabd1efd517d2e647a6729080e36b3c0", "committedDate": "2020-05-14T14:40:09Z", "message": "Prereq for updating the tables selections over the new structure #6653"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5de9f8998131d30e90e7a0015cd820985e7b0d91", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/5de9f8998131d30e90e7a0015cd820985e7b0d91", "committedDate": "2020-05-18T07:02:54Z", "message": "Selection by default if nothing selected #6653"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bda8c69906b6acbdd9c4210b4a2881196a4ad61", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/7bda8c69906b6acbdd9c4210b4a2881196a4ad61", "committedDate": "2020-05-18T07:05:31Z", "message": "Fix linter error 6653"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdab7f50a7ec3e6026b5aaf8bef3546569546982", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/bdab7f50a7ec3e6026b5aaf8bef3546569546982", "committedDate": "2020-05-18T09:20:31Z", "message": "Fix selection #6653"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3154ba5ed31494326ea4c4551f91ee85a12a137a", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/3154ba5ed31494326ea4c4551f91ee85a12a137a", "committedDate": "2020-05-18T09:25:24Z", "message": "Fix linter errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNDQ2NTMy", "url": "https://github.com/metasfresh/metasfresh/pull/6679#pullrequestreview-413446532", "createdAt": "2020-05-18T09:59:20Z", "commit": {"oid": "3154ba5ed31494326ea4c4551f91ee85a12a137a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwOTo1OToyMFrOGWwHdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxMDowNjo1NVrOGWwYsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxMDE5Nw==", "bodyText": "So the idea behind the action creators for tables was that they will just accept an ID and we won't have to deal with that in the reducer. So please align this with the already existing ACs.", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426510197", "createdAt": "2020-05-18T09:59:20Z", "author": {"login": "siemiatj"}, "path": "frontend/src/actions/TableActions.js", "diffHunk": "@@ -192,3 +192,13 @@ export function updateTabTable(tableId, tableResponse) {\n     }\n   };\n }\n+\n+/**\n+ * Update table selection - select items\n+ */\n+export function updateTableSelection({ windowId, viewId, ids }) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3154ba5ed31494326ea4c4551f91ee85a12a137a"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxMTA5OA==", "bodyText": "Maybe we sholud just set parentView to null if it doesn't exist ? We won't have to make those computation-heavy checks here.", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426511098", "createdAt": "2020-05-18T10:00:53Z", "author": {"login": "siemiatj"}, "path": "frontend/src/components/app/QuickActions.js", "diffHunk": "@@ -249,7 +249,11 @@ export class QuickActions extends Component {\n             const relatedActions =\n               resp && resp.data ? respRel.data.actions : null;\n \n-            if ((parentView.viewId || childView.viewId) && relatedActions) {\n+            if (\n+              (parentView.viewId || childView.viewId) &&\n+              relatedActions &&\n+              !_.isEmpty(parentView)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3154ba5ed31494326ea4c4551f91ee85a12a137a"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxMjEyOA==", "bodyText": "if rows is an array (and same for selected) why can't we just check the length property ?", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426512128", "createdAt": "2020-05-18T10:02:35Z", "author": {"login": "siemiatj"}, "path": "frontend/src/components/table/Table.js", "diffHunk": "@@ -90,6 +92,25 @@ class Table extends Component {\n       page,\n     } = this.props;\n     const { selected, rows } = this.state;\n+\n+    /**\n+     * Selection by default of first row if nothing selected\n+     */\n+    if (\n+      (_.isEmpty(defaultSelected) || _.isEmpty(selected)) &&\n+      !_.isEmpty(rows)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3154ba5ed31494326ea4c4551f91ee85a12a137a"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxMjczMA==", "bodyText": "I think this can be moved to TableTypes", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426512730", "createdAt": "2020-05-18T10:03:34Z", "author": {"login": "siemiatj"}, "path": "frontend/src/constants/ActionTypes.js", "diffHunk": "@@ -616,3 +616,9 @@ export const UPDATE_TAB_ROWS_DATA = 'UPDATE_TAB_ROWS_DATA';\n  * @type {string} set languages in the app handler\n  */\n export const SET_LANGUAGES = 'SET_LANGUAGES';\n+\n+/**\n+ * @constant\n+ * @type {string} update table selection\n+ */\n+export const UPDATE_TABLE_SELECTION = 'UPDATE_TABLE_SELECTION';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3154ba5ed31494326ea4c4551f91ee85a12a137a"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjUxNDYwOA==", "bodyText": "draftState is already a copy of the object so it's easier to just set the selected property (like for activeState) , since we're not merging anything but setting it fresh.", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426514608", "createdAt": "2020-05-18T10:06:55Z", "author": {"login": "siemiatj"}, "path": "frontend/src/reducers/tables.js", "diffHunk": "@@ -107,6 +107,17 @@ const reducer = produce((draftState, action) => {\n       return;\n     }\n \n+    case types.UPDATE_TABLE_SELECTION: {\n+      const { windowId, viewId, selection } = action.payload;\n+      const tableId = getTableId({ windowType: windowId, viewId });\n+      draftState[tableId] = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3154ba5ed31494326ea4c4551f91ee85a12a137a"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0306f03b69c168805f37b16698be2992ce1c5418", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/0306f03b69c168805f37b16698be2992ce1c5418", "committedDate": "2020-05-18T10:10:58Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62af334b703ffbc3b7cfb13e42322b272eae004c", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/62af334b703ffbc3b7cfb13e42322b272eae004c", "committedDate": "2020-05-18T12:09:12Z", "message": "Call action with tableId only #6653"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzI0MTcx", "url": "https://github.com/metasfresh/metasfresh/pull/6679#pullrequestreview-413724171", "createdAt": "2020-05-18T15:51:49Z", "commit": {"oid": "62af334b703ffbc3b7cfb13e42322b272eae004c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNTo1MTo1MFrOGW9Veg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNTo1MTo1MFrOGW9Veg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcyNjc3OA==", "bodyText": "this should be fixed when we refactor TableItem.\nWe cannot allow having a prop which is sometimes bool and sometimes string.\nPlease add a FIXME/TODO marker to be handled later and not forget.", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426726778", "createdAt": "2020-05-18T15:51:50Z", "author": {"login": "teosarca"}, "path": "frontend/src/components/table/TableItem.js", "diffHunk": "@@ -715,7 +715,7 @@ TableItem.propTypes = {\n   tabIndex: PropTypes.number,\n   entity: PropTypes.string,\n   getSizeClass: PropTypes.func,\n-  colspan: PropTypes.string,\n+  colspan: PropTypes.oneOfType([PropTypes.bool, PropTypes.string]),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62af334b703ffbc3b7cfb13e42322b272eae004c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzQzMTAz", "url": "https://github.com/metasfresh/metasfresh/pull/6679#pullrequestreview-413743103", "createdAt": "2020-05-18T16:13:26Z", "commit": {"oid": "62af334b703ffbc3b7cfb13e42322b272eae004c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNjoxMzoyNlrOGW-P9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNjoxMzoyNlrOGW-P9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc0MTc1MA==", "bodyText": "@siemiatj  @petrican  IMHO this shall be called initialTableState", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426741750", "createdAt": "2020-05-18T16:13:26Z", "author": {"login": "teosarca"}, "path": "frontend/src/reducers/tables.js", "diffHunk": "@@ -3,6 +3,7 @@ import { get } from 'lodash';\n import { createSelector } from 'reselect';\n \n import * as types from '../constants/ActionTypes';\n+import { UPDATE_TABLE_SELECTION } from '../constants/actions/TableTypes';\n \n export const tableState = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62af334b703ffbc3b7cfb13e42322b272eae004c"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzQ0NTU0", "url": "https://github.com/metasfresh/metasfresh/pull/6679#pullrequestreview-413744554", "createdAt": "2020-05-18T16:15:10Z", "commit": {"oid": "62af334b703ffbc3b7cfb13e42322b272eae004c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNjoxNToxMFrOGW-UfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNjoxNToxMFrOGW-UfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc0MjkwOQ==", "bodyText": "why do we have selectTableItems along with updateTableSelection?", "url": "https://github.com/metasfresh/metasfresh/pull/6679#discussion_r426742909", "createdAt": "2020-05-18T16:15:10Z", "author": {"login": "teosarca"}, "path": "frontend/src/components/table/Table.js", "diffHunk": "@@ -375,6 +409,12 @@ class Table extends Component {\n       const { selected } = this.state;\n \n       if (tabInfo) {\n+        dispatch(\n+          updateTableSelection({\n+            tableId: getTableId({ windowType: windowId, viewId }),\n+            ids: selected,\n+          })\n+        );\n         dispatch(\n           selectTableItems({", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62af334b703ffbc3b7cfb13e42322b272eae004c"}, "originalPosition": 74}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzOTkxNzU1", "url": "https://github.com/metasfresh/metasfresh/pull/6679#pullrequestreview-413991755", "createdAt": "2020-05-18T22:57:27Z", "commit": {"oid": "62af334b703ffbc3b7cfb13e42322b272eae004c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7af776309a133c85e791978e2916462216c93c49", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/7af776309a133c85e791978e2916462216c93c49", "committedDate": "2020-05-19T05:06:21Z", "message": "Small fmixes after review #6653"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d90d0bd209e8fa446c42269f3481f22ba2d1def9", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/d90d0bd209e8fa446c42269f3481f22ba2d1def9", "committedDate": "2020-05-19T06:03:45Z", "message": "Merged master branch to current and updated the unit tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3420, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}