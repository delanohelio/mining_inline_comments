{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0MzgwMzMy", "number": 10026, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTowNzowOFrOEof3Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTowOTozM1rOEof6aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTAwNTgyOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.material/dispo-service/src/main/java/de/metas/material/dispo/service/candidatechange/StockCandidateService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTowNzowOFrOHZn8vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTowNzowOFrOHZn8vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYzMDk3NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t{ // our stock candidate's quantity shall not be bound to a particular customer, so don't propagate it\n          \n          \n            \n            \t\t{ // our stock candidate's quantity shall not be bound to a particular customer, so don't propagate the costomer-id to the stock record", "url": "https://github.com/metasfresh/metasfresh/pull/10026#discussion_r496630975", "createdAt": "2020-09-29T11:07:08Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.material/dispo-service/src/main/java/de/metas/material/dispo/service/candidatechange/StockCandidateService.java", "diffHunk": "@@ -107,13 +107,22 @@ public SaveResult createStockCandidate(@NonNull final Candidate candidate)\n \t\t\t\t? previousStockOrNull.getGroupId()\n \t\t\t\t: null;\n \n-\t\tfinal Candidate stockCandidate = Candidate.builder()\n+\t\tfinal Candidate.CandidateBuilder candidateBuilder = Candidate.builder()\n \t\t\t\t.type(CandidateType.STOCK)\n \t\t\t\t.clientAndOrgId(candidate.getClientAndOrgId())\n-\t\t\t\t.materialDescriptor(materialDescriptor)\n \t\t\t\t.parentId(candidate.getParentId())\n \t\t\t\t.seqNo(candidate.getSeqNo())\n-\t\t\t\t.groupId(groupId)\n+\t\t\t\t.groupId(groupId);\n+\t\tif (materialDescriptor.isReservedForCustomer())\n+\t\t{\n+\t\t\tcandidateBuilder.materialDescriptor(materialDescriptor);\n+\t\t}\n+\t\telse\n+\t\t{ // our stock candidate's quantity shall not be bound to a particular customer, so don't propagate it", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5a940410636486679fd2ed9b126adce17c2d224"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTAxMTYzOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.material/dispo-service/src/main/java/de/metas/material/dispo/service/candidatechange/StockCandidateService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTowOTowMFrOHZoAaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTowOTowMFrOHZoAaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYzMTkxNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t// do include the bpartner in the query, because e.g. an increase for a given bpartner does a raised ATP just for that partner, and not for everyone\n          \n          \n            \n            \t\t\t// do include the bpartner in the query, because e.g. an increase for a given bpartner causes a raised ATP just for that partner, but not for everyone", "url": "https://github.com/metasfresh/metasfresh/pull/10026#discussion_r496631915", "createdAt": "2020-09-29T11:09:00Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.material/dispo-service/src/main/java/de/metas/material/dispo/service/candidatechange/StockCandidateService.java", "diffHunk": "@@ -282,14 +291,14 @@ private MaterialDescriptorQueryBuilder createMaterialDescriptorQueryBuilder(\n \t\t\t\t.builder()\n \t\t\t\t.customerIdOperator(CustomerIdOperator.GIVEN_ID_OR_NULL); // want the latest, only excluding records that have a *different* customerId\n \n-\t\tif (materialDescriptor.getCustomerId() != null)\n+\t\tif (materialDescriptor.getCustomerId() != null && materialDescriptor.isReservedForCustomer())\n \t\t{\n \t\t\t// do include the bpartner in the query, because e.g. an increase for a given bpartner does a raised ATP just for that partner, and not for everyone", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5a940410636486679fd2ed9b126adce17c2d224"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEwOTAxMzUzOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.material/dispo-service/src/main/java/de/metas/material/dispo/service/candidatechange/StockCandidateService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTowOTozM1rOHZoBlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMTowOTozM1rOHZoBlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYzMjIxMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t// ..on the other hand, if materialDescriptor has *no* bpartner or that partner is just for info, then the respective change in qty is related to everybody\n          \n          \n            \n            \t\t\t// ..on the other hand, if materialDescriptor has *no* bpartner or that partner is just for info, then the respective change in ATP is for everybody", "url": "https://github.com/metasfresh/metasfresh/pull/10026#discussion_r496632212", "createdAt": "2020-09-29T11:09:33Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.material/dispo-service/src/main/java/de/metas/material/dispo/service/candidatechange/StockCandidateService.java", "diffHunk": "@@ -282,14 +291,14 @@ private MaterialDescriptorQueryBuilder createMaterialDescriptorQueryBuilder(\n \t\t\t\t.builder()\n \t\t\t\t.customerIdOperator(CustomerIdOperator.GIVEN_ID_OR_NULL); // want the latest, only excluding records that have a *different* customerId\n \n-\t\tif (materialDescriptor.getCustomerId() != null)\n+\t\tif (materialDescriptor.getCustomerId() != null && materialDescriptor.isReservedForCustomer())\n \t\t{\n \t\t\t// do include the bpartner in the query, because e.g. an increase for a given bpartner does a raised ATP just for that partner, and not for everyone\n \t\t\tbuilder.customer(BPartnerClassifier.specific(materialDescriptor.getCustomerId()));\n \t\t}\n \t\telse\n \t\t{\n-\t\t\t// ..on the other hand, if materialDescriptor has *no* bpartner, then the respective change in qty is related to everybody\n+\t\t\t// ..on the other hand, if materialDescriptor has *no* bpartner or that partner is just for info, then the respective change in qty is related to everybody", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5a940410636486679fd2ed9b126adce17c2d224"}, "originalPosition": 79}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1194, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}