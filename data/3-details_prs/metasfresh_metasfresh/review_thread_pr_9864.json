{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2MTk0NDAy", "number": 9864, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxMDo0MzoyMFrOEeQMvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxMTo1MDoyOFrOEeRmCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMTU4MTQzOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.business/src/main/java/de/metas/invoice/service/impl/AbstractInvoiceBL.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxMDo0MzoyMFrOHJzeZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxMDo0MzoyMFrOHJzeZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDA0MjU5OA==", "bodyText": "are we sure this should be isCreditedInvoiceReinvoicable() and not referenceInvoice()", "url": "https://github.com/metasfresh/metasfresh/pull/9864#discussion_r480042598", "createdAt": "2020-08-31T10:43:20Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.business/src/main/java/de/metas/invoice/service/impl/AbstractInvoiceBL.java", "diffHunk": "@@ -161,18 +161,23 @@\n \tpublic final I_C_Invoice creditInvoice(@NonNull final I_C_Invoice invoice, final InvoiceCreditContext creditCtx)\n \t{\n \t\tCheck.errorIf(isCreditMemo(invoice), \"Param 'invoice'={} may not be a credit memo\");\n-\t\tCheck.errorIf(invoice.isPaid(), \"Param 'invoice'={} may not yet be paid\");\n-\n \t\tCheck.assume(invoice.getGrandTotal().signum() != 0, \"GrandTotal!=0 for {}\", invoice);\n \n-\t\tfinal Properties ctx = InterfaceWrapperHelper.getCtx(invoice);\n-\t\t//\n-\t\t// 'openAmt is the amount that shall end up in the credit memo's GrandTotal\n-\t\tfinal BigDecimal openAmt = Services.get(IAllocationDAO.class).retrieveOpenAmt(invoice,\n-\t\t\t\tfalse); // creditMemoAdjusted = false\n+\t\tif (creditCtx.isCreditedInvoiceReinvoicable())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09d6dddba75ca26b07a76b6e6c1582412ed766ea"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMTYwODU0OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.business/src/main/java/de/metas/invoice/service/impl/AbstractInvoiceBL.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxMDo1MDoyMFrOHJzvOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxMDo1MDoyMFrOHJzvOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDA0NjkwNA==", "bodyText": "please change this error a bit. e.g. throw an AdempiereException with text\n\"If the credit memo shall reference the credited invoice, then that invoice may not yet be paid\");\nand append the C_Invoice_ID as exception parameter", "url": "https://github.com/metasfresh/metasfresh/pull/9864#discussion_r480046904", "createdAt": "2020-08-31T10:50:20Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.business/src/main/java/de/metas/invoice/service/impl/AbstractInvoiceBL.java", "diffHunk": "@@ -163,7 +163,7 @@ public final I_C_Invoice creditInvoice(@NonNull final I_C_Invoice invoice, final\n \t\tCheck.errorIf(isCreditMemo(invoice), \"Param 'invoice'={} may not be a credit memo\");\n \t\tCheck.assume(invoice.getGrandTotal().signum() != 0, \"GrandTotal!=0 for {}\", invoice);\n \n-\t\tif (creditCtx.isCreditedInvoiceReinvoicable())\n+\t\tif (creditCtx.isReferenceInvoice())\n \t\t{\n \t\t\tCheck.errorIf(invoice.isPaid(), \"Param 'invoice'={} may not yet be paid\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d99b855bf0576ccb0b67eb6f11c3e46a3f3848ec"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMTgxMDAxOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5565960_sys_gh9863_CreditMemo_For_Paid_Invoice_Messages.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxMTo1MDoyOFrOHJ1ocg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxMTo1MDoyOFrOHJ1ocg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDA3NzkzOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            UPDATE AD_Message_Trl SET IsTranslated='Y', MsgText='IIf the credit memo shall reference the credited invoice = {0}, then that invoice may not yet be paid.',Updated=TO_TIMESTAMP('2020-08-31 14:30:28','YYYY-MM-DD HH24:MI:SS'),UpdatedBy=100 WHERE AD_Language='en_US' AND AD_Message_ID=544998\n          \n          \n            \n            UPDATE AD_Message_Trl SET IsTranslated='Y', MsgText='If the credit memo shall reference the credited invoice = {0}, then that invoice may not yet be paid.',Updated=TO_TIMESTAMP('2020-08-31 14:30:28','YYYY-MM-DD HH24:MI:SS'),UpdatedBy=100 WHERE AD_Language='en_US' AND AD_Message_ID=544998", "url": "https://github.com/metasfresh/metasfresh/pull/9864#discussion_r480077938", "createdAt": "2020-08-31T11:50:28Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5565960_sys_gh9863_CreditMemo_For_Paid_Invoice_Messages.sql", "diffHunk": "@@ -0,0 +1,40 @@\n+-- 2020-08-31T11:28:25.800Z\n+-- URL zum Konzept\n+INSERT INTO AD_Message (AD_Client_ID,AD_Message_ID,AD_Org_ID,Created,CreatedBy,EntityType,IsActive,MsgText,MsgType,Updated,UpdatedBy,Value) VALUES (0,544998,0,TO_TIMESTAMP('2020-08-31 14:28:24','YYYY-MM-DD HH24:MI:SS'),100,'D','Y','Wenn die gutgeschriebene Rechnung  = {} referenziert werden soll, dann darf sie noch nicht bezahlt sein.','I',TO_TIMESTAMP('2020-08-31 14:28:24','YYYY-MM-DD HH24:MI:SS'),100,'de.metas.invoice.service.impl.AbstractInvoiceBL_InvoiceMayNotBePaid')\n+;\n+\n+-- 2020-08-31T11:28:25.956Z\n+-- URL zum Konzept\n+INSERT INTO AD_Message_Trl (AD_Language,AD_Message_ID, MsgText,MsgTip, IsTranslated,AD_Client_ID,AD_Org_ID,Created,Createdby,Updated,UpdatedBy) SELECT l.AD_Language, t.AD_Message_ID, t.MsgText,t.MsgTip, 'N',t.AD_Client_ID,t.AD_Org_ID,t.Created,t.Createdby,t.Updated,t.UpdatedBy FROM AD_Language l, AD_Message t WHERE l.IsActive='Y'AND (l.IsSystemLanguage='Y' AND l.IsBaseLanguage='N') AND t.AD_Message_ID=544998 AND NOT EXISTS (SELECT 1 FROM AD_Message_Trl tt WHERE tt.AD_Language=l.AD_Language AND tt.AD_Message_ID=t.AD_Message_ID)\n+;\n+\n+-- 2020-08-31T11:29:16.800Z\n+-- URL zum Konzept\n+UPDATE AD_Message SET MsgText='Wenn die gutgeschriebene Rechnung = {0} referenziert werden soll, dann darf sie noch nicht bezahlt sein.',Updated=TO_TIMESTAMP('2020-08-31 14:29:16','YYYY-MM-DD HH24:MI:SS'),UpdatedBy=100 WHERE AD_Message_ID=544998\n+;\n+\n+-- 2020-08-31T11:30:28.250Z\n+-- URL zum Konzept\n+UPDATE AD_Message_Trl SET IsTranslated='Y', MsgText='IIf the credit memo shall reference the credited invoice = {0}, then that invoice may not yet be paid.',Updated=TO_TIMESTAMP('2020-08-31 14:30:28','YYYY-MM-DD HH24:MI:SS'),UpdatedBy=100 WHERE AD_Language='en_US' AND AD_Message_ID=544998", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b441299c7f252ec7398eaee02c403ed295a27fd"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1255, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}