{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwNDY1NTgx", "number": 6008, "title": "#409 Aded UOM conversion check when adding a new price to a product.", "bodyText": "#6007", "createdAt": "2020-01-08T13:43:47Z", "url": "https://github.com/metasfresh/metasfresh/pull/6008", "merged": true, "mergeCommit": {"oid": "988416fb99f89e7c9706d28f4e03584fc65228e9"}, "closed": true, "closedAt": "2020-01-10T16:22:29Z", "author": {"login": "dragospodariu96"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4Vd-TAH2gAyMzYwNDY1NTgxOmFmMzc3M2Q1NjQ5ZGFmY2NjZDdmNzRjODc2NmZiM2IxYjBlZDEwNmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb5AguAgH2gAyMzYwNDY1NTgxOjNkNzhjYmYzMGI2ZGIxZTI4YTEwMDg2ZmY4ZmFlYzRkNjUwZDczODM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "af3773d5649dafcccd7f74c8766fb3b1b0ed106d", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/af3773d5649dafcccd7f74c8766fb3b1b0ed106d", "committedDate": "2020-01-08T13:35:26Z", "message": "#409 Aded UOM conversion check when adding a new price to a product."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c3e2984ef600faa77c31f6c48744814d078a37d", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/7c3e2984ef600faa77c31f6c48744814d078a37d", "committedDate": "2020-01-08T13:59:54Z", "message": "#409 Removed unnecessary import."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bde99f829e71649f00b61f19f9c5a12d5563f3e", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/1bde99f829e71649f00b61f19f9c5a12d5563f3e", "committedDate": "2020-01-08T15:18:37Z", "message": "#409 Changed ModelChange configuration to the check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce6fd776cfb1f0b959d466934e612137c0d46e6e", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/ce6fd776cfb1f0b959d466934e612137c0d46e6e", "committedDate": "2020-01-08T15:34:14Z", "message": "Merge branch 'master' into gh409"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwMzIxNjkw", "url": "https://github.com/metasfresh/metasfresh/pull/6008#pullrequestreview-340321690", "createdAt": "2020-01-09T07:07:49Z", "commit": {"oid": "ce6fd776cfb1f0b959d466934e612137c0d46e6e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNzowNzo1MFrOFbsfjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQwNzowNzo1MFrOFbsfjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU4NDg0NQ==", "bodyText": "Create an AD_Message record with translations (we'll need en_US, de_DE and de_CH) and use IMsg (Services.get(IMsg.class)) to get a translatable string instance.\nPassing hardcoded strings  generally doesn't make sense for user-errors", "url": "https://github.com/metasfresh/metasfresh/pull/6008#discussion_r364584845", "createdAt": "2020-01-09T07:07:50Z", "author": {"login": "metas-ts"}, "path": "de.metas.business/src/main/java/de/metas/pricing/service/ProductPrices.java", "diffHunk": "@@ -124,6 +127,38 @@ public static void assertMainProductPriceIsNotDuplicate(final I_M_ProductPrice p\n \t\tgetFirstOrThrowExceptionIfMoreThanOne(allMainPrices);\n \t}\n \n+\tpublic static void assertUomConversionExists(final I_M_ProductPrice productPrice)\n+\t{\n+\t\tif (productPrice == null || !productPrice.isActive())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tif (productPrice.isInvalidPrice())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tfinal IProductDAO productDAO = Services.get(IProductDAO.class);\n+\t\tfinal org.compiere.model.I_M_Product product = productDAO.getById(productPrice.getM_Product_ID());\n+\n+\t\tif (UomId.ofRepoId(product.getC_UOM_ID()).equals(UomId.ofRepoId(productPrice.getC_UOM_ID())))\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tfinal IUOMConversionDAO uomConversionRepo = Services.get(IUOMConversionDAO.class);\n+\t\tfinal ProductId productId = ProductId.ofRepoId(productPrice.getM_Product_ID());\n+\n+\t\tUOMConversionsMap conversionsMap = uomConversionRepo.getProductConversions(productId);\n+\n+\t\tif (conversionsMap.getRateIfExists(UomId.ofRepoId(product.getC_UOM_ID()), UomId.ofRepoId(productPrice.getC_UOM_ID())).isPresent())\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\t\tthrow new AdempiereException(\"UOM Conversion to the selected UOM doesn't exist\").markAsUserValidationError();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce6fd776cfb1f0b959d466934e612137c0d46e6e"}, "originalPosition": 61}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23261c41744eb50ebf54456e9080c80cb2461a18", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/23261c41744eb50ebf54456e9080c80cb2461a18", "committedDate": "2020-01-09T09:12:36Z", "message": "Merge branch 'master' into gh409"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9e3054d9f37718448dc56b89ca925ec8bed80bf", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/b9e3054d9f37718448dc56b89ca925ec8bed80bf", "committedDate": "2020-01-09T12:29:47Z", "message": "#409 Removed hardcoded Error message. Added translated one in AD_Message."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "616a3c263e3ee0267f9bd8ff9cf5bcdfaba187f3", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/616a3c263e3ee0267f9bd8ff9cf5bcdfaba187f3", "committedDate": "2020-01-09T12:30:33Z", "message": "Merge branch 'master' into gh409"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "301b4559cf80a833de42145e9ba5de80d9ed1a73", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/301b4559cf80a833de42145e9ba5de80d9ed1a73", "committedDate": "2020-01-09T13:00:29Z", "message": "#409 Removed unnecessary duplicate product check."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a4cc7bbbea9ed4219f2c6ee8cb82c722a742f01", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/2a4cc7bbbea9ed4219f2c6ee8cb82c722a742f01", "committedDate": "2020-01-09T13:01:31Z", "message": "#409 Removed unnecessary duplicate product check."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "088ad39a251539b0cfe10319e5446e07a73965c6", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/088ad39a251539b0cfe10319e5446e07a73965c6", "committedDate": "2020-01-09T13:46:19Z", "message": "Merge branch 'master' into gh409"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNTk1MzI0", "url": "https://github.com/metasfresh/metasfresh/pull/6008#pullrequestreview-340595324", "createdAt": "2020-01-09T15:18:02Z", "commit": {"oid": "2a4cc7bbbea9ed4219f2c6ee8cb82c722a742f01"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNTk5NjUy", "url": "https://github.com/metasfresh/metasfresh/pull/6008#pullrequestreview-340599652", "createdAt": "2020-01-09T15:23:22Z", "commit": {"oid": "088ad39a251539b0cfe10319e5446e07a73965c6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNToyMzoyMlrOFb5j-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNToyMzoyMlrOFb5j-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDc5ODk2OQ==", "bodyText": "why were the checks here unnecessary? remember, you never know who is going to call this public static method.\nMaybe you can annotate the productPrice parameter with @NonNull (lombok!), but i thik you should check still for IsActive and IsValid", "url": "https://github.com/metasfresh/metasfresh/pull/6008#discussion_r364798969", "createdAt": "2020-01-09T15:23:22Z", "author": {"login": "metas-ts"}, "path": "de.metas.business/src/main/java/de/metas/pricing/service/ProductPrices.java", "diffHunk": "@@ -124,6 +130,29 @@ public static void assertMainProductPriceIsNotDuplicate(final I_M_ProductPrice p\n \t\tgetFirstOrThrowExceptionIfMoreThanOne(allMainPrices);\n \t}\n \n+\tpublic static void assertUomConversionExists(final I_M_ProductPrice productPrice)\n+\t{\n+\t\tfinal IProductDAO productDAO = Services.get(IProductDAO.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "088ad39a251539b0cfe10319e5446e07a73965c6"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b603656fe9291a37d3726c244bf42c284cc73858", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/b603656fe9291a37d3726c244bf42c284cc73858", "committedDate": "2020-01-09T15:35:02Z", "message": "#409 Added back the checks."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6b3f21e30eb06b65ae056b672bf081e0eaa848e", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/c6b3f21e30eb06b65ae056b672bf081e0eaa848e", "committedDate": "2020-01-09T15:35:37Z", "message": "Merge branch 'master' into gh409"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49a24fee829d1ff0b849e5f2359d3f939ea191d9", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/49a24fee829d1ff0b849e5f2359d3f939ea191d9", "committedDate": "2020-01-10T08:59:03Z", "message": "#5895 Added ifcolumnschanged conditions to the @ModelChange annotation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43299dd12da06e5f057080ced12ca4e7d531d12e", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/43299dd12da06e5f057080ced12ca4e7d531d12e", "committedDate": "2020-01-10T09:02:38Z", "message": "Merge branch 'master' into gh409"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMDUwNzk0", "url": "https://github.com/metasfresh/metasfresh/pull/6008#pullrequestreview-341050794", "createdAt": "2020-01-10T09:44:11Z", "commit": {"oid": "43299dd12da06e5f057080ced12ca4e7d531d12e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d7697ae3a9fac2b1c740f270adb6a9c4d5f0fd9", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/0d7697ae3a9fac2b1c740f270adb6a9c4d5f0fd9", "committedDate": "2020-01-10T10:03:06Z", "message": "Merge branch 'master' into gh409"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d78cbf30b6db1e28a10086ff8faec4d650d7383", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/3d78cbf30b6db1e28a10086ff8faec4d650d7383", "committedDate": "2020-01-10T15:44:21Z", "message": "Merge branch 'master' into gh409"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3649, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}