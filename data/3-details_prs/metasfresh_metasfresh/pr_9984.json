{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNzI4MDc4", "number": 9984, "title": "Store the data in the redux store instead of local state", "bodyText": "-creates a separate branch in the redux store within the tables one for the headers. This is needed because if I were to use the corresponding table branch ID that would have been overwritten on view reload. This way I make sure it remains and is accessible across browsing(back, fw)\nhttps://www.loom.com/share/a4e27010c4cf46e49d5ff6b5585b3795", "createdAt": "2020-09-22T06:45:01Z", "url": "https://github.com/metasfresh/metasfresh/pull/9984", "merged": true, "mergeCommit": {"oid": "af7ef62ef13f037ed04bf241f02536a475d8766c"}, "closed": true, "closedAt": "2020-09-22T12:34:35Z", "author": {"login": "petrican"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLSLVAAH2gAyNDkwNzI4MDc4Ojc3NGFjZDkxMGU3N2NjZDIwZDdkNjc5MmMyNzYwMzRhZDExMzRkNzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLWz9YAFqTQ5MzM4NzY5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "774acd910e77ccd20d7d6792c276034ad1134d75", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/774acd910e77ccd20d7d6792c276034ad1134d75", "committedDate": "2020-09-22T06:41:04Z", "message": "Store the data in the redux store instead of local state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0fa19338714d5de4dfb267a06a822fc2c7c286c", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/c0fa19338714d5de4dfb267a06a822fc2c7c286c", "committedDate": "2020-09-22T07:00:46Z", "message": "Adapt the tests with the changes did in the component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99eccfe7b0ef110221a6cfbfee97de8dd3e15041", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/99eccfe7b0ef110221a6cfbfee97de8dd3e15041", "committedDate": "2020-09-22T08:32:28Z", "message": "Adapts to the Table tests also"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMjYwMjI4", "url": "https://github.com/metasfresh/metasfresh/pull/9984#pullrequestreview-493260228", "createdAt": "2020-09-22T09:03:57Z", "commit": {"oid": "99eccfe7b0ef110221a6cfbfee97de8dd3e15041"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTowMzo1N1rOHVwxsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOToxNzoxMFrOHVxRsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4MTI5Nw==", "bodyText": "Why not add a named export of a component disconnected from the store ? This way you won't have to do the whole shenanigans in the tests and use what we've had instead. Then the reducers/actions can be tested separately. We know, that mapStateToProps works as redux has a pretty good test coverage.", "url": "https://github.com/metasfresh/metasfresh/pull/9984#discussion_r492581297", "createdAt": "2020-09-22T09:03:57Z", "author": {"login": "siemiatj"}, "path": "frontend/src/components/table/TableHeader.js", "diffHunk": "@@ -145,4 +145,23 @@ TableHeader.propTypes = {\n   cols: PropTypes.any,\n   indentSupported: PropTypes.any,\n   setActiveSort: PropTypes.func,\n+  headersFields: PropTypes.object,\n+  setActiveSortFields: PropTypes.func,\n };\n+\n+const mapStateToProps = (state, ownProps) => {\n+  const { viewId, windowType: windowId, docId, tabId } = ownProps;\n+  const tableId = getTableId({ windowId, viewId, docId, tabId });\n+\n+  return {\n+    headersFields:\n+      state.tables && state.tables.headers ? state.tables.headers[tableId] : {},\n+  };\n+};\n+\n+export default connect(\n+  mapStateToProps,\n+  {\n+    setActiveSortFields,\n+  }\n+)(TableHeader);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99eccfe7b0ef110221a6cfbfee97de8dd3e15041"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4NzM1Mg==", "bodyText": "I'm strongly against this. Since we have everything we need in the redux store already, why not use it when instantiating the table instead ? On FETCH_DOCUMENT_SUCCESS we get the orderBy value, and immediately update the table. So we can move this logic there and this whole lifecycle handler won't be needed anymore.", "url": "https://github.com/metasfresh/metasfresh/pull/9984#discussion_r492587352", "createdAt": "2020-09-22T09:13:45Z", "author": {"login": "siemiatj"}, "path": "frontend/src/components/table/TableHeader.js", "diffHunk": "@@ -1,27 +1,27 @@\n import React, { PureComponent } from 'react';\n+import { connect } from 'react-redux';\n import classnames from 'classnames';\n import PropTypes from 'prop-types';\n-\n+import { setActiveSortFields } from '../../actions/TableActions';\n import { shouldRenderColumn, getSizeClass } from '../../utils/tableHelpers';\n import { getTableId } from '../../reducers/tables';\n \n-export default class TableHeader extends PureComponent {\n+class TableHeader extends PureComponent {\n   UNSAFE_componentWillMount() {\n     this.setInitialState();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99eccfe7b0ef110221a6cfbfee97de8dd3e15041"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4OTQ5MQ==", "bodyText": "Shouldn't this be in the tables[tableId].headers ? Or even with a more meaningful name like sortOptions or something ?", "url": "https://github.com/metasfresh/metasfresh/pull/9984#discussion_r492589491", "createdAt": "2020-09-22T09:17:10Z", "author": {"login": "siemiatj"}, "path": "frontend/src/reducers/tables.js", "diffHunk": "@@ -326,6 +326,13 @@ const reducer = produce((draftState, action) => {\n       const { id, active } = action.payload;\n \n       draftState[id].activeSort = active;\n+      return;\n+    }\n+    case types.SET_SORT_FIELDS: {\n+      const { id, fields } = action.payload;\n+      draftState.headers = {};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99eccfe7b0ef110221a6cfbfee97de8dd3e15041"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15283b4aecd2d19dd6781a5ed069c0e18955df2b", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/15283b4aecd2d19dd6781a5ed069c0e18955df2b", "committedDate": "2020-09-22T11:19:23Z", "message": "Ditch some lifecycle methods in TableHeader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87d018f1a6e4a2e4383d0196d1bc39c239683119", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/87d018f1a6e4a2e4383d0196d1bc39c239683119", "committedDate": "2020-09-22T11:19:56Z", "message": "Merge branch 'master' into 9980-indicatorVanished"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "092fcd9e26909ae8a8855ba6714c05f9f50d5b99", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/092fcd9e26909ae8a8855ba6714c05f9f50d5b99", "committedDate": "2020-09-22T11:33:05Z", "message": "Restore the initial TableHeader test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1c71e4526bd7640c3add026d7d5f2aa3b10f9ad", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/b1c71e4526bd7640c3add026d7d5f2aa3b10f9ad", "committedDate": "2020-09-22T11:37:22Z", "message": "Changed headers name to sortOptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bedbc5cb03370a6af7faa7658b44263da19612f4", "author": {"user": null}, "url": "https://github.com/metasfresh/metasfresh/commit/bedbc5cb03370a6af7faa7658b44263da19612f4", "committedDate": "2020-09-22T11:55:49Z", "message": "Fix path in redux store"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMzg3Njk3", "url": "https://github.com/metasfresh/metasfresh/pull/9984#pullrequestreview-493387697", "createdAt": "2020-09-22T12:05:04Z", "commit": {"oid": "bedbc5cb03370a6af7faa7658b44263da19612f4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3195, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}