{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2ODQyOTc2", "number": 10418, "title": "Gh10393", "bodyText": "https://github.com/metasfresh/mf15/issues/487", "createdAt": "2020-12-11T12:01:33Z", "url": "https://github.com/metasfresh/metasfresh/pull/10418", "merged": true, "mergeCommit": {"oid": "068354ccc3e5098c05fcdbc0897cbeb8e587a3ce"}, "closed": true, "closedAt": "2020-12-18T12:44:11Z", "author": {"login": "dragospodariu96"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnBxokAH2gAyNTM2ODQyOTc2OjljNjkxMmVmYzZjYzMzOTY4OTJkNGI3ZmM5NmM0NzA0MzdlYWRmZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnXg7iAFqTU1NTQ1NDkxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9c6912efc6cc3396892d4b7fc96c470437eadfdd", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/9c6912efc6cc3396892d4b7fc96c470437eadfdd", "committedDate": "2020-12-17T11:24:24Z", "message": "#10393\n - Initial commit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NTQxODQ1", "url": "https://github.com/metasfresh/metasfresh/pull/10418#pullrequestreview-554541845", "createdAt": "2020-12-17T12:06:03Z", "commit": {"oid": "3879dd71e6029b22b1c1e71f5062f5ccaf130522"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMjowNjowNFrOIHyj7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMjoxNjo0NVrOIHy8NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTAzOTM0MQ==", "bodyText": "not really sure what the point of this method is..", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545039341", "createdAt": "2020-12-17T12:06:04Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.business/src/main/java/de/metas/order/impl/OrderLineBL.java", "diffHunk": "@@ -328,6 +328,12 @@ public void updateLineNetAmtFromQtyEntered(@NonNull final org.compiere.model.I_C\n \t\tupdateLineNetAmtFromQtyInPriceUOM(orderLine, qtyInPriceUOM);\n \t}\n \n+\t@Override\n+\tpublic void updateMHuPiItemProduct(final I_C_OrderLine orderLine, final int huPiItemProductId)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3879dd71e6029b22b1c1e71f5062f5ccaf130522"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTAzOTg2OA==", "bodyText": "we already have this, in de.metas.handlingunits.model.I_C_Order", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545039868", "createdAt": "2020-12-17T12:06:56Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/interfaces/I_C_OrderLine.java", "diffHunk": "@@ -43,4 +43,8 @@\n \tvoid setHandOver_Location_ID(int handoverLocationId);\n \tint getHandOver_Location_ID();\n \t// @formatter:on\n+\n+\tString COLUMNNAME_M_HU_PI_Item_Product_ID = \"M_HU_PI_Item_Product_ID\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3879dd71e6029b22b1c1e71f5062f5ccaf130522"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA0MzgxNA==", "bodyText": "1 i think it would be better to do this in a ModelInterceptor..i believe it make sense to do this also if e.g. the order line is created via scheduler from an C_OLCand\n2 if the new product has no M_HU_PI_Item_Product_ID, then i think C_OrderLine.M_HU_PI_Item_Product_ID should be set to -1\n3 please add a method Optional<HUPIItemProductId> retrieveDefaultIdForProduct to IHUPIItemProductDAO`\n\nrationale: try to avoid throwing around data records. we like to grow in the general direction of DDD.\nalso, we don't need (to load) the record for this", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545043814", "createdAt": "2020-12-17T12:13:53Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/callout/C_OrderLine.java", "diffHunk": "@@ -47,6 +55,17 @@ public void updateQtyCU(final I_C_OrderLine orderLine, final ICalloutField field\n \t\tServices.get(IOrderLineBL.class).updateLineNetAmtFromQtyEntered(orderLine);\n \t}\n \n+\t@CalloutMethod(columnNames = de.metas.interfaces.I_C_OrderLine.COLUMNNAME_M_Product_ID)\n+\tpublic void onProductSetOrChanged(final de.metas.interfaces.I_C_OrderLine orderLine)\n+\t{\n+\t\tfinal Optional<I_M_HU_PI_Item_Product> huPiItemProduct = hupiItemProductDAO.retrieveDefaultForProduct(ProductId.ofRepoId(orderLine.getM_Product_ID()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3879dd71e6029b22b1c1e71f5062f5ccaf130522"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA0NTU1Ng==", "bodyText": "i didn't understand in the concept, why this was supposed to be changed..so i guess it's fine that it effectively was not changed at all", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545045556", "createdAt": "2020-12-17T12:16:45Z", "author": {"login": "metas-ts"}, "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/quickinput/orderline/OrderLineQuickInputDescriptorFactory.java", "diffHunk": "@@ -175,7 +175,7 @@ private ProductLookupDescriptor createProductLookupDescriptor(@NonNull final Opt\n \t\t\t\t\t\t.setCtxTableName(null) // ctxTableName\n \t\t\t\t\t\t.setCtxColumnName(IOrderLineQuickInput.COLUMNNAME_M_HU_PI_Item_Product_ID)\n \t\t\t\t\t\t.setDisplayType(DisplayType.TableDir)\n-\t\t\t\t\t\t.setAD_Val_Rule_ID(540365) // FIXME: hardcoded \"M_HU_PI_Item_Product_For_Org_and_Product_and_DatePromised\"\n+\t\t\t\t\t\t.setAD_Val_Rule_ID(540365)// FIXME: hardcoded \"M_HU_PI_Item_Product_For_Org_and_Product_and_DatePromised\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3879dd71e6029b22b1c1e71f5062f5ccaf130522"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c95b8aea41c182b518d6c363f1c3b1a83dc559c9", "author": {"user": {"login": "adi-stefan", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/c95b8aea41c182b518d6c363f1c3b1a83dc559c9", "committedDate": "2020-12-18T08:04:48Z", "message": "#gh10393 CR fixes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3879dd71e6029b22b1c1e71f5062f5ccaf130522", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/3879dd71e6029b22b1c1e71f5062f5ccaf130522", "committedDate": "2020-12-10T10:39:48Z", "message": "#10393\n - Initial commit"}, "afterCommit": {"oid": "c95b8aea41c182b518d6c363f1c3b1a83dc559c9", "author": {"user": {"login": "adi-stefan", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/c95b8aea41c182b518d6c363f1c3b1a83dc559c9", "committedDate": "2020-12-18T08:04:48Z", "message": "#gh10393 CR fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "935224947e7e63007f10ec7d6120ff58140a15d8", "author": {"user": {"login": "adi-stefan", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/935224947e7e63007f10ec7d6120ff58140a15d8", "committedDate": "2020-12-18T08:14:49Z", "message": "#gh10393 cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1MzM2NTIw", "url": "https://github.com/metasfresh/metasfresh/pull/10418#pullrequestreview-555336520", "createdAt": "2020-12-18T09:38:51Z", "commit": {"oid": "935224947e7e63007f10ec7d6120ff58140a15d8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOTozODo1MlrOIIbutQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOTozODo1MlrOIIbutQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxMzg0NQ==", "bodyText": "This was missing from Dragos's changes, but was necessary (at least for the batch add)", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545713845", "createdAt": "2020-12-18T09:38:52Z", "author": {"login": "adi-stefan"}, "path": "backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/impl/HUPIItemProductDAO.java", "diffHunk": "@@ -487,6 +488,7 @@ public I_M_HU_PI_Item_Product retrieveMaterialItemProduct(\n \t\t\t\t// Get specific Product first\n \t\t\t\t.addColumn(I_M_HU_PI_Item_Product.COLUMNNAME_IsAllowAnyProduct, Direction.Descending, Nulls.Last) // Y first, N second\n \t\t\t\t.addColumn(I_M_HU_PI_Item_Product.COLUMNNAME_M_Product_ID, Direction.Descending, Nulls.Last)\n+\t\t\t\t.addColumn(I_M_HU_PI_Item_Product.COLUMNNAME_IsDefaultForProduct, Direction.Descending, Nulls.Last)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "935224947e7e63007f10ec7d6120ff58140a15d8"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NDE2MDgw", "url": "https://github.com/metasfresh/metasfresh/pull/10418#pullrequestreview-555416080", "createdAt": "2020-12-18T11:38:27Z", "commit": {"oid": "935224947e7e63007f10ec7d6120ff58140a15d8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxMTozODoyN1rOIIfj8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxMTozODoyN1rOIIfj8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTc3NjYyNg==", "bodyText": "please make sure we don't run into an NPE here", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545776626", "createdAt": "2020-12-18T11:38:27Z", "author": {"login": "metas-ts"}, "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/quickinput/ddorderline/DDOrderLineQuickInputCallout.java", "diffHunk": "@@ -72,7 +73,7 @@ public void onProductChange(@NonNull final ICalloutField calloutField)\n \t\t}\n \t\tfinal I_DD_Order ddOrder = quickInput.getRootDocumentAs(I_DD_Order.class);\n \n-\t\tddOrderLineQuickInput.setM_HU_PI_Item_Product(getDefaultPI(ddOrder, productId));\n+\t\tddOrderLineQuickInput.setM_HU_PI_Item_Product_ID(getDefaultPI(ddOrder, productId).getM_HU_PI_Item_Product_ID());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "935224947e7e63007f10ec7d6120ff58140a15d8"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0ac6dafaa51c38a2da165007a882d1b32451ade", "author": {"user": {"login": "adi-stefan", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/f0ac6dafaa51c38a2da165007a882d1b32451ade", "committedDate": "2020-12-18T11:43:58Z", "message": "#gh10393 CR fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NDU0OTEy", "url": "https://github.com/metasfresh/metasfresh/pull/10418#pullrequestreview-555454912", "createdAt": "2020-12-18T12:44:04Z", "commit": {"oid": "f0ac6dafaa51c38a2da165007a882d1b32451ade"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2969, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}