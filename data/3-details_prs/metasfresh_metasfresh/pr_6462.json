{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMjcyMzkx", "number": 6462, "title": "Make sure `C_InvoiceLine.Price_UOM_ID` and `C_UOM_ID` are always set", "bodyText": "#6458", "createdAt": "2020-04-09T08:03:47Z", "url": "https://github.com/metasfresh/metasfresh/pull/6462", "merged": true, "mergeCommit": {"oid": "30727890fdd8205323d36a78c7418858fc5c4ec2"}, "closed": true, "closedAt": "2020-04-09T13:14:45Z", "author": {"login": "TheBestPessimist"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVnKggAH2gAyNDAxMjcyMzkxOmY5NDMxNjY0ZDY5MmMzNGIzOTU4ZTFhZjE1YmE5ZTRhOGFiZDQ1YzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcV7hA2gFqTM5MDc0MDM1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f9431664d692c34b3958e1af15ba9e4a8abd45c0", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/f9431664d692c34b3958e1af15ba9e4a8abd45c0", "committedDate": "2020-04-08T12:36:16Z", "message": "Ad migration script for handling empty `C_InvoiceLine.C_UOM_ID` and `C_InvoiceLine.Price_UOM_ID`\n\nhttps://github.com/metasfresh/metasfresh/issues/6458"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c7dd1cbb6988856289f631bafe16a827d830961", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/9c7dd1cbb6988856289f631bafe16a827d830961", "committedDate": "2020-04-09T08:01:03Z", "message": "Add model validator After Complete for handling empty `C_InvoiceLine.C_UOM_ID` and `C_InvoiceLine.Price_UOM_ID`\n\nhttps://github.com/metasfresh/metasfresh/issues/6458"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzA2OTE4", "url": "https://github.com/metasfresh/metasfresh/pull/6462#pullrequestreview-390706918", "createdAt": "2020-04-09T11:24:22Z", "commit": {"oid": "9c7dd1cbb6988856289f631bafe16a827d830961"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMToyNDoyMlrOGDUnig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMToyNzoyNVrOGDUtYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEzNjcxNA==", "bodyText": "pls add UpdatedBy and Updated with a \"hardcoded\" timestamp, e.g. 2020-04-09 13:23:07.035603+02\non some DBs there might be \"a lot\" of C_InvoiceLines affected by this SQL", "url": "https://github.com/metasfresh/metasfresh/pull/6462#discussion_r406136714", "createdAt": "2020-04-09T11:24:22Z", "author": {"login": "metas-ts"}, "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5556570_sys_gh6458_Fix_C_InvoiceLines_With_Invalid_C_Uom_ID_or_Price_Uom_ID.sql", "diffHunk": "@@ -0,0 +1,9 @@\n+UPDATE c_invoiceline il", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c7dd1cbb6988856289f631bafe16a827d830961"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEzODIxMQ==", "bodyText": "ok - getStockUOMId never returns null", "url": "https://github.com/metasfresh/metasfresh/pull/6462#discussion_r406138211", "createdAt": "2020-04-09T11:27:25Z", "author": {"login": "metas-ts"}, "path": "de.metas.swat/de.metas.swat.base/src/main/java/org/adempiere/invoice/service/impl/AbstractInvoiceBL.java", "diffHunk": "@@ -674,6 +678,29 @@ public void updateDescriptionFromDocTypeTargetId(final org.compiere.model.I_C_In\n \t\t}\n \t}\n \n+\t@Override\n+\tpublic void ensureUOMsAreNotNull(final @NonNull InvoiceId invoiceId)\n+\t{\n+\t\tfinal IInvoiceDAO invoiceDAO = Services.get(IInvoiceDAO.class);\n+\t\tfinal IProductBL productBL = Services.get(IProductBL.class);\n+\n+\t\tfinal List<I_C_InvoiceLine> lines = invoiceDAO.retrieveLines(invoiceId); // // TODO tbp: create this method!\n+\t\tfor (final I_C_InvoiceLine line : lines)\n+\t\t{\n+\t\t\tif (line.getC_UOM_ID() < 1)\n+\t\t\t{\n+\t\t\t\tfinal ProductId productId = ProductId.ofRepoId(line.getM_Product_ID());\n+\t\t\t\tfinal UomId stockUOMId = productBL.getStockUOMId(productId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c7dd1cbb6988856289f631bafe16a827d830961"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd1be6035c7e5f5378fd6f072da2d8cbfa941f8b", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/fd1be6035c7e5f5378fd6f072da2d8cbfa941f8b", "committedDate": "2020-04-09T12:15:16Z", "message": "Update migration script to set `Updated` and `UpdatedBy`\n\nhttps://github.com/metasfresh/metasfresh/issues/6458"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15377882f305fff97422f719bfdf2de618c2558f", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/15377882f305fff97422f719bfdf2de618c2558f", "committedDate": "2020-04-09T12:17:11Z", "message": "Make it explicit that function returns NonNull\n\nhttps://github.com/metasfresh/metasfresh/issues/6458"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzQwMzU2", "url": "https://github.com/metasfresh/metasfresh/pull/6462#pullrequestreview-390740356", "createdAt": "2020-04-09T12:18:57Z", "commit": {"oid": "15377882f305fff97422f719bfdf2de618c2558f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3461, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}