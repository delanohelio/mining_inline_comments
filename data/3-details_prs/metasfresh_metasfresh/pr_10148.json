{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4Mzg5OTA2", "number": 10148, "title": "Gh10127 export all shipment schedules for order", "bodyText": "#10127", "createdAt": "2020-10-22T15:46:45Z", "url": "https://github.com/metasfresh/metasfresh/pull/10148", "merged": true, "mergeCommit": {"oid": "efd9c5b6d31b78436346751b0b757b9ddc108810"}, "closed": true, "closedAt": "2020-10-23T07:52:19Z", "author": {"login": "metas-rc"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTHmnxgH2gAyNTA4Mzg5OTA2OmQ2OTgxNWFjMjViMzc2MGY2ZDQxY2FkZjEyZWUzNzE1M2NmZjhiZTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVG4lkgFqTUxNTAzOTA3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d69815ac25b3760f6d41cadf12ee37153cff8be4", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/d69815ac25b3760f6d41cadf12ee37153cff8be4", "committedDate": "2020-10-16T14:53:19Z", "message": "#10127 shipment schedule export - whole orders (WIP)\n\nhttps://github.com/metasfresh/metasfresh/issues/10127"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bdcd86e1eac030f5be02cbf786d5b39f828db93", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/2bdcd86e1eac030f5be02cbf786d5b39f828db93", "committedDate": "2020-10-19T11:55:17Z", "message": "#10127 refactoring\n\nhttps://github.com/metasfresh/metasfresh/issues/10127"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6443ca25cae85e4138ea6891230357fde65c8361", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/6443ca25cae85e4138ea6891230357fde65c8361", "committedDate": "2020-10-20T10:53:38Z", "message": "#10127 no future export for order's shipment schedules\n\nhttps://github.com/metasfresh/metasfresh/issues/10127"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16ec1652d0dd73a866f6d3bcf335e5d1a84d6d80", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/16ec1652d0dd73a866f6d3bcf335e5d1a84d6d80", "committedDate": "2020-10-22T15:06:35Z", "message": "#10127 shipment schedule export tests\n\nhttps://github.com/metasfresh/metasfresh/issues/10127"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6064cc806ca40fc564d9a5539d4d87d50bb35fb", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/a6064cc806ca40fc564d9a5539d4d87d50bb35fb", "committedDate": "2020-10-22T15:51:11Z", "message": "#10127 small cleanup\n\nhttps://github.com/metasfresh/metasfresh/issues/10127"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0ODgxNjY1", "url": "https://github.com/metasfresh/metasfresh/pull/10148#pullrequestreview-514881665", "createdAt": "2020-10-22T15:55:34Z", "commit": {"oid": "a6064cc806ca40fc564d9a5539d4d87d50bb35fb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNTo1NTozNFrOHmovTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNjowMTo0MlrOHmpBOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3NTQwNw==", "bodyText": "if i get it right, you can break if the limit is reached, and don't have to iterate the remaining schedules", "url": "https://github.com/metasfresh/metasfresh/pull/10148#discussion_r510275407", "createdAt": "2020-10-22T15:55:34Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.business.rest-api-impl/src/main/java/de/metas/rest_api/shipping/ShipmentCandidateAPIService.java", "diffHunk": "@@ -636,13 +640,51 @@ private IdsRegistry buildIdsRegistry(@NonNull final List<ShipmentSchedule> sched\n \tprivate List<ShipmentSchedule> loadShipmentSchedulesToExport(@NonNull final QueryLimit limit)\n \t{\n \t\tfinal ShipmentScheduleQuery shipmentScheduleQuery = ShipmentScheduleQuery.builder()\n-\t\t\t\t.limit(limit)\n \t\t\t\t.canBeExportedFrom(SystemTime.asInstant())\n+\t\t\t\t.noFutureExportOfOrder(true)\n \t\t\t\t.exportStatus(APIExportStatus.Pending)\n \t\t\t\t.includeWithQtyToDeliverZero(true)\n+\t\t\t\t.fromCompleteOrderOrNullOrder(true)\n+\t\t\t\t.orderByOrderId(true)\n \t\t\t\t.build();\n \n-\t\treturn shipmentScheduleRepository.getBy(shipmentScheduleQuery);\n+\t\tfinal List<ShipmentSchedule> shipmentSchedulesOrderedByOrderId = shipmentScheduleRepository.getBy(shipmentScheduleQuery);\n+\t\tList<ShipmentSchedule> schedulesToBeExported = new ArrayList<>();\n+\n+\t\tint counter = 0;\n+\t\tfor (ShipmentSchedule schedule : shipmentSchedulesOrderedByOrderId)\n+\t\t{\n+\t\t\tif (schedule.getOrderAndLineId() == null && counter < limit.toInt() - 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6064cc806ca40fc564d9a5539d4d87d50bb35fb"}, "originalPosition": 142}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3OTk5NA==", "bodyText": "i could understand noFutureExportOfOrder only after looking at the code in ShipmentScheduleRepository..\npls add a javadoc-comment to it, oooor think of a better name...like..maybe sth like onlyIfAllFromOrderExportable?", "url": "https://github.com/metasfresh/metasfresh/pull/10148#discussion_r510279994", "createdAt": "2020-10-22T16:01:42Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/inoutcandidate/ShipmentScheduleRepository.java", "diffHunk": "@@ -227,5 +273,14 @@ private void save(@NonNull final ShipmentSchedule shipmentSchedule)\n \n \t\t@Builder.Default\n \t\tboolean includeProcessed = false;\n+\n+\t\t@Builder.Default\n+\t\tboolean fromCompleteOrderOrNullOrder = false;\n+\n+\t\t@Builder.Default\n+\t\tboolean orderByOrderId = false;\n+\t\t@Builder.Default\n+\t\tboolean noFutureExportOfOrder = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6064cc806ca40fc564d9a5539d4d87d50bb35fb"}, "originalPosition": 154}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b48e9c20082186bbadbf4772599979f61540bcba", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/b48e9c20082186bbadbf4772599979f61540bcba", "committedDate": "2020-10-22T16:12:55Z", "message": "#10127 improvements and javadoc\n\nhttps://github.com/metasfresh/metasfresh/issues/10127"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MDM5MDc3", "url": "https://github.com/metasfresh/metasfresh/pull/10148#pullrequestreview-515039077", "createdAt": "2020-10-22T19:10:54Z", "commit": {"oid": "b48e9c20082186bbadbf4772599979f61540bcba"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3114, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}