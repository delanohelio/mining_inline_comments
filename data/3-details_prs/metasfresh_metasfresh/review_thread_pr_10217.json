{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5MzM3OTM1", "number": 10217, "reviewThreads": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToxNzoxNVrOE6_lLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNzoxNDo0MFrOE7aZqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjk0NTc0OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java-gen/org/compiere/model/X_C_DocType.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToxNzoxNVrOH2YSfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToxNzoxNVrOH2YSfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc4MzEwMg==", "bodyText": "avoid manually changing the generated classes", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526783102", "createdAt": "2020-11-19T11:17:15Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java-gen/org/compiere/model/X_C_DocType.java", "diffHunk": "@@ -1,11 +1,15 @@\n-/** Generated Model - DO NOT CHANGE */\n+/**\n+ * Generated Model - DO NOT CHANGE", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjk1NDQ0OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5572160_sys_gh10197AddTestApplianceDocType.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToxODo1NVrOH2YYJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToxODo1NVrOH2YYJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc4NDU1MA==", "bodyText": "move file to customization repo", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526784550", "createdAt": "2020-11-19T11:18:55Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5572160_sys_gh10197AddTestApplianceDocType.sql", "diffHunk": "@@ -0,0 +1,20 @@\n+-- 2020-11-05T11:56:20.268Z\n+-- URL zum Konzept\n+INSERT INTO C_DocType (AD_Client_ID,AD_Org_ID,AD_PrintFormat_ID,C_DocType_ID,C_DocTypeInvoice_ID,C_DocTypeShipment_ID,Created,CreatedBy,DocBaseType,DocNoSequence_ID,DocSubType,DocumentCopies,EntityType,GL_Category_ID,HasCharges,HasProforma,IsActive,IsCopyDescriptionToDocument,IsCreateCounter,IsDefault,IsDefaultCounterDoc,IsDocNoControlled,IsIndexed,IsInTransit,IsOverwriteDateOnComplete,IsOverwriteSeqOnComplete,IsPickQAConfirm,IsShipConfirm,IsSOTrx,IsSplitWhenDifference,Name,PrintName,Updated,UpdatedBy) VALUES (1000000,0,1000010,541004,1000002,1000011,TO_TIMESTAMP('2020-11-05 13:56:18','YYYY-MM-DD HH24:MI:SS'),100,'SOO',545479,'SO',0,'de.metas.swat',1000001,'N','N','Y','Y','N','N','N','Y','Y','N','N','N','N','N','Y','N','Testger\u00e4t Auftrag','Testger\u00e4t Auftrag',TO_TIMESTAMP('2020-11-05 13:56:18','YYYY-MM-DD HH24:MI:SS'),100)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjk1ODExOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5572170_sys_gh10197AddTestApplianceRequestType.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToxOToyM1rOH2YahA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToxOToyM1rOH2YahA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc4NTE1Ng==", "bodyText": "move file to customization repo", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526785156", "createdAt": "2020-11-19T11:19:23Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5572170_sys_gh10197AddTestApplianceRequestType.sql", "diffHunk": "@@ -0,0 +1,35 @@\n+-- 2020-11-10T15:51:15.916Z\n+-- URL zum Konzept\n+UPDATE R_StatusCategory SET Name='Teststellung',Updated=TO_TIMESTAMP('2020-11-10 17:51:15','YYYY-MM-DD HH24:MI:SS'),UpdatedBy=100 WHERE R_StatusCategory_ID=1000001", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjk3MDc0OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5572180_sys_gh10197AddTestApplianceAttribute.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToyMTowMVrOH2Yisw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToyMTowMVrOH2Yisw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc4NzI1MQ==", "bodyText": "move to customization repo", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526787251", "createdAt": "2020-11-19T11:21:01Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5572180_sys_gh10197AddTestApplianceAttribute.sql", "diffHunk": "@@ -0,0 +1,50 @@\n+-- 2020-11-12T15:10:13.300Z\n+-- URL zum Konzept\n+INSERT INTO M_Attribute (AD_Client_ID,AD_Org_ID,AttributeValueType,Created,CreatedBy,IsActive,IsAttrDocumentRelevant,IsHighVolume,IsInstanceAttribute,IsMandatory,IsPricingRelevant,IsReadOnlyValues,IsStorageRelevant,IsTransferWhenNull,M_Attribute_ID,Name,Updated,UpdatedBy,Value,ValueMax,ValueMin) VALUES (1000000,1000000,'L',TO_TIMESTAMP('2020-11-12 17:10:11','YYYY-MM-DD HH24:MI:SS'),100,'Y','N','N','Y','N','N','N','Y','N',540083,'Testger\u00e4t Auftrag',TO_TIMESTAMP('2020-11-12 17:10:11','YYYY-MM-DD HH24:MI:SS'),100,'HU_TestAppliance',0,0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjk4MDU2OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5572200_sys_gh10197AddReturnDateColumnToOrderTable.sql", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToyMjoyMVrOH2YpXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTo1NTozMlrOH2Z78w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc4ODk1Nw==", "bodyText": "pls use ReturnDate instead (remark upper case capital)", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526788957", "createdAt": "2020-11-19T11:22:21Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5572200_sys_gh10197AddReturnDateColumnToOrderTable.sql", "diffHunk": "@@ -0,0 +1,44 @@\n+-- 2020-11-12T14:04:50.397Z\n+-- URL zum Konzept\n+INSERT INTO AD_Element (AD_Client_ID,AD_Element_ID,AD_Org_ID,ColumnName,Created,CreatedBy,EntityType,IsActive,Name,PrintName,Updated,UpdatedBy) VALUES (0,578546,0,'returnDate',TO_TIMESTAMP('2020-11-12 16:04:49','YYYY-MM-DD HH24:MI:SS'),100,'D','Y','Datum Teststellung','Datum Teststellung',TO_TIMESTAMP('2020-11-12 16:04:49','YYYY-MM-DD HH24:MI:SS'),100)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgxMDA5OQ==", "bodyText": "also, move this file to the customizations repo.", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526810099", "createdAt": "2020-11-19T11:55:32Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/system/10-de.metas.adempiere/5572200_sys_gh10197AddReturnDateColumnToOrderTable.sql", "diffHunk": "@@ -0,0 +1,44 @@\n+-- 2020-11-12T14:04:50.397Z\n+-- URL zum Konzept\n+INSERT INTO AD_Element (AD_Client_ID,AD_Element_ID,AD_Org_ID,ColumnName,Created,CreatedBy,EntityType,IsActive,Name,PrintName,Updated,UpdatedBy) VALUES (0,578546,0,'returnDate',TO_TIMESTAMP('2020-11-12 16:04:49','YYYY-MM-DD HH24:MI:SS'),100,'D','Y','Datum Teststellung','Datum Teststellung',TO_TIMESTAMP('2020-11-12 16:04:49','YYYY-MM-DD HH24:MI:SS'),100)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc4ODk1Nw=="}, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzAwMjAxOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.business/src/main/java/de/metas/request/api/IRequestTypeDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToyNToyNFrOH2Y3cQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToyNToyNFrOH2Y3cQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5MjU2MQ==", "bodyText": "remove it and introduce and use C_DocType.R_RequestType_ID", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526792561", "createdAt": "2020-11-19T11:25:24Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.business/src/main/java/de/metas/request/api/IRequestTypeDAO.java", "diffHunk": "@@ -31,5 +31,7 @@\n \n \tRequestTypeId retrieveCustomerRequestTypeId();\n \n+\tRequestTypeId retrieveTestApplianceRequestTypeId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzAwNTA2OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.business/src/main/java/de/metas/request/api/RequestCandidate.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToyNjoxNVrOH2Y5eQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToyNjoxNVrOH2Y5eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5MzA4MQ==", "bodyText": "IMHO not needed. You can extract it from recordRef when applies. see below.", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526793081", "createdAt": "2020-11-19T11:26:15Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.business/src/main/java/de/metas/request/api/RequestCandidate.java", "diffHunk": "@@ -53,6 +52,8 @@\n \n \tTableRecordReference recordRef;\n \n+\tOrderId orderId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzAwODM0OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.business/src/main/java/de/metas/request/api/impl/RequestDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToyNzowOVrOH2Y7fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToyNzowOVrOH2Y7fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5MzU5Ng==", "bodyText": "check if canddiate.getRecordRef().getTableName() equals C_Order => if yes, setC_Order_ID(recordRef's record_ID)", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526793596", "createdAt": "2020-11-19T11:27:09Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.business/src/main/java/de/metas/request/api/impl/RequestDAO.java", "diffHunk": "@@ -47,14 +46,15 @@\n \tpublic I_R_Request createRequest(@NonNull final RequestCandidate candidate)\n \t{\n \t\tfinal I_R_Request request = newInstance(I_R_Request.class);\n-\n+;\n \t\trequest.setSummary(candidate.getSummary());\n \t\trequest.setConfidentialType(candidate.getConfidentialType());\n \t\trequest.setAD_Org_ID(candidate.getOrgId().getRepoId());\n \t\trequest.setM_Product_ID(ProductId.toRepoId(candidate.getProductId()));\n \t\trequest.setAD_Table_ID(candidate.getRecordRef() != null ? candidate.getRecordRef().getAD_Table_ID() : -1);\n \t\trequest.setRecord_ID(candidate.getRecordRef() != null ? candidate.getRecordRef().getRecord_ID() : -1);\n \t\trequest.setC_BPartner_ID(BPartnerId.toRepoId(candidate.getPartnerId()));\n+\t\trequest.setC_Order_ID(candidate.getOrderId() != null ? candidate.getOrderId().getRepoId() : 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzAxMDU2OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.business/src/main/java/de/metas/request/api/impl/RequestTypeDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToyNzo0MlrOH2Y83g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToyNzo0MlrOH2Y83g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5Mzk1MA==", "bodyText": "remove it, not needed. use C_DocType.R_RequestType_ID.", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526793950", "createdAt": "2020-11-19T11:27:42Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.business/src/main/java/de/metas/request/api/impl/RequestTypeDAO.java", "diffHunk": "@@ -41,6 +41,8 @@\n \tstatic final String InternalName_CustomerComplaint = \"A_CustomerComplaint\";\n \t@VisibleForTesting\n \tstatic final String InternalName_VendorComplaint = \"B_VendorComplaint\";\n+\t@VisibleForTesting\n+\tstatic final String InternalName_TestAppliance = \"T_TestAppliance\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzAxMzg2OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.business/src/main/java/de/metas/request/api/impl/RequestTypeDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToyODozOVrOH2Y-_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMToyODozOVrOH2Y-_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5NDQ5Mw==", "bodyText": "remove it", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526794493", "createdAt": "2020-11-19T11:28:39Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.business/src/main/java/de/metas/request/api/impl/RequestTypeDAO.java", "diffHunk": "@@ -56,6 +58,12 @@ public RequestTypeId retrieveCustomerRequestTypeId()\n \t\treturn retrieveRequestTypeIdByInternalName(InternalName_CustomerComplaint);\n \t}\n \n+\t@Override\n+\tpublic RequestTypeId retrieveTestApplianceRequestTypeId()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzAyNjk3OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/order/model/validator/C_Order.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTozMjowN1rOH2ZGwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTozMjowN1rOH2ZGwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5NjQ4Mg==", "bodyText": "remote this method. no need to register user notifications topics.", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526796482", "createdAt": "2020-11-19T11:32:07Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/order/model/validator/C_Order.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package de.metas.order.model.validator;\n+\n+import de.metas.event.IEventBusFactory;\n+import de.metas.inout.event.InOutUserNotificationsProducer;\n+import de.metas.inout.event.ReturnInOutUserNotificationsProducer;\n+import de.metas.request.service.async.spi.impl.R_Request_CreateFromOrder_Async;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.modelvalidator.annotations.DocValidate;\n+import org.adempiere.ad.modelvalidator.annotations.Init;\n+import org.adempiere.ad.modelvalidator.annotations.Interceptor;\n+import org.compiere.model.I_C_Order;\n+import org.compiere.model.ModelValidator;\n+import org.compiere.model.X_C_DocType;\n+\n+@Interceptor(I_C_Order.class)\n+public class C_Order\n+{\n+\t@Init\n+\tpublic void onInit()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzAyOTIwOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/order/model/validator/C_Order.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTozMjo0NFrOH2ZIIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTozMjo0NFrOH2ZIIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5NjgzNA==", "bodyText": "use/check C_DocType.R_RequestType_ID to decide if we are going to generate a request.", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526796834", "createdAt": "2020-11-19T11:32:44Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/order/model/validator/C_Order.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package de.metas.order.model.validator;\n+\n+import de.metas.event.IEventBusFactory;\n+import de.metas.inout.event.InOutUserNotificationsProducer;\n+import de.metas.inout.event.ReturnInOutUserNotificationsProducer;\n+import de.metas.request.service.async.spi.impl.R_Request_CreateFromOrder_Async;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.modelvalidator.annotations.DocValidate;\n+import org.adempiere.ad.modelvalidator.annotations.Init;\n+import org.adempiere.ad.modelvalidator.annotations.Interceptor;\n+import org.compiere.model.I_C_Order;\n+import org.compiere.model.ModelValidator;\n+import org.compiere.model.X_C_DocType;\n+\n+@Interceptor(I_C_Order.class)\n+public class C_Order\n+{\n+\t@Init\n+\tpublic void onInit()\n+\t{\n+\t\t// Setup event bus topics on which swing client notification listener shall subscribe\n+\t\tServices.get(IEventBusFactory.class).addAvailableUserNotificationsTopic(InOutUserNotificationsProducer.EVENTBUS_TOPIC);\n+\t\tServices.get(IEventBusFactory.class).addAvailableUserNotificationsTopic(ReturnInOutUserNotificationsProducer.EVENTBUS_TOPIC);\n+\t}\n+\n+\t@DocValidate(timings = ModelValidator.TIMING_AFTER_COMPLETE)\n+\tpublic void createRequest(@NonNull final de.metas.adempiere.model.I_C_Order order)\n+\t{\n+\t\tif (order.getC_DocTypeTarget_ID() == X_C_DocType.DOCTYPE_TEST_APPLIANCE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzAzOTEzOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/api/IRequestBL.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTozNToxOVrOH2ZOMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTozNToxOVrOH2ZOMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5ODM4Nw==", "bodyText": "rename it to createRequestFromOrder", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526798387", "createdAt": "2020-11-19T11:35:19Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/api/IRequestBL.java", "diffHunk": "@@ -41,13 +41,15 @@\n \t * <li>qualityNotice\n \t * <li>org\n \t * <li>linked salesrep of the org, etc.\n-\t * \n+\t * <p>\n \t * Note that the quantities are not relevant in the requests. Therefore, the qualityDiscountPercent is not even set in the request.\n \t * We can have requests with no quality notices, in case the base inout line was created with qualityDiscountPercent but with no quality notice.\n-\t * \n+\t *\n \t * @param line\n \t */\n \tI_R_Request createRequestFromInOutLine(I_M_InOutLine line);\n \n \tI_R_Request createRequestFromDDOrderLine(I_DD_OrderLine line);\n+\n+\tI_R_Request createTestApplianceRequestFromOrder(I_C_Order order);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzA0MzAzOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/api/impl/RequestBL.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTozNjoxMVrOH2ZQfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTozNjoxMVrOH2ZQfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5ODk3NA==", "bodyText": "get the request type from C_DocType.R_RequestType_ID.", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526798974", "createdAt": "2020-11-19T11:36:11Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/api/impl/RequestBL.java", "diffHunk": "@@ -166,6 +167,25 @@ public I_R_Request createRequestFromDDOrderLine(@NonNull final I_DD_OrderLine dd\n \t\treturn createRequest(requestCandidate);\n \t}\n \n+\t@Override\n+\tpublic I_R_Request createTestApplianceRequestFromOrder(@NonNull final I_C_Order order)\n+\t{\n+\t\tfinal RequestTypeId requestTypeId = requestTypeDAO.retrieveTestApplianceRequestTypeId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzA0NTc4OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/service/async/spi/impl/R_Request_CreateFromOrder_Async.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTozNjo1M1rOH2ZSLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTozNjo1M1rOH2ZSLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5OTQwNg==", "bodyText": "use I_C_Order as param (you already have it in caller method.\nAnnotate with @NonNull.", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526799406", "createdAt": "2020-11-19T11:36:53Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/service/async/spi/impl/R_Request_CreateFromOrder_Async.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * #%L\n+ * de.metas.swat.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.request.service.async.spi.impl;\n+\n+import de.metas.async.api.IQueueDAO;\n+import de.metas.async.model.I_C_Queue_WorkPackage;\n+import de.metas.async.spi.WorkpackageProcessorAdapter;\n+import de.metas.async.spi.WorkpackagesOnCommitSchedulerTemplate;\n+import de.metas.order.IOrderDAO;\n+import de.metas.request.api.IRequestBL;\n+import de.metas.util.Services;\n+import org.adempiere.ad.trx.api.ITrx;\n+import org.adempiere.util.lang.impl.TableRecordReference;\n+import org.compiere.model.I_C_Order;\n+import org.compiere.util.Env;\n+\n+import java.util.Properties;\n+\n+import static org.adempiere.model.InterfaceWrapperHelper.load;\n+\n+public class R_Request_CreateFromOrder_Async extends WorkpackageProcessorAdapter\n+{\n+\tprivate final IOrderDAO orderDAO = Services.get(IOrderDAO.class);\n+\n+\t/**\n+\t * Schedule the request creation based on the given order id\n+\t * <p>\n+\t * The request will contain information taken from the order\n+\t */\n+\tpublic static void createWorkpackage(final int orderId)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzA0OTk4OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/service/async/spi/impl/R_Request_CreateFromOrder_Async.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTozODowMFrOH2ZUsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTozODowMFrOH2ZUsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwMDA0OQ==", "bodyText": "not needed", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526800049", "createdAt": "2020-11-19T11:38:00Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/service/async/spi/impl/R_Request_CreateFromOrder_Async.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * #%L\n+ * de.metas.swat.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.request.service.async.spi.impl;\n+\n+import de.metas.async.api.IQueueDAO;\n+import de.metas.async.model.I_C_Queue_WorkPackage;\n+import de.metas.async.spi.WorkpackageProcessorAdapter;\n+import de.metas.async.spi.WorkpackagesOnCommitSchedulerTemplate;\n+import de.metas.order.IOrderDAO;\n+import de.metas.request.api.IRequestBL;\n+import de.metas.util.Services;\n+import org.adempiere.ad.trx.api.ITrx;\n+import org.adempiere.util.lang.impl.TableRecordReference;\n+import org.compiere.model.I_C_Order;\n+import org.compiere.util.Env;\n+\n+import java.util.Properties;\n+\n+import static org.adempiere.model.InterfaceWrapperHelper.load;\n+\n+public class R_Request_CreateFromOrder_Async extends WorkpackageProcessorAdapter\n+{\n+\tprivate final IOrderDAO orderDAO = Services.get(IOrderDAO.class);\n+\n+\t/**\n+\t * Schedule the request creation based on the given order id\n+\t * <p>\n+\t * The request will contain information taken from the order\n+\t */\n+\tpublic static void createWorkpackage(final int orderId)\n+\t{\n+\t\tif (orderId == 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzA1NDI1OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/service/async/spi/impl/R_Request_CreateFromOrder_Async.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTozOToxOVrOH2ZXYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTozOToxOVrOH2ZXYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwMDczOA==", "bodyText": "not needed", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526800738", "createdAt": "2020-11-19T11:39:19Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/service/async/spi/impl/R_Request_CreateFromOrder_Async.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * #%L\n+ * de.metas.swat.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.request.service.async.spi.impl;\n+\n+import de.metas.async.api.IQueueDAO;\n+import de.metas.async.model.I_C_Queue_WorkPackage;\n+import de.metas.async.spi.WorkpackageProcessorAdapter;\n+import de.metas.async.spi.WorkpackagesOnCommitSchedulerTemplate;\n+import de.metas.order.IOrderDAO;\n+import de.metas.request.api.IRequestBL;\n+import de.metas.util.Services;\n+import org.adempiere.ad.trx.api.ITrx;\n+import org.adempiere.util.lang.impl.TableRecordReference;\n+import org.compiere.model.I_C_Order;\n+import org.compiere.util.Env;\n+\n+import java.util.Properties;\n+\n+import static org.adempiere.model.InterfaceWrapperHelper.load;\n+\n+public class R_Request_CreateFromOrder_Async extends WorkpackageProcessorAdapter\n+{\n+\tprivate final IOrderDAO orderDAO = Services.get(IOrderDAO.class);\n+\n+\t/**\n+\t * Schedule the request creation based on the given order id\n+\t * <p>\n+\t * The request will contain information taken from the order\n+\t */\n+\tpublic static void createWorkpackage(final int orderId)\n+\t{\n+\t\tif (orderId == 0)\n+\t\t{\n+\t\t\t// no order to process\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tfinal I_C_Order order = load(orderId, I_C_Order.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzA2NDQzOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/service/async/spi/impl/R_Request_CreateFromOrder_Async.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTo0MTo1NlrOH2ZdXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTo0MTo1NlrOH2ZdXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwMjI3MQ==", "bodyText": "extract those as fields", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526802271", "createdAt": "2020-11-19T11:41:56Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/service/async/spi/impl/R_Request_CreateFromOrder_Async.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * #%L\n+ * de.metas.swat.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.request.service.async.spi.impl;\n+\n+import de.metas.async.api.IQueueDAO;\n+import de.metas.async.model.I_C_Queue_WorkPackage;\n+import de.metas.async.spi.WorkpackageProcessorAdapter;\n+import de.metas.async.spi.WorkpackagesOnCommitSchedulerTemplate;\n+import de.metas.order.IOrderDAO;\n+import de.metas.request.api.IRequestBL;\n+import de.metas.util.Services;\n+import org.adempiere.ad.trx.api.ITrx;\n+import org.adempiere.util.lang.impl.TableRecordReference;\n+import org.compiere.model.I_C_Order;\n+import org.compiere.util.Env;\n+\n+import java.util.Properties;\n+\n+import static org.adempiere.model.InterfaceWrapperHelper.load;\n+\n+public class R_Request_CreateFromOrder_Async extends WorkpackageProcessorAdapter\n+{\n+\tprivate final IOrderDAO orderDAO = Services.get(IOrderDAO.class);\n+\n+\t/**\n+\t * Schedule the request creation based on the given order id\n+\t * <p>\n+\t * The request will contain information taken from the order\n+\t */\n+\tpublic static void createWorkpackage(final int orderId)\n+\t{\n+\t\tif (orderId == 0)\n+\t\t{\n+\t\t\t// no order to process\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tfinal I_C_Order order = load(orderId, I_C_Order.class);\n+\n+\t\tSCHEDULER.schedule(order);\n+\t}\n+\n+\tprivate static final WorkpackagesOnCommitSchedulerTemplate<I_C_Order> SCHEDULER = new WorkpackagesOnCommitSchedulerTemplate<I_C_Order>(R_Request_CreateFromOrder_Async.class)\n+\t{\n+\t\t@Override\n+\t\tprotected boolean isEligibleForScheduling(final I_C_Order model)\n+\t\t{\n+\t\t\treturn model != null && model.getC_Order_ID() > 0;\n+\t\t}\n+\n+\t\t@Override\n+\t\tprotected Properties extractCtxFromItem(final I_C_Order item)\n+\t\t{\n+\t\t\treturn Env.getCtx();\n+\t\t}\n+\n+\t\t@Override\n+\t\tprotected String extractTrxNameFromItem(final I_C_Order item)\n+\t\t{\n+\t\t\treturn ITrx.TRXNAME_ThreadInherited;\n+\t\t}\n+\n+\t\t@Override\n+\t\tprotected Object extractModelToEnqueueFromItem(final Collector collector, final I_C_Order item)\n+\t\t{\n+\t\t\treturn TableRecordReference.of(I_C_Order.Table_Name, item.getC_Order_ID());\n+\t\t}\n+\t};\n+\n+\t@Override\n+\tpublic Result processWorkPackage(final I_C_Queue_WorkPackage workPackage, final String localTrxName)\n+\t{\n+\t\t// Services\n+\t\tfinal IQueueDAO queueDAO = Services.get(IQueueDAO.class);\n+\t\tfinal IRequestBL requestBL = Services.get(IRequestBL.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzA2NzM2OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/service/async/spi/impl/R_Request_CreateFromOrder_Async.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTo0MjozNlrOH2Ze_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTo0MjozNlrOH2Ze_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwMjY4NA==", "bodyText": "use can get all orders and do a for to iterate them and create requests for each of them", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526802684", "createdAt": "2020-11-19T11:42:36Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/service/async/spi/impl/R_Request_CreateFromOrder_Async.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * #%L\n+ * de.metas.swat.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.request.service.async.spi.impl;\n+\n+import de.metas.async.api.IQueueDAO;\n+import de.metas.async.model.I_C_Queue_WorkPackage;\n+import de.metas.async.spi.WorkpackageProcessorAdapter;\n+import de.metas.async.spi.WorkpackagesOnCommitSchedulerTemplate;\n+import de.metas.order.IOrderDAO;\n+import de.metas.request.api.IRequestBL;\n+import de.metas.util.Services;\n+import org.adempiere.ad.trx.api.ITrx;\n+import org.adempiere.util.lang.impl.TableRecordReference;\n+import org.compiere.model.I_C_Order;\n+import org.compiere.util.Env;\n+\n+import java.util.Properties;\n+\n+import static org.adempiere.model.InterfaceWrapperHelper.load;\n+\n+public class R_Request_CreateFromOrder_Async extends WorkpackageProcessorAdapter\n+{\n+\tprivate final IOrderDAO orderDAO = Services.get(IOrderDAO.class);\n+\n+\t/**\n+\t * Schedule the request creation based on the given order id\n+\t * <p>\n+\t * The request will contain information taken from the order\n+\t */\n+\tpublic static void createWorkpackage(final int orderId)\n+\t{\n+\t\tif (orderId == 0)\n+\t\t{\n+\t\t\t// no order to process\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tfinal I_C_Order order = load(orderId, I_C_Order.class);\n+\n+\t\tSCHEDULER.schedule(order);\n+\t}\n+\n+\tprivate static final WorkpackagesOnCommitSchedulerTemplate<I_C_Order> SCHEDULER = new WorkpackagesOnCommitSchedulerTemplate<I_C_Order>(R_Request_CreateFromOrder_Async.class)\n+\t{\n+\t\t@Override\n+\t\tprotected boolean isEligibleForScheduling(final I_C_Order model)\n+\t\t{\n+\t\t\treturn model != null && model.getC_Order_ID() > 0;\n+\t\t}\n+\n+\t\t@Override\n+\t\tprotected Properties extractCtxFromItem(final I_C_Order item)\n+\t\t{\n+\t\t\treturn Env.getCtx();\n+\t\t}\n+\n+\t\t@Override\n+\t\tprotected String extractTrxNameFromItem(final I_C_Order item)\n+\t\t{\n+\t\t\treturn ITrx.TRXNAME_ThreadInherited;\n+\t\t}\n+\n+\t\t@Override\n+\t\tprotected Object extractModelToEnqueueFromItem(final Collector collector, final I_C_Order item)\n+\t\t{\n+\t\t\treturn TableRecordReference.of(I_C_Order.Table_Name, item.getC_Order_ID());\n+\t\t}\n+\t};\n+\n+\t@Override\n+\tpublic Result processWorkPackage(final I_C_Queue_WorkPackage workPackage, final String localTrxName)\n+\t{\n+\t\t// Services\n+\t\tfinal IQueueDAO queueDAO = Services.get(IQueueDAO.class);\n+\t\tfinal IRequestBL requestBL = Services.get(IRequestBL.class);\n+\n+\t\t// retrieve the order\n+\t\tfinal I_C_Order order = queueDAO.retrieveItems(workPackage, I_C_Order.class, localTrxName).get(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 98}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzA3MDc3OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/test/java/de/metas/request/api/impl/RequestBLTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTo0MzozM1rOH2ZhEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTo0MzozM1rOH2ZhEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwMzIxOA==", "bodyText": "fix/rename the test", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526803218", "createdAt": "2020-11-19T11:43:33Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/test/java/de/metas/request/api/impl/RequestBLTest.java", "diffHunk": "@@ -115,6 +118,28 @@ public void createRequestForDDOrderLine()\n \n \t}\n \n+\t@Test\n+\tpublic void createTestApplianceRequestFromOrder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzEwMjk1OnYy", "diffSide": "RIGHT", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/window/descriptor/sql/SqlForFetchingLookupById.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTo1MjoxN1rOH2Z0WQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTo1MjoxN1rOH2Z0WQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwODE1Mw==", "bodyText": "pls revert this file. as discussed.", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526808153", "createdAt": "2020-11-19T11:52:17Z", "author": {"login": "teosarca"}, "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/window/descriptor/sql/SqlForFetchingLookupById.java", "diffHunk": "@@ -64,6 +64,7 @@ public IStringExpression toStringExpression(@NonNull final String joinOnColumnNa\n \t{\n \t\treturn sql.resolvePartial(Evaluatees\n \t\t\t\t.mapBuilder()\n+\t\t\t\t.put(SQL_PARAM_FilterSql, joinOnColumnNameFQ)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzExMjY2OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/api/impl/RequestBL.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTo1NDo1MlrOH2Z6Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMTo1NDo1MlrOH2Z6Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwOTY1NQ==", "bodyText": "fallback to <space>. remove the TODO.", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526809655", "createdAt": "2020-11-19T11:54:52Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/api/impl/RequestBL.java", "diffHunk": "@@ -166,6 +167,25 @@ public I_R_Request createRequestFromDDOrderLine(@NonNull final I_DD_OrderLine dd\n \t\treturn createRequest(requestCandidate);\n \t}\n \n+\t@Override\n+\tpublic I_R_Request createTestApplianceRequestFromOrder(@NonNull final I_C_Order order)\n+\t{\n+\t\tfinal RequestTypeId requestTypeId = requestTypeDAO.retrieveTestApplianceRequestTypeId();\n+\n+\t\tfinal RequestCandidate requestCandidate = RequestCandidate.builder()\n+\t\t\t\t.summary(order.getDescription()) // TODO: Decide what to put here", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b07e6096e52ca0598af562d772bfde6a87deed08"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNDI1NTExOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/order/model/validator/C_Order.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNTo0ODoyOFrOH2lE-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNTo0ODoyOFrOH2lE-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk5MjYzNQ==", "bodyText": "use > 0 instead of != 0", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r526992635", "createdAt": "2020-11-19T15:48:28Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/order/model/validator/C_Order.java", "diffHunk": "@@ -0,0 +1,29 @@\n+package de.metas.order.model.validator;\n+\n+import de.metas.document.IDocTypeDAO;\n+import de.metas.request.service.async.spi.impl.R_Request_CreateFromOrder_Async;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.modelvalidator.annotations.DocValidate;\n+import org.adempiere.ad.modelvalidator.annotations.Interceptor;\n+import org.compiere.model.I_C_DocType;\n+import org.compiere.model.I_C_Order;\n+import org.compiere.model.ModelValidator;\n+\n+@Interceptor(I_C_Order.class)\n+public class C_Order\n+{\n+\tprivate final IDocTypeDAO docTypeDAO = Services.get(IDocTypeDAO.class);\n+\n+\t@DocValidate(timings = ModelValidator.TIMING_AFTER_COMPLETE)\n+\tpublic void createRequest(@NonNull final de.metas.adempiere.model.I_C_Order order)\n+\t{\n+\t\tfinal I_C_DocType docType = docTypeDAO.getById(order.getC_DocTypeTarget_ID());\n+\t\tif (docType.getR_RequestType_ID() != 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3333acb2990759ae83b9f9c1a427c8c579f941d0"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNDM0Mzk3OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/order/model/validator/C_Order.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjowNjowMlrOH2l8jA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjowNjowMlrOH2l8jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAwNjg2MA==", "bodyText": "use order.getC_DocType_ID() in case of completed orders.", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r527006860", "createdAt": "2020-11-19T16:06:02Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/order/model/validator/C_Order.java", "diffHunk": "@@ -0,0 +1,29 @@\n+package de.metas.order.model.validator;\n+\n+import de.metas.document.IDocTypeDAO;\n+import de.metas.request.service.async.spi.impl.R_Request_CreateFromOrder_Async;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.modelvalidator.annotations.DocValidate;\n+import org.adempiere.ad.modelvalidator.annotations.Interceptor;\n+import org.compiere.model.I_C_DocType;\n+import org.compiere.model.I_C_Order;\n+import org.compiere.model.ModelValidator;\n+\n+@Interceptor(I_C_Order.class)\n+public class C_Order\n+{\n+\tprivate final IDocTypeDAO docTypeDAO = Services.get(IDocTypeDAO.class);\n+\n+\t@DocValidate(timings = ModelValidator.TIMING_AFTER_COMPLETE)\n+\tpublic void createRequest(@NonNull final de.metas.adempiere.model.I_C_Order order)\n+\t{\n+\t\tfinal I_C_DocType docType = docTypeDAO.getById(order.getC_DocTypeTarget_ID());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3333acb2990759ae83b9f9c1a427c8c579f941d0"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNDM0ODk0OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/api/impl/RequestBL.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjowNzoxM1rOH2l_2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjowOTowN1rOH2mFZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAwNzcwNQ==", "bodyText": "use order.getC_DocType_ID()", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r527007705", "createdAt": "2020-11-19T16:07:13Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/api/impl/RequestBL.java", "diffHunk": "@@ -166,6 +168,25 @@ public I_R_Request createRequestFromDDOrderLine(@NonNull final I_DD_OrderLine dd\n \t\treturn createRequest(requestCandidate);\n \t}\n \n+\t@Override\n+\tpublic I_R_Request createRequestFromOrder(@NonNull final I_C_Order order)\n+\t{\n+\t\tfinal int requestTypeId = docTypeDAO.getById(order.getC_DocTypeTarget_ID()).getR_RequestType_ID();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3333acb2990759ae83b9f9c1a427c8c579f941d0"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAwOTEyNQ==", "bodyText": "and because we have 2 places with same issue... i suggest introducing a new method in OrderBL:\nOptional getRequestTypeForCreatingNewRequestsAfterComplete(I_C_Order order)", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r527009125", "createdAt": "2020-11-19T16:09:07Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/request/api/impl/RequestBL.java", "diffHunk": "@@ -166,6 +168,25 @@ public I_R_Request createRequestFromDDOrderLine(@NonNull final I_DD_OrderLine dd\n \t\treturn createRequest(requestCandidate);\n \t}\n \n+\t@Override\n+\tpublic I_R_Request createRequestFromOrder(@NonNull final I_C_Order order)\n+\t{\n+\t\tfinal int requestTypeId = docTypeDAO.getById(order.getC_DocTypeTarget_ID()).getR_RequestType_ID();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAwNzcwNQ=="}, "originalCommit": {"oid": "3333acb2990759ae83b9f9c1a427c8c579f941d0"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNDM3MDM2OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/test/java/de/metas/request/api/impl/RequestBLTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjoxMTo0NlrOH2mNUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNjoxMTo0NlrOH2mNUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAxMTE1Mg==", "bodyText": "... u will have to setC_DocType_ID here", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r527011152", "createdAt": "2020-11-19T16:11:46Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/test/java/de/metas/request/api/impl/RequestBLTest.java", "diffHunk": "@@ -131,6 +161,27 @@ private I_DD_Order createDDOrder()\n \t\treturn ddOrder;\n \t}\n \n+\tprivate I_C_Order createOrder()\n+\t{\n+\t\tfinal I_C_Order order = newInstance(I_C_Order.class);\n+\n+\t\torder.setIsSOTrx(true);\n+\t\torder.setC_BPartner_ID(createPartner(\"Partner 3\").getC_BPartner_ID());\n+\t\torder.setAD_User_ID(createUser(\"User 3\").getAD_User_ID());\n+\t\torder.setDatePromised(de.metas.common.util.time.SystemTime.asDayTimestamp());\n+\t\torder.setC_DocTypeTarget_ID(createDocType().getC_DocType_ID());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3333acb2990759ae83b9f9c1a427c8c579f941d0"}, "originalPosition": 108}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNzMzOTk1OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.business/src/main/java/de/metas/order/impl/OrderBL.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNzoxNDo0MFrOH3DCjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNzoxNTo0OFrOH3DELw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ4MzUzMw==", "bodyText": "pls use <= 0", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r527483533", "createdAt": "2020-11-20T07:14:40Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.business/src/main/java/de/metas/order/impl/OrderBL.java", "diffHunk": "@@ -1026,6 +1029,19 @@ public ProjectId getProjectIdOrNull(@NonNull final OrderLineId orderLineId)\n \t\treturn orderProjectId;\n \t}\n \n+\t@Override\n+\tpublic Optional<RequestTypeId> getRequestTypeForCreatingNewRequestsAfterComplete(@NonNull final I_C_Order order)\n+\t{\n+\t\tfinal I_C_DocType docType = docTypeDAO.getById(order.getC_DocType_ID());\n+\n+\t\tif (docType.getR_RequestType_ID() == 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0195cf014036f51ca2db6c6b794d977d15a65af"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ4Mzk1MQ==", "bodyText": "or even better, just return\nreturn Optional.ofNullable(RequestTypeId.ofRepoIdOrNull(docType.getR_RequestType_ID()));", "url": "https://github.com/metasfresh/metasfresh/pull/10217#discussion_r527483951", "createdAt": "2020-11-20T07:15:48Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.business/src/main/java/de/metas/order/impl/OrderBL.java", "diffHunk": "@@ -1026,6 +1029,19 @@ public ProjectId getProjectIdOrNull(@NonNull final OrderLineId orderLineId)\n \t\treturn orderProjectId;\n \t}\n \n+\t@Override\n+\tpublic Optional<RequestTypeId> getRequestTypeForCreatingNewRequestsAfterComplete(@NonNull final I_C_Order order)\n+\t{\n+\t\tfinal I_C_DocType docType = docTypeDAO.getById(order.getC_DocType_ID());\n+\n+\t\tif (docType.getR_RequestType_ID() == 0)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ4MzUzMw=="}, "originalCommit": {"oid": "d0195cf014036f51ca2db6c6b794d977d15a65af"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1142, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}