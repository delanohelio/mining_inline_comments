{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2ODQyOTc2", "number": 10418, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMjowNjowM1rOFGrMow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxMTozODoyN1rOFHJgvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNTQzNTIzOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.business/src/main/java/de/metas/order/impl/OrderLineBL.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMjowNjowNFrOIHyj7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwODowODoyNlrOIIW--Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTAzOTM0MQ==", "bodyText": "not really sure what the point of this method is..", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545039341", "createdAt": "2020-12-17T12:06:04Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.business/src/main/java/de/metas/order/impl/OrderLineBL.java", "diffHunk": "@@ -328,6 +328,12 @@ public void updateLineNetAmtFromQtyEntered(@NonNull final org.compiere.model.I_C\n \t\tupdateLineNetAmtFromQtyInPriceUOM(orderLine, qtyInPriceUOM);\n \t}\n \n+\t@Override\n+\tpublic void updateMHuPiItemProduct(final I_C_OrderLine orderLine, final int huPiItemProductId)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3879dd71e6029b22b1c1e71f5062f5ccaf130522"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTYzNjA4OQ==", "bodyText": "Me neither, removed.", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545636089", "createdAt": "2020-12-18T08:08:26Z", "author": {"login": "adi-stefan"}, "path": "backend/de.metas.business/src/main/java/de/metas/order/impl/OrderLineBL.java", "diffHunk": "@@ -328,6 +328,12 @@ public void updateLineNetAmtFromQtyEntered(@NonNull final org.compiere.model.I_C\n \t\tupdateLineNetAmtFromQtyInPriceUOM(orderLine, qtyInPriceUOM);\n \t}\n \n+\t@Override\n+\tpublic void updateMHuPiItemProduct(final I_C_OrderLine orderLine, final int huPiItemProductId)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTAzOTM0MQ=="}, "originalCommit": {"oid": "3879dd71e6029b22b1c1e71f5062f5ccaf130522"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNTQzOTEyOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/interfaces/I_C_OrderLine.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMjowNjo1NlrOIHyl_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwODowODozNFrOIIW_NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTAzOTg2OA==", "bodyText": "we already have this, in de.metas.handlingunits.model.I_C_Order", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545039868", "createdAt": "2020-12-17T12:06:56Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/interfaces/I_C_OrderLine.java", "diffHunk": "@@ -43,4 +43,8 @@\n \tvoid setHandOver_Location_ID(int handoverLocationId);\n \tint getHandOver_Location_ID();\n \t// @formatter:on\n+\n+\tString COLUMNNAME_M_HU_PI_Item_Product_ID = \"M_HU_PI_Item_Product_ID\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3879dd71e6029b22b1c1e71f5062f5ccaf130522"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTYzNjE0OQ==", "bodyText": "Removed.", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545636149", "createdAt": "2020-12-18T08:08:34Z", "author": {"login": "adi-stefan"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/interfaces/I_C_OrderLine.java", "diffHunk": "@@ -43,4 +43,8 @@\n \tvoid setHandOver_Location_ID(int handoverLocationId);\n \tint getHandOver_Location_ID();\n \t// @formatter:on\n+\n+\tString COLUMNNAME_M_HU_PI_Item_Product_ID = \"M_HU_PI_Item_Product_ID\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTAzOTg2OA=="}, "originalCommit": {"oid": "3879dd71e6029b22b1c1e71f5062f5ccaf130522"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNTQ2NjgyOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/callout/C_OrderLine.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMjoxMzo1M1rOIHy1Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwODoxMToxNlrOIIXD-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA0MzgxNA==", "bodyText": "1 i think it would be better to do this in a ModelInterceptor..i believe it make sense to do this also if e.g. the order line is created via scheduler from an C_OLCand\n2 if the new product has no M_HU_PI_Item_Product_ID, then i think C_OrderLine.M_HU_PI_Item_Product_ID should be set to -1\n3 please add a method Optional<HUPIItemProductId> retrieveDefaultIdForProduct to IHUPIItemProductDAO`\n\nrationale: try to avoid throwing around data records. we like to grow in the general direction of DDD.\nalso, we don't need (to load) the record for this", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545043814", "createdAt": "2020-12-17T12:13:53Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/callout/C_OrderLine.java", "diffHunk": "@@ -47,6 +55,17 @@ public void updateQtyCU(final I_C_OrderLine orderLine, final ICalloutField field\n \t\tServices.get(IOrderLineBL.class).updateLineNetAmtFromQtyEntered(orderLine);\n \t}\n \n+\t@CalloutMethod(columnNames = de.metas.interfaces.I_C_OrderLine.COLUMNNAME_M_Product_ID)\n+\tpublic void onProductSetOrChanged(final de.metas.interfaces.I_C_OrderLine orderLine)\n+\t{\n+\t\tfinal Optional<I_M_HU_PI_Item_Product> huPiItemProduct = hupiItemProductDAO.retrieveDefaultForProduct(ProductId.ofRepoId(orderLine.getM_Product_ID()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3879dd71e6029b22b1c1e71f5062f5ccaf130522"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTYzNzM3MA==", "bodyText": "Moved to ModelInterceptor\nHUPIItemProductId.toRepoId(null) will return -1, used that.\nAdded, though I've only used it for our particular case. There are other places which still call retrieveDefaultForProduct, but we'd need to test those changes....", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545637370", "createdAt": "2020-12-18T08:11:16Z", "author": {"login": "adi-stefan"}, "path": "backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/callout/C_OrderLine.java", "diffHunk": "@@ -47,6 +55,17 @@ public void updateQtyCU(final I_C_OrderLine orderLine, final ICalloutField field\n \t\tServices.get(IOrderLineBL.class).updateLineNetAmtFromQtyEntered(orderLine);\n \t}\n \n+\t@CalloutMethod(columnNames = de.metas.interfaces.I_C_OrderLine.COLUMNNAME_M_Product_ID)\n+\tpublic void onProductSetOrChanged(final de.metas.interfaces.I_C_OrderLine orderLine)\n+\t{\n+\t\tfinal Optional<I_M_HU_PI_Item_Product> huPiItemProduct = hupiItemProductDAO.retrieveDefaultForProduct(ProductId.ofRepoId(orderLine.getM_Product_ID()),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA0MzgxNA=="}, "originalCommit": {"oid": "3879dd71e6029b22b1c1e71f5062f5ccaf130522"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNTQ3OTAzOnYy", "diffSide": "RIGHT", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/quickinput/orderline/OrderLineQuickInputDescriptorFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMjoxNjo0NVrOIHy8NA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxMjoxNjo0NVrOIHy8NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA0NTU1Ng==", "bodyText": "i didn't understand in the concept, why this was supposed to be changed..so i guess it's fine that it effectively was not changed at all", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545045556", "createdAt": "2020-12-17T12:16:45Z", "author": {"login": "metas-ts"}, "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/quickinput/orderline/OrderLineQuickInputDescriptorFactory.java", "diffHunk": "@@ -175,7 +175,7 @@ private ProductLookupDescriptor createProductLookupDescriptor(@NonNull final Opt\n \t\t\t\t\t\t.setCtxTableName(null) // ctxTableName\n \t\t\t\t\t\t.setCtxColumnName(IOrderLineQuickInput.COLUMNNAME_M_HU_PI_Item_Product_ID)\n \t\t\t\t\t\t.setDisplayType(DisplayType.TableDir)\n-\t\t\t\t\t\t.setAD_Val_Rule_ID(540365) // FIXME: hardcoded \"M_HU_PI_Item_Product_For_Org_and_Product_and_DatePromised\"\n+\t\t\t\t\t\t.setAD_Val_Rule_ID(540365)// FIXME: hardcoded \"M_HU_PI_Item_Product_For_Org_and_Product_and_DatePromised\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3879dd71e6029b22b1c1e71f5062f5ccaf130522"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyOTk4NjcyOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/impl/HUPIItemProductDAO.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOTozODo1MlrOIIbutQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOTozODo1MlrOIIbutQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxMzg0NQ==", "bodyText": "This was missing from Dragos's changes, but was necessary (at least for the batch add)", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545713845", "createdAt": "2020-12-18T09:38:52Z", "author": {"login": "adi-stefan"}, "path": "backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/impl/HUPIItemProductDAO.java", "diffHunk": "@@ -487,6 +488,7 @@ public I_M_HU_PI_Item_Product retrieveMaterialItemProduct(\n \t\t\t\t// Get specific Product first\n \t\t\t\t.addColumn(I_M_HU_PI_Item_Product.COLUMNNAME_IsAllowAnyProduct, Direction.Descending, Nulls.Last) // Y first, N second\n \t\t\t\t.addColumn(I_M_HU_PI_Item_Product.COLUMNNAME_M_Product_ID, Direction.Descending, Nulls.Last)\n+\t\t\t\t.addColumn(I_M_HU_PI_Item_Product.COLUMNNAME_IsDefaultForProduct, Direction.Descending, Nulls.Last)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "935224947e7e63007f10ec7d6120ff58140a15d8"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzMDQwMTg4OnYy", "diffSide": "RIGHT", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/quickinput/ddorderline/DDOrderLineQuickInputCallout.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxMTozODoyN1rOIIfj8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxMTozODoyN1rOIIfj8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTc3NjYyNg==", "bodyText": "please make sure we don't run into an NPE here", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545776626", "createdAt": "2020-12-18T11:38:27Z", "author": {"login": "metas-ts"}, "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/quickinput/ddorderline/DDOrderLineQuickInputCallout.java", "diffHunk": "@@ -72,7 +73,7 @@ public void onProductChange(@NonNull final ICalloutField calloutField)\n \t\t}\n \t\tfinal I_DD_Order ddOrder = quickInput.getRootDocumentAs(I_DD_Order.class);\n \n-\t\tddOrderLineQuickInput.setM_HU_PI_Item_Product(getDefaultPI(ddOrder, productId));\n+\t\tddOrderLineQuickInput.setM_HU_PI_Item_Product_ID(getDefaultPI(ddOrder, productId).getM_HU_PI_Item_Product_ID());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "935224947e7e63007f10ec7d6120ff58140a15d8"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1098, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}