{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0MDY1NjI2", "number": 6593, "title": "Gh6566 2 customer retention: repair logic, refactoring, test", "bodyText": "#6566", "createdAt": "2020-05-06T12:30:00Z", "url": "https://github.com/metasfresh/metasfresh/pull/6593", "merged": true, "mergeCommit": {"oid": "a5862f5061436914e9e86edb639ad56269dea8fa"}, "closed": true, "closedAt": "2020-05-07T12:01:53Z", "author": {"login": "metas-rc"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceTd5sAH2gAyNDE0MDY1NjI2Ojc1YmEzNmY5MjRhY2M0Njg0MTk2NjQyMDhmYTdiMGE5OTJjYmUyMzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABce8DWBAFqTQwNzQwMzExMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "75ba36f924acc468419664208fa7b0a992cbe234", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/75ba36f924acc468419664208fa7b0a992cbe234", "committedDate": "2020-05-05T12:44:40Z", "message": "#6566 customer retention logic refactoring\n\nhttps://github.com/metasfresh/metasfresh/issues/6566"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "930f7e8853ddccaf1468de809e406a4220582adb", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/930f7e8853ddccaf1468de809e406a4220582adb", "committedDate": "2020-05-06T12:07:33Z", "message": "#6566 improve logic, cleanup, test\n\nhttps://github.com/metasfresh/metasfresh/issues/6566"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94133edcc936aa7779966a165806d47d3c9b8137", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/94133edcc936aa7779966a165806d47d3c9b8137", "committedDate": "2020-05-06T12:29:14Z", "message": "#6566 Repair customer retentino logic, refactoring, test\n\nhttps://github.com/metasfresh/metasfresh/issues/6566"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5a3e1b7bec62b31e85af9075b7b58177d956e13", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/b5a3e1b7bec62b31e85af9075b7b58177d956e13", "committedDate": "2020-05-06T12:30:22Z", "message": "Merge branch 'master' into gh6566_2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22bfa134f063ec463408db546c77eb53922592c4", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/22bfa134f063ec463408db546c77eb53922592c4", "committedDate": "2020-05-06T14:54:42Z", "message": "#6566 merge the 2 processes in only 1 process\n\nhttps://github.com/metasfresh/metasfresh/issues/6566"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f8a6936272e81cfcaa3cbdd550b731cc8d4c6cd", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/3f8a6936272e81cfcaa3cbdd550b731cc8d4c6cd", "committedDate": "2020-05-06T14:56:37Z", "message": "Revert \"#6566 merge the 2 processes in only 1 process\"\n\nThis reverts commit 22bfa134f063ec463408db546c77eb53922592c4."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "651e95ee38c33dcd5b840652ca4d80ab6ec33198", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/651e95ee38c33dcd5b840652ca4d80ab6ec33198", "committedDate": "2020-05-06T14:57:32Z", "message": "#6566 merge the 2 processes into a a createUpdate process\n\nhttps://github.com/metasfresh/metasfresh/issues/6566"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "271ef62473ee98d8fdcccce8ff8dc37b6cafcf0f", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/271ef62473ee98d8fdcccce8ff8dc37b6cafcf0f", "committedDate": "2020-05-06T14:58:00Z", "message": "Merge branch 'gh6566_2' of https://github.com/metasfresh/metasfresh into gh6566_2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d9e33ef2419cae7acf963eea56e946ee5938752", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/3d9e33ef2419cae7acf963eea56e946ee5938752", "committedDate": "2020-05-06T15:49:39Z", "message": "#6566 repair customerRetentionId repoIdAware\n\nhttps://github.com/metasfresh/metasfresh/issues/6566"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfc2900ec42e52da88c383e73e29dae208535c4f", "author": {"user": {"login": "metas-ts", "name": "Tobias Sch\u00f6neberg"}}, "url": "https://github.com/metasfresh/metasfresh/commit/dfc2900ec42e52da88c383e73e29dae208535c4f", "committedDate": "2020-05-07T09:47:46Z", "message": "fix typo in method name\n\n#6566"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MzE3MjU5", "url": "https://github.com/metasfresh/metasfresh/pull/6593#pullrequestreview-407317259", "createdAt": "2020-05-07T09:49:20Z", "commit": {"oid": "dfc2900ec42e52da88c383e73e29dae208535c4f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwOTo0OToyMVrOGR3BDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwOTo1MDozN1rOGR3D3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM4MDM2NQ==", "bodyText": "pls add @NonNull at least to public methods like this one", "url": "https://github.com/metasfresh/metasfresh/pull/6593#discussion_r421380365", "createdAt": "2020-05-07T09:49:21Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.contracts/src/main/java/de/metas/contracts/impl/CustomerRetentionRepository.java", "diffHunk": "@@ -64,13 +68,18 @@\n \tprivate final IInvoiceDAO invoiceDAO = Services.get(IInvoiceDAO.class);\n \tprivate final IContractsDAO contractsDAO = Services.get(IContractsDAO.class);\n \tprivate final ContractInvoiceService contractInvoiceService;\n-\t\n+\n+\tpublic I_C_Customer_Retention getById(final CustomerRetentionId customerRetentionId)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfc2900ec42e52da88c383e73e29dae208535c4f"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM4MTA4Ng==", "bodyText": "please add a comment or better an Check.assumeNotNull here to make it explicit the you made sure elsewhere this won't be null\nPS: if you need to rely on something outside this class, such as the model interceptors, i suggest to invoke that getCreate createUpdate method instead..", "url": "https://github.com/metasfresh/metasfresh/pull/6593#discussion_r421381086", "createdAt": "2020-05-07T09:50:37Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.contracts/src/main/java/de/metas/contracts/impl/CustomerRetentionRepository.java", "diffHunk": "@@ -80,134 +89,111 @@ public I_C_Customer_Retention createNewCustomerRetention(@NonNull final BPartner\n \n \t\tsave(customerRetention);\n \n-\t\treturn customerRetention;\n+\t\treturn CustomerRetentionId.ofRepoId(customerRetention.getC_Customer_Retention_ID());\n \t}\n \n-\tpublic void setNewCustomer(@NonNull final BPartnerId bpartnerId)\n+\t@VisibleForTesting\n+\tvoid setNewCustomer(@NonNull final CustomerRetentionId customerRetentionId)\n \t{\n-\t\tI_C_Customer_Retention customerRetention = retrieveCustomerRetention(bpartnerId);\n-\n-\t\tif (customerRetention == null)\n-\t\t{\n-\t\t\tcustomerRetention = createNewCustomerRetention(bpartnerId);\n-\t\t}\n+\t\tfinal I_C_Customer_Retention customerRetention = getById(customerRetentionId);\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfc2900ec42e52da88c383e73e29dae208535c4f"}, "originalPosition": 79}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e98617ae6782f8d139191b190d117e3973016047", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/e98617ae6782f8d139191b190d117e3973016047", "committedDate": "2020-05-07T10:06:02Z", "message": "Merge branch 'master' into gh6566_2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0f2f9e70d5749491b31e6446d2a07b9b5ebe0b7", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/b0f2f9e70d5749491b31e6446d2a07b9b5ebe0b7", "committedDate": "2020-05-07T10:43:02Z", "message": "#6566 nullchecks\n\nhttps://github.com/metasfresh/metasfresh/issues/6566"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41482e2e72fdb770890c73e033d208fdf7cbd4ac", "author": {"user": {"login": "metas-rc", "name": "Ruxandra Craciunescu"}}, "url": "https://github.com/metasfresh/metasfresh/commit/41482e2e72fdb770890c73e033d208fdf7cbd4ac", "committedDate": "2020-05-07T10:44:02Z", "message": "Merge branch 'master' into gh6566_2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NDAzMTEw", "url": "https://github.com/metasfresh/metasfresh/pull/6593#pullrequestreview-407403110", "createdAt": "2020-05-07T12:01:46Z", "commit": {"oid": "41482e2e72fdb770890c73e033d208fdf7cbd4ac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3393, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}