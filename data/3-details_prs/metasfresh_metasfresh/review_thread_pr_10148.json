{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4Mzg5OTA2", "number": 10148, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNTo1NTozNFrOEw1bZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNjowMTo0MlrOEw1miQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjQyNDY5OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.business.rest-api-impl/src/main/java/de/metas/rest_api/shipping/ShipmentCandidateAPIService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNTo1NTozNFrOHmovTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNTo1NTozNFrOHmovTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3NTQwNw==", "bodyText": "if i get it right, you can break if the limit is reached, and don't have to iterate the remaining schedules", "url": "https://github.com/metasfresh/metasfresh/pull/10148#discussion_r510275407", "createdAt": "2020-10-22T15:55:34Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.business.rest-api-impl/src/main/java/de/metas/rest_api/shipping/ShipmentCandidateAPIService.java", "diffHunk": "@@ -636,13 +640,51 @@ private IdsRegistry buildIdsRegistry(@NonNull final List<ShipmentSchedule> sched\n \tprivate List<ShipmentSchedule> loadShipmentSchedulesToExport(@NonNull final QueryLimit limit)\n \t{\n \t\tfinal ShipmentScheduleQuery shipmentScheduleQuery = ShipmentScheduleQuery.builder()\n-\t\t\t\t.limit(limit)\n \t\t\t\t.canBeExportedFrom(SystemTime.asInstant())\n+\t\t\t\t.noFutureExportOfOrder(true)\n \t\t\t\t.exportStatus(APIExportStatus.Pending)\n \t\t\t\t.includeWithQtyToDeliverZero(true)\n+\t\t\t\t.fromCompleteOrderOrNullOrder(true)\n+\t\t\t\t.orderByOrderId(true)\n \t\t\t\t.build();\n \n-\t\treturn shipmentScheduleRepository.getBy(shipmentScheduleQuery);\n+\t\tfinal List<ShipmentSchedule> shipmentSchedulesOrderedByOrderId = shipmentScheduleRepository.getBy(shipmentScheduleQuery);\n+\t\tList<ShipmentSchedule> schedulesToBeExported = new ArrayList<>();\n+\n+\t\tint counter = 0;\n+\t\tfor (ShipmentSchedule schedule : shipmentSchedulesOrderedByOrderId)\n+\t\t{\n+\t\t\tif (schedule.getOrderAndLineId() == null && counter < limit.toInt() - 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6064cc806ca40fc564d9a5539d4d87d50bb35fb"}, "originalPosition": 142}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjQ1MzIxOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/inoutcandidate/ShipmentScheduleRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNjowMTo0MlrOHmpBOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNjoxMzozOVrOHmphuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3OTk5NA==", "bodyText": "i could understand noFutureExportOfOrder only after looking at the code in ShipmentScheduleRepository..\npls add a javadoc-comment to it, oooor think of a better name...like..maybe sth like onlyIfAllFromOrderExportable?", "url": "https://github.com/metasfresh/metasfresh/pull/10148#discussion_r510279994", "createdAt": "2020-10-22T16:01:42Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/inoutcandidate/ShipmentScheduleRepository.java", "diffHunk": "@@ -227,5 +273,14 @@ private void save(@NonNull final ShipmentSchedule shipmentSchedule)\n \n \t\t@Builder.Default\n \t\tboolean includeProcessed = false;\n+\n+\t\t@Builder.Default\n+\t\tboolean fromCompleteOrderOrNullOrder = false;\n+\n+\t\t@Builder.Default\n+\t\tboolean orderByOrderId = false;\n+\t\t@Builder.Default\n+\t\tboolean noFutureExportOfOrder = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6064cc806ca40fc564d9a5539d4d87d50bb35fb"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI4ODMxNQ==", "bodyText": "Why not both? :)\nDone", "url": "https://github.com/metasfresh/metasfresh/pull/10148#discussion_r510288315", "createdAt": "2020-10-22T16:13:39Z", "author": {"login": "metas-rc"}, "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/inoutcandidate/ShipmentScheduleRepository.java", "diffHunk": "@@ -227,5 +273,14 @@ private void save(@NonNull final ShipmentSchedule shipmentSchedule)\n \n \t\t@Builder.Default\n \t\tboolean includeProcessed = false;\n+\n+\t\t@Builder.Default\n+\t\tboolean fromCompleteOrderOrNullOrder = false;\n+\n+\t\t@Builder.Default\n+\t\tboolean orderByOrderId = false;\n+\t\t@Builder.Default\n+\t\tboolean noFutureExportOfOrder = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3OTk5NA=="}, "originalCommit": {"oid": "a6064cc806ca40fc564d9a5539d4d87d50bb35fb"}, "originalPosition": 154}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1230, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}