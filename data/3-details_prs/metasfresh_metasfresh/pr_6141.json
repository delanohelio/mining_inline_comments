{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyMjg3MjQz", "number": 6141, "title": "Gh6134", "bodyText": "#6134", "createdAt": "2020-02-07T08:14:16Z", "url": "https://github.com/metasfresh/metasfresh/pull/6141", "merged": true, "mergeCommit": {"oid": "3171a7a19bae197e62f0785160dc7ad20aab7121"}, "closed": true, "closedAt": "2020-02-07T21:28:12Z", "author": {"login": "teosarca"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBo54jAH2gAyMzcyMjg3MjQzOmMwYTBmNGFhZWUzZjMzMzNmY2UxYTk3YTU5ODZkMWFlZDU0OTY2N2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcCEjfbgH2gAyMzcyMjg3MjQzOmE4ZDFlZTk3NjNiZjU4OTUxMzNjMWQzYjE0NjQxMzM5MWRmOTY2Y2M=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c0a0f4aaee3f3333fce1a97a5986d1aed549667a", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/c0a0f4aaee3f3333fce1a97a5986d1aed549667a", "committedDate": "2020-02-06T11:19:26Z", "message": "generate all async models + fix compile errors\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e34cbb3cde4e78ae5bd4bf501d0a1360eb0063ab", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/e34cbb3cde4e78ae5bd4bf501d0a1360eb0063ab", "committedDate": "2020-02-06T11:21:05Z", "message": "THE FIX - InvoiceCandBL.setQualityDiscountPercent_Override: don't search for a break if pricing conditions is not based on breaks\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf45510697e105e566ba34d8f5904b890982de0c", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/bf45510697e105e566ba34d8f5904b890982de0c", "committedDate": "2020-02-06T11:21:46Z", "message": "Loggables.withWarnLoggerToo\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82e5314ee04490be8ad5458696352950178d7966", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/82e5314ee04490be8ad5458696352950178d7966", "committedDate": "2020-02-06T11:23:28Z", "message": "WorkpackageLoggable: handle exceptions and set C_Queue_WorkPackage_Log.AD_Issue_ID\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3eb07c9a28dfefbbd4b5af8d3b7585ece363fc23", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/3eb07c9a28dfefbbd4b5af8d3b7585ece363fc23", "committedDate": "2020-02-06T11:24:03Z", "message": "put current model in MDC\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05f2ed2f26bce7225e5d540c37e8a65c09afff2d", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/05f2ed2f26bce7225e5d540c37e8a65c09afff2d", "committedDate": "2020-02-06T11:24:12Z", "message": "minor\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5ad67b88f79c2c76cf979be147ed98b7e0507db", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/c5ad67b88f79c2c76cf979be147ed98b7e0507db", "committedDate": "2020-02-06T11:24:36Z", "message": "InvoiceCandidateHandlerBL: let the exception flow\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d8d0c1ae75e4574f8a188422641a8cadb2d392e", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/5d8d0c1ae75e4574f8a188422641a8cadb2d392e", "committedDate": "2020-02-06T11:35:47Z", "message": "Env.getLoggedUserIdIfExists()\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e2755d7d26ca893beaaaa89dc59b1f95df4e325", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/0e2755d7d26ca893beaaaa89dc59b1f95df4e325", "committedDate": "2020-02-06T11:36:14Z", "message": "IWorkPackageBuilder: QA\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd16b1faf006cbfbc94431d24a33bf03bd28690c", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/dd16b1faf006cbfbc94431d24a33bf03bd28690c", "committedDate": "2020-02-07T07:51:51Z", "message": "change data source name\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39e3339cea89a664895c6844f7cd2780370bad0a", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/39e3339cea89a664895c6844f7cd2780370bad0a", "committedDate": "2020-02-07T07:51:57Z", "message": "Create 5551380_sys_gh6134_display_C_Queue_WorkPackage_Log_AD_Issue_ID.sql\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3b3642cf212ab06f47f9fee1012805cbaae353b", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/d3b3642cf212ab06f47f9fee1012805cbaae353b", "committedDate": "2020-02-07T08:13:10Z", "message": "WorkpackagesOnCommitSchedulerTemplate.extractUserInChargeOrNull\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88ac50aea5fca3d61315a286ff9680e56e85ad47", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/88ac50aea5fca3d61315a286ff9680e56e85ad47", "committedDate": "2020-02-07T08:13:38Z", "message": "CreateMissingInvoiceCandidatesWorkpackageProcessor: use currently logged user if any as user in charge\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91380b3acd2a71c605fd87a7dc7d2b3aa0121e29", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/91380b3acd2a71c605fd87a7dc7d2b3aa0121e29", "committedDate": "2020-02-07T08:13:45Z", "message": "Merge branch 'master' into gh6134"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MTExNTMz", "url": "https://github.com/metasfresh/metasfresh/pull/6141#pullrequestreview-355111533", "createdAt": "2020-02-07T12:02:55Z", "commit": {"oid": "91380b3acd2a71c605fd87a7dc7d2b3aa0121e29"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMjowMjo1NVrOFm6_wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxMjowNDozNlrOFm7B-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM1NjgwMA==", "bodyText": "i guess here is \"the\" fix, right?", "url": "https://github.com/metasfresh/metasfresh/pull/6141#discussion_r376356800", "createdAt": "2020-02-07T12:02:55Z", "author": {"login": "metas-ts"}, "path": "de.metas.swat/de.metas.swat.base/src/main/java/de/metas/invoicecandidate/api/impl/InvoiceCandBL.java", "diffHunk": "@@ -1809,40 +1810,49 @@ public void setQualityDiscountPercent_Override(final I_C_Invoice_Candidate ic, f\n \t\tfinal IBPartnerBL bpartnerBL = Services.get(IBPartnerBL.class);\n \t\tfinal IProductDAO productsRepo = Services.get(IProductDAO.class);\n \n-\t\tfinal int discountSchemaId = bpartnerBL.getDiscountSchemaId(BPartnerId.ofRepoId(ic.getBill_BPartner_ID()), SOTrx.ofBoolean(ic.isSOTrx()));\n-\t\tif (discountSchemaId <= 0)\n+\t\tfinal PricingConditionsId pricingConditionsId = PricingConditionsId.ofRepoIdOrNull(bpartnerBL.getDiscountSchemaId(BPartnerId.ofRepoId(ic.getBill_BPartner_ID()), SOTrx.ofBoolean(ic.isSOTrx())));\n+\t\tif (pricingConditionsId == null)\n \t\t{\n \t\t\t// do nothing\n \t\t\treturn;\n \t\t}\n \n-\t\tBigDecimal qty = ic.getQtyToInvoice();\n-\t\tif (qty.signum() < 0)\n+\t\tfinal BigDecimal qualityDiscountPercentage;\n+\t\tfinal PricingConditions pricingConditions = pricingConditionsRepo.getPricingConditionsById(pricingConditionsId);\n+\t\tif(pricingConditions.isBreaksDiscountType())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91380b3acd2a71c605fd87a7dc7d2b3aa0121e29"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM1NzM3MQ==", "bodyText": "i know that's sortof nitpicking, but whyt the ..Too?", "url": "https://github.com/metasfresh/metasfresh/pull/6141#discussion_r376357371", "createdAt": "2020-02-07T12:04:36Z", "author": {"login": "metas-ts"}, "path": "de.metas.util/src/main/java/de/metas/util/Loggables.java", "diffHunk": "@@ -94,6 +94,11 @@ public static ILoggable withLogger(@NonNull final Logger logger, @NonNull final\n \t\treturn new LoggableWithLogger(get(), logger, level);\n \t}\n \n+\tpublic static ILoggable withWarnLoggerToo(@NonNull final Logger logger)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91380b3acd2a71c605fd87a7dc7d2b3aa0121e29"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ac10257df8a3491f22255b151fc7018a0fe0b47", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/3ac10257df8a3491f22255b151fc7018a0fe0b47", "committedDate": "2020-02-07T16:00:05Z", "message": "contracts: QA tests, avoid using SpringRunner\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad22d910d7fb1061bc448de7b160205d76060605", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/ad22d910d7fb1061bc448de7b160205d76060605", "committedDate": "2020-02-07T16:00:32Z", "message": "fix failing test: i.e. check QtyEntered instead of QtyToInvoice\n\nhttps://github.com/metasfresh/metasfresh/issues/6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bec6730426b9e40cfa396641f02f3c0dd7cb7a9d", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/bec6730426b9e40cfa396641f02f3c0dd7cb7a9d", "committedDate": "2020-02-07T16:00:45Z", "message": "Merge branch 'master' into gh6134"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8d1ee9763bf5895133c1d3b146413391df966cc", "author": {"user": {"login": "teosarca", "name": "Teo Sarca"}}, "url": "https://github.com/metasfresh/metasfresh/commit/a8d1ee9763bf5895133c1d3b146413391df966cc", "committedDate": "2020-02-07T19:32:19Z", "message": "de.metas.contracts: use junit 5"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3598, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}