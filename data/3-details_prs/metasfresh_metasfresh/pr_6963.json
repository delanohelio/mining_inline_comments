{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NzQ5OTE2", "number": 6963, "title": "#6956 Implement possibility to easy switch from QR Bill to ESR ", "bodyText": "#6956", "createdAt": "2020-07-06T12:42:37Z", "url": "https://github.com/metasfresh/metasfresh/pull/6963", "merged": true, "mergeCommit": {"oid": "40f7c5b47d49ddb68887116d56154d278acd078c"}, "closed": true, "closedAt": "2020-07-06T14:35:33Z", "author": {"login": "cristinamghita"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxPEABgH2gAyNDQ0NzQ5OTE2OmQwZTI0ODc0MDI0ZmJlOTQzZjkxMDY0MjFjYzQxOGE1MjQ3MDA3M2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyRn41gFqTQ0MzA5NjYwOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d0e24874024fbe943f9106421cc418a52470073b", "author": {"user": {"login": "cristinamghita", "name": "Cristina Ghita"}}, "url": "https://github.com/metasfresh/metasfresh/commit/d0e24874024fbe943f9106421cc418a52470073b", "committedDate": "2020-07-03T08:21:19Z", "message": "#6956 Adfd function isShowQRBill\n\nImplement possibility to easy switch from QR Bill to ESR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57989e9a865d937a965ea4ee81d92f73c6aa4b4a", "author": {"user": {"login": "cristinamghita", "name": "Cristina Ghita"}}, "url": "https://github.com/metasfresh/metasfresh/commit/57989e9a865d937a965ea4ee81d92f73c6aa4b4a", "committedDate": "2020-07-03T08:22:27Z", "message": "#6956 Add sys config ShowQRBill\n\n#6956 Implement possibility to easy switch from QR Bill to ESR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea4931d813ddc916181adccaed54e54b4c4123fc", "author": {"user": {"login": "cristinamghita", "name": "Cristina Ghita"}}, "url": "https://github.com/metasfresh/metasfresh/commit/ea4931d813ddc916181adccaed54e54b4c4123fc", "committedDate": "2020-07-03T08:40:49Z", "message": "#6956 Add printWhen logic in the jasper invoice report\n\n#6956 Implement possibility to easy switch from QR Bill to ESR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40d94307c626e3ae53cc1c07414b4b5357c063d1", "author": {"user": {"login": "cristinamghita", "name": "Cristina Ghita"}}, "url": "https://github.com/metasfresh/metasfresh/commit/40d94307c626e3ae53cc1c07414b4b5357c063d1", "committedDate": "2020-07-06T12:44:41Z", "message": "#6956 Minor cleaning"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMDU5OTE1", "url": "https://github.com/metasfresh/metasfresh/pull/6963#pullrequestreview-443059915", "createdAt": "2020-07-06T13:10:25Z", "commit": {"oid": "40d94307c626e3ae53cc1c07414b4b5357c063d1"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMzoxMDoyNVrOGtWlSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMzoxNTowN1rOGtWv6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIwOTA5Nw==", "bodyText": "maybe we should leave the loop here?", "url": "https://github.com/metasfresh/metasfresh/pull/6963#discussion_r450209097", "createdAt": "2020-07-06T13:10:25Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.fresh/de.metas.fresh.base/src/main/sql/postgresql/ddl/functions/isShowQRBill.sql", "diffHunk": "@@ -0,0 +1,43 @@\n+DROP FUNCTION IF EXISTS report.isShowQRBill(IN p_AD_Client_ID numeric, IN p_AD_Org_ID numeric);\n+\n+create or replace function report.isShowQRBill(IN p_AD_Client_ID numeric, IN p_AD_Org_ID numeric) RETURNS CHAR AS\n+$$\n+DECLARE\n+    isShowQRBill CHAR DEFAULT 'Y';\n+    foundValue   BOOLEAN DEFAULT FALSE;\n+    rec_config   RECORD;\n+    sysConfigs CURSOR FOR SELECT *\n+                          from AD_SysConfig\n+                          where Name = 'ShowQRBill';\n+BEGIN\n+    OPEN sysConfigs;\n+\n+    LOOP\n+        -- fetch row into the film\n+        FETCH sysConfigs INTO rec_config;\n+        -- exit when no more row to fetch\n+        EXIT WHEN NOT FOUND;\n+\n+        -- build the output\n+        IF rec_config.AD_Client_ID = p_AD_Client_ID AND rec_config.AD_Org_ID = p_AD_Org_ID THEN\n+            isShowQRBill := rec_config.value;\n+            foundValue := TRUE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40d94307c626e3ae53cc1c07414b4b5357c063d1"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIxMTU3OQ==", "bodyText": "I might be underthinking the problem, but maybe the function could also have done something along the lines of\nselect ... from AD_SysConfig where AD_Client_ID IN (0,1000000) AND AD_Org_ID IN (0, p_AD_Org_ID) ORDER BY AD_Org_ID DESC, AD_Client_ID DESC LIMIT 1", "url": "https://github.com/metasfresh/metasfresh/pull/6963#discussion_r450211579", "createdAt": "2020-07-06T13:14:38Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.fresh/de.metas.fresh.base/src/main/sql/postgresql/ddl/functions/isShowQRBill.sql", "diffHunk": "@@ -0,0 +1,43 @@\n+DROP FUNCTION IF EXISTS report.isShowQRBill(IN p_AD_Client_ID numeric, IN p_AD_Org_ID numeric);\n+\n+create or replace function report.isShowQRBill(IN p_AD_Client_ID numeric, IN p_AD_Org_ID numeric) RETURNS CHAR AS\n+$$\n+DECLARE\n+    isShowQRBill CHAR DEFAULT 'Y';\n+    foundValue   BOOLEAN DEFAULT FALSE;\n+    rec_config   RECORD;\n+    sysConfigs CURSOR FOR SELECT *\n+                          from AD_SysConfig\n+                          where Name = 'ShowQRBill';\n+BEGIN\n+    OPEN sysConfigs;\n+\n+    LOOP\n+        -- fetch row into the film\n+        FETCH sysConfigs INTO rec_config;\n+        -- exit when no more row to fetch\n+        EXIT WHEN NOT FOUND;\n+\n+        -- build the output\n+        IF rec_config.AD_Client_ID = p_AD_Client_ID AND rec_config.AD_Org_ID = p_AD_Org_ID THEN\n+            isShowQRBill := rec_config.value;\n+            foundValue := TRUE;\n+        END IF;\n+\n+    END LOOP;\n+\n+    -- Close the cursor\n+    CLOSE sysConfigs;\n+\n+\n+    IF foundValue = FALSE THEN\n+        SELECT VALUE\n+        INTO isShowQRBill\n+        from AD_SysConfig\n+        where Name = 'ShowQRBill' AND AD_Client_ID = 0 AND AD_Org_ID = 0;\n+    END IF;\n+\n+    return isShowQRBill;\n+END\n+$$\n+    LANGUAGE plpgsql;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40d94307c626e3ae53cc1c07414b4b5357c063d1"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIxMTgxNw==", "bodyText": "please add a description that explains what the function switches between", "url": "https://github.com/metasfresh/metasfresh/pull/6963#discussion_r450211817", "createdAt": "2020-07-06T13:15:07Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.fresh/de.metas.fresh.base/src/main/sql/postgresql/system/70-de.metas.fresh/5562680_sys_gh6956_AddSHowQRBIllSysCOnfig.sql", "diffHunk": "@@ -0,0 +1,10 @@\n+-- 2020-07-02T12:08:05.045Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_SysConfig (AD_Client_ID,AD_Org_ID,AD_SysConfig_ID,ConfigurationLevel,Created,CreatedBy,EntityType,IsActive,Name,Updated,UpdatedBy,Value) VALUES (0,0,541328,'S',TO_TIMESTAMP('2020-07-02 15:08:04','YYYY-MM-DD HH24:MI:SS'),100,'D','Y','ShowQRBill',TO_TIMESTAMP('2020-07-02 15:08:04','YYYY-MM-DD HH24:MI:SS'),100,'Y')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40d94307c626e3ae53cc1c07414b4b5357c063d1"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cce53313092adaaef0d4676c687a714d768205fe", "author": {"user": {"login": "cristinamghita", "name": "Cristina Ghita"}}, "url": "https://github.com/metasfresh/metasfresh/commit/cce53313092adaaef0d4676c687a714d768205fe", "committedDate": "2020-07-06T13:40:24Z", "message": "#6956 Simplify things"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMDk2NjA5", "url": "https://github.com/metasfresh/metasfresh/pull/6963#pullrequestreview-443096609", "createdAt": "2020-07-06T13:54:12Z", "commit": {"oid": "cce53313092adaaef0d4676c687a714d768205fe"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMzo1NDoxMlrOGtYP7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMzo1NDoxMlrOGtYP7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIzNjM5OQ==", "bodyText": "clarified with cris, if there is no value, it will stay 'Y' and not be reassigned NULL", "url": "https://github.com/metasfresh/metasfresh/pull/6963#discussion_r450236399", "createdAt": "2020-07-06T13:54:12Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.fresh/de.metas.fresh.base/src/main/sql/postgresql/ddl/functions/isShowQRBill.sql", "diffHunk": "@@ -0,0 +1,17 @@\n+DROP FUNCTION IF EXISTS report.isShowQRBill(IN p_AD_Client_ID numeric, IN p_AD_Org_ID numeric);\n+\n+create or replace function report.isShowQRBill(IN p_AD_Client_ID numeric, IN p_AD_Org_ID numeric) RETURNS CHAR AS\n+$$\n+DECLARE\n+    isShowQRBill CHAR DEFAULT 'Y';\n+BEGIN\n+ \n+        SELECT VALUE\n+        INTO isShowQRBill", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cce53313092adaaef0d4676c687a714d768205fe"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3318, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}