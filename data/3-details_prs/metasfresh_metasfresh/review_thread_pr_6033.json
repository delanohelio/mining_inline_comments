{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMjIyMTEz", "number": 6033, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwOToxNTo1MVrODXxvTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwOTozMTowNlrODXyBQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MjU4NzY2OnYy", "diffSide": "RIGHT", "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/ddl/functions/exportSalesInvoicesInDateRange.sql", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwOToxNTo1MVrOFdQiVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwOToxNTo1MVrOFdQiVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIyMzk1Ng==", "bodyText": "Also filter on inv.AD_Client_ID=1000000 AND inv.IsaCtive='Y' pls", "url": "https://github.com/metasfresh/metasfresh/pull/6033#discussion_r366223956", "createdAt": "2020-01-14T09:15:51Z", "author": {"login": "metas-ts"}, "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/ddl/functions/exportSalesInvoicesInDateRange.sql", "diffHunk": "@@ -0,0 +1,38 @@\n+DROP FUNCTION IF EXISTS exportSalesInvoicesInDateRange(TIMESTAMP With Time Zone, TIMESTAMP With Time Zone, numeric);\n+\n+CREATE OR REPLACE FUNCTION exportSalesInvoicesInDateRange(IN p_C_Invoice_dateinvoiced_start TIMESTAMP With Time Zone, \n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_C_Invoice_dateinvoiced_end TIMESTAMP With Time Zone,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_AD_Org_ID numeric)\n+\n+    RETURNS TABLE\n+            (\n+                AD_Org_ID character varying,\n+\t\t\t\tC_Bpartner_ID character varying,\n+\t\t\t\tC_Invoices_Count bigint\n+            )\n+AS\n+\n+$BODY$\n+\n+SELECT DISTINCT org.name as AD_Org_ID,\n+\tbp.name as C_Bpartner_ID,\n+\t(SELECT COUNT(*)\n+\t FROM   C_Invoice other\n+\t WHERE other.c_bpartner_id = inv.c_bpartner_id\n+ \t AND other.ad_org_id = inv.ad_org_id\n+\t AND other.dateinvoiced >= p_C_Invoice_dateinvoiced_start\n+     AND other.dateinvoiced <= p_C_Invoice_dateinvoiced_end\n+\t)\n+\t AS C_Invoices_Count\n+\t\n+FROM C_Invoice inv\n+\tLEFT OUTER JOIN ad_org org on org.ad_org_id = inv.ad_org_id\n+\tLEFT OUTER JOIN c_bpartner bp on bp.c_bpartner_id = inv.c_bpartner_id\n+WHERE inv.dateinvoiced >= p_C_Invoice_dateinvoiced_start", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab220c494aff8c44da72f23fad1f00bf88ccb40"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MjYxNjI3OnYy", "diffSide": "RIGHT", "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/ddl/functions/exportSalesInvoicesInDateRange.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwOToyNTo0MFrOFdQz8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwOToyNTo0MFrOFdQz8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIyODQ2NA==", "bodyText": "This is a misunderstanding: the org-partner means the BPartner that \"represents\" the org...not the invoice's partner.\nSo basically, if you write a sales-invoice with Org=ABC, then\n\nthe BPartner from inv.c_bpartner_id is supposed to pay to Org ABC\nand ABC's \"organization-bpartner\" will find the paid money on their bank-accound\n\nSo, to get from an invoice to the \"organization-bpartner\", you go C_Invoice.AD_Org_ID and then AD_Org.AD_OrgBP_ID.", "url": "https://github.com/metasfresh/metasfresh/pull/6033#discussion_r366228464", "createdAt": "2020-01-14T09:25:40Z", "author": {"login": "metas-ts"}, "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/ddl/functions/exportSalesInvoicesInDateRange.sql", "diffHunk": "@@ -0,0 +1,38 @@\n+DROP FUNCTION IF EXISTS exportSalesInvoicesInDateRange(TIMESTAMP With Time Zone, TIMESTAMP With Time Zone, numeric);\n+\n+CREATE OR REPLACE FUNCTION exportSalesInvoicesInDateRange(IN p_C_Invoice_dateinvoiced_start TIMESTAMP With Time Zone, \n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_C_Invoice_dateinvoiced_end TIMESTAMP With Time Zone,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_AD_Org_ID numeric)\n+\n+    RETURNS TABLE\n+            (\n+                AD_Org_ID character varying,\n+\t\t\t\tC_Bpartner_ID character varying,\n+\t\t\t\tC_Invoices_Count bigint\n+            )\n+AS\n+\n+$BODY$\n+\n+SELECT DISTINCT org.name as AD_Org_ID,\n+\tbp.name as C_Bpartner_ID,\n+\t(SELECT COUNT(*)\n+\t FROM   C_Invoice other\n+\t WHERE other.c_bpartner_id = inv.c_bpartner_id\n+ \t AND other.ad_org_id = inv.ad_org_id\n+\t AND other.dateinvoiced >= p_C_Invoice_dateinvoiced_start\n+     AND other.dateinvoiced <= p_C_Invoice_dateinvoiced_end\n+\t)\n+\t AS C_Invoices_Count\n+\t\n+FROM C_Invoice inv\n+\tLEFT OUTER JOIN ad_org org on org.ad_org_id = inv.ad_org_id", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab220c494aff8c44da72f23fad1f00bf88ccb40"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MjYzMDI1OnYy", "diffSide": "RIGHT", "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/ddl/functions/exportSalesInvoicesInDateRange.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwOTozMDoxMlrOFdQ8iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwOTozMDoxMlrOFdQ8iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIzMDY2NQ==", "bodyText": "please rewrite the select to get rid of the subselect, and have just one where-clause.\nyou can do this with \"group by\"", "url": "https://github.com/metasfresh/metasfresh/pull/6033#discussion_r366230665", "createdAt": "2020-01-14T09:30:12Z", "author": {"login": "metas-ts"}, "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/ddl/functions/exportSalesInvoicesInDateRange.sql", "diffHunk": "@@ -0,0 +1,38 @@\n+DROP FUNCTION IF EXISTS exportSalesInvoicesInDateRange(TIMESTAMP With Time Zone, TIMESTAMP With Time Zone, numeric);\n+\n+CREATE OR REPLACE FUNCTION exportSalesInvoicesInDateRange(IN p_C_Invoice_dateinvoiced_start TIMESTAMP With Time Zone, \n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_C_Invoice_dateinvoiced_end TIMESTAMP With Time Zone,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_AD_Org_ID numeric)\n+\n+    RETURNS TABLE\n+            (\n+                AD_Org_ID character varying,\n+\t\t\t\tC_Bpartner_ID character varying,\n+\t\t\t\tC_Invoices_Count bigint\n+            )\n+AS\n+\n+$BODY$\n+\n+SELECT DISTINCT org.name as AD_Org_ID,\n+\tbp.name as C_Bpartner_ID,\n+\t(SELECT COUNT(*)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab220c494aff8c44da72f23fad1f00bf88ccb40"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2MjYzMzYyOnYy", "diffSide": "RIGHT", "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/ddl/functions/exportSalesInvoicesInDateRange.sql", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwOTozMTowNlrOFdQ-gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwOTozMTowNlrOFdQ-gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIzMTE3MA==", "bodyText": "Also, filter by inv.DocType IN ('CO', 'CL'), because you don't want drafted or reversed invoices", "url": "https://github.com/metasfresh/metasfresh/pull/6033#discussion_r366231170", "createdAt": "2020-01-14T09:31:06Z", "author": {"login": "metas-ts"}, "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/ddl/functions/exportSalesInvoicesInDateRange.sql", "diffHunk": "@@ -0,0 +1,38 @@\n+DROP FUNCTION IF EXISTS exportSalesInvoicesInDateRange(TIMESTAMP With Time Zone, TIMESTAMP With Time Zone, numeric);\n+\n+CREATE OR REPLACE FUNCTION exportSalesInvoicesInDateRange(IN p_C_Invoice_dateinvoiced_start TIMESTAMP With Time Zone, \n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_C_Invoice_dateinvoiced_end TIMESTAMP With Time Zone,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_AD_Org_ID numeric)\n+\n+    RETURNS TABLE\n+            (\n+                AD_Org_ID character varying,\n+\t\t\t\tC_Bpartner_ID character varying,\n+\t\t\t\tC_Invoices_Count bigint\n+            )\n+AS\n+\n+$BODY$\n+\n+SELECT DISTINCT org.name as AD_Org_ID,\n+\tbp.name as C_Bpartner_ID,\n+\t(SELECT COUNT(*)\n+\t FROM   C_Invoice other\n+\t WHERE other.c_bpartner_id = inv.c_bpartner_id\n+ \t AND other.ad_org_id = inv.ad_org_id\n+\t AND other.dateinvoiced >= p_C_Invoice_dateinvoiced_start\n+     AND other.dateinvoiced <= p_C_Invoice_dateinvoiced_end\n+\t)\n+\t AS C_Invoices_Count\n+\t\n+FROM C_Invoice inv\n+\tLEFT OUTER JOIN ad_org org on org.ad_org_id = inv.ad_org_id\n+\tLEFT OUTER JOIN c_bpartner bp on bp.c_bpartner_id = inv.c_bpartner_id\n+WHERE inv.dateinvoiced >= p_C_Invoice_dateinvoiced_start\n+      AND inv.dateinvoiced <= p_C_Invoice_dateinvoiced_end\n+      AND CASE WHEN p_AD_Org_ID > 0 THEN inv.ad_org_id = p_AD_Org_ID ELSE 1 = 1 END", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab220c494aff8c44da72f23fad1f00bf88ccb40"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1540, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}