{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMjIyMTEz", "number": 6033, "title": "#3552 Added Action to export number of sales invoices in specific date range for business partners.", "bodyText": "#6032", "createdAt": "2020-01-13T16:57:58Z", "url": "https://github.com/metasfresh/metasfresh/pull/6033", "merged": true, "mergeCommit": {"oid": "6e2abdccc1ac55aa8c80c89883f272b2b5e9465f"}, "closed": true, "closedAt": "2020-01-16T06:46:07Z", "author": {"login": "dragospodariu96"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5_WmZgH2gAyMzYyMjIyMTEzOjFhYjIyMGM0OTRhZmY4YzQ0ZGE3MmYyM2ZhZDFmMDBiZjg4Y2NiNDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb60ZsiAFqTM0MzcwMDYyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1ab220c494aff8c44da72f23fad1f00bf88ccb40", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/1ab220c494aff8c44da72f23fad1f00bf88ccb40", "committedDate": "2020-01-13T16:57:19Z", "message": "#3552 Added Action to export number of sales invoices in specific date range for business partners."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMzgyNDU1", "url": "https://github.com/metasfresh/metasfresh/pull/6033#pullrequestreview-342382455", "createdAt": "2020-01-14T09:15:51Z", "commit": {"oid": "1ab220c494aff8c44da72f23fad1f00bf88ccb40"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwOToxNTo1MVrOFdQiVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwOTozMTowNlrOFdQ-gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIyMzk1Ng==", "bodyText": "Also filter on inv.AD_Client_ID=1000000 AND inv.IsaCtive='Y' pls", "url": "https://github.com/metasfresh/metasfresh/pull/6033#discussion_r366223956", "createdAt": "2020-01-14T09:15:51Z", "author": {"login": "metas-ts"}, "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/ddl/functions/exportSalesInvoicesInDateRange.sql", "diffHunk": "@@ -0,0 +1,38 @@\n+DROP FUNCTION IF EXISTS exportSalesInvoicesInDateRange(TIMESTAMP With Time Zone, TIMESTAMP With Time Zone, numeric);\n+\n+CREATE OR REPLACE FUNCTION exportSalesInvoicesInDateRange(IN p_C_Invoice_dateinvoiced_start TIMESTAMP With Time Zone, \n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_C_Invoice_dateinvoiced_end TIMESTAMP With Time Zone,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_AD_Org_ID numeric)\n+\n+    RETURNS TABLE\n+            (\n+                AD_Org_ID character varying,\n+\t\t\t\tC_Bpartner_ID character varying,\n+\t\t\t\tC_Invoices_Count bigint\n+            )\n+AS\n+\n+$BODY$\n+\n+SELECT DISTINCT org.name as AD_Org_ID,\n+\tbp.name as C_Bpartner_ID,\n+\t(SELECT COUNT(*)\n+\t FROM   C_Invoice other\n+\t WHERE other.c_bpartner_id = inv.c_bpartner_id\n+ \t AND other.ad_org_id = inv.ad_org_id\n+\t AND other.dateinvoiced >= p_C_Invoice_dateinvoiced_start\n+     AND other.dateinvoiced <= p_C_Invoice_dateinvoiced_end\n+\t)\n+\t AS C_Invoices_Count\n+\t\n+FROM C_Invoice inv\n+\tLEFT OUTER JOIN ad_org org on org.ad_org_id = inv.ad_org_id\n+\tLEFT OUTER JOIN c_bpartner bp on bp.c_bpartner_id = inv.c_bpartner_id\n+WHERE inv.dateinvoiced >= p_C_Invoice_dateinvoiced_start", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab220c494aff8c44da72f23fad1f00bf88ccb40"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIyODQ2NA==", "bodyText": "This is a misunderstanding: the org-partner means the BPartner that \"represents\" the org...not the invoice's partner.\nSo basically, if you write a sales-invoice with Org=ABC, then\n\nthe BPartner from inv.c_bpartner_id is supposed to pay to Org ABC\nand ABC's \"organization-bpartner\" will find the paid money on their bank-accound\n\nSo, to get from an invoice to the \"organization-bpartner\", you go C_Invoice.AD_Org_ID and then AD_Org.AD_OrgBP_ID.", "url": "https://github.com/metasfresh/metasfresh/pull/6033#discussion_r366228464", "createdAt": "2020-01-14T09:25:40Z", "author": {"login": "metas-ts"}, "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/ddl/functions/exportSalesInvoicesInDateRange.sql", "diffHunk": "@@ -0,0 +1,38 @@\n+DROP FUNCTION IF EXISTS exportSalesInvoicesInDateRange(TIMESTAMP With Time Zone, TIMESTAMP With Time Zone, numeric);\n+\n+CREATE OR REPLACE FUNCTION exportSalesInvoicesInDateRange(IN p_C_Invoice_dateinvoiced_start TIMESTAMP With Time Zone, \n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_C_Invoice_dateinvoiced_end TIMESTAMP With Time Zone,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_AD_Org_ID numeric)\n+\n+    RETURNS TABLE\n+            (\n+                AD_Org_ID character varying,\n+\t\t\t\tC_Bpartner_ID character varying,\n+\t\t\t\tC_Invoices_Count bigint\n+            )\n+AS\n+\n+$BODY$\n+\n+SELECT DISTINCT org.name as AD_Org_ID,\n+\tbp.name as C_Bpartner_ID,\n+\t(SELECT COUNT(*)\n+\t FROM   C_Invoice other\n+\t WHERE other.c_bpartner_id = inv.c_bpartner_id\n+ \t AND other.ad_org_id = inv.ad_org_id\n+\t AND other.dateinvoiced >= p_C_Invoice_dateinvoiced_start\n+     AND other.dateinvoiced <= p_C_Invoice_dateinvoiced_end\n+\t)\n+\t AS C_Invoices_Count\n+\t\n+FROM C_Invoice inv\n+\tLEFT OUTER JOIN ad_org org on org.ad_org_id = inv.ad_org_id", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab220c494aff8c44da72f23fad1f00bf88ccb40"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIzMDY2NQ==", "bodyText": "please rewrite the select to get rid of the subselect, and have just one where-clause.\nyou can do this with \"group by\"", "url": "https://github.com/metasfresh/metasfresh/pull/6033#discussion_r366230665", "createdAt": "2020-01-14T09:30:12Z", "author": {"login": "metas-ts"}, "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/ddl/functions/exportSalesInvoicesInDateRange.sql", "diffHunk": "@@ -0,0 +1,38 @@\n+DROP FUNCTION IF EXISTS exportSalesInvoicesInDateRange(TIMESTAMP With Time Zone, TIMESTAMP With Time Zone, numeric);\n+\n+CREATE OR REPLACE FUNCTION exportSalesInvoicesInDateRange(IN p_C_Invoice_dateinvoiced_start TIMESTAMP With Time Zone, \n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_C_Invoice_dateinvoiced_end TIMESTAMP With Time Zone,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_AD_Org_ID numeric)\n+\n+    RETURNS TABLE\n+            (\n+                AD_Org_ID character varying,\n+\t\t\t\tC_Bpartner_ID character varying,\n+\t\t\t\tC_Invoices_Count bigint\n+            )\n+AS\n+\n+$BODY$\n+\n+SELECT DISTINCT org.name as AD_Org_ID,\n+\tbp.name as C_Bpartner_ID,\n+\t(SELECT COUNT(*)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab220c494aff8c44da72f23fad1f00bf88ccb40"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIzMTE3MA==", "bodyText": "Also, filter by inv.DocType IN ('CO', 'CL'), because you don't want drafted or reversed invoices", "url": "https://github.com/metasfresh/metasfresh/pull/6033#discussion_r366231170", "createdAt": "2020-01-14T09:31:06Z", "author": {"login": "metas-ts"}, "path": "de.metas.adempiere.adempiere/migration/src/main/sql/postgresql/ddl/functions/exportSalesInvoicesInDateRange.sql", "diffHunk": "@@ -0,0 +1,38 @@\n+DROP FUNCTION IF EXISTS exportSalesInvoicesInDateRange(TIMESTAMP With Time Zone, TIMESTAMP With Time Zone, numeric);\n+\n+CREATE OR REPLACE FUNCTION exportSalesInvoicesInDateRange(IN p_C_Invoice_dateinvoiced_start TIMESTAMP With Time Zone, \n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_C_Invoice_dateinvoiced_end TIMESTAMP With Time Zone,\n+\t\t\t\t\t\t\t\t\t\t\t\t\t\t  IN p_AD_Org_ID numeric)\n+\n+    RETURNS TABLE\n+            (\n+                AD_Org_ID character varying,\n+\t\t\t\tC_Bpartner_ID character varying,\n+\t\t\t\tC_Invoices_Count bigint\n+            )\n+AS\n+\n+$BODY$\n+\n+SELECT DISTINCT org.name as AD_Org_ID,\n+\tbp.name as C_Bpartner_ID,\n+\t(SELECT COUNT(*)\n+\t FROM   C_Invoice other\n+\t WHERE other.c_bpartner_id = inv.c_bpartner_id\n+ \t AND other.ad_org_id = inv.ad_org_id\n+\t AND other.dateinvoiced >= p_C_Invoice_dateinvoiced_start\n+     AND other.dateinvoiced <= p_C_Invoice_dateinvoiced_end\n+\t)\n+\t AS C_Invoices_Count\n+\t\n+FROM C_Invoice inv\n+\tLEFT OUTER JOIN ad_org org on org.ad_org_id = inv.ad_org_id\n+\tLEFT OUTER JOIN c_bpartner bp on bp.c_bpartner_id = inv.c_bpartner_id\n+WHERE inv.dateinvoiced >= p_C_Invoice_dateinvoiced_start\n+      AND inv.dateinvoiced <= p_C_Invoice_dateinvoiced_end\n+      AND CASE WHEN p_AD_Org_ID > 0 THEN inv.ad_org_id = p_AD_Org_ID ELSE 1 = 1 END", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ab220c494aff8c44da72f23fad1f00bf88ccb40"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdb6258e8f0cf9c9f57debcbf780167b596425b6", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/bdb6258e8f0cf9c9f57debcbf780167b596425b6", "committedDate": "2020-01-14T12:51:51Z", "message": "#3552 Updated Export Function."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e4d142981cc2762a498b129e5026c8cd664dee1", "author": {"user": {"login": "dragospodariu96", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/6e4d142981cc2762a498b129e5026c8cd664dee1", "committedDate": "2020-01-14T12:52:00Z", "message": "Merge branch 'master' into gh3552"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNzAwNjIx", "url": "https://github.com/metasfresh/metasfresh/pull/6033#pullrequestreview-343700621", "createdAt": "2020-01-16T06:45:40Z", "commit": {"oid": "6e4d142981cc2762a498b129e5026c8cd664dee1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3655, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}