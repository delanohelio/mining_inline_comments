{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMDQ4MTY4", "number": 9992, "title": "Create a WidgetWrapper component for fetching data", "bodyText": "Second attempt after doing a thorough manual testing. Related to #9914", "createdAt": "2020-09-22T16:09:39Z", "url": "https://github.com/metasfresh/metasfresh/pull/9992", "merged": true, "mergeCommit": {"oid": "f2fad65a53a6c668c9465bcf7428c7250804a99e"}, "closed": true, "closedAt": "2020-09-28T07:30:06Z", "author": {"login": "siemiatj"}, "timelineItems": {"totalCount": 33, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLGtQiAH2gAyNDkxMDQ4MTY4OjQwYTI1YmQzNjk2MzJmYWQ5OGJlZTBkODZhYzUyMWU0MWJiOWIyMDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdL9Vw5gFqTQ5NTM2MTM0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "40a25bd369632fad98bee0d86ac521e41bb9b200", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/40a25bd369632fad98bee0d86ac521e41bb9b200", "committedDate": "2020-09-21T17:19:16Z", "message": "#9914 basic widgetwrapper container"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aea11530f9c0ae6d2fa28bff541909e82c05046b", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/aea11530f9c0ae6d2fa28bff541909e82c05046b", "committedDate": "2020-09-21T17:19:17Z", "message": "#9914 cleanup window components"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c0392223aac0b58012a620a4c8ad4a02a158f1e", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/9c0392223aac0b58012a620a4c8ad4a02a158f1e", "committedDate": "2020-09-21T17:19:17Z", "message": "#9914 switch to using WidgetWrapper in Header/Element"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c853dc6ba35a09f5101cc6a9601b990ce9997764", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/c853dc6ba35a09f5101cc6a9601b990ce9997764", "committedDate": "2020-09-21T17:19:18Z", "message": "#9914 move some helper functions to utils\n- remove unused code from Lookup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bacfc72a4e5866256bba1401fcbc1c0f51be5046", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/bacfc72a4e5866256bba1401fcbc1c0f51be5046", "committedDate": "2020-09-21T17:19:18Z", "message": "#9914 support getting widget data for tables by WidgetWrapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "806d8584c46468dd8c2adf7c97695baf12db353b", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/806d8584c46468dd8c2adf7c97695baf12db353b", "committedDate": "2020-09-21T17:19:19Z", "message": "#9914 small refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69c0ceb9de50b0b37a05abe6b215369d1f806494", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/69c0ceb9de50b0b37a05abe6b215369d1f806494", "committedDate": "2020-09-21T17:19:19Z", "message": "#9914 support WidgetWrapper in tables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9ca6bba49c3f49b983a5270cfb13c016c44343d", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/a9ca6bba49c3f49b983a5270cfb13c016c44343d", "committedDate": "2020-09-21T17:19:20Z", "message": "#9914 optimize rendering and pass props to query data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11907bd9d9eff40c9ba1ed30c0bf470e8fcd5ca9", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/11907bd9d9eff40c9ba1ed30c0bf470e8fcd5ca9", "committedDate": "2020-09-21T17:19:20Z", "message": "#9914 selectors for data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "079396b25294dec0fc1c0fe64c252cbf79c7f4be", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/079396b25294dec0fc1c0fe64c252cbf79c7f4be", "committedDate": "2020-09-21T17:19:21Z", "message": "#9914 cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c69287bb5ebf07551656d2f4a9326397b81564cb", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/c69287bb5ebf07551656d2f4a9326397b81564cb", "committedDate": "2020-09-21T17:19:22Z", "message": "#9914 create selector for document status widget data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf51deeff3eb421c3eb6cd1d627f30ce276a1960", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/cf51deeff3eb421c3eb6cd1d627f30ce276a1960", "committedDate": "2020-09-21T17:19:22Z", "message": "#9914 cleanup and removing unnecessary props"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43504debe8bd650c265107292b17ed4cd0f2ce2d", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/43504debe8bd650c265107292b17ed4cd0f2ce2d", "committedDate": "2020-09-21T17:19:23Z", "message": "#9914 load fields directly from the store\n- cleaning up MasterWidget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03ec506522a7fa50eacdfc6f0403f6224e71fa2a", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/03ec506522a7fa50eacdfc6f0403f6224e71fa2a", "committedDate": "2020-09-21T17:19:23Z", "message": "#9914 pass missing props to Master/RawWidget where WidgetWrapper is not used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4926610a1b4f311156e465ac5de6d6d14ab24e85", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/4926610a1b4f311156e465ac5de6d6d14ab24e85", "committedDate": "2020-09-21T17:19:23Z", "message": "#9914 temporarily revert RawWidget changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e1ddd8df84b682643e358627af729f3b8f03df4", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/5e1ddd8df84b682643e358627af729f3b8f03df4", "committedDate": "2020-09-21T17:19:24Z", "message": "#9914 fixing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ad00a35886900c2dc9a3cf58d8a0b847516dd4a", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/8ad00a35886900c2dc9a3cf58d8a0b847516dd4a", "committedDate": "2020-09-21T17:19:25Z", "message": "#9914 fix quickinput tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3353287ba6a917651984ed8c2f5a9cc28c625a73", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/3353287ba6a917651984ed8c2f5a9cc28c625a73", "committedDate": "2020-09-21T17:19:26Z", "message": "#9914 rename `TableItem` to `TableRow` everywhere and fix tests\n- change all occurences of `item` related to table to `row`"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fba0ae2b85212ce4c408469e7905573bae32d754", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/fba0ae2b85212ce4c408469e7905573bae32d754", "committedDate": "2020-09-21T17:19:26Z", "message": "#9914 add docs and move some functionality to utils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f0e36742e3d74ac2110140e6e7de349c10998c6", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/3f0e36742e3d74ac2110140e6e7de349c10998c6", "committedDate": "2020-09-21T17:19:26Z", "message": "#9914 add `re-reselect` package"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "108e12a644006d076756ed3d2a30f00937900895", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/108e12a644006d076756ed3d2a30f00937900895", "committedDate": "2020-09-21T17:19:27Z", "message": "#9914 fix linter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3ecd4b2739593ba3ad19e1fc25969686d9332de", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/a3ecd4b2739593ba3ad19e1fc25969686d9332de", "committedDate": "2020-09-21T17:19:27Z", "message": "#9914 fix getting data for ActionButton in the document status widget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cae50c4b184acc60525f79f4061a913f52d17d8", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/8cae50c4b184acc60525f79f4061a913f52d17d8", "committedDate": "2020-09-21T17:19:28Z", "message": "#9914 WidgetWrapper tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d2c860806f322285446f2ebdb8b2c1eb512b29a", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/1d2c860806f322285446f2ebdb8b2c1eb512b29a", "committedDate": "2020-09-21T17:19:28Z", "message": "#9914 more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f83e160aa87470751b0837eb15125d9d5af5356", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/8f83e160aa87470751b0837eb15125d9d5af5356", "committedDate": "2020-09-22T11:16:45Z", "message": "#9914 properly fetch data for widgets in modals"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0fa1d77647f43ba2474b7b79e84e443bf62269d", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/a0fa1d77647f43ba2474b7b79e84e443bf62269d", "committedDate": "2020-09-22T12:59:22Z", "message": "#9914 don't clear the cell value when navigating with tab"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50a5eddb8ecf63801e7409a12a4592c263b056ed", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/50a5eddb8ecf63801e7409a12a4592c263b056ed", "committedDate": "2020-09-22T16:00:21Z", "message": "#9914 properly handle widgets in processes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f11677cc42f7d61cc4fe14d8b33a64088991b6a", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/5f11677cc42f7d61cc4fe14d8b33a64088991b6a", "committedDate": "2020-09-22T16:20:05Z", "message": "#9914 don't edit inactive fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea04dc71e21677d78222b72bd74b6c2714641454", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/ea04dc71e21677d78222b72bd74b6c2714641454", "committedDate": "2020-09-22T17:14:12Z", "message": "#9914 add unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99df550872dfbd1d31a49e94946e26c4e7759a6d", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/99df550872dfbd1d31a49e94946e26c4e7759a6d", "committedDate": "2020-09-23T00:05:48Z", "message": "#9914 fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0Mzk4NzUw", "url": "https://github.com/metasfresh/metasfresh/pull/9992#pullrequestreview-494398750", "createdAt": "2020-09-23T08:01:19Z", "commit": {"oid": "99df550872dfbd1d31a49e94946e26c4e7759a6d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwODowMToxOVrOHWbe2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwODo1OTowOVrOHWe9Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI4MDk4NA==", "bodyText": "name of the file should be WidgetWrapper.test.js", "url": "https://github.com/metasfresh/metasfresh/pull/9992#discussion_r493280984", "createdAt": "2020-09-23T08:01:19Z", "author": {"login": "petrican"}, "path": "frontend/src/__tests__/containers/WidgetWrapper.js", "diffHunk": "@@ -0,0 +1,61 @@\n+import React from 'react';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99df550872dfbd1d31a49e94946e26c4e7759a6d"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI4NjIzNQ==", "bodyText": "element${idx}", "url": "https://github.com/metasfresh/metasfresh/pull/9992#discussion_r493286235", "createdAt": "2020-09-23T08:06:51Z", "author": {"login": "petrican"}, "path": "frontend/src/components/Process.js", "diffHunk": "@@ -22,43 +19,38 @@ class Process extends Component {\n    * @param {*} type\n    * @todo Write the documentation\n    */\n-  renderElements = (layout, data, type) => {\n-    const { disabled } = this.props;\n+  renderElements = () => {\n+    const { layout, type, disabled } = this.props;\n     const elements = layout.elements;\n-    return elements.map((elem, id) => {\n-      const widgetData = elem.fields.map((item) => data[item.field] || -1);\n+\n+    return elements.map((elem, idx) => {\n+      const element = omit(elem, ['fields']);\n       return (\n-        <div key={`${id}-${layout.pinstanceId}`}>\n-          <MasterWidget\n+        <div key={`${idx}-${layout.pinstanceId}`}>\n+          <WidgetWrapper\n+            renderMaster={true}\n+            dataSource=\"process\"\n+            layoutId={`${idx}`}\n             entity=\"process\"\n-            key={'element' + id}\n-            windowType={type}\n+            key={'element' + idx}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99df550872dfbd1d31a49e94946e26c4e7759a6d"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMyNjM5OA==", "bodyText": "!==", "url": "https://github.com/metasfresh/metasfresh/pull/9992#discussion_r493326398", "createdAt": "2020-09-23T08:47:55Z", "author": {"login": "petrican"}, "path": "frontend/src/components/widget/RawWidget.js", "diffHunk": "@@ -449,19 +454,19 @@ export class RawWidget extends Component {\n       updateHeight,\n       rowIndex,\n     } = this.props;\n-    let widgetValue = data != null ? data : widgetData[0].value;\n+    let tabIndex = this.props.tabIndex;\n     const { isEdited, charsTyped } = this.state;\n \n+    let widgetValue = data != null ? data : widgetData[0].value;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99df550872dfbd1d31a49e94946e26c4e7759a6d"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMyOTkxOQ==", "bodyText": "wonder if wouldn't be practical to have a function that would format that like getLayoutId({ sectionIndex, columnIndex....aso})\nSimilar to what we have for the table -> getTableId", "url": "https://github.com/metasfresh/metasfresh/pull/9992#discussion_r493329919", "createdAt": "2020-09-23T08:51:30Z", "author": {"login": "petrican"}, "path": "frontend/src/components/window/Element.js", "diffHunk": "@@ -1,42 +1,57 @@\n import React, { PureComponent } from 'react';\n import PropTypes from 'prop-types';\n-import MasterWidget from '../widget/MasterWidget';\n+import { omit } from 'lodash';\n+\n+import WidgetWrapper from '../../containers/WidgetWrapper';\n \n class Element extends PureComponent {\n   render() {\n-    const { windowId, tabId, rowId, dataId } = this.props;\n-    const { elementLayout, elementIndex } = this.props;\n-    const { isFocused, tabIndex } = this.props;\n-    const { data } = this.props;\n-    const { isModal, isAdvanced, isFullScreen } = this.props;\n-    const { addRefToWidgets, onBlurWidget } = this.props;\n+    const {\n+      windowId,\n+      tabId,\n+      rowId,\n+      dataId,\n+      elementLayout,\n+      isFocused,\n+      tabIndex,\n+      isModal,\n+      isAdvanced,\n+      isFullScreen,\n+      addRefToWidgets,\n+      onBlurWidget,\n+      elementIndex,\n+      elementsLineIndex,\n+      elementGroupIndex,\n+      sectionIndex,\n+      columnIndex,\n+    } = this.props;\n \n     const autoFocus = isFocused && elementIndex === 0;\n-    const widgetData = elementLayout.fields.map(\n-      (item) => data[item.field] || -1\n-    );\n     const fieldName = elementLayout.fields ? elementLayout.fields[0].field : '';\n-    const relativeDocId = data.ID && data.ID.value;\n+    const layoutId = `${sectionIndex}_${columnIndex}_${elementGroupIndex}_${elementsLineIndex}_${elementIndex}`;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99df550872dfbd1d31a49e94946e26c4e7759a6d"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMzNzAwMw==", "bodyText": "thinking if getWidgetElementData wouldn't be more appropriate as a name", "url": "https://github.com/metasfresh/metasfresh/pull/9992#discussion_r493337003", "createdAt": "2020-09-23T08:58:15Z", "author": {"login": "petrican"}, "path": "frontend/src/containers/WidgetWrapper.js", "diffHunk": "@@ -0,0 +1,153 @@\n+import React, { PureComponent } from 'react';\n+import PropTypes from 'prop-types';\n+import { connect } from 'react-redux';\n+\n+import {\n+  openModal,\n+  patch,\n+  updatePropertyValue,\n+  allowShortcut,\n+  disableShortcut,\n+} from '../actions/WindowActions';\n+import { getCellWidgetData } from '../utils/tableHelpers';\n+import { getTable } from '../reducers/tables';\n+import {\n+  getData,\n+  getWidgetData,\n+  getWidgetFields,\n+  getMasterDocStatus,\n+  getProcessWidgetData,\n+  getProcessWidgetFields,\n+} from '../reducers/windowHandler';\n+\n+import MasterWidget from '../components/widget/MasterWidget';\n+import RawWidget from '../components/widget/RawWidget';\n+\n+/**\n+ * @file Class based component.\n+ * @module WidgetWrapper\n+ * @extends PureComponent\n+ * @summary this is a wrapper around widgets that's responsible for\n+ * fetching data to the component. Depending on the `dataSource` prop it\n+ * has a selection of strategies to get the data from the redux store. No\n+ * `MasterWidget` or `RawWidget` component should be rendered directly - always\n+ * wrap them in `WidgetWrapper` and if needed add another data selector.\n+ */\n+class WidgetWrapper extends PureComponent {\n+  render() {\n+    const { renderMaster } = this.props;\n+\n+    if (renderMaster) {\n+      return <MasterWidget {...this.props} />;\n+    } else {\n+      return <RawWidget {...this.props} />;\n+    }\n+  }\n+}\n+\n+const mapStateToProps = (state, props) => {\n+  const { appHandler, windowHandler } = state;\n+  const {\n+    dataSource,\n+    tableId,\n+    rowIndex,\n+    colIndex,\n+    isEditable,\n+    supportFieldEdit,\n+    layoutId,\n+    fields,\n+    isModal,\n+  } = props;\n+  const data = getData(state, isModal);\n+\n+  let widgetData = null;\n+  let fieldsCopy = null;\n+\n+  switch (dataSource) {\n+    case 'doc-status':\n+      widgetData = getMasterDocStatus(state);\n+\n+      break;\n+    case 'modal':\n+    case 'element':\n+      widgetData = getWidgetData(state, isModal, layoutId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99df550872dfbd1d31a49e94946e26c4e7759a6d"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMzNzg3NA==", "bodyText": "Same in here for coherence of naming getWidgetProcessData, getWidgetProcessFields", "url": "https://github.com/metasfresh/metasfresh/pull/9992#discussion_r493337874", "createdAt": "2020-09-23T08:59:09Z", "author": {"login": "petrican"}, "path": "frontend/src/containers/WidgetWrapper.js", "diffHunk": "@@ -0,0 +1,153 @@\n+import React, { PureComponent } from 'react';\n+import PropTypes from 'prop-types';\n+import { connect } from 'react-redux';\n+\n+import {\n+  openModal,\n+  patch,\n+  updatePropertyValue,\n+  allowShortcut,\n+  disableShortcut,\n+} from '../actions/WindowActions';\n+import { getCellWidgetData } from '../utils/tableHelpers';\n+import { getTable } from '../reducers/tables';\n+import {\n+  getData,\n+  getWidgetData,\n+  getWidgetFields,\n+  getMasterDocStatus,\n+  getProcessWidgetData,\n+  getProcessWidgetFields,\n+} from '../reducers/windowHandler';\n+\n+import MasterWidget from '../components/widget/MasterWidget';\n+import RawWidget from '../components/widget/RawWidget';\n+\n+/**\n+ * @file Class based component.\n+ * @module WidgetWrapper\n+ * @extends PureComponent\n+ * @summary this is a wrapper around widgets that's responsible for\n+ * fetching data to the component. Depending on the `dataSource` prop it\n+ * has a selection of strategies to get the data from the redux store. No\n+ * `MasterWidget` or `RawWidget` component should be rendered directly - always\n+ * wrap them in `WidgetWrapper` and if needed add another data selector.\n+ */\n+class WidgetWrapper extends PureComponent {\n+  render() {\n+    const { renderMaster } = this.props;\n+\n+    if (renderMaster) {\n+      return <MasterWidget {...this.props} />;\n+    } else {\n+      return <RawWidget {...this.props} />;\n+    }\n+  }\n+}\n+\n+const mapStateToProps = (state, props) => {\n+  const { appHandler, windowHandler } = state;\n+  const {\n+    dataSource,\n+    tableId,\n+    rowIndex,\n+    colIndex,\n+    isEditable,\n+    supportFieldEdit,\n+    layoutId,\n+    fields,\n+    isModal,\n+  } = props;\n+  const data = getData(state, isModal);\n+\n+  let widgetData = null;\n+  let fieldsCopy = null;\n+\n+  switch (dataSource) {\n+    case 'doc-status':\n+      widgetData = getMasterDocStatus(state);\n+\n+      break;\n+    case 'modal':\n+    case 'element':\n+      widgetData = getWidgetData(state, isModal, layoutId);\n+      fieldsCopy = getWidgetFields(state, isModal, layoutId);\n+\n+      break;\n+    case 'process':\n+      widgetData = getProcessWidgetData(state, true, layoutId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99df550872dfbd1d31a49e94946e26c4e7759a6d"}, "originalPosition": 78}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82e4cff21d57e1413ff726cef564f4262cfca46f", "author": {"user": {"login": "siemiatj", "name": "Kuba Siemi\u0105tkowski"}}, "url": "https://github.com/metasfresh/metasfresh/commit/82e4cff21d57e1413ff726cef564f4262cfca46f", "committedDate": "2020-09-23T09:39:24Z", "message": "#9914 grooming after PR review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MzYxMzQ2", "url": "https://github.com/metasfresh/metasfresh/pull/9992#pullrequestreview-495361346", "createdAt": "2020-09-24T08:58:23Z", "commit": {"oid": "82e4cff21d57e1413ff726cef564f4262cfca46f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3198, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}