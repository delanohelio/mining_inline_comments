{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2Mjc0MDU0", "number": 6772, "reviewThreads": {"totalCount": 35, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwOTo1MDo1MVrOEBrLZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzo1NTowNFrOEEsgUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMTkxNDYzOnYy", "diffSide": "RIGHT", "path": "frontend/src/components/app/DocumentList.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwOTo1MDo1MVrOGdqZdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwNzo0MDo1NVrOGe5lOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc1NjUzMg==", "bodyText": "Is there a reason why we need the these passed ? AFAIs the FiltersStatic component it needs passed data and clearFitlers. https://github.com/metasfresh/metasfresh/blob/master/frontend/src/components/filters/FiltersStatic.js", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r433756532", "createdAt": "2020-06-02T09:50:51Z", "author": {"login": "petrican"}, "path": "frontend/src/components/app/DocumentList.js", "diffHunk": "@@ -236,20 +249,21 @@ export default class DocumentList extends Component {\n               {layout.filters && (\n                 <Filters\n                   {...{\n-                    windowType,\n                     viewId,\n                     filtersActive,\n                     initialValuesNulled,\n                   }}\n+                  windowType={windowId}\n                   filterData={filtersToMap(layout.filters)}\n                   updateDocList={onFilterChange}\n                   resetInitialValues={onResetInitialFilters}\n                 />\n               )}\n \n-              {rowData && staticFilters && (\n+              {staticFilters && (\n                 <FiltersStatic\n-                  {...{ windowType, viewId }}\n+                  {...{ viewId }}\n+                  windowType={windowId}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c742b186edba764121249b0e2839f9e02537334c"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTA1Mzg4Mg==", "bodyText": "It's not something I'm focusing on in this effort, but you're right.", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r435053882", "createdAt": "2020-06-04T07:40:55Z", "author": {"login": "siemiatj"}, "path": "frontend/src/components/app/DocumentList.js", "diffHunk": "@@ -236,20 +249,21 @@ export default class DocumentList extends Component {\n               {layout.filters && (\n                 <Filters\n                   {...{\n-                    windowType,\n                     viewId,\n                     filtersActive,\n                     initialValuesNulled,\n                   }}\n+                  windowType={windowId}\n                   filterData={filtersToMap(layout.filters)}\n                   updateDocList={onFilterChange}\n                   resetInitialValues={onResetInitialFilters}\n                 />\n               )}\n \n-              {rowData && staticFilters && (\n+              {staticFilters && (\n                 <FiltersStatic\n-                  {...{ windowType, viewId }}\n+                  {...{ viewId }}\n+                  windowType={windowId}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc1NjUzMg=="}, "originalCommit": {"oid": "c742b186edba764121249b0e2839f9e02537334c"}, "originalPosition": 155}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMTk0NjUzOnYy", "diffSide": "RIGHT", "path": "frontend/src/containers/Table.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMDowMDoxOFrOGdquGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMDowMDoxOFrOGdquGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc2MTgxNw==", "bodyText": "can't we replace this with an action and hold it in the redux data and ditch component state?", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r433761817", "createdAt": "2020-06-02T10:00:18Z", "author": {"login": "petrican"}, "path": "frontend/src/containers/Table.js", "diffHunk": "@@ -0,0 +1,324 @@\n+import update from 'immutability-helper';\n+import React, { PureComponent } from 'react';\n+import { connect } from 'react-redux';\n+\n+import { getZoomIntoWindow, deleteRequest } from '../api';\n+import { getTableId, getTable } from '../reducers/tables';\n+\n+import {\n+  updateTableSelection,\n+  deselectTableItems,\n+  collapseTableRow,\n+} from '../actions/TableActions';\n+import { deleteLocal, openModal } from '../actions/WindowActions';\n+\n+import { containerPropTypes } from '../utils/tableHelpers';\n+import { mapIncluded } from '../utils/documentListHelper';\n+\n+import Table from '../components/table/Table';\n+\n+class TableContainer extends PureComponent {\n+  constructor(props) {\n+    super(props);\n+\n+    this.state = {};\n+    this._isMounted = false;\n+  }\n+\n+  componentDidMount() {\n+    this._isMounted = true;\n+  }\n+\n+  componentDidUpdate(prevProps) {\n+    const { mainTable, open, rows } = this.props;\n+\n+    if (rows.length && prevProps.rows.length === 0) {\n+      document.getElementsByClassName('js-table')[0].focus();\n+\n+      setTimeout(() => {\n+        if (this._isMounted) {\n+          // TODO: Figure a better way to do this https://github.com/metasfresh/metasfresh/issues/1679\n+          this.setState({", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c742b186edba764121249b0e2839f9e02537334c"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMjIzOTY5OnYy", "diffSide": "RIGHT", "path": "frontend/src/components/table/Table.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMTozNjowNVrOGdtokA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxMTozNjowNVrOGdtokA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzgwOTU1Mg==", "bodyText": "I dont understand why are we still using local component state for the table", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r433809552", "createdAt": "2020-06-02T11:36:05Z", "author": {"login": "petrican"}, "path": "frontend/src/components/table/Table.js", "diffHunk": "@@ -57,500 +34,141 @@ class Table extends Component {\n   }\n \n   componentDidMount() {\n-    const { rowData, tabId } = this.props;\n-    //selecting first table elem while getting indent data\n-    this._isMounted = true;\n-\n-    if (rowData.get(`${tabId}`)) {\n-      this.getIndentData(true);\n-    }\n     if (this.props.autofocus) {\n       this.table.focus();\n     }\n   }\n \n-  UNSAFE_componentWillReceiveProps(nextProps) {\n-    if (this.state.rows.length && !nextProps.cols) {\n-      this.setState({ rows: [] });\n-    }\n-  }\n-\n-  componentDidUpdate(prevProps, prevState) {\n-    const {\n-      dispatch,\n-      mainTable,\n-      open,\n-      rowData,\n-      defaultSelected,\n-      disconnectFromState,\n-      windowId,\n-      refreshSelection,\n-      openIncludedViewOnSelect,\n-      viewId,\n-      tabId,\n-      isModal,\n-      hasIncluded,\n-      page,\n-    } = this.props;\n-    const { selected, rows } = this.state;\n-\n-    /**\n-     * Selection by default of first row if nothing selected\n-     */\n-    if (\n-      (_.isEmpty(defaultSelected) || _.isEmpty(selected)) &&\n-      selected[0] === undefined &&\n-      !_.isEmpty(rows)\n-    ) {\n-      this.setState({ selected: [rows[0].id] });\n-      dispatch(\n-        updateTableSelection({\n-          tableId: getTableId({ windowType: windowId, viewId }),\n-          ids: [rows[0].id],\n-        })\n-      );\n-      dispatch(\n-        selectTableItems({\n-          windowType: windowId,\n-          viewId,\n-          ids: selected,\n-        })\n-      );\n-    } // end of selection for the first row if nothing selected\n-\n-    const selectedEqual = _.isEqual(prevState.selected, selected);\n-    const defaultSelectedEqual = _.isEqual(\n-      prevProps.defaultSelected,\n-      defaultSelected\n-    );\n-\n-    if (!this._isMounted) {\n-      return;\n-    }\n-\n-    if (rows && !_.isEqual(prevState.rows, rows)) {\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-\n-      if (isModal && !hasIncluded) {\n-        let firstRow = rows[0];\n-\n-        if (firstRow) {\n-          if (openIncludedViewOnSelect) {\n-            this.showSelectedIncludedView([firstRow.id]);\n-          }\n-\n-          if (firstRow.id && !selectedEqual) {\n-            this.selectOneProduct(firstRow.id);\n-          }\n-        }\n-      }\n-    } else if (page !== prevProps.page) {\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-    }\n-\n-    if (mainTable && open) {\n-      this.table.focus();\n-    }\n-\n-    if (\n-      (!defaultSelectedEqual && !selectedEqual) ||\n-      (refreshSelection && prevProps.refreshSelection !== refreshSelection)\n-    ) {\n-      this.setState({\n-        selected:\n-          defaultSelected && defaultSelected !== null ? defaultSelected : [],\n-      });\n-    } else if (!disconnectFromState && !selectedEqual && selected.length) {\n-      dispatch(\n-        updateTableSelection({\n-          tableId: getTableId({ windowType: windowId, viewId }),\n-          ids: selected,\n-        })\n-      );\n-      dispatch(\n-        selectTableItems({\n-          windowType: windowId,\n-          viewId,\n-          ids: selected,\n-        })\n-      );\n-    }\n-\n-    if (prevProps.viewId !== viewId && rowData.get(`${tabId}`)) {\n-      if (defaultSelected && defaultSelected.length === 0) {\n-        this.setState({ selected: [] });\n-      }\n-\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-\n-      const firstLoad =\n-        prevProps.rowData.get(`${tabId}`) &&\n-        prevProps.rowData.get(`${tabId}`).size &&\n-        rowData.get(`${tabId}`).size\n-          ? false\n-          : true;\n-\n-      this.getIndentData(firstLoad);\n-    } else if (rowData.get(`${tabId}`) && !is(prevProps.rowData, rowData)) {\n-      let firstLoad = rowData.get(`${tabId}`).size ? false : true;\n-\n-      if (\n-        prevProps.rowData.get(`${tabId}`) &&\n-        !prevProps.rowData.get(`${tabId}`).size &&\n-        rowData.get(`${tabId}`).size\n-      ) {\n-        firstLoad = true;\n-      }\n-\n-      this.getIndentData(firstLoad);\n-    }\n-  }\n-\n-  componentWillUnmount() {\n-    const {\n-      showIncludedViewOnSelect,\n-      viewId,\n-      windowType,\n-      isIncluded,\n-    } = this.props;\n-\n-    this._isMounted = false;\n-\n-    this.deselectAllProducts();\n-    if (showIncludedViewOnSelect && !isIncluded) {\n-      showIncludedViewOnSelect({\n-        showIncludedView: false,\n-        windowType,\n-        viewId,\n-      });\n-    }\n-  }\n-\n-  showSelectedIncludedView = (selected) => {\n-    const { showIncludedViewOnSelect, openIncludedViewOnSelect } = this.props;\n-    const { rows } = this.state;\n-\n-    if (openIncludedViewOnSelect && selected.length === 1) {\n-      rows.forEach((item) => {\n-        if (item.id === selected[0]) {\n-          showIncludedViewOnSelect({\n-            showIncludedView: item.supportIncludedViews,\n-            windowType: item.supportIncludedViews\n-              ? item.includedView.windowType || item.includedView.windowId\n-              : null,\n-            viewId: item.supportIncludedViews ? item.includedView.viewId : '',\n-          });\n-        }\n-      });\n-    }\n+  setListenTrue = () => {\n+    this.setState({ listenOnKeys: true });\n   };\n \n-  getIndentData = (selectFirst) => {\n-    const {\n-      rowData,\n-      tabId,\n-      indentSupported,\n-      collapsible,\n-      expandedDepth,\n-      keyProperty,\n-    } = this.props;\n-    const { selected } = this.state;\n-    let rowsData = [];\n-\n-    if (indentSupported && rowData.get(`${tabId}`).size) {\n-      rowsData = getRowsData(rowData.get(`${tabId}`));\n-\n-      let stateChange = {\n-        rows: rowsData,\n-        pendingInit: !rowsData,\n-      };\n-\n-      if (selectFirst) {\n-        stateChange = {\n-          ...stateChange,\n-          collapsedParentsRows: [],\n-          collapsedRows: [],\n-        };\n-      }\n-\n-      this.setState(stateChange, () => {\n-        const { rows } = this.state;\n-        const firstRow = rows[0];\n-\n-        let updatedParentsRows = [...this.state.collapsedParentsRows];\n-        let updatedRows = [...this.state.collapsedRows];\n+  setListenFalse = () => {\n+    this.setState({ listenOnKeys: false });\n+  };\n \n-        if (firstRow && selectFirst) {\n-          let selectedIndex = 0;\n-          if (\n-            selected &&\n-            selected.length === 1 &&\n-            selected[0] &&\n-            firstRow.id !== selected[0]\n-          ) {\n-            selectedIndex = _.findIndex(rows, (row) => row.id === selected[0]);\n-          }\n+  closeContextMenu = () => {\n+    this.setState({\n+      contextMenu: Object.assign({}, this.state.contextMenu, {\n+        open: false,\n+      }),\n+    });\n+  };\n \n-          if (!selectedIndex) {\n-            this.selectOneProduct(rows[0].id);\n-          }\n+  handleSelect = (id, idFocused, idFocusedDown, cb) => {\n+    const { onSelect } = this.props;\n \n-          document.getElementsByClassName('js-table')[0].focus();\n-        }\n+    onSelect(id, idFocused, idFocusedDown, cb);\n \n-        let mapCollapsed = [];\n+    this.triggerFocus(idFocused, idFocusedDown);\n+  };\n \n-        if (collapsible && rows && rows.length) {\n-          rows.map((row) => {\n-            if (row.indent.length >= expandedDepth && row.includedDocuments) {\n-              mapCollapsed = mapCollapsed.concat(collapsedMap(row));\n-              updatedParentsRows = updatedParentsRows.concat(row[keyProperty]);\n-            }\n-            if (row.indent.length > expandedDepth) {\n-              updatedRows = updatedRows.concat(row[keyProperty]);\n-            }\n-          });\n+  setContextMenu = (\n+    clientX,\n+    clientY,\n+    fieldName,\n+    supportZoomInto,\n+    supportFieldEdit\n+  ) => {\n+    this.setState({", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6133d67b73d637dcb249f470219bba2d96f22e72"}, "originalPosition": 342}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTEyOTU0OnYy", "diffSide": "RIGHT", "path": "frontend/src/__tests__/reducers/WindowHandler.test.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjoyMzozMlrOGhyRCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMDo0Mzo0MFrOGi_d0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA3OTc1NQ==", "bodyText": "We should add some tests separately specific for the Tabs in a separate file wdyt ?", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438079755", "createdAt": "2020-06-10T12:23:32Z", "author": {"login": "petrican"}, "path": "frontend/src/__tests__/reducers/WindowHandler.test.js", "diffHunk": "@@ -67,63 +67,5 @@ describe('WindowHandler reducer', () => {\n       expect(state).toEqual(expect.objectContaining({ master: expect.objectContaining({ data: { ...data.data } }) }));\n     });\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0c41d39a688625fb2630a9d0f044e8272025ced"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM0NDU5Mw==", "bodyText": "Probably, but for sure not as part of this effort. And Window/MasterWindow/Tabs could need their own refactorings too.", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r439344593", "createdAt": "2020-06-12T10:43:40Z", "author": {"login": "siemiatj"}, "path": "frontend/src/__tests__/reducers/WindowHandler.test.js", "diffHunk": "@@ -67,63 +67,5 @@ describe('WindowHandler reducer', () => {\n       expect(state).toEqual(expect.objectContaining({ master: expect.objectContaining({ data: { ...data.data } }) }));\n     });\n ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA3OTc1NQ=="}, "originalCommit": {"oid": "f0c41d39a688625fb2630a9d0f044e8272025ced"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTE1MjU3OnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/TableActions.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjoyOTo0MVrOGhyfKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjoyOTo0MVrOGhyfKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA4MzM3MQ==", "bodyText": "Pls document a bit more this also each parameter following the pattern we use for the others\n`/**\n\n@method updateTableData\n@summary Summary\n...params\n*/`", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438083371", "createdAt": "2020-06-10T12:29:41Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/TableActions.js", "diffHunk": "@@ -38,26 +39,81 @@ export function deleteTable(id) {\n   };\n }\n \n-// TODO: Legacy version. Remove once we switch to rendering tables from redux\n-export function setActiveSort(data) {\n+/**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTE1ODcyOnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/TableActions.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjozMToyMFrOGhyi0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjozMToyMFrOGhyi0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA4NDMwNQ==", "bodyText": "Doc here pls", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438084305", "createdAt": "2020-06-10T12:31:20Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/TableActions.js", "diffHunk": "@@ -38,26 +39,81 @@ export function deleteTable(id) {\n   };\n }\n \n-// TODO: Legacy version. Remove once we switch to rendering tables from redux\n-export function setActiveSort(data) {\n+/**\n+ * Update table rows\n+ */\n+function updateTableData(id, rows, keyProperty) {\n   return {\n-    type: types.SET_ACTIVE_SORT,\n-    payload: data,\n+    type: types.UPDATE_TABLE_DATA,\n+    payload: { id, rows, keyProperty },\n   };\n }\n \n /**\n- * @method setActiveSortNEW\n+ * @method setActiveSort\n  * @summary Change the value of the `activeSort` setting for specified table\n  * @todo rename to `setActiveSort` once we switch to tables driven by redux\n  */\n-export function setActiveSortNEW(id, active) {\n+export function setActiveSort(id, active) {\n   return {\n-    type: types.SET_ACTIVE_SORT_NEW,\n+    type: types.SET_ACTIVE_SORT,\n     payload: { id, active },\n   };\n }\n \n+/**\n+ * Update table selection - select items\n+ */\n+export function updateTableSelection(id, selection, keyProperty = 'id') {\n+  return {\n+    type: types.UPDATE_TABLE_SELECTION,\n+    payload: { id, selection, keyProperty },\n+  };\n+}\n+\n+/**\n+ * Update table selection - deselect items or deselect all if an empty `ids`\n+ * array is provided\n+ */\n+export function deselectTableItems(id, selection) {\n+  return {\n+    type: types.DESELECT_TABLE_ITEMS,\n+    payload: { id, selection },\n+  };\n+}\n+\n+/**\n+ * Toggle table rows\n+ */\n+function collapseRows({\n+  tableId,\n+  collapsedParentRows,\n+  collapsedRows,\n+  collapsedArrayMap,\n+}) {\n+  return {\n+    type: types.COLLAPSE_TABLE_ROWS,\n+    payload: {\n+      id: tableId,\n+      collapsedParentRows,\n+      collapsedRows,\n+      collapsedArrayMap,\n+    },\n+  };\n+}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTE2MTUyOnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/TableActions.js", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjozMjowN1rOGhykmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNTo1MTowMVrOGiPXlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA4NDc2MQ==", "bodyText": "Document using pattern we have across the app + params pls. For both the top function and the one below. Thanks", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438084761", "createdAt": "2020-06-10T12:32:07Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/TableActions.js", "diffHunk": "@@ -38,26 +39,81 @@ export function deleteTable(id) {\n   };\n }\n \n-// TODO: Legacy version. Remove once we switch to rendering tables from redux\n-export function setActiveSort(data) {\n+/**\n+ * Update table rows\n+ */\n+function updateTableData(id, rows, keyProperty) {\n   return {\n-    type: types.SET_ACTIVE_SORT,\n-    payload: data,\n+    type: types.UPDATE_TABLE_DATA,\n+    payload: { id, rows, keyProperty },\n   };\n }\n \n /**\n- * @method setActiveSortNEW\n+ * @method setActiveSort\n  * @summary Change the value of the `activeSort` setting for specified table\n  * @todo rename to `setActiveSort` once we switch to tables driven by redux\n  */\n-export function setActiveSortNEW(id, active) {\n+export function setActiveSort(id, active) {\n   return {\n-    type: types.SET_ACTIVE_SORT_NEW,\n+    type: types.SET_ACTIVE_SORT,\n     payload: { id, active },\n   };\n }\n \n+/**\n+ * Update table selection - select items\n+ */\n+export function updateTableSelection(id, selection, keyProperty = 'id') {\n+  return {\n+    type: types.UPDATE_TABLE_SELECTION,\n+    payload: { id, selection, keyProperty },\n+  };\n+}\n+\n+/**\n+ * Update table selection - deselect items or deselect all if an empty `ids`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxNjQ3OQ==", "bodyText": "You are aware, that you've created the updateTableSelection function, right ?", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438216479", "createdAt": "2020-06-10T15:32:34Z", "author": {"login": "siemiatj"}, "path": "frontend/src/actions/TableActions.js", "diffHunk": "@@ -38,26 +39,81 @@ export function deleteTable(id) {\n   };\n }\n \n-// TODO: Legacy version. Remove once we switch to rendering tables from redux\n-export function setActiveSort(data) {\n+/**\n+ * Update table rows\n+ */\n+function updateTableData(id, rows, keyProperty) {\n   return {\n-    type: types.SET_ACTIVE_SORT,\n-    payload: data,\n+    type: types.UPDATE_TABLE_DATA,\n+    payload: { id, rows, keyProperty },\n   };\n }\n \n /**\n- * @method setActiveSortNEW\n+ * @method setActiveSort\n  * @summary Change the value of the `activeSort` setting for specified table\n  * @todo rename to `setActiveSort` once we switch to tables driven by redux\n  */\n-export function setActiveSortNEW(id, active) {\n+export function setActiveSort(id, active) {\n   return {\n-    type: types.SET_ACTIVE_SORT_NEW,\n+    type: types.SET_ACTIVE_SORT,\n     payload: { id, active },\n   };\n }\n \n+/**\n+ * Update table selection - select items\n+ */\n+export function updateTableSelection(id, selection, keyProperty = 'id') {\n+  return {\n+    type: types.UPDATE_TABLE_SELECTION,\n+    payload: { id, selection, keyProperty },\n+  };\n+}\n+\n+/**\n+ * Update table selection - deselect items or deselect all if an empty `ids`", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA4NDc2MQ=="}, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU1NjU2NA==", "bodyText": "Yes. I should have document that. My bad.", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438556564", "createdAt": "2020-06-11T05:51:01Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/TableActions.js", "diffHunk": "@@ -38,26 +39,81 @@ export function deleteTable(id) {\n   };\n }\n \n-// TODO: Legacy version. Remove once we switch to rendering tables from redux\n-export function setActiveSort(data) {\n+/**\n+ * Update table rows\n+ */\n+function updateTableData(id, rows, keyProperty) {\n   return {\n-    type: types.SET_ACTIVE_SORT,\n-    payload: data,\n+    type: types.UPDATE_TABLE_DATA,\n+    payload: { id, rows, keyProperty },\n   };\n }\n \n /**\n- * @method setActiveSortNEW\n+ * @method setActiveSort\n  * @summary Change the value of the `activeSort` setting for specified table\n  * @todo rename to `setActiveSort` once we switch to tables driven by redux\n  */\n-export function setActiveSortNEW(id, active) {\n+export function setActiveSort(id, active) {\n   return {\n-    type: types.SET_ACTIVE_SORT_NEW,\n+    type: types.SET_ACTIVE_SORT,\n     payload: { id, active },\n   };\n }\n \n+/**\n+ * Update table selection - select items\n+ */\n+export function updateTableSelection(id, selection, keyProperty = 'id') {\n+  return {\n+    type: types.UPDATE_TABLE_SELECTION,\n+    payload: { id, selection, keyProperty },\n+  };\n+}\n+\n+/**\n+ * Update table selection - deselect items or deselect all if an empty `ids`", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA4NDc2MQ=="}, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTE3MjY4OnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/TableActions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjozNTozM1rOGhyrbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjozNTozM1rOGhyrbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA4NjUxMA==", "bodyText": "@teosarca can you please make some light in here ? Which should we support ? Ty", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438086510", "createdAt": "2020-06-10T12:35:33Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/TableActions.js", "diffHunk": "@@ -99,6 +144,11 @@ export function createTableData(rawData) {\n     defaultOrderBys: rawData.defaultOrderBys\n       ? rawData.defaultOrderBys\n       : undefined,\n+    expandedDepth: rawData.expandedDepth,\n+\n+    // TODO: We have both `supportTree` and `collapsible` in the layout response.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 149}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTE4MjAxOnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/TableActions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjozODowN1rOGhyxHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjozODowN1rOGhyxHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA4Nzk2NQ==", "bodyText": "add params to the desc", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438087965", "createdAt": "2020-06-10T12:38:07Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/TableActions.js", "diffHunk": "@@ -139,26 +200,103 @@ export function updateGridTable(tableId, tableResponse) {\n   return (dispatch, getState) => {\n     const state = getState();\n \n+    // this check is only for unit tests purposes\n     if (state.tables) {\n       const tableExists = state.tables[tableId];\n \n       if (tableExists) {\n         const tableData = createTableData({\n           ...tableResponse,\n           headerElements: tableResponse.columnsByFieldName,\n+          keyProperty: 'id',\n         });\n+        const { collapsible, expandedDepth } = tableExists;\n+        const { keyProperty } = tableData;\n+\n+        // Parse `rows` to add `indent` property\n+        if (tableData.rows.length && tableData.rows.length && collapsible) {\n+          tableData.rows = flattenRows(tableData.rows);\n+        }\n \n         dispatch(updateTable(tableId, tableData));\n+\n+        if (collapsible) {\n+          dispatch(\n+            createCollapsedRows({\n+              tableId,\n+              rows: tableData.rows,\n+              collapsible,\n+              expandedDepth,\n+              keyProperty,\n+            })\n+          );\n+        }\n+\n+        return Promise.resolve(true);\n       } else {\n         const windowType = tableResponse.windowType || tableResponse.windowId;\n         const tableLayout = getView(getState(), windowType).layout;\n         const tableData = createTableData({\n           ...tableResponse,\n           ...tableLayout,\n           headerElements: tableResponse.columnsByFieldName,\n+          keyProperty: 'id',\n         });\n+        const { collapsible, expandedDepth, keyProperty } = tableData;\n+\n+        if (tableData.rows && tableData.rows.length && collapsible) {\n+          tableData.rows = flattenRows(tableData.rows);\n+        }\n \n         dispatch(createTable(tableId, tableData));\n+\n+        if (collapsible) {\n+          dispatch(\n+            createCollapsedRows({\n+              tableId,\n+              rows: tableData.rows,\n+              collapsible,\n+              expandedDepth,\n+              keyProperty,\n+            })\n+          );\n+        }\n+\n+        return Promise.resolve(true);\n+      }\n+    }\n+\n+    return Promise.resolve(false);\n+  };\n+}\n+\n+/*\n+ * Update `tableId` rows and rebuild collapsed rows if necessary", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 254}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTE4NDkxOnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/TableActions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjozODo1M1rOGhyyyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjozODo1M1rOGhyyyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA4ODM5NA==", "bodyText": "Doc params", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438088394", "createdAt": "2020-06-10T12:38:53Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/TableActions.js", "diffHunk": "@@ -205,12 +352,124 @@ export function updateTabTable(tableId, tableResponse) {\n   };\n }\n \n-/**\n- * Update table selection - select items\n+/*\n+ * Update `tableId` rows for tab table/details view", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 317}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTE5MTc1OnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/TableActions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo0MDo0MVrOGhy3Aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo0MDo0MVrOGhy3Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA4OTQ3NQ==", "bodyText": "Doc pls", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438089475", "createdAt": "2020-06-10T12:40:41Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/TableActions.js", "diffHunk": "@@ -205,12 +352,124 @@ export function updateTabTable(tableId, tableResponse) {\n   };\n }\n \n-/**\n- * Update table selection - select items\n+/*\n+ * Update `tableId` rows for tab table/details view\n  */\n-export function updateTableSelection({ tableId, ids }) {\n-  return {\n-    type: UPDATE_TABLE_SELECTION,\n-    payload: { tableId, selection: ids },\n+export function updateTabTableData(tableId, rows) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 323}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTE5Mjk3OnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/TableActions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo0MTowMFrOGhy3xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo0MTowMFrOGhy3xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA4OTY3MQ==", "bodyText": "Doc pls + params", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438089671", "createdAt": "2020-06-10T12:41:00Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/TableActions.js", "diffHunk": "@@ -205,12 +352,124 @@ export function updateTabTable(tableId, tableResponse) {\n   };\n }\n \n-/**\n- * Update table selection - select items\n+/*\n+ * Update `tableId` rows for tab table/details view\n  */\n-export function updateTableSelection({ tableId, ids }) {\n-  return {\n-    type: UPDATE_TABLE_SELECTION,\n-    payload: { tableId, selection: ids },\n+export function updateTabTableData(tableId, rows) {\n+  return (dispatch, getState) => {\n+    const state = getState();\n+\n+    if (state.tables) {\n+      const table = getTable(state, tableId);\n+      const { keyProperty } = table;\n+\n+      dispatch(updateTableData(tableId, rows, keyProperty));\n+\n+      return Promise.resolve(true);\n+    }\n+\n+    return Promise.resolve(false);\n+  };\n+}\n+\n+function createCollapsedRows({", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 340}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTE5NDE3OnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/TableActions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo0MToyM1rOGhy4oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo0MToyM1rOGhy4oQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA4OTg4OQ==", "bodyText": "Doc + params", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438089889", "createdAt": "2020-06-10T12:41:23Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/TableActions.js", "diffHunk": "@@ -205,12 +352,124 @@ export function updateTabTable(tableId, tableResponse) {\n   };\n }\n \n-/**\n- * Update table selection - select items\n+/*\n+ * Update `tableId` rows for tab table/details view\n  */\n-export function updateTableSelection({ tableId, ids }) {\n-  return {\n-    type: UPDATE_TABLE_SELECTION,\n-    payload: { tableId, selection: ids },\n+export function updateTabTableData(tableId, rows) {\n+  return (dispatch, getState) => {\n+    const state = getState();\n+\n+    if (state.tables) {\n+      const table = getTable(state, tableId);\n+      const { keyProperty } = table;\n+\n+      dispatch(updateTableData(tableId, rows, keyProperty));\n+\n+      return Promise.resolve(true);\n+    }\n+\n+    return Promise.resolve(false);\n+  };\n+}\n+\n+function createCollapsedRows({\n+  tableId,\n+  rows,\n+  collapsible,\n+  expandedDepth,\n+  keyProperty,\n+}) {\n+  return (dispatch) => {\n+    let collapsedArrayMap = [];\n+    let collapsedParentRows = [];\n+    let collapsedRows = [];\n+\n+    if (collapsible && rows.length) {\n+      rows.forEach((row) => {\n+        if (row.indent.length >= expandedDepth && row.includedDocuments) {\n+          collapsedArrayMap = collapsedArrayMap.concat(createCollapsedMap(row));\n+          collapsedParentRows = collapsedParentRows.concat(row[keyProperty]);\n+        } else if (row.indent.length > expandedDepth) {\n+          collapsedRows = collapsedRows.concat(row[keyProperty]);\n+        }\n+      });\n+    }\n+\n+    if (collapsible) {\n+      dispatch(\n+        collapseRows({\n+          tableId,\n+          collapsedParentRows,\n+          collapsedRows,\n+          collapsedArrayMap,\n+        })\n+      );\n+    }\n+  };\n+}\n+\n+/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 376}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTIwNjY5OnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/ViewActions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo0NDo1NVrOGhzA3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo0NDo1NVrOGhzA3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA5MTk5OA==", "bodyText": "params doc", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438091998", "createdAt": "2020-06-10T12:44:55Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/ViewActions.js", "diffHunk": "@@ -230,6 +219,17 @@ export function addLocationData(id, locationData) {\n   };\n }\n \n+/**\n+ * @method toggleIncludedView\n+ * @summary sets internal hasIncluded/isIncluded values\n+ */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTIxNzUwOnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/ViewActions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo0NzoyMFrOGhzHcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo0NzoyMFrOGhzHcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA5MzY4MA==", "bodyText": "desc + params", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438093680", "createdAt": "2020-06-10T12:47:20Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/ViewActions.js", "diffHunk": "@@ -412,3 +439,31 @@ export function fetchLocationConfig(windowId, viewId = null) {\n       });\n   };\n }\n+\n+/**\n+ * @method showIncludedView\n+ * @summary ToDo: Describe the method.\n+ */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 167}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTIyMzk0OnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/ViewActions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo0OTowNFrOGhzLjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo0OTowNFrOGhzLjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA5NDczMw==", "bodyText": "can we transform these to one liners ?\nid && dispatch(toggleIncludedView(id, showIncludedView))", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438094733", "createdAt": "2020-06-10T12:49:04Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/ViewActions.js", "diffHunk": "@@ -412,3 +439,31 @@ export function fetchLocationConfig(windowId, viewId = null) {\n       });\n   };\n }\n+\n+/**\n+ * @method showIncludedView\n+ * @summary ToDo: Describe the method.\n+ */\n+export function showIncludedView({\n+  id,\n+  showIncludedView,\n+  windowId,\n+  viewId,\n+  forceClose,\n+} = {}) {\n+  return (dispatch) => {\n+    if (id) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 176}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTIzMzk4OnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/WindowActions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo1MTozNlrOGhzRzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo1MTozNlrOGhzRzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA5NjMzMg==", "bodyText": "don't we have coherence on the name ? Why do we have tabid ?", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438096332", "createdAt": "2020-06-10T12:51:36Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/WindowActions.js", "diffHunk": "@@ -681,20 +537,20 @@ export function createWindow(\n \n       if (tabs) {\n         Object.values(tabs).forEach((tab) => {\n-          const { tabId } = tab;\n-          const tableId = getTableId({ windowType, docId, tabId });\n+          const tabId = tab.tabId || tab.tabid;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 269}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTI1ODY4OnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/WindowActions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo1Nzo0MFrOGhzhVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo1Nzo0MFrOGhzhVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEwMDMwOA==", "bodyText": "Should we add here an extra safety check for response.data ? wdyt", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438100308", "createdAt": "2020-06-10T12:57:40Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/WindowActions.js", "diffHunk": "@@ -822,17 +671,21 @@ export function fetchTopActions(windowType, docId, tabId) {\n       type: FETCH_TOP_ACTIONS,\n     });\n \n-    topActionsRequest(windowType, docId, tabId)\n+    return topActionsRequest(windowType, docId, tabId)\n       .then((response) => {\n         dispatch({\n           type: FETCH_TOP_ACTIONS_SUCCESS,\n           payload: response.data.actions,\n         });\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 360}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTI2OTgyOnYy", "diffSide": "RIGHT", "path": "frontend/src/actions/WindowActions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzowMDoxN1rOGhzoTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzowMDoxN1rOGhzoTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEwMjA5Mw==", "bodyText": "noticed this as well. It comes for example wither when something changes or within a patch", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438102093", "createdAt": "2020-06-10T13:00:17Z", "author": {"login": "petrican"}, "path": "frontend/src/actions/WindowActions.js", "diffHunk": "@@ -1146,6 +966,8 @@ function updateStatus(responseData) {\n /*\n  * It updates store for single field value modification, like handleChange\n  * in MasterWidget\n+ * @todo TODO: from my observations, this is triggered multiple times even", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 454}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTI4OTYwOnYy", "diffSide": "RIGHT", "path": "frontend/src/api/view.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzowNTowMVrOGhz0rA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzowNTowMVrOGhz0rA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEwNTI2MA==", "bodyText": "pls put a doc above the function on this this one also as I believe it's an important one. I know I am a pain in the  ... :)", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438105260", "createdAt": "2020-06-10T13:05:01Z", "author": {"login": "petrican"}, "path": "frontend/src/api/view.js", "diffHunk": "@@ -36,6 +36,7 @@ export function getData({\n }\n \n export function getRowsData({ entity, docType, docId, tabId, rows }) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTMwNzg1OnYy", "diffSide": "RIGHT", "path": "frontend/src/api/window.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzowOTo0MFrOGh0AlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzowOTo0MFrOGh0AlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEwODMwOQ==", "bodyText": "Can you clean up and extract the ternary logic outside , also use a const like EMPTY_STRING for ''. In the end it would be more easier to read that.", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438108309", "createdAt": "2020-06-10T13:09:40Z", "author": {"login": "petrican"}, "path": "frontend/src/api/window.js", "diffHunk": "@@ -19,6 +19,24 @@ export function topActionsRequest(windowId, documentId, tabId) {\n   `);\n }\n \n+export function deleteRequest(\n+  entity,\n+  docType,\n+  docId,\n+  tabId,\n+  ids,\n+  subentity,\n+  subentityId\n+) {\n+  return del(\n+    `${config.API_URL}/${entity}${docType ? `/${docType}` : ''}${", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTMzMDU1OnYy", "diffSide": "RIGHT", "path": "frontend/src/components/app/DocumentList.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzoxNToyMVrOGh0PLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzoxNToyMVrOGh0PLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODExMjA0Ng==", "bodyText": "Dunno. Should we keep it in the redux store and use it to update only the edited item ? wdyt?", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438112046", "createdAt": "2020-06-10T13:15:21Z", "author": {"login": "petrican"}, "path": "frontend/src/components/app/DocumentList.js", "diffHunk": "@@ -75,13 +77,14 @@ export default class DocumentList extends Component {\n   /**\n    * @method setTableRowEdited\n    * @summary ToDo: Describe the method.\n+   * @todo TODO: Figure out if we still need this", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTM1NzQyOnYy", "diffSide": "RIGHT", "path": "frontend/src/components/app/DocumentList.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzoyMTo0MlrOGh0gZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzoyMTo0MlrOGh0gZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODExNjQ1NQ==", "bodyText": "can we refactor to also pass windowId ? Or is outside of the scope ?", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438116455", "createdAt": "2020-06-10T13:21:42Z", "author": {"login": "petrican"}, "path": "frontend/src/components/app/DocumentList.js", "diffHunk": "@@ -384,20 +384,21 @@ export default class DocumentList extends Component {\n                   isModal,\n                   hasIncluded,\n                   viewId,\n-                  windowType,\n+                  windowId,\n                 }}\n               >\n                 {layout.supportAttributes && !isIncluded && !hasIncluded && (\n                   <DataLayoutWrapper\n                     className=\"table-flex-wrapper attributes-selector js-not-unselect\"\n                     entity=\"documentView\"\n-                    {...{ windowType, viewId }}\n+                    {...{ viewId }}\n+                    windowType={windowId}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 268}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTM2NDI3OnYy", "diffSide": "RIGHT", "path": "frontend/src/components/app/QuickActions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzoyMzoxMVrOGh0klw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzoyMzoxMVrOGh0klw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODExNzUyNw==", "bodyText": "Does it always send the first action ?", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438117527", "createdAt": "2020-06-10T13:23:11Z", "author": {"login": "petrican"}, "path": "frontend/src/components/app/QuickActions.js", "diffHunk": "@@ -165,6 +166,19 @@ export class QuickActions extends Component {\n     this.toggleDropdown();\n   };\n \n+  /**\n+   * @method onClick\n+   * @summary Wrapper around the local `handleClick` to be in sync with how it's\n+   * called via `QuickActionsDropdown`.\n+   */\n+  onClick = (e) => {\n+    e.preventDefault;\n+\n+    const { actions } = this.props;\n+\n+    this.handleClick(actions[0]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTM5NDcyOnYy", "diffSide": "RIGHT", "path": "frontend/src/components/app/QuickActions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzozMDowM1rOGh04Bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzozMDowM1rOGh04Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEyMjUwMg==", "bodyText": "should we alias windowId: windowType ?", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438122502", "createdAt": "2020-06-10T13:30:03Z", "author": {"login": "petrican"}, "path": "frontend/src/components/app/QuickActions.js", "diffHunk": "@@ -464,14 +503,9 @@ QuickActions.propTypes = {\n   onInvalidViewId: PropTypes.func,\n };\n \n-const mapStateToProps = (state, ownProps) => {\n-  const { viewId, windowType } = ownProps;\n-  const key = `${windowType}${viewId ? `-${viewId}` : ''}`;\n-\n-  return {\n-    actions: state.windowHandler.quickActions[key] || [],\n-  };\n-};\n+const mapStateToProps = (state, { viewId, windowType }) => ({\n+  actions: getQuickactions(state, { viewId, windowType }),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 207}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTQxMTgxOnYy", "diffSide": "RIGHT", "path": "frontend/src/components/keyshortcuts/DocumentListContextShortcuts.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzozMzo0NlrOGh1C2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzozMzo0NlrOGh1C2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEyNTI3NQ==", "bodyText": "can we destructure the functions from props and only use their names ?", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438125275", "createdAt": "2020-06-10T13:33:46Z", "author": {"login": "petrican"}, "path": "frontend/src/components/keyshortcuts/DocumentListContextShortcuts.js", "diffHunk": "@@ -1,103 +1,115 @@\n-import React, { Component } from 'react';\n+import React, { Fragment, PureComponent } from 'react';\n import PropTypes from 'prop-types';\n import { Shortcut } from '../keyshortcuts';\n-import { arePropTypesIdentical } from '../../utils';\n \n-export default class DocumentListContextShortcuts extends Component {\n+export default class DocumentListContextShortcuts extends PureComponent {\n   handlers = {\n     OPEN_SELECTED: (event) => {\n       event.preventDefault();\n \n-      if (this.props.handleOpenNewTab) {\n-        this.props.handleOpenNewTab();\n+      if (this.props.onOpenNewTab) {\n+        this.handleOpenNewTab();\n       }\n     },\n     REMOVE_SELECTED: (event) => {\n       event.preventDefault();\n \n-      if (this.props.handleDelete) {\n-        this.props.handleDelete();\n+      if (this.props.onDelete) {\n+        this.props.onDelete();\n       }\n     },\n     ADVANCED_EDIT: (event) => {\n       event.preventDefault();\n \n-      if (this.props.handleAdvancedEdit) {\n-        this.props.handleAdvancedEdit();\n+      if (this.props.onAdvancedEdit) {\n+        this.onAdvancedEdit();\n \n         return true;\n       }\n \n       return false;\n     },\n-    SELECT_ALL_LEAFS: (event) => {\n+    SELECT_ALL_LEAVES: (event) => {\n       event.preventDefault();\n \n-      if (this.props.getAllLeafs) {\n-        this.props.getAllLeafs();\n+      if (this.props.onGetAllLeaves) {\n+        this.props.onGetAllLeaves();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTQyMDgwOnYy", "diffSide": "RIGHT", "path": "frontend/src/components/table/Table.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzozNTo1OVrOGh1Iww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzozNTo1OVrOGh1Iww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEyNjc4Nw==", "bodyText": "...", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438126787", "createdAt": "2020-06-10T13:35:59Z", "author": {"login": "petrican"}, "path": "frontend/src/components/table/Table.js", "diffHunk": "@@ -57,500 +33,170 @@ class Table extends Component {\n   }\n \n   componentDidMount() {\n-    const { rowData, tabId } = this.props;\n-    //selecting first table elem while getting indent data\n     this._isMounted = true;\n \n-    if (rowData.get(`${tabId}`)) {\n-      this.getIndentData(true);\n-    }\n     if (this.props.autofocus) {\n       this.table.focus();\n     }\n   }\n \n-  UNSAFE_componentWillReceiveProps(nextProps) {\n-    if (this.state.rows.length && !nextProps.cols) {\n-      this.setState({ rows: [] });\n-    }\n-  }\n-\n-  componentDidUpdate(prevProps, prevState) {\n-    const {\n-      dispatch,\n-      mainTable,\n-      open,\n-      rowData,\n-      defaultSelected,\n-      disconnectFromState,\n-      windowId,\n-      refreshSelection,\n-      openIncludedViewOnSelect,\n-      viewId,\n-      tabId,\n-      isModal,\n-      hasIncluded,\n-      page,\n-    } = this.props;\n-    const { selected, rows } = this.state;\n-\n-    /**\n-     * Selection by default of first row if nothing selected\n-     */\n-    if (\n-      (_.isEmpty(defaultSelected) || _.isEmpty(selected)) &&\n-      selected[0] === undefined &&\n-      !_.isEmpty(rows)\n-    ) {\n-      this.setState({ selected: [rows[0].id] });\n-      dispatch(\n-        updateTableSelection({\n-          tableId: getTableId({ windowType: windowId, viewId }),\n-          ids: [rows[0].id],\n-        })\n-      );\n-      dispatch(\n-        selectTableItems({\n-          windowType: windowId,\n-          viewId,\n-          ids: selected,\n-        })\n-      );\n-    } // end of selection for the first row if nothing selected\n-\n-    const selectedEqual = _.isEqual(prevState.selected, selected);\n-    const defaultSelectedEqual = _.isEqual(\n-      prevProps.defaultSelected,\n-      defaultSelected\n-    );\n+  componentDidUpdate(prevProps) {\n+    const { mainTable, open, rows } = this.props;\n \n     if (!this._isMounted) {\n       return;\n     }\n \n-    if (rows && !_.isEqual(prevState.rows, rows)) {\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-\n-      if (isModal && !hasIncluded) {\n-        let firstRow = rows[0];\n-\n-        if (firstRow) {\n-          if (openIncludedViewOnSelect) {\n-            this.showSelectedIncludedView([firstRow.id]);\n-          }\n-\n-          if (firstRow.id && !selectedEqual) {\n-            this.selectOneProduct(firstRow.id);\n-          }\n-        }\n-      }\n-    } else if (page !== prevProps.page) {\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-    }\n-\n-    if (mainTable && open) {\n-      this.table.focus();\n-    }\n-\n     if (\n-      (!defaultSelectedEqual && !selectedEqual) ||\n-      (refreshSelection && prevProps.refreshSelection !== refreshSelection)\n+      ((rows.length && prevProps.rows.length === 0) || (mainTable && open)) &&\n+      this.table\n     ) {\n-      this.setState({\n-        selected:\n-          defaultSelected && defaultSelected !== null ? defaultSelected : [],\n-      });\n-    } else if (!disconnectFromState && !selectedEqual && selected.length) {\n-      dispatch(\n-        updateTableSelection({\n-          tableId: getTableId({ windowType: windowId, viewId }),\n-          ids: selected,\n-        })\n-      );\n-      dispatch(\n-        selectTableItems({\n-          windowType: windowId,\n-          viewId,\n-          ids: selected,\n-        })\n-      );\n-    }\n-\n-    if (prevProps.viewId !== viewId && rowData.get(`${tabId}`)) {\n-      if (defaultSelected && defaultSelected.length === 0) {\n-        this.setState({ selected: [] });\n-      }\n-\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-\n-      const firstLoad =\n-        prevProps.rowData.get(`${tabId}`) &&\n-        prevProps.rowData.get(`${tabId}`).size &&\n-        rowData.get(`${tabId}`).size\n-          ? false\n-          : true;\n-\n-      this.getIndentData(firstLoad);\n-    } else if (rowData.get(`${tabId}`) && !is(prevProps.rowData, rowData)) {\n-      let firstLoad = rowData.get(`${tabId}`).size ? false : true;\n-\n-      if (\n-        prevProps.rowData.get(`${tabId}`) &&\n-        !prevProps.rowData.get(`${tabId}`).size &&\n-        rowData.get(`${tabId}`).size\n-      ) {\n-        firstLoad = true;\n-      }\n+      this.table.focus();\n \n-      this.getIndentData(firstLoad);\n+      setTimeout(() => {\n+        // TODO: Figure a better way to do this https://github.com/metasfresh/metasfresh/issues/1679\n+        this.setState({\n+          tableRefreshToggle: !this.state.mounted,\n+        });\n+      }, 1);\n     }\n   }\n \n   componentWillUnmount() {\n-    const {\n-      showIncludedViewOnSelect,\n-      viewId,\n-      windowType,\n-      isIncluded,\n-    } = this.props;\n-\n     this._isMounted = false;\n-\n-    this.deselectAllProducts();\n-    if (showIncludedViewOnSelect && !isIncluded) {\n-      showIncludedViewOnSelect({\n-        showIncludedView: false,\n-        windowType,\n-        viewId,\n-      });\n-    }\n   }\n \n-  showSelectedIncludedView = (selected) => {\n-    const { showIncludedViewOnSelect, openIncludedViewOnSelect } = this.props;\n-    const { rows } = this.state;\n-\n-    if (openIncludedViewOnSelect && selected.length === 1) {\n-      rows.forEach((item) => {\n-        if (item.id === selected[0]) {\n-          showIncludedViewOnSelect({\n-            showIncludedView: item.supportIncludedViews,\n-            windowType: item.supportIncludedViews\n-              ? item.includedView.windowType || item.includedView.windowId\n-              : null,\n-            viewId: item.supportIncludedViews ? item.includedView.viewId : '',\n-          });\n-        }\n-      });\n-    }\n+  setListenTrue = () => {\n+    this.setState({ listenOnKeys: true });\n   };\n \n-  getIndentData = (selectFirst) => {\n-    const {\n-      rowData,\n-      tabId,\n-      indentSupported,\n-      collapsible,\n-      expandedDepth,\n-      keyProperty,\n-    } = this.props;\n-    const { selected } = this.state;\n-    let rowsData = [];\n-\n-    if (indentSupported && rowData.get(`${tabId}`).size) {\n-      rowsData = getRowsData(rowData.get(`${tabId}`));\n-\n-      let stateChange = {\n-        rows: rowsData,\n-        pendingInit: !rowsData,\n-      };\n-\n-      if (selectFirst) {\n-        stateChange = {\n-          ...stateChange,\n-          collapsedParentsRows: [],\n-          collapsedRows: [],\n-        };\n-      }\n-\n-      this.setState(stateChange, () => {\n-        const { rows } = this.state;\n-        const firstRow = rows[0];\n-\n-        let updatedParentsRows = [...this.state.collapsedParentsRows];\n-        let updatedRows = [...this.state.collapsedRows];\n+  setListenFalse = () => {\n+    this.setState({ listenOnKeys: false });\n+  };\n \n-        if (firstRow && selectFirst) {\n-          let selectedIndex = 0;\n-          if (\n-            selected &&\n-            selected.length === 1 &&\n-            selected[0] &&\n-            firstRow.id !== selected[0]\n-          ) {\n-            selectedIndex = _.findIndex(rows, (row) => row.id === selected[0]);\n-          }\n+  closeContextMenu = () => {\n+    this.setState({\n+      contextMenu: Object.assign({}, this.state.contextMenu, {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 316}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTQyODI5OnYy", "diffSide": "RIGHT", "path": "frontend/src/components/table/Table.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzozNzo0MFrOGh1Nfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzozNzo0MFrOGh1Nfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEyNzk5OQ==", "bodyText": "doc param pls", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438127999", "createdAt": "2020-06-10T13:37:40Z", "author": {"login": "petrican"}, "path": "frontend/src/components/table/Table.js", "diffHunk": "@@ -57,500 +33,170 @@ class Table extends Component {\n   }\n \n   componentDidMount() {\n-    const { rowData, tabId } = this.props;\n-    //selecting first table elem while getting indent data\n     this._isMounted = true;\n \n-    if (rowData.get(`${tabId}`)) {\n-      this.getIndentData(true);\n-    }\n     if (this.props.autofocus) {\n       this.table.focus();\n     }\n   }\n \n-  UNSAFE_componentWillReceiveProps(nextProps) {\n-    if (this.state.rows.length && !nextProps.cols) {\n-      this.setState({ rows: [] });\n-    }\n-  }\n-\n-  componentDidUpdate(prevProps, prevState) {\n-    const {\n-      dispatch,\n-      mainTable,\n-      open,\n-      rowData,\n-      defaultSelected,\n-      disconnectFromState,\n-      windowId,\n-      refreshSelection,\n-      openIncludedViewOnSelect,\n-      viewId,\n-      tabId,\n-      isModal,\n-      hasIncluded,\n-      page,\n-    } = this.props;\n-    const { selected, rows } = this.state;\n-\n-    /**\n-     * Selection by default of first row if nothing selected\n-     */\n-    if (\n-      (_.isEmpty(defaultSelected) || _.isEmpty(selected)) &&\n-      selected[0] === undefined &&\n-      !_.isEmpty(rows)\n-    ) {\n-      this.setState({ selected: [rows[0].id] });\n-      dispatch(\n-        updateTableSelection({\n-          tableId: getTableId({ windowType: windowId, viewId }),\n-          ids: [rows[0].id],\n-        })\n-      );\n-      dispatch(\n-        selectTableItems({\n-          windowType: windowId,\n-          viewId,\n-          ids: selected,\n-        })\n-      );\n-    } // end of selection for the first row if nothing selected\n-\n-    const selectedEqual = _.isEqual(prevState.selected, selected);\n-    const defaultSelectedEqual = _.isEqual(\n-      prevProps.defaultSelected,\n-      defaultSelected\n-    );\n+  componentDidUpdate(prevProps) {\n+    const { mainTable, open, rows } = this.props;\n \n     if (!this._isMounted) {\n       return;\n     }\n \n-    if (rows && !_.isEqual(prevState.rows, rows)) {\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-\n-      if (isModal && !hasIncluded) {\n-        let firstRow = rows[0];\n-\n-        if (firstRow) {\n-          if (openIncludedViewOnSelect) {\n-            this.showSelectedIncludedView([firstRow.id]);\n-          }\n-\n-          if (firstRow.id && !selectedEqual) {\n-            this.selectOneProduct(firstRow.id);\n-          }\n-        }\n-      }\n-    } else if (page !== prevProps.page) {\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-    }\n-\n-    if (mainTable && open) {\n-      this.table.focus();\n-    }\n-\n     if (\n-      (!defaultSelectedEqual && !selectedEqual) ||\n-      (refreshSelection && prevProps.refreshSelection !== refreshSelection)\n+      ((rows.length && prevProps.rows.length === 0) || (mainTable && open)) &&\n+      this.table\n     ) {\n-      this.setState({\n-        selected:\n-          defaultSelected && defaultSelected !== null ? defaultSelected : [],\n-      });\n-    } else if (!disconnectFromState && !selectedEqual && selected.length) {\n-      dispatch(\n-        updateTableSelection({\n-          tableId: getTableId({ windowType: windowId, viewId }),\n-          ids: selected,\n-        })\n-      );\n-      dispatch(\n-        selectTableItems({\n-          windowType: windowId,\n-          viewId,\n-          ids: selected,\n-        })\n-      );\n-    }\n-\n-    if (prevProps.viewId !== viewId && rowData.get(`${tabId}`)) {\n-      if (defaultSelected && defaultSelected.length === 0) {\n-        this.setState({ selected: [] });\n-      }\n-\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-\n-      const firstLoad =\n-        prevProps.rowData.get(`${tabId}`) &&\n-        prevProps.rowData.get(`${tabId}`).size &&\n-        rowData.get(`${tabId}`).size\n-          ? false\n-          : true;\n-\n-      this.getIndentData(firstLoad);\n-    } else if (rowData.get(`${tabId}`) && !is(prevProps.rowData, rowData)) {\n-      let firstLoad = rowData.get(`${tabId}`).size ? false : true;\n-\n-      if (\n-        prevProps.rowData.get(`${tabId}`) &&\n-        !prevProps.rowData.get(`${tabId}`).size &&\n-        rowData.get(`${tabId}`).size\n-      ) {\n-        firstLoad = true;\n-      }\n+      this.table.focus();\n \n-      this.getIndentData(firstLoad);\n+      setTimeout(() => {\n+        // TODO: Figure a better way to do this https://github.com/metasfresh/metasfresh/issues/1679\n+        this.setState({\n+          tableRefreshToggle: !this.state.mounted,\n+        });\n+      }, 1);\n     }\n   }\n \n   componentWillUnmount() {\n-    const {\n-      showIncludedViewOnSelect,\n-      viewId,\n-      windowType,\n-      isIncluded,\n-    } = this.props;\n-\n     this._isMounted = false;\n-\n-    this.deselectAllProducts();\n-    if (showIncludedViewOnSelect && !isIncluded) {\n-      showIncludedViewOnSelect({\n-        showIncludedView: false,\n-        windowType,\n-        viewId,\n-      });\n-    }\n   }\n \n-  showSelectedIncludedView = (selected) => {\n-    const { showIncludedViewOnSelect, openIncludedViewOnSelect } = this.props;\n-    const { rows } = this.state;\n-\n-    if (openIncludedViewOnSelect && selected.length === 1) {\n-      rows.forEach((item) => {\n-        if (item.id === selected[0]) {\n-          showIncludedViewOnSelect({\n-            showIncludedView: item.supportIncludedViews,\n-            windowType: item.supportIncludedViews\n-              ? item.includedView.windowType || item.includedView.windowId\n-              : null,\n-            viewId: item.supportIncludedViews ? item.includedView.viewId : '',\n-          });\n-        }\n-      });\n-    }\n+  setListenTrue = () => {\n+    this.setState({ listenOnKeys: true });\n   };\n \n-  getIndentData = (selectFirst) => {\n-    const {\n-      rowData,\n-      tabId,\n-      indentSupported,\n-      collapsible,\n-      expandedDepth,\n-      keyProperty,\n-    } = this.props;\n-    const { selected } = this.state;\n-    let rowsData = [];\n-\n-    if (indentSupported && rowData.get(`${tabId}`).size) {\n-      rowsData = getRowsData(rowData.get(`${tabId}`));\n-\n-      let stateChange = {\n-        rows: rowsData,\n-        pendingInit: !rowsData,\n-      };\n-\n-      if (selectFirst) {\n-        stateChange = {\n-          ...stateChange,\n-          collapsedParentsRows: [],\n-          collapsedRows: [],\n-        };\n-      }\n-\n-      this.setState(stateChange, () => {\n-        const { rows } = this.state;\n-        const firstRow = rows[0];\n-\n-        let updatedParentsRows = [...this.state.collapsedParentsRows];\n-        let updatedRows = [...this.state.collapsedRows];\n+  setListenFalse = () => {\n+    this.setState({ listenOnKeys: false });\n+  };\n \n-        if (firstRow && selectFirst) {\n-          let selectedIndex = 0;\n-          if (\n-            selected &&\n-            selected.length === 1 &&\n-            selected[0] &&\n-            firstRow.id !== selected[0]\n-          ) {\n-            selectedIndex = _.findIndex(rows, (row) => row.id === selected[0]);\n-          }\n+  closeContextMenu = () => {\n+    this.setState({\n+      contextMenu: Object.assign({}, this.state.contextMenu, {\n+        open: false,\n+      }),\n+    });\n+  };\n \n-          if (!selectedIndex) {\n-            this.selectOneProduct(rows[0].id);\n-          }\n+  handleSelect = (id, idFocused, idFocusedDown, cb) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 325}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTQzMTQzOnYy", "diffSide": "RIGHT", "path": "frontend/src/components/table/Table.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzozODoxOVrOGh1PVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzozODoxOVrOGh1PVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEyODQ3MA==", "bodyText": "doc + params pls", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438128470", "createdAt": "2020-06-10T13:38:19Z", "author": {"login": "petrican"}, "path": "frontend/src/components/table/Table.js", "diffHunk": "@@ -57,500 +33,170 @@ class Table extends Component {\n   }\n \n   componentDidMount() {\n-    const { rowData, tabId } = this.props;\n-    //selecting first table elem while getting indent data\n     this._isMounted = true;\n \n-    if (rowData.get(`${tabId}`)) {\n-      this.getIndentData(true);\n-    }\n     if (this.props.autofocus) {\n       this.table.focus();\n     }\n   }\n \n-  UNSAFE_componentWillReceiveProps(nextProps) {\n-    if (this.state.rows.length && !nextProps.cols) {\n-      this.setState({ rows: [] });\n-    }\n-  }\n-\n-  componentDidUpdate(prevProps, prevState) {\n-    const {\n-      dispatch,\n-      mainTable,\n-      open,\n-      rowData,\n-      defaultSelected,\n-      disconnectFromState,\n-      windowId,\n-      refreshSelection,\n-      openIncludedViewOnSelect,\n-      viewId,\n-      tabId,\n-      isModal,\n-      hasIncluded,\n-      page,\n-    } = this.props;\n-    const { selected, rows } = this.state;\n-\n-    /**\n-     * Selection by default of first row if nothing selected\n-     */\n-    if (\n-      (_.isEmpty(defaultSelected) || _.isEmpty(selected)) &&\n-      selected[0] === undefined &&\n-      !_.isEmpty(rows)\n-    ) {\n-      this.setState({ selected: [rows[0].id] });\n-      dispatch(\n-        updateTableSelection({\n-          tableId: getTableId({ windowType: windowId, viewId }),\n-          ids: [rows[0].id],\n-        })\n-      );\n-      dispatch(\n-        selectTableItems({\n-          windowType: windowId,\n-          viewId,\n-          ids: selected,\n-        })\n-      );\n-    } // end of selection for the first row if nothing selected\n-\n-    const selectedEqual = _.isEqual(prevState.selected, selected);\n-    const defaultSelectedEqual = _.isEqual(\n-      prevProps.defaultSelected,\n-      defaultSelected\n-    );\n+  componentDidUpdate(prevProps) {\n+    const { mainTable, open, rows } = this.props;\n \n     if (!this._isMounted) {\n       return;\n     }\n \n-    if (rows && !_.isEqual(prevState.rows, rows)) {\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-\n-      if (isModal && !hasIncluded) {\n-        let firstRow = rows[0];\n-\n-        if (firstRow) {\n-          if (openIncludedViewOnSelect) {\n-            this.showSelectedIncludedView([firstRow.id]);\n-          }\n-\n-          if (firstRow.id && !selectedEqual) {\n-            this.selectOneProduct(firstRow.id);\n-          }\n-        }\n-      }\n-    } else if (page !== prevProps.page) {\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-    }\n-\n-    if (mainTable && open) {\n-      this.table.focus();\n-    }\n-\n     if (\n-      (!defaultSelectedEqual && !selectedEqual) ||\n-      (refreshSelection && prevProps.refreshSelection !== refreshSelection)\n+      ((rows.length && prevProps.rows.length === 0) || (mainTable && open)) &&\n+      this.table\n     ) {\n-      this.setState({\n-        selected:\n-          defaultSelected && defaultSelected !== null ? defaultSelected : [],\n-      });\n-    } else if (!disconnectFromState && !selectedEqual && selected.length) {\n-      dispatch(\n-        updateTableSelection({\n-          tableId: getTableId({ windowType: windowId, viewId }),\n-          ids: selected,\n-        })\n-      );\n-      dispatch(\n-        selectTableItems({\n-          windowType: windowId,\n-          viewId,\n-          ids: selected,\n-        })\n-      );\n-    }\n-\n-    if (prevProps.viewId !== viewId && rowData.get(`${tabId}`)) {\n-      if (defaultSelected && defaultSelected.length === 0) {\n-        this.setState({ selected: [] });\n-      }\n-\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-\n-      const firstLoad =\n-        prevProps.rowData.get(`${tabId}`) &&\n-        prevProps.rowData.get(`${tabId}`).size &&\n-        rowData.get(`${tabId}`).size\n-          ? false\n-          : true;\n-\n-      this.getIndentData(firstLoad);\n-    } else if (rowData.get(`${tabId}`) && !is(prevProps.rowData, rowData)) {\n-      let firstLoad = rowData.get(`${tabId}`).size ? false : true;\n-\n-      if (\n-        prevProps.rowData.get(`${tabId}`) &&\n-        !prevProps.rowData.get(`${tabId}`).size &&\n-        rowData.get(`${tabId}`).size\n-      ) {\n-        firstLoad = true;\n-      }\n+      this.table.focus();\n \n-      this.getIndentData(firstLoad);\n+      setTimeout(() => {\n+        // TODO: Figure a better way to do this https://github.com/metasfresh/metasfresh/issues/1679\n+        this.setState({\n+          tableRefreshToggle: !this.state.mounted,\n+        });\n+      }, 1);\n     }\n   }\n \n   componentWillUnmount() {\n-    const {\n-      showIncludedViewOnSelect,\n-      viewId,\n-      windowType,\n-      isIncluded,\n-    } = this.props;\n-\n     this._isMounted = false;\n-\n-    this.deselectAllProducts();\n-    if (showIncludedViewOnSelect && !isIncluded) {\n-      showIncludedViewOnSelect({\n-        showIncludedView: false,\n-        windowType,\n-        viewId,\n-      });\n-    }\n   }\n \n-  showSelectedIncludedView = (selected) => {\n-    const { showIncludedViewOnSelect, openIncludedViewOnSelect } = this.props;\n-    const { rows } = this.state;\n-\n-    if (openIncludedViewOnSelect && selected.length === 1) {\n-      rows.forEach((item) => {\n-        if (item.id === selected[0]) {\n-          showIncludedViewOnSelect({\n-            showIncludedView: item.supportIncludedViews,\n-            windowType: item.supportIncludedViews\n-              ? item.includedView.windowType || item.includedView.windowId\n-              : null,\n-            viewId: item.supportIncludedViews ? item.includedView.viewId : '',\n-          });\n-        }\n-      });\n-    }\n+  setListenTrue = () => {\n+    this.setState({ listenOnKeys: true });\n   };\n \n-  getIndentData = (selectFirst) => {\n-    const {\n-      rowData,\n-      tabId,\n-      indentSupported,\n-      collapsible,\n-      expandedDepth,\n-      keyProperty,\n-    } = this.props;\n-    const { selected } = this.state;\n-    let rowsData = [];\n-\n-    if (indentSupported && rowData.get(`${tabId}`).size) {\n-      rowsData = getRowsData(rowData.get(`${tabId}`));\n-\n-      let stateChange = {\n-        rows: rowsData,\n-        pendingInit: !rowsData,\n-      };\n-\n-      if (selectFirst) {\n-        stateChange = {\n-          ...stateChange,\n-          collapsedParentsRows: [],\n-          collapsedRows: [],\n-        };\n-      }\n-\n-      this.setState(stateChange, () => {\n-        const { rows } = this.state;\n-        const firstRow = rows[0];\n-\n-        let updatedParentsRows = [...this.state.collapsedParentsRows];\n-        let updatedRows = [...this.state.collapsedRows];\n+  setListenFalse = () => {\n+    this.setState({ listenOnKeys: false });\n+  };\n \n-        if (firstRow && selectFirst) {\n-          let selectedIndex = 0;\n-          if (\n-            selected &&\n-            selected.length === 1 &&\n-            selected[0] &&\n-            firstRow.id !== selected[0]\n-          ) {\n-            selectedIndex = _.findIndex(rows, (row) => row.id === selected[0]);\n-          }\n+  closeContextMenu = () => {\n+    this.setState({\n+      contextMenu: Object.assign({}, this.state.contextMenu, {\n+        open: false,\n+      }),\n+    });\n+  };\n \n-          if (!selectedIndex) {\n-            this.selectOneProduct(rows[0].id);\n-          }\n+  handleSelect = (id, idFocused, idFocusedDown, cb) => {\n+    const { onSelect } = this.props;\n \n-          document.getElementsByClassName('js-table')[0].focus();\n-        }\n+    onSelect(id, idFocused, idFocusedDown, cb);\n \n-        let mapCollapsed = [];\n+    this.triggerFocus(idFocused, idFocusedDown);\n+  };\n \n-        if (collapsible && rows && rows.length) {\n-          rows.map((row) => {\n-            if (row.indent.length >= expandedDepth && row.includedDocuments) {\n-              mapCollapsed = mapCollapsed.concat(collapsedMap(row));\n-              updatedParentsRows = updatedParentsRows.concat(row[keyProperty]);\n-            }\n-            if (row.indent.length > expandedDepth) {\n-              updatedRows = updatedRows.concat(row[keyProperty]);\n-            }\n-          });\n+  setContextMenu = (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 346}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyOTQ0ODUzOnYy", "diffSide": "RIGHT", "path": "frontend/src/components/table/Table.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzo0MjoxMlrOGh1aTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNToyODozOVrOGh6cUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEzMTI3OA==", "bodyText": "is there always a selection ? should we add an extra safety check ?", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438131278", "createdAt": "2020-06-10T13:42:12Z", "author": {"login": "petrican"}, "path": "frontend/src/components/table/Table.js", "diffHunk": "@@ -57,500 +33,170 @@ class Table extends Component {\n   }\n \n   componentDidMount() {\n-    const { rowData, tabId } = this.props;\n-    //selecting first table elem while getting indent data\n     this._isMounted = true;\n \n-    if (rowData.get(`${tabId}`)) {\n-      this.getIndentData(true);\n-    }\n     if (this.props.autofocus) {\n       this.table.focus();\n     }\n   }\n \n-  UNSAFE_componentWillReceiveProps(nextProps) {\n-    if (this.state.rows.length && !nextProps.cols) {\n-      this.setState({ rows: [] });\n-    }\n-  }\n-\n-  componentDidUpdate(prevProps, prevState) {\n-    const {\n-      dispatch,\n-      mainTable,\n-      open,\n-      rowData,\n-      defaultSelected,\n-      disconnectFromState,\n-      windowId,\n-      refreshSelection,\n-      openIncludedViewOnSelect,\n-      viewId,\n-      tabId,\n-      isModal,\n-      hasIncluded,\n-      page,\n-    } = this.props;\n-    const { selected, rows } = this.state;\n-\n-    /**\n-     * Selection by default of first row if nothing selected\n-     */\n-    if (\n-      (_.isEmpty(defaultSelected) || _.isEmpty(selected)) &&\n-      selected[0] === undefined &&\n-      !_.isEmpty(rows)\n-    ) {\n-      this.setState({ selected: [rows[0].id] });\n-      dispatch(\n-        updateTableSelection({\n-          tableId: getTableId({ windowType: windowId, viewId }),\n-          ids: [rows[0].id],\n-        })\n-      );\n-      dispatch(\n-        selectTableItems({\n-          windowType: windowId,\n-          viewId,\n-          ids: selected,\n-        })\n-      );\n-    } // end of selection for the first row if nothing selected\n-\n-    const selectedEqual = _.isEqual(prevState.selected, selected);\n-    const defaultSelectedEqual = _.isEqual(\n-      prevProps.defaultSelected,\n-      defaultSelected\n-    );\n+  componentDidUpdate(prevProps) {\n+    const { mainTable, open, rows } = this.props;\n \n     if (!this._isMounted) {\n       return;\n     }\n \n-    if (rows && !_.isEqual(prevState.rows, rows)) {\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-\n-      if (isModal && !hasIncluded) {\n-        let firstRow = rows[0];\n-\n-        if (firstRow) {\n-          if (openIncludedViewOnSelect) {\n-            this.showSelectedIncludedView([firstRow.id]);\n-          }\n-\n-          if (firstRow.id && !selectedEqual) {\n-            this.selectOneProduct(firstRow.id);\n-          }\n-        }\n-      }\n-    } else if (page !== prevProps.page) {\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-    }\n-\n-    if (mainTable && open) {\n-      this.table.focus();\n-    }\n-\n     if (\n-      (!defaultSelectedEqual && !selectedEqual) ||\n-      (refreshSelection && prevProps.refreshSelection !== refreshSelection)\n+      ((rows.length && prevProps.rows.length === 0) || (mainTable && open)) &&\n+      this.table\n     ) {\n-      this.setState({\n-        selected:\n-          defaultSelected && defaultSelected !== null ? defaultSelected : [],\n-      });\n-    } else if (!disconnectFromState && !selectedEqual && selected.length) {\n-      dispatch(\n-        updateTableSelection({\n-          tableId: getTableId({ windowType: windowId, viewId }),\n-          ids: selected,\n-        })\n-      );\n-      dispatch(\n-        selectTableItems({\n-          windowType: windowId,\n-          viewId,\n-          ids: selected,\n-        })\n-      );\n-    }\n-\n-    if (prevProps.viewId !== viewId && rowData.get(`${tabId}`)) {\n-      if (defaultSelected && defaultSelected.length === 0) {\n-        this.setState({ selected: [] });\n-      }\n-\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-\n-      const firstLoad =\n-        prevProps.rowData.get(`${tabId}`) &&\n-        prevProps.rowData.get(`${tabId}`).size &&\n-        rowData.get(`${tabId}`).size\n-          ? false\n-          : true;\n-\n-      this.getIndentData(firstLoad);\n-    } else if (rowData.get(`${tabId}`) && !is(prevProps.rowData, rowData)) {\n-      let firstLoad = rowData.get(`${tabId}`).size ? false : true;\n-\n-      if (\n-        prevProps.rowData.get(`${tabId}`) &&\n-        !prevProps.rowData.get(`${tabId}`).size &&\n-        rowData.get(`${tabId}`).size\n-      ) {\n-        firstLoad = true;\n-      }\n+      this.table.focus();\n \n-      this.getIndentData(firstLoad);\n+      setTimeout(() => {\n+        // TODO: Figure a better way to do this https://github.com/metasfresh/metasfresh/issues/1679\n+        this.setState({\n+          tableRefreshToggle: !this.state.mounted,\n+        });\n+      }, 1);\n     }\n   }\n \n   componentWillUnmount() {\n-    const {\n-      showIncludedViewOnSelect,\n-      viewId,\n-      windowType,\n-      isIncluded,\n-    } = this.props;\n-\n     this._isMounted = false;\n-\n-    this.deselectAllProducts();\n-    if (showIncludedViewOnSelect && !isIncluded) {\n-      showIncludedViewOnSelect({\n-        showIncludedView: false,\n-        windowType,\n-        viewId,\n-      });\n-    }\n   }\n \n-  showSelectedIncludedView = (selected) => {\n-    const { showIncludedViewOnSelect, openIncludedViewOnSelect } = this.props;\n-    const { rows } = this.state;\n-\n-    if (openIncludedViewOnSelect && selected.length === 1) {\n-      rows.forEach((item) => {\n-        if (item.id === selected[0]) {\n-          showIncludedViewOnSelect({\n-            showIncludedView: item.supportIncludedViews,\n-            windowType: item.supportIncludedViews\n-              ? item.includedView.windowType || item.includedView.windowId\n-              : null,\n-            viewId: item.supportIncludedViews ? item.includedView.viewId : '',\n-          });\n-        }\n-      });\n-    }\n+  setListenTrue = () => {\n+    this.setState({ listenOnKeys: true });\n   };\n \n-  getIndentData = (selectFirst) => {\n-    const {\n-      rowData,\n-      tabId,\n-      indentSupported,\n-      collapsible,\n-      expandedDepth,\n-      keyProperty,\n-    } = this.props;\n-    const { selected } = this.state;\n-    let rowsData = [];\n-\n-    if (indentSupported && rowData.get(`${tabId}`).size) {\n-      rowsData = getRowsData(rowData.get(`${tabId}`));\n-\n-      let stateChange = {\n-        rows: rowsData,\n-        pendingInit: !rowsData,\n-      };\n-\n-      if (selectFirst) {\n-        stateChange = {\n-          ...stateChange,\n-          collapsedParentsRows: [],\n-          collapsedRows: [],\n-        };\n-      }\n-\n-      this.setState(stateChange, () => {\n-        const { rows } = this.state;\n-        const firstRow = rows[0];\n-\n-        let updatedParentsRows = [...this.state.collapsedParentsRows];\n-        let updatedRows = [...this.state.collapsedRows];\n+  setListenFalse = () => {\n+    this.setState({ listenOnKeys: false });\n+  };\n \n-        if (firstRow && selectFirst) {\n-          let selectedIndex = 0;\n-          if (\n-            selected &&\n-            selected.length === 1 &&\n-            selected[0] &&\n-            firstRow.id !== selected[0]\n-          ) {\n-            selectedIndex = _.findIndex(rows, (row) => row.id === selected[0]);\n-          }\n+  closeContextMenu = () => {\n+    this.setState({\n+      contextMenu: Object.assign({}, this.state.contextMenu, {\n+        open: false,\n+      }),\n+    });\n+  };\n \n-          if (!selectedIndex) {\n-            this.selectOneProduct(rows[0].id);\n-          }\n+  handleSelect = (id, idFocused, idFocusedDown, cb) => {\n+    const { onSelect } = this.props;\n \n-          document.getElementsByClassName('js-table')[0].focus();\n-        }\n+    onSelect(id, idFocused, idFocusedDown, cb);\n \n-        let mapCollapsed = [];\n+    this.triggerFocus(idFocused, idFocusedDown);\n+  };\n \n-        if (collapsible && rows && rows.length) {\n-          rows.map((row) => {\n-            if (row.indent.length >= expandedDepth && row.includedDocuments) {\n-              mapCollapsed = mapCollapsed.concat(collapsedMap(row));\n-              updatedParentsRows = updatedParentsRows.concat(row[keyProperty]);\n-            }\n-            if (row.indent.length > expandedDepth) {\n-              updatedRows = updatedRows.concat(row[keyProperty]);\n-            }\n-          });\n+  setContextMenu = (\n+    clientX,\n+    clientY,\n+    fieldName,\n+    supportZoomInto,\n+    supportFieldEdit\n+  ) => {\n+    this.setState({\n+      contextMenu: {\n+        ...this.state.contextMenu,\n+        x: clientX,\n+        y: clientY,\n+        open: true,\n+        fieldName,\n+        supportZoomInto,\n+        supportFieldEdit,\n+      },\n+    });\n+  };\n \n-          const updatedState = {\n-            dataHash: uuid(),\n-          };\n+  getProductRange = (id) => {\n+    const { keyProperty, rows, selected } = this.props;\n+    let arrayIndex;\n+    let selectIdA;\n+    let selectIdB;\n \n-          if (mapCollapsed.length) {\n-            updatedState.collapsedArrayMap = mapCollapsed;\n-          }\n-          if (updatedRows.length) {\n-            updatedState.collapsedRows = updatedRows;\n-          }\n-          if (updatedParentsRows.length) {\n-            updatedState.collapsedParentsRows = updatedParentsRows;\n-          }\n+    arrayIndex = rows.map((item) => item[keyProperty]);\n+    selectIdA = arrayIndex.findIndex((x) => x === id);\n+    selectIdB = arrayIndex.findIndex((x) => x === selected[0]);\n \n-          if (Object.keys(updatedState).length) {\n-            this.setState({ ...updatedState });\n-          }\n-        }\n-      });\n-    } else {\n-      rowsData =\n-        rowData.get(`${tabId}`) && rowData.get(`${tabId}`).size\n-          ? rowData.get(`${tabId}`).toArray()\n-          : [];\n-\n-      this.setState({\n-        rows: rowsData,\n-        dataHash: uuid(),\n-        pendingInit: !rowData.get(`${tabId}`),\n-      });\n-    }\n+    const selectedArr = [selectIdA, selectIdB];\n \n-    if (rowsData.length) {\n-      setTimeout(() => {\n-        if (this._isMounted) {\n-          this.setState({\n-            tableRefreshToggle: !this.state.mounted,\n-          });\n-        }\n-      }, 1);\n-    }\n+    selectedArr.sort((a, b) => a - b);\n+    return arrayIndex.slice(selectedArr[0], selectedArr[1] + 1);\n   };\n \n-  getAllLeafs = () => {\n-    const { rows, selected } = this.state;\n-    let leafs = [];\n-    let leafsIds = [];\n-\n-    rows.map((item) => {\n-      if (item.id == selected[0]) {\n-        leafs = mapIncluded(item);\n-      }\n-    });\n+  handleBatchEntryToggle = () => {\n+    const { isBatchEntry } = this.state;\n \n-    leafs.map((item) => {\n-      leafsIds = leafsIds.concat(item.id);\n+    this.setState({\n+      isBatchEntry: !isBatchEntry,\n     });\n-\n-    this.selectRangeProduct(leafsIds);\n   };\n \n-  setListenTrue = () => {\n-    this.setState({ listenOnKeys: true });\n+  handleDelete = () => {\n+    this.setState({\n+      promptOpen: true,\n+    });\n   };\n \n-  setListenFalse = () => {\n-    this.setState({ listenOnKeys: false });\n+  handlePromptCancelClick = () => {\n+    this.setState({\n+      promptOpen: false,\n+    });\n   };\n \n-  selectProduct = (id, idFocused, idFocusedDown) => {\n-    const {\n-      dispatch,\n-      windowId,\n-      disconnectFromState,\n-      tabInfo,\n-      viewId,\n-    } = this.props;\n-    const { selected } = this.state;\n-    let newSelected = [];\n-    if (!selected[0]) {\n-      newSelected = [id];\n-    } else {\n-      newSelected = selected.concat([id]);\n-    }\n-\n-    this.setState({ selected: newSelected }, () => {\n-      const { selected } = this.state;\n-\n-      if (tabInfo) {\n-        dispatch(\n-          updateTableSelection({\n-            tableId: getTableId({ windowType: windowId, viewId }),\n-            ids: selected,\n-          })\n-        );\n-        dispatch(\n-          selectTableItems({\n-            windowType: windowId,\n-            viewId,\n-            ids: selected,\n-          })\n-        );\n-      }\n-\n-      if (!disconnectFromState) {\n-        dispatch(\n-          updateTableSelection({\n-            tableId: getTableId({ windowType: windowId, viewId }),\n-            ids: selected,\n-          })\n-        );\n-        dispatch(\n-          selectTableItems({\n-            windowType: windowId,\n-            viewId,\n-            ids: selected,\n-          })\n-        );\n-      }\n+  handlePromptSubmitClick = (selected) => {\n+    const { onPromptSubmit } = this.props;\n \n-      this.triggerFocus(idFocused, idFocusedDown);\n-    });\n+    onPromptSubmit && onPromptSubmit(selected);\n \n-    return newSelected;\n+    this.setState({ promptOpen: false });\n   };\n \n-  selectRangeProduct = (ids) => {\n-    const { dispatch, tabInfo, windowId, viewId } = this.props;\n+  handleShortcutIndent = (collapse) => {\n+    const { selected, rows, onRowCollapse } = this.props;\n+    let node = null;\n \n-    this.setState({ selected: [...ids] });\n+    selected.length === 1 &&\n+      rows.map((item) => {\n+        if (item.id === selected[0]) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 528}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODIxMzcxNA==", "bodyText": "there's always a selection array in the state now", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438213714", "createdAt": "2020-06-10T15:28:39Z", "author": {"login": "siemiatj"}, "path": "frontend/src/components/table/Table.js", "diffHunk": "@@ -57,500 +33,170 @@ class Table extends Component {\n   }\n \n   componentDidMount() {\n-    const { rowData, tabId } = this.props;\n-    //selecting first table elem while getting indent data\n     this._isMounted = true;\n \n-    if (rowData.get(`${tabId}`)) {\n-      this.getIndentData(true);\n-    }\n     if (this.props.autofocus) {\n       this.table.focus();\n     }\n   }\n \n-  UNSAFE_componentWillReceiveProps(nextProps) {\n-    if (this.state.rows.length && !nextProps.cols) {\n-      this.setState({ rows: [] });\n-    }\n-  }\n-\n-  componentDidUpdate(prevProps, prevState) {\n-    const {\n-      dispatch,\n-      mainTable,\n-      open,\n-      rowData,\n-      defaultSelected,\n-      disconnectFromState,\n-      windowId,\n-      refreshSelection,\n-      openIncludedViewOnSelect,\n-      viewId,\n-      tabId,\n-      isModal,\n-      hasIncluded,\n-      page,\n-    } = this.props;\n-    const { selected, rows } = this.state;\n-\n-    /**\n-     * Selection by default of first row if nothing selected\n-     */\n-    if (\n-      (_.isEmpty(defaultSelected) || _.isEmpty(selected)) &&\n-      selected[0] === undefined &&\n-      !_.isEmpty(rows)\n-    ) {\n-      this.setState({ selected: [rows[0].id] });\n-      dispatch(\n-        updateTableSelection({\n-          tableId: getTableId({ windowType: windowId, viewId }),\n-          ids: [rows[0].id],\n-        })\n-      );\n-      dispatch(\n-        selectTableItems({\n-          windowType: windowId,\n-          viewId,\n-          ids: selected,\n-        })\n-      );\n-    } // end of selection for the first row if nothing selected\n-\n-    const selectedEqual = _.isEqual(prevState.selected, selected);\n-    const defaultSelectedEqual = _.isEqual(\n-      prevProps.defaultSelected,\n-      defaultSelected\n-    );\n+  componentDidUpdate(prevProps) {\n+    const { mainTable, open, rows } = this.props;\n \n     if (!this._isMounted) {\n       return;\n     }\n \n-    if (rows && !_.isEqual(prevState.rows, rows)) {\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-\n-      if (isModal && !hasIncluded) {\n-        let firstRow = rows[0];\n-\n-        if (firstRow) {\n-          if (openIncludedViewOnSelect) {\n-            this.showSelectedIncludedView([firstRow.id]);\n-          }\n-\n-          if (firstRow.id && !selectedEqual) {\n-            this.selectOneProduct(firstRow.id);\n-          }\n-        }\n-      }\n-    } else if (page !== prevProps.page) {\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-    }\n-\n-    if (mainTable && open) {\n-      this.table.focus();\n-    }\n-\n     if (\n-      (!defaultSelectedEqual && !selectedEqual) ||\n-      (refreshSelection && prevProps.refreshSelection !== refreshSelection)\n+      ((rows.length && prevProps.rows.length === 0) || (mainTable && open)) &&\n+      this.table\n     ) {\n-      this.setState({\n-        selected:\n-          defaultSelected && defaultSelected !== null ? defaultSelected : [],\n-      });\n-    } else if (!disconnectFromState && !selectedEqual && selected.length) {\n-      dispatch(\n-        updateTableSelection({\n-          tableId: getTableId({ windowType: windowId, viewId }),\n-          ids: selected,\n-        })\n-      );\n-      dispatch(\n-        selectTableItems({\n-          windowType: windowId,\n-          viewId,\n-          ids: selected,\n-        })\n-      );\n-    }\n-\n-    if (prevProps.viewId !== viewId && rowData.get(`${tabId}`)) {\n-      if (defaultSelected && defaultSelected.length === 0) {\n-        this.setState({ selected: [] });\n-      }\n-\n-      this.setState({\n-        collapsedRows: [],\n-        collapsedParentsRows: [],\n-      });\n-\n-      const firstLoad =\n-        prevProps.rowData.get(`${tabId}`) &&\n-        prevProps.rowData.get(`${tabId}`).size &&\n-        rowData.get(`${tabId}`).size\n-          ? false\n-          : true;\n-\n-      this.getIndentData(firstLoad);\n-    } else if (rowData.get(`${tabId}`) && !is(prevProps.rowData, rowData)) {\n-      let firstLoad = rowData.get(`${tabId}`).size ? false : true;\n-\n-      if (\n-        prevProps.rowData.get(`${tabId}`) &&\n-        !prevProps.rowData.get(`${tabId}`).size &&\n-        rowData.get(`${tabId}`).size\n-      ) {\n-        firstLoad = true;\n-      }\n+      this.table.focus();\n \n-      this.getIndentData(firstLoad);\n+      setTimeout(() => {\n+        // TODO: Figure a better way to do this https://github.com/metasfresh/metasfresh/issues/1679\n+        this.setState({\n+          tableRefreshToggle: !this.state.mounted,\n+        });\n+      }, 1);\n     }\n   }\n \n   componentWillUnmount() {\n-    const {\n-      showIncludedViewOnSelect,\n-      viewId,\n-      windowType,\n-      isIncluded,\n-    } = this.props;\n-\n     this._isMounted = false;\n-\n-    this.deselectAllProducts();\n-    if (showIncludedViewOnSelect && !isIncluded) {\n-      showIncludedViewOnSelect({\n-        showIncludedView: false,\n-        windowType,\n-        viewId,\n-      });\n-    }\n   }\n \n-  showSelectedIncludedView = (selected) => {\n-    const { showIncludedViewOnSelect, openIncludedViewOnSelect } = this.props;\n-    const { rows } = this.state;\n-\n-    if (openIncludedViewOnSelect && selected.length === 1) {\n-      rows.forEach((item) => {\n-        if (item.id === selected[0]) {\n-          showIncludedViewOnSelect({\n-            showIncludedView: item.supportIncludedViews,\n-            windowType: item.supportIncludedViews\n-              ? item.includedView.windowType || item.includedView.windowId\n-              : null,\n-            viewId: item.supportIncludedViews ? item.includedView.viewId : '',\n-          });\n-        }\n-      });\n-    }\n+  setListenTrue = () => {\n+    this.setState({ listenOnKeys: true });\n   };\n \n-  getIndentData = (selectFirst) => {\n-    const {\n-      rowData,\n-      tabId,\n-      indentSupported,\n-      collapsible,\n-      expandedDepth,\n-      keyProperty,\n-    } = this.props;\n-    const { selected } = this.state;\n-    let rowsData = [];\n-\n-    if (indentSupported && rowData.get(`${tabId}`).size) {\n-      rowsData = getRowsData(rowData.get(`${tabId}`));\n-\n-      let stateChange = {\n-        rows: rowsData,\n-        pendingInit: !rowsData,\n-      };\n-\n-      if (selectFirst) {\n-        stateChange = {\n-          ...stateChange,\n-          collapsedParentsRows: [],\n-          collapsedRows: [],\n-        };\n-      }\n-\n-      this.setState(stateChange, () => {\n-        const { rows } = this.state;\n-        const firstRow = rows[0];\n-\n-        let updatedParentsRows = [...this.state.collapsedParentsRows];\n-        let updatedRows = [...this.state.collapsedRows];\n+  setListenFalse = () => {\n+    this.setState({ listenOnKeys: false });\n+  };\n \n-        if (firstRow && selectFirst) {\n-          let selectedIndex = 0;\n-          if (\n-            selected &&\n-            selected.length === 1 &&\n-            selected[0] &&\n-            firstRow.id !== selected[0]\n-          ) {\n-            selectedIndex = _.findIndex(rows, (row) => row.id === selected[0]);\n-          }\n+  closeContextMenu = () => {\n+    this.setState({\n+      contextMenu: Object.assign({}, this.state.contextMenu, {\n+        open: false,\n+      }),\n+    });\n+  };\n \n-          if (!selectedIndex) {\n-            this.selectOneProduct(rows[0].id);\n-          }\n+  handleSelect = (id, idFocused, idFocusedDown, cb) => {\n+    const { onSelect } = this.props;\n \n-          document.getElementsByClassName('js-table')[0].focus();\n-        }\n+    onSelect(id, idFocused, idFocusedDown, cb);\n \n-        let mapCollapsed = [];\n+    this.triggerFocus(idFocused, idFocusedDown);\n+  };\n \n-        if (collapsible && rows && rows.length) {\n-          rows.map((row) => {\n-            if (row.indent.length >= expandedDepth && row.includedDocuments) {\n-              mapCollapsed = mapCollapsed.concat(collapsedMap(row));\n-              updatedParentsRows = updatedParentsRows.concat(row[keyProperty]);\n-            }\n-            if (row.indent.length > expandedDepth) {\n-              updatedRows = updatedRows.concat(row[keyProperty]);\n-            }\n-          });\n+  setContextMenu = (\n+    clientX,\n+    clientY,\n+    fieldName,\n+    supportZoomInto,\n+    supportFieldEdit\n+  ) => {\n+    this.setState({\n+      contextMenu: {\n+        ...this.state.contextMenu,\n+        x: clientX,\n+        y: clientY,\n+        open: true,\n+        fieldName,\n+        supportZoomInto,\n+        supportFieldEdit,\n+      },\n+    });\n+  };\n \n-          const updatedState = {\n-            dataHash: uuid(),\n-          };\n+  getProductRange = (id) => {\n+    const { keyProperty, rows, selected } = this.props;\n+    let arrayIndex;\n+    let selectIdA;\n+    let selectIdB;\n \n-          if (mapCollapsed.length) {\n-            updatedState.collapsedArrayMap = mapCollapsed;\n-          }\n-          if (updatedRows.length) {\n-            updatedState.collapsedRows = updatedRows;\n-          }\n-          if (updatedParentsRows.length) {\n-            updatedState.collapsedParentsRows = updatedParentsRows;\n-          }\n+    arrayIndex = rows.map((item) => item[keyProperty]);\n+    selectIdA = arrayIndex.findIndex((x) => x === id);\n+    selectIdB = arrayIndex.findIndex((x) => x === selected[0]);\n \n-          if (Object.keys(updatedState).length) {\n-            this.setState({ ...updatedState });\n-          }\n-        }\n-      });\n-    } else {\n-      rowsData =\n-        rowData.get(`${tabId}`) && rowData.get(`${tabId}`).size\n-          ? rowData.get(`${tabId}`).toArray()\n-          : [];\n-\n-      this.setState({\n-        rows: rowsData,\n-        dataHash: uuid(),\n-        pendingInit: !rowData.get(`${tabId}`),\n-      });\n-    }\n+    const selectedArr = [selectIdA, selectIdB];\n \n-    if (rowsData.length) {\n-      setTimeout(() => {\n-        if (this._isMounted) {\n-          this.setState({\n-            tableRefreshToggle: !this.state.mounted,\n-          });\n-        }\n-      }, 1);\n-    }\n+    selectedArr.sort((a, b) => a - b);\n+    return arrayIndex.slice(selectedArr[0], selectedArr[1] + 1);\n   };\n \n-  getAllLeafs = () => {\n-    const { rows, selected } = this.state;\n-    let leafs = [];\n-    let leafsIds = [];\n-\n-    rows.map((item) => {\n-      if (item.id == selected[0]) {\n-        leafs = mapIncluded(item);\n-      }\n-    });\n+  handleBatchEntryToggle = () => {\n+    const { isBatchEntry } = this.state;\n \n-    leafs.map((item) => {\n-      leafsIds = leafsIds.concat(item.id);\n+    this.setState({\n+      isBatchEntry: !isBatchEntry,\n     });\n-\n-    this.selectRangeProduct(leafsIds);\n   };\n \n-  setListenTrue = () => {\n-    this.setState({ listenOnKeys: true });\n+  handleDelete = () => {\n+    this.setState({\n+      promptOpen: true,\n+    });\n   };\n \n-  setListenFalse = () => {\n-    this.setState({ listenOnKeys: false });\n+  handlePromptCancelClick = () => {\n+    this.setState({\n+      promptOpen: false,\n+    });\n   };\n \n-  selectProduct = (id, idFocused, idFocusedDown) => {\n-    const {\n-      dispatch,\n-      windowId,\n-      disconnectFromState,\n-      tabInfo,\n-      viewId,\n-    } = this.props;\n-    const { selected } = this.state;\n-    let newSelected = [];\n-    if (!selected[0]) {\n-      newSelected = [id];\n-    } else {\n-      newSelected = selected.concat([id]);\n-    }\n-\n-    this.setState({ selected: newSelected }, () => {\n-      const { selected } = this.state;\n-\n-      if (tabInfo) {\n-        dispatch(\n-          updateTableSelection({\n-            tableId: getTableId({ windowType: windowId, viewId }),\n-            ids: selected,\n-          })\n-        );\n-        dispatch(\n-          selectTableItems({\n-            windowType: windowId,\n-            viewId,\n-            ids: selected,\n-          })\n-        );\n-      }\n-\n-      if (!disconnectFromState) {\n-        dispatch(\n-          updateTableSelection({\n-            tableId: getTableId({ windowType: windowId, viewId }),\n-            ids: selected,\n-          })\n-        );\n-        dispatch(\n-          selectTableItems({\n-            windowType: windowId,\n-            viewId,\n-            ids: selected,\n-          })\n-        );\n-      }\n+  handlePromptSubmitClick = (selected) => {\n+    const { onPromptSubmit } = this.props;\n \n-      this.triggerFocus(idFocused, idFocusedDown);\n-    });\n+    onPromptSubmit && onPromptSubmit(selected);\n \n-    return newSelected;\n+    this.setState({ promptOpen: false });\n   };\n \n-  selectRangeProduct = (ids) => {\n-    const { dispatch, tabInfo, windowId, viewId } = this.props;\n+  handleShortcutIndent = (collapse) => {\n+    const { selected, rows, onRowCollapse } = this.props;\n+    let node = null;\n \n-    this.setState({ selected: [...ids] });\n+    selected.length === 1 &&\n+      rows.map((item) => {\n+        if (item.id === selected[0]) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEzMTI3OA=="}, "originalCommit": {"oid": "adb28faab87d22c900cbfecb04e820fcddd35c0d"}, "originalPosition": 528}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzQzOTkxOnYy", "diffSide": "RIGHT", "path": "frontend/src/containers/Table.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzoyOTo0MFrOGidECw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMjoxMDowNFrOGjBqWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc4MDkzOQ==", "bodyText": "can we move all this logic from L:70-78 to a separate function that can live outside the Table component  in tableHelpers ?  let newSelection = getSelectionForIds(ids). Goal is to have the Table as thin as possible", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438780939", "createdAt": "2020-06-11T13:29:40Z", "author": {"login": "petrican"}, "path": "frontend/src/containers/Table.js", "diffHunk": "@@ -0,0 +1,268 @@\n+import update from 'immutability-helper';\n+import React, { PureComponent } from 'react';\n+import { connect } from 'react-redux';\n+\n+import { getZoomIntoWindow, deleteRequest } from '../api';\n+import { getTableId, getTable } from '../reducers/tables';\n+\n+import {\n+  updateTableSelection,\n+  deselectTableItems,\n+  collapseTableRow,\n+} from '../actions/TableActions';\n+import { showIncludedView } from '../actions/ViewActions';\n+import { openModal } from '../actions/WindowActions';\n+\n+import { containerPropTypes } from '../utils/tableHelpers';\n+import { mapIncluded } from '../utils/documentListHelper';\n+\n+import Table from '../components/table/Table';\n+\n+class TableContainer extends PureComponent {\n+  componentWillUnmount() {\n+    const {\n+      showIncludedView,\n+      viewId,\n+      windowId,\n+      isIncluded,\n+      isModal,\n+    } = this.props;\n+\n+    if (!isIncluded) {\n+      const identifier = isModal ? viewId : windowId;\n+\n+      showIncludedView({\n+        id: identifier,\n+        showIncludedView: false,\n+        windowId,\n+        viewId,\n+      });\n+    }\n+  }\n+\n+  getAllLeaves = () => {\n+    const { rows, selected } = this.props;\n+    let leafs = [];\n+    let leafsIds = [];\n+\n+    rows.map((item) => {\n+      if (item.id === selected[0]) {\n+        leafs = mapIncluded(item);\n+      }\n+    });\n+\n+    leafs.map((item) => {\n+      leafsIds = leafsIds.concat(item.id);\n+    });\n+\n+    this.handleSelect(leafsIds);\n+  };\n+\n+  handleSelect = (ids, cb) => {\n+    const {\n+      updateTableSelection,\n+      windowId,\n+      viewId,\n+      docId,\n+      tabId,\n+      keyProperty,\n+    } = this.props;\n+    let newSelected = [];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "075ac3cfc22846ce0ba1d9db93541309d5c77862"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM4MDU2OQ==", "bodyText": "But this is in the container, which is ~270 LOC's so I don't really see much sense. Also we'd then have to pass like 6 or 7 parameters.", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r439380569", "createdAt": "2020-06-12T12:10:04Z", "author": {"login": "siemiatj"}, "path": "frontend/src/containers/Table.js", "diffHunk": "@@ -0,0 +1,268 @@\n+import update from 'immutability-helper';\n+import React, { PureComponent } from 'react';\n+import { connect } from 'react-redux';\n+\n+import { getZoomIntoWindow, deleteRequest } from '../api';\n+import { getTableId, getTable } from '../reducers/tables';\n+\n+import {\n+  updateTableSelection,\n+  deselectTableItems,\n+  collapseTableRow,\n+} from '../actions/TableActions';\n+import { showIncludedView } from '../actions/ViewActions';\n+import { openModal } from '../actions/WindowActions';\n+\n+import { containerPropTypes } from '../utils/tableHelpers';\n+import { mapIncluded } from '../utils/documentListHelper';\n+\n+import Table from '../components/table/Table';\n+\n+class TableContainer extends PureComponent {\n+  componentWillUnmount() {\n+    const {\n+      showIncludedView,\n+      viewId,\n+      windowId,\n+      isIncluded,\n+      isModal,\n+    } = this.props;\n+\n+    if (!isIncluded) {\n+      const identifier = isModal ? viewId : windowId;\n+\n+      showIncludedView({\n+        id: identifier,\n+        showIncludedView: false,\n+        windowId,\n+        viewId,\n+      });\n+    }\n+  }\n+\n+  getAllLeaves = () => {\n+    const { rows, selected } = this.props;\n+    let leafs = [];\n+    let leafsIds = [];\n+\n+    rows.map((item) => {\n+      if (item.id === selected[0]) {\n+        leafs = mapIncluded(item);\n+      }\n+    });\n+\n+    leafs.map((item) => {\n+      leafsIds = leafsIds.concat(item.id);\n+    });\n+\n+    this.handleSelect(leafsIds);\n+  };\n+\n+  handleSelect = (ids, cb) => {\n+    const {\n+      updateTableSelection,\n+      windowId,\n+      viewId,\n+      docId,\n+      tabId,\n+      keyProperty,\n+    } = this.props;\n+    let newSelected = [];", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc4MDkzOQ=="}, "originalCommit": {"oid": "075ac3cfc22846ce0ba1d9db93541309d5c77862"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzQ1NjUwOnYy", "diffSide": "RIGHT", "path": "frontend/src/containers/Table.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzozMjo1M1rOGidOEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMjoxMToxMFrOGjBsLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc4MzUwNQ==", "bodyText": "I would move this also outside the component.", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438783505", "createdAt": "2020-06-11T13:32:53Z", "author": {"login": "petrican"}, "path": "frontend/src/containers/Table.js", "diffHunk": "@@ -0,0 +1,268 @@\n+import update from 'immutability-helper';\n+import React, { PureComponent } from 'react';\n+import { connect } from 'react-redux';\n+\n+import { getZoomIntoWindow, deleteRequest } from '../api';\n+import { getTableId, getTable } from '../reducers/tables';\n+\n+import {\n+  updateTableSelection,\n+  deselectTableItems,\n+  collapseTableRow,\n+} from '../actions/TableActions';\n+import { showIncludedView } from '../actions/ViewActions';\n+import { openModal } from '../actions/WindowActions';\n+\n+import { containerPropTypes } from '../utils/tableHelpers';\n+import { mapIncluded } from '../utils/documentListHelper';\n+\n+import Table from '../components/table/Table';\n+\n+class TableContainer extends PureComponent {\n+  componentWillUnmount() {\n+    const {\n+      showIncludedView,\n+      viewId,\n+      windowId,\n+      isIncluded,\n+      isModal,\n+    } = this.props;\n+\n+    if (!isIncluded) {\n+      const identifier = isModal ? viewId : windowId;\n+\n+      showIncludedView({\n+        id: identifier,\n+        showIncludedView: false,\n+        windowId,\n+        viewId,\n+      });\n+    }\n+  }\n+\n+  getAllLeaves = () => {\n+    const { rows, selected } = this.props;\n+    let leafs = [];\n+    let leafsIds = [];\n+\n+    rows.map((item) => {\n+      if (item.id === selected[0]) {\n+        leafs = mapIncluded(item);\n+      }\n+    });\n+\n+    leafs.map((item) => {\n+      leafsIds = leafsIds.concat(item.id);\n+    });\n+\n+    this.handleSelect(leafsIds);\n+  };\n+\n+  handleSelect = (ids, cb) => {\n+    const {\n+      updateTableSelection,\n+      windowId,\n+      viewId,\n+      docId,\n+      tabId,\n+      keyProperty,\n+    } = this.props;\n+    let newSelected = [];\n+\n+    if (ids) {\n+      if (!ids.splice) {\n+        newSelected = [ids];\n+      } else {\n+        newSelected = ids;\n+      }\n+    }\n+\n+    updateTableSelection(\n+      getTableId({ windowId, viewId, docId, tabId }),\n+      newSelected,\n+      keyProperty\n+    ).then(() => {\n+      cb && cb();\n+    });\n+\n+    return newSelected;\n+  };\n+\n+  handleSelectAll = () => {\n+    const { keyProperty, rows } = this.props;\n+    const property = keyProperty ? keyProperty : 'rowId';\n+    const toSelect = rows.map((item) => item[property]);\n+\n+    this.handleSelect(toSelect);\n+  };\n+\n+  handleDeselect = (id) => {\n+    const { deselectTableItems, windowId, viewId, selected } = this.props;\n+    const tableId = getTableId({ windowId, viewId });\n+    const index = selected.indexOf(id);\n+\n+    // TODO: Do we need this returned value ? Maybe we can handle\n+    // this in redux only?\n+    const newSelected = update(selected, { $splice: [[index, 1]] });\n+\n+    if (!newSelected.length) {\n+      deselectTableItems(tableId, [id]);\n+    }\n+\n+    return newSelected;\n+  };\n+\n+  handleDeselectAll = (callback) => {\n+    const { deselectTableItems, windowId, viewId, docId, tabId } = this.props;\n+\n+    callback && callback();\n+\n+    deselectTableItems(getTableId({ windowId, viewId, docId, tabId }), []);\n+  };\n+\n+  // TODO: This reallydoesn't do anything. Check if it's still a valid solution\n+  handleItemChange = () => {\n+    const { onRowEdited } = this.props;\n+\n+    onRowEdited && onRowEdited(true);\n+  };\n+\n+  openTableModal = () => {\n+    const { openModal, windowId, tabId } = this.props;\n+\n+    openModal('Add new', windowId, 'window', tabId, 'NEW');\n+  };\n+\n+  /**\n+   * @method handleAdvancedEdit\n+   * @summary Handles advanced edit - i.e case when ALT+E key combinations are being used\n+   *          Active only on subtables\n+   */\n+  handleAdvancedEdit = () => {\n+    const { openModal, windowId, tabId, docId, selected } = this.props;\n+\n+    if (docId) {\n+      openModal('Advanced edit', windowId, 'window', tabId, selected[0], true);\n+    }\n+  };\n+\n+  handlePromptSubmit = (selected) => {\n+    const { windowId, docId, updateDocList, tabId } = this.props;\n+\n+    this.handleSelect();\n+\n+    // TODO: This should be an action creator\n+    deleteRequest(\n+      'window',\n+      windowId,\n+      docId ? docId : null,\n+      docId ? tabId : null,\n+      selected\n+    ).then(() => {\n+      if (!docId) {\n+        updateDocList();\n+      }\n+    });\n+  };\n+\n+  handleZoomInto = (fieldName) => {\n+    const { entity, windowId, docId, tabId, viewId, selected } = this.props;\n+\n+    getZoomIntoWindow(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "075ac3cfc22846ce0ba1d9db93541309d5c77862"}, "originalPosition": 171}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM4MTAzNw==", "bodyText": "Same as above.", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r439381037", "createdAt": "2020-06-12T12:11:10Z", "author": {"login": "siemiatj"}, "path": "frontend/src/containers/Table.js", "diffHunk": "@@ -0,0 +1,268 @@\n+import update from 'immutability-helper';\n+import React, { PureComponent } from 'react';\n+import { connect } from 'react-redux';\n+\n+import { getZoomIntoWindow, deleteRequest } from '../api';\n+import { getTableId, getTable } from '../reducers/tables';\n+\n+import {\n+  updateTableSelection,\n+  deselectTableItems,\n+  collapseTableRow,\n+} from '../actions/TableActions';\n+import { showIncludedView } from '../actions/ViewActions';\n+import { openModal } from '../actions/WindowActions';\n+\n+import { containerPropTypes } from '../utils/tableHelpers';\n+import { mapIncluded } from '../utils/documentListHelper';\n+\n+import Table from '../components/table/Table';\n+\n+class TableContainer extends PureComponent {\n+  componentWillUnmount() {\n+    const {\n+      showIncludedView,\n+      viewId,\n+      windowId,\n+      isIncluded,\n+      isModal,\n+    } = this.props;\n+\n+    if (!isIncluded) {\n+      const identifier = isModal ? viewId : windowId;\n+\n+      showIncludedView({\n+        id: identifier,\n+        showIncludedView: false,\n+        windowId,\n+        viewId,\n+      });\n+    }\n+  }\n+\n+  getAllLeaves = () => {\n+    const { rows, selected } = this.props;\n+    let leafs = [];\n+    let leafsIds = [];\n+\n+    rows.map((item) => {\n+      if (item.id === selected[0]) {\n+        leafs = mapIncluded(item);\n+      }\n+    });\n+\n+    leafs.map((item) => {\n+      leafsIds = leafsIds.concat(item.id);\n+    });\n+\n+    this.handleSelect(leafsIds);\n+  };\n+\n+  handleSelect = (ids, cb) => {\n+    const {\n+      updateTableSelection,\n+      windowId,\n+      viewId,\n+      docId,\n+      tabId,\n+      keyProperty,\n+    } = this.props;\n+    let newSelected = [];\n+\n+    if (ids) {\n+      if (!ids.splice) {\n+        newSelected = [ids];\n+      } else {\n+        newSelected = ids;\n+      }\n+    }\n+\n+    updateTableSelection(\n+      getTableId({ windowId, viewId, docId, tabId }),\n+      newSelected,\n+      keyProperty\n+    ).then(() => {\n+      cb && cb();\n+    });\n+\n+    return newSelected;\n+  };\n+\n+  handleSelectAll = () => {\n+    const { keyProperty, rows } = this.props;\n+    const property = keyProperty ? keyProperty : 'rowId';\n+    const toSelect = rows.map((item) => item[property]);\n+\n+    this.handleSelect(toSelect);\n+  };\n+\n+  handleDeselect = (id) => {\n+    const { deselectTableItems, windowId, viewId, selected } = this.props;\n+    const tableId = getTableId({ windowId, viewId });\n+    const index = selected.indexOf(id);\n+\n+    // TODO: Do we need this returned value ? Maybe we can handle\n+    // this in redux only?\n+    const newSelected = update(selected, { $splice: [[index, 1]] });\n+\n+    if (!newSelected.length) {\n+      deselectTableItems(tableId, [id]);\n+    }\n+\n+    return newSelected;\n+  };\n+\n+  handleDeselectAll = (callback) => {\n+    const { deselectTableItems, windowId, viewId, docId, tabId } = this.props;\n+\n+    callback && callback();\n+\n+    deselectTableItems(getTableId({ windowId, viewId, docId, tabId }), []);\n+  };\n+\n+  // TODO: This reallydoesn't do anything. Check if it's still a valid solution\n+  handleItemChange = () => {\n+    const { onRowEdited } = this.props;\n+\n+    onRowEdited && onRowEdited(true);\n+  };\n+\n+  openTableModal = () => {\n+    const { openModal, windowId, tabId } = this.props;\n+\n+    openModal('Add new', windowId, 'window', tabId, 'NEW');\n+  };\n+\n+  /**\n+   * @method handleAdvancedEdit\n+   * @summary Handles advanced edit - i.e case when ALT+E key combinations are being used\n+   *          Active only on subtables\n+   */\n+  handleAdvancedEdit = () => {\n+    const { openModal, windowId, tabId, docId, selected } = this.props;\n+\n+    if (docId) {\n+      openModal('Advanced edit', windowId, 'window', tabId, selected[0], true);\n+    }\n+  };\n+\n+  handlePromptSubmit = (selected) => {\n+    const { windowId, docId, updateDocList, tabId } = this.props;\n+\n+    this.handleSelect();\n+\n+    // TODO: This should be an action creator\n+    deleteRequest(\n+      'window',\n+      windowId,\n+      docId ? docId : null,\n+      docId ? tabId : null,\n+      selected\n+    ).then(() => {\n+      if (!docId) {\n+        updateDocList();\n+      }\n+    });\n+  };\n+\n+  handleZoomInto = (fieldName) => {\n+    const { entity, windowId, docId, tabId, viewId, selected } = this.props;\n+\n+    getZoomIntoWindow(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc4MzUwNQ=="}, "originalCommit": {"oid": "075ac3cfc22846ce0ba1d9db93541309d5c77862"}, "originalPosition": 171}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzQ4MzYzOnYy", "diffSide": "RIGHT", "path": "frontend/src/containers/Table.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzozNzoyM1rOGide2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxNDozMjoxM1rOGjGPDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc4NzgwMw==", "bodyText": "This is not quite reliable to get the language. I found out that the most reliable way is from the localStore where it is set as a result of the call to getSession.  See ex: https://github.com/metasfresh/metasfresh/pull/6824/files#diff-858b40143f05e165f6bc793cd0a6fa32R303", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438787803", "createdAt": "2020-06-11T13:37:23Z", "author": {"login": "petrican"}, "path": "frontend/src/containers/Table.js", "diffHunk": "@@ -0,0 +1,268 @@\n+import update from 'immutability-helper';\n+import React, { PureComponent } from 'react';\n+import { connect } from 'react-redux';\n+\n+import { getZoomIntoWindow, deleteRequest } from '../api';\n+import { getTableId, getTable } from '../reducers/tables';\n+\n+import {\n+  updateTableSelection,\n+  deselectTableItems,\n+  collapseTableRow,\n+} from '../actions/TableActions';\n+import { showIncludedView } from '../actions/ViewActions';\n+import { openModal } from '../actions/WindowActions';\n+\n+import { containerPropTypes } from '../utils/tableHelpers';\n+import { mapIncluded } from '../utils/documentListHelper';\n+\n+import Table from '../components/table/Table';\n+\n+class TableContainer extends PureComponent {\n+  componentWillUnmount() {\n+    const {\n+      showIncludedView,\n+      viewId,\n+      windowId,\n+      isIncluded,\n+      isModal,\n+    } = this.props;\n+\n+    if (!isIncluded) {\n+      const identifier = isModal ? viewId : windowId;\n+\n+      showIncludedView({\n+        id: identifier,\n+        showIncludedView: false,\n+        windowId,\n+        viewId,\n+      });\n+    }\n+  }\n+\n+  getAllLeaves = () => {\n+    const { rows, selected } = this.props;\n+    let leafs = [];\n+    let leafsIds = [];\n+\n+    rows.map((item) => {\n+      if (item.id === selected[0]) {\n+        leafs = mapIncluded(item);\n+      }\n+    });\n+\n+    leafs.map((item) => {\n+      leafsIds = leafsIds.concat(item.id);\n+    });\n+\n+    this.handleSelect(leafsIds);\n+  };\n+\n+  handleSelect = (ids, cb) => {\n+    const {\n+      updateTableSelection,\n+      windowId,\n+      viewId,\n+      docId,\n+      tabId,\n+      keyProperty,\n+    } = this.props;\n+    let newSelected = [];\n+\n+    if (ids) {\n+      if (!ids.splice) {\n+        newSelected = [ids];\n+      } else {\n+        newSelected = ids;\n+      }\n+    }\n+\n+    updateTableSelection(\n+      getTableId({ windowId, viewId, docId, tabId }),\n+      newSelected,\n+      keyProperty\n+    ).then(() => {\n+      cb && cb();\n+    });\n+\n+    return newSelected;\n+  };\n+\n+  handleSelectAll = () => {\n+    const { keyProperty, rows } = this.props;\n+    const property = keyProperty ? keyProperty : 'rowId';\n+    const toSelect = rows.map((item) => item[property]);\n+\n+    this.handleSelect(toSelect);\n+  };\n+\n+  handleDeselect = (id) => {\n+    const { deselectTableItems, windowId, viewId, selected } = this.props;\n+    const tableId = getTableId({ windowId, viewId });\n+    const index = selected.indexOf(id);\n+\n+    // TODO: Do we need this returned value ? Maybe we can handle\n+    // this in redux only?\n+    const newSelected = update(selected, { $splice: [[index, 1]] });\n+\n+    if (!newSelected.length) {\n+      deselectTableItems(tableId, [id]);\n+    }\n+\n+    return newSelected;\n+  };\n+\n+  handleDeselectAll = (callback) => {\n+    const { deselectTableItems, windowId, viewId, docId, tabId } = this.props;\n+\n+    callback && callback();\n+\n+    deselectTableItems(getTableId({ windowId, viewId, docId, tabId }), []);\n+  };\n+\n+  // TODO: This reallydoesn't do anything. Check if it's still a valid solution\n+  handleItemChange = () => {\n+    const { onRowEdited } = this.props;\n+\n+    onRowEdited && onRowEdited(true);\n+  };\n+\n+  openTableModal = () => {\n+    const { openModal, windowId, tabId } = this.props;\n+\n+    openModal('Add new', windowId, 'window', tabId, 'NEW');\n+  };\n+\n+  /**\n+   * @method handleAdvancedEdit\n+   * @summary Handles advanced edit - i.e case when ALT+E key combinations are being used\n+   *          Active only on subtables\n+   */\n+  handleAdvancedEdit = () => {\n+    const { openModal, windowId, tabId, docId, selected } = this.props;\n+\n+    if (docId) {\n+      openModal('Advanced edit', windowId, 'window', tabId, selected[0], true);\n+    }\n+  };\n+\n+  handlePromptSubmit = (selected) => {\n+    const { windowId, docId, updateDocList, tabId } = this.props;\n+\n+    this.handleSelect();\n+\n+    // TODO: This should be an action creator\n+    deleteRequest(\n+      'window',\n+      windowId,\n+      docId ? docId : null,\n+      docId ? tabId : null,\n+      selected\n+    ).then(() => {\n+      if (!docId) {\n+        updateDocList();\n+      }\n+    });\n+  };\n+\n+  handleZoomInto = (fieldName) => {\n+    const { entity, windowId, docId, tabId, viewId, selected } = this.props;\n+\n+    getZoomIntoWindow(\n+      entity,\n+      windowId,\n+      docId,\n+      entity === 'window' ? tabId : viewId,\n+      selected[0],\n+      fieldName\n+    ).then((res) => {\n+      res &&\n+        res.data &&\n+        window.open(\n+          `/window/${res.data.documentPath.windowId}/${\n+            res.data.documentPath.documentId\n+          }`,\n+          '_blank'\n+        );\n+    });\n+  };\n+\n+  handleRowCollapse = (node, collapse) => {\n+    const { collapseTableRow, windowId, viewId, tabId, docId } = this.props;\n+    const tableId = getTableId({ windowId, viewId, docId, tabId });\n+\n+    collapseTableRow({ tableId, collapse, node });\n+  };\n+\n+  render() {\n+    return (\n+      <Table\n+        {...this.props}\n+        onHandleZoomInto={this.handleZoomInto}\n+        onPromptSubmit={this.handlePromptSubmit}\n+        onItemChange={this.handleItemChange}\n+        onSelect={this.handleSelect}\n+        onSelectAll={this.handleSelectAll}\n+        onDeselectAll={this.handleDeselectAll}\n+        onDeselect={this.handleDeselect}\n+        onRowCollapse={this.handleRowCollapse}\n+        onGetAllLeaves={this.getAllLeaves}\n+        onHandleAdvancedEdit={this.handleAdvancedEdit}\n+        onOpenTableModal={this.openTableModal}\n+      />\n+    );\n+  }\n+}\n+\n+TableContainer.propTypes = containerPropTypes;\n+\n+const mapStateToProps = (state, props) => {\n+  const { windowId, docId, tabId, viewId } = props;\n+  const tableId = getTableId({ windowId, viewId, docId, tabId });\n+  const table = getTable(state, tableId);\n+  const modalVisible = state.windowHandler.modal.visible;\n+  let handleShortcuts = state.windowHandler.allowShortcut;\n+\n+  // we don't have to worry about shortcuts if table is behind a modal\n+  if (modalVisible && !props.isModal) {\n+    handleShortcuts = false;\n+  }\n+\n+  return {\n+    rows: table.rows,\n+    columns: table.columns,\n+    selected: table.selected,\n+    pending: table.dataPending,\n+    collapsedParentRows: table.collapsedParentRows,\n+    collapsedRows: table.collapsedRows,\n+    collapsedArrayMap: table.collapsedArrayMap,\n+    activeSort: table.activeSort,\n+    emptyText: table.emptyText,\n+    emptyHint: table.emptyHint,\n+    indentSupported: table.indentSupported,\n+    collapsible: table.collapsible,\n+    keyProperty: table.keyProperty,\n+    size: table.size,\n+    allowShortcut: handleShortcuts,\n+    allowOutsideClick: state.windowHandler.allowOutsideClick,\n+    modalVisible,\n+    isGerman:\n+      state.appHandler.me.language && state.appHandler.me.language.key", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "075ac3cfc22846ce0ba1d9db93541309d5c77862"}, "originalPosition": 250}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ1NTUwMw==", "bodyText": "This is not in BIG_BANG yet, so I can update that after I'll rebase it with master.", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r439455503", "createdAt": "2020-06-12T14:32:13Z", "author": {"login": "siemiatj"}, "path": "frontend/src/containers/Table.js", "diffHunk": "@@ -0,0 +1,268 @@\n+import update from 'immutability-helper';\n+import React, { PureComponent } from 'react';\n+import { connect } from 'react-redux';\n+\n+import { getZoomIntoWindow, deleteRequest } from '../api';\n+import { getTableId, getTable } from '../reducers/tables';\n+\n+import {\n+  updateTableSelection,\n+  deselectTableItems,\n+  collapseTableRow,\n+} from '../actions/TableActions';\n+import { showIncludedView } from '../actions/ViewActions';\n+import { openModal } from '../actions/WindowActions';\n+\n+import { containerPropTypes } from '../utils/tableHelpers';\n+import { mapIncluded } from '../utils/documentListHelper';\n+\n+import Table from '../components/table/Table';\n+\n+class TableContainer extends PureComponent {\n+  componentWillUnmount() {\n+    const {\n+      showIncludedView,\n+      viewId,\n+      windowId,\n+      isIncluded,\n+      isModal,\n+    } = this.props;\n+\n+    if (!isIncluded) {\n+      const identifier = isModal ? viewId : windowId;\n+\n+      showIncludedView({\n+        id: identifier,\n+        showIncludedView: false,\n+        windowId,\n+        viewId,\n+      });\n+    }\n+  }\n+\n+  getAllLeaves = () => {\n+    const { rows, selected } = this.props;\n+    let leafs = [];\n+    let leafsIds = [];\n+\n+    rows.map((item) => {\n+      if (item.id === selected[0]) {\n+        leafs = mapIncluded(item);\n+      }\n+    });\n+\n+    leafs.map((item) => {\n+      leafsIds = leafsIds.concat(item.id);\n+    });\n+\n+    this.handleSelect(leafsIds);\n+  };\n+\n+  handleSelect = (ids, cb) => {\n+    const {\n+      updateTableSelection,\n+      windowId,\n+      viewId,\n+      docId,\n+      tabId,\n+      keyProperty,\n+    } = this.props;\n+    let newSelected = [];\n+\n+    if (ids) {\n+      if (!ids.splice) {\n+        newSelected = [ids];\n+      } else {\n+        newSelected = ids;\n+      }\n+    }\n+\n+    updateTableSelection(\n+      getTableId({ windowId, viewId, docId, tabId }),\n+      newSelected,\n+      keyProperty\n+    ).then(() => {\n+      cb && cb();\n+    });\n+\n+    return newSelected;\n+  };\n+\n+  handleSelectAll = () => {\n+    const { keyProperty, rows } = this.props;\n+    const property = keyProperty ? keyProperty : 'rowId';\n+    const toSelect = rows.map((item) => item[property]);\n+\n+    this.handleSelect(toSelect);\n+  };\n+\n+  handleDeselect = (id) => {\n+    const { deselectTableItems, windowId, viewId, selected } = this.props;\n+    const tableId = getTableId({ windowId, viewId });\n+    const index = selected.indexOf(id);\n+\n+    // TODO: Do we need this returned value ? Maybe we can handle\n+    // this in redux only?\n+    const newSelected = update(selected, { $splice: [[index, 1]] });\n+\n+    if (!newSelected.length) {\n+      deselectTableItems(tableId, [id]);\n+    }\n+\n+    return newSelected;\n+  };\n+\n+  handleDeselectAll = (callback) => {\n+    const { deselectTableItems, windowId, viewId, docId, tabId } = this.props;\n+\n+    callback && callback();\n+\n+    deselectTableItems(getTableId({ windowId, viewId, docId, tabId }), []);\n+  };\n+\n+  // TODO: This reallydoesn't do anything. Check if it's still a valid solution\n+  handleItemChange = () => {\n+    const { onRowEdited } = this.props;\n+\n+    onRowEdited && onRowEdited(true);\n+  };\n+\n+  openTableModal = () => {\n+    const { openModal, windowId, tabId } = this.props;\n+\n+    openModal('Add new', windowId, 'window', tabId, 'NEW');\n+  };\n+\n+  /**\n+   * @method handleAdvancedEdit\n+   * @summary Handles advanced edit - i.e case when ALT+E key combinations are being used\n+   *          Active only on subtables\n+   */\n+  handleAdvancedEdit = () => {\n+    const { openModal, windowId, tabId, docId, selected } = this.props;\n+\n+    if (docId) {\n+      openModal('Advanced edit', windowId, 'window', tabId, selected[0], true);\n+    }\n+  };\n+\n+  handlePromptSubmit = (selected) => {\n+    const { windowId, docId, updateDocList, tabId } = this.props;\n+\n+    this.handleSelect();\n+\n+    // TODO: This should be an action creator\n+    deleteRequest(\n+      'window',\n+      windowId,\n+      docId ? docId : null,\n+      docId ? tabId : null,\n+      selected\n+    ).then(() => {\n+      if (!docId) {\n+        updateDocList();\n+      }\n+    });\n+  };\n+\n+  handleZoomInto = (fieldName) => {\n+    const { entity, windowId, docId, tabId, viewId, selected } = this.props;\n+\n+    getZoomIntoWindow(\n+      entity,\n+      windowId,\n+      docId,\n+      entity === 'window' ? tabId : viewId,\n+      selected[0],\n+      fieldName\n+    ).then((res) => {\n+      res &&\n+        res.data &&\n+        window.open(\n+          `/window/${res.data.documentPath.windowId}/${\n+            res.data.documentPath.documentId\n+          }`,\n+          '_blank'\n+        );\n+    });\n+  };\n+\n+  handleRowCollapse = (node, collapse) => {\n+    const { collapseTableRow, windowId, viewId, tabId, docId } = this.props;\n+    const tableId = getTableId({ windowId, viewId, docId, tabId });\n+\n+    collapseTableRow({ tableId, collapse, node });\n+  };\n+\n+  render() {\n+    return (\n+      <Table\n+        {...this.props}\n+        onHandleZoomInto={this.handleZoomInto}\n+        onPromptSubmit={this.handlePromptSubmit}\n+        onItemChange={this.handleItemChange}\n+        onSelect={this.handleSelect}\n+        onSelectAll={this.handleSelectAll}\n+        onDeselectAll={this.handleDeselectAll}\n+        onDeselect={this.handleDeselect}\n+        onRowCollapse={this.handleRowCollapse}\n+        onGetAllLeaves={this.getAllLeaves}\n+        onHandleAdvancedEdit={this.handleAdvancedEdit}\n+        onOpenTableModal={this.openTableModal}\n+      />\n+    );\n+  }\n+}\n+\n+TableContainer.propTypes = containerPropTypes;\n+\n+const mapStateToProps = (state, props) => {\n+  const { windowId, docId, tabId, viewId } = props;\n+  const tableId = getTableId({ windowId, viewId, docId, tabId });\n+  const table = getTable(state, tableId);\n+  const modalVisible = state.windowHandler.modal.visible;\n+  let handleShortcuts = state.windowHandler.allowShortcut;\n+\n+  // we don't have to worry about shortcuts if table is behind a modal\n+  if (modalVisible && !props.isModal) {\n+    handleShortcuts = false;\n+  }\n+\n+  return {\n+    rows: table.rows,\n+    columns: table.columns,\n+    selected: table.selected,\n+    pending: table.dataPending,\n+    collapsedParentRows: table.collapsedParentRows,\n+    collapsedRows: table.collapsedRows,\n+    collapsedArrayMap: table.collapsedArrayMap,\n+    activeSort: table.activeSort,\n+    emptyText: table.emptyText,\n+    emptyHint: table.emptyHint,\n+    indentSupported: table.indentSupported,\n+    collapsible: table.collapsible,\n+    keyProperty: table.keyProperty,\n+    size: table.size,\n+    allowShortcut: handleShortcuts,\n+    allowOutsideClick: state.windowHandler.allowOutsideClick,\n+    modalVisible,\n+    isGerman:\n+      state.appHandler.me.language && state.appHandler.me.language.key", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc4NzgwMw=="}, "originalCommit": {"oid": "075ac3cfc22846ce0ba1d9db93541309d5c77862"}, "originalPosition": 250}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzU3OTk3OnYy", "diffSide": "RIGHT", "path": "frontend/src/reducers/viewHandler.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzo1MzoyNlrOGieaLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMDo1ODoxNlrOGi_4QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwMjk4OA==", "bodyText": "Not sure I understand why this is being removed. Pls explain", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438802988", "createdAt": "2020-06-11T13:53:26Z", "author": {"login": "petrican"}, "path": "frontend/src/reducers/viewHandler.js", "diffHunk": "@@ -163,7 +160,7 @@ export default function viewHandler(state = initialState, action) {\n           firstRow,\n           headerProperties,\n           pageLength,\n-          result,\n+          // result,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "075ac3cfc22846ce0ba1d9db93541309d5c77862"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM1MTM2MQ==", "bodyText": "because we have rows in the tables reducer.", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r439351361", "createdAt": "2020-06-12T10:58:16Z", "author": {"login": "siemiatj"}, "path": "frontend/src/reducers/viewHandler.js", "diffHunk": "@@ -163,7 +160,7 @@ export default function viewHandler(state = initialState, action) {\n           firstRow,\n           headerProperties,\n           pageLength,\n-          result,\n+          // result,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwMjk4OA=="}, "originalCommit": {"oid": "075ac3cfc22846ce0ba1d9db93541309d5c77862"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzU4OTI5OnYy", "diffSide": "RIGHT", "path": "frontend/src/reducers/viewHandler.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzo1NTowNFrOGiegCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQxMTo0ODo0N1rOGjBJTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwNDQ5MQ==", "bodyText": "why do we have isShowIncluded and also hasShowIncluded with the same value. Couldn't we just use one of them ?", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r438804491", "createdAt": "2020-06-11T13:55:04Z", "author": {"login": "petrican"}, "path": "frontend/src/reducers/viewHandler.js", "diffHunk": "@@ -399,6 +377,23 @@ export default function viewHandler(state = initialState, action) {\n       };\n     }\n \n+    case TOGGLE_INCLUDED_VIEW: {\n+      const { id, showIncludedView } = action.payload;\n+      const view = getLocalView(state, id);\n+\n+      return {\n+        ...state,\n+        views: {\n+          ...state.views,\n+          [`${id}`]: {\n+            ...view,\n+            isShowIncluded: !!showIncludedView,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "075ac3cfc22846ce0ba1d9db93541309d5c77862"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM3MjExMA==", "bodyText": "I have no idea. Looks like some hack from the old days. I did not wanted to touch it, since it's not in the Table component but looks to be safe.", "url": "https://github.com/metasfresh/metasfresh/pull/6772#discussion_r439372110", "createdAt": "2020-06-12T11:48:47Z", "author": {"login": "siemiatj"}, "path": "frontend/src/reducers/viewHandler.js", "diffHunk": "@@ -399,6 +377,23 @@ export default function viewHandler(state = initialState, action) {\n       };\n     }\n \n+    case TOGGLE_INCLUDED_VIEW: {\n+      const { id, showIncludedView } = action.payload;\n+      const view = getLocalView(state, id);\n+\n+      return {\n+        ...state,\n+        views: {\n+          ...state.views,\n+          [`${id}`]: {\n+            ...view,\n+            isShowIncluded: !!showIncludedView,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwNDQ5MQ=="}, "originalCommit": {"oid": "075ac3cfc22846ce0ba1d9db93541309d5c77862"}, "originalPosition": 128}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1452, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}