{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5OTY5ODE4", "number": 7157, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMDo1OTo1M1rOEZ7Oug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMTowMjowNlrOEZ7R0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NjIwMjgyOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/calendar/impl/CalendarBL.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMDo1OTo1M1rOHDCLXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMTo0MzozMlrOHDDkfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk0MzQ1Mw==", "bodyText": "lines 241:253 shall be a DAO method", "url": "https://github.com/metasfresh/metasfresh/pull/7157#discussion_r472943453", "createdAt": "2020-08-19T10:59:53Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/calendar/impl/CalendarBL.java", "diffHunk": "@@ -214,4 +227,29 @@ public IBusinessDayMatcher createBusinessDayMatcherExcluding(final Set<DayOfWeek\n \t\t\t\t.excludeWeekendDays(excludeWeekendDays)\n \t\t\t\t.build();\n \t}\n+\n+\t@Override\n+\t@NonNull\n+\tpublic CalendarId getOrgCalendarOrDefault(final @NonNull OrgId orgId)\n+\t{\n+\t\tfinal OrgInfo orgInfo = orgDAO.getOrgInfoByIdInTrx(orgId);\n+\t\tif (orgInfo.getCalendarId() != null)\n+\t\t{\n+\t\t\treturn orgInfo.getCalendarId();\n+\t\t}\n+\n+\t\tfinal I_C_Calendar calendar = queryBL.createQueryBuilder(I_C_Calendar.class)\n+\t\t\t\t.addEqualsFilter(I_C_Calendar.COLUMNNAME_IsDefault, true)\n+\t\t\t\t.addInArrayFilter(I_C_Calendar.COLUMNNAME_AD_Org_ID, ImmutableList.of(orgId, OrgId.ANY))\n+\t\t\t\t.orderByDescending(I_C_Calendar.COLUMNNAME_AD_Org_ID)\n+\t\t\t\t.create()\n+\t\t\t\t.first();\n+\n+\t\tif (calendar == null)\n+\t\t{\n+\t\t\tthrow new AdempiereException(MSG_SET_DEFAULT_OR_ORG_CALENDAR);\n+\t\t}\n+\n+\t\treturn CalendarId.ofRepoId(calendar.getC_Calendar_ID());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk0NjM5Nw==", "bodyText": "hehe, initially i created it in DAO, then moved it here since i believed it should not be duplicated", "url": "https://github.com/metasfresh/metasfresh/pull/7157#discussion_r472946397", "createdAt": "2020-08-19T11:05:26Z", "author": {"login": "TheBestPessimist"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/calendar/impl/CalendarBL.java", "diffHunk": "@@ -214,4 +227,29 @@ public IBusinessDayMatcher createBusinessDayMatcherExcluding(final Set<DayOfWeek\n \t\t\t\t.excludeWeekendDays(excludeWeekendDays)\n \t\t\t\t.build();\n \t}\n+\n+\t@Override\n+\t@NonNull\n+\tpublic CalendarId getOrgCalendarOrDefault(final @NonNull OrgId orgId)\n+\t{\n+\t\tfinal OrgInfo orgInfo = orgDAO.getOrgInfoByIdInTrx(orgId);\n+\t\tif (orgInfo.getCalendarId() != null)\n+\t\t{\n+\t\t\treturn orgInfo.getCalendarId();\n+\t\t}\n+\n+\t\tfinal I_C_Calendar calendar = queryBL.createQueryBuilder(I_C_Calendar.class)\n+\t\t\t\t.addEqualsFilter(I_C_Calendar.COLUMNNAME_IsDefault, true)\n+\t\t\t\t.addInArrayFilter(I_C_Calendar.COLUMNNAME_AD_Org_ID, ImmutableList.of(orgId, OrgId.ANY))\n+\t\t\t\t.orderByDescending(I_C_Calendar.COLUMNNAME_AD_Org_ID)\n+\t\t\t\t.create()\n+\t\t\t\t.first();\n+\n+\t\tif (calendar == null)\n+\t\t{\n+\t\t\tthrow new AdempiereException(MSG_SET_DEFAULT_OR_ORG_CALENDAR);\n+\t\t}\n+\n+\t\treturn CalendarId.ofRepoId(calendar.getC_Calendar_ID());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk0MzQ1Mw=="}, "originalCommit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk2NjI2OA==", "bodyText": "done", "url": "https://github.com/metasfresh/metasfresh/pull/7157#discussion_r472966268", "createdAt": "2020-08-19T11:43:32Z", "author": {"login": "TheBestPessimist"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/calendar/impl/CalendarBL.java", "diffHunk": "@@ -214,4 +227,29 @@ public IBusinessDayMatcher createBusinessDayMatcherExcluding(final Set<DayOfWeek\n \t\t\t\t.excludeWeekendDays(excludeWeekendDays)\n \t\t\t\t.build();\n \t}\n+\n+\t@Override\n+\t@NonNull\n+\tpublic CalendarId getOrgCalendarOrDefault(final @NonNull OrgId orgId)\n+\t{\n+\t\tfinal OrgInfo orgInfo = orgDAO.getOrgInfoByIdInTrx(orgId);\n+\t\tif (orgInfo.getCalendarId() != null)\n+\t\t{\n+\t\t\treturn orgInfo.getCalendarId();\n+\t\t}\n+\n+\t\tfinal I_C_Calendar calendar = queryBL.createQueryBuilder(I_C_Calendar.class)\n+\t\t\t\t.addEqualsFilter(I_C_Calendar.COLUMNNAME_IsDefault, true)\n+\t\t\t\t.addInArrayFilter(I_C_Calendar.COLUMNNAME_AD_Org_ID, ImmutableList.of(orgId, OrgId.ANY))\n+\t\t\t\t.orderByDescending(I_C_Calendar.COLUMNNAME_AD_Org_ID)\n+\t\t\t\t.create()\n+\t\t\t\t.first();\n+\n+\t\tif (calendar == null)\n+\t\t{\n+\t\t\tthrow new AdempiereException(MSG_SET_DEFAULT_OR_ORG_CALENDAR);\n+\t\t}\n+\n+\t\treturn CalendarId.ofRepoId(calendar.getC_Calendar_ID());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk0MzQ1Mw=="}, "originalCommit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc"}, "originalPosition": 121}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NjIwOTIwOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/calendar/impl/CalendarDAO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMTowMTozMlrOHDCPKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMTo0NTo0OFrOHDDpPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk0NDQyNA==", "bodyText": "u can use org.compiere.model.IQuery.listDistinct(String, Class<AT>).", "url": "https://github.com/metasfresh/metasfresh/pull/7157#discussion_r472944424", "createdAt": "2020-08-19T11:01:32Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/calendar/impl/CalendarDAO.java", "diffHunk": "@@ -119,4 +127,22 @@ public I_C_Period retrieveLastPeriodOfTheYear(final I_C_Year year)\n \t\t\t\t.setOrderBy(I_C_Period.COLUMNNAME_StartDate + \" DESC \")\n \t\t\t\t.first(I_C_Period.class);\n \t}\n+\n+\t@Nullable\n+\t@Override\n+\tpublic String getName(final CalendarId calendarId)\n+\t{\n+\t\tfinal List<Map<String, Object>> calendarNames = queryBL.createQueryBuilder(I_C_Calendar.class)\n+\t\t\t\t.addOnlyActiveRecordsFilter()\n+\t\t\t\t.addEqualsFilter(I_C_Calendar.COLUMNNAME_C_Calendar_ID, calendarId)\n+\t\t\t\t.create()\n+\t\t\t\t.listColumns(I_C_Calendar.COLUMNNAME_Name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk2NzQ4Ng==", "bodyText": "done", "url": "https://github.com/metasfresh/metasfresh/pull/7157#discussion_r472967486", "createdAt": "2020-08-19T11:45:48Z", "author": {"login": "TheBestPessimist"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/calendar/impl/CalendarDAO.java", "diffHunk": "@@ -119,4 +127,22 @@ public I_C_Period retrieveLastPeriodOfTheYear(final I_C_Year year)\n \t\t\t\t.setOrderBy(I_C_Period.COLUMNNAME_StartDate + \" DESC \")\n \t\t\t\t.first(I_C_Period.class);\n \t}\n+\n+\t@Nullable\n+\t@Override\n+\tpublic String getName(final CalendarId calendarId)\n+\t{\n+\t\tfinal List<Map<String, Object>> calendarNames = queryBL.createQueryBuilder(I_C_Calendar.class)\n+\t\t\t\t.addOnlyActiveRecordsFilter()\n+\t\t\t\t.addEqualsFilter(I_C_Calendar.COLUMNNAME_C_Calendar_ID, calendarId)\n+\t\t\t\t.create()\n+\t\t\t\t.listColumns(I_C_Calendar.COLUMNNAME_Name);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk0NDQyNA=="}, "originalCommit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NjIxMDc0OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/calendar/impl/PlainCalendarDAO.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMTowMjowNlrOHDCQMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMjowNDoyNFrOHDEOqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk0NDY5MQ==", "bodyText": "why this method is needed?", "url": "https://github.com/metasfresh/metasfresh/pull/7157#discussion_r472944691", "createdAt": "2020-08-19T11:02:06Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/calendar/impl/PlainCalendarDAO.java", "diffHunk": "@@ -222,6 +224,18 @@ public I_C_Period retrieveLastPeriodOfTheYear(I_C_Year year)\n \t\treturn periods.get(periods.size() - 1);\n \t}\n \n+\t@Nullable\n+\t@Override\n+\tpublic String getName(final CalendarId calendarId)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk0NDcyNw==", "bodyText": "pls avoid it", "url": "https://github.com/metasfresh/metasfresh/pull/7157#discussion_r472944727", "createdAt": "2020-08-19T11:02:12Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/calendar/impl/PlainCalendarDAO.java", "diffHunk": "@@ -222,6 +224,18 @@ public I_C_Period retrieveLastPeriodOfTheYear(I_C_Year year)\n \t\treturn periods.get(periods.size() - 1);\n \t}\n \n+\t@Nullable\n+\t@Override\n+\tpublic String getName(final CalendarId calendarId)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk0NDY5MQ=="}, "originalCommit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk3NzA2Nw==", "bodyText": "done", "url": "https://github.com/metasfresh/metasfresh/pull/7157#discussion_r472977067", "createdAt": "2020-08-19T12:04:24Z", "author": {"login": "TheBestPessimist"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/calendar/impl/PlainCalendarDAO.java", "diffHunk": "@@ -222,6 +224,18 @@ public I_C_Period retrieveLastPeriodOfTheYear(I_C_Year year)\n \t\treturn periods.get(periods.size() - 1);\n \t}\n \n+\t@Nullable\n+\t@Override\n+\tpublic String getName(final CalendarId calendarId)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk0NDY5MQ=="}, "originalCommit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1374, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}