{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMjkyNTI1", "number": 7102, "title": "picking terminal details", "bodyText": "refs: #7101", "createdAt": "2020-08-05T10:26:02Z", "url": "https://github.com/metasfresh/metasfresh/pull/7102", "merged": true, "mergeCommit": {"oid": "ffae590ebeda21159a1c91ba8f76adea71baa8bc"}, "closed": true, "closedAt": "2020-08-05T13:40:25Z", "author": {"login": "pvpurcarcosmin"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc74mxlgH2gAyNDYzMjkyNTI1OjFkN2EzNWRjZGRhMjc4ZWQzNGY0MjJiNjI1YTNlNTU2MTI3NDUyZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc764mmAH2gAyNDYzMjkyNTI1OmZkNGZhZTA5YWViYWMxMmZjNWY1MzIzZGNlMmI1NjhiYjAyZTA5ODE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1d7a35dcdda278ed34f422b625a3e556127452eb", "author": {"user": {"login": "pvpurcarcosmin", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/1d7a35dcdda278ed34f422b625a3e556127452eb", "committedDate": "2020-08-05T10:24:39Z", "message": "picking terminal details\nrefs: https://github.com/metasfresh/metasfresh/issues/7101"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNjA1NTU5", "url": "https://github.com/metasfresh/metasfresh/pull/7102#pullrequestreview-461605559", "createdAt": "2020-08-05T12:14:35Z", "commit": {"oid": "1d7a35dcdda278ed34f422b625a3e556127452eb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMjoxNDozNVrOG8G_5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxMjoyMDoxN1rOG8HLbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY4MjQwNw==", "bodyText": "why not moving this class to PickingSlotViewFactory and make it private?", "url": "https://github.com/metasfresh/metasfresh/pull/7102#discussion_r465682407", "createdAt": "2020-08-05T12:14:35Z", "author": {"login": "teosarca"}, "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/picking/pickingslot/PickingSlotRepoQuery.java", "diffHunk": "@@ -71,4 +75,18 @@ private PickingSlotRepoQuery(\n \t\tthis.onlyNotClosedOrNotRackSystem = onlyNotClosedOrNotRackSystem != null ? onlyNotClosedOrNotRackSystem : true;\n \t\tthis.pickingSlotBarcode = pickingSlotBarcode;\n \t}\n+\n+\t@Value\n+\t@Builder\n+\tpublic static class CreatePickingSlotRepoQueryReq", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d7a35dcdda278ed34f422b625a3e556127452eb"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY4MzQ4MA==", "bodyText": "pls document why we need to invalidate its parent view too (packageable view)?", "url": "https://github.com/metasfresh/metasfresh/pull/7102#discussion_r465683480", "createdAt": "2020-08-05T12:16:39Z", "author": {"login": "teosarca"}, "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/picking/pickingslot/PickingSlotViewsIndexStorage.java", "diffHunk": "@@ -175,14 +172,21 @@ public void closeById(@NonNull final ViewId pickingSlotViewId, @NonNull final Vi\n \t}\n \n \t@Override\n-\tpublic void invalidateView(ViewId pickingSlotViewId)\n+\tpublic void invalidateView(final ViewId pickingSlotViewId)\n \t{\n \t\tfinal PickingSlotView pickingSlotView = getOrCreatePickingSlotView(pickingSlotViewId, false/* create */);\n \t\tif (pickingSlotView == null)\n \t\t{\n \t\t\treturn;\n \t\t}\n \n+\t\tfinal PackageableView packageableView = getPackageableViewByPickingSlotViewId(pickingSlotViewId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d7a35dcdda278ed34f422b625a3e556127452eb"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY4NTM1Ng==", "bodyText": "i think this error message applies only for productIds.size() != 1.\nFor the other part of the OR we need a different error message.", "url": "https://github.com/metasfresh/metasfresh/pull/7102#discussion_r465685356", "createdAt": "2020-08-05T12:20:17Z", "author": {"login": "teosarca"}, "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/picking/pickingslot/process/WEBUI_Picking_PickQtyToExistingHU.java", "diffHunk": "@@ -134,20 +130,24 @@ public Object getParameterDefaultValue(@NonNull final IProcessDefaultParameter p\n \tprotected void validatePickingToHU()\n \t{\n \t\tfinal PickingSlotRow pickingSlotRow = getSingleSelectedRow();\n-\n \t\tfinal I_M_HU hu = handlingUnitsBL.getById(pickingSlotRow.getHuId());\n \n-\t\tif (handlingUnitsBL.isVirtual(hu))\n+\t\tif (!handlingUnitsBL.isVirtual(hu))\n \t\t{\n-\t\t\tthrow new AdempiereException(msgBL.getTranslatableMsgText(MSG_WEBUI_PICKING_TO_EXISTING_CUS_NOT_ALLOWED));\n+\t\t\treturn;\n \t\t}\n \n-\t\tfinal OrderId orderIdOfThePickedHU = extractCorrespondingOrderId(pickingSlotRow.getHuId());\n-\t\tfinal OrderId orderIdOfTheCurrentSchedule = OrderId.ofRepoIdOrNull(getCurrentShipmentSchedule().getC_Order_ID());\n+\t\tfinal ImmutableSet<ProductId> productIds = handlingUnitsBL.getStorageFactory().streamHUProductStorages(ImmutableList.of(hu))\n+\t\t\t\t.map(IProductStorage::getProductId)\n+\t\t\t\t.collect(ImmutableSet.toImmutableSet());\n+\n+\t\tfinal I_M_ShipmentSchedule selectedShipmentSchedule = getCurrentShipmentSchedule();\n \n-\t\tif (!orderIdOfThePickedHU.equals(orderIdOfTheCurrentSchedule))\n+\t\tif (productIds.size() != 1 || !productIds.contains(ProductId.ofRepoId(selectedShipmentSchedule.getM_Product_ID())))\n \t\t{\n-\t\t\tthrow new AdempiereException(msgBL.getTranslatableMsgText(MSG_WEBUI_PICKING_TO_THE_SAME_HU_FOR_MULTIPLE_ORDERS_NOT_ALLOWED));\n+\t\t\tthrow new AdempiereException(\"VHUs cannot have multiple product storages!\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d7a35dcdda278ed34f422b625a3e556127452eb"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73d6b68efb25548619ab412053eee288d659278b", "author": {"user": {"login": "pvpurcarcosmin", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/73d6b68efb25548619ab412053eee288d659278b", "committedDate": "2020-08-05T12:41:57Z", "message": "sugg changes\nrefs: https://github.com/metasfresh/metasfresh/issues/7101"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd4fae09aebac12fc5f5323dce2b568bb02e0981", "author": {"user": {"login": "pvpurcarcosmin", "name": null}}, "url": "https://github.com/metasfresh/metasfresh/commit/fd4fae09aebac12fc5f5323dce2b568bb02e0981", "committedDate": "2020-08-05T13:03:56Z", "message": "test fix\nrefs: https://github.com/metasfresh/metasfresh/issues/7101"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3252, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}