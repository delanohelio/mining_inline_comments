{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzNDEyMjU0", "number": 6564, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMzowODoxMVrOD5zrEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMToxNjo1NFrOD6M9wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxOTQyMDM1OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/reflist/GetRefListRequest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMzowODoxMVrOGRSGJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMzoyOTo1NFrOGRTBrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc3NTQ2MA==", "bodyText": "can't this be immutable (=> @Value)?", "url": "https://github.com/metasfresh/metasfresh/pull/6564#discussion_r420775460", "createdAt": "2020-05-06T13:08:11Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/reflist/GetRefListRequest.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * #%L\n+ * de.metas.adempiere.adempiere.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.reflist;\n+\n+import lombok.Builder;\n+import lombok.Data;\n+import lombok.NonNull;\n+\n+@Data\n+@Builder\n+public class GetRefListRequest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f231baf075541e78209c3746b335fe6ef9c33e6"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc5MDcwMg==", "bodyText": "my bad, I had @Value in mind when I typed @Data", "url": "https://github.com/metasfresh/metasfresh/pull/6564#discussion_r420790702", "createdAt": "2020-05-06T13:29:54Z", "author": {"login": "pvpurcarcosmin"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/reflist/GetRefListRequest.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * #%L\n+ * de.metas.adempiere.adempiere.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.reflist;\n+\n+import lombok.Builder;\n+import lombok.Data;\n+import lombok.NonNull;\n+\n+@Data\n+@Builder\n+public class GetRefListRequest", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc3NTQ2MA=="}, "originalCommit": {"oid": "1f231baf075541e78209c3746b335fe6ef9c33e6"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxOTQyODM1OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/reflist/RefListRepository.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMzoxMDoxMVrOGRSLSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMzozNzoxNFrOGRTWnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc3Njc3OA==", "bodyText": "we have a unique constraint on AD_Reference_ID and Value ..\ni think for that reason, the lookup should be only by AD_Reference_ID and Value AFAIS. and \"name\" should not be part of the key.", "url": "https://github.com/metasfresh/metasfresh/pull/6564#discussion_r420776778", "createdAt": "2020-05-06T13:10:11Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/reflist/RefListRepository.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * #%L\n+ * de.metas.adempiere.adempiere.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.reflist;\n+\n+import de.metas.organization.OrgId;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.dao.IQueryBL;\n+import org.compiere.model.I_AD_Ref_List;\n+import org.springframework.stereotype.Repository;\n+\n+import java.util.Optional;\n+\n+import static org.adempiere.model.InterfaceWrapperHelper.loadOrNew;\n+import static org.adempiere.model.InterfaceWrapperHelper.saveRecord;\n+\n+@Repository\n+public class RefListRepository\n+{\n+\tprivate final IQueryBL queryBL = Services.get(IQueryBL.class);\n+\n+\tpublic RefListId save(@NonNull final RefList refList)\n+\t{\n+\t\tfinal I_AD_Ref_List record = loadOrNew(refList.getRefListId(), I_AD_Ref_List.class);\n+\n+\t\trecord.setAD_Org_ID(refList.getOrgId().getRepoId());\n+\t\trecord.setAD_Reference_ID(refList.getReferenceId().getRepoId());\n+\n+\t\trecord.setName(refList.getName());\n+\t\trecord.setValue(refList.getValue());\n+\n+\t\tsaveRecord(record);\n+\n+\t\treturn RefListId.ofRepoId(record.getAD_Ref_List_ID());\n+\t}\n+\n+\tpublic Optional<RefList> getByRequest(@NonNull final GetRefListRequest getRefListRequest)\n+\t{\n+\t\treturn queryBL.createQueryBuilder(I_AD_Ref_List.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f231baf075541e78209c3746b335fe6ef9c33e6"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc5NjA2MA==", "bodyText": "didn't saw it, as it is not in the AD_Index_Table, I'll drop mine and query only after Reference_ID and Value.", "url": "https://github.com/metasfresh/metasfresh/pull/6564#discussion_r420796060", "createdAt": "2020-05-06T13:37:14Z", "author": {"login": "pvpurcarcosmin"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/reflist/RefListRepository.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * #%L\n+ * de.metas.adempiere.adempiere.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.reflist;\n+\n+import de.metas.organization.OrgId;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.dao.IQueryBL;\n+import org.compiere.model.I_AD_Ref_List;\n+import org.springframework.stereotype.Repository;\n+\n+import java.util.Optional;\n+\n+import static org.adempiere.model.InterfaceWrapperHelper.loadOrNew;\n+import static org.adempiere.model.InterfaceWrapperHelper.saveRecord;\n+\n+@Repository\n+public class RefListRepository\n+{\n+\tprivate final IQueryBL queryBL = Services.get(IQueryBL.class);\n+\n+\tpublic RefListId save(@NonNull final RefList refList)\n+\t{\n+\t\tfinal I_AD_Ref_List record = loadOrNew(refList.getRefListId(), I_AD_Ref_List.class);\n+\n+\t\trecord.setAD_Org_ID(refList.getOrgId().getRepoId());\n+\t\trecord.setAD_Reference_ID(refList.getReferenceId().getRepoId());\n+\n+\t\trecord.setName(refList.getName());\n+\t\trecord.setValue(refList.getValue());\n+\n+\t\tsaveRecord(record);\n+\n+\t\treturn RefListId.ofRepoId(record.getAD_Ref_List_ID());\n+\t}\n+\n+\tpublic Optional<RefList> getByRequest(@NonNull final GetRefListRequest getRefListRequest)\n+\t{\n+\t\treturn queryBL.createQueryBuilder(I_AD_Ref_List.class)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc3Njc3OA=="}, "originalCommit": {"oid": "1f231baf075541e78209c3746b335fe6ef9c33e6"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxOTQ1MzEyOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.serviceprovider/src/main/java-gen/de/metas/serviceprovider/model/I_S_TimeBooking.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMzoxNTo1MFrOGRSaYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMzozMjoxM1rOGRTH9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc4MDY0Mw==", "bodyText": "can we still have multiple bookings per day? or don't we (currently) need/want this?", "url": "https://github.com/metasfresh/metasfresh/pull/6564#discussion_r420780643", "createdAt": "2020-05-06T13:15:50Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.serviceprovider/src/main/java-gen/de/metas/serviceprovider/model/I_S_TimeBooking.java", "diffHunk": "@@ -82,7 +82,7 @@\n \t/**\n \t * Set Booked date.\n \t *\n-\t * <br>Type: DateTime\n+\t * <br>Type: Date", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f231baf075541e78209c3746b335fe6ef9c33e6"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc5MjMxMQ==", "bodyText": "we can, we dropped the unique constraint when we moved from the exportTime endpoint to the getTeamBookedTime  one ( the one that provides also ids for the time records ) .", "url": "https://github.com/metasfresh/metasfresh/pull/6564#discussion_r420792311", "createdAt": "2020-05-06T13:32:13Z", "author": {"login": "pvpurcarcosmin"}, "path": "backend/de.metas.serviceprovider/src/main/java-gen/de/metas/serviceprovider/model/I_S_TimeBooking.java", "diffHunk": "@@ -82,7 +82,7 @@\n \t/**\n \t * Set Booked date.\n \t *\n-\t * <br>Type: DateTime\n+\t * <br>Type: Date", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc4MDY0Mw=="}, "originalCommit": {"oid": "1f231baf075541e78209c3746b335fe6ef9c33e6"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxOTQ2MDY3OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.serviceprovider/src/main/java/de/metas/serviceprovider/external/label/IssueLabelRepository.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMzoxNzozOVrOGRSfMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMzozMzo1MFrOGRTMjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc4MTg3Mg==", "bodyText": "do you have an index on S_IssueLabel.S_Issue_ID ?", "url": "https://github.com/metasfresh/metasfresh/pull/6564#discussion_r420781872", "createdAt": "2020-05-06T13:17:39Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.serviceprovider/src/main/java/de/metas/serviceprovider/external/label/IssueLabelRepository.java", "diffHunk": "@@ -0,0 +1,138 @@\n+/*\n+ * #%L\n+ * de.metas.serviceprovider.base\n+ * %%\n+ * Copyright (C) 2019 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.serviceprovider.external.label;\n+\n+import com.google.common.collect.ImmutableList;\n+import de.metas.organization.OrgId;\n+import de.metas.serviceprovider.issue.IssueId;\n+import de.metas.serviceprovider.model.I_S_IssueLabel;\n+import de.metas.util.Check;\n+import lombok.NonNull;\n+import org.adempiere.ad.dao.IQueryBL;\n+import org.adempiere.model.InterfaceWrapperHelper;\n+import org.springframework.stereotype.Repository;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+@Repository\n+public class IssueLabelRepository\n+{\n+\tprivate final IQueryBL queryBL;\n+\n+\tpublic IssueLabelRepository(final IQueryBL queryBL)\n+\t{\n+\t\tthis.queryBL = queryBL;\n+\t}\n+\n+\tpublic ImmutableList<IssueLabel> getByIssueId(@NonNull final IssueId issueId)\n+\t{\n+\t\treturn getRecordsByIssueId(issueId)\n+\t\t\t\t.stream()\n+\t\t\t\t.map(this::of)\n+\t\t\t\t.collect(ImmutableList.toImmutableList());\n+\t}\n+\n+\tpublic void persistLabels(@NonNull final IssueId issueId,\n+\t\t\t\t\t\t\t  @NonNull final ImmutableList<IssueLabel> issueLabels)\n+\t{\n+\t\tfinal ImmutableList<I_S_IssueLabel> newLabels =\n+\t\t\t\tissueLabels\n+\t\t\t\t\t\t.stream()\n+\t\t\t\t\t\t.map(label -> of(issueId, label))\n+\t\t\t\t\t\t.collect(ImmutableList.toImmutableList());\n+\n+\t\tfinal ImmutableList<I_S_IssueLabel> existingLabels = getRecordsByIssueId(issueId);\n+\n+\t\tpersistLabels(newLabels, existingLabels);\n+\t}\n+\n+\t@NonNull\n+\tprivate ImmutableList<I_S_IssueLabel> getRecordsByIssueId(@NonNull final IssueId issueId)\n+\t{\n+\t\treturn queryBL.createQueryBuilder(I_S_IssueLabel.class)\n+\t\t\t\t.addOnlyActiveRecordsFilter()\n+\t\t\t\t.addEqualsFilter(I_S_IssueLabel.COLUMNNAME_S_Issue_ID, issueId.getRepoId())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f231baf075541e78209c3746b335fe6ef9c33e6"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc5MzQ4Ng==", "bodyText": "yep", "url": "https://github.com/metasfresh/metasfresh/pull/6564#discussion_r420793486", "createdAt": "2020-05-06T13:33:50Z", "author": {"login": "pvpurcarcosmin"}, "path": "backend/de.metas.serviceprovider/src/main/java/de/metas/serviceprovider/external/label/IssueLabelRepository.java", "diffHunk": "@@ -0,0 +1,138 @@\n+/*\n+ * #%L\n+ * de.metas.serviceprovider.base\n+ * %%\n+ * Copyright (C) 2019 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.serviceprovider.external.label;\n+\n+import com.google.common.collect.ImmutableList;\n+import de.metas.organization.OrgId;\n+import de.metas.serviceprovider.issue.IssueId;\n+import de.metas.serviceprovider.model.I_S_IssueLabel;\n+import de.metas.util.Check;\n+import lombok.NonNull;\n+import org.adempiere.ad.dao.IQueryBL;\n+import org.adempiere.model.InterfaceWrapperHelper;\n+import org.springframework.stereotype.Repository;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+@Repository\n+public class IssueLabelRepository\n+{\n+\tprivate final IQueryBL queryBL;\n+\n+\tpublic IssueLabelRepository(final IQueryBL queryBL)\n+\t{\n+\t\tthis.queryBL = queryBL;\n+\t}\n+\n+\tpublic ImmutableList<IssueLabel> getByIssueId(@NonNull final IssueId issueId)\n+\t{\n+\t\treturn getRecordsByIssueId(issueId)\n+\t\t\t\t.stream()\n+\t\t\t\t.map(this::of)\n+\t\t\t\t.collect(ImmutableList.toImmutableList());\n+\t}\n+\n+\tpublic void persistLabels(@NonNull final IssueId issueId,\n+\t\t\t\t\t\t\t  @NonNull final ImmutableList<IssueLabel> issueLabels)\n+\t{\n+\t\tfinal ImmutableList<I_S_IssueLabel> newLabels =\n+\t\t\t\tissueLabels\n+\t\t\t\t\t\t.stream()\n+\t\t\t\t\t\t.map(label -> of(issueId, label))\n+\t\t\t\t\t\t.collect(ImmutableList.toImmutableList());\n+\n+\t\tfinal ImmutableList<I_S_IssueLabel> existingLabels = getRecordsByIssueId(issueId);\n+\n+\t\tpersistLabels(newLabels, existingLabels);\n+\t}\n+\n+\t@NonNull\n+\tprivate ImmutableList<I_S_IssueLabel> getRecordsByIssueId(@NonNull final IssueId issueId)\n+\t{\n+\t\treturn queryBL.createQueryBuilder(I_S_IssueLabel.class)\n+\t\t\t\t.addOnlyActiveRecordsFilter()\n+\t\t\t\t.addEqualsFilter(I_S_IssueLabel.COLUMNNAME_S_Issue_ID, issueId.getRepoId())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc4MTg3Mg=="}, "originalCommit": {"oid": "1f231baf075541e78209c3746b335fe6ef9c33e6"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxOTQ5NjM3OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.serviceprovider/src/main/sql/postgresql/system/45-de.metas.serviceprovider/5558560_sys_gh5816-app_add_unique_index_IDX_AD_REF_LIST_AD_REFERENCE_ID_NAME_VALUE.sql", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMzoyNTo0MlrOGRS1aA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxMzozOTozNlrOGRTdjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc4NzU2MA==", "bodyText": "Ok, you also saw the UC i wrote about further up..but i think this is not a good idea in general.\nWhat's a \"legal\" scenario where we have two AD_Ref_Lists with same AD_Reference_ID, same Value and different name?\n@teosarca wdyt?", "url": "https://github.com/metasfresh/metasfresh/pull/6564#discussion_r420787560", "createdAt": "2020-05-06T13:25:42Z", "author": {"login": "metas-ts"}, "path": "backend/de.metas.serviceprovider/src/main/sql/postgresql/system/45-de.metas.serviceprovider/5558560_sys_gh5816-app_add_unique_index_IDX_AD_REF_LIST_AD_REFERENCE_ID_NAME_VALUE.sql", "diffHunk": "@@ -0,0 +1,35 @@\n+-- 2020-05-05T07:10:33.305Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Index_Table (AD_Client_ID,AD_Index_Table_ID,AD_Org_ID,AD_Table_ID,Created,CreatedBy,EntityType,IsActive,IsUnique,Name,Processing,Updated,UpdatedBy,WhereClause) VALUES (0,540538,0,104,TO_TIMESTAMP('2020-05-05 10:10:33','YYYY-MM-DD HH24:MI:SS'),100,'U','Y','Y','IDX_AD_REF_LIST_AD_REFERENCE_ID_NAME_VALUE','N',TO_TIMESTAMP('2020-05-05 10:10:33','YYYY-MM-DD HH24:MI:SS'),100,'AD_RE')\n+;\n+\n+-- 2020-05-05T07:10:33.310Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Index_Table_Trl (AD_Language,AD_Index_Table_ID, ErrorMsg, IsTranslated,AD_Client_ID,AD_Org_ID,Created,Createdby,Updated,UpdatedBy) SELECT l.AD_Language, t.AD_Index_Table_ID, t.ErrorMsg, 'N',t.AD_Client_ID,t.AD_Org_ID,t.Created,t.Createdby,t.Updated,t.UpdatedBy FROM AD_Language l, AD_Index_Table t WHERE l.IsActive='Y'AND (l.IsSystemLanguage='Y' AND l.IsBaseLanguage='N') AND t.AD_Index_Table_ID=540538 AND NOT EXISTS (SELECT 1 FROM AD_Index_Table_Trl tt WHERE tt.AD_Language=l.AD_Language AND tt.AD_Index_Table_ID=t.AD_Index_Table_ID)\n+;\n+\n+-- 2020-05-05T07:10:50.629Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+UPDATE AD_Index_Table SET EntityType='D', WhereClause='AD_Ref_List.isActive=''Y''',Updated=TO_TIMESTAMP('2020-05-05 10:10:50','YYYY-MM-DD HH24:MI:SS'),UpdatedBy=100 WHERE AD_Index_Table_ID=540538\n+;\n+\n+-- 2020-05-05T07:11:55.097Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Index_Column (AD_Client_ID,AD_Column_ID,AD_Index_Column_ID,AD_Index_Table_ID,AD_Org_ID,Created,CreatedBy,EntityType,IsActive,SeqNo,Updated,UpdatedBy) VALUES (0,151,541016,540538,0,TO_TIMESTAMP('2020-05-05 10:11:54','YYYY-MM-DD HH24:MI:SS'),100,'D','Y',10,TO_TIMESTAMP('2020-05-05 10:11:54','YYYY-MM-DD HH24:MI:SS'),100)\n+;\n+\n+-- 2020-05-05T07:12:01.747Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Index_Column (AD_Client_ID,AD_Column_ID,AD_Index_Column_ID,AD_Index_Table_ID,AD_Org_ID,Created,CreatedBy,EntityType,IsActive,SeqNo,Updated,UpdatedBy) VALUES (0,149,541017,540538,0,TO_TIMESTAMP('2020-05-05 10:12:01','YYYY-MM-DD HH24:MI:SS'),100,'D','Y',20,TO_TIMESTAMP('2020-05-05 10:12:01','YYYY-MM-DD HH24:MI:SS'),100)\n+;\n+\n+-- 2020-05-05T07:12:41.294Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Index_Column (AD_Client_ID,AD_Column_ID,AD_Index_Column_ID,AD_Index_Table_ID,AD_Org_ID,Created,CreatedBy,EntityType,IsActive,SeqNo,Updated,UpdatedBy) VALUES (0,200,541018,540538,0,TO_TIMESTAMP('2020-05-05 10:12:41','YYYY-MM-DD HH24:MI:SS'),100,'D','Y',30,TO_TIMESTAMP('2020-05-05 10:12:41','YYYY-MM-DD HH24:MI:SS'),100)\n+;\n+\n+-- 2020-05-05T07:12:51.362Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+CREATE UNIQUE INDEX IDX_AD_REF_LIST_AD_REFERENCE_ID_NAME_VALUE ON AD_Ref_List (AD_Reference_ID,Name,Value) WHERE AD_Ref_List.isActive='Y'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f231baf075541e78209c3746b335fe6ef9c33e6"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc5NzgzOA==", "bodyText": "yep, you're right, I wasn't aware of that existing unique constraint on AD_Reference_ID and Value so I thought there aren't any kind of constraints and just wanted to play it safe. Like I've mentioned above, I'll drop this.", "url": "https://github.com/metasfresh/metasfresh/pull/6564#discussion_r420797838", "createdAt": "2020-05-06T13:39:36Z", "author": {"login": "pvpurcarcosmin"}, "path": "backend/de.metas.serviceprovider/src/main/sql/postgresql/system/45-de.metas.serviceprovider/5558560_sys_gh5816-app_add_unique_index_IDX_AD_REF_LIST_AD_REFERENCE_ID_NAME_VALUE.sql", "diffHunk": "@@ -0,0 +1,35 @@\n+-- 2020-05-05T07:10:33.305Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Index_Table (AD_Client_ID,AD_Index_Table_ID,AD_Org_ID,AD_Table_ID,Created,CreatedBy,EntityType,IsActive,IsUnique,Name,Processing,Updated,UpdatedBy,WhereClause) VALUES (0,540538,0,104,TO_TIMESTAMP('2020-05-05 10:10:33','YYYY-MM-DD HH24:MI:SS'),100,'U','Y','Y','IDX_AD_REF_LIST_AD_REFERENCE_ID_NAME_VALUE','N',TO_TIMESTAMP('2020-05-05 10:10:33','YYYY-MM-DD HH24:MI:SS'),100,'AD_RE')\n+;\n+\n+-- 2020-05-05T07:10:33.310Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Index_Table_Trl (AD_Language,AD_Index_Table_ID, ErrorMsg, IsTranslated,AD_Client_ID,AD_Org_ID,Created,Createdby,Updated,UpdatedBy) SELECT l.AD_Language, t.AD_Index_Table_ID, t.ErrorMsg, 'N',t.AD_Client_ID,t.AD_Org_ID,t.Created,t.Createdby,t.Updated,t.UpdatedBy FROM AD_Language l, AD_Index_Table t WHERE l.IsActive='Y'AND (l.IsSystemLanguage='Y' AND l.IsBaseLanguage='N') AND t.AD_Index_Table_ID=540538 AND NOT EXISTS (SELECT 1 FROM AD_Index_Table_Trl tt WHERE tt.AD_Language=l.AD_Language AND tt.AD_Index_Table_ID=t.AD_Index_Table_ID)\n+;\n+\n+-- 2020-05-05T07:10:50.629Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+UPDATE AD_Index_Table SET EntityType='D', WhereClause='AD_Ref_List.isActive=''Y''',Updated=TO_TIMESTAMP('2020-05-05 10:10:50','YYYY-MM-DD HH24:MI:SS'),UpdatedBy=100 WHERE AD_Index_Table_ID=540538\n+;\n+\n+-- 2020-05-05T07:11:55.097Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Index_Column (AD_Client_ID,AD_Column_ID,AD_Index_Column_ID,AD_Index_Table_ID,AD_Org_ID,Created,CreatedBy,EntityType,IsActive,SeqNo,Updated,UpdatedBy) VALUES (0,151,541016,540538,0,TO_TIMESTAMP('2020-05-05 10:11:54','YYYY-MM-DD HH24:MI:SS'),100,'D','Y',10,TO_TIMESTAMP('2020-05-05 10:11:54','YYYY-MM-DD HH24:MI:SS'),100)\n+;\n+\n+-- 2020-05-05T07:12:01.747Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Index_Column (AD_Client_ID,AD_Column_ID,AD_Index_Column_ID,AD_Index_Table_ID,AD_Org_ID,Created,CreatedBy,EntityType,IsActive,SeqNo,Updated,UpdatedBy) VALUES (0,149,541017,540538,0,TO_TIMESTAMP('2020-05-05 10:12:01','YYYY-MM-DD HH24:MI:SS'),100,'D','Y',20,TO_TIMESTAMP('2020-05-05 10:12:01','YYYY-MM-DD HH24:MI:SS'),100)\n+;\n+\n+-- 2020-05-05T07:12:41.294Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+INSERT INTO AD_Index_Column (AD_Client_ID,AD_Column_ID,AD_Index_Column_ID,AD_Index_Table_ID,AD_Org_ID,Created,CreatedBy,EntityType,IsActive,SeqNo,Updated,UpdatedBy) VALUES (0,200,541018,540538,0,TO_TIMESTAMP('2020-05-05 10:12:41','YYYY-MM-DD HH24:MI:SS'),100,'D','Y',30,TO_TIMESTAMP('2020-05-05 10:12:41','YYYY-MM-DD HH24:MI:SS'),100)\n+;\n+\n+-- 2020-05-05T07:12:51.362Z\n+-- I forgot to set the DICTIONARY_ID_COMMENTS System Configurator\n+CREATE UNIQUE INDEX IDX_AD_REF_LIST_AD_REFERENCE_ID_NAME_VALUE ON AD_Ref_List (AD_Reference_ID,Name,Value) WHERE AD_Ref_List.isActive='Y'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc4NzU2MA=="}, "originalCommit": {"oid": "1f231baf075541e78209c3746b335fe6ef9c33e6"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxOTcwMjQzOnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/reflist/RefList.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNDowNzo1MVrOGRU1EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNDowNzo1MVrOGRU1EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDgyMDI0MA==", "bodyText": "see org.adempiere.ad.service.IADReferenceDAO.ADRefListItem.\nmight be what u want.\nalso pls note that usually, for names we use ITranslatableString instead of plain Strings.", "url": "https://github.com/metasfresh/metasfresh/pull/6564#discussion_r420820240", "createdAt": "2020-05-06T14:07:51Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/reflist/RefList.java", "diffHunk": "@@ -20,29 +20,31 @@\n  * #L%\n  */\n \n-package de.metas.serviceprovider.external.issuedetails;\n+package de.metas.reflist;\n \n-import lombok.AllArgsConstructor;\n-import lombok.Getter;\n+import de.metas.organization.OrgId;\n+import lombok.Builder;\n import lombok.NonNull;\n+import lombok.Value;\n \n-import java.util.Optional;\n-import java.util.stream.Stream;\n+import javax.annotation.Nullable;\n \n-@AllArgsConstructor\n-@Getter\n-public enum ExternalIssueDetailType\n+@Value\n+@Builder\n+public class RefList", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af59e565a73994ed24d38f984a2abb244ca5cc24"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMzU2NDE2OnYy", "diffSide": "RIGHT", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/org/adempiere/ad/service/impl/ADReferenceDAO.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMToxNjo1NFrOGR54lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxMToxNjo1NFrOGR54lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQyNzM0OA==", "bodyText": "ImmutableMap", "url": "https://github.com/metasfresh/metasfresh/pull/6564#discussion_r421427348", "createdAt": "2020-05-07T11:16:54Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/org/adempiere/ad/service/impl/ADReferenceDAO.java", "diffHunk": "@@ -26,11 +25,16 @@\n import java.util.Properties;\n import java.util.Set;\n \n-import static org.adempiere.model.InterfaceWrapperHelper.loadOrNew;\n+import static org.adempiere.model.InterfaceWrapperHelper.newInstanceOutOfTrx;\n import static org.adempiere.model.InterfaceWrapperHelper.saveRecord;\n \n public class ADReferenceDAO implements IADReferenceDAO\n {\n+\tprivate final CCache<ReferenceId, Map<String,ADRefListItem>> cache = CCache.<ReferenceId, Map<String,ADRefListItem>>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a32e06c35f7f14e25a1cbb9501f1d183af2bdea3"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1616, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}