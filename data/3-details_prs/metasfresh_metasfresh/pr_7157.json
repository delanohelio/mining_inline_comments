{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5OTY5ODE4", "number": 7157, "title": "WebUI Forecast Window hide Calendar, Period, Year", "bodyText": "#3856", "createdAt": "2020-08-19T07:14:37Z", "url": "https://github.com/metasfresh/metasfresh/pull/7157", "merged": true, "mergeCommit": {"oid": "fa5413da2e64829b36f5685631b3ccaccb01c85d"}, "closed": true, "closedAt": "2020-08-20T05:54:26Z", "author": {"login": "TheBestPessimist"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAGd9DgH2gAyNDY5OTY5ODE4OmQyYzYxOTc3MTA3MjI2MGU1Mjk3OWVlZTU5NjdhM2Q4OGM5YWE3MmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAaXRPgH2gAyNDY5OTY5ODE4OjMyMmY5OWMyMzM2ODY0OGI2MDg4Zjk4OGNiNjFkZWZlZTQ4NGQ0YjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d2c619771072260e52979eee5967a3d88c9aa72d", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/d2c619771072260e52979eee5967a3d88c9aa72d", "committedDate": "2020-08-18T12:49:23Z", "message": "Add `C_Calendar.IsDefault`\n\nhttps://github.com/metasfresh/metasfresh/issues/3856"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "718fec059e86b9ecd442059c17e5ee8629b17142", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/718fec059e86b9ecd442059c17e5ee8629b17142", "committedDate": "2020-08-18T13:06:14Z", "message": "Add webui and migration for `C_Calendar.IsDefault`\n\nhttps://github.com/metasfresh/metasfresh/issues/3856"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc93978faad4518fabbfed243f004fe836a676d2", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/cc93978faad4518fabbfed243f004fe836a676d2", "committedDate": "2020-08-19T06:17:10Z", "message": "Add model validator for M_Forecast.DatePromised\n\nIt gets the default calendar and sets the forecast's Calendar, Year and Period, if possible.\nIf not possible error is thrown.\n\nhttps://github.com/metasfresh/metasfresh/issues/3856"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37ffe5c42703a00afe6253c31b9bf25dd9ef2378", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/37ffe5c42703a00afe6253c31b9bf25dd9ef2378", "committedDate": "2020-08-19T06:19:18Z", "message": "Update Forecast Window\n\nhttps://github.com/metasfresh/metasfresh/issues/3856"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dee9d2c5e3a9414eddb28644048585989974de8", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/5dee9d2c5e3a9414eddb28644048585989974de8", "committedDate": "2020-08-19T07:13:14Z", "message": "Add error messages if default calendar or period does not exist\n\nhttps://github.com/metasfresh/metasfresh/issues/3856"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58efda0067be3bfeaca3d0cf1ff7f965e56170aa", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/58efda0067be3bfeaca3d0cf1ff7f965e56170aa", "committedDate": "2020-08-19T07:18:52Z", "message": "Add error messages trls\n\nhttps://github.com/metasfresh/metasfresh/issues/3856"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09624ae6675de5c0eb998eaacf44b35dbdaaaaf9", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/09624ae6675de5c0eb998eaacf44b35dbdaaaaf9", "committedDate": "2020-08-19T07:21:30Z", "message": "Set Updated and UpdatedBy to the default Calendar\n\nhttps://github.com/metasfresh/metasfresh/issues/3856"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6810b53c0e7289b6828c265319cb8c6a88ae882e", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/6810b53c0e7289b6828c265319cb8c6a88ae882e", "committedDate": "2020-08-19T07:26:19Z", "message": "Set Updated and UpdatedBy to the default Calendar 2\n\nhttps://github.com/metasfresh/metasfresh/issues/3856"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b99d9e798ec552f51721e255ae58f7afbedb8cfc", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/b99d9e798ec552f51721e255ae58f7afbedb8cfc", "committedDate": "2020-08-19T09:51:55Z", "message": "ForecastLine Quick Input: copy warehouse from Forecast\n\nhttps://github.com/metasfresh/metasfresh/issues/3856"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/bd6f00ba724a7504559bcc817a250b34cc1f7adc", "committedDate": "2020-08-19T10:12:51Z", "message": "Cleanup\n\nhttps://github.com/metasfresh/metasfresh/issues/3856"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMzQ3NDY4", "url": "https://github.com/metasfresh/metasfresh/pull/7157#pullrequestreview-470347468", "createdAt": "2020-08-19T10:59:53Z", "commit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMDo1OTo1M1rOHDCLXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMDo1OTo1M1rOHDCLXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk0MzQ1Mw==", "bodyText": "lines 241:253 shall be a DAO method", "url": "https://github.com/metasfresh/metasfresh/pull/7157#discussion_r472943453", "createdAt": "2020-08-19T10:59:53Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/calendar/impl/CalendarBL.java", "diffHunk": "@@ -214,4 +227,29 @@ public IBusinessDayMatcher createBusinessDayMatcherExcluding(final Set<DayOfWeek\n \t\t\t\t.excludeWeekendDays(excludeWeekendDays)\n \t\t\t\t.build();\n \t}\n+\n+\t@Override\n+\t@NonNull\n+\tpublic CalendarId getOrgCalendarOrDefault(final @NonNull OrgId orgId)\n+\t{\n+\t\tfinal OrgInfo orgInfo = orgDAO.getOrgInfoByIdInTrx(orgId);\n+\t\tif (orgInfo.getCalendarId() != null)\n+\t\t{\n+\t\t\treturn orgInfo.getCalendarId();\n+\t\t}\n+\n+\t\tfinal I_C_Calendar calendar = queryBL.createQueryBuilder(I_C_Calendar.class)\n+\t\t\t\t.addEqualsFilter(I_C_Calendar.COLUMNNAME_IsDefault, true)\n+\t\t\t\t.addInArrayFilter(I_C_Calendar.COLUMNNAME_AD_Org_ID, ImmutableList.of(orgId, OrgId.ANY))\n+\t\t\t\t.orderByDescending(I_C_Calendar.COLUMNNAME_AD_Org_ID)\n+\t\t\t\t.create()\n+\t\t\t\t.first();\n+\n+\t\tif (calendar == null)\n+\t\t{\n+\t\t\tthrow new AdempiereException(MSG_SET_DEFAULT_OR_ORG_CALENDAR);\n+\t\t}\n+\n+\t\treturn CalendarId.ofRepoId(calendar.getC_Calendar_ID());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc"}, "originalPosition": 121}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMzQ4NTYy", "url": "https://github.com/metasfresh/metasfresh/pull/7157#pullrequestreview-470348562", "createdAt": "2020-08-19T11:01:32Z", "commit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMTowMTozMlrOHDCPKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMTowMTozMlrOHDCPKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk0NDQyNA==", "bodyText": "u can use org.compiere.model.IQuery.listDistinct(String, Class<AT>).", "url": "https://github.com/metasfresh/metasfresh/pull/7157#discussion_r472944424", "createdAt": "2020-08-19T11:01:32Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/calendar/impl/CalendarDAO.java", "diffHunk": "@@ -119,4 +127,22 @@ public I_C_Period retrieveLastPeriodOfTheYear(final I_C_Year year)\n \t\t\t\t.setOrderBy(I_C_Period.COLUMNNAME_StartDate + \" DESC \")\n \t\t\t\t.first(I_C_Period.class);\n \t}\n+\n+\t@Nullable\n+\t@Override\n+\tpublic String getName(final CalendarId calendarId)\n+\t{\n+\t\tfinal List<Map<String, Object>> calendarNames = queryBL.createQueryBuilder(I_C_Calendar.class)\n+\t\t\t\t.addOnlyActiveRecordsFilter()\n+\t\t\t\t.addEqualsFilter(I_C_Calendar.COLUMNNAME_C_Calendar_ID, calendarId)\n+\t\t\t\t.create()\n+\t\t\t\t.listColumns(I_C_Calendar.COLUMNNAME_Name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc"}, "originalPosition": 87}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMzQ4OTA3", "url": "https://github.com/metasfresh/metasfresh/pull/7157#pullrequestreview-470348907", "createdAt": "2020-08-19T11:02:05Z", "commit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMTowMjowNlrOHDCQMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMTowMjowNlrOHDCQMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk0NDY5MQ==", "bodyText": "why this method is needed?", "url": "https://github.com/metasfresh/metasfresh/pull/7157#discussion_r472944691", "createdAt": "2020-08-19T11:02:06Z", "author": {"login": "teosarca"}, "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/calendar/impl/PlainCalendarDAO.java", "diffHunk": "@@ -222,6 +224,18 @@ public I_C_Period retrieveLastPeriodOfTheYear(I_C_Year year)\n \t\treturn periods.get(periods.size() - 1);\n \t}\n \n+\t@Nullable\n+\t@Override\n+\tpublic String getName(final CalendarId calendarId)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd6f00ba724a7504559bcc817a250b34cc1f7adc"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "322f99c23368648b6088f988cb61defee484d4b0", "author": {"user": {"login": "TheBestPessimist", "name": "TheBestPessimist"}}, "url": "https://github.com/metasfresh/metasfresh/commit/322f99c23368648b6088f988cb61defee484d4b0", "committedDate": "2020-08-19T12:00:11Z", "message": "Refactoring here and there\n\nhttps://github.com/metasfresh/metasfresh/issues/3856"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3271, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}