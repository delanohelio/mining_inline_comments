{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczNjU0MzE4", "number": 16639, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzozNToxN1rODezfdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNToxMDozMVrODe1y2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjI3NTExOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/test/java/com/hazelcast/test/compatibility/CompatibilityTestUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzozNToxN1rOFoJGRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNToxMToyN1rOFoMvIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzNjQyMA==", "bodyText": "Previously used disableClassFormatChanges() was actually disallowing removal of final modifier, silently disregarding the transformer. We configure the agent with REDEFINE type strategy and NoOp initialization strategy; this allows for the redefinition of the type (instead of default REBASE strategy) without adding any methods (which result in modifying Serializable classes' serialVersionUid). For more details see ByteBuddy#rebase vs ByteBuddy#redefine.", "url": "https://github.com/hazelcast/hazelcast/pull/16639#discussion_r377636420", "createdAt": "2020-02-11T13:35:17Z", "author": {"login": "vbekiaris"}, "path": "hazelcast/src/test/java/com/hazelcast/test/compatibility/CompatibilityTestUtils.java", "diffHunk": "@@ -32,25 +28,18 @@\n     // loaded with final modifier to allow subclass proxying.\n     public static void attachFinalRemovalAgent() {\n         Instrumentation instrumentation = ByteBuddyAgent.install();\n-        new AgentBuilder.Default()\n-                .disableClassFormatChanges()\n-                .type(new ElementMatcher<TypeDescription>() {\n-                    @Override\n-                    public boolean matches(TypeDescription target) {\n-                        return target.getName().startsWith(\"com.hazelcast\");\n-                    }\n-                })\n-                .transform(new AgentBuilder.Transformer() {\n-                    @Override\n-                    public DynamicType.Builder<?> transform(DynamicType.Builder<?> builder,\n-                                                            TypeDescription typeDescription,\n-                                                            ClassLoader classLoader, JavaModule module) {\n-                        int actualModifiers = typeDescription.getActualModifiers(false);\n-                        // unset final modifier\n-                        int nonFinalModifiers = actualModifiers & ~Opcodes.ACC_FINAL;\n-                        return builder.modifiers(nonFinalModifiers);\n-                    }\n-                })\n-                .installOn(instrumentation);\n+        new AgentBuilder.Default().with(AgentBuilder.TypeStrategy.Default.REDEFINE)\n+                                  .with(AgentBuilder.InitializationStrategy.NoOp.INSTANCE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2b9d5d2db0afc0dd082654ddf8bfe1e77db3c1f"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY5NjAzMg==", "bodyText": "+1 for the REDEFINE/REBASE background info, what about adding it as a code comment for posterity?", "url": "https://github.com/hazelcast/hazelcast/pull/16639#discussion_r377696032", "createdAt": "2020-02-11T15:11:27Z", "author": {"login": "vojtechtoman"}, "path": "hazelcast/src/test/java/com/hazelcast/test/compatibility/CompatibilityTestUtils.java", "diffHunk": "@@ -32,25 +28,18 @@\n     // loaded with final modifier to allow subclass proxying.\n     public static void attachFinalRemovalAgent() {\n         Instrumentation instrumentation = ByteBuddyAgent.install();\n-        new AgentBuilder.Default()\n-                .disableClassFormatChanges()\n-                .type(new ElementMatcher<TypeDescription>() {\n-                    @Override\n-                    public boolean matches(TypeDescription target) {\n-                        return target.getName().startsWith(\"com.hazelcast\");\n-                    }\n-                })\n-                .transform(new AgentBuilder.Transformer() {\n-                    @Override\n-                    public DynamicType.Builder<?> transform(DynamicType.Builder<?> builder,\n-                                                            TypeDescription typeDescription,\n-                                                            ClassLoader classLoader, JavaModule module) {\n-                        int actualModifiers = typeDescription.getActualModifiers(false);\n-                        // unset final modifier\n-                        int nonFinalModifiers = actualModifiers & ~Opcodes.ACC_FINAL;\n-                        return builder.modifiers(nonFinalModifiers);\n-                    }\n-                })\n-                .installOn(instrumentation);\n+        new AgentBuilder.Default().with(AgentBuilder.TypeStrategy.Default.REDEFINE)\n+                                  .with(AgentBuilder.InitializationStrategy.NoOp.INSTANCE)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYzNjQyMA=="}, "originalCommit": {"oid": "d2b9d5d2db0afc0dd082654ddf8bfe1e77db3c1f"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjYwODA2OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/test/java/com/hazelcast/test/starter/test/HazelcastVersionLocatorTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNDo1OTozMFrOFoMQiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNTo0NDo0N1rOFoOJBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY4ODIwMA==", "bodyText": "HAZELCAST_TESTS_JAR_INDEX?", "url": "https://github.com/hazelcast/hazelcast/pull/16639#discussion_r377688200", "createdAt": "2020-02-11T14:59:30Z", "author": {"login": "vojtechtoman"}, "path": "hazelcast/src/test/java/com/hazelcast/test/starter/test/HazelcastVersionLocatorTest.java", "diffHunk": "@@ -45,19 +46,15 @@\n \n     @Test\n     public void testDownloadVersion() throws Exception {\n-        File[] files = HazelcastVersionLocator.locateVersion(\"3.6\", folder.getRoot(), true);\n+        File[] files = HazelcastVersionLocator.locateVersion(\"4.0\", folder.getRoot(), true);\n \n-        assertHash(files[0], \"89563f7dab02bd5f592082697c24d167\", \"OS member\");\n+        assertHash(files[HAZELCAST_JAR_INDEX], \"bc409b12b96ece6d05c3bd1e99b202bb\", \"OS\");\n \n-        assertHash(files[1], \"66615c68c2708036a6030114a1b87f2b\", \"OS member tests\");\n+        assertHash(files[1], \"220509ece9fc152525c91ba7c75ce600\", \"OS tests\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2b9d5d2db0afc0dd082654ddf8bfe1e77db3c1f"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzcxOTA0Nw==", "bodyText": "\ud83e\udd26\u200d\u2642 I thought I did that...", "url": "https://github.com/hazelcast/hazelcast/pull/16639#discussion_r377719047", "createdAt": "2020-02-11T15:44:47Z", "author": {"login": "vbekiaris"}, "path": "hazelcast/src/test/java/com/hazelcast/test/starter/test/HazelcastVersionLocatorTest.java", "diffHunk": "@@ -45,19 +46,15 @@\n \n     @Test\n     public void testDownloadVersion() throws Exception {\n-        File[] files = HazelcastVersionLocator.locateVersion(\"3.6\", folder.getRoot(), true);\n+        File[] files = HazelcastVersionLocator.locateVersion(\"4.0\", folder.getRoot(), true);\n \n-        assertHash(files[0], \"89563f7dab02bd5f592082697c24d167\", \"OS member\");\n+        assertHash(files[HAZELCAST_JAR_INDEX], \"bc409b12b96ece6d05c3bd1e99b202bb\", \"OS\");\n \n-        assertHash(files[1], \"66615c68c2708036a6030114a1b87f2b\", \"OS member tests\");\n+        assertHash(files[1], \"220509ece9fc152525c91ba7c75ce600\", \"OS tests\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY4ODIwMA=="}, "originalCommit": {"oid": "d2b9d5d2db0afc0dd082654ddf8bfe1e77db3c1f"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjYwOTAzOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/test/java/com/hazelcast/test/starter/test/HazelcastVersionLocatorTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNDo1OTo0NVrOFoMRLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNDo1OTo0NVrOFoMRLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY4ODM2NA==", "bodyText": "HAZELCAST_EE_JAR_INDEX?", "url": "https://github.com/hazelcast/hazelcast/pull/16639#discussion_r377688364", "createdAt": "2020-02-11T14:59:45Z", "author": {"login": "vojtechtoman"}, "path": "hazelcast/src/test/java/com/hazelcast/test/starter/test/HazelcastVersionLocatorTest.java", "diffHunk": "@@ -45,19 +46,15 @@\n \n     @Test\n     public void testDownloadVersion() throws Exception {\n-        File[] files = HazelcastVersionLocator.locateVersion(\"3.6\", folder.getRoot(), true);\n+        File[] files = HazelcastVersionLocator.locateVersion(\"4.0\", folder.getRoot(), true);\n \n-        assertHash(files[0], \"89563f7dab02bd5f592082697c24d167\", \"OS member\");\n+        assertHash(files[HAZELCAST_JAR_INDEX], \"bc409b12b96ece6d05c3bd1e99b202bb\", \"OS\");\n \n-        assertHash(files[1], \"66615c68c2708036a6030114a1b87f2b\", \"OS member tests\");\n+        assertHash(files[1], \"220509ece9fc152525c91ba7c75ce600\", \"OS tests\");\n \n-        assertHash(files[2], \"fd6022e35908b42d24fe10a9c9fdaad5\", \"OS client\");\n+        assertHash(files[2], \"765816e628ca4ca57d5bd7387e761eaa\", \"EE\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2b9d5d2db0afc0dd082654ddf8bfe1e77db3c1f"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjYwOTkyOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/test/java/com/hazelcast/test/starter/test/HazelcastVersionLocatorTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNTowMDowMFrOFoMRvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNTowMDowMFrOFoMRvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY4ODUxMQ==", "bodyText": "HAZELCAST_EE_TESTS_JAR_INDEX?", "url": "https://github.com/hazelcast/hazelcast/pull/16639#discussion_r377688511", "createdAt": "2020-02-11T15:00:00Z", "author": {"login": "vojtechtoman"}, "path": "hazelcast/src/test/java/com/hazelcast/test/starter/test/HazelcastVersionLocatorTest.java", "diffHunk": "@@ -45,19 +46,15 @@\n \n     @Test\n     public void testDownloadVersion() throws Exception {\n-        File[] files = HazelcastVersionLocator.locateVersion(\"3.6\", folder.getRoot(), true);\n+        File[] files = HazelcastVersionLocator.locateVersion(\"4.0\", folder.getRoot(), true);\n \n-        assertHash(files[0], \"89563f7dab02bd5f592082697c24d167\", \"OS member\");\n+        assertHash(files[HAZELCAST_JAR_INDEX], \"bc409b12b96ece6d05c3bd1e99b202bb\", \"OS\");\n \n-        assertHash(files[1], \"66615c68c2708036a6030114a1b87f2b\", \"OS member tests\");\n+        assertHash(files[1], \"220509ece9fc152525c91ba7c75ce600\", \"OS tests\");\n \n-        assertHash(files[2], \"fd6022e35908b42d24fe10a9c9fdaad5\", \"OS client\");\n+        assertHash(files[2], \"765816e628ca4ca57d5bd7387e761eaa\", \"EE\");\n \n-        assertHash(files[3], \"c5718ba5c280339fff9b54ecb5e61549\", \"EE member\");\n-\n-        assertHash(files[4], \"c5df750fdab71a650fb56c41742806ff\", \"EE member tests\");\n-\n-        assertHash(files[5], \"b1cf93ec4bb9bcda8809b81349f48cb3\", \"EE client\");\n+        assertHash(files[3], \"162bcb2412570845e6fd91ee61b54f94\", \"EE tests\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2b9d5d2db0afc0dd082654ddf8bfe1e77db3c1f"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjYyMzQ0OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/test/java/com/hazelcast/test/starter/HazelcastVersionLocator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNTowMzoyNVrOFoMaSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNTowMzoyNVrOFoMaSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY5MDY5Nw==", "bodyText": "Minor: since locateMember has been renamed to locateMainArtifact, maybe downloadMember should be renamed, too?", "url": "https://github.com/hazelcast/hazelcast/pull/16639#discussion_r377690697", "createdAt": "2020-02-11T15:03:25Z", "author": {"login": "vojtechtoman"}, "path": "hazelcast/src/test/java/com/hazelcast/test/starter/HazelcastVersionLocator.java", "diffHunk": "@@ -56,21 +59,19 @@\n     }\n \n     public static File[] locateVersion(String version, File target, boolean enterprise) {\n-        File[] files = new File[enterprise ? 6 : 3];\n-        files[0] = locateMember(version, target, false);\n-        files[1] = locateMemberTests(version, target, false);\n-        files[2] = locateClient(version, target, false);\n+        File[] files = new File[enterprise ? 4 : 2];\n+        files[HAZELCAST_JAR_INDEX] = locateMainArtifact(version, target, false);\n+        files[HAZELCAST_TESTS_JAR_INDEX] = locateTestsArtifact(version, target, false);\n         if (enterprise) {\n-            files[3] = locateMember(version, target, true);\n-            files[4] = locateMemberTests(version, target, true);\n-            files[5] = locateClient(version, target, true);\n+            files[HAZELCAST_EE_JAR_INDEX] = locateMainArtifact(version, target, true);\n+            files[HAZELCAST_EE_TESTS_JAR_INDEX] = locateTestsArtifact(version, target, true);\n         }\n         return files;\n     }\n \n     // attempts to locate member artifact in local maven repository, then downloads\n-    private static File locateMember(String version, File target, boolean enterprise) {\n-        File artifact = new File(LOCAL_M2_REPOSITORY_PREFIX + constructPathForMember(version, enterprise));\n+    private static File locateMainArtifact(String version, File target, boolean enterprise) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2b9d5d2db0afc0dd082654ddf8bfe1e77db3c1f"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjYyNDg0OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/test/java/com/hazelcast/test/starter/HazelcastVersionLocator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNTowMzo0OVrOFoMbMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNTowMzo0OVrOFoMbMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY5MDkyOQ==", "bodyText": "Minor: since locateMemberTests has been renamed to locateTestsArtifact, maybe downloadMemberTests should be renamed, too?", "url": "https://github.com/hazelcast/hazelcast/pull/16639#discussion_r377690929", "createdAt": "2020-02-11T15:03:49Z", "author": {"login": "vojtechtoman"}, "path": "hazelcast/src/test/java/com/hazelcast/test/starter/HazelcastVersionLocator.java", "diffHunk": "@@ -79,41 +80,24 @@ private static File locateMember(String version, File target, boolean enterprise\n     }\n \n     // attempts to locate member tests artifact in local maven repository, then downloads\n-    private static File locateMemberTests(String version, File target, boolean enterprise) {\n-        File artifact = new File(LOCAL_M2_REPOSITORY_PREFIX + constructPathForMemberTests(version, enterprise));\n+    private static File locateTestsArtifact(String version, File target, boolean enterprise) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2b9d5d2db0afc0dd082654ddf8bfe1e77db3c1f"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjY1MjQyOnYy", "diffSide": "RIGHT", "path": "pom.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNToxMDozMVrOFoMscw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxNToxMDozMVrOFoMscw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY5NTM0Nw==", "bodyText": "Nice catch. Better late than never :)", "url": "https://github.com/hazelcast/hazelcast/pull/16639#discussion_r377695347", "createdAt": "2020-02-11T15:10:31Z", "author": {"login": "vojtechtoman"}, "path": "pom.xml", "diffHunk": "@@ -119,7 +119,7 @@\n         <atomikos.version>3.9.3</atomikos.version>\n         <!-- Additional JVM system arguments -->\n         <extraVmArgs/>\n-        <vmHeapSettings>-Xms512m -Xmx2G -XX:MaxPermSize=1024M</vmHeapSettings>\n+        <vmHeapSettings>-Xms512m -Xmx2G</vmHeapSettings>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2b9d5d2db0afc0dd082654ddf8bfe1e77db3c1f"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 822, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}