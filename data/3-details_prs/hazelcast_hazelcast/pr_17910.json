{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwMTYzNjQ3", "number": 17910, "title": "Add remove logger method to LoggingService and LoggerFactory interfaces", "bodyText": "related hazelcast/hazelcast-jet#2703\nEE: hazelcast/hazelcast-enterprise#3868", "createdAt": "2020-12-01T09:37:02Z", "url": "https://github.com/hazelcast/hazelcast/pull/17910", "merged": true, "mergeCommit": {"oid": "91e088d446809633166247cc051294cf25e32215"}, "closed": true, "closedAt": "2020-12-04T07:04:43Z", "author": {"login": "gurbuzali"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdh2oq9AH2gAyNTMwMTYzNjQ3OjJmNjU1YjlmYjc0M2Q4OWY2OTQwOWYxYzIyNTM4ODEwMDVmYjk3YTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdimgj0gFqTU0NDE5OTExMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2f655b9fb743d89f69409f1c2253881005fb97a7", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast/commit/2f655b9fb743d89f69409f1c2253881005fb97a7", "committedDate": "2020-12-01T09:36:02Z", "message": "Add remove logger method to LoggingService and LoggerFactory interfaces"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxOTE2OTg1", "url": "https://github.com/hazelcast/hazelcast/pull/17910#pullrequestreview-541916985", "createdAt": "2020-12-01T13:57:13Z", "commit": {"oid": "2f655b9fb743d89f69409f1c2253881005fb97a7"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNDoxNTo0OVrOH8uhlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNDoxNjo0M1rOH8ukPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQzODg2OQ==", "bodyText": "Should be removeLogger", "url": "https://github.com/hazelcast/hazelcast/pull/17910#discussion_r533438869", "createdAt": "2020-12-01T14:15:49Z", "author": {"login": "puzpuzpuz"}, "path": "hazelcast/src/main/java/com/hazelcast/logging/LoggingService.java", "diffHunk": "@@ -28,4 +28,8 @@\n     @Nonnull ILogger getLogger(@Nonnull String name);\n \n     @Nonnull ILogger getLogger(@Nonnull Class type);\n+\n+    void reoveLogger(@Nonnull String name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f655b9fb743d89f69409f1c2253881005fb97a7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQzODk1Mg==", "bodyText": "Should be removeLogger", "url": "https://github.com/hazelcast/hazelcast/pull/17910#discussion_r533438952", "createdAt": "2020-12-01T14:15:56Z", "author": {"login": "puzpuzpuz"}, "path": "hazelcast/src/main/java/com/hazelcast/logging/LoggingService.java", "diffHunk": "@@ -28,4 +28,8 @@\n     @Nonnull ILogger getLogger(@Nonnull String name);\n \n     @Nonnull ILogger getLogger(@Nonnull Class type);\n+\n+    void reoveLogger(@Nonnull String name);\n+\n+    void reoveLogger(@Nonnull Class type);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f655b9fb743d89f69409f1c2253881005fb97a7"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQzOTU0OA==", "bodyText": "javax.annotation.Nonnull should be used instead of this one", "url": "https://github.com/hazelcast/hazelcast/pull/17910#discussion_r533439548", "createdAt": "2020-12-01T14:16:43Z", "author": {"login": "puzpuzpuz"}, "path": "hazelcast/src/main/java/com/hazelcast/logging/impl/LoggingServiceImpl.java", "diffHunk": "@@ -27,6 +27,7 @@\n import com.hazelcast.logging.Logger;\n import com.hazelcast.logging.LoggerFactory;\n import com.hazelcast.logging.LoggingService;\n+import org.jetbrains.annotations.NotNull;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f655b9fb743d89f69409f1c2253881005fb97a7"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce9f3c98d721259ecbbda0befdcf856e82cc3562", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast/commit/ce9f3c98d721259ecbbda0befdcf856e82cc3562", "committedDate": "2020-12-01T15:58:51Z", "message": "address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "729e75f8403722265c918f5e3e8232dcfc8a6851", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast/commit/729e75f8403722265c918f5e3e8232dcfc8a6851", "committedDate": "2020-12-01T16:47:43Z", "message": "Add removeLogger to Logger"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMTAzOTk4", "url": "https://github.com/hazelcast/hazelcast/pull/17910#pullrequestreview-542103998", "createdAt": "2020-12-01T16:55:29Z", "commit": {"oid": "729e75f8403722265c918f5e3e8232dcfc8a6851"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNjo1NToyOVrOH82dsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNjo1NzoyMlrOH82jCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2ODk0NA==", "bodyText": "nit: I think the old javadoc was closer to the truth, as clazz is not the class of the logger, but the class for which the logger is created/obtained.", "url": "https://github.com/hazelcast/hazelcast/pull/17910#discussion_r533568944", "createdAt": "2020-12-01T16:55:29Z", "author": {"login": "puzpuzpuz"}, "path": "hazelcast/src/main/java/com/hazelcast/logging/Logger.java", "diffHunk": "@@ -57,7 +57,7 @@ private Logger() {\n     /**\n      * Obtains a {@link ILogger logger} for the given {@code clazz}.\n      *\n-     * @param clazz the class to obtain the logger for.\n+     * @param clazz the class of the logger to obtain.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "729e75f8403722265c918f5e3e8232dcfc8a6851"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU3MDMxMw==", "bodyText": "We can get a NPE because of this change as if statement checks loggerFactory, but the internal block operates on existingFactory. The old code seems to be correct to me as it was reading a volatile fields into a local variable and then operating on it.", "url": "https://github.com/hazelcast/hazelcast/pull/17910#discussion_r533570313", "createdAt": "2020-12-01T16:57:22Z", "author": {"login": "puzpuzpuz"}, "path": "hazelcast/src/main/java/com/hazelcast/logging/Logger.java", "diffHunk": "@@ -71,16 +71,40 @@ public static ILogger getLogger(Class clazz) {\n      * @return the obtained logger.\n      */\n     public static ILogger getLogger(String name) {\n-        // try the fast path first\n         LoggerFactory existingFactory = loggerFactory;\n-        if (existingFactory != null) {\n+        if (loggerFactory != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "729e75f8403722265c918f5e3e8232dcfc8a6851"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMTY3NjA2", "url": "https://github.com/hazelcast/hazelcast/pull/17910#pullrequestreview-542167606", "createdAt": "2020-12-01T18:10:12Z", "commit": {"oid": "729e75f8403722265c918f5e3e8232dcfc8a6851"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxODoxMDoxMlrOH85iCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxODoxMDoxMlrOH85iCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYxOTIwOA==", "bodyText": "nit: it would be nice to have input validation (e.g. checkNotNull(clazz, \"class must not be null\");) in this and other public methods of this class.", "url": "https://github.com/hazelcast/hazelcast/pull/17910#discussion_r533619208", "createdAt": "2020-12-01T18:10:12Z", "author": {"login": "puzpuzpuz"}, "path": "hazelcast/src/main/java/com/hazelcast/logging/Logger.java", "diffHunk": "@@ -71,16 +71,40 @@ public static ILogger getLogger(Class clazz) {\n      * @return the obtained logger.\n      */\n     public static ILogger getLogger(String name) {\n-        // try the fast path first\n         LoggerFactory existingFactory = loggerFactory;\n-        if (existingFactory != null) {\n+        if (loggerFactory != null) {\n             return existingFactory.getLogger(name);\n         }\n+        return createFactoryInternal(name).getLogger(name);\n+    }\n \n+    /**\n+     * Removes the {@link ILogger logger} for the given {@code clazz}.\n+     *\n+     * @param clazz the class of the logger to remove.\n+     */\n+    public static void removeLogger(Class clazz) {\n+        removeLogger(clazz.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "729e75f8403722265c918f5e3e8232dcfc8a6851"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe9905945804e4cca1a7a2ef54b97d1bf5ebc9f0", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast/commit/fe9905945804e4cca1a7a2ef54b97d1bf5ebc9f0", "committedDate": "2020-12-01T18:36:00Z", "message": "more review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNTU4Njgx", "url": "https://github.com/hazelcast/hazelcast/pull/17910#pullrequestreview-542558681", "createdAt": "2020-12-02T07:29:17Z", "commit": {"oid": "fe9905945804e4cca1a7a2ef54b97d1bf5ebc9f0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNzoyOToxN1rOH9NoyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNzozMTozMVrOH9NsxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk0ODYxNw==", "bodyText": "Should be javax.annotation.Nonnull", "url": "https://github.com/hazelcast/hazelcast/pull/17910#discussion_r533948617", "createdAt": "2020-12-02T07:29:17Z", "author": {"login": "puzpuzpuz"}, "path": "hazelcast/src/main/java/com/hazelcast/client/impl/clientside/ClientLoggingService.java", "diffHunk": "@@ -18,14 +18,15 @@\n \n import com.hazelcast.instance.BuildInfo;\n import com.hazelcast.instance.JetBuildInfo;\n+import com.hazelcast.internal.util.ConstructorFunction;\n import com.hazelcast.logging.AbstractLogger;\n import com.hazelcast.logging.ILogger;\n import com.hazelcast.logging.LogEvent;\n import com.hazelcast.logging.LogListener;\n import com.hazelcast.logging.Logger;\n import com.hazelcast.logging.LoggerFactory;\n import com.hazelcast.logging.LoggingService;\n-import com.hazelcast.internal.util.ConstructorFunction;\n+import org.jetbrains.annotations.NotNull;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe9905945804e4cca1a7a2ef54b97d1bf5ebc9f0"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk0OTYzNg==", "bodyText": "String name seems to be unused.", "url": "https://github.com/hazelcast/hazelcast/pull/17910#discussion_r533949636", "createdAt": "2020-12-02T07:31:31Z", "author": {"login": "puzpuzpuz"}, "path": "hazelcast/src/main/java/com/hazelcast/logging/Logger.java", "diffHunk": "@@ -70,17 +75,52 @@ public static ILogger getLogger(Class clazz) {\n      * @param name the name of the logger to obtain.\n      * @return the obtained logger.\n      */\n-    public static ILogger getLogger(String name) {\n-        // try the fast path first\n+    public static ILogger getLogger(@Nonnull String name) {\n+        checkNotNull(name, \"name must not be null\");\n+        return getLoggerInternal(name);\n+    }\n+\n+    private static ILogger getLoggerInternal(String name) {\n         LoggerFactory existingFactory = loggerFactory;\n         if (existingFactory != null) {\n             return existingFactory.getLogger(name);\n         }\n+        return createFactoryInternal(name).getLogger(name);\n+    }\n+\n+    /**\n+     * Removes the {@link ILogger logger} for the given {@code clazz}.\n+     *\n+     * @param clazz the class to remove the logger for.\n+     */\n+    public static void removeLogger(Class clazz) {\n+        checkNotNull(clazz, \"class must not be null\");\n+        removeLoggerInternal(clazz.getName());\n+    }\n+\n+    /**\n+     * Removes the {@link ILogger logger} for the given {@code name}.\n+     *\n+     * @param name the name of the logger to remove.\n+     */\n+    public static void removeLogger(String name) {\n+        checkNotNull(name, \"name must not be null\");\n+        removeLoggerInternal(name);\n+    }\n+\n+    private static void removeLoggerInternal(String name) {\n+        LoggerFactory existingFactory = loggerFactory;\n+        if (existingFactory != null) {\n+            existingFactory.removeLogger(name);\n+        }\n+        createFactoryInternal(name).removeLogger(name);\n+    }\n \n+    private static LoggerFactory createFactoryInternal(String name) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe9905945804e4cca1a7a2ef54b97d1bf5ebc9f0"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62c8daf1619956dd2e615860f96024520934c2b7", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast/commit/62c8daf1619956dd2e615860f96024520934c2b7", "committedDate": "2020-12-02T08:44:39Z", "message": "review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNjMzMjEw", "url": "https://github.com/hazelcast/hazelcast/pull/17910#pullrequestreview-542633210", "createdAt": "2020-12-02T09:16:32Z", "commit": {"oid": "62c8daf1619956dd2e615860f96024520934c2b7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMDgwMzAx", "url": "https://github.com/hazelcast/hazelcast/pull/17910#pullrequestreview-543080301", "createdAt": "2020-12-02T17:36:50Z", "commit": {"oid": "62c8daf1619956dd2e615860f96024520934c2b7"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNzozNjo1MFrOH9meIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNzozOTo0MlrOH9mluA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM1NTQ5MA==", "bodyText": "Does this need to be synchronized with concurrent calls to getLogger? I can see all calls to getLogger are thread-safe as they use striped locks but removeLogger here does not coordinate with methods adding loggers.", "url": "https://github.com/hazelcast/hazelcast/pull/17910#discussion_r534355490", "createdAt": "2020-12-02T17:36:50Z", "author": {"login": "mmedenjak"}, "path": "hazelcast/src/main/java/com/hazelcast/client/impl/clientside/ClientLoggingService.java", "diffHunk": "@@ -86,6 +86,21 @@ public ILogger getLogger(@Nonnull Class clazz) {\n         return getOrPutIfAbsent(mapLoggers, clazz.getName(), loggerConstructor);\n     }\n \n+    @Override\n+    public void removeLogger(@Nonnull String name) {\n+        checkNotNull(name, \"name must not be null\");\n+        loggerFactory.removeLogger(name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62c8daf1619956dd2e615860f96024520934c2b7"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM1NzQzMg==", "bodyText": "Same as in client logging service.", "url": "https://github.com/hazelcast/hazelcast/pull/17910#discussion_r534357432", "createdAt": "2020-12-02T17:39:42Z", "author": {"login": "mmedenjak"}, "path": "hazelcast/src/main/java/com/hazelcast/logging/impl/LoggingServiceImpl.java", "diffHunk": "@@ -83,6 +83,21 @@ public ILogger getLogger(@Nonnull Class clazz) {\n         return getOrPutIfAbsent(mapLoggers, clazz.getName(), loggerConstructor);\n     }\n \n+    @Override\n+    public void removeLogger(@Nonnull String name) {\n+        checkNotNull(name, \"name must not be null\");\n+        loggerFactory.removeLogger(name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62c8daf1619956dd2e615860f96024520934c2b7"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7bf93b154d5eb3396b742ba598718d514d7d43a", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast/commit/c7bf93b154d5eb3396b742ba598718d514d7d43a", "committedDate": "2020-12-03T07:00:55Z", "message": "guard factory logger removal with computeIfPresent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MTk5MTEy", "url": "https://github.com/hazelcast/hazelcast/pull/17910#pullrequestreview-544199112", "createdAt": "2020-12-03T17:22:37Z", "commit": {"oid": "c7bf93b154d5eb3396b742ba598718d514d7d43a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2989, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}