{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1NDUzNjU5", "number": 17958, "reviewThreads": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwOToyNzowM1rOFJer-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNTo0MDo1MlrOFQdBYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NDg0MjgxOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/spi/properties/ClusterProperty.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQwOToyNzowM1rOIL1QGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxODo1OTo0M1rOIMAALA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI3NzcyMQ==", "bodyText": "Hi @sgflt,\nsince we have decided to give full config support for this the property support is needed. Can we remove this back? Sorry for the inconvenience.", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r549277721", "createdAt": "2020-12-28T09:27:03Z", "author": {"login": "sancar"}, "path": "hazelcast/src/main/java/com/hazelcast/spi/properties/ClusterProperty.java", "diffHunk": "@@ -1546,6 +1546,18 @@ private int getWhenNoSSLDetected() {\n             = new HazelcastProperty(\"hazelcast.serialization.version\",\n             BuildInfoProvider.getBuildInfo().getSerializationVersion());\n \n+    /**\n+     * Property allows override of default Java serializers for backward compatibility.\n+     *\n+     * For example application using older version of Hazelcast provides custom java.util.Optional serializer.\n+     * Since version 4.2 of Hazelcast registration of any serializer for an embedded type is not possible\n+     * until this flag is set to true.\n+     *\n+     * @since 4.2\n+     */\n+    public static final HazelcastProperty SERIALIZATION_ALLOW_OVERRIDE_DEFAULT_SERIALIZERS", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc86a6c38908a24d9dffcd685d56ec246abc9bf6"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI5ODEwMg==", "bodyText": "Hi @sancar, I followed widely used way of configuration:\n\nsystem property - useful for debug or fine tuning, overrides config file\nstandard config file as persistent configuration\n\nSo the final decision is to drop the system property support? It simplifies some code paths, but removes duality of configuration, which may be useful in some use cases.", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r549298102", "createdAt": "2020-12-28T10:33:49Z", "author": {"login": "sgflt"}, "path": "hazelcast/src/main/java/com/hazelcast/spi/properties/ClusterProperty.java", "diffHunk": "@@ -1546,6 +1546,18 @@ private int getWhenNoSSLDetected() {\n             = new HazelcastProperty(\"hazelcast.serialization.version\",\n             BuildInfoProvider.getBuildInfo().getSerializationVersion());\n \n+    /**\n+     * Property allows override of default Java serializers for backward compatibility.\n+     *\n+     * For example application using older version of Hazelcast provides custom java.util.Optional serializer.\n+     * Since version 4.2 of Hazelcast registration of any serializer for an embedded type is not possible\n+     * until this flag is set to true.\n+     *\n+     * @since 4.2\n+     */\n+    public static final HazelcastProperty SERIALIZATION_ALLOW_OVERRIDE_DEFAULT_SERIALIZERS", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI3NzcyMQ=="}, "originalCommit": {"oid": "cc86a6c38908a24d9dffcd685d56ec246abc9bf6"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMxNTY0OQ==", "bodyText": "We are not putting configuration to both properties and config unless we have to.\nAnd I have just learned that we applied a feature that allows you to override Config via properties anyway.\nhttps://docs.hazelcast.org/docs/latest/manual/html-single/#overriding-configuration\nSo when you add it to Config, the property support is added automagically :)", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r549315649", "createdAt": "2020-12-28T11:33:47Z", "author": {"login": "sancar"}, "path": "hazelcast/src/main/java/com/hazelcast/spi/properties/ClusterProperty.java", "diffHunk": "@@ -1546,6 +1546,18 @@ private int getWhenNoSSLDetected() {\n             = new HazelcastProperty(\"hazelcast.serialization.version\",\n             BuildInfoProvider.getBuildInfo().getSerializationVersion());\n \n+    /**\n+     * Property allows override of default Java serializers for backward compatibility.\n+     *\n+     * For example application using older version of Hazelcast provides custom java.util.Optional serializer.\n+     * Since version 4.2 of Hazelcast registration of any serializer for an embedded type is not possible\n+     * until this flag is set to true.\n+     *\n+     * @since 4.2\n+     */\n+    public static final HazelcastProperty SERIALIZATION_ALLOW_OVERRIDE_DEFAULT_SERIALIZERS", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI3NzcyMQ=="}, "originalCommit": {"oid": "cc86a6c38908a24d9dffcd685d56ec246abc9bf6"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzNDE5Ng==", "bodyText": "Oh nice :) I am going to investigate this feature.", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r549434196", "createdAt": "2020-12-28T18:00:31Z", "author": {"login": "sgflt"}, "path": "hazelcast/src/main/java/com/hazelcast/spi/properties/ClusterProperty.java", "diffHunk": "@@ -1546,6 +1546,18 @@ private int getWhenNoSSLDetected() {\n             = new HazelcastProperty(\"hazelcast.serialization.version\",\n             BuildInfoProvider.getBuildInfo().getSerializationVersion());\n \n+    /**\n+     * Property allows override of default Java serializers for backward compatibility.\n+     *\n+     * For example application using older version of Hazelcast provides custom java.util.Optional serializer.\n+     * Since version 4.2 of Hazelcast registration of any serializer for an embedded type is not possible\n+     * until this flag is set to true.\n+     *\n+     * @since 4.2\n+     */\n+    public static final HazelcastProperty SERIALIZATION_ALLOW_OVERRIDE_DEFAULT_SERIALIZERS", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI3NzcyMQ=="}, "originalCommit": {"oid": "cc86a6c38908a24d9dffcd685d56ec246abc9bf6"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ1Mzg2OA==", "bodyText": "Property removed", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r549453868", "createdAt": "2020-12-28T18:59:43Z", "author": {"login": "sgflt"}, "path": "hazelcast/src/main/java/com/hazelcast/spi/properties/ClusterProperty.java", "diffHunk": "@@ -1546,6 +1546,18 @@ private int getWhenNoSSLDetected() {\n             = new HazelcastProperty(\"hazelcast.serialization.version\",\n             BuildInfoProvider.getBuildInfo().getSerializationVersion());\n \n+    /**\n+     * Property allows override of default Java serializers for backward compatibility.\n+     *\n+     * For example application using older version of Hazelcast provides custom java.util.Optional serializer.\n+     * Since version 4.2 of Hazelcast registration of any serializer for an embedded type is not possible\n+     * until this flag is set to true.\n+     *\n+     * @since 4.2\n+     */\n+    public static final HazelcastProperty SERIALIZATION_ALLOW_OVERRIDE_DEFAULT_SERIALIZERS", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI3NzcyMQ=="}, "originalCommit": {"oid": "cc86a6c38908a24d9dffcd685d56ec246abc9bf6"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NDkyMDg5OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/config/SerializationConfig.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxMDowMjo0NVrOIL16rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxODo1OTozNlrOIMAAEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI4ODYyMQ==", "bodyText": "Can we add something like following into Javadoc of the set method?\nThis configuration should be used cautiously. Default serializers are used heavily by the hazelcast internally. \nIf any of the instance in the same cluster overrides a default serializer, all the members and clients in the same cluster must override it with the same serializer. \nThis configuration is introduced specifically to support the following case:\n1. There was a custom configuration by the user for a type \n2. Hazelcast decided to add a default serializer for the same type in a future release.\nTo be able to support Rolling Upgrade from an old version to the new version, one needs to make sure of the backward compatibility of the serialization. As a solution, the user will set this property on the new version so that new instances will be able to override new default serializers with their existing custom serializers.", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r549288621", "createdAt": "2020-12-28T10:02:45Z", "author": {"login": "sancar"}, "path": "hazelcast/src/main/java/com/hazelcast/config/SerializationConfig.java", "diffHunk": "@@ -454,6 +455,20 @@ public SerializationConfig setAllowUnsafe(boolean allowUnsafe) {\n         return this;\n     }\n \n+    /**\n+     * @return true if embedded serializers may be overridden by custom serializers\n+     *\n+     * @since 4.2\n+     */\n+    public boolean isAllowOverrideDefaultSerializers() {\n+        return allowOverrideDefaultSerializers;\n+    }\n+\n+    public SerializationConfig setAllowOverrideDefaultSerializers(final boolean allowOverrideDefaultSerializers) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc86a6c38908a24d9dffcd685d56ec246abc9bf6"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ1Mzg0Mg==", "bodyText": "Javadoc added", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r549453842", "createdAt": "2020-12-28T18:59:36Z", "author": {"login": "sgflt"}, "path": "hazelcast/src/main/java/com/hazelcast/config/SerializationConfig.java", "diffHunk": "@@ -454,6 +455,20 @@ public SerializationConfig setAllowUnsafe(boolean allowUnsafe) {\n         return this;\n     }\n \n+    /**\n+     * @return true if embedded serializers may be overridden by custom serializers\n+     *\n+     * @since 4.2\n+     */\n+    public boolean isAllowOverrideDefaultSerializers() {\n+        return allowOverrideDefaultSerializers;\n+    }\n+\n+    public SerializationConfig setAllowOverrideDefaultSerializers(final boolean allowOverrideDefaultSerializers) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI4ODYyMQ=="}, "originalCommit": {"oid": "cc86a6c38908a24d9dffcd685d56ec246abc9bf6"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NDkyNDAyOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/impl/AbstractSerializationService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxMDowNDoxNlrOIL18Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxOTowNzo0NlrOIMAIZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI4OTA0Ng==", "bodyText": "Since we will be removing the property, please do not forget to update this part as SerializationConfig. setAllowOverrideDefaultSerializers", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r549289046", "createdAt": "2020-12-28T10:04:16Z", "author": {"login": "sancar"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/impl/AbstractSerializationService.java", "diffHunk": "@@ -425,8 +427,11 @@ protected final boolean safeRegister(final Class type, final Serializer serializ\n     }\n \n     protected final boolean safeRegister(final Class type, final SerializerAdapter serializer) {\n-        if (constantTypesMap.containsKey(type)) {\n-            throw new IllegalArgumentException(\"[\" + type + \"] serializer cannot be overridden\");\n+        if (constantTypesMap.containsKey(type) && !allowOverrideDefaultSerializers) {\n+            throw new IllegalArgumentException(\n+                \"[\" + type + \"] serializer cannot be overridden.\"\n+                + \" See hazelcast.serialization.allowOverrideDefaultSerializers\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc86a6c38908a24d9dffcd685d56ec246abc9bf6"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ1NTk3NQ==", "bodyText": "Message updated", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r549455975", "createdAt": "2020-12-28T19:07:46Z", "author": {"login": "sgflt"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/impl/AbstractSerializationService.java", "diffHunk": "@@ -425,8 +427,11 @@ protected final boolean safeRegister(final Class type, final Serializer serializ\n     }\n \n     protected final boolean safeRegister(final Class type, final SerializerAdapter serializer) {\n-        if (constantTypesMap.containsKey(type)) {\n-            throw new IllegalArgumentException(\"[\" + type + \"] serializer cannot be overridden\");\n+        if (constantTypesMap.containsKey(type) && !allowOverrideDefaultSerializers) {\n+            throw new IllegalArgumentException(\n+                \"[\" + type + \"] serializer cannot be overridden.\"\n+                + \" See hazelcast.serialization.allowOverrideDefaultSerializers\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI4OTA0Ng=="}, "originalCommit": {"oid": "cc86a6c38908a24d9dffcd685d56ec246abc9bf6"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NTAzMjUwOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/config/SerializationConfig.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxMDo1NToxMlrOIL24NA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxOToxMDoxOVrOIMALFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMwNDM3Mg==", "bodyText": "Can we put field to equals/hashcode/toString methods of SerializationConfig?", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r549304372", "createdAt": "2020-12-28T10:55:12Z", "author": {"login": "sancar"}, "path": "hazelcast/src/main/java/com/hazelcast/config/SerializationConfig.java", "diffHunk": "@@ -51,6 +51,7 @@\n     private boolean allowUnsafe;\n     private final Set<ClassDefinition> classDefinitions;\n     private JavaSerializationFilterConfig javaSerializationFilterConfig;\n+    private boolean allowOverrideDefaultSerializers;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc86a6c38908a24d9dffcd685d56ec246abc9bf6"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ1NjY2Mw==", "bodyText": "fixed", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r549456663", "createdAt": "2020-12-28T19:10:19Z", "author": {"login": "sgflt"}, "path": "hazelcast/src/main/java/com/hazelcast/config/SerializationConfig.java", "diffHunk": "@@ -51,6 +51,7 @@\n     private boolean allowUnsafe;\n     private final Set<ClassDefinition> classDefinitions;\n     private JavaSerializationFilterConfig javaSerializationFilterConfig;\n+    private boolean allowOverrideDefaultSerializers;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMwNDM3Mg=="}, "originalCommit": {"oid": "cc86a6c38908a24d9dffcd685d56ec246abc9bf6"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyNzQ4NDE0OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/config/SerializationConfig.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNDowMjowNVrOIWPqhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNDowMjowNVrOIWPqhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDE5NjIzMQ==", "bodyText": "Minor: Could be replaced with\n@return {@code true} if default serializers may be overridden by custom serializers\n\nto be more consistent with the name of the method", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r560196231", "createdAt": "2021-01-19T14:02:05Z", "author": {"login": "mdumandag"}, "path": "hazelcast/src/main/java/com/hazelcast/config/SerializationConfig.java", "diffHunk": "@@ -454,6 +455,46 @@ public SerializationConfig setAllowUnsafe(boolean allowUnsafe) {\n         return this;\n     }\n \n+    /**\n+     * @return true if embedded serializers may be overridden by custom serializers", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyNzU2MjQ2OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/impl/AbstractSerializationService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNDoxOTo1OVrOIWQa5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQxNTozNDoxMlrOIXESnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDIwODYxNA==", "bodyText": "Can be final", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r560208614", "createdAt": "2021-01-19T14:19:59Z", "author": {"login": "mdumandag"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/impl/AbstractSerializationService.java", "diffHunk": "@@ -90,6 +90,7 @@\n     private volatile boolean active = true;\n     private final byte version;\n     private final ILogger logger = Logger.getLogger(InternalSerializationService.class);\n+    private boolean allowOverrideDefaultSerializers;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTA1ODQ2MQ==", "bodyText": "Final revelaed small bug in Second constructor :)", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r561058461", "createdAt": "2021-01-20T15:34:12Z", "author": {"login": "sgflt"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/impl/AbstractSerializationService.java", "diffHunk": "@@ -90,6 +90,7 @@\n     private volatile boolean active = true;\n     private final byte version;\n     private final ILogger logger = Logger.getLogger(InternalSerializationService.class);\n+    private boolean allowOverrideDefaultSerializers;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDIwODYxNA=="}, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyNzU3OTkzOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/impl/AbstractSerializationService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNDoyMzozNlrOIWQlXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNDoyMzozNlrOIWQlXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDIxMTI5Mw==", "bodyText": "We can be more specific here and mention about the setAllowOverrideDefaultSerializers method", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r560211293", "createdAt": "2021-01-19T14:23:36Z", "author": {"login": "mdumandag"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/impl/AbstractSerializationService.java", "diffHunk": "@@ -425,8 +427,11 @@ protected final boolean safeRegister(final Class type, final Serializer serializ\n     }\n \n     protected final boolean safeRegister(final Class type, final SerializerAdapter serializer) {\n-        if (constantTypesMap.containsKey(type)) {\n-            throw new IllegalArgumentException(\"[\" + type + \"] serializer cannot be overridden\");\n+        if (constantTypesMap.containsKey(type) && !allowOverrideDefaultSerializers) {\n+            throw new IllegalArgumentException(\n+                \"[\" + type + \"] serializer cannot be overridden.\"\n+                + \" See documentation of hazelcast serialization configuration.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyNzcyMTYzOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/impl/AbstractSerializationService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNDo1MTo0OVrOIWR71Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNDo1MTo0OVrOIWR71Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDIzMzQyOQ==", "bodyText": "We should also add this to the copy constructor below", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r560233429", "createdAt": "2021-01-19T14:51:49Z", "author": {"login": "mdumandag"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/impl/AbstractSerializationService.java", "diffHunk": "@@ -102,6 +103,7 @@\n         this.bufferPoolThreadLocal = new BufferPoolThreadLocal(this, builder.bufferPoolFactory,\n                 builder.notActiveExceptionSupplier);\n         this.nullSerializerAdapter = createSerializerAdapter(new ConstantSerializers.NullSerializer());\n+        this.allowOverrideDefaultSerializers = builder.allowOverrideDefaultSerializers;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyNzc1MzMzOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/resources/hazelcast-client-full-example.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNDo1Nzo0NlrOIWSPDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNDo1Nzo0NlrOIWSPDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDIzODM0OA==", "bodyText": "Minor: I see that for the configs above, we mention the default value. Maybe we can do that here too.\nAlso, I think that we should replace embedded with default to be consistent with the configuration name.", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r560238348", "createdAt": "2021-01-19T14:57:46Z", "author": {"login": "mdumandag"}, "path": "hazelcast/src/main/resources/hazelcast-client-full-example.xml", "diffHunk": "@@ -470,6 +470,8 @@\n             Set as true to enable shared object when default Java serialization is used. Its default value is false.\n         * <allow-unsafe>:\n             Set as true to allow the usage of unsafe. Its default value is false.\n+        * <allow-override-default-serializers>:\n+            Set as true to allow override of embedded serializers.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyNzc1NzcyOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/resources/hazelcast-client-full-example.yaml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNDo1ODozMlrOIWSRkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNDo1ODozMlrOIWSRkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDIzODk5NA==", "bodyText": "Minor: I see that for the configs above, we mention the default value. Maybe we can do that here too.\nAlso, I think that we should replace embedded with default to be consistent with the configuration name.", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r560238994", "createdAt": "2021-01-19T14:58:32Z", "author": {"login": "mdumandag"}, "path": "hazelcast/src/main/resources/hazelcast-client-full-example.yaml", "diffHunk": "@@ -413,6 +413,8 @@ hazelcast-client:\n   #     Set as true to enable shared object when default Java serialization is used. Its default value is false.\n   # * \"allow-unsafe\":\n   #     Set as true to allow the usage of unsafe. Its default value is false.\n+  # * \"allow-override-default-serializers\":\n+  #     Set as true to allow override of embedded serializers.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyNzc3NTE3OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/resources/hazelcast-config-4.2.xsd", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNTowMjowMlrOIWScmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxNToyOTo0NVrOIX8EaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI0MTgxNg==", "bodyText": "Minor: I think that we should replace embedded with default to be consistent with the configuration name.", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r560241816", "createdAt": "2021-01-19T15:02:02Z", "author": {"login": "mdumandag"}, "path": "hazelcast/src/main/resources/hazelcast-config-4.2.xsd", "diffHunk": "@@ -2959,6 +2959,14 @@\n                     </xs:documentation>\n                 </xs:annotation>\n             </xs:element>\n+            <xs:element name=\"allow-override-default-serializers\" type=\"xs:boolean\" minOccurs=\"0\" maxOccurs=\"1\" default=\"false\">\n+                <xs:annotation>\n+                    <xs:documentation>\n+                        True to allow override of embedded serializers.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTk3MjMyOQ==", "bodyText": "fixed", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r561972329", "createdAt": "2021-01-21T15:29:45Z", "author": {"login": "sgflt"}, "path": "hazelcast/src/main/resources/hazelcast-config-4.2.xsd", "diffHunk": "@@ -2959,6 +2959,14 @@\n                     </xs:documentation>\n                 </xs:annotation>\n             </xs:element>\n+            <xs:element name=\"allow-override-default-serializers\" type=\"xs:boolean\" minOccurs=\"0\" maxOccurs=\"1\" default=\"false\">\n+                <xs:annotation>\n+                    <xs:documentation>\n+                        True to allow override of embedded serializers.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI0MTgxNg=="}, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyNzc3ODgzOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/resources/hazelcast-full-example.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNTowMjo0OVrOIWSfBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxNToyNjo0NFrOIX751g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI0MjQzOA==", "bodyText": "Minor: I see that for the configs above, we mention the default value. Maybe we can do that here too.\nAlso, I think that we should replace embedded with default to be consistent with the configuration name.", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r560242438", "createdAt": "2021-01-19T15:02:49Z", "author": {"login": "mdumandag"}, "path": "hazelcast/src/main/resources/hazelcast-full-example.xml", "diffHunk": "@@ -2045,6 +2045,8 @@\n             Set as true to enable shared object when default Java serialization is used. Its default value is false.\n         * <allow-unsafe>:\n             Set as true to allow the usage of unsafe. Its default value is false.\n+        * <allow-override-default-serializers>:\n+            Set as true to allow override of embedded serializers.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTk2OTYyMg==", "bodyText": "fixed", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r561969622", "createdAt": "2021-01-21T15:26:44Z", "author": {"login": "sgflt"}, "path": "hazelcast/src/main/resources/hazelcast-full-example.xml", "diffHunk": "@@ -2045,6 +2045,8 @@\n             Set as true to enable shared object when default Java serialization is used. Its default value is false.\n         * <allow-unsafe>:\n             Set as true to allow the usage of unsafe. Its default value is false.\n+        * <allow-override-default-serializers>:\n+            Set as true to allow override of embedded serializers.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI0MjQzOA=="}, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyNzc3OTc3OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/resources/hazelcast-full-example.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNTowMjo1OFrOIWSfhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMVQxNToxMjoxN1rOIX7MXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI0MjU2Ng==", "bodyText": "Minor: I see that for the configs above, we mention the default value. Maybe we can do that here too.\nAlso, I think that we should replace embedded with default to be consistent with the configuration name.", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r560242566", "createdAt": "2021-01-19T15:02:58Z", "author": {"login": "mdumandag"}, "path": "hazelcast/src/main/resources/hazelcast-full-example.yaml", "diffHunk": "@@ -2023,6 +2023,8 @@ hazelcast:\n   #     Set as true to enable shared object when default Java serialization is used. Its default value is false.\n   # * \"allow-unsafe\":\n   #     Set as true to allow the usage of unsafe. Its default value is false.\n+  # * \"allow-override-default-serializers\":\n+  #     Set as true to allow override of embedded serializers.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTk1Nzk4MQ==", "bodyText": "I have to Apologize, I have missed it.", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r561957981", "createdAt": "2021-01-21T15:12:17Z", "author": {"login": "sgflt"}, "path": "hazelcast/src/main/resources/hazelcast-full-example.yaml", "diffHunk": "@@ -2023,6 +2023,8 @@ hazelcast:\n   #     Set as true to enable shared object when default Java serialization is used. Its default value is false.\n   # * \"allow-unsafe\":\n   #     Set as true to allow the usage of unsafe. Its default value is false.\n+  # * \"allow-override-default-serializers\":\n+  #     Set as true to allow override of embedded serializers.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI0MjU2Ng=="}, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyNzkyNjcwOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/test/java/com/hazelcast/internal/serialization/impl/CustomSerializationOverrideDefaultTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNTozMTo1NVrOIWT6TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNTozMTo1NVrOIWT6TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI2NTgwNQ==", "bodyText": "Minor: Can you reformat this file with 4-spaces per tab instead of 2?", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r560265805", "createdAt": "2021-01-19T15:31:55Z", "author": {"login": "mdumandag"}, "path": "hazelcast/src/test/java/com/hazelcast/internal/serialization/impl/CustomSerializationOverrideDefaultTest.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyNzk0NDg2OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/test/java/com/hazelcast/internal/serialization/impl/CustomSerializationOverrideDefaultTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNTozNTo0NlrOIWUFrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNTozNTo0NlrOIWUFrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI2ODcxNg==", "bodyText": "Not a big deal for this test suite but there is no need to run these serially. You can replace these lines with\n@RunWith(HazelcastParallelClassRunner.class)\n@Category({QuickTest.class, ParallelJVMTest.class})", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r560268716", "createdAt": "2021-01-19T15:35:46Z", "author": {"login": "mdumandag"}, "path": "hazelcast/src/test/java/com/hazelcast/internal/serialization/impl/CustomSerializationOverrideDefaultTest.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.internal.serialization.impl;\n+\n+import com.hazelcast.config.SerializationConfig;\n+import com.hazelcast.config.SerializerConfig;\n+import com.hazelcast.internal.serialization.Data;\n+import com.hazelcast.internal.serialization.SerializationService;\n+import com.hazelcast.nio.ObjectDataInput;\n+import com.hazelcast.nio.ObjectDataOutput;\n+import com.hazelcast.nio.serialization.StreamSerializer;\n+import com.hazelcast.test.HazelcastSerialClassRunner;\n+import com.hazelcast.test.annotation.QuickTest;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.junit.runner.RunWith;\n+\n+import java.io.IOException;\n+import java.util.Optional;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotEquals;\n+\n+@RunWith(HazelcastSerialClassRunner.class)\n+@Category(QuickTest.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyNzk2NzUyOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/SerializationServiceBuilder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNTo0MDoxNVrOIWUTJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMFQwNjo0MzowNlrOIWvLRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI3MjE2Nw==", "bodyText": "I feel like this method is unnecessary. We will be able to set this via setConfig. If I am not mistaken, we are not using this anywhere, right?\n@sancar What do you think about it?", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r560272167", "createdAt": "2021-01-19T15:40:15Z", "author": {"login": "mdumandag"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/SerializationServiceBuilder.java", "diffHunk": "@@ -59,6 +59,8 @@\n \n     SerializationServiceBuilder setAllowUnsafe(boolean allowUnsafe);\n \n+    SerializationServiceBuilder setAllowOverrideDefaultSerializers(boolean allowOverrideDefaultSerializers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDcxMjUxOQ==", "bodyText": "Yes, seems it is not needed. It is a leftover from the first commit I assume when we had property based configuration as well.\n@sgflt Can we clean this up and its implementation please?", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r560712519", "createdAt": "2021-01-20T06:43:06Z", "author": {"login": "sancar"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/SerializationServiceBuilder.java", "diffHunk": "@@ -59,6 +59,8 @@\n \n     SerializationServiceBuilder setAllowUnsafe(boolean allowUnsafe);\n \n+    SerializationServiceBuilder setAllowOverrideDefaultSerializers(boolean allowOverrideDefaultSerializers);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI3MjE2Nw=="}, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUyNzk3MDI2OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/impl/DefaultSerializationServiceBuilder.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNTo0MDo1MlrOIWUU9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOVQxNTo0MDo1MlrOIWUU9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI3MjYyOQ==", "bodyText": "If we decide to remove this from the interface, we should remove this implementation too", "url": "https://github.com/hazelcast/hazelcast/pull/17958#discussion_r560272629", "createdAt": "2021-01-19T15:40:52Z", "author": {"login": "mdumandag"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/serialization/impl/DefaultSerializationServiceBuilder.java", "diffHunk": "@@ -202,6 +205,12 @@ public SerializationServiceBuilder setAllowUnsafe(boolean allowUnsafe) {\n         return this;\n     }\n \n+    @Override\n+    public SerializationServiceBuilder setAllowOverrideDefaultSerializers(final boolean allowOverrideDefaultSerializers) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "968f79c27df798136e14a584c52e1dff65a402f4"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 10, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}