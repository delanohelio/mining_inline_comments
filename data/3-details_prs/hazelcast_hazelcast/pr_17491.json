{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4ODI0MDcy", "number": 17491, "title": "Locate config files using a thread's context classloader", "bodyText": "Aligns with other places that rely on context classloader for resource loading, and makes the feature suitable to use with modern frameworks that employ classloader magic to use with hot reloading.\nFor example, when running Quarkus with hot reload on, Hazelcast is not able to discover any config files except the default one, although they are discoverable without the hot-reload on.\nOther usages of thread context classloader when dealing with config loading:\n\n  \n    \n      hazelcast/hazelcast/src/main/java/com/hazelcast/config/AbstractXmlConfigHelper.java\n    \n    \n         Line 130\n      in\n      7d63cfd\n    \n    \n    \n    \n\n        \n          \n           InputStream inputStream = Thread.currentThread().getContextClassLoader().getResourceAsStream(schemaLocation); \n        \n    \n  \n\n\n\n  \n    \n      hazelcast/hazelcast/src/main/java/com/hazelcast/config/ClasspathXmlConfig.java\n    \n    \n         Line 61\n      in\n      97ff57b\n    \n    \n    \n    \n\n        \n          \n           this(Thread.currentThread().getContextClassLoader(), resource, properties); \n        \n    \n  \n\n\nThis should be backported to 4.0.z", "createdAt": "2020-09-03T18:49:35Z", "url": "https://github.com/hazelcast/hazelcast/pull/17491", "merged": true, "mergeCommit": {"oid": "f45f972fe845adabfee974f4e1b93005dcb05c43"}, "closed": true, "closedAt": "2020-09-14T12:22:14Z", "author": {"login": "pivovarit"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFi4nUAH2gAyNDc4ODI0MDcyOmMyYTgwZGU2MmFhMzNhYzllYjFmZTNjMGE4YmYyYzk2OTg2MGI4ODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIyOGYgFqTQ4NzY5NDQ5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c2a80de62aa33ac9eb1fe3c0a8bf2c969860b884", "author": {"user": {"login": "pivovarit", "name": "Grzegorz Piwowarek"}}, "url": "https://github.com/hazelcast/hazelcast/commit/c2a80de62aa33ac9eb1fe3c0a8bf2c969860b884", "committedDate": "2020-09-04T10:45:28Z", "message": "Locate config files using a thread's context classloader"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63e52f4b483e4b6c655511812f8f0d4673f14dcb", "author": {"user": {"login": "pivovarit", "name": "Grzegorz Piwowarek"}}, "url": "https://github.com/hazelcast/hazelcast/commit/63e52f4b483e4b6c655511812f8f0d4673f14dcb", "committedDate": "2020-09-03T18:44:07Z", "message": "Locate config files using a thread's context classloader"}, "afterCommit": {"oid": "c2a80de62aa33ac9eb1fe3c0a8bf2c969860b884", "author": {"user": {"login": "pivovarit", "name": "Grzegorz Piwowarek"}}, "url": "https://github.com/hazelcast/hazelcast/commit/c2a80de62aa33ac9eb1fe3c0a8bf2c969860b884", "committedDate": "2020-09-04T10:45:28Z", "message": "Locate config files using a thread's context classloader"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNjA5NTA1", "url": "https://github.com/hazelcast/hazelcast/pull/17491#pullrequestreview-482609505", "createdAt": "2020-09-04T12:27:55Z", "commit": {"oid": "c2a80de62aa33ac9eb1fe3c0a8bf2c969860b884"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMjoyNzo1NVrOHNLnmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxMjoyNzo1NVrOHNLnmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU4Mzg5Ng==", "bodyText": "Just for the record, as we discussed in private, the default config has to be loaded from the hazelcast.jar always, therefore, Config.class.getClassloader() should be the right one here and TCCL should be used only in the other load methods.", "url": "https://github.com/hazelcast/hazelcast/pull/17491#discussion_r483583896", "createdAt": "2020-09-04T12:27:55Z", "author": {"login": "blazember"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/config/AbstractConfigLocator.java", "diffHunk": "@@ -146,7 +146,7 @@ protected void loadDefaultConfigurationFromClasspath(String defaultConfigFile) {\n \n     protected boolean loadConfigurationFromClasspath(String configFileName) {\n         try {\n-            URL url = Config.class.getClassLoader().getResource(configFileName);\n+            URL url = Thread.currentThread().getContextClassLoader().getResource(configFileName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2a80de62aa33ac9eb1fe3c0a8bf2c969860b884"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNDE5Nzcz", "url": "https://github.com/hazelcast/hazelcast/pull/17491#pullrequestreview-483419773", "createdAt": "2020-09-07T09:52:56Z", "commit": {"oid": "c2a80de62aa33ac9eb1fe3c0a8bf2c969860b884"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fedbbab797d7586444e07ca2740910bf6bd8643", "author": {"user": {"login": "pivovarit", "name": "Grzegorz Piwowarek"}}, "url": "https://github.com/hazelcast/hazelcast/commit/7fedbbab797d7586444e07ca2740910bf6bd8643", "committedDate": "2020-09-09T15:13:33Z", "message": "Add comment explaining the classloader choice in loadDefaultConfiguratinoFromClasspath"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e78c3da99e8c1437f3c11a686cdf94070fc57c78", "author": {"user": {"login": "pivovarit", "name": "Grzegorz Piwowarek"}}, "url": "https://github.com/hazelcast/hazelcast/commit/e78c3da99e8c1437f3c11a686cdf94070fc57c78", "committedDate": "2020-09-07T10:08:30Z", "message": "Add comment explaining the classloader choice in loadDefaultConfiguratinoFromClasspath"}, "afterCommit": {"oid": "7fedbbab797d7586444e07ca2740910bf6bd8643", "author": {"user": {"login": "pivovarit", "name": "Grzegorz Piwowarek"}}, "url": "https://github.com/hazelcast/hazelcast/commit/7fedbbab797d7586444e07ca2740910bf6bd8643", "committedDate": "2020-09-09T15:13:33Z", "message": "Add comment explaining the classloader choice in loadDefaultConfiguratinoFromClasspath"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3Njk0NDk4", "url": "https://github.com/hazelcast/hazelcast/pull/17491#pullrequestreview-487694498", "createdAt": "2020-09-14T12:19:17Z", "commit": {"oid": "7fedbbab797d7586444e07ca2740910bf6bd8643"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3270, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}