{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0MDY1NzEx", "number": 17521, "title": "Add logging for test: testPostJoinMapOperation_mapWithIndex", "bodyText": "Modifications:\n\nMakes test available for HD extensions.\nsee hazelcast/hazelcast-enterprise#3772\nRewrite owned-partitions caching logic by using sync blocks, this is  to prevent unneeded garbage in case of multiple concurrent accesses.\nAdd trace logging to MapMigrationAwareService. These logs are enabled in PostJoinMapOperationTest.", "createdAt": "2020-09-10T16:20:11Z", "url": "https://github.com/hazelcast/hazelcast/pull/17521", "merged": true, "mergeCommit": {"oid": "f6c9913b0f4c99997d8ac1b229f75e769121605c"}, "closed": true, "closedAt": "2020-09-28T11:51:42Z", "author": {"login": "ahmetmircik"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJsIF-gBqjM3NzY1NTE0MTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNQWsPgBqjM4MTM2MDI3MDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "25a0caabe277781d37a2ee868f828f68a6a8eab5", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/25a0caabe277781d37a2ee868f828f68a6a8eab5", "committedDate": "2020-09-10T16:19:22Z", "message": "Polish PostJoinMapOperationTest"}, "afterCommit": {"oid": "2b0288efb4f4573a3eb7c58b578a0f338aaba0f0", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/2b0288efb4f4573a3eb7c58b578a0f338aaba0f0", "committedDate": "2020-09-17T07:41:00Z", "message": "Remove reloadOwnedPartitions method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b0288efb4f4573a3eb7c58b578a0f338aaba0f0", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/2b0288efb4f4573a3eb7c58b578a0f338aaba0f0", "committedDate": "2020-09-17T07:41:00Z", "message": "Remove reloadOwnedPartitions method"}, "afterCommit": {"oid": "1d98332357f92b9497cf8e3b41bd53eb1d3b4bf3", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/1d98332357f92b9497cf8e3b41bd53eb1d3b4bf3", "committedDate": "2020-09-17T08:49:26Z", "message": "Remove reloadOwnedPartitions method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1d98332357f92b9497cf8e3b41bd53eb1d3b4bf3", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/1d98332357f92b9497cf8e3b41bd53eb1d3b4bf3", "committedDate": "2020-09-17T08:49:26Z", "message": "Remove reloadOwnedPartitions method"}, "afterCommit": {"oid": "1823cb3e24c6a33cdf3e96aa89368fd1b54673fa", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/1823cb3e24c6a33cdf3e96aa89368fd1b54673fa", "committedDate": "2020-09-21T08:20:43Z", "message": "Add trace logging for indexing to MapMigrationService"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMjY1NzAy", "url": "https://github.com/hazelcast/hazelcast/pull/17521#pullrequestreview-493265702", "createdAt": "2020-09-22T09:10:59Z", "commit": {"oid": "1823cb3e24c6a33cdf3e96aa89368fd1b54673fa"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOToxMDo1OVrOHVxDFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOToxMDo1OVrOHVxDFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4NTc0OA==", "bodyText": "Can you initialise the logger in the constructor?", "url": "https://github.com/hazelcast/hazelcast/pull/17521#discussion_r492585748", "createdAt": "2020-09-22T09:10:59Z", "author": {"login": "mmedenjak"}, "path": "hazelcast/src/main/java/com/hazelcast/map/impl/MapMigrationAwareService.java", "diffHunk": "@@ -323,6 +330,11 @@ private void depopulateIndexes(PartitionMigrationEvent event) {\n \n             Indexes.markPartitionAsUnindexed(event.getPartitionId(), indexesSnapshot);\n         }\n+\n+        ILogger logger = mapServiceContext.getNodeEngine().getLogger(getClass());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1823cb3e24c6a33cdf3e96aa89368fd1b54673fa"}, "originalPosition": 93}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1823cb3e24c6a33cdf3e96aa89368fd1b54673fa", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/1823cb3e24c6a33cdf3e96aa89368fd1b54673fa", "committedDate": "2020-09-21T08:20:43Z", "message": "Add trace logging for indexing to MapMigrationService"}, "afterCommit": {"oid": "9b0dca5a655474dadacce77ad89ff8d7ff298701", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/9b0dca5a655474dadacce77ad89ff8d7ff298701", "committedDate": "2020-09-22T09:51:17Z", "message": "Address Matko's comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MzI5NDE4", "url": "https://github.com/hazelcast/hazelcast/pull/17521#pullrequestreview-497329418", "createdAt": "2020-09-28T09:17:00Z", "commit": {"oid": "9b0dca5a655474dadacce77ad89ff8d7ff298701"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwOToxNzowMFrOHY1NvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwOToxNzowMFrOHY1NvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc5OTc0MA==", "bodyText": "No need for AtomicReference anymore, you can convert ownedPartitions to a volatile field.", "url": "https://github.com/hazelcast/hazelcast/pull/17521#discussion_r495799740", "createdAt": "2020-09-28T09:17:00Z", "author": {"login": "mdogan"}, "path": "hazelcast/src/main/java/com/hazelcast/map/impl/MapServiceContextImpl.java", "diffHunk": "@@ -484,34 +484,23 @@ public RecordStore getExistingRecordStore(int partitionId, String mapName) {\n     }\n \n     @Override\n-    public PartitionIdSet getOwnedPartitions() {\n-        PartitionIdSet partitions = ownedPartitions.get();\n-        if (partitions == null) {\n-            do {\n-                reloadOwnedPartitions();\n-                partitions = ownedPartitions.get();\n-            } while (partitions == null);\n+    public PartitionIdSet getOrInitCachedMemberPartitions() {\n+        PartitionIdSet ownedPartitionIdSet = ownedPartitions.get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b0dca5a655474dadacce77ad89ff8d7ff298701"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "880d440f49aa68c569828591683daa4f8229194e", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/880d440f49aa68c569828591683daa4f8229194e", "committedDate": "2020-09-28T09:39:29Z", "message": "Polish PostJoinMapOperationTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c70d44cdb98c8da50b2f7871cc7ff45a74d71de", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/4c70d44cdb98c8da50b2f7871cc7ff45a74d71de", "committedDate": "2020-09-28T09:39:29Z", "message": "Remove reloadOwnedPartitions method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8699c5beb26a37fd13725ec6e4dd98815a500ee", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/d8699c5beb26a37fd13725ec6e4dd98815a500ee", "committedDate": "2020-09-28T09:39:29Z", "message": "Add trace logging for indexing to MapMigrationService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdcd4b3ef21235aa015b0b1f7db7faca7b278c6c", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/fdcd4b3ef21235aa015b0b1f7db7faca7b278c6c", "committedDate": "2020-09-28T09:39:29Z", "message": "Address Matko's comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f708d6652c8fd77c49744935393cae92621bc74b", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/f708d6652c8fd77c49744935393cae92621bc74b", "committedDate": "2020-09-28T09:41:20Z", "message": "Address Mehmet's review comment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9b0dca5a655474dadacce77ad89ff8d7ff298701", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/9b0dca5a655474dadacce77ad89ff8d7ff298701", "committedDate": "2020-09-22T09:51:17Z", "message": "Address Matko's comment"}, "afterCommit": {"oid": "f708d6652c8fd77c49744935393cae92621bc74b", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/f708d6652c8fd77c49744935393cae92621bc74b", "committedDate": "2020-09-28T09:41:20Z", "message": "Address Mehmet's review comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3285, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}