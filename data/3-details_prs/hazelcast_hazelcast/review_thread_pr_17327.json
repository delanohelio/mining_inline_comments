{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2MDE3Nzc2", "number": 17327, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMjoxNTozNlrOEXLuvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNzozMDozOVrOEX7jAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNzQ0ODk0OnYy", "diffSide": "RIGHT", "path": "hazelcast/pom.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMjoxNTozNlrOG-1GUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMjoxNTozNlrOG-1GUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODUzNDg2NA==", "bodyText": "I think you don't have to add it here, it is already added to the parent project (but please double-check).", "url": "https://github.com/hazelcast/hazelcast/pull/17327#discussion_r468534864", "createdAt": "2020-08-11T12:15:36Z", "author": {"login": "erosb"}, "path": "hazelcast/pom.xml", "diffHunk": "@@ -486,5 +486,16 @@\n             <version>2.26.3</version>\n             <scope>test</scope>\n         </dependency>\n+        <!-- https://mvnrepository.com/artifact/org.openjdk.jmh/jmh-core -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7219a7ad49a61d9200b6131f59e72e6f8a79b122"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNzQ1MDQ1OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/test/java/com/hazelcast/internal/util/phonehome/PhoneHomeBenchMark.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMjoxNjowMlrOG-1HPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMjoxNjowMlrOG-1HPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODUzNTEwMw==", "bodyText": "Maps are covered by the 100k loop below, aren't they?", "url": "https://github.com/hazelcast/hazelcast/pull/17327#discussion_r468535103", "createdAt": "2020-08-11T12:16:02Z", "author": {"login": "erosb"}, "path": "hazelcast/src/test/java/com/hazelcast/internal/util/phonehome/PhoneHomeBenchMark.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.hazelcast.internal.util.phonehome;\n+\n+import com.hazelcast.config.AttributeConfig;\n+import com.hazelcast.config.CacheConfig;\n+import com.hazelcast.config.EvictionConfig;\n+import com.hazelcast.config.EvictionPolicy;\n+import com.hazelcast.config.HotRestartConfig;\n+import com.hazelcast.config.InMemoryFormat;\n+import com.hazelcast.config.IndexConfig;\n+import com.hazelcast.config.MapConfig;\n+import com.hazelcast.config.QueryCacheConfig;\n+import com.hazelcast.config.WanReplicationRef;\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.instance.impl.Node;\n+import com.hazelcast.map.IMap;\n+import com.hazelcast.test.HazelcastTestSupport;\n+import org.openjdk.jmh.annotations.Benchmark;\n+import org.openjdk.jmh.annotations.BenchmarkMode;\n+import org.openjdk.jmh.annotations.Mode;\n+import org.openjdk.jmh.annotations.Scope;\n+import org.openjdk.jmh.annotations.Setup;\n+import org.openjdk.jmh.annotations.State;\n+import org.openjdk.jmh.annotations.TearDown;\n+\n+import javax.cache.CacheManager;\n+import javax.cache.spi.CachingProvider;\n+\n+import static com.hazelcast.cache.CacheTestSupport.createServerCachingProvider;\n+import static com.hazelcast.test.Accessors.getNode;\n+\n+@State(Scope.Benchmark)\n+public class PhoneHomeBenchMark extends HazelcastTestSupport {\n+\n+    private PhoneHome phoneHome;\n+    private Node node;\n+\n+    @Setup\n+    public void setup() {\n+        HazelcastInstance hz = createHazelcastInstance();\n+        node = getNode(hz);\n+        phoneHome = new PhoneHome(node);\n+        CachingProvider cachingProvider = createServerCachingProvider(hz);\n+        CacheManager cacheManager = cachingProvider.getCacheManager();\n+\n+        for (int i = 1; i <= 10000; i++) {\n+            hz.getMap(\"maps\" + i);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7219a7ad49a61d9200b6131f59e72e6f8a79b122"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNzQ1Mzk1OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/test/java/com/hazelcast/internal/util/phonehome/PhoneHomeBenchMark.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMjoxNjo1N1rOG-1JQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxMjoxNjo1N1rOG-1JQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODUzNTYxOA==", "bodyText": "I doubt if getClass().getName() will work here. Does this class implement the MapStore interface.", "url": "https://github.com/hazelcast/hazelcast/pull/17327#discussion_r468535618", "createdAt": "2020-08-11T12:16:57Z", "author": {"login": "erosb"}, "path": "hazelcast/src/test/java/com/hazelcast/internal/util/phonehome/PhoneHomeBenchMark.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.hazelcast.internal.util.phonehome;\n+\n+import com.hazelcast.config.AttributeConfig;\n+import com.hazelcast.config.CacheConfig;\n+import com.hazelcast.config.EvictionConfig;\n+import com.hazelcast.config.EvictionPolicy;\n+import com.hazelcast.config.HotRestartConfig;\n+import com.hazelcast.config.InMemoryFormat;\n+import com.hazelcast.config.IndexConfig;\n+import com.hazelcast.config.MapConfig;\n+import com.hazelcast.config.QueryCacheConfig;\n+import com.hazelcast.config.WanReplicationRef;\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.instance.impl.Node;\n+import com.hazelcast.map.IMap;\n+import com.hazelcast.test.HazelcastTestSupport;\n+import org.openjdk.jmh.annotations.Benchmark;\n+import org.openjdk.jmh.annotations.BenchmarkMode;\n+import org.openjdk.jmh.annotations.Mode;\n+import org.openjdk.jmh.annotations.Scope;\n+import org.openjdk.jmh.annotations.Setup;\n+import org.openjdk.jmh.annotations.State;\n+import org.openjdk.jmh.annotations.TearDown;\n+\n+import javax.cache.CacheManager;\n+import javax.cache.spi.CachingProvider;\n+\n+import static com.hazelcast.cache.CacheTestSupport.createServerCachingProvider;\n+import static com.hazelcast.test.Accessors.getNode;\n+\n+@State(Scope.Benchmark)\n+public class PhoneHomeBenchMark extends HazelcastTestSupport {\n+\n+    private PhoneHome phoneHome;\n+    private Node node;\n+\n+    @Setup\n+    public void setup() {\n+        HazelcastInstance hz = createHazelcastInstance();\n+        node = getNode(hz);\n+        phoneHome = new PhoneHome(node);\n+        CachingProvider cachingProvider = createServerCachingProvider(hz);\n+        CacheManager cacheManager = cachingProvider.getCacheManager();\n+\n+        for (int i = 1; i <= 10000; i++) {\n+            hz.getMap(\"maps\" + i);\n+            hz.getSet(\"set\" + i);\n+            hz.getQueue(\"queue\" + i);\n+            hz.getMultiMap(\"multimap\" + i);\n+            hz.getList(\"list\" + i);\n+            hz.getRingbuffer(\"ringbuffer\" + i);\n+            hz.getTopic(\"topic\" + i);\n+            hz.getReplicatedMap(\"replicatedmap\" + i);\n+            hz.getCardinalityEstimator(\"cardinalityEstimator\" + i);\n+            hz.getPNCounter(\"PNcounter\" + i);\n+            hz.getFlakeIdGenerator(\"flakeid\" + i);\n+            cacheManager.createCache(\"cache\" + i, new CacheConfig<>(\"cache\" + i));\n+        }\n+\n+        for (int i = 1; i <= 100000; i++) {\n+            IMap<Object, Object> iMap = hz.getMap(\"map\" + i);\n+            MapConfig config = node.getConfig().getMapConfig(\"map\" + i);\n+\n+            if (i % 10 == 0) {\n+                config.getMapStoreConfig().setClassName(getClass().getName()).setEnabled(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7219a7ad49a61d9200b6131f59e72e6f8a79b122"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzNTI4MzIxOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/test/java/com/hazelcast/internal/util/phonehome/BenchMarkRunner.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNzozMDozOVrOG__ZmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwNzozMDozOVrOG__ZmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTc1MjIxNg==", "bodyText": "Can we please delete this class and move this main method to the PhoneHomeBenchmark itself?", "url": "https://github.com/hazelcast/hazelcast/pull/17327#discussion_r469752216", "createdAt": "2020-08-13T07:30:39Z", "author": {"login": "erosb"}, "path": "hazelcast/src/test/java/com/hazelcast/internal/util/phonehome/BenchMarkRunner.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.hazelcast.internal.util.phonehome;\n+\n+import org.openjdk.jmh.runner.Runner;\n+import org.openjdk.jmh.runner.RunnerException;\n+import org.openjdk.jmh.runner.options.Options;\n+import org.openjdk.jmh.runner.options.OptionsBuilder;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+public class BenchMarkRunner {\n+    public static void main(String[] args) throws RunnerException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fbaecd3e6cf44b5be98ae3061ff7b1da9f54a9d"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 278, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}