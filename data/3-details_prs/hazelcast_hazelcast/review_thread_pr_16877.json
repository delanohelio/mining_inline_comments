{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMTk1NDY1", "number": 16877, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwOTozMDo0NVrODxj6bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwOTozNzozNlrODxkEzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMjk1MjEzOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/map/IMap.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwOTozMDo0NVrOGFGKgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwOTozMDo0NVrOGFGKgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzk5NzA1OA==", "bodyText": "You may also add that the implementation will pull in all of the map data onto the local member in this case because it uses IMap#entrySet() to iterate over the entries.", "url": "https://github.com/hazelcast/hazelcast/pull/16877#discussion_r407997058", "createdAt": "2020-04-14T09:30:45Z", "author": {"login": "mmedenjak"}, "path": "hazelcast/src/main/java/com/hazelcast/map/IMap.java", "diffHunk": "@@ -2978,4 +2980,29 @@ default void addIndex(IndexType type, String... attributes) {\n      */\n     V computeIfAbsent(@Nonnull K key, @Nonnull Function<? super K, ? extends V> mappingFunction);\n \n+    /**\n+     * {@inheritDoc}\n+     *\n+     * <p> </p>\n+     * <p>\n+     *     If the supplied {@code action} is a lambda, anonymous class or an inner class,\n+     *     it would be executed locally. Same would happen if it is not serializable.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9622ba846e9b9f8df3bd1bba05298409d2f95b7"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMjk1NjQxOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/map/IMap.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwOTozMTo1OVrOGFGNMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwOTozMTo1OVrOGFGNMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzk5Nzc0NA==", "bodyText": "In this case, I'd propose the user to simply use IMap#executeOnEntries(com.hazelcast.map.EntryProcessor<K,V,R>) directly, since it can change the value by calling java.util.Map.Entry#setValue from within the entry processor.", "url": "https://github.com/hazelcast/hazelcast/pull/16877#discussion_r407997744", "createdAt": "2020-04-14T09:31:59Z", "author": {"login": "mmedenjak"}, "path": "hazelcast/src/main/java/com/hazelcast/map/IMap.java", "diffHunk": "@@ -2978,4 +2980,29 @@ default void addIndex(IndexType type, String... attributes) {\n      */\n     V computeIfAbsent(@Nonnull K key, @Nonnull Function<? super K, ? extends V> mappingFunction);\n \n+    /**\n+     * {@inheritDoc}\n+     *\n+     * <p> </p>\n+     * <p>\n+     *     If the supplied {@code action} is a lambda, anonymous class or an inner class,\n+     *     it would be executed locally. Same would happen if it is not serializable.\n+     *     This may result in multiple round-trips between hazelcast nodes.\n+     *</p>\n+     * <p>\n+     *     Otherwise (i.e. if it is a top-level class or a member class, and it is serializable), the function <i>may be</i> sent\n+     *     to the servers which own the partitions/keys. This results in a much less number of remote calls.\n+     *     Note that in this case, side effects of the {@code action} may not be visible to the local JVM\n+     *     If users intend to install the changed value in the map entry, the {@code action} must do so itself (e.g. by", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9622ba846e9b9f8df3bd1bba05298409d2f95b7"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzMjk3ODcxOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/map/impl/KeyValueConsumingEntryProcessor.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwOTozNzozNlrOGFGa7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQwOTozNzozNlrOGFGa7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODAwMTI2Mg==", "bodyText": "Since forEach doesn't use these values, maybe we can avoid sending them back to the caller by simply returning null.", "url": "https://github.com/hazelcast/hazelcast/pull/16877#discussion_r408001262", "createdAt": "2020-04-14T09:37:36Z", "author": {"login": "mmedenjak"}, "path": "hazelcast/src/main/java/com/hazelcast/map/impl/KeyValueConsumingEntryProcessor.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.map.impl;\n+\n+import com.hazelcast.map.EntryProcessor;\n+import com.hazelcast.nio.ObjectDataInput;\n+import com.hazelcast.nio.ObjectDataOutput;\n+import com.hazelcast.nio.serialization.IdentifiedDataSerializable;\n+\n+import java.io.IOException;\n+import java.util.Map;\n+import java.util.function.BiConsumer;\n+\n+public class KeyValueConsumingEntryProcessor<K, V> implements EntryProcessor<K, V, V>, IdentifiedDataSerializable {\n+\n+    BiConsumer<? super K, ? super V> action;\n+\n+    public KeyValueConsumingEntryProcessor() {\n+    }\n+\n+    public KeyValueConsumingEntryProcessor(BiConsumer<? super K, ? super V> action) {\n+        this.action = action;\n+    }\n+\n+    @Override\n+    public V process(Map.Entry<K, V> entry) {\n+        action.accept(entry.getKey(), entry.getValue());\n+        return entry.getValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9622ba846e9b9f8df3bd1bba05298409d2f95b7"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 653, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}