{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3NTY3MDc4", "number": 17550, "title": "Simplify SqlResult", "bodyText": "The current SqlResult can represent two options: it's either a row set\nor an update count. The type is determined by calling isUpdateCount().\nThis PR aligns it with the JDBC API:\n\n\nwe eliminate the isUpdateCount() method. Instead, the\nupdateCount() method returns -1 in case the result represents a row set\n\n\nwe ensure that a result with update count doesn't have negative count\n\n\nWe also remove isUpdateCount from the responses and rename\nupdatedCount to updateCount.", "createdAt": "2020-09-15T20:54:19Z", "url": "https://github.com/hazelcast/hazelcast/pull/17550", "merged": true, "mergeCommit": {"oid": "0c51b07ee7ace940ee070f97a7ef37156368db38"}, "closed": true, "closedAt": "2020-09-18T13:12:03Z", "author": {"login": "viliam-durina"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJOKmQAH2gAyNDg3NTY3MDc4OjcxYjg0NDZhOWRkY2ViYmJhY2E2ZjYwNjBlYWNjN2JiZjcyODgyYWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKEXaKAFqTQ5MTQwMTcwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "71b8446a9ddcebbbaca6f6060eacc7bbf72882af", "author": {"user": {"login": "viliam-durina", "name": "Viliam Durina"}}, "url": "https://github.com/hazelcast/hazelcast/commit/71b8446a9ddcebbbaca6f6060eacc7bbf72882af", "committedDate": "2020-09-15T20:52:48Z", "message": "Simplify SqlResult\n\nThe current SqlResult can represent two options: it's either a row set\nor an update count. The type is determined by calling `isUpdateCount()`.\n\nThis PR aligns it with the JDBC API:\n\n- we eliminate the `isUpdateCount()` method. Instead, the\n`updateCount()` method returns -1 in case the result represents a row set\n\n- we ensure that a result with update count doesn't have negative count\n\nWe also remove `isUpdateCount` from the responses and rename\n`updatedCount` to `updateCount`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MzU3MTQw", "url": "https://github.com/hazelcast/hazelcast/pull/17550#pullrequestreview-489357140", "createdAt": "2020-09-16T07:43:06Z", "commit": {"oid": "71b8446a9ddcebbbaca6f6060eacc7bbf72882af"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNzo0MzowNlrOHSkPdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNzo0MzowNlrOHSkPdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTIzMDE5Ng==", "bodyText": "What is the motivation for returning null? It is inconsistent with the behavior of the iterator() method. and makes the code prone to NPE. The previous behavior does not have this problem.", "url": "https://github.com/hazelcast/hazelcast/pull/17550#discussion_r489230196", "createdAt": "2020-09-16T07:43:06Z", "author": {"login": "devozerov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlResult.java", "diffHunk": "@@ -41,33 +41,24 @@\n  * }\n  * </pre>\n  *\n- * <p>\n  * <h4>Usage for update count</h4>\n  *\n  * <pre>\n  *     long updated = hazelcastInstance.getSql().execute(\"UPDATE ...\").updateCount();\n  * </pre>\n  *\n  * You don't need to call {@link #close()} in this case.\n+ *\n+ * <h4>Determining the type of the result</h4>\n+ *\n+ * To determine whether the result contains rows or an update count, call\n+ * {@link #updateCount()}. If it returns -1, the result is rows, otherwise\n+ * it's update count.\n  */\n public interface SqlResult extends Iterable<SqlRow>, AutoCloseable {\n \n     /**\n-     * If this result represents a row set, this method returns {@code false}.\n-     * If this result represents an update count (such as for a DML query), it\n-     * returns {@code true}.\n-     *\n-     * @return {@code false} for a rows result and {@code true} for an update\n-     *     count result\n-     */\n-    boolean isUpdateCount();\n-\n-    /**\n-     * Gets row metadata.\n-     *\n-     * @throws IllegalStateException if this result doesn't have rows (i.e.\n-     *     when {@link #isUpdateCount()} returns {@code true})\n-     * @return row metadata\n+     * Gets the row metadata or {@code null} if this result is an update count.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71b8446a9ddcebbbaca6f6060eacc7bbf72882af"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MzU4MDQ3", "url": "https://github.com/hazelcast/hazelcast/pull/17550#pullrequestreview-489358047", "createdAt": "2020-09-16T07:44:21Z", "commit": {"oid": "71b8446a9ddcebbbaca6f6060eacc7bbf72882af"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNzo0NDoyMVrOHSkSZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNzo0NDoyMVrOHSkSZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTIzMDk0OQ==", "bodyText": "I think that instead of asking the user to do updateCount() == -1 to check for the result type, we should leave this method in the inversed form. This is more convenient and easier to use, and makes no harm to the API:\nboolean isResultSet() {\n    return updateCount() == -1;\n}", "url": "https://github.com/hazelcast/hazelcast/pull/17550#discussion_r489230949", "createdAt": "2020-09-16T07:44:21Z", "author": {"login": "devozerov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/SqlResult.java", "diffHunk": "@@ -41,33 +41,24 @@\n  * }\n  * </pre>\n  *\n- * <p>\n  * <h4>Usage for update count</h4>\n  *\n  * <pre>\n  *     long updated = hazelcastInstance.getSql().execute(\"UPDATE ...\").updateCount();\n  * </pre>\n  *\n  * You don't need to call {@link #close()} in this case.\n+ *\n+ * <h4>Determining the type of the result</h4>\n+ *\n+ * To determine whether the result contains rows or an update count, call\n+ * {@link #updateCount()}. If it returns -1, the result is rows, otherwise\n+ * it's update count.\n  */\n public interface SqlResult extends Iterable<SqlRow>, AutoCloseable {\n \n     /**\n-     * If this result represents a row set, this method returns {@code false}.\n-     * If this result represents an update count (such as for a DML query), it\n-     * returns {@code true}.\n-     *\n-     * @return {@code false} for a rows result and {@code true} for an update\n-     *     count result\n-     */\n-    boolean isUpdateCount();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71b8446a9ddcebbbaca6f6060eacc7bbf72882af"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d02f894d1cbbc048475bf845813aaa2f334807d3", "author": {"user": {"login": "viliam-durina", "name": "Viliam Durina"}}, "url": "https://github.com/hazelcast/hazelcast/commit/d02f894d1cbbc048475bf845813aaa2f334807d3", "committedDate": "2020-09-16T09:43:13Z", "message": "Address the review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "158509c4f251dd432d88bc75246360103b2cb577", "author": {"user": {"login": "viliam-durina", "name": "Viliam Durina"}}, "url": "https://github.com/hazelcast/hazelcast/commit/158509c4f251dd432d88bc75246360103b2cb577", "committedDate": "2020-09-16T09:44:11Z", "message": "Random typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17fc29043160868ff96e07eb6a73539f99797fd7", "author": {"user": {"login": "viliam-durina", "name": "Viliam Durina"}}, "url": "https://github.com/hazelcast/hazelcast/commit/17fc29043160868ff96e07eb6a73539f99797fd7", "committedDate": "2020-09-16T09:47:56Z", "message": "Address review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTM1MjAy", "url": "https://github.com/hazelcast/hazelcast/pull/17550#pullrequestreview-489535202", "createdAt": "2020-09-16T11:37:34Z", "commit": {"oid": "17fc29043160868ff96e07eb6a73539f99797fd7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNDAxNzA1", "url": "https://github.com/hazelcast/hazelcast/pull/17550#pullrequestreview-491401705", "createdAt": "2020-09-18T12:01:40Z", "commit": {"oid": "17fc29043160868ff96e07eb6a73539f99797fd7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3308, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}