{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4ODA0Nzk2", "number": 16679, "title": "Eureka url can not be set from xml config #36", "bodyText": "Fixes: hazelcast/hazelcast-eureka#36", "createdAt": "2020-02-24T04:28:17Z", "url": "https://github.com/hazelcast/hazelcast/pull/16679", "merged": true, "mergeCommit": {"oid": "6af3c260419a6a86a2fb04a03b685a887c272376"}, "closed": true, "closedAt": "2020-03-02T14:28:16Z", "author": {"login": "omidp"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHU45aAH2gAyMzc4ODA0Nzk2OmVhZDBhZTFhNDIwYjRkODY4Mzc1ZDE2MDlmMzQ1MDM3NTI4ODRiYzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIaQ6igFqTM2NTYzMTk4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ead0ae1a420b4d868375d1609f34503752884bc3", "author": {"user": {"login": "omidp", "name": "Omid Pourhadi"}}, "url": "https://github.com/hazelcast/hazelcast/commit/ead0ae1a420b4d868375d1609f34503752884bc3", "committedDate": "2020-02-24T03:23:48Z", "message": "Eureka url can not be set from xml config #36"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "034cb4646a1fce4d3ce4ddbb5442e4823f45801e", "author": {"user": {"login": "omidp", "name": "Omid Pourhadi"}}, "url": "https://github.com/hazelcast/hazelcast/commit/034cb4646a1fce4d3ce4ddbb5442e4823f45801e", "committedDate": "2020-02-24T07:31:25Z", "message": "lowecase handler abstraction"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNjk5MTgx", "url": "https://github.com/hazelcast/hazelcast/pull/16679#pullrequestreview-363699181", "createdAt": "2020-02-24T21:04:29Z", "commit": {"oid": "034cb4646a1fce4d3ce4ddbb5442e4823f45801e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMTowNDoyOVrOFtvyaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMTowNjozN1rOFtv2Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzUxMzE5Mg==", "bodyText": "Can't we simply pass the tag to this metrod from the caller and do the following without the need for the handler?\nString key = cleanNodeName(n, !tag.equals(\"eureka\"));\n\n[...]\n\npublic static String cleanNodeName(final Node node, final boolean shouldLowerCase) {\n[...]\n}\n\nThis seems we put a \"local\" boolean to a hashmap that we lookup for a few lines later in the same cycle, so the handler and the map feel unnecessary here.", "url": "https://github.com/hazelcast/hazelcast/pull/16679#discussion_r383513192", "createdAt": "2020-02-24T21:04:29Z", "author": {"login": "blazember"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/config/MemberDomConfigProcessor.java", "diffHunk": "@@ -1332,18 +1332,25 @@ private void handleAliasedDiscoveryStrategy(WanBatchPublisherConfig publisherCon\n     private void updateConfig(AliasedDiscoveryConfig config, Node node) {\n         NamedNodeMap attributes = node.getAttributes();\n         for (int a = 0; a < attributes.getLength(); a++) {\n-            Node att = attributes.item(a);\n+            Node att = attributes.item(a);            \n             String value = getTextContent(att).trim();\n             if (\"enabled\".equals(lowerCaseInternal(att.getNodeName()))) {\n                 config.setEnabled(getBooleanValue(value));\n             } else if (att.getNodeName().equals(\"connection-timeout-seconds\")) {\n                 config.setProperty(\"connection-timeout-seconds\", value);\n             }\n         }\n+        LowercaseHandler lowerCaseHandler = new LowercaseHandler();\n         for (Node n : childElements(node)) {\n+        \tlowerCaseHandler.put(n.getLocalName(), \"eureka\".equals(n.getParentNode().getLocalName()));\n             String key = cleanNodeName(n);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "034cb4646a1fce4d3ce4ddbb5442e4823f45801e"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzUxNDE1OQ==", "bodyText": "Could you please add an assertion for the two added properties and do the same changes in the YamlConfigBuilderTest too?", "url": "https://github.com/hazelcast/hazelcast/pull/16679#discussion_r383514159", "createdAt": "2020-02-24T21:06:37Z", "author": {"login": "blazember"}, "path": "hazelcast/src/test/java/com/hazelcast/config/XMLConfigBuilderTest.java", "diffHunk": "@@ -407,6 +407,8 @@ public void readEurekaConfig() {\n                 + \"            <eureka enabled=\\\"true\\\">\\n\"\n                 + \"                <use-public-ip>true</use-public-ip>\\n\"\n                 + \"                <namespace>hazelcast</namespace>\\n\"\n+                + \"                <shouldUseDns>false</shouldUseDns>\\n\"\n+                + \"\t\t\t\t   <serviceUrl.default>http://localhost:8082/eureka</serviceUrl.default>\\n\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "034cb4646a1fce4d3ce4ddbb5442e4823f45801e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd04bcfa989c06884657bc385021505ee9e019e5", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast/commit/cd04bcfa989c06884657bc385021505ee9e019e5", "committedDate": "2020-02-25T01:50:02Z", "message": "Eureka url can not be set from xml config #36"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d02d86a5844c31c7651c0f22d3d8a0e0d770639", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast/commit/3d02d86a5844c31c7651c0f22d3d8a0e0d770639", "committedDate": "2020-02-25T11:04:52Z", "message": "overload method for cleanNodename to handle lowercase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddda9c4c205e8c1c89650e8369f2b85ac1529191", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast/commit/ddda9c4c205e8c1c89650e8369f2b85ac1529191", "committedDate": "2020-02-25T11:11:57Z", "message": "eureka lowercase bug fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NTMyMzU1", "url": "https://github.com/hazelcast/hazelcast/pull/16679#pullrequestreview-365532355", "createdAt": "2020-02-27T09:36:45Z", "commit": {"oid": "ddda9c4c205e8c1c89650e8369f2b85ac1529191"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwOTozNjo0NVrOFvLFlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QwOTozODozOFrOFvLJ2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAwOTA0NQ==", "bodyText": "Could you please add assertion for serviceUrl.default too?", "url": "https://github.com/hazelcast/hazelcast/pull/16679#discussion_r385009045", "createdAt": "2020-02-27T09:36:45Z", "author": {"login": "blazember"}, "path": "hazelcast/src/test/java/com/hazelcast/config/XMLConfigBuilderTest.java", "diffHunk": "@@ -419,6 +421,7 @@ public void readEurekaConfig() {\n         assertTrue(eurekaConfig.isEnabled());\n         assertTrue(eurekaConfig.isUsePublicIp());\n         assertEquals(\"hazelcast\", eurekaConfig.getProperty(\"namespace\"));\n+        assertEquals(\"false\", eurekaConfig.getProperty(\"shouldUseDns\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddda9c4c205e8c1c89650e8369f2b85ac1529191"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAxMDEzNw==", "bodyText": "You can call this method from cleanNodeName(Node) with true, so the duplication can be removed.", "url": "https://github.com/hazelcast/hazelcast/pull/16679#discussion_r385010137", "createdAt": "2020-02-27T09:38:38Z", "author": {"login": "blazember"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/config/DomConfigHelper.java", "diffHunk": "@@ -98,6 +98,14 @@ public static String cleanNodeName(final Node node) {\n         }\n         return StringUtil.lowerCaseInternal(nodeName);\n     }\n+    \n+    public static String cleanNodeName(final Node node, final boolean shouldLowercase) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddda9c4c205e8c1c89650e8369f2b85ac1529191"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0995f627603164911cfa5469f240b41013b98334", "author": {"user": {"login": "omidp", "name": "Omid Pourhadi"}}, "url": "https://github.com/hazelcast/hazelcast/commit/0995f627603164911cfa5469f240b41013b98334", "committedDate": "2020-02-27T09:46:21Z", "message": "code clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "914f6934a3a1bf0fc5ff3562480ae0440c22daa3", "author": {"user": {"login": "omidp", "name": "Omid Pourhadi"}}, "url": "https://github.com/hazelcast/hazelcast/commit/914f6934a3a1bf0fc5ff3562480ae0440c22daa3", "committedDate": "2020-02-27T10:26:46Z", "message": "fix trailing space"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NjI0MTQ5", "url": "https://github.com/hazelcast/hazelcast/pull/16679#pullrequestreview-365624149", "createdAt": "2020-02-27T11:59:43Z", "commit": {"oid": "914f6934a3a1bf0fc5ff3562480ae0440c22daa3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1NjMxOTgw", "url": "https://github.com/hazelcast/hazelcast/pull/16679#pullrequestreview-365631980", "createdAt": "2020-02-27T12:13:29Z", "commit": {"oid": "914f6934a3a1bf0fc5ff3562480ae0440c22daa3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3820, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}