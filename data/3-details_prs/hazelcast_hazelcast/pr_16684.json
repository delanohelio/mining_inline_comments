{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NDk4NzYz", "number": 16684, "title": "Improve logging when wrong class implemented", "bodyText": "original error:\n2020-02-25 10:56:26,732 [DEBUG] [Thread-1] [c.h.i.u.ServiceLoader]: There appears to be a classloading conflict. Class com.hazelcast.jet.impl.metrics.JetMetricsDataSerializerHook loaded by jdk.internal.loader.ClassLoaders$AppClassLoader@2c13da15 does not implement an interface with name com.hazelcast.nio.serialization.SerializerHook in both class loaders.the interface currently loaded by jdk.internal.loader.ClassLoaders$AppClassLoader@2c13da15\n\nThe interface was same, but the class implemented wrong interface.", "createdAt": "2020-02-25T10:36:58Z", "url": "https://github.com/hazelcast/hazelcast/pull/16684", "merged": true, "mergeCommit": {"oid": "d54fa6df9a88c59f7479744c2b46158f10b2df7f"}, "closed": true, "closedAt": "2020-03-06T09:20:02Z", "author": {"login": "viliam-durina"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHvqeWgH2gAyMzc5NDk4NzYzOjU2MmI0YzRmZjc1NjkwYThkZTkyNmM5ZjhhODk3MjU4ZTdkNzExNWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcK8kG0AFqTM3MDE3OTEyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "562b4c4ff75690a8de926c9f8a897258e7d7115c", "author": {"user": {"login": "viliam-durina", "name": "Viliam Durina"}}, "url": "https://github.com/hazelcast/hazelcast/commit/562b4c4ff75690a8de926c9f8a897258e7d7115c", "committedDate": "2020-02-25T10:35:29Z", "message": "Improve logging when wrong class implemented\n\noriginal error:\n```\n2020-02-25 10:56:26,732 [DEBUG] [Thread-1] [c.h.i.u.ServiceLoader]: There appears to be a classloading conflict. Class com.hazelcast.jet.impl.metrics.JetMetricsDataSerializerHook loaded by jdk.internal.loader.ClassLoaders$AppClassLoader@2c13da15 does not implement an interface with name com.hazelcast.nio.serialization.SerializerHook in both class loaders.the interface currently loaded by jdk.internal.loader.ClassLoaders$AppClassLoader@2c13da15\n```\n\nThe interface was same, but the class implemented wrong interface."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MTI2NjI4", "url": "https://github.com/hazelcast/hazelcast/pull/16684#pullrequestreview-364126628", "createdAt": "2020-02-25T13:10:23Z", "commit": {"oid": "562b4c4ff75690a8de926c9f8a897258e7d7115c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3OTQ0NTUw", "url": "https://github.com/hazelcast/hazelcast/pull/16684#pullrequestreview-367944550", "createdAt": "2020-03-03T12:41:15Z", "commit": {"oid": "562b4c4ff75690a8de926c9f8a897258e7d7115c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMjo0MToxNlrOFxEL6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMjo0Njo0MFrOFxEWzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk5MzEzMA==", "bodyText": "I think the original was referring to a specific runtime environment (OSGi, Java EE) and not to execution time; so I would say that \"in a runtime\" was actually correct.", "url": "https://github.com/hazelcast/hazelcast/pull/16684#discussion_r386993130", "createdAt": "2020-03-03T12:41:16Z", "author": {"login": "vojtechtoman"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/util/ServiceLoader.java", "diffHunk": "@@ -374,8 +374,8 @@ private boolean isDuplicate(Class<?> candidate) {\n         private void onClassNotFoundException(String className, ClassLoader classLoader, ClassNotFoundException e) {\n             if (className.startsWith(\"com.hazelcast\")) {\n                 LOGGER.fine(\"Failed to load \" + className + \" by \" + classLoader\n-                        + \". This indicates a classloading issue. It can happen in a runtime with \"\n-                        + \"a complicated classloading model. (OSGi, Java EE, etc);\");\n+                        + \". This indicates a classloading issue. It can happen at runtime with \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "562b4c4ff75690a8de926c9f8a897258e7d7115c"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk5NTkxOA==", "bodyText": "Minor: the three logging statements in this method use three different conventions when referring to interfaces: \"does not implement ...\" vs \"does not implement an interface with name ...\" vs \"does not implement the expected interface ...\" What about unifying this?", "url": "https://github.com/hazelcast/hazelcast/pull/16684#discussion_r386995918", "createdAt": "2020-03-03T12:46:40Z", "author": {"login": "vojtechtoman"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/util/ServiceLoader.java", "diffHunk": "@@ -385,17 +385,22 @@ private void onNonAssignableClass(String className, Class candidate) {\n             if (expectedType.isInterface()) {\n                 if (ClassLoaderUtil.implementsInterfaceWithSameName(candidate, expectedType)) {\n                     // this can happen in application containers - different Hazelcast JARs are loaded\n-                    // by different classloaders.\n+                    // by different class loaders.\n                     LOGGER.fine(\"There appears to be a classloading conflict. \"\n                             + \"Class \" + className + \" loaded by \" + candidate.getClassLoader() + \" implements \"\n                             + expectedType.getName() + \" from its own class loader, but it does not implement \"\n                             + expectedType.getName() + \" loaded by \" + expectedType.getClassLoader());\n                 } else {\n-                    //the class does not implement interface with the expected name.\n-                    LOGGER.fine(\"There appears to be a classloading conflict. \"\n-                            + \"Class \" + className + \" loaded by \" + candidate.getClassLoader() + \" does not \"\n-                            + \"implement an interface with name \" + expectedType.getName() + \" in both class loaders.\"\n-                            + \"the interface currently loaded by \" + expectedType.getClassLoader());\n+                    if (candidate.getClassLoader() != expectedType.getClassLoader()) {\n+                        //the class does not implement interface with the expected name.\n+                        LOGGER.fine(\"There appears to be a classloading conflict. \"\n+                                + \"Class \" + className + \" loaded by \" + candidate.getClassLoader() + \" does not \"\n+                                + \"implement an interface with name \" + expectedType.getName() + \" in both class loaders.\"\n+                                + \" The interface currently loaded by \" + expectedType.getClassLoader());\n+                    } else {\n+                        LOGGER.fine(\"The class \" + candidate.getName() + \" does not implement the expected \" +\n+                                \"interface \" + expectedType.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "562b4c4ff75690a8de926c9f8a897258e7d7115c"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33e848439aa1b17b48c5d8d15965b894a1425ebc", "author": {"user": {"login": "viliam-durina", "name": "Viliam Durina"}}, "url": "https://github.com/hazelcast/hazelcast/commit/33e848439aa1b17b48c5d8d15965b894a1425ebc", "committedDate": "2020-03-04T10:33:27Z", "message": "Tweak the messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "123a67e9b7bbacc5ffb479be4094a54de407cf4d", "author": {"user": {"login": "viliam-durina", "name": "Viliam Durina"}}, "url": "https://github.com/hazelcast/hazelcast/commit/123a67e9b7bbacc5ffb479be4094a54de407cf4d", "committedDate": "2020-03-06T07:58:46Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMTc5MTI2", "url": "https://github.com/hazelcast/hazelcast/pull/16684#pullrequestreview-370179126", "createdAt": "2020-03-06T09:19:04Z", "commit": {"oid": "123a67e9b7bbacc5ffb479be4094a54de407cf4d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3835, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}