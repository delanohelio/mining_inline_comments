{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNTc5NTE2", "number": 16800, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNToxNjo1N1rODrQvhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjo1MDoxMFrODroTrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2Njg5NjY4OnYy", "diffSide": "RIGHT", "path": "docs/design/sql/03-network-protocol.md", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNToxNjo1N1rOF7gILg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMTo1OToyMlrOF8DiqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzNjY4Ng==", "bodyText": "relatively high?", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r397936686", "createdAt": "2020-03-25T15:16:57Z", "author": {"login": "petrpleshachkov"}, "path": "docs/design/sql/03-network-protocol.md", "diffHunk": "@@ -0,0 +1,402 @@\n+# SQL Network Protocol\n+\n+## Overview\n+\n+Hazelcast Mustang is a distributed SQL engine. Network communication between nodes is required to produce the final result.\n+In this document, we describe the design of the communication protocol, that includes query start and cancel, data exchange,\n+and maintenance operations.\n+\n+The remainder of this document is structured as follows. Section 1 describes the primary design considerations. Section 2\n+discusses the existing networking infrastructure of the Hazelcast cluster and whether it satisfies our design\n+principles. Section 3 explains the protocol.\n+\n+## 1 Design Considerations\n+\n+In this section, we summarize the fundamental principles that influence the protocol design:\n+1. Low latency\n+1. Fail-fast\n+1. Ordered data exchange\n+\n+### 1.1 Low Latency\n+\n+Hazelcast Mustang is a modern distributed SQL engine that targets the OLTP workloads for in-memory data. We expect\n+that the engine will be used mostly for relatively short queries, taking milliseconds or seconds to complete. Because network\n+latency is still relatively as of 2020, the protocol should be designed to minimize the number of blocking network calls,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f084f5e250249132759e0955a5bf9e0c53e8378"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUxNjkwNQ==", "bodyText": "Fixed.", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398516905", "createdAt": "2020-03-26T11:59:22Z", "author": {"login": "devozerov"}, "path": "docs/design/sql/03-network-protocol.md", "diffHunk": "@@ -0,0 +1,402 @@\n+# SQL Network Protocol\n+\n+## Overview\n+\n+Hazelcast Mustang is a distributed SQL engine. Network communication between nodes is required to produce the final result.\n+In this document, we describe the design of the communication protocol, that includes query start and cancel, data exchange,\n+and maintenance operations.\n+\n+The remainder of this document is structured as follows. Section 1 describes the primary design considerations. Section 2\n+discusses the existing networking infrastructure of the Hazelcast cluster and whether it satisfies our design\n+principles. Section 3 explains the protocol.\n+\n+## 1 Design Considerations\n+\n+In this section, we summarize the fundamental principles that influence the protocol design:\n+1. Low latency\n+1. Fail-fast\n+1. Ordered data exchange\n+\n+### 1.1 Low Latency\n+\n+Hazelcast Mustang is a modern distributed SQL engine that targets the OLTP workloads for in-memory data. We expect\n+that the engine will be used mostly for relatively short queries, taking milliseconds or seconds to complete. Because network\n+latency is still relatively as of 2020, the protocol should be designed to minimize the number of blocking network calls,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzNjY4Ng=="}, "originalCommit": {"oid": "3f084f5e250249132759e0955a5bf9e0c53e8378"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NzEzMjkxOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/operation/QueryCancelOperation.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNjowNTowOFrOF7igcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMTo1OToxOFrOF8DihQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk3NTY2Nw==", "bodyText": "We use query initiator terminology in the doc.", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r397975667", "createdAt": "2020-03-25T16:05:08Z", "author": {"login": "petrpleshachkov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/operation/QueryCancelOperation.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.operation;\n+\n+import com.hazelcast.internal.util.UUIDSerializationUtil;\n+import com.hazelcast.nio.ObjectDataInput;\n+import com.hazelcast.nio.ObjectDataOutput;\n+import com.hazelcast.sql.impl.QueryId;\n+import com.hazelcast.sql.impl.SqlDataSerializerHook;\n+\n+import java.io.IOException;\n+import java.util.UUID;\n+\n+/**\n+ * Operation to cancel query execution on participant node. Cancellation process is two-phase:\n+ * 1) When a participant would like to cancel the query, this request is sent to the query coordinator", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f084f5e250249132759e0955a5bf9e0c53e8378"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUxNjg2OQ==", "bodyText": "Fixed.", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398516869", "createdAt": "2020-03-26T11:59:18Z", "author": {"login": "devozerov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/operation/QueryCancelOperation.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.operation;\n+\n+import com.hazelcast.internal.util.UUIDSerializationUtil;\n+import com.hazelcast.nio.ObjectDataInput;\n+import com.hazelcast.nio.ObjectDataOutput;\n+import com.hazelcast.sql.impl.QueryId;\n+import com.hazelcast.sql.impl.SqlDataSerializerHook;\n+\n+import java.io.IOException;\n+import java.util.UUID;\n+\n+/**\n+ * Operation to cancel query execution on participant node. Cancellation process is two-phase:\n+ * 1) When a participant would like to cancel the query, this request is sent to the query coordinator", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk3NTY2Nw=="}, "originalCommit": {"oid": "3f084f5e250249132759e0955a5bf9e0c53e8378"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NzEzNzkwOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/operation/QueryCancelOperation.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNjowNjoxNlrOF7ijnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjowMDo0MlrOF8Dldg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk3NjQ3Nw==", "bodyText": "Minor grammar: it broadcasts it to...?", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r397976477", "createdAt": "2020-03-25T16:06:16Z", "author": {"login": "petrpleshachkov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/operation/QueryCancelOperation.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.operation;\n+\n+import com.hazelcast.internal.util.UUIDSerializationUtil;\n+import com.hazelcast.nio.ObjectDataInput;\n+import com.hazelcast.nio.ObjectDataOutput;\n+import com.hazelcast.sql.impl.QueryId;\n+import com.hazelcast.sql.impl.SqlDataSerializerHook;\n+\n+import java.io.IOException;\n+import java.util.UUID;\n+\n+/**\n+ * Operation to cancel query execution on participant node. Cancellation process is two-phase:\n+ * 1) When a participant would like to cancel the query, this request is sent to the query coordinator\n+ * 2) When coordinator receives cancel request from a participant (including self), it is broadcast to", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f084f5e250249132759e0955a5bf9e0c53e8378"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUxNzYyMg==", "bodyText": "Fixed.", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398517622", "createdAt": "2020-03-26T12:00:42Z", "author": {"login": "devozerov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/operation/QueryCancelOperation.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.operation;\n+\n+import com.hazelcast.internal.util.UUIDSerializationUtil;\n+import com.hazelcast.nio.ObjectDataInput;\n+import com.hazelcast.nio.ObjectDataOutput;\n+import com.hazelcast.sql.impl.QueryId;\n+import com.hazelcast.sql.impl.SqlDataSerializerHook;\n+\n+import java.io.IOException;\n+import java.util.UUID;\n+\n+/**\n+ * Operation to cancel query execution on participant node. Cancellation process is two-phase:\n+ * 1) When a participant would like to cancel the query, this request is sent to the query coordinator\n+ * 2) When coordinator receives cancel request from a participant (including self), it is broadcast to", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk3NjQ3Nw=="}, "originalCommit": {"oid": "3f084f5e250249132759e0955a5bf9e0c53e8378"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2ODAyOTc2OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/operation/QueryExecuteOperation.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTo0MDowNlrOF7rYCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjowMDo1N1rOF8DmDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyMDk2OA==", "bodyText": "broadcasted?", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398120968", "createdAt": "2020-03-25T19:40:06Z", "author": {"login": "petrpleshachkov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/operation/QueryExecuteOperation.java", "diffHunk": "@@ -0,0 +1,244 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.operation;\n+\n+import com.hazelcast.internal.serialization.impl.SerializationUtil;\n+import com.hazelcast.internal.util.UUIDSerializationUtil;\n+import com.hazelcast.internal.util.collection.PartitionIdSet;\n+import com.hazelcast.nio.ObjectDataInput;\n+import com.hazelcast.nio.ObjectDataOutput;\n+import com.hazelcast.sql.impl.QueryId;\n+import com.hazelcast.sql.impl.SqlDataSerializerHook;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+/**\n+ * Operation which is broadcast to participating members to start query execution.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b7a6aa6bce18aad4827d73050060904d64d396c"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUxNzc3NQ==", "bodyText": "Fixed.", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398517775", "createdAt": "2020-03-26T12:00:57Z", "author": {"login": "devozerov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/operation/QueryExecuteOperation.java", "diffHunk": "@@ -0,0 +1,244 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.operation;\n+\n+import com.hazelcast.internal.serialization.impl.SerializationUtil;\n+import com.hazelcast.internal.util.UUIDSerializationUtil;\n+import com.hazelcast.internal.util.collection.PartitionIdSet;\n+import com.hazelcast.nio.ObjectDataInput;\n+import com.hazelcast.nio.ObjectDataOutput;\n+import com.hazelcast.sql.impl.QueryId;\n+import com.hazelcast.sql.impl.SqlDataSerializerHook;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.UUID;\n+\n+/**\n+ * Operation which is broadcast to participating members to start query execution.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyMDk2OA=="}, "originalCommit": {"oid": "0b7a6aa6bce18aad4827d73050060904d64d396c"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2ODA2NjkyOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/physical/FieldTypeProvider.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxOTo1MDo0OFrOF7rvIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjowMjowNlrOF8Doaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyNjg4Mg==", "bodyText": "It'd be nice to have Javadoc to define what index is, etc.", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398126882", "createdAt": "2020-03-25T19:50:48Z", "author": {"login": "petrpleshachkov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/physical/FieldTypeProvider.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.physical;\n+\n+import com.hazelcast.sql.impl.type.QueryDataType;\n+\n+/**\n+ * Interface to resovle field types.\n+ */\n+public interface FieldTypeProvider {\n+    QueryDataType getType(int index);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b7a6aa6bce18aad4827d73050060904d64d396c"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUxODM3OQ==", "bodyText": "Added JavaDoc.", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398518379", "createdAt": "2020-03-26T12:02:06Z", "author": {"login": "devozerov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/physical/FieldTypeProvider.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.physical;\n+\n+import com.hazelcast.sql.impl.type.QueryDataType;\n+\n+/**\n+ * Interface to resovle field types.\n+ */\n+public interface FieldTypeProvider {\n+    QueryDataType getType(int index);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyNjg4Mg=="}, "originalCommit": {"oid": "0b7a6aa6bce18aad4827d73050060904d64d396c"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MDUyNzI4OnYy", "diffSide": "RIGHT", "path": "docs/design/sql/03-network-protocol.md", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMTo0NTo1MVrOF8DFQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjowNzoxNFrOF8DzRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUwOTM3Nw==", "bodyText": "Is the order enforced for all operators or only for operators really requiring it?", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398509377", "createdAt": "2020-03-26T11:45:51Z", "author": {"login": "taburet"}, "path": "docs/design/sql/03-network-protocol.md", "diffHunk": "@@ -0,0 +1,402 @@\n+# SQL Network Protocol\n+\n+## Overview\n+\n+Hazelcast Mustang is a distributed SQL engine. Network communication between nodes is required to produce the final result.\n+In this document, we describe the design of the communication protocol, that includes query start and cancel, data exchange,\n+and maintenance operations.\n+\n+The remainder of this document is structured as follows. Section 1 describes the primary design considerations. Section 2\n+discusses the existing networking infrastructure of the Hazelcast cluster and whether it satisfies our design\n+principles. Section 3 explains the protocol.\n+\n+## 1 Design Considerations\n+\n+In this section, we summarize the fundamental principles that influence the protocol design:\n+1. Low latency\n+1. Fail-fast\n+1. Ordered data exchange\n+\n+### 1.1 Low Latency\n+\n+Hazelcast Mustang is a modern distributed SQL engine that targets the OLTP workloads for in-memory data. We expect\n+that the engine will be used mostly for relatively short queries, taking milliseconds or seconds to complete. Because network\n+latency is still relatively as of 2020, the protocol should be designed to minimize the number of blocking network calls,\n+when one member waits for the other.\n+\n+### 1.2 Fail-Fast\n+\n+Distributed systems must account for network and hardware failures. Query execution is a stateful process. Whenever a participant\n+of a distributed query goes down, there are two options: try tolerating the failure and continue execution, or fail it.\n+\n+The system needs to track the progress of query execution to tolerate the failure of a query participant. An example of such a\n+system is Google Spanner [[1]], which uses restart tokens to track the progress of the query, hiding network failures from\n+users. Another approach is to persist intermediate state to disk, which is used in OLAP engines where query restart is not an\n+appropriate choice.\n+\n+While the idea of hiding intermittent failures from users is compelling from the usability point of view, it comes at a massive\n+engineering cost, as mentioned by Google Spanner engineers. The Hazelcast Mustang engine is designed with the **fail-fast**\n+behavior in mind: whenever a failure occurs, the query is terminated, and a proper transient error is delivered to the user.\n+The user should restart the query manually then. The query will fail in the following scenarios:\n+1. Member executing the query (participant) has left the cluster\n+1. Temporal network problem between two members which resulted in a broken TCP connection\n+\n+We understand that fail-fast behavior might not be the best solution for some use cases, including machine shutdowns in cloud\n+environments. We, therefore, do not reject the idea of implementing transparent handling of network errors in future releases.\n+Instead, we treat the fail-fast behavior as a starting point for future improvements, which provides a good trade-off between\n+the added value and implementation complexity.\n+\n+### 1.3 Ordered Data Exchange\n+\n+The Hazelcast Mustang engine employs the **Volcano Model** approach, as described in [[2]]. Data flows from children relational\n+operators to parents operators. The order of rows transferred between operators is essential for correctness. For example, a\n+parent operator may expect the child operator to produce rows that are sorted on a particular attribute.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b7a6aa6bce18aad4827d73050060904d64d396c"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUyMTE1OA==", "bodyText": "The order is enforced for all operators because some optimizer decisions may rely on it. E.g. the optimizer may decide to eliminate the sorting for the sort <- project <- join <- filter <- index scan pipeline, so every operator should preserve the order.\nIn principle, it is possible to relax the order for operators without collation, but that would require adding collation metadata to all operators. The benefit is questionable since all current connection implementations provide ordering anyway.", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398521158", "createdAt": "2020-03-26T12:07:14Z", "author": {"login": "devozerov"}, "path": "docs/design/sql/03-network-protocol.md", "diffHunk": "@@ -0,0 +1,402 @@\n+# SQL Network Protocol\n+\n+## Overview\n+\n+Hazelcast Mustang is a distributed SQL engine. Network communication between nodes is required to produce the final result.\n+In this document, we describe the design of the communication protocol, that includes query start and cancel, data exchange,\n+and maintenance operations.\n+\n+The remainder of this document is structured as follows. Section 1 describes the primary design considerations. Section 2\n+discusses the existing networking infrastructure of the Hazelcast cluster and whether it satisfies our design\n+principles. Section 3 explains the protocol.\n+\n+## 1 Design Considerations\n+\n+In this section, we summarize the fundamental principles that influence the protocol design:\n+1. Low latency\n+1. Fail-fast\n+1. Ordered data exchange\n+\n+### 1.1 Low Latency\n+\n+Hazelcast Mustang is a modern distributed SQL engine that targets the OLTP workloads for in-memory data. We expect\n+that the engine will be used mostly for relatively short queries, taking milliseconds or seconds to complete. Because network\n+latency is still relatively as of 2020, the protocol should be designed to minimize the number of blocking network calls,\n+when one member waits for the other.\n+\n+### 1.2 Fail-Fast\n+\n+Distributed systems must account for network and hardware failures. Query execution is a stateful process. Whenever a participant\n+of a distributed query goes down, there are two options: try tolerating the failure and continue execution, or fail it.\n+\n+The system needs to track the progress of query execution to tolerate the failure of a query participant. An example of such a\n+system is Google Spanner [[1]], which uses restart tokens to track the progress of the query, hiding network failures from\n+users. Another approach is to persist intermediate state to disk, which is used in OLAP engines where query restart is not an\n+appropriate choice.\n+\n+While the idea of hiding intermittent failures from users is compelling from the usability point of view, it comes at a massive\n+engineering cost, as mentioned by Google Spanner engineers. The Hazelcast Mustang engine is designed with the **fail-fast**\n+behavior in mind: whenever a failure occurs, the query is terminated, and a proper transient error is delivered to the user.\n+The user should restart the query manually then. The query will fail in the following scenarios:\n+1. Member executing the query (participant) has left the cluster\n+1. Temporal network problem between two members which resulted in a broken TCP connection\n+\n+We understand that fail-fast behavior might not be the best solution for some use cases, including machine shutdowns in cloud\n+environments. We, therefore, do not reject the idea of implementing transparent handling of network errors in future releases.\n+Instead, we treat the fail-fast behavior as a starting point for future improvements, which provides a good trade-off between\n+the added value and implementation complexity.\n+\n+### 1.3 Ordered Data Exchange\n+\n+The Hazelcast Mustang engine employs the **Volcano Model** approach, as described in [[2]]. Data flows from children relational\n+operators to parents operators. The order of rows transferred between operators is essential for correctness. For example, a\n+parent operator may expect the child operator to produce rows that are sorted on a particular attribute.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUwOTM3Nw=="}, "originalCommit": {"oid": "0b7a6aa6bce18aad4827d73050060904d64d396c"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MDYzMzgzOnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/operation/QueryOperation.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjoxNjo0OVrOF8EGrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjoyOToyOVrOF8EjNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUyNjEyNg==", "bodyText": "Doesn't look like it's returning a partition, more like a partition hash code. Used like a utility function, should be static probably. Some javadoc may help in any case.", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398526126", "createdAt": "2020-03-26T12:16:49Z", "author": {"login": "taburet"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/operation/QueryOperation.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.operation;\n+\n+import com.hazelcast.internal.util.UUIDSerializationUtil;\n+import com.hazelcast.nio.ObjectDataInput;\n+import com.hazelcast.nio.ObjectDataOutput;\n+import com.hazelcast.nio.serialization.IdentifiedDataSerializable;\n+import com.hazelcast.sql.impl.SqlDataSerializerHook;\n+\n+import java.io.IOException;\n+import java.util.UUID;\n+\n+/**\n+ * Base class for query operations.\n+ */\n+public abstract class QueryOperation implements IdentifiedDataSerializable {\n+\n+    public static final int PARTITION_ANY = -1;\n+\n+    private UUID callerId;\n+\n+    protected QueryOperation() {\n+        // No-op.\n+    }\n+\n+    public UUID getCallerId() {\n+        return callerId;\n+    }\n+\n+    public void setCallerId(UUID callerId) {\n+        this.callerId = callerId;\n+    }\n+\n+    public int getPartition() {\n+        return PARTITION_ANY;\n+    }\n+\n+    protected int getPartitionForHash(int hash) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b7a6aa6bce18aad4827d73050060904d64d396c"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUzMjkyOQ==", "bodyText": "This function converts an arbitrary integer to a positive integer, which is then interpreted as a logical partition.\nThe notion of \"partition\" is used here to provide an analogy with our partition pool, which also uses logical partitions [1], not physical.\n[1] com.hazelcast.spi.impl.operationexecutor.impl.OperationExecutorImpl#getPartitionThreadId(int, int)", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398532929", "createdAt": "2020-03-26T12:28:44Z", "author": {"login": "devozerov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/operation/QueryOperation.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.operation;\n+\n+import com.hazelcast.internal.util.UUIDSerializationUtil;\n+import com.hazelcast.nio.ObjectDataInput;\n+import com.hazelcast.nio.ObjectDataOutput;\n+import com.hazelcast.nio.serialization.IdentifiedDataSerializable;\n+import com.hazelcast.sql.impl.SqlDataSerializerHook;\n+\n+import java.io.IOException;\n+import java.util.UUID;\n+\n+/**\n+ * Base class for query operations.\n+ */\n+public abstract class QueryOperation implements IdentifiedDataSerializable {\n+\n+    public static final int PARTITION_ANY = -1;\n+\n+    private UUID callerId;\n+\n+    protected QueryOperation() {\n+        // No-op.\n+    }\n+\n+    public UUID getCallerId() {\n+        return callerId;\n+    }\n+\n+    public void setCallerId(UUID callerId) {\n+        this.callerId = callerId;\n+    }\n+\n+    public int getPartition() {\n+        return PARTITION_ANY;\n+    }\n+\n+    protected int getPartitionForHash(int hash) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUyNjEyNg=="}, "originalCommit": {"oid": "0b7a6aa6bce18aad4827d73050060904d64d396c"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUzMzQyOQ==", "bodyText": "Additional JavaDocs are added.", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398533429", "createdAt": "2020-03-26T12:29:29Z", "author": {"login": "devozerov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/operation/QueryOperation.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.operation;\n+\n+import com.hazelcast.internal.util.UUIDSerializationUtil;\n+import com.hazelcast.nio.ObjectDataInput;\n+import com.hazelcast.nio.ObjectDataOutput;\n+import com.hazelcast.nio.serialization.IdentifiedDataSerializable;\n+import com.hazelcast.sql.impl.SqlDataSerializerHook;\n+\n+import java.io.IOException;\n+import java.util.UUID;\n+\n+/**\n+ * Base class for query operations.\n+ */\n+public abstract class QueryOperation implements IdentifiedDataSerializable {\n+\n+    public static final int PARTITION_ANY = -1;\n+\n+    private UUID callerId;\n+\n+    protected QueryOperation() {\n+        // No-op.\n+    }\n+\n+    public UUID getCallerId() {\n+        return callerId;\n+    }\n+\n+    public void setCallerId(UUID callerId) {\n+        this.callerId = callerId;\n+    }\n+\n+    public int getPartition() {\n+        return PARTITION_ANY;\n+    }\n+\n+    protected int getPartitionForHash(int hash) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUyNjEyNg=="}, "originalCommit": {"oid": "0b7a6aa6bce18aad4827d73050060904d64d396c"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MDcxNDg2OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/physical/PhysicalNode.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjozOToxOVrOF8E5bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjo0MToxNVrOF8E9sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUzOTExNg==", "bodyText": "Looks like a pretty central interface in physical node hierarchy. Probably deserves a better javadoc.", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398539116", "createdAt": "2020-03-26T12:39:19Z", "author": {"login": "taburet"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/physical/PhysicalNode.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.physical;\n+\n+import com.hazelcast.nio.serialization.DataSerializable;\n+\n+/**\n+ * Physical node.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29cc97d0994a8ffdf8ec4dff7f62e906556fd58f"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU0MDIxMQ==", "bodyText": "PhysicalNode will be described in detail in future pull requests. Here it is just used to maintain compilation.", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398540211", "createdAt": "2020-03-26T12:41:15Z", "author": {"login": "devozerov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/physical/PhysicalNode.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.physical;\n+\n+import com.hazelcast.nio.serialization.DataSerializable;\n+\n+/**\n+ * Physical node.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODUzOTExNg=="}, "originalCommit": {"oid": "29cc97d0994a8ffdf8ec4dff7f62e906556fd58f"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MDc1NzU5OnYy", "diffSide": "RIGHT", "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/physical/PhysicalNodeSchema.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjo1MDoxMFrOF8FT2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjo1ODo0N1rOF8FpSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU0NTg4MQ==", "bodyText": "Does it return an exact value, overestimates or underestimates? One may think it just returns the number of columns, probably a better name is something like get(Over/Under)EstimatedSize.", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398545881", "createdAt": "2020-03-26T12:50:10Z", "author": {"login": "taburet"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/physical/PhysicalNodeSchema.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.physical;\n+\n+import com.hazelcast.sql.impl.type.QueryDataType;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * Schema of a node.\n+ */\n+public class PhysicalNodeSchema implements FieldTypeProvider {\n+\n+    private final List<QueryDataType> types;\n+    private final int rowWidth;\n+\n+    public PhysicalNodeSchema(List<QueryDataType> types) {\n+        assert types != null;\n+\n+        this.types = Collections.unmodifiableList(types);\n+\n+        rowWidth = calculateRowWidth(types);\n+    }\n+\n+    public static PhysicalNodeSchema combine(PhysicalNodeSchema schema1, PhysicalNodeSchema schema2) {\n+        ArrayList<QueryDataType> types = new ArrayList<>(schema1.types);\n+\n+        types.addAll(schema2.types);\n+\n+        return new PhysicalNodeSchema(types);\n+    }\n+\n+    @Override\n+    public QueryDataType getType(int index) {\n+        assert index <= types.size();\n+\n+        return types.get(index);\n+    }\n+\n+    public List<QueryDataType> getTypes() {\n+        return types;\n+    }\n+\n+    public int getRowWidth() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29cc97d0994a8ffdf8ec4dff7f62e906556fd58f"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU1MTM3MA==", "bodyText": "This value is used to estimate memory requirements. We assume that it is relatively accurate. Bug again, this is not a concern of this ticket. The row width is currently used in IO handling, which will be prepared in a separate PR. I'll add JavaDocs with clarifications and possibly rename the method. Otherwise, we will have unnecessary conflicts.", "url": "https://github.com/hazelcast/hazelcast/pull/16800#discussion_r398551370", "createdAt": "2020-03-26T12:58:47Z", "author": {"login": "devozerov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/physical/PhysicalNodeSchema.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.sql.impl.physical;\n+\n+import com.hazelcast.sql.impl.type.QueryDataType;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * Schema of a node.\n+ */\n+public class PhysicalNodeSchema implements FieldTypeProvider {\n+\n+    private final List<QueryDataType> types;\n+    private final int rowWidth;\n+\n+    public PhysicalNodeSchema(List<QueryDataType> types) {\n+        assert types != null;\n+\n+        this.types = Collections.unmodifiableList(types);\n+\n+        rowWidth = calculateRowWidth(types);\n+    }\n+\n+    public static PhysicalNodeSchema combine(PhysicalNodeSchema schema1, PhysicalNodeSchema schema2) {\n+        ArrayList<QueryDataType> types = new ArrayList<>(schema1.types);\n+\n+        types.addAll(schema2.types);\n+\n+        return new PhysicalNodeSchema(types);\n+    }\n+\n+    @Override\n+    public QueryDataType getType(int index) {\n+        assert index <= types.size();\n+\n+        return types.get(index);\n+    }\n+\n+    public List<QueryDataType> getTypes() {\n+        return types;\n+    }\n+\n+    public int getRowWidth() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU0NTg4MQ=="}, "originalCommit": {"oid": "29cc97d0994a8ffdf8ec4dff7f62e906556fd58f"}, "originalPosition": 60}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 771, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}