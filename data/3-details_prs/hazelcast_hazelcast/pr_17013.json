{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzNjU1MTc3", "number": 17013, "title": "Add new assertion to have better info about test failure", "bodyText": "closes #17001\nModifications:\n\nadded new assertion to have better info about test failure\nrefactored checkPositive utility method\nrefactored cyclic buffer size check", "createdAt": "2020-05-27T07:13:06Z", "url": "https://github.com/hazelcast/hazelcast/pull/17013", "merged": true, "mergeCommit": {"oid": "4e04000ebe5bdf58c798240f0fc105c18aaa8833"}, "closed": true, "closedAt": "2020-08-12T13:25:45Z", "author": {"login": "ahmetmircik"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclT62CgBqjMzNzY3MTkwNTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-KyQkAFqTQ2NTg3ODE5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6b411f1197b1ee8d231e0c7081184d8aba485f93", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/6b411f1197b1ee8d231e0c7081184d8aba485f93", "committedDate": "2020-05-22T01:12:47Z", "message": "Use synchronized methods"}, "afterCommit": {"oid": "80884c47c4cb3c5c4b45cfb61410c2cc26b9c695", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/80884c47c4cb3c5c4b45cfb61410c2cc26b9c695", "committedDate": "2020-05-27T07:13:37Z", "message": "Use synchronized methods"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80884c47c4cb3c5c4b45cfb61410c2cc26b9c695", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/80884c47c4cb3c5c4b45cfb61410c2cc26b9c695", "committedDate": "2020-05-27T07:13:37Z", "message": "Use synchronized methods"}, "afterCommit": {"oid": "6ed54cb9c8bf5d4be892ab9d368ed424b9c67243", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/6ed54cb9c8bf5d4be892ab9d368ed424b9c67243", "committedDate": "2020-05-27T09:03:37Z", "message": "Use synchronized methods"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwODQ5MjUy", "url": "https://github.com/hazelcast/hazelcast/pull/17013#pullrequestreview-420849252", "createdAt": "2020-05-29T10:53:33Z", "commit": {"oid": "6ed54cb9c8bf5d4be892ab9d368ed424b9c67243"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMDo1MzozNFrOGcYEGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMDo1MzozNFrOGcYEGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQwNzU3Ng==", "bodyText": "This smells like a design problem. The class is lock free and now get some locks.", "url": "https://github.com/hazelcast/hazelcast/pull/17013#discussion_r432407576", "createdAt": "2020-05-29T10:53:34Z", "author": {"login": "pveentjer"}, "path": "hazelcast/src/main/java/com/hazelcast/map/impl/querycache/accumulator/DefaultCyclicBuffer.java", "diffHunk": "@@ -33,37 +33,38 @@\n  */\n public class DefaultCyclicBuffer<E extends Sequenced> implements CyclicBuffer<E> {\n \n-    private static final long UNAVAILABLE = -1L;\n+    private static final long UNSET = -1L;\n \n     private int capacity;\n     private E[] buffer;\n     private AtomicLong headSequence;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ed54cb9c8bf5d4be892ab9d368ed424b9c67243"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ed54cb9c8bf5d4be892ab9d368ed424b9c67243", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/6ed54cb9c8bf5d4be892ab9d368ed424b9c67243", "committedDate": "2020-05-27T09:03:37Z", "message": "Use synchronized methods"}, "afterCommit": {"oid": "487b7f2724cfb6eedaa98de7598a74d88ceb630f", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/487b7f2724cfb6eedaa98de7598a74d88ceb630f", "committedDate": "2020-06-23T12:15:58Z", "message": "Rewrite checkPositive method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "487b7f2724cfb6eedaa98de7598a74d88ceb630f", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/487b7f2724cfb6eedaa98de7598a74d88ceb630f", "committedDate": "2020-06-23T12:15:58Z", "message": "Rewrite checkPositive method"}, "afterCommit": {"oid": "b91d172e90cd7bd96eda95c3022e3169931eb510", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/b91d172e90cd7bd96eda95c3022e3169931eb510", "committedDate": "2020-06-23T14:38:59Z", "message": "Rewrite checkPositive method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNTkxNDk1", "url": "https://github.com/hazelcast/hazelcast/pull/17013#pullrequestreview-441591495", "createdAt": "2020-07-02T11:32:00Z", "commit": {"oid": "b91d172e90cd7bd96eda95c3022e3169931eb510"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMTozMjowMFrOGsI4eQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMTozMjowMFrOGsI4eQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkzNjA1Nw==", "bodyText": "Can you explain from which threads this buffer is accessed, how and when? Why the need for such coarse synchronization?", "url": "https://github.com/hazelcast/hazelcast/pull/17013#discussion_r448936057", "createdAt": "2020-07-02T11:32:00Z", "author": {"login": "mmedenjak"}, "path": "hazelcast/src/main/java/com/hazelcast/map/impl/querycache/accumulator/DefaultCyclicBuffer.java", "diffHunk": "@@ -33,37 +33,38 @@\n  */\n public class DefaultCyclicBuffer<E extends Sequenced> implements CyclicBuffer<E> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b91d172e90cd7bd96eda95c3022e3169931eb510"}, "originalPosition": 2}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b91d172e90cd7bd96eda95c3022e3169931eb510", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/b91d172e90cd7bd96eda95c3022e3169931eb510", "committedDate": "2020-06-23T14:38:59Z", "message": "Rewrite checkPositive method"}, "afterCommit": {"oid": "e827156821805db59a1e3b72a55e1ac0b47a877e", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/e827156821805db59a1e3b72a55e1ac0b47a877e", "committedDate": "2020-07-03T08:55:45Z", "message": "Rewrite checkPositive method"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e827156821805db59a1e3b72a55e1ac0b47a877e", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/e827156821805db59a1e3b72a55e1ac0b47a877e", "committedDate": "2020-07-03T08:55:45Z", "message": "Rewrite checkPositive method"}, "afterCommit": {"oid": "ae4c714661500f570e59d187c7fab58f9454b006", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/ae4c714661500f570e59d187c7fab58f9454b006", "committedDate": "2020-07-09T12:07:07Z", "message": "Address review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfd63b36a47341e4202a04bf43cb07152e60d218", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/dfd63b36a47341e4202a04bf43cb07152e60d218", "committedDate": "2020-08-04T07:47:02Z", "message": "Use synchronized methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8498190548798fc433cc53be6eb75a694950a8de", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/8498190548798fc433cc53be6eb75a694950a8de", "committedDate": "2020-08-04T07:47:02Z", "message": "Rewrite checkPositive method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e082bdfc7643478305b3a2108050b4eb7ea722ff", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/e082bdfc7643478305b3a2108050b4eb7ea722ff", "committedDate": "2020-08-04T07:47:02Z", "message": "Address review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae4c714661500f570e59d187c7fab58f9454b006", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/ae4c714661500f570e59d187c7fab58f9454b006", "committedDate": "2020-07-09T12:07:07Z", "message": "Address review comments"}, "afterCommit": {"oid": "e082bdfc7643478305b3a2108050b4eb7ea722ff", "author": {"user": {"login": "ahmetmircik", "name": "Ahmet Mircik"}}, "url": "https://github.com/hazelcast/hazelcast/commit/e082bdfc7643478305b3a2108050b4eb7ea722ff", "committedDate": "2020-08-04T07:47:02Z", "message": "Address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1ODM4NzA3", "url": "https://github.com/hazelcast/hazelcast/pull/17013#pullrequestreview-465838707", "createdAt": "2020-08-12T11:55:08Z", "commit": {"oid": "e082bdfc7643478305b3a2108050b4eb7ea722ff"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxMTo1NTowOFrOG_d3Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxMTo1NTowOFrOG_d3Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTIwMjY5MA==", "bodyText": "How was it even possible in the previous code that the available was higher than the capacity?", "url": "https://github.com/hazelcast/hazelcast/pull/17013#discussion_r469202690", "createdAt": "2020-08-12T11:55:08Z", "author": {"login": "mmedenjak"}, "path": "hazelcast/src/main/java/com/hazelcast/map/impl/querycache/accumulator/DefaultCyclicBuffer.java", "diffHunk": "@@ -137,16 +138,11 @@ public int size() {\n         long head = headSequence.get();\n         long tail = tailSequence.get();\n \n-        if (tail == UNAVAILABLE) {\n+        if (tail == UNSET) {\n             return 0;\n         }\n \n-        int avail = (int) (tail - head + 1);\n-        if (avail <= capacity) {\n-            return avail;\n-        } else {\n-            return capacity;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e082bdfc7643478305b3a2108050b4eb7ea722ff"}, "originalPosition": 84}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1ODUzNDQ2", "url": "https://github.com/hazelcast/hazelcast/pull/17013#pullrequestreview-465853446", "createdAt": "2020-08-12T12:17:59Z", "commit": {"oid": "e082bdfc7643478305b3a2108050b4eb7ea722ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1ODc4MTky", "url": "https://github.com/hazelcast/hazelcast/pull/17013#pullrequestreview-465878192", "createdAt": "2020-08-12T12:43:20Z", "commit": {"oid": "e082bdfc7643478305b3a2108050b4eb7ea722ff"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3646, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}