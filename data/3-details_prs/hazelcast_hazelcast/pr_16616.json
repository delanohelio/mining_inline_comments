{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxNDMxMzYw", "number": 16616, "title": "[BACKPORT] Allow blocking Raft invocations to op-timeout after wait timeout", "bodyText": "If the wait key of a blocking call times out, it is still reported\nas a live operation. This cloud lead to hang the caller side when\nthe majority is lost because the Raft invocation does not fail with\noperation timeout.\nTo prevent this problem, we don't report a wait key as a live operation\nif it is not expired on the CP group after its wait timeout occurs.\nBackport of #16614", "createdAt": "2020-02-05T15:21:12Z", "url": "https://github.com/hazelcast/hazelcast/pull/16616", "merged": true, "mergeCommit": {"oid": "f4d444a6c58a5cc865d44d66e3feec44c2f78cbb"}, "closed": true, "closedAt": "2020-02-07T07:27:23Z", "author": {"login": "metanet"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBYl8DABqjMwMTA2NTU0NzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBsKgHAFqTM1NDUyMTk1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3cac6a0e22a1d5bb0d45588c56832717f524f347", "author": {"user": {"login": "metanet", "name": "Ensar Basri Kahveci"}}, "url": "https://github.com/hazelcast/hazelcast/commit/3cac6a0e22a1d5bb0d45588c56832717f524f347", "committedDate": "2020-02-05T14:48:51Z", "message": "Allow blocking Raft invocations to op-timeout after wait timeout\n\nIf the wait key of a blocking call times out, it is still reported\nas a live operation. This cloud lead to hang the caller side when\nthe majority is lost because the Raft invocation does not fail with\noperation timeout.\n\nTo prevent this problem, we don't report a wait key as a live operation\nif it is not expired on the CP group after its wait timeout occurs."}, "afterCommit": {"oid": "f21af4a9f310c15c6b1c6f071d1a06648ce2f672", "author": {"user": {"login": "metanet", "name": "Ensar Basri Kahveci"}}, "url": "https://github.com/hazelcast/hazelcast/commit/f21af4a9f310c15c6b1c6f071d1a06648ce2f672", "committedDate": "2020-02-05T16:18:47Z", "message": "Allow blocking Raft invocations to op-timeout after wait timeout\n\nIf the wait key of a blocking call times out, it is still reported\nas a live operation. This cloud lead to hang the caller side when\nthe majority is lost because the Raft invocation does not fail with\noperation timeout.\n\nTo prevent this problem, we don't report a wait key as a live operation\nif it is not expired on the CP group after its wait timeout occurs."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f21af4a9f310c15c6b1c6f071d1a06648ce2f672", "author": {"user": {"login": "metanet", "name": "Ensar Basri Kahveci"}}, "url": "https://github.com/hazelcast/hazelcast/commit/f21af4a9f310c15c6b1c6f071d1a06648ce2f672", "committedDate": "2020-02-05T16:18:47Z", "message": "Allow blocking Raft invocations to op-timeout after wait timeout\n\nIf the wait key of a blocking call times out, it is still reported\nas a live operation. This cloud lead to hang the caller side when\nthe majority is lost because the Raft invocation does not fail with\noperation timeout.\n\nTo prevent this problem, we don't report a wait key as a live operation\nif it is not expired on the CP group after its wait timeout occurs."}, "afterCommit": {"oid": "736973afc4c72beb4d7fad077cf790b3b87d7057", "author": {"user": {"login": "metanet", "name": "Ensar Basri Kahveci"}}, "url": "https://github.com/hazelcast/hazelcast/commit/736973afc4c72beb4d7fad077cf790b3b87d7057", "committedDate": "2020-02-05T18:18:05Z", "message": "Allow blocking Raft invocations to op-timeout after wait timeout\n\nIf the wait key of a blocking call times out, it is still reported\nas a live operation. This cloud lead to hang the caller side when\nthe majority is lost because the Raft invocation does not fail with\noperation timeout.\n\nTo prevent this problem, we don't report a wait key as a live operation\nif it is not expired on the CP group after its wait timeout occurs."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "736973afc4c72beb4d7fad077cf790b3b87d7057", "author": {"user": {"login": "metanet", "name": "Ensar Basri Kahveci"}}, "url": "https://github.com/hazelcast/hazelcast/commit/736973afc4c72beb4d7fad077cf790b3b87d7057", "committedDate": "2020-02-05T18:18:05Z", "message": "Allow blocking Raft invocations to op-timeout after wait timeout\n\nIf the wait key of a blocking call times out, it is still reported\nas a live operation. This cloud lead to hang the caller side when\nthe majority is lost because the Raft invocation does not fail with\noperation timeout.\n\nTo prevent this problem, we don't report a wait key as a live operation\nif it is not expired on the CP group after its wait timeout occurs."}, "afterCommit": {"oid": "98700760a91f09fabb5930975541e0c91c76dfe1", "author": {"user": {"login": "metanet", "name": "Ensar Basri Kahveci"}}, "url": "https://github.com/hazelcast/hazelcast/commit/98700760a91f09fabb5930975541e0c91c76dfe1", "committedDate": "2020-02-05T21:57:09Z", "message": "Allow blocking Raft invocations to op-timeout after wait timeout\n\nIf the wait key of a blocking call times out, it is still reported\nas a live operation. This cloud lead to hang the caller side when\nthe majority is lost because the Raft invocation does not fail with\noperation timeout.\n\nTo prevent this problem, we don't report a wait key as a live operation\nif it is not expired on the CP group after its wait timeout occurs."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98700760a91f09fabb5930975541e0c91c76dfe1", "author": {"user": {"login": "metanet", "name": "Ensar Basri Kahveci"}}, "url": "https://github.com/hazelcast/hazelcast/commit/98700760a91f09fabb5930975541e0c91c76dfe1", "committedDate": "2020-02-05T21:57:09Z", "message": "Allow blocking Raft invocations to op-timeout after wait timeout\n\nIf the wait key of a blocking call times out, it is still reported\nas a live operation. This cloud lead to hang the caller side when\nthe majority is lost because the Raft invocation does not fail with\noperation timeout.\n\nTo prevent this problem, we don't report a wait key as a live operation\nif it is not expired on the CP group after its wait timeout occurs."}, "afterCommit": {"oid": "3fa7f3a65856d639f5e9fc9bb37db07ec5f6ff6c", "author": {"user": {"login": "metanet", "name": "Ensar Basri Kahveci"}}, "url": "https://github.com/hazelcast/hazelcast/commit/3fa7f3a65856d639f5e9fc9bb37db07ec5f6ff6c", "committedDate": "2020-02-06T08:21:55Z", "message": "Allow blocking Raft invocations to op-timeout after wait timeout\n\nIf the wait key of a blocking call times out, it is still reported\nas a live operation. This cloud lead to hang the caller side when\nthe majority is lost because the Raft invocation does not fail with\noperation timeout.\n\nTo prevent this problem, we don't report a wait key as a live operation\nif it is not expired on the CP group after its wait timeout occurs."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3fa7f3a65856d639f5e9fc9bb37db07ec5f6ff6c", "author": {"user": {"login": "metanet", "name": "Ensar Basri Kahveci"}}, "url": "https://github.com/hazelcast/hazelcast/commit/3fa7f3a65856d639f5e9fc9bb37db07ec5f6ff6c", "committedDate": "2020-02-06T08:21:55Z", "message": "Allow blocking Raft invocations to op-timeout after wait timeout\n\nIf the wait key of a blocking call times out, it is still reported\nas a live operation. This cloud lead to hang the caller side when\nthe majority is lost because the Raft invocation does not fail with\noperation timeout.\n\nTo prevent this problem, we don't report a wait key as a live operation\nif it is not expired on the CP group after its wait timeout occurs."}, "afterCommit": {"oid": "cef7aa39981b8c2b3db0f20759ce94818c601718", "author": {"user": {"login": "metanet", "name": "Ensar Basri Kahveci"}}, "url": "https://github.com/hazelcast/hazelcast/commit/cef7aa39981b8c2b3db0f20759ce94818c601718", "committedDate": "2020-02-06T09:25:33Z", "message": "Allow blocking Raft invocations to op-timeout after wait timeout\n\nIf the wait key of a blocking call times out, it is still reported\nas a live operation. This cloud lead to hang the caller side when\nthe majority is lost because the Raft invocation does not fail with\noperation timeout.\n\nTo prevent this problem, we don't report a wait key as a live operation\nif it is not expired on the CP group after its wait timeout occurs."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MzMxMTY1", "url": "https://github.com/hazelcast/hazelcast/pull/16616#pullrequestreview-354331165", "createdAt": "2020-02-06T10:08:46Z", "commit": {"oid": "cef7aa39981b8c2b3db0f20759ce94818c601718"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08987d3351e1ea8a9d3cec4c1e1b6762e6f9dcad", "author": {"user": {"login": "metanet", "name": "Ensar Basri Kahveci"}}, "url": "https://github.com/hazelcast/hazelcast/commit/08987d3351e1ea8a9d3cec4c1e1b6762e6f9dcad", "committedDate": "2020-02-06T15:01:29Z", "message": "Allow blocking Raft invocations to op-timeout after wait timeout\n\nIf the wait key of a blocking call times out, it is still reported\nas a live operation. This could lead to hang the caller side when\nthe majority is lost because the Raft invocation does not fail with\noperation timeout.\n\nTo prevent this problem, we don't report a wait key as a live operation\nif it is not expired on the CP group after its wait timeout occurs."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cef7aa39981b8c2b3db0f20759ce94818c601718", "author": {"user": {"login": "metanet", "name": "Ensar Basri Kahveci"}}, "url": "https://github.com/hazelcast/hazelcast/commit/cef7aa39981b8c2b3db0f20759ce94818c601718", "committedDate": "2020-02-06T09:25:33Z", "message": "Allow blocking Raft invocations to op-timeout after wait timeout\n\nIf the wait key of a blocking call times out, it is still reported\nas a live operation. This cloud lead to hang the caller side when\nthe majority is lost because the Raft invocation does not fail with\noperation timeout.\n\nTo prevent this problem, we don't report a wait key as a live operation\nif it is not expired on the CP group after its wait timeout occurs."}, "afterCommit": {"oid": "08987d3351e1ea8a9d3cec4c1e1b6762e6f9dcad", "author": {"user": {"login": "metanet", "name": "Ensar Basri Kahveci"}}, "url": "https://github.com/hazelcast/hazelcast/commit/08987d3351e1ea8a9d3cec4c1e1b6762e6f9dcad", "committedDate": "2020-02-06T15:01:29Z", "message": "Allow blocking Raft invocations to op-timeout after wait timeout\n\nIf the wait key of a blocking call times out, it is still reported\nas a live operation. This could lead to hang the caller side when\nthe majority is lost because the Raft invocation does not fail with\noperation timeout.\n\nTo prevent this problem, we don't report a wait key as a live operation\nif it is not expired on the CP group after its wait timeout occurs."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NTIxOTU5", "url": "https://github.com/hazelcast/hazelcast/pull/16616#pullrequestreview-354521959", "createdAt": "2020-02-06T15:07:10Z", "commit": {"oid": "08987d3351e1ea8a9d3cec4c1e1b6762e6f9dcad"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNTowNzoxMVrOFmebFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNTowNzoxMVrOFmebFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTg4ODY2MA==", "bodyText": "typo: cloud -> could?", "url": "https://github.com/hazelcast/hazelcast/pull/16616#discussion_r375888660", "createdAt": "2020-02-06T15:07:11Z", "author": {"login": "petrpleshachkov"}, "path": "hazelcast/src/main/java/com/hazelcast/cp/internal/datastructures/spi/blocking/ResourceRegistry.java", "diffHunk": "@@ -57,11 +57,31 @@\n  * @param <R> concrete type of the resource\n  */\n public abstract class ResourceRegistry<W extends WaitKey, R extends BlockingResource<W>>\n-        implements LiveOperationsTracker, DataSerializable {\n+        implements DataSerializable {\n+\n+    // If the wait key of a blocking call times out, it is still reported\n+    // as a live operation. This cloud lead to hang the caller side when", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08987d3351e1ea8a9d3cec4c1e1b6762e6f9dcad"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3956, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}