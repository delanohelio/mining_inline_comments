{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5MzUzMjU3", "number": 16849, "title": "Client/Server Connection and cleanup", "bodyText": "Connection had conflated concerns; it contained client and server side specific logic. Therefor 2 new interfaces that extend Connection were introduced:\n\nClientConnection\nServerConnection\n\nThe client specific logic is move to ClientConnection and server specific knowledge is moved to ServerConnection.\nThe ClientConnection (the actual implementation) is renamed to TcpClientConnection.\nThe ServerConnection (the actual implementation)  is renamed to TcpServerConnection\nThe ClientConnectionManagerImpl is renamed to TcpClientConnectionManager (which matches TcpServerConnectionManager).\ncom.hazelcast.client.impl.connection.nio has been renamed to com.hazelcast.client.impl.connection.tcp. That it is using nio isn't very relevant. The naming is now in line with what is being used in server.\nThe ServerConnection functionality has been split in an API part and an implementation part.\nThe API part can be found at com.hazelcast.internal.server\nThe TCP implementation part can be found at com.hazelcast.internal.server.tcp\nEndpointManager is renamed to ServerConnectionManager because it ServerConnections are managed; not endpoints. Also the name is now in line with the ClientConnectionManager.\nAggregateEndpointManager is renamed to AggregateServerConnectionManager\nConnection.endpoint methods have been renamed to remoteAddress.\nNetworkingService is renamed to Server\nAnd ServerNetworkingService is renamed to TcpServer\nFor EE see https://github.com/hazelcast/hazelcast-enterprise/pull/3575", "createdAt": "2020-04-06T03:03:21Z", "url": "https://github.com/hazelcast/hazelcast/pull/16849", "merged": true, "mergeCommit": {"oid": "97d5da8a2ba6002a4e48ae03cf0485751b58dcca"}, "closed": true, "closedAt": "2020-04-09T09:08:58Z", "author": {"login": "pveentjer"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcU6PQ4ABqjMyMDQxNjIyODI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVmI8NgBqjMyMTM2NzczNDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a975bf6efd13dfe9588982e85853f07038739314", "author": {"user": {"login": "pveentjer", "name": "Peter Veentjer"}}, "url": "https://github.com/hazelcast/hazelcast/commit/a975bf6efd13dfe9588982e85853f07038739314", "committedDate": "2020-04-06T08:13:11Z", "message": "WIP"}, "afterCommit": {"oid": "f7f0db33950f983e080d12b426d5406fde2337be", "author": {"user": {"login": "pveentjer", "name": "Peter Veentjer"}}, "url": "https://github.com/hazelcast/hazelcast/commit/f7f0db33950f983e080d12b426d5406fde2337be", "committedDate": "2020-04-06T08:15:25Z", "message": "Renamed EndpointManager to connectionmanager"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7f0db33950f983e080d12b426d5406fde2337be", "author": {"user": {"login": "pveentjer", "name": "Peter Veentjer"}}, "url": "https://github.com/hazelcast/hazelcast/commit/f7f0db33950f983e080d12b426d5406fde2337be", "committedDate": "2020-04-06T08:15:25Z", "message": "Renamed EndpointManager to connectionmanager"}, "afterCommit": {"oid": "b539d9b47ddf2eb22322234708e773d0a7db3f9c", "author": {"user": {"login": "pveentjer", "name": "Peter Veentjer"}}, "url": "https://github.com/hazelcast/hazelcast/commit/b539d9b47ddf2eb22322234708e773d0a7db3f9c", "committedDate": "2020-04-06T08:18:52Z", "message": "Renamed EndpointManager to connectionmanager"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4MDczNjU4", "url": "https://github.com/hazelcast/hazelcast/pull/16849#pullrequestreview-388073658", "createdAt": "2020-04-06T09:22:31Z", "commit": {"oid": "b539d9b47ddf2eb22322234708e773d0a7db3f9c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwOToyMjozMVrOGBPARg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwOToyMjozMVrOGBPARg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk0NzU5MA==", "bodyText": "I could not find the usage of this method. Is this on enterprise side ?\nDo you have EE side ready for this pr ? Asking to check them together, to make sure this kind of changes.", "url": "https://github.com/hazelcast/hazelcast/pull/16849#discussion_r403947590", "createdAt": "2020-04-06T09:22:31Z", "author": {"login": "sancar"}, "path": "hazelcast/src/main/java/com/hazelcast/client/impl/connection/ClientConnection.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.client.impl.connection;\n+\n+import com.hazelcast.client.impl.protocol.ClientMessage;\n+import com.hazelcast.client.impl.spi.EventHandler;\n+import com.hazelcast.internal.nio.Connection;\n+\n+import java.util.Map;\n+\n+/**\n+ * The ClientConnection is connection that lives on the client side on behalf of a Java client.\n+ *\n+ * On the server side there will be a {@link com.hazelcast.internal.server.ServerConnection}.\n+ *\n+ * Use this class to add client specific method.\n+ */\n+public interface ClientConnection extends Connection {\n+\n+    /**\n+     * Returns the ClientConnectionManager of this ClientConnection.\n+     *\n+     * @return the ClientConnectionManager.\n+     */\n+    ClientConnectionManager getConnectionManager();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b539d9b47ddf2eb22322234708e773d0a7db3f9c"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4MDgwMjIw", "url": "https://github.com/hazelcast/hazelcast/pull/16849#pullrequestreview-388080220", "createdAt": "2020-04-06T09:31:22Z", "commit": {"oid": "b539d9b47ddf2eb22322234708e773d0a7db3f9c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwOTozMToyMlrOGBPVXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwOTozMToyMlrOGBPVXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzk1Mjk5MA==", "bodyText": "This second method is not necessary. The users of getActiveTcpClientConnections can use getActiveConnections instead. I have checked them. ClientConnection interface is enough for them. They don't need need implementation class.", "url": "https://github.com/hazelcast/hazelcast/pull/16849#discussion_r403952990", "createdAt": "2020-04-06T09:31:22Z", "author": {"login": "sancar"}, "path": "hazelcast/src/main/java/com/hazelcast/client/impl/connection/tcp/TcpClientConnectionManager.java", "diffHunk": "@@ -534,6 +535,10 @@ private void shutdownWithExternalThread() {\n \n     @Override\n     public Collection<ClientConnection> getActiveConnections() {\n+        return (Collection) activeConnections.values();\n+    }\n+\n+    public Collection<TcpClientConnection> getActiveTcpClientConnections() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b539d9b47ddf2eb22322234708e773d0a7db3f9c"}, "originalPosition": 51}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "67f7bf60a0de72c5289751661f98314a494ea456", "author": {"user": {"login": "pveentjer", "name": "Peter Veentjer"}}, "url": "https://github.com/hazelcast/hazelcast/commit/67f7bf60a0de72c5289751661f98314a494ea456", "committedDate": "2020-04-07T03:48:02Z", "message": "WIP"}, "afterCommit": {"oid": "a58367fa59c4b3b87e104faa4909d478ebd96b9f", "author": {"user": {"login": "pveentjer", "name": "Peter Veentjer"}}, "url": "https://github.com/hazelcast/hazelcast/commit/a58367fa59c4b3b87e104faa4909d478ebd96b9f", "committedDate": "2020-04-07T05:30:36Z", "message": "Introduction ClientConnection and ServerConnection"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a58367fa59c4b3b87e104faa4909d478ebd96b9f", "author": {"user": {"login": "pveentjer", "name": "Peter Veentjer"}}, "url": "https://github.com/hazelcast/hazelcast/commit/a58367fa59c4b3b87e104faa4909d478ebd96b9f", "committedDate": "2020-04-07T05:30:36Z", "message": "Introduction ClientConnection and ServerConnection"}, "afterCommit": {"oid": "0ad5f24ac71bcfd6cecaa2b40b7e18616611a000", "author": {"user": {"login": "pveentjer", "name": "Peter Veentjer"}}, "url": "https://github.com/hazelcast/hazelcast/commit/0ad5f24ac71bcfd6cecaa2b40b7e18616611a000", "committedDate": "2020-04-07T06:08:04Z", "message": "Introduction ClientConnection and ServerConnection"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4OTA3NDQ2", "url": "https://github.com/hazelcast/hazelcast/pull/16849#pullrequestreview-388907446", "createdAt": "2020-04-07T08:43:49Z", "commit": {"oid": "0ad5f24ac71bcfd6cecaa2b40b7e18616611a000"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4OTYxMDcz", "url": "https://github.com/hazelcast/hazelcast/pull/16849#pullrequestreview-388961073", "createdAt": "2020-04-07T09:53:07Z", "commit": {"oid": "0ad5f24ac71bcfd6cecaa2b40b7e18616611a000"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ad5f24ac71bcfd6cecaa2b40b7e18616611a000", "author": {"user": {"login": "pveentjer", "name": "Peter Veentjer"}}, "url": "https://github.com/hazelcast/hazelcast/commit/0ad5f24ac71bcfd6cecaa2b40b7e18616611a000", "committedDate": "2020-04-07T06:08:04Z", "message": "Introduction ClientConnection and ServerConnection"}, "afterCommit": {"oid": "53d0603ca0aacd98985da2516263450f361a778d", "author": {"user": {"login": "pveentjer", "name": "Peter Veentjer"}}, "url": "https://github.com/hazelcast/hazelcast/commit/53d0603ca0aacd98985da2516263450f361a778d", "committedDate": "2020-04-07T10:35:24Z", "message": "Introduction ClientConnection and ServerConnection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71b2c95472c5955b41c9ee91af13f239e1fc488c", "author": {"user": {"login": "pveentjer", "name": "Peter Veentjer"}}, "url": "https://github.com/hazelcast/hazelcast/commit/71b2c95472c5955b41c9ee91af13f239e1fc488c", "committedDate": "2020-04-08T11:24:24Z", "message": "Introduction ClientConnection and ServerConnection"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53d0603ca0aacd98985da2516263450f361a778d", "author": {"user": {"login": "pveentjer", "name": "Peter Veentjer"}}, "url": "https://github.com/hazelcast/hazelcast/commit/53d0603ca0aacd98985da2516263450f361a778d", "committedDate": "2020-04-07T10:35:24Z", "message": "Introduction ClientConnection and ServerConnection"}, "afterCommit": {"oid": "71b2c95472c5955b41c9ee91af13f239e1fc488c", "author": {"user": {"login": "pveentjer", "name": "Peter Veentjer"}}, "url": "https://github.com/hazelcast/hazelcast/commit/71b2c95472c5955b41c9ee91af13f239e1fc488c", "committedDate": "2020-04-08T11:24:24Z", "message": "Introduction ClientConnection and ServerConnection"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3750, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}