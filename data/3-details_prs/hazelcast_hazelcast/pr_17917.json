{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwNzc3MTgx", "number": 17917, "title": "Ensure that SplitBrainProtection configs are not overwritten during parsing", "bodyText": "Related: #17874\nDepends on: #17918", "createdAt": "2020-12-02T06:13:38Z", "url": "https://github.com/hazelcast/hazelcast/pull/17917", "merged": true, "mergeCommit": {"oid": "2c3d7ee5141fed45e24bef2017f37eb0f8ca04d6"}, "closed": true, "closedAt": "2020-12-04T15:28:39Z", "author": {"login": "pivovarit"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiJsx3gBqjQwNjA5MDk1MjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdi5eB7gFqTU0NTA1NzkyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "90e3ef31a5c77fd97c9d66307d108ccaa5467325", "author": {"user": {"login": "pivovarit", "name": "Grzegorz Piwowarek"}}, "url": "https://github.com/hazelcast/hazelcast/commit/90e3ef31a5c77fd97c9d66307d108ccaa5467325", "committedDate": "2020-12-02T06:07:55Z", "message": "Ensure that SplitBrainProtection configs are not overwritten during parsing"}, "afterCommit": {"oid": "1af230d30bf165e826b2ec64a0d005e709c267ad", "author": {"user": {"login": "pivovarit", "name": "Grzegorz Piwowarek"}}, "url": "https://github.com/hazelcast/hazelcast/commit/1af230d30bf165e826b2ec64a0d005e709c267ad", "committedDate": "2020-12-02T07:48:33Z", "message": "Ensure that SplitBrainProtection configs are not overwritten during parsing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72aa302cb9d049a5cee46668893ce1df09d126ff", "author": {"user": {"login": "pivovarit", "name": "Grzegorz Piwowarek"}}, "url": "https://github.com/hazelcast/hazelcast/commit/72aa302cb9d049a5cee46668893ce1df09d126ff", "committedDate": "2020-12-02T09:35:36Z", "message": "Ensure that SplitBrainProtection configs are not overwritten during parsing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1af230d30bf165e826b2ec64a0d005e709c267ad", "author": {"user": {"login": "pivovarit", "name": "Grzegorz Piwowarek"}}, "url": "https://github.com/hazelcast/hazelcast/commit/1af230d30bf165e826b2ec64a0d005e709c267ad", "committedDate": "2020-12-02T07:48:33Z", "message": "Ensure that SplitBrainProtection configs are not overwritten during parsing"}, "afterCommit": {"oid": "72aa302cb9d049a5cee46668893ce1df09d126ff", "author": {"user": {"login": "pivovarit", "name": "Grzegorz Piwowarek"}}, "url": "https://github.com/hazelcast/hazelcast/commit/72aa302cb9d049a5cee46668893ce1df09d126ff", "committedDate": "2020-12-02T09:35:36Z", "message": "Ensure that SplitBrainProtection configs are not overwritten during parsing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70dbe40197d1cb86ba0515e5563cbef3750b3b60", "author": {"user": {"login": "pivovarit", "name": "Grzegorz Piwowarek"}}, "url": "https://github.com/hazelcast/hazelcast/commit/70dbe40197d1cb86ba0515e5563cbef3750b3b60", "committedDate": "2020-12-02T17:41:29Z", "message": "Merge branch 'master' into parser-fix-part-4"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MDUzMjY4", "url": "https://github.com/hazelcast/hazelcast/pull/17917#pullrequestreview-545053268", "createdAt": "2020-12-04T15:22:48Z", "commit": {"oid": "70dbe40197d1cb86ba0515e5563cbef3750b3b60"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNToyMjo0OVrOH_Vnfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNToyMjo0OVrOH_Vnfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE3NjUxMQ==", "bodyText": "I think we need a test for a non-existent config as well. We rely on getting a non-null config for config.getSplitBrainProtectionConfig(name) in MemberDomConfigProcessor, but it's not tested.", "url": "https://github.com/hazelcast/hazelcast/pull/17917#discussion_r536176511", "createdAt": "2020-12-04T15:22:49Z", "author": {"login": "blazember"}, "path": "hazelcast/src/test/java/com/hazelcast/internal/config/override/ExternalMemberConfigurationOverrideEnvTest.java", "diffHunk": "@@ -142,6 +144,22 @@ public void shouldHandleUserCodeDeploymentConfig() throws Exception {\n         assertEquals(UserCodeDeploymentConfig.ClassCacheMode.OFF, config.getUserCodeDeploymentConfig().getClassCacheMode());\n     }\n \n+    @Test\n+    public void shouldHandleSplitBrainProtectionConfig() throws Exception {\n+        Config config = new Config();\n+        config.getSplitBrainProtectionConfig(\"foo\")\n+          .setEnabled(true)\n+          .setProtectOn(SplitBrainProtectionOn.READ);\n+\n+        withEnvironmentVariable(\"HZ_SPLITBRAINPROTECTION_FOO_ENABLED\", \"true\")\n+          .and(\"HZ_SPLITBRAINPROTECTION_FOO_FUNCTIONCLASSNAME\", \"com.foo.SomeClass\")\n+          .execute(() -> new ExternalConfigurationOverride().overwriteMemberConfig(config));\n+\n+        assertTrue(config.getSplitBrainProtectionConfig(\"foo\").isEnabled());\n+        assertSame(SplitBrainProtectionOn.READ, config.getSplitBrainProtectionConfig(\"foo\").getProtectOn());\n+        assertEquals(\"com.foo.SomeClass\", config.getSplitBrainProtectionConfig(\"foo\").getFunctionClassName());\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70dbe40197d1cb86ba0515e5563cbef3750b3b60"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MDU2MzAz", "url": "https://github.com/hazelcast/hazelcast/pull/17917#pullrequestreview-545056303", "createdAt": "2020-12-04T15:26:11Z", "commit": {"oid": "70dbe40197d1cb86ba0515e5563cbef3750b3b60"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MDU3OTI4", "url": "https://github.com/hazelcast/hazelcast/pull/17917#pullrequestreview-545057928", "createdAt": "2020-12-04T15:28:02Z", "commit": {"oid": "70dbe40197d1cb86ba0515e5563cbef3750b3b60"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNToyODowM1rOH_V2Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNToyODowM1rOH_V2Vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE4MDMxMA==", "bodyText": "I see that the merge introduced some empty lines here. Will remove them in the next change.", "url": "https://github.com/hazelcast/hazelcast/pull/17917#discussion_r536180310", "createdAt": "2020-12-04T15:28:03Z", "author": {"login": "pivovarit"}, "path": "hazelcast/src/main/java/com/hazelcast/config/SplitBrainProtectionConfig.java", "diffHunk": "@@ -71,7 +71,9 @@\n     private String name;\n     private boolean enabled;\n     private int minimumClusterSize = 2;\n-    private List<SplitBrainProtectionListenerConfig> listenerConfigs = new ArrayList<SplitBrainProtectionListenerConfig>();\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70dbe40197d1cb86ba0515e5563cbef3750b3b60"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2995, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}