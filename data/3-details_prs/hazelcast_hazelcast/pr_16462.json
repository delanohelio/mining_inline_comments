{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNDIzNzUw", "number": 16462, "title": "Take serializeKeys into account in containsKey at ClientMapProxy", "bodyText": "fixes #16472\nNote that after adding the check to checkKeyFormat ,\nClientMapNearCacheBasicSlowTest starts to fail. It has tests\nfor containsKey. With the fix, it is passing now. So no new test is\nneeded.\nrelated to #16458", "createdAt": "2020-01-10T12:14:27Z", "url": "https://github.com/hazelcast/hazelcast/pull/16462", "merged": true, "mergeCommit": {"oid": "f8df6301abad6bd3670c90dbb8be12f0ca364acf"}, "closed": true, "closedAt": "2020-01-15T10:30:01Z", "author": {"login": "sancar"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb49htZgFqTM0MTEyNjE5Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6PILrgBqjI5NDY2NjM4MDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMTI2MTkz", "url": "https://github.com/hazelcast/hazelcast/pull/16462#pullrequestreview-341126193", "createdAt": "2020-01-10T12:15:43Z", "commit": {"oid": "15a0322816e5a745cca13c8ab94c4bce1531f78b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMTI5MjEz", "url": "https://github.com/hazelcast/hazelcast/pull/16462#pullrequestreview-341129213", "createdAt": "2020-01-10T12:22:47Z", "commit": {"oid": "15a0322816e5a745cca13c8ab94c4bce1531f78b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxMjoyMjo0N1rOFcSnjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQxMjoyMjo0N1rOFcSnjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTIwOTQ4Ng==", "bodyText": "This looks clearer:\nif (serializeKeys) {\n\tcheckInstanceOf(Data.class, key, \"key must be of type Data!\");\n} else {\n    checkNotInstanceOf(Data.class, key, \"key cannot be of type Data!\");        \n}", "url": "https://github.com/hazelcast/hazelcast/pull/16462#discussion_r365209486", "createdAt": "2020-01-10T12:22:47Z", "author": {"login": "ahmetmircik"}, "path": "hazelcast/src/main/java/com/hazelcast/internal/nearcache/impl/DefaultNearCache.java", "diffHunk": "@@ -222,6 +223,8 @@ public V tryPublishReserved(K key, V value, long reservationId, boolean deserial\n     private void checkKeyFormat(K key) {\n         if (!serializeKeys) {\n             checkNotInstanceOf(Data.class, key, \"key cannot be of type Data!\");\n+        } else {\n+            checkInstanceOf(Data.class, key, \"key must be of type Data!\");\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15a0322816e5a745cca13c8ab94c4bce1531f78b"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d31da11d9d49fee98532ee148e3c0b5be9ff5bd", "author": {"user": {"login": "sancar", "name": "sancar"}}, "url": "https://github.com/hazelcast/hazelcast/commit/3d31da11d9d49fee98532ee148e3c0b5be9ff5bd", "committedDate": "2020-01-10T13:09:31Z", "message": "fixing test to honor serializeKeys also"}, "afterCommit": {"oid": "ba218b95614072a1752f73cf43ade8b31a4967cc", "author": {"user": {"login": "sancar", "name": "sancar"}}, "url": "https://github.com/hazelcast/hazelcast/commit/ba218b95614072a1752f73cf43ade8b31a4967cc", "committedDate": "2020-01-10T13:12:22Z", "message": "fixing test to honor serializeKeys also"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMjAwOTMx", "url": "https://github.com/hazelcast/hazelcast/pull/16462#pullrequestreview-341200931", "createdAt": "2020-01-10T14:36:27Z", "commit": {"oid": "ba218b95614072a1752f73cf43ade8b31a4967cc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNjc3MDc5", "url": "https://github.com/hazelcast/hazelcast/pull/16462#pullrequestreview-341677079", "createdAt": "2020-01-13T08:03:43Z", "commit": {"oid": "73efca89f265e5fb3c53a9d3a2893000e6007d30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwODowMzo0M1rOFcvJOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QwODowMzo0M1rOFcvJOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY3Njg1Ng==", "bodyText": "can we fail fast here instead of forcing it to be false?", "url": "https://github.com/hazelcast/hazelcast/pull/16462#discussion_r365676856", "createdAt": "2020-01-13T08:03:43Z", "author": {"login": "ahmetmircik"}, "path": "hazelcast/src/main/java/com/hazelcast/client/impl/proxy/ClientReplicatedMapProxy.java", "diffHunk": "@@ -112,7 +112,11 @@ protected void onInitialize() {\n     private void initNearCache() {\n         NearCacheConfig nearCacheConfig = getContext().getClientConfig().getNearCacheConfig(name);\n         if (nearCacheConfig != null) {\n-            nearCache = getContext().getNearCacheManager(getServiceName()).getOrCreateNearCache(name, nearCacheConfig);\n+            NearCacheConfig copyNearCacheConfig = new NearCacheConfig(nearCacheConfig);\n+            //We don't have serializeKeys support on replicated map nearcache\n+            copyNearCacheConfig.setSerializeKeys(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "73efca89f265e5fb3c53a9d3a2893000e6007d30"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bbd4586a00b0443e25d75c7ee22960724c0d369", "author": {"user": {"login": "sancar", "name": "sancar"}}, "url": "https://github.com/hazelcast/hazelcast/commit/7bbd4586a00b0443e25d75c7ee22960724c0d369", "committedDate": "2020-01-13T12:17:02Z", "message": "Take serializeKeys into account in containsKey at ClientMapProxy\n\nNote that after adding the check to `checkKeyFormat` ,\nClientMapNearCacheBasicSlowTest starts to fail. It has tests\nfor containsKey. With the fix, it is passing now. So no new test is\nneeded.\n\nrelated to https://github.com/hazelcast/hazelcast/issues/16458"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05677733b17a924fd2819d8e51df7ba4310e3c6f", "author": {"user": {"login": "sancar", "name": "sancar"}}, "url": "https://github.com/hazelcast/hazelcast/commit/05677733b17a924fd2819d8e51df7ba4310e3c6f", "committedDate": "2020-01-13T12:17:02Z", "message": "address review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd53b86abb0fe92c57dfaeb1bf2c24d867bbfa2b", "author": {"user": {"login": "sancar", "name": "sancar"}}, "url": "https://github.com/hazelcast/hazelcast/commit/dd53b86abb0fe92c57dfaeb1bf2c24d867bbfa2b", "committedDate": "2020-01-13T12:17:02Z", "message": "fixing test to honor serializeKeys also"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0557b1cc96667796d3504b40573c9d6e97cc3cba", "author": {"user": {"login": "sancar", "name": "sancar"}}, "url": "https://github.com/hazelcast/hazelcast/commit/0557b1cc96667796d3504b40573c9d6e97cc3cba", "committedDate": "2020-01-13T12:17:02Z", "message": "don't use serializeKeys on replicated map nearcache"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "73efca89f265e5fb3c53a9d3a2893000e6007d30", "author": {"user": {"login": "sancar", "name": "sancar"}}, "url": "https://github.com/hazelcast/hazelcast/commit/73efca89f265e5fb3c53a9d3a2893000e6007d30", "committedDate": "2020-01-13T07:16:25Z", "message": "don't use serializeKeys on replicated map nearcache"}, "afterCommit": {"oid": "3bd216eebf32e801a395b12e53df81dfb1b4483d", "author": {"user": {"login": "sancar", "name": "sancar"}}, "url": "https://github.com/hazelcast/hazelcast/commit/3bd216eebf32e801a395b12e53df81dfb1b4483d", "committedDate": "2020-01-13T12:36:10Z", "message": "make serializeKeys option failfast for replicated map"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cfbf837cbcdc5dcd9178418e44747861df96624", "author": {"user": {"login": "sancar", "name": "sancar"}}, "url": "https://github.com/hazelcast/hazelcast/commit/1cfbf837cbcdc5dcd9178418e44747861df96624", "committedDate": "2020-01-14T11:15:44Z", "message": "make serializeKeys option failfast for replicated map"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3bd216eebf32e801a395b12e53df81dfb1b4483d", "author": {"user": {"login": "sancar", "name": "sancar"}}, "url": "https://github.com/hazelcast/hazelcast/commit/3bd216eebf32e801a395b12e53df81dfb1b4483d", "committedDate": "2020-01-13T12:36:10Z", "message": "make serializeKeys option failfast for replicated map"}, "afterCommit": {"oid": "1cfbf837cbcdc5dcd9178418e44747861df96624", "author": {"user": {"login": "sancar", "name": "sancar"}}, "url": "https://github.com/hazelcast/hazelcast/commit/1cfbf837cbcdc5dcd9178418e44747861df96624", "committedDate": "2020-01-14T11:15:44Z", "message": "make serializeKeys option failfast for replicated map"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4018, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}