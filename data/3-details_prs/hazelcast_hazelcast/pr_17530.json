{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2NDc5MjQy", "number": 17530, "title": "QueryUtils.createPartitionMap may throw NPE if a partition is not assigned", "bodyText": "QueryUtils.createPartitionMap creates a map from member ID to owned partitions. This map is used in several parts of the SQL engine: to create the plan, and to invalidate obsolete plans.\nPreviously this method doesn't check the partition owner for null, so NPE could have been thrown from it. This NPE could lead to either user-facing exception, or kill the query checker thread completely, leading to query hangs in case of a concurrent kill of a member.\nThis PR fixes the problem making NPE impossible. Now, if the partition is not assigned, our reaction depends on the context - we either throw an exception if we cannot proceed (similarly to Invocation.initInvocationTarget), or ignore it.", "createdAt": "2020-09-14T09:37:26Z", "url": "https://github.com/hazelcast/hazelcast/pull/17530", "merged": true, "mergeCommit": {"oid": "a0c2eb7a87fa84a934c264a28b9f91dbc4ed5ffa"}, "closed": true, "closedAt": "2020-09-14T13:03:16Z", "author": {"login": "devozerov"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIvqinAH2gAyNDg2NDc5MjQyOjE3NWQzNjE1MWRkOTQwZTQzNzY2ZmRmMDI2NDJiMDhiNjdmMTM2Nzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIy0AKgFqTQ4NzcyODAxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "175d36151dd940e43766fdf02642b08b67f13678", "author": {"user": {"login": "devozerov", "name": "Vladimir Ozerov"}}, "url": "https://github.com/hazelcast/hazelcast/commit/175d36151dd940e43766fdf02642b08b67f13678", "committedDate": "2020-09-14T09:20:38Z", "message": "Fixed possible NPE in case of unassigned partition."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb314381ea283a540c482e05630fcfc4ee140662", "author": {"user": {"login": "devozerov", "name": "Vladimir Ozerov"}}, "url": "https://github.com/hazelcast/hazelcast/commit/cb314381ea283a540c482e05630fcfc4ee140662", "committedDate": "2020-09-14T09:32:46Z", "message": "Tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NjM5Nzk3", "url": "https://github.com/hazelcast/hazelcast/pull/17530#pullrequestreview-487639797", "createdAt": "2020-09-14T10:55:54Z", "commit": {"oid": "cb314381ea283a540c482e05630fcfc4ee140662"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3Njc5MjY3", "url": "https://github.com/hazelcast/hazelcast/pull/17530#pullrequestreview-487679267", "createdAt": "2020-09-14T11:57:07Z", "commit": {"oid": "cb314381ea283a540c482e05630fcfc4ee140662"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMTo1NzowOFrOHRQTrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMTo1NzowOFrOHRQTrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzg1NTAyMg==", "bodyText": "In which situation the owner can be null?", "url": "https://github.com/hazelcast/hazelcast/pull/17530#discussion_r487855022", "createdAt": "2020-09-14T11:57:08Z", "author": {"login": "petrpleshachkov"}, "path": "hazelcast/src/main/java/com/hazelcast/sql/impl/QueryUtils.java", "diffHunk": "@@ -190,6 +193,17 @@ public static SqlColumnMetadata getColumnMetadata(String columnName, QueryDataTy\n         for (Partition part : parts) {\n             Member owner = part.getOwner();\n \n+            if (owner == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb314381ea283a540c482e05630fcfc4ee140662"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NzI4MDEy", "url": "https://github.com/hazelcast/hazelcast/pull/17530#pullrequestreview-487728012", "createdAt": "2020-09-14T13:00:41Z", "commit": {"oid": "cb314381ea283a540c482e05630fcfc4ee140662"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3291, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}