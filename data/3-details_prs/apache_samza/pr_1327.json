{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzMzM4MDYz", "number": 1327, "title": "SAMZA-2493: Keep checkpoint manager consumer open for repeated polling", "bodyText": "Feature: Allow control of whether the underlying consumer backing a checkpoint manager will be left open (until stopped), or closed after the initial read of checkpoints\nChanges: Introduces an internal config, injected by SamzaContainer, that is injected dependent on whether the container is standby or not, to control whether the container's checkpoint manager should have it's underlying consumer stopped after initial read or not.\n\u2028Tests: Added a unit test each for the config set to true / false\nAPI Changes: None\nUpgrade Instructions: None\nUsage Instructions: None", "createdAt": "2020-03-25T01:40:25Z", "url": "https://github.com/apache/samza/pull/1327", "merged": true, "mergeCommit": {"oid": "b193d45a8cd53996a0272817cc37a59255058092"}, "closed": true, "closedAt": "2020-04-07T16:44:24Z", "author": {"login": "bkonold"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ9NmWAH2gAyMzkzMzM4MDYzOjI3Yzc1YWQ1MGJjM2NlMTA5YjFhY2I2YzVhOTk2OTA3NThiMzIwZWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVISqZgFqTM4ODcxMTEwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "27c75ad50bc3ce109b1acb6c5a99690758b320ee", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/27c75ad50bc3ce109b1acb6c5a99690758b320ee", "committedDate": "2020-03-25T01:27:56Z", "message": "keep checkpoint manager consumer open after first read"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MDEyMzEz", "url": "https://github.com/apache/samza/pull/1327#pullrequestreview-385012313", "createdAt": "2020-03-31T18:50:31Z", "commit": {"oid": "27c75ad50bc3ce109b1acb6c5a99690758b320ee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODo1MDozMVrOF-jjYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxODo1MDozMVrOF-jjYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEzODUzMQ==", "bodyText": "Why do this as a config instead of a parameter?\nIf internal config, let's use samza.internal prefix.", "url": "https://github.com/apache/samza/pull/1327#discussion_r401138531", "createdAt": "2020-03-31T18:50:31Z", "author": {"login": "prateekm"}, "path": "samza-core/src/main/java/org/apache/samza/config/TaskConfig.java", "diffHunk": "@@ -105,6 +105,7 @@\n   private static final String BROADCAST_STREAM_PATTERN = \"^[\\\\d]+$\";\n   private static final String BROADCAST_STREAM_RANGE_PATTERN = \"^\\\\[[\\\\d]+\\\\-[\\\\d]+\\\\]$\";\n   public static final String CHECKPOINT_MANAGER_FACTORY = \"task.checkpoint.factory\";\n+  public static final String CHECKPOINT_MANAGER_CONSUMER_STOP_AFTER_FIRST_READ = \"task.checkpoint.consumer.stop.after.first.read\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27c75ad50bc3ce109b1acb6c5a99690758b320ee"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbf98ab8c9df5de93d88860d822a9994c85a02fd", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/fbf98ab8c9df5de93d88860d822a9994c85a02fd", "committedDate": "2020-04-03T01:49:19Z", "message": "adding samza.internal prefix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2ODk2OTc0", "url": "https://github.com/apache/samza/pull/1327#pullrequestreview-386896974", "createdAt": "2020-04-03T02:20:40Z", "commit": {"oid": "fbf98ab8c9df5de93d88860d822a9994c85a02fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMjoyMDo0MFrOGAC24A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMjoyMDo0MFrOGAC24A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjcwMDAwMA==", "bodyText": "Lets maybe add a one-line description of what this config does?\nAlso if it'd be possible to shrink the name somewhat.", "url": "https://github.com/apache/samza/pull/1327#discussion_r402700000", "createdAt": "2020-04-03T02:20:40Z", "author": {"login": "rmatharu"}, "path": "samza-core/src/main/java/org/apache/samza/config/TaskConfig.java", "diffHunk": "@@ -105,6 +105,7 @@\n   private static final String BROADCAST_STREAM_PATTERN = \"^[\\\\d]+$\";\n   private static final String BROADCAST_STREAM_RANGE_PATTERN = \"^\\\\[[\\\\d]+\\\\-[\\\\d]+\\\\]$\";\n   public static final String CHECKPOINT_MANAGER_FACTORY = \"task.checkpoint.factory\";\n+  public static final String INTERNAL_CHECKPOINT_MANAGER_CONSUMER_STOP_AFTER_FIRST_READ = \"samza.internal.task.checkpoint.consumer.stop.after.first.read\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbf98ab8c9df5de93d88860d822a9994c85a02fd"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NTU1Nzg5", "url": "https://github.com/apache/samza/pull/1327#pullrequestreview-387555789", "createdAt": "2020-04-03T20:21:40Z", "commit": {"oid": "fbf98ab8c9df5de93d88860d822a9994c85a02fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDoyMTo0MFrOGAnu5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDoyMTo0MFrOGAnu5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwNDE2Ng==", "bodyText": "can we put in a comment on when this config is set vs not?", "url": "https://github.com/apache/samza/pull/1327#discussion_r403304166", "createdAt": "2020-04-03T20:21:40Z", "author": {"login": "mynameborat"}, "path": "samza-kafka/src/main/scala/org/apache/samza/checkpoint/kafka/KafkaCheckpointManager.scala", "diffHunk": "@@ -76,6 +76,8 @@ class KafkaCheckpointManager(checkpointSpec: KafkaStreamSpec,\n   val producerRef: AtomicReference[SystemProducer] = new AtomicReference[SystemProducer](getSystemProducer())\n   val producerCreationLock: Object = new Object\n \n+  val stopConsumerAfterFirstRead: Boolean = new TaskConfig(config).getCheckpointManagerConsumerStopAfterFirstRead", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbf98ab8c9df5de93d88860d822a9994c85a02fd"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67849b69ab048867e90770971444e1993fb9491f", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/67849b69ab048867e90770971444e1993fb9491f", "committedDate": "2020-04-03T22:38:17Z", "message": "adding doc strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35ec1aa5a57864b6d687942f0216f6016aafe95a", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/35ec1aa5a57864b6d687942f0216f6016aafe95a", "committedDate": "2020-04-06T23:51:37Z", "message": "unit tests and fixing config initialization in SamzaContainer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25b0ab2e28a2ed6297d7487b7ce2adff0d670d97", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/25b0ab2e28a2ed6297d7487b7ce2adff0d670d97", "committedDate": "2020-04-07T00:36:20Z", "message": "verify no interactions after stop() in unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NzExMTA0", "url": "https://github.com/apache/samza/pull/1327#pullrequestreview-388711104", "createdAt": "2020-04-07T00:38:07Z", "commit": {"oid": "25b0ab2e28a2ed6297d7487b7ce2adff0d670d97"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4832, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}