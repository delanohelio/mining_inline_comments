{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExODYyMzAw", "number": 1354, "title": "SAMZA-2518: Update JobCoordinatorLaunchUtil to fetch launch config from metadata store.", "bodyText": "Design:\nhttps://cwiki.apache.org/confluence/display/SAMZA/SEP-23%3A+Simplify+Job+Runner\nChanges:\n\nAdd readLaunchConfigFromCoordinatorStream() in CoordinatorStreamUtil\nAdd an extra step in JobCoordinatorLaunchUtil to invoke readLaunchConfigFromCoordinatorStream()\n\nAPI Changes:\nNone\nUpgrade Instructions:\nNone\nUsage Instructions:\nNone\nTests:\nUnit Tests", "createdAt": "2020-04-30T22:06:46Z", "url": "https://github.com/apache/samza/pull/1354", "merged": true, "mergeCommit": {"oid": "10915fb3cda40ae3733d82f1290bd854af113af6"}, "closed": true, "closedAt": "2020-05-05T00:04:22Z", "author": {"login": "kw2542"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcc0c8DAH2gAyNDExODYyMzAwOjVhZDAyNzNlMjEzZjMxMGU3YTJhNjA5YjM2YmQzYjgyMTc0NTliZTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceIA2pgH2gAyNDExODYyMzAwOjc1OTMzNmQzN2Q4YmM5MGFlYmViYjBiMmY3NmM5ZmFjM2VkNzQwMGQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5ad0273e213f310e7a2a609b36bd3b8217459be7", "author": {"user": {"login": "kw2542", "name": "Ke Wu"}}, "url": "https://github.com/apache/samza/commit/5ad0273e213f310e7a2a609b36bd3b8217459be7", "committedDate": "2020-04-30T22:02:38Z", "message": "SAMZA-2518: Update JobCoordinatorLaunchUtil to fetch launch config from metadata store.\n\nDesign:\nhttps://cwiki.apache.org/confluence/display/SAMZA/SEP-23%3A+Simplify+Job+Runner\n\nChanges:\n1. Add readLaunchConfigFromCoordinatorStream() in CoordinatorStreamUtil\n2. Add an extra step in JobCoordinatorLaunchUtil to invoke readLaunchConfigFromCoordinatorStream()\n\nAPI Changes:\nNone\n\nUpgrade Instructions:\nNone\n\nUsage Instructions:\nNone\n\nTests:\nUnit Tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzE4MjUx", "url": "https://github.com/apache/samza/pull/1354#pullrequestreview-404318251", "createdAt": "2020-05-01T18:21:14Z", "commit": {"oid": "5ad0273e213f310e7a2a609b36bd3b8217459be7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODoyMToxNFrOGPRncA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODoyMToxNFrOGPRncA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3MDQ0OA==", "bodyText": "nit pick: new CoordinatorStreamStore(CoordinatorStreamUtil.buildCoordinatorStreamConfig(fullConfig), new MetricsRegistryMap());", "url": "https://github.com/apache/samza/pull/1354#discussion_r418670448", "createdAt": "2020-05-01T18:21:14Z", "author": {"login": "rmatharu"}, "path": "samza-core/src/main/java/org/apache/samza/clustermanager/JobCoordinatorLaunchUtil.java", "diffHunk": "@@ -57,14 +58,17 @@ public static void run(SamzaApplication app, Config config) {\n       throw new SamzaException(\"Only support single remote job is supported.\");\n     }\n \n-    Config finalConfig = jobConfigs.get(0);\n+    Config fullConfig = jobConfigs.get(0);\n+    MetricsRegistryMap metrics = new MetricsRegistryMap();\n+    MetadataStore", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ad0273e213f310e7a2a609b36bd3b8217459be7"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzE5MDEw", "url": "https://github.com/apache/samza/pull/1354#pullrequestreview-404319010", "createdAt": "2020-05-01T18:22:29Z", "commit": {"oid": "5ad0273e213f310e7a2a609b36bd3b8217459be7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODoyMjoyOVrOGPRp0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODoyMjoyOVrOGPRp0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3MTA1OQ==", "bodyText": "Could we use the\npublic boolean isAutosizingConfig(String configParam)\nmethod in JobConfig for this?", "url": "https://github.com/apache/samza/pull/1354#discussion_r418671059", "createdAt": "2020-05-01T18:22:29Z", "author": {"login": "rmatharu"}, "path": "samza-core/src/main/java/org/apache/samza/config/JobConfig.java", "diffHunk": "@@ -132,7 +132,7 @@\n \n   // Auto-sizing related configs that take precedence over respective sizing confings job.container.count, etc,\n   // *only* when job.autosizing.enabled is true. Otherwise current behavior is maintained.\n-  private static final String JOB_AUTOSIZING_CONFIG_PREFIX = \"job.autosizing.\"; // used to determine if a config is related to autosizing\n+  public static final String JOB_AUTOSIZING_CONFIG_PREFIX = \"job.autosizing.\"; // used to determine if a config is related to autosizing", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ad0273e213f310e7a2a609b36bd3b8217459be7"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzI0NDkw", "url": "https://github.com/apache/samza/pull/1354#pullrequestreview-404324490", "createdAt": "2020-05-01T18:32:20Z", "commit": {"oid": "5ad0273e213f310e7a2a609b36bd3b8217459be7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODozMjoyMFrOGPR7mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODozMjoyMFrOGPR7mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3NTYxMA==", "bodyText": "should we call it readAutosizingConfigs?", "url": "https://github.com/apache/samza/pull/1354#discussion_r418675610", "createdAt": "2020-05-01T18:32:20Z", "author": {"login": "rmatharu"}, "path": "samza-core/src/main/scala/org/apache/samza/util/CoordinatorStreamUtil.scala", "diffHunk": "@@ -110,13 +111,34 @@ object CoordinatorStreamUtil extends Logging {\n       jobConfig.getJobId)\n   }\n \n+  /**\n+   * Reads and returns launch config persisted in coordinator stream. Only job.auto sizing configs are currently supported.\n+   * @param config full job config\n+   * @param metadataStore an instance of the instantiated MetadataStore\n+   * @return empty config if auto sizing is disabled, otherwise auto sizing related configs.\n+   */\n+  def readLaunchConfigFromCoordinatorStream(config: Config, metadataStore: MetadataStore): Config = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ad0273e213f310e7a2a609b36bd3b8217459be7"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzI1NDg2", "url": "https://github.com/apache/samza/pull/1354#pullrequestreview-404325486", "createdAt": "2020-05-01T18:34:18Z", "commit": {"oid": "5ad0273e213f310e7a2a609b36bd3b8217459be7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODozNDoxOFrOGPR-2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxODozNDoxOFrOGPR-2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3NjQ0MQ==", "bodyText": "Could be simplified along the lines of\nJobConfig jobConfig = new JobConfig(config);\nlaunchConfig = config.map().filter(jobConfig.isAutosizingConfig(key))", "url": "https://github.com/apache/samza/pull/1354#discussion_r418676441", "createdAt": "2020-05-01T18:34:18Z", "author": {"login": "rmatharu"}, "path": "samza-core/src/main/scala/org/apache/samza/util/CoordinatorStreamUtil.scala", "diffHunk": "@@ -110,13 +111,34 @@ object CoordinatorStreamUtil extends Logging {\n       jobConfig.getJobId)\n   }\n \n+  /**\n+   * Reads and returns launch config persisted in coordinator stream. Only job.auto sizing configs are currently supported.\n+   * @param config full job config\n+   * @param metadataStore an instance of the instantiated MetadataStore\n+   * @return empty config if auto sizing is disabled, otherwise auto sizing related configs.\n+   */\n+  def readLaunchConfigFromCoordinatorStream(config: Config, metadataStore: MetadataStore): Config = {\n+    if (!config.getBoolean(JobConfig.JOB_AUTOSIZING_ENABLED, false)) {\n+      new MapConfig()\n+    } else {\n+      val config = readConfigFromCoordinatorStream(metadataStore)\n+      val launchConfig: util.Map[String, String] = new util.HashMap[String, String]()\n+      for ((key:String, value:String) <- config.asScala) {\n+        if (key.startsWith(JobConfig.JOB_AUTOSIZING_CONFIG_PREFIX)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ad0273e213f310e7a2a609b36bd3b8217459be7"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzI1Njk5", "url": "https://github.com/apache/samza/pull/1354#pullrequestreview-404325699", "createdAt": "2020-05-01T18:34:43Z", "commit": {"oid": "5ad0273e213f310e7a2a609b36bd3b8217459be7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "142087e76731230570115c6079b2846e815aa47e", "author": {"user": {"login": "kw2542", "name": "Ke Wu"}}, "url": "https://github.com/apache/samza/commit/142087e76731230570115c6079b2846e815aa47e", "committedDate": "2020-05-01T19:35:30Z", "message": "Update to address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1Mzg1NTg3", "url": "https://github.com/apache/samza/pull/1354#pullrequestreview-405385587", "createdAt": "2020-05-04T22:14:28Z", "commit": {"oid": "142087e76731230570115c6079b2846e815aa47e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "759336d37d8bc90aebebb0b2f76c9fac3ed7400d", "author": {"user": {"login": "kw2542", "name": "Ke Wu"}}, "url": "https://github.com/apache/samza/commit/759336d37d8bc90aebebb0b2f76c9fac3ed7400d", "committedDate": "2020-05-04T23:23:59Z", "message": "Simplify implementation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4586, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}