{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NzQ3MDk5", "number": 1361, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxOTowNDowN1rOD8_A_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxOTowNDowN1rOD8_A_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MjczNTk2OnYy", "diffSide": "RIGHT", "path": "samza-yarn/src/main/scala/org/apache/samza/job/yarn/ClientHelper.scala", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxOTowNDowOFrOGWQpRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxOToxMjoyOVrOGWQ3-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk5NDU2NQ==", "bodyText": "but application report does not change.. so how would toAppStatus return different values for the same applicationReport? i thought applicationReport does NOT change within the same invocation of isActiveAppliction.", "url": "https://github.com/apache/samza/pull/1361#discussion_r425994565", "createdAt": "2020-05-15T19:04:08Z", "author": {"login": "lakshmi-manasa-g"}, "path": "samza-yarn/src/main/scala/org/apache/samza/job/yarn/ClientHelper.scala", "diffHunk": "@@ -301,8 +301,8 @@ class ClientHelper(conf: Configuration) extends Logging {\n   }\n \n   private def isActiveApplication(applicationReport: ApplicationReport): Boolean = {\n-    (Running.equals(toAppStatus(applicationReport).get)\n-    || New.equals(toAppStatus(applicationReport).get))\n+    val status = toAppStatus(applicationReport).get", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9454648812908553ccd483fcba4a4fd6e2f19c4"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk5NzI0NA==", "bodyText": "You are right applicationReport does not change, however, there is another check in ClientHelper#allContainersRunning to check metrics against AM on \"needed-containers\"\nif needed-container is non zero, the status will be be NEW\nonly when needed-containers is zero, the status will be returned as RUNNING.\nSee\ndef allContainersRunning(applicationReport: ApplicationReport): Boolean = {\n    val amClient: ApplicationMasterRestClient = createAmClient(applicationReport)\n\n    debug(\"Created client: \" + amClient.toString)\n\n    try {\n      val metrics = amClient.getMetrics\n      debug(\"Got metrics: \" + metrics.toString)\n\n      val neededContainers = Integer.parseInt(\n        metrics.get(classOf[SamzaAppMasterMetrics].getCanonicalName)\n          .get(\"needed-containers\")\n          .toString)\n\n      info(\"Needed containers: \" + neededContainers)\n      if (neededContainers == 0) {\n        true\n      } else {\n        false\n      }\n\nand\nClientHelper#toAppStatus\ncase (YarnApplicationState.RUNNING, _) =>\n        if (allContainersRunning(applicationReport)) {\n          Some(Running)\n        } else {\n          Some(New)\n        }", "url": "https://github.com/apache/samza/pull/1361#discussion_r425997244", "createdAt": "2020-05-15T19:10:05Z", "author": {"login": "kw2542"}, "path": "samza-yarn/src/main/scala/org/apache/samza/job/yarn/ClientHelper.scala", "diffHunk": "@@ -301,8 +301,8 @@ class ClientHelper(conf: Configuration) extends Logging {\n   }\n \n   private def isActiveApplication(applicationReport: ApplicationReport): Boolean = {\n-    (Running.equals(toAppStatus(applicationReport).get)\n-    || New.equals(toAppStatus(applicationReport).get))\n+    val status = toAppStatus(applicationReport).get", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk5NDU2NQ=="}, "originalCommit": {"oid": "f9454648812908553ccd483fcba4a4fd6e2f19c4"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk5ODMyOA==", "bodyText": "thanks for clarifying. makes sense", "url": "https://github.com/apache/samza/pull/1361#discussion_r425998328", "createdAt": "2020-05-15T19:12:29Z", "author": {"login": "lakshmi-manasa-g"}, "path": "samza-yarn/src/main/scala/org/apache/samza/job/yarn/ClientHelper.scala", "diffHunk": "@@ -301,8 +301,8 @@ class ClientHelper(conf: Configuration) extends Logging {\n   }\n \n   private def isActiveApplication(applicationReport: ApplicationReport): Boolean = {\n-    (Running.equals(toAppStatus(applicationReport).get)\n-    || New.equals(toAppStatus(applicationReport).get))\n+    val status = toAppStatus(applicationReport).get", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk5NDU2NQ=="}, "originalCommit": {"oid": "f9454648812908553ccd483fcba4a4fd6e2f19c4"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1423, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}