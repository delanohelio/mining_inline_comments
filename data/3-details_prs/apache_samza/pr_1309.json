{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1ODgzOTY3", "number": 1309, "title": "SAMZA-2453: Update ClusterBasedJobCoordinator to support Beam jobs", "bodyText": "Design:\nhttps://cwiki.apache.org/confluence/display/SAMZA/SEP-23%3A+Simplify+Job+Runner\nChanges:\n\nInvoke app.main.class with app.main.args when present instead of invoking ClusterBasedJobCoordinator#run\n\nAPI Changes:\nN/A\nUpgrade Instructions:\nFor beam jobs, beam's main class and pipeline options need to passed with app.main.class and app.main.args configs.\nUsage Instructions:\nTake https://github.com/apache/samza-beam-examples as an example:\n\nrun-beam-yarn.sh#line 36 will be updated to\n\nexec $(dirname $0)/run-class.sh $1 --config app.main.class=$1 --config app.main.args=\"--runner=org.apache.beam.runners.samza.SamzaRunner --configOverride=\"$override\" \"${@:2}\"\"\nTests:\nUnit tests", "createdAt": "2020-03-10T00:51:13Z", "url": "https://github.com/apache/samza/pull/1309", "merged": true, "mergeCommit": {"oid": "e4eefe2a9b7d6559ee5ce236e5357d773c199816"}, "closed": true, "closedAt": "2020-03-10T20:20:39Z", "author": {"login": "kw2542"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcH5RzNgH2gAyMzg1ODgzOTY3OjRiNDAzNTgxZTYxNzU2YTA1NDUwOGQ5YzY3YjYxYWRjZGU1NTlhNWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMYbEuAFqTM3MjI5MTY0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4b403581e61756a054508d9c67b61adcde559a5c", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/4b403581e61756a054508d9c67b61adcde559a5c", "committedDate": "2020-02-25T21:47:35Z", "message": "SAMZA-2471: Simplify CommandLine\n\nDesign:\nhttps://cwiki.apache.org/confluence/display/SAMZA/SEP-23%3A+Simplify+Job+Runner\n\nChanges:\n1. Simplify CommandLine by removing unnecessary arguments.\n\nAPI Changes:\n1. config-loader-factory removed in CommandLine\n2. config-loader-properties removed in CommandLine\n\nUpgrade Instruction:\n1. Usage of --config-factory and --config-loader-factory will be switched to --config job.config.loader.factory\n2. Usage of --config-path and --config-loader-properties will be switched to --config job.config.loader.properties\n\nUsage Instruction\n\n--config-factory=org.apache.samza.config.factories.PropertiesConfigFactory --config-path=file:///location/file.txt\nand\n--config-loader-factory=org.apache.samza.config.loaders.PropertiesConfigLoaderFactory --config-loader-properties path=file:///location/file.txt\nwill be updated to\n--config job.config.loader.factory=org.apache.samza.config.loaders.PropertiesConfigLoaderFactory --config job.config.loader.properties.path=file:///location/file.txt\n\nTests\n\n1. Unit tests\n2. Test against Hello Samza example with\ndeploy/samza/bin/run-app.sh --config job.config.loader.factory=org.apache.samza.config.loaders.PropertiesConfigLoaderFactory --config job.loader.properties.path=$PWD/deploy/samza/config/wikipedia-feed.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd045f19dd8745fb3c6839f3183df4e088ad3676", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/dd045f19dd8745fb3c6839f3183df4e088ad3676", "committedDate": "2020-02-25T22:33:20Z", "message": "Update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb11970ec6ca12c6ee1605a6e9bc91b378bf777f", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/fb11970ec6ca12c6ee1605a6e9bc91b378bf777f", "committedDate": "2020-02-25T22:34:00Z", "message": "Update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "278b70651e8f53a8dde6eba7f394e5ccc8dc8dae", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/278b70651e8f53a8dde6eba7f394e5ccc8dc8dae", "committedDate": "2020-02-25T22:47:01Z", "message": "Update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84d9fd57873adee773ac9e14f887760c5fe2bfee", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/84d9fd57873adee773ac9e14f887760c5fe2bfee", "committedDate": "2020-02-26T00:18:12Z", "message": "Update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d11af1583789b4aa1634ec0ab1725b82ec48430", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/3d11af1583789b4aa1634ec0ab1725b82ec48430", "committedDate": "2020-02-26T17:47:44Z", "message": "Update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c304241fc2c07fd8c5686ba597545ee8576e4d1b", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/c304241fc2c07fd8c5686ba597545ee8576e4d1b", "committedDate": "2020-02-26T18:41:40Z", "message": "Dummy Commit to trigger tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be4b6199a738042dfef0eb0953f9a74a39e5d5de", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/be4b6199a738042dfef0eb0953f9a74a39e5d5de", "committedDate": "2020-02-26T19:31:36Z", "message": "Trigger test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa1deb7891dfadbeace40dcb482249c3f4162b4e", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/fa1deb7891dfadbeace40dcb482249c3f4162b4e", "committedDate": "2020-02-26T21:32:27Z", "message": "Merge branch 'master' of https://github.com/apache/samza"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c95ea9a2e649af4a78d1d7bb65b8738431fab337", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/c95ea9a2e649af4a78d1d7bb65b8738431fab337", "committedDate": "2020-03-02T18:20:03Z", "message": "Merge branch 'master' of https://github.com/apache/samza"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13e37eded0f77a9d86aab10bf0cb402fc1f73c62", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/13e37eded0f77a9d86aab10bf0cb402fc1f73c62", "committedDate": "2020-03-02T22:01:08Z", "message": "Merge branch 'master' of https://github.com/apache/samza"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b66905a691963723ba0556c561cb1d06fb5ea55b", "author": {"user": {"login": "kw2542", "name": "Ke Wu"}}, "url": "https://github.com/apache/samza/commit/b66905a691963723ba0556c561cb1d06fb5ea55b", "committedDate": "2020-03-05T23:43:33Z", "message": "Merge branch 'master' of https://github.com/apache/samza"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34367093eb3438cba445a9c6769fbf2749187282", "author": {"user": {"login": "kw2542", "name": "Ke Wu"}}, "url": "https://github.com/apache/samza/commit/34367093eb3438cba445a9c6769fbf2749187282", "committedDate": "2020-03-09T21:53:25Z", "message": "SAMZA-2482: Add app.main.class and app.main.args in ApplicationConfig\n\nDesign:\nhttps://cwiki.apache.org/confluence/display/SAMZA/SEP-23%3A+Simplify+Job+Runner\n\nChanges:\n1. Add app.main.class to ApplicationConfig\n2. Add app.main.args to ApplicationConfig\n\nAPI Changes:\n\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\nUpgrade Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\nUsage Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nTests:\nN/A."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db4ce1115b2151b661e2673b0f3384504fb81bb9", "author": {"user": {"login": "kw2542", "name": "Ke Wu"}}, "url": "https://github.com/apache/samza/commit/db4ce1115b2151b661e2673b0f3384504fb81bb9", "committedDate": "2020-03-10T00:28:25Z", "message": "Merge branch 'master' of https://github.com/apache/samza"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b3cb4f1dbc6c158742806878386fdc62a1b8213", "author": {"user": {"login": "kw2542", "name": "Ke Wu"}}, "url": "https://github.com/apache/samza/commit/3b3cb4f1dbc6c158742806878386fdc62a1b8213", "committedDate": "2020-03-10T00:30:10Z", "message": "SAMZA-2453: Update ClusterBasedJobCoordinator to support Beam jobs\n\nDesign:\nhttps://cwiki.apache.org/confluence/display/SAMZA/SEP-23%3A+Simplify+Job+Runner\n\nChanges:\n\n1. Invoke app.main.class with app.main.args when present instead of invoking ClusterBasedJobCoordinator#run\n\nAPI Changes:\n\nN/A\n\nUpgrade Instructions:\n\nFor beam jobs, beam's main class and pipeline options need to passed with app.main.class and app.main.args configs.\n\nUsage Instructions:\n\nTake https://github.com/apache/samza-beam-examples as an example:\n\n1. run-beam-yarn.sh#line 36 will be updated to\n\nexec $(dirname $0)/run-class.sh $1 --config app.main.class=$1 --config app.main.args=\"--runner=org.apache.beam.runners.samza.SamzaRunner --configOverride=\\\"$override\\\" \\\"${@:2}\\\"\"\n\nTests:\nN/A."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMTI1NjY0", "url": "https://github.com/apache/samza/pull/1309#pullrequestreview-372125664", "createdAt": "2020-03-10T16:36:15Z", "commit": {"oid": "3b3cb4f1dbc6c158742806878386fdc62a1b8213"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNjozNjoxNVrOF0XPzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNjozNjo0NFrOF0XRMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ1MTE0OQ==", "bodyText": "Please add some comments about the use cases here for Beam. what's the expected main/args being passed in and what are we going to do with them.", "url": "https://github.com/apache/samza/pull/1309#discussion_r390451149", "createdAt": "2020-03-10T16:36:15Z", "author": {"login": "xinyuiscool"}, "path": "samza-core/src/main/java/org/apache/samza/clustermanager/ClusterBasedJobCoordinator.java", "diffHunk": "@@ -551,8 +553,23 @@ private static void runClusterBasedJobCoordinator(String[] args) {\n         throw new SamzaException(e);\n       }\n \n-      ClusterBasedJobCoordinator jc = createFromConfigLoader(submissionConfig);\n-      jc.run();\n+      ApplicationConfig appConfig = new ApplicationConfig(submissionConfig);\n+\n+      if (appConfig.getAppMainClass().isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b3cb4f1dbc6c158742806878386fdc62a1b8213"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ1MTUwNQ==", "bodyText": "is there else part being used right now?", "url": "https://github.com/apache/samza/pull/1309#discussion_r390451505", "createdAt": "2020-03-10T16:36:44Z", "author": {"login": "xinyuiscool"}, "path": "samza-core/src/main/java/org/apache/samza/clustermanager/ClusterBasedJobCoordinator.java", "diffHunk": "@@ -634,4 +651,20 @@ static ClusterBasedJobCoordinator createFromConfigLoader(Config submissionConfig\n         metadataStore,\n         config);\n   }\n+\n+  @VisibleForTesting\n+  static String[] toArgs(ApplicationConfig config) {\n+    List<String> args = new ArrayList<>(config.size() * 2);\n+\n+    config.forEach((key, value) -> {\n+      if (key.equals(ApplicationConfig.APP_MAIN_ARGS)) {\n+        args.addAll(Arrays.asList(value.split(\"\\\\s\")));\n+      } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b3cb4f1dbc6c158742806878386fdc62a1b8213"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd3380abccbbf055c02fd056cb360bff7e9e7b03", "author": {"user": {"login": "kw2542", "name": "Ke Wu"}}, "url": "https://github.com/apache/samza/commit/bd3380abccbbf055c02fd056cb360bff7e9e7b03", "committedDate": "2020-03-10T17:01:07Z", "message": "Add comments to clarify the new flow."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c52501c6e73ce8047a5e4e79187f0f072c26e2d", "author": {"user": {"login": "kw2542", "name": "Ke Wu"}}, "url": "https://github.com/apache/samza/commit/8c52501c6e73ce8047a5e4e79187f0f072c26e2d", "committedDate": "2020-03-10T17:02:35Z", "message": "Add more comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMjkxNjQw", "url": "https://github.com/apache/samza/pull/1309#pullrequestreview-372291640", "createdAt": "2020-03-10T20:20:28Z", "commit": {"oid": "8c52501c6e73ce8047a5e4e79187f0f072c26e2d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4814, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}