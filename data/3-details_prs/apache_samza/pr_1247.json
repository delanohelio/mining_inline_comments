{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNTc5MzM5", "number": 1247, "title": "SAMZA-2408: Update RemoteApplicationRunner to submit job only", "bodyText": "Design:\nhttps://cwiki.apache.org/confluence/display/SAMZA/SEP-23%3A+Simplify+Job+Runner\nChanges:\n\nDepending on the existence of job.config.loader.factory, RemoteApplicationRunner will alternatively only submit the job, without planning.\nLate initialize RemoteJobPlanner only when needed to avoid executing user code in submitting only mode.\n\nAPI Changes:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\nUpgrade Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\nUsage Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\nTests:\nEnd to end tested with Hello Samza job.", "createdAt": "2020-01-10T18:55:38Z", "url": "https://github.com/apache/samza/pull/1247", "merged": true, "mergeCommit": {"oid": "d28a1df62eccc3e3dda11093b69b6220b889c0ba"}, "closed": true, "closedAt": "2020-01-17T22:03:44Z", "author": {"login": "kw2542"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5DM3lgH2gAyMzYxNTc5MzM5OjE2YzBkNzRiOTQzMzIwN2IyYjU5Y2Y1MzA2NGJkNDZkZWE3ODE2YmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7UdFmAFqTM0NDgxMzQ0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "16c0d74b9433207b2b59cf53064bd46dea7816bd", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/16c0d74b9433207b2b59cf53064bd46dea7816bd", "committedDate": "2020-01-10T18:52:23Z", "message": "SAMZA-2408: Update RemoteApplicationRunner to submit job only\n\nDesign:\nhttps://cwiki.apache.org/confluence/display/SAMZA/SEP-23%3A+Simplify+Job+Runner\n\nChanges:\n\n1. Depending on the existence of job.config.loader.factory, RemoteApplicationRunner will alternatively only submit the job, without planning.\n2. Late initialize RemoteJobPlanner only when needed to avoid executing user code in submitting only mode.\n\nAPI Changes:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nUpgrade Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nUsage Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nTests:\nN/A"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4105111a81a0921ccccf61598eba3589f7b23d60", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/4105111a81a0921ccccf61598eba3589f7b23d60", "committedDate": "2020-01-10T18:54:18Z", "message": "Use config instead of this.config"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMjMwMjM1", "url": "https://github.com/apache/samza/pull/1247#pullrequestreview-342230235", "createdAt": "2020-01-14T00:36:24Z", "commit": {"oid": "4105111a81a0921ccccf61598eba3589f7b23d60"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwMDozNjoyNFrOFdJE3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwMDozNjoyNFrOFdJE3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjEwMTcyNg==", "bodyText": "Would it be helpful to create a ticket for this cleanup work (for all changes related to the SEP) so we don't lose track of it?", "url": "https://github.com/apache/samza/pull/1247#discussion_r366101726", "createdAt": "2020-01-14T00:36:24Z", "author": {"login": "bkonold"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/RemoteApplicationRunner.java", "diffHunk": "@@ -57,13 +55,21 @@\n    * @param config configuration for the application\n    */\n   public RemoteApplicationRunner(SamzaApplication app, Config config) {\n-    this.appDesc = ApplicationDescriptorUtil.getAppDescriptor(app, config);\n-    this.planner = new RemoteJobPlanner(appDesc);\n+    this.app = app;\n+    this.config = config;\n   }\n \n   @Override\n   public void run(ExternalContext externalContext) {\n+    if (new JobConfig(config).getConfigLoaderFactory().isPresent()) {\n+      JobRunner runner = new JobRunner(config);\n+      runner.submit();\n+      return;\n+    }\n+\n+    // TODO: Clean this up once SAMZA-2405 is completed when legacy flow is removed.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4105111a81a0921ccccf61598eba3589f7b23d60"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f864b2f87dc3a364e5344340b6768de942fc9ea", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/4f864b2f87dc3a364e5344340b6768de942fc9ea", "committedDate": "2020-01-14T20:42:06Z", "message": "Add unit tests and clean up ticket"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyODk1ODkx", "url": "https://github.com/apache/samza/pull/1247#pullrequestreview-342895891", "createdAt": "2020-01-14T22:59:41Z", "commit": {"oid": "4f864b2f87dc3a364e5344340b6768de942fc9ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMjo1OTo0MVrOFdok7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQyMjo1OTo0MVrOFdok7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYxNzgzOQ==", "bodyText": "Hmm. I guess the code as-is isn't very unit test friendly. It would be nice to test the invocation of .submit vs .run on JobRunner depending on the presence of the ConfigLoaderFactory.\nMaybe we could factor out the JobRunner creation into its own method, and use a spy to stub out the return value of that method to be a mock JobRunner that we can verify? Disclaimer though, I'm not sure what the best practices are of using spies...", "url": "https://github.com/apache/samza/pull/1247#discussion_r366617839", "createdAt": "2020-01-14T22:59:41Z", "author": {"login": "bkonold"}, "path": "samza-core/src/test/java/org/apache/samza/runtime/TestRemoteApplicationRunner.java", "diffHunk": "@@ -75,9 +75,20 @@ public void testWaitForFinishTimesout() {\n     assertFalse(\"Application finished before the timeout.\", finished);\n   }\n \n+  @Test\n+  public void testRunWithConfigLoaderFactoryPresent() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f864b2f87dc3a364e5344340b6768de942fc9ea"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "077d4d22063bb6623c3f376a09a28613c3c60fa1", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/077d4d22063bb6623c3f376a09a28613c3c60fa1", "committedDate": "2020-01-15T00:39:12Z", "message": "Merge branch 'master' of https://github.com/apache/samza into SAMZA-2408"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyOTMwMjcx", "url": "https://github.com/apache/samza/pull/1247#pullrequestreview-342930271", "createdAt": "2020-01-15T00:43:21Z", "commit": {"oid": "4f864b2f87dc3a364e5344340b6768de942fc9ea"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNDI0ODQw", "url": "https://github.com/apache/samza/pull/1247#pullrequestreview-343424840", "createdAt": "2020-01-15T18:21:09Z", "commit": {"oid": "077d4d22063bb6623c3f376a09a28613c3c60fa1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxODoyMTowOVrOFeB5rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxODoyMTowOVrOFeB5rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzAzMjc0OQ==", "bodyText": "This is a question for kill, status, and waitForFinish:\nShould you be calling JobPlanner.generateSingleJobConfig even when config loader factory is specified? It seems like you would want to call JobRunner, similar to how you changed it for run.", "url": "https://github.com/apache/samza/pull/1247#discussion_r367032749", "createdAt": "2020-01-15T18:21:09Z", "author": {"login": "cameronlee314"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/RemoteApplicationRunner.java", "diffHunk": "@@ -85,7 +91,7 @@ public void kill() {\n     // since currently we only support single actual remote job, we can get its status without\n     // building the execution plan.\n     try {\n-      JobConfig jc = new JobConfig(JobPlanner.generateSingleJobConfig(appDesc.getConfig()));\n+      JobConfig jc = new JobConfig(JobPlanner.generateSingleJobConfig(config));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "077d4d22063bb6623c3f376a09a28613c3c60fa1"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba8ab367649bf94e977f55c4a331e6e7ff07cf8c", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/ba8ab367649bf94e977f55c4a331e6e7ff07cf8c", "committedDate": "2020-01-15T21:47:43Z", "message": "Use JobPlanner.generateSingleJobConfig to be consistent with kill, status and waitForFinish. This is also used in ExecutionPlanner as well before."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNTU2MDc0", "url": "https://github.com/apache/samza/pull/1247#pullrequestreview-343556074", "createdAt": "2020-01-15T22:09:41Z", "commit": {"oid": "ba8ab367649bf94e977f55c4a331e6e7ff07cf8c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0ODEzNDQ0", "url": "https://github.com/apache/samza/pull/1247#pullrequestreview-344813444", "createdAt": "2020-01-17T20:06:20Z", "commit": {"oid": "ba8ab367649bf94e977f55c4a331e6e7ff07cf8c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4744, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}