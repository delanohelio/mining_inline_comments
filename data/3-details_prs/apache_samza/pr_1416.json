{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3Njk3ODc0", "number": 1416, "title": "SAMZA-2581: Fix Samza Histogram update to update percentile Gauge values", "bodyText": "Symptom: Missing metrics. EventSystemConsumer consumer lag latency\nmetrics are missing.\nCause: Histogram update and percentile gauges are updated in two\ndifferent functions. Percentiles are internal to Samza histogram and\nhence should be updated internally as part of update.\nChanges: Histogram update also updates internal gauges.", "createdAt": "2020-08-14T00:05:49Z", "url": "https://github.com/apache/samza/pull/1416", "merged": true, "mergeCommit": {"oid": "216a87fe4c6fa8e0ed48ad7488e296a88d41376e"}, "closed": true, "closedAt": "2020-08-17T19:39:12Z", "author": {"login": "vishwajith-s"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-plzRgFqTQ2NzIzOTEyNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_3uShgFqTQ2ODc3OTgzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MjM5MTI3", "url": "https://github.com/apache/samza/pull/1416#pullrequestreview-467239127", "createdAt": "2020-08-14T00:33:18Z", "commit": {"oid": "4de45c65896ea44c567163399a43a7032feda8e5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMDozMzoxOVrOHAizKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMDozMzoxOVrOHAizKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMzMjIwMw==", "bodyText": "Looks like this line is unnecessary? The \"values\" variable is never being used.", "url": "https://github.com/apache/samza/pull/1416#discussion_r470332203", "createdAt": "2020-08-14T00:33:19Z", "author": {"login": "xiefan46"}, "path": "samza-api/src/main/java/org/apache/samza/metrics/SamzaHistogram.java", "diffHunk": "@@ -53,6 +53,8 @@ public SamzaHistogram(MetricsRegistry registry, String group, String name, List<\n \n   public void update(long value) {\n     histogram.update(value);\n+    Snapshot values = histogram.getSnapshot();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4de45c65896ea44c567163399a43a7032feda8e5"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4de45c65896ea44c567163399a43a7032feda8e5", "author": {"user": {"login": "vishwajith-s", "name": "Vishwajith Shivappa"}}, "url": "https://github.com/apache/samza/commit/4de45c65896ea44c567163399a43a7032feda8e5", "committedDate": "2020-08-13T23:53:16Z", "message": "SAMZA-2581: Fix Samza Histogram update to update percentile Gauge values\n\nSymptom: Missing metrics. EventSystemConsumer consumer lag latency\nmetrics are missing.\n\nCause: Histogram update and percentile gauges are updated in two\ndifferent functions. Percentiles are internal to Samza histogram and\nhence should be updated internally as part of update.\n\nChanges: Histogram update also updates internal gauges."}, "afterCommit": {"oid": "f4d5d982e84108e611949fa8df910952ac6c3304", "author": {"user": {"login": "vishwajith-s", "name": "Vishwajith Shivappa"}}, "url": "https://github.com/apache/samza/commit/f4d5d982e84108e611949fa8df910952ac6c3304", "committedDate": "2020-08-14T00:42:12Z", "message": "SAMZA-2581: Fix Samza Histogram update to update percentile Gauge values\n\nSymptom: Missing metrics. EventSystemConsumer consumer lag latency\nmetrics are missing.\n\nCause: Histogram update and percentile gauges are updated in two\ndifferent functions. Percentiles are internal to Samza histogram and\nhence should be updated internally as part of update.\n\nChanges: Histogram update also updates internal gauges."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MjQ0ODYz", "url": "https://github.com/apache/samza/pull/1416#pullrequestreview-467244863", "createdAt": "2020-08-14T00:55:07Z", "commit": {"oid": "f4d5d982e84108e611949fa8df910952ac6c3304"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMDo1NTowN1rOHAjqdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMDo1NTowN1rOHAjqdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM0NjM1Ng==", "bodyText": "Looks like the gauge value is already updated when it is reported (line 76 Gauge#visit). Why do we need to update them on every new datapoint?", "url": "https://github.com/apache/samza/pull/1416#discussion_r470346356", "createdAt": "2020-08-14T00:55:07Z", "author": {"login": "prateekm"}, "path": "samza-api/src/main/java/org/apache/samza/metrics/SamzaHistogram.java", "diffHunk": "@@ -53,6 +53,7 @@ public SamzaHistogram(MetricsRegistry registry, String group, String name, List<\n \n   public void update(long value) {\n     histogram.update(value);\n+    percentiles.forEach(x -> updateGaugeValues(x));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4d5d982e84108e611949fa8df910952ac6c3304"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f4d5d982e84108e611949fa8df910952ac6c3304", "author": {"user": {"login": "vishwajith-s", "name": "Vishwajith Shivappa"}}, "url": "https://github.com/apache/samza/commit/f4d5d982e84108e611949fa8df910952ac6c3304", "committedDate": "2020-08-14T00:42:12Z", "message": "SAMZA-2581: Fix Samza Histogram update to update percentile Gauge values\n\nSymptom: Missing metrics. EventSystemConsumer consumer lag latency\nmetrics are missing.\n\nCause: Histogram update and percentile gauges are updated in two\ndifferent functions. Percentiles are internal to Samza histogram and\nhence should be updated internally as part of update.\n\nChanges: Histogram update also updates internal gauges."}, "afterCommit": {"oid": "5fa559e01db7c116f73ee2e428e2a8aaf6d61756", "author": {"user": {"login": "vishwajith-s", "name": "Vishwajith Shivappa"}}, "url": "https://github.com/apache/samza/commit/5fa559e01db7c116f73ee2e428e2a8aaf6d61756", "committedDate": "2020-08-17T15:30:07Z", "message": "SAMZA-2581: Fix Samza Histogram update to update percentile Gauge values\n\nSymptom: Missing metrics. EventSystemConsumer consumer lag latency\nmetrics are missing.\n\nCause: Histogram update and percentile gauges are updated in two\ndifferent functions. Percentiles are internal to Samza histogram and\nhence should be updated internally as part of update.\n\nChanges: Histogram update also updates internal gauges."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5fa559e01db7c116f73ee2e428e2a8aaf6d61756", "author": {"user": {"login": "vishwajith-s", "name": "Vishwajith Shivappa"}}, "url": "https://github.com/apache/samza/commit/5fa559e01db7c116f73ee2e428e2a8aaf6d61756", "committedDate": "2020-08-17T15:30:07Z", "message": "SAMZA-2581: Fix Samza Histogram update to update percentile Gauge values\n\nSymptom: Missing metrics. EventSystemConsumer consumer lag latency\nmetrics are missing.\n\nCause: Histogram update and percentile gauges are updated in two\ndifferent functions. Percentiles are internal to Samza histogram and\nhence should be updated internally as part of update.\n\nChanges: Histogram update also updates internal gauges."}, "afterCommit": {"oid": "012e404226baf5c6099ff109e9cef886dc7cc019", "author": {"user": {"login": "vishwajith-s", "name": "Vishwajith Shivappa"}}, "url": "https://github.com/apache/samza/commit/012e404226baf5c6099ff109e9cef886dc7cc019", "committedDate": "2020-08-17T18:15:45Z", "message": "SAMZA-2581: Fix Samza Histogram update to update percentile Gauge values\n\nSymptom: Missing metrics. EventSystemConsumer consumer lag latency\nmetrics are missing.\n\nCause: Histogram update and percentile gauges are updated in two\ndifferent functions. Percentiles are internal to Samza histogram and\nhence should be updated internally as part of update.\n\nChanges: Histogram update also updates internal gauges."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NzQ0MDM5", "url": "https://github.com/apache/samza/pull/1416#pullrequestreview-468744039", "createdAt": "2020-08-17T18:41:21Z", "commit": {"oid": "012e404226baf5c6099ff109e9cef886dc7cc019"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODo0MToyMVrOHB2ZFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODo0MToyMVrOHB2ZFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTcwMTc4MA==", "bodyText": "Should this be removed from here if this is already being updated in getValue?", "url": "https://github.com/apache/samza/pull/1416#discussion_r471701780", "createdAt": "2020-08-17T18:41:21Z", "author": {"login": "prateekm"}, "path": "samza-api/src/main/java/org/apache/samza/metrics/SamzaHistogram.java", "diffHunk": "@@ -75,5 +75,15 @@ public void visit(MetricsVisitor visitor) {\n       updateGaugeValues(percentile);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "012e404226baf5c6099ff109e9cef886dc7cc019"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f735773e681933f9ee657eccf4db3fdb2f77b084", "author": {"user": {"login": "vishwajith-s", "name": "Vishwajith Shivappa"}}, "url": "https://github.com/apache/samza/commit/f735773e681933f9ee657eccf4db3fdb2f77b084", "committedDate": "2020-08-17T19:08:18Z", "message": "SAMZA-2581: Fix Samza Histogram update to update percentile Gauge values\n\nSymptom: Missing metrics. EventSystemConsumer consumer lag latency\nmetrics are missing.\n\nCause: Histogram update and percentile gauges are updated in two\ndifferent functions. Percentiles are internal to Samza histogram and\nhence should be updated internally as part of update.\n\nChanges: Histogram update also updates internal gauges."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "012e404226baf5c6099ff109e9cef886dc7cc019", "author": {"user": {"login": "vishwajith-s", "name": "Vishwajith Shivappa"}}, "url": "https://github.com/apache/samza/commit/012e404226baf5c6099ff109e9cef886dc7cc019", "committedDate": "2020-08-17T18:15:45Z", "message": "SAMZA-2581: Fix Samza Histogram update to update percentile Gauge values\n\nSymptom: Missing metrics. EventSystemConsumer consumer lag latency\nmetrics are missing.\n\nCause: Histogram update and percentile gauges are updated in two\ndifferent functions. Percentiles are internal to Samza histogram and\nhence should be updated internally as part of update.\n\nChanges: Histogram update also updates internal gauges."}, "afterCommit": {"oid": "f735773e681933f9ee657eccf4db3fdb2f77b084", "author": {"user": {"login": "vishwajith-s", "name": "Vishwajith Shivappa"}}, "url": "https://github.com/apache/samza/commit/f735773e681933f9ee657eccf4db3fdb2f77b084", "committedDate": "2020-08-17T19:08:18Z", "message": "SAMZA-2581: Fix Samza Histogram update to update percentile Gauge values\n\nSymptom: Missing metrics. EventSystemConsumer consumer lag latency\nmetrics are missing.\n\nCause: Histogram update and percentile gauges are updated in two\ndifferent functions. Percentiles are internal to Samza histogram and\nhence should be updated internally as part of update.\n\nChanges: Histogram update also updates internal gauges."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4Nzc5ODM0", "url": "https://github.com/apache/samza/pull/1416#pullrequestreview-468779834", "createdAt": "2020-08-17T19:38:39Z", "commit": {"oid": "f735773e681933f9ee657eccf4db3fdb2f77b084"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4688, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}