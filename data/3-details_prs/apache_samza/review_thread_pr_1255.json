{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0MzYzMDIz", "number": 1255, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwMDo0OTozMlrODbEoTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQyMDoxNjo1NVrODbW5rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzEzOTk3OnYy", "diffSide": "RIGHT", "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwMDo0OTozMlrOFiWXQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwMTo1NjoyNlrOFiXTDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2MjMwNA==", "bodyText": "In the old flow, getCoordinationUtils seemed to be called with the full config. In the new flow, getCoordinationUtils will get called with the initial config, not the full config. Do you need to load the config before calling getCoordinationUtils?", "url": "https://github.com/apache/samza/pull/1255#discussion_r371562304", "createdAt": "2020-01-28T00:49:32Z", "author": {"login": "cameronlee314"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,27 +112,35 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20cd9489454a8fe06cb55770a2d0992862b97cc0"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU3NzYxMw==", "bodyText": "Very good question, and nice catch. You are right, both getCoordinationUtils as well as getDefaultCoordinatorStreamStoreFactory need to be updated to load full config first if applicable.", "url": "https://github.com/apache/samza/pull/1255#discussion_r371577613", "createdAt": "2020-01-28T01:56:26Z", "author": {"login": "kw2542"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,27 +112,35 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2MjMwNA=="}, "originalCommit": {"oid": "20cd9489454a8fe06cb55770a2d0992862b97cc0"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzE0MDk1OnYy", "diffSide": "RIGHT", "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwMDo1MDowOFrOFiWX4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwMTo1Njo0MVrOFiXTlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2MjQ2NA==", "bodyText": "I guess this constructor is just for testing, but it does have a similar change as above where config is now just the initial config, but before it was the full config.", "url": "https://github.com/apache/samza/pull/1255#discussion_r371562464", "createdAt": "2020-01-28T00:50:08Z", "author": {"login": "cameronlee314"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,27 +112,35 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);\n   }\n \n   /**\n    * Constructor only used in unit test to allow injection of {@link LocalJobPlanner}\n    */\n   @VisibleForTesting\n-  LocalApplicationRunner(ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc, Optional<CoordinationUtils> coordinationUtils) {\n-    this(appDesc, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(appDesc.getConfig())));\n+  LocalApplicationRunner(SamzaApplication app, Config config, Optional<CoordinationUtils> coordinationUtils) {\n+    this(app, config, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(config)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20cd9489454a8fe06cb55770a2d0992862b97cc0"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU3Nzc0OQ==", "bodyText": "Updated.", "url": "https://github.com/apache/samza/pull/1255#discussion_r371577749", "createdAt": "2020-01-28T01:56:41Z", "author": {"login": "kw2542"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,27 +112,35 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);\n   }\n \n   /**\n    * Constructor only used in unit test to allow injection of {@link LocalJobPlanner}\n    */\n   @VisibleForTesting\n-  LocalApplicationRunner(ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc, Optional<CoordinationUtils> coordinationUtils) {\n-    this(appDesc, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(appDesc.getConfig())));\n+  LocalApplicationRunner(SamzaApplication app, Config config, Optional<CoordinationUtils> coordinationUtils) {\n+    this(app, config, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(config)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2MjQ2NA=="}, "originalCommit": {"oid": "20cd9489454a8fe06cb55770a2d0992862b97cc0"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NzE0NDc1OnYy", "diffSide": "RIGHT", "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQwMDo1MjoyMVrOFiWaIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQyMzo1Nzo0MFrOFi4uag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2MzA0MA==", "bodyText": "Is this considered a semantic API change? Before, it seems like config was always the full config, but now you are allowing the initial config with only config loader properties.\nIt's ok to have this be an API change, but just wanted to make sure you note that where necessary.", "url": "https://github.com/apache/samza/pull/1255#discussion_r371563040", "createdAt": "2020-01-28T00:52:21Z", "author": {"login": "cameronlee314"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,27 +112,35 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);\n   }\n \n   /**\n    * Constructor only used in unit test to allow injection of {@link LocalJobPlanner}\n    */\n   @VisibleForTesting\n-  LocalApplicationRunner(ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc, Optional<CoordinationUtils> coordinationUtils) {\n-    this(appDesc, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(appDesc.getConfig())));\n+  LocalApplicationRunner(SamzaApplication app, Config config, Optional<CoordinationUtils> coordinationUtils) {\n+    this(app, config, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(config)));\n   }\n \n   private LocalApplicationRunner(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20cd9489454a8fe06cb55770a2d0992862b97cc0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU3ODM0Ng==", "bodyText": "Good question, I would consider changes in samza-api module to be public facing API changes, and changes in samza-core to be internal API changes, which can be less risky.\nI will update the PR description to explicitly call out the constructor changes, also this is a backward compatible API change.", "url": "https://github.com/apache/samza/pull/1255#discussion_r371578346", "createdAt": "2020-01-28T01:59:34Z", "author": {"login": "kw2542"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,27 +112,35 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);\n   }\n \n   /**\n    * Constructor only used in unit test to allow injection of {@link LocalJobPlanner}\n    */\n   @VisibleForTesting\n-  LocalApplicationRunner(ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc, Optional<CoordinationUtils> coordinationUtils) {\n-    this(appDesc, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(appDesc.getConfig())));\n+  LocalApplicationRunner(SamzaApplication app, Config config, Optional<CoordinationUtils> coordinationUtils) {\n+    this(app, config, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(config)));\n   }\n \n   private LocalApplicationRunner(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2MzA0MA=="}, "originalCommit": {"oid": "20cd9489454a8fe06cb55770a2d0992862b97cc0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU4NDA3Mg==", "bodyText": "LocalApplicationRunner is kind of in that middle layer: it's not in samza-api and not quite a direct API, but it also can get used by users running standalone and it can be specified in configs as the \"app.runner.class\".", "url": "https://github.com/apache/samza/pull/1255#discussion_r371584072", "createdAt": "2020-01-28T02:29:03Z", "author": {"login": "cameronlee314"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,27 +112,35 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);\n   }\n \n   /**\n    * Constructor only used in unit test to allow injection of {@link LocalJobPlanner}\n    */\n   @VisibleForTesting\n-  LocalApplicationRunner(ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc, Optional<CoordinationUtils> coordinationUtils) {\n-    this(appDesc, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(appDesc.getConfig())));\n+  LocalApplicationRunner(SamzaApplication app, Config config, Optional<CoordinationUtils> coordinationUtils) {\n+    this(app, config, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(config)));\n   }\n \n   private LocalApplicationRunner(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2MzA0MA=="}, "originalCommit": {"oid": "20cd9489454a8fe06cb55770a2d0992862b97cc0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU4NDE5Ng==", "bodyText": "In my opinion, LocalApplicationRunner doesn't truly belong in samza-core, but it had to be somewhere...", "url": "https://github.com/apache/samza/pull/1255#discussion_r371584196", "createdAt": "2020-01-28T02:29:43Z", "author": {"login": "cameronlee314"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,27 +112,35 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);\n   }\n \n   /**\n    * Constructor only used in unit test to allow injection of {@link LocalJobPlanner}\n    */\n   @VisibleForTesting\n-  LocalApplicationRunner(ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc, Optional<CoordinationUtils> coordinationUtils) {\n-    this(appDesc, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(appDesc.getConfig())));\n+  LocalApplicationRunner(SamzaApplication app, Config config, Optional<CoordinationUtils> coordinationUtils) {\n+    this(app, config, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(config)));\n   }\n \n   private LocalApplicationRunner(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2MzA0MA=="}, "originalCommit": {"oid": "20cd9489454a8fe06cb55770a2d0992862b97cc0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk5MDc1OQ==", "bodyText": "Got you, in addition to note this change in PR's description, anywhere else we should notify this change?", "url": "https://github.com/apache/samza/pull/1255#discussion_r371990759", "createdAt": "2020-01-28T18:51:00Z", "author": {"login": "kw2542"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,27 +112,35 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);\n   }\n \n   /**\n    * Constructor only used in unit test to allow injection of {@link LocalJobPlanner}\n    */\n   @VisibleForTesting\n-  LocalApplicationRunner(ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc, Optional<CoordinationUtils> coordinationUtils) {\n-    this(appDesc, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(appDesc.getConfig())));\n+  LocalApplicationRunner(SamzaApplication app, Config config, Optional<CoordinationUtils> coordinationUtils) {\n+    this(app, config, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(config)));\n   }\n \n   private LocalApplicationRunner(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2MzA0MA=="}, "originalCommit": {"oid": "20cd9489454a8fe06cb55770a2d0992862b97cc0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjAzMTU2Nw==", "bodyText": "Someone will need to remember to add this as a release note, and if we have information in the user guide about this flow, then that will need to be updated.", "url": "https://github.com/apache/samza/pull/1255#discussion_r372031567", "createdAt": "2020-01-28T20:13:15Z", "author": {"login": "cameronlee314"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,27 +112,35 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);\n   }\n \n   /**\n    * Constructor only used in unit test to allow injection of {@link LocalJobPlanner}\n    */\n   @VisibleForTesting\n-  LocalApplicationRunner(ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc, Optional<CoordinationUtils> coordinationUtils) {\n-    this(appDesc, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(appDesc.getConfig())));\n+  LocalApplicationRunner(SamzaApplication app, Config config, Optional<CoordinationUtils> coordinationUtils) {\n+    this(app, config, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(config)));\n   }\n \n   private LocalApplicationRunner(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2MzA0MA=="}, "originalCommit": {"oid": "20cd9489454a8fe06cb55770a2d0992862b97cc0"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEyNTI5MA==", "bodyText": "I will make sure this to be added in the OSS release when it is out and I will go through our user guide to see if we have any thing about this flow.", "url": "https://github.com/apache/samza/pull/1255#discussion_r372125290", "createdAt": "2020-01-28T23:57:40Z", "author": {"login": "kw2542"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,27 +112,35 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);\n   }\n \n   /**\n    * Constructor only used in unit test to allow injection of {@link LocalJobPlanner}\n    */\n   @VisibleForTesting\n-  LocalApplicationRunner(ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc, Optional<CoordinationUtils> coordinationUtils) {\n-    this(appDesc, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(appDesc.getConfig())));\n+  LocalApplicationRunner(SamzaApplication app, Config config, Optional<CoordinationUtils> coordinationUtils) {\n+    this(app, config, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(config)));\n   }\n \n   private LocalApplicationRunner(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2MzA0MA=="}, "originalCommit": {"oid": "20cd9489454a8fe06cb55770a2d0992862b97cc0"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMDEzMjY3OnYy", "diffSide": "RIGHT", "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQyMDoxNjo0MVrOFizGUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwMDo1Mjo0NVrOFi5lvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjAzMzEwNw==", "bodyText": "Should we avoid multiple calls to ConfigUtil.loadConfig? You already call it in getApplicationDescriptor.\nIf the config loader logic is complex/heavy (e.g. makes remote calls), then that is going to result in inefficient calls.", "url": "https://github.com/apache/samza/pull/1255#discussion_r372033107", "createdAt": "2020-01-28T20:16:41Z", "author": {"login": "cameronlee314"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,29 +112,41 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);\n   }\n \n   /**\n    * Constructor only used in unit test to allow injection of {@link LocalJobPlanner}\n    */\n   @VisibleForTesting\n-  LocalApplicationRunner(ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc, Optional<CoordinationUtils> coordinationUtils) {\n-    this(appDesc, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(appDesc.getConfig())));\n+  LocalApplicationRunner(SamzaApplication app, Config config, Optional<CoordinationUtils> coordinationUtils) {\n+    this(app, config, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(config)));\n   }\n \n   private LocalApplicationRunner(\n-      ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc,\n+      SamzaApplication app,\n+      Config config,\n       Optional<CoordinationUtils> coordinationUtils,\n       MetadataStoreFactory metadataStoreFactory) {\n-    this.appDesc = appDesc;\n+    this.appDesc = getApplicationDescriptor(app, config);\n     this.isAppModeBatch = isAppModeBatch(appDesc.getConfig());\n     this.coordinationUtils = coordinationUtils;\n     this.metadataStoreFactory = Optional.ofNullable(metadataStoreFactory);\n   }\n \n+  @VisibleForTesting\n+  static ApplicationDescriptorImpl<? extends ApplicationDescriptor> getApplicationDescriptor(SamzaApplication app, Config config) {\n+    return new JobConfig(config).getConfigLoaderFactory().isPresent()\n+        ? ApplicationDescriptorUtil.getAppDescriptor(app, ConfigUtil.loadConfig(config))\n+        : ApplicationDescriptorUtil.getAppDescriptor(app, config);\n+  }\n+\n   @VisibleForTesting\n   static MetadataStoreFactory getDefaultCoordinatorStreamStoreFactory(JobConfig jobConfig) {\n+    if (jobConfig.getConfigLoaderFactory().isPresent()) {\n+      jobConfig = new JobConfig(ConfigUtil.loadConfig(jobConfig));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d62aa7de229de2f037a1369226e759d799b95d0c"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEyNDg4OQ==", "bodyText": "Ideally yes, in order to achieve this, each constructor needs to have some if checks, thus it cannot invoke another constructor anymore. This will return in all constructors follows its own logic instead of merging into a single private constructor. Do you think this is a good trade off?", "url": "https://github.com/apache/samza/pull/1255#discussion_r372124889", "createdAt": "2020-01-28T23:56:04Z", "author": {"login": "kw2542"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,29 +112,41 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);\n   }\n \n   /**\n    * Constructor only used in unit test to allow injection of {@link LocalJobPlanner}\n    */\n   @VisibleForTesting\n-  LocalApplicationRunner(ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc, Optional<CoordinationUtils> coordinationUtils) {\n-    this(appDesc, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(appDesc.getConfig())));\n+  LocalApplicationRunner(SamzaApplication app, Config config, Optional<CoordinationUtils> coordinationUtils) {\n+    this(app, config, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(config)));\n   }\n \n   private LocalApplicationRunner(\n-      ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc,\n+      SamzaApplication app,\n+      Config config,\n       Optional<CoordinationUtils> coordinationUtils,\n       MetadataStoreFactory metadataStoreFactory) {\n-    this.appDesc = appDesc;\n+    this.appDesc = getApplicationDescriptor(app, config);\n     this.isAppModeBatch = isAppModeBatch(appDesc.getConfig());\n     this.coordinationUtils = coordinationUtils;\n     this.metadataStoreFactory = Optional.ofNullable(metadataStoreFactory);\n   }\n \n+  @VisibleForTesting\n+  static ApplicationDescriptorImpl<? extends ApplicationDescriptor> getApplicationDescriptor(SamzaApplication app, Config config) {\n+    return new JobConfig(config).getConfigLoaderFactory().isPresent()\n+        ? ApplicationDescriptorUtil.getAppDescriptor(app, ConfigUtil.loadConfig(config))\n+        : ApplicationDescriptorUtil.getAppDescriptor(app, config);\n+  }\n+\n   @VisibleForTesting\n   static MetadataStoreFactory getDefaultCoordinatorStreamStoreFactory(JobConfig jobConfig) {\n+    if (jobConfig.getConfigLoaderFactory().isPresent()) {\n+      jobConfig = new JobConfig(ConfigUtil.loadConfig(jobConfig));\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjAzMzEwNw=="}, "originalCommit": {"oid": "d62aa7de229de2f037a1369226e759d799b95d0c"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEyOTI2Ng==", "bodyText": "I do think it is reasonable trade-off.\nOne of the challenges is that the LocalApplicationRunner(SamzaApplication app, Config config) constructor is overloaded semantically. In one case, config is already the full config, and in another case config is a partial config which needs to be loaded. And then it may seem like we can't use a single common constructor due to the need to use the full config in the constructor arguments. I do still think there is a way to share a common constructor: instead of passing individual arguments, create a LocalApplicationRunnerContext which contains all of the arguments, and then you can build that other object based on what is given to you.", "url": "https://github.com/apache/samza/pull/1255#discussion_r372129266", "createdAt": "2020-01-29T00:12:22Z", "author": {"login": "cameronlee314"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,29 +112,41 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);\n   }\n \n   /**\n    * Constructor only used in unit test to allow injection of {@link LocalJobPlanner}\n    */\n   @VisibleForTesting\n-  LocalApplicationRunner(ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc, Optional<CoordinationUtils> coordinationUtils) {\n-    this(appDesc, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(appDesc.getConfig())));\n+  LocalApplicationRunner(SamzaApplication app, Config config, Optional<CoordinationUtils> coordinationUtils) {\n+    this(app, config, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(config)));\n   }\n \n   private LocalApplicationRunner(\n-      ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc,\n+      SamzaApplication app,\n+      Config config,\n       Optional<CoordinationUtils> coordinationUtils,\n       MetadataStoreFactory metadataStoreFactory) {\n-    this.appDesc = appDesc;\n+    this.appDesc = getApplicationDescriptor(app, config);\n     this.isAppModeBatch = isAppModeBatch(appDesc.getConfig());\n     this.coordinationUtils = coordinationUtils;\n     this.metadataStoreFactory = Optional.ofNullable(metadataStoreFactory);\n   }\n \n+  @VisibleForTesting\n+  static ApplicationDescriptorImpl<? extends ApplicationDescriptor> getApplicationDescriptor(SamzaApplication app, Config config) {\n+    return new JobConfig(config).getConfigLoaderFactory().isPresent()\n+        ? ApplicationDescriptorUtil.getAppDescriptor(app, ConfigUtil.loadConfig(config))\n+        : ApplicationDescriptorUtil.getAppDescriptor(app, config);\n+  }\n+\n   @VisibleForTesting\n   static MetadataStoreFactory getDefaultCoordinatorStreamStoreFactory(JobConfig jobConfig) {\n+    if (jobConfig.getConfigLoaderFactory().isPresent()) {\n+      jobConfig = new JobConfig(ConfigUtil.loadConfig(jobConfig));\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjAzMzEwNw=="}, "originalCommit": {"oid": "d62aa7de229de2f037a1369226e759d799b95d0c"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEzOTQ1Mw==", "bodyText": "I like the idea of LocalApplicationRunnerContext, will update the PR.", "url": "https://github.com/apache/samza/pull/1255#discussion_r372139453", "createdAt": "2020-01-29T00:52:45Z", "author": {"login": "kw2542"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -111,29 +112,41 @@ public LocalApplicationRunner(SamzaApplication app, Config config) {\n    * @param metadataStoreFactory the instance of {@link MetadataStoreFactory} to read and write to coordinator stream.\n    */\n   public LocalApplicationRunner(SamzaApplication app, Config config, MetadataStoreFactory metadataStoreFactory) {\n-    this(ApplicationDescriptorUtil.getAppDescriptor(app, config), getCoordinationUtils(config), metadataStoreFactory);\n+    this(app, config, getCoordinationUtils(config), metadataStoreFactory);\n   }\n \n   /**\n    * Constructor only used in unit test to allow injection of {@link LocalJobPlanner}\n    */\n   @VisibleForTesting\n-  LocalApplicationRunner(ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc, Optional<CoordinationUtils> coordinationUtils) {\n-    this(appDesc, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(appDesc.getConfig())));\n+  LocalApplicationRunner(SamzaApplication app, Config config, Optional<CoordinationUtils> coordinationUtils) {\n+    this(app, config, coordinationUtils, getDefaultCoordinatorStreamStoreFactory(new JobConfig(config)));\n   }\n \n   private LocalApplicationRunner(\n-      ApplicationDescriptorImpl<? extends ApplicationDescriptor> appDesc,\n+      SamzaApplication app,\n+      Config config,\n       Optional<CoordinationUtils> coordinationUtils,\n       MetadataStoreFactory metadataStoreFactory) {\n-    this.appDesc = appDesc;\n+    this.appDesc = getApplicationDescriptor(app, config);\n     this.isAppModeBatch = isAppModeBatch(appDesc.getConfig());\n     this.coordinationUtils = coordinationUtils;\n     this.metadataStoreFactory = Optional.ofNullable(metadataStoreFactory);\n   }\n \n+  @VisibleForTesting\n+  static ApplicationDescriptorImpl<? extends ApplicationDescriptor> getApplicationDescriptor(SamzaApplication app, Config config) {\n+    return new JobConfig(config).getConfigLoaderFactory().isPresent()\n+        ? ApplicationDescriptorUtil.getAppDescriptor(app, ConfigUtil.loadConfig(config))\n+        : ApplicationDescriptorUtil.getAppDescriptor(app, config);\n+  }\n+\n   @VisibleForTesting\n   static MetadataStoreFactory getDefaultCoordinatorStreamStoreFactory(JobConfig jobConfig) {\n+    if (jobConfig.getConfigLoaderFactory().isPresent()) {\n+      jobConfig = new JobConfig(ConfigUtil.loadConfig(jobConfig));\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjAzMzEwNw=="}, "originalCommit": {"oid": "d62aa7de229de2f037a1369226e759d799b95d0c"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMDEzMzU4OnYy", "diffSide": "RIGHT", "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQyMDoxNjo1NVrOFizG1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwMTozMjoyMlrOFi6LtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjAzMzIzOA==", "bodyText": "Same as above about multiple calls to loadConfig.", "url": "https://github.com/apache/samza/pull/1255#discussion_r372033238", "createdAt": "2020-01-28T20:16:55Z", "author": {"login": "cameronlee314"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -150,6 +163,10 @@ static MetadataStoreFactory getDefaultCoordinatorStreamStoreFactory(JobConfig jo\n   }\n \n   private static Optional<CoordinationUtils> getCoordinationUtils(Config config) {\n+    if (new JobConfig(config).getConfigLoaderFactory().isPresent()) {\n+      config = ConfigUtil.loadConfig(config);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d62aa7de229de2f037a1369226e759d799b95d0c"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE0OTE3Mg==", "bodyText": "Updated", "url": "https://github.com/apache/samza/pull/1255#discussion_r372149172", "createdAt": "2020-01-29T01:32:22Z", "author": {"login": "kw2542"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/LocalApplicationRunner.java", "diffHunk": "@@ -150,6 +163,10 @@ static MetadataStoreFactory getDefaultCoordinatorStreamStoreFactory(JobConfig jo\n   }\n \n   private static Optional<CoordinationUtils> getCoordinationUtils(Config config) {\n+    if (new JobConfig(config).getConfigLoaderFactory().isPresent()) {\n+      config = ConfigUtil.loadConfig(config);\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjAzMzIzOA=="}, "originalCommit": {"oid": "d62aa7de229de2f037a1369226e759d799b95d0c"}, "originalPosition": 61}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1549, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}