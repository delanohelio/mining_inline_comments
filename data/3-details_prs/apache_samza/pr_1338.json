{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3Nzk5NDk3", "number": 1338, "title": "SAMZA-2502: Byte array keys be partitioned based on array contents in\u2026", "bodyText": "Issue:\nInMemorySystemProducer uses the hashCode of the partition key to decide to which partition the message goes. This works well when the key is an object whose hashCode method can be override. But in the case when the partition key is serialized as a byte[], the message can go to any partition. It turns out that the hash code of a byte array is based on the address in memory but not the content. Therefore, even though two messages may have same key, they can be sent to different partitions after their keys are serialized into byte[] whose hash code is kind of random.\nFix:\nWe want to be able to partition messages based on the contents of the partition keys. An easy fix would be: in the case of byte array, we calculate the hash code with Arrays.hashCode(byte[] input). This allows us to calculate the hash code of the byte array by its contents.\nTest:\nAdded a unit test in TestInMemorySystemProducer.", "createdAt": "2020-04-02T20:39:39Z", "url": "https://github.com/apache/samza/pull/1338", "merged": true, "mergeCommit": {"oid": "291e8540bec120363df07bcd4468d446590e0e0f"}, "closed": true, "closedAt": "2020-04-03T01:21:40Z", "author": {"login": "Zhangyx39"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTwm4GgH2gAyMzk3Nzk5NDk3OjA2NTUyNmFiZDYwZTA0NTdkM2Q1MTE2MzAwYmEzZTFiMDM5YWE4NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcT0lbHgH2gAyMzk3Nzk5NDk3OjM0ZWMxMDQ4Y2UwMGU2NmY2NGU0MzY5MDI0ZWMyNzZjMDM2YzAxNWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "065526abd60e0457d3d5116300ba3e1b039aa859", "author": {"user": {"login": "Zhangyx39", "name": "Yixing Zhang"}}, "url": "https://github.com/apache/samza/commit/065526abd60e0457d3d5116300ba3e1b039aa859", "committedDate": "2020-04-02T18:28:33Z", "message": "SAMZA-2502: Byte array keys be partitioned based on array contents in InMemorySystemProducer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2Nzc4OTQ0", "url": "https://github.com/apache/samza/pull/1338#pullrequestreview-386778944", "createdAt": "2020-04-02T21:11:05Z", "commit": {"oid": "065526abd60e0457d3d5116300ba3e1b039aa859"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2ODI4NDQ0", "url": "https://github.com/apache/samza/pull/1338#pullrequestreview-386828444", "createdAt": "2020-04-02T22:43:31Z", "commit": {"oid": "065526abd60e0457d3d5116300ba3e1b039aa859"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2ODI5NjEz", "url": "https://github.com/apache/samza/pull/1338#pullrequestreview-386829613", "createdAt": "2020-04-02T22:46:23Z", "commit": {"oid": "065526abd60e0457d3d5116300ba3e1b039aa859"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMjo0NjoyM1rOF__Jkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMjo0NjoyM1rOF__Jkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYzOTI1MA==", "bodyText": "Can you fix the rat check and add copyright to this new file?", "url": "https://github.com/apache/samza/pull/1338#discussion_r402639250", "createdAt": "2020-04-02T22:46:23Z", "author": {"login": "mynameborat"}, "path": "samza-core/src/test/java/org/apache/samza/system/inmemory/TestInMemorySystemProducer.java", "diffHunk": "@@ -0,0 +1,65 @@\n+package org.apache.samza.system.inmemory;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "065526abd60e0457d3d5116300ba3e1b039aa859"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34ec1048ce00e66f64e4369024ec276c036c015d", "author": {"user": {"login": "Zhangyx39", "name": "Yixing Zhang"}}, "url": "https://github.com/apache/samza/commit/34ec1048ce00e66f64e4369024ec276c036c015d", "committedDate": "2020-04-02T23:06:35Z", "message": "Add license to TestInMemorySystemProducer"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4853, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}