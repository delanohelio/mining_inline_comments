{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwMjYyODYy", "number": 1439, "title": "SAMZA-2600: Extract constants for string literals used in AM and container", "bodyText": "Issue: AM and container share a few string literals but these are not constants and if the strings do not exactly match on both, no tests fails but the job certainly will.\nChanges: in the existing CoordinationConstants, new constants created for string literals: \"containerHeartbeat\", \"executionContainerId\", \"samza.autoscaling.server.url\"\nTests: all existing tests pass.\nAPI changes: None\nUpgrade Instructions: replace \"samza.autoscaling.server.url\" with  \"yarn.am.tracking.url\" if used by any tooling outside of the samza job. Currently, this coordinator stream message is not used within the samza job.\nUsage Instructions: None", "createdAt": "2020-11-13T01:37:00Z", "url": "https://github.com/apache/samza/pull/1439", "merged": true, "mergeCommit": {"oid": "120f2fb5caf9f0606a7ee233e7445c4db469f413"}, "closed": true, "closedAt": "2020-11-17T17:56:49Z", "author": {"login": "lakshmi-manasa-g"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdb81r4AH2gAyNTIwMjYyODYyOmM1ZjM0NjcwNzNkOGE5NmI0MDJmMTM0MWM4MjdhY2JhZjlhMTQ2MTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddcyAWAFqTUzMjYwMTU4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c5f3467073d8a96b402f1341c827acbaf9a14615", "author": {"user": {"login": "lakshmi-manasa-g", "name": null}}, "url": "https://github.com/apache/samza/commit/c5f3467073d8a96b402f1341c827acbaf9a14615", "committedDate": "2020-11-13T01:26:08Z", "message": "SAMZA-2600: Create constants for string literals used in AM and container"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNDIyMzY1", "url": "https://github.com/apache/samza/pull/1439#pullrequestreview-531422365", "createdAt": "2020-11-16T15:21:28Z", "commit": {"oid": "c5f3467073d8a96b402f1341c827acbaf9a14615"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNToyMToyOFrOH0DmoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNTozMTowNVrOH0EERQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM0NzA0MQ==", "bodyText": "I would suggest extracting the format as a constant and hardcoding some of the format constants instead of doing it the other way.\ne.g.\n  CONTAINER_HEART_BEAT_SERVLET_FORMAT = \"%s\" + \"/containerHeartbeat\";\n  CONTAINER_EXECUTION_ID_PARAM_FORMAT = \"executionContainerId=\" + \"%s\";\n  CONTAINER_HEART_BEAT_ENDPOINT_FORMAT = CONTAINER_HEART_BEAT_SERVLET_FORMAT + CONTAINER_EXECUTION_ID_PARAM_FORMAT\n\nOr some flavor of the above, so that you can reuse the format across the unit tests & other places in code. IMO, having the constants by themselves still forces users to figure out how they come together and repetitive code e.g. \"%s%s?%s=%s\" with readability hit as well.", "url": "https://github.com/apache/samza/pull/1439#discussion_r524347041", "createdAt": "2020-11-16T15:21:28Z", "author": {"login": "mynameborat"}, "path": "samza-core/src/main/java/org/apache/samza/container/ContainerHeartbeatClient.java", "diffHunk": "@@ -56,7 +57,8 @@\n \n   public ContainerHeartbeatClient(String coordinatorUrl, String executionEnvContainerId) {\n     this.heartbeatEndpoint =\n-        String.format(\"%scontainerHeartbeat?executionContainerId=%s\", coordinatorUrl, executionEnvContainerId);\n+        String.format(\"%s%s?%s=%s\", coordinatorUrl, CoordinationConstants.CLUSTERBASED_CONTAINER_HEARTBEAT_SERVELET,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5f3467073d8a96b402f1341c827acbaf9a14615"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM1NDYyOQ==", "bodyText": "I'd also suggest moving this to Yarn specific constants file and remove the ClusterBased prefix as these don't have any implications outside the YARN world as they are all very specific to how YARN operates and aren't used in general samza core orchestration.\n[1] samza.autoscaling.server.url should have gotten cleaned up when we removed the auto-scaling module. We can take this opportunity and rename this configuration to am.tracking.url or something else as this is unused.\n[2] If we want to keep it the way it is for backward compatibility reasons, we should add a comment on how this is being used.\nI am in favor of [1]. wdyt?", "url": "https://github.com/apache/samza/pull/1439#discussion_r524354629", "createdAt": "2020-11-16T15:31:05Z", "author": {"login": "mynameborat"}, "path": "samza-core/src/main/java/org/apache/samza/coordinator/CoordinationConstants.java", "diffHunk": "@@ -27,4 +27,7 @@ private CoordinationConstants() {}\n   public static final String APPLICATION_RUNNER_PATH_SUFFIX = \"ApplicationRunnerData\";\n   public static final String RUNID_LOCK_ID = \"runId\";\n   public static final int LOCK_TIMEOUT_MS = 300000;\n+  public static final String CLUSTERBASED_CONTAINER_HEARTBEAT_SERVELET = \"containerHeartbeat\";\n+  public static final String CLUSTERBASED_EXECUTION_ENVIRONMENT_CONTAINER_ID = \"executionContainerId\";\n+  public static final String CLUSTERBASED_COORDINATOR_URL = \"samza.autoscaling.server.url\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5f3467073d8a96b402f1341c827acbaf9a14615"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "222225cc29f9cc8c0fab04ba076a6c8336ba2791", "author": {"user": {"login": "lakshmi-manasa-g", "name": null}}, "url": "https://github.com/apache/samza/commit/222225cc29f9cc8c0fab04ba076a6c8336ba2791", "committedDate": "2020-11-16T23:54:44Z", "message": "address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "381cedaaa3f5c7d9c0ed179db3543a6d6b21d922", "author": {"user": {"login": "lakshmi-manasa-g", "name": null}}, "url": "https://github.com/apache/samza/commit/381cedaaa3f5c7d9c0ed179db3543a6d6b21d922", "committedDate": "2020-11-17T00:08:00Z", "message": "fix coordinator url"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxOTIyOTQ3", "url": "https://github.com/apache/samza/pull/1439#pullrequestreview-531922947", "createdAt": "2020-11-17T00:11:17Z", "commit": {"oid": "381cedaaa3f5c7d9c0ed179db3543a6d6b21d922"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f968931b32be1fb1dd96c05dfc94264a3caa1f5b", "author": {"user": {"login": "lakshmi-manasa-g", "name": null}}, "url": "https://github.com/apache/samza/commit/f968931b32be1fb1dd96c05dfc94264a3caa1f5b", "committedDate": "2020-11-17T02:00:01Z", "message": "fix heartbeat endpoint string format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "572869f4162de993092250a31f64405eef4a12a6", "author": {"user": {"login": "lakshmi-manasa-g", "name": null}}, "url": "https://github.com/apache/samza/commit/572869f4162de993092250a31f64405eef4a12a6", "committedDate": "2020-11-17T05:24:56Z", "message": "fix typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNjAxNTg3", "url": "https://github.com/apache/samza/pull/1439#pullrequestreview-532601587", "createdAt": "2020-11-17T17:13:00Z", "commit": {"oid": "572869f4162de993092250a31f64405eef4a12a6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4732, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}