{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2NjQyMDUw", "number": 1335, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQwNDo0OToyMFrODtYABw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOToxODoyNFrODtq81A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4OTA1NzM1OnYy", "diffSide": "RIGHT", "path": "samza-core/src/main/java/org/apache/samza/startpoint/StartpointManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQwNDo0OToyMFrOF-wt0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQwNDo0OToyMFrOF-wt0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTM1NDE5NQ==", "bodyText": "null as a key and .get(null) looks atypical and not readable on the go. It does require some context for someone to get the background on this.", "url": "https://github.com/apache/samza/pull/1335#discussion_r401354195", "createdAt": "2020-04-01T04:49:20Z", "author": {"login": "mynameborat"}, "path": "samza-core/src/main/java/org/apache/samza/startpoint/StartpointManager.java", "diffHunk": "@@ -159,38 +160,63 @@ public void writeStartpoint(SystemStreamPartition ssp, TaskName taskName, Startp\n    *         It is empty if it does not exist or if it is too stale.\n    */\n   public Optional<Startpoint> readStartpoint(SystemStreamPartition ssp) {\n-    return readStartpoint(ssp, null);\n+    return readStartpointMap(Collections.singletonMap(null, Collections.singleton(ssp)), false).get(null)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d318de7bca18592ac00b5efe614e2b1aaaf21f71"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MjE0NTQyOnYy", "diffSide": "LEFT", "path": "samza-core/src/main/java/org/apache/samza/startpoint/StartpointManager.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOToxMzozM1rOF_O4nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOTozNjowMFrOF_Po8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0ODQ3OQ==", "bodyText": "Revert the change on line line 162 calling readStartpoint(ssp, null); will still do the intended, do not need line 163-165", "url": "https://github.com/apache/samza/pull/1335#discussion_r401848479", "createdAt": "2020-04-01T19:13:33Z", "author": {"login": "Sanil15"}, "path": "samza-core/src/main/java/org/apache/samza/startpoint/StartpointManager.java", "diffHunk": "@@ -158,8 +158,25 @@ public void writeStartpoint(SystemStreamPartition ssp, TaskName taskName, Startp\n    * @return {@link Optional} of {@link Startpoint} for the {@link SystemStreamPartition}.\n    *         It is empty if it does not exist or if it is too stale.\n    */\n+  @VisibleForTesting\n   public Optional<Startpoint> readStartpoint(SystemStreamPartition ssp) {\n-    return readStartpoint(ssp, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23290222031cd2d9f73f1eef7c4432fda43e02b9"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1MzI5NA==", "bodyText": "Is used in numerous tests, so need it.", "url": "https://github.com/apache/samza/pull/1335#discussion_r401853294", "createdAt": "2020-04-01T19:22:24Z", "author": {"login": "rmatharu"}, "path": "samza-core/src/main/java/org/apache/samza/startpoint/StartpointManager.java", "diffHunk": "@@ -158,8 +158,25 @@ public void writeStartpoint(SystemStreamPartition ssp, TaskName taskName, Startp\n    * @return {@link Optional} of {@link Startpoint} for the {@link SystemStreamPartition}.\n    *         It is empty if it does not exist or if it is too stale.\n    */\n+  @VisibleForTesting\n   public Optional<Startpoint> readStartpoint(SystemStreamPartition ssp) {\n-    return readStartpoint(ssp, null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0ODQ3OQ=="}, "originalCommit": {"oid": "23290222031cd2d9f73f1eef7c4432fda43e02b9"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1NjY4MQ==", "bodyText": "You are not changing the function signature, so the test should still work when you invoke readStartpoint(ssp, null) from here what am I missing?", "url": "https://github.com/apache/samza/pull/1335#discussion_r401856681", "createdAt": "2020-04-01T19:28:28Z", "author": {"login": "Sanil15"}, "path": "samza-core/src/main/java/org/apache/samza/startpoint/StartpointManager.java", "diffHunk": "@@ -158,8 +158,25 @@ public void writeStartpoint(SystemStreamPartition ssp, TaskName taskName, Startp\n    * @return {@link Optional} of {@link Startpoint} for the {@link SystemStreamPartition}.\n    *         It is empty if it does not exist or if it is too stale.\n    */\n+  @VisibleForTesting\n   public Optional<Startpoint> readStartpoint(SystemStreamPartition ssp) {\n-    return readStartpoint(ssp, null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0ODQ3OQ=="}, "originalCommit": {"oid": "23290222031cd2d9f73f1eef7c4432fda43e02b9"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg2MDg0OQ==", "bodyText": "The fact that null as task-name maps to \"only-ssp\" is an internal of the class, i.e., the unit.\nUnit-tests test the unit not internal nitty gritties of the unit.", "url": "https://github.com/apache/samza/pull/1335#discussion_r401860849", "createdAt": "2020-04-01T19:36:00Z", "author": {"login": "rmatharu"}, "path": "samza-core/src/main/java/org/apache/samza/startpoint/StartpointManager.java", "diffHunk": "@@ -158,8 +158,25 @@ public void writeStartpoint(SystemStreamPartition ssp, TaskName taskName, Startp\n    * @return {@link Optional} of {@link Startpoint} for the {@link SystemStreamPartition}.\n    *         It is empty if it does not exist or if it is too stale.\n    */\n+  @VisibleForTesting\n   public Optional<Startpoint> readStartpoint(SystemStreamPartition ssp) {\n-    return readStartpoint(ssp, null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0ODQ3OQ=="}, "originalCommit": {"oid": "23290222031cd2d9f73f1eef7c4432fda43e02b9"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MjE0ODc1OnYy", "diffSide": "RIGHT", "path": "samza-core/src/main/java/org/apache/samza/startpoint/StartpointManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOToxNDoyMFrOF_O6mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOToxNDoyMFrOF_O6mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0ODk4Nw==", "bodyText": "Please correct the comment, task-name can be non-null", "url": "https://github.com/apache/samza/pull/1335#discussion_r401848987", "createdAt": "2020-04-01T19:14:20Z", "author": {"login": "Sanil15"}, "path": "samza-core/src/main/java/org/apache/samza/startpoint/StartpointManager.java", "diffHunk": "@@ -158,8 +158,25 @@ public void writeStartpoint(SystemStreamPartition ssp, TaskName taskName, Startp\n    * @return {@link Optional} of {@link Startpoint} for the {@link SystemStreamPartition}.\n    *         It is empty if it does not exist or if it is too stale.\n    */\n+  @VisibleForTesting\n   public Optional<Startpoint> readStartpoint(SystemStreamPartition ssp) {\n-    return readStartpoint(ssp, null);\n+    Map<String, byte[]> startpointBytes = readWriteStore.all();\n+    // there is no task-name to use as key for the startpoint in this case (only the ssp), so we use a null task-name\n+    return readStartpoint(startpointBytes, ssp, null);\n+  }\n+\n+  /**\n+   * Returns the last {@link Startpoint} that defines the start position for a {@link SystemStreamPartition} and {@link TaskName}.\n+   * @param ssp The {@link SystemStreamPartition} to fetch the {@link Startpoint} for.\n+   * @param taskName the {@link TaskName} to fetch the {@link Startpoint} for.\n+   * @return {@link Optional} of {@link Startpoint} for the {@link SystemStreamPartition}.\n+   *         It is empty if it does not exist or if it is too stale.\n+   */\n+  @VisibleForTesting\n+  public Optional<Startpoint> readStartpoint(SystemStreamPartition ssp, TaskName taskName) {\n+    Map<String, byte[]> startpointBytes = readWriteStore.all();\n+    // there is no task-name to use as key for the startpoint in this case (only the ssp), so we use a null task-name", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23290222031cd2d9f73f1eef7c4432fda43e02b9"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MjE2MjEyOnYy", "diffSide": "RIGHT", "path": "samza-core/src/main/java/org/apache/samza/config/ClusterManagerConfig.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOToxODoyNFrOF_PDNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOToyMzo1MFrOF_POkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1MTE4OA==", "bodyText": "If this config is called job.startpoint.fanout.enabled, isn't it better to be a part of JobConfig than ClusterManagerConfig?", "url": "https://github.com/apache/samza/pull/1335#discussion_r401851188", "createdAt": "2020-04-01T19:18:24Z", "author": {"login": "Sanil15"}, "path": "samza-core/src/main/java/org/apache/samza/config/ClusterManagerConfig.java", "diffHunk": "@@ -127,6 +127,7 @@\n    */\n   private static final String AM_JMX_ENABLED = \"yarn.am.jmx.enabled\";\n   private static final String CLUSTER_MANAGER_JMX_ENABLED = \"cluster-manager.jobcoordinator.jmx.enabled\";\n+  private static final String CLUSTER_MANAGER_STARTPOINT_FANOUT_ENABLED = \"job.startpoint.fanout.enabled\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23290222031cd2d9f73f1eef7c4432fda43e02b9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1NDA5OA==", "bodyText": "Once you decide where it fits, since this is user-facing, please add docs to doc markdown. Thanks!", "url": "https://github.com/apache/samza/pull/1335#discussion_r401854098", "createdAt": "2020-04-01T19:23:50Z", "author": {"login": "Sanil15"}, "path": "samza-core/src/main/java/org/apache/samza/config/ClusterManagerConfig.java", "diffHunk": "@@ -127,6 +127,7 @@\n    */\n   private static final String AM_JMX_ENABLED = \"yarn.am.jmx.enabled\";\n   private static final String CLUSTER_MANAGER_JMX_ENABLED = \"cluster-manager.jobcoordinator.jmx.enabled\";\n+  private static final String CLUSTER_MANAGER_STARTPOINT_FANOUT_ENABLED = \"job.startpoint.fanout.enabled\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg1MTE4OA=="}, "originalCommit": {"oid": "23290222031cd2d9f73f1eef7c4432fda43e02b9"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1622, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}