{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3MDkzOTM0", "number": 1414, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxOToxNjozNFrOEaHZhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNzoxNDowN1rOEbqndg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1ODE5NjU1OnYy", "diffSide": "RIGHT", "path": "samza-core/src/main/java/org/apache/samza/clustermanager/ContainerManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxOToxNjozNFrOHDVpkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwMDowMDowNVrOHEXGMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI2MjQ4MQ==", "bodyText": "Isnt force-restart a misnomer here?\nAll its really doing is issuing a stop and relying on the AM to bring it back up?\nIn a corner case, AM will not be able to bring it back up on the same host, rather on a different available host?", "url": "https://github.com/apache/samza/pull/1414#discussion_r473262481", "createdAt": "2020-08-19T19:16:34Z", "author": {"login": "rmatharu"}, "path": "samza-core/src/main/java/org/apache/samza/clustermanager/ContainerManager.java", "diffHunk": "@@ -54,6 +54,8 @@\n \n   private static final Logger LOG = LoggerFactory.getLogger(ContainerManager.class);\n   private static final String ANY_HOST = ResourceRequestState.ANY_HOST;\n+  private static final String LAST_SEEN = \"LAST_SEEN\";\n+  private static final String FORCE_RESTART_LAST_SEEN = \"FORCE_RESTART_LAST_SEEN\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ae626a626a5de1872ddcd18ddbef11b65d6a285"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMzNDc2OQ==", "bodyText": "discussed offline, its the destinationHost param which is.\nAll its really doing is issuing a stop and relying on the AM to bring it back up?\nYup that is what is it doing\nIn a corner case, AM will not be able to bring it back up on the same host, rather on a different available host?\nYes and that is documented", "url": "https://github.com/apache/samza/pull/1414#discussion_r474334769", "createdAt": "2020-08-21T00:00:05Z", "author": {"login": "Sanil15"}, "path": "samza-core/src/main/java/org/apache/samza/clustermanager/ContainerManager.java", "diffHunk": "@@ -54,6 +54,8 @@\n \n   private static final Logger LOG = LoggerFactory.getLogger(ContainerManager.class);\n   private static final String ANY_HOST = ResourceRequestState.ANY_HOST;\n+  private static final String LAST_SEEN = \"LAST_SEEN\";\n+  private static final String FORCE_RESTART_LAST_SEEN = \"FORCE_RESTART_LAST_SEEN\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI2MjQ4MQ=="}, "originalCommit": {"oid": "3ae626a626a5de1872ddcd18ddbef11b65d6a285"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1ODIwMDg2OnYy", "diffSide": "RIGHT", "path": "samza-core/src/main/java/org/apache/samza/clustermanager/ContainerManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxOToxODowMVrOHDVsSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwMDowMDoxN1rOHEXGbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI2MzE3OA==", "bodyText": "This comment has the same meaning as the one above\n\"if (destinationHost.equals(FORCE_RESTART_LAST_SEEN))\"\nCould we write the difference", "url": "https://github.com/apache/samza/pull/1414#discussion_r473263178", "createdAt": "2020-08-19T19:18:01Z", "author": {"login": "rmatharu"}, "path": "samza-core/src/main/java/org/apache/samza/clustermanager/ContainerManager.java", "diffHunk": "@@ -391,6 +402,28 @@ public void registerContainerPlacementAction(ContainerPlacementRequestMessage re\n       return;\n     }\n \n+    /*\n+     * When destination host is {@code FORCE_RESTART_LAST_SEEN} its treated as eqvivalent to kill -9 operation for the container\n+     * In this scenario container is stopped first and we fallback to normal restart path\n+     */\n+    if (destinationHost.equals(FORCE_RESTART_LAST_SEEN)) {\n+      LOG.info(\"Issuing a force restart for Processor ID: {} for ContainerPlacement action request {}\", processorId, requestMessage);\n+      clusterResourceManager.stopStreamProcessor(samzaApplicationState.runningProcessors.get(processorId));\n+      writeContainerPlacementResponseMessage(requestMessage, ContainerPlacementMessage.StatusCode.SUCCEEDED,\n+          \"Successfully issued a stop container request falling back to normal restart path\");\n+      return;\n+    }\n+\n+    /**\n+     * When destination host is {@code LAST_SEEN} its treated as a restart request on the host where container is running\n+     * on or has been seen last\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ae626a626a5de1872ddcd18ddbef11b65d6a285"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMzNDgyOA==", "bodyText": "sure", "url": "https://github.com/apache/samza/pull/1414#discussion_r474334828", "createdAt": "2020-08-21T00:00:17Z", "author": {"login": "Sanil15"}, "path": "samza-core/src/main/java/org/apache/samza/clustermanager/ContainerManager.java", "diffHunk": "@@ -391,6 +402,28 @@ public void registerContainerPlacementAction(ContainerPlacementRequestMessage re\n       return;\n     }\n \n+    /*\n+     * When destination host is {@code FORCE_RESTART_LAST_SEEN} its treated as eqvivalent to kill -9 operation for the container\n+     * In this scenario container is stopped first and we fallback to normal restart path\n+     */\n+    if (destinationHost.equals(FORCE_RESTART_LAST_SEEN)) {\n+      LOG.info(\"Issuing a force restart for Processor ID: {} for ContainerPlacement action request {}\", processorId, requestMessage);\n+      clusterResourceManager.stopStreamProcessor(samzaApplicationState.runningProcessors.get(processorId));\n+      writeContainerPlacementResponseMessage(requestMessage, ContainerPlacementMessage.StatusCode.SUCCEEDED,\n+          \"Successfully issued a stop container request falling back to normal restart path\");\n+      return;\n+    }\n+\n+    /**\n+     * When destination host is {@code LAST_SEEN} its treated as a restart request on the host where container is running\n+     * on or has been seen last\n+     */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI2MzE3OA=="}, "originalCommit": {"oid": "3ae626a626a5de1872ddcd18ddbef11b65d6a285"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3NDQ1MjM4OnYy", "diffSide": "RIGHT", "path": "samza-core/src/main/java/org/apache/samza/clustermanager/ContainerManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNzoxNDowN1rOHFunJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNzoxNDowN1rOHFunJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc2ODYxNA==", "bodyText": "small thing:\nI think its equivalent to a \"kill\"  (i.e., sigstop), not \"kill -9\" (sigkill).\nCould you verify using the yarn docs", "url": "https://github.com/apache/samza/pull/1414#discussion_r475768614", "createdAt": "2020-08-24T17:14:07Z", "author": {"login": "rmatharu"}, "path": "samza-core/src/main/java/org/apache/samza/clustermanager/ContainerManager.java", "diffHunk": "@@ -391,6 +402,30 @@ public void registerContainerPlacementAction(ContainerPlacementRequestMessage re\n       return;\n     }\n \n+    /*\n+     * When destination host is {@code FORCE_RESTART_LAST_SEEN} its treated as eqvivalent to kill -9 operation for the container", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6e3cc0857e5a43691b8864674c7541a56a03815"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1491, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}