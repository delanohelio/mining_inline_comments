{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNjMxOTQz", "number": 1299, "title": "SAMZA-2477: JobModel isn't updated with latest \"task.inputs\" if enabled regex topic rewriter", "bodyText": "Symptom\nJobModelManager provides readJobModel() function to let JobCoordinator, ClusterBasedJboCoordinator and etc know the latest JobModel information.\nIf the users enable regex topic rewriter in their config, readJobModel() function will dynamically load the latest Kafka topic list and generate new TaskModel with new topic partition mappings.\nHowever, it doesn't update the task.inputs in JobModel's Config. So other services depend on task.inputs information will still see stale data.\nCause\nJobModelManager.readJobModel() uses the original config instead of the updated config to build JobModel.\nChanges\nUse updated config to build final JobModel.\nTests\n\n All unit tests and integration tests are passed\n\nAPI Changes\nNone\nUpgrade Instructions\nNone\nUsage Instructions\nNone", "createdAt": "2020-02-28T22:46:49Z", "url": "https://github.com/apache/samza/pull/1299", "merged": true, "mergeCommit": {"oid": "b06cb3ffddb030d22f4c46ccbf7a45b9a54873a7"}, "closed": true, "closedAt": "2020-03-16T22:09:24Z", "author": {"login": "alnzng"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcI1DTPgH2gAyMzgxNjMxOTQzOjlmMDBjZGI5YWUxY2U1NDNlNWQ2OTgyOWExNDA0Nzc1NWViYTJkMGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOUH7bgH2gAyMzgxNjMxOTQzOjIzMDlkMWI5MjVmZDhmNjk0OTcwODM1MGU0MGVjNDUzMDIwZmI2ZWQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9f00cdb9ae1ce543e5d69829a14047755eba2d0d", "author": {"user": {"login": "alnzng", "name": "Alan Zhang"}}, "url": "https://github.com/apache/samza/commit/9f00cdb9ae1ce543e5d69829a14047755eba2d0d", "committedDate": "2020-02-28T19:26:03Z", "message": "update JobModel if enabled regex topic rewriter\n\nSigned-off-by: Alan Zhang <shuai.xyz@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e392154ec2cc4b69c6240598b8568249c6bfcdb", "author": {"user": {"login": "alnzng", "name": "Alan Zhang"}}, "url": "https://github.com/apache/samza/commit/8e392154ec2cc4b69c6240598b8568249c6bfcdb", "committedDate": "2020-02-28T22:40:46Z", "message": "add test case\n\nSigned-off-by: Alan Zhang <shuai.xyz@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NDU2Mzky", "url": "https://github.com/apache/samza/pull/1299#pullrequestreview-375456392", "createdAt": "2020-03-16T17:57:22Z", "commit": {"oid": "8e392154ec2cc4b69c6240598b8568249c6bfcdb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNzo1NzoyMlrOF2_q_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNzo1NzoyMlrOF2_q_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIxMDYyMQ==", "bodyText": "I'd recommend renaming the method parameter to originalConfig and rename newConfig to config. It minimizes the changes in this PR and also removes unnecessary redirections in commit log which are just renames.", "url": "https://github.com/apache/samza/pull/1299#discussion_r393210621", "createdAt": "2020-03-16T17:57:22Z", "author": {"login": "mynameborat"}, "path": "samza-core/src/main/scala/org/apache/samza/coordinator/JobModelManager.scala", "diffHunk": "@@ -353,20 +357,23 @@ object JobModelManager extends Logging {\n                    changeLogPartitionMapping: util.Map[TaskName, Integer],\n                    streamMetadataCache: StreamMetadataCache,\n                    grouperMetadata: GrouperMetadata): JobModel = {\n-    val taskConfig = new TaskConfig(config)\n+    // refresh config if enabled regex topic rewriter\n+    val newConfig = refreshConfigByRegexTopicRewriter(config)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e392154ec2cc4b69c6240598b8568249c6bfcdb"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2309d1b925fd8f6949708350e40ec453020fb6ed", "author": {"user": {"login": "alnzng", "name": "Alan Zhang"}}, "url": "https://github.com/apache/samza/commit/2309d1b925fd8f6949708350e40ec453020fb6ed", "committedDate": "2020-03-16T20:27:47Z", "message": "refactor name\n\nSigned-off-by: Alan Zhang <shuai.xyz@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4805, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}