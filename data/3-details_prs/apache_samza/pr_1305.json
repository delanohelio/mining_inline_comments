{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NzA0ODgx", "number": 1305, "title": "SAMZA-2479: Add configurable default for min compaction lag ms", "bodyText": "Feature: Allow changelog min.compaction.lag.ms to be assigned a configurable default value that will apply to all stores if present, and unless overriden by a store-specific config.\nThe need for a different value comes from an evaluation done internally (within LI) that we can have a more relaxed setting than 4hr across all our jobs. The code default was chosen when the feature was implemented and is now part of a released build of samza; this 4hr value has been communicated to OSS customers and since changing this value has an operational impact on customers' kafka deployments (storage space) and each customer may have different thresholds for what is acceptable in terms of cost, making this default configurable empowers them to easily configure their samza/kafka clusters.\nChanges: Introducing stores.default.changelog.min.compaction.lag.ms store config as a way to indicate a default value that will apply to all changelogs unless overriden for a store specifically.\nTests: Added a unit test which verifies the config works as expected and honors the correct precedence.\nAPI Changes: None\nUpgrade instructions: None\nUsage instructions: Value of the configuration must be specified in milliseconds. Use stores.default.changelog.min.compaction.lag.ms to configure a default, and stores.<store-name>.changelog.min.compaction.lag.ms to set a store specific value. The precedence is as follows: 1) store specific configuration; if not present then 2) configured default; if not present then 3) default hard-coded in StorageConfig.java", "createdAt": "2020-03-06T08:55:58Z", "url": "https://github.com/apache/samza/pull/1305", "merged": true, "mergeCommit": {"oid": "5e52b281c21c1749b981c5e45bc3766ee634a413"}, "closed": true, "closedAt": "2020-03-17T15:50:29Z", "author": {"login": "bkonold"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKlH-BgH2gAyMzg0NzA0ODgxOmU2MDVjY2YwYTE5N2Q5ZDAzMWVlYWM3M2RmYTdiYTJlZTA5NjE3Zjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOWBV8AFqTM3NTYzMDEyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e605ccf0a197d9d031eeac73dfa7ba2ee09617f8", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/e605ccf0a197d9d031eeac73dfa7ba2ee09617f8", "committedDate": "2020-03-05T06:00:31Z", "message": "Making default min.compaction.lag.ms configurable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5834237f20f98f29be3616544618dbbe4a4ce371", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/5834237f20f98f29be3616544618dbbe4a4ce371", "committedDate": "2020-03-06T08:40:28Z", "message": "Unit test for compact lag default"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzA3OTE0", "url": "https://github.com/apache/samza/pull/1305#pullrequestreview-370707914", "createdAt": "2020-03-07T01:15:55Z", "commit": {"oid": "5834237f20f98f29be3616544618dbbe4a4ce371"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62f6d18d5c3954d252a8b00594e538b3815d8691", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/62f6d18d5c3954d252a8b00594e538b3815d8691", "committedDate": "2020-03-16T18:56:07Z", "message": "adding new configuration to docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NTE0MzE4", "url": "https://github.com/apache/samza/pull/1305#pullrequestreview-375514318", "createdAt": "2020-03-16T19:15:03Z", "commit": {"oid": "62f6d18d5c3954d252a8b00594e538b3815d8691"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxOToxNTowM1rOF3Cdxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxOToxNTowM1rOF3Cdxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI1NjM5MA==", "bodyText": "Can you shed some light on how this configuration impacts application (if any), Kafka (data footprint etc)?\nAre there any gotchas around how to configure this if you have TTL'd enabled on a log compacted store?", "url": "https://github.com/apache/samza/pull/1305#discussion_r393256390", "createdAt": "2020-03-16T19:15:03Z", "author": {"login": "mynameborat"}, "path": "docs/learn/documentation/versioned/jobs/configuration-table.html", "diffHunk": "@@ -1585,6 +1585,22 @@ <h1>Samza Configuration Reference</h1>\n                     </td>\n                 </tr>\n \n+                <tr>\n+                    <td class=\"property\" id=\"store-default-changelog-min-compaction-lag-ms\">stores.default.changelog.min.compaction.lag.ms</td>\n+                    <td class=\"default\">14400000</td>\n+                    <td class=\"description\">\n+                        This property defines the default minimum period that must pass before a changelog message can be compacted.\n+                    </td>\n+                </tr>\n+\n+                <tr>\n+                    <td class=\"property\" id=\"store-changelog-min-compaction-lag-ms\">stores.<span class=\"store\">store-name</span>.changelog.min.compaction.lag.ms</td>\n+                    <td class=\"default\">stores.default.changelog.min.compaction.lag.ms</td>\n+                    <td class=\"description\">\n+                        This property defines the minimum period that must pass before a message in the store's changelog can be compacted.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62f6d18d5c3954d252a8b00594e538b3815d8691"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ffcc6650909614d8a4016942cdcdf4cf0a25cd3", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/1ffcc6650909614d8a4016942cdcdf4cf0a25cd3", "committedDate": "2020-03-16T21:30:43Z", "message": "adding details to documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "286bfbc2fc2b3928aa329ed45b781f8f11f5d31e", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/286bfbc2fc2b3928aa329ed45b781f8f11f5d31e", "committedDate": "2020-03-16T21:33:54Z", "message": "fixing docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c06791c17acf9025563d147a83f898b213464b61", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/c06791c17acf9025563d147a83f898b213464b61", "committedDate": "2020-03-16T22:37:51Z", "message": "refining docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NjMwMTIx", "url": "https://github.com/apache/samza/pull/1305#pullrequestreview-375630121", "createdAt": "2020-03-16T22:40:24Z", "commit": {"oid": "c06791c17acf9025563d147a83f898b213464b61"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4811, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}