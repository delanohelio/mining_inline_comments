{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxMjQxNDgy", "number": 1246, "title": "SAMZA-2409: Update YarnJob to construct job submission env varible", "bodyText": "Design:\nhttps://cwiki.apache.org/confluence/display/SAMZA/SEP-23%3A+Simplify+Job+Runner\nChanges:\n\nDepending the on the existence of job.config.loader.factory, YarnJob will alternatively wraps job submission configs to Yarn.\nIn a separate PR, ClusterBasedJobCoordinator will be updated to read full job config from loader or coordinator stream based on the existence of submission config environment variable.\n\nAPI Changes:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\nUpgrade Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\nUsage Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\nTests:\nUnit Tests", "createdAt": "2020-01-10T02:03:37Z", "url": "https://github.com/apache/samza/pull/1246", "merged": true, "mergeCommit": {"oid": "dd7b9b84232e3240cd2241989a8cf3402a2abd15"}, "closed": true, "closedAt": "2020-01-17T22:02:45Z", "author": {"login": "kw2542"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb40r5fAH2gAyMzYxMjQxNDgyOjU4ODk0NTJmZTI4MDlmYWMxYjdiMGUyN2RjYjBlN2QxNDBiMmRjMDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb7UpghAFqTM0NDgxOTg1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5889452fe2809fac1b7b0e27dcb0e7d140b2dc02", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/5889452fe2809fac1b7b0e27dcb0e7d140b2dc02", "committedDate": "2020-01-10T01:57:42Z", "message": "SAMZA-2409: Update YarnJob to construct job submission env varible\n\nDesign:\nhttps://cwiki.apache.org/confluence/display/SAMZA/SEP-23%3A+Simplify+Job+Runner\n\nChanges:\n1. Depending the on the existence of job.config.loader.factory, YarnJob will alternatively wraps job submission configs to Yarn.\n\nAPI Changes:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nUpgrade Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nUsage Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nTests:\nUnit Tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8229a053986d9de12c026e519f390f13fb79d037", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/8229a053986d9de12c026e519f390f13fb79d037", "committedDate": "2020-01-10T01:59:41Z", "message": "SAMZA-2409: Update YarnJob to construct job submission env varible\n\nDesign:\nhttps://cwiki.apache.org/confluence/display/SAMZA/SEP-23%3A+Simplify+Job+Runner\n\nChanges:\n1. Depending the on the existence of job.config.loader.factory, YarnJob will alternatively wraps job submission configs to Yarn.\n\nAPI Changes:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nUpgrade Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nUsage Instructions:\nN/A. This is part of a series PRs, detailed information will be provided in the last/main PR.\n\nTests:\nUnit Tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bca4abd1222ca0cd5a9f9f0e7875ad626b2a3c3", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/6bca4abd1222ca0cd5a9f9f0e7875ad626b2a3c3", "committedDate": "2020-01-10T02:01:21Z", "message": "Merge branch 'SAMZA-2409' of https://github.com/kw2542/samza into SAMZA-2409"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyMjI4Nzc2", "url": "https://github.com/apache/samza/pull/1246#pullrequestreview-342228776", "createdAt": "2020-01-14T00:31:15Z", "commit": {"oid": "6bca4abd1222ca0cd5a9f9f0e7875ad626b2a3c3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwMDozMToxNlrOFdJAJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNFQwMDozMToxNlrOFdJAJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjEwMDUxNw==", "bodyText": "Is \"config\" here intended to be only the subset of configs required for submissions (the subset you outlined in SEP-23)?\nI may be misunderstanding the flow somewhere, but won't ApplicationRunnerMain end up loading the full (pre-planning) config from the properties file which will end up getting passed through to here?", "url": "https://github.com/apache/samza/pull/1246#discussion_r366100517", "createdAt": "2020-01-14T00:31:16Z", "author": {"login": "bkonold"}, "path": "samza-yarn/src/main/scala/org/apache/samza/job/yarn/YarnJob.scala", "diffHunk": "@@ -173,10 +173,16 @@ object YarnJob extends Logging {\n   @VisibleForTesting\n   private[yarn] def buildEnvironment(config: Config, yarnConfig: YarnConfig,\n     jobConfig: JobConfig): Map[String, String] = {\n-    val coordinatorSystemConfig = CoordinatorStreamUtil.buildCoordinatorStreamConfig(config)\n     val envMapBuilder = Map.newBuilder[String, String]\n-    envMapBuilder += ShellCommandConfig.ENV_COORDINATOR_SYSTEM_CONFIG ->\n-      Util.envVarEscape(SamzaObjectMapper.getObjectMapper.writeValueAsString(coordinatorSystemConfig))\n+    if (jobConfig.getConfigLoaderFactory.isPresent) {\n+      envMapBuilder += ShellCommandConfig.ENV_SUBMISSION_CONFIG ->\n+        Util.envVarEscape(SamzaObjectMapper.getObjectMapper.writeValueAsString(config))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bca4abd1222ca0cd5a9f9f0e7875ad626b2a3c3"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99a667638703f68889b097ad8ad637f14137ceeb", "author": {"user": null}, "url": "https://github.com/apache/samza/commit/99a667638703f68889b097ad8ad637f14137ceeb", "committedDate": "2020-01-14T20:32:21Z", "message": "Add clean up ticket"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyODg4NjI2", "url": "https://github.com/apache/samza/pull/1246#pullrequestreview-342888626", "createdAt": "2020-01-14T22:43:10Z", "commit": {"oid": "99a667638703f68889b097ad8ad637f14137ceeb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNDEzNjUy", "url": "https://github.com/apache/samza/pull/1246#pullrequestreview-343413652", "createdAt": "2020-01-15T18:02:07Z", "commit": {"oid": "99a667638703f68889b097ad8ad637f14137ceeb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ0ODE5ODU5", "url": "https://github.com/apache/samza/pull/1246#pullrequestreview-344819859", "createdAt": "2020-01-17T20:19:54Z", "commit": {"oid": "99a667638703f68889b097ad8ad637f14137ceeb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4741, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}