{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2MzkxNTEx", "number": 1359, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMDowODoxNVrOD7cg3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMDowODoxNVrOD7cg3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNjU5NzQzOnYy", "diffSide": "RIGHT", "path": "samza-core/src/main/java/org/apache/samza/util/Util.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMDowODoxNVrOGTxnFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMzoyNjozOFrOGT0ukg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM4ODk0OA==", "bodyText": "Are these escape sequences comprehensive enough to cover all the special characters that are currently used in samza-sql statements? (Some other special characters include: % , (, [).", "url": "https://github.com/apache/samza/pull/1359#discussion_r423388948", "createdAt": "2020-05-12T00:08:15Z", "author": {"login": "shanthoosh"}, "path": "samza-core/src/main/java/org/apache/samza/util/Util.java", "diffHunk": "@@ -45,7 +45,11 @@\n    * Make an environment variable string safe to pass.\n    */\n   public static String envVarEscape(String str) {\n-    return str.replace(\"\\\"\", \"\\\\\\\"\").replace(\"'\", \"\\\\'\");\n+    return str", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "264207f135c8452b8b95d6d52e8eb81ced08cae8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5MTI1OA==", "bodyText": "%, ( and [ are not special characters in terms of env var.", "url": "https://github.com/apache/samza/pull/1359#discussion_r423391258", "createdAt": "2020-05-12T00:16:27Z", "author": {"login": "kw2542"}, "path": "samza-core/src/main/java/org/apache/samza/util/Util.java", "diffHunk": "@@ -45,7 +45,11 @@\n    * Make an environment variable string safe to pass.\n    */\n   public static String envVarEscape(String str) {\n-    return str.replace(\"\\\"\", \"\\\\\\\"\").replace(\"'\", \"\\\\'\");\n+    return str", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM4ODk0OA=="}, "originalCommit": {"oid": "264207f135c8452b8b95d6d52e8eb81ced08cae8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5NzAwNw==", "bodyText": "The point I am trying to make is passing samza-sql statements over as env_arguments is kind of fragile. To be comprehensive, you need to figure out all the special characters in bash that are used in sql and then escape them. Special characters that are used in bash  .", "url": "https://github.com/apache/samza/pull/1359#discussion_r423397007", "createdAt": "2020-05-12T00:36:12Z", "author": {"login": "shanthoosh"}, "path": "samza-core/src/main/java/org/apache/samza/util/Util.java", "diffHunk": "@@ -45,7 +45,11 @@\n    * Make an environment variable string safe to pass.\n    */\n   public static String envVarEscape(String str) {\n-    return str.replace(\"\\\"\", \"\\\\\\\"\").replace(\"'\", \"\\\\'\");\n+    return str", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM4ODk0OA=="}, "originalCommit": {"oid": "264207f135c8452b8b95d6d52e8eb81ced08cae8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQwNDYyOA==", "bodyText": "I understand your point. Special characters in bash does not mean we need to escape it because:\n\nit must be valid SQL syntax\nthey are already encapsulated in bash string, only those that will impact the string encapsulation needs to be escaped.\n\nI can only find backslash and grave accent for now, do you know if there are other characters that we need to escape here?", "url": "https://github.com/apache/samza/pull/1359#discussion_r423404628", "createdAt": "2020-05-12T01:04:47Z", "author": {"login": "kw2542"}, "path": "samza-core/src/main/java/org/apache/samza/util/Util.java", "diffHunk": "@@ -45,7 +45,11 @@\n    * Make an environment variable string safe to pass.\n    */\n   public static String envVarEscape(String str) {\n-    return str.replace(\"\\\"\", \"\\\\\\\"\").replace(\"'\", \"\\\\'\");\n+    return str", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM4ODk0OA=="}, "originalCommit": {"oid": "264207f135c8452b8b95d6d52e8eb81ced08cae8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQxOTcxOA==", "bodyText": "From this bash wiki here: https://mywiki.wooledge.org/BashGuide/SpecialCharacters\n$, #  are special charactors. They're used in samza-sql statements espciecially in udf's,   ( ) means sub-shell group in bash. It's also used in samza-sql.\n\n\nMoreover join is a linux command and samza-sql uses this keyword extensively for stream-table join and stream-to-stream join.   . Do you know if we had to escape that too.", "url": "https://github.com/apache/samza/pull/1359#discussion_r423419718", "createdAt": "2020-05-12T02:01:58Z", "author": {"login": "shanthoosh"}, "path": "samza-core/src/main/java/org/apache/samza/util/Util.java", "diffHunk": "@@ -45,7 +45,11 @@\n    * Make an environment variable string safe to pass.\n    */\n   public static String envVarEscape(String str) {\n-    return str.replace(\"\\\"\", \"\\\\\\\"\").replace(\"'\", \"\\\\'\");\n+    return str", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM4ODk0OA=="}, "originalCommit": {"oid": "264207f135c8452b8b95d6d52e8eb81ced08cae8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ0MDAxOA==", "bodyText": "I may not be clear before, let me explain, all of these env var are already encapsulated in a string in bash, i.e.\nexport SAMZA_SUBMISSION_CONFIG=\"the config\"\n\nwhat we need to escape are those characters that will change how bash interpret strings, single and double quotes are the most obvious ones, which are the characters we have been escaping. However, backslash and grave accent are also special characters that will change how string looks in bash, other special characters such as $, #, (, ) are special in bash itself but no longer special once they are wrapper inside a string.", "url": "https://github.com/apache/samza/pull/1359#discussion_r423440018", "createdAt": "2020-05-12T03:26:38Z", "author": {"login": "kw2542"}, "path": "samza-core/src/main/java/org/apache/samza/util/Util.java", "diffHunk": "@@ -45,7 +45,11 @@\n    * Make an environment variable string safe to pass.\n    */\n   public static String envVarEscape(String str) {\n-    return str.replace(\"\\\"\", \"\\\\\\\"\").replace(\"'\", \"\\\\'\");\n+    return str", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM4ODk0OA=="}, "originalCommit": {"oid": "264207f135c8452b8b95d6d52e8eb81ced08cae8"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1420, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}