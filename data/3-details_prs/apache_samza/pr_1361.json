{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NzQ3MDk5", "number": 1361, "title": "SAMZA-2525:Fix race condition in ClientHelper#isActiveApplication", "bodyText": "Symptom:Incorrect job status reported, which is previous deployed job status instead of current job.\nCause:ClientHelper#isActiveApplication is invoking toAppStatus twice when comparing status to Running or New. It could happen that 1st time, the status is New which failed Running check, and 2nd invocation returns Running, which failed New check, this will result in the current app to be classified as non active causing ClientHelper to return job status of a previous deployed app.\nChanges: Update ClientHelper#isActiveApplication to invoke toAppStatus once and compare both status against this single result.\nTests: None\nAPI Changes: None\nUpgrade Instructions: None\nUsage Instructions: None", "createdAt": "2020-05-15T18:47:43Z", "url": "https://github.com/apache/samza/pull/1361", "merged": true, "mergeCommit": {"oid": "5e73b1f6f08a876037b8d97baad9947c4d5a077c"}, "closed": true, "closedAt": "2020-05-15T21:45:57Z", "author": {"login": "kw2542"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchmkvDAH2gAyNDE4NzQ3MDk5OmY5NDU0NjQ4ODEyOTA4NTUzY2NkNDgzZmNiYTRhNGZkNmUyZjE5YzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchpMOxgFqTQxMjk4NTcxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f9454648812908553ccd483fcba4a4fd6e2f19c4", "author": {"user": {"login": "kw2542", "name": "Ke Wu"}}, "url": "https://github.com/apache/samza/commit/f9454648812908553ccd483fcba4a4fd6e2f19c4", "committedDate": "2020-05-15T18:42:06Z", "message": "SAMZA-2525:Fix race condition in ClientHelper#isActiveApplication\n\nSymptom:Incorrect job status reported, which is previous deployed job status instead of current job.\nCause:ClientHelper#isActiveApplication is invoking toAppStatus twice when comparing status to Running or New. It could happen that 1st time, the status is New which failed Running check, and 2nd invocation returns Running, which failed New check, this will result in the current app to be classified as non active causing ClientHelper to return job status of a previous deployed app.\nChanges: Update ClientHelper#isActiveApplication to invoke toAppStatus once and compare both status against this single result.\nTests: None\nAPI Changes: None\nUpgrade Instructions: None\nUsage Instructions: None"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyODk4ODY1", "url": "https://github.com/apache/samza/pull/1361#pullrequestreview-412898865", "createdAt": "2020-05-15T19:04:07Z", "commit": {"oid": "f9454648812908553ccd483fcba4a4fd6e2f19c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxOTowNDowOFrOGWQpRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxOTowNDowOFrOGWQpRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTk5NDU2NQ==", "bodyText": "but application report does not change.. so how would toAppStatus return different values for the same applicationReport? i thought applicationReport does NOT change within the same invocation of isActiveAppliction.", "url": "https://github.com/apache/samza/pull/1361#discussion_r425994565", "createdAt": "2020-05-15T19:04:08Z", "author": {"login": "lakshmi-manasa-g"}, "path": "samza-yarn/src/main/scala/org/apache/samza/job/yarn/ClientHelper.scala", "diffHunk": "@@ -301,8 +301,8 @@ class ClientHelper(conf: Configuration) extends Logging {\n   }\n \n   private def isActiveApplication(applicationReport: ApplicationReport): Boolean = {\n-    (Running.equals(toAppStatus(applicationReport).get)\n-    || New.equals(toAppStatus(applicationReport).get))\n+    val status = toAppStatus(applicationReport).get", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9454648812908553ccd483fcba4a4fd6e2f19c4"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyOTAzOTU5", "url": "https://github.com/apache/samza/pull/1361#pullrequestreview-412903959", "createdAt": "2020-05-15T19:12:44Z", "commit": {"oid": "f9454648812908553ccd483fcba4a4fd6e2f19c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyOTg1NzEz", "url": "https://github.com/apache/samza/pull/1361#pullrequestreview-412985713", "createdAt": "2020-05-15T21:45:03Z", "commit": {"oid": "f9454648812908553ccd483fcba4a4fd6e2f19c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4596, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}