{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3Njk3ODc0", "number": 1416, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMDozMzoxOVrOEYSazA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODo0MToyMVrOEZLYUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzOTAzMDUyOnYy", "diffSide": "RIGHT", "path": "samza-api/src/main/java/org/apache/samza/metrics/SamzaHistogram.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMDozMzoxOVrOHAizKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMDozMzoxOVrOHAizKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMzMjIwMw==", "bodyText": "Looks like this line is unnecessary? The \"values\" variable is never being used.", "url": "https://github.com/apache/samza/pull/1416#discussion_r470332203", "createdAt": "2020-08-14T00:33:19Z", "author": {"login": "xiefan46"}, "path": "samza-api/src/main/java/org/apache/samza/metrics/SamzaHistogram.java", "diffHunk": "@@ -53,6 +53,8 @@ public SamzaHistogram(MetricsRegistry registry, String group, String name, List<\n \n   public void update(long value) {\n     histogram.update(value);\n+    Snapshot values = histogram.getSnapshot();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4de45c65896ea44c567163399a43a7032feda8e5"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzOTExMzg4OnYy", "diffSide": "RIGHT", "path": "samza-api/src/main/java/org/apache/samza/metrics/SamzaHistogram.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMDo1NTowN1rOHAjqdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNTozNDoxOFrOHBt3cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM0NjM1Ng==", "bodyText": "Looks like the gauge value is already updated when it is reported (line 76 Gauge#visit). Why do we need to update them on every new datapoint?", "url": "https://github.com/apache/samza/pull/1416#discussion_r470346356", "createdAt": "2020-08-14T00:55:07Z", "author": {"login": "prateekm"}, "path": "samza-api/src/main/java/org/apache/samza/metrics/SamzaHistogram.java", "diffHunk": "@@ -53,6 +53,7 @@ public SamzaHistogram(MetricsRegistry registry, String group, String name, List<\n \n   public void update(long value) {\n     histogram.update(value);\n+    percentiles.forEach(x -> updateGaugeValues(x));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4d5d982e84108e611949fa8df910952ac6c3304"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM0OTc1Nw==", "bodyText": "good point. @prateekm is it possible that this is never called? We are seeing the values a 0, so I assumed this could be the issue.", "url": "https://github.com/apache/samza/pull/1416#discussion_r470349757", "createdAt": "2020-08-14T01:00:04Z", "author": {"login": "vishwajith-s"}, "path": "samza-api/src/main/java/org/apache/samza/metrics/SamzaHistogram.java", "diffHunk": "@@ -53,6 +53,7 @@ public SamzaHistogram(MetricsRegistry registry, String group, String name, List<\n \n   public void update(long value) {\n     histogram.update(value);\n+    percentiles.forEach(x -> updateGaugeValues(x));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM0NjM1Ng=="}, "originalCommit": {"oid": "f4d5d982e84108e611949fa8df910952ac6c3304"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM1NTI2NQ==", "bodyText": "Also by the way this code is being called from Brooklin code in Brooklin cluster. Not sure if the visit is called", "url": "https://github.com/apache/samza/pull/1416#discussion_r470355265", "createdAt": "2020-08-14T01:08:11Z", "author": {"login": "vishwajith-s"}, "path": "samza-api/src/main/java/org/apache/samza/metrics/SamzaHistogram.java", "diffHunk": "@@ -53,6 +53,7 @@ public SamzaHistogram(MetricsRegistry registry, String group, String name, List<\n \n   public void update(long value) {\n     histogram.update(value);\n+    percentiles.forEach(x -> updateGaugeValues(x));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM0NjM1Ng=="}, "originalCommit": {"oid": "f4d5d982e84108e611949fa8df910952ac6c3304"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MjA5OQ==", "bodyText": "@prateekm as discussed doing it in the getValue of the Histogram.", "url": "https://github.com/apache/samza/pull/1416#discussion_r471562099", "createdAt": "2020-08-17T15:34:18Z", "author": {"login": "vishwajith-s"}, "path": "samza-api/src/main/java/org/apache/samza/metrics/SamzaHistogram.java", "diffHunk": "@@ -53,6 +53,7 @@ public SamzaHistogram(MetricsRegistry registry, String group, String name, List<\n \n   public void update(long value) {\n     histogram.update(value);\n+    percentiles.forEach(x -> updateGaugeValues(x));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM0NjM1Ng=="}, "originalCommit": {"oid": "f4d5d982e84108e611949fa8df910952ac6c3304"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0ODM2MzA3OnYy", "diffSide": "RIGHT", "path": "samza-api/src/main/java/org/apache/samza/metrics/SamzaHistogram.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODo0MToyMVrOHB2ZFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxODo0MToyMVrOHB2ZFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTcwMTc4MA==", "bodyText": "Should this be removed from here if this is already being updated in getValue?", "url": "https://github.com/apache/samza/pull/1416#discussion_r471701780", "createdAt": "2020-08-17T18:41:21Z", "author": {"login": "prateekm"}, "path": "samza-api/src/main/java/org/apache/samza/metrics/SamzaHistogram.java", "diffHunk": "@@ -75,5 +75,15 @@ public void visit(MetricsVisitor visitor) {\n       updateGaugeValues(percentile);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "012e404226baf5c6099ff109e9cef886dc7cc019"}, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1495, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}