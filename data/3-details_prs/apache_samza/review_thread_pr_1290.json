{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NzI0NzI5", "number": 1290, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOToxNDoyM1rODi0VyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMjo1NzozOVrODi4f9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODM1NzIxOnYy", "diffSide": "RIGHT", "path": "samza-core/src/main/scala/org/apache/samza/container/SamzaContainer.scala", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOToxNDoyM1rOFuRvuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMDowMzoyMlrOFuTWsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2OTU2MA==", "bodyText": "please add a unit test :)", "url": "https://github.com/apache/samza/pull/1290#discussion_r384069560", "createdAt": "2020-02-25T19:14:23Z", "author": {"login": "mynameborat"}, "path": "samza-core/src/main/scala/org/apache/samza/container/SamzaContainer.scala", "diffHunk": "@@ -865,6 +868,11 @@ class SamzaContainer(\n       return\n     }\n \n+    /**\n+      * Countdown the standbyContainerShutdownLatch so standby container can invoke a shutdown sequence\n+      */\n+    standbyContainerShutdownLatch.countDown();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "619318bf61e902b4e57f0b99dc630e3d0d7696cf"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA5NTkyMQ==", "bodyText": "sure", "url": "https://github.com/apache/samza/pull/1290#discussion_r384095921", "createdAt": "2020-02-25T20:03:22Z", "author": {"login": "Sanil15"}, "path": "samza-core/src/main/scala/org/apache/samza/container/SamzaContainer.scala", "diffHunk": "@@ -865,6 +868,11 @@ class SamzaContainer(\n       return\n     }\n \n+    /**\n+      * Countdown the standbyContainerShutdownLatch so standby container can invoke a shutdown sequence\n+      */\n+    standbyContainerShutdownLatch.countDown();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2OTU2MA=="}, "originalCommit": {"oid": "619318bf61e902b4e57f0b99dc630e3d0d7696cf"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3OTAzODYyOnYy", "diffSide": "RIGHT", "path": "samza-core/src/test/scala/org/apache/samza/container/TestSamzaContainer.scala", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMjo1NzozOVrOFuYWzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzowMTowMVrOFuYcTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE3Nzg3MA==", "bodyText": "Can we do without the sleep in the test ?  Also, we should verify that the countdown() was actually called.\nI think it should be possible to test the behavior by making the latch visible for testing ?", "url": "https://github.com/apache/samza/pull/1290#discussion_r384177870", "createdAt": "2020-02-25T22:57:39Z", "author": {"login": "abhishekshivanna"}, "path": "samza-core/src/test/scala/org/apache/samza/container/TestSamzaContainer.scala", "diffHunk": "@@ -126,6 +126,45 @@ class TestSamzaContainer extends AssertionsForJUnit with MockitoSugar {\n     verify(this.runLoop).run()\n   }\n \n+\n+  @Test\n+  def testShutDownSequenceForStandbyContainers() {\n+    class ShutDownSignal(container: SamzaContainer) extends Runnable {\n+      def run(): Unit = {\n+        Thread.sleep(2000)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5831bbc1768c84be72036c778154edd5e0f31aa"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE3OTI3Nw==", "bodyText": "runLoop.run is blocking call so cannot do this without sleep\n\nAlso, we should verify that the countdown() was actually called\n\nwell the verification is done on the shutdown methods which only gets called once that latch is counted down if the latch was not all these shutdown methods won't be invoked, hence I do not feel exposing this latch outside and verifying on it is necessary", "url": "https://github.com/apache/samza/pull/1290#discussion_r384179277", "createdAt": "2020-02-25T23:01:01Z", "author": {"login": "Sanil15"}, "path": "samza-core/src/test/scala/org/apache/samza/container/TestSamzaContainer.scala", "diffHunk": "@@ -126,6 +126,45 @@ class TestSamzaContainer extends AssertionsForJUnit with MockitoSugar {\n     verify(this.runLoop).run()\n   }\n \n+\n+  @Test\n+  def testShutDownSequenceForStandbyContainers() {\n+    class ShutDownSignal(container: SamzaContainer) extends Runnable {\n+      def run(): Unit = {\n+        Thread.sleep(2000)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE3Nzg3MA=="}, "originalCommit": {"oid": "b5831bbc1768c84be72036c778154edd5e0f31aa"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1581, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}