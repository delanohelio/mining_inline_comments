{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MDE1NzAz", "number": 1358, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMTowMDo0N1rOD8sokA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMToxNzowM1rOD8syaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0OTcyNDMyOnYy", "diffSide": "RIGHT", "path": "samza-azure/src/main/java/org/apache/samza/system/azureblob/AzureBlobConfig.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMTowMDo0N1rOGVzEZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMTowMDo0N1rOGVzEZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTUwOTk4OQ==", "bodyText": "Does this need to have an extra . at the end so it gets stripped off in getSystemMetadataGeneratorConfigs?", "url": "https://github.com/apache/samza/pull/1358#discussion_r425509989", "createdAt": "2020-05-15T01:00:47Z", "author": {"login": "cameronlee314"}, "path": "samza-azure/src/main/java/org/apache/samza/system/azureblob/AzureBlobConfig.java", "diffHunk": "@@ -94,6 +95,18 @@\n   public static final String SYSTEM_SUFFIX_RANDOM_STRING_TO_BLOB_NAME = SYSTEM_AZUREBLOB_PREFIX + \"suffixRandomStringToBlobName\";\n   private static final boolean SYSTEM_SUFFIX_RANDOM_STRING_TO_BLOB_NAME_DEFAULT = true;\n \n+  // full class name of an implementation of org.apache.samza.system.azureblob.utils.BlobMetadataGeneratorFactory\n+  // this factory should return an implementation of org.apache.samza.system.azureblob.utils.BlobMetadataGenerator\n+  // this generator will be invoked when a blob is committed to add metadata properties to it\n+  public static final String SYSTEM_BLOB_METADATA_PROPERTIES_GENERATOR_FACTORY = SYSTEM_AZUREBLOB_PREFIX + \"metadataPropertiesGeneratorFactory\";\n+  private static final String SYSTEM_BLOB_METADATA_PROPERTIES_GENERATOR_FACTORY_DEFAULT =\n+      \"org.apache.samza.system.azureblob.utils.NullBlobMetadataGeneratorFactory\";\n+\n+  // Additional configs for the metadata generator should be prefixed with this string which is passed to the generator.\n+  // for example, to pass a \"key\":\"value\" pair to the metadata generator, add config like\n+  // systems.<system-name>.azureblob.metadataGeneratorConfig.<key> with value <value>\n+  public static final String SYSTEM_BLOB_METADATA_GENERATOR_CONFIG_PREFIX = SYSTEM_AZUREBLOB_PREFIX + \"metadataGeneratorConfig\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c340bd00ed9a20d9c992fbf5ba009041ccac22ee"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0OTczNjAzOnYy", "diffSide": "RIGHT", "path": "samza-azure/src/main/java/org/apache/samza/system/azureblob/AzureBlobConfig.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMTowODozNVrOGVzLkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMTowODozNVrOGVzLkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTUxMTgyNA==", "bodyText": "Minor: For consistency, consider naming these getSystemBlobMetadata...", "url": "https://github.com/apache/samza/pull/1358#discussion_r425511824", "createdAt": "2020-05-15T01:08:35Z", "author": {"login": "cameronlee314"}, "path": "samza-azure/src/main/java/org/apache/samza/system/azureblob/AzureBlobConfig.java", "diffHunk": "@@ -185,4 +198,13 @@ public long getMaxBlobSize(String systemName) {\n   public long getMaxMessagesPerBlob(String systemName) {\n     return getLong(String.format(SYSTEM_MAX_MESSAGES_PER_BLOB, systemName), SYSTEM_MAX_MESSAGES_PER_BLOB_DEFAULT);\n   }\n+\n+  public String getSystemMetadataPropertiesGeneratorFactory(String systemName) {\n+    return get(String.format(SYSTEM_BLOB_METADATA_PROPERTIES_GENERATOR_FACTORY, systemName),\n+        SYSTEM_BLOB_METADATA_PROPERTIES_GENERATOR_FACTORY_DEFAULT);\n+  }\n+\n+  public Config getSystemMetadataGeneratorConfigs(String systemName) {\n+    return subset(String.format(SYSTEM_BLOB_METADATA_GENERATOR_CONFIG_PREFIX, systemName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c340bd00ed9a20d9c992fbf5ba009041ccac22ee"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0OTc0OTUzOnYy", "diffSide": "LEFT", "path": "samza-azure/src/main/java/org/apache/samza/system/azureblob/avro/AzureBlobOutputStream.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMToxNzowM1rOGVzTvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwMjoyMzoyMlrOGV0UqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTUxMzkxOQ==", "bodyText": "If an existing case needs this BLOB_RAW_SIZE_BYTES_METADATA, then will they need to implement their own blob metadata generator?", "url": "https://github.com/apache/samza/pull/1358#discussion_r425513919", "createdAt": "2020-05-15T01:17:03Z", "author": {"login": "cameronlee314"}, "path": "samza-azure/src/main/java/org/apache/samza/system/azureblob/avro/AzureBlobOutputStream.java", "diffHunk": "@@ -172,8 +193,8 @@ public synchronized void close() {\n       future.get((long) flushTimeoutMs, TimeUnit.MILLISECONDS);\n       LOG.info(\"For blob: {} committing blockList size:{}\", blobAsyncClient.getBlobUrl().toString(), blockList.size());\n       metrics.updateAzureCommitMetrics();\n-      Map<String, String> blobMetadata = Collections.singletonMap(BLOB_RAW_SIZE_BYTES_METADATA, Long.toString(totalUploadedBlockSize));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c340bd00ed9a20d9c992fbf5ba009041ccac22ee"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTUzMDUzNg==", "bodyText": "ah, yes. they will need to implement their own generator. Updated the PR description to reflect backwards incompatible.  is that ok?", "url": "https://github.com/apache/samza/pull/1358#discussion_r425530536", "createdAt": "2020-05-15T02:23:22Z", "author": {"login": "lakshmi-manasa-g"}, "path": "samza-azure/src/main/java/org/apache/samza/system/azureblob/avro/AzureBlobOutputStream.java", "diffHunk": "@@ -172,8 +193,8 @@ public synchronized void close() {\n       future.get((long) flushTimeoutMs, TimeUnit.MILLISECONDS);\n       LOG.info(\"For blob: {} committing blockList size:{}\", blobAsyncClient.getBlobUrl().toString(), blockList.size());\n       metrics.updateAzureCommitMetrics();\n-      Map<String, String> blobMetadata = Collections.singletonMap(BLOB_RAW_SIZE_BYTES_METADATA, Long.toString(totalUploadedBlockSize));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTUxMzkxOQ=="}, "originalCommit": {"oid": "c340bd00ed9a20d9c992fbf5ba009041ccac22ee"}, "originalPosition": 69}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1417, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}