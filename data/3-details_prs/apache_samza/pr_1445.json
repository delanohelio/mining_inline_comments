{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MTY5NTAy", "number": 1445, "title": "SAMZA-2604: Datamodel change to capture physical container id for AM HA", "bodyText": "Feature: Main feature is Cluster based Job coordinator (aka AM) high availability (HA) (TODO: sep/doc how?). The feature ensures that the new AM can establish connection with already running containers to avoid restarting all running containers when AM dies. This PR enables capturing of the physical execution environment container id (ex: yarn container id \"container_123_123\") mapping to Samza logical processor id (ex: \"0\"). In future PRs, this mapping will be used by the new AM.\nChanges:\n\nIntroduce new Coordinator Stream Message and manager to read/write this message\nContainer upon launch will write to c-stream, its logical and physical id\nJob Coordinator(AM) upon launch will read the mapping of all containers from c-stream.\n\nTests:\n\nadded unit test for new manager\nworking on tests for other classes as they have no coverage for relevant code.\n\nAPI changes:\n\nNew c-stream message\n\nUsage instructions: None\nUpgrade instructions: Backwards compatible. N/A", "createdAt": "2020-11-19T19:07:22Z", "url": "https://github.com/apache/samza/pull/1445", "merged": true, "mergeCommit": {"oid": "c212cac420864d09f2663da2e51c23e4718d6812"}, "closed": true, "closedAt": "2020-12-01T07:37:22Z", "author": {"login": "lakshmi-manasa-g"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdde_AwgH2gAyNTI0MTY5NTAyOmVlYjdhYjczNzYyYjgwODE0MzBkZDc1MmNlNzFjYzE4YzA5NmNhNGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdh07AZgFqTU0MTU1MjI5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "eeb7ab73762b8081430dd752ce71cc18c096ca4b", "author": {"user": {"login": "lakshmi-manasa-g", "name": null}}, "url": "https://github.com/apache/samza/commit/eeb7ab73762b8081430dd752ce71cc18c096ca4b", "committedDate": "2020-11-17T19:47:01Z", "message": "Introduce config for cluster based job coordinator high availability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a58b6dee7969021c3b97659e65f58eac0f355eb", "author": {"user": {"login": "lakshmi-manasa-g", "name": null}}, "url": "https://github.com/apache/samza/commit/1a58b6dee7969021c3b97659e65f58eac0f355eb", "committedDate": "2020-11-19T18:58:15Z", "message": "SAMZA-2604: Data model change to capture physical container id mapping for AM HA"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwOTA3MDU1", "url": "https://github.com/apache/samza/pull/1445#pullrequestreview-540907055", "createdAt": "2020-11-30T13:29:15Z", "commit": {"oid": "1a58b6dee7969021c3b97659e65f58eac0f355eb"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14370d9fa0d79781deafffcde3d15ab12c087ddb", "author": {"user": {"login": "lakshmi-manasa-g", "name": null}}, "url": "https://github.com/apache/samza/commit/14370d9fa0d79781deafffcde3d15ab12c087ddb", "committedDate": "2020-11-30T22:49:51Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMzk5OTQ3", "url": "https://github.com/apache/samza/pull/1445#pullrequestreview-541399947", "createdAt": "2020-12-01T00:27:00Z", "commit": {"oid": "14370d9fa0d79781deafffcde3d15ab12c087ddb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDoyNzowMFrOH8TRbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDoyNzowMFrOH8TRbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk5MjM2NQ==", "bodyText": "Can go inside the ifPresent block so that we don't create it unless it is available? Why this is optional by the way? Seems like this is required and we should bail out. unless its used in local flow where it isn't populated.", "url": "https://github.com/apache/samza/pull/1445#discussion_r532992365", "createdAt": "2020-12-01T00:27:00Z", "author": {"login": "mynameborat"}, "path": "samza-core/src/main/java/org/apache/samza/runtime/ContainerLaunchUtil.java", "diffHunk": "@@ -151,10 +151,9 @@ private static void run(\n \n       if (new JobConfig(config).getJobCoordinatorHighAvailabilityEnabled()) {\n         ExecutionContainerIdManager executionContainerIdManager = new ExecutionContainerIdManager(\n-            new NamespaceAwareCoordinatorStreamStore(coordinatorStreamStore, SetExecutionContainerIdMapping.TYPE));\n-        if (executionContainerIdManager != null && execEnvContainerId.isPresent()) {\n-          executionContainerIdManager.writeExecutionEnvironmentContainerIdMapping(containerId, execEnvContainerId.get());\n-        }\n+            new NamespaceAwareCoordinatorStreamStore(coordinatorStreamStore, SetExecutionEnvContainerIdMapping.TYPE));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14370d9fa0d79781deafffcde3d15ab12c087ddb"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab68cad1bd3a66e28d2f387540cc77624bdd341f", "author": {"user": {"login": "lakshmi-manasa-g", "name": null}}, "url": "https://github.com/apache/samza/commit/ab68cad1bd3a66e28d2f387540cc77624bdd341f", "committedDate": "2020-12-01T00:35:25Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNDc3NjYy", "url": "https://github.com/apache/samza/pull/1445#pullrequestreview-541477662", "createdAt": "2020-12-01T04:18:50Z", "commit": {"oid": "ab68cad1bd3a66e28d2f387540cc77624bdd341f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa33b34f890d3a1402d5eeb6b9621f1fd7210e08", "author": {"user": {"login": "lakshmi-manasa-g", "name": null}}, "url": "https://github.com/apache/samza/commit/fa33b34f890d3a1402d5eeb6b9621f1fd7210e08", "committedDate": "2020-12-01T06:15:46Z", "message": "merge master"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNTUyMjky", "url": "https://github.com/apache/samza/pull/1445#pullrequestreview-541552292", "createdAt": "2020-12-01T07:36:15Z", "commit": {"oid": "fa33b34f890d3a1402d5eeb6b9621f1fd7210e08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4535, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}