{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2NDI4Njkx", "number": 10004, "title": "[#9940] Refactor Admin Endpoints", "bodyText": "Fixes #9940", "createdAt": "2020-03-31T15:53:05Z", "url": "https://github.com/TEAMMATES/teammates/pull/10004", "merged": true, "mergeCommit": {"oid": "23ea7c3b15640afe902e4366787c56779f71600d"}, "closed": true, "closedAt": "2020-04-04T16:56:43Z", "author": {"login": "tiuweehan"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTvsMPgFqTM4NjYzMzQ0NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUX-unAH2gAyMzk2NDI4NjkxOjg2ZDg1ZmI3YzczNDQ1OGY5NmYyYWUxZjRmZThlNzg1YWFmNWQzYzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NjMzNDQ1", "url": "https://github.com/TEAMMATES/teammates/pull/10004#pullrequestreview-386633445", "createdAt": "2020-04-02T17:17:30Z", "commit": {"oid": "885f534f2ad3758ff97478fcaeb0b02bd1d71358"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNzoxNzozMVrOF_1UYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNzoxNzozMVrOF_1UYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ3ODE3OQ==", "bodyText": "Might be worthwhile to have dummy values instead of blank strings", "url": "https://github.com/TEAMMATES/teammates/pull/10004#discussion_r402478179", "createdAt": "2020-04-02T17:17:31Z", "author": {"login": "madanalogy"}, "path": "src/web/services/error-report.service.spec.ts", "diffHunk": "@@ -0,0 +1,44 @@\n+import { TestBed } from '@angular/core/testing';\n+\n+import { HttpClientTestingModule } from '@angular/common/http/testing';\n+import { ResourceEndpoints } from '../types/api-endpoints';\n+import { ErrorReportRequest } from '../types/api-request';\n+import { ErrorReportService } from './error-report.service';\n+import { HttpRequestService } from './http-request.service';\n+\n+describe('ErrorReportService', () => {\n+  let spyHttpRequestService: any;\n+  let service: ErrorReportService;\n+\n+  beforeEach(() => {\n+    spyHttpRequestService = {\n+      get: jest.fn(),\n+      post: jest.fn(),\n+      put: jest.fn(),\n+      delete: jest.fn(),\n+    };\n+    TestBed.configureTestingModule({\n+      imports: [\n+        HttpClientTestingModule,\n+      ],\n+      providers: [\n+        { provide: HttpRequestService, useValue: spyHttpRequestService },\n+      ],\n+    });\n+    service = TestBed.get(ErrorReportService);\n+  });\n+\n+  it('should be created', () => {\n+    expect(service).toBeTruthy();\n+  });\n+\n+  it('should execute POST when sending an error report', () => {\n+    const request: ErrorReportRequest = {\n+      requestId: '',\n+      subject: '',\n+      content: '',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "885f534f2ad3758ff97478fcaeb0b02bd1d71358"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47674529b4d08034016ac21c075c4752ae7e0605", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/47674529b4d08034016ac21c075c4752ae7e0605", "committedDate": "2020-04-03T21:00:50Z", "message": "Refactor admin endpoints for sessions page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bf3c4d251ed6950d17b6ce4b53c1191d626abb3", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/7bf3c4d251ed6950d17b6ce4b53c1191d626abb3", "committedDate": "2020-04-03T21:00:50Z", "message": "Refactor admin endpoints for submissions page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4178ebe12ab746949d862851dd786de9e7d358de", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/4178ebe12ab746949d862851dd786de9e7d358de", "committedDate": "2020-04-03T21:00:50Z", "message": "Add Error reporting service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f9a62f092a676d09f755917afb5058aefbb8caf", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/9f9a62f092a676d09f755917afb5058aefbb8caf", "committedDate": "2020-04-03T21:00:50Z", "message": "Refactor admin endpoints for recovery and submissions page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e8a142af22ca611ba36aa6795cd48e30d596121", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/8e8a142af22ca611ba36aa6795cd48e30d596121", "committedDate": "2020-04-03T21:00:50Z", "message": "Refactor admin DELETE endpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf572725de0b7c63d3fb126e86b85c17c93e4541", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/bf572725de0b7c63d3fb126e86b85c17c93e4541", "committedDate": "2020-04-03T21:00:50Z", "message": "Add dummy value to test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7781d32d9403352541702ee3d8612f773631ae6a", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/7781d32d9403352541702ee3d8612f773631ae6a", "committedDate": "2020-04-03T21:00:08Z", "message": "Add dummy value to test"}, "afterCommit": {"oid": "bf572725de0b7c63d3fb126e86b85c17c93e4541", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/bf572725de0b7c63d3fb126e86b85c17c93e4541", "committedDate": "2020-04-03T21:00:50Z", "message": "Add dummy value to test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3Njc5NDMy", "url": "https://github.com/TEAMMATES/teammates/pull/10004#pullrequestreview-387679432", "createdAt": "2020-04-04T08:19:20Z", "commit": {"oid": "bf572725de0b7c63d3fb126e86b85c17c93e4541"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwODoxOToyMVrOGAwJyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwODoxOToyMVrOGAwJyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0MjEyMA==", "bodyText": "Nitpicking I guess, but maybe ES6 destructuring can come into handy here, so that you can just do\n// do destructuring here\n// then can simplify this part\nconst paramMap: { [key: string]: string } = {\n   questionid \n   intent,\n   key,\n   moderatedperson\n}", "url": "https://github.com/TEAMMATES/teammates/pull/10004#discussion_r403442120", "createdAt": "2020-04-04T08:19:21Z", "author": {"login": "hcwong"}, "path": "src/web/services/feedback-responses.service.ts", "diffHunk": "@@ -119,6 +122,24 @@ export class FeedbackResponsesService {\n     }\n   }\n \n+  /**\n+   * Retrieves a feedback response by calling API.\n+   */\n+  getFeedbackResponse(queryParams: {\n+    questionId: string,\n+    intent: Intent,\n+    key: string,\n+    moderatedPerson: string,\n+  }): Observable<FeedbackResponsesResponse> {\n+    const paramMap: { [key: string]: string } = {\n+      questionid: queryParams.questionId,\n+      intent: queryParams.intent,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf572725de0b7c63d3fb126e86b85c17c93e4541"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NjgxMDYw", "url": "https://github.com/TEAMMATES/teammates/pull/10004#pullrequestreview-387681060", "createdAt": "2020-04-04T08:46:36Z", "commit": {"oid": "bf572725de0b7c63d3fb126e86b85c17c93e4541"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwODo0NjozN1rOGAwS5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwODo1Mzo1NVrOGAwVow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0NDQ1NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  googleId: id,\n          \n          \n            \n                  googleId: this.accountInfo.googleId,\n          \n      \n    \n    \n  \n\nCan it be this instead? Then we can get rid of the id local variable since it isn't used anywhere else.", "url": "https://github.com/TEAMMATES/teammates/pull/10004#discussion_r403444455", "createdAt": "2020-04-04T08:46:37Z", "author": {"login": "dvrylc"}, "path": "src/web/app/pages-admin/admin-accounts-page/admin-accounts-page.component.ts", "diffHunk": "@@ -97,11 +103,10 @@ export class AdminAccountsPageComponent implements OnInit {\n    */\n   removeStudentFromCourse(courseId: string): void {\n     const id: string = this.accountInfo.googleId;\n-    const paramMap: { [key: string]: string } = {\n-      googleid: id,\n-      courseid: courseId,\n-    };\n-    this.httpRequestService.delete('/student', paramMap).subscribe(() => {\n+    this.studentService.deleteStudent({\n+      courseId,\n+      googleId: id,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf572725de0b7c63d3fb126e86b85c17c93e4541"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0NDkxMA==", "bodyText": "Same as above", "url": "https://github.com/TEAMMATES/teammates/pull/10004#discussion_r403444910", "createdAt": "2020-04-04T08:51:32Z", "author": {"login": "dvrylc"}, "path": "src/web/app/pages-admin/admin-accounts-page/admin-accounts-page.component.ts", "diffHunk": "@@ -114,11 +119,10 @@ export class AdminAccountsPageComponent implements OnInit {\n    */\n   removeInstructorFromCourse(courseId: string): void {\n     const id: string = this.accountInfo.googleId;\n-    const paramMap: { [key: string]: string } = {\n-      instructorid: id,\n-      courseid: courseId,\n-    };\n-    this.httpRequestService.delete('/instructor', paramMap).subscribe(() => {\n+    this.instructorService.deleteInstructor({\n+      courseId,\n+      instructorId: id,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf572725de0b7c63d3fb126e86b85c17c93e4541"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0NTE1NQ==", "bodyText": "Since courseid and fsname are used twice in this function, consider destructuring queryParams as { courseid: courseId, fsname: feedbackSessionName } so that this object and the one below can be simplified?", "url": "https://github.com/TEAMMATES/teammates/pull/10004#discussion_r403445155", "createdAt": "2020-04-04T08:53:55Z", "author": {"login": "dvrylc"}, "path": "src/web/app/pages-session/session-result-page/session-result-page.component.ts", "diffHunk": "@@ -27,26 +23,29 @@ export class SessionResultPageComponent implements OnInit {\n   formattedSessionOpeningTime: string = '';\n   formattedSessionClosingTime: string = '';\n \n-  constructor(private httpRequestService: HttpRequestService, private route: ActivatedRoute,\n+  constructor(private feedbackSessionsService: FeedbackSessionsService, private route: ActivatedRoute,\n       private timezoneService: TimezoneService, private statusMessageService: StatusMessageService) {\n     this.timezoneService.getTzVersion(); // import timezone service to load timezone data\n   }\n \n   ngOnInit(): void {\n     this.route.queryParams.subscribe((queryParams: any) => {\n-      const paramMap: { [key: string]: string } = {\n-        courseid: queryParams.courseid,\n-        fsname: queryParams.fsname,\n+      this.feedbackSessionsService.getFeedbackSession({\n+        courseId: queryParams.courseid,\n+        feedbackSessionName: queryParams.fsname,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf572725de0b7c63d3fb126e86b85c17c93e4541"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86d85fb7c734458f96f2ae1f4fe8e785aaf5d3c6", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/86d85fb7c734458f96f2ae1f4fe8e785aaf5d3c6", "committedDate": "2020-04-04T16:20:54Z", "message": "Fix minor syntax issues"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4389, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}