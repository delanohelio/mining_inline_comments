{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4ODI0MDgw", "number": 10227, "title": "[#10176] Avoid expensive missing responses generation when recipient type is all students", "bodyText": "Part of #10176\nOutline of Solution\n\nMissing responses are not generated when the recipient type is \"STUDENTS\" (V6 enforces a more strict check where the generation is skipped when recipient is \"TEAM\". However, we assume the number of team will not grow that large).", "createdAt": "2020-06-23T21:11:29Z", "url": "https://github.com/TEAMMATES/teammates/pull/10227", "merged": true, "mergeCommit": {"oid": "69c01809127f94c3bfac09a11659e030251c46c7"}, "closed": true, "closedAt": "2020-06-24T12:08:48Z", "author": {"login": "xpdavid"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuL5z9AH2gAyNDM4ODI0MDgwOjgzNTkxMzVlNzdjZTlmNzY3NTgzMmEwZTViYjgzODk2OTMxZjdmYzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuWvfdgFqTQzNjQ4Mjg0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8359135e77ce9f7675832a0e5bb83896931f7fc5", "author": {"user": {"login": "xpdavid", "name": "Xiao Pu"}}, "url": "https://github.com/TEAMMATES/teammates/commit/8359135e77ce9f7675832a0e5bb83896931f7fc5", "committedDate": "2020-06-23T20:58:42Z", "message": "add check to avoid generating all combinations when recipient type is all other students"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MzM3MDYx", "url": "https://github.com/TEAMMATES/teammates/pull/10227#pullrequestreview-436337061", "createdAt": "2020-06-24T05:38:32Z", "commit": {"oid": "8359135e77ce9f7675832a0e5bb83896931f7fc5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd18a57892a10f8dde92822cb14e7c6769791419", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/bd18a57892a10f8dde92822cb14e7c6769791419", "committedDate": "2020-06-24T08:23:00Z", "message": "Merge branch 'master' into 10176-missing-response-improve"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df4e1395bb77154d1f39c03f732d8d53f02d71dc", "author": {"user": {"login": "Derek-Hardy", "name": "Derek-Hardy"}}, "url": "https://github.com/TEAMMATES/teammates/commit/df4e1395bb77154d1f39c03f732d8d53f02d71dc", "committedDate": "2020-06-24T09:28:34Z", "message": "Merge branch 'master' into 10176-missing-response-improve"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NDgyODQ4", "url": "https://github.com/TEAMMATES/teammates/pull/10227#pullrequestreview-436482848", "createdAt": "2020-06-24T09:34:16Z", "commit": {"oid": "df4e1395bb77154d1f39c03f732d8d53f02d71dc"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwOTozNDoxNlrOGoKidg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwOTozNDoxNlrOGoKidg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc2ODg4Ng==", "bodyText": "I think the common code questionCompleteGiverRecipientMap.put() can be extracted out of if-else.", "url": "https://github.com/TEAMMATES/teammates/pull/10227#discussion_r444768886", "createdAt": "2020-06-24T09:34:16Z", "author": {"login": "Derek-Hardy"}, "path": "src/main/java/teammates/logic/core/FeedbackSessionsLogic.java", "diffHunk": "@@ -1651,13 +1651,20 @@ private void addCommentVisibilityToTable(\n             List<FeedbackResponseAttributes> existingResponses, CourseRoster courseRoster, @Nullable String section) {\n \n         // first get all possible giver recipient pairs\n-        Map<String, Map<String, Set<String>>> completeGiverRecipientMap =\n-                fqLogic.buildCompleteGiverRecipientMap(feedbackSession, relatedQuestionsMap.values(), courseRoster);\n+        Map<String, Map<String, Set<String>>> questionCompleteGiverRecipientMap = new HashMap<>();\n+        for (FeedbackQuestionAttributes feedbackQuestion : relatedQuestionsMap.values()) {\n+            if (feedbackQuestion.getQuestionDetails().shouldGenerateMissingResponses(feedbackQuestion)) {\n+                questionCompleteGiverRecipientMap.put(feedbackQuestion.getId(),\n+                        fqLogic.buildCompleteGiverRecipientMap(feedbackSession, feedbackQuestion, courseRoster));\n+            } else {\n+                questionCompleteGiverRecipientMap.put(feedbackQuestion.getId(), new HashMap<>());\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df4e1395bb77154d1f39c03f732d8d53f02d71dc"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4363, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}