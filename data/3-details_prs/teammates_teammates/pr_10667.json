{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2NDQzNDgz", "number": 10667, "title": "[#9536] Feedback Text Question E2E Test", "bodyText": "Part of #9536\nOutline of Solution\n\nAdd backdoor method to get FeedbackResponse\nEdit page functions:\n\nverify loaded question\nadd new question\ncopy question\nedit question\n\n\nSubmit page functions:\n\nverify loaded question\nsubmit response\ncheck previous response\nedit response", "createdAt": "2020-08-31T17:51:52Z", "url": "https://github.com/TEAMMATES/teammates/pull/10667", "merged": true, "mergeCommit": {"oid": "17c1c698fa3bc6ee59b7e6f354c91cd111eada81"}, "closed": true, "closedAt": "2020-09-03T10:12:06Z", "author": {"login": "jtankw3"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEWEnSgH2gAyNDc2NDQzNDgzOmVlMjAzNDg3MzVhNjhmYzA3MTllZWIwZjE3YjZjZTc1NjlkMDQzOTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFNWEwAH2gAyNDc2NDQzNDgzOmM3OWE2ZjQ4N2ViNzkyYzJlM2Q5MzMzNjdlOTQ1ZmVjYThlMDYyZTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ee20348735a68fc0719eeb0f17b6ce7569d04395", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/ee20348735a68fc0719eeb0f17b6ce7569d04395", "committedDate": "2020-08-31T17:15:53Z", "message": "Add backdoor methods for submit page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b57b6436d10049cd97f242d0a0d7c720fd63e52", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/8b57b6436d10049cd97f242d0a0d7c720fd63e52", "committedDate": "2020-08-31T17:44:47Z", "message": "Add generic methods for FeedbackSubmitPage and InstructorFeedbackEditPage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eeea49742d1af28935b567eb4a1e8de18b57df87", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/eeea49742d1af28935b567eb4a1e8de18b57df87", "committedDate": "2020-08-31T17:50:39Z", "message": "Add FeedbackTextQuestionE2ETest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b3da223dd2caf8c9c1f5f05c1133c43428fdd1d", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/8b3da223dd2caf8c9c1f5f05c1133c43428fdd1d", "committedDate": "2020-09-01T05:28:30Z", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into text-question-e2e\n\n# Conflicts:\n#\tsrc/e2e/java/teammates/e2e/cases/BaseTestCaseWithBackDoorApiAccess.java\n#\tsrc/e2e/java/teammates/e2e/pageobjects/FeedbackSubmitPage.java\n#\tsrc/e2e/java/teammates/e2e/pageobjects/InstructorFeedbackEditPage.java\n#\tsrc/e2e/java/teammates/e2e/util/BackDoor.java\n#\tsrc/e2e/resources/testng-e2e.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52ac2346a72e3fc0cfdb8405c15ad163ef759ff9", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/52ac2346a72e3fc0cfdb8405c15ad163ef759ff9", "committedDate": "2020-09-01T06:03:53Z", "message": "Add waitForPageToLoad"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "61be9072a24c2ff4d099b14dd6f80b0edb96a2f7", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/61be9072a24c2ff4d099b14dd6f80b0edb96a2f7", "committedDate": "2020-09-01T05:28:39Z", "message": "Add waitForPageToLoad"}, "afterCommit": {"oid": "52ac2346a72e3fc0cfdb8405c15ad163ef759ff9", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/52ac2346a72e3fc0cfdb8405c15ad163ef759ff9", "committedDate": "2020-09-01T06:03:53Z", "message": "Add waitForPageToLoad"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5ODE1NzYw", "url": "https://github.com/TEAMMATES/teammates/pull/10667#pullrequestreview-479815760", "createdAt": "2020-09-01T14:46:19Z", "commit": {"oid": "52ac2346a72e3fc0cfdb8405c15ad163ef759ff9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNDo0NjoxOVrOHK5uCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNDo0NjoxOVrOHK5uCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE5MzQ4Mg==", "bodyText": "Minor suggestion: Shall we make this string longer to see if the response length field can work? Maybe a string that has 100 words?", "url": "https://github.com/TEAMMATES/teammates/pull/10667#discussion_r481193482", "createdAt": "2020-09-01T14:46:19Z", "author": {"login": "rrtheonlyone"}, "path": "src/e2e/java/teammates/e2e/cases/e2e/FeedbackTextQuestionE2ETest.java", "diffHunk": "@@ -0,0 +1,134 @@\n+package teammates.e2e.cases.e2e;\n+\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.CourseAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackQuestionAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackResponseAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackSessionAttributes;\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.datatransfer.questions.FeedbackTextQuestionDetails;\n+import teammates.common.datatransfer.questions.FeedbackTextResponseDetails;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.common.util.StringHelper;\n+import teammates.e2e.pageobjects.AppPage;\n+import teammates.e2e.pageobjects.FeedbackSubmitPage;\n+import teammates.e2e.pageobjects.InstructorFeedbackEditPage;\n+\n+/**\n+ * SUT: {@link Const.WebPageURIs#INSTRUCTOR_SESSION_EDIT_PAGE}, {@link Const.WebPageURIs#SESSION_SUBMISSION_PAGE}\n+ *      specifically for text questions.\n+ */\n+public class FeedbackTextQuestionE2ETest extends BaseE2ETestCase {\n+    InstructorAttributes instructor;\n+    CourseAttributes course;\n+    FeedbackSessionAttributes feedbackSession;\n+    StudentAttributes student;\n+\n+    @Override\n+    protected void prepareTestData() {\n+        testData = loadDataBundle(\"/FeedbackTextQuestionE2ETest.json\");\n+        removeAndRestoreDataBundle(testData);\n+\n+        instructor = testData.instructors.get(\"instructor\");\n+        course = testData.courses.get(\"course\");\n+        feedbackSession = testData.feedbackSessions.get(\"openSession\");\n+        student = testData.students.get(\"alice.tmms@FTextQuestionE2eT.CS2104\");\n+    }\n+\n+    @Test\n+    public void testAll() {\n+        testEditPage();\n+        testSubmitPage();\n+    }\n+\n+    private void testEditPage() {\n+        AppUrl url = createUrl(Const.WebPageURIs.INSTRUCTOR_SESSION_EDIT_PAGE)\n+                .withUserId(instructor.googleId)\n+                .withCourseId(course.getId())\n+                .withSessionName(feedbackSession.getFeedbackSessionName());\n+        InstructorFeedbackEditPage feedbackEditPage = loginAdminToPage(url, InstructorFeedbackEditPage.class);\n+        feedbackEditPage.waitForPageToLoad();\n+\n+        ______TS(\"verify loaded question\");\n+        FeedbackQuestionAttributes loadedQuestion = testData.feedbackQuestions.get(\"qn1ForFirstSession\");\n+        FeedbackTextQuestionDetails questionDetails = (FeedbackTextQuestionDetails) loadedQuestion.getQuestionDetails();\n+        feedbackEditPage.verifyTextQuestionDetails(1, questionDetails);\n+\n+        ______TS(\"add new question\");\n+        // add new question exactly like loaded question\n+        loadedQuestion.setQuestionNumber(2);\n+        feedbackEditPage.addTextQuestion(loadedQuestion);\n+\n+        feedbackEditPage.verifyTextQuestionDetails(2, questionDetails);\n+        verifyPresentInDatastore(loadedQuestion);\n+\n+        ______TS(\"copy question\");\n+        FeedbackQuestionAttributes copiedQuestion = testData.feedbackQuestions.get(\"qn1ForSecondSession\");\n+        questionDetails = (FeedbackTextQuestionDetails) copiedQuestion.getQuestionDetails();\n+        feedbackEditPage.copyQuestion(copiedQuestion.getCourseId(),\n+                copiedQuestion.getQuestionDetails().getQuestionText());\n+        copiedQuestion.courseId = course.getId();\n+        copiedQuestion.feedbackSessionName = feedbackSession.getFeedbackSessionName();\n+        copiedQuestion.setQuestionNumber(3);\n+\n+        feedbackEditPage.verifyTextQuestionDetails(3, questionDetails);\n+        verifyPresentInDatastore(copiedQuestion);\n+\n+        ______TS(\"edit question\");\n+        questionDetails.setRecommendedLength(200);\n+        copiedQuestion.questionDetails = questionDetails;\n+        feedbackEditPage.editTextQuestion(3, questionDetails);\n+\n+        feedbackEditPage.verifyTextQuestionDetails(3, questionDetails);\n+        verifyPresentInDatastore(copiedQuestion);\n+    }\n+\n+    private void testSubmitPage() {\n+        AppUrl url = createUrl(Const.WebPageURIs.SESSION_SUBMISSION_PAGE)\n+                .withUserId(student.googleId)\n+                .withCourseId(student.course)\n+                .withSessionName(feedbackSession.getFeedbackSessionName())\n+                .withRegistrationKey(StringHelper.encrypt(getStudent(student).key));\n+        FeedbackSubmitPage feedbackSubmitPage = loginAdminToPage(url, FeedbackSubmitPage.class);\n+        feedbackSubmitPage.waitForPageToLoad();\n+\n+        ______TS(\"verify loaded question\");\n+        FeedbackQuestionAttributes question = testData.feedbackQuestions.get(\"qn1ForFirstSession\");\n+        InstructorAttributes receiver = testData.instructors.get(\"instructor\");\n+        question.setQuestionNumber(1);\n+        feedbackSubmitPage.verifyTextQuestion(1, (FeedbackTextQuestionDetails) question.getQuestionDetails());\n+\n+        ______TS(\"submit response\");\n+        String questionId = getFeedbackQuestion(question).getId();\n+        FeedbackResponseAttributes response = getResponse(questionId, receiver, \"<p>This is the response for qn 1</p>\");\n+        feedbackSubmitPage.submitTextResponse(1, receiver.getName(), response);\n+\n+        verifyPresentInDatastore(response);\n+\n+        ______TS(\"check previous response\");\n+        feedbackSubmitPage = AppPage.getNewPageInstance(browser, url, FeedbackSubmitPage.class);\n+        feedbackSubmitPage.waitForPageToLoad();\n+        feedbackSubmitPage.verifyTextResponse(1, receiver.getName(), response);\n+\n+        ______TS(\"edit response\");\n+        String editedResponse = \"<p><strong>Edited response</strong></p>\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52ac2346a72e3fc0cfdb8405c15ad163ef759ff9"}, "originalPosition": 117}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNTA2NTc0", "url": "https://github.com/TEAMMATES/teammates/pull/10667#pullrequestreview-480506574", "createdAt": "2020-09-02T06:03:42Z", "commit": {"oid": "52ac2346a72e3fc0cfdb8405c15ad163ef759ff9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNDA1ODcy", "url": "https://github.com/TEAMMATES/teammates/pull/10667#pullrequestreview-481405872", "createdAt": "2020-09-03T00:41:25Z", "commit": {"oid": "52ac2346a72e3fc0cfdb8405c15ad163ef759ff9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98f66875db77eee690396a81faebd847bdcb4905", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/98f66875db77eee690396a81faebd847bdcb4905", "committedDate": "2020-09-03T06:07:28Z", "message": "Merge branch 'master' into text-question-e2e"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c79a6f487eb792c2e3d933367e945feca8e062e2", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/c79a6f487eb792c2e3d933367e945feca8e062e2", "committedDate": "2020-09-03T09:39:44Z", "message": "Merge branch 'master' into text-question-e2e"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4248, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}