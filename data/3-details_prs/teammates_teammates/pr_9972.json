{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwOTE0NjYy", "number": 9972, "title": "[#9940] Instructor module: standardize API endpoints, remove HttpRequestService", "bodyText": "Part of #9940\nNote: Previous PR did not reflect changes pushed to branch, so I closed it and created a new PR.\nChanges made:\n\nAdded remaining API endpoints\nRefactored API calls to use standardized endpoints\nRemoved HttpRequestService API calls from instructor session and feedback components (as well as parent components)\nCreated new methods in services\nWrote new tests for new service methods", "createdAt": "2020-02-27T15:29:37Z", "url": "https://github.com/TEAMMATES/teammates/pull/9972", "merged": true, "mergeCommit": {"oid": "55f1f66cb2c74d266dcbdd5058703cfd6b3611f8"}, "closed": true, "closedAt": "2020-03-07T18:32:16Z", "author": {"login": "tiuweehan"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIcuHFgH2gAyMzgwOTE0NjYyOmRlM2Y1MDk3NDg1M2U1ZTg3MGI0OTUyMDhhZDk3MmI1NDRkZDAyMGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcLZEkcAFqTM3MDc4MTYwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "de3f50974853e5e870b495208ad972b544dd020e", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/de3f50974853e5e870b495208ad972b544dd020e", "committedDate": "2020-02-27T15:05:11Z", "message": "Create unpublishFeedbackSession in feedback session service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33e76124d58df327c762f3f16938c25f8db5a32f", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/33e76124d58df327c762f3f16938c25f8db5a32f", "committedDate": "2020-02-27T15:05:11Z", "message": "Refactor URI string literals"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "525ac8bb64472956faec84ad12a528fc26f92de8", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/525ac8bb64472956faec84ad12a528fc26f92de8", "committedDate": "2020-02-27T15:05:11Z", "message": "Add all API endpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d12e74c6c0c85863b4a04e6800e51b8b7e2811cd", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/d12e74c6c0c85863b4a04e6800e51b8b7e2811cd", "committedDate": "2020-02-27T15:05:11Z", "message": "Remove HttpRequestService from instructor-student-list-page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8457142581bed18024f6382c13f42e654cda6e0", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/f8457142581bed18024f6382c13f42e654cda6e0", "committedDate": "2020-02-27T15:05:11Z", "message": "Refactor load instructor privilege"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8558bae08de3cc1b81b793a277405369bc789d1f", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/8558bae08de3cc1b81b793a277405369bc789d1f", "committedDate": "2020-02-27T15:05:11Z", "message": "Remove HttpRequestService from instructor-session-base-page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45c9c2d13da930d167480bae3f08aa22a2859c24", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/45c9c2d13da930d167480bae3f08aa22a2859c24", "committedDate": "2020-02-27T15:05:11Z", "message": "Remove HttpRequestService from instructor sessions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf57766bbc67113814c632ce78a84259834862c7", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/cf57766bbc67113814c632ce78a84259834862c7", "committedDate": "2020-02-27T15:05:11Z", "message": "Add tests for course and questions service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88dfaa0207b6d873999dc7caa333a51adc6f1c7b", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/88dfaa0207b6d873999dc7caa333a51adc6f1c7b", "committedDate": "2020-02-27T15:25:59Z", "message": "Add sessions and instructor tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MjA3NDU0", "url": "https://github.com/TEAMMATES/teammates/pull/9972#pullrequestreview-366207454", "createdAt": "2020-02-28T07:42:47Z", "commit": {"oid": "88dfaa0207b6d873999dc7caa333a51adc6f1c7b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwNzo0Mjo0OFrOFvr-4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQwNzo0MzowNlrOFvr_MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU0ODAwMQ==", "bodyText": "The cron job's URL should not be exposed right?", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r385548001", "createdAt": "2020-02-28T07:42:48Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/endpoints/CronJobEndpoints.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package teammates.ui.webapi.endpoints;\n+\n+import com.fasterxml.jackson.annotation.JsonValue;\n+\n+import teammates.common.util.Const.CronJobURIs;\n+\n+/**\n+ * API endpoints for cron jobs.\n+ */\n+public enum CronJobEndpoints {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88dfaa0207b6d873999dc7caa333a51adc6f1c7b"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU0ODA4MQ==", "bodyText": "I don't think this one should be exposed either.", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r385548081", "createdAt": "2020-02-28T07:43:06Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/endpoints/LegacyEndpoints.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package teammates.ui.webapi.endpoints;\n+\n+import com.fasterxml.jackson.annotation.JsonValue;\n+\n+import teammates.common.util.Const.LegacyURIs;\n+\n+/**\n+ * Legacy API endpoints.\n+ */\n+public enum LegacyEndpoints {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88dfaa0207b6d873999dc7caa333a51adc6f1c7b"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2aaf6a8227842855398c5b240c91aa48880c97cc", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/2aaf6a8227842855398c5b240c91aa48880c97cc", "committedDate": "2020-02-28T07:51:16Z", "message": "Remove Cron job and Legacy API endpoints"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/addd29d18f9e3cfd6657967fa51b59b0eb61bb6b", "committedDate": "2020-02-28T12:47:52Z", "message": "Merge branch 'master' into 9940-standardize-instructor-api-endpoints\n\n* master:\n  [#9382] Add MasqueradeModeService Tests (#9955)\n  [#9302] Support rich text for MCQ option text (#9944)\n  [#9642] Feedback sessions with # or ? in their name can't be edited. (#9925)\n  [#9970] Fix failing Travis build (#9971)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODgzMTU3", "url": "https://github.com/TEAMMATES/teammates/pull/9972#pullrequestreview-366883157", "createdAt": "2020-03-01T20:13:17Z", "commit": {"oid": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQyMDoxMzoxN1rOFwP7JQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQyMDoxNjo0N1rOFwP8IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjg2OQ==", "bodyText": "Question: Is this a good design? (i.e. let the backend to decide what the frontend URL should be). Looks like it should be other way around. the control of frontend URL should be in the frontend rather than the backend.", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386136869", "createdAt": "2020-03-01T20:13:17Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/endpoints/WebPageEndpoints.java", "diffHunk": "@@ -0,0 +1,51 @@\n+package teammates.ui.webapi.endpoints;\n+\n+import com.fasterxml.jackson.annotation.JsonValue;\n+\n+import teammates.common.util.Const.WebPageURIs;\n+\n+/**\n+ * API endpoints for web pages.\n+ */\n+public enum WebPageEndpoints {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjkzOA==", "bodyText": "undefined?", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386136938", "createdAt": "2020-03-01T20:14:15Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/instructor-session-base-page.component.ts", "diffHunk": "@@ -152,10 +152,11 @@ export abstract class InstructorSessionBasePageComponent {\n    * Updates the instructor privilege in {@code SessionsTableRowModel}.\n    */\n   protected updateInstructorPrivilege(model: SessionsTableRowModel): void {\n-    this.httpRequestService.get('/instructor/privilege', {\n-      courseid: model.feedbackSession.courseId,\n-      fsname: model.feedbackSession.feedbackSessionName,\n-    }).subscribe((instructorPrivilege: InstructorPrivilege) => {\n+    this.instructorService.loadInstructorPrivilege(\n+        model.feedbackSession.courseId,\n+        undefined,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjk4OQ==", "bodyText": "Where does this line goes?", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386136989", "createdAt": "2020-03-01T20:15:14Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/instructor-session-base-page.component.ts", "diffHunk": "@@ -166,15 +167,11 @@ export abstract class InstructorSessionBasePageComponent {\n    * Loads response rate of a feedback session.\n    */\n   loadResponseRate(model: SessionsTableRowModel): void {\n-    model.isLoadingResponseRate = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNzA3OQ==", "bodyText": "I don't think it is a good practice to pass the whole model into the service. The service should only get what are necessary.", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386137079", "createdAt": "2020-03-01T20:16:22Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/instructor-session-base-page.component.ts", "diffHunk": "@@ -166,15 +167,11 @@ export abstract class InstructorSessionBasePageComponent {\n    * Loads response rate of a feedback session.\n    */\n   loadResponseRate(model: SessionsTableRowModel): void {\n-    model.isLoadingResponseRate = true;\n-    const paramMap: { [key: string]: string } = {\n-      courseid: model.feedbackSession.courseId,\n-      fsname: model.feedbackSession.feedbackSessionName,\n-    };\n-    this.httpRequestService.get('/session/stats', paramMap).subscribe((resp: FeedbackSessionStats) => {\n-      model.isLoadingResponseRate = false;\n-      model.responseRate = `${resp.submittedTotal} / ${resp.expectedTotal}`;\n-    }, (resp: ErrorMessageOutput) => { this.statusMessageService.showErrorMessage(resp.error.message); });\n+    this.feedbackSessionsService.loadSessionStatistics(model)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNzA5Nw==", "bodyText": "Same here.", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386137097", "createdAt": "2020-03-01T20:16:39Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/instructor-session-base-page.component.ts", "diffHunk": "@@ -225,12 +222,8 @@ export abstract class InstructorSessionBasePageComponent {\n    * Publishes a feedback session.\n    */\n   publishSession(model: SessionsTableRowModel): void {\n-    const paramMap: { [key: string]: string } = {\n-      courseid: model.feedbackSession.courseId,\n-      fsname: model.feedbackSession.feedbackSessionName,\n-    };\n \n-    this.httpRequestService.post('/session/publish', paramMap)\n+    this.feedbackSessionsService.publishFeedbackSession(model)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b"}, "originalPosition": 108}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNzEyMA==", "bodyText": "Same here.", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r386137120", "createdAt": "2020-03-01T20:16:47Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/instructor-session-base-page.component.ts", "diffHunk": "@@ -244,12 +237,7 @@ export abstract class InstructorSessionBasePageComponent {\n    * Unpublishes a feedback session.\n    */\n   unpublishSession(model: SessionsTableRowModel): void {\n-    const paramMap: { [key: string]: string } = {\n-      courseid: model.feedbackSession.courseId,\n-      fsname: model.feedbackSession.feedbackSessionName,\n-    };\n-\n-    this.httpRequestService.delete('/session/publish', paramMap)\n+    this.feedbackSessionsService.unpublishFeedbackSession(model)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b"}, "originalPosition": 122}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53362c181dcf1e5a806f93877b2a213feefa7862", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/53362c181dcf1e5a806f93877b2a213feefa7862", "committedDate": "2020-03-07T05:34:58Z", "message": "Refactor to not pass model as parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5b7c42f56e54fe3c391fdf5485f9ec1074e26a8", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/c5b7c42f56e54fe3c391fdf5485f9ec1074e26a8", "committedDate": "2020-03-07T05:36:26Z", "message": "Remove WebPageEndpoints"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzI1Njgy", "url": "https://github.com/TEAMMATES/teammates/pull/9972#pullrequestreview-370725682", "createdAt": "2020-03-07T06:01:29Z", "commit": {"oid": "c5b7c42f56e54fe3c391fdf5485f9ec1074e26a8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwNjowMToyOVrOFzM0Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwNzoyMDowN1rOFzNBAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIzMTY3MA==", "bodyText": "ActionURIs is deprecated? Why bother sync it to the frontend?", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r389231670", "createdAt": "2020-03-07T06:01:29Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/endpoints/ActionEndpoints.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package teammates.ui.webapi.endpoints;\n+\n+import com.fasterxml.jackson.annotation.JsonValue;\n+\n+import teammates.common.util.Const.ActionURIs;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c5b7c42f56e54fe3c391fdf5485f9ec1074e26a8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIzNDk0Ng==", "bodyText": "I think you can also try to define the interface on the fly:\nloadInstructorPrivilege(param: { courseId: string, sectionName?: string, feedbackSessionName?: string })", "url": "https://github.com/TEAMMATES/teammates/pull/9972#discussion_r389234946", "createdAt": "2020-03-07T07:20:07Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/instructor-session-base-page.component.ts", "diffHunk": "@@ -152,10 +152,11 @@ export abstract class InstructorSessionBasePageComponent {\n    * Updates the instructor privilege in {@code SessionsTableRowModel}.\n    */\n   protected updateInstructorPrivilege(model: SessionsTableRowModel): void {\n-    this.httpRequestService.get('/instructor/privilege', {\n-      courseid: model.feedbackSession.courseId,\n-      fsname: model.feedbackSession.feedbackSessionName,\n-    }).subscribe((instructorPrivilege: InstructorPrivilege) => {\n+    this.instructorService.loadInstructorPrivilege(\n+        model.feedbackSession.courseId,\n+        undefined,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjkzOA=="}, "originalCommit": {"oid": "addd29d18f9e3cfd6657967fa51b59b0eb61bb6b"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e278a99b4ba0eb683c75e969cbc3f6fe7d84a358", "author": {"user": {"login": "tiuweehan", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/e278a99b4ba0eb683c75e969cbc3f6fe7d84a358", "committedDate": "2020-03-07T07:47:58Z", "message": "Move optionals to an object parameter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzgxNjAy", "url": "https://github.com/TEAMMATES/teammates/pull/9972#pullrequestreview-370781602", "createdAt": "2020-03-07T18:31:52Z", "commit": {"oid": "e278a99b4ba0eb683c75e969cbc3f6fe7d84a358"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4438, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}