{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2ODE3MjA5", "number": 10209, "title": "[#10176] Fix section-related problems in session results page", "bodyText": "Part of #10176\nThis fixes the following tickets:\n\nMissing \"No specific section\"\nMissing response to/from instructors\n\nHowever, this PR also appears to solve an age-old problem in TEAMMATES where an entity who is a both a student and an instructor will have some mixed up logic in V6.", "createdAt": "2020-06-18T23:55:47Z", "url": "https://github.com/TEAMMATES/teammates/pull/10209", "merged": true, "mergeCommit": {"oid": "ea856a375dbf9cf9bb0d73ad3f45e43f2872d290"}, "closed": true, "closedAt": "2020-06-20T00:56:53Z", "author": {"login": "wkurniawan07"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsop0nAFqTQzMzc0NDMyMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcs2ZP0AH2gAyNDM2ODE3MjA5OmEwYjY4NmM5MTE4MWU3NmU4YjBlM2NmMWEzNzkxYTI3MjAyMjA0YmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNzQ0MzIw", "url": "https://github.com/TEAMMATES/teammates/pull/10209#pullrequestreview-433744320", "createdAt": "2020-06-19T01:20:38Z", "commit": {"oid": "b0c35d8d1d905c12c4eb58634bdba6e4d55c7fdf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNzY1Mzg5", "url": "https://github.com/TEAMMATES/teammates/pull/10209#pullrequestreview-433765389", "createdAt": "2020-06-19T02:35:15Z", "commit": {"oid": "b0c35d8d1d905c12c4eb58634bdba6e4d55c7fdf"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwMjozNToxNVrOGmGI5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwMjo0MTowOFrOGmGOZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU5OTY1NQ==", "bodyText": "When I write the refactored version, I have considered the case for DEFAULT_SECTION.  To me, it looks like adding support for No specific section does not need to modify the backend. What happened if we do not modify the logic?\nActually, DEFAULT_SECTION does not mean it comes from Instructors. V6 actually allows default section for students if section is not provided (P.S. the behavior need to be changed in V6).", "url": "https://github.com/TEAMMATES/teammates/pull/10209#discussion_r442599655", "createdAt": "2020-06-19T02:35:15Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/logic/core/FeedbackSessionsLogic.java", "diffHunk": "@@ -1521,20 +1522,46 @@ public SessionResultsBundle getSessionResultsForUser(\n             allQuestionsMap.put(qn.getId(), qn);\n         }\n \n+        List<FeedbackQuestionAttributes> questionsWithDefaultSections = new ArrayList<>();\n+        if (Const.DEFAULT_SECTION.equals(section)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0c35d8d1d905c12c4eb58634bdba6e4d55c7fdf"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjYwMTA2MA==", "bodyText": "The logic should be in getRecipientSection? and we don't need to check intent?", "url": "https://github.com/TEAMMATES/teammates/pull/10209#discussion_r442601060", "createdAt": "2020-06-19T02:41:08Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/action/CreateFeedbackResponseAction.java", "diffHunk": "@@ -96,12 +96,17 @@ public ActionResult execute() {\n         }\n \n         FeedbackResponseCreateRequest createRequest = getAndValidateRequestBody(FeedbackResponseCreateRequest.class);\n+        String recipientSection = getRecipientSection(feedbackQuestion.getCourseId(),\n+                feedbackQuestion.getRecipientType(), createRequest.getRecipientIdentifier());\n+        if (intent == Intent.INSTRUCTOR_SUBMISSION && feedbackQuestion.giverType == FeedbackParticipantType.INSTRUCTORS", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c4810c586b93392ba1fcf68c0b6682b76ce490c"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzODIyNDU5", "url": "https://github.com/TEAMMATES/teammates/pull/10209#pullrequestreview-433822459", "createdAt": "2020-06-19T06:03:51Z", "commit": {"oid": "3c4810c586b93392ba1fcf68c0b6682b76ce490c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwNjowMzo1MlrOGmJDfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwNjowMzo1MlrOGmJDfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjY0NzQyMg==", "bodyText": "So Yup, I am proposing new solution here.\nBy right, when the recipientType is SELF, we should examine the giverType instead. If we didn't do this, it will work if an account is either student or instructor but will generate wrong section when the account is both student and instructor.\nThe fix will not only cover your if check but will also fix other problems (self (the self is feedback creator (instructor)) -> self, team -> self) (P.S. look like we found some bugs).", "url": "https://github.com/TEAMMATES/teammates/pull/10209#discussion_r442647422", "createdAt": "2020-06-19T06:03:52Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/action/BasicFeedbackSubmissionAction.java", "diffHunk": "@@ -155,12 +155,12 @@ protected String getRecipientSection(\n             String courseId, FeedbackParticipantType recipientType, String recipientIdentifier) {\n         switch (recipientType) {\n         case INSTRUCTORS:\n-        case SELF:\n         case NONE:\n             return Const.DEFAULT_SECTION;\n         case TEAMS:\n         case OWN_TEAM:\n             return logic.getSectionForTeam(courseId, recipientIdentifier);\n+        case SELF:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c4810c586b93392ba1fcf68c0b6682b76ce490c"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fca99c818847a2dbfee777e6eac0acd9f3c624f8", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/fca99c818847a2dbfee777e6eac0acd9f3c624f8", "committedDate": "2020-06-19T13:44:39Z", "message": "Fix display logic for instructor questions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45d5b9b537a20036697cba1a519d2ef585a4e812", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/45d5b9b537a20036697cba1a519d2ef585a4e812", "committedDate": "2020-06-19T13:58:40Z", "message": "Fix logic for determining recipient section"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cb67d8af5ec46e5f96423aee2d54f670226a980", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/1cb67d8af5ec46e5f96423aee2d54f670226a980", "committedDate": "2020-06-19T13:58:40Z", "message": "Add filter for DEFAULT_SECTION"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b0c35d8d1d905c12c4eb58634bdba6e4d55c7fdf", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/b0c35d8d1d905c12c4eb58634bdba6e4d55c7fdf", "committedDate": "2020-06-18T23:16:21Z", "message": "Add filter for DEFAULT_SECTION"}, "afterCommit": {"oid": "1cb67d8af5ec46e5f96423aee2d54f670226a980", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/1cb67d8af5ec46e5f96423aee2d54f670226a980", "committedDate": "2020-06-19T13:58:40Z", "message": "Add filter for DEFAULT_SECTION"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MjMxOTI4", "url": "https://github.com/TEAMMATES/teammates/pull/10209#pullrequestreview-434231928", "createdAt": "2020-06-19T17:16:01Z", "commit": {"oid": "1cb67d8af5ec46e5f96423aee2d54f670226a980"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0b686c91181e76e8b0e3cf1a3791a27202204bb", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/a0b686c91181e76e8b0e3cf1a3791a27202204bb", "committedDate": "2020-06-19T17:21:12Z", "message": "Merge branch 'master' into uat-fixes-section"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4356, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}