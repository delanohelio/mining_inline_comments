{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5ODQ2MTgx", "number": 9937, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwODowODoxMlrODcaKsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwNDo1MTowOFrODdkBBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTE1NDQyOnYy", "diffSide": "RIGHT", "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwODowODoxMlrOFkc2eA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwOToxNTo1NlrOFkdA9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NTc1Mg==", "bodyText": "I think a better way is to create a service and encapsulate the API call. Maybe just student-profile-service", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373765752", "createdAt": "2020-02-01T08:08:12Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -161,14 +180,28 @@ export class StudentProfilePageComponent implements OnInit {\n     this.ngbModal.open(confirmDeleteProfilePicture);\n   }\n \n+  /**\n+   * Gets the profile picture as blob image.\n+   */\n+  getProfilePicture(): Observable<Blob> {\n+    return this.httpRequestService.get(this.profilePictureEndPoint, {}, 'blob');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2ODM4OQ==", "bodyText": "I realize there is already  a student-profile.service.ts file under services. Should I create this method under the service?", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373768389", "createdAt": "2020-02-01T09:15:01Z", "author": {"login": "tiuweehan"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -161,14 +180,28 @@ export class StudentProfilePageComponent implements OnInit {\n     this.ngbModal.open(confirmDeleteProfilePicture);\n   }\n \n+  /**\n+   * Gets the profile picture as blob image.\n+   */\n+  getProfilePicture(): Observable<Blob> {\n+    return this.httpRequestService.get(this.profilePictureEndPoint, {}, 'blob');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NTc1Mg=="}, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2ODQzOA==", "bodyText": "Yup.", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373768438", "createdAt": "2020-02-01T09:15:56Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -161,14 +180,28 @@ export class StudentProfilePageComponent implements OnInit {\n     this.ngbModal.open(confirmDeleteProfilePicture);\n   }\n \n+  /**\n+   * Gets the profile picture as blob image.\n+   */\n+  getProfilePicture(): Observable<Blob> {\n+    return this.httpRequestService.get(this.profilePictureEndPoint, {}, 'blob');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NTc1Mg=="}, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTE1NDQzOnYy", "diffSide": "RIGHT", "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwODowODoxN1rOFkc2eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwODowODoxN1rOFkc2eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NTc1NA==", "bodyText": "Same here.", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373765754", "createdAt": "2020-02-01T08:08:17Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -161,14 +180,28 @@ export class StudentProfilePageComponent implements OnInit {\n     this.ngbModal.open(confirmDeleteProfilePicture);\n   }\n \n+  /**\n+   * Gets the profile picture as blob image.\n+   */\n+  getProfilePicture(): Observable<Blob> {\n+    return this.httpRequestService.get(this.profilePictureEndPoint, {}, 'blob');\n+  }\n+\n+  /**\n+   * Posts the profile picture.\n+   */\n+  postProfilePicture(formData: FormData): Observable<any> {\n+    return this.httpRequestService.post(this.profilePictureEndPoint, {}, formData);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTE1NTMxOnYy", "diffSide": "RIGHT", "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwODoxMDo0N1rOFkc29w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwODoxMDo0N1rOFkc29w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NTg3OQ==", "bodyText": "I think only if the statusCode is 404 then you should return  null", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373765879", "createdAt": "2020-02-01T08:10:47Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -112,25 +115,41 @@ export class StudentProfilePageComponent implements OnInit {\n    * Opens a modal box to upload/edit profile picture.\n    */\n   onUploadEdit(): void {\n-    const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n-    modalRef.componentInstance.profilePicLink = this.profilePicLink;\n-    modalRef.result.then((formData: FormData) => {\n-      if (!formData) {\n-        this.statusMessageService.showWarningMessage('No photo uploaded');\n-        return;\n-      }\n-\n-      this.httpRequestService.post('/student/profilePic', {}, formData)\n-          .subscribe(() => {\n-            this.statusMessageService.showSuccessMessage('Your profile picture has been saved successfully');\n-\n-            // force reload\n-            const timestamp: number = (new Date()).getTime();\n-            this.profilePicLink = `${this.backendUrl}/webapi/student/profilePic?${timestamp}&user=${this.id}`;\n-          }, (response: ErrorMessageOutput) => {\n-            this.statusMessageService.showErrorMessage(response.error.message);\n-          });\n-    }, () => {});\n+    this.getProfilePicture()\n+        // Return null if no picture is found\n+        .pipe(\n+            catchError(() => of(null)),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTE1NTU5OnYy", "diffSide": "RIGHT", "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwODoxMToxMVrOFkc3GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwODoxMToxMVrOFkc3GQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NTkxMw==", "bodyText": "Maybe should be switchMap", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373765913", "createdAt": "2020-02-01T08:11:11Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -112,25 +115,41 @@ export class StudentProfilePageComponent implements OnInit {\n    * Opens a modal box to upload/edit profile picture.\n    */\n   onUploadEdit(): void {\n-    const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n-    modalRef.componentInstance.profilePicLink = this.profilePicLink;\n-    modalRef.result.then((formData: FormData) => {\n-      if (!formData) {\n-        this.statusMessageService.showWarningMessage('No photo uploaded');\n-        return;\n-      }\n-\n-      this.httpRequestService.post('/student/profilePic', {}, formData)\n-          .subscribe(() => {\n-            this.statusMessageService.showSuccessMessage('Your profile picture has been saved successfully');\n-\n-            // force reload\n-            const timestamp: number = (new Date()).getTime();\n-            this.profilePicLink = `${this.backendUrl}/webapi/student/profilePic?${timestamp}&user=${this.id}`;\n-          }, (response: ErrorMessageOutput) => {\n-            this.statusMessageService.showErrorMessage(response.error.message);\n-          });\n-    }, () => {});\n+    this.getProfilePicture()\n+        // Return null if no picture is found\n+        .pipe(\n+            catchError(() => of(null)),\n+        )\n+        // Open Modal and wait for user to upload picture\n+        // Throw an error if there is no picture is uploaded\n+        .pipe(\n+            flatMap((image: Blob | null) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTE1NjAwOnYy", "diffSide": "RIGHT", "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwODoxMjoyM1rOFkc3TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwOToxNjozN1rOFkdBFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NTk2NQ==", "bodyText": "Any reason why we don't combine pipe together into one block?\n.pipe(\n    catchError()\n    flatMap()\n    catchError()\n    xxxx\n)", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373765965", "createdAt": "2020-02-01T08:12:23Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -112,25 +115,41 @@ export class StudentProfilePageComponent implements OnInit {\n    * Opens a modal box to upload/edit profile picture.\n    */\n   onUploadEdit(): void {\n-    const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n-    modalRef.componentInstance.profilePicLink = this.profilePicLink;\n-    modalRef.result.then((formData: FormData) => {\n-      if (!formData) {\n-        this.statusMessageService.showWarningMessage('No photo uploaded');\n-        return;\n-      }\n-\n-      this.httpRequestService.post('/student/profilePic', {}, formData)\n-          .subscribe(() => {\n-            this.statusMessageService.showSuccessMessage('Your profile picture has been saved successfully');\n-\n-            // force reload\n-            const timestamp: number = (new Date()).getTime();\n-            this.profilePicLink = `${this.backendUrl}/webapi/student/profilePic?${timestamp}&user=${this.id}`;\n-          }, (response: ErrorMessageOutput) => {\n-            this.statusMessageService.showErrorMessage(response.error.message);\n-          });\n-    }, () => {});\n+    this.getProfilePicture()\n+        // Return null if no picture is found\n+        .pipe(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2ODQ3MQ==", "bodyText": "I previously thought that catchError was a 'catch all' function for pipe, but looks like it is not the case. I will make the changes, thanks for pointing it out!", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373768471", "createdAt": "2020-02-01T09:16:37Z", "author": {"login": "tiuweehan"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -112,25 +115,41 @@ export class StudentProfilePageComponent implements OnInit {\n    * Opens a modal box to upload/edit profile picture.\n    */\n   onUploadEdit(): void {\n-    const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n-    modalRef.componentInstance.profilePicLink = this.profilePicLink;\n-    modalRef.result.then((formData: FormData) => {\n-      if (!formData) {\n-        this.statusMessageService.showWarningMessage('No photo uploaded');\n-        return;\n-      }\n-\n-      this.httpRequestService.post('/student/profilePic', {}, formData)\n-          .subscribe(() => {\n-            this.statusMessageService.showSuccessMessage('Your profile picture has been saved successfully');\n-\n-            // force reload\n-            const timestamp: number = (new Date()).getTime();\n-            this.profilePicLink = `${this.backendUrl}/webapi/student/profilePic?${timestamp}&user=${this.id}`;\n-          }, (response: ErrorMessageOutput) => {\n-            this.statusMessageService.showErrorMessage(response.error.message);\n-          });\n-    }, () => {});\n+    this.getProfilePicture()\n+        // Return null if no picture is found\n+        .pipe(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NTk2NQ=="}, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTE1NjMzOnYy", "diffSide": "RIGHT", "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwODoxMzoyOVrOFkc3dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QwNTozMTowNFrOFkmuJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NjAwNQ==", "bodyText": "The error message format is for the convenient of which handler?", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373766005", "createdAt": "2020-02-01T08:13:29Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -112,25 +115,41 @@ export class StudentProfilePageComponent implements OnInit {\n    * Opens a modal box to upload/edit profile picture.\n    */\n   onUploadEdit(): void {\n-    const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n-    modalRef.componentInstance.profilePicLink = this.profilePicLink;\n-    modalRef.result.then((formData: FormData) => {\n-      if (!formData) {\n-        this.statusMessageService.showWarningMessage('No photo uploaded');\n-        return;\n-      }\n-\n-      this.httpRequestService.post('/student/profilePic', {}, formData)\n-          .subscribe(() => {\n-            this.statusMessageService.showSuccessMessage('Your profile picture has been saved successfully');\n-\n-            // force reload\n-            const timestamp: number = (new Date()).getTime();\n-            this.profilePicLink = `${this.backendUrl}/webapi/student/profilePic?${timestamp}&user=${this.id}`;\n-          }, (response: ErrorMessageOutput) => {\n-            this.statusMessageService.showErrorMessage(response.error.message);\n-          });\n-    }, () => {});\n+    this.getProfilePicture()\n+        // Return null if no picture is found\n+        .pipe(\n+            catchError(() => of(null)),\n+        )\n+        // Open Modal and wait for user to upload picture\n+        // Throw an error if there is no picture is uploaded\n+        .pipe(\n+            flatMap((image: Blob | null) => {\n+              const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n+              modalRef.componentInstance.image = image;\n+\n+              return from(modalRef.result);\n+            }),\n+            catchError(() => throwError({\n+              error: {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2ODYxMQ==", "bodyText": "It is for the response object of type ErrorMessageOutput in line 150", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373768611", "createdAt": "2020-02-01T09:20:40Z", "author": {"login": "tiuweehan"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -112,25 +115,41 @@ export class StudentProfilePageComponent implements OnInit {\n    * Opens a modal box to upload/edit profile picture.\n    */\n   onUploadEdit(): void {\n-    const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n-    modalRef.componentInstance.profilePicLink = this.profilePicLink;\n-    modalRef.result.then((formData: FormData) => {\n-      if (!formData) {\n-        this.statusMessageService.showWarningMessage('No photo uploaded');\n-        return;\n-      }\n-\n-      this.httpRequestService.post('/student/profilePic', {}, formData)\n-          .subscribe(() => {\n-            this.statusMessageService.showSuccessMessage('Your profile picture has been saved successfully');\n-\n-            // force reload\n-            const timestamp: number = (new Date()).getTime();\n-            this.profilePicLink = `${this.backendUrl}/webapi/student/profilePic?${timestamp}&user=${this.id}`;\n-          }, (response: ErrorMessageOutput) => {\n-            this.statusMessageService.showErrorMessage(response.error.message);\n-          });\n-    }, () => {});\n+    this.getProfilePicture()\n+        // Return null if no picture is found\n+        .pipe(\n+            catchError(() => of(null)),\n+        )\n+        // Open Modal and wait for user to upload picture\n+        // Throw an error if there is no picture is uploaded\n+        .pipe(\n+            flatMap((image: Blob | null) => {\n+              const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n+              modalRef.componentInstance.image = image;\n+\n+              return from(modalRef.result);\n+            }),\n+            catchError(() => throwError({\n+              error: {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NjAwNQ=="}, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2ODY4MA==", "bodyText": "It should not be an error as users just dismiss the modal?", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373768680", "createdAt": "2020-02-01T09:22:40Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -112,25 +115,41 @@ export class StudentProfilePageComponent implements OnInit {\n    * Opens a modal box to upload/edit profile picture.\n    */\n   onUploadEdit(): void {\n-    const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n-    modalRef.componentInstance.profilePicLink = this.profilePicLink;\n-    modalRef.result.then((formData: FormData) => {\n-      if (!formData) {\n-        this.statusMessageService.showWarningMessage('No photo uploaded');\n-        return;\n-      }\n-\n-      this.httpRequestService.post('/student/profilePic', {}, formData)\n-          .subscribe(() => {\n-            this.statusMessageService.showSuccessMessage('Your profile picture has been saved successfully');\n-\n-            // force reload\n-            const timestamp: number = (new Date()).getTime();\n-            this.profilePicLink = `${this.backendUrl}/webapi/student/profilePic?${timestamp}&user=${this.id}`;\n-          }, (response: ErrorMessageOutput) => {\n-            this.statusMessageService.showErrorMessage(response.error.message);\n-          });\n-    }, () => {});\n+    this.getProfilePicture()\n+        // Return null if no picture is found\n+        .pipe(\n+            catchError(() => of(null)),\n+        )\n+        // Open Modal and wait for user to upload picture\n+        // Throw an error if there is no picture is uploaded\n+        .pipe(\n+            flatMap((image: Blob | null) => {\n+              const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n+              modalRef.componentInstance.image = image;\n+\n+              return from(modalRef.result);\n+            }),\n+            catchError(() => throwError({\n+              error: {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NjAwNQ=="}, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2OTMxNg==", "bodyText": "That makes a lot more sense, will do!", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373769316", "createdAt": "2020-02-01T09:35:16Z", "author": {"login": "tiuweehan"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -112,25 +115,41 @@ export class StudentProfilePageComponent implements OnInit {\n    * Opens a modal box to upload/edit profile picture.\n    */\n   onUploadEdit(): void {\n-    const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n-    modalRef.componentInstance.profilePicLink = this.profilePicLink;\n-    modalRef.result.then((formData: FormData) => {\n-      if (!formData) {\n-        this.statusMessageService.showWarningMessage('No photo uploaded');\n-        return;\n-      }\n-\n-      this.httpRequestService.post('/student/profilePic', {}, formData)\n-          .subscribe(() => {\n-            this.statusMessageService.showSuccessMessage('Your profile picture has been saved successfully');\n-\n-            // force reload\n-            const timestamp: number = (new Date()).getTime();\n-            this.profilePicLink = `${this.backendUrl}/webapi/student/profilePic?${timestamp}&user=${this.id}`;\n-          }, (response: ErrorMessageOutput) => {\n-            this.statusMessageService.showErrorMessage(response.error.message);\n-          });\n-    }, () => {});\n+    this.getProfilePicture()\n+        // Return null if no picture is found\n+        .pipe(\n+            catchError(() => of(null)),\n+        )\n+        // Open Modal and wait for user to upload picture\n+        // Throw an error if there is no picture is uploaded\n+        .pipe(\n+            flatMap((image: Blob | null) => {\n+              const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n+              modalRef.componentInstance.image = image;\n+\n+              return from(modalRef.result);\n+            }),\n+            catchError(() => throwError({\n+              error: {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NjAwNQ=="}, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkyMDc0NQ==", "bodyText": "I can't find a clean way to terminate a pipe in RxJs, so in the new implementation I have passed null down the pipe to indicate that the user didn't upload any picture.\nWould it be better to throw an error when the user does not upload any picture, but not display the error message to the user? Or is there a better alternative.", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373920745", "createdAt": "2020-02-03T04:46:42Z", "author": {"login": "tiuweehan"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -112,25 +115,41 @@ export class StudentProfilePageComponent implements OnInit {\n    * Opens a modal box to upload/edit profile picture.\n    */\n   onUploadEdit(): void {\n-    const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n-    modalRef.componentInstance.profilePicLink = this.profilePicLink;\n-    modalRef.result.then((formData: FormData) => {\n-      if (!formData) {\n-        this.statusMessageService.showWarningMessage('No photo uploaded');\n-        return;\n-      }\n-\n-      this.httpRequestService.post('/student/profilePic', {}, formData)\n-          .subscribe(() => {\n-            this.statusMessageService.showSuccessMessage('Your profile picture has been saved successfully');\n-\n-            // force reload\n-            const timestamp: number = (new Date()).getTime();\n-            this.profilePicLink = `${this.backendUrl}/webapi/student/profilePic?${timestamp}&user=${this.id}`;\n-          }, (response: ErrorMessageOutput) => {\n-            this.statusMessageService.showErrorMessage(response.error.message);\n-          });\n-    }, () => {});\n+    this.getProfilePicture()\n+        // Return null if no picture is found\n+        .pipe(\n+            catchError(() => of(null)),\n+        )\n+        // Open Modal and wait for user to upload picture\n+        // Throw an error if there is no picture is uploaded\n+        .pipe(\n+            flatMap((image: Blob | null) => {\n+              const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n+              modalRef.componentInstance.image = image;\n+\n+              return from(modalRef.result);\n+            }),\n+            catchError(() => throwError({\n+              error: {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NjAwNQ=="}, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkyNzQ2Mg==", "bodyText": "Would it be better to throw an error when the user does not upload any picture, but not display the error message to the user?\n\nI think so.", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373927462", "createdAt": "2020-02-03T05:31:04Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -112,25 +115,41 @@ export class StudentProfilePageComponent implements OnInit {\n    * Opens a modal box to upload/edit profile picture.\n    */\n   onUploadEdit(): void {\n-    const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n-    modalRef.componentInstance.profilePicLink = this.profilePicLink;\n-    modalRef.result.then((formData: FormData) => {\n-      if (!formData) {\n-        this.statusMessageService.showWarningMessage('No photo uploaded');\n-        return;\n-      }\n-\n-      this.httpRequestService.post('/student/profilePic', {}, formData)\n-          .subscribe(() => {\n-            this.statusMessageService.showSuccessMessage('Your profile picture has been saved successfully');\n-\n-            // force reload\n-            const timestamp: number = (new Date()).getTime();\n-            this.profilePicLink = `${this.backendUrl}/webapi/student/profilePic?${timestamp}&user=${this.id}`;\n-          }, (response: ErrorMessageOutput) => {\n-            this.statusMessageService.showErrorMessage(response.error.message);\n-          });\n-    }, () => {});\n+    this.getProfilePicture()\n+        // Return null if no picture is found\n+        .pipe(\n+            catchError(() => of(null)),\n+        )\n+        // Open Modal and wait for user to upload picture\n+        // Throw an error if there is no picture is uploaded\n+        .pipe(\n+            flatMap((image: Blob | null) => {\n+              const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n+              modalRef.componentInstance.image = image;\n+\n+              return from(modalRef.result);\n+            }),\n+            catchError(() => throwError({\n+              error: {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NjAwNQ=="}, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMTE1NjY3OnYy", "diffSide": "RIGHT", "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwODoxNDoyNlrOFkc3oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwODoxNDoyNlrOFkc3oQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2NjA0OQ==", "bodyText": "Looks like you master the rxjs pipe. Great job!", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r373766049", "createdAt": "2020-02-01T08:14:26Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-student/student-profile-page/student-profile-page.component.ts", "diffHunk": "@@ -112,25 +115,41 @@ export class StudentProfilePageComponent implements OnInit {\n    * Opens a modal box to upload/edit profile picture.\n    */\n   onUploadEdit(): void {\n-    const modalRef: NgbModalRef = this.ngbModal.open(UploadEditProfilePictureModalComponent);\n-    modalRef.componentInstance.profilePicLink = this.profilePicLink;\n-    modalRef.result.then((formData: FormData) => {\n-      if (!formData) {\n-        this.statusMessageService.showWarningMessage('No photo uploaded');\n-        return;\n-      }\n-\n-      this.httpRequestService.post('/student/profilePic', {}, formData)\n-          .subscribe(() => {\n-            this.statusMessageService.showSuccessMessage('Your profile picture has been saved successfully');\n-\n-            // force reload\n-            const timestamp: number = (new Date()).getTime();\n-            this.profilePicLink = `${this.backendUrl}/webapi/student/profilePic?${timestamp}&user=${this.id}`;\n-          }, (response: ErrorMessageOutput) => {\n-            this.statusMessageService.showErrorMessage(response.error.message);\n-          });\n-    }, () => {});\n+    this.getProfilePicture()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "862a5f09eb4ab16096cfb26eeb786a070cd8ed3b"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMzI1MjYzOnYy", "diffSide": "RIGHT", "path": "src/web/services/student-profile.service.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwNDo1MDowOFrOFmPM2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwNDo1MDowOFrOFmPM2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYzOTI1OA==", "bodyText": "Documentation?", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r375639258", "createdAt": "2020-02-06T04:50:08Z", "author": {"login": "xpdavid"}, "path": "src/web/services/student-profile.service.ts", "diffHunk": "@@ -41,4 +42,22 @@ export class StudentProfileService {\n     };\n     return this.httpRequestService.put('/student/profile', paramsMap, requestBody);\n   }\n+\n+  /**\n+   * Gets the profile picture as blob image.\n+   */\n+  getProfilePicture(): Observable<Blob> {\n+    return this.httpRequestService.get(this.profilePictureEndPoint, {}, 'blob');\n+  }\n+\n+  /**\n+   * Posts the profile picture.\n+   */\n+  postProfilePicture(formData: FormData): Observable<any> {\n+    return this.httpRequestService.post(this.profilePictureEndPoint, {}, formData);\n+  }\n+\n+  deleteProfilePictre(paramMap: { [key: string]: string }): Observable<any> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "092df9bd3762728ddc9d8fbb2e69860570bf65c3"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMzI1MzgyOnYy", "diffSide": "RIGHT", "path": "src/web/services/student-profile.service.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwNDo1MTowOFrOFmPNhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwNDo1NzowNVrOFmPR2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYzOTQyOQ==", "bodyText": "Though personally I think it is OK to use string literal here. Depends on how you want to standardize this. Either use it for all API call or not use it.", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r375639429", "createdAt": "2020-02-06T04:51:08Z", "author": {"login": "xpdavid"}, "path": "src/web/services/student-profile.service.ts", "diffHunk": "@@ -11,6 +11,7 @@ import { HttpRequestService } from './http-request.service';\n   providedIn: 'root',\n })\n export class StudentProfileService {\n+  profilePictureEndPoint: string = '/student/profilePic';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "092df9bd3762728ddc9d8fbb2e69860570bf65c3"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTY0MDUzNg==", "bodyText": "Ok I'll change it back and standardize it in a later PR", "url": "https://github.com/TEAMMATES/teammates/pull/9937#discussion_r375640536", "createdAt": "2020-02-06T04:57:05Z", "author": {"login": "tiuweehan"}, "path": "src/web/services/student-profile.service.ts", "diffHunk": "@@ -11,6 +11,7 @@ import { HttpRequestService } from './http-request.service';\n   providedIn: 'root',\n })\n export class StudentProfileService {\n+  profilePictureEndPoint: string = '/student/profilePic';", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYzOTQyOQ=="}, "originalCommit": {"oid": "092df9bd3762728ddc9d8fbb2e69860570bf65c3"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4045, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}