{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxMDEyNzI4", "number": 10622, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMjo0OTo0MFrOEau1tA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwMTo1NDo0MVrOEgwdDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NDY1ODQ0OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/ui/webapi/action/GetFeedbackSessionAction.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMjo0OTo0MFrOHEVz9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMjo0OTo0MFrOHEVz9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMxMzcxOQ==", "bodyText": "You should update this as well. This should require the MODIFY_SESSION privilege.", "url": "https://github.com/TEAMMATES/teammates/pull/10622#discussion_r474313719", "createdAt": "2020-08-20T22:49:40Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/ui/webapi/action/GetFeedbackSessionAction.java", "diffHunk": "@@ -38,10 +39,12 @@ public void checkSpecificAccessControl() {\n             gateKeeper.verifyAccessible(logic.getInstructorForGoogleId(courseId, userInfo.getId()), feedbackSession);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc23cd911d58bd8677dd7a70b01002d25d5bf832"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NDY2NTQ3OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/ui/webapi/action/GetFeedbackSessionAction.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMjo1Mjo0NlrOHEV4Fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMjo1Mjo0NlrOHEV4Fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMxNDc3NQ==", "bodyText": "This privilege is used to modify the session object itself. The privilege here should be INSTRUCTOR_PERMISSION_MODIFY_SESSION_COMMENT_IN_SECTIONS.\nI think there are a few places whereby this mistake happens. Let's take this time to correct them all.", "url": "https://github.com/TEAMMATES/teammates/pull/10622#discussion_r474314775", "createdAt": "2020-08-20T22:52:46Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/ui/webapi/action/GetFeedbackSessionAction.java", "diffHunk": "@@ -79,4 +82,19 @@ public ActionResult execute() {\n \n         return new JsonResult(response);\n     }\n+\n+    /**\n+     * Checks the access control for instructor feedback submission.\n+     */\n+    private void checkInstructorForSessionAccessPrivilege(FeedbackSessionAttributes feedbackSession) {\n+        String moderatedPerson = getRequestParamValue(Const.ParamsNames.FEEDBACK_SESSION_MODERATED_PERSON);\n+        gateKeeper.verifyLoggedInUserPrivileges();\n+        if (StringHelper.isEmpty(moderatedPerson)) {\n+            gateKeeper.verifyAccessible(logic.getInstructorForGoogleId(feedbackSession.getCourseId(), userInfo.getId()),\n+                    feedbackSession, Const.ParamsNames.INSTRUCTOR_PERMISSION_VIEW_SESSION_IN_SECTIONS);\n+        } else {\n+            gateKeeper.verifyAccessible(logic.getInstructorForGoogleId(feedbackSession.getCourseId(), userInfo.getId()),\n+                    feedbackSession, Const.ParamsNames.INSTRUCTOR_PERMISSION_MODIFY_SESSION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc23cd911d58bd8677dd7a70b01002d25d5bf832"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NTAxMTYxOnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/ui/webapi/action/GetFeedbackSessionAction.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwMjowMzowMlrOHEZCjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwNDowODo1OFrOHIo0uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM2NjYwNQ==", "bodyText": "Why there is a moderatedPerson here?", "url": "https://github.com/TEAMMATES/teammates/pull/10622#discussion_r474366605", "createdAt": "2020-08-21T02:03:02Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/action/GetFeedbackSessionAction.java", "diffHunk": "@@ -79,4 +82,19 @@ public ActionResult execute() {\n \n         return new JsonResult(response);\n     }\n+\n+    /**\n+     * Checks the access control for instructor feedback submission.\n+     */\n+    private void checkInstructorForSessionAccessPrivilege(FeedbackSessionAttributes feedbackSession) {\n+        String moderatedPerson = getRequestParamValue(Const.ParamsNames.FEEDBACK_SESSION_MODERATED_PERSON);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc23cd911d58bd8677dd7a70b01002d25d5bf832"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM5ODgxMA==", "bodyText": "This method is supposed to validate any access with intent INSTRUCTOR_RESULT which includes access to this action with non null FEEDBACK_SESSION_MODERATED_PERSON param. See: \n  \n    \n      teammates/src/test/java/teammates/test/cases/webapi/GetFeedbackSessionActionTest.java\n    \n    \n        Lines 215 to 221\n      in\n      bc23cd9\n    \n    \n    \n    \n\n        \n          \n           ______TS(\"Instructor moderates instructor submission with correct privilege will pass\"); \n        \n\n        \n          \n            \n        \n\n        \n          \n           InstructorAttributes instructor1OfCourse1 = typicalBundle.instructors.get(\"instructor1OfCourse1\"); \n        \n\n        \n          \n           params = generateParameters(feedbackSession, intent, \"\", instructor1OfCourse1.email, \"\"); \n        \n\n        \n          \n            \n        \n\n        \n          \n           verifyOnlyInstructorsOfTheSameCourseWithCorrectCoursePrivilegeCanAccess( \n        \n\n        \n          \n                   Const.ParamsNames.INSTRUCTOR_PERMISSION_MODIFY_SESSION, params);", "url": "https://github.com/TEAMMATES/teammates/pull/10622#discussion_r474398810", "createdAt": "2020-08-21T04:15:33Z", "author": {"login": "madanalogy"}, "path": "src/main/java/teammates/ui/webapi/action/GetFeedbackSessionAction.java", "diffHunk": "@@ -79,4 +82,19 @@ public ActionResult execute() {\n \n         return new JsonResult(response);\n     }\n+\n+    /**\n+     * Checks the access control for instructor feedback submission.\n+     */\n+    private void checkInstructorForSessionAccessPrivilege(FeedbackSessionAttributes feedbackSession) {\n+        String moderatedPerson = getRequestParamValue(Const.ParamsNames.FEEDBACK_SESSION_MODERATED_PERSON);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM2NjYwNQ=="}, "originalCommit": {"oid": "bc23cd911d58bd8677dd7a70b01002d25d5bf832"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQwMDA4OQ==", "bodyText": "That's precisely because of the misconfiguration. Moderated person makes no sense when we're talking about instructor result page.", "url": "https://github.com/TEAMMATES/teammates/pull/10622#discussion_r474400089", "createdAt": "2020-08-21T04:21:38Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/ui/webapi/action/GetFeedbackSessionAction.java", "diffHunk": "@@ -79,4 +82,19 @@ public ActionResult execute() {\n \n         return new JsonResult(response);\n     }\n+\n+    /**\n+     * Checks the access control for instructor feedback submission.\n+     */\n+    private void checkInstructorForSessionAccessPrivilege(FeedbackSessionAttributes feedbackSession) {\n+        String moderatedPerson = getRequestParamValue(Const.ParamsNames.FEEDBACK_SESSION_MODERATED_PERSON);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM2NjYwNQ=="}, "originalCommit": {"oid": "bc23cd911d58bd8677dd7a70b01002d25d5bf832"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxOTUxNQ==", "bodyText": "I've pushed a refactoring of the access control mechanisms. Please help to check if I understood the nature of the misconfiguration.", "url": "https://github.com/TEAMMATES/teammates/pull/10622#discussion_r478819515", "createdAt": "2020-08-28T04:08:58Z", "author": {"login": "madanalogy"}, "path": "src/main/java/teammates/ui/webapi/action/GetFeedbackSessionAction.java", "diffHunk": "@@ -79,4 +82,19 @@ public ActionResult execute() {\n \n         return new JsonResult(response);\n     }\n+\n+    /**\n+     * Checks the access control for instructor feedback submission.\n+     */\n+    private void checkInstructorForSessionAccessPrivilege(FeedbackSessionAttributes feedbackSession) {\n+        String moderatedPerson = getRequestParamValue(Const.ParamsNames.FEEDBACK_SESSION_MODERATED_PERSON);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM2NjYwNQ=="}, "originalCommit": {"oid": "bc23cd911d58bd8677dd7a70b01002d25d5bf832"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzIwNTAxOnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/ui/webapi/action/BasicFeedbackSubmissionAction.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzo0MjozOFrOHJPMcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzo0MjozOFrOHJPMcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0ODE3Nw==", "bodyText": "The previous setting INSTRUCTOR_PERMISSION_MODIFY_SESSION is correct for previewing. This is correct for moderation only. Refer to checkAccessControlForStudentFeedbackSubmission.", "url": "https://github.com/TEAMMATES/teammates/pull/10622#discussion_r479448177", "createdAt": "2020-08-28T17:42:38Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/ui/webapi/action/BasicFeedbackSubmissionAction.java", "diffHunk": "@@ -126,7 +126,7 @@ protected void checkAccessControlForInstructorFeedbackSubmission(\n         } else {\n             gateKeeper.verifyLoggedInUserPrivileges();\n             gateKeeper.verifyAccessible(logic.getInstructorForGoogleId(feedbackSession.getCourseId(), userInfo.getId()),\n-                    feedbackSession, Const.ParamsNames.INSTRUCTOR_PERMISSION_MODIFY_SESSION);\n+                    feedbackSession, Const.ParamsNames.INSTRUCTOR_PERMISSION_MODIFY_SESSION_COMMENT_IN_SECTIONS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3aa36a12a88dc9bc6cc9fccac28b64b99fba1c86"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNzgzNzU5OnYy", "diffSide": "RIGHT", "path": "src/test/java/teammates/test/cases/webapi/GetFeedbackQuestionRecipientsActionTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwMTo1NDo0MVrOHNuAsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwMTo1NDo0MVrOHNuAsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDE0NzM3OQ==", "bodyText": "Note that this is an unintended change", "url": "https://github.com/TEAMMATES/teammates/pull/10622#discussion_r484147379", "createdAt": "2020-09-07T01:54:41Z", "author": {"login": "wkurniawan07"}, "path": "src/test/java/teammates/test/cases/webapi/GetFeedbackQuestionRecipientsActionTest.java", "diffHunk": "@@ -291,15 +291,17 @@ protected void testAccessControl_instructorSubmission()\n                 generateParameters(firstSessionInCourse1, 3, Intent.INSTRUCTOR_SUBMISSION,\n                         \"\", instructor1OfCourse1.email, \"\");\n         verifyOnlyInstructorsOfTheSameCourseWithCorrectCoursePrivilegeCanAccess(\n-                Const.ParamsNames.INSTRUCTOR_PERMISSION_MODIFY_SESSION, moderatedInstructorSubmissionParams);\n+                Const.ParamsNames.INSTRUCTOR_PERMISSION_MODIFY_SESSION_COMMENT_IN_SECTIONS,\n+                moderatedInstructorSubmissionParams);\n \n         ______TS(\"Instructor previews another instructor's question,\"\n                 + \" should be accessible if he has privilege\");\n         String[] previewInstructorSubmissionParams =\n                 generateParameters(firstSessionInCourse1, 3, Intent.INSTRUCTOR_SUBMISSION,\n                         \"\", \"\", instructor1OfCourse1.email);\n         verifyOnlyInstructorsOfTheSameCourseWithCorrectCoursePrivilegeCanAccess(\n-                Const.ParamsNames.INSTRUCTOR_PERMISSION_MODIFY_SESSION, previewInstructorSubmissionParams);\n+                Const.ParamsNames.INSTRUCTOR_PERMISSION_MODIFY_SESSION,\n+                previewInstructorSubmissionParams);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b593c75394fdeb8581ca6442352a80dd7e0ab39d"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3499, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}