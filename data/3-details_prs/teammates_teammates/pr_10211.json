{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2ODIwMzQx", "number": 10211, "title": "[#10176] Fix statistics-related problems in session results page", "bodyText": "Part of #10176\nThis fixes the following tickets:\n\nNumerical scale statistics duplicated when collapsing and expanding the result tab\nGRQ, RGQ, GQR, RQG alice betsy > alice betsy, q14 missing (also observed in V6)\nGRQ/RGQ/GQR/RQG view: Teams displayed in sections they don't belong to\nIn GRQ/RGQ view, the show statistics option should be disable as no statistics are shown\nGQR/RQG view: missing team statistics\nQuestion View > Any section > statistics table do not update to show the statistics of the filtered responses\nNo response behavior different (V7 shows result with no response, V6 omits them)\nIn student all records page, if there are no responses for a student, V6 displays a No feedback for xxx found. But in V7, all tabs are shown (same issue as the previous item)", "createdAt": "2020-06-19T00:08:36Z", "url": "https://github.com/TEAMMATES/teammates/pull/10211", "merged": true, "mergeCommit": {"oid": "2ebfaf2043e393b879e86021edd3b0f2ff5d7e44"}, "closed": true, "closedAt": "2020-06-22T01:41:00Z", "author": {"login": "wkurniawan07"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcspdZZAFqTQzMzc1MzIzNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABctmugkAFqTQzNDU1ODcxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNzUzMjM0", "url": "https://github.com/TEAMMATES/teammates/pull/10211#pullrequestreview-433753234", "createdAt": "2020-06-19T01:51:55Z", "commit": {"oid": "5a67585cd8b7e20450daf858ef5cd5bf4703ea06"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwMTo1MTo1NVrOGmFg4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwMjoxNjowOFrOGmF3Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU4OTQxMA==", "bodyText": "I think if this is the case:\n\nThe sectionType GIVER, EVALUEE will be invalid under G** or R** view or it is really confused.", "url": "https://github.com/TEAMMATES/teammates/pull/10211#discussion_r442589410", "createdAt": "2020-06-19T01:51:55Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/gqr-rqg-view-responses/gqr-rqg-view-responses.component.ts", "diffHunk": "@@ -86,19 +86,26 @@ export class GqrRqgViewResponsesComponent extends InstructorResponsesViewBase im\n           // filter out missing responses\n           continue;\n         }\n-        if (response.giverEmail) {\n-          this.userToEmail[response.giver] = response.giverEmail;\n-        }\n-        if (response.recipientEmail) {\n-          this.userToEmail[response.recipient] = response.recipientEmail;\n-        }\n \n+        if (this.section) {\n+          if (this.isGqr && response.giverSection !== this.section", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a67585cd8b7e20450daf858ef5cd5bf4703ea06"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU5MTE3Mg==", "bodyText": "The checkbox should also be unchecked (to show that stats is not enabled and not allowed to enabled).", "url": "https://github.com/TEAMMATES/teammates/pull/10211#discussion_r442591172", "createdAt": "2020-06-19T01:59:15Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/instructor-session-result-page/instructor-session-result-page.component.html", "diffHunk": "@@ -109,7 +109,7 @@ <h1>\n         <label class=\"form-check-label\" ngbTooltip=\"Group results in the current view by team\"><input type=\"checkbox\" [(ngModel)]=\"groupByTeam\" [disabled]=\"viewType === 'QUESTION'\"> Group by Teams</label>\n       </div>\n       <div>\n-        <label class=\"form-check-label\"  ngbTooltip=\"Show statistics\"><input type=\"checkbox\" [(ngModel)]=\"showStatistics\"> Show Statistics</label>\n+        <label class=\"form-check-label\" ngbTooltip=\"Show statistics\"><input type=\"checkbox\" [(ngModel)]=\"showStatistics\" [disabled]=\"viewType === 'GRQ' || viewType === 'RGQ'\"> Show Statistics</label>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "307962328a78300b2887802afa11af2b2494ff5c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU5MzI2OA==", "bodyText": "this.hasNonMissingResponses  -> this.hasRealResponses (or we can just go opposite this.areAllMissingResponses). Reasons: The name hasNonMissingResponses seems it requires non missing response while it is not true in the case.\n\n\nAnd to save code :P\n\n\nthis.hasNonMissingResponses = this.responses.some((question) => question.allResponses.some((response) => !response.isMissingResponse))", "url": "https://github.com/TEAMMATES/teammates/pull/10211#discussion_r442593268", "createdAt": "2020-06-19T02:07:48Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/grouped-responses/grouped-responses.component.ts", "diffHunk": "@@ -42,11 +42,24 @@ export class GroupedResponsesComponent extends InstructorResponsesViewBase imple\n     createdAtTimestamp: 0,\n   };\n \n+  hasNonMissingResponses: boolean = false;\n+\n   constructor() {\n     super();\n   }\n \n   ngOnInit(): void {\n+    for (const question of this.responses) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3af11f1123071f3a5ffb834a12c7a6b5d05990ad"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU5Mzk1Mg==", "bodyText": "Same naming issue here.", "url": "https://github.com/TEAMMATES/teammates/pull/10211#discussion_r442593952", "createdAt": "2020-06-19T02:10:51Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/grq-rgq-view-responses/grq-rgq-view-responses.component.ts", "diffHunk": "@@ -56,6 +56,7 @@ export class GrqRgqViewResponsesComponent extends InstructorResponsesViewBase im\n   userExpanded: Record<string, boolean> = {};\n \n   responsesToShow: Record<string, Record<string, QuestionOutput[]>> = {};\n+  userHasNonMissingResponses: Record<string, boolean> = {};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3af11f1123071f3a5ffb834a12c7a6b5d05990ad"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU5NDA0MA==", "bodyText": "this.userHasNonMissingResponses[user] = questionCopy2.allResponses.some((response: ResponseOutput) => !response.isMissingResponse)", "url": "https://github.com/TEAMMATES/teammates/pull/10211#discussion_r442594040", "createdAt": "2020-06-19T02:11:09Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/grq-rgq-view-responses/grq-rgq-view-responses.component.ts", "diffHunk": "@@ -174,6 +178,14 @@ export class GrqRgqViewResponsesComponent extends InstructorResponsesViewBase im\n             this.responsesToShow[user] = this.responsesToShow[user] || {};\n             this.responsesToShow[user][other] = this.responsesToShow[user][other] || [];\n             this.responsesToShow[user][other].push(questionCopy2);\n+\n+            if (!this.userHasNonMissingResponses[user]) {\n+              const hasNonMissingResponse: boolean =\n+                  !!questionCopy2.allResponses.filter((response: ResponseOutput) => !response.isMissingResponse).length;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3af11f1123071f3a5ffb834a12c7a6b5d05990ad"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU5NTEzNA==", "bodyText": "So we are saying if all responses are missing responses then we are going to show it as no response? Looks confusing under the case where indicateMissingResponses is true.", "url": "https://github.com/TEAMMATES/teammates/pull/10211#discussion_r442595134", "createdAt": "2020-06-19T02:16:08Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/per-question-view-responses/per-question-view-responses.component.ts", "diffHunk": "@@ -89,7 +89,14 @@ export class PerQuestionViewResponsesComponent extends InstructorResponsesViewBa\n \n       responsesToShow.push(response);\n     }\n-    this.responsesToShow = responsesToShow;\n+\n+    const hasNonMissingResponse: boolean =\n+        !!responsesToShow.filter((response: ResponseOutput) => !response.isMissingResponse).length;\n+    if (hasNonMissingResponse) {\n+      this.responsesToShow = responsesToShow;\n+    } else {\n+      this.responsesToShow = [];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3af11f1123071f3a5ffb834a12c7a6b5d05990ad"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3af11f1123071f3a5ffb834a12c7a6b5d05990ad", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/3af11f1123071f3a5ffb834a12c7a6b5d05990ad", "committedDate": "2020-06-18T23:16:47Z", "message": "Modify presentation of no responses"}, "afterCommit": {"oid": "a83abaf0770cb39c44085a0a5185ea90bd26e4dc", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/a83abaf0770cb39c44085a0a5185ea90bd26e4dc", "committedDate": "2020-06-19T14:21:11Z", "message": "Modify presentation of no responses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDQ5MTIw", "url": "https://github.com/TEAMMATES/teammates/pull/10211#pullrequestreview-434449120", "createdAt": "2020-06-20T19:33:08Z", "commit": {"oid": "363f7b730ebf3c8aeff9713106bbc39974af47de"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxOTozMzowOFrOGmoAIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxOTo0Mzo0NFrOGmoCgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1NDQ2NQ==", "bodyText": "I think somehow later we should just hide the options. In addition, I think if we do this properly, we might not need this if check and the isFeedbackResponsesDisplayedOnSection can filter responses already.", "url": "https://github.com/TEAMMATES/teammates/pull/10211#discussion_r443154465", "createdAt": "2020-06-20T19:33:08Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/gqr-rqg-view-responses/gqr-rqg-view-responses.component.ts", "diffHunk": "@@ -86,19 +86,26 @@ export class GqrRqgViewResponsesComponent extends InstructorResponsesViewBase im\n           // filter out missing responses\n           continue;\n         }\n-        if (response.giverEmail) {\n-          this.userToEmail[response.giver] = response.giverEmail;\n-        }\n-        if (response.recipientEmail) {\n-          this.userToEmail[response.recipient] = response.recipientEmail;\n-        }\n \n+        if (this.section) {\n+          if (this.isGqr && response.giverSection !== this.section", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU4OTQxMA=="}, "originalCommit": {"oid": "5a67585cd8b7e20450daf858ef5cd5bf4703ea06"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1NDkxOA==", "bodyText": "Are we going to address this?\n\nThe checkbox should also be unchecked (to show that stats is not enabled and not allowed to enabled).", "url": "https://github.com/TEAMMATES/teammates/pull/10211#discussion_r443154918", "createdAt": "2020-06-20T19:40:54Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/instructor-session-result-page/instructor-session-result-page.component.html", "diffHunk": "@@ -109,7 +109,7 @@ <h1>\n         <label class=\"form-check-label\" ngbTooltip=\"Group results in the current view by team\"><input type=\"checkbox\" [(ngModel)]=\"groupByTeam\" [disabled]=\"viewType === 'QUESTION'\"> Group by Teams</label>\n       </div>\n       <div>\n-        <label class=\"form-check-label\"  ngbTooltip=\"Show statistics\"><input type=\"checkbox\" [(ngModel)]=\"showStatistics\"> Show Statistics</label>\n+        <label class=\"form-check-label\" ngbTooltip=\"Show statistics\"><input type=\"checkbox\" [(ngModel)]=\"showStatistics\" [disabled]=\"viewType === 'GRQ' || viewType === 'RGQ'\"> Show Statistics</label>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU5MTE3Mg=="}, "originalCommit": {"oid": "307962328a78300b2887802afa11af2b2494ff5c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1NTA3NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          const hasRealResponse: boolean =\n          \n          \n            \n                          this.userHasRealResponses[user] =\n          \n      \n    \n    \n  \n\ncan be simplified :P", "url": "https://github.com/TEAMMATES/teammates/pull/10211#discussion_r443155075", "createdAt": "2020-06-20T19:43:44Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/grq-rgq-view-responses/grq-rgq-view-responses.component.ts", "diffHunk": "@@ -174,6 +178,14 @@ export class GrqRgqViewResponsesComponent extends InstructorResponsesViewBase im\n             this.responsesToShow[user] = this.responsesToShow[user] || {};\n             this.responsesToShow[user][other] = this.responsesToShow[user][other] || [];\n             this.responsesToShow[user][other].push(questionCopy2);\n+\n+            if (!this.userHasRealResponses[user]) {\n+              const hasRealResponse: boolean =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a83abaf0770cb39c44085a0a5185ea90bd26e4dc"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "371e49beafdaf1f093c711c056e55a37d14f5fe2", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/371e49beafdaf1f093c711c056e55a37d14f5fe2", "committedDate": "2020-06-21T16:26:44Z", "message": "Fix problem in sample data where Alice belongs in wrong section"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6bede3473f2bde45d3123e885026b1b8afd308e", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/b6bede3473f2bde45d3123e885026b1b8afd308e", "committedDate": "2020-06-21T16:26:44Z", "message": "Fix NPE when retrieving team-to-team question responses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "742e5b15f2b90b51c2d74a678094b210aebc76f2", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/742e5b15f2b90b51c2d74a678094b210aebc76f2", "committedDate": "2020-06-21T16:26:44Z", "message": "Fix section filtering for non-question view"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "734fadbb98a262c3e2faf2fbbe9ef644c504623f", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/734fadbb98a262c3e2faf2fbbe9ef644c504623f", "committedDate": "2020-06-21T16:26:44Z", "message": "Disable \"Show statistics\" in GRQ/RGQ mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f097a97f3d1d57235ca4eeeb4fc262f8fd732bc3", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/f097a97f3d1d57235ca4eeeb4fc262f8fd732bc3", "committedDate": "2020-06-21T16:26:44Z", "message": "Add statistics for given/received responses in GQR/RQG view"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2e151729df35f90c5d7af0c8a5b705c8bfa52e2", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/c2e151729df35f90c5d7af0c8a5b705c8bfa52e2", "committedDate": "2020-06-21T16:26:44Z", "message": "Filter responses based on section for question statistics"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a83abaf0770cb39c44085a0a5185ea90bd26e4dc", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/a83abaf0770cb39c44085a0a5185ea90bd26e4dc", "committedDate": "2020-06-19T14:21:11Z", "message": "Modify presentation of no responses"}, "afterCommit": {"oid": "433d771a36cbbe984338cc62c5b393f858e2cb26", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/433d771a36cbbe984338cc62c5b393f858e2cb26", "committedDate": "2020-06-21T16:26:44Z", "message": "Modify presentation of no responses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebe516bffa4eb506ab6a4d4aadae9fe232606c05", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/ebe516bffa4eb506ab6a4d4aadae9fe232606c05", "committedDate": "2020-06-22T00:51:31Z", "message": "Modify presentation of no responses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "433d771a36cbbe984338cc62c5b393f858e2cb26", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/433d771a36cbbe984338cc62c5b393f858e2cb26", "committedDate": "2020-06-21T16:26:44Z", "message": "Modify presentation of no responses"}, "afterCommit": {"oid": "ebe516bffa4eb506ab6a4d4aadae9fe232606c05", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/ebe516bffa4eb506ab6a4d4aadae9fe232606c05", "committedDate": "2020-06-22T00:51:31Z", "message": "Modify presentation of no responses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTU4NzE1", "url": "https://github.com/TEAMMATES/teammates/pull/10211#pullrequestreview-434558715", "createdAt": "2020-06-22T01:39:52Z", "commit": {"oid": "ebe516bffa4eb506ab6a4d4aadae9fe232606c05"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4357, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}