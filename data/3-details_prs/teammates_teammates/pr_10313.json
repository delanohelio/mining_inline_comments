{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4Nzc1NzQz", "number": 10313, "title": "[#9673] Fix feedback session names with '+' encoding", "bodyText": "Fixes #9673, Closes #9713\nAdds a custom HTTP parameter encoder and URL serialiser\nCredits to @crizyli for original design and implementation.", "createdAt": "2020-07-14T09:53:23Z", "url": "https://github.com/TEAMMATES/teammates/pull/10313", "merged": true, "mergeCommit": {"oid": "966c11c879fc54027088daef427eeb345145c7dd"}, "closed": true, "closedAt": "2020-07-18T09:12:33Z", "author": {"login": "madanalogy"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABauPVUKgH2gAyNDQ4Nzc1NzQzOjJjMzFiNmE5Yzc1YjgzYWMxMDRiMGQ5NzIwMjMwNjE4MWY2YTMyNzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc2EUreAH2gAyNDQ4Nzc1NzQzOjEwODc3MjFlNzUyNGQ3NmFlYmUwYjVkZTg5NzkxNDU1OGYzZTRmODA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2c31b6a9c75b83ac104b0d97202306181f6a3274", "author": {"user": {"login": "crizyli", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/2c31b6a9c75b83ac104b0d97202306181f6a3274", "committedDate": "2019-05-23T08:36:09Z", "message": "add custom httpparameter encode and url encoder to accept plus sign"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f8252c6a28788e194134edbf090005aa07fa73d", "author": {"user": {"login": "crizyli", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/7f8252c6a28788e194134edbf090005aa07fa73d", "committedDate": "2019-06-07T03:02:00Z", "message": "add test for custom url serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9d36ef411c861d45935fceb6983d27525d1a431", "author": {"user": {"login": "crizyli", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/b9d36ef411c861d45935fceb6983d27525d1a431", "committedDate": "2019-06-07T05:02:57Z", "message": "update method doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c6b7cec4c041d8ded19274ea4679a204db96422", "author": {"user": {"login": "crizyli", "name": null}}, "url": "https://github.com/TEAMMATES/teammates/commit/8c6b7cec4c041d8ded19274ea4679a204db96422", "committedDate": "2019-06-19T07:15:49Z", "message": "update doc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "67c1489b1cd65fb60973790675c1b893bfbe6659", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/67c1489b1cd65fb60973790675c1b893bfbe6659", "committedDate": "2020-07-14T09:41:26Z", "message": "Merge branch 'master' into 9673-9713\n\n# Conflicts:\n#\tsrc/web/app/app.module.ts\n#\tsrc/web/services/http-request.service.ts"}, "afterCommit": {"oid": "4fb76615cf2f63eb81c517654f81b5a35c337ebc", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/4fb76615cf2f63eb81c517654f81b5a35c337ebc", "committedDate": "2020-07-14T09:57:14Z", "message": "Merge branch 'master' into 9673-9713\n\n# Conflicts:\n#\tsrc/web/app/app.module.ts\n#\tsrc/web/services/http-request.service.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df32feffab7d5c86b9abd8b3883e1c090a967a76", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/df32feffab7d5c86b9abd8b3883e1c090a967a76", "committedDate": "2020-07-14T14:23:47Z", "message": "Merge branch 'master' into 9673-9713\n\n# Conflicts:\n#\tsrc/web/app/app.module.ts\n#\tsrc/web/services/http-request.service.ts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4fb76615cf2f63eb81c517654f81b5a35c337ebc", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/4fb76615cf2f63eb81c517654f81b5a35c337ebc", "committedDate": "2020-07-14T09:57:14Z", "message": "Merge branch 'master' into 9673-9713\n\n# Conflicts:\n#\tsrc/web/app/app.module.ts\n#\tsrc/web/services/http-request.service.ts"}, "afterCommit": {"oid": "df32feffab7d5c86b9abd8b3883e1c090a967a76", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/df32feffab7d5c86b9abd8b3883e1c090a967a76", "committedDate": "2020-07-14T14:23:47Z", "message": "Merge branch 'master' into 9673-9713\n\n# Conflicts:\n#\tsrc/web/app/app.module.ts\n#\tsrc/web/services/http-request.service.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c840e701554cbe37e6df9189a2c34cbefd38d6b9", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/c840e701554cbe37e6df9189a2c34cbefd38d6b9", "committedDate": "2020-07-14T14:37:26Z", "message": "Clean up docs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e5c7a72937077f7941477764a64b21561afd9ea", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/0e5c7a72937077f7941477764a64b21561afd9ea", "committedDate": "2020-07-14T14:34:00Z", "message": "Clean up CustomEncoder docs"}, "afterCommit": {"oid": "c840e701554cbe37e6df9189a2c34cbefd38d6b9", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/c840e701554cbe37e6df9189a2c34cbefd38d6b9", "committedDate": "2020-07-14T14:37:26Z", "message": "Clean up docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NTk4Mjk0", "url": "https://github.com/TEAMMATES/teammates/pull/10313#pullrequestreview-448598294", "createdAt": "2020-07-15T03:07:51Z", "commit": {"oid": "c840e701554cbe37e6df9189a2c34cbefd38d6b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMzowNzo1MVrOGxsjFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMzowNzo1MVrOGxsjFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2MzI4Nw==", "bodyText": "Does it get fixed in Angular 9\n\n\nCan we extend HttpUrlEncodingCodec and only override encodeValue.", "url": "https://github.com/TEAMMATES/teammates/pull/10313#discussion_r454763287", "createdAt": "2020-07-15T03:07:51Z", "author": {"login": "xpdavid"}, "path": "src/web/services/http-request.service.ts", "diffHunk": "@@ -1,10 +1,35 @@\n-import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';\n+import { HttpClient, HttpHeaders, HttpParameterCodec, HttpParams } from '@angular/common/http';\n import { Injectable } from '@angular/core';\n import { Observable } from 'rxjs';\n import { environment } from '../environments/environment';\n import { ResourceEndpoints } from '../types/api-endpoints';\n import { MasqueradeModeService } from './masquerade-mode.service';\n \n+/**\n+ * This encoder was created to support encoding and decoding of plus (+) signs.\n+ *\n+ * Angular will ignore the encoding for plus signs. Refer to:\n+ * https://github.com/angular/angular/blob/8.0.0/packages/common/http/src/params.ts#L33\n+ */\n+class CustomEncoder implements HttpParameterCodec {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c840e701554cbe37e6df9189a2c34cbefd38d6b9"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NjIxMzgw", "url": "https://github.com/TEAMMATES/teammates/pull/10313#pullrequestreview-448621380", "createdAt": "2020-07-15T04:32:20Z", "commit": {"oid": "c840e701554cbe37e6df9189a2c34cbefd38d6b9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNDozMjoyMFrOGxt3LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwNDozMjoyMFrOGxt3LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc4NDgxMw==", "bodyText": "https://github.com/angular/angular/blob/9.0.0/packages/common/http/src/params.ts#L81-L92\nThere should be a reason why they do it like this. Should just copy that and modify accordingly (if my hunch is right, remove line 88).", "url": "https://github.com/TEAMMATES/teammates/pull/10313#discussion_r454784813", "createdAt": "2020-07-15T04:32:20Z", "author": {"login": "wkurniawan07"}, "path": "src/web/services/http-request.service.ts", "diffHunk": "@@ -1,10 +1,35 @@\n-import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';\n+import { HttpClient, HttpHeaders, HttpParameterCodec, HttpParams } from '@angular/common/http';\n import { Injectable } from '@angular/core';\n import { Observable } from 'rxjs';\n import { environment } from '../environments/environment';\n import { ResourceEndpoints } from '../types/api-endpoints';\n import { MasqueradeModeService } from './masquerade-mode.service';\n \n+/**\n+ * This encoder was created to support encoding and decoding of plus (+) signs.\n+ *\n+ * Angular will ignore the encoding for plus signs. Refer to:\n+ * https://github.com/angular/angular/blob/8.0.0/packages/common/http/src/params.ts#L33\n+ */\n+class CustomEncoder implements HttpParameterCodec {\n+\n+  encodeKey(key: string): string {\n+    return encodeURIComponent(key);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c840e701554cbe37e6df9189a2c34cbefd38d6b9"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d086e9cb306718aa9d7bd586297a5db61705355b", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/d086e9cb306718aa9d7bd586297a5db61705355b", "committedDate": "2020-07-15T13:55:21Z", "message": "Refactor CustomEncoder to use HttpUrlEncodingCodec"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MTMyNDQz", "url": "https://github.com/TEAMMATES/teammates/pull/10313#pullrequestreview-449132443", "createdAt": "2020-07-15T16:46:42Z", "commit": {"oid": "d086e9cb306718aa9d7bd586297a5db61705355b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNjo0Njo0MlrOGyGhjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNjo0Njo0MlrOGyGhjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE4ODg3OQ==", "bodyText": "The url should be updated.", "url": "https://github.com/TEAMMATES/teammates/pull/10313#discussion_r455188879", "createdAt": "2020-07-15T16:46:42Z", "author": {"login": "xpdavid"}, "path": "src/web/services/http-request.service.ts", "diffHunk": "@@ -1,10 +1,35 @@\n-import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';\n+import { HttpClient, HttpHeaders, HttpParams, HttpUrlEncodingCodec } from '@angular/common/http';\n import { Injectable } from '@angular/core';\n import { Observable } from 'rxjs';\n import { environment } from '../environments/environment';\n import { ResourceEndpoints } from '../types/api-endpoints';\n import { MasqueradeModeService } from './masquerade-mode.service';\n \n+/**\n+ * This encoder was created to support encoding and decoding of plus (+) signs.\n+ *\n+ * Angular will ignore the encoding for plus signs. Refer to:\n+ * https://github.com/angular/angular/blob/8.0.0/packages/common/http/src/params.ts#L33", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d086e9cb306718aa9d7bd586297a5db61705355b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c58c7e41006cc9e6f5726dd3ed18b7ae8ba64e6", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/7c58c7e41006cc9e6f5726dd3ed18b7ae8ba64e6", "committedDate": "2020-07-16T00:58:02Z", "message": "Update method reference link"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NTUxMzY4", "url": "https://github.com/TEAMMATES/teammates/pull/10313#pullrequestreview-449551368", "createdAt": "2020-07-16T06:51:07Z", "commit": {"oid": "7c58c7e41006cc9e6f5726dd3ed18b7ae8ba64e6"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNjo1MTowN1rOGyccyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwNjo1MzoxN1rOGycgig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTU0ODEwNQ==", "bodyText": "Can use stricter type\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            const customUrlSerializerProvider: any = {\n          \n          \n            \n            const customUrlSerializerProvider: ValueProvider = {", "url": "https://github.com/TEAMMATES/teammates/pull/10313#discussion_r455548105", "createdAt": "2020-07-16T06:51:07Z", "author": {"login": "ccyccyccy"}, "path": "src/web/app/app.module.ts", "diffHunk": "@@ -16,13 +16,19 @@ import {\n   StatusMesssageModalModule,\n } from './components/status-message/status-messsage-modal/status-messsage-modal.module';\n import { ToastModule } from './components/toast/toast.module';\n+import { CustomUrlSerializer } from './custom-url-serializer';\n import { ClickOutsideDirective, PageComponent } from './page.component';\n import { AdminPageComponent } from './pages-admin/admin-page.component';\n import { InstructorPageComponent } from './pages-instructor/instructor-page.component';\n import { StaticPageComponent } from './pages-static/static-page.component';\n import { StudentPageComponent } from './pages-student/student-page.component';\n import { PublicPageComponent } from './public-page.component';\n \n+const customUrlSerializer: CustomUrlSerializer = new CustomUrlSerializer();\n+const customUrlSerializerProvider: any = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c58c7e41006cc9e6f5726dd3ed18b7ae8ba64e6"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTU0OTA2Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              parse(url: any): UrlTree {\n          \n          \n            \n              parse(url: string): UrlTree {", "url": "https://github.com/TEAMMATES/teammates/pull/10313#discussion_r455549066", "createdAt": "2020-07-16T06:53:17Z", "author": {"login": "ccyccyccy"}, "path": "src/web/app/custom-url-serializer.ts", "diffHunk": "@@ -0,0 +1,16 @@\n+import { DefaultUrlSerializer, UrlSerializer, UrlTree } from '@angular/router';\n+\n+/**\n+ * Custom Url Serializer to handle plus sign related issues\n+ */\n+export class CustomUrlSerializer implements UrlSerializer {\n+  parse(url: any): UrlTree {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c58c7e41006cc9e6f5726dd3ed18b7ae8ba64e6"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de794eb870e190d1d05b0d13ee16cf18c4277133", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/de794eb870e190d1d05b0d13ee16cf18c4277133", "committedDate": "2020-07-16T07:33:52Z", "message": "Enforce type paramaters\n\nCo-authored-by: Chong Chee Yuan <32454748+ccyccyccy@users.noreply.github.com>"}, "afterCommit": {"oid": "d82a54b92bcdce59cf9219a3738263919957d63d", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/d82a54b92bcdce59cf9219a3738263919957d63d", "committedDate": "2020-07-16T08:19:56Z", "message": "Enforce type parameters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5NjcyNDM1", "url": "https://github.com/TEAMMATES/teammates/pull/10313#pullrequestreview-449672435", "createdAt": "2020-07-16T09:22:18Z", "commit": {"oid": "d82a54b92bcdce59cf9219a3738263919957d63d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOToyMjoxOFrOGyiizw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwOToyMjoxOFrOGyiizw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY0Nzk1MQ==", "bodyText": "Here as well :P\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              serialize(tree: UrlTree): any {\n          \n          \n            \n              serialize(tree: UrlTree): string {", "url": "https://github.com/TEAMMATES/teammates/pull/10313#discussion_r455647951", "createdAt": "2020-07-16T09:22:18Z", "author": {"login": "ccyccyccy"}, "path": "src/web/app/custom-url-serializer.ts", "diffHunk": "@@ -0,0 +1,16 @@\n+import { DefaultUrlSerializer, UrlSerializer, UrlTree } from '@angular/router';\n+\n+/**\n+ * Custom Url Serializer to handle plus sign related issues\n+ */\n+export class CustomUrlSerializer implements UrlSerializer {\n+  parse(url: string): UrlTree {\n+    const dus: DefaultUrlSerializer = new DefaultUrlSerializer();\n+    return dus.parse(url.replace(/\\+/g, '%2B'));\n+  }\n+\n+  serialize(tree: UrlTree): any {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d82a54b92bcdce59cf9219a3738263919957d63d"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cb336606b17df3a74c8e24ec40a2f58643de2ac", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/8cb336606b17df3a74c8e24ec40a2f58643de2ac", "committedDate": "2020-07-16T10:45:12Z", "message": "Enforce type parameters"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d82a54b92bcdce59cf9219a3738263919957d63d", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/d82a54b92bcdce59cf9219a3738263919957d63d", "committedDate": "2020-07-16T08:19:56Z", "message": "Enforce type parameters"}, "afterCommit": {"oid": "8cb336606b17df3a74c8e24ec40a2f58643de2ac", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/8cb336606b17df3a74c8e24ec40a2f58643de2ac", "committedDate": "2020-07-16T10:45:12Z", "message": "Enforce type parameters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMDM4OTcy", "url": "https://github.com/TEAMMATES/teammates/pull/10313#pullrequestreview-451038972", "createdAt": "2020-07-18T07:31:40Z", "commit": {"oid": "8cb336606b17df3a74c8e24ec40a2f58643de2ac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1087721e7524d76aebe0b5de897914558f3e4f80", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/1087721e7524d76aebe0b5de897914558f3e4f80", "committedDate": "2020-07-18T08:40:12Z", "message": "Merge branch 'master' into 9673-9713"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4290, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}