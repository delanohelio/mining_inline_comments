{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MTU0OTcz", "number": 10290, "title": "[#10245] UAT Round 2 Fix: Sorting of floating point numbers", "bodyText": "Part of #10245\nCause of problem\nsortNaturally uses localeCompare which has implementation-defined behaviour so it seems to not work nicely with floating point numbers. For example, '0.75'.localeCompare('0.555') returns -1 instead of 1.\nOutline of Solution\n\nAdd a new comparison method for floats and shifted all the floating point sortable data to use that method instead\nAdd some tests to ensure the new method works\n\nIssues\nSince now the service will be converting to numbers, floating point errors can occur. Should we try and mitigate the fp errors? Most of the statistics data are truncated to 2d.p. also, which helps", "createdAt": "2020-07-08T10:44:46Z", "url": "https://github.com/TEAMMATES/teammates/pull/10290", "merged": true, "mergeCommit": {"oid": "c4f4d4b6bdcbfb5eabcb4488e08480ee7338f890"}, "closed": true, "closedAt": "2020-07-10T01:16:16Z", "author": {"login": "t-cheepeng"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcy3sC5gH2gAyNDQ2MTU0OTczOjA3ODM5MjBmZGI1YjQwNDllMzI0MWIwYWNlYzMyOTYxYTg5NmUzN2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczNOyKAH2gAyNDQ2MTU0OTczOjFhNWQ1MzJjM2ZlNTM4MWE0NWZhYmM5OWE3MDMwMmNlYjVhMmQzZTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0783920fdb5b4049e3241b0acec32961a896e37d", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/0783920fdb5b4049e3241b0acec32961a896e37d", "committedDate": "2020-07-08T10:15:11Z", "message": "Change SortBy constants for numerical scale"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b6ea6030d801914159f8aa0434483568a732fa5", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/1b6ea6030d801914159f8aa0434483568a732fa5", "committedDate": "2020-07-08T10:18:43Z", "message": "Add tests for comparing floats"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83d08639fb499717de16071f59a09fbfac096c49", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/83d08639fb499717de16071f59a09fbfac096c49", "committedDate": "2020-07-08T10:18:44Z", "message": "Add compare float method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1576f504ae05369949f86acccf8f8307b8916cb", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/d1576f504ae05369949f86acccf8f8307b8916cb", "committedDate": "2020-07-08T10:18:44Z", "message": "Shift floating point related SortBy constants"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NjMwNjA0", "url": "https://github.com/TEAMMATES/teammates/pull/10290#pullrequestreview-444630604", "createdAt": "2020-07-08T10:53:21Z", "commit": {"oid": "d1576f504ae05369949f86acccf8f8307b8916cb"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMDo1MzoyMVrOGuilEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDowMToxNlrOGupiBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ1NDIyNg==", "bodyText": "compareFloats -> compareNumbers", "url": "https://github.com/TEAMMATES/teammates/pull/10290#discussion_r451454226", "createdAt": "2020-07-08T10:53:21Z", "author": {"login": "wkurniawan07"}, "path": "src/web/services/table-comparator.service.ts", "diffHunk": "@@ -37,38 +37,49 @@ export class TableComparatorService {\n     return 0;\n   }\n \n+  /**\n+   * Compares two strings which are expected to be floating point numbers depending on the order given.\n+   * If either string cannot be parsed into number, it will be seen as 'smaller'\n+   * If both strings cannot be parsed into number, strA will always be seen as 'larger'\n+   */\n+  compareFloats(strA: string, strB: string, order: SortOrder): number {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1576f504ae05369949f86acccf8f8307b8916cb"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ1NDkwNA==", "bodyText": "You can shorten these 9 lines:\nreturn (order === SortOrder.DESC ? -1 : 1) * Math.sign(numA - numB);", "url": "https://github.com/TEAMMATES/teammates/pull/10290#discussion_r451454904", "createdAt": "2020-07-08T10:54:36Z", "author": {"login": "wkurniawan07"}, "path": "src/web/services/table-comparator.service.ts", "diffHunk": "@@ -37,38 +37,49 @@ export class TableComparatorService {\n     return 0;\n   }\n \n+  /**\n+   * Compares two strings which are expected to be floating point numbers depending on the order given.\n+   * If either string cannot be parsed into number, it will be seen as 'smaller'\n+   * If both strings cannot be parsed into number, strA will always be seen as 'larger'\n+   */\n+  compareFloats(strA: string, strB: string, order: SortOrder): number {\n+    const numA: number = Number(strA);\n+    const numB: number = Number(strB);\n+    if (Number.isNaN(numA)) {\n+      return 1;\n+    }\n+\n+    if (Number.isNaN(numB)) {\n+      return -1;\n+    }\n+\n+    if (order === SortOrder.ASC) {\n+      return numA < numB ? -1 : (numA > numB ? 1 : 0);\n+    }\n+\n+    if (order === SortOrder.DESC) {\n+      return numA < numB ? 1 : (numA > numB ? -1 : 0);\n+    }\n+\n+    return 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1576f504ae05369949f86acccf8f8307b8916cb"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU2ODEzMg==", "bodyText": "No need to specify it as \"floating point\" because all numbers behave like that in JS.", "url": "https://github.com/TEAMMATES/teammates/pull/10290#discussion_r451568132", "createdAt": "2020-07-08T14:01:16Z", "author": {"login": "wkurniawan07"}, "path": "src/web/services/table-comparator.service.ts", "diffHunk": "@@ -37,38 +37,49 @@ export class TableComparatorService {\n     return 0;\n   }\n \n+  /**\n+   * Compares two strings which are expected to be floating point numbers depending on the order given.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1576f504ae05369949f86acccf8f8307b8916cb"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb7e4e3c1637e00ce43fed69aaf5ccd2b324133b", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/bb7e4e3c1637e00ce43fed69aaf5ccd2b324133b", "committedDate": "2020-07-09T03:09:21Z", "message": "Merge branch 'master' into 10245-sort-natural-numbers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2120e2e05783a76b15584d8191d7db5defd72e88", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/2120e2e05783a76b15584d8191d7db5defd72e88", "committedDate": "2020-07-09T03:15:55Z", "message": "Change method name and simplify implementation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1Mjg3OTc5", "url": "https://github.com/TEAMMATES/teammates/pull/10290#pullrequestreview-445287979", "createdAt": "2020-07-09T04:53:38Z", "commit": {"oid": "2120e2e05783a76b15584d8191d7db5defd72e88"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78fb5a2605bc95914320b396f51946053150970c", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/78fb5a2605bc95914320b396f51946053150970c", "committedDate": "2020-07-09T06:34:24Z", "message": "Merge branch 'master' into 10245-sort-natural-numbers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NTE4Nzc2", "url": "https://github.com/TEAMMATES/teammates/pull/10290#pullrequestreview-445518776", "createdAt": "2020-07-09T11:14:19Z", "commit": {"oid": "78fb5a2605bc95914320b396f51946053150970c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a5d532c3fe5381a45fabc99a70302ceb5a2d3e4", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/1a5d532c3fe5381a45fabc99a70302ceb5a2d3e4", "committedDate": "2020-07-09T11:21:08Z", "message": "Merge branch 'master' into 10245-sort-natural-numbers"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4279, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}