{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzNDQxMDAy", "number": 10273, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMTowNjoyN1rOEK2aaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNDoyMToyMFrOELiOFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5ODEyNzE1OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMTowNjoyN1rOGsIJWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMTowNjoyN1rOGsIJWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkyMzk5Mg==", "bodyText": "same here", "url": "https://github.com/TEAMMATES/teammates/pull/10273#discussion_r448923992", "createdAt": "2020-07-02T11:06:27Z", "author": {"login": "t-cheepeng"}, "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "diffHunk": "@@ -72,11 +79,12 @@ private String findAvailableInstructorGoogleIdForCourse(String courseId) {\n     @Override\n     public ActionResult execute() {\n         String searchKey = getNonNullRequestParamValue(Const.ParamsNames.SEARCH_KEY);\n+        String entity = getNonNullRequestParamValue(Const.ParamsNames.ENTITY_TYPE);\n         List<StudentAttributes> students;\n         List<StudentData> studentDataList = new ArrayList<>();\n \n         // Search for students\n-        if (userInfo.isAdmin) {\n+        if (userInfo.isAdmin && \"admin\".equals(entity)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea028a469bfd9412cdaa37c32a7c4cbb735d2d19"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5ODEyNzYwOnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMTowNjozNVrOGsIJnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMTowNjozNVrOGsIJnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkyNDA2MA==", "bodyText": "same here", "url": "https://github.com/TEAMMATES/teammates/pull/10273#discussion_r448924060", "createdAt": "2020-07-02T11:06:35Z", "author": {"login": "t-cheepeng"}, "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "diffHunk": "@@ -86,7 +94,7 @@ public ActionResult execute() {\n         for (StudentAttributes s : students) {\n             StudentData studentData = new StudentData(s);\n \n-            if (userInfo.isAdmin) {\n+            if (userInfo.isAdmin && \"admin\".equals(entity)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea028a469bfd9412cdaa37c32a7c4cbb735d2d19"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5ODEzMTQ4OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMTowNzo1M1rOGsIMAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMToxMzowNVrOGsIVCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkyNDY3Mw==", "bodyText": "Maybe extract the admin and 'instructor' string to a variable/const if possible?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!userInfo.isAdmin && \"admin\".equals(entity)) {\n          \n          \n            \n                    if (!userInfo.isAdmin && entity.equals(\"admin\")) {", "url": "https://github.com/TEAMMATES/teammates/pull/10273#discussion_r448924673", "createdAt": "2020-07-02T11:07:53Z", "author": {"login": "t-cheepeng"}, "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "diffHunk": "@@ -28,6 +28,13 @@ public void checkSpecificAccessControl() {\n         if (!userInfo.isInstructor && !userInfo.isAdmin) {\n             throw new UnauthorizedAccessException(\"Instructor or Admin privilege is required to access this resource.\");\n         }\n+        String entity = getNonNullRequestParamValue(Const.ParamsNames.ENTITY_TYPE);\n+        if (!userInfo.isAdmin && \"admin\".equals(entity)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea028a469bfd9412cdaa37c32a7c4cbb735d2d19"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkyNjk4Ng==", "bodyText": "Yeap sounds like a good idea, I\u2019ll extract to a constant. The comparison order you suggested is not allowed by our lint settings, something about comparison of literals having to come first haha", "url": "https://github.com/TEAMMATES/teammates/pull/10273#discussion_r448926986", "createdAt": "2020-07-02T11:13:05Z", "author": {"login": "madanalogy"}, "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "diffHunk": "@@ -28,6 +28,13 @@ public void checkSpecificAccessControl() {\n         if (!userInfo.isInstructor && !userInfo.isAdmin) {\n             throw new UnauthorizedAccessException(\"Instructor or Admin privilege is required to access this resource.\");\n         }\n+        String entity = getNonNullRequestParamValue(Const.ParamsNames.ENTITY_TYPE);\n+        if (!userInfo.isAdmin && \"admin\".equals(entity)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkyNDY3Mw=="}, "originalCommit": {"oid": "ea028a469bfd9412cdaa37c32a7c4cbb735d2d19"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDgxNjkzOnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxOToxNzoyOVrOGtETSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwMjoxMTo0MFrOGtG6PA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwOTU3OA==", "bodyText": "If entity type equals to something else, we might have unexpected flow in both execute() and checkSpecificAccessControl()", "url": "https://github.com/TEAMMATES/teammates/pull/10273#discussion_r449909578", "createdAt": "2020-07-05T19:17:29Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "diffHunk": "@@ -28,6 +28,13 @@ public void checkSpecificAccessControl() {\n         if (!userInfo.isInstructor && !userInfo.isAdmin) {\n             throw new UnauthorizedAccessException(\"Instructor or Admin privilege is required to access this resource.\");\n         }\n+        String entity = getNonNullRequestParamValue(Const.ParamsNames.ENTITY_TYPE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cc12a3c36be55d571f3867b4090da26689d43ff"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk1MTYyNA==", "bodyText": "Added throw exception if entities do not match exactly", "url": "https://github.com/TEAMMATES/teammates/pull/10273#discussion_r449951624", "createdAt": "2020-07-06T02:07:51Z", "author": {"login": "madanalogy"}, "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "diffHunk": "@@ -28,6 +28,13 @@ public void checkSpecificAccessControl() {\n         if (!userInfo.isInstructor && !userInfo.isAdmin) {\n             throw new UnauthorizedAccessException(\"Instructor or Admin privilege is required to access this resource.\");\n         }\n+        String entity = getNonNullRequestParamValue(Const.ParamsNames.ENTITY_TYPE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwOTU3OA=="}, "originalCommit": {"oid": "6cc12a3c36be55d571f3867b4090da26689d43ff"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk1MjMxNg==", "bodyText": "Don't forget test case :P", "url": "https://github.com/TEAMMATES/teammates/pull/10273#discussion_r449952316", "createdAt": "2020-07-06T02:11:40Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "diffHunk": "@@ -28,6 +28,13 @@ public void checkSpecificAccessControl() {\n         if (!userInfo.isInstructor && !userInfo.isAdmin) {\n             throw new UnauthorizedAccessException(\"Instructor or Admin privilege is required to access this resource.\");\n         }\n+        String entity = getNonNullRequestParamValue(Const.ParamsNames.ENTITY_TYPE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkwOTU3OA=="}, "originalCommit": {"oid": "6cc12a3c36be55d571f3867b4090da26689d43ff"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTMwNDU1OnYy", "diffSide": "RIGHT", "path": "src/test/java/teammates/test/cases/webapi/SearchStudentsActionTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNDoyMToyMFrOGtIXtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNDoyMToyMFrOGtIXtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk3NjI0NQ==", "bodyText": "This needs not be a separate test case as wrongEntityType is a subset of invalidParameters", "url": "https://github.com/TEAMMATES/teammates/pull/10273#discussion_r449976245", "createdAt": "2020-07-06T04:21:20Z", "author": {"login": "wkurniawan07"}, "path": "src/test/java/teammates/test/cases/webapi/SearchStudentsActionTest.java", "diffHunk": "@@ -37,9 +37,38 @@ protected void testExecute() {\n     }\n \n     @Test\n-    public void execute_notEnoughParameters_parameterFailure() {\n+    public void execute_invalidParameters_parameterFailure() {\n         loginAsAdmin();\n         verifyHttpParameterFailure();\n+\n+        String[] notEnoughParams = new String[] {\n+                Const.ParamsNames.SEARCH_KEY, \"dummy\",\n+        };\n+        verifyHttpParameterFailure(notEnoughParams);\n+\n+        String[] invalidEntityParams = new String[] {\n+                Const.ParamsNames.SEARCH_KEY, \"dummy\",\n+                Const.ParamsNames.ENTITY_TYPE, \"dummy\",\n+        };\n+        verifyHttpParameterFailure(invalidEntityParams);\n+    }\n+\n+    @Test\n+    public void execute_wrongEntityType_parameterFailure() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "995f9ece6ebc747bde60afd5418dc75e005f44f2"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3580, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}