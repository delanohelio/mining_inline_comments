{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2OTIwNjQ2", "number": 10583, "title": "[#10574] [#10575] [#10576] Fix back-end related issues", "bodyText": "This fixes some back-end operations:\n\nFixes #10574\n\nChange 404 to 200 (cannot use 204 because the response body will be stripped) and return empty student profile if the student has not registered. 404 is appropriate when the target student is not found.\n\n\nFixes #10575\n\nThis was due to HTML sanitization when constructing error message. HTML sanitization in the back-end is no longer necessary and in fact should not be done. The only place where HTML sanitization is still relevant is email content generation.\n\n\nFixes #10576\n\nThis was due to the sessions queried via start time and end time are combined with OR operation, not AND.", "createdAt": "2020-08-12T17:55:13Z", "url": "https://github.com/TEAMMATES/teammates/pull/10583", "merged": true, "mergeCommit": {"oid": "081932187f4cd036331f0eca8823568bbf4f2761"}, "closed": true, "closedAt": "2020-08-13T03:38:10Z", "author": {"login": "wkurniawan07"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-QKsggBqjM2NDkwNDE3NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-V2CagBqjM2NTAwNDU5NTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "065a04b276e4527e532d4241fb77dc44f36d1f96", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/065a04b276e4527e532d4241fb77dc44f36d1f96", "committedDate": "2020-08-12T14:27:40Z", "message": "Use intersection when processing ongoing sessions instead of union"}, "afterCommit": {"oid": "645a70a0469d9f4880a06e8758c9cb731a3554dc", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/645a70a0469d9f4880a06e8758c9cb731a3554dc", "committedDate": "2020-08-12T18:59:09Z", "message": "Use intersection when processing ongoing sessions instead of union"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2Mzc1Mzc0", "url": "https://github.com/TEAMMATES/teammates/pull/10583#pullrequestreview-466375374", "createdAt": "2020-08-13T01:00:25Z", "commit": {"oid": "bfd188beaa0886825519bdb55c698221d8558fb8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMTowMDoyNVrOG_4LTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMTowMDoyNVrOG_4LTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYzMzg2OA==", "bodyText": "Can we just use empty string here?", "url": "https://github.com/TEAMMATES/teammates/pull/10583#discussion_r469633868", "createdAt": "2020-08-13T01:00:25Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/action/GetStudentProfileAction.java", "diffHunk": "@@ -52,32 +50,38 @@ public ActionResult execute() {\n         String studentId;\n         String studentEmail = getRequestParamValue(Const.ParamsNames.STUDENT_EMAIL);\n         String courseId = getRequestParamValue(Const.ParamsNames.COURSE_ID);\n+        String studentName = \"\";\n         if (studentEmail == null || courseId == null) {\n+            if (userInfo == null) {\n+                return new JsonResult(\"No student found\", HttpStatus.SC_NOT_FOUND);\n+            }\n             studentId = userInfo.id;\n         } else {\n             StudentAttributes student = logic.getStudentForEmail(courseId, studentEmail);\n             if (student == null) {\n                 return new JsonResult(\"No student found\", HttpStatus.SC_NOT_FOUND);\n             }\n             studentId = student.getGoogleId();\n+            studentName = student.getName();\n         }\n \n+        StudentProfileAttributes studentProfile;\n+\n         if (StringHelper.isEmpty(studentId)) {\n-            // The student has not registered.\n-            return new JsonResult(MESSAGE_STUDENT_NOT_REGISTERED, HttpStatus.SC_NOT_FOUND);\n+            studentProfile = StudentProfileAttributes.builder(\"placeholderId\").build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfd188beaa0886825519bdb55c698221d8558fb8"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b5c015b0a6ff9922e42ba887b7057d7ac74969a", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/1b5c015b0a6ff9922e42ba887b7057d7ac74969a", "committedDate": "2020-08-13T01:36:06Z", "message": "Return empty student profile if student has not registered"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14e5cf87d1be3cc8e49f7086baa05e49d3a909eb", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/14e5cf87d1be3cc8e49f7086baa05e49d3a909eb", "committedDate": "2020-08-13T01:36:06Z", "message": "Remove HTML sanitization for validation messages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "435c7a56e0fae25d271a0a2ec9589a38d3c676fe", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/435c7a56e0fae25d271a0a2ec9589a38d3c676fe", "committedDate": "2020-08-13T01:36:06Z", "message": "Use intersection when processing ongoing sessions instead of union"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "645a70a0469d9f4880a06e8758c9cb731a3554dc", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/645a70a0469d9f4880a06e8758c9cb731a3554dc", "committedDate": "2020-08-12T18:59:09Z", "message": "Use intersection when processing ongoing sessions instead of union"}, "afterCommit": {"oid": "435c7a56e0fae25d271a0a2ec9589a38d3c676fe", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/435c7a56e0fae25d271a0a2ec9589a38d3c676fe", "committedDate": "2020-08-13T01:36:06Z", "message": "Use intersection when processing ongoing sessions instead of union"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4235, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}