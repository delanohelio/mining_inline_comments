{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzMTAwMjAz", "number": 10119, "title": "[#10107] Append email after participants' name for GRQ/RGQ/GQR/RQG view", "bodyText": "Fixes #10107\nOutline of Solution\nGRQ\n\nRQG\n\n\nAdd recipientEmail and giverEmail to backend output. The visibility is handled by the getDisplayableEmailGiver/Recipient method\nMade a map from user to email in the group by views and display them accordingly", "createdAt": "2020-05-26T09:48:40Z", "url": "https://github.com/TEAMMATES/teammates/pull/10119", "merged": true, "mergeCommit": {"oid": "dbbedbce218fdd236f21562b724826780a7f3c04"}, "closed": true, "closedAt": "2020-05-27T04:42:47Z", "author": {"login": "t-cheepeng"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclAaO6AH2gAyNDIzMTAwMjAzOjdiMWJmMmRjMDIzOTk4MGNhOGEwMjgzZjUwOGM2N2EwZjkxOGIwYTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclRfX2AFqTQxODg0NzE4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b1bf2dc0239980ca8a0283f508c67a0f918b0a4", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/7b1bf2dc0239980ca8a0283f508c67a0f918b0a4", "committedDate": "2020-05-26T08:29:56Z", "message": "Add giver and recipient email to response output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa17a6cfd2e9b53e3a6f066d4b2fe28dc4b630ff", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/fa17a6cfd2e9b53e3a6f066d4b2fe28dc4b630ff", "committedDate": "2020-05-26T08:34:59Z", "message": "Add email text to grq-rgq views"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5526e10e2670c38e8269512098bfd447748ae664", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/5526e10e2670c38e8269512098bfd447748ae664", "committedDate": "2020-05-26T08:47:12Z", "message": "Add email text to gqr-rqg views"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "107f58dc0c528ec836cdb80759c5594d130d7e5a", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/107f58dc0c528ec836cdb80759c5594d130d7e5a", "committedDate": "2020-05-26T09:13:38Z", "message": "Add conditionals to display of email text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b847c7042e36945fd049d25e2d778cf2dc7cdc0", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/1b847c7042e36945fd049d25e2d778cf2dc7cdc0", "committedDate": "2020-05-26T09:30:05Z", "message": "Add line breaks for linting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MzA2NTU4", "url": "https://github.com/TEAMMATES/teammates/pull/10119#pullrequestreview-418306558", "createdAt": "2020-05-26T13:39:13Z", "commit": {"oid": "1b847c7042e36945fd049d25e2d778cf2dc7cdc0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NTk4ODI5", "url": "https://github.com/TEAMMATES/teammates/pull/10119#pullrequestreview-418598829", "createdAt": "2020-05-26T19:13:58Z", "commit": {"oid": "1b847c7042e36945fd049d25e2d778cf2dc7cdc0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxOToxMzo1OVrOGaskJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxOToyMjowMFrOGas1Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY0NjMwOQ==", "bodyText": "Let's follow V6 where we should use mailto here.\nhttps://www.w3schools.com/tags/tag_address.asp", "url": "https://github.com/TEAMMATES/teammates/pull/10119#discussion_r430646309", "createdAt": "2020-05-26T19:13:59Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/gqr-rqg-view-responses/gqr-rqg-view-responses.component.html", "diffHunk": "@@ -32,8 +32,11 @@\n   <div class=\"card top-padded\">\n     <div class=\"card-header bg-primary text-white\" (click)=\"userExpanded[userInfo] = !userExpanded[userInfo]\">\n       {{ isGqr ? 'From' : 'To' }}: {{ userInfo }}\n+      <span *ngIf=\"userToEmail[userInfo]\">\n+        [{{ userToEmail[userInfo] }}]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b847c7042e36945fd049d25e2d778cf2dc7cdc0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY0ODgyMA==", "bodyText": "Whats this indoxOf for?", "url": "https://github.com/TEAMMATES/teammates/pull/10119#discussion_r430648820", "createdAt": "2020-05-26T19:18:33Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/gqr-rqg-view-responses/gqr-rqg-view-responses.component.ts", "diffHunk": "@@ -100,6 +106,11 @@ export class GqrRqgViewResponsesComponent extends ResponsesInstructorCommentsBas\n             this.teamsToUsers[response.recipientTeam].push(response.recipient);\n             this.teamExpanded[response.recipientTeam] = this.isExpandAll;\n           }\n+          this.userToEmail[response.recipient] = this.userToEmail[response.recipient] || '';\n+          if (this.userToEmail[response.recipient].indexOf(response.recipient) === -1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b847c7042e36945fd049d25e2d778cf2dc7cdc0"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY0OTA3Nw==", "bodyText": "If you want to check something not to be undefined.\nYou can do\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      if (this.userToEmail[response.giver].indexOf(response.giver) === -1 && response.giverEmail !== undefined) {\n          \n          \n            \n                      if (this.userToEmail[response.giver].indexOf(response.giver) === -1 && response.giverEmail) {", "url": "https://github.com/TEAMMATES/teammates/pull/10119#discussion_r430649077", "createdAt": "2020-05-26T19:19:01Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/gqr-rqg-view-responses/gqr-rqg-view-responses.component.ts", "diffHunk": "@@ -83,6 +85,10 @@ export class GqrRqgViewResponsesComponent extends ResponsesInstructorCommentsBas\n             this.teamsToUsers[response.giverTeam].push(response.giver);\n             this.teamExpanded[response.giverTeam] = this.isExpandAll;\n           }\n+          this.userToEmail[response.giver] = this.userToEmail[response.giver] || '';\n+          if (this.userToEmail[response.giver].indexOf(response.giver) === -1 && response.giverEmail !== undefined) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b847c7042e36945fd049d25e2d778cf2dc7cdc0"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY0OTIyNQ==", "bodyText": "Same here, what the indexOf for?", "url": "https://github.com/TEAMMATES/teammates/pull/10119#discussion_r430649225", "createdAt": "2020-05-26T19:19:17Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/gqr-rqg-view-responses/gqr-rqg-view-responses.component.ts", "diffHunk": "@@ -83,6 +85,10 @@ export class GqrRqgViewResponsesComponent extends ResponsesInstructorCommentsBas\n             this.teamsToUsers[response.giverTeam].push(response.giver);\n             this.teamExpanded[response.giverTeam] = this.isExpandAll;\n           }\n+          this.userToEmail[response.giver] = this.userToEmail[response.giver] || '';\n+          if (this.userToEmail[response.giver].indexOf(response.giver) === -1 && response.giverEmail !== undefined) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY0OTA3Nw=="}, "originalCommit": {"oid": "1b847c7042e36945fd049d25e2d778cf2dc7cdc0"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY1MDY3MQ==", "bodyText": "I think giverEmail will never be null in this case, it would be Anonymous Student xxx@Anonymous Student xxx.com for anonymous response in this case. However this is not what we want right? Maybe follow the hint by checking isGiverVisible and isRecipientVisible?", "url": "https://github.com/TEAMMATES/teammates/pull/10119#discussion_r430650671", "createdAt": "2020-05-26T19:22:00Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/output/SessionResultsData.java", "diffHunk": "@@ -163,6 +164,8 @@ private static String removeAnonymousHash(String identifier) {\n \n             for (FeedbackResponseAttributes response : responsesForRecipient) {\n                 String giverName = removeAnonymousHash(bundle.getGiverNameForResponse(response));\n+                String giverEmail = bundle.getDisplayableEmailGiver(response);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b847c7042e36945fd049d25e2d778cf2dc7cdc0"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a31f6b3361794c97b28af941441c76a02eb5c93", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/9a31f6b3361794c97b28af941441c76a02eb5c93", "committedDate": "2020-05-27T02:09:41Z", "message": "Merge branch 'master' into 10107-append-participant-email"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a7bc8f4be25c933b6183353a25e9f88f9091180", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/2a7bc8f4be25c933b6183353a25e9f88f9091180", "committedDate": "2020-05-27T02:20:15Z", "message": "Simplify conditional checks for email map"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfab6aaf1a9fb510659c53d383de73eb66c52ba5", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/cfab6aaf1a9fb510659c53d383de73eb66c52ba5", "committedDate": "2020-05-27T02:38:25Z", "message": "Add mailto for email text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e61f4cd0e56f83597d842510ef12e0cfdf7b6d77", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/e61f4cd0e56f83597d842510ef12e0cfdf7b6d77", "committedDate": "2020-05-27T03:05:09Z", "message": "Change backend to send null email if not visible"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4ODQwNDEx", "url": "https://github.com/TEAMMATES/teammates/pull/10119#pullrequestreview-418840411", "createdAt": "2020-05-27T03:57:35Z", "commit": {"oid": "e61f4cd0e56f83597d842510ef12e0cfdf7b6d77"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4ODQxMTM5", "url": "https://github.com/TEAMMATES/teammates/pull/10119#pullrequestreview-418841139", "createdAt": "2020-05-27T04:00:15Z", "commit": {"oid": "e61f4cd0e56f83597d842510ef12e0cfdf7b6d77"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwNDowMDoxNVrOGa4pNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwNDowMDoyMVrOGa4pUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg0NDIxNQ==", "bodyText": "This is no necessary if you have *ngIf=\"userToEmail[userInfo]\"?", "url": "https://github.com/TEAMMATES/teammates/pull/10119#discussion_r430844215", "createdAt": "2020-05-27T04:00:15Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/gqr-rqg-view-responses/gqr-rqg-view-responses.component.ts", "diffHunk": "@@ -83,6 +85,10 @@ export class GqrRqgViewResponsesComponent extends ResponsesInstructorCommentsBas\n             this.teamsToUsers[response.giverTeam].push(response.giver);\n             this.teamExpanded[response.giverTeam] = this.isExpandAll;\n           }\n+          this.userToEmail[response.giver] = this.userToEmail[response.giver] || '';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e61f4cd0e56f83597d842510ef12e0cfdf7b6d77"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg0NDI0Mg==", "bodyText": "Same here and other places", "url": "https://github.com/TEAMMATES/teammates/pull/10119#discussion_r430844242", "createdAt": "2020-05-27T04:00:21Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/gqr-rqg-view-responses/gqr-rqg-view-responses.component.ts", "diffHunk": "@@ -100,6 +106,10 @@ export class GqrRqgViewResponsesComponent extends ResponsesInstructorCommentsBas\n             this.teamsToUsers[response.recipientTeam].push(response.recipient);\n             this.teamExpanded[response.recipientTeam] = this.isExpandAll;\n           }\n+          this.userToEmail[response.recipient] = this.userToEmail[response.recipient] || '';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e61f4cd0e56f83597d842510ef12e0cfdf7b6d77"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c2c355afafe8762e2eb7a34712b43c80f3519fa", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/4c2c355afafe8762e2eb7a34712b43c80f3519fa", "committedDate": "2020-05-27T04:17:57Z", "message": "Remove unnecessary code and check for team name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4ODQ3MTg0", "url": "https://github.com/TEAMMATES/teammates/pull/10119#pullrequestreview-418847184", "createdAt": "2020-05-27T04:23:56Z", "commit": {"oid": "4c2c355afafe8762e2eb7a34712b43c80f3519fa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4414, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}