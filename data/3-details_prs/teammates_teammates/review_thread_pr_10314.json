{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4OTQzNjU2", "number": 10314, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMzowNDoyNFrOEOgaig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNDo0ODoyMVrOEQ4zzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjQ2NjAyOnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "isResolved": true, "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMzowNDoyNFrOGxsfkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwMTo1ODoyN1rOGzk51Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2MjM4Ng==", "bodyText": "Some context here:\n\nSadly, we do not manage to migrate the database for team response. There are still entries in the database where giver is one of the team member's email.", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r454762386", "createdAt": "2020-07-15T03:04:24Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,7 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            if (roster.isStudentInTeam(userEmail, response.giver)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a3b2ee79522ce16665876f7d78b907473bd32dd"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE4NTkyNg==", "bodyText": "Don't close too soon. I think the fix is necessary? In addition, have you tried the legacy case where the response.giver is student's email?", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r455185926", "createdAt": "2020-07-15T16:41:58Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,7 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            if (roster.isStudentInTeam(userEmail, response.giver)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2MjM4Ng=="}, "originalCommit": {"oid": "6a3b2ee79522ce16665876f7d78b907473bd32dd"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ0NjY1OA==", "bodyText": "I don't know how to try the legacy case. I verified using the sequence described in the original issue with the uat server, and team responses did not show as anonymous.", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r455446658", "createdAt": "2020-07-16T00:51:53Z", "author": {"login": "madanalogy"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,7 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            if (roster.isStudentInTeam(userEmail, response.giver)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2MjM4Ng=="}, "originalCommit": {"oid": "6a3b2ee79522ce16665876f7d78b907473bd32dd"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ0OTE3Mg==", "bodyText": "You can:\n\nModify the current submission logic temporally to achieve that.\nModify the instructor demo data and create a new account", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r455449172", "createdAt": "2020-07-16T01:01:04Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,7 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            if (roster.isStudentInTeam(userEmail, response.giver)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2MjM4Ng=="}, "originalCommit": {"oid": "6a3b2ee79522ce16665876f7d78b907473bd32dd"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc0NTE1OA==", "bodyText": "@xpdavid if we run the migration script now, would V6 still function correctly?", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r455745158", "createdAt": "2020-07-16T12:22:52Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,7 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            if (roster.isStudentInTeam(userEmail, response.giver)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2MjM4Ng=="}, "originalCommit": {"oid": "6a3b2ee79522ce16665876f7d78b907473bd32dd"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkzNDQ3MA==", "bodyText": "Yes. Both V6 and V7 has the ability to handle the scenarios.", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r455934470", "createdAt": "2020-07-16T16:59:06Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,7 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            if (roster.isStudentInTeam(userEmail, response.giver)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2MjM4Ng=="}, "originalCommit": {"oid": "6a3b2ee79522ce16665876f7d78b907473bd32dd"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY0OTc2MQ==", "bodyText": "I am trying to understand in the legacy case where response.giver is an email. There will be a bug here?", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456649761", "createdAt": "2020-07-17T20:04:57Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,7 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            if (roster.isStudentInTeam(userEmail, response.giver)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2MjM4Ng=="}, "originalCommit": {"oid": "6a3b2ee79522ce16665876f7d78b907473bd32dd"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjczMzUzOQ==", "bodyText": "It depends on how the legacy team name was formulated. If it's just the email of the giver then this line might return false for everyone else in the team (other than the original giver).\n\n  \n    \n      teammates/src/main/java/teammates/common/datatransfer/CourseRoster.java\n    \n    \n        Lines 62 to 72\n      in\n      faf15f9\n    \n    \n    \n    \n\n        \n          \n           public boolean isStudentInTeam(String studentEmail, String targetTeamName) { \n        \n\n        \n          \n               StudentAttributes student = studentListByEmail.get(studentEmail); \n        \n\n        \n          \n               return student != null && student.team.equals(targetTeamName); \n        \n\n        \n          \n           } \n        \n\n        \n          \n            \n        \n\n        \n          \n           public boolean isStudentsInSameTeam(String studentEmail1, String studentEmail2) { \n        \n\n        \n          \n               StudentAttributes student1 = studentListByEmail.get(studentEmail1); \n        \n\n        \n          \n               StudentAttributes student2 = studentListByEmail.get(studentEmail2); \n        \n\n        \n          \n               return student1 != null && student2 != null \n        \n\n        \n          \n                       && student1.team != null && student1.team.equals(student2.team); \n        \n\n        \n          \n           }", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456733539", "createdAt": "2020-07-18T01:39:03Z", "author": {"login": "madanalogy"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,7 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            if (roster.isStudentInTeam(userEmail, response.giver)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2MjM4Ng=="}, "originalCommit": {"oid": "6a3b2ee79522ce16665876f7d78b907473bd32dd"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjczNDg4Mw==", "bodyText": "It depends on how the legacy team name was formulated.\n\nThere is only one way if I am not wrong (The giver will be the email).\n\nIf it's just the email of the giver then this line might return false\n\nWhich is not correct? Should return true?", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456734883", "createdAt": "2020-07-18T01:54:52Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,7 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            if (roster.isStudentInTeam(userEmail, response.giver)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2MjM4Ng=="}, "originalCommit": {"oid": "6a3b2ee79522ce16665876f7d78b907473bd32dd"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjczNTE4OQ==", "bodyText": "Which is not correct? Should return true?\n\nYeap that sounds about right.\nGiven that this issue is no longer relevant (even with legacy data), any issues if I close it?", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456735189", "createdAt": "2020-07-18T01:58:27Z", "author": {"login": "madanalogy"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,7 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            if (roster.isStudentInTeam(userEmail, response.giver)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2MjM4Ng=="}, "originalCommit": {"oid": "6a3b2ee79522ce16665876f7d78b907473bd32dd"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNjQ2NzI5OnYy", "diffSide": "RIGHT", "path": "src/test/resources/data/FeedbackSessionResultsTest.json", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwMzowNTowN1rOGxsgUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwODo1Nzo0OVrOGzm7Rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2MjU3OQ==", "bodyText": "And therefore, let's make sure we have test data that cover the legacy data. We should remove it only after we have migrated the database.", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r454762579", "createdAt": "2020-07-15T03:05:07Z", "author": {"login": "xpdavid"}, "path": "src/test/resources/data/FeedbackSessionResultsTest.json", "diffHunk": "@@ -594,7 +594,7 @@\n       \"feedbackSessionName\": \"Standard feedback session\",\n       \"courseId\": \"FSRTest.idOfTypicalCourse1\",\n       \"feedbackQuestionId\": \"7\",\n-      \"giver\": \"FSRTest.student2InCourse1@gmail.tmt\",\n+      \"giver\": \"Team 1.1\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a3b2ee79522ce16665876f7d78b907473bd32dd"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0OTcwMg==", "bodyText": "How does this get addresed?", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456749702", "createdAt": "2020-07-18T04:57:13Z", "author": {"login": "xpdavid"}, "path": "src/test/resources/data/FeedbackSessionResultsTest.json", "diffHunk": "@@ -594,7 +594,7 @@\n       \"feedbackSessionName\": \"Standard feedback session\",\n       \"courseId\": \"FSRTest.idOfTypicalCourse1\",\n       \"feedbackQuestionId\": \"7\",\n-      \"giver\": \"FSRTest.student2InCourse1@gmail.tmt\",\n+      \"giver\": \"Team 1.1\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2MjU3OQ=="}, "originalCommit": {"oid": "6a3b2ee79522ce16665876f7d78b907473bd32dd"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc2ODMyNw==", "bodyText": "Changes have been reverted", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456768327", "createdAt": "2020-07-18T08:57:49Z", "author": {"login": "madanalogy"}, "path": "src/test/resources/data/FeedbackSessionResultsTest.json", "diffHunk": "@@ -594,7 +594,7 @@\n       \"feedbackSessionName\": \"Standard feedback session\",\n       \"courseId\": \"FSRTest.idOfTypicalCourse1\",\n       \"feedbackQuestionId\": \"7\",\n-      \"giver\": \"FSRTest.student2InCourse1@gmail.tmt\",\n+      \"giver\": \"Team 1.1\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDc2MjU3OQ=="}, "originalCommit": {"oid": "6a3b2ee79522ce16665876f7d78b907473bd32dd"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTE1MzQyOnYy", "diffSide": "LEFT", "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwMjowMTo0NlrOGzk7Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwMjozNDo1N1rOGzlGSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjczNTUxNQ==", "bodyText": "The old code works for legacy data for team response.\nDoes it work for the new data (where giver is the team name)? It looks like a no to me.", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456735515", "createdAt": "2020-07-18T02:01:46Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,7 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c805e88a6cf160e15348bc7e413ee948318cb3c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjczODM3Nw==", "bodyText": "Okay I think I get it now haha, have pushed new code to check for both current and legacy cases", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456738377", "createdAt": "2020-07-18T02:34:57Z", "author": {"login": "madanalogy"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,7 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjczNTUxNQ=="}, "originalCommit": {"oid": "2c805e88a6cf160e15348bc7e413ee948318cb3c"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTI3MTY0OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQwNDo1NjowMFrOGzlyJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQwMTo0MTowMFrOGzrtmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0OTYwNQ==", "bodyText": "Remember to add comment explain the legacy case", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456749605", "createdAt": "2020-07-18T04:56:00Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,8 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            if (roster.isStudentInTeam(userEmail, response.giver)\n+                    || roster.isStudentsInSameTeam(userEmail, response.giver)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2314eee14a93154245b73915619b6e438d577b1f"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMzEwMA==", "bodyText": "If it is not too difficult, we can have a test for this", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456833100", "createdAt": "2020-07-18T22:14:21Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,8 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            if (roster.isStudentInTeam(userEmail, response.giver)\n+                    || roster.isStudentsInSameTeam(userEmail, response.giver)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0OTYwNQ=="}, "originalCommit": {"oid": "2314eee14a93154245b73915619b6e438d577b1f"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg0NjMzNA==", "bodyText": "How would I go about writing tests for this exactly? I had thought it was not necessary since the current tests already check for visibility.", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456846334", "createdAt": "2020-07-19T01:34:54Z", "author": {"login": "madanalogy"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,8 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            if (roster.isStudentInTeam(userEmail, response.giver)\n+                    || roster.isStudentsInSameTeam(userEmail, response.giver)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0OTYwNQ=="}, "originalCommit": {"oid": "2314eee14a93154245b73915619b6e438d577b1f"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg0Njc0Ng==", "bodyText": "The newly added condition is not covered right?", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456846746", "createdAt": "2020-07-19T01:41:00Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,8 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            if (roster.isStudentInTeam(userEmail, response.giver)\n+                    || roster.isStudentsInSameTeam(userEmail, response.giver)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njc0OTYwNQ=="}, "originalCommit": {"oid": "2314eee14a93154245b73915619b6e438d577b1f"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0OTk3MTI1OnYy", "diffSide": "LEFT", "path": "src/test/resources/data/FeedbackSessionResultsTest.json", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQyMjoxMDo0M1rOGzq3RA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQwMTo0MDozNlrOGzrtfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMjgzNg==", "bodyText": "Why do we need the change this?", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456832836", "createdAt": "2020-07-18T22:10:43Z", "author": {"login": "xpdavid"}, "path": "src/test/resources/data/FeedbackSessionResultsTest.json", "diffHunk": "@@ -179,9 +179,9 @@\n       \"googleId\": \"FSRTest.student1InCourse1\",\n       \"email\": \"FSRTest.student1InCourse1@gmail.tmt\",\n       \"course\": \"FSRTest.idOfTypicalCourse1\",\n-      \"name\": \"student1 In Course1</td></div>'\\\"\",\n+      \"name\": \"student1 In Course1\",\n       \"comments\": \"comment for student1InCourse1\",\n-      \"team\": \"Team 1.1</td></div>'\\\"\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c985c97e86bc052f3e7423d7f049360d13e29305"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg0NjA3NA==", "bodyText": "I thought the HTML tags were just typos that never got fixed?", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456846074", "createdAt": "2020-07-19T01:30:41Z", "author": {"login": "madanalogy"}, "path": "src/test/resources/data/FeedbackSessionResultsTest.json", "diffHunk": "@@ -179,9 +179,9 @@\n       \"googleId\": \"FSRTest.student1InCourse1\",\n       \"email\": \"FSRTest.student1InCourse1@gmail.tmt\",\n       \"course\": \"FSRTest.idOfTypicalCourse1\",\n-      \"name\": \"student1 In Course1</td></div>'\\\"\",\n+      \"name\": \"student1 In Course1\",\n       \"comments\": \"comment for student1InCourse1\",\n-      \"team\": \"Team 1.1</td></div>'\\\"\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMjgzNg=="}, "originalCommit": {"oid": "c985c97e86bc052f3e7423d7f049360d13e29305"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg0NjcxNw==", "bodyText": "Nope. There are there for some reasons:\n\nText sanitization\nHTML code escape", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r456846717", "createdAt": "2020-07-19T01:40:36Z", "author": {"login": "xpdavid"}, "path": "src/test/resources/data/FeedbackSessionResultsTest.json", "diffHunk": "@@ -179,9 +179,9 @@\n       \"googleId\": \"FSRTest.student1InCourse1\",\n       \"email\": \"FSRTest.student1InCourse1@gmail.tmt\",\n       \"course\": \"FSRTest.idOfTypicalCourse1\",\n-      \"name\": \"student1 In Course1</td></div>'\\\"\",\n+      \"name\": \"student1 In Course1\",\n       \"comments\": \"comment for student1InCourse1\",\n-      \"team\": \"Team 1.1</td></div>'\\\"\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMjgzNg=="}, "originalCommit": {"oid": "c985c97e86bc052f3e7423d7f049360d13e29305"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MTgyMzcyOnYy", "diffSide": "RIGHT", "path": "src/test/java/teammates/test/cases/logic/FeedbackResponsesLogicTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNTozNjo1OFrOGz5OdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNTozNjo1OFrOGz5OdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA2ODE0OA==", "bodyText": "This test case is ineffective because the question's giver type here is SELF.", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r457068148", "createdAt": "2020-07-20T05:36:58Z", "author": {"login": "wkurniawan07"}, "path": "src/test/java/teammates/test/cases/logic/FeedbackResponsesLogicTest.java", "diffHunk": "@@ -423,6 +423,8 @@ public void testIsNameVisibleTo() {\n \n         fr.giver = student.email;\n         assertTrue(frLogic.isNameVisibleToUser(fq, fr, student.email, UserRole.STUDENT, false, roster));\n+        fr.giver = student.team;\n+        assertTrue(frLogic.isNameVisibleToUser(fq, fr, student.email, UserRole.STUDENT, false, roster));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eafdb6a2c9871d72093599b34e1c00ec9c8e6a60"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MTQzMzE0OnYy", "diffSide": "RIGHT", "path": "src/test/java/teammates/test/cases/logic/FeedbackResponsesLogicTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNDo0Nzo0MlrOG1Sj3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNDo0Nzo0MlrOG1Sj3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUzMTgwNw==", "bodyText": "Need a new ______TS header here", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r458531807", "createdAt": "2020-07-22T04:47:42Z", "author": {"login": "wkurniawan07"}, "path": "src/test/java/teammates/test/cases/logic/FeedbackResponsesLogicTest.java", "diffHunk": "@@ -451,6 +451,24 @@ public void testIsNameVisibleTo() {\n         assertTrue(frLogic.isNameVisibleToUser(fq, fr, student3.email, UserRole.STUDENT, false, roster));\n         assertFalse(frLogic.isNameVisibleToUser(fq, fr, student5.email, UserRole.STUDENT, false, roster));\n \n+        fq.recipientType = FeedbackParticipantType.TEAMS;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8a88131d7dc84630272a2cd93a91c23582d909c"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MTQzNDM5OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNDo0ODoyMVrOG1Sklg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNDo1NDo0OVrOG1SqqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUzMTk5MA==", "bodyText": "You meant the first check? The second check is the pre-existing one", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r458531990", "createdAt": "2020-07-22T04:48:21Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,9 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            // The second check is used to accommodate legacy data where team giver is a student email", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8a88131d7dc84630272a2cd93a91c23582d909c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUzMjk2Nw==", "bodyText": "Yea, the pre-existing one is the one that's catering to legacy data I think. That's why @xpdavid suggested going ahead with this PR even though the session logic refactor meant that the original issue is no longer relevant", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r458532967", "createdAt": "2020-07-22T04:52:16Z", "author": {"login": "madanalogy"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,9 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            // The second check is used to accommodate legacy data where team giver is a student email", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUzMTk5MA=="}, "originalCommit": {"oid": "e8a88131d7dc84630272a2cd93a91c23582d909c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUzMzU0NQ==", "bodyText": "I see, got it", "url": "https://github.com/TEAMMATES/teammates/pull/10314#discussion_r458533545", "createdAt": "2020-07-22T04:54:49Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/logic/core/FeedbackResponsesLogic.java", "diffHunk": "@@ -201,7 +201,9 @@ public boolean isNameVisibleToUser(\n         // Early return if user is giver\n         if (question.giverType == FeedbackParticipantType.TEAMS) {\n             // if response is given by team, then anyone in the team can see the response\n-            if (roster.isStudentsInSameTeam(response.giver, userEmail)) {\n+            // The second check is used to accommodate legacy data where team giver is a student email", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUzMTk5MA=="}, "originalCommit": {"oid": "e8a88131d7dc84630272a2cd93a91c23582d909c"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3637, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}