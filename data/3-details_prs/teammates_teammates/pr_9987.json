{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5Mjg5ODY1", "number": 9987, "title": "[#9536] Admin Search Page E2E Tests", "bodyText": "Part of #9536\nOutline of Solution\n\nAdded putDocuments method to BackDoor for BaseTestCaseWithBackDoorApiAccess to put searchable documents into the datastore\nAdd AdminSearchPage which focuses on retrieving data from specific fields in the UI for comparison\nAdd AdminSearchPageE2ETest which compares the main fields in the search table to the data placed via backdoor.", "createdAt": "2020-03-16T14:51:06Z", "url": "https://github.com/TEAMMATES/teammates/pull/9987", "merged": true, "mergeCommit": {"oid": "cd186393ec213fa5117a8bc0806b52234709808b"}, "closed": true, "closedAt": "2020-03-30T05:33:02Z", "author": {"login": "jtankw3"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOO4hnAH2gAyMzg5Mjg5ODY1OjdiMDU2MzJjYTBiZGZiZjk0NjM2ODI3YjU3ZWJhNTEyNzliZmRjY2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSm0nfgFqTM4MzUyNDA5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b05632ca0bdfbf94636827b57eba51279bfdcca", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/7b05632ca0bdfbf94636827b57eba51279bfdcca", "committedDate": "2020-03-16T14:21:26Z", "message": "Add putDocuments method to BackDoor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdde64cfcb3ccab13352f9b23496c8ddf1db3099", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/cdde64cfcb3ccab13352f9b23496c8ddf1db3099", "committedDate": "2020-03-16T14:23:14Z", "message": "Add E2ETests for AdminSearchPage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxODkwMzg5", "url": "https://github.com/TEAMMATES/teammates/pull/9987#pullrequestreview-381890389", "createdAt": "2020-03-26T10:47:41Z", "commit": {"oid": "9623cc0a7ed310fb8c708368de910fdf3c187db5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMDo0Nzo0MlrOF8BF1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMDo1MDo1MlrOF8BNGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ3Njc1OA==", "bodyText": "Student1 is a rather generic term. This may result in unexpected results when there are other data in the system.", "url": "https://github.com/TEAMMATES/teammates/pull/9987#discussion_r398476758", "createdAt": "2020-03-26T10:47:42Z", "author": {"login": "wkurniawan07"}, "path": "src/e2e/java/teammates/e2e/cases/e2e/AdminSearchPageE2ETest.java", "diffHunk": "@@ -0,0 +1,188 @@\n+package teammates.e2e.cases.e2e;\n+\n+import java.time.Instant;\n+\n+import org.openqa.selenium.WebElement;\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.AccountAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackSessionAttributes;\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.common.util.StringHelper;\n+import teammates.e2e.pageobjects.AdminHomePage;\n+import teammates.e2e.pageobjects.AdminSearchPage;\n+import teammates.e2e.pageobjects.AppPage;\n+\n+/**\n+ * SUT: {@link Const.WebPageURIs#ADMIN_SEARCH_PAGE}.\n+ */\n+public class AdminSearchPageE2ETest extends BaseE2ETestCase {\n+    private AdminSearchPage searchPage;\n+\n+    @Override\n+    protected void prepareTestData() {\n+        testData = loadDataBundle(\"/AdminSearchPageE2ETest.json\");\n+        removeAndRestoreDataBundle(testData);\n+        putDocuments(testData);\n+    }\n+\n+    @Test\n+    public void allTests() {\n+        AppUrl url = createUrl(Const.WebPageURIs.ADMIN_SEARCH_PAGE);\n+        loginAdminToPage(url, AdminHomePage.class);\n+        searchPage = AppPage.getNewPageInstance(browser, url, AdminSearchPage.class);\n+\n+        browser.waitForPageLoad();\n+        StudentAttributes student = testData.students.get(\"student1InCourse1\");\n+        AccountAttributes studentAccount = testData.accounts.get(\"student1InCourse1\");\n+        InstructorAttributes instructor = testData.instructors.get(\"instructor1OfCourse1\");\n+        AccountAttributes instructorAccount = testData.accounts.get(\"instructor1OfCourse1\");\n+\n+        ______TS(\"Typical case: Search student keyword\");\n+        String searchContent = \"Student1\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9623cc0a7ed310fb8c708368de910fdf3c187db5"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ3NzU3NA==", "bodyText": "May need more example cases. I don't think resetting instructor google ID is the only action possible from this page.", "url": "https://github.com/TEAMMATES/teammates/pull/9987#discussion_r398477574", "createdAt": "2020-03-26T10:49:02Z", "author": {"login": "wkurniawan07"}, "path": "src/e2e/java/teammates/e2e/cases/e2e/AdminSearchPageE2ETest.java", "diffHunk": "@@ -0,0 +1,188 @@\n+package teammates.e2e.cases.e2e;\n+\n+import java.time.Instant;\n+\n+import org.openqa.selenium.WebElement;\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.AccountAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackSessionAttributes;\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.common.util.StringHelper;\n+import teammates.e2e.pageobjects.AdminHomePage;\n+import teammates.e2e.pageobjects.AdminSearchPage;\n+import teammates.e2e.pageobjects.AppPage;\n+\n+/**\n+ * SUT: {@link Const.WebPageURIs#ADMIN_SEARCH_PAGE}.\n+ */\n+public class AdminSearchPageE2ETest extends BaseE2ETestCase {\n+    private AdminSearchPage searchPage;\n+\n+    @Override\n+    protected void prepareTestData() {\n+        testData = loadDataBundle(\"/AdminSearchPageE2ETest.json\");\n+        removeAndRestoreDataBundle(testData);\n+        putDocuments(testData);\n+    }\n+\n+    @Test\n+    public void allTests() {\n+        AppUrl url = createUrl(Const.WebPageURIs.ADMIN_SEARCH_PAGE);\n+        loginAdminToPage(url, AdminHomePage.class);\n+        searchPage = AppPage.getNewPageInstance(browser, url, AdminSearchPage.class);\n+\n+        browser.waitForPageLoad();\n+        StudentAttributes student = testData.students.get(\"student1InCourse1\");\n+        AccountAttributes studentAccount = testData.accounts.get(\"student1InCourse1\");\n+        InstructorAttributes instructor = testData.instructors.get(\"instructor1OfCourse1\");\n+        AccountAttributes instructorAccount = testData.accounts.get(\"instructor1OfCourse1\");\n+\n+        ______TS(\"Typical case: Search student keyword\");\n+        String searchContent = \"Student1\";\n+        searchPage.inputSearchContent(searchContent);\n+        searchPage.clickSearchButton();\n+        verifyStudentRowContent(student, studentAccount);\n+        verifyStudentExpandedLinks(student);\n+\n+        ______TS(\"Typical case: Search for instructor email\");\n+        searchPage.clearSearchBox();\n+        searchContent = \"searchUI.instructor1@course1.tmt\";\n+        searchPage.inputSearchContent(searchContent);\n+        searchPage.clickSearchButton();\n+        verifyInstructorRowContent(instructor, instructorAccount);\n+        verifyInstructorExpandedLinks(instructor);\n+\n+        ______TS(\"Typical case: Reset instructor google id\");\n+        searchPage.resetInstructorGoogleId(instructor);\n+        instructor.googleId = null;\n+        verifyInstructorRowContent(instructor, instructorAccount);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9623cc0a7ed310fb8c708368de910fdf3c187db5"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ3ODI4Mw==", "bodyText": "Reason for this?", "url": "https://github.com/TEAMMATES/teammates/pull/9987#discussion_r398478283", "createdAt": "2020-03-26T10:50:17Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/ui/webapi/action/SearchAccountsAction.java", "diffHunk": "@@ -267,7 +267,7 @@ private String generateResultUrl(StudentAttributes student, String fsName) {\n             if (ib.getGoogleId() != null) {\n                 ib.setHomePageLink(Config.getFrontEndAppUrl(Const.WebPageURIs.INSTRUCTOR_HOME_PAGE)\n                         .withUserId(instructor.googleId)\n-                        .toAbsoluteString());\n+                        .toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9623cc0a7ed310fb8c708368de910fdf3c187db5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQ3ODYxOA==", "bodyText": "Unrelated change; although this doesn't affect correctness, try not to have this kind of stuff.", "url": "https://github.com/TEAMMATES/teammates/pull/9987#discussion_r398478618", "createdAt": "2020-03-26T10:50:52Z", "author": {"login": "wkurniawan07"}, "path": "src/web/app/pages-admin/admin-search-page/admin-search-page.component.html", "diffHunk": "@@ -92,7 +92,7 @@\n         </tr>\n       </thead>\n       <tbody>\n-        <ng-container *ngFor=\"let student of students\">\n+        <ng-container *ngFor=\"let student of students;\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9623cc0a7ed310fb8c708368de910fdf3c187db5"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a71942d32b6c4226eceae881dd49e24359ad4e3e", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/a71942d32b6c4226eceae881dd49e24359ad4e3e", "committedDate": "2020-03-27T06:48:07Z", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into admin-search-e2eTests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db76c0565651f92a6fcd5d2fb5b63d2433b49852", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/db76c0565651f92a6fcd5d2fb5b63d2433b49852", "committedDate": "2020-03-27T06:12:45Z", "message": "Merge branch 'master' into admin-search-e2eTests"}, "afterCommit": {"oid": "237c751568d9b05e137435fc26b12e45ae3e9c00", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/237c751568d9b05e137435fc26b12e45ae3e9c00", "committedDate": "2020-03-27T07:09:01Z", "message": "Add example cases to AdminSearchPageE2ETest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b70d2e28a6cb4935b43fd627aecb6eb86a89e1b3", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/b70d2e28a6cb4935b43fd627aecb6eb86a89e1b3", "committedDate": "2020-03-27T08:06:47Z", "message": "Add example case to AdminSearchPageE2ETest"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "237c751568d9b05e137435fc26b12e45ae3e9c00", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/237c751568d9b05e137435fc26b12e45ae3e9c00", "committedDate": "2020-03-27T07:09:01Z", "message": "Add example cases to AdminSearchPageE2ETest"}, "afterCommit": {"oid": "b70d2e28a6cb4935b43fd627aecb6eb86a89e1b3", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/b70d2e28a6cb4935b43fd627aecb6eb86a89e1b3", "committedDate": "2020-03-27T08:06:47Z", "message": "Add example case to AdminSearchPageE2ETest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a161a252129a8fe09f9b896a56e1ffd3bdd6da5", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/6a161a252129a8fe09f9b896a56e1ffd3bdd6da5", "committedDate": "2020-03-30T04:30:26Z", "message": "Merge branch 'master' into admin-search-e2eTests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNTI0MDkx", "url": "https://github.com/TEAMMATES/teammates/pull/9987#pullrequestreview-383524091", "createdAt": "2020-03-30T04:30:35Z", "commit": {"oid": "b70d2e28a6cb4935b43fd627aecb6eb86a89e1b3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4380, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}