{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4Nzc2NzIx", "number": 9967, "reviewThreads": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjoyODoxMFrODiMvpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwMTozNTo0NVrODqnWSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MTg2OTgzOnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjoyODoxMFrOFtUklA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMzozNjoyMVrOFuZRMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2NzI4NA==", "bodyText": "seems the logic can be simplified here?\nIs \"adding all accounts from 'newAccounts' that already exist in oldAccounts?\"", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r383067284", "createdAt": "2020-02-24T02:28:10Z", "author": {"login": "junming403"}, "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "diffHunk": "@@ -109,18 +110,249 @@ public void persistDataBundle(DataBundle dataBundle) throws InvalidParametersExc\n         processResponsesAndPopulateMap(responses, sessionResponsesMap);\n         processSessionsAndUpdateRespondents(sessions, courseInstructorsMap, sessionQuestionsMap, sessionResponsesMap);\n \n-        accountsDb.putEntities(googleIdAccountMap.values());\n-        profilesDb.putEntities(profiles);\n-        coursesDb.putEntities(courses);\n-        instructorsDb.putEntities(instructors);\n-        studentsDb.putEntities(students);\n-        fbDb.putEntities(sessions);\n+        List<AccountAttributes> newAccounts = accountsDb.putEntities(googleIdAccountMap.values());\n+\n+        List<StudentProfileAttributes> newProfiles = profilesDb.putEntities(profiles);\n+        List<CourseAttributes> newCourses = coursesDb.putEntities(courses);\n+        List<InstructorAttributes> newInstructors = instructorsDb.putEntities(instructors);\n+        List<StudentAttributes> newStudents = studentsDb.putEntities(students);\n+        List<FeedbackSessionAttributes> newFeedbackSessions = fbDb.putEntities(sessions);\n \n         List<FeedbackQuestionAttributes> createdQuestions = fqDb.putEntities(questions);\n         injectRealIds(responses, responseComments, createdQuestions);\n \n-        frDb.putEntities(responses);\n-        fcDb.putEntities(responseComments);\n+        List<FeedbackResponseAttributes> newFeedbackResponses = frDb.putEntities(responses);\n+        List<FeedbackResponseCommentAttributes> newFeedbackResponseComments = fcDb.putEntities(responseComments);\n+\n+        updateDataBundleAccounts(dataBundle, newAccounts);\n+\n+        updateDataBundleProfiles(dataBundle, newProfiles);\n+        updateDataBundleCourses(dataBundle, newCourses);\n+        updateDataBundleInstructors(dataBundle, newInstructors);\n+\n+        updateDataBundleStudents(dataBundle, newStudents);\n+        updateDataBundleFeedbackSessions(dataBundle, newFeedbackSessions);\n+        updateDataBundleFeedbackQuestions(dataBundle, createdQuestions);\n+        updateDataBundleFeedbackResponses(dataBundle, newFeedbackResponses);\n+        updateDataBundleFeedbackResponseComments(dataBundle, newFeedbackResponseComments);\n+\n+        return dataBundle;\n+\n+    }\n+\n+    private void updateDataBundleAccounts(DataBundle dataBundle, List<AccountAttributes> newAccounts) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75545c56e6df6b79635c05a4f87d0e084e361213"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzEzNTU1OQ==", "bodyText": "It is mapping back the accounts in newAccounts back to their original keys, by finding an corresponding account in the oldAccounts (which is the account before being added into the server)\nThe oldAccounts contain the Map<string, AccountAttributes> which contains the attributes before they were added into the server. NewAccounts contain a List of AccountAttributes, that contain the same objects as oldAccounts, but taken directly from the database after being added, which means that they have updated values that their respective counterparts in oldAccounts do not have.\nSince dataBundle uses Map to store the respective attributes, when we need to update the Attributes from the new ones directly from the database, we need to ensure that they get mapped back to the correct Key. This is because the external classes that uses databundle uses the keys to retrieve the attributes, and having the wrong attributes mapped to wrong keys will result in problems for those external classes.\nThe first problem is that when the values are passed into the database, key-value mapping is lost and we only have the list of attributes to work on. The second issue is that the old and new value aren't exactly equal, because the new attributes have some variables that are generated by the server (createdAt, and feedbackQuestionId are such variables). The third issue is that there seems to be no requirement for uniqueness for the attribute's variables, which means that there is no single variable that can be used to link the new attributes to the old attribute.\nI ended up with writing this n + 1 query to ensure that the updated attributes gets mapped back to the correct key, by comparing all possible relevant variables with the old values, that does not get changed by the database. It only affects tests so the performance impact won't be as significant, but I'm definitely open to using another approach if a better one exists.", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r383135559", "createdAt": "2020-02-24T08:46:37Z", "author": {"login": "daekoon"}, "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "diffHunk": "@@ -109,18 +110,249 @@ public void persistDataBundle(DataBundle dataBundle) throws InvalidParametersExc\n         processResponsesAndPopulateMap(responses, sessionResponsesMap);\n         processSessionsAndUpdateRespondents(sessions, courseInstructorsMap, sessionQuestionsMap, sessionResponsesMap);\n \n-        accountsDb.putEntities(googleIdAccountMap.values());\n-        profilesDb.putEntities(profiles);\n-        coursesDb.putEntities(courses);\n-        instructorsDb.putEntities(instructors);\n-        studentsDb.putEntities(students);\n-        fbDb.putEntities(sessions);\n+        List<AccountAttributes> newAccounts = accountsDb.putEntities(googleIdAccountMap.values());\n+\n+        List<StudentProfileAttributes> newProfiles = profilesDb.putEntities(profiles);\n+        List<CourseAttributes> newCourses = coursesDb.putEntities(courses);\n+        List<InstructorAttributes> newInstructors = instructorsDb.putEntities(instructors);\n+        List<StudentAttributes> newStudents = studentsDb.putEntities(students);\n+        List<FeedbackSessionAttributes> newFeedbackSessions = fbDb.putEntities(sessions);\n \n         List<FeedbackQuestionAttributes> createdQuestions = fqDb.putEntities(questions);\n         injectRealIds(responses, responseComments, createdQuestions);\n \n-        frDb.putEntities(responses);\n-        fcDb.putEntities(responseComments);\n+        List<FeedbackResponseAttributes> newFeedbackResponses = frDb.putEntities(responses);\n+        List<FeedbackResponseCommentAttributes> newFeedbackResponseComments = fcDb.putEntities(responseComments);\n+\n+        updateDataBundleAccounts(dataBundle, newAccounts);\n+\n+        updateDataBundleProfiles(dataBundle, newProfiles);\n+        updateDataBundleCourses(dataBundle, newCourses);\n+        updateDataBundleInstructors(dataBundle, newInstructors);\n+\n+        updateDataBundleStudents(dataBundle, newStudents);\n+        updateDataBundleFeedbackSessions(dataBundle, newFeedbackSessions);\n+        updateDataBundleFeedbackQuestions(dataBundle, createdQuestions);\n+        updateDataBundleFeedbackResponses(dataBundle, newFeedbackResponses);\n+        updateDataBundleFeedbackResponseComments(dataBundle, newFeedbackResponseComments);\n+\n+        return dataBundle;\n+\n+    }\n+\n+    private void updateDataBundleAccounts(DataBundle dataBundle, List<AccountAttributes> newAccounts) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2NzI4NA=="}, "originalCommit": {"oid": "75545c56e6df6b79635c05a4f87d0e084e361213"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzY1OTM0Nw==", "bodyText": "In this case if you want to check if one entry in oldAccounts exists in newAccounts, probably hasing is a better idea? Currently the double nested loop seems to be not efficient (O(n^2))", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r383659347", "createdAt": "2020-02-25T05:00:29Z", "author": {"login": "junming403"}, "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "diffHunk": "@@ -109,18 +110,249 @@ public void persistDataBundle(DataBundle dataBundle) throws InvalidParametersExc\n         processResponsesAndPopulateMap(responses, sessionResponsesMap);\n         processSessionsAndUpdateRespondents(sessions, courseInstructorsMap, sessionQuestionsMap, sessionResponsesMap);\n \n-        accountsDb.putEntities(googleIdAccountMap.values());\n-        profilesDb.putEntities(profiles);\n-        coursesDb.putEntities(courses);\n-        instructorsDb.putEntities(instructors);\n-        studentsDb.putEntities(students);\n-        fbDb.putEntities(sessions);\n+        List<AccountAttributes> newAccounts = accountsDb.putEntities(googleIdAccountMap.values());\n+\n+        List<StudentProfileAttributes> newProfiles = profilesDb.putEntities(profiles);\n+        List<CourseAttributes> newCourses = coursesDb.putEntities(courses);\n+        List<InstructorAttributes> newInstructors = instructorsDb.putEntities(instructors);\n+        List<StudentAttributes> newStudents = studentsDb.putEntities(students);\n+        List<FeedbackSessionAttributes> newFeedbackSessions = fbDb.putEntities(sessions);\n \n         List<FeedbackQuestionAttributes> createdQuestions = fqDb.putEntities(questions);\n         injectRealIds(responses, responseComments, createdQuestions);\n \n-        frDb.putEntities(responses);\n-        fcDb.putEntities(responseComments);\n+        List<FeedbackResponseAttributes> newFeedbackResponses = frDb.putEntities(responses);\n+        List<FeedbackResponseCommentAttributes> newFeedbackResponseComments = fcDb.putEntities(responseComments);\n+\n+        updateDataBundleAccounts(dataBundle, newAccounts);\n+\n+        updateDataBundleProfiles(dataBundle, newProfiles);\n+        updateDataBundleCourses(dataBundle, newCourses);\n+        updateDataBundleInstructors(dataBundle, newInstructors);\n+\n+        updateDataBundleStudents(dataBundle, newStudents);\n+        updateDataBundleFeedbackSessions(dataBundle, newFeedbackSessions);\n+        updateDataBundleFeedbackQuestions(dataBundle, createdQuestions);\n+        updateDataBundleFeedbackResponses(dataBundle, newFeedbackResponses);\n+        updateDataBundleFeedbackResponseComments(dataBundle, newFeedbackResponseComments);\n+\n+        return dataBundle;\n+\n+    }\n+\n+    private void updateDataBundleAccounts(DataBundle dataBundle, List<AccountAttributes> newAccounts) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2NzI4NA=="}, "originalCommit": {"oid": "75545c56e6df6b79635c05a4f87d0e084e361213"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE5MjgxNw==", "bodyText": "Updated logic to use hashing", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r384192817", "createdAt": "2020-02-25T23:36:21Z", "author": {"login": "daekoon"}, "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "diffHunk": "@@ -109,18 +110,249 @@ public void persistDataBundle(DataBundle dataBundle) throws InvalidParametersExc\n         processResponsesAndPopulateMap(responses, sessionResponsesMap);\n         processSessionsAndUpdateRespondents(sessions, courseInstructorsMap, sessionQuestionsMap, sessionResponsesMap);\n \n-        accountsDb.putEntities(googleIdAccountMap.values());\n-        profilesDb.putEntities(profiles);\n-        coursesDb.putEntities(courses);\n-        instructorsDb.putEntities(instructors);\n-        studentsDb.putEntities(students);\n-        fbDb.putEntities(sessions);\n+        List<AccountAttributes> newAccounts = accountsDb.putEntities(googleIdAccountMap.values());\n+\n+        List<StudentProfileAttributes> newProfiles = profilesDb.putEntities(profiles);\n+        List<CourseAttributes> newCourses = coursesDb.putEntities(courses);\n+        List<InstructorAttributes> newInstructors = instructorsDb.putEntities(instructors);\n+        List<StudentAttributes> newStudents = studentsDb.putEntities(students);\n+        List<FeedbackSessionAttributes> newFeedbackSessions = fbDb.putEntities(sessions);\n \n         List<FeedbackQuestionAttributes> createdQuestions = fqDb.putEntities(questions);\n         injectRealIds(responses, responseComments, createdQuestions);\n \n-        frDb.putEntities(responses);\n-        fcDb.putEntities(responseComments);\n+        List<FeedbackResponseAttributes> newFeedbackResponses = frDb.putEntities(responses);\n+        List<FeedbackResponseCommentAttributes> newFeedbackResponseComments = fcDb.putEntities(responseComments);\n+\n+        updateDataBundleAccounts(dataBundle, newAccounts);\n+\n+        updateDataBundleProfiles(dataBundle, newProfiles);\n+        updateDataBundleCourses(dataBundle, newCourses);\n+        updateDataBundleInstructors(dataBundle, newInstructors);\n+\n+        updateDataBundleStudents(dataBundle, newStudents);\n+        updateDataBundleFeedbackSessions(dataBundle, newFeedbackSessions);\n+        updateDataBundleFeedbackQuestions(dataBundle, createdQuestions);\n+        updateDataBundleFeedbackResponses(dataBundle, newFeedbackResponses);\n+        updateDataBundleFeedbackResponseComments(dataBundle, newFeedbackResponseComments);\n+\n+        return dataBundle;\n+\n+    }\n+\n+    private void updateDataBundleAccounts(DataBundle dataBundle, List<AccountAttributes> newAccounts) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2NzI4NA=="}, "originalCommit": {"oid": "75545c56e6df6b79635c05a4f87d0e084e361213"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MTg3MDQ2OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjoyODo1MFrOFtUk7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjoyODo1MFrOFtUk7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2NzM3NQ==", "bodyText": "same here\uff1f", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r383067375", "createdAt": "2020-02-24T02:28:50Z", "author": {"login": "junming403"}, "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "diffHunk": "@@ -109,18 +110,249 @@ public void persistDataBundle(DataBundle dataBundle) throws InvalidParametersExc\n         processResponsesAndPopulateMap(responses, sessionResponsesMap);\n         processSessionsAndUpdateRespondents(sessions, courseInstructorsMap, sessionQuestionsMap, sessionResponsesMap);\n \n-        accountsDb.putEntities(googleIdAccountMap.values());\n-        profilesDb.putEntities(profiles);\n-        coursesDb.putEntities(courses);\n-        instructorsDb.putEntities(instructors);\n-        studentsDb.putEntities(students);\n-        fbDb.putEntities(sessions);\n+        List<AccountAttributes> newAccounts = accountsDb.putEntities(googleIdAccountMap.values());\n+\n+        List<StudentProfileAttributes> newProfiles = profilesDb.putEntities(profiles);\n+        List<CourseAttributes> newCourses = coursesDb.putEntities(courses);\n+        List<InstructorAttributes> newInstructors = instructorsDb.putEntities(instructors);\n+        List<StudentAttributes> newStudents = studentsDb.putEntities(students);\n+        List<FeedbackSessionAttributes> newFeedbackSessions = fbDb.putEntities(sessions);\n \n         List<FeedbackQuestionAttributes> createdQuestions = fqDb.putEntities(questions);\n         injectRealIds(responses, responseComments, createdQuestions);\n \n-        frDb.putEntities(responses);\n-        fcDb.putEntities(responseComments);\n+        List<FeedbackResponseAttributes> newFeedbackResponses = frDb.putEntities(responses);\n+        List<FeedbackResponseCommentAttributes> newFeedbackResponseComments = fcDb.putEntities(responseComments);\n+\n+        updateDataBundleAccounts(dataBundle, newAccounts);\n+\n+        updateDataBundleProfiles(dataBundle, newProfiles);\n+        updateDataBundleCourses(dataBundle, newCourses);\n+        updateDataBundleInstructors(dataBundle, newInstructors);\n+\n+        updateDataBundleStudents(dataBundle, newStudents);\n+        updateDataBundleFeedbackSessions(dataBundle, newFeedbackSessions);\n+        updateDataBundleFeedbackQuestions(dataBundle, createdQuestions);\n+        updateDataBundleFeedbackResponses(dataBundle, newFeedbackResponses);\n+        updateDataBundleFeedbackResponseComments(dataBundle, newFeedbackResponseComments);\n+\n+        return dataBundle;\n+\n+    }\n+\n+    private void updateDataBundleAccounts(DataBundle dataBundle, List<AccountAttributes> newAccounts) {\n+        Map<String, AccountAttributes> oldAccounts = dataBundle.accounts;\n+        Map<String, AccountAttributes> accounts = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, AccountAttributes> entry : oldAccounts.entrySet()) {\n+            String key = entry.getKey();\n+            AccountAttributes value = entry.getValue();\n+\n+            for (AccountAttributes cur : newAccounts) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.name, value.name)\n+                            && customEquals(cur.institute, value.institute)\n+                            && customEquals(cur.googleId, value.googleId)) {\n+                    accounts.put(key, cur);\n+                    newAccounts.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.accounts = accounts;\n+    }\n+\n+    private void updateDataBundleProfiles(DataBundle dataBundle, List<StudentProfileAttributes> newProfiles) {\n+        Map<String, StudentProfileAttributes> oldProfiles = dataBundle.profiles;\n+        Map<String, StudentProfileAttributes> profiles = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, StudentProfileAttributes> entry : oldProfiles.entrySet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75545c56e6df6b79635c05a4f87d0e084e361213"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MTg3MDU1OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjoyOTowMFrOFtUlAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjoyOTowMFrOFtUlAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2NzM5Mw==", "bodyText": "same here", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r383067393", "createdAt": "2020-02-24T02:29:00Z", "author": {"login": "junming403"}, "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "diffHunk": "@@ -109,18 +110,249 @@ public void persistDataBundle(DataBundle dataBundle) throws InvalidParametersExc\n         processResponsesAndPopulateMap(responses, sessionResponsesMap);\n         processSessionsAndUpdateRespondents(sessions, courseInstructorsMap, sessionQuestionsMap, sessionResponsesMap);\n \n-        accountsDb.putEntities(googleIdAccountMap.values());\n-        profilesDb.putEntities(profiles);\n-        coursesDb.putEntities(courses);\n-        instructorsDb.putEntities(instructors);\n-        studentsDb.putEntities(students);\n-        fbDb.putEntities(sessions);\n+        List<AccountAttributes> newAccounts = accountsDb.putEntities(googleIdAccountMap.values());\n+\n+        List<StudentProfileAttributes> newProfiles = profilesDb.putEntities(profiles);\n+        List<CourseAttributes> newCourses = coursesDb.putEntities(courses);\n+        List<InstructorAttributes> newInstructors = instructorsDb.putEntities(instructors);\n+        List<StudentAttributes> newStudents = studentsDb.putEntities(students);\n+        List<FeedbackSessionAttributes> newFeedbackSessions = fbDb.putEntities(sessions);\n \n         List<FeedbackQuestionAttributes> createdQuestions = fqDb.putEntities(questions);\n         injectRealIds(responses, responseComments, createdQuestions);\n \n-        frDb.putEntities(responses);\n-        fcDb.putEntities(responseComments);\n+        List<FeedbackResponseAttributes> newFeedbackResponses = frDb.putEntities(responses);\n+        List<FeedbackResponseCommentAttributes> newFeedbackResponseComments = fcDb.putEntities(responseComments);\n+\n+        updateDataBundleAccounts(dataBundle, newAccounts);\n+\n+        updateDataBundleProfiles(dataBundle, newProfiles);\n+        updateDataBundleCourses(dataBundle, newCourses);\n+        updateDataBundleInstructors(dataBundle, newInstructors);\n+\n+        updateDataBundleStudents(dataBundle, newStudents);\n+        updateDataBundleFeedbackSessions(dataBundle, newFeedbackSessions);\n+        updateDataBundleFeedbackQuestions(dataBundle, createdQuestions);\n+        updateDataBundleFeedbackResponses(dataBundle, newFeedbackResponses);\n+        updateDataBundleFeedbackResponseComments(dataBundle, newFeedbackResponseComments);\n+\n+        return dataBundle;\n+\n+    }\n+\n+    private void updateDataBundleAccounts(DataBundle dataBundle, List<AccountAttributes> newAccounts) {\n+        Map<String, AccountAttributes> oldAccounts = dataBundle.accounts;\n+        Map<String, AccountAttributes> accounts = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, AccountAttributes> entry : oldAccounts.entrySet()) {\n+            String key = entry.getKey();\n+            AccountAttributes value = entry.getValue();\n+\n+            for (AccountAttributes cur : newAccounts) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.name, value.name)\n+                            && customEquals(cur.institute, value.institute)\n+                            && customEquals(cur.googleId, value.googleId)) {\n+                    accounts.put(key, cur);\n+                    newAccounts.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.accounts = accounts;\n+    }\n+\n+    private void updateDataBundleProfiles(DataBundle dataBundle, List<StudentProfileAttributes> newProfiles) {\n+        Map<String, StudentProfileAttributes> oldProfiles = dataBundle.profiles;\n+        Map<String, StudentProfileAttributes> profiles = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, StudentProfileAttributes> entry : oldProfiles.entrySet()) {\n+            String key = entry.getKey();\n+            StudentProfileAttributes value = entry.getValue();\n+\n+            for (StudentProfileAttributes cur : newProfiles) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.shortName, value.shortName)\n+                            && customEquals(cur.institute, value.institute)\n+                            && customEquals(cur.googleId, value.googleId)\n+                            && customEquals(cur.gender, value.gender)\n+                            && customEquals(cur.pictureKey, value.pictureKey)) {\n+                    profiles.put(key, cur);\n+                    newProfiles.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.profiles = profiles;\n+    }\n+\n+    private void updateDataBundleCourses(DataBundle dataBundle, List<CourseAttributes> newCourses) {\n+        Map<String, CourseAttributes> oldCourses = dataBundle.courses;\n+        Map<String, CourseAttributes> courses = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, CourseAttributes> entry : oldCourses.entrySet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75545c56e6df6b79635c05a4f87d0e084e361213"}, "originalPosition": 109}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MTg3MDY1OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjoyOToxMVrOFtUlDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjoyOToxMVrOFtUlDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2NzQwNw==", "bodyText": "same here", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r383067407", "createdAt": "2020-02-24T02:29:11Z", "author": {"login": "junming403"}, "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "diffHunk": "@@ -109,18 +110,249 @@ public void persistDataBundle(DataBundle dataBundle) throws InvalidParametersExc\n         processResponsesAndPopulateMap(responses, sessionResponsesMap);\n         processSessionsAndUpdateRespondents(sessions, courseInstructorsMap, sessionQuestionsMap, sessionResponsesMap);\n \n-        accountsDb.putEntities(googleIdAccountMap.values());\n-        profilesDb.putEntities(profiles);\n-        coursesDb.putEntities(courses);\n-        instructorsDb.putEntities(instructors);\n-        studentsDb.putEntities(students);\n-        fbDb.putEntities(sessions);\n+        List<AccountAttributes> newAccounts = accountsDb.putEntities(googleIdAccountMap.values());\n+\n+        List<StudentProfileAttributes> newProfiles = profilesDb.putEntities(profiles);\n+        List<CourseAttributes> newCourses = coursesDb.putEntities(courses);\n+        List<InstructorAttributes> newInstructors = instructorsDb.putEntities(instructors);\n+        List<StudentAttributes> newStudents = studentsDb.putEntities(students);\n+        List<FeedbackSessionAttributes> newFeedbackSessions = fbDb.putEntities(sessions);\n \n         List<FeedbackQuestionAttributes> createdQuestions = fqDb.putEntities(questions);\n         injectRealIds(responses, responseComments, createdQuestions);\n \n-        frDb.putEntities(responses);\n-        fcDb.putEntities(responseComments);\n+        List<FeedbackResponseAttributes> newFeedbackResponses = frDb.putEntities(responses);\n+        List<FeedbackResponseCommentAttributes> newFeedbackResponseComments = fcDb.putEntities(responseComments);\n+\n+        updateDataBundleAccounts(dataBundle, newAccounts);\n+\n+        updateDataBundleProfiles(dataBundle, newProfiles);\n+        updateDataBundleCourses(dataBundle, newCourses);\n+        updateDataBundleInstructors(dataBundle, newInstructors);\n+\n+        updateDataBundleStudents(dataBundle, newStudents);\n+        updateDataBundleFeedbackSessions(dataBundle, newFeedbackSessions);\n+        updateDataBundleFeedbackQuestions(dataBundle, createdQuestions);\n+        updateDataBundleFeedbackResponses(dataBundle, newFeedbackResponses);\n+        updateDataBundleFeedbackResponseComments(dataBundle, newFeedbackResponseComments);\n+\n+        return dataBundle;\n+\n+    }\n+\n+    private void updateDataBundleAccounts(DataBundle dataBundle, List<AccountAttributes> newAccounts) {\n+        Map<String, AccountAttributes> oldAccounts = dataBundle.accounts;\n+        Map<String, AccountAttributes> accounts = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, AccountAttributes> entry : oldAccounts.entrySet()) {\n+            String key = entry.getKey();\n+            AccountAttributes value = entry.getValue();\n+\n+            for (AccountAttributes cur : newAccounts) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.name, value.name)\n+                            && customEquals(cur.institute, value.institute)\n+                            && customEquals(cur.googleId, value.googleId)) {\n+                    accounts.put(key, cur);\n+                    newAccounts.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.accounts = accounts;\n+    }\n+\n+    private void updateDataBundleProfiles(DataBundle dataBundle, List<StudentProfileAttributes> newProfiles) {\n+        Map<String, StudentProfileAttributes> oldProfiles = dataBundle.profiles;\n+        Map<String, StudentProfileAttributes> profiles = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, StudentProfileAttributes> entry : oldProfiles.entrySet()) {\n+            String key = entry.getKey();\n+            StudentProfileAttributes value = entry.getValue();\n+\n+            for (StudentProfileAttributes cur : newProfiles) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.shortName, value.shortName)\n+                            && customEquals(cur.institute, value.institute)\n+                            && customEquals(cur.googleId, value.googleId)\n+                            && customEquals(cur.gender, value.gender)\n+                            && customEquals(cur.pictureKey, value.pictureKey)) {\n+                    profiles.put(key, cur);\n+                    newProfiles.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.profiles = profiles;\n+    }\n+\n+    private void updateDataBundleCourses(DataBundle dataBundle, List<CourseAttributes> newCourses) {\n+        Map<String, CourseAttributes> oldCourses = dataBundle.courses;\n+        Map<String, CourseAttributes> courses = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, CourseAttributes> entry : oldCourses.entrySet()) {\n+            String key = entry.getKey();\n+            CourseAttributes value = entry.getValue();\n+\n+            for (CourseAttributes cur : newCourses) {\n+                if (customEquals(cur.getId(), value.getId())\n+                            && customEquals(cur.getName(), value.getName())) {\n+                    courses.put(key, cur);\n+                    newCourses.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.courses = courses;\n+    }\n+\n+    private void updateDataBundleInstructors(DataBundle dataBundle, List<InstructorAttributes> newInstructors) {\n+        Map<String, InstructorAttributes> oldInstructors = dataBundle.instructors;\n+        Map<String, InstructorAttributes> instructors = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, InstructorAttributes> entry : oldInstructors.entrySet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75545c56e6df6b79635c05a4f87d0e084e361213"}, "originalPosition": 129}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MTg3MTMwOnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjozMDowMFrOFtUlaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjozMDowMFrOFtUlaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2NzQ5Nw==", "bodyText": "same here", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r383067497", "createdAt": "2020-02-24T02:30:00Z", "author": {"login": "junming403"}, "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "diffHunk": "@@ -109,18 +110,249 @@ public void persistDataBundle(DataBundle dataBundle) throws InvalidParametersExc\n         processResponsesAndPopulateMap(responses, sessionResponsesMap);\n         processSessionsAndUpdateRespondents(sessions, courseInstructorsMap, sessionQuestionsMap, sessionResponsesMap);\n \n-        accountsDb.putEntities(googleIdAccountMap.values());\n-        profilesDb.putEntities(profiles);\n-        coursesDb.putEntities(courses);\n-        instructorsDb.putEntities(instructors);\n-        studentsDb.putEntities(students);\n-        fbDb.putEntities(sessions);\n+        List<AccountAttributes> newAccounts = accountsDb.putEntities(googleIdAccountMap.values());\n+\n+        List<StudentProfileAttributes> newProfiles = profilesDb.putEntities(profiles);\n+        List<CourseAttributes> newCourses = coursesDb.putEntities(courses);\n+        List<InstructorAttributes> newInstructors = instructorsDb.putEntities(instructors);\n+        List<StudentAttributes> newStudents = studentsDb.putEntities(students);\n+        List<FeedbackSessionAttributes> newFeedbackSessions = fbDb.putEntities(sessions);\n \n         List<FeedbackQuestionAttributes> createdQuestions = fqDb.putEntities(questions);\n         injectRealIds(responses, responseComments, createdQuestions);\n \n-        frDb.putEntities(responses);\n-        fcDb.putEntities(responseComments);\n+        List<FeedbackResponseAttributes> newFeedbackResponses = frDb.putEntities(responses);\n+        List<FeedbackResponseCommentAttributes> newFeedbackResponseComments = fcDb.putEntities(responseComments);\n+\n+        updateDataBundleAccounts(dataBundle, newAccounts);\n+\n+        updateDataBundleProfiles(dataBundle, newProfiles);\n+        updateDataBundleCourses(dataBundle, newCourses);\n+        updateDataBundleInstructors(dataBundle, newInstructors);\n+\n+        updateDataBundleStudents(dataBundle, newStudents);\n+        updateDataBundleFeedbackSessions(dataBundle, newFeedbackSessions);\n+        updateDataBundleFeedbackQuestions(dataBundle, createdQuestions);\n+        updateDataBundleFeedbackResponses(dataBundle, newFeedbackResponses);\n+        updateDataBundleFeedbackResponseComments(dataBundle, newFeedbackResponseComments);\n+\n+        return dataBundle;\n+\n+    }\n+\n+    private void updateDataBundleAccounts(DataBundle dataBundle, List<AccountAttributes> newAccounts) {\n+        Map<String, AccountAttributes> oldAccounts = dataBundle.accounts;\n+        Map<String, AccountAttributes> accounts = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, AccountAttributes> entry : oldAccounts.entrySet()) {\n+            String key = entry.getKey();\n+            AccountAttributes value = entry.getValue();\n+\n+            for (AccountAttributes cur : newAccounts) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.name, value.name)\n+                            && customEquals(cur.institute, value.institute)\n+                            && customEquals(cur.googleId, value.googleId)) {\n+                    accounts.put(key, cur);\n+                    newAccounts.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.accounts = accounts;\n+    }\n+\n+    private void updateDataBundleProfiles(DataBundle dataBundle, List<StudentProfileAttributes> newProfiles) {\n+        Map<String, StudentProfileAttributes> oldProfiles = dataBundle.profiles;\n+        Map<String, StudentProfileAttributes> profiles = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, StudentProfileAttributes> entry : oldProfiles.entrySet()) {\n+            String key = entry.getKey();\n+            StudentProfileAttributes value = entry.getValue();\n+\n+            for (StudentProfileAttributes cur : newProfiles) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.shortName, value.shortName)\n+                            && customEquals(cur.institute, value.institute)\n+                            && customEquals(cur.googleId, value.googleId)\n+                            && customEquals(cur.gender, value.gender)\n+                            && customEquals(cur.pictureKey, value.pictureKey)) {\n+                    profiles.put(key, cur);\n+                    newProfiles.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.profiles = profiles;\n+    }\n+\n+    private void updateDataBundleCourses(DataBundle dataBundle, List<CourseAttributes> newCourses) {\n+        Map<String, CourseAttributes> oldCourses = dataBundle.courses;\n+        Map<String, CourseAttributes> courses = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, CourseAttributes> entry : oldCourses.entrySet()) {\n+            String key = entry.getKey();\n+            CourseAttributes value = entry.getValue();\n+\n+            for (CourseAttributes cur : newCourses) {\n+                if (customEquals(cur.getId(), value.getId())\n+                            && customEquals(cur.getName(), value.getName())) {\n+                    courses.put(key, cur);\n+                    newCourses.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.courses = courses;\n+    }\n+\n+    private void updateDataBundleInstructors(DataBundle dataBundle, List<InstructorAttributes> newInstructors) {\n+        Map<String, InstructorAttributes> oldInstructors = dataBundle.instructors;\n+        Map<String, InstructorAttributes> instructors = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, InstructorAttributes> entry : oldInstructors.entrySet()) {\n+            String key = entry.getKey();\n+            InstructorAttributes value = entry.getValue();\n+\n+            for (InstructorAttributes cur : newInstructors) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.name, value.name)\n+                            && customEquals(cur.courseId, value.courseId)\n+                            && customEquals(cur.googleId, value.googleId)\n+                            && customEquals(cur.displayedName, value.displayedName)\n+                            && customEquals(cur.role, value.role)) {\n+                    instructors.put(key, cur);\n+                    newInstructors.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.instructors = instructors;\n+    }\n+\n+    private void updateDataBundleStudents(DataBundle dataBundle, List<StudentAttributes> newStudents) {\n+        Map<String, StudentAttributes> oldStudents = dataBundle.students;\n+        Map<String, StudentAttributes> students = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, StudentAttributes> entry : oldStudents.entrySet()) {\n+            String key = entry.getKey();\n+            StudentAttributes value = entry.getValue();\n+\n+            for (StudentAttributes cur : newStudents) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.name, value.name)\n+                            && customEquals(cur.course, value.course)\n+                            && customEquals(cur.googleId, value.googleId)\n+                            && customEquals(cur.team, value.team)\n+                            && customEquals(cur.section, value.section)\n+                            && customEquals(cur.comments, value.comments)) {\n+                    students.put(key, cur);\n+                    newStudents.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.students = students;\n+    }\n+\n+    private void updateDataBundleFeedbackSessions(DataBundle dataBundle,\n+            List<FeedbackSessionAttributes> newFeedbackSessions) {\n+        Map<String, FeedbackSessionAttributes> oldFeedbackSessions = dataBundle.feedbackSessions;\n+        Map<String, FeedbackSessionAttributes> feedbackSessions = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, FeedbackSessionAttributes> entry : oldFeedbackSessions.entrySet()) {\n+            String key = entry.getKey();\n+            FeedbackSessionAttributes value = entry.getValue();\n+\n+            for (FeedbackSessionAttributes cur : newFeedbackSessions) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75545c56e6df6b79635c05a4f87d0e084e361213"}, "originalPosition": 183}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MTg3MTM5OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjozMDowNVrOFtUldQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjozMDowNVrOFtUldQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2NzUwOQ==", "bodyText": "same here", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r383067509", "createdAt": "2020-02-24T02:30:05Z", "author": {"login": "junming403"}, "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "diffHunk": "@@ -109,18 +110,249 @@ public void persistDataBundle(DataBundle dataBundle) throws InvalidParametersExc\n         processResponsesAndPopulateMap(responses, sessionResponsesMap);\n         processSessionsAndUpdateRespondents(sessions, courseInstructorsMap, sessionQuestionsMap, sessionResponsesMap);\n \n-        accountsDb.putEntities(googleIdAccountMap.values());\n-        profilesDb.putEntities(profiles);\n-        coursesDb.putEntities(courses);\n-        instructorsDb.putEntities(instructors);\n-        studentsDb.putEntities(students);\n-        fbDb.putEntities(sessions);\n+        List<AccountAttributes> newAccounts = accountsDb.putEntities(googleIdAccountMap.values());\n+\n+        List<StudentProfileAttributes> newProfiles = profilesDb.putEntities(profiles);\n+        List<CourseAttributes> newCourses = coursesDb.putEntities(courses);\n+        List<InstructorAttributes> newInstructors = instructorsDb.putEntities(instructors);\n+        List<StudentAttributes> newStudents = studentsDb.putEntities(students);\n+        List<FeedbackSessionAttributes> newFeedbackSessions = fbDb.putEntities(sessions);\n \n         List<FeedbackQuestionAttributes> createdQuestions = fqDb.putEntities(questions);\n         injectRealIds(responses, responseComments, createdQuestions);\n \n-        frDb.putEntities(responses);\n-        fcDb.putEntities(responseComments);\n+        List<FeedbackResponseAttributes> newFeedbackResponses = frDb.putEntities(responses);\n+        List<FeedbackResponseCommentAttributes> newFeedbackResponseComments = fcDb.putEntities(responseComments);\n+\n+        updateDataBundleAccounts(dataBundle, newAccounts);\n+\n+        updateDataBundleProfiles(dataBundle, newProfiles);\n+        updateDataBundleCourses(dataBundle, newCourses);\n+        updateDataBundleInstructors(dataBundle, newInstructors);\n+\n+        updateDataBundleStudents(dataBundle, newStudents);\n+        updateDataBundleFeedbackSessions(dataBundle, newFeedbackSessions);\n+        updateDataBundleFeedbackQuestions(dataBundle, createdQuestions);\n+        updateDataBundleFeedbackResponses(dataBundle, newFeedbackResponses);\n+        updateDataBundleFeedbackResponseComments(dataBundle, newFeedbackResponseComments);\n+\n+        return dataBundle;\n+\n+    }\n+\n+    private void updateDataBundleAccounts(DataBundle dataBundle, List<AccountAttributes> newAccounts) {\n+        Map<String, AccountAttributes> oldAccounts = dataBundle.accounts;\n+        Map<String, AccountAttributes> accounts = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, AccountAttributes> entry : oldAccounts.entrySet()) {\n+            String key = entry.getKey();\n+            AccountAttributes value = entry.getValue();\n+\n+            for (AccountAttributes cur : newAccounts) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.name, value.name)\n+                            && customEquals(cur.institute, value.institute)\n+                            && customEquals(cur.googleId, value.googleId)) {\n+                    accounts.put(key, cur);\n+                    newAccounts.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.accounts = accounts;\n+    }\n+\n+    private void updateDataBundleProfiles(DataBundle dataBundle, List<StudentProfileAttributes> newProfiles) {\n+        Map<String, StudentProfileAttributes> oldProfiles = dataBundle.profiles;\n+        Map<String, StudentProfileAttributes> profiles = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, StudentProfileAttributes> entry : oldProfiles.entrySet()) {\n+            String key = entry.getKey();\n+            StudentProfileAttributes value = entry.getValue();\n+\n+            for (StudentProfileAttributes cur : newProfiles) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.shortName, value.shortName)\n+                            && customEquals(cur.institute, value.institute)\n+                            && customEquals(cur.googleId, value.googleId)\n+                            && customEquals(cur.gender, value.gender)\n+                            && customEquals(cur.pictureKey, value.pictureKey)) {\n+                    profiles.put(key, cur);\n+                    newProfiles.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.profiles = profiles;\n+    }\n+\n+    private void updateDataBundleCourses(DataBundle dataBundle, List<CourseAttributes> newCourses) {\n+        Map<String, CourseAttributes> oldCourses = dataBundle.courses;\n+        Map<String, CourseAttributes> courses = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, CourseAttributes> entry : oldCourses.entrySet()) {\n+            String key = entry.getKey();\n+            CourseAttributes value = entry.getValue();\n+\n+            for (CourseAttributes cur : newCourses) {\n+                if (customEquals(cur.getId(), value.getId())\n+                            && customEquals(cur.getName(), value.getName())) {\n+                    courses.put(key, cur);\n+                    newCourses.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.courses = courses;\n+    }\n+\n+    private void updateDataBundleInstructors(DataBundle dataBundle, List<InstructorAttributes> newInstructors) {\n+        Map<String, InstructorAttributes> oldInstructors = dataBundle.instructors;\n+        Map<String, InstructorAttributes> instructors = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, InstructorAttributes> entry : oldInstructors.entrySet()) {\n+            String key = entry.getKey();\n+            InstructorAttributes value = entry.getValue();\n+\n+            for (InstructorAttributes cur : newInstructors) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.name, value.name)\n+                            && customEquals(cur.courseId, value.courseId)\n+                            && customEquals(cur.googleId, value.googleId)\n+                            && customEquals(cur.displayedName, value.displayedName)\n+                            && customEquals(cur.role, value.role)) {\n+                    instructors.put(key, cur);\n+                    newInstructors.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.instructors = instructors;\n+    }\n+\n+    private void updateDataBundleStudents(DataBundle dataBundle, List<StudentAttributes> newStudents) {\n+        Map<String, StudentAttributes> oldStudents = dataBundle.students;\n+        Map<String, StudentAttributes> students = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, StudentAttributes> entry : oldStudents.entrySet()) {\n+            String key = entry.getKey();\n+            StudentAttributes value = entry.getValue();\n+\n+            for (StudentAttributes cur : newStudents) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.name, value.name)\n+                            && customEquals(cur.course, value.course)\n+                            && customEquals(cur.googleId, value.googleId)\n+                            && customEquals(cur.team, value.team)\n+                            && customEquals(cur.section, value.section)\n+                            && customEquals(cur.comments, value.comments)) {\n+                    students.put(key, cur);\n+                    newStudents.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.students = students;\n+    }\n+\n+    private void updateDataBundleFeedbackSessions(DataBundle dataBundle,\n+            List<FeedbackSessionAttributes> newFeedbackSessions) {\n+        Map<String, FeedbackSessionAttributes> oldFeedbackSessions = dataBundle.feedbackSessions;\n+        Map<String, FeedbackSessionAttributes> feedbackSessions = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, FeedbackSessionAttributes> entry : oldFeedbackSessions.entrySet()) {\n+            String key = entry.getKey();\n+            FeedbackSessionAttributes value = entry.getValue();\n+\n+            for (FeedbackSessionAttributes cur : newFeedbackSessions) {\n+                if (customEquals(cur.getFeedbackSessionName(), value.getFeedbackSessionName())\n+                            && customEquals(cur.getCourseId(), value.getCourseId())\n+                            && customEquals(cur.getInstructions(), value.getInstructions())\n+                            && customEquals(cur.getCreatorEmail(), value.getCreatorEmail())) {\n+                    feedbackSessions.put(key, cur);\n+                    newFeedbackSessions.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.feedbackSessions = feedbackSessions;\n+    }\n+\n+    private void updateDataBundleFeedbackQuestions(DataBundle dataBundle,\n+                List<FeedbackQuestionAttributes> createdQuestions) {\n+        Map<String, FeedbackQuestionAttributes> oldFeedbackQuestions = dataBundle.feedbackQuestions;\n+        Map<String, FeedbackQuestionAttributes> feedbackQuestions = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, FeedbackQuestionAttributes> entry : oldFeedbackQuestions.entrySet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75545c56e6df6b79635c05a4f87d0e084e361213"}, "originalPosition": 202}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MTg3MTU1OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjozMDoxMlrOFtUliQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjozMDoxMlrOFtUliQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2NzUyOQ==", "bodyText": "same here", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r383067529", "createdAt": "2020-02-24T02:30:12Z", "author": {"login": "junming403"}, "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "diffHunk": "@@ -109,18 +110,249 @@ public void persistDataBundle(DataBundle dataBundle) throws InvalidParametersExc\n         processResponsesAndPopulateMap(responses, sessionResponsesMap);\n         processSessionsAndUpdateRespondents(sessions, courseInstructorsMap, sessionQuestionsMap, sessionResponsesMap);\n \n-        accountsDb.putEntities(googleIdAccountMap.values());\n-        profilesDb.putEntities(profiles);\n-        coursesDb.putEntities(courses);\n-        instructorsDb.putEntities(instructors);\n-        studentsDb.putEntities(students);\n-        fbDb.putEntities(sessions);\n+        List<AccountAttributes> newAccounts = accountsDb.putEntities(googleIdAccountMap.values());\n+\n+        List<StudentProfileAttributes> newProfiles = profilesDb.putEntities(profiles);\n+        List<CourseAttributes> newCourses = coursesDb.putEntities(courses);\n+        List<InstructorAttributes> newInstructors = instructorsDb.putEntities(instructors);\n+        List<StudentAttributes> newStudents = studentsDb.putEntities(students);\n+        List<FeedbackSessionAttributes> newFeedbackSessions = fbDb.putEntities(sessions);\n \n         List<FeedbackQuestionAttributes> createdQuestions = fqDb.putEntities(questions);\n         injectRealIds(responses, responseComments, createdQuestions);\n \n-        frDb.putEntities(responses);\n-        fcDb.putEntities(responseComments);\n+        List<FeedbackResponseAttributes> newFeedbackResponses = frDb.putEntities(responses);\n+        List<FeedbackResponseCommentAttributes> newFeedbackResponseComments = fcDb.putEntities(responseComments);\n+\n+        updateDataBundleAccounts(dataBundle, newAccounts);\n+\n+        updateDataBundleProfiles(dataBundle, newProfiles);\n+        updateDataBundleCourses(dataBundle, newCourses);\n+        updateDataBundleInstructors(dataBundle, newInstructors);\n+\n+        updateDataBundleStudents(dataBundle, newStudents);\n+        updateDataBundleFeedbackSessions(dataBundle, newFeedbackSessions);\n+        updateDataBundleFeedbackQuestions(dataBundle, createdQuestions);\n+        updateDataBundleFeedbackResponses(dataBundle, newFeedbackResponses);\n+        updateDataBundleFeedbackResponseComments(dataBundle, newFeedbackResponseComments);\n+\n+        return dataBundle;\n+\n+    }\n+\n+    private void updateDataBundleAccounts(DataBundle dataBundle, List<AccountAttributes> newAccounts) {\n+        Map<String, AccountAttributes> oldAccounts = dataBundle.accounts;\n+        Map<String, AccountAttributes> accounts = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, AccountAttributes> entry : oldAccounts.entrySet()) {\n+            String key = entry.getKey();\n+            AccountAttributes value = entry.getValue();\n+\n+            for (AccountAttributes cur : newAccounts) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.name, value.name)\n+                            && customEquals(cur.institute, value.institute)\n+                            && customEquals(cur.googleId, value.googleId)) {\n+                    accounts.put(key, cur);\n+                    newAccounts.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.accounts = accounts;\n+    }\n+\n+    private void updateDataBundleProfiles(DataBundle dataBundle, List<StudentProfileAttributes> newProfiles) {\n+        Map<String, StudentProfileAttributes> oldProfiles = dataBundle.profiles;\n+        Map<String, StudentProfileAttributes> profiles = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, StudentProfileAttributes> entry : oldProfiles.entrySet()) {\n+            String key = entry.getKey();\n+            StudentProfileAttributes value = entry.getValue();\n+\n+            for (StudentProfileAttributes cur : newProfiles) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.shortName, value.shortName)\n+                            && customEquals(cur.institute, value.institute)\n+                            && customEquals(cur.googleId, value.googleId)\n+                            && customEquals(cur.gender, value.gender)\n+                            && customEquals(cur.pictureKey, value.pictureKey)) {\n+                    profiles.put(key, cur);\n+                    newProfiles.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.profiles = profiles;\n+    }\n+\n+    private void updateDataBundleCourses(DataBundle dataBundle, List<CourseAttributes> newCourses) {\n+        Map<String, CourseAttributes> oldCourses = dataBundle.courses;\n+        Map<String, CourseAttributes> courses = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, CourseAttributes> entry : oldCourses.entrySet()) {\n+            String key = entry.getKey();\n+            CourseAttributes value = entry.getValue();\n+\n+            for (CourseAttributes cur : newCourses) {\n+                if (customEquals(cur.getId(), value.getId())\n+                            && customEquals(cur.getName(), value.getName())) {\n+                    courses.put(key, cur);\n+                    newCourses.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.courses = courses;\n+    }\n+\n+    private void updateDataBundleInstructors(DataBundle dataBundle, List<InstructorAttributes> newInstructors) {\n+        Map<String, InstructorAttributes> oldInstructors = dataBundle.instructors;\n+        Map<String, InstructorAttributes> instructors = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, InstructorAttributes> entry : oldInstructors.entrySet()) {\n+            String key = entry.getKey();\n+            InstructorAttributes value = entry.getValue();\n+\n+            for (InstructorAttributes cur : newInstructors) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.name, value.name)\n+                            && customEquals(cur.courseId, value.courseId)\n+                            && customEquals(cur.googleId, value.googleId)\n+                            && customEquals(cur.displayedName, value.displayedName)\n+                            && customEquals(cur.role, value.role)) {\n+                    instructors.put(key, cur);\n+                    newInstructors.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.instructors = instructors;\n+    }\n+\n+    private void updateDataBundleStudents(DataBundle dataBundle, List<StudentAttributes> newStudents) {\n+        Map<String, StudentAttributes> oldStudents = dataBundle.students;\n+        Map<String, StudentAttributes> students = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, StudentAttributes> entry : oldStudents.entrySet()) {\n+            String key = entry.getKey();\n+            StudentAttributes value = entry.getValue();\n+\n+            for (StudentAttributes cur : newStudents) {\n+                if (customEquals(cur.email, value.email)\n+                            && customEquals(cur.name, value.name)\n+                            && customEquals(cur.course, value.course)\n+                            && customEquals(cur.googleId, value.googleId)\n+                            && customEquals(cur.team, value.team)\n+                            && customEquals(cur.section, value.section)\n+                            && customEquals(cur.comments, value.comments)) {\n+                    students.put(key, cur);\n+                    newStudents.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.students = students;\n+    }\n+\n+    private void updateDataBundleFeedbackSessions(DataBundle dataBundle,\n+            List<FeedbackSessionAttributes> newFeedbackSessions) {\n+        Map<String, FeedbackSessionAttributes> oldFeedbackSessions = dataBundle.feedbackSessions;\n+        Map<String, FeedbackSessionAttributes> feedbackSessions = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, FeedbackSessionAttributes> entry : oldFeedbackSessions.entrySet()) {\n+            String key = entry.getKey();\n+            FeedbackSessionAttributes value = entry.getValue();\n+\n+            for (FeedbackSessionAttributes cur : newFeedbackSessions) {\n+                if (customEquals(cur.getFeedbackSessionName(), value.getFeedbackSessionName())\n+                            && customEquals(cur.getCourseId(), value.getCourseId())\n+                            && customEquals(cur.getInstructions(), value.getInstructions())\n+                            && customEquals(cur.getCreatorEmail(), value.getCreatorEmail())) {\n+                    feedbackSessions.put(key, cur);\n+                    newFeedbackSessions.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.feedbackSessions = feedbackSessions;\n+    }\n+\n+    private void updateDataBundleFeedbackQuestions(DataBundle dataBundle,\n+                List<FeedbackQuestionAttributes> createdQuestions) {\n+        Map<String, FeedbackQuestionAttributes> oldFeedbackQuestions = dataBundle.feedbackQuestions;\n+        Map<String, FeedbackQuestionAttributes> feedbackQuestions = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, FeedbackQuestionAttributes> entry : oldFeedbackQuestions.entrySet()) {\n+            String key = entry.getKey();\n+            FeedbackQuestionAttributes value = entry.getValue();\n+\n+            for (FeedbackQuestionAttributes cur : createdQuestions) {\n+                if (customEquals(cur.feedbackSessionName, value.feedbackSessionName)\n+                            && customEquals(cur.courseId, value.courseId)\n+                            && cur.questionNumber == value.questionNumber) {\n+                    feedbackQuestions.put(key, cur);\n+                    createdQuestions.remove(cur);\n+                    break;\n+                }\n+            }\n+        }\n+        dataBundle.feedbackQuestions = feedbackQuestions;\n+    }\n+\n+    private void updateDataBundleFeedbackResponses(DataBundle dataBundle,\n+                List<FeedbackResponseAttributes> newFeedbackResponses) {\n+        Map<String, FeedbackResponseAttributes> oldFeedbackResponses = dataBundle.feedbackResponses;\n+        Map<String, FeedbackResponseAttributes> feedbackResponses = new LinkedHashMap<>();\n+\n+        for (Map.Entry<String, FeedbackResponseAttributes> entry : oldFeedbackResponses.entrySet()) {\n+            String key = entry.getKey();\n+            FeedbackResponseAttributes value = entry.getValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75545c56e6df6b79635c05a4f87d0e084e361213"}, "originalPosition": 226}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMTg2OTU3OnYy", "diffSide": "RIGHT", "path": "src/e2e/java/teammates/e2e/util/BackDoor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwNzo1MTo0NFrOF0sH1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNDoxMzo1NFrOF21-Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc5MzE3Mw==", "bodyText": "The function return two different things (json response or BACKDOOR_STATUS_FAILURE ) with different meanings which result in the hack in https://github.com/TEAMMATES/teammates/pull/9967/files#diff-6509e6ed4f2a3ea02c0d46c61b1ff10fR185. I think it is better to just throw exception for failing situation.", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r390793173", "createdAt": "2020-03-11T07:51:44Z", "author": {"login": "xpdavid"}, "path": "src/e2e/java/teammates/e2e/util/BackDoor.java", "diffHunk": "@@ -215,8 +215,10 @@ public static String removeAndRestoreDataBundle(DataBundle dataBundle) {\n         removeDataBundle(dataBundle);\n         ResponseBodyAndCode putRequestOutput =\n                 executePostRequest(Const.ResourceURIs.DATABUNDLE, null, JsonUtils.toJson(dataBundle));\n-        return putRequestOutput.responseCode == HttpStatus.SC_OK\n-                ? Const.StatusCodes.BACKDOOR_STATUS_SUCCESS : Const.StatusCodes.BACKDOOR_STATUS_FAILURE;\n+        if (putRequestOutput.responseCode == HttpStatus.SC_OK) {\n+            return putRequestOutput.responseBody;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b6146b62d1eac055f6c084dd29705ed2b1c4efe"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzA1MTY4Ng==", "bodyText": "Updated code to throw exception when HTTP request fails for removeandupdateDataBundle", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r393051686", "createdAt": "2020-03-16T14:13:54Z", "author": {"login": "daekoon"}, "path": "src/e2e/java/teammates/e2e/util/BackDoor.java", "diffHunk": "@@ -215,8 +215,10 @@ public static String removeAndRestoreDataBundle(DataBundle dataBundle) {\n         removeDataBundle(dataBundle);\n         ResponseBodyAndCode putRequestOutput =\n                 executePostRequest(Const.ResourceURIs.DATABUNDLE, null, JsonUtils.toJson(dataBundle));\n-        return putRequestOutput.responseCode == HttpStatus.SC_OK\n-                ? Const.StatusCodes.BACKDOOR_STATUS_SUCCESS : Const.StatusCodes.BACKDOOR_STATUS_FAILURE;\n+        if (putRequestOutput.responseCode == HttpStatus.SC_OK) {\n+            return putRequestOutput.responseBody;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc5MzE3Mw=="}, "originalCommit": {"oid": "3b6146b62d1eac055f6c084dd29705ed2b1c4efe"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMTg5MTEyOnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwNzo1OTo1NVrOF0sU5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNTozMzozMVrOF25vDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc5NjUxOQ==", "bodyText": "All the logic above looks the same? Why not writing a generic function?", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r390796519", "createdAt": "2020-03-11T07:59:55Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "diffHunk": "@@ -109,18 +110,226 @@ public void persistDataBundle(DataBundle dataBundle) throws InvalidParametersExc\n         processResponsesAndPopulateMap(responses, sessionResponsesMap);\n         processSessionsAndUpdateRespondents(sessions, courseInstructorsMap, sessionQuestionsMap, sessionResponsesMap);\n \n-        accountsDb.putEntities(googleIdAccountMap.values());\n-        profilesDb.putEntities(profiles);\n-        coursesDb.putEntities(courses);\n-        instructorsDb.putEntities(instructors);\n-        studentsDb.putEntities(students);\n-        fbDb.putEntities(sessions);\n+        List<AccountAttributes> newAccounts = accountsDb.putEntities(googleIdAccountMap.values());\n+\n+        List<StudentProfileAttributes> newProfiles = profilesDb.putEntities(profiles);\n+        List<CourseAttributes> newCourses = coursesDb.putEntities(courses);\n+        List<InstructorAttributes> newInstructors = instructorsDb.putEntities(instructors);\n+        List<StudentAttributes> newStudents = studentsDb.putEntities(students);\n+        List<FeedbackSessionAttributes> newFeedbackSessions = fbDb.putEntities(sessions);\n \n         List<FeedbackQuestionAttributes> createdQuestions = fqDb.putEntities(questions);\n         injectRealIds(responses, responseComments, createdQuestions);\n \n-        frDb.putEntities(responses);\n-        fcDb.putEntities(responseComments);\n+        List<FeedbackResponseAttributes> newFeedbackResponses = frDb.putEntities(responses);\n+        List<FeedbackResponseCommentAttributes> newFeedbackResponseComments = fcDb.putEntities(responseComments);\n+\n+        updateDataBundleAccounts(dataBundle, newAccounts);\n+\n+        updateDataBundleProfiles(dataBundle, newProfiles);\n+        updateDataBundleCourses(dataBundle, newCourses);\n+        updateDataBundleInstructors(dataBundle, newInstructors);\n+\n+        updateDataBundleStudents(dataBundle, newStudents);\n+        updateDataBundleFeedbackSessions(dataBundle, newFeedbackSessions);\n+        updateDataBundleFeedbackQuestions(dataBundle, createdQuestions);\n+        updateDataBundleFeedbackResponses(dataBundle, newFeedbackResponses);\n+        updateDataBundleFeedbackResponseComments(dataBundle, newFeedbackResponseComments);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b6146b62d1eac055f6c084dd29705ed2b1c4efe"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzExMzM1Ng==", "bodyText": "Updated all updateXXX methods into a generic function", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r393113356", "createdAt": "2020-03-16T15:33:31Z", "author": {"login": "daekoon"}, "path": "src/main/java/teammates/logic/core/DataBundleLogic.java", "diffHunk": "@@ -109,18 +110,226 @@ public void persistDataBundle(DataBundle dataBundle) throws InvalidParametersExc\n         processResponsesAndPopulateMap(responses, sessionResponsesMap);\n         processSessionsAndUpdateRespondents(sessions, courseInstructorsMap, sessionQuestionsMap, sessionResponsesMap);\n \n-        accountsDb.putEntities(googleIdAccountMap.values());\n-        profilesDb.putEntities(profiles);\n-        coursesDb.putEntities(courses);\n-        instructorsDb.putEntities(instructors);\n-        studentsDb.putEntities(students);\n-        fbDb.putEntities(sessions);\n+        List<AccountAttributes> newAccounts = accountsDb.putEntities(googleIdAccountMap.values());\n+\n+        List<StudentProfileAttributes> newProfiles = profilesDb.putEntities(profiles);\n+        List<CourseAttributes> newCourses = coursesDb.putEntities(courses);\n+        List<InstructorAttributes> newInstructors = instructorsDb.putEntities(instructors);\n+        List<StudentAttributes> newStudents = studentsDb.putEntities(students);\n+        List<FeedbackSessionAttributes> newFeedbackSessions = fbDb.putEntities(sessions);\n \n         List<FeedbackQuestionAttributes> createdQuestions = fqDb.putEntities(questions);\n         injectRealIds(responses, responseComments, createdQuestions);\n \n-        frDb.putEntities(responses);\n-        fcDb.putEntities(responseComments);\n+        List<FeedbackResponseAttributes> newFeedbackResponses = frDb.putEntities(responses);\n+        List<FeedbackResponseCommentAttributes> newFeedbackResponseComments = fcDb.putEntities(responseComments);\n+\n+        updateDataBundleAccounts(dataBundle, newAccounts);\n+\n+        updateDataBundleProfiles(dataBundle, newProfiles);\n+        updateDataBundleCourses(dataBundle, newCourses);\n+        updateDataBundleInstructors(dataBundle, newInstructors);\n+\n+        updateDataBundleStudents(dataBundle, newStudents);\n+        updateDataBundleFeedbackSessions(dataBundle, newFeedbackSessions);\n+        updateDataBundleFeedbackQuestions(dataBundle, createdQuestions);\n+        updateDataBundleFeedbackResponses(dataBundle, newFeedbackResponses);\n+        updateDataBundleFeedbackResponseComments(dataBundle, newFeedbackResponseComments);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc5NjUxOQ=="}, "originalCommit": {"oid": "3b6146b62d1eac055f6c084dd29705ed2b1c4efe"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNjk3NTIwOnYy", "diffSide": "RIGHT", "path": "src/e2e/java/teammates/e2e/cases/lnp/BaseLNPTestCase.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjoyNzo0MlrOF28CqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODoyNjozOFrOF4Rutg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1MTE0NQ==", "bodyText": "Just a nit: The whole message body can be the json. Don't use a specific field to hold them (magic \"message\" field) .", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r393151145", "createdAt": "2020-03-16T16:27:42Z", "author": {"login": "xpdavid"}, "path": "src/e2e/java/teammates/e2e/cases/lnp/BaseLNPTestCase.java", "diffHunk": "@@ -162,18 +163,27 @@ protected void createTestData() {\n         LNPTestData testData = getTestData();\n         try {\n             createJsonDataFile(testData);\n+            persistTestData();\n             createCsvConfigDataFile(testData);\n-        } catch (IOException ex) {\n+        } catch (IOException | HttpRequestFailedException ex) {\n             log.severe(TeammatesException.toStringWithStackTrace(ex));\n         }\n     }\n \n     /**\n      * Creates the entities in the datastore from the JSON data file.\n      */\n-    protected void persistTestData() {\n+    protected void persistTestData() throws IOException, HttpRequestFailedException {\n         DataBundle dataBundle = loadDataBundle(getJsonDataPath());\n-        BackDoor.removeAndRestoreDataBundle(dataBundle);\n+        String responseBody = \"\";\n+        responseBody = BackDoor.removeAndRestoreDataBundle(dataBundle);\n+\n+        String pathToResultFile = createFileAndDirectory(TestProperties.LNP_TEST_DATA_FOLDER, getJsonDataPath());\n+        String jsonValue = JsonUtils.parse(responseBody).getAsJsonObject().get(\"message\").getAsString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2293eec588f0a11399ec8c02ec8cce57318f376"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0NDY4OA==", "bodyText": "From what I checked, in order to be able to return the entire DataBundle object as json I need to create a new DataBundleData class that extends ApiOutput, and converts all the values into xxxData. I checked through the various xxxData classes, and my concern is that some of the classes does not have the same structure as their respective xxxAttributes.\nFor example, the class FeedbackQuestionData converts the two fields, showResponsesTo and showGiverNameTo, which are FeedbackParticipantType class, into FeedbackVisibilityType class. I'm worried that using xxxData will have unintended side effect - should we proceed with this? (Removing the magic \"message\" field)", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r394544688", "createdAt": "2020-03-18T18:08:39Z", "author": {"login": "daekoon"}, "path": "src/e2e/java/teammates/e2e/cases/lnp/BaseLNPTestCase.java", "diffHunk": "@@ -162,18 +163,27 @@ protected void createTestData() {\n         LNPTestData testData = getTestData();\n         try {\n             createJsonDataFile(testData);\n+            persistTestData();\n             createCsvConfigDataFile(testData);\n-        } catch (IOException ex) {\n+        } catch (IOException | HttpRequestFailedException ex) {\n             log.severe(TeammatesException.toStringWithStackTrace(ex));\n         }\n     }\n \n     /**\n      * Creates the entities in the datastore from the JSON data file.\n      */\n-    protected void persistTestData() {\n+    protected void persistTestData() throws IOException, HttpRequestFailedException {\n         DataBundle dataBundle = loadDataBundle(getJsonDataPath());\n-        BackDoor.removeAndRestoreDataBundle(dataBundle);\n+        String responseBody = \"\";\n+        responseBody = BackDoor.removeAndRestoreDataBundle(dataBundle);\n+\n+        String pathToResultFile = createFileAndDirectory(TestProperties.LNP_TEST_DATA_FOLDER, getJsonDataPath());\n+        String jsonValue = JsonUtils.parse(responseBody).getAsJsonObject().get(\"message\").getAsString();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1MTE0NQ=="}, "originalCommit": {"oid": "c2293eec588f0a11399ec8c02ec8cce57318f376"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0NjYwNA==", "bodyText": "I am not suggestion to use xxxData. Let me rephrase the question, why there is message key here?", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r394546604", "createdAt": "2020-03-18T18:12:00Z", "author": {"login": "xpdavid"}, "path": "src/e2e/java/teammates/e2e/cases/lnp/BaseLNPTestCase.java", "diffHunk": "@@ -162,18 +163,27 @@ protected void createTestData() {\n         LNPTestData testData = getTestData();\n         try {\n             createJsonDataFile(testData);\n+            persistTestData();\n             createCsvConfigDataFile(testData);\n-        } catch (IOException ex) {\n+        } catch (IOException | HttpRequestFailedException ex) {\n             log.severe(TeammatesException.toStringWithStackTrace(ex));\n         }\n     }\n \n     /**\n      * Creates the entities in the datastore from the JSON data file.\n      */\n-    protected void persistTestData() {\n+    protected void persistTestData() throws IOException, HttpRequestFailedException {\n         DataBundle dataBundle = loadDataBundle(getJsonDataPath());\n-        BackDoor.removeAndRestoreDataBundle(dataBundle);\n+        String responseBody = \"\";\n+        responseBody = BackDoor.removeAndRestoreDataBundle(dataBundle);\n+\n+        String pathToResultFile = createFileAndDirectory(TestProperties.LNP_TEST_DATA_FOLDER, getJsonDataPath());\n+        String jsonValue = JsonUtils.parse(responseBody).getAsJsonObject().get(\"message\").getAsString();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1MTE0NQ=="}, "originalCommit": {"oid": "c2293eec588f0a11399ec8c02ec8cce57318f376"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU1NTA2Mg==", "bodyText": "This is a behaviour from the PutDataBundleAction.java, method execute().\nLink to code\nThe execute() method has to return a JsonResult object. JsonResult class has 4 constructors :\npublic JsonResult(ApiOutput output) { }\npublic JsonResult(ApiOutput output, List<Cookie> cookies) { }\npublic JsonResult(String message) { }\npublic JsonResult(String message, int statusCode) {}\n\nAs for now I'm returning the String converted, it will use the 3rd constructor which creates a MessageOutput object with my json String as the message. Which is why the message key is used in the json return value.\nIn order to use the ApiOutput I need to create the DataBundleData class, but now that I think about it the message body will still be returned under the \"DataBundle\" key even if I do that.\nI've tried looking around to find a way to remove the extra key (basically pass the entire json string by itself), but I couldn't find it so far. Not sure whether creating an entire group of extra classes just to get rid of the extra key is going to be worth it either.", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r394555062", "createdAt": "2020-03-18T18:26:38Z", "author": {"login": "daekoon"}, "path": "src/e2e/java/teammates/e2e/cases/lnp/BaseLNPTestCase.java", "diffHunk": "@@ -162,18 +163,27 @@ protected void createTestData() {\n         LNPTestData testData = getTestData();\n         try {\n             createJsonDataFile(testData);\n+            persistTestData();\n             createCsvConfigDataFile(testData);\n-        } catch (IOException ex) {\n+        } catch (IOException | HttpRequestFailedException ex) {\n             log.severe(TeammatesException.toStringWithStackTrace(ex));\n         }\n     }\n \n     /**\n      * Creates the entities in the datastore from the JSON data file.\n      */\n-    protected void persistTestData() {\n+    protected void persistTestData() throws IOException, HttpRequestFailedException {\n         DataBundle dataBundle = loadDataBundle(getJsonDataPath());\n-        BackDoor.removeAndRestoreDataBundle(dataBundle);\n+        String responseBody = \"\";\n+        responseBody = BackDoor.removeAndRestoreDataBundle(dataBundle);\n+\n+        String pathToResultFile = createFileAndDirectory(TestProperties.LNP_TEST_DATA_FOLDER, getJsonDataPath());\n+        String jsonValue = JsonUtils.parse(responseBody).getAsJsonObject().get(\"message\").getAsString();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1MTE0NQ=="}, "originalCommit": {"oid": "c2293eec588f0a11399ec8c02ec8cce57318f376"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNjk3NzM5OnYy", "diffSide": "RIGHT", "path": "src/e2e/java/teammates/e2e/cases/lnp/BaseLNPTestCase.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjoyODoxOFrOF28ELw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTowODo1MlrOF4TLYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1MTUzNQ==", "bodyText": "I think you can try FileHelper.saveFile", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r393151535", "createdAt": "2020-03-16T16:28:18Z", "author": {"login": "xpdavid"}, "path": "src/e2e/java/teammates/e2e/cases/lnp/BaseLNPTestCase.java", "diffHunk": "@@ -162,18 +163,27 @@ protected void createTestData() {\n         LNPTestData testData = getTestData();\n         try {\n             createJsonDataFile(testData);\n+            persistTestData();\n             createCsvConfigDataFile(testData);\n-        } catch (IOException ex) {\n+        } catch (IOException | HttpRequestFailedException ex) {\n             log.severe(TeammatesException.toStringWithStackTrace(ex));\n         }\n     }\n \n     /**\n      * Creates the entities in the datastore from the JSON data file.\n      */\n-    protected void persistTestData() {\n+    protected void persistTestData() throws IOException, HttpRequestFailedException {\n         DataBundle dataBundle = loadDataBundle(getJsonDataPath());\n-        BackDoor.removeAndRestoreDataBundle(dataBundle);\n+        String responseBody = \"\";\n+        responseBody = BackDoor.removeAndRestoreDataBundle(dataBundle);\n+\n+        String pathToResultFile = createFileAndDirectory(TestProperties.LNP_TEST_DATA_FOLDER, getJsonDataPath());\n+        String jsonValue = JsonUtils.parse(responseBody).getAsJsonObject().get(\"message\").getAsString();\n+        try (BufferedWriter bw = Files.newBufferedWriter(Paths.get(pathToResultFile))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2293eec588f0a11399ec8c02ec8cce57318f376"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU3ODc4NA==", "bodyText": "Updated method to use filehelper", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r394578784", "createdAt": "2020-03-18T19:08:52Z", "author": {"login": "daekoon"}, "path": "src/e2e/java/teammates/e2e/cases/lnp/BaseLNPTestCase.java", "diffHunk": "@@ -162,18 +163,27 @@ protected void createTestData() {\n         LNPTestData testData = getTestData();\n         try {\n             createJsonDataFile(testData);\n+            persistTestData();\n             createCsvConfigDataFile(testData);\n-        } catch (IOException ex) {\n+        } catch (IOException | HttpRequestFailedException ex) {\n             log.severe(TeammatesException.toStringWithStackTrace(ex));\n         }\n     }\n \n     /**\n      * Creates the entities in the datastore from the JSON data file.\n      */\n-    protected void persistTestData() {\n+    protected void persistTestData() throws IOException, HttpRequestFailedException {\n         DataBundle dataBundle = loadDataBundle(getJsonDataPath());\n-        BackDoor.removeAndRestoreDataBundle(dataBundle);\n+        String responseBody = \"\";\n+        responseBody = BackDoor.removeAndRestoreDataBundle(dataBundle);\n+\n+        String pathToResultFile = createFileAndDirectory(TestProperties.LNP_TEST_DATA_FOLDER, getJsonDataPath());\n+        String jsonValue = JsonUtils.parse(responseBody).getAsJsonObject().get(\"message\").getAsString();\n+        try (BufferedWriter bw = Files.newBufferedWriter(Paths.get(pathToResultFile))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1MTUzNQ=="}, "originalCommit": {"oid": "c2293eec588f0a11399ec8c02ec8cce57318f376"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNjk4MDcxOnYy", "diffSide": "RIGHT", "path": "src/e2e/java/teammates/e2e/util/BackDoor.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjoyOToxMFrOF28GbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNDo0ODowNFrOF4IdAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1MjEwOA==", "bodyText": "It OK to use IOException I think.", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r393152108", "createdAt": "2020-03-16T16:29:10Z", "author": {"login": "xpdavid"}, "path": "src/e2e/java/teammates/e2e/util/BackDoor.java", "diffHunk": "@@ -212,12 +213,14 @@ private static void addAuthKeys(HttpRequestBase request) {\n      * However, removing the data bundle on teardown manually is not a perfect solution because two tests can concurrently\n      * access the same account and their data may get mixed up in the process. This is a major problem we need to address.\n      */\n-    public static String removeAndRestoreDataBundle(DataBundle dataBundle) {\n+    public static String removeAndRestoreDataBundle(DataBundle dataBundle) throws HttpRequestFailedException {\n         removeDataBundle(dataBundle);\n         ResponseBodyAndCode putRequestOutput =\n                 executePostRequest(Const.ResourceURIs.DATABUNDLE, null, JsonUtils.toJson(dataBundle));\n-        return putRequestOutput.responseCode == HttpStatus.SC_OK\n-                ? Const.StatusCodes.BACKDOOR_STATUS_SUCCESS : Const.StatusCodes.BACKDOOR_STATUS_FAILURE;\n+        if (putRequestOutput.responseCode == HttpStatus.SC_OK) {\n+            return putRequestOutput.responseBody;\n+        }\n+        throw new HttpRequestFailedException(\"Request failed with status code: \" + putRequestOutput.responseCode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2293eec588f0a11399ec8c02ec8cce57318f376"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQwMzA3NQ==", "bodyText": "I felt that Http requests should use a separate exception because they aren't exactly IO, and you might want to handle them separately if you need to.", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r394403075", "createdAt": "2020-03-18T14:48:04Z", "author": {"login": "daekoon"}, "path": "src/e2e/java/teammates/e2e/util/BackDoor.java", "diffHunk": "@@ -212,12 +213,14 @@ private static void addAuthKeys(HttpRequestBase request) {\n      * However, removing the data bundle on teardown manually is not a perfect solution because two tests can concurrently\n      * access the same account and their data may get mixed up in the process. This is a major problem we need to address.\n      */\n-    public static String removeAndRestoreDataBundle(DataBundle dataBundle) {\n+    public static String removeAndRestoreDataBundle(DataBundle dataBundle) throws HttpRequestFailedException {\n         removeDataBundle(dataBundle);\n         ResponseBodyAndCode putRequestOutput =\n                 executePostRequest(Const.ResourceURIs.DATABUNDLE, null, JsonUtils.toJson(dataBundle));\n-        return putRequestOutput.responseCode == HttpStatus.SC_OK\n-                ? Const.StatusCodes.BACKDOOR_STATUS_SUCCESS : Const.StatusCodes.BACKDOOR_STATUS_FAILURE;\n+        if (putRequestOutput.responseCode == HttpStatus.SC_OK) {\n+            return putRequestOutput.responseBody;\n+        }\n+        throw new HttpRequestFailedException(\"Request failed with status code: \" + putRequestOutput.responseCode);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1MjEwOA=="}, "originalCommit": {"oid": "c2293eec588f0a11399ec8c02ec8cce57318f376"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNjk5MTM4OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/common/util/CustomLogic.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjozMjowNFrOF28Nkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTo1NzoyNVrOF4Utxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1MzkzOA==", "bodyText": "I think you should put the method into EntityAttributes since it is about comparison between attributes. In addition, please don't call it as customEquals. The name is not constructive as how \"custom\" is \"custom\". A name such as equalsWithNullComparaision (of course it is not a ideal name) is far better than customEquals.", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r393153938", "createdAt": "2020-03-16T16:32:04Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/common/util/CustomLogic.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package teammates.common.util;\n+\n+/**\n+ * Stores various custom logic that are used across classes.\n+ */\n+public final class CustomLogic {\n+\n+    private CustomLogic() {\n+        // utility class\n+    }\n+\n+    /**\n+     * Custom equals method that is able to handle null objects.\n+     * @param first first object to be compared\n+     * @param second second object to be compared\n+     * @return true of both objects are null or equal, false otherwise.\n+     */\n+    public static boolean customEquals(Object first, Object second) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2293eec588f0a11399ec8c02ec8cce57318f376"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDYwMzk3NQ==", "bodyText": "Moved custom equals method to EntityAttributes, and renamed it to reflect its purpose more clearly", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r394603975", "createdAt": "2020-03-18T19:57:25Z", "author": {"login": "daekoon"}, "path": "src/main/java/teammates/common/util/CustomLogic.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package teammates.common.util;\n+\n+/**\n+ * Stores various custom logic that are used across classes.\n+ */\n+public final class CustomLogic {\n+\n+    private CustomLogic() {\n+        // utility class\n+    }\n+\n+    /**\n+     * Custom equals method that is able to handle null objects.\n+     * @param first first object to be compared\n+     * @param second second object to be compared\n+     * @return true of both objects are null or equal, false otherwise.\n+     */\n+    public static boolean customEquals(Object first, Object second) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1MzkzOA=="}, "originalCommit": {"oid": "c2293eec588f0a11399ec8c02ec8cce57318f376"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNjk5NTE4OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/common/datatransfer/attributes/FeedbackResponseAttributes.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjozMjo1OFrOF28P9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQyMzoxODo1NlrOF4aJ0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1NDU0OQ==", "bodyText": "Don't forget to write test for the equals method.", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r393154549", "createdAt": "2020-03-16T16:32:58Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/common/datatransfer/attributes/FeedbackResponseAttributes.java", "diffHunk": "@@ -168,6 +170,28 @@ public String toString() {\n                 + \", answer=\" + getSerializedFeedbackResponseDetail() + \"]\";\n     }\n \n+    @Override\n+    public int hashCode() {\n+        StringBuilder stringBuilder = new StringBuilder();\n+        stringBuilder.append(this.feedbackSessionName).append(this.courseId)\n+                .append(this.feedbackQuestionId).append(this.giver).append(this.recipient);\n+        return stringBuilder.toString().hashCode();\n+    }\n+\n+    @Override\n+    public boolean equals(Object other) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2293eec588f0a11399ec8c02ec8cce57318f376"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY5MzA3NA==", "bodyText": "Added tests for the equals method", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r394693074", "createdAt": "2020-03-18T23:18:56Z", "author": {"login": "daekoon"}, "path": "src/main/java/teammates/common/datatransfer/attributes/FeedbackResponseAttributes.java", "diffHunk": "@@ -168,6 +170,28 @@ public String toString() {\n                 + \", answer=\" + getSerializedFeedbackResponseDetail() + \"]\";\n     }\n \n+    @Override\n+    public int hashCode() {\n+        StringBuilder stringBuilder = new StringBuilder();\n+        stringBuilder.append(this.feedbackSessionName).append(this.courseId)\n+                .append(this.feedbackQuestionId).append(this.giver).append(this.recipient);\n+        return stringBuilder.toString().hashCode();\n+    }\n+\n+    @Override\n+    public boolean equals(Object other) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1NDU0OQ=="}, "originalCommit": {"oid": "c2293eec588f0a11399ec8c02ec8cce57318f376"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NjIxNjgzOnYy", "diffSide": "RIGHT", "path": "src/e2e/java/teammates/e2e/cases/lnp/BaseLNPTestCase.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwNTo1NDo1OVrOF53t3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwNTo1NDo1OVrOF53t3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIyNjAxNA==", "bodyText": "I think there is a way such that this (usage of magic string message) can be mitigated. Let me get back to you later.", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r396226014", "createdAt": "2020-03-23T05:54:59Z", "author": {"login": "wkurniawan07"}, "path": "src/e2e/java/teammates/e2e/cases/lnp/BaseLNPTestCase.java", "diffHunk": "@@ -162,18 +164,24 @@ protected void createTestData() {\n         LNPTestData testData = getTestData();\n         try {\n             createJsonDataFile(testData);\n+            persistTestData();\n             createCsvConfigDataFile(testData);\n-        } catch (IOException ex) {\n+        } catch (IOException | HttpRequestFailedException ex) {\n             log.severe(TeammatesException.toStringWithStackTrace(ex));\n         }\n     }\n \n     /**\n      * Creates the entities in the datastore from the JSON data file.\n      */\n-    protected void persistTestData() {\n+    protected void persistTestData() throws IOException, HttpRequestFailedException {\n         DataBundle dataBundle = loadDataBundle(getJsonDataPath());\n-        BackDoor.removeAndRestoreDataBundle(dataBundle);\n+        String responseBody = \"\";\n+        responseBody = BackDoor.removeAndRestoreDataBundle(dataBundle);\n+\n+        String pathToResultFile = createFileAndDirectory(TestProperties.LNP_TEST_DATA_FOLDER, getJsonDataPath());\n+        String jsonValue = JsonUtils.parse(responseBody).getAsJsonObject().get(\"message\").getAsString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f55a933c78a2c019fd08ee03aeeb9a69ff297de"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MDExMTgwOnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/common/datatransfer/attributes/EntityAttributes.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwMTozMzo0OVrOF6eHqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNzozNjo0M1rOF8Skkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1NTIwOA==", "bodyText": "Actually, you can use Objects.equals from java.util.Objects", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r396855208", "createdAt": "2020-03-24T01:33:49Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/common/datatransfer/attributes/EntityAttributes.java", "diffHunk": "@@ -55,6 +55,21 @@ public void addNonEmptyError(String error, List<String> errors) {\n         errors.add(error);\n     }\n \n+    /**\n+     * Custom equals method that is able to handle null objects.\n+     * @param first first object to be compared\n+     * @param second second object to be compared\n+     * @return true of both objects are null or equal, false otherwise.\n+     */\n+    protected boolean nullableDataEquals(Object first, Object second) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f55a933c78a2c019fd08ee03aeeb9a69ff297de"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE3MDcwNQ==", "bodyText": "Replaced all usage of nullableDataEquals with Objects.equals", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r397170705", "createdAt": "2020-03-24T13:55:55Z", "author": {"login": "daekoon"}, "path": "src/main/java/teammates/common/datatransfer/attributes/EntityAttributes.java", "diffHunk": "@@ -55,6 +55,21 @@ public void addNonEmptyError(String error, List<String> errors) {\n         errors.add(error);\n     }\n \n+    /**\n+     * Custom equals method that is able to handle null objects.\n+     * @param first first object to be compared\n+     * @param second second object to be compared\n+     * @return true of both objects are null or equal, false otherwise.\n+     */\n+    protected boolean nullableDataEquals(Object first, Object second) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1NTIwOA=="}, "originalCommit": {"oid": "8f55a933c78a2c019fd08ee03aeeb9a69ff297de"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc2MzE1NA==", "bodyText": "You can remove the method also?", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r398763154", "createdAt": "2020-03-26T17:36:43Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/common/datatransfer/attributes/EntityAttributes.java", "diffHunk": "@@ -55,6 +55,21 @@ public void addNonEmptyError(String error, List<String> errors) {\n         errors.add(error);\n     }\n \n+    /**\n+     * Custom equals method that is able to handle null objects.\n+     * @param first first object to be compared\n+     * @param second second object to be compared\n+     * @return true of both objects are null or equal, false otherwise.\n+     */\n+    protected boolean nullableDataEquals(Object first, Object second) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1NTIwOA=="}, "originalCommit": {"oid": "8f55a933c78a2c019fd08ee03aeeb9a69ff297de"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MDExNDY3OnYy", "diffSide": "RIGHT", "path": "src/test/java/teammates/test/cases/datatransfer/StudentProfileAttributesTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQwMTozNTo0NVrOF6eJeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNTo1MzoyNVrOF62_Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1NTY3Mw==", "bodyText": "You can test: hashCode() of objects should be equal if there are equal.", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r396855673", "createdAt": "2020-03-24T01:35:45Z", "author": {"login": "xpdavid"}, "path": "src/test/java/teammates/test/cases/datatransfer/StudentProfileAttributesTest.java", "diffHunk": "@@ -295,6 +295,35 @@ public void testUpdateOptionsBuilder_withNullInput_shouldFailWithAssertionError(\n                         .withPictureKey(null));\n     }\n \n+    @Test\n+    public void testEquals() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f55a933c78a2c019fd08ee03aeeb9a69ff297de"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI2MjY5MA==", "bodyText": "Added tests for hashCode()", "url": "https://github.com/TEAMMATES/teammates/pull/9967#discussion_r397262690", "createdAt": "2020-03-24T15:53:25Z", "author": {"login": "daekoon"}, "path": "src/test/java/teammates/test/cases/datatransfer/StudentProfileAttributesTest.java", "diffHunk": "@@ -295,6 +295,35 @@ public void testUpdateOptionsBuilder_withNullInput_shouldFailWithAssertionError(\n                         .withPictureKey(null));\n     }\n \n+    @Test\n+    public void testEquals() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1NTY3Mw=="}, "originalCommit": {"oid": "8f55a933c78a2c019fd08ee03aeeb9a69ff297de"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4071, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}