{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNjAzNjAw", "number": 10270, "title": "[#10245] Add send email feature for admin search", "bodyText": "Part of #10245\nAdd button to populate email with content when sending reminder emails.", "createdAt": "2020-07-01T10:26:50Z", "url": "https://github.com/TEAMMATES/teammates/pull/10270", "merged": true, "mergeCommit": {"oid": "5da3cd22e793f69c461c540cff9893692ddc778d"}, "closed": true, "closedAt": "2020-07-08T14:26:03Z", "author": {"login": "ccyccyccy"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwsM86gBqjM1MDMwODM2NTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcy6dPuAH2gAyNDQyNjAzNjAwOjIwOGM3MWIyMTVlOTM3MmMwNjBkMTUwOGI4MDdlYmU1MzE5M2ZkOWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bba9406e3214428faca9bfe3b2d9eb003f81c415", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/bba9406e3214428faca9bfe3b2d9eb003f81c415", "committedDate": "2020-07-01T15:04:40Z", "message": "Test fix"}, "afterCommit": {"oid": "ecdfc394048fbbce1e22dfca41dfd6284833073a", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/ecdfc394048fbbce1e22dfca41dfd6284833073a", "committedDate": "2020-07-01T15:42:48Z", "message": "Test fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMDE1ODQ1", "url": "https://github.com/TEAMMATES/teammates/pull/10270#pullrequestreview-441015845", "createdAt": "2020-07-01T16:16:31Z", "commit": {"oid": "ecdfc394048fbbce1e22dfca41dfd6284833073a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNjoxNjozMVrOGrsplg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNjoxOTo0NVrOGrsxGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3MzQ5NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return AuthType.PUBLIC;\n          \n          \n            \n                    return AuthType.LOGGED_IN;", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448473494", "createdAt": "2020-07-01T16:16:31Z", "author": {"login": "madanalogy"}, "path": "src/main/java/teammates/ui/webapi/action/GenerateEmailAction.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package teammates.ui.webapi.action;\n+\n+import teammates.common.datatransfer.attributes.CourseAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackSessionAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.exception.InvalidHttpParameterException;\n+import teammates.common.exception.UnauthorizedAccessException;\n+import teammates.common.util.Assumption;\n+import teammates.common.util.Const;\n+import teammates.common.util.EmailType;\n+import teammates.common.util.EmailWrapper;\n+import teammates.ui.webapi.output.GenerateEmailData;\n+\n+/**\n+ * Generate email content.\n+ */\n+public class GenerateEmailAction extends Action {\n+\n+    @Override\n+    protected AuthType getMinAuthLevel() {\n+        return AuthType.PUBLIC;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecdfc394048fbbce1e22dfca41dfd6284833073a"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3NTQxNg==", "bodyText": "I'm thinking /email might be more appropriate. Worthwhile getting more input on this from senior devs.", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448475416", "createdAt": "2020-07-01T16:19:45Z", "author": {"login": "madanalogy"}, "path": "src/main/java/teammates/common/util/Const.java", "diffHunk": "@@ -704,6 +706,7 @@ private Const() {\n         public static final String LOCAL_DATE_TIME = \"/localdatetime\";\n         public static final String SESSION_LINKS_RECOVERY = \"/sessionlinksrecovery\";\n         public static final String NATIONALITIES = \"/nationalities\";\n+        public static final String GENERATE_EMAIL = \"/generateemail\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecdfc394048fbbce1e22dfca41dfd6284833073a"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMTk1MTQ0", "url": "https://github.com/TEAMMATES/teammates/pull/10270#pullrequestreview-441195144", "createdAt": "2020-07-01T21:03:25Z", "commit": {"oid": "ecdfc394048fbbce1e22dfca41dfd6284833073a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMTowMzoyNVrOGr1SCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMTowNTozOFrOGr1Vrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNDkyMw==", "bodyText": "Is this the same as the method above? generateFeedbackSessionReminderEmails ?", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448614923", "createdAt": "2020-07-01T21:03:25Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/logic/api/EmailGenerator.java", "diffHunk": "@@ -108,6 +108,21 @@\n         return emails;\n     }\n \n+    /**\n+     * Generates the feedback session reminder emails for the given {@code student}.\n+     */\n+    public EmailWrapper generateFeedbackSessionStudentReminderEmail(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecdfc394048fbbce1e22dfca41dfd6284833073a"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYxNTg1NA==", "bodyText": "email is better. In REST, you are dealing with Resource not RPC.", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448615854", "createdAt": "2020-07-01T21:05:38Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/common/util/Const.java", "diffHunk": "@@ -704,6 +706,7 @@ private Const() {\n         public static final String LOCAL_DATE_TIME = \"/localdatetime\";\n         public static final String SESSION_LINKS_RECOVERY = \"/sessionlinksrecovery\";\n         public static final String NATIONALITIES = \"/nationalities\";\n+        public static final String GENERATE_EMAIL = \"/generateemail\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3NTQxNg=="}, "originalCommit": {"oid": "ecdfc394048fbbce1e22dfca41dfd6284833073a"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMzI1NTA5", "url": "https://github.com/TEAMMATES/teammates/pull/10270#pullrequestreview-441325509", "createdAt": "2020-07-02T03:27:55Z", "commit": {"oid": "ecdfc394048fbbce1e22dfca41dfd6284833073a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwMzoyNzo1NlrOGr8K4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwMzoyNzo1NlrOGr8K4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODcyNzc3Ng==", "bodyText": "Not sure if I can link STUDENT_COURSE_JOIN to the backend, without hardcoding it here. How do I get the enum EmailType to show up in the frontend? Do I add a new class to src/main/java/teammates/ui/webapi/request?", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r448727776", "createdAt": "2020-07-02T03:27:56Z", "author": {"login": "ccyccyccy"}, "path": "src/web/app/pages-admin/admin-search-page/admin-search-page.component.html", "diffHunk": "@@ -149,18 +149,22 @@\n                 </li>\n                 <li class=\"list-group-item list-group-item-info\">\n                   <strong>Course Join Link</strong>\n+                  <button type=\"button\" class=\"btn btn-primary margin-left-5px btn-sm\" (click)=\"openEmail(student.courseId, student.email, 'STUDENT_COURSE_JOIN')\">Send mail</button>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecdfc394048fbbce1e22dfca41dfd6284833073a"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5052bd1f5fa657ba56a9c00a110d8e857fa640a0", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/5052bd1f5fa657ba56a9c00a110d8e857fa640a0", "committedDate": "2020-07-02T03:35:22Z", "message": "Rename generateemail endpoint to email"}, "afterCommit": {"oid": "0b1a7738b7ba88cce99dc350b23d8bffd13103ad", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/0b1a7738b7ba88cce99dc350b23d8bffd13103ad", "committedDate": "2020-07-02T03:44:04Z", "message": "Rename generateemail endpoint to email"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNDUwMzQx", "url": "https://github.com/TEAMMATES/teammates/pull/10270#pullrequestreview-441450341", "createdAt": "2020-07-02T08:15:12Z", "commit": {"oid": "3e30cf09b6a41ceb9cbc86de4934580c48a53a78"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMDg2Njk5", "url": "https://github.com/TEAMMATES/teammates/pull/10270#pullrequestreview-442086699", "createdAt": "2020-07-03T00:40:35Z", "commit": {"oid": "3e30cf09b6a41ceb9cbc86de4934580c48a53a78"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwMDo0MDozNVrOGsgjmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwMDo0OToxNFrOGsgqDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMyMzkzMA==", "bodyText": "Instead of queryParams for the method parameter, why not just put all the individual courseId, studentEmail, etc. as the method parameters?", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r449323930", "createdAt": "2020-07-03T00:40:35Z", "author": {"login": "wkurniawan07"}, "path": "src/web/services/email-generation.service.ts", "diffHunk": "@@ -0,0 +1,31 @@\n+import { Injectable } from '@angular/core';\n+import { Observable } from 'rxjs';\n+import { ResourceEndpoints } from '../types/api-endpoints';\n+import { Email } from '../types/api-output';\n+import { HttpRequestService } from './http-request.service';\n+\n+/**\n+ * Handles email generation.\n+ */\n+@Injectable({\n+  providedIn: 'root',\n+})\n+export class EmailGenerationService {\n+\n+  constructor(private httpRequestService: HttpRequestService) { }\n+\n+  /**\n+   * Get email contents by calling API.\n+   */\n+  getEmail(queryParams: {\n+    courseId: string, studentemail: string, emailtype: string, fsname?: string,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e30cf09b6a41ceb9cbc86de4934580c48a53a78"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMyNTU4Mg==", "bodyText": "Do we really need sessionLinkToSessionName function? There might be something already usable in openFs.", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r449325582", "createdAt": "2020-07-03T00:49:14Z", "author": {"login": "wkurniawan07"}, "path": "src/web/app/pages-admin/admin-search-page/admin-search-page.component.html", "diffHunk": "@@ -149,18 +149,22 @@\n                 </li>\n                 <li class=\"list-group-item list-group-item-info\">\n                   <strong>Course Join Link</strong>\n+                  <button type=\"button\" class=\"btn btn-primary margin-left-5px btn-sm\" (click)=\"openEmail(student.courseId, student.email, EmailType.STUDENT_COURSE_JOIN)\">Send mail</button>\n                   <input [value]=\"student.courseJoinLink\" readonly class=\"form-control\">\n                 </li>\n                 <li class=\"list-group-item list-group-item-warning\" *ngFor=\"let openFs of student.openSessions | keyvalue\">\n                   <strong>{{ openFs.key }}</strong>\n+                  <button type=\"button\" class=\"btn btn-primary margin-left-5px btn-sm\" (click)=\"openEmail(student.courseId, student.email, EmailType.FEEDBACK_SESSION_REMINDER, sessionLinkToSessionName(openFs.value))\">Send mail</button>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e30cf09b6a41ceb9cbc86de4934580c48a53a78"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd1ddbebe5db7242dc1f3799c7ee74b3524c8dcd", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/cd1ddbebe5db7242dc1f3799c7ee74b3524c8dcd", "committedDate": "2020-07-06T02:41:58Z", "message": "Add API for email request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16cb0394993556d74ba4d39ebe6aaddf4aed9014", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/16cb0394993556d74ba4d39ebe6aaddf4aed9014", "committedDate": "2020-07-06T02:44:11Z", "message": "Add frontend buttons for email feature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99a2ac40f78ee922ca5a3a9d1525fa9aa90020e1", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/99a2ac40f78ee922ca5a3a9d1525fa9aa90020e1", "committedDate": "2020-07-06T02:44:12Z", "message": "Test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4a044245d39957ab2ac2673cf83d6174e8742d8", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/a4a044245d39957ab2ac2673cf83d6174e8742d8", "committedDate": "2020-07-06T02:44:12Z", "message": "Rename generateemail endpoint to email"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e33ea93f509538a8044ee76c285e49cbcdea6df", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/0e33ea93f509538a8044ee76c285e49cbcdea6df", "committedDate": "2020-07-06T02:44:12Z", "message": "Change auth type\n\nCo-authored-by: Ahmed Bahajjaj <Ahmed_Bahajjaj@u.nus.edu>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbd4d819dc6cd5bac56cf364974c4d7878f0f5a8", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/bbd4d819dc6cd5bac56cf364974c4d7878f0f5a8", "committedDate": "2020-07-06T02:44:12Z", "message": "Link EmailType from backend to frontend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c46fcb6762c92a12dc56dc984d2929f3cba4c799", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/c46fcb6762c92a12dc56dc984d2929f3cba4c799", "committedDate": "2020-07-06T02:44:12Z", "message": "Change params of getEmail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9683c9e5b542fa7f19dfdee462c09269351702d", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/f9683c9e5b542fa7f19dfdee462c09269351702d", "committedDate": "2020-07-06T03:28:59Z", "message": "Fix year not showing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e30cf09b6a41ceb9cbc86de4934580c48a53a78", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/3e30cf09b6a41ceb9cbc86de4934580c48a53a78", "committedDate": "2020-07-02T04:23:53Z", "message": "Link EmailType from backend to frontend"}, "afterCommit": {"oid": "f9c51705a1b8fb554c39ffea0fc2f9ba7abf1221", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/f9c51705a1b8fb554c39ffea0fc2f9ba7abf1221", "committedDate": "2020-07-06T05:10:56Z", "message": "Refactor data shape returned by generating strings to display"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0ddb5e899db92d586c1368ff3fabb881f867484", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/d0ddb5e899db92d586c1368ff3fabb881f867484", "committedDate": "2020-07-06T06:01:46Z", "message": "Refactor data shape returned by generating strings to display"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f9c51705a1b8fb554c39ffea0fc2f9ba7abf1221", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/f9c51705a1b8fb554c39ffea0fc2f9ba7abf1221", "committedDate": "2020-07-06T05:10:56Z", "message": "Refactor data shape returned by generating strings to display"}, "afterCommit": {"oid": "d0ddb5e899db92d586c1368ff3fabb881f867484", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/d0ddb5e899db92d586c1368ff3fabb881f867484", "committedDate": "2020-07-06T06:01:46Z", "message": "Refactor data shape returned by generating strings to display"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyODA0NjY2", "url": "https://github.com/TEAMMATES/teammates/pull/10270#pullrequestreview-442804666", "createdAt": "2020-07-06T06:32:45Z", "commit": {"oid": "d0ddb5e899db92d586c1368ff3fabb881f867484"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjozMjo0NlrOGtKZSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMjoyOTo1OFrOGtVPCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAwOTQxOA==", "bodyText": "This comment is not necessary. It is implied by the fact that there is no export preceding the interfaces.", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450009418", "createdAt": "2020-07-06T06:32:46Z", "author": {"login": "wkurniawan07"}, "path": "src/web/services/search.service.ts", "diffHunk": "@@ -505,16 +514,24 @@ export interface StudentAccountSearchResult extends InstructorAccountSearchResul\n   team: string;\n   comments: string;\n   recordsPageLink: string;\n-  openSessions: { [index: string]: string };\n-  notOpenSessions: { [index: string]: string };\n-  publishedSessions: { [index: string]: string };\n+  openSessions: FeedbackSessionsGroup;\n+  notOpenSessions: FeedbackSessionsGroup;\n+  publishedSessions: FeedbackSessionsGroup;\n }\n \n-// Private interfaces\n-interface FeedbackSessionsGroup {\n-  [key: string]: string;\n+/**\n+ * Feedback session inforamtion for search result.\n+ */\n+export interface FeedbackSessionsGroup {\n+  [name: string]: {\n+    startTime: string;\n+    endTime: string;\n+    feedbackSessionUrl: string;\n+  };\n }\n \n+// Private interfaces", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0ddb5e899db92d586c1368ff3fabb881f867484"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAwOTgzOA==", "bodyText": "It looks like the only usage for this is in search-service.ts, and the method is very use case-specific. Let's move this method there instead.", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450009838", "createdAt": "2020-07-06T06:34:05Z", "author": {"login": "wkurniawan07"}, "path": "src/web/services/feedback-sessions.service.ts", "diffHunk": "@@ -413,14 +413,14 @@ export class FeedbackSessionsService {\n   }\n \n   /**\n-   * Generates the name fragment of a feedbackSession for display on the frontend.\n+   * Generates formatted properties of a feedbackSession for display on the frontend.\n    */\n-  generateNameFragment(feedbackSession: FeedbackSession): string {\n-    const DATE_FORMAT_WITH_ZONE_INFO: string = 'ddd, DD MMM yyyy, hh:mm A Z';\n+  formatProperties(feedbackSession: FeedbackSession): { startTime: string, endTime: string } {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0ddb5e899db92d586c1368ff3fabb881f867484"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDExNzc0MQ==", "bodyText": "Unknown is not exactly accurate because some other types (e.g. INSTRUCTOR_COURSE_JOIN, NEW_INSTRUCTOR_ACCOUNT) are known but we just don't cater for them, maybe not now, maybe never. Email type ... is not accepted. is more accurate.", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450117741", "createdAt": "2020-07-06T10:03:30Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/ui/webapi/action/GenerateEmailAction.java", "diffHunk": "@@ -0,0 +1,60 @@\n+package teammates.ui.webapi.action;\n+\n+import teammates.common.datatransfer.attributes.CourseAttributes;\n+import teammates.common.datatransfer.attributes.FeedbackSessionAttributes;\n+import teammates.common.datatransfer.attributes.StudentAttributes;\n+import teammates.common.exception.InvalidHttpParameterException;\n+import teammates.common.exception.UnauthorizedAccessException;\n+import teammates.common.util.Assumption;\n+import teammates.common.util.Const;\n+import teammates.common.util.EmailType;\n+import teammates.common.util.EmailWrapper;\n+import teammates.ui.webapi.output.EmailData;\n+\n+/**\n+ * Generate email content.\n+ */\n+public class GenerateEmailAction extends Action {\n+\n+    @Override\n+    protected AuthType getMinAuthLevel() {\n+        return AuthType.LOGGED_IN;\n+    }\n+\n+    @Override\n+    public void checkSpecificAccessControl() {\n+        if (!userInfo.isAdmin) {\n+            throw new UnauthorizedAccessException(\"Admin privilege is required to access this resource.\");\n+        }\n+    }\n+\n+    @Override\n+    public ActionResult execute() {\n+        String courseId = getNonNullRequestParamValue(Const.ParamsNames.COURSE_ID);\n+        String studentEmail = getNonNullRequestParamValue(Const.ParamsNames.STUDENT_EMAIL);\n+        String emailType = getNonNullRequestParamValue(Const.ParamsNames.EMAIL_TYPE);\n+        String feedbackSessionName = getRequestParamValue(Const.ParamsNames.FEEDBACK_SESSION_NAME);\n+\n+        CourseAttributes course = logic.getCourse(courseId);\n+        Assumption.assertNotNull(course);\n+\n+        StudentAttributes student = logic.getStudentForEmail(courseId, studentEmail);\n+        Assumption.assertNotNull(student);\n+\n+        EmailWrapper email;\n+\n+        if (emailType.equals(EmailType.STUDENT_COURSE_JOIN.name())) {\n+            email = emailGenerator.generateStudentCourseJoinEmail(course, student);\n+        } else if (emailType.equals(EmailType.FEEDBACK_SESSION_REMINDER.name())) {\n+            if (feedbackSessionName == null) {\n+                throw new InvalidHttpParameterException(\"Feedback session name not specified\");\n+            }\n+            FeedbackSessionAttributes feedbackSession = logic.getFeedbackSession(feedbackSessionName, courseId);\n+            email = emailGenerator.generateFeedbackSessionStudentReminderEmail(feedbackSession, student);\n+        } else {\n+            throw new InvalidHttpParameterException(\"Unknown emailType \" + emailType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0ddb5e899db92d586c1368ff3fabb881f867484"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4Mzg0Mg==", "bodyText": "I would even go this far and say that LinkService should be deprecated as this class is the only user, but you don't need to change this now.", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450183842", "createdAt": "2020-07-06T12:23:59Z", "author": {"login": "wkurniawan07"}, "path": "src/web/services/search.service.ts", "diffHunk": "@@ -342,16 +342,25 @@ export class SearchService {\n     };\n     for (const feedbackSession of feedbackSessions.feedbackSessions) {\n       if (this.feedbackSessionService.isFeedbackSessionOpen(feedbackSession)) {\n-        feedbackSessionLinks.openSessions[this.feedbackSessionService.generateNameFragment(feedbackSession).toString()]\n-          = this.linkService.generateSubmitUrl(student, feedbackSession.feedbackSessionName);\n+        feedbackSessionLinks.openSessions[feedbackSession.feedbackSessionName]\n+            = {\n+              ...this.feedbackSessionService.formatProperties(feedbackSession),\n+              feedbackSessionUrl: this.linkService.generateSubmitUrl(student, feedbackSession.feedbackSessionName),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0ddb5e899db92d586c1368ff3fabb881f867484"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4NTA5Mw==", "bodyText": "It's ok for the = { to be on the previous line, i.e.\nfeedbackSessionLinks.openSessions[feedbackSession.feedbackSessionName] = {\n  // ...\n};\nIt saves some levels of indentation.", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450185093", "createdAt": "2020-07-06T12:26:17Z", "author": {"login": "wkurniawan07"}, "path": "src/web/services/search.service.ts", "diffHunk": "@@ -342,16 +342,25 @@ export class SearchService {\n     };\n     for (const feedbackSession of feedbackSessions.feedbackSessions) {\n       if (this.feedbackSessionService.isFeedbackSessionOpen(feedbackSession)) {\n-        feedbackSessionLinks.openSessions[this.feedbackSessionService.generateNameFragment(feedbackSession).toString()]\n-          = this.linkService.generateSubmitUrl(student, feedbackSession.feedbackSessionName);\n+        feedbackSessionLinks.openSessions[feedbackSession.feedbackSessionName]\n+            = {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0ddb5e899db92d586c1368ff3fabb881f867484"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4NTMzNw==", "bodyText": "\ud83d\udcaf", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450185337", "createdAt": "2020-07-06T12:26:41Z", "author": {"login": "wkurniawan07"}, "path": "src/web/app/pages-admin/admin-search-page/admin-search-page.component.html", "diffHunk": "@@ -149,19 +149,23 @@\n                 </li>\n                 <li class=\"list-group-item list-group-item-info\">\n                   <strong>Course Join Link</strong>\n+                  <button type=\"button\" class=\"btn btn-primary margin-left-5px btn-sm\" (click)=\"openEmail(student.courseId, student.email, EmailType.STUDENT_COURSE_JOIN)\">Send mail</button>\n                   <input [value]=\"student.courseJoinLink\" readonly class=\"form-control\">\n                 </li>\n                 <li class=\"list-group-item list-group-item-warning\" *ngFor=\"let openFs of student.openSessions | keyvalue\">\n-                  <strong>{{ openFs.key }}</strong>\n-                  <input [value]=\"openFs.value\" readonly class=\"form-control\">\n+                  <strong>{{ openFs.key + ' ' + openFs.value.startTime + ' - ' + openFs.value.endTime }}</strong>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0ddb5e899db92d586c1368ff3fabb881f867484"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4NzAxNw==", "bodyText": "Although it works, it's not exactly the best way to generalize this method for all email types. Why not create a few different methods for different email types? i.e.\ngetCourseJoinEmail(courseId: string, studentEmail: string): Observable<Email> {\n  ...\n}\n\ngetFeedbackSessionReminderEmail(courseId: string, studentEmail: string): Observable<Email> {\n  ...\n}\nThis way you can also hide some implementation details (e.g. the EmailType) from the service callers.", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r450187017", "createdAt": "2020-07-06T12:29:58Z", "author": {"login": "wkurniawan07"}, "path": "src/web/services/email-generation.service.ts", "diffHunk": "@@ -0,0 +1,29 @@\n+import { Injectable } from '@angular/core';\n+import { Observable } from 'rxjs';\n+import { ResourceEndpoints } from '../types/api-endpoints';\n+import { Email } from '../types/api-output';\n+import { HttpRequestService } from './http-request.service';\n+\n+/**\n+ * Handles email generation.\n+ */\n+@Injectable({\n+  providedIn: 'root',\n+})\n+export class EmailGenerationService {\n+\n+  constructor(private httpRequestService: HttpRequestService) { }\n+\n+  /**\n+   * Get email contents by calling API.\n+   */\n+  getEmail(courseId: string, studentemail: string, emailtype: string, fsname?: string): Observable<Email> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0ddb5e899db92d586c1368ff3fabb881f867484"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "233ee124e3683e4ccf3e42db2195cfe01388067e", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/233ee124e3683e4ccf3e42db2195cfe01388067e", "committedDate": "2020-07-06T13:39:22Z", "message": "Remove comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acfe8f3b04473e5bc5343a2c4bb4e0b6f04e4f91", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/acfe8f3b04473e5bc5343a2c4bb4e0b6f04e4f91", "committedDate": "2020-07-06T14:19:36Z", "message": "Move formatProperties to searchservice.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5554ffaa916cdd2955b6d0e05ef7ecf7f9f8dc1", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/a5554ffaa916cdd2955b6d0e05ef7ecf7f9f8dc1", "committedDate": "2020-07-06T14:20:47Z", "message": "Change error message for unaccepted email type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2739b966f363c5fe8e14c65bc45036137091950", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/e2739b966f363c5fe8e14c65bc45036137091950", "committedDate": "2020-07-06T14:41:09Z", "message": "Abstration for email opening link"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83f8794002fe02ba7bf91aafa37064afb5a6e377", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/83f8794002fe02ba7bf91aafa37064afb5a6e377", "committedDate": "2020-07-06T15:35:47Z", "message": "Lint fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NDEyMTEz", "url": "https://github.com/TEAMMATES/teammates/pull/10270#pullrequestreview-444412113", "createdAt": "2020-07-08T04:54:31Z", "commit": {"oid": "83f8794002fe02ba7bf91aafa37064afb5a6e377"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNDo1NDozMVrOGuYFZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwNDo1NjoyM1rOGuYHUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI4MjI3OQ==", "bodyText": "I believe you don't need this anymore", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r451282279", "createdAt": "2020-07-08T04:54:31Z", "author": {"login": "wkurniawan07"}, "path": "src/web/app/pages-admin/admin-search-page/admin-search-page.component.ts", "diffHunk": "@@ -28,6 +27,9 @@ import {\n })\n export class AdminSearchPageComponent {\n \n+  // enum\n+  EmailType: typeof EmailType = EmailType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83f8794002fe02ba7bf91aafa37064afb5a6e377"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI4MjU4MA==", "bodyText": "The body of these two methods are identical other than the method being called in the service class. Can they be abstracted out?", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r451282580", "createdAt": "2020-07-08T04:55:36Z", "author": {"login": "wkurniawan07"}, "path": "src/web/app/pages-admin/admin-search-page/admin-search-page.component.ts", "diffHunk": "@@ -189,4 +192,32 @@ export class AdminSearchPageComponent {\n     return link.replace(regex, `$1${newVal}`);\n   }\n \n+  /**\n+   * Open up an email populated with content for course join invitation.\n+   */\n+  openCourseJoinEmail(courseId: string, studentemail: string): void {\n+    this.emailGenerationService.getCourseJoinEmail(courseId, studentemail)\n+        .subscribe((email: Email) => {\n+          window.location.href = `mailto:${email.recipient}`\n+              + `?Subject=${email.subject}`\n+              + `&body=${email.content}`;\n+        }, (err: ErrorMessageOutput) => {\n+          this.statusMessageService.showErrorToast(err.error.message);\n+        });\n+  }\n+\n+  /**\n+   * Open up an email populated with content for feedback session reminder.\n+   */\n+  openFeedbackSessionReminderEmail(courseId: string, studentemail: string, fsname: string): void {\n+    this.emailGenerationService.getFeedbackSessionReminderEmail(courseId, studentemail, fsname)\n+        .subscribe((email: Email) => {\n+          window.location.href = `mailto:${email.recipient}`\n+              + `?Subject=${email.subject}`\n+              + `&body=${email.content}`;\n+        }, (err: ErrorMessageOutput) => {\n+          this.statusMessageService.showErrorToast(err.error.message);\n+        });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83f8794002fe02ba7bf91aafa37064afb5a6e377"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI4Mjc3MQ==", "bodyText": "This can be private, I believe", "url": "https://github.com/TEAMMATES/teammates/pull/10270#discussion_r451282771", "createdAt": "2020-07-08T04:56:23Z", "author": {"login": "wkurniawan07"}, "path": "src/web/services/search.service.ts", "diffHunk": "@@ -463,6 +471,15 @@ export class SearchService {\n       }),\n     );\n   }\n+\n+  formatProperties(feedbackSession: FeedbackSession): { startTime: string, endTime: string } {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83f8794002fe02ba7bf91aafa37064afb5a6e377"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d47ce941601fc6d87568a5a0203b5ad8cca8a0a1", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/d47ce941601fc6d87568a5a0203b5ad8cca8a0a1", "committedDate": "2020-07-08T08:00:20Z", "message": "Fix bad merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51e4ead529251ee014ce4524a7cef2af0583df89", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/51e4ead529251ee014ce4524a7cef2af0583df89", "committedDate": "2020-07-08T08:11:50Z", "message": "Remove useless enum"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NzU4MzAz", "url": "https://github.com/TEAMMATES/teammates/pull/10270#pullrequestreview-444758303", "createdAt": "2020-07-08T13:22:41Z", "commit": {"oid": "51e4ead529251ee014ce4524a7cef2af0583df89"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "208c71b215e9372c060d1508b807ebe53193fd9f", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/208c71b215e9372c060d1508b807ebe53193fd9f", "committedDate": "2020-07-08T13:28:44Z", "message": "Merge branch 'master' into 10245-email-feature"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4268, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}