{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMTQwODk3", "number": 10879, "title": "[#10870] Improve error messages for 403 errors", "bodyText": "Fixes #10870", "createdAt": "2020-12-16T12:46:14Z", "url": "https://github.com/TEAMMATES/teammates/pull/10879", "merged": true, "mergeCommit": {"oid": "948a9ea410e52e8d13b173da274690a978ba4f38"}, "closed": true, "closedAt": "2020-12-18T12:31:24Z", "author": {"login": "wkurniawan07"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdm5j1MgFqTU1NDIyMTgxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnXVHrAFqTU1NTQ0NzA0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MjIxODE3", "url": "https://github.com/TEAMMATES/teammates/pull/10879#pullrequestreview-554221817", "createdAt": "2020-12-17T01:50:02Z", "commit": {"oid": "652d45e25b11e5ff8a3e87e61b934f285c1a9685"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMTo1MDowM1rOIHg99A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMTo1MDowM1rOIHg99A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc1MTA5Mg==", "bodyText": "Is there any specific reason why the default is false? I think it should be true since this is the behavior for all other error message types (whatever you write is displayed to the user). There's also a lot more cases of you passing in true as the 2nd parameter compared to using it as false, although this isn't really a compelling argument.", "url": "https://github.com/TEAMMATES/teammates/pull/10879#discussion_r544751092", "createdAt": "2020-12-17T01:50:03Z", "author": {"login": "ChooJeremy"}, "path": "src/main/java/teammates/common/exception/UnauthorizedAccessException.java", "diffHunk": "@@ -6,8 +6,34 @@\n @SuppressWarnings(\"serial\")\n public class UnauthorizedAccessException extends RuntimeException {\n \n+    /**\n+     * Indicates whether the error message will be shown to the user (as the API response).\n+     * If this flag is set to \"false\", a generic error message will be displayed instead.\n+     * The actual error message is always displayed to admin in the logs.\n+     *\n+     * <p>As this exception involves access control, the error message need to be redacted\n+     * in most cases because the full error message can give clues as to what needs to be done\n+     * in order to get the access (which should be unauthorized).\n+     * While it is true that there is little that user can do to elevate his/her privilege\n+     * even with that knowledge, we still need to do our part.\n+     *\n+     * <p>There are, however, some cases whereby the error message would be legitimately helpful\n+     * to users, e.g. when submitting responses to a feedback session that has not opened yet.\n+     * For such cases, it is appropriate to set this flag as \"true\".\n+     */\n+    private final boolean showErrorMessage;\n+\n     public UnauthorizedAccessException(String message) {\n+        this(message, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "652d45e25b11e5ff8a3e87e61b934f285c1a9685"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0ODQ0ODIy", "url": "https://github.com/TEAMMATES/teammates/pull/10879#pullrequestreview-554844822", "createdAt": "2020-12-17T17:49:48Z", "commit": {"oid": "652d45e25b11e5ff8a3e87e61b934f285c1a9685"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNzo0OTo0OFrOIIBekg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNzo0OTo0OFrOIIBekg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI4MzczMA==", "bodyText": "very minor nit: perhaps can rename this function to testActionUnauthorized and also the test case name to ______TS(\"Unauthorized Access Case: updating another student's profile\");", "url": "https://github.com/TEAMMATES/teammates/pull/10879#discussion_r545283730", "createdAt": "2020-12-17T17:49:48Z", "author": {"login": "rrtheonlyone"}, "path": "src/test/java/teammates/ui/webapi/UpdateStudentProfileActionTest.java", "diffHunk": "@@ -215,5 +200,18 @@ private StudentProfileUpdateRequest createInvalidUpdateRequestForProfileWithScri\n     protected void testAccessControl() {\n         verifyInaccessibleWithoutLogin();\n         verifyInaccessibleForUnregisteredUsers();\n+        testActionForbidden();\n+    }\n+\n+    private void testActionForbidden() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "652d45e25b11e5ff8a3e87e61b934f285c1a9685"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42fcf1f5df1d151fd020104eea46e5712c1f8473", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/42fcf1f5df1d151fd020104eea46e5712c1f8473", "committedDate": "2020-12-18T09:30:59Z", "message": "Move misplaced access control check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "672e0919ce7abf93655e0bbdecbb73daca9f3d5c", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/672e0919ce7abf93655e0bbdecbb73daca9f3d5c", "committedDate": "2020-12-18T09:30:59Z", "message": "Remove unnecessary masquerade mode check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a1b10d25c770e50a37aa6d1896f18d155747f58", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/9a1b10d25c770e50a37aa6d1896f18d155747f58", "committedDate": "2020-12-18T09:31:00Z", "message": "Add flag to UnauthorizedAccessException to display the error message to user"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "652d45e25b11e5ff8a3e87e61b934f285c1a9685", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/652d45e25b11e5ff8a3e87e61b934f285c1a9685", "committedDate": "2020-12-16T12:13:03Z", "message": "Add flag to UnauthorizedAccessException to display the error message to user"}, "afterCommit": {"oid": "9a1b10d25c770e50a37aa6d1896f18d155747f58", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/9a1b10d25c770e50a37aa6d1896f18d155747f58", "committedDate": "2020-12-18T09:31:00Z", "message": "Add flag to UnauthorizedAccessException to display the error message to user"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NDQ3MDQw", "url": "https://github.com/TEAMMATES/teammates/pull/10879#pullrequestreview-555447040", "createdAt": "2020-12-18T12:31:10Z", "commit": {"oid": "9a1b10d25c770e50a37aa6d1896f18d155747f58"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4224, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}