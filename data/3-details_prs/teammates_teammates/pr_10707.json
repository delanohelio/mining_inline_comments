{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1OTAyOTEz", "number": 10707, "title": "[#9536] Course Join Confirmation Page E2E Tests", "bodyText": "Part of #9536\nOutline of Solution\n\nAdd key to results of GetInstructorsAction if user is admin\nAdd CourseJoinConfirmationPage to represent the confirmation page for both student and instructors\nAdd ErrorReportingModal to represent to error reporting modal\nAdd InstructorCourseJoinConfirmationPageE2ETest and StudentCourseJoinConfirmationPageE2ETest which tests:\n\nClick join link: invalid key\nClick join link: valid key\nAlready joined, no confirmation page", "createdAt": "2020-09-12T13:20:15Z", "url": "https://github.com/TEAMMATES/teammates/pull/10707", "merged": true, "mergeCommit": {"oid": "d2f3d0bb06c4ad45ad2d2ef1f36e47ac54fb55d7"}, "closed": true, "closedAt": "2020-09-14T03:55:54Z", "author": {"login": "jtankw3"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIJw4bAH2gAyNDg1OTAyOTEzOjYxNTcyZjM5YmVlMGM1M2FmOWFmMjI2NDQwNmZiN2JkYTk3ZmNlYTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIqz7tAFqTQ4NzM5NjQ2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "61572f39bee0c53af9af2264406fb7bda97fcea6", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/61572f39bee0c53af9af2264406fb7bda97fcea6", "committedDate": "2020-09-12T13:11:10Z", "message": "Add InstructorCourseJoinConfirmationPageE2ETest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e5f5c5894e14ef32d13880c75c659f766d7b6a2", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/4e5f5c5894e14ef32d13880c75c659f766d7b6a2", "committedDate": "2020-09-12T13:11:39Z", "message": "Add StudentCourseJoinConfirmationPageE2ETest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21b8dae52ad0a0c3eb4c993d00587176cb7310a7", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/21b8dae52ad0a0c3eb4c993d00587176cb7310a7", "committedDate": "2020-09-12T13:20:29Z", "message": "Merge branch 'master' into course-join-page-e2e"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85cee6be448b7707aa780c9f56e7f4108cb94622", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/85cee6be448b7707aa780c9f56e7f4108cb94622", "committedDate": "2020-09-12T13:49:55Z", "message": "Update snapshots"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjczNTY5", "url": "https://github.com/TEAMMATES/teammates/pull/10707#pullrequestreview-487273569", "createdAt": "2020-09-13T04:25:29Z", "commit": {"oid": "85cee6be448b7707aa780c9f56e7f4108cb94622"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QwNDoyNToyOVrOHQ5YFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xM1QxNDoyNzoxNFrOHQ82YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ3OTMxOA==", "bodyText": "This should also be WebPageURIs#JOIN_PAGE. The only difference is the entity doing the join.", "url": "https://github.com/TEAMMATES/teammates/pull/10707#discussion_r487479318", "createdAt": "2020-09-13T04:25:29Z", "author": {"login": "wkurniawan07"}, "path": "src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseJoinConfirmationPageE2ETest.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package teammates.e2e.cases.e2e;\n+\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.common.util.StringHelper;\n+import teammates.e2e.pageobjects.AppPage;\n+import teammates.e2e.pageobjects.CourseJoinConfirmationPage;\n+import teammates.e2e.pageobjects.ErrorReportingModal;\n+import teammates.e2e.pageobjects.InstructorHomePage;\n+\n+/**\n+ * SUT: {@link Const.LegacyURIs#INSTRUCTOR_COURSE_JOIN}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85cee6be448b7707aa780c9f56e7f4108cb94622"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMDI5Ng==", "bodyText": "At this stage, we shouldn't have dependency on StringHelper.encrypt because this method has dependency to the encryption key set in the application. We need to either:\n\nSet up another encryption method that is configured via test.properties used by E2E tests. (not preferred)\nModify the API layer such that all keys that are returned are already encrypted. I am of the belief this is already the case for non-admin user-facing endpoints.", "url": "https://github.com/TEAMMATES/teammates/pull/10707#discussion_r487530296", "createdAt": "2020-09-13T13:34:27Z", "author": {"login": "wkurniawan07"}, "path": "src/e2e/java/teammates/e2e/cases/BaseTestCaseWithBackDoorApiAccess.java", "diffHunk": "@@ -191,7 +192,7 @@ public InstructorAttributes run() {\n     }\n \n     protected String getKeyForInstructor(String courseId, String instructorEmail) {\n-        return null; // BackDoor.getEncryptedKeyForInstructor(courseId, instructorEmail);\n+        return StringHelper.encrypt(getInstructor(courseId, instructorEmail).getKey());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85cee6be448b7707aa780c9f56e7f4108cb94622"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzNTEzNg==", "bodyText": "This is not something specific to the course join page, though", "url": "https://github.com/TEAMMATES/teammates/pull/10707#discussion_r487535136", "createdAt": "2020-09-13T14:17:55Z", "author": {"login": "wkurniawan07"}, "path": "src/e2e/java/teammates/e2e/pageobjects/CourseJoinConfirmationPage.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package teammates.e2e.pageobjects;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.WebElement;\n+import org.openqa.selenium.support.FindBy;\n+\n+/**\n+ * Page Object Model for the course join confirmation page.\n+ */\n+public class CourseJoinConfirmationPage extends AppPage {\n+    @FindBy(id = \"btn-confirm\")\n+    private WebElement confirmButton;\n+\n+    public CourseJoinConfirmationPage(Browser browser) {\n+        super(browser);\n+    }\n+\n+    @Override\n+    public boolean containsExpectedPageContents() {\n+        if (isElementPresent(By.className(\"modal-content\"))) {\n+            return waitForElementPresence(By.tagName(\"h2\")).getText().contains(\"Uh oh! Something went wrong.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85cee6be448b7707aa780c9f56e7f4108cb94622"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzNjIyNA==", "bodyText": "I'm aware that this is from previous UI test, but is this necessary? I don't think cookies are carried over to browsers initialized by Selenium.", "url": "https://github.com/TEAMMATES/teammates/pull/10707#discussion_r487536224", "createdAt": "2020-09-13T14:27:14Z", "author": {"login": "wkurniawan07"}, "path": "src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseJoinConfirmationPageE2ETest.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package teammates.e2e.cases.e2e;\n+\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.common.util.StringHelper;\n+import teammates.e2e.pageobjects.AppPage;\n+import teammates.e2e.pageobjects.CourseJoinConfirmationPage;\n+import teammates.e2e.pageobjects.ErrorReportingModal;\n+import teammates.e2e.pageobjects.InstructorHomePage;\n+\n+/**\n+ * SUT: {@link Const.LegacyURIs#INSTRUCTOR_COURSE_JOIN}.\n+ */\n+public class InstructorCourseJoinConfirmationPageE2ETest extends BaseE2ETestCase {\n+    InstructorAttributes newInstructor;\n+\n+    @Override\n+    protected void prepareTestData() {\n+        testData = loadDataBundle(\"/InstructorCourseJoinConfirmationPageE2ETest.json\");\n+        removeAndRestoreDataBundle(testData);\n+\n+        newInstructor = testData.instructors.get(\"ICJConfirmationE2eT.instr.CS1101\");\n+        newInstructor.googleId = \"ICJConfirmationE2eT.instr2\";\n+    }\n+\n+    @BeforeClass\n+    public void classSetup() {\n+        browser.driver.manage().deleteAllCookies();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85cee6be448b7707aa780c9f56e7f4108cb94622"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8af920a2c2db6f743990a654fff7fd0e5b447d45", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/8af920a2c2db6f743990a654fff7fd0e5b447d45", "committedDate": "2020-09-13T15:18:17Z", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into course-join-page-e2e"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1469746b852c4eb8e0365668e51985a4f61658c2", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/1469746b852c4eb8e0365668e51985a4f61658c2", "committedDate": "2020-09-13T15:29:25Z", "message": "Remove unneeded expected page content in CourseJoinConfirmationPage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6623eeac5c5d95d98e9c06a8d20c22c5aa70bf89", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/6623eeac5c5d95d98e9c06a8d20c22c5aa70bf89", "committedDate": "2020-09-13T17:28:25Z", "message": "Fix wrong javadoc comment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ea84e1ab066d0bfb958470e2ec56feeb8ef4869", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/6ea84e1ab066d0bfb958470e2ec56feeb8ef4869", "committedDate": "2020-09-13T15:30:36Z", "message": "Fix wrong javadoc comment"}, "afterCommit": {"oid": "6623eeac5c5d95d98e9c06a8d20c22c5aa70bf89", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/6623eeac5c5d95d98e9c06a8d20c22c5aa70bf89", "committedDate": "2020-09-13T17:28:25Z", "message": "Fix wrong javadoc comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7aa9d1de7ae24bd92cf7a344cb931b18a7dc38f2", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/7aa9d1de7ae24bd92cf7a344cb931b18a7dc38f2", "committedDate": "2020-09-14T02:56:18Z", "message": "Remove StringHelper encryption from E2E"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3Mzk2NDY1", "url": "https://github.com/TEAMMATES/teammates/pull/10707#pullrequestreview-487396465", "createdAt": "2020-09-14T03:41:22Z", "commit": {"oid": "7aa9d1de7ae24bd92cf7a344cb931b18a7dc38f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4263, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}