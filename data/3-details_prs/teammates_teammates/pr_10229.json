{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MDE1ODcx", "number": 10229, "title": "[#10219] Add instructor/participant comment in CSV", "bodyText": "Fixes #10219\nOutline of Solution\n\nAdded abstract method to check if instructor/participant can comment on the response\nAdd the headers and actual comment to csvRows\nManually verified all snapshot tests matches up with the CSV files generated in V6 for comments\n\nConcerns\n\nFor should show responses along with stats for feedbackSessionResultC1S1 (The second test), the CSV file mentioned in the comment seems incorrect?\nThere were some test data where there seems to be more data in the json in V7 compared to V6 so there wasn't a one to one match so I checked against the json for these tests for comments.", "createdAt": "2020-06-24T07:25:54Z", "url": "https://github.com/TEAMMATES/teammates/pull/10229", "merged": true, "mergeCommit": {"oid": "580f3cd12f8aef34cfa813b6f442f9da8a777e89"}, "closed": true, "closedAt": "2020-06-24T09:28:12Z", "author": {"login": "t-cheepeng"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuCw7VgH2gAyNDM5MDE1ODcxOmJhZGEyYzdiMWIxMzJlMzZlY2Q0NDNjOTg2OTQ3NDNkY2YyYmFhMWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuVy2mgH2gAyNDM5MDE1ODcxOmFkYzQ5NmU2NjY0MTVhZjUzNDAzYTE4ZGZkZTljNDkzNzMyZjQ4Njg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bada2c7b1b132e36ecd443c98694743dcf2baa1c", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/bada2c7b1b132e36ecd443c98694743dcf2baa1c", "committedDate": "2020-06-23T10:19:51Z", "message": "Add check for if someone can comment on response"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b85ac729dab08c67645749da798c6e565b7fd31", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/8b85ac729dab08c67645749da798c6e565b7fd31", "committedDate": "2020-06-23T10:20:30Z", "message": "Add in comment header and content to csv"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b724ba3c1e875832cf6cdefb514efff24f26918", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/5b724ba3c1e875832cf6cdefb514efff24f26918", "committedDate": "2020-06-24T04:56:13Z", "message": "Update snapshots"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NDA4OTI2", "url": "https://github.com/TEAMMATES/teammates/pull/10229#pullrequestreview-436408926", "createdAt": "2020-06-24T07:55:39Z", "commit": {"oid": "5b724ba3c1e875832cf6cdefb514efff24f26918"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNzo1NTozOVrOGoHDpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwNzo1ODoxOVrOGoHJ7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcxMTg0Nw==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/TEAMMATES/teammates/pull/10229#discussion_r444711847", "createdAt": "2020-06-24T07:55:39Z", "author": {"login": "xpdavid"}, "path": "src/web/services/session-result-csv.service.ts", "diffHunk": "@@ -97,11 +97,25 @@ export class SessionResultCsvService {\n     const header: string[] = ['Team', \"Giver's Full Name\", \"Giver's Last Name\", \"Giver's Email\", \"Recipient's Team\",\n       \"Recipient's Full Name\", \"Recipient's Last Name\", \"Recipient's Email\",\n       ...this.getQuestionSpecificHeaders(question.feedbackQuestion)];\n-    csvRows.push(header);\n \n-    // TODO add participant comment header\n+    const isParticipantCommentsOnResponsesAllowed: boolean =\n+        this.getIsParticipantCommentsOnResponsesAllowed(question.feedbackQuestion);\n+    if (isParticipantCommentsOnResponsesAllowed) {\n+      header.push(\"Giver's Comments\");\n+    }\n+\n+    const isInstructorCommentsOnResponsesAllowed: boolean =\n+        this.getIsInstructorCommentsOnResponsesAllowed(question.feedbackQuestion);\n+    if (isInstructorCommentsOnResponsesAllowed) {\n+      const maxNumOfInstructorComments: number = question.allResponses\n+          .map((response: ResponseOutput) => response.instructorComments.length)\n+          .reduce((prev: number, cur: number) => Math.max(prev, cur), 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b724ba3c1e875832cf6cdefb514efff24f26918"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcxMzQ1Mg==", "bodyText": "Should be true for MSQ also", "url": "https://github.com/TEAMMATES/teammates/pull/10229#discussion_r444713452", "createdAt": "2020-06-24T07:58:19Z", "author": {"login": "xpdavid"}, "path": "src/web/types/question-details-impl/feedback-msq-question-details.impl.ts", "diffHunk": "@@ -57,4 +57,11 @@ export class FeedbackMsqQuestionDetailsImpl extends AbstractFeedbackMcqMsqQuesti\n     return statsRows;\n   }\n \n+  isParticipantCommentsOnResponsesAllowed(): boolean {\n+    return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b724ba3c1e875832cf6cdefb514efff24f26918"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65e2bc6476a9cb0e1404d8748035e4be4469a729", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/65e2bc6476a9cb0e1404d8748035e4be4469a729", "committedDate": "2020-06-24T08:21:35Z", "message": "Change msq question to allow participant comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NDI4NjE4", "url": "https://github.com/TEAMMATES/teammates/pull/10229#pullrequestreview-436428618", "createdAt": "2020-06-24T08:22:49Z", "commit": {"oid": "65e2bc6476a9cb0e1404d8748035e4be4469a729"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adc496e666415af53403a18dfde9c493732f4868", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/adc496e666415af53403a18dfde9c493732f4868", "committedDate": "2020-06-24T08:30:09Z", "message": "Update snapshots for msq"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4365, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}