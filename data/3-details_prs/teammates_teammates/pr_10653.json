{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1MDY3MjY4", "number": 10653, "title": "[#10650] Add null check for getFeedbackSession in API actions", "bodyText": "Fixes #10650", "createdAt": "2020-08-28T03:33:17Z", "url": "https://github.com/TEAMMATES/teammates/pull/10653", "merged": true, "mergeCommit": {"oid": "5eb457fc9fb599b9a7b675d5ff6f9b88399184f4"}, "closed": true, "closedAt": "2020-09-07T12:33:29Z", "author": {"login": "madanalogy"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDYowngFqTQ3NzkxNDA4Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdGhMJdgH2gAyNDc1MDY3MjY4OmU2NWZjMjYwNTRkYjY2MGQ0NjdlNDY3NmM2N2U2ODI0YzRkZmUwZGU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3OTE0MDg3", "url": "https://github.com/TEAMMATES/teammates/pull/10653#pullrequestreview-477914087", "createdAt": "2020-08-28T17:41:15Z", "commit": {"oid": "45e7052ad62e9a570dd292f70ff96c6830a8d2f7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "45e7052ad62e9a570dd292f70ff96c6830a8d2f7", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/45e7052ad62e9a570dd292f70ff96c6830a8d2f7", "committedDate": "2020-08-28T03:31:23Z", "message": "Add null check for method parameter"}, "afterCommit": {"oid": "5559d607994696d4752e060c977526aa62bb4882", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/5559d607994696d4752e060c977526aa62bb4882", "committedDate": "2020-08-29T13:55:49Z", "message": "Add EntityNotFoundException to getFeedbackSession"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MTQzNzQ3", "url": "https://github.com/TEAMMATES/teammates/pull/10653#pullrequestreview-478143747", "createdAt": "2020-08-29T17:40:45Z", "commit": {"oid": "5559d607994696d4752e060c977526aa62bb4882"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQxNzo0MDo0NVrOHJc4tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOVQxNzo0MDo0NVrOHJc4tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTY3MjUwMw==", "bodyText": "This violates our policy on DB layer though https://github.com/TEAMMATES/teammates/blob/master/docs/design.md#policies-2", "url": "https://github.com/TEAMMATES/teammates/pull/10653#discussion_r479672503", "createdAt": "2020-08-29T17:40:45Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/storage/api/FeedbackSessionsDb.java", "diffHunk": "@@ -80,7 +81,15 @@ public FeedbackSessionAttributes getFeedbackSession(String courseId, String feed\n \n         if (feedbackSession != null && feedbackSession.isSessionDeleted()) {\n             log.info(\"Trying to access soft-deleted session: \" + feedbackSessionName + \"/\" + courseId);\n-            return null;\n+        }\n+        if (feedbackSession == null || feedbackSession.isSessionDeleted()) {\n+            String errorMessage = \"\";\n+            if (feedbackSession == null) {\n+                errorMessage = \"Session not found.\";\n+            } else {\n+                errorMessage = \"Session is deleted.\";\n+            }\n+            throw new EntityNotFoundException(new EntityDoesNotExistException(errorMessage));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5559d607994696d4752e060c977526aa62bb4882"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5559d607994696d4752e060c977526aa62bb4882", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/5559d607994696d4752e060c977526aa62bb4882", "committedDate": "2020-08-29T13:55:49Z", "message": "Add EntityNotFoundException to getFeedbackSession"}, "afterCommit": {"oid": "cc5dcabfac1135839382ad0d55a691aecc185b4f", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/cc5dcabfac1135839382ad0d55a691aecc185b4f", "committedDate": "2020-08-31T02:52:37Z", "message": "Add null checks for feedback session access control"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4Mjg2NjY0", "url": "https://github.com/TEAMMATES/teammates/pull/10653#pullrequestreview-478286664", "createdAt": "2020-08-31T03:31:10Z", "commit": {"oid": "cc5dcabfac1135839382ad0d55a691aecc185b4f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwMzozMToxMFrOHJo8ZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwMzozMToxMFrOHJo8ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg3MDA1Mg==", "bodyText": "This entire PR screams \"DRY\". You should abstract this entire method (get feedback session, throw EntityNotFoundException if not found) into the parent Action class.\nWhile you're at it, see if you can also employ the same method for course, instructor, and/or student objects.", "url": "https://github.com/TEAMMATES/teammates/pull/10653#discussion_r479870052", "createdAt": "2020-08-31T03:31:10Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/ui/webapi/action/ConfirmFeedbackSessionSubmissionAction.java", "diffHunk": "@@ -30,6 +32,10 @@ public void checkSpecificAccessControl() {\n         String feedbackSessionName = getNonNullRequestParamValue(Const.ParamsNames.FEEDBACK_SESSION_NAME);\n         FeedbackSessionAttributes feedbackSession = logic.getFeedbackSession(feedbackSessionName, courseId);\n \n+        if (feedbackSession == null) {\n+            throw new EntityNotFoundException(new EntityDoesNotExistException(\"Feedback session not found\"));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc5dcabfac1135839382ad0d55a691aecc185b4f"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1696c1b92cbcaae2668616ba44196474f6923864", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/1696c1b92cbcaae2668616ba44196474f6923864", "committedDate": "2020-09-06T16:32:00Z", "message": "Add null check for getFeedbackSession in API actions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cc5dcabfac1135839382ad0d55a691aecc185b4f", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/cc5dcabfac1135839382ad0d55a691aecc185b4f", "committedDate": "2020-08-31T02:52:37Z", "message": "Add null checks for feedback session access control"}, "afterCommit": {"oid": "1696c1b92cbcaae2668616ba44196474f6923864", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/1696c1b92cbcaae2668616ba44196474f6923864", "committedDate": "2020-09-06T16:32:00Z", "message": "Add null check for getFeedbackSession in API actions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMjAxNzIy", "url": "https://github.com/TEAMMATES/teammates/pull/10653#pullrequestreview-483201722", "createdAt": "2020-09-07T01:56:38Z", "commit": {"oid": "1696c1b92cbcaae2668616ba44196474f6923864"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwMTo1NjozOFrOHNuCAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwMTo1ODoxNFrOHNuDNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDE0NzcxMw==", "bodyText": "Just getFeedbackSession doesn't immediately tell that it's going to throw some exception if the value is null. Name it something like getNonNullFeedbackSession?", "url": "https://github.com/TEAMMATES/teammates/pull/10653#discussion_r484147713", "createdAt": "2020-09-07T01:56:38Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/ui/webapi/action/Action.java", "diffHunk": "@@ -190,6 +193,14 @@ protected String getRequestBody() {\n         return requestBody;\n     }\n \n+    protected FeedbackSessionAttributes getFeedbackSession(String feedbackSessionName, String courseId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1696c1b92cbcaae2668616ba44196474f6923864"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDE0ODAwMg==", "bodyText": "Unnecessary line move", "url": "https://github.com/TEAMMATES/teammates/pull/10653#discussion_r484148002", "createdAt": "2020-09-07T01:58:06Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/ui/webapi/action/PublishFeedbackSessionAction.java", "diffHunk": "@@ -24,10 +24,10 @@ public void checkSpecificAccessControl() {\n         String courseId = getNonNullRequestParamValue(Const.ParamsNames.COURSE_ID);\n         String feedbackSessionName = getNonNullRequestParamValue(Const.ParamsNames.FEEDBACK_SESSION_NAME);\n \n+        FeedbackSessionAttributes feedbackSession = getFeedbackSession(feedbackSessionName, courseId);\n         InstructorAttributes instructor = logic.getInstructorForGoogleId(courseId, userInfo.getId());\n-        FeedbackSessionAttributes session = logic.getFeedbackSession(feedbackSessionName, courseId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1696c1b92cbcaae2668616ba44196474f6923864"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDE0ODAyMw==", "bodyText": "Similarly here", "url": "https://github.com/TEAMMATES/teammates/pull/10653#discussion_r484148023", "createdAt": "2020-09-07T01:58:14Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/ui/webapi/action/UnpublishFeedbackSessionAction.java", "diffHunk": "@@ -24,10 +24,10 @@ public void checkSpecificAccessControl() {\n         String courseId = getNonNullRequestParamValue(Const.ParamsNames.COURSE_ID);\n         String feedbackSessionName = getNonNullRequestParamValue(Const.ParamsNames.FEEDBACK_SESSION_NAME);\n \n+        FeedbackSessionAttributes feedbackSession = getFeedbackSession(feedbackSessionName, courseId);\n         InstructorAttributes instructor = logic.getInstructorForGoogleId(courseId, userInfo.getId());\n-        FeedbackSessionAttributes session = logic.getFeedbackSession(feedbackSessionName, courseId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1696c1b92cbcaae2668616ba44196474f6923864"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c917886a597a44165a9b5109fc9a3321a23fc42d", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/c917886a597a44165a9b5109fc9a3321a23fc42d", "committedDate": "2020-09-07T02:33:56Z", "message": "Refactor name of base method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNDY4NDQz", "url": "https://github.com/TEAMMATES/teammates/pull/10653#pullrequestreview-483468443", "createdAt": "2020-09-07T11:05:18Z", "commit": {"oid": "c917886a597a44165a9b5109fc9a3321a23fc42d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e65fc26054db660d467e4676c67e6824c4dfe0de", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/e65fc26054db660d467e4676c67e6824c4dfe0de", "committedDate": "2020-09-07T11:20:55Z", "message": "Merge branch 'master' into 10650-npe"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4245, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}