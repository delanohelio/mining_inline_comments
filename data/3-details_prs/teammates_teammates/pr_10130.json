{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MzY5NTcz", "number": 10130, "title": "[#10108]  Show profile picture popover in instructor result page ", "bodyText": "Fixes #10108\nOutline of Solution\nStudent List\n\nQuestion View\n\nGRQ View\n\nGQR View\n\n\nCreated a pipe formatPhotoUrlPipe for formatting URL for API request to backend\nExtracted popover to a common component view-photo-popover-component for reuse\nHave a map of users to their photo url so that data can be passed from parent views to child views since clicking on the View Photo popover in any place makes it propogate throughout the whole view. Would there be a better way to do this?\nDue to the above, loading photo is handled by the specific view components with loadPhotoHandler. Child components bubble the load photo event from the view-photo-popover-component upwards", "createdAt": "2020-05-28T09:39:26Z", "url": "https://github.com/TEAMMATES/teammates/pull/10130", "merged": true, "mergeCommit": {"oid": "693542c7963b1c064c7ca2cf20b2463f4bc6407e"}, "closed": true, "closedAt": "2020-05-29T08:39:30Z", "author": {"login": "t-cheepeng"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclkEdaAH2gAyNDI0MzY5NTczOjJkNjViNjFlM2Q3MjI3NjkxM2JjNGU2NGY5M2IxYTdhOWE2OGRjYTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcl8JkRAFqTQyMDY3NDE2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2d65b61e3d72276913bc4e64f93b1a7a9a68dca3", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/2d65b61e3d72276913bc4e64f93b1a7a9a68dca3", "committedDate": "2020-05-28T02:02:44Z", "message": "Refactor popover to view-photo-popover-component"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b4a54df1f91dce2c5b603bc7e16ed3f6bc698c9", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/1b4a54df1f91dce2c5b603bc7e16ed3f6bc698c9", "committedDate": "2020-05-28T02:45:00Z", "message": "Add popover to grq-rgq views"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac2a3afb670a0ddd42d88406691de18154f0111b", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/ac2a3afb670a0ddd42d88406691de18154f0111b", "committedDate": "2020-05-28T03:09:08Z", "message": "Add popover to per question and gqr-rqg views"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "942430323be4d587a2fb6ebb36c7763a58c99385", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/942430323be4d587a2fb6ebb36c7763a58c99385", "committedDate": "2020-05-28T04:03:41Z", "message": "Return student list popover to original behaviour"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ce6749a13d98a9bcd52e3f23ebf9a0a7ca5c083", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/3ce6749a13d98a9bcd52e3f23ebf9a0a7ca5c083", "committedDate": "2020-05-28T06:32:15Z", "message": "Merge branch 'master' into 10108-show-profile-popover"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f5fae876c496e0434c78b38a643493475bce673", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/6f5fae876c496e0434c78b38a643493475bce673", "committedDate": "2020-05-28T07:01:20Z", "message": "Shift email init logic up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1161e8a66e2d2acf64d676f400a59985adc018f6", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/1161e8a66e2d2acf64d676f400a59985adc018f6", "committedDate": "2020-05-28T07:26:25Z", "message": "Add popover to question view"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "946634d45aa029a98252c0bf200fcb8b765e1d67", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/946634d45aa029a98252c0bf200fcb8b765e1d67", "committedDate": "2020-05-28T08:03:01Z", "message": "Shift td tags outwards from per question view"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b46809648ce04ffcbf7a9cf0b07be8385d28fcc", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/8b46809648ce04ffcbf7a9cf0b07be8385d28fcc", "committedDate": "2020-05-28T08:30:31Z", "message": "Update snapshots and fix linting issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de10d8182efd61285841818f8be7156a5ef89875", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/de10d8182efd61285841818f8be7156a5ef89875", "committedDate": "2020-05-28T09:40:13Z", "message": "Make click event stop at popover"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNDQ5MTE5", "url": "https://github.com/TEAMMATES/teammates/pull/10130#pullrequestreview-420449119", "createdAt": "2020-05-28T20:00:46Z", "commit": {"oid": "de10d8182efd61285841818f8be7156a5ef89875"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMDowMDo0NlrOGcEsTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMDoxMTo0NVrOGcFD9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5MDE4OA==", "bodyText": "The component should be in TeammatesCommon module right?", "url": "https://github.com/TEAMMATES/teammates/pull/10130#discussion_r432090188", "createdAt": "2020-05-28T20:00:46Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/view-photo-popover/view-photo-popover.component.ts", "diffHunk": "@@ -0,0 +1,30 @@\n+import { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\n+\n+/**\n+ * Component to display a popover for photos\n+ */\n+@Component({\n+  selector: 'tm-view-photo-popover',\n+  templateUrl: './view-photo-popover.component.html',\n+  styleUrls: ['./view-photo-popover.component.scss'],\n+})\n+export class ViewPhotoPopoverComponent implements OnInit {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de10d8182efd61285841818f8be7156a5ef89875"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5MTcxNQ==", "bodyText": "I am not sure why do we need this event for parent to handle.\nParent can just pass the full photoUrl. There is a new attribute in the component called isPhotoShown. Once the View photo is clicked, the attribute change and the photo is shown.", "url": "https://github.com/TEAMMATES/teammates/pull/10130#discussion_r432091715", "createdAt": "2020-05-28T20:02:52Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/view-photo-popover/view-photo-popover.component.ts", "diffHunk": "@@ -0,0 +1,30 @@\n+import { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\n+\n+/**\n+ * Component to display a popover for photos\n+ */\n+@Component({\n+  selector: 'tm-view-photo-popover',\n+  templateUrl: './view-photo-popover.component.html',\n+  styleUrls: ['./view-photo-popover.component.scss'],\n+})\n+export class ViewPhotoPopoverComponent implements OnInit {\n+\n+  @Input()\n+  photoUrl: string = '';\n+\n+  @Input()\n+  isContentAvailable: boolean = true;\n+\n+  @Output()\n+  loadPhotoEvent: EventEmitter<any> = new EventEmitter();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de10d8182efd61285841818f8be7156a5ef89875"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NDA2OQ==", "bodyText": "You already have email and courseId here, don't you?", "url": "https://github.com/TEAMMATES/teammates/pull/10130#discussion_r432094069", "createdAt": "2020-05-28T20:07:32Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/gqr-rqg-view-responses/gqr-rqg-view-responses.component.html", "diffHunk": "@@ -31,7 +31,9 @@\n <ng-template #userTab let-userInfo='userInfo'>\n   <div class=\"card top-padded\">\n     <div class=\"card-header bg-primary text-white\" (click)=\"userExpanded[userInfo] = !userExpanded[userInfo]\">\n-      {{ isGqr ? 'From' : 'To' }}: {{ userInfo }}\n+      <tm-view-photo-popover [photoUrl]=\"userToPhotoUrl[userInfo]\" (loadPhotoEvent)=\"loadPhotoHandler(userInfo)\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de10d8182efd61285841818f8be7156a5ef89875"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NTQ5Ng==", "bodyText": "I don't think topName is a good name. Actually the original expression looks better", "url": "https://github.com/TEAMMATES/teammates/pull/10130#discussion_r432095496", "createdAt": "2020-05-28T20:10:13Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/grouped-responses/grouped-responses.component.html", "diffHunk": "@@ -2,10 +2,14 @@\n     *ngIf=\"responses.length && responses[0].allResponses.length\">\n   <div class=\"col-md-3\">\n     <div>\n-      {{ isGrq ? 'To' : 'From' }}: {{ responses[0].allResponses[0][isGrq ? 'recipient' : 'giver']}} {{ teamInfo[isGrq ? 'recipient' : 'giver'] }}\n+      <tm-view-photo-popover [photoUrl]=\"userToPhotoUrl[topName]\" (loadPhotoEvent)=\"loadPhotoEvent.emit(topName)\">\n+        {{ isGrq ? 'To' : 'From' }}: {{ topName }} {{ teamInfo[isGrq ? 'recipient' : 'giver'] }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de10d8182efd61285841818f8be7156a5ef89875"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NjI0NQ==", "bodyText": "What does isContentAvailable control?", "url": "https://github.com/TEAMMATES/teammates/pull/10130#discussion_r432096245", "createdAt": "2020-05-28T20:11:45Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/view-photo-popover/view-photo-popover.component.ts", "diffHunk": "@@ -0,0 +1,30 @@\n+import { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\n+\n+/**\n+ * Component to display a popover for photos\n+ */\n+@Component({\n+  selector: 'tm-view-photo-popover',\n+  templateUrl: './view-photo-popover.component.html',\n+  styleUrls: ['./view-photo-popover.component.scss'],\n+})\n+export class ViewPhotoPopoverComponent implements OnInit {\n+\n+  @Input()\n+  photoUrl: string = '';\n+\n+  @Input()\n+  isContentAvailable: boolean = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de10d8182efd61285841818f8be7156a5ef89875"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23338e6564e90f8005b1b6acf587cdd5124ee9a6", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/23338e6564e90f8005b1b6acf587cdd5124ee9a6", "committedDate": "2020-05-29T02:06:54Z", "message": "Merge branch 'master' into 10108-show-profile-popover"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9813839d0167d383cc8a83293d0d92c7af949409", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/9813839d0167d383cc8a83293d0d92c7af949409", "committedDate": "2020-05-29T02:21:18Z", "message": "Shift popover to tm common module and fix var name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e676b27a4da3240c1c2d30a3a0d5daef27b7a6d5", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/e676b27a4da3240c1c2d30a3a0d5daef27b7a6d5", "committedDate": "2020-05-29T04:39:14Z", "message": "Remove syncing of view photo popovers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7d1d5473d783562545b08e3d2eed7817aee04be", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/a7d1d5473d783562545b08e3d2eed7817aee04be", "committedDate": "2020-05-29T04:46:48Z", "message": "Update snapshots and fix lint issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9488b0b84c8f5d9c6aa8237b926dfc963cb10a2e", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/9488b0b84c8f5d9c6aa8237b926dfc963cb10a2e", "committedDate": "2020-05-29T04:52:27Z", "message": "Merge branch 'master' into 10108-show-profile-popover"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNjUxMjA3", "url": "https://github.com/TEAMMATES/teammates/pull/10130#pullrequestreview-420651207", "createdAt": "2020-05-29T04:53:43Z", "commit": {"oid": "a7d1d5473d783562545b08e3d2eed7817aee04be"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNDo1Mzo1N1rOGcOvUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNTowMDowNVrOGcO05A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI1NDgwMQ==", "bodyText": "userToEmail[userInfo] is more important so it should be\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  <tm-view-photo-popover [photoUrl]=\"session.courseId | formatPhotoUrl: userToEmail[userInfo]\">\n          \n          \n            \n                  <tm-view-photo-popover [photoUrl]=\"userToEmail[userInfo] | formatPhotoUrl: session.courseId\">\n          \n      \n    \n    \n  \n\n?", "url": "https://github.com/TEAMMATES/teammates/pull/10130#discussion_r432254801", "createdAt": "2020-05-29T04:53:57Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/gqr-rqg-view-responses/gqr-rqg-view-responses.component.html", "diffHunk": "@@ -31,7 +31,9 @@\n <ng-template #userTab let-userInfo='userInfo'>\n   <div class=\"card top-padded\">\n     <div class=\"card-header bg-primary text-white\" (click)=\"userExpanded[userInfo] = !userExpanded[userInfo]\">\n-      {{ isGqr ? 'From' : 'To' }}: {{ userInfo }}\n+      <tm-view-photo-popover [photoUrl]=\"session.courseId | formatPhotoUrl: userToEmail[userInfo]\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9488b0b84c8f5d9c6aa8237b926dfc963cb10a2e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI1NTIyOA==", "bodyText": "There should be a two-spaces indentation here?", "url": "https://github.com/TEAMMATES/teammates/pull/10130#discussion_r432255228", "createdAt": "2020-05-29T04:56:00Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/per-question-view-responses/per-question-view-responses.component.html", "diffHunk": "@@ -34,9 +34,17 @@\n     <tbody>\n       <tr *ngFor=\"let response of responsesToShow\">\n         <td *ngIf=\"showGiver\">{{ response.giverTeam }}</td>\n-        <td *ngIf=\"showGiver\">{{ response.giver }}</td>\n+        <td *ngIf=\"showGiver\">\n+        <tm-view-photo-popover [photoUrl]=\"session.courseId | formatPhotoUrl: userToEmail[response.giver]\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9488b0b84c8f5d9c6aa8237b926dfc963cb10a2e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI1NTUzOQ==", "bodyText": "Unnecessary changes?", "url": "https://github.com/TEAMMATES/teammates/pull/10130#discussion_r432255539", "createdAt": "2020-05-29T04:57:22Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/instructor-session-result-page/instructor-session-result-question-view.component.html", "diffHunk": "@@ -10,7 +10,7 @@\n     <tm-per-question-view-responses [responses]=\"question.responses\" [section]=\"section\" [sectionType]=\"sectionType\" [session]=\"session\"\n                                     [indicateMissingResponses]=\"true\" [question]=\"question.question\"\n                                     [instructorCommentTableModel]=\"instructorCommentTableModel\"\n-                                    (instructorCommentTableModelChange)=\"triggerInstructorCommentTableModelChange($event)\"\n+                                    (instructorCommentTableModelChange)=\"triggerInstructorCommentTableModelChange($event);\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9488b0b84c8f5d9c6aa8237b926dfc963cb10a2e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI1NjIyOA==", "bodyText": "Not used?", "url": "https://github.com/TEAMMATES/teammates/pull/10130#discussion_r432256228", "createdAt": "2020-05-29T05:00:05Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-responses/grouped-responses/grouped-responses.component.ts", "diffHunk": "@@ -22,6 +22,7 @@ export class GroupedResponsesComponent extends ResponsesInstructorCommentsBase i\n   CommentRowMode: typeof CommentRowMode = CommentRowMode;\n \n   @Input() responses: QuestionOutput[] = [];\n+  @Input() userToEmail: Record<string, string> = {};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9488b0b84c8f5d9c6aa8237b926dfc963cb10a2e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94ebfd2e989d6ff7d61255710107ff0f032d8b89", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/94ebfd2e989d6ff7d61255710107ff0f032d8b89", "committedDate": "2020-05-29T05:30:43Z", "message": "Change argument order in formatPhotoUrl pipe"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNjcwMDQz", "url": "https://github.com/TEAMMATES/teammates/pull/10130#pullrequestreview-420670043", "createdAt": "2020-05-29T05:55:10Z", "commit": {"oid": "94ebfd2e989d6ff7d61255710107ff0f032d8b89"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27da626d4273efd1c8888773f8bc72d3885acc02", "author": {"user": {"login": "t-cheepeng", "name": "t-cheepeng"}}, "url": "https://github.com/TEAMMATES/teammates/commit/27da626d4273efd1c8888773f8bc72d3885acc02", "committedDate": "2020-05-29T05:58:57Z", "message": "Merge branch 'master' into 10108-show-profile-popover"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNjc0MTYz", "url": "https://github.com/TEAMMATES/teammates/pull/10130#pullrequestreview-420674163", "createdAt": "2020-05-29T06:06:02Z", "commit": {"oid": "27da626d4273efd1c8888773f8bc72d3885acc02"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4323, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}