{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1NjMyNjI2", "number": 10895, "title": "[#8918] Instructor: view results: questions for ranking: show rank within team", "bodyText": "Fixes #8918\nOutline of Solution\n\nCreated new member fields in the rank-recipient-question-statistics-calculation class for team rank.\n\nIn calculateRanks, all the teams and their team members are captured in the optionsPerTeam variable, which maps team names to its team members.\nFor each team, the calculateRankPerOption is called with only the team members' responses, and the ranks within each team are calculated.\n\n\nLikewise, the process is repeated for team rank excluding self.\nAdded test case for ranks within a team.\n\nScreenshot\n\n\nPoints to Note\nThe solution assumes that team names are unique.", "createdAt": "2020-12-25T21:23:05Z", "url": "https://github.com/TEAMMATES/teammates/pull/10895", "merged": true, "mergeCommit": {"oid": "4e443205d9c351e0b95d011504548cdcbe5a3f63"}, "closed": true, "closedAt": "2021-02-22T12:28:37Z", "author": {"login": "AdithyaNarayan"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdppZbqgH2gAyNTQ1NjMyNjI2OmM2ODFmOTdjNmViZjYwNmQ4NGQ4NjBmMTFhY2ZkZjNjMzI4NGRiMDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd8l7VJgH2gAyNTQ1NjMyNjI2OmU5YmMxOTk5ZWY4OTVjMzkyZDlmZDdhYmVlMzgyZmZjMmJjNGQ5MDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c681f97c6ebf606d84d860f11acfdf3c3284db04", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/c681f97c6ebf606d84d860f11acfdf3c3284db04", "committedDate": "2020-12-25T14:42:01Z", "message": "Add team rank and team rank excluding self"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2635a5e4841b084ae8218fc74fa67e8ecd3a5f8e", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/2635a5e4841b084ae8218fc74fa67e8ecd3a5f8e", "committedDate": "2020-12-25T19:10:36Z", "message": "Add test for team rank"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca8146dacf85b942e052b71302857ef1c715fd03", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/ca8146dacf85b942e052b71302857ef1c715fd03", "committedDate": "2020-12-25T20:36:17Z", "message": "Update snapshots"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7268d9bb79821579cd29864a9f0811d13a6d4765", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/7268d9bb79821579cd29864a9f0811d13a6d4765", "committedDate": "2020-12-25T21:03:50Z", "message": "Fix lint errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMzIzMzUx", "url": "https://github.com/TEAMMATES/teammates/pull/10895#pullrequestreview-560323351", "createdAt": "2020-12-31T10:53:34Z", "commit": {"oid": "7268d9bb79821579cd29864a9f0811d13a6d4765"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a41dec99db76bed2f5ac65eae94315e07787cf95", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/a41dec99db76bed2f5ac65eae94315e07787cf95", "committedDate": "2021-01-09T06:29:15Z", "message": "Merge branch 'master' into 8918-show-rank-within-team"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1b9cc76b6a53f660249689702fa63812cd4860e", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/d1b9cc76b6a53f660249689702fa63812cd4860e", "committedDate": "2021-01-09T08:17:11Z", "message": "Add recipient type check for team rank calculation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "872a814073e853370df5c49442278f625a3ec9cd", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/872a814073e853370df5c49442278f625a3ec9cd", "committedDate": "2021-01-09T10:11:13Z", "message": "Trigger re-run of e2e tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fdaeecfe3bcb6cc5edcfd4ed9565cf4fd4d26c0", "author": {"user": {"login": "rrtheonlyone", "name": "Rahul Rajesh"}}, "url": "https://github.com/TEAMMATES/teammates/commit/7fdaeecfe3bcb6cc5edcfd4ed9565cf4fd4d26c0", "committedDate": "2021-01-17T14:08:41Z", "message": "Merge branch 'master' into 8918-show-rank-within-team"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcwMDY4ODY3", "url": "https://github.com/TEAMMATES/teammates/pull/10895#pullrequestreview-570068867", "createdAt": "2021-01-17T15:42:44Z", "commit": {"oid": "7fdaeecfe3bcb6cc5edcfd4ed9565cf4fd4d26c0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xN1QxNTo0Mjo0NVrOIVSyBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xN1QxNjowNDo0OVrOIVS89Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTE5ODcyNw==", "bodyText": "we can add more test cases here:\n\nteam rank not calculated depending on recipient type\ncheck team vs team excluding self is correct", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r559198727", "createdAt": "2021-01-17T15:42:45Z", "author": {"login": "rrtheonlyone"}, "path": "src/web/app/components/question-types/question-statistics/rank-recipients-question-statistics.component.spec.ts", "diffHunk": "@@ -24,4 +33,21 @@ describe('RankRecipientsQuestionStatisticsComponent', () => {\n   it('should create', () => {\n     expect(component).toBeTruthy();\n   });\n+\n+  it('should rank correctly within team', () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fdaeecfe3bcb6cc5edcfd4ed9565cf4fd4d26c0"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTIwMTUyNQ==", "bodyText": "the naming here is a little confusing - we are referring to recipient but the variable names all somehow say option.\nI think we might be able to streamline this entire statistic calculation with a combination of map, filter and reduce (in a functional manner without for loops).  However, this I leave it up to you: as long as it's readable I am okay.", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r559201525", "createdAt": "2021-01-17T16:04:49Z", "author": {"login": "rrtheonlyone"}, "path": "src/web/app/components/question-types/question-statistics/question-statistics-calculation/rank-recipients-question-statistics-calculation.ts", "diffHunk": "@@ -57,13 +66,26 @@ export class RankRecipientsQuestionStatisticsCalculation\n       if (!this.emailToName[identifier]) {\n         this.emailToName[identifier] = response.recipient;\n       }\n+\n+      optionsPerTeam[response.recipientTeam] = optionsPerTeam[response.recipientTeam] || [];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fdaeecfe3bcb6cc5edcfd4ed9565cf4fd4d26c0"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f63610b107152a644c241cc4609f5432ba387435", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/f63610b107152a644c241cc4609f5432ba387435", "committedDate": "2021-01-18T16:04:57Z", "message": "Add help page and declerative methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66813794a28b475c99e3a0b0d304d23f060aad19", "author": {"user": {"login": "rrtheonlyone", "name": "Rahul Rajesh"}}, "url": "https://github.com/TEAMMATES/teammates/commit/66813794a28b475c99e3a0b0d304d23f060aad19", "committedDate": "2021-02-07T11:26:58Z", "message": "Merge branch 'master' into 8918-show-rank-within-team"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "321239aa61b1e82975ac22374eb1b05fabe60e79", "author": {"user": {"login": "rrtheonlyone", "name": "Rahul Rajesh"}}, "url": "https://github.com/TEAMMATES/teammates/commit/321239aa61b1e82975ac22374eb1b05fabe60e79", "committedDate": "2021-02-21T15:38:43Z", "message": "Merge branch 'master' into 8918-show-rank-within-team"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTk0ODU0Mjg5", "url": "https://github.com/TEAMMATES/teammates/pull/10895#pullrequestreview-594854289", "createdAt": "2021-02-21T15:50:50Z", "commit": {"oid": "321239aa61b1e82975ac22374eb1b05fabe60e79"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTk0OTg2MTAx", "url": "https://github.com/TEAMMATES/teammates/pull/10895#pullrequestreview-594986101", "createdAt": "2021-02-22T03:23:28Z", "commit": {"oid": "321239aa61b1e82975ac22374eb1b05fabe60e79"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQwMzoyMzoyOFrOIpGGHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0yMlQwMzozNjoyNFrOIpGR7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTk2MjM5OQ==", "bodyText": "Shouldn't this be indented? But okay not a big deal since the lint check passes", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r579962399", "createdAt": "2021-02-22T03:23:28Z", "author": {"login": "madanalogy"}, "path": "src/web/app/components/question-types/question-statistics/rank-recipients-question-statistics.component.spec.ts", "diffHunk": "@@ -1,8 +1,17 @@\n import { async, ComponentFixture, TestBed } from '@angular/core/testing';\n-\n+import { FeedbackParticipantType, FeedbackRankRecipientsResponseDetails } from '../../../../types/api-output';\n import { SortableTableModule } from '../../sortable-table/sortable-table.module';\n+import { Response } from './question-statistics';\n import { RankRecipientsQuestionStatisticsComponent } from './rank-recipients-question-statistics.component';\n \n+/**\n+ * Loads data for testing.\n+ */\n+const loadTestData: (filename: string) => Response<FeedbackRankRecipientsResponseDetails>[] =\n+(filename: string): Response<FeedbackRankRecipientsResponseDetails>[] => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "321239aa61b1e82975ac22374eb1b05fabe60e79"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTk2MzA1MA==", "bodyText": "Brackets not needed", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r579963050", "createdAt": "2021-02-22T03:26:11Z", "author": {"login": "madanalogy"}, "path": "src/web/app/pages-help/instructor-help-page/instructor-help-questions-section/instructor-help-questions-section.component.html", "diffHunk": "@@ -658,6 +658,9 @@ <h4 *ngIf=\"displaySubsection(0, 10)\">Setting Up Questions</h4>\n       <li>\n         <b>Overall rank</b>: the recipient's rank relative to other recipients, as computed by TEAMMATES.\n       </li>\n+      <li>\n+        <b>Team rank</b>: the recipient's rank relative to other recipients within their own team only. (Applicable only if students rank their teammates)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "321239aa61b1e82975ac22374eb1b05fabe60e79"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTk2NDgyMA==", "bodyText": "Any particular reason why test data is stored in a separate file? I'm not entirely against the approach don't get me wrong, just that our frontend tests so far all have their data embedded in the spec.ts file so I'm wondering if you had any particular reason for the extraction of data.\nI can understand the extraction if the same data is being used by other test components but this doesn't seem to be the case. Would be better for now to just have the data as a constant variable as in other frontend tests for consistency (e.g. instructor-home-page.component.spec.ts)", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r579964820", "createdAt": "2021-02-22T03:33:44Z", "author": {"login": "madanalogy"}, "path": "src/web/app/components/question-types/question-statistics/rank-recipients-question-statistics.component.spec.ts", "diffHunk": "@@ -1,8 +1,17 @@\n import { async, ComponentFixture, TestBed } from '@angular/core/testing';\n-\n+import { FeedbackParticipantType, FeedbackRankRecipientsResponseDetails } from '../../../../types/api-output';\n import { SortableTableModule } from '../../sortable-table/sortable-table.module';\n+import { Response } from './question-statistics';\n import { RankRecipientsQuestionStatisticsComponent } from './rank-recipients-question-statistics.component';\n \n+/**\n+ * Loads data for testing.\n+ */\n+const loadTestData: (filename: string) => Response<FeedbackRankRecipientsResponseDetails>[] =\n+(filename: string): Response<FeedbackRankRecipientsResponseDetails>[] => {\n+  return require(`./test-data/${filename}`);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "321239aa61b1e82975ac22374eb1b05fabe60e79"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTk2NTM1NA==", "bodyText": "Typo in the sentence, I'm assuming the period at the end of \"team\" was unintended", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r579965354", "createdAt": "2021-02-22T03:36:03Z", "author": {"login": "madanalogy"}, "path": "src/web/app/pages-help/instructor-help-page/instructor-help-questions-section/instructor-help-questions-section.component.html", "diffHunk": "@@ -672,6 +675,12 @@ <h4 *ngIf=\"displaySubsection(0, 10)\">Setting Up Questions</h4>\n           The <b>Overall Rank</b> ranks the average rank each recipient receives.\n           For example, if recipient A received the ranks <code>(1, 2)</code> and recipient B received the ranks <code>(2, 4, 6)</code>, then recipient A and recipient B's average ranks are 1.5 and 4 respectively. By ranking these two averages, recipient A and B will get an <b>Overall Rank</b> of 1 and 2 respectively.\n         </li>\n+        <li>\n+          The <b>Team Rank</b> works in a similar way to <b>Overall Rank</b> as it uses the average rank received to calculate the rank within the team. to the average rank each recipient receives. However, the average rank of the members are only compared to their own team members.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "321239aa61b1e82975ac22374eb1b05fabe60e79"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3OTk2NTQyMg==", "bodyText": "Unnecessary starting And, can be removed", "url": "https://github.com/TEAMMATES/teammates/pull/10895#discussion_r579965422", "createdAt": "2021-02-22T03:36:24Z", "author": {"login": "madanalogy"}, "path": "src/web/app/pages-help/instructor-help-page/instructor-help-questions-section/instructor-help-questions-section.component.html", "diffHunk": "@@ -672,6 +675,12 @@ <h4 *ngIf=\"displaySubsection(0, 10)\">Setting Up Questions</h4>\n           The <b>Overall Rank</b> ranks the average rank each recipient receives.\n           For example, if recipient A received the ranks <code>(1, 2)</code> and recipient B received the ranks <code>(2, 4, 6)</code>, then recipient A and recipient B's average ranks are 1.5 and 4 respectively. By ranking these two averages, recipient A and B will get an <b>Overall Rank</b> of 1 and 2 respectively.\n         </li>\n+        <li>\n+          The <b>Team Rank</b> works in a similar way to <b>Overall Rank</b> as it uses the average rank received to calculate the rank within the team. to the average rank each recipient receives. However, the average rank of the members are only compared to their own team members.\n+          For example, if recipient A (who is a part of team X) received the ranks <code>(1, 2)</code> and recipient B (who is a part of team X) received the ranks <code>(2, 4, 6)</code>, then recipient A and recipient B's average ranks are 1.5 and 4 respectively. By ranking these two averages, recipient A and B will get a <b>Team Rank</b> of 1 and 2 respectively.\n+          And if recipient C (who is a part of team Y) received the ranks <code>(1, 1)</code> and recipient D (who is a part of team Y) received the ranks <code>(1, 2)</code>, then recipient C and recipient D's average ranks are 1 and 1.5 respectively. By ranking these two averages, recipient C and D will get a <b>Team Rank</b> of 1 and 2 respectively.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "321239aa61b1e82975ac22374eb1b05fabe60e79"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbd59f8168e2416d836ce3a4c4481da15c534062", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/dbd59f8168e2416d836ce3a4c4481da15c534062", "committedDate": "2021-02-22T11:17:51Z", "message": "Move test-data from json into spec.ts file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTk1MjQ5MTY4", "url": "https://github.com/TEAMMATES/teammates/pull/10895#pullrequestreview-595249168", "createdAt": "2021-02-22T11:23:17Z", "commit": {"oid": "dbd59f8168e2416d836ce3a4c4481da15c534062"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9bc1999ef895c392d9fd7abee382ffc2bc4d903", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/e9bc1999ef895c392d9fd7abee382ffc2bc4d903", "committedDate": "2021-02-22T11:23:59Z", "message": "Merge branch 'master' into 8918-show-rank-within-team"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4184, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}