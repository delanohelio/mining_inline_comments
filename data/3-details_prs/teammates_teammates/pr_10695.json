{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgwODc5ODEw", "number": 10695, "title": "[#10691] Weighted rubric question missing statistics ", "bodyText": "Fixes #10691\nPR Checklist\nOutline of Solution\n\nfill up allResponses field in SessionResultsData for students as well\nadd team info for all responses instead of only when student is the giver and/or recipient\nuse allResponses instead of responsesToSelf for calculating statistics. This makes it more flexible as we can choose which responses to filter.\nfilter responses for previous statistics that used responsesToSelf\n\nScreenshot:", "createdAt": "2020-09-06T20:13:08Z", "url": "https://github.com/TEAMMATES/teammates/pull/10695", "merged": true, "mergeCommit": {"oid": "143ab3c640c109a7699b1024e9a85f368795ad5d"}, "closed": true, "closedAt": "2020-10-30T01:59:07Z", "author": {"login": "jtankw3"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGO1rcgH2gAyNDgwODc5ODEwOjI1MDRkYjMyN2I1MDI1OWFiNjJmYzQ0NWFhNjFiNTc5ZDA5ZTYwNDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXLCgNgH2gAyNDgwODc5ODEwOmM5YzM1ZjI5NmI0ZGNjZWExMWE1OGJjOGM1ZDAzOGYyNTk0ODIxMGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2504db327b50259ab62fc445aa61b579d09e6042", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/2504db327b50259ab62fc445aa61b579d09e6042", "committedDate": "2020-09-06T13:58:05Z", "message": "Fix student result page rubric statistics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68322e88937c14153d3976503031fc4dbb868c9c", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/68322e88937c14153d3976503031fc4dbb868c9c", "committedDate": "2020-09-06T20:05:20Z", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into fix-rubric-statistics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjE0MjA0", "url": "https://github.com/TEAMMATES/teammates/pull/10695#pullrequestreview-489214204", "createdAt": "2020-09-16T01:36:05Z", "commit": {"oid": "68322e88937c14153d3976503031fc4dbb868c9c"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMTozNjowNVrOHSc41A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMTo0MTo1MFrOHSc-xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwOTcxNg==", "bodyText": "This might need some reviews as it might leak information", "url": "https://github.com/TEAMMATES/teammates/pull/10695#discussion_r489109716", "createdAt": "2020-09-16T01:36:05Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/output/SessionResultsData.java", "diffHunk": "@@ -144,15 +147,14 @@ private static ResponseOutput buildSingleResponseForStudent(\n         } else {\n             // we don't want student to figure out who is who by using the hash\n             recipientName = removeAnonymousHash(getRecipientNameOfResponse(response, bundle).getName());\n+            recipientTeam = bundle.getRoster().getInfoForIdentifier(response.getRecipient()).getTeamName();\n         }\n \n         // process comments\n         List<FeedbackResponseCommentAttributes> feedbackResponseComments =\n                 bundle.getResponseCommentsMap().getOrDefault(response.getId(), Collections.emptyList());\n         Queue<CommentOutput> comments = buildComments(feedbackResponseComments, bundle);\n \n-        // Student does not need to know the teams for giver and/or recipient\n-        // unless the student him/herself is the giver and/or recipient", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68322e88937c14153d3976503031fc4dbb868c9c"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTExMTA0OA==", "bodyText": "I don't think the filtering should happen here as the statistics component's responsibility is just display stats based on provided responses. It essentially should not do the filtering.", "url": "https://github.com/TEAMMATES/teammates/pull/10695#discussion_r489111048", "createdAt": "2020-09-16T01:41:13Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-types/question-statistics/num-scale-question-statistics.component.ts", "diffHunk": "@@ -48,6 +48,9 @@ export class NumScaleQuestionStatisticsComponent extends NumScaleQuestionStatist\n     this.rowsData = [];\n     for (const team of Object.keys(this.teamToRecipientToScores)) {\n       for (const recipient of Object.keys(this.teamToRecipientToScores[team])) {\n+        if (this.isStudent && recipient !== 'You') {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68322e88937c14153d3976503031fc4dbb868c9c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTExMTIzNg==", "bodyText": "At least the filtering should happen here.", "url": "https://github.com/TEAMMATES/teammates/pull/10695#discussion_r489111236", "createdAt": "2020-09-16T01:41:50Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-session/session-result-page/session-result-page.component.html", "diffHunk": "@@ -41,7 +41,7 @@ <h1>\n       <div class=\"card-body\">\n         <tm-question-text-with-info [questionNumber]=\"question.feedbackQuestion.questionNumber\" [questionDetails]=\"question.feedbackQuestion.questionDetails\" class=\"question-text\"></tm-question-text-with-info>\n         <tm-single-statistics [question]=\"question.feedbackQuestion.questionDetails\"\n-                              [responses]=\"question.responsesToSelf\"\n+                              [responses]=\"question.allResponses\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68322e88937c14153d3976503031fc4dbb868c9c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c85d9e3a29aa9ec88c99a87de13de7353bb52b8", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/7c85d9e3a29aa9ec88c99a87de13de7353bb52b8", "committedDate": "2020-10-03T06:24:01Z", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into fix-rubric-statistics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5586075d01523aa9bd10a5b6ff03090c306ef8d", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/a5586075d01523aa9bd10a5b6ff03090c306ef8d", "committedDate": "2020-10-03T08:23:04Z", "message": "Add anonymous check for team name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d938369740ee006f9ceb98344d22696019d60ee1", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/d938369740ee006f9ceb98344d22696019d60ee1", "committedDate": "2020-10-03T08:38:18Z", "message": "Shift filtering of responses to single-statistic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d94e3a103f434e3d0067316682d723f4d1492227", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/d94e3a103f434e3d0067316682d723f4d1492227", "committedDate": "2020-10-03T08:40:07Z", "message": "Clean up boolean condition for rubric calculation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "989998cfe023952ddb6910f839d99e6c22e6350f", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/989998cfe023952ddb6910f839d99e6c22e6350f", "committedDate": "2020-10-03T09:21:49Z", "message": "Use empty string instead of null of team names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5Mjk2ODc0", "url": "https://github.com/TEAMMATES/teammates/pull/10695#pullrequestreview-519296874", "createdAt": "2020-10-29T02:59:23Z", "commit": {"oid": "989998cfe023952ddb6910f839d99e6c22e6350f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMjo1OToyNFrOHqGHbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMjo1OToyNFrOHqGHbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzkwMjQ0Nw==", "bodyText": "Let me just confirm @damithc\nIs is ok to show team name when the name of student is visible?", "url": "https://github.com/TEAMMATES/teammates/pull/10695#discussion_r513902447", "createdAt": "2020-10-29T02:59:24Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/output/SessionResultsData.java", "diffHunk": "@@ -144,15 +146,16 @@ private static ResponseOutput buildSingleResponseForStudent(\n         } else {\n             // we don't want student to figure out who is who by using the hash\n             recipientName = removeAnonymousHash(getRecipientNameOfResponse(response, bundle).getName());\n+            if (!recipientName.contains(Const.DISPLAYED_NAME_FOR_ANONYMOUS_PARTICIPANT)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "989998cfe023952ddb6910f839d99e6c22e6350f"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9c35f296b4dccea11a58bc8c5d038f25948210a", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/c9c35f296b4dccea11a58bc8c5d038f25948210a", "committedDate": "2020-10-29T05:09:11Z", "message": "Merge branch 'master' into fix-rubric-statistics"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4259, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}