{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUxMDg5Nzg4", "number": 10327, "title": "[#10325] Google blocking E2E login on production server ", "bodyText": "Fixes #10325\nBypass google block by logging in manually and using that user data to run automated test.\nThus, we can skip over the login page as user is already logged in.\nHowever, this only allows one test to be run at a time on Chrome due to 'user data directory is already in use' error.\nOutline of Solution\n\nAdd firefox profile or chrome user data folders to webdriver to include user data in test.", "createdAt": "2020-07-17T12:27:53Z", "url": "https://github.com/TEAMMATES/teammates/pull/10327", "merged": true, "mergeCommit": {"oid": "c57408f7195be8c785b5aea8da2e276d22f7654e"}, "closed": true, "closedAt": "2020-07-21T14:59:31Z", "author": {"login": "jtankw3"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1y5N0gH2gAyNDUxMDg5Nzg4OjIyMGQyYzU5ZTViZjk2YzM4NzU4NWIyZjM1YzhmYmEzNjMyNTQ4OTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3Fa-DAH2gAyNDUxMDg5Nzg4OjRhZjk3ZGRkZmZjYzE0ZGIzZWZkYTZiOTdkODYyZWIxOWFlOTU0NmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "220d2c59e5bf96c387585b2f35c8fba363254894", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/220d2c59e5bf96c387585b2f35c8fba363254894", "committedDate": "2020-07-17T12:21:49Z", "message": "Add user data to webdriver to enable manual log in"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNjYzMTQy", "url": "https://github.com/TEAMMATES/teammates/pull/10327#pullrequestreview-450663142", "createdAt": "2020-07-17T13:36:39Z", "commit": {"oid": "220d2c59e5bf96c387585b2f35c8fba363254894"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMDg1NzI3", "url": "https://github.com/TEAMMATES/teammates/pull/10327#pullrequestreview-451085727", "createdAt": "2020-07-18T22:25:10Z", "commit": {"oid": "220d2c59e5bf96c387585b2f35c8fba363254894"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQyMjoyNToxMFrOGzq7OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOFQyMjoyNzo0NFrOGzq76g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMzg0OA==", "bodyText": "Will this result in NPE?", "url": "https://github.com/TEAMMATES/teammates/pull/10327#discussion_r456833848", "createdAt": "2020-07-18T22:25:10Z", "author": {"login": "xpdavid"}, "path": "src/e2e/java/teammates/e2e/cases/e2e/BaseE2ETestCase.java", "diffHunk": "@@ -82,6 +82,12 @@ protected static Url createLocalUrl(String testFileName) throws IOException {\n      * Logs in a page using admin credentials (i.e. in masquerade mode).\n      */\n     protected <T extends AppPage> T loginAdminToPage(AppUrl url, Class<T> typeOfPage) {\n+        // When not using dev server, Google blocks log in by automation.\n+        // To log in, log in manually to teammates in your browser before running e2e tests.\n+        // Refer to teammates.e2e.pageobjects.Browser for more information.\n+        if (!TestProperties.isDevServer()) {\n+            return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "220d2c59e5bf96c387585b2f35c8fba363254894"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMzkwMQ==", "bodyText": "We should also delete code for google login?", "url": "https://github.com/TEAMMATES/teammates/pull/10327#discussion_r456833901", "createdAt": "2020-07-18T22:25:53Z", "author": {"login": "xpdavid"}, "path": "src/e2e/java/teammates/e2e/cases/e2e/BaseE2ETestCase.java", "diffHunk": "@@ -82,6 +82,12 @@ protected static Url createLocalUrl(String testFileName) throws IOException {\n      * Logs in a page using admin credentials (i.e. in masquerade mode).\n      */\n     protected <T extends AppPage> T loginAdminToPage(AppUrl url, Class<T> typeOfPage) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "220d2c59e5bf96c387585b2f35c8fba363254894"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMzkyOQ==", "bodyText": "I think we should do check the existing of the profile here. It's more user friendly.", "url": "https://github.com/TEAMMATES/teammates/pull/10327#discussion_r456833929", "createdAt": "2020-07-18T22:26:23Z", "author": {"login": "xpdavid"}, "path": "src/e2e/java/teammates/e2e/pageobjects/Browser.java", "diffHunk": "@@ -126,10 +127,19 @@ private WebDriver createWebDriver() {\n             }\n             System.setProperty(\"webdriver.gecko.driver\", TestProperties.GECKODRIVER_PATH);\n \n+            FirefoxProfile profile;\n+            if (TestProperties.isDevServer()) {\n+                profile = new FirefoxProfile();\n+            } else {\n+                // Get user data from browser to bypass google blocking automated log in.\n+                // Log in manually to teammates to use that log in data for e2e tests.\n+                ProfilesIni profileIni = new ProfilesIni();\n+                profile = profileIni.getProfile(TestProperties.FIREFOX_PROFILE_NAME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "220d2c59e5bf96c387585b2f35c8fba363254894"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzMzk0Mw==", "bodyText": "Same here.", "url": "https://github.com/TEAMMATES/teammates/pull/10327#discussion_r456833943", "createdAt": "2020-07-18T22:26:31Z", "author": {"login": "xpdavid"}, "path": "src/e2e/java/teammates/e2e/pageobjects/Browser.java", "diffHunk": "@@ -146,6 +156,12 @@ private WebDriver createWebDriver() {\n \n             ChromeOptions options = new ChromeOptions();\n             options.addArguments(\"--allow-file-access-from-files\");\n+            if (!TestProperties.isDevServer()) {\n+                // Get user data from browser to bypass google blocking automated log in.\n+                // Log in manually to teammates to use that log in data for e2e tests.\n+                options.addArguments(\"user-data-dir=\" + TestProperties.CHROME_USER_DATA_PATH);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "220d2c59e5bf96c387585b2f35c8fba363254894"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjgzNDAyNg==", "bodyText": "I think it is more appropriate to throw exception with this message (and result in test fail). It is more explicit than a random NPE error where we need to trace down it to this line.", "url": "https://github.com/TEAMMATES/teammates/pull/10327#discussion_r456834026", "createdAt": "2020-07-18T22:27:44Z", "author": {"login": "xpdavid"}, "path": "src/e2e/java/teammates/e2e/cases/e2e/BaseE2ETestCase.java", "diffHunk": "@@ -82,6 +82,12 @@ protected static Url createLocalUrl(String testFileName) throws IOException {\n      * Logs in a page using admin credentials (i.e. in masquerade mode).\n      */\n     protected <T extends AppPage> T loginAdminToPage(AppUrl url, Class<T> typeOfPage) {\n+        // When not using dev server, Google blocks log in by automation.\n+        // To log in, log in manually to teammates in your browser before running e2e tests.\n+        // Refer to teammates.e2e.pageobjects.Browser for more information.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "220d2c59e5bf96c387585b2f35c8fba363254894"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b99167c4ec6d23ea7c9834772d89b80df8b8f49e", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/b99167c4ec6d23ea7c9834772d89b80df8b8f49e", "committedDate": "2020-07-19T08:01:21Z", "message": "Fix redirection after loginAdminToPage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1771668aa12518768b5d34ddd496afd702e2ef6f", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/1771668aa12518768b5d34ddd496afd702e2ef6f", "committedDate": "2020-07-19T08:17:32Z", "message": "Remove code for google log in"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6edf8b8b2c060b728aa8d254541ff38296636d9c", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/6edf8b8b2c060b728aa8d254541ff38296636d9c", "committedDate": "2020-07-19T08:55:54Z", "message": "Add check for profile existence"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86e404e808154654ed32702baad269d9d2a30a29", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/86e404e808154654ed32702baad269d9d2a30a29", "committedDate": "2020-07-19T08:56:03Z", "message": "Fix lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "596b46044196bfb20ebf149a06535727fdbba1cb", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/596b46044196bfb20ebf149a06535727fdbba1cb", "committedDate": "2020-07-19T08:56:56Z", "message": "Merge branch 'master' into production-server-e2e"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMDg3MTQw", "url": "https://github.com/TEAMMATES/teammates/pull/10327#pullrequestreview-452087140", "createdAt": "2020-07-21T02:41:45Z", "commit": {"oid": "596b46044196bfb20ebf149a06535727fdbba1cb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwMjo0MTo0NVrOG0mC4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwMjo0MTo0NVrOG0mC4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgwMjQ2Nw==", "bodyText": "Actually this entire page can be deleted", "url": "https://github.com/TEAMMATES/teammates/pull/10327#discussion_r457802467", "createdAt": "2020-07-21T02:41:45Z", "author": {"login": "xpdavid"}, "path": "src/e2e/java/teammates/e2e/pageobjects/GoogleLoginPage.java", "diffHunk": "@@ -1,38 +1,15 @@\n package teammates.e2e.pageobjects;\n \n-import org.openqa.selenium.By;\n-import org.openqa.selenium.NoSuchElementException;\n-import org.openqa.selenium.WebElement;\n-import org.openqa.selenium.support.FindBy;\n-import org.openqa.selenium.support.ui.ExpectedConditions;\n-\n-import com.google.common.base.Preconditions;\n-\n-import teammates.e2e.util.TestProperties;\n-\n /**\n  * Page Object Model for the official Google Accounts login page.\n  */\n public class GoogleLoginPage extends LoginPage {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "596b46044196bfb20ebf149a06535727fdbba1cb"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMzM5ODQ1", "url": "https://github.com/TEAMMATES/teammates/pull/10327#pullrequestreview-452339845", "createdAt": "2020-07-21T10:49:12Z", "commit": {"oid": "596b46044196bfb20ebf149a06535727fdbba1cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4af97dddffcc14db3efda6b97d862eb19ae9546d", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/4af97dddffcc14db3efda6b97d862eb19ae9546d", "committedDate": "2020-07-21T12:30:54Z", "message": "Merge branch 'master' into production-server-e2e"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4298, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}