{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzNzAzMjYz", "number": 10732, "title": "[#9536] Reduce E2E tests flakiness due to underlying test structure", "bodyText": "Part of #9536\nThis aims to reduce the flakiness of E2E tests due to the underlying test structure.\n\nRemove BrowserPool usage. Previously, as UI tests are a part of developer's routine, it was thought that this can save some time/memory resource as starting up browser takes a long time. Since then: (1) Selenium has evolved such that the time is not that long, (2) E2E tests are made optional and only to be run sparingly, (3) our need to have fresh browser for each test has been increasing. All of them warrant to stop the usage of BrowserPool.\n\nAdd a flag to indicate whether the browser is to be closed after failed test run. Useful for local debugging. Successful test run will always close the browser as there is no point in keeping it open.\n\n\nRun each test in incognito to ensure fresh starting state.\n(Important!) Disable Angular service worker for the app used in E2E test. It turns out that this is a major aggravating factor as failed Angular chunk loading will be persisted if service worker is used.\n\nAlso:\n\nTimeout is reduced to 10 (for page loads) as this is sufficient. There are many runs that show that even 5 is sufficient, but 10 is the safer number. For other purposes, 5 is already sufficient.\nApply afterTestClosure after every run. Previously this was not done due to God mode (old term for snapshot testing) being part of UI tests, whereby failed HTML comparison will easily fill up the entire logs if repeated 3-4 times. Now that snapshot testing has been moved out, the afterTestClosure is safe to apply after every test run and can capture different causes of intermittent failures in different runs.\nAdd one test retry as a last safety net.", "createdAt": "2020-09-27T10:34:17Z", "url": "https://github.com/TEAMMATES/teammates/pull/10732", "merged": true, "mergeCommit": {"oid": "5bbb5aa59e834071c7e993940dbc9e58564dcbf0"}, "closed": true, "closedAt": "2020-09-29T10:02:14Z", "author": {"login": "wkurniawan07"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMyE_jAH2gAyNDkzNzAzMjYzOmM1M2Y4OGJhNDdkYjQ3NzUzNDg0OWM5N2M3YTIzY2Q3OGQ5MTUzNmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNin8RgFqTQ5ODE0NDk0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c53f88ba47db477534849c97c7a23cd78d91536b", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/c53f88ba47db477534849c97c7a23cd78d91536b", "committedDate": "2020-09-26T22:25:02Z", "message": "Reduce timeout setting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6160c05d794f93e5b156718faa49e58667bdebc", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/a6160c05d794f93e5b156718faa49e58667bdebc", "committedDate": "2020-09-26T22:25:22Z", "message": "Apply afterTestClosure after every E2E test run"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23a3e48dac0f210d502854c46eb124474bf4611f", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/23a3e48dac0f210d502854c46eb124474bf4611f", "committedDate": "2020-09-26T22:25:46Z", "message": "Remove usage of BrowserPool"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a3da4549f279de077e263819da383ac9782e6e2", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/3a3da4549f279de077e263819da383ac9782e6e2", "committedDate": "2020-09-26T22:56:25Z", "message": "Add incognito mode for browsers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b20940679f5eeffbfe44528c1306dc3c3fe0f70c", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/b20940679f5eeffbfe44528c1306dc3c3fe0f70c", "committedDate": "2020-09-26T22:56:25Z", "message": "Remove deleteAllCookies"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MzAwODc2", "url": "https://github.com/TEAMMATES/teammates/pull/10732#pullrequestreview-497300876", "createdAt": "2020-09-28T08:40:41Z", "commit": {"oid": "b20940679f5eeffbfe44528c1306dc3c3fe0f70c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaa317ef155685da1976258a97f4759f623e1bf0", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/aaa317ef155685da1976258a97f4759f623e1bf0", "committedDate": "2020-09-28T09:58:11Z", "message": "Add flag to indicate whether to close browser after test run"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c91c7db392993c2ec9a3e2638aa52d7561287ca2", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/c91c7db392993c2ec9a3e2638aa52d7561287ca2", "committedDate": "2020-09-28T19:30:27Z", "message": "Modify timeout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9de5a14f0512e5c38841f7923f3b5a989edc32ca", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/9de5a14f0512e5c38841f7923f3b5a989edc32ca", "committedDate": "2020-09-28T19:32:00Z", "message": "Disable service worker for E2E tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66476196bb8487c521daa163de92a7791a9de8ca", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/66476196bb8487c521daa163de92a7791a9de8ca", "committedDate": "2020-09-28T19:34:53Z", "message": "Add one more test retry"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ba9762b67727824b41d97ed458e0d9994a5f995", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/9ba9762b67727824b41d97ed458e0d9994a5f995", "committedDate": "2020-09-28T13:11:14Z", "message": "Replace reloadPage with hard refresh"}, "afterCommit": {"oid": "66476196bb8487c521daa163de92a7791a9de8ca", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/66476196bb8487c521daa163de92a7791a9de8ca", "committedDate": "2020-09-28T19:34:53Z", "message": "Add one more test retry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4MTQ0OTQy", "url": "https://github.com/TEAMMATES/teammates/pull/10732#pullrequestreview-498144942", "createdAt": "2020-09-29T06:54:21Z", "commit": {"oid": "66476196bb8487c521daa163de92a7791a9de8ca"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNjo1NDoyMVrOHZdYmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQwNjo1NDoyMVrOHZdYmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ1Nzg4MA==", "bodyText": "I believe this is by default false so I am not very sure if it is needed here?", "url": "https://github.com/TEAMMATES/teammates/pull/10732#discussion_r496457880", "createdAt": "2020-09-29T06:54:21Z", "author": {"login": "jtankw3"}, "path": ".travis.yml", "diffHunk": "@@ -77,7 +77,7 @@ jobs:\n         - mv src/e2e/resources/test.travis.properties src/e2e/resources/test.properties\n         - ./gradlew createConfigs testClasses generateTypes\n         - npm ci\n-        - npm run build -- --progress=false\n+        - npm run build -- --progress=false --serviceWorker=false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66476196bb8487c521daa163de92a7791a9de8ca"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4188, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}