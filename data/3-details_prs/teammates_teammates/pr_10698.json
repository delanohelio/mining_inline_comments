{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxMDYzMDE1", "number": 10698, "title": "[#10697] Performance improvements when getting session result as students", "bodyText": "Fixes #10697\nOutline of Solution\nCopy logic from V6 to proactively fetch the viewable response.\nTested for \"Session with different question types\" and unit tests cover most of the cases (see line coverage)", "createdAt": "2020-09-07T05:37:03Z", "url": "https://github.com/TEAMMATES/teammates/pull/10698", "merged": true, "mergeCommit": {"oid": "fdcfc9f00e50a4b0e97ef235b7d8d0ad4568fa6c"}, "closed": true, "closedAt": "2020-09-07T10:56:07Z", "author": {"login": "xpdavid"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGcJ7ZAH2gAyNDgxMDYzMDE1OjRlYWUyYmYxMDI0NWZmNzJjNWViMWExYzQ1NDkwYWIxNjg2NTdjNjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdGgtCQAFqTQ4MzM5MjQ5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4eae2bf10245ff72c5eb1a1c45490ab168657c69", "author": {"user": {"login": "xpdavid", "name": "Xiao Pu"}}, "url": "https://github.com/TEAMMATES/teammates/commit/4eae2bf10245ff72c5eb1a1c45490ab168657c69", "committedDate": "2020-09-07T05:28:58Z", "message": "proactively fetch viewable responses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNDEwNTY1", "url": "https://github.com/TEAMMATES/teammates/pull/10698#pullrequestreview-483410565", "createdAt": "2020-09-07T09:40:15Z", "commit": {"oid": "4eae2bf10245ff72c5eb1a1c45490ab168657c69"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMzkyNDkx", "url": "https://github.com/TEAMMATES/teammates/pull/10698#pullrequestreview-483392491", "createdAt": "2020-09-07T09:15:58Z", "commit": {"oid": "4eae2bf10245ff72c5eb1a1c45490ab168657c69"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwOToxNTo1OFrOHN3eiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwOToxNTo1OFrOHN3eiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMwMjQ3Mg==", "bodyText": "This is more likely than not user error so it should not return any 500-resulting exception (like this one)", "url": "https://github.com/TEAMMATES/teammates/pull/10698#discussion_r484302472", "createdAt": "2020-09-07T09:15:58Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/logic/core/FeedbackSessionsLogic.java", "diffHunk": "@@ -654,11 +652,27 @@ public SessionResultsBundle getSessionResultsForUser(\n         }\n \n         // load response(s)\n+        StudentAttributes student = getStudent(courseId, userEmail, role);\n         List<FeedbackResponseAttributes> allResponses;\n-        if (questionId == null) {\n-            allResponses = frLogic.getFeedbackResponsesForSessionInSection(feedbackSessionName, courseId, section);\n+        if (isInstructor(role)) {\n+            // load all response for instructors and passively filter them later\n+            if (questionId == null) {\n+                allResponses = frLogic.getFeedbackResponsesForSessionInSection(feedbackSessionName, courseId, section);\n+            } else {\n+                allResponses = frLogic.getFeedbackResponsesForQuestionInSection(questionId, section);\n+            }\n         } else {\n-            allResponses = frLogic.getFeedbackResponsesForQuestionInSection(questionId, section);\n+            if (section != null) {\n+                throw new UnsupportedOperationException(\"Specify section filtering is not supported for student result\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4eae2bf10245ff72c5eb1a1c45490ab168657c69"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4261, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}