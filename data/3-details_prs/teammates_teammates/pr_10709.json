{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2MTg4MjI2", "number": 10709, "title": "[#10315] Refactor search result for instructor search", "bodyText": "Fixes #10315\nOutline of Solution\nCreated an interface SearchResult as a generic type for search functions that stores an any type searchResult field. All the raw search result data will be passed in, and will be processed in the module using the search result.\nThe developer is to ensure that the type passed in matches the type needed in the other modules. (would defensive programming needed here? Type validation with exception when type mismatch happens?)\n@t-cheepeng\nWould there be a need to wrap the rest of the result types into this as well? Else, the name should be less generic than SearchResult.", "createdAt": "2020-09-13T14:15:22Z", "url": "https://github.com/TEAMMATES/teammates/pull/10709", "merged": true, "mergeCommit": {"oid": "1c2b94d63a7be533d96e149223c0f4368bcea1cd"}, "closed": true, "closedAt": "2020-10-03T03:19:57Z", "author": {"login": "moziliar"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJSKE1gFqTQ4OTIxMjUyMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOoE24gH2gAyNDg2MTg4MjI2OjA5M2Y5ODA5MzQxZTA2Zjk2NmQxNTc2MjNkNTg1OWViMDNhMGY4MmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjEyNTIw", "url": "https://github.com/TEAMMATES/teammates/pull/10709#pullrequestreview-489212520", "createdAt": "2020-09-16T01:30:17Z", "commit": {"oid": "121c3c39e77be366ddc759c654c0949c7da3c5b3"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMTozMDoxN1rOHScywA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMTozMTo0OVrOHSc0VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODE2MA==", "bodyText": "But right now we loss the type information by doing this?", "url": "https://github.com/TEAMMATES/teammates/pull/10709#discussion_r489108160", "createdAt": "2020-09-16T01:30:17Z", "author": {"login": "xpdavid"}, "path": "src/web/services/search.service.ts", "diffHunk": "@@ -473,11 +459,10 @@ export class SearchService {\n }\n \n /**\n- * The typings for the response object returned by the instructor search service.\n+ * Generic search result type.\n  */\n-export interface InstructorSearchResult {\n-  searchStudentsTables: SearchStudentsListRowTable[];\n-  searchCommentsTables: SearchCommentsTable[];\n+export interface SearchResult {\n+  searchResult: any;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "121c3c39e77be366ddc759c654c0949c7da3c5b3"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODUxNA==", "bodyText": "Why can't this just be comments: CommentSearchResult[]?", "url": "https://github.com/TEAMMATES/teammates/pull/10709#discussion_r489108514", "createdAt": "2020-09-16T01:31:43Z", "author": {"login": "xpdavid"}, "path": "src/web/services/search.service.ts", "diffHunk": "@@ -473,11 +459,10 @@ export class SearchService {\n }\n \n /**\n- * The typings for the response object returned by the instructor search service.\n+ * Generic search result type.\n  */\n-export interface InstructorSearchResult {\n-  searchStudentsTables: SearchStudentsListRowTable[];\n-  searchCommentsTables: SearchCommentsTable[];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "121c3c39e77be366ddc759c654c0949c7da3c5b3"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEwODU2NQ==", "bodyText": "And similar here", "url": "https://github.com/TEAMMATES/teammates/pull/10709#discussion_r489108565", "createdAt": "2020-09-16T01:31:49Z", "author": {"login": "xpdavid"}, "path": "src/web/services/search.service.ts", "diffHunk": "@@ -473,11 +459,10 @@ export class SearchService {\n }\n \n /**\n- * The typings for the response object returned by the instructor search service.\n+ * Generic search result type.\n  */\n-export interface InstructorSearchResult {\n-  searchStudentsTables: SearchStudentsListRowTable[];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "121c3c39e77be366ddc759c654c0949c7da3c5b3"}, "originalPosition": 84}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "121c3c39e77be366ddc759c654c0949c7da3c5b3", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/121c3c39e77be366ddc759c654c0949c7da3c5b3", "committedDate": "2020-09-13T14:11:12Z", "message": "Refactor search result for instructor search"}, "afterCommit": {"oid": "b6c932272f44001e515b7ecb2303c432374f655e", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/b6c932272f44001e515b7ecb2303c432374f655e", "committedDate": "2020-09-16T03:10:18Z", "message": "Refactor search result for instructor search"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMzY2NTk1", "url": "https://github.com/TEAMMATES/teammates/pull/10709#pullrequestreview-490366595", "createdAt": "2020-09-17T08:35:55Z", "commit": {"oid": "b6c932272f44001e515b7ecb2303c432374f655e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwODozNTo1NVrOHTXd-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwODozOTowMlrOHTXlog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA2OTQ5OA==", "bodyText": "unnecessary changes? u can disable angular analytics globally with  ng analytics off so you don't get these changes", "url": "https://github.com/TEAMMATES/teammates/pull/10709#discussion_r490069498", "createdAt": "2020-09-17T08:35:55Z", "author": {"login": "t-cheepeng"}, "path": "angular.json", "diffHunk": "@@ -158,5 +158,8 @@\n       }\n     }\n   },\n-  \"defaultProject\": \"teammates\"\n-}\n+  \"defaultProject\": \"teammates\",\n+  \"cli\": {\n+    \"analytics\": false\n+  }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6c932272f44001e515b7ecb2303c432374f655e"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA3MTQ1OA==", "bodyText": "\ud83d\udc4d . Yup this is what we were looking for with the refactoring!", "url": "https://github.com/TEAMMATES/teammates/pull/10709#discussion_r490071458", "createdAt": "2020-09-17T08:39:02Z", "author": {"login": "t-cheepeng"}, "path": "src/web/app/pages-instructor/instructor-search-page/instructor-search-page.component.ts", "diffHunk": "@@ -84,4 +106,85 @@ export class InstructorSearchPageComponent implements OnInit {\n       this.statusMessageService.showErrorToast(resp.error.message);\n     });\n   }\n+\n+  private getSearchCommentsTable(searchResults: CommentSearchResult[]): SearchCommentsTable[] {\n+    return searchResults.map((res: CommentSearchResult) => ({\n+      feedbackSession: res.feedbackSession,\n+      questions: res.questions,\n+    }));\n+  }\n+\n+  private getCoursesWithStudents(students: Student[]): SearchStudentsListRowTable[] {\n+    const distinctCourses: string[] = Array.from(\n+        new Set(students.map((s: Student) => s.courseId)),\n+    );\n+    const coursesWithStudents: SearchStudentsListRowTable[] = distinctCourses.map(\n+        (courseId: string) => ({\n+          courseId,\n+          students: Array.from(\n+              new Set(\n+                  students\n+                      .filter((s: Student) => s.courseId === courseId),\n+              ),\n+          ).map((s: Student) => ({", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6c932272f44001e515b7ecb2303c432374f655e"}, "originalPosition": 82}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b6c932272f44001e515b7ecb2303c432374f655e", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/b6c932272f44001e515b7ecb2303c432374f655e", "committedDate": "2020-09-16T03:10:18Z", "message": "Refactor search result for instructor search"}, "afterCommit": {"oid": "376a294384aabca062246221dd08a4c213652b2d", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/376a294384aabca062246221dd08a4c213652b2d", "committedDate": "2020-09-17T08:44:04Z", "message": "Refactor search result for instructor search"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1e5e018ac561040e54aa8ed12621534dc1621f2", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/f1e5e018ac561040e54aa8ed12621534dc1621f2", "committedDate": "2020-09-18T02:04:24Z", "message": "Migrate tests to instructor search component from search service"}, "afterCommit": {"oid": "92b780d15582f09c419bce79e16783e9bc02c900", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/92b780d15582f09c419bce79e16783e9bc02c900", "committedDate": "2020-09-18T04:07:13Z", "message": "Migrate tests to instructor search component from search service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71d6e6ac9ca4e660c3804f0b1d61feda93ad9fb2", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/71d6e6ac9ca4e660c3804f0b1d61feda93ad9fb2", "committedDate": "2020-09-19T09:59:23Z", "message": "Refactor search result for instructor search"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ac12a8c69ae8b37f14696a9065b1e83fd2f5735", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/5ac12a8c69ae8b37f14696a9065b1e83fd2f5735", "committedDate": "2020-09-19T09:59:23Z", "message": "Migrate tests to instructor search component from search service"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "92b780d15582f09c419bce79e16783e9bc02c900", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/92b780d15582f09c419bce79e16783e9bc02c900", "committedDate": "2020-09-18T04:07:13Z", "message": "Migrate tests to instructor search component from search service"}, "afterCommit": {"oid": "5ac12a8c69ae8b37f14696a9065b1e83fd2f5735", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/5ac12a8c69ae8b37f14696a9065b1e83fd2f5735", "committedDate": "2020-09-19T09:59:23Z", "message": "Migrate tests to instructor search component from search service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84ccac6f84e238bff1c9bae3d36037dd99ddc265", "author": {"user": null}, "url": "https://github.com/TEAMMATES/teammates/commit/84ccac6f84e238bff1c9bae3d36037dd99ddc265", "committedDate": "2020-09-19T10:16:29Z", "message": "Fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMjU5Nzg3", "url": "https://github.com/TEAMMATES/teammates/pull/10709#pullrequestreview-492259787", "createdAt": "2020-09-21T03:09:39Z", "commit": {"oid": "84ccac6f84e238bff1c9bae3d36037dd99ddc265"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MDA5NzM2", "url": "https://github.com/TEAMMATES/teammates/pull/10709#pullrequestreview-495009736", "createdAt": "2020-09-23T20:08:57Z", "commit": {"oid": "84ccac6f84e238bff1c9bae3d36037dd99ddc265"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMDowODo1N1rOHW_H0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMDowODo1N1rOHW_H0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg2NDkxNQ==", "bodyText": "You can just call the method directly.\n\nThere is no need to use search service as a proxy\nThe naming is also a bit misleading as we are not searching instructor privilege.", "url": "https://github.com/TEAMMATES/teammates/pull/10709#discussion_r493864915", "createdAt": "2020-09-23T20:08:57Z", "author": {"login": "xpdavid"}, "path": "src/web/services/search.service.ts", "diffHunk": "@@ -120,87 +116,10 @@ export class SearchService {\n     return this.httpRequestService.get(ResourceEndpoints.SEARCH_COMMENTS, paramMap);\n   }\n \n-  getCoursesWithStudents(studentsRes: Students): SearchStudentsListRowTable[] {\n-    const { students }: { students: Student[] } = studentsRes;\n-\n-    const distinctCourses: string[] = Array.from(\n-      new Set(students.map((s: Student) => s.courseId)),\n+  searchInstructorPrivilege(courseId: string, sectionName: string): Observable<InstructorPrivilege> {\n+    return this.instructorService.loadInstructorPrivilege(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84ccac6f84e238bff1c9bae3d36037dd99ddc265"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "093f9809341e06f966d157623d5859eb03a0f82d", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/093f9809341e06f966d157623d5859eb03a0f82d", "committedDate": "2020-10-02T15:53:41Z", "message": "Merge branch 'master' into 10315-refactor-search-result-type"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4264, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}