{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1OTM2ODA5", "number": 10287, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMDozOTowOFrOEMbilg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNzo1ODo0M1rOENLeig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNDY5NTkwOnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/ui/webapi/action/GetStudentsAction.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMDozOTowOFrOGuiJ6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMDozOTowOFrOGuiJ6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ0NzI3NQ==", "bodyText": "This is insufficient as googleId still leaks", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r451447275", "createdAt": "2020-07-08T10:39:08Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/ui/webapi/action/GetStudentsAction.java", "diffHunk": "@@ -43,18 +44,14 @@ public ActionResult execute() {\n         if (teamName == null) {\n             // request to get all students of a course by instructor\n             List<StudentAttributes> studentsForCourse = logic.getStudentsForCourse(courseId);\n-            return new JsonResult(new StudentsData(studentsForCourse));\n+            StudentsData studentsData = new StudentsData(studentsForCourse);\n+            studentsData.getStudents().forEach(StudentData::hideInformationForInstructor);\n+            return new JsonResult(studentsData);\n         } else {\n             // request to get team members by current student\n             List<StudentAttributes> studentsForTeam = logic.getStudentsForTeam(teamName, courseId);\n             StudentsData studentsData = new StudentsData(studentsForTeam);\n-\n-            // hide information for students\n-            studentsData.getStudents().forEach(s -> {\n-                s.setComments(null);\n-                s.setJoinState(null);\n-            });\n-\n+            studentsData.getStudents().forEach(StudentData::hideInformationForStudent);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a83972d927d5d21aaffbbfe7fe6b6d85c3b299"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNDcwNTM5OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/ui/webapi/output/StudentData.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMDo0MjowNFrOGuiPwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMDo0MjowNFrOGuiPwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ0ODc2OQ==", "bodyText": "I don't think this is necessary because the registration key is not set as part of constructor (i.e. it needs to be explicitly set).\nBut having said that, googleId also needs to be treated the same, i.e. needs to be explicitly set. This will also make the line before this redundant.", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r451448769", "createdAt": "2020-07-08T10:42:04Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/ui/webapi/output/StudentData.java", "diffHunk": "@@ -116,12 +116,29 @@ public void hideLastName() {\n         setLastName(null);\n     }\n \n+    /**\n+     * Hides some attributes to instructor on a search.\n+     */\n+    public void hideInformationForInstructorSearch() {\n+        hideInformationForInstructor();\n+        setComments(null);\n+        setInstitute(null);\n+    }\n+\n     /**\n      * Hides some attributes to instructor.\n      */\n     public void hideInformationForInstructor() {\n         setGoogleId(null);\n+        setKey(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a83972d927d5d21aaffbbfe7fe6b6d85c3b299"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNDcxNzk0OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/ui/webapi/output/StudentData.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxMDo0NTo1NFrOGuiXHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDo0Njo1NFrOGurpNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ1MDY1Mg==", "bodyText": "This is not necessary if the information is not sensitive because:\n\nIt does not save any DB retrieval cost\nIt does save the byte transferred, but comments and institute are never that large to warrant that kind of saving\nThese information are accessible from some other instructor endpoints that are not search, which defeats any goal of information hiding\nHaving this method requires some maintenance effort, e.g. \"why these fields?\", \"why only for instructor search?\"\n\nAdd: I realize I included institute in the issue description (although I did put it as \"good to hide\"). Let's invert the way we look at this: in which situation do we need institute, comments, etc.? Only during those time then we include the said fields.", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r451450652", "createdAt": "2020-07-08T10:45:54Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/ui/webapi/output/StudentData.java", "diffHunk": "@@ -116,12 +116,29 @@ public void hideLastName() {\n         setLastName(null);\n     }\n \n+    /**\n+     * Hides some attributes to instructor on a search.\n+     */\n+    public void hideInformationForInstructorSearch() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a83972d927d5d21aaffbbfe7fe6b6d85c3b299"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYwMjc0MQ==", "bodyText": "There was already a method called hideInformationForInstructor which wasn't appropriately named because it was only used in the student search so I just renamed it to hideInformationForInstructorSearch.\nI removed googleId from being set in the constructor and renamed the methods more appropriately. I'll fix the tests first then push the changes.", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r451602741", "createdAt": "2020-07-08T14:46:54Z", "author": {"login": "madanalogy"}, "path": "src/main/java/teammates/ui/webapi/output/StudentData.java", "diffHunk": "@@ -116,12 +116,29 @@ public void hideLastName() {\n         setLastName(null);\n     }\n \n+    /**\n+     * Hides some attributes to instructor on a search.\n+     */\n+    public void hideInformationForInstructorSearch() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ1MDY1Mg=="}, "originalCommit": {"oid": "57a83972d927d5d21aaffbbfe7fe6b6d85c3b299"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxODIzMzI0OnYy", "diffSide": "RIGHT", "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNzowMzoyOVrOGvEQPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNzoyOToyNFrOGva-eA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwNTk0OQ==", "bodyText": "Even this is not necessary. This is not really hiding anything.", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r452005949", "createdAt": "2020-07-09T07:03:29Z", "author": {"login": "wkurniawan07"}, "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "diffHunk": "@@ -93,9 +93,9 @@ public ActionResult execute() {\n             if (userInfo.isAdmin && entity.equals(Const.EntityType.ADMIN)) {\n                 studentData.addAdditionalInformationForAdminSearch(\n                         StringHelper.encrypt(s.getKey()),\n-                        getInstituteFromCourseId(s.getCourse()));\n+                        getInstituteFromCourseId(s.getCourse()), s.getGoogleId());\n             } else {\n-                studentData.hideInformationForInstructor();\n+                studentData.hideInformationForSearch();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86fc456c3ddc6a4fef4d0e3b97c7641f59ce03c9"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE2NzY2Mw==", "bodyText": "This was legacy code, comments are hidden from output in student search for instructor. I don't really know why. Would you like me to remove it?", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r452167663", "createdAt": "2020-07-09T12:05:24Z", "author": {"login": "madanalogy"}, "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "diffHunk": "@@ -93,9 +93,9 @@ public ActionResult execute() {\n             if (userInfo.isAdmin && entity.equals(Const.EntityType.ADMIN)) {\n                 studentData.addAdditionalInformationForAdminSearch(\n                         StringHelper.encrypt(s.getKey()),\n-                        getInstituteFromCourseId(s.getCourse()));\n+                        getInstituteFromCourseId(s.getCourse()), s.getGoogleId());\n             } else {\n-                studentData.hideInformationForInstructor();\n+                studentData.hideInformationForSearch();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwNTk0OQ=="}, "originalCommit": {"oid": "86fc456c3ddc6a4fef4d0e3b97c7641f59ce03c9"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM3ODIzMg==", "bodyText": "comment should not be hidden I think. The point raised by @wkurniawan07 should justify:\n\nThese information are accessible from some other instructor endpoints that are not search, which defeats any goal of information hiding", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r452378232", "createdAt": "2020-07-09T17:29:24Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "diffHunk": "@@ -93,9 +93,9 @@ public ActionResult execute() {\n             if (userInfo.isAdmin && entity.equals(Const.EntityType.ADMIN)) {\n                 studentData.addAdditionalInformationForAdminSearch(\n                         StringHelper.encrypt(s.getKey()),\n-                        getInstituteFromCourseId(s.getCourse()));\n+                        getInstituteFromCourseId(s.getCourse()), s.getGoogleId());\n             } else {\n-                studentData.hideInformationForInstructor();\n+                studentData.hideInformationForSearch();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwNTk0OQ=="}, "originalCommit": {"oid": "86fc456c3ddc6a4fef4d0e3b97c7641f59ce03c9"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxODIzNTA5OnYy", "diffSide": "RIGHT", "path": "src/test/java/teammates/test/cases/webapi/GetStudentActionTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNzowNDoxM1rOGvERbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwNzowNDoxM1rOGvERbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwNjI1Mg==", "bodyText": "Need to assertNull the registration key as well", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r452006252", "createdAt": "2020-07-09T07:04:13Z", "author": {"login": "wkurniawan07"}, "path": "src/test/java/teammates/test/cases/webapi/GetStudentActionTest.java", "diffHunk": "@@ -32,6 +32,7 @@ protected String getRequestMethod() {\n \n     private void assertStudentDataMatches(StudentData studentData, StudentAttributes student,\n                                           boolean isRequestFromInstructor) {\n+        assertNull(studentData.getGoogleId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86fc456c3ddc6a4fef4d0e3b97c7641f59ce03c9"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjU0ODQ1OnYy", "diffSide": "RIGHT", "path": "src/web/app/components/student-list/join-state.pipe.ts", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNzo1ODoxMlrOGvtuCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMDo0NjowM1rOGvy1XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY4NTMyMA==", "bodyText": "Can shorten to joinState?: JoinState", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r452685320", "createdAt": "2020-07-10T07:58:12Z", "author": {"login": "wkurniawan07"}, "path": "src/web/app/components/student-list/join-state.pipe.ts", "diffHunk": "@@ -12,7 +12,7 @@ export class JoinStatePipe implements PipeTransform {\n   /**\n    * Transforms {@code JoinState} to a join state display for the student list component.\n    */\n-  transform(joinState: JoinState): any {\n+  transform(joinState: JoinState | undefined): any {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7aed6ca688f7b744c264673c59a38a5655397a6a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc2MjY0MA==", "bodyText": "I tried doing that at first, but then I get the error Type 'JoinState | undefined' is not assignable to type 'JoinState'. in the implementations.", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r452762640", "createdAt": "2020-07-10T10:31:25Z", "author": {"login": "madanalogy"}, "path": "src/web/app/components/student-list/join-state.pipe.ts", "diffHunk": "@@ -12,7 +12,7 @@ export class JoinStatePipe implements PipeTransform {\n   /**\n    * Transforms {@code JoinState} to a join state display for the student list component.\n    */\n-  transform(joinState: JoinState): any {\n+  transform(joinState: JoinState | undefined): any {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY4NTMyMA=="}, "originalCommit": {"oid": "7aed6ca688f7b744c264673c59a38a5655397a6a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc2OTExNg==", "bodyText": "Have you run ./gradlew generateTypes? The changes introduced here will affect the response format.", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r452769116", "createdAt": "2020-07-10T10:46:03Z", "author": {"login": "wkurniawan07"}, "path": "src/web/app/components/student-list/join-state.pipe.ts", "diffHunk": "@@ -12,7 +12,7 @@ export class JoinStatePipe implements PipeTransform {\n   /**\n    * Transforms {@code JoinState} to a join state display for the student list component.\n    */\n-  transform(joinState: JoinState): any {\n+  transform(joinState: JoinState | undefined): any {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY4NTMyMA=="}, "originalCommit": {"oid": "7aed6ca688f7b744c264673c59a38a5655397a6a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjU0ODk4OnYy", "diffSide": "RIGHT", "path": "src/web/app/components/student-list/student-list-section-data.ts", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNzo1ODoyN1rOGvtuXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxMDozMTo0OFrOGvycpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY4NTQwNg==", "bodyText": "Similarly can shorten to status?: JoinState", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r452685406", "createdAt": "2020-07-10T07:58:27Z", "author": {"login": "wkurniawan07"}, "path": "src/web/app/components/student-list/student-list-section-data.ts", "diffHunk": "@@ -16,7 +16,7 @@ export interface StudentListSectionData {\n export interface StudentListStudentData {\n   name: string;\n   email: string;\n-  status: JoinState;\n+  status: JoinState | undefined;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7aed6ca688f7b744c264673c59a38a5655397a6a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc2Mjc5MQ==", "bodyText": "same here", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r452762791", "createdAt": "2020-07-10T10:31:48Z", "author": {"login": "madanalogy"}, "path": "src/web/app/components/student-list/student-list-section-data.ts", "diffHunk": "@@ -16,7 +16,7 @@ export interface StudentListSectionData {\n export interface StudentListStudentData {\n   name: string;\n   email: string;\n-  status: JoinState;\n+  status: JoinState | undefined;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY4NTQwNg=="}, "originalCommit": {"oid": "7aed6ca688f7b744c264673c59a38a5655397a6a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjU0OTg2OnYy", "diffSide": "RIGHT", "path": "src/web/services/student.service.ts", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNzo1ODo0M1rOGvtu6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNzo1ODo0M1rOGvtu6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY4NTU0Ng==", "bodyText": "I don't think this file needs any change", "url": "https://github.com/TEAMMATES/teammates/pull/10287#discussion_r452685546", "createdAt": "2020-07-10T07:58:43Z", "author": {"login": "wkurniawan07"}, "path": "src/web/services/student.service.ts", "diffHunk": "@@ -158,13 +158,12 @@ export class StudentService {\n           || this.tableComparatorService.compare(SortBy.TEAM_NAME, SortOrder.ASC, a.teamName, b.teamName)\n           || this.tableComparatorService.compare(SortBy.STUDENT_NAME, SortOrder.ASC, a.name, b.name);\n     });\n-    const joinStatePipe: JoinStatePipe = new JoinStatePipe();\n     students.forEach((student: Student) => {\n       const studentRow: string[] = [\n         student.teamName ? student.teamName : '',\n         student.name,\n         student.lastName ? student.lastName : '',\n-        joinStatePipe.transform(student.joinState),\n+        new JoinStatePipe().transform(student.joinState),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7aed6ca688f7b744c264673c59a38a5655397a6a"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3597, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}