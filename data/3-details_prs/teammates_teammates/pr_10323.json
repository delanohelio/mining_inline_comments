{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUxMDA1ODQ2", "number": 10323, "title": "[#10322] Rich text editor breaks when moved during reorder ", "bodyText": "Fixes #10322\nThis issue is talked about here: https://stackoverflow.com/questions/2535569/tinymce-editor-dislikes-being-moved-around\nI believe the only solution is to remove the TinyMCE before moving the elements and adding it back after.\nHowever, I do not think it is possible to have a listener for the editor is called during when the editor is moved.\nIt is also difficult for instructor-session-edit-page.component to interact with the  editor directly.\nHence, I believe the best solution is to reload all the questions,  thus reloading the editor as well.\nOutline of Solution\n\nChange from moving questionForms to reloading on reorder", "createdAt": "2020-07-17T10:28:18Z", "url": "https://github.com/TEAMMATES/teammates/pull/10323", "merged": true, "mergeCommit": {"oid": "965d5d777955de7b67e46f64d56b81689c3ab989"}, "closed": true, "closedAt": "2020-07-19T15:34:03Z", "author": {"login": "jtankw3"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1xCHwAH2gAyNDUxMDA1ODQ2OjY5YThiNWRlNmMzMjM0YjlkZGJmN2RjZWNiZTU0ZWE2OTA5Mjg2MWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc2e1hIAFqTQ1MTE0MTgyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "69a8b5de6c3234b9ddbf7dcecbe54ea69092861d", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/69a8b5de6c3234b9ddbf7dcecbe54ea69092861d", "committedDate": "2020-07-17T10:11:44Z", "message": "Change from moving questionForms to reloading on reorder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwODg3MzI5", "url": "https://github.com/TEAMMATES/teammates/pull/10323#pullrequestreview-450887329", "createdAt": "2020-07-17T18:54:18Z", "commit": {"oid": "69a8b5de6c3234b9ddbf7dcecbe54ea69092861d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxODo1NDoxOFrOGzdzkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxODo1NDoxOFrOGzdzkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxODg5OQ==", "bodyText": "I think we need to explain the workaround a bit as this violate our design in frontend where we want to minimize the unnecessary communication.", "url": "https://github.com/TEAMMATES/teammates/pull/10323#discussion_r456618899", "createdAt": "2020-07-17T18:54:18Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/instructor-session-edit-page/instructor-session-edit-page.component.ts", "diffHunk": "@@ -538,24 +538,21 @@ export class InstructorSessionEditPageComponent extends InstructorSessionBasePag\n           this.feedbackQuestionModels.set(updatedQuestion.feedbackQuestionId, updatedQuestion);\n           this.loadResponseStatusForQuestion(this.questionEditFormModels[index]);\n \n-          // shift question if needed\n+          // reload questions in new order if needed\n           if (originalQuestionNumber !== updatedQuestion.questionNumber) {\n-            // move question form\n-            this.moveQuestionForm(\n-                originalQuestionNumber - 1, updatedQuestion.questionNumber - 1);\n-            this.normalizeQuestionNumberInQuestionForms();\n+            this.reloadQuestionForms();\n           }\n \n           this.statusMessageService.showSuccessToast('The changes to the question have been updated.');\n         }, (resp: ErrorMessageOutput) => { this.statusMessageService.showErrorToast(resp.error.message); });\n   }\n \n   /**\n-   * Moves question edit form from the original position to the new position.\n+   * Reloads feedback questions.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69a8b5de6c3234b9ddbf7dcecbe54ea69092861d"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "452fc0ef0fb3e68a1225213ef23950695ddb071f", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/452fc0ef0fb3e68a1225213ef23950695ddb071f", "committedDate": "2020-07-19T03:47:02Z", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into fix-reorder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99fc7e0fd86e8d330b5494d899293144be058321", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/99fc7e0fd86e8d330b5494d899293144be058321", "committedDate": "2020-07-19T07:22:28Z", "message": "Change from reloading to re-expanding moved questions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "170f86db36689694f7133576b165158dfea0e6d6", "author": {"user": {"login": "jtankw3", "name": "Tan Kian Wei Jason"}}, "url": "https://github.com/TEAMMATES/teammates/commit/170f86db36689694f7133576b165158dfea0e6d6", "committedDate": "2020-07-19T07:23:43Z", "message": "Merge branch 'master' into fix-reorder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMTM5OTQ2", "url": "https://github.com/TEAMMATES/teammates/pull/10323#pullrequestreview-451139946", "createdAt": "2020-07-19T15:08:13Z", "commit": {"oid": "170f86db36689694f7133576b165158dfea0e6d6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxNTowODoxM1rOGzwLTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xOVQxNTowODoxM1rOGzwLTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkxOTg4Ng==", "bodyText": "This will make all modals previously collapsed to be expanded. Only those which are previously expanded should be re-expanded.", "url": "https://github.com/TEAMMATES/teammates/pull/10323#discussion_r456919886", "createdAt": "2020-07-19T15:08:13Z", "author": {"login": "wkurniawan07"}, "path": "src/web/app/pages-instructor/instructor-session-edit-page/instructor-session-edit-page.component.ts", "diffHunk": "@@ -556,6 +557,15 @@ export class InstructorSessionEditPageComponent extends InstructorSessionBasePag\n   private moveQuestionForm(originalPosition: number, newPosition: number): void {\n     this.questionEditFormModels.splice(newPosition, 0,\n         this.questionEditFormModels.splice(originalPosition, 1)[0]);\n+\n+    // all expanded questions that were moved upwards must be re-expanded to reload rich text editor\n+    const start: number = Math.min(originalPosition, newPosition);\n+    const movedExpandedQuestions: QuestionEditFormModel[] = this.questionEditFormModels\n+      .slice(start, newPosition + 1)\n+      .filter((model: QuestionEditFormModel) => !model.isCollapsed);\n+    movedExpandedQuestions.forEach((model: QuestionEditFormModel) => model.isCollapsed = true);\n+    this.changeDetectorRef.detectChanges();\n+    movedExpandedQuestions.forEach((model: QuestionEditFormModel) => model.isCollapsed = false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "170f86db36689694f7133576b165158dfea0e6d6"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMTQxODI4", "url": "https://github.com/TEAMMATES/teammates/pull/10323#pullrequestreview-451141828", "createdAt": "2020-07-19T15:33:36Z", "commit": {"oid": "170f86db36689694f7133576b165158dfea0e6d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4296, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}