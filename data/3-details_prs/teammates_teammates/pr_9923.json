{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0NDM2NzA5", "number": 9923, "title": "[#9921] Don't load all courses again when deleting/archiving courses in InstructorCoursesPageComponent", "bodyText": "Fixes #9921\nOutline of Solution\nMoved course models between activeCourses, archivedCourses, softDeletedCourses. The following functions were changed: changeArchiveStatus, onDelete, onDeletePermanently, onDeleteAll. onRestore and onRestoreAll were left unchanged because based on the current design front-end does not know which list the course goes to after being restored. Possible to be improved in future.", "createdAt": "2020-01-18T15:30:36Z", "url": "https://github.com/TEAMMATES/teammates/pull/9923", "merged": true, "mergeCommit": {"oid": "553956e58e38a6d73925ab51d6bee5f99c1752e5"}, "closed": true, "closedAt": "2020-02-02T05:01:19Z", "author": {"login": "niqiukun"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb7lCbYAH2gAyMzY0NDM2NzA5OjY0NTYzMTY3NWJjOGViYzI2Y2UyNjQ5M2MxYjkxYzEwZjI3NzE3NjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcARFz-gFqTM1MTkxODkyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "645631675bc8ebc26ce26493c1b91c10f2771765", "author": {"user": {"login": "niqiukun", "name": "Ni Tianzhen"}}, "url": "https://github.com/TEAMMATES/teammates/commit/645631675bc8ebc26ce26493c1b91c10f2771765", "committedDate": "2020-01-18T15:25:36Z", "message": "Prevent multiple loading of courses after archiving/deleting courses in courses page"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MDc0NjIx", "url": "https://github.com/TEAMMATES/teammates/pull/9923#pullrequestreview-345074621", "createdAt": "2020-01-20T04:25:13Z", "commit": {"oid": "645631675bc8ebc26ce26493c1b91c10f2771765"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQwNDoyNToxNFrOFfTQWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQwNDozNzoyOVrOFfTWrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODM2NTY1OA==", "bodyText": "Naming convention:\n\nIt is a bit weird to mention frontend here as you are already in the frontend.\nA bit redundant to say in front-end only\nonXXX is more of naming convention for an event handler.", "url": "https://github.com/TEAMMATES/teammates/pull/9923#discussion_r368365658", "createdAt": "2020-01-20T04:25:14Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/instructor-courses-page/instructor-courses-page.component.ts", "diffHunk": "@@ -248,6 +320,28 @@ export class InstructorCoursesPageComponent implements OnInit {\n     }, () => {});\n   }\n \n+  /**\n+   * Moves an active/archived course to Recycle Bin in front-end only.\n+   * This is to reduce the need to refresh the entire list of courses multiple times.\n+   */\n+  onDeleteFrontEnd(courseId: string): void {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "645631675bc8ebc26ce26493c1b91c10f2771765"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODM2NzI3Ng==", "bodyText": "How about combining ActiveCourseModel ArchivedCourseModel SoftDeletedCourseModel into one CourseModel?", "url": "https://github.com/TEAMMATES/teammates/pull/9923#discussion_r368367276", "createdAt": "2020-01-20T04:37:29Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/instructor-courses-page/instructor-courses-page.component.ts", "diffHunk": "@@ -228,6 +228,78 @@ export class InstructorCoursesPageComponent implements OnInit {\n     });\n   }\n \n+  /**\n+   * Changes the status of an archived course in front-end only.\n+   * This is to reduce the need to refresh the entire list of courses multiple times.\n+   */\n+  changeFrontEndArchiveStatus(courseId: string, toArchive: boolean): void {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "645631675bc8ebc26ce26493c1b91c10f2771765"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bc98bf1ea7667ac585efc155bc732f8b1332df1", "author": {"user": {"login": "niqiukun", "name": "Ni Tianzhen"}}, "url": "https://github.com/TEAMMATES/teammates/commit/7bc98bf1ea7667ac585efc155bc732f8b1332df1", "committedDate": "2020-01-20T06:18:15Z", "message": "Organise various model types into one CourseModel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a718457021de2ee9dcb4222ed1c1f054a5e9462", "author": {"user": {"login": "niqiukun", "name": "Ni Tianzhen"}}, "url": "https://github.com/TEAMMATES/teammates/commit/0a718457021de2ee9dcb4222ed1c1f054a5e9462", "committedDate": "2020-01-20T06:18:52Z", "message": "Fix deletion date not assigned after moving the course into recycle bin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58f3787b629a2293da206d3a6dfcb6ea6448238d", "author": {"user": {"login": "niqiukun", "name": "Ni Tianzhen"}}, "url": "https://github.com/TEAMMATES/teammates/commit/58f3787b629a2293da206d3a6dfcb6ea6448238d", "committedDate": "2020-01-20T06:29:16Z", "message": "Make sorting persistent after courses restored from archive"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NTI0NzE3", "url": "https://github.com/TEAMMATES/teammates/pull/9923#pullrequestreview-345524717", "createdAt": "2020-01-20T20:42:39Z", "commit": {"oid": "58f3787b629a2293da206d3a6dfcb6ea6448238d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQyMDo0MjozOVrOFfo20w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQyMDo0NDoxMVrOFfo4UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODcxOTU3MQ==", "bodyText": "course now will have the true deletionTimestamp in the backend. Manually assigning a fake deletionTimestamp might cause data inconsistency in the future.", "url": "https://github.com/TEAMMATES/teammates/pull/9923#discussion_r368719571", "createdAt": "2020-01-20T20:42:39Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/instructor-courses-page/instructor-courses-page.component.ts", "diffHunk": "@@ -239,7 +296,7 @@ export class InstructorCoursesPageComponent implements OnInit {\n     const modalRef: NgbModalRef = this.modalService.open(CourseSoftDeletionConfirmModalComponent);\n     modalRef.result.then(() => {\n       this.courseService.binCourse(courseId).subscribe((course: Course) => {\n-        this.loadInstructorCourses();\n+        this.moveCourseToRecycleBin(courseId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58f3787b629a2293da206d3a6dfcb6ea6448238d"}, "originalPosition": 156}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODcxOTk1Mg==", "bodyText": "You can try to combine findAndRemoveActiveCourse. ,indAndRemoveArchivedCourse and findAndRemoveSoftDeletedCourse to findAndRemoveCourseModel(from, couseId)?", "url": "https://github.com/TEAMMATES/teammates/pull/9923#discussion_r368719952", "createdAt": "2020-01-20T20:44:11Z", "author": {"login": "xpdavid"}, "path": "src/web/app/pages-instructor/instructor-courses-page/instructor-courses-page.component.ts", "diffHunk": "@@ -216,18 +208,83 @@ export class InstructorCoursesPageComponent implements OnInit {\n     this.courseService.changeArchiveStatus(courseId, {\n       archiveStatus: toArchive,\n     }).subscribe((courseArchive: CourseArchive) => {\n-      this.loadInstructorCourses();\n       if (courseArchive.isArchived) {\n+        this.changeModelFromActiveToArchived(courseId);\n         this.statusMessageService.showSuccessMessage(`The course ${courseId} has been archived.\n           It will not appear on the home page anymore.`);\n       } else {\n+        this.changeModelFromArchivedToActive(courseId);\n         this.statusMessageService.showSuccessMessage('The course has been unarchived.');\n       }\n     }, (resp: ErrorMessageOutput) => {\n       this.statusMessageService.showErrorMessage(resp.error.message);\n     });\n   }\n \n+  /**\n+   * Moves a course model from active courses list to archived list.\n+   * This is to reduce the need to refresh the entire list of courses multiple times.\n+   */\n+  changeModelFromActiveToArchived(courseId: string): void {\n+    const courseToBeRemoved: CourseModel | undefined = this.findAndRemoveActiveCourse(courseId);\n+    if (courseToBeRemoved !== undefined) {\n+      this.archivedCourses.push(courseToBeRemoved);\n+    }\n+  }\n+\n+  /**\n+   * Moves a course model from archived courses list to active list.\n+   * This is to reduce the need to refresh the entire list of courses multiple times.\n+   */\n+  changeModelFromArchivedToActive(courseId: string): void {\n+    const courseToBeRemoved: CourseModel | undefined = this.findAndRemoveArchivedCourse(courseId);\n+    if (courseToBeRemoved !== undefined) {\n+      this.activeCourses.push(courseToBeRemoved);\n+      this.activeCourses.sort(this.sortBy(this.tableSortBy));\n+    }\n+  }\n+\n+  /**\n+   * Finds and removes an active course from the active course list.\n+   */\n+  findAndRemoveActiveCourse(courseId: string): CourseModel | undefined {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58f3787b629a2293da206d3a6dfcb6ea6448238d"}, "originalPosition": 110}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6d0add7f2b7eb977a9ff887177ecb3a824d328f", "author": {"user": {"login": "niqiukun", "name": "Ni Tianzhen"}}, "url": "https://github.com/TEAMMATES/teammates/commit/b6d0add7f2b7eb977a9ff887177ecb3a824d328f", "committedDate": "2020-01-23T03:07:03Z", "message": "Refactor and return deletion timestamp from backend"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NjYzMTk2", "url": "https://github.com/TEAMMATES/teammates/pull/9923#pullrequestreview-347663196", "createdAt": "2020-01-23T22:55:19Z", "commit": {"oid": "b6d0add7f2b7eb977a9ff887177ecb3a824d328f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMjo1NToxOVrOFhPVTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QyMjo1NToxOVrOFhPVTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDM5ODU0MA==", "bodyText": "My apologies. I thought we will return the updated course through the API.\nLooks like your change is necessary. In addition, don't forget to add Java test for it.", "url": "https://github.com/TEAMMATES/teammates/pull/9923#discussion_r370398540", "createdAt": "2020-01-23T22:55:19Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/action/BinCourseAction.java", "diffHunk": "@@ -33,7 +33,7 @@ public ActionResult execute() {\n         String idOfCourseToBin = getNonNullRequestParamValue(Const.ParamsNames.COURSE_ID);\n         try {\n             CourseAttributes courseAttributes = logic.getCourse(idOfCourseToBin);\n-            logic.moveCourseToRecycleBin(idOfCourseToBin);\n+            courseAttributes.deletedAt = logic.moveCourseToRecycleBin(idOfCourseToBin);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6d0add7f2b7eb977a9ff887177ecb3a824d328f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d779de798b5803025dbcb6cba0e543801a4cb57", "author": {"user": {"login": "niqiukun", "name": "Ni Tianzhen"}}, "url": "https://github.com/TEAMMATES/teammates/commit/9d779de798b5803025dbcb6cba0e543801a4cb57", "committedDate": "2020-02-01T14:08:55Z", "message": "Add test to verify deletion timestamp has been set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93c38918c0b7d421a6a0f710ba29b4ac6b55fbc1", "author": {"user": {"login": "niqiukun", "name": "Ni Tianzhen"}}, "url": "https://github.com/TEAMMATES/teammates/commit/93c38918c0b7d421a6a0f710ba29b4ac6b55fbc1", "committedDate": "2020-02-01T14:31:40Z", "message": "Merge branch 'master' into archive-delete-course-page"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxOTE4OTIy", "url": "https://github.com/TEAMMATES/teammates/pull/9923#pullrequestreview-351918922", "createdAt": "2020-02-02T05:00:49Z", "commit": {"oid": "93c38918c0b7d421a6a0f710ba29b4ac6b55fbc1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4419, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}