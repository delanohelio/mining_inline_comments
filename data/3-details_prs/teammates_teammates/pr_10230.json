{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MDcxMDYx", "number": 10230, "title": "[#10176] Fix MCQ delete after reorder bug", "bodyText": "Part of #10176\nCan't believe this took me a full day to resolve...\nOutline of Solution\nThe original bug is caused by the trackBy: trackMcqOption option, which is necessary to prevent the input field from rerendering every time the input value changes.\nHowever, when the options gets reordered, this trackBy option causes the editor instances to not get reordered, which causes some sort of de-sync which I still do not fully understand.\nThus, when a reordered option gets deleted, both the onMcqOptionDeleted and onMcqOptionEntered gets called, whereas only onMcqOptionDeleted is supposed to be called. The onMcqOptionEntered call would thus overwrite the result of the previous onMcqOptionDeleted and cause the model to become invalid (E.g. numberOfMcqChoices=2 but there are 3 items in the mcqChoices array.\nThe most consistent way to reproduce the bug is to swap the position of the last 2 options, and then delete the last option.\nThis PR prevents onMcqOptionEntered from being called when an option is deleted. It doesn't fully resolve the root of the bug, but it works well enough. A better way should be to assign a unique ID for each options, and track each options by their ID. Not sure if it works though.", "createdAt": "2020-06-24T09:11:34Z", "url": "https://github.com/TEAMMATES/teammates/pull/10230", "merged": true, "mergeCommit": {"oid": "7a4a9ab22f884a03ef528749bbb1bc3906baad87"}, "closed": true, "closedAt": "2020-06-25T05:35:58Z", "author": {"login": "ccyccyccy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuV4i3AH2gAyNDM5MDcxMDYxOjg3NmQxMDY2NjVmN2U0N2NjNjJhMTMwNjI3NDk5ZjA4ODI4ZTk4NWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcunCjUgH2gAyNDM5MDcxMDYxOmU5YTZlMTNmYWE3MWY5YWJjZTNhYmMwNjhmNGUwOTJkZTRiNmI1ZDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "876d106665f7e47cc62a130627499f08828e985c", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/876d106665f7e47cc62a130627499f08828e985c", "committedDate": "2020-06-24T08:36:22Z", "message": "Fix MCQ delete after reorder bug"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2OTUzOTcx", "url": "https://github.com/TEAMMATES/teammates/pull/10230#pullrequestreview-436953971", "createdAt": "2020-06-24T19:45:40Z", "commit": {"oid": "876d106665f7e47cc62a130627499f08828e985c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTo0NTo0MFrOGogmbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTo0NTo0MFrOGogmbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEzMDM0OQ==", "bodyText": "Might be a potential bug here. If it is only updated on 'blur':\n\nUser enters something in the edit box but don't click outside.\nClick save immediately\nThe content might not be recorded and updated.", "url": "https://github.com/TEAMMATES/teammates/pull/10230#discussion_r445130349", "createdAt": "2020-06-24T19:45:40Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-types/question-edit-details-form/option-rich-text-editor/option-rich-text-editor.component.html", "diffHunk": "@@ -1,4 +1,4 @@\n <editor class=\"editor\" [ngClass]=\"{ 'editor-disabled': isDisabled }\" [ngStyle]=\"{ 'min-height.px': minHeightInPx }\"\n-        [init]=\"init\" [disabled]=\"isDisabled\" [inline]=\"isInlineMode\"\n+        [init]=\"init\" [disabled]=\"isDisabled\" [inline]=\"isInlineMode\" [ngModelOptions]=\"{ updateOn: 'blur' }\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "876d106665f7e47cc62a130627499f08828e985c"}, "originalPosition": 3}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MTU3NzU0", "url": "https://github.com/TEAMMATES/teammates/pull/10230#pullrequestreview-437157754", "createdAt": "2020-06-25T04:23:26Z", "commit": {"oid": "876d106665f7e47cc62a130627499f08828e985c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9a6e13faa71f9abce3abc068f4e092de4b6b5d7", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/e9a6e13faa71f9abce3abc068f4e092de4b6b5d7", "committedDate": "2020-06-25T04:35:41Z", "message": "Merge branch 'master' into 10176-mcq-delete-after-reorder-bug"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4366, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}