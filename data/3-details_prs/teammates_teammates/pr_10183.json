{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzMTA1MzQ1", "number": 10183, "title": "[#10182] Add custom component for sortable table, with contribution statistics using it", "bodyText": "Fixes #10182 and part of #10155\nImplemented an additional component field to take in for the column data of the sortable table, as well as individual input values to that component in each row.\nI have tried to use the dynamic component loader but it seems to be unable to accept @Input values.\nSo I ended up using the ng-dynamic-component  which supports the use of @Input for dynamic components.\nIncluded the fix for #10155 here for sample usage:", "createdAt": "2020-06-11T14:08:44Z", "url": "https://github.com/TEAMMATES/teammates/pull/10183", "merged": true, "mergeCommit": {"oid": "9135b8b5e0dbaaa19dc412cbb6fd74b98f5159e9"}, "closed": true, "closedAt": "2020-06-15T07:38:42Z", "author": {"login": "ccyccyccy"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqM4_ugH2gAyNDMzMTA1MzQ1OjkyMzVmOWM0ZThmNmEwMDMzMjEyYTc1ODYwMjM1NDE4MDkzMzJmNTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrae--AH2gAyNDMzMTA1MzQ1OjVlNTgxZDc4Mjc3ZGQ3ZDliYWM3NTM1MGFhOWM1NTY2YTVhODRjYmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9235f9c4e8f6a0033212a7586023541809332f58", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/9235f9c4e8f6a0033212a7586023541809332f58", "committedDate": "2020-06-11T11:52:01Z", "message": "Modify sortable table to accept custom components to render within the table cell"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "844dd5d8303ed38c2e20a79b952553777c137dd2", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/844dd5d8303ed38c2e20a79b952553777c137dd2", "committedDate": "2020-06-11T11:53:36Z", "message": "Add sortable table for contribution statistics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88b530e6d6147f5c6e341010b105a880663e92e9", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/88b530e6d6147f5c6e341010b105a880663e92e9", "committedDate": "2020-06-11T13:36:15Z", "message": "Lint and test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50d066697cacdb773477b79e69b846df07814472", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/50d066697cacdb773477b79e69b846df07814472", "committedDate": "2020-06-11T13:58:49Z", "message": "Remove original table, add tooltips"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5MDUwODc2", "url": "https://github.com/TEAMMATES/teammates/pull/10183#pullrequestreview-429050876", "createdAt": "2020-06-11T15:48:09Z", "commit": {"oid": "50d066697cacdb773477b79e69b846df07814472"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNTo0ODowOVrOGijpuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNTo0ODowOVrOGijpuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg4ODg4OA==", "bodyText": "I think essentially the PR wants to distinguish the data presentation from the data itself in the sortable table. Therefore, you may not want the rows to by of type any[]. Instead, we can define a new interface\nexport interface TableRow {\n    value: any, // value used for sorting with sortBy provided in ColumnData\n    displayableValue?: any; // displayable value \n    componentInput?: Record<string, any>; // @Input values for customized component if specified in ColumnData\n}\n\nBy doing this, the data presentation (use dynamic component or just plain-string displayable value) is separated from the data (value) itself.\nI think the current type definition any[][] | CustomTableCellData[][] is a bit confusing as it will enforce nothing since we have any.", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r438888888", "createdAt": "2020-06-11T15:48:09Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/sortable-table/sortable-table.component.ts", "diffHunk": "@@ -9,6 +9,16 @@ export interface ColumnData {\n   header: string;\n   headerToolTip?: string;\n   sortBy?: SortBy; // optional if the column is not sortable\n+  component?: Type<any>; // Must use in conjunction with CustomTableCellData in rows\n+}\n+\n+/**\n+ * Data provided for custom component used in table cell\n+ * Must use in conjunction with component in ColumnData\n+ */\n+export interface CustomTableCellData {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50d066697cacdb773477b79e69b846df07814472"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01ae9aea42db5e93334826635fcef6101d10f1a4", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/01ae9aea42db5e93334826635fcef6101d10f1a4", "committedDate": "2020-06-12T11:02:08Z", "message": "Convert sortable table to accept a single interface type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1771db5c1bcd3113def87c7d0a62c0403b7b1cc", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/f1771db5c1bcd3113def87c7d0a62c0403b7b1cc", "committedDate": "2020-06-12T11:32:58Z", "message": "Convert rest of statistics to use new API"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDE3NzE2", "url": "https://github.com/TEAMMATES/teammates/pull/10183#pullrequestreview-430017716", "createdAt": "2020-06-12T20:25:40Z", "commit": {"oid": "f1771db5c1bcd3113def87c7d0a62c0403b7b1cc"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMDoyNTo0MVrOGjQszg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMDozMzo0MVrOGjQ5EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyNjk1OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            export interface CustomTableCellData {\n          \n          \n            \n            export interface SortableTableCellData {\n          \n      \n    \n    \n  \n\nThe model should somehow be consistent with the component.", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439626958", "createdAt": "2020-06-12T20:25:41Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/sortable-table/sortable-table.component.ts", "diffHunk": "@@ -11,6 +11,22 @@ export interface ColumnData {\n   sortBy?: SortBy; // optional if the column is not sortable\n }\n \n+/**\n+ * Data provided for each table cell\n+ * Priority of display\n+ * 1. customComponent\n+ * 2. displayValue\n+ * 3. value\n+ */\n+export interface CustomTableCellData {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1771db5c1bcd3113def87c7d0a62c0403b7b1cc"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyODIxMA==", "bodyText": "Is the comment necessary?\n\nDefault to use supplied value for both sorting and displaying\n\nWhat is supplied value?", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439628210", "createdAt": "2020-06-12T20:28:52Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/sortable-table/sortable-table.component.ts", "diffHunk": "@@ -29,12 +45,14 @@ export class SortableTableComponent implements OnInit {\n   @Input()\n   columns: ColumnData[] = [];\n \n+  // Default to use supplied value for both sorting and displaying\n+  // Use CustomTableCellData if value used for sorting is different from displaying", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1771db5c1bcd3113def87c7d0a62c0403b7b1cc"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyODc5OA==", "bodyText": "The value should not be optional?", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439628798", "createdAt": "2020-06-12T20:30:17Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/sortable-table/sortable-table.component.ts", "diffHunk": "@@ -11,6 +11,22 @@ export interface ColumnData {\n   sortBy?: SortBy; // optional if the column is not sortable\n }\n \n+/**\n+ * Data provided for each table cell\n+ * Priority of display\n+ * 1. customComponent\n+ * 2. displayValue\n+ * 3. value\n+ */\n+export interface CustomTableCellData {\n+  value?: any; // Optional value used for sorting with sortBy provided in ColumnData", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1771db5c1bcd3113def87c7d0a62c0403b7b1cc"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYzMDA5Nw==", "bodyText": "Is defining the module really necessary?", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439630097", "createdAt": "2020-06-12T20:33:41Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-types/question-statistics/contribution-question-statistics/contribution-question-statistics.module.ts", "diffHunk": "@@ -0,0 +1,19 @@\n+import { CommonModule } from '@angular/common';\n+import { NgModule } from '@angular/core';\n+import { NgbModule } from '@ng-bootstrap/ng-bootstrap';\n+import { ContributionRatingsListComponent } from './contribution-ratings-list.component';\n+import { ContributionComponent } from './contribution.component';\n+\n+/**\n+ * Module for displaying data in a sortable table\n+ */\n+@NgModule({\n+  declarations: [ContributionComponent, ContributionRatingsListComponent],\n+  imports: [\n+    NgbModule, CommonModule,\n+  ],\n+  exports: [\n+    ContributionComponent, ContributionRatingsListComponent,\n+  ],\n+})\n+export class ContributionQuestionStatisticsModule { }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1771db5c1bcd3113def87c7d0a62c0403b7b1cc"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ec5e081d5d21518391044503794c878660fb9a7", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/9ec5e081d5d21518391044503794c878660fb9a7", "committedDate": "2020-06-13T07:19:58Z", "message": "Cleanup after refactoring sortable table row structure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTIwNjE1", "url": "https://github.com/TEAMMATES/teammates/pull/10183#pullrequestreview-430120615", "createdAt": "2020-06-13T07:23:21Z", "commit": {"oid": "9ec5e081d5d21518391044503794c878660fb9a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwNzoyMzoyMlrOGjWOFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwNzoyMzoyMlrOGjWOFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNzM5OA==", "bodyText": "Tooltips weren't working previous. Added a fix in here", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439717398", "createdAt": "2020-06-13T07:23:22Z", "author": {"login": "ccyccyccy"}, "path": "src/web/app/components/question-types/question-statistics/contribution-question-statistics/contribution.component.html", "diffHunk": "@@ -2,11 +2,11 @@\n   <span class=\"positive\" *ngIf=\"value > 0\">+{{ value }}%</span>\n   <span class=\"neutral\" *ngIf=\"value === 0\">0</span>\n   <span class=\"negative\" *ngIf=\"value < 0 && value >= -100\">{{ value }}%</span>\n-  <span class=\"neutral\" ngbTooltip=\"Not Available: There is no data for this or the data is not enough\" *ngIf=\"value === -999 || value === -9999\">N/A</span>\n+  <span class=\"neutral\" container=\"body\" ngbTooltip=\"Not Available: There is no data for this or the data is not enough\" *ngIf=\"value === -999 || value === -9999\">N/A</span>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ec5e081d5d21518391044503794c878660fb9a7"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTIwOTEz", "url": "https://github.com/TEAMMATES/teammates/pull/10183#pullrequestreview-430120913", "createdAt": "2020-06-13T07:29:36Z", "commit": {"oid": "9ec5e081d5d21518391044503794c878660fb9a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwNzoyOTozNlrOGjWPZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwNzoyOTozNlrOGjWPZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNzczNQ==", "bodyText": "One annoying thing is that the caller must remember to register their dynamic component here. Maybe should document this somewhere?\nFrom the docs here, it seems like this step can be skipped if we upgrade to Angular 9, but since we are at Angular 8, we are using this doc instead, which requires the registration of these components.\nWill open issue to track this as a reminder if we ever upgrade to Angular 9.", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439717735", "createdAt": "2020-06-13T07:29:36Z", "author": {"login": "ccyccyccy"}, "path": "src/web/app/components/sortable-table/sortable-table.module.ts", "diffHunk": "@@ -11,6 +18,8 @@ import { SortableTableComponent } from './sortable-table.component';\n   imports: [\n     CommonModule,\n     NgbModule,\n+    ContributionQuestionStatisticsModule,\n+    DynamicModule.withComponents([ContributionComponent, ContributionRatingsListComponent]),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ec5e081d5d21518391044503794c878660fb9a7"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "137bec54079fdc9a4905d6ebfb1e8812713661a6", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/137bec54079fdc9a4905d6ebfb1e8812713661a6", "committedDate": "2020-06-13T07:36:46Z", "message": "Add reminder to register new dynamic components"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTU0ODA2", "url": "https://github.com/TEAMMATES/teammates/pull/10183#pullrequestreview-430154806", "createdAt": "2020-06-13T17:48:33Z", "commit": {"oid": "137bec54079fdc9a4905d6ebfb1e8812713661a6"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNzo0ODozM1rOGjYl_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxNzo1Mjo1OFrOGjYnBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc1NjI4NQ==", "bodyText": "Will open issue to track this as a reminder if we ever upgrade to Angular 9.\n\nWe will do soon.", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439756285", "createdAt": "2020-06-13T17:48:33Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/sortable-table/sortable-table.module.ts", "diffHunk": "@@ -11,6 +18,8 @@ import { SortableTableComponent } from './sortable-table.component';\n   imports: [\n     CommonModule,\n     NgbModule,\n+    ContributionQuestionStatisticsModule,\n+    DynamicModule.withComponents([ContributionComponent, ContributionRatingsListComponent]),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNzczNQ=="}, "originalCommit": {"oid": "9ec5e081d5d21518391044503794c878660fb9a7"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc1NjU0OA==", "bodyText": "We should describe the function of the module other than where the module is used.", "url": "https://github.com/TEAMMATES/teammates/pull/10183#discussion_r439756548", "createdAt": "2020-06-13T17:52:58Z", "author": {"login": "xpdavid"}, "path": "src/web/app/components/question-types/question-statistics/contribution-question-statistics/contribution-question-statistics.module.ts", "diffHunk": "@@ -0,0 +1,19 @@\n+import { CommonModule } from '@angular/common';\n+import { NgModule } from '@angular/core';\n+import { NgbModule } from '@ng-bootstrap/ng-bootstrap';\n+import { ContributionRatingsListComponent } from './contribution-ratings-list.component';\n+import { ContributionComponent } from './contribution.component';\n+\n+/**\n+ * Module for displaying data in a sortable table", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "137bec54079fdc9a4905d6ebfb1e8812713661a6"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1de8c11a200a43f0f3869ac7203984761a2d9ccf", "author": {"user": {"login": "ccyccyccy", "name": "Chong Chee Yuan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/1de8c11a200a43f0f3869ac7203984761a2d9ccf", "committedDate": "2020-06-15T04:39:44Z", "message": "Change comments for contribution question statistics module"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMzE4MTMx", "url": "https://github.com/TEAMMATES/teammates/pull/10183#pullrequestreview-430318131", "createdAt": "2020-06-15T04:42:17Z", "commit": {"oid": "1de8c11a200a43f0f3869ac7203984761a2d9ccf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e581d78277dd7d9bac75350aa9c5566a5a84cba", "author": {"user": {"login": "madanalogy", "name": "Ahmed Bahajjaj"}}, "url": "https://github.com/TEAMMATES/teammates/commit/5e581d78277dd7d9bac75350aa9c5566a5a84cba", "committedDate": "2020-06-15T06:16:12Z", "message": "Merge branch 'master' into 10155-contribution-msq-statistic-table"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4344, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}