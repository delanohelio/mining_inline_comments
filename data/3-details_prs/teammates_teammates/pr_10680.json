{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3NTExNzEy", "number": 10680, "title": "[#10598] Combine teammates.ui.automated and teammates.ui.webapi into unified REST API package", "bodyText": "Fixes #10598\n\nAdded AdminOnlyAction as a shortcut action whereby admin privilege is required. All automated actions inherit this, as well as some actions like creating/deleting user account.\nMerged teammates.ui.automated into teammates.ui.webapi.action.\n\nNew package name:\n\nteammates.ui.webapi: I think this is more appropriate as the package does not contain only actions but also servlets and filters\nteammates.ui.output, teammates.ui.request, teammates.ui.endpoints: as before\n\n\nAs GAE-invoked requests do not carry any user information, the authentication is done by looking at X-AppEngine-QueueName header, which cannot be spoofed by user\nThe output objects for the automated actions are hard-coded to JsonResult(\"Successful\") as they are not meaningful, i.e. GAE won't make any use of it.\n\n\nAdded capability to task items to use request body, which is in line with our API design principles. This also reduces the need of conversion from request body -> request parameters -> object (case in point: from scheduleEmailForSending to SendEmailWorkerAction)\n\nWe could, of course, reorganize these automated endpoints such that they are truly REST-ful instead of RPC-based, but this is a work for another time.", "createdAt": "2020-09-02T01:34:39Z", "url": "https://github.com/TEAMMATES/teammates/pull/10680", "merged": true, "mergeCommit": {"oid": "a641cd213937cd6b14fed74a1e7837818576f292"}, "closed": true, "closedAt": "2020-09-16T04:44:52Z", "author": {"login": "wkurniawan07"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFgSYpABqjM3Mjg0MDc0NzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJUTsdABqjM3NzEyMjM2NDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3481e002825835d8051430106391bfa8c1548246", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/3481e002825835d8051430106391bfa8c1548246", "committedDate": "2020-09-02T01:27:02Z", "message": "Use proper subclass of ActionResult for all Action classes"}, "afterCommit": {"oid": "245ab2e265a9a816f9ce9a8be84836f449744ee2", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/245ab2e265a9a816f9ce9a8be84836f449744ee2", "committedDate": "2020-09-04T07:43:28Z", "message": "Use proper subclass of ActionResult for all Action classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "245ab2e265a9a816f9ce9a8be84836f449744ee2", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/245ab2e265a9a816f9ce9a8be84836f449744ee2", "committedDate": "2020-09-04T07:43:28Z", "message": "Use proper subclass of ActionResult for all Action classes"}, "afterCommit": {"oid": "68552f05b17fac0341d97c8f42827cc4ea7e29e8", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/68552f05b17fac0341d97c8f42827cc4ea7e29e8", "committedDate": "2020-09-06T01:24:01Z", "message": "Use proper subclass of ActionResult for all Action classes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMTYxMDY1", "url": "https://github.com/TEAMMATES/teammates/pull/10680#pullrequestreview-483161065", "createdAt": "2020-09-06T17:38:46Z", "commit": {"oid": "d165c3f048ce043ec1d38328572bda728f87000f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQxNzozODo0NlrOHNq3jA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNlQxNzo0NDowMlrOHNq5jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA5NTg4NA==", "bodyText": "Should we put the request object into another package as it will incorrectly be synced to the frontend.", "url": "https://github.com/TEAMMATES/teammates/pull/10680#discussion_r484095884", "createdAt": "2020-09-06T17:38:46Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/request/FeedbackSessionRemindRequest.java", "diffHunk": "@@ -0,0 +1,45 @@\n+package teammates.ui.webapi.request;\n+\n+/**\n+ * The request of specifying reminder emails to be sent.\n+ */\n+public class FeedbackSessionRemindRequest extends BasicRequest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d165c3f048ce043ec1d38328572bda728f87000f"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA5NjMyOA==", "bodyText": "If we allow both parameters and body, shouldn't that be more consistent with the REST API", "url": "https://github.com/TEAMMATES/teammates/pull/10680#discussion_r484096328", "createdAt": "2020-09-06T17:43:00Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/logic/core/TaskQueuesLogic.java", "diffHunk": "@@ -35,13 +36,18 @@ public void addDeferredTask(TaskWrapper task, long countdownTime) {\n             taskToBeAdded.countdownMillis(countdownTime);\n         }\n \n-        for (Map.Entry<String, String[]> entry : task.getParamMap().entrySet()) {\n-            String name = entry.getKey();\n-            String[] values = entry.getValue();\n+        // Task queue API only allows either parameter map or body, not both", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa92fe907c46a2f18efb69c06eee6fa32245a17e"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDA5NjM5OQ==", "bodyText": "Of course, we want to disallow the body for GET.", "url": "https://github.com/TEAMMATES/teammates/pull/10680#discussion_r484096399", "createdAt": "2020-09-06T17:44:02Z", "author": {"login": "xpdavid"}, "path": "src/main/java/teammates/ui/webapi/action/ActionFactory.java", "diffHunk": "@@ -116,10 +118,38 @@\n         map(ResourceURIs.STUDENT_PROFILE_PICTURE, DELETE, DeleteStudentProfilePictureAction.class);\n         map(ResourceURIs.INSTRUCTOR, PUT, UpdateInstructorAction.class);\n         map(ResourceURIs.INSTRUCTOR, POST, CreateInstructorAction.class);\n+\n+        // Cron jobs; use GET request", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7cffc495a8945359040eb388c428f9f7e54bbbd"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "68552f05b17fac0341d97c8f42827cc4ea7e29e8", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/68552f05b17fac0341d97c8f42827cc4ea7e29e8", "committedDate": "2020-09-06T01:24:01Z", "message": "Use proper subclass of ActionResult for all Action classes"}, "afterCommit": {"oid": "c234e787e665f68d1dd9df1f51ea488ee4e87c81", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/c234e787e665f68d1dd9df1f51ea488ee4e87c81", "committedDate": "2020-09-08T15:08:18Z", "message": "Use proper subclass of ActionResult for all Action classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c234e787e665f68d1dd9df1f51ea488ee4e87c81", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/c234e787e665f68d1dd9df1f51ea488ee4e87c81", "committedDate": "2020-09-08T15:08:18Z", "message": "Use proper subclass of ActionResult for all Action classes"}, "afterCommit": {"oid": "dc5a2003d44ecf8fdf5b2f31d77d5c50d4b5d735", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/dc5a2003d44ecf8fdf5b2f31d77d5c50d4b5d735", "committedDate": "2020-09-12T02:20:59Z", "message": "Use proper subclass of ActionResult for all Action classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc5a2003d44ecf8fdf5b2f31d77d5c50d4b5d735", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/dc5a2003d44ecf8fdf5b2f31d77d5c50d4b5d735", "committedDate": "2020-09-12T02:20:59Z", "message": "Use proper subclass of ActionResult for all Action classes"}, "afterCommit": {"oid": "dd25aeebb0d3a56320fe70b26f69aac955da6c0a", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/dd25aeebb0d3a56320fe70b26f69aac955da6c0a", "committedDate": "2020-09-13T02:53:32Z", "message": "Use proper subclass of ActionResult for all Action classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dd25aeebb0d3a56320fe70b26f69aac955da6c0a", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/dd25aeebb0d3a56320fe70b26f69aac955da6c0a", "committedDate": "2020-09-13T02:53:32Z", "message": "Use proper subclass of ActionResult for all Action classes"}, "afterCommit": {"oid": "33f54fff81944f0d131d4ae4b0cae407472093c0", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/33f54fff81944f0d131d4ae4b0cae407472093c0", "committedDate": "2020-09-14T13:59:03Z", "message": "Use proper subclass of ActionResult for all Action classes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjA5ODYx", "url": "https://github.com/TEAMMATES/teammates/pull/10680#pullrequestreview-489209861", "createdAt": "2020-09-16T01:21:33Z", "commit": {"oid": "33f54fff81944f0d131d4ae4b0cae407472093c0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9192b4f10a5174b99191f4515065da0cca133cc", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/b9192b4f10a5174b99191f4515065da0cca133cc", "committedDate": "2020-09-16T04:01:07Z", "message": "Add AdminOnlyAction class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b608f121fe6e77f449f42926ca162456e0f2e02", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/2b608f121fe6e77f449f42926ca162456e0f2e02", "committedDate": "2020-09-16T04:01:08Z", "message": "Merge automated actions to webapi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecee4ef4ddbcb3b4548cf7f0b6c02ed32539d741", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/ecee4ef4ddbcb3b4548cf7f0b6c02ed32539d741", "committedDate": "2020-09-16T04:01:08Z", "message": "Add request body field for TaskWrapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dab57a095ea7d6f6c787fbc62efdd4796bea1f9", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/4dab57a095ea7d6f6c787fbc62efdd4796bea1f9", "committedDate": "2020-09-16T04:01:08Z", "message": "Standardize parameter name for course ID and session name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7e194610a466370d72fc5825552afeaa37ae75a", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/c7e194610a466370d72fc5825552afeaa37ae75a", "committedDate": "2020-09-16T04:01:08Z", "message": "Use request body for some automated actions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f0adb199b8486f23927bf2277d71bc466fb4b1c", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/0f0adb199b8486f23927bf2277d71bc466fb4b1c", "committedDate": "2020-09-16T04:01:08Z", "message": "Deprecate multivalue parameter map for TaskWrapper, Action, BackDoor class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a0fcedc9128c1e051f4384e8e7d44b24c2cc4ea", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/9a0fcedc9128c1e051f4384e8e7d44b24c2cc4ea", "committedDate": "2020-09-16T04:01:09Z", "message": "Rename ui.webapi.* to ui.*"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffdb5695b4411858e6473ac463c0cbadd3d5b3de", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/ffdb5695b4411858e6473ac463c0cbadd3d5b3de", "committedDate": "2020-09-16T04:01:09Z", "message": "Use proper subclass of ActionResult for all Action classes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33f54fff81944f0d131d4ae4b0cae407472093c0", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/33f54fff81944f0d131d4ae4b0cae407472093c0", "committedDate": "2020-09-14T13:59:03Z", "message": "Use proper subclass of ActionResult for all Action classes"}, "afterCommit": {"oid": "ffdb5695b4411858e6473ac463c0cbadd3d5b3de", "author": {"user": {"login": "wkurniawan07", "name": "Wilson Kurniawan"}}, "url": "https://github.com/TEAMMATES/teammates/commit/ffdb5695b4411858e6473ac463c0cbadd3d5b3de", "committedDate": "2020-09-16T04:01:09Z", "message": "Use proper subclass of ActionResult for all Action classes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4254, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}