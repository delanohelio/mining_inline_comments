{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzMDcyOTUz", "number": 1053, "title": "OKAPI-875 async tenant init", "bodyText": "PR for version 2.0 of _tenant interface. It will use the paths for POST, GET, DELETE as provided. Version 1 series are still supported and there should be no changes in behavior. So this is a pure extension as far as Okapi is concerned.\nShould a Location be returned at runtime and yet the module descriptor only says 1.1 / 1.2 , Okapi issues an error. That is maintainer forgets folio-org/raml-module-builder#815 .", "createdAt": "2020-12-05T18:25:31Z", "url": "https://github.com/folio-org/okapi/pull/1053", "merged": true, "mergeCommit": {"oid": "1c9e23ceaf86649e45a63ecc813bd06007c0451f"}, "closed": true, "closedAt": "2020-12-09T11:13:12Z", "author": {"login": "adamdickmeiss"}, "timelineItems": {"totalCount": 39, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdi02LXAH2gAyNTMzMDcyOTUzOmMzMGIyZDM1Y2U1ZWNlNDhkYmExNzk5OGVjYjhkMmJjYTkwYmVhZjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkczzZAFqTU0ODA3NzM3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c30b2d35ce5ece48dba17998ecb8d2bca90beaf0", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/c30b2d35ce5ece48dba17998ecb8d2bca90beaf0", "committedDate": "2020-12-04T10:04:54Z", "message": "Ignore idea iml files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4045153865cbfcc7631b0ab9a5a201f64231f3db", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/4045153865cbfcc7631b0ab9a5a201f64231f3db", "committedDate": "2020-12-04T10:05:09Z", "message": "Make a few methods static"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19138a8a1cab580aa880f71a8c2f78cbd6a16342", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/19138a8a1cab580aa880f71a8c2f78cbd6a16342", "committedDate": "2020-12-04T10:47:04Z", "message": "Start work on module with async tenant init"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae3b0712a21dae7d6cf8ace70a92d4511cda2c5f", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/ae3b0712a21dae7d6cf8ace70a92d4511cda2c5f", "committedDate": "2020-12-04T11:46:58Z", "message": "Begin test for tenant init v2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d2b5bcee907a2b1b91aa1644759cb4c61e4bcdc", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/9d2b5bcee907a2b1b91aa1644759cb4c61e4bcdc", "committedDate": "2020-12-04T15:17:36Z", "message": "Begin supporting version 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9c2bb1b39c61c93c452389e026da1703a85a29d", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/d9c2bb1b39c61c93c452389e026da1703a85a29d", "committedDate": "2020-12-04T21:23:42Z", "message": "Codestyle fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d37e28561f3d1ea004d7fd8dca825f2b1b4a3441", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/d37e28561f3d1ea004d7fd8dca825f2b1b4a3441", "committedDate": "2020-12-05T08:24:11Z", "message": "Async tenant init operational OKAPI-875"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b26104743f58a35367a6b237b2195621d21c5e88", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/b26104743f58a35367a6b237b2195621d21c5e88", "committedDate": "2020-12-05T18:25:03Z", "message": "Fail for missing id property or no Location in v2 response"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a2fc1f891ec73edfbe513d00efdbf5a92bca938", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/1a2fc1f891ec73edfbe513d00efdbf5a92bca938", "committedDate": "2020-12-05T18:25:44Z", "message": "Merge remote-tracking branch 'origin/master' into OKAPI-875-async-tenant-init"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b994a36f5516ce4957437030f4601e342e3f53ee", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/b994a36f5516ce4957437030f4601e342e3f53ee", "committedDate": "2020-12-06T10:11:55Z", "message": "Return empty rather than null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2608933c0fb96f294009f67e9e17f1c439118a3", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/b2608933c0fb96f294009f67e9e17f1c439118a3", "committedDate": "2020-12-06T11:00:12Z", "message": "delete async tenant init job as well"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "271d29769e092c965524409afd8e1d5400f79fa3", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/271d29769e092c965524409afd8e1d5400f79fa3", "committedDate": "2020-12-06T12:10:14Z", "message": "Fixes to accommodate codestyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1068a3e6191ed67214334477b69b964d5fef721e", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/1068a3e6191ed67214334477b69b964d5fef721e", "committedDate": "2020-12-06T12:25:13Z", "message": "No need to check for null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1276edc6e88706c02eedb4b24a00bf5bc3fdcf58", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/1276edc6e88706c02eedb4b24a00bf5bc3fdcf58", "committedDate": "2020-12-06T14:19:37Z", "message": "Test tenant init error case; delete also init job on error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d9bac517c02383d87d4a4a8aa5b8c1e8320d528", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/8d9bac517c02383d87d4a4a8aa5b8c1e8320d528", "committedDate": "2020-12-07T07:51:49Z", "message": "Supply module in various test calls"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "295e388e604f942e293bd859843a7bae9705d490", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/295e388e604f942e293bd859843a7bae9705d490", "committedDate": "2020-12-07T08:59:38Z", "message": "Refactor; not a timer module in install test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74ef7ffbfdd7ceaed380be3f94ea46b8d3487651", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/74ef7ffbfdd7ceaed380be3f94ea46b8d3487651", "committedDate": "2020-12-07T09:15:54Z", "message": "Relay error messages as well; refactorings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3babc3a5fa3e83ee59ea9b6193590a171e4b8b6", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/f3babc3a5fa3e83ee59ea9b6193590a171e4b8b6", "committedDate": "2020-12-07T11:05:20Z", "message": "Allow POST with no Location for tenant init v2\n\nWhile not in the RAML it might be convenient for some modules\nto just be sync - if they know it will be \"fast\"."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6a4931a13cb1a2848592ff31f3674042cb07582", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/f6a4931a13cb1a2848592ff31f3674042cb07582", "committedDate": "2020-12-07T12:20:18Z", "message": "Fail if Location is returned and v1"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MTU4MzY5", "url": "https://github.com/folio-org/okapi/pull/1053#pullrequestreview-546158369", "createdAt": "2020-12-07T13:43:34Z", "commit": {"oid": "f6a4931a13cb1a2848592ff31f3674042cb07582"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxMzo0MzozNFrOIAnVlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxMzo0MzozNFrOIAnVlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzUxNTQxNQ==", "bodyText": "Are there plans for other substitutions or can we use\n/**\n * Substitute {id} in path\n */\npublic void substPathId(String id) {\n  path = path.replace(\"{id}\", id);\n}", "url": "https://github.com/folio-org/okapi/pull/1053#discussion_r537515415", "createdAt": "2020-12-07T13:43:34Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/bean/ModuleInstance.java", "diffHunk": "@@ -44,6 +44,10 @@ public ModuleInstance(ModuleDescriptor md, RoutingEntry re,\n     this.withRetry = false;\n   }\n \n+  public void substPath(String pattern, String value) {\n+    path = path.replace(pattern, value);\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a4931a13cb1a2848592ff31f3674042cb07582"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5336110510098695c126ca1f8b0ba430b2766b7", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/a5336110510098695c126ca1f8b0ba430b2766b7", "committedDate": "2020-12-08T09:53:24Z", "message": "Update raml-util and documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b078d16c8e6ad33689e51a4a51b30b15a37b74d", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/7b078d16c8e6ad33689e51a4a51b30b15a37b74d", "committedDate": "2020-12-08T09:55:11Z", "message": "Merge remote-tracking branch 'origin/master' into OKAPI-875-async-tenant-init"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd0d0d3c2bcf6be2fe9e4223fe0d249d4a5497c4", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/fd0d0d3c2bcf6be2fe9e4223fe0d249d4a5497c4", "committedDate": "2020-12-08T10:23:45Z", "message": "Remove reference to permissions raml\n\nTenant permissions RAML is only defined in mod-permissions\nmodule. It should be shared in raml-util."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d2f9f8b46c3a48aa6b78a445836a1fd94259762", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/0d2f9f8b46c3a48aa6b78a445836a1fd94259762", "committedDate": "2020-12-08T10:26:51Z", "message": "Typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0aaea881b45afe0f8fd10f594d8eb4bb14e2083", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/b0aaea881b45afe0f8fd10f594d8eb4bb14e2083", "committedDate": "2020-12-08T10:32:21Z", "message": "Minor reformatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25877f91101ff95000c83fdd9fc440bba735dddd", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/25877f91101ff95000c83fdd9fc440bba735dddd", "committedDate": "2020-12-08T10:36:56Z", "message": "Avoid two sections called \"Tenant Interface\""}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NTA0ODMx", "url": "https://github.com/folio-org/okapi/pull/1053#pullrequestreview-547504831", "createdAt": "2020-12-08T18:19:44Z", "commit": {"oid": "25877f91101ff95000c83fdd9fc440bba735dddd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxODoxOTo0NFrOIBu8Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxODoxOTo0NFrOIBu8Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY4ODU1OA==", "bodyText": "Show we add \"permissionsRequired\" : [ ]?", "url": "https://github.com/folio-org/okapi/pull/1053#discussion_r538688558", "createdAt": "2020-12-08T18:19:44Z", "author": {"login": "julianladisch"}, "path": "doc/guide.md", "diffHunk": "@@ -3188,29 +3196,51 @@ etc.  also load sets of reference data. This can be controlled by\n supplying tenant parameters. These are properties (key-value pairs)\n that are passed to the module when enabled or upgraded. Passing those\n are only performed when tenantParameters is specified for install and\n-when the tenant interface is version 1.2.\n+when the tenant interface is version 1.2 and later.\n \n In FOLIO two such parameters are widely recognized:\n \n  * `loadReference` with value `true` loads reference data.\n  * `loadSample` with value `true` loads sample data.\n \n-### Tenant Interface\n+#### Tenant Interface definitions\n \n-The full `_tenant` interface version 1.1/1.2 portion:\n+A module supporting 1.1/1.2 of the `_tenant` interface should use this\n+snippet in the module descriptor:\n \n ```\n    \"id\" : \"_tenant\",\n    \"version\" : \"1.2\",\n    \"interfaceType\" : \"system\",\n    \"handlers\" : [ {\n-     \"methods\" : [ \"POST\", \"DELETE\" ],\n-     \"pathPattern\" : \"/_/tenant\"\n-    }, {\n-     \"methods\" : [ \"POST\" ],\n-     \"pathPattern\" : \"/_/tenant/disable\"\n-    } ]\n+       \"methods\" : [ \"POST\", \"DELETE\" ],\n+       \"pathPattern\" : \"/_/tenant\"\n+      }, {\n+       \"methods\" : [ \"POST\" ],\n+       \"pathPattern\" : \"/_/tenant/disable\"\n+      }\n+   ]\n+```\n+The corresponding RAML definition:\n+[tenant.raml](https://github.com/folio-org/raml/blob/tenant_interface_1_2/ramls/tenant.raml)\n+\n+Snippet of version 2.0 of the `_tenant` interface:\n+\n ```\n+   \"id\" : \"_tenant\",\n+   \"version\" : \"2.0\",\n+   \"interfaceType\" : \"system\",\n+   \"handlers\" : [ {\n+       \"methods\" : [ \"POST\" ],\n+       \"pathPattern\" : \"/_/tenant\"\n+      }, {\n+       \"methods\" : [ \"GET\", \"DELETE\" ],\n+       \"pathPattern\" : \"/_/tenant/{id}\"\n+      }\n+   ]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25877f91101ff95000c83fdd9fc440bba735dddd"}, "originalPosition": 149}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NTgwMDA3", "url": "https://github.com/folio-org/okapi/pull/1053#pullrequestreview-547580007", "createdAt": "2020-12-08T19:55:14Z", "commit": {"oid": "25877f91101ff95000c83fdd9fc440bba735dddd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxOTo1NToxNFrOIBze_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxOTo1NToxNFrOIBze_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc2MzAwNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                curl -HX-Okapi-url:http://localhost:8081 -HX-Okapi-Tenant:testlib \\\n          \n          \n            \n                  -HContent-Type:application/json \"-HAccept:*/*\" \\\n          \n          \n            \n                curl -H \"X-Okapi-url: http://localhost:8081\" -H \"X-Okapi-Tenant: testlib\" \\\n          \n          \n            \n                  -H \"Content-Type: application/json\" -H \"Accept: */*\" \\", "url": "https://github.com/folio-org/okapi/pull/1053#discussion_r538763006", "createdAt": "2020-12-08T19:55:14Z", "author": {"login": "julianladisch"}, "path": "doc/guide.md", "diffHunk": "@@ -3142,9 +3138,19 @@ during the operation.\n \n Add 'loadSample=true` to parameters, to load sample data as well.\n \n+If the module supports version 2 of the `_tenant` interface it should return status 201 with\n+a `Location` header. This signals that the tenant job has started. Use a GET request on the\n+Location path returned to poll for the completion of the tenant job with the\n+\n+    curl -HX-Okapi-url:http://localhost:8081 -HX-Okapi-Tenant:testlib \\\n+      -HContent-Type:application/json \"-HAccept:*/*\" \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25877f91101ff95000c83fdd9fc440bba735dddd"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NTg5MTAx", "url": "https://github.com/folio-org/okapi/pull/1053#pullrequestreview-547589101", "createdAt": "2020-12-08T20:07:57Z", "commit": {"oid": "25877f91101ff95000c83fdd9fc440bba735dddd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMDowNzo1N1rOIBz9gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMDowNzo1N1rOIBz9gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc3MDgxOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            a `Location` header. This signals that the tenant job has started. Use a GET request on the\n          \n          \n            \n            a\n          \n          \n            \n            \n          \n          \n            \n                Location: /_/tenant/6da99bac-457b-499f-89a4-34f4da8e9be8\n          \n          \n            \n                \n          \n          \n            \n            header. This signals that the tenant job has started. Use a GET request on the", "url": "https://github.com/folio-org/okapi/pull/1053#discussion_r538770819", "createdAt": "2020-12-08T20:07:57Z", "author": {"login": "julianladisch"}, "path": "doc/guide.md", "diffHunk": "@@ -3142,9 +3138,19 @@ during the operation.\n \n Add 'loadSample=true` to parameters, to load sample data as well.\n \n+If the module supports version 2 of the `_tenant` interface it should return status 201 with\n+a `Location` header. This signals that the tenant job has started. Use a GET request on the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25877f91101ff95000c83fdd9fc440bba735dddd"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NTg5MTk1", "url": "https://github.com/folio-org/okapi/pull/1053#pullrequestreview-547589195", "createdAt": "2020-12-08T20:08:05Z", "commit": {"oid": "25877f91101ff95000c83fdd9fc440bba735dddd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMDowODowNVrOIBz9wQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMDowODowNVrOIBz9wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc3MDg4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  http://localhost:8081/path\n          \n          \n            \n                  http://localhost:8081/_/tenant/6da99bac-457b-499f-89a4-34f4da8e9be8", "url": "https://github.com/folio-org/okapi/pull/1053#discussion_r538770881", "createdAt": "2020-12-08T20:08:05Z", "author": {"login": "julianladisch"}, "path": "doc/guide.md", "diffHunk": "@@ -3142,9 +3138,19 @@ during the operation.\n \n Add 'loadSample=true` to parameters, to load sample data as well.\n \n+If the module supports version 2 of the `_tenant` interface it should return status 201 with\n+a `Location` header. This signals that the tenant job has started. Use a GET request on the\n+Location path returned to poll for the completion of the tenant job with the\n+\n+    curl -HX-Okapi-url:http://localhost:8081 -HX-Okapi-Tenant:testlib \\\n+      -HContent-Type:application/json \"-HAccept:*/*\" \\\n+      http://localhost:8081/path", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25877f91101ff95000c83fdd9fc440bba735dddd"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60970d469c20df017606ff7e216860b2fa1ae8ea", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/60970d469c20df017606ff7e216860b2fa1ae8ea", "committedDate": "2020-12-08T20:43:47Z", "message": "Update doc/guide.md\n\nCo-authored-by: julianladisch <julianladisch@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a7248c80a41e0ad40bb9f3ca97add86679705d2", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/1a7248c80a41e0ad40bb9f3ca97add86679705d2", "committedDate": "2020-12-08T20:44:10Z", "message": "Update doc/guide.md\n\nCo-authored-by: julianladisch <julianladisch@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NjIzNTE0", "url": "https://github.com/folio-org/okapi/pull/1053#pullrequestreview-547623514", "createdAt": "2020-12-08T20:54:47Z", "commit": {"oid": "25877f91101ff95000c83fdd9fc440bba735dddd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMDo1NDo0N1rOIB1toQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMDo1NDo0N1rOIB1toQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc5OTUyMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String reqId = inst.getPath().replaceFirst(\"^[/_]*([^/]+).*\", \"$1\");\n          \n          \n            \n                // first path segment, but skip leading /_\n          \n          \n            \n                String reqId = inst.getPath().replaceFirst(\"^(/_)?/([^/]+).*\", \"$2\");", "url": "https://github.com/folio-org/okapi/pull/1053#discussion_r538799521", "createdAt": "2020-12-08T20:54:47Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/managers/ProxyService.java", "diffHunk": "@@ -1193,6 +1193,40 @@ private static DeploymentDescriptor pickInstance(List<DeploymentDescriptor> inst\n         });\n   }\n \n+  private Future<OkapiClient> doCallSystemInterface2(\n+      MultiMap headersIn, String tenantId, String authToken,\n+      ModuleInstance inst, String modPerms, String request) {\n+\n+    Map<String, String> headers = sysReqHeaders(headersIn, tenantId, authToken, inst, modPerms);\n+    headers.put(XOkapiHeaders.URL_TO, inst.getUrl());\n+    logger.debug(\"syscall begin {} {}{}\", inst.getMethod(), inst.getUrl(), inst.getPath());\n+    OkapiClient cli = new OkapiClient(this.httpClient, inst.getUrl(), vertx, headers);\n+    String reqId = inst.getPath().replaceFirst(\"^[/_]*([^/]+).*\", \"$1\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25877f91101ff95000c83fdd9fc440bba735dddd"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NjMzMTUw", "url": "https://github.com/folio-org/okapi/pull/1053#pullrequestreview-547633150", "createdAt": "2020-12-08T21:08:19Z", "commit": {"oid": "25877f91101ff95000c83fdd9fc440bba735dddd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMTowODoxOVrOIB2RAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQyMTowODoxOVrOIB2RAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODgwODU3OQ==", "bodyText": "indexOf(\"/_/\") is always 0.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String locationInstallJob = r.getHeader(\"Location\");\n          \n          \n            \n            \n          \n          \n            \n                String path = locationInstallJob.substring(locationInstallJob.indexOf(\"/_/\"));\n          \n          \n            \n                String path = r.getHeader(\"Location\");", "url": "https://github.com/folio-org/okapi/pull/1053#discussion_r538808579", "createdAt": "2020-12-08T21:08:19Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/test/java/org/folio/okapi/InstallTest.java", "diffHunk": "@@ -1119,7 +1047,325 @@ public void installTenantInit(TestContext context) {\n     Assert.assertTrue(\n         \"raml: \" + c.getLastReport().toString(),\n         c.getLastReport().isEmpty());\n-    timerServer.close();\n+    httpServerV1.close();\n+  }\n+\n+  void createAsyncInitModule(TestContext context, String module) {\n+    final String docModule = \"{\" + LS\n+        + \"  \\\"id\\\" : \\\"\" + module + \"\\\",\" + LS\n+        + \"  \\\"name\\\" : \\\"async tenant init module\\\",\" + LS\n+        + \"  \\\"provides\\\" : [ {\" + LS\n+        + \"    \\\"id\\\" : \\\"_tenant\\\",\" + LS\n+        + \"    \\\"version\\\" : \\\"2.0\\\",\" + LS\n+        + \"    \\\"interfaceType\\\" : \\\"system\\\",\" + LS\n+        + \"    \\\"handlers\\\" : [ {\" + LS\n+        + \"      \\\"methods\\\" : [ \\\"POST\\\" ],\" + LS\n+        + \"      \\\"pathPattern\\\" : \\\"/_/tenant\\\",\" + LS\n+        + \"      \\\"permissionsRequired\\\" : [ ]\" + LS\n+        + \"    }, {\" + LS\n+        + \"      \\\"methods\\\" : [ \\\"GET\\\", \\\"DELETE\\\" ],\" + LS\n+        + \"      \\\"pathPattern\\\" : \\\"/_/tenant/{id}\\\",\" + LS\n+        + \"      \\\"permissionsRequired\\\" : [ ]\" + LS\n+        + \"    } ]\" + LS\n+        + \"  } ],\" + LS\n+        + \"  \\\"requires\\\" : [ ]\" + LS\n+        + \"}\";\n+\n+    RestAssuredClient c = api.createRestAssured3();\n+    c.given()\n+        .header(\"Content-Type\", \"application/json\")\n+        .body(docModule).post(\"/_/proxy/modules\").then().statusCode(201);\n+  }\n+\n+  void deployAsyncInitModule(TestContext context, String module, int port) {\n+    final String nodeDoc1 = \"{\" + LS\n+        + \"  \\\"instId\\\" : \\\"localhost-\" + Integer.toString(port) + \"\\\",\" + LS\n+        + \"  \\\"srvcId\\\" : \\\"\" + module + \"\\\",\" + LS\n+        + \"  \\\"url\\\" : \\\"http://localhost:\" + Integer.toString(port) + \"\\\"\" + LS\n+        + \"}\";\n+\n+    RestAssuredClient c = api.createRestAssured3();\n+    c.given().header(\"Content-Type\", \"application/json\")\n+        .body(nodeDoc1).post(\"/_/discovery/modules\")\n+        .then().statusCode(201);\n+    Assert.assertTrue(\"raml: \" + c.getLastReport().toString(),\n+        c.getLastReport().isEmpty());\n+  }\n+\n+  JsonObject enableAndWait(TestContext context, String tenant, String module) {\n+    RestAssuredClient c = api.createRestAssured3();\n+    Response r = c.given()\n+        .header(\"Content-Type\", \"application/json\")\n+        .body(\"[ {\\\"id\\\" : \\\"\" + module + \"\\\", \\\"action\\\" : \\\"enable\\\"} ]\")\n+        .post(\"/_/proxy/tenants/\" + tenant + \"/install?async=true\")\n+        .then().statusCode(201)\n+        .body(equalTo(\"[ {\" + LS\n+            + \"  \\\"id\\\" : \\\"\"+ module + \"\\\",\" + LS\n+            + \"  \\\"action\\\" : \\\"enable\\\"\" + LS\n+            + \"} ]\"))\n+        .extract().response();\n+    Assert.assertTrue(\n+        \"raml: \" + c.getLastReport().toString(),\n+        c.getLastReport().isEmpty());\n+    String locationInstallJob = r.getHeader(\"Location\");\n+\n+    String path = locationInstallJob.substring(locationInstallJob.indexOf(\"/_/\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25877f91101ff95000c83fdd9fc440bba735dddd"}, "originalPosition": 775}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dc652c6da0c14838ce9c3ace4e9c14ba4ad5eaf", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/7dc652c6da0c14838ce9c3ace4e9c14ba4ad5eaf", "committedDate": "2020-12-09T07:50:42Z", "message": "Update doc/guide.md\n\nCo-authored-by: julianladisch <julianladisch@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "809cace0e1d1a256f79671cafb188fd3cb6caf66", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/809cace0e1d1a256f79671cafb188fd3cb6caf66", "committedDate": "2020-12-09T08:13:14Z", "message": "substPathId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d2ae07dfc5a6262dd610830d43608e591cb6cc9", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/7d2ae07dfc5a6262dd610830d43608e591cb6cc9", "committedDate": "2020-12-09T08:13:58Z", "message": "Location is relative URL for our case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MDc2MjAx", "url": "https://github.com/folio-org/okapi/pull/1053#pullrequestreview-548076201", "createdAt": "2020-12-09T11:10:45Z", "commit": {"oid": "7d2ae07dfc5a6262dd610830d43608e591cb6cc9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MDc3Mzc5", "url": "https://github.com/folio-org/okapi/pull/1053#pullrequestreview-548077379", "createdAt": "2020-12-09T11:12:26Z", "commit": {"oid": "7d2ae07dfc5a6262dd610830d43608e591cb6cc9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2788, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}