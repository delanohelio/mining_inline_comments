{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4NDg4OTA1", "number": 1012, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNjoyNTo1MVrOExRq1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNjoyNTo1MVrOExRq1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwMTA1MTc1OnYy", "diffSide": "RIGHT", "path": "doc/guide.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNjoyNTo1MVrOHnU9Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQwODoyNDowM1rOHnphAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk5OTg3OA==", "bodyText": "I think you should break this long line with backslashes.. Of course, so that it's possible to still cut'n paste to shell.", "url": "https://github.com/folio-org/okapi/pull/1012#discussion_r510999878", "createdAt": "2020-10-23T16:25:51Z", "author": {"login": "adamdickmeiss"}, "path": "doc/guide.md", "diffHunk": "@@ -3050,23 +3049,18 @@ Use `modulePermissions` to grant permissions for the token.\n \n ### Instrumentation\n \n-Okapi pushes instrumentation data to an InfluxDB backend, from which\n-they can be shown with something like Grafana. Vert.x pushes some numbers\n-automatically, but various parts of Okapi push their own numbers explicitly,\n-so we can classify by tenant or module. Individual\n-modules may push their own numbers as well, as needed. It is hoped that they\n-will use a key naming scheme that is close to what we do in Okapi.\n+Okapi uses Micrometer to managing metrics and reporting to backends. To enable it,\n+add Java parameter `-Dvertx.metrics.options.enabled=true` first.\n \n-Enabling the metrics via `-enable-metrics` will start sending metrics to `localhost:8086`\n+More Java parameters are needed to config which backends to use\n+* `-DinfluxDbOptions='{\"uri\": \"http://localhost:8086\", \"db\":\"okapi\"}'` - Send metrics to InfluxDB\n+* `-DprometheusOptions='{\"embeddedServerOptions\": {\"port\": 9930}}'` - Expose `<server>:9930/metrics` for Prometheus\n+* `-DjmxMetricsOptions='{\"domain\": \"org.folio.metrics\"}'` - JMX\n \n-Follwing Java parameters can be used to config InfluxDB connection.\n-* `influxUrl` - default to `http://localhost:8086`\n-* `influxDbName` - default to `okapi`\n-* `influxUser` - default to null\n-* `influxPassword` - default to null\n+Another Java parameter can be used to filter metrics\n+* `-DmetricsPrefixFilter=org.folio` - Will only report metrics with name starting `org.folio`\n \n-For example: `java -DinfluxUrl=http://influx.yourdomain.io:8086 -jar okapi-core/target/okapi-core-fat.jar dev -enable-metrics` then metrics\n-will be sent to `http://influx.yourdomain.io:8086`\n+A full example: `java -Dvertx.metrics.options.enabled=true -DmetricsPrefixFilter=org.folio -DinfluxDbOptions='{\"uri\": \"http://localhost:8086\", \"db\":\"okapi\"}' -DprometheusOptions='{\"embeddedServerOptions\": {\"port\": 9930}}' -DjmxMetricsOptions='{\"domain\": \"org.folio\"}' -jar okapi-core/target/okapi-core-fat.jar dev`\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "954a5f2a60787cc414524742cfa374cc21ca21a8"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTMzNjcwNw==", "bodyText": "Reformatted as suggested.", "url": "https://github.com/folio-org/okapi/pull/1012#discussion_r511336707", "createdAt": "2020-10-24T08:24:03Z", "author": {"login": "hjiebsco"}, "path": "doc/guide.md", "diffHunk": "@@ -3050,23 +3049,18 @@ Use `modulePermissions` to grant permissions for the token.\n \n ### Instrumentation\n \n-Okapi pushes instrumentation data to an InfluxDB backend, from which\n-they can be shown with something like Grafana. Vert.x pushes some numbers\n-automatically, but various parts of Okapi push their own numbers explicitly,\n-so we can classify by tenant or module. Individual\n-modules may push their own numbers as well, as needed. It is hoped that they\n-will use a key naming scheme that is close to what we do in Okapi.\n+Okapi uses Micrometer to managing metrics and reporting to backends. To enable it,\n+add Java parameter `-Dvertx.metrics.options.enabled=true` first.\n \n-Enabling the metrics via `-enable-metrics` will start sending metrics to `localhost:8086`\n+More Java parameters are needed to config which backends to use\n+* `-DinfluxDbOptions='{\"uri\": \"http://localhost:8086\", \"db\":\"okapi\"}'` - Send metrics to InfluxDB\n+* `-DprometheusOptions='{\"embeddedServerOptions\": {\"port\": 9930}}'` - Expose `<server>:9930/metrics` for Prometheus\n+* `-DjmxMetricsOptions='{\"domain\": \"org.folio.metrics\"}'` - JMX\n \n-Follwing Java parameters can be used to config InfluxDB connection.\n-* `influxUrl` - default to `http://localhost:8086`\n-* `influxDbName` - default to `okapi`\n-* `influxUser` - default to null\n-* `influxPassword` - default to null\n+Another Java parameter can be used to filter metrics\n+* `-DmetricsPrefixFilter=org.folio` - Will only report metrics with name starting `org.folio`\n \n-For example: `java -DinfluxUrl=http://influx.yourdomain.io:8086 -jar okapi-core/target/okapi-core-fat.jar dev -enable-metrics` then metrics\n-will be sent to `http://influx.yourdomain.io:8086`\n+A full example: `java -Dvertx.metrics.options.enabled=true -DmetricsPrefixFilter=org.folio -DinfluxDbOptions='{\"uri\": \"http://localhost:8086\", \"db\":\"okapi\"}' -DprometheusOptions='{\"embeddedServerOptions\": {\"port\": 9930}}' -DjmxMetricsOptions='{\"domain\": \"org.folio\"}' -jar okapi-core/target/okapi-core-fat.jar dev`\n ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDk5OTg3OA=="}, "originalCommit": {"oid": "954a5f2a60787cc414524742cfa374cc21ca21a8"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 176, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}