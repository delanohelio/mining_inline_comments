{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5MDU3MDIz", "number": 1042, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMzo1MTowNVrOE3toag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNTo0NToxMlrOE4OMkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2ODU0NzYyOnYy", "diffSide": "RIGHT", "path": "okapi-core/src/main/java/org/folio/okapi/service/impl/DockerModuleHandle.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxMzo1MTowNVrOHxN-qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNzowOTowNVrOHxWVMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3MTMwNA==", "bodyText": "I think it's better to assign a message for this by adding an entry in okapi-core/src/main/resources/infra-messages/Messages_en.properties", "url": "https://github.com/folio-org/okapi/pull/1042#discussion_r521371304", "createdAt": "2020-11-11T13:51:05Z", "author": {"login": "adamdickmeiss"}, "path": "okapi-core/src/main/java/org/folio/okapi/service/impl/DockerModuleHandle.java", "diffHunk": "@@ -37,6 +37,10 @@\n @java.lang.SuppressWarnings({\"squid:S1192\"})\n public class DockerModuleHandle implements ModuleHandle {\n \n+  static final String DOCKER_REGISTRIES_EMPTY_LIST =\n+      \"dockerRegistries=[] contains no registry and disables docker pull. \"\n+          + \"For unauthenticated pull from DockerHub use [ {} ].\";\n+\n   private final Logger logger;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27c8300ea11a37e7c743e2e702239a72114377f2"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQzMTEyMw==", "bodyText": "https://github.com/folio-org/okapi/tree/master/okapi-core/src/main/resources/infra-messages hasn't been used since 2018. And there isn't any translation yet. I would rather propose to delete infra-messages and move the message into the code to improve code readability.", "url": "https://github.com/folio-org/okapi/pull/1042#discussion_r521431123", "createdAt": "2020-11-11T15:19:22Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/service/impl/DockerModuleHandle.java", "diffHunk": "@@ -37,6 +37,10 @@\n @java.lang.SuppressWarnings({\"squid:S1192\"})\n public class DockerModuleHandle implements ModuleHandle {\n \n+  static final String DOCKER_REGISTRIES_EMPTY_LIST =\n+      \"dockerRegistries=[] contains no registry and disables docker pull. \"\n+          + \"For unauthenticated pull from DockerHub use [ {} ].\";\n+\n   private final Logger logger;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3MTMwNA=="}, "originalCommit": {"oid": "27c8300ea11a37e7c743e2e702239a72114377f2"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ5ODUxMA==", "bodyText": "Are you kidding?", "url": "https://github.com/folio-org/okapi/pull/1042#discussion_r521498510", "createdAt": "2020-11-11T16:54:51Z", "author": {"login": "adamdickmeiss"}, "path": "okapi-core/src/main/java/org/folio/okapi/service/impl/DockerModuleHandle.java", "diffHunk": "@@ -37,6 +37,10 @@\n @java.lang.SuppressWarnings({\"squid:S1192\"})\n public class DockerModuleHandle implements ModuleHandle {\n \n+  static final String DOCKER_REGISTRIES_EMPTY_LIST =\n+      \"dockerRegistries=[] contains no registry and disables docker pull. \"\n+          + \"For unauthenticated pull from DockerHub use [ {} ].\";\n+\n   private final Logger logger;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3MTMwNA=="}, "originalCommit": {"oid": "27c8300ea11a37e7c743e2e702239a72114377f2"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUwODE0Ng==", "bodyText": "FWIW, let's must merge this now and have this discussion later.. The messages returned IMHO should be accommodated with the message ID .. Eg (OKAPI-12345) messsage .. It serves as a nice unique way of telling what has returned the message. Of course, the log might have backtraces and all.. But for a system user, it's nice to be able to spot WHAT has actually generated some message .. Okapi? RMB ? Or code from a module?", "url": "https://github.com/folio-org/okapi/pull/1042#discussion_r521508146", "createdAt": "2020-11-11T17:09:05Z", "author": {"login": "adamdickmeiss"}, "path": "okapi-core/src/main/java/org/folio/okapi/service/impl/DockerModuleHandle.java", "diffHunk": "@@ -37,6 +37,10 @@\n @java.lang.SuppressWarnings({\"squid:S1192\"})\n public class DockerModuleHandle implements ModuleHandle {\n \n+  static final String DOCKER_REGISTRIES_EMPTY_LIST =\n+      \"dockerRegistries=[] contains no registry and disables docker pull. \"\n+          + \"For unauthenticated pull from DockerHub use [ {} ].\";\n+\n   private final Logger logger;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTM3MTMwNA=="}, "originalCommit": {"oid": "27c8300ea11a37e7c743e2e702239a72114377f2"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3Mzg4MzA2OnYy", "diffSide": "RIGHT", "path": "dist/okapi.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNTo0NToxMlrOHyA81w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNTozMDoyNFrOH0ECHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIwNjQyMw==", "bodyText": "@julianladisch in my testing using Ubuntu Focal, if $docker_registries is undefined, this fails if quoted (though it works if $docker_registries is defined). I confess I'm not sure why. Did it work in your testing?", "url": "https://github.com/folio-org/okapi/pull/1042#discussion_r522206423", "createdAt": "2020-11-12T15:45:12Z", "author": {"login": "wafschneider"}, "path": "dist/okapi.sh", "diffHunk": "@@ -46,7 +53,7 @@ parse_okapi_conf()  {\n          chmod 600 \"${PID_DIR}/okapi-runtime.conf\"\n          # include postgres connection arguments only if defined\n          jq -n --arg WARNING \"AUTOMATICALLY CREATED FILE, DO NOT EDIT!\"    \\\n-               --argjson dockerRegistries  ${docker_registries:-[\\{\\}]}    \\\n+               --argjson dockerRegistries  \"${docker_registries:-[\\{\\}]}\"  \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af2262a1a42e2eedc1262352c6701265dae7874b"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM1NDA3OA==", "bodyText": "Good catch!\nThis is correct: \"${docker_registries:-[{\\}]}\"\nWhen using quotes only the closing } needs to be masked.\n$ docker run --rm=true -it ubuntu:focal\nroot@e4921c64df45:/# apt-get update; apt-get install -y jq\nroot@e4921c64df45:/# jq -n --argjson dockerRegistries \"${docker_registries:-[{\\}]}\" \"{ \\$dockerRegistries }\"                                   {\n  \"dockerRegistries\": [\n    {}\n  ]\n}", "url": "https://github.com/folio-org/okapi/pull/1042#discussion_r524354078", "createdAt": "2020-11-16T15:30:24Z", "author": {"login": "julianladisch"}, "path": "dist/okapi.sh", "diffHunk": "@@ -46,7 +53,7 @@ parse_okapi_conf()  {\n          chmod 600 \"${PID_DIR}/okapi-runtime.conf\"\n          # include postgres connection arguments only if defined\n          jq -n --arg WARNING \"AUTOMATICALLY CREATED FILE, DO NOT EDIT!\"    \\\n-               --argjson dockerRegistries  ${docker_registries:-[\\{\\}]}    \\\n+               --argjson dockerRegistries  \"${docker_registries:-[\\{\\}]}\"  \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjIwNjQyMw=="}, "originalCommit": {"oid": "af2262a1a42e2eedc1262352c6701265dae7874b"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 204, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}