{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMTg5MTYx", "number": 927, "title": "FOLIO-2603 (BTW JIRA has changed to OKAPI-851)", "bodyText": "See FOLIO-2603: ensure compatibility between Okapi 3.0 and mod-perms/mod-authtoken (BTW The JIRA has changed to OKAPI-851)", "createdAt": "2020-05-23T01:21:57Z", "url": "https://github.com/folio-org/okapi/pull/927", "merged": true, "mergeCommit": {"oid": "0d7431bf115e74b27b303cdadd6168a41d0413fc"}, "closed": true, "closedAt": "2020-05-27T18:59:06Z", "author": {"login": "hjiebsco"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjGXu1gH2gAyNDIyMTg5MTYxOmQ0Y2RiMDI4MWE3MjU3YmVhN2Q5ZDYzM2JmOWQwZDQ0MDc0ZDNiY2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcld42EgH2gAyNDIyMTg5MTYxOmY3OWZlYjQ3MWVjNzdjNTk5MTllYmZjMTZjNjc0NjVkZDJiY2IwNTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d4cdb0281a7257bea7d9d633bf9d0d44074d3bcd", "author": {"user": {"login": "hjiebsco", "name": "Hongwei Ji"}}, "url": "https://github.com/folio-org/okapi/commit/d4cdb0281a7257bea7d9d633bf9d0d44074d3bcd", "committedDate": "2020-05-20T10:18:47Z", "message": "Make compatible with 1.0 tenantpermissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8df31eb89649919fb2b921bbe9650f4a33f5e059", "author": {"user": {"login": "hjiebsco", "name": "Hongwei Ji"}}, "url": "https://github.com/folio-org/okapi/commit/8df31eb89649919fb2b921bbe9650f4a33f5e059", "committedDate": "2020-05-23T01:11:55Z", "message": "Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b17f238a55bdc7393028fcda72c7c8097584475", "author": {"user": {"login": "hjiebsco", "name": "Hongwei Ji"}}, "url": "https://github.com/folio-org/okapi/commit/7b17f238a55bdc7393028fcda72c7c8097584475", "committedDate": "2020-05-23T01:23:54Z", "message": "Merge branch 'master' into FOLIO-2603"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3ODI4NDc4", "url": "https://github.com/folio-org/okapi/pull/927#pullrequestreview-417828478", "createdAt": "2020-05-25T17:52:43Z", "commit": {"oid": "7b17f238a55bdc7393028fcda72c7c8097584475"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxNzo1Mjo0NFrOGaHIRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxNzo1Mjo0NFrOGaHIRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAzMjk2Ng==", "bodyText": "Can private Set<String> expandedPermModuleTenants = new ConcurrentHashMap<String, Boolean>().newKeySet() been used instead to avoid the unused Boolean?", "url": "https://github.com/folio-org/okapi/pull/927#discussion_r430032966", "createdAt": "2020-05-25T17:52:44Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/managers/ModuleManager.java", "diffHunk": "@@ -44,6 +47,8 @@\n   private final ModuleStore moduleStore;\n   private Vertx vertx;\n   private final Messages messages = Messages.getInstance();\n+  // tenants with new permission module (_tenantPermissions version 1.1 or later)\n+  private ConcurrentMap<String, Boolean> newPermModuleTenants = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b17f238a55bdc7393028fcda72c7c8097584475"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3ODI4ODE5", "url": "https://github.com/folio-org/okapi/pull/927#pullrequestreview-417828819", "createdAt": "2020-05-25T17:53:54Z", "commit": {"oid": "7b17f238a55bdc7393028fcda72c7c8097584475"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxNzo1Mzo1NVrOGaHJhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxNzo1Mzo1NVrOGaHJhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAzMzI4Ng==", "bodyText": "Can you replace \"new\" by a more descriptive word, for example \"expanded\"?", "url": "https://github.com/folio-org/okapi/pull/927#discussion_r430033286", "createdAt": "2020-05-25T17:53:55Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/managers/ModuleManager.java", "diffHunk": "@@ -420,4 +429,21 @@ public void getEnabledModules(Tenant ten,\n     }\n     futures.all(mdl, fut);\n   }\n+\n+  private void updateNewPermModuleTenants(String tenant, ModuleDescriptor md) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b17f238a55bdc7393028fcda72c7c8097584475"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3ODI4OTAw", "url": "https://github.com/folio-org/okapi/pull/927#pullrequestreview-417828900", "createdAt": "2020-05-25T17:54:13Z", "commit": {"oid": "7b17f238a55bdc7393028fcda72c7c8097584475"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxNzo1NDoxM1rOGaHJzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxNzo1NDoxM1rOGaHJzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAzMzM1OQ==", "bodyText": "Can you replace \"new\" by a more descriptive word, for example \"expanded\"?", "url": "https://github.com/folio-org/okapi/pull/927#discussion_r430033359", "createdAt": "2020-05-25T17:54:13Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/managers/ModuleManager.java", "diffHunk": "@@ -420,4 +429,21 @@ public void getEnabledModules(Tenant ten,\n     }\n     futures.all(mdl, fut);\n   }\n+\n+  private void updateNewPermModuleTenants(String tenant, ModuleDescriptor md) {\n+    InterfaceDescriptor id = md.getSystemInterface(\"_tenantPermissions\");\n+    if (id == null) {\n+      return;\n+    }\n+    if (id.getVersion().equals(\"1.0\")) {\n+      newPermModuleTenants.remove(tenant);\n+    } else {\n+      newPermModuleTenants.put(tenant, Boolean.TRUE);\n+    }\n+  }\n+\n+  public ConcurrentMap<String, Boolean> getNewPermModuleTenants() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b17f238a55bdc7393028fcda72c7c8097584475"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cdd3807f86fc1a3d1a05490d05a2ed88b52647f", "author": {"user": {"login": "hjiebsco", "name": "Hongwei Ji"}}, "url": "https://github.com/folio-org/okapi/commit/5cdd3807f86fc1a3d1a05490d05a2ed88b52647f", "committedDate": "2020-05-26T13:24:24Z", "message": "Rename as suggested by PR review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "baa2096856af73eb2af69f39cf3347178aac123a", "author": {"user": {"login": "hjiebsco", "name": "Hongwei Ji"}}, "url": "https://github.com/folio-org/okapi/commit/baa2096856af73eb2af69f39cf3347178aac123a", "committedDate": "2020-05-26T13:29:46Z", "message": "Fix method call changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MzA3NTUx", "url": "https://github.com/folio-org/okapi/pull/927#pullrequestreview-418307551", "createdAt": "2020-05-26T13:40:12Z", "commit": {"oid": "baa2096856af73eb2af69f39cf3347178aac123a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f79feb471ec77c59919ebfc16c67465dd2bcb050", "author": {"user": {"login": "hjiebsco", "name": "Hongwei Ji"}}, "url": "https://github.com/folio-org/okapi/commit/f79feb471ec77c59919ebfc16c67465dd2bcb050", "committedDate": "2020-05-27T18:50:37Z", "message": "Merge branch 'master' into FOLIO-2603"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2961, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}