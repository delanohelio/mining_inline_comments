{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3ODA2ODU1", "number": 973, "title": "Event Bus check OKAPI-891", "bodyText": "This PR makes Okapi check the Event Bus upon startup. Note that this requires that ALL Okapi instances are compiled with this check. If not, it will assume that Event Bus is not working.. Each party must be consuming on the particular message.\nThere's a slight chance that there's a race condition with this.. If the node list changes during startup, there might be a failure.. But this will only affect the starting Okapi process .. Not something that is already running.", "createdAt": "2020-09-16T08:00:59Z", "url": "https://github.com/folio-org/okapi/pull/973", "merged": true, "mergeCommit": {"oid": "ed6b33288f054dbbb7eefc12a033e40258bd3b9f"}, "closed": true, "closedAt": "2020-10-01T07:31:59Z", "author": {"login": "adamdickmeiss"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJXrbGAH2gAyNDg3ODA2ODU1OmY5Njk5ZWZiNzM5ODU0YWQxYWM3NjMwNGI3ZTI2N2E2NmMwYjkzNzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOAa9GgH2gAyNDg3ODA2ODU1OjVjZWU2NjVlMTkzNzY3ZTlkNDE2N2MwYzFmMTJlMDhmYTY1NGRiMzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f9699efb739854ad1ac76304b7e267a66c0b9378", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/f9699efb739854ad1ac76304b7e267a66c0b9378", "committedDate": "2020-09-16T07:57:48Z", "message": "Event Bus check OKAPI-891"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c570d4f1236fdf04b67de63aa7b59283ccb6389", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/8c570d4f1236fdf04b67de63aa7b59283ccb6389", "committedDate": "2020-09-16T08:15:35Z", "message": "Return with failure; slightly more coverage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwODQ2NDM4", "url": "https://github.com/folio-org/okapi/pull/973#pullrequestreview-490846438", "createdAt": "2020-09-17T17:49:18Z", "commit": {"oid": "8c570d4f1236fdf04b67de63aa7b59283ccb6389"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNzo0OToxOVrOHTuhMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNzo0OToxOVrOHTuhMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ0NzE1NA==", "bodyText": "To handle the race condition when the node list changes you may have a check3 method that runs check(Vertx, ClusterManager) up to three times if it fails.", "url": "https://github.com/folio-org/okapi/pull/973#discussion_r490447154", "createdAt": "2020-09-17T17:49:19Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/util/EventBusChecker.java", "diffHunk": "@@ -0,0 +1,51 @@\n+package org.folio.okapi.util;\n+\n+import io.vertx.core.CompositeFuture;\n+import io.vertx.core.Future;\n+import io.vertx.core.Vertx;\n+import io.vertx.core.eventbus.DeliveryOptions;\n+import io.vertx.core.spi.cluster.ClusterManager;\n+import java.util.LinkedList;\n+import java.util.List;\n+\n+public class EventBusChecker {\n+  private static final String EVENT_NODE_CHECK = \"org.folio.okapi.node.check.\";\n+\n+  /**\n+   * Check that event bus is operational by sending a message to each party.\n+   * @param vertx Vert.x handle\n+   * @param clusterManager manager ; null if not in clustered mode\n+   * @return async result\n+   */\n+  public static Future<Void> check(Vertx vertx, ClusterManager clusterManager) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c570d4f1236fdf04b67de63aa7b59283ccb6389"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwODQ2NjA0", "url": "https://github.com/folio-org/okapi/pull/973#pullrequestreview-490846604", "createdAt": "2020-09-17T17:49:31Z", "commit": {"oid": "8c570d4f1236fdf04b67de63aa7b59283ccb6389"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbffd841b4756b6ba9f0b6296245b96eb95a25b8", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/dbffd841b4756b6ba9f0b6296245b96eb95a25b8", "committedDate": "2020-09-19T16:02:28Z", "message": "Merge branch 'master' into OKAPI-891-event-bus-check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e458f714b317e36ce022b1fe80c3a4fe3158b39f", "author": {"user": {"login": "hjiebsco", "name": "Hongwei Ji"}}, "url": "https://github.com/folio-org/okapi/commit/e458f714b317e36ce022b1fe80c3a4fe3158b39f", "committedDate": "2020-09-21T21:35:06Z", "message": "Merge branch 'master' into OKAPI-891-event-bus-check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1aa3436cd1f6b08bc5cc53c78463f5ad5b7b01e", "author": {"user": {"login": "hjiebsco", "name": "Hongwei Ji"}}, "url": "https://github.com/folio-org/okapi/commit/c1aa3436cd1f6b08bc5cc53c78463f5ad5b7b01e", "committedDate": "2020-09-22T20:11:24Z", "message": "Merge branch 'master' into OKAPI-891-event-bus-check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MDM1Mjg1", "url": "https://github.com/folio-org/okapi/pull/973#pullrequestreview-495035285", "createdAt": "2020-09-23T20:46:46Z", "commit": {"oid": "c1aa3436cd1f6b08bc5cc53c78463f5ad5b7b01e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5eb750c80d72a5b6a1b7a870284987f687b40797", "author": {"user": {"login": "hjiebsco", "name": "Hongwei Ji"}}, "url": "https://github.com/folio-org/okapi/commit/5eb750c80d72a5b6a1b7a870284987f687b40797", "committedDate": "2020-09-23T20:46:52Z", "message": "Merge branch 'master' into OKAPI-891-event-bus-check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03b927fc5dad453d53dcccd0fb1ecf49055ec1ef", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/03b927fc5dad453d53dcccd0fb1ecf49055ec1ef", "committedDate": "2020-09-30T17:32:07Z", "message": "Merge branch 'master' into OKAPI-891-event-bus-check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c47ecf35296155b8a2079295668a6334dcb3ffc5", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/c47ecf35296155b8a2079295668a6334dcb3ffc5", "committedDate": "2020-09-30T17:40:56Z", "message": "Warn rather than fail if EventBusCheck fails"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cee665e193767e9d4167c0c1f12e08fa654db37", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/5cee665e193767e9d4167c0c1f12e08fa654db37", "committedDate": "2020-09-30T17:41:37Z", "message": "Merge branch 'OKAPI-891-event-bus-check' of github.com:folio-org/okapi into OKAPI-891-event-bus-check"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2833, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}