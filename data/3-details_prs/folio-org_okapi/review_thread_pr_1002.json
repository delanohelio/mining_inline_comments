{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1MTA5ODY0", "number": 1002, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMjoxNzoyOVrOEvSPmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMjoxNzoyOVrOEvSPmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4MDE3NDMzOnYy", "diffSide": "RIGHT", "path": "okapi-core/src/main/java/org/folio/okapi/managers/ProxyService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMjoxNzoyOVrOHkLehw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQxMjoxNzoyOVrOHkLehw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY5ODgyMw==", "bodyText": "Checking for tokenCache == null seems redundant. It is always constructed. Perhaps it should be final?", "url": "https://github.com/folio-org/okapi/pull/1002#discussion_r507698823", "createdAt": "2020-10-19T12:17:29Z", "author": {"login": "adamdickmeiss"}, "path": "okapi-core/src/main/java/org/folio/okapi/managers/ProxyService.java", "diffHunk": "@@ -203,9 +203,20 @@ private boolean resolveRedirects(ProxyContext pc,\n    */\n   private boolean checkTokenCache(String tenant, HttpServerRequest req, String pathPattern,\n       ModuleInstance mi) {\n-    CacheEntry cached =\n-        tokenCache.get(tenant, req.method().name(), pathPattern == null ? req.path() : pathPattern,\n-            req.getHeader(XOkapiHeaders.USER_ID), req.headers().get(XOkapiHeaders.TOKEN));\n+    String token = req.headers().get(XOkapiHeaders.TOKEN);\n+    if (token == null) {\n+      mi.setAuthToken(null);\n+      mi.setUserId(null);\n+      mi.setPermissions(null);\n+      return false;\n+    }\n+\n+    String pathComponent = pathPattern == null ? req.path() : pathPattern;\n+\n+    CacheEntry cached = tokenCache == null ? null\n+        : tokenCache.get(tenant, req.method().name(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dab4739dc57fb4c0eb470d1a84fee8aedd1ff467"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 169, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}