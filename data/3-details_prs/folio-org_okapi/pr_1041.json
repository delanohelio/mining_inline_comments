{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NzYxNDgz", "number": 1041, "title": "Support both \"http.port\" and \"port\" property variables", "bodyText": "\"http.port\" is the command-line option name that all RMB based\nmodules support:\nhttps://github.com/folio-org/raml-module-builder#command-line-options\nFor consistency Okapi should also support this.\nThe guide.md should show \"http.port\" because most modules\nare RMB based and support only this form.", "createdAt": "2020-11-10T21:00:52Z", "url": "https://github.com/folio-org/okapi/pull/1041", "merged": true, "mergeCommit": {"oid": "edfea415905a2cef8c43666117c355d5bbc8868e"}, "closed": true, "closedAt": "2020-12-14T12:24:23Z", "author": {"login": "julianladisch"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbPwrQAH2gAyNTE4NzYxNDgzOjI2NmZjNjA5ZjdhZWJjYzE5Zjc3NjA4YmVkY2I2YTY3NzlmNGI2Njc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmCKqkgH2gAyNTE4NzYxNDgzOmVjODA0MTU3Y2ZkMmY1MDEyZGMxOGY3NTE4NTM2YWIzZTg4NmMwNDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "266fc609f7aebcc19f77608bedcb6a6779f4b667", "author": {"user": {"login": "julianladisch", "name": null}}, "url": "https://github.com/folio-org/okapi/commit/266fc609f7aebcc19f77608bedcb6a6779f4b667", "committedDate": "2020-11-10T20:54:56Z", "message": "Support both \"http.port\" and \"port\" property variables\n\n\"http.port\" is the command-line option name that all RMB based\nmodules support:\nhttps://github.com/folio-org/raml-module-builder#command-line-options\n\nFor consistency Okapi should also support this.\n\nThe guide.md should show \"http.port\" because most modules\nare RMB based and support only this form."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MzQzMzk3", "url": "https://github.com/folio-org/okapi/pull/1041#pullrequestreview-528343397", "createdAt": "2020-11-11T16:39:14Z", "commit": {"oid": "266fc609f7aebcc19f77608bedcb6a6779f4b667"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNjozOToxNVrOHxVHug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNjozOToxNVrOHxVHug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ4ODMxNA==", "bodyText": "So http.port is only supported as property. Not as Json configuration. Is that intended?", "url": "https://github.com/folio-org/okapi/pull/1041#discussion_r521488314", "createdAt": "2020-11-11T16:39:15Z", "author": {"login": "adamdickmeiss"}, "path": "okapi-core/src/main/java/org/folio/okapi/MainVerticle.java", "diffHunk": "@@ -83,7 +83,8 @@ public void init(Vertx vertx, Context context) {\n     super.init(vertx, context);\n \n     JsonObject config = context.config();\n-    port = Integer.parseInt(Config.getSysConf(\"port\", \"9130\", config));\n+    String portString = System.getProperty(\"http.port\", \"9130\");\n+    port = Integer.parseInt(Config.getSysConf(\"port\", portString, config));\n     String okapiVersion2 = Config.getSysConf(\"okapiVersion\", null, config);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "266fc609f7aebcc19f77608bedcb6a6779f4b667"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97238ed75b784ad27b1478d0de12ace617123a9b", "author": {"user": {"login": "julianladisch", "name": null}}, "url": "https://github.com/folio-org/okapi/commit/97238ed75b784ad27b1478d0de12ace617123a9b", "committedDate": "2020-11-11T21:03:26Z", "message": "Config.getSysConf with 2 keys, http.port in okapi.sh"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4ODQ0ODYz", "url": "https://github.com/folio-org/okapi/pull/1041#pullrequestreview-528844863", "createdAt": "2020-11-12T08:21:28Z", "commit": {"oid": "97238ed75b784ad27b1478d0de12ace617123a9b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwODoyMToyOFrOHxvQWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwODoyMToyOFrOHxvQWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkxNjUwNQ==", "bodyText": "I'm not sure I follow. This is a value, not a name. Hopefully no system tampers with values. So I don't think we should excuse anything here.", "url": "https://github.com/folio-org/okapi/pull/1041#discussion_r521916505", "createdAt": "2020-11-12T08:21:28Z", "author": {"login": "adamdickmeiss"}, "path": "dist/okapi.sh", "diffHunk": "@@ -121,9 +121,19 @@ parse_okapi_conf()  {\n       OKAPI_JAVA_OPTS+=\" -Dhost=${host}\"\n    fi\n \n-   # configure okapi port\n-   if [ \"$port\" ]; then\n-      OKAPI_JAVA_OPTS+=\" -Dport=${port}\"\n+   # configure okapi http port\n+   # Environment variables with periods/dots in their names are deprecated\n+   # because a period is not POSIX compliant and therefore some shells, notably,\n+   # the BusyBox /bin/sh included in Alpine Linux, strip them:\n+   # https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap08.html\n+   # https://github.com/docker-library/docs/tree/master/openjdk#environment-variables-with-periods-in-their-names\n+   # https://wiki.ubuntu.com/DashAsBinSh\n+   # https://wiki.ubuntu.com/DashAsBinSh/Spec\n+   # Java property variable names allow periods/dots.\n+   if [ \"$http_port\" ]; then\n+      OKAPI_JAVA_OPTS+=\" -Dhttp.port=${http_port}\"\n+   elif [ \"$port\" ]; then\n+      OKAPI_JAVA_OPTS+=\" -Dhttp.port=${port}\"\n    fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97238ed75b784ad27b1478d0de12ace617123a9b"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4ODg1MDA1", "url": "https://github.com/folio-org/okapi/pull/1041#pullrequestreview-528885005", "createdAt": "2020-11-12T09:12:40Z", "commit": {"oid": "97238ed75b784ad27b1478d0de12ace617123a9b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMjI5Njk4", "url": "https://github.com/folio-org/okapi/pull/1041#pullrequestreview-532229698", "createdAt": "2020-11-17T10:37:20Z", "commit": {"oid": "97238ed75b784ad27b1478d0de12ace617123a9b"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMDgxMDM2", "url": "https://github.com/folio-org/okapi/pull/1041#pullrequestreview-550081036", "createdAt": "2020-12-11T13:06:33Z", "commit": {"oid": "97238ed75b784ad27b1478d0de12ace617123a9b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec804157cfd2f5012dc18f7518536ab3e886c041", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/ec804157cfd2f5012dc18f7518536ab3e886c041", "committedDate": "2020-12-14T09:17:49Z", "message": "Merge branch 'master' into http.port"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2914, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}