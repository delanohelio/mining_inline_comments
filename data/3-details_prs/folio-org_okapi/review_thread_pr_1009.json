{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NzI5NTUw", "number": 1009, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMjo0MzoyMVrOEwv2Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMjo0MzoyMVrOEwv2Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NTUwOTkxOnYy", "diffSide": "RIGHT", "path": "okapi-core/src/main/java/org/folio/okapi/util/DepResolution.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMjo0MzoyMVrOHmfzyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMjo1NTo0M1rOHmgUxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEyOTA5OQ==", "bodyText": "The list values are not needed. This can be simplified if upgradeLeafs2 returns a boolean that is true if something upgraded:\nwhile (upgradeLeafs2(modsAvailable, modsEnabled, tml)) {\n  // something upgraded.. try again\n}", "url": "https://github.com/folio-org/okapi/pull/1009#discussion_r510129099", "createdAt": "2020-10-22T12:43:21Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/util/DepResolution.java", "diffHunk": "@@ -506,27 +506,41 @@ private static void addOrReplace(List<TenantModuleDescriptor> tml, ModuleDescrip\n   }\n \n   private static void upgradeLeafs(\n-      ModuleDescriptor md, Map<String, ModuleDescriptor> modsAvailable,\n+      Map<String, ModuleDescriptor> modsAvailable,\n       Map<String, ModuleDescriptor> modsEnabled, List<TenantModuleDescriptor> tml) {\n-    Iterator<ModuleDescriptor> it = modsEnabled.values().iterator();\n-    while (it.hasNext()) {\n-      ModuleDescriptor me = it.next();\n-      if (me.equals(md)) {\n-        continue;\n+    while (true) {\n+      List<String> ret = upgradeLeafs2(modsAvailable, modsEnabled, tml);\n+      if (ret == null) { // nothing done\n+        return;\n+      }\n+      if (!ret.isEmpty()) { // error\n+        return;\n       }\n-      ModuleDescriptor mdTo = null;\n-      for (InterfaceDescriptor prov : md.getProvidesList()) {\n-        for (InterfaceDescriptor req : me.getRequiresOptionalList()) {\n-          if (prov.getId().equals(req.getId()) && !prov.isCompatible(req)) {\n-            mdTo = lookupAvailableForProvided(modsAvailable, me, prov, mdTo);\n+      // something upgraded.. try again\n+    }\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a75380804e2d96d327ec1ddbfa626955be7a0e00"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEzNzU0Mw==", "bodyText": "ok", "url": "https://github.com/folio-org/okapi/pull/1009#discussion_r510137543", "createdAt": "2020-10-22T12:55:43Z", "author": {"login": "adamdickmeiss"}, "path": "okapi-core/src/main/java/org/folio/okapi/util/DepResolution.java", "diffHunk": "@@ -506,27 +506,41 @@ private static void addOrReplace(List<TenantModuleDescriptor> tml, ModuleDescrip\n   }\n \n   private static void upgradeLeafs(\n-      ModuleDescriptor md, Map<String, ModuleDescriptor> modsAvailable,\n+      Map<String, ModuleDescriptor> modsAvailable,\n       Map<String, ModuleDescriptor> modsEnabled, List<TenantModuleDescriptor> tml) {\n-    Iterator<ModuleDescriptor> it = modsEnabled.values().iterator();\n-    while (it.hasNext()) {\n-      ModuleDescriptor me = it.next();\n-      if (me.equals(md)) {\n-        continue;\n+    while (true) {\n+      List<String> ret = upgradeLeafs2(modsAvailable, modsEnabled, tml);\n+      if (ret == null) { // nothing done\n+        return;\n+      }\n+      if (!ret.isEmpty()) { // error\n+        return;\n       }\n-      ModuleDescriptor mdTo = null;\n-      for (InterfaceDescriptor prov : md.getProvidesList()) {\n-        for (InterfaceDescriptor req : me.getRequiresOptionalList()) {\n-          if (prov.getId().equals(req.getId()) && !prov.isCompatible(req)) {\n-            mdTo = lookupAvailableForProvided(modsAvailable, me, prov, mdTo);\n+      // something upgraded.. try again\n+    }\n+  }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEyOTA5OQ=="}, "originalCommit": {"oid": "a75380804e2d96d327ec1ddbfa626955be7a0e00"}, "originalPosition": 64}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 174, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}