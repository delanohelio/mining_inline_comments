{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MjkwNzcy", "number": 985, "title": "Allow module and interface discovery for same tenant OKAPI-863", "bodyText": "Okapi on its own can not check if tenant is valid, so it might\npass no required permissions to auth. But auth will still fail\nif tenant in token doesn't match. Internally this is done in\nthe routing entry of Okapi module to use a new property which\nlists permissions to use when tenant matches {tenantId} in\npathPattern. This solution is, thus, backwards compatible with\nOKAPI-835 for a tenant match.", "createdAt": "2020-10-03T15:09:49Z", "url": "https://github.com/folio-org/okapi/pull/985", "merged": true, "mergeCommit": {"oid": "624117f5983303709510d89f3d3aea878aa397aa"}, "closed": true, "closedAt": "2020-10-05T17:01:46Z", "author": {"login": "adamdickmeiss"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdO8BMbgH2gAyNDk3MjkwNzcyOjQzNTcwMmQ1NGUwNjVjM2VjYmU4NDA0ZGEwN2I1MTc5NmQzODU5OWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPmwqvgFqTUwMjI0NjU2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "435702d54e065c3ecbe8404da07b51796d38599f", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/435702d54e065c3ecbe8404da07b51796d38599f", "committedDate": "2020-10-03T15:07:47Z", "message": "Allow module and interface discovery for same tenant OKAPI-863\n\nOkapi on its own can not check if tenant is valid, so it might\npass no required permissions to auth. But auth will still fail\nif tenant in token doesn't match. Internally this is done in\nthe routing entry of Okapi module to use a new property which\nlists permissions to use when tenant matches {tenantId} in\npathPattern. This solution is, thus, backwards compatible with\nOKAPI-835 for a tenant match."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edd99d12c9cbe9148a71ed9403ebbc3fb692ed9a", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/edd99d12c9cbe9148a71ed9403ebbc3fb692ed9a", "committedDate": "2020-10-05T07:23:29Z", "message": "Must have token(session) when matching permissionsTenant\n\nFix description as well."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "beeb98de2edc76b134d2d768373da2a1a8856066", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/beeb98de2edc76b134d2d768373da2a1a8856066", "committedDate": "2020-10-05T13:59:03Z", "message": "Rename permissionsTenant to permissionsRequiredTenant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe78380cb1d4e2f1cc2015dcd0e0e7957cbd82af", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/fe78380cb1d4e2f1cc2015dcd0e0e7957cbd82af", "committedDate": "2020-10-05T14:04:54Z", "message": "Guess that schema is checked afterall :-)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMTc0ODQw", "url": "https://github.com/folio-org/okapi/pull/985#pullrequestreview-502174840", "createdAt": "2020-10-05T15:30:09Z", "commit": {"oid": "fe78380cb1d4e2f1cc2015dcd0e0e7957cbd82af"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNTozMDowOVrOHcibag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxNTozMDowOVrOHcibag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY4NjI1MA==", "bodyText": "Does this mean one tenant can see another tenant's modules?", "url": "https://github.com/folio-org/okapi/pull/985#discussion_r499686250", "createdAt": "2020-10-05T15:30:09Z", "author": {"login": "hjiebsco"}, "path": "okapi-core/src/test/java/org/folio/okapi/MultiTenantTest.java", "diffHunk": "@@ -335,6 +335,27 @@ public void test1() {\n     ja = new JsonArray(res.body().asString());\n     Assert.assertEquals(3, ja.size()); // two sample modules and auth module\n \n+    res = given()\n+        .header(\"Content-Type\", \"application/json\")\n+        .header(\"X-Okapi-Tenant\", tenant2)\n+        .get(\"/_/proxy/tenants/\" + tenant2 + \"/modules\")\n+        .then().statusCode(401).log().ifValidationFails()\n+        .extract().response();\n+\n+    res = given()\n+        .header(\"Content-Type\", \"application/json\")\n+        .header(\"X-Okapi-Token\", okapiTokenTenant2)\n+        .get(\"/_/proxy/tenants/\" + tenant2 + \"/modules\")\n+        .then().statusCode(200).log().ifValidationFails()\n+        .extract().response();\n+\n+    res = given()\n+        .header(\"Content-Type\", \"application/json\")\n+        .header(\"X-Okapi-Token\", okapiTokenTenant2)\n+        .get(\"/_/proxy/tenants/\" + tenant1 + \"/modules\")\n+        .then().statusCode(200).log().ifValidationFails()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe78380cb1d4e2f1cc2015dcd0e0e7957cbd82af"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMjQ2NTY2", "url": "https://github.com/folio-org/okapi/pull/985#pullrequestreview-502246566", "createdAt": "2020-10-05T16:55:39Z", "commit": {"oid": "fe78380cb1d4e2f1cc2015dcd0e0e7957cbd82af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2859, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}