{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NzYxNDgz", "number": 1041, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNjozOToxNVrOE3yIvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwODoyMToyOFrOE4C8_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2OTI4NTczOnYy", "diffSide": "RIGHT", "path": "okapi-core/src/main/java/org/folio/okapi/MainVerticle.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNjozOToxNVrOHxVHug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQyMTowMzo1N1rOHxeNew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ4ODMxNA==", "bodyText": "So http.port is only supported as property. Not as Json configuration. Is that intended?", "url": "https://github.com/folio-org/okapi/pull/1041#discussion_r521488314", "createdAt": "2020-11-11T16:39:15Z", "author": {"login": "adamdickmeiss"}, "path": "okapi-core/src/main/java/org/folio/okapi/MainVerticle.java", "diffHunk": "@@ -83,7 +83,8 @@ public void init(Vertx vertx, Context context) {\n     super.init(vertx, context);\n \n     JsonObject config = context.config();\n-    port = Integer.parseInt(Config.getSysConf(\"port\", \"9130\", config));\n+    String portString = System.getProperty(\"http.port\", \"9130\");\n+    port = Integer.parseInt(Config.getSysConf(\"port\", portString, config));\n     String okapiVersion2 = Config.getSysConf(\"okapiVersion\", null, config);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "266fc609f7aebcc19f77608bedcb6a6779f4b667"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYzNzI0Mw==", "bodyText": "No, good catch!\nFixed.", "url": "https://github.com/folio-org/okapi/pull/1041#discussion_r521637243", "createdAt": "2020-11-11T21:03:57Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/MainVerticle.java", "diffHunk": "@@ -83,7 +83,8 @@ public void init(Vertx vertx, Context context) {\n     super.init(vertx, context);\n \n     JsonObject config = context.config();\n-    port = Integer.parseInt(Config.getSysConf(\"port\", \"9130\", config));\n+    String portString = System.getProperty(\"http.port\", \"9130\");\n+    port = Integer.parseInt(Config.getSysConf(\"port\", portString, config));\n     String okapiVersion2 = Config.getSysConf(\"okapiVersion\", null, config);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ4ODMxNA=="}, "originalCommit": {"oid": "266fc609f7aebcc19f77608bedcb6a6779f4b667"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3MjA0MDkzOnYy", "diffSide": "RIGHT", "path": "dist/okapi.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwODoyMToyOFrOHxvQWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwOToxMjoxNVrOHxxRhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkxNjUwNQ==", "bodyText": "I'm not sure I follow. This is a value, not a name. Hopefully no system tampers with values. So I don't think we should excuse anything here.", "url": "https://github.com/folio-org/okapi/pull/1041#discussion_r521916505", "createdAt": "2020-11-12T08:21:28Z", "author": {"login": "adamdickmeiss"}, "path": "dist/okapi.sh", "diffHunk": "@@ -121,9 +121,19 @@ parse_okapi_conf()  {\n       OKAPI_JAVA_OPTS+=\" -Dhost=${host}\"\n    fi\n \n-   # configure okapi port\n-   if [ \"$port\" ]; then\n-      OKAPI_JAVA_OPTS+=\" -Dport=${port}\"\n+   # configure okapi http port\n+   # Environment variables with periods/dots in their names are deprecated\n+   # because a period is not POSIX compliant and therefore some shells, notably,\n+   # the BusyBox /bin/sh included in Alpine Linux, strip them:\n+   # https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap08.html\n+   # https://github.com/docker-library/docs/tree/master/openjdk#environment-variables-with-periods-in-their-names\n+   # https://wiki.ubuntu.com/DashAsBinSh\n+   # https://wiki.ubuntu.com/DashAsBinSh/Spec\n+   # Java property variable names allow periods/dots.\n+   if [ \"$http_port\" ]; then\n+      OKAPI_JAVA_OPTS+=\" -Dhttp.port=${http_port}\"\n+   elif [ \"$port\" ]; then\n+      OKAPI_JAVA_OPTS+=\" -Dhttp.port=${port}\"\n    fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97238ed75b784ad27b1478d0de12ace617123a9b"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk0OTU3Mg==", "bodyText": "You mean http_port of course. ok.", "url": "https://github.com/folio-org/okapi/pull/1041#discussion_r521949572", "createdAt": "2020-11-12T09:12:15Z", "author": {"login": "adamdickmeiss"}, "path": "dist/okapi.sh", "diffHunk": "@@ -121,9 +121,19 @@ parse_okapi_conf()  {\n       OKAPI_JAVA_OPTS+=\" -Dhost=${host}\"\n    fi\n \n-   # configure okapi port\n-   if [ \"$port\" ]; then\n-      OKAPI_JAVA_OPTS+=\" -Dport=${port}\"\n+   # configure okapi http port\n+   # Environment variables with periods/dots in their names are deprecated\n+   # because a period is not POSIX compliant and therefore some shells, notably,\n+   # the BusyBox /bin/sh included in Alpine Linux, strip them:\n+   # https://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap08.html\n+   # https://github.com/docker-library/docs/tree/master/openjdk#environment-variables-with-periods-in-their-names\n+   # https://wiki.ubuntu.com/DashAsBinSh\n+   # https://wiki.ubuntu.com/DashAsBinSh/Spec\n+   # Java property variable names allow periods/dots.\n+   if [ \"$http_port\" ]; then\n+      OKAPI_JAVA_OPTS+=\" -Dhttp.port=${http_port}\"\n+   elif [ \"$port\" ]; then\n+      OKAPI_JAVA_OPTS+=\" -Dhttp.port=${port}\"\n    fi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkxNjUwNQ=="}, "originalCommit": {"oid": "97238ed75b784ad27b1478d0de12ace617123a9b"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 202, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}