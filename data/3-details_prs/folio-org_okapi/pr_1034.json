{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MDc2OTY2", "number": 1034, "title": "New service /_/proxy/import/modules OKAPI-610", "bodyText": "This service is also convenient in ProxyTest.testManyModules.\nAlso perform log.warn with backtrace when Okapi reports 500.", "createdAt": "2020-11-05T13:54:38Z", "url": "https://github.com/folio-org/okapi/pull/1034", "merged": true, "mergeCommit": {"oid": "df00145d7679c68ab97ec8edaac548d78f7f72b0"}, "closed": true, "closedAt": "2020-11-11T18:36:27Z", "author": {"login": "adamdickmeiss"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZivHxgH2gAyNTE2MDc2OTY2OmM0MGQzZjNiNTgzNzExOGEzNWRiZGRhZTcwNjFmMGE4M2MxMWRmZTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbhUeGgH2gAyNTE2MDc2OTY2OjYxYTk3Yjg4MjE2ZmMwNmQ2Y2NlMjgxMTlmYmMyNDNkM2NkYzY3NmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c40d3f3b5837118a35dbddae7061f0a83c11dfe6", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/c40d3f3b5837118a35dbddae7061f0a83c11dfe6", "committedDate": "2020-11-05T13:53:35Z", "message": "New service /_/proxy/import/modules OKAPI-610\n\nThis service is also convenient in ProxyTest.testManyModules.\nAlso perform log.warn with backtrace when Okapi reports 500."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/3c204f75d76b818b143818887914563536bb7e2d", "committedDate": "2020-11-05T14:14:59Z", "message": "No need to check for pullManager"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MDE0ODc0", "url": "https://github.com/folio-org/okapi/pull/1034#pullrequestreview-525014874", "createdAt": "2020-11-06T10:07:56Z", "commit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDowNzo1N1rOHunzDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDowNzo1N1rOHunzDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY0ODU4OA==", "bodyText": "The method should be renamed to createModules to parallel the createModule method.\nThe method should be moved directly below to the createModule method.", "url": "https://github.com/folio-org/okapi/pull/1034#discussion_r518648588", "createdAt": "2020-11-06T10:07:57Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/managers/InternalModule.java", "diffHunk": "@@ -1056,6 +1068,19 @@ public static ModuleDescriptor moduleDescriptor(String okapiVersion) {\n     }\n   }\n \n+  private Future<Void> importModules(ProxyContext pc, String body) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MDE1NzMy", "url": "https://github.com/folio-org/okapi/pull/1034#pullrequestreview-525015732", "createdAt": "2020-11-06T10:08:58Z", "commit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDowODo1OFrOHun1NA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDowODo1OFrOHun1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY0OTE0MA==", "bodyText": "The each module descriptor should be validated the same way as createModule validates it.", "url": "https://github.com/folio-org/okapi/pull/1034#discussion_r518649140", "createdAt": "2020-11-06T10:08:58Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/managers/InternalModule.java", "diffHunk": "@@ -1056,6 +1068,19 @@ public static ModuleDescriptor moduleDescriptor(String okapiVersion) {\n     }\n   }\n \n+  private Future<Void> importModules(ProxyContext pc, String body) {\n+    try {\n+      HttpServerRequest req = pc.getCtx().request();\n+      final boolean check = ModuleUtil.getParamBoolean(req, \"check\", true);\n+      final boolean preRelease = ModuleUtil.getParamBoolean(req, \"preRelease\", true);\n+      final boolean npmSnapshot = ModuleUtil.getParamBoolean(req, \"npmSnapshot\", true);\n+      final ModuleDescriptor[] modules = Json.decodeValue(body, ModuleDescriptor[].class);\n+      return moduleManager.createList(Arrays.asList(modules), check, preRelease, npmSnapshot);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MDE4MTY5", "url": "https://github.com/folio-org/okapi/pull/1034#pullrequestreview-525018169", "createdAt": "2020-11-06T10:12:08Z", "commit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDoxMjowOFrOHun7zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDoxMjowOFrOHun7zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY1MDgzMQ==", "bodyText": "Can you move it just before /_/proxy/modules: to have these very similar endpoints next to each other?", "url": "https://github.com/folio-org/okapi/pull/1034#discussion_r518650831", "createdAt": "2020-11-06T10:12:08Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/raml/okapi.raml", "diffHunk": "@@ -1128,6 +1128,31 @@ types:\n         body:\n           text/plain:\n \n+/_/proxy/import/modules:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MDIyMzQz", "url": "https://github.com/folio-org/okapi/pull/1034#pullrequestreview-525022343", "createdAt": "2020-11-06T10:18:02Z", "commit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDoxODowMlrOHuoILQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDoxODowMlrOHuoILQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY1Mzk5Nw==", "bodyText": "The related endpoints should have related descriptions:\n/_/proxy/modules:\n  description: Proxy modules service\n\n/_/proxy/import/modules:\n  description: Proxy modules service, list import", "url": "https://github.com/folio-org/okapi/pull/1034#discussion_r518653997", "createdAt": "2020-11-06T10:18:02Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/raml/okapi.raml", "diffHunk": "@@ -1128,6 +1128,31 @@ types:\n         body:\n           text/plain:\n \n+/_/proxy/import/modules:\n+  description: Import modules", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MDIzNTM1", "url": "https://github.com/folio-org/okapi/pull/1034#pullrequestreview-525023535", "createdAt": "2020-11-06T10:19:43Z", "commit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDoxOTo0M1rOHuoLjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDoxOTo0M1rOHuoLjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY1NDg2MA==", "bodyText": "Please copy the queryParameters documentation from /_/proxy/modules.", "url": "https://github.com/folio-org/okapi/pull/1034#discussion_r518654860", "createdAt": "2020-11-06T10:19:43Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/raml/okapi.raml", "diffHunk": "@@ -1128,6 +1128,31 @@ types:\n         body:\n           text/plain:\n \n+/_/proxy/import/modules:\n+  description: Import modules\n+  post:\n+    description: Import list modules.\n+    body:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MDMxMzg3", "url": "https://github.com/folio-org/okapi/pull/1034#pullrequestreview-525031387", "createdAt": "2020-11-06T10:31:05Z", "commit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDozMTowNlrOHuoj1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMDozMTowNlrOHuoj1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY2MTA3Ng==", "bodyText": "The descriptions of the related endpoints should link to each other, be similar and verbose.\n/_/proxy/modules:\n  post:\n    description: Announce one new module to the proxy. Once successful a module\n      can be selected for a specific tenant. To announce a list of modules use\n      /_/proxy/import/modules.\n\n/_/proxy/import/modules:\n  post:\n    description: Announce a list of new modules to the proxy. Once successful a module\n      can be selected for a specific tenant. To announce only one module you may use\n      /_/proxy/modules.", "url": "https://github.com/folio-org/okapi/pull/1034#discussion_r518661076", "createdAt": "2020-11-06T10:31:06Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/raml/okapi.raml", "diffHunk": "@@ -1128,6 +1128,31 @@ types:\n         body:\n           text/plain:\n \n+/_/proxy/import/modules:\n+  description: Import modules\n+  post:\n+    description: Import list modules.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MDU4NTc3", "url": "https://github.com/folio-org/okapi/pull/1034#pullrequestreview-525058577", "createdAt": "2020-11-06T11:09:22Z", "commit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMTowOToyM1rOHup5gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMTowOToyM1rOHup5gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY4MzAwOQ==", "bodyText": "Such code blocks can be avoided if the classes provide methods/constructors that reduce noise in the test setup.\nmdA.setProvides(\"intA\", \"1.0\", new RoutingEntry(\"/a\", \"GET\"));\n\npublic RoutingEntry(String pathPattern, String... httpMethods)", "url": "https://github.com/folio-org/okapi/pull/1034#discussion_r518683009", "createdAt": "2020-11-06T11:09:23Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/test/java/org/folio/okapi/ProxyTest.java", "diffHunk": "@@ -4196,6 +4196,87 @@ private void setupBasicModule(String tenant, String moduleId, String tenantPermi\n         .then().statusCode(200).log().ifValidationFails();\n   }\n \n+  @Test\n+  public void testImportModules(TestContext context) {\n+    RestAssuredClient c;\n+\n+    c = api.createRestAssured3();\n+    given()\n+        .header(\"Content-Type\", \"application/json\")\n+        .body(\"{\\\"id\\\":\").post(\"/_/proxy/import/modules\")\n+        .then().statusCode(400);\n+\n+    c = api.createRestAssured3();\n+    c.given()\n+        .header(\"Content-Type\", \"application/json\")\n+        .body(\"[]\").post(\"/_/proxy/import/modules\")\n+        .then().statusCode(204);\n+    Assert.assertTrue(\"raml: \" + c.getLastReport().toString(),\n+        c.getLastReport().isEmpty());\n+\n+    ModuleDescriptor mdA = new ModuleDescriptor();\n+    mdA.setId(\"moduleA-1.0.0\");\n+    {\n+      RoutingEntry[] routingEntries = new RoutingEntry[1];\n+      RoutingEntry routingEntry = routingEntries[0] = new RoutingEntry();\n+      routingEntry.setPathPattern(\"/a\");\n+      routingEntry.setMethods(new String[]{\"GET\"});\n+\n+      InterfaceDescriptor[] interfaceDescriptors = new InterfaceDescriptor[1];\n+      InterfaceDescriptor interfaceDescriptor = interfaceDescriptors[0] = new InterfaceDescriptor();\n+      interfaceDescriptor.setId(\"intA\");\n+      interfaceDescriptor.setVersion(\"1.0\");\n+      interfaceDescriptor.setHandlers(routingEntries);\n+      mdA.setProvides(interfaceDescriptors);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1MDU4NjA0", "url": "https://github.com/folio-org/okapi/pull/1034#pullrequestreview-525058604", "createdAt": "2020-11-06T11:09:26Z", "commit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMTowOToyNlrOHup5pQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxMTowOToyNlrOHup5pQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODY4MzA0NQ==", "bodyText": "Such code blocks can be avoided if the classes provide methods/constructors that reduce noise in the test setup.\nmdB.setRequires(\"intA\", \"1.0\");", "url": "https://github.com/folio-org/okapi/pull/1034#discussion_r518683045", "createdAt": "2020-11-06T11:09:26Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/test/java/org/folio/okapi/ProxyTest.java", "diffHunk": "@@ -4196,6 +4196,87 @@ private void setupBasicModule(String tenant, String moduleId, String tenantPermi\n         .then().statusCode(200).log().ifValidationFails();\n   }\n \n+  @Test\n+  public void testImportModules(TestContext context) {\n+    RestAssuredClient c;\n+\n+    c = api.createRestAssured3();\n+    given()\n+        .header(\"Content-Type\", \"application/json\")\n+        .body(\"{\\\"id\\\":\").post(\"/_/proxy/import/modules\")\n+        .then().statusCode(400);\n+\n+    c = api.createRestAssured3();\n+    c.given()\n+        .header(\"Content-Type\", \"application/json\")\n+        .body(\"[]\").post(\"/_/proxy/import/modules\")\n+        .then().statusCode(204);\n+    Assert.assertTrue(\"raml: \" + c.getLastReport().toString(),\n+        c.getLastReport().isEmpty());\n+\n+    ModuleDescriptor mdA = new ModuleDescriptor();\n+    mdA.setId(\"moduleA-1.0.0\");\n+    {\n+      RoutingEntry[] routingEntries = new RoutingEntry[1];\n+      RoutingEntry routingEntry = routingEntries[0] = new RoutingEntry();\n+      routingEntry.setPathPattern(\"/a\");\n+      routingEntry.setMethods(new String[]{\"GET\"});\n+\n+      InterfaceDescriptor[] interfaceDescriptors = new InterfaceDescriptor[1];\n+      InterfaceDescriptor interfaceDescriptor = interfaceDescriptors[0] = new InterfaceDescriptor();\n+      interfaceDescriptor.setId(\"intA\");\n+      interfaceDescriptor.setVersion(\"1.0\");\n+      interfaceDescriptor.setHandlers(routingEntries);\n+      mdA.setProvides(interfaceDescriptors);\n+    }\n+\n+    ModuleDescriptor mdB = new ModuleDescriptor();\n+    mdB.setId(\"moduleB-1.0.0\");\n+    {\n+      InterfaceDescriptor[] interfaceDescriptors = new InterfaceDescriptor[1];\n+      InterfaceDescriptor interfaceDescriptor = interfaceDescriptors[0] = new InterfaceDescriptor();\n+      interfaceDescriptor.setId(\"intA\");\n+      interfaceDescriptor.setVersion(\"1.0\");\n+      mdB.setRequires(interfaceDescriptors);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c204f75d76b818b143818887914563536bb7e2d"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c2a473c4fd5cbed07aab70d596f9e3a448d3d83", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/7c2a473c4fd5cbed07aab70d596f9e3a448d3d83", "committedDate": "2020-11-06T13:48:20Z", "message": "Merge branch 'master' into OKAPI-610-post-multiple-modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cd348164331b50a3bde592c192717b7cccae828", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/4cd348164331b50a3bde592c192717b7cccae828", "committedDate": "2020-11-06T14:22:55Z", "message": "query parameters; move definition; validate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6980c48e305623a998aec11177cf537fde7895bf", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/6980c48e305623a998aec11177cf537fde7895bf", "committedDate": "2020-11-06T14:25:21Z", "message": "Merge remote-tracking branch 'origin/master' into OKAPI-610-post-multiple-modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd9589ebad3bc7301e017989209168863845da03", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/dd9589ebad3bc7301e017989209168863845da03", "committedDate": "2020-11-06T15:56:12Z", "message": "Test bad query paremter for import modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30db31c7b048443e2cae0347085aeacd7479b2da", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/30db31c7b048443e2cae0347085aeacd7479b2da", "committedDate": "2020-11-06T16:33:33Z", "message": "Unnecessary check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1643b7ffbd107ac82eb68fe04f3d46961b066d37", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/1643b7ffbd107ac82eb68fe04f3d46961b066d37", "committedDate": "2020-11-09T11:44:20Z", "message": "ModuleDescriptor.setRequires utility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af002d337da4cedf8383c219557c2e64ede5dd9a", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/af002d337da4cedf8383c219557c2e64ede5dd9a", "committedDate": "2020-11-09T12:11:37Z", "message": "A couple of more constructor utils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdbf0086b641b82d8853c07e98a61b9bc41f2071", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/fdbf0086b641b82d8853c07e98a61b9bc41f2071", "committedDate": "2020-11-09T20:05:11Z", "message": "Merge branch 'master' into OKAPI-610-post-multiple-modules"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MDA3MTgy", "url": "https://github.com/folio-org/okapi/pull/1034#pullrequestreview-527007182", "createdAt": "2020-11-10T09:26:00Z", "commit": {"oid": "fdbf0086b641b82d8853c07e98a61b9bc41f2071"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOToyNjowMFrOHwTZdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOToyNjowMFrOHwTZdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQxMTUwOA==", "bodyText": "cause can be null\npublic void responseError(ErrorType t, Throwable cause) might be called with a null cause and calls private void responseError(int code, Throwable cause) .\nString msg = (cause != null && cause.getMessage() != null) ? cause.getMessage() : messages.getMessage(\"10300\");\nif (code == 500) {\n  logger.warn(msg, cause);\n}\nresponseError(code, msg);", "url": "https://github.com/folio-org/okapi/pull/1034#discussion_r520411508", "createdAt": "2020-11-10T09:26:00Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/util/ProxyContext.java", "diffHunk": "@@ -237,7 +237,10 @@ public void responseError(ErrorType t, Throwable cause) {\n   }\n \n   private void responseError(int code, Throwable cause) {\n-    if (cause != null && cause.getMessage() != null) {\n+    if (code == 500) {\n+      logger.warn(cause.getMessage(), cause);\n+    }\n+    if (cause.getMessage() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdbf0086b641b82d8853c07e98a61b9bc41f2071"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MDE1ODcx", "url": "https://github.com/folio-org/okapi/pull/1034#pullrequestreview-527015871", "createdAt": "2020-11-10T09:35:52Z", "commit": {"oid": "fdbf0086b641b82d8853c07e98a61b9bc41f2071"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOTozNTo1M1rOHwT0dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOTozNTo1M1rOHwT0dQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQxODQyMQ==", "bodyText": "If someone has okapi.proxy.tenants.post permission and therefore is allowed to use POST /_/proxy/modules with one module at a time why should they not do exactly the same thing with a list of modules?\nMy suggestion is to avoid this new permission and reuse okapi.proxy.tenants.post.", "url": "https://github.com/folio-org/okapi/pull/1034#discussion_r520418421", "createdAt": "2020-11-10T09:35:53Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/managers/InternalModule.java", "diffHunk": "@@ -201,6 +201,13 @@ public static ModuleDescriptor moduleDescriptor(String okapiVersion) {\n         + \"    \\\"permissionsRequired\\\" : [ \\\"okapi.discovery.nodes.get\\\"  ], \"\n         + \"    \\\"type\\\" : \\\"internal\\\" \"\n         + \"   }, \"\n+        // import modules\n+        + \"   {\"\n+        + \"    \\\"methods\\\" :  [ \\\"POST\\\" ],\"\n+        + \"    \\\"pathPattern\\\" : \\\"/_/proxy/import/modules\\\",\"\n+        + \"    \\\"permissionsRequired\\\" : [ \\\"okapi.import.modules.post\\\" ], \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdbf0086b641b82d8853c07e98a61b9bc41f2071"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MDI5NTM3", "url": "https://github.com/folio-org/okapi/pull/1034#pullrequestreview-527029537", "createdAt": "2020-11-10T09:51:13Z", "commit": {"oid": "fdbf0086b641b82d8853c07e98a61b9bc41f2071"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOTo1MToxM1rOHwUc5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOTo1MToxM1rOHwUc5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQyODc3Mg==", "bodyText": "If we decide that we need a new permission.\nThen we should\n\nuse a permission name the reflects the similarity to okapi.proxy.tenants.post\ncopy the wording we use in the raml file.\n\nExample:\n\"permissionName\" : \"okapi.proxy.tenants.post-list\"\n\"displayName\" : \"Okapi - announce new modules to proxy\"\n\"description\" : \"Announce a list of new modules to the proxy\"", "url": "https://github.com/folio-org/okapi/pull/1034#discussion_r520428772", "createdAt": "2020-11-10T09:51:13Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/managers/InternalModule.java", "diffHunk": "@@ -491,6 +498,11 @@ public static ModuleDescriptor moduleDescriptor(String okapiVersion) {\n         + \"   \\\"description\\\" : \\\"get modules that provide some interface\\\" \"\n         + \" }, \"\n         + \" { \"\n+        + \"   \\\"permissionName\\\" : \\\"okapi.import.modules.post\\\", \"\n+        + \"   \\\"displayName\\\" : \\\"Okapi - import modules\\\", \"\n+        + \"   \\\"description\\\" : \\\"Import modules\\\" \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdbf0086b641b82d8853c07e98a61b9bc41f2071"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MDMxMTI5", "url": "https://github.com/folio-org/okapi/pull/1034#pullrequestreview-527031129", "createdAt": "2020-11-10T09:53:02Z", "commit": {"oid": "fdbf0086b641b82d8853c07e98a61b9bc41f2071"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOTo1MzowM1rOHwUhrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwOTo1MzowM1rOHwUhrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQyOTk5OQ==", "bodyText": "Can you copy the wording from the .raml file into the existing permission in the descriptor?\nThe existing permission\n\"permissionName\" : \"okapi.proxy.modules.post\"\n\"displayName\" : \"Okapi - declare a module\"\n\"description\" : \"Declare a module\"\n\nshould become\n\"permissionName\" : \"okapi.proxy.modules.post\"\n\"displayName\" : \"Okapi - announce new module to proxy\"\n\"description\" : \"Announce a new module to the proxy\"", "url": "https://github.com/folio-org/okapi/pull/1034#discussion_r520429999", "createdAt": "2020-11-10T09:53:03Z", "author": {"login": "julianladisch"}, "path": "okapi-core/src/main/java/org/folio/okapi/managers/InternalModule.java", "diffHunk": "@@ -491,6 +498,11 @@ public static ModuleDescriptor moduleDescriptor(String okapiVersion) {\n         + \"   \\\"description\\\" : \\\"get modules that provide some interface\\\" \"\n         + \" }, \"\n         + \" { \"\n+        + \"   \\\"permissionName\\\" : \\\"okapi.import.modules.post\\\", \"\n+        + \"   \\\"displayName\\\" : \\\"Okapi - import modules\\\", \"\n+        + \"   \\\"description\\\" : \\\"Import modules\\\" \"\n+        + \" }, \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdbf0086b641b82d8853c07e98a61b9bc41f2071"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MDMyOTky", "url": "https://github.com/folio-org/okapi/pull/1034#pullrequestreview-527032992", "createdAt": "2020-11-10T09:55:07Z", "commit": {"oid": "fdbf0086b641b82d8853c07e98a61b9bc41f2071"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62da9643de9cec07da94cf626a940432133faa19", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/62da9643de9cec07da94cf626a940432133faa19", "committedDate": "2020-11-11T13:39:12Z", "message": "Merge remote-tracking branch 'origin/master' into OKAPI-610-post-multiple-modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60725c54f7e9d31e54f83a2dbf909bd2ab0ddcf8", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/60725c54f7e9d31e54f83a2dbf909bd2ab0ddcf8", "committedDate": "2020-11-11T13:42:26Z", "message": "Also okapi.proxy.modules.post for importing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "caed1b64fc1f0843066498cd9d7e705151305c74", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/caed1b64fc1f0843066498cd9d7e705151305c74", "committedDate": "2020-11-11T13:42:51Z", "message": "Simplify for message in response handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6571a24212c34981afb6b2ba59b7d39d03e093c2", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/6571a24212c34981afb6b2ba59b7d39d03e093c2", "committedDate": "2020-11-11T13:44:45Z", "message": "Wrap line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61a97b88216fc06d6cce28119fbc243d3cdc676c", "author": {"user": {"login": "adamdickmeiss", "name": "Adam Dickmeiss"}}, "url": "https://github.com/folio-org/okapi/commit/61a97b88216fc06d6cce28119fbc243d3cdc676c", "committedDate": "2020-11-11T17:22:25Z", "message": "Merge branch 'master' into OKAPI-610-post-multiple-modules"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2900, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}