{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMjA5MDM0", "number": 2961, "title": "NCL-5497 - Store User in BuildConfiguration and BuildConfigurationAudited", "bodyText": "@janinko @alexcreasy Hi guys, would you mind taking a look? Thanks!\nChecklist:\n\n Have you added a note in the CHANGELOG wiki for your change if user-facing?\n Have you added unit tests for your change?", "createdAt": "2020-04-07T11:29:24Z", "url": "https://github.com/project-ncl/pnc/pull/2961", "merged": true, "mergeCommit": {"oid": "d80c7a2987a04c6f5416a6e3f9024bc534a7de43"}, "closed": true, "closedAt": "2020-04-07T14:29:16Z", "author": {"login": "vibe13"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVQzwJAH2gAyNDAwMjA5MDM0OmRjNzgxY2ZlNTVhMzU4N2NmMjM3ZTFiZjQ3ZWNjMGYyN2U1YTg5Y2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVTapyAH2gAyNDAwMjA5MDM0OjkyZTg1MDEyODMzMTI5ZDkzMDEyNGQ3ZjM1NjMxMjQ0Nzg5NWRjYjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dc781cfe55a3587cf237e1bf47ecc0f27e5a89cb", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/dc781cfe55a3587cf237e1bf47ecc0f27e5a89cb", "committedDate": "2020-04-07T10:33:30Z", "message": "NCL-5497 - Store User in BuildConfiguration and BuildConfigurationAudited"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae30a557e2774b8c9635bfaf1823931cdea679db", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/ae30a557e2774b8c9635bfaf1823931cdea679db", "committedDate": "2020-04-07T11:27:52Z", "message": "Add sql script to add new columns, indexes, foreign keys"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MDUyMTA1", "url": "https://github.com/project-ncl/pnc/pull/2961#pullrequestreview-389052105", "createdAt": "2020-04-07T12:10:34Z", "commit": {"oid": "ae30a557e2774b8c9635bfaf1823931cdea679db"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMjoxMDozNVrOGCAfWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMjoxNzozNFrOGCAu3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc1ODM2Mw==", "bodyText": "Here you are changing the creationUser of existing BC. This method creates new BC-audited for existing BC. It's called createRevision because from API point it is creating new entity, but it's actually just updating the BC.", "url": "https://github.com/project-ncl/pnc/pull/2961#discussion_r404758363", "createdAt": "2020-04-07T12:10:35Z", "author": {"login": "janinko"}, "path": "facade/src/main/java/org/jboss/pnc/facade/providers/BuildConfigurationProviderImpl.java", "diffHunk": "@@ -219,6 +239,9 @@ public BuildConfigurationRevision createRevision(String id, BuildConfiguration b\n             return buildConfigurationRevisionMapper.toDTO(latestRevision);\n         }\n         bcEntity.setCreationTime(latestRevision.getCreationTime());\n+        org.jboss.pnc.model.User user = userService.currentUser();\n+        bcEntity.setCreationUser(user);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae30a557e2774b8c9635bfaf1823931cdea679db"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc2MjI0NQ==", "bodyText": "Dependencies are not audited. Should we update the user even when no audited data got changed?", "url": "https://github.com/project-ncl/pnc/pull/2961#discussion_r404762245", "createdAt": "2020-04-07T12:17:23Z", "author": {"login": "janinko"}, "path": "facade/src/main/java/org/jboss/pnc/facade/providers/BuildConfigurationProviderImpl.java", "diffHunk": "@@ -308,6 +335,7 @@ public void addDependency(String configId, String dependencyId) {\n \n         logger.debug(\"Didn't throw any validation errors\");\n         buildConfig.addDependency(dependency);\n+        buildConfig.setLastModificationUser(user);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae30a557e2774b8c9635bfaf1823931cdea679db"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc2MjMzNQ==", "bodyText": "^", "url": "https://github.com/project-ncl/pnc/pull/2961#discussion_r404762335", "createdAt": "2020-04-07T12:17:34Z", "author": {"login": "janinko"}, "path": "facade/src/main/java/org/jboss/pnc/facade/providers/BuildConfigurationProviderImpl.java", "diffHunk": "@@ -316,12 +344,14 @@ public void removeDependency(String configId, String dependencyId) {\n \n         org.jboss.pnc.model.BuildConfiguration buildConfig = repository.queryById(Integer.valueOf(configId));\n         org.jboss.pnc.model.BuildConfiguration dependency = repository.queryById(Integer.valueOf(dependencyId));\n+        org.jboss.pnc.model.User user = userService.currentUser();\n \n         ValidationBuilder.validateObject(buildConfig, WhenUpdating.class)\n                 .validateCondition(buildConfig != null, \"No build config exists with id: \" + configId)\n                 .validateCondition(dependency != null, \"No dependency build config exists with id: \" + dependencyId);\n \n         buildConfig.removeDependency(dependency);\n+        buildConfig.setLastModificationUser(user);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae30a557e2774b8c9635bfaf1823931cdea679db"}, "originalPosition": 108}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ac6ce52324b448da217595bdac74685d9135562", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/5ac6ce52324b448da217595bdac74685d9135562", "committedDate": "2020-04-07T12:53:20Z", "message": "Do not change lastModificatioUser when changing dependencies; do not change creationUser when creating a new revision"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MDk2MzI4", "url": "https://github.com/project-ncl/pnc/pull/2961#pullrequestreview-389096328", "createdAt": "2020-04-07T13:07:53Z", "commit": {"oid": "5ac6ce52324b448da217595bdac74685d9135562"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92e85012833129d930124d7f356312447895dcb0", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/92e85012833129d930124d7f356312447895dcb0", "committedDate": "2020-04-07T13:35:48Z", "message": "Apply correct formatting"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2610, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}