{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2Njc5NDIx", "number": 3036, "title": "[NCL-5754] add duplication validation to productMilestone validation endpoint", "bodyText": "Checklist:\n\n Have you added a note in the CHANGELOG wiki for your change if user-facing?\n Have you added unit tests for your change?", "createdAt": "2020-05-12T12:01:23Z", "url": "https://github.com/project-ncl/pnc/pull/3036", "merged": true, "mergeCommit": {"oid": "29155f19e97be9f0f737f041f8ce9d6b5098c875"}, "closed": true, "closedAt": "2020-05-18T13:22:28Z", "author": {"login": "michalovjan"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgjGmsgFqTQwOTk3MjE5OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcifhX4gFqTQxMzU3MTg4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5OTcyMTk4", "url": "https://github.com/project-ncl/pnc/pull/3036#pullrequestreview-409972198", "createdAt": "2020-05-12T12:05:33Z", "commit": {"oid": "5b03551c8686023130b838bb9a8abdde5584974a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5b03551c8686023130b838bb9a8abdde5584974a", "author": {"user": {"login": "michalovjan", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/5b03551c8686023130b838bb9a8abdde5584974a", "committedDate": "2020-05-12T12:00:38Z", "message": "[NCL-5754] upgrade productMilestone validation endpoint"}, "afterCommit": {"oid": "75f06c46e0a07aec7c906df8521538e2fc8654b5", "author": {"user": {"login": "michalovjan", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/75f06c46e0a07aec7c906df8521538e2fc8654b5", "committedDate": "2020-05-12T12:31:08Z", "message": "[NCL-5754] upgrade productMilestone validation endpoint"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "75f06c46e0a07aec7c906df8521538e2fc8654b5", "author": {"user": {"login": "michalovjan", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/75f06c46e0a07aec7c906df8521538e2fc8654b5", "committedDate": "2020-05-12T12:31:08Z", "message": "[NCL-5754] upgrade productMilestone validation endpoint"}, "afterCommit": {"oid": "41c7b2463b095c800c2aa3af6bff51611bc29e76", "author": {"user": {"login": "michalovjan", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/41c7b2463b095c800c2aa3af6bff51611bc29e76", "committedDate": "2020-05-12T13:35:06Z", "message": "[NCL-5754] upgrade productMilestone validation endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNTQ1MDk2", "url": "https://github.com/project-ncl/pnc/pull/3036#pullrequestreview-411545096", "createdAt": "2020-05-14T07:46:43Z", "commit": {"oid": "41c7b2463b095c800c2aa3af6bff51611bc29e76"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzo0Njo0NFrOGVP-gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzo1MzozNFrOGVQOLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkzNTA0MA==", "bodyText": "I would prefer Collections.singletonList() instead of using guava library", "url": "https://github.com/project-ncl/pnc/pull/3036#discussion_r424935040", "createdAt": "2020-05-14T07:46:44Z", "author": {"login": "janinko"}, "path": "facade/src/main/java/org/jboss/pnc/facade/providers/ProductMilestoneProviderImpl.java", "diffHunk": "@@ -275,6 +281,34 @@ public void cancelMilestoneCloseProcess(String id) throws RepositoryViolationExc\n         return new Page<>(pageIndex, pageSize, milestoneIds.size(), milestones);\n     }\n \n+    @Override\n+    public ValidationResponse validateVersion(String productVersionId, String version) {\n+        boolean matches = Pattern.matches(Patterns.PRODUCT_MILESTONE_VERSION, version);\n+        ValidationResponse.Builder builder = ValidationResponse.builder().isValid(matches);\n+        if (!matches) {\n+            return builder.errorType(FORMAT)\n+                    .hints(\n+                            Lists.newArrayList(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41c7b2463b095c800c2aa3af6bff51611bc29e76"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkzNzI4Mw==", "bodyText": "add @Valid to VersionValidationRequest and I belive then you can rely on the fields not be null.", "url": "https://github.com/project-ncl/pnc/pull/3036#discussion_r424937283", "createdAt": "2020-05-14T07:50:34Z", "author": {"login": "janinko"}, "path": "rest-new/src/main/java/org/jboss/pnc/rest/endpoints/ProductMilestoneEndpointImpl.java", "diffHunk": "@@ -132,12 +129,7 @@ public void cancelMilestoneClose(String id) {\n \n     @Override\n     public ValidationResponse validateVersion(VersionValidationRequest versionRequest) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41c7b2463b095c800c2aa3af6bff51611bc29e76"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkzNzc1Nw==", "bodyText": "if you use @Valid then you don't need this check, I think.", "url": "https://github.com/project-ncl/pnc/pull/3036#discussion_r424937757", "createdAt": "2020-05-14T07:51:22Z", "author": {"login": "janinko"}, "path": "facade/src/main/java/org/jboss/pnc/facade/providers/ProductMilestoneProviderImpl.java", "diffHunk": "@@ -275,6 +281,34 @@ public void cancelMilestoneCloseProcess(String id) throws RepositoryViolationExc\n         return new Page<>(pageIndex, pageSize, milestoneIds.size(), milestones);\n     }\n \n+    @Override\n+    public ValidationResponse validateVersion(String productVersionId, String version) {\n+        boolean matches = Pattern.matches(Patterns.PRODUCT_MILESTONE_VERSION, version);\n+        ValidationResponse.Builder builder = ValidationResponse.builder().isValid(matches);\n+        if (!matches) {\n+            return builder.errorType(FORMAT)\n+                    .hints(\n+                            Lists.newArrayList(\n+                                    \"Allowed format consists of 2 or 3 numeric components (separated by a dot) followed by a string \"\n+                                            + \"qualifier starting with a character, eg. 3.0.0.GA, 1.0.11.CR2.ER1, 3.0.CR2\"))\n+                    .build();\n+        }\n+        org.jboss.pnc.model.ProductMilestone duplicate = null;\n+        if (productVersionId != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41c7b2463b095c800c2aa3af6bff51611bc29e76"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkzOTA1Mg==", "bodyText": "ValidationErrorType? + javadoc on class level", "url": "https://github.com/project-ncl/pnc/pull/3036#discussion_r424939052", "createdAt": "2020-05-14T07:53:34Z", "author": {"login": "janinko"}, "path": "constants/src/main/java/org/jboss/pnc/enums/ErrorType.java", "diffHunk": "@@ -0,0 +1,29 @@\n+/**\n+ * JBoss, Home of Professional Open Source.\n+ * Copyright 2014-2020 Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.jboss.pnc.enums;\n+\n+public enum ErrorType {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41c7b2463b095c800c2aa3af6bff51611bc29e76"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "433ce2f6a8f0c44b506a32093b9aac6ed81c5a74", "author": {"user": {"login": "michalovjan", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/433ce2f6a8f0c44b506a32093b9aac6ed81c5a74", "committedDate": "2020-05-18T12:47:38Z", "message": "[NCL-5754] upgrade productMilestone validation endpoint"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41c7b2463b095c800c2aa3af6bff51611bc29e76", "author": {"user": {"login": "michalovjan", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/41c7b2463b095c800c2aa3af6bff51611bc29e76", "committedDate": "2020-05-12T13:35:06Z", "message": "[NCL-5754] upgrade productMilestone validation endpoint"}, "afterCommit": {"oid": "433ce2f6a8f0c44b506a32093b9aac6ed81c5a74", "author": {"user": {"login": "michalovjan", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/433ce2f6a8f0c44b506a32093b9aac6ed81c5a74", "committedDate": "2020-05-18T12:47:38Z", "message": "[NCL-5754] upgrade productMilestone validation endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNTcxODgz", "url": "https://github.com/project-ncl/pnc/pull/3036#pullrequestreview-413571883", "createdAt": "2020-05-18T13:03:01Z", "commit": {"oid": "433ce2f6a8f0c44b506a32093b9aac6ed81c5a74"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2645, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}