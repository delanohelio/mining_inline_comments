{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2NzA5NjE3", "number": 3233, "title": "[NCL-5891] add generalized way to update OneToMany relationships and add functionality to endpoints", "bodyText": "Checklist:\n\n Have you added a note in the CHANGELOG wiki for your change if user-facing?\n Have you added unit tests for your change?", "createdAt": "2020-08-12T11:42:06Z", "url": "https://github.com/project-ncl/pnc/pull/3233", "merged": true, "mergeCommit": {"oid": "ced4bed8950eff792a961edbcd6fec8c1b87435e"}, "closed": true, "closedAt": "2020-08-13T07:48:38Z", "author": {"login": "michalovjan"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-JZOUgH2gAyNDY2NzA5NjE3OjZjZTk2OTZhMzAwMjkwODlmODk4OGJkNzFhNTZiZTU3YzZkNDBlYzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-ShnsAH2gAyNDY2NzA5NjE3OjA2OTIyOTNkMTgwZTY0YzIwNmQ2YzIxNTNiNzVmMzZjNzNlYmFmMGQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6ce9696a30029089f8988bd71a56be57c6d40ec2", "author": {"user": {"login": "michalovjan", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/6ce9696a30029089f8988bd71a56be57c6d40ec2", "committedDate": "2020-08-12T11:06:05Z", "message": "[NCL-5891] fix PV.Builder to also update BuildConfiguration's side"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb989043f4005fa5bd9e497c35d7472c93133e14", "author": {"user": {"login": "michalovjan", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/bb989043f4005fa5bd9e497c35d7472c93133e14", "committedDate": "2020-08-12T11:35:27Z", "message": "[NCL-5891] add general method for updating owning side of relationships"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a3428229eef153d480bc285534a89f2bbe48e66", "author": {"user": {"login": "michalovjan", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/9a3428229eef153d480bc285534a89f2bbe48e66", "committedDate": "2020-08-12T11:35:27Z", "message": "[NCL-5891] add PATCH request tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1ODc2OTE0", "url": "https://github.com/project-ncl/pnc/pull/3233#pullrequestreview-465876914", "createdAt": "2020-08-12T12:41:35Z", "commit": {"oid": "9a3428229eef153d480bc285534a89f2bbe48e66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MDI5OTk4", "url": "https://github.com/project-ncl/pnc/pull/3233#pullrequestreview-466029998", "createdAt": "2020-08-12T15:29:48Z", "commit": {"oid": "9a3428229eef153d480bc285534a89f2bbe48e66"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNToyOTo0OFrOG_moKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxNToyOTo0OFrOG_moKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM0NjM0NQ==", "bodyText": "This will break the TreeSet as if A != B  then A > B && A < B. (or in best case will be as efficient as array list)\nYou would want to use Map<ID, Entity> I think.", "url": "https://github.com/project-ncl/pnc/pull/3233#discussion_r469346345", "createdAt": "2020-08-12T15:29:48Z", "author": {"login": "janinko"}, "path": "datastore/src/main/java/org/jboss/pnc/datastore/repositories/internal/AbstractRepository.java", "diffHunk": "@@ -110,4 +116,54 @@ public int count(Collection<Predicate<T>> andPredicates, Collection<Predicate<T>\n                 .getContent();\n     }\n \n+    /**\n+     * @see Repository#cascadeUpdates) for full docs\n+     * \n+     * @param managedNonOwning current version of entity from DB (MUST be Hibernate managed (due to LAZY fetching))\n+     * @param updatedNonOwning proposed version of entity from request\n+     * @param collectionGetter getter with collection of owning side (f.e ProductVersion::getBuildConfigurations)\n+     * @param owningSetter setter which updates the owning side (f.e BuildConfiguration::setProductVersion)\n+     * @param filter\n+     * @param <N>\n+     */\n+    public <N extends GenericEntity<ID>> void cascadeUpdates(\n+            N managedNonOwning,\n+            N updatedNonOwning,\n+            Function<N, Collection<T>> collectionGetter,\n+            BiConsumer<T, N> owningSetter,\n+            java.util.function.Predicate<T>... filter) {\n+        // we want only to compare IDs because the data from request can be partial (due to dto refs in Maps)\n+        Comparator<T> idComparator = (t, t1) -> t.getId().equals(t1.getId()) ? 0 : 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9a3428229eef153d480bc285534a89f2bbe48e66"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0692293d180e64c206d6c2153b75f36c73ebaf0d", "author": {"user": {"login": "michalovjan", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/0692293d180e64c206d6c2153b75f36c73ebaf0d", "committedDate": "2020-08-12T21:44:24Z", "message": "[NCL-5891] use Map<ID, T> instead of Set<T> in update cascading"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2572, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}