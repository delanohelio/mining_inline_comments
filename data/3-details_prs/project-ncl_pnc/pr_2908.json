{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2NTgzMDUz", "number": 2908, "title": "[NCL-5558] Respond with 403 status when Brew Push is forbidden becaus\u2026", "bodyText": "\u2026e of bad artifact quality\nChecklist:\n\n Have you added a note in the CHANGELOG wiki for your change if user-facing?\n Have you added unit tests for your change?", "createdAt": "2020-03-11T09:46:40Z", "url": "https://github.com/project-ncl/pnc/pull/2908", "merged": true, "mergeCommit": {"oid": "c178dc4e74aafa8f9136a95aad3fdb3dba717394"}, "closed": true, "closedAt": "2020-03-16T10:30:08Z", "author": {"login": "jomrazek"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMk9xxAFqTM3MjY1MzQ4Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOLVDBAFqTM3NTA2Njc5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjUzNDgy", "url": "https://github.com/project-ncl/pnc/pull/2908#pullrequestreview-372653482", "createdAt": "2020-03-11T10:54:17Z", "commit": {"oid": "bf0c576c1120adb1b0fd991bd67c1cfe33c4f49c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDo1NDoxN1rOF0x_8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDo1NzowN1rOF0yFtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg4OTQ1OA==", "bodyText": "Why is this needed?", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r390889458", "createdAt": "2020-03-11T10:54:17Z", "author": {"login": "janinko"}, "path": "facade/pom.xml", "diffHunk": "@@ -139,6 +139,11 @@\n             <artifactId>hibernate-core</artifactId>\n             <scope>provided</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>org.jboss.resteasy</groupId>\n+            <artifactId>resteasy-jaxrs</artifactId>\n+            <scope>provided</scope>\n+        </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf0c576c1120adb1b0fd991bd67c1cfe33c4f49c"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5MDI5MA==", "bodyText": "use the pushedResponse.get(0) before this if and everything will be much simpler.", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r390890290", "createdAt": "2020-03-11T10:55:54Z", "author": {"login": "janinko"}, "path": "facade/src/main/java/org/jboss/pnc/facade/impl/BrewPusherImpl.java", "diffHunk": "@@ -121,6 +119,10 @@ public BuildPushResult brewPush(String id, BuildPushRequest buildPushRequest) th\n                                 .build())\n                 .collect(Collectors.toList());\n \n+        if (pushed.stream().anyMatch(r -> r.getMessage().contains(\"BLACKLISTED/DELETED\"))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf0c576c1120adb1b0fd991bd67c1cfe33c4f49c"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5MDkzNA==", "bodyText": "the schema is actually BuildPushResultPage", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r390890934", "createdAt": "2020-03-11T10:57:07Z", "author": {"login": "janinko"}, "path": "rest-api/src/main/java/org/jboss/pnc/rest/api/endpoints/BuildEndpoint.java", "diffHunk": "@@ -328,6 +330,10 @@ void removeAttribute(\n                             responseCode = INVALID_CODE,\n                             description = INVALID_DESCRIPTION,\n                             content = @Content(schema = @Schema(implementation = ErrorResponse.class))),\n+                    @ApiResponse(\n+                            responseCode = FORBIDDEN_CODE,\n+                            description = FORBIDDEN_PUSH_DESCRIPTION,\n+                            content = @Content(schema = @Schema(implementation = ErrorResponse.class))),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bf0c576c1120adb1b0fd991bd67c1cfe33c4f49c"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bf0c576c1120adb1b0fd991bd67c1cfe33c4f49c", "author": {"user": {"login": "jomrazek", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/bf0c576c1120adb1b0fd991bd67c1cfe33c4f49c", "committedDate": "2020-03-11T09:44:19Z", "message": "[NCL-5558] Respond with 403 status when Brew Push is forbidden because of bad artifact quality"}, "afterCommit": {"oid": "08a06a606691c92e42086c76abf09d6b499232cb", "author": {"user": {"login": "jomrazek", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/08a06a606691c92e42086c76abf09d6b499232cb", "committedDate": "2020-03-11T12:23:31Z", "message": "[NCL-5558] Respond with 403 status when Brew Push is forbidden because of bad artifact quality"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNzI3ODY0", "url": "https://github.com/project-ncl/pnc/pull/2908#pullrequestreview-372727864", "createdAt": "2020-03-11T12:51:42Z", "commit": {"oid": "08a06a606691c92e42086c76abf09d6b499232cb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMjo1MTo0MlrOF01jYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMzowMzowN1rOF016xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk0NzY4MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static final String FORBIDDEN_PUSH_DESCRIPTION = \"Build contains artifacts of of insufficient quality\";\n          \n          \n            \n                public static final String FORBIDDEN_PUSH_DESCRIPTION = \"Build contains artifacts of insufficient quality\";", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r390947680", "createdAt": "2020-03-11T12:51:42Z", "author": {"login": "michalovjan"}, "path": "rest-api/src/main/java/org/jboss/pnc/rest/configuration/SwaggerConstants.java", "diffHunk": "@@ -42,6 +42,7 @@\n     public static final String INVALID_CODE = \"400\";\n     public static final String FORBIDDEN_DESCRIPTION = \"User must be logged in.\";\n     public static final String FORBIDDEN_CODE = \"403\";\n+    public static final String FORBIDDEN_PUSH_DESCRIPTION = \"Build contains artifacts of of insufficient quality\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08a06a606691c92e42086c76abf09d6b499232cb"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDk1MzY3MQ==", "bodyText": "Maybe throw different exception. Wrap it in the rest-new module or write exception mapper?", "url": "https://github.com/project-ncl/pnc/pull/2908#discussion_r390953671", "createdAt": "2020-03-11T13:03:07Z", "author": {"login": "michalovjan"}, "path": "facade/pom.xml", "diffHunk": "@@ -139,6 +139,11 @@\n             <artifactId>hibernate-core</artifactId>\n             <scope>provided</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>org.jboss.resteasy</groupId>\n+            <artifactId>resteasy-jaxrs</artifactId>\n+            <scope>provided</scope>\n+        </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg4OTQ1OA=="}, "originalCommit": {"oid": "bf0c576c1120adb1b0fd991bd67c1cfe33c4f49c"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5ce2a8f7a35ca026124968e2412d8bf7da54970", "author": {"user": {"login": "jomrazek", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/f5ce2a8f7a35ca026124968e2412d8bf7da54970", "committedDate": "2020-03-11T16:16:28Z", "message": "[NCL-5558] Respond with 403 status when Brew Push is forbidden because of bad artifact quality"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "08a06a606691c92e42086c76abf09d6b499232cb", "author": {"user": {"login": "jomrazek", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/08a06a606691c92e42086c76abf09d6b499232cb", "committedDate": "2020-03-11T12:23:31Z", "message": "[NCL-5558] Respond with 403 status when Brew Push is forbidden because of bad artifact quality"}, "afterCommit": {"oid": "f5ce2a8f7a35ca026124968e2412d8bf7da54970", "author": {"user": {"login": "jomrazek", "name": null}}, "url": "https://github.com/project-ncl/pnc/commit/f5ce2a8f7a35ca026124968e2412d8bf7da54970", "committedDate": "2020-03-11T16:16:28Z", "message": "[NCL-5558] Respond with 403 status when Brew Push is forbidden because of bad artifact quality"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0MTI4NDE3", "url": "https://github.com/project-ncl/pnc/pull/2908#pullrequestreview-374128417", "createdAt": "2020-03-13T08:45:38Z", "commit": {"oid": "f5ce2a8f7a35ca026124968e2412d8bf7da54970"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MDY2Nzkw", "url": "https://github.com/project-ncl/pnc/pull/2908#pullrequestreview-375066790", "createdAt": "2020-03-16T10:12:58Z", "commit": {"oid": "f5ce2a8f7a35ca026124968e2412d8bf7da54970"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2684, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}