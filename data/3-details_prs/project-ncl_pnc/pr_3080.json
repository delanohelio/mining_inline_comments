{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3NjUwNTA2", "number": 3080, "title": "[NCL-5680] - Update the model related to Artifacts and revision of quality levels change", "bodyText": "Created a new ArtifactAudited table, to watch and record changes related to the ArtifactQuality related fields. Added new fields to record the creationTime, creationUser, modificationTime and modificationUser, and the reason why an ArtifactQuality has changed.", "createdAt": "2020-06-04T07:43:48Z", "url": "https://github.com/project-ncl/pnc/pull/3080", "merged": true, "mergeCommit": {"oid": "76ec6dfca23ec83f896399809b9dde3ad9a05fa8"}, "closed": true, "closedAt": "2020-06-09T14:12:09Z", "author": {"login": "vibe13"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoUleMgBqjM0MTE5MjQxNTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcplKqvgFqTQyNzE1MTcyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3fd58b365e993206c995c0691d6534dad09ee9a4", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/3fd58b365e993206c995c0691d6534dad09ee9a4", "committedDate": "2020-06-04T08:36:32Z", "message": "Fix formatting"}, "afterCommit": {"oid": "cd3480d0236426896bed32b90a788e0924711100", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/cd3480d0236426896bed32b90a788e0924711100", "committedDate": "2020-06-05T15:41:37Z", "message": "Rebase to solve some conflicts with latest changes on master branch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd3480d0236426896bed32b90a788e0924711100", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/cd3480d0236426896bed32b90a788e0924711100", "committedDate": "2020-06-05T15:41:37Z", "message": "Rebase to solve some conflicts with latest changes on master branch"}, "afterCommit": {"oid": "6c10ea04baf63a1db7b98f77cc47eac3b8cd1d57", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/6c10ea04baf63a1db7b98f77cc47eac3b8cd1d57", "committedDate": "2020-06-08T12:59:09Z", "message": "Remove creationTime and creationUser from the audited fields in Artifacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "055d33be78591fe5e1ab2984b07ba22716d64c89", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/055d33be78591fe5e1ab2984b07ba22716d64c89", "committedDate": "2020-06-09T08:15:14Z", "message": "Added ArtifactAudited table to audit Quality label related fields in the Artifact table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b16524b029a68fc106a5122e262e22fadf55f96", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/3b16524b029a68fc106a5122e262e22fadf55f96", "committedDate": "2020-06-09T08:15:14Z", "message": "Fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a474949ad91f10b1f75e3f300016f455d6874a3", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/0a474949ad91f10b1f75e3f300016f455d6874a3", "committedDate": "2020-06-09T08:15:14Z", "message": "When an artifact is updated, change modificationUser and modificationTime only if the audited fields related to Quality labels have changed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e064705ffa94dc35902b21efc68d2069798d0a8a", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/e064705ffa94dc35902b21efc68d2069798d0a8a", "committedDate": "2020-06-09T08:15:14Z", "message": "When storing or updating an artifact, set the creation and modification properties; added tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0d175d328610644b71d3f7c700fb874999f312e", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/c0d175d328610644b71d3f7c700fb874999f312e", "committedDate": "2020-06-09T08:15:14Z", "message": "Added endpoints for the ArtifactAudited entities; added tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb986a2a9aa80134666f146a8812c6c7d19bde07", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/fb986a2a9aa80134666f146a8812c6c7d19bde07", "committedDate": "2020-06-09T08:15:14Z", "message": "Fix formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c7581cb58eddc73b4c1bad62aa4d3e0a5e8e7b8", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/1c7581cb58eddc73b4c1bad62aa4d3e0a5e8e7b8", "committedDate": "2020-06-09T08:15:14Z", "message": "Rebase to solve some conflicts with latest changes on master branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52b545274f6d5f748aa1bc27fddc5997cb1534d0", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/52b545274f6d5f748aa1bc27fddc5997cb1534d0", "committedDate": "2020-06-09T08:15:14Z", "message": "Remove creationTime and creationUser from the audited fields in Artifacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db776e1c350d0a6b406299bb723c09bbd2cac1b3", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/db776e1c350d0a6b406299bb723c09bbd2cac1b3", "committedDate": "2020-06-09T09:54:41Z", "message": "Refactor the reason of quality setting to qualityLevelReason"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c10ea04baf63a1db7b98f77cc47eac3b8cd1d57", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/6c10ea04baf63a1db7b98f77cc47eac3b8cd1d57", "committedDate": "2020-06-08T12:59:09Z", "message": "Remove creationTime and creationUser from the audited fields in Artifacts"}, "afterCommit": {"oid": "db776e1c350d0a6b406299bb723c09bbd2cac1b3", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/db776e1c350d0a6b406299bb723c09bbd2cac1b3", "committedDate": "2020-06-09T09:54:41Z", "message": "Refactor the reason of quality setting to qualityLevelReason"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MDk0NDc3", "url": "https://github.com/project-ncl/pnc/pull/3080#pullrequestreview-427094477", "createdAt": "2020-06-09T12:35:10Z", "commit": {"oid": "db776e1c350d0a6b406299bb723c09bbd2cac1b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMjozNToxMFrOGhHZMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMjozNToxMFrOGhHZMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM3NzMzMA==", "bodyText": "Do we want to create new revision when the Quality level doesn't change? That means there will be 2 revisions only different with modificationUser and modificationTime but nothing else changed.", "url": "https://github.com/project-ncl/pnc/pull/3080#discussion_r437377330", "createdAt": "2020-06-09T12:35:10Z", "author": {"login": "janinko"}, "path": "facade/src/main/java/org/jboss/pnc/facade/providers/ArtifactProviderImpl.java", "diffHunk": "@@ -91,14 +119,26 @@ public ArtifactProviderImpl(\n     @Override\n     @RolesAllowed(SYSTEM_USER)\n     public org.jboss.pnc.dto.Artifact store(org.jboss.pnc.dto.Artifact restEntity) throws DTOValidationException {\n-        return super.store(restEntity);\n+        org.jboss.pnc.model.User currentUser = userService.currentUser();\n+        User user = userMapper.toDTO(currentUser);\n+        Instant now = Instant.now();\n+        return super.store(\n+                restEntity.toBuilder()\n+                        .creationUser(user)\n+                        .modificationUser(user)\n+                        .creationTime(now)\n+                        .modificationTime(now)\n+                        .build());\n     }\n \n     @Override\n     @RolesAllowed(SYSTEM_USER)\n     public org.jboss.pnc.dto.Artifact update(String id, org.jboss.pnc.dto.Artifact restEntity)\n             throws DTOValidationException {\n-        return super.update(id, restEntity);\n+        org.jboss.pnc.model.User currentUser = userService.currentUser();\n+        User user = userMapper.toDTO(currentUser);\n+        Instant now = Instant.now();\n+        return super.update(id, restEntity.toBuilder().modificationUser(user).modificationTime(now).build());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "db776e1c350d0a6b406299bb723c09bbd2cac1b3"}, "originalPosition": 119}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MTUxNzI5", "url": "https://github.com/project-ncl/pnc/pull/3080#pullrequestreview-427151729", "createdAt": "2020-06-09T13:35:07Z", "commit": {"oid": "db776e1c350d0a6b406299bb723c09bbd2cac1b3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2582, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}