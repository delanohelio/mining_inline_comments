{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyODY1MzY0", "number": 3296, "title": "[NCL-6032] - PNC should wait for a pod to be available instead of giv\u2026", "bodyText": "\u2026ing a SYSTEM_ERROR after 300s\nChecklist:\n\n Have you added a note in the CHANGELOG wiki for your change if user-facing?\n Have you added unit tests for your change?", "createdAt": "2020-09-09T13:58:37Z", "url": "https://github.com/project-ncl/pnc/pull/3296", "merged": true, "mergeCommit": {"oid": "403f8bb7b9c8209dd39731e8e130697e77c20f48"}, "closed": true, "closedAt": "2020-09-11T08:33:05Z", "author": {"login": "vibe13"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHMo0WgH2gAyNDgyODY1MzY0OmM0ZjZkZDAyNGU0MDVkMmY5YWZjZmJhMmJiNGNlMzM4YmE4ZmZiZDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHi79RAH2gAyNDgyODY1MzY0OjAzNTE2NjhkNjcyNGFmYjk2MzQzMWQwYTU4YzYwNmM5MjY1NDgzOWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c4f6dd024e405d2f9afcfba2bb4ce338ba8ffbd5", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/c4f6dd024e405d2f9afcfba2bb4ce338ba8ffbd5", "committedDate": "2020-09-09T13:58:09Z", "message": "[NCL-6032] - PNC should wait for a pod to be available instead of giving a SYSTEM_ERROR after 300s"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1Mzg3Mzkw", "url": "https://github.com/project-ncl/pnc/pull/3296#pullrequestreview-485387390", "createdAt": "2020-09-09T20:40:51Z", "commit": {"oid": "c4f6dd024e405d2f9afcfba2bb4ce338ba8ffbd5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMDo0MDo1MlrOHPZisA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQyMDo0MDo1MlrOHPZisA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkwOTE2OA==", "bodyText": "I think we can get rid of like 65:\ntimeout = reader.getIntValueFromPropertyOrDefault(PULLING_MONITOR_TIMEOUT_KEY, DEFAULT_TIMEOUT);\n\nSince that'll make it confusing on how to configure the default polling monitor timeout (env var v/s config file). Then on line 84, we can just use the 'DEFAULT_TIMEOUT' as our timeout. WDYT?", "url": "https://github.com/project-ncl/pnc/pull/3296#discussion_r485909168", "createdAt": "2020-09-09T20:40:52Z", "author": {"login": "thescouser89"}, "path": "common/src/main/java/org/jboss/pnc/common/monitor/PollingMonitor.java", "diffHunk": "@@ -84,6 +84,19 @@ public PollingMonitor() {\n         return monitor(condition, checkInterval, timeout, DEFAULT_TIME_UNIT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4f6dd024e405d2f9afcfba2bb4ce338ba8ffbd5"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65ad3cafd85863b3b5febc6335afc1a20019e452", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/65ad3cafd85863b3b5febc6335afc1a20019e452", "committedDate": "2020-09-09T21:52:25Z", "message": "Add and manage list of retry-able pod statuses; add Error and InvalidImageName to the list of detected pod error statuses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NzIwNDM1", "url": "https://github.com/project-ncl/pnc/pull/3296#pullrequestreview-485720435", "createdAt": "2020-09-10T08:51:33Z", "commit": {"oid": "65ad3cafd85863b3b5febc6335afc1a20019e452"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwODo1MTozNFrOHPptlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwODo1NDowNlrOHPpzjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3NDEwMQ==", "bodyText": "Since the value is assigned in the previous line from the constant, what is the case for null ?", "url": "https://github.com/project-ncl/pnc/pull/3296#discussion_r486174101", "createdAt": "2020-09-10T08:51:34Z", "author": {"login": "matejonnet"}, "path": "moduleconfig/src/main/java/org/jboss/pnc/common/json/moduleconfig/OpenshiftEnvironmentDriverModuleConfig.java", "diffHunk": "@@ -92,9 +98,30 @@ public OpenshiftEnvironmentDriverModuleConfig(\n         this.containerPort = containerPort;\n         this.keepBuildAgentInstance = keepBuildAgentInstance != null ? keepBuildAgentInstance : false;\n         this.exposeBuildAgentOnPublicUrl = exposeBuildAgentOnPublicUrl != null ? exposeBuildAgentOnPublicUrl : false;\n-        this.creationPodRetry = creationPodRetry;\n         this.builderPodMemory = builderPodMemory == null ? DEFAULT_BUILDER_POD_MEMORY : builderPodMemory;\n \n+        this.creationPodRetry = DEFAULT_CREATION_POD_RETRY;\n+        if (creationPodRetry != null) {\n+            try {\n+                this.creationPodRetry = Integer.parseInt(creationPodRetry);\n+            } catch (NumberFormatException e) {\n+                log.error(\n+                        \"Couldn't parse the value of creation pod retry from the configuration. Using default ({} retries)\",\n+                        DEFAULT_CREATION_POD_RETRY);\n+            }\n+        }\n+\n+        this.pollingMonitorTimeout = PollingMonitor.DEFAULT_TIMEOUT;\n+        if (pollingMonitorTimeout != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65ad3cafd85863b3b5febc6335afc1a20019e452"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3NTYzMQ==", "bodyText": "Please use \"readable\" variable name. eg: failedStartException", "url": "https://github.com/project-ncl/pnc/pull/3296#discussion_r486175631", "createdAt": "2020-09-10T08:54:06Z", "author": {"login": "matejonnet"}, "path": "openshift-environment-driver/src/main/java/org/jboss/pnc/environment/openshift/OpenshiftStartedEnvironment.java", "diffHunk": "@@ -476,8 +478,21 @@ private void monitorInitialization(\n                         if (retries == 0) {\n                             onError.accept(new Exception(throwable));\n                         } else {\n-                            logger.error(\"Creating build environment failed! Retrying...\", throwable);\n-                            retryEnvironment(onComplete, onError, retries);\n+                            PodFailedStartException pfsExc = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "65ad3cafd85863b3b5febc6335afc1a20019e452"}, "originalPosition": 94}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "258b64edeffec3e56e15d6fe6223101ee293e169", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/258b64edeffec3e56e15d6fe6223101ee293e169", "committedDate": "2020-09-10T09:46:11Z", "message": "Renaming of exception to readable name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a975fe379bc2d3894ef4a700cafac707fc9118f0", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/a975fe379bc2d3894ef4a700cafac707fc9118f0", "committedDate": "2020-09-10T10:13:06Z", "message": "Fix formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bf9f261bb385d94bf19e9706700e4a73c96e87d", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/5bf9f261bb385d94bf19e9706700e4a73c96e87d", "committedDate": "2020-09-10T15:51:23Z", "message": "Removal of env var and renaming of PullingMonitor occurrences to PollingMonitor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0351668d6724afb963431d0a58c606c92654839b", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/0351668d6724afb963431d0a58c606c92654839b", "committedDate": "2020-09-10T15:56:58Z", "message": "Specify new polling monitor check interval"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2526, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}