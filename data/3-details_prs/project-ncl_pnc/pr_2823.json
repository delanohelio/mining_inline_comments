{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4OTk2MTk1", "number": 2823, "title": "Ncl 5400 - Enable the second level cache", "bodyText": "Checklist:\n\n Have you added a note in the CHANGELOG wiki for your change if user-facing?\n Have you added unit tests for your change?", "createdAt": "2020-01-30T10:30:09Z", "url": "https://github.com/project-ncl/pnc/pull/2823", "merged": true, "mergeCommit": {"oid": "26e1b460f50da6f10f963dc8f0a06e32f7d2812d"}, "closed": true, "closedAt": "2020-01-31T15:04:07Z", "author": {"login": "vibe13"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_XaLVAH2gAyMzY4OTk2MTk1OmZlNDU5MTYzNWE0NzA2MjI0ODZmNzFiZDkwMTM5NDE4MWM1NDlmMjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_waXcAFqTM1MTU1OTM1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fe4591635a470622486f71bd901394181c549f24", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/fe4591635a470622486f71bd901394181c549f24", "committedDate": "2020-01-30T09:48:34Z", "message": "Configure batch size to improve performance when doing bulk inserts and updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d4e2665364a244d05b46ca3987f4bcfecbabcd4", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/6d4e2665364a244d05b46ca3987f4bcfecbabcd4", "committedDate": "2020-01-30T10:17:31Z", "message": "Enable second level cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee7c05305df005adb9c9e58a17a295115eae84e6", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/ee7c05305df005adb9c9e58a17a295115eae84e6", "committedDate": "2020-01-30T10:28:53Z", "message": "Raise errors instead of warnings in case pagination is done in memory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "649d64f47aa80b0d43fb0f4bb12be1e176a6db27", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/649d64f47aa80b0d43fb0f4bb12be1e176a6db27", "committedDate": "2020-01-30T11:11:28Z", "message": "Fix test for PNC 2.0 model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83d8fe81d388ca035f4761a7a2628561e6e50b01", "author": {"user": {"login": "vibe13", "name": "Andrea Vibelli"}}, "url": "https://github.com/project-ncl/pnc/commit/83d8fe81d388ca035f4761a7a2628561e6e50b01", "committedDate": "2020-01-30T16:41:16Z", "message": "Added caching to collections"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNTA1NDM3", "url": "https://github.com/project-ncl/pnc/pull/2823#pullrequestreview-351505437", "createdAt": "2020-01-31T13:32:35Z", "commit": {"oid": "83d8fe81d388ca035f4761a7a2628561e6e50b01"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMzozMjozNVrOFkLaAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMzozNzowMVrOFkLhBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ3OTkzNg==", "bodyText": "It would be good to monitor the size of the cache. My feeling is that higher number might be better for us as we have milions of artifacts and my feeling is that we might fill the cache quite quickly. I'd consider adding a metrics for it and increasing the cache for artifacts.", "url": "https://github.com/project-ncl/pnc/pull/2823#discussion_r373479936", "createdAt": "2020-01-31T13:32:35Z", "author": {"login": "jbartece"}, "path": "datastore/src/main/resources/META-INF/persistence.xml", "diffHunk": "@@ -37,6 +38,43 @@\n           <property name=\"org.hibernate.envers.do_not_audit_optimistic_locking_field\" value=\"false\"/>\n           <property name=\"hibernate.generate_statistics\" value=\"true\" />\n \n+          <!-- Configure batches to improve performance when doing bulk inserts and updates.\n+               Do not exceed with the size because when an entity is persisted, Hibernate stores it in the persistence context (in memory) before flushing.\n+          -->\n+          <property name=\"hibernate.jdbc.batch_size\" value=\"50\"/>\n+          <property name=\"hibernate.order_inserts\" value=\"true\"/>\n+          <property name=\"hibernate.order_updates\" value=\"true\"/>\n+          <property name=\"hibernate.batch_versioned_data\" value=\"true\"/>\n+\n+          <!-- Raise error instead of warning if \u201cHHH000104: firstResult/maxResults specified with collection fetch; applying in memory!\u201d is detected (since Hibernate 5.2.13) -->\n+          <property name=\"hibernate.query.fail_on_pagination_over_collection_fetch\" value=\"true\"/>\n+\n+          <!--\n+              Infinispan second level cache (default Wildfly settings are\n+              https://infinispan.org/docs/stable/titles/integrating/integrating.html#default_local_configuration_second_level):\n+                - Eviction wake up interval is 5 seconds.\n+                - Max number of entries are 10,000.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83d8fe81d388ca035f4761a7a2628561e6e50b01"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ4MTczNA==", "bodyText": "Shouldn't we use Infinispan version bundled with EAP?", "url": "https://github.com/project-ncl/pnc/pull/2823#discussion_r373481734", "createdAt": "2020-01-31T13:37:01Z", "author": {"login": "jbartece"}, "path": "pom.xml", "diffHunk": "@@ -131,6 +131,7 @@\n     <version.jackson.databind>2.10.1</version.jackson.databind>\n     <version.org.jboss.resteasy>3.6.1.SP5</version.org.jboss.resteasy>\n     <version.hibernate>5.3.10.Final</version.hibernate>\n+    <version.org.infinispan>9.3.6.Final</version.org.infinispan>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83d8fe81d388ca035f4761a7a2628561e6e50b01"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNTU5MzUw", "url": "https://github.com/project-ncl/pnc/pull/2823#pullrequestreview-351559350", "createdAt": "2020-01-31T14:56:20Z", "commit": {"oid": "83d8fe81d388ca035f4761a7a2628561e6e50b01"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNDo1NjoyMFrOFkN5sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNDo1NjoyMFrOFkN5sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzUyMDgxNg==", "bodyText": "I didn't realize we don't use the runtime-artifacts BOM. Not sure it is worth adding it just for this one artifact for tests.\nLet's leave it as is", "url": "https://github.com/project-ncl/pnc/pull/2823#discussion_r373520816", "createdAt": "2020-01-31T14:56:20Z", "author": {"login": "jbartece"}, "path": "pom.xml", "diffHunk": "@@ -131,6 +131,7 @@\n     <version.jackson.databind>2.10.1</version.jackson.databind>\n     <version.org.jboss.resteasy>3.6.1.SP5</version.org.jboss.resteasy>\n     <version.hibernate>5.3.10.Final</version.hibernate>\n+    <version.org.infinispan>9.3.6.Final</version.org.infinispan>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ4MTczNA=="}, "originalCommit": {"oid": "83d8fe81d388ca035f4761a7a2628561e6e50b01"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2703, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}