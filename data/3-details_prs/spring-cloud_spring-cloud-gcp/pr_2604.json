{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5NjY0Nzg3", "number": 2604, "title": "Fix auditing when running through DatastoreTemplate.performTransaction", "bodyText": "The new DatastoreTemplate instance should have the same\nApplicationEventPublisher as the original one, so that AuditingHandler\ncan be called.\nFixes #2603", "createdAt": "2020-11-30T16:29:58Z", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2604", "merged": true, "mergeCommit": {"oid": "1909fe1226e406a92ee7138f02ffd15485a3d025"}, "closed": true, "closedAt": "2020-11-30T22:17:35Z", "author": {"login": "fpavageau"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhoyl-AFqTU0MTEzMTYyOQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhs65_AFqTU0MTMzOTcyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMTMxNjI5", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2604#pullrequestreview-541131629", "createdAt": "2020-11-30T17:26:32Z", "commit": {"oid": "fb40156407d388982494b445a5195920569f5941"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNzoyNjozMlrOH8FspQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNzoyNjozMlrOH8FspQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc2OTk1Nw==", "bodyText": "I see mock setup all done in datastoreTemplate(). Would it make sense to move it there?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2604#discussion_r532769957", "createdAt": "2020-11-30T17:26:32Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-data-datastore/src/test/java/org/springframework/cloud/gcp/data/datastore/core/DatastoreTemplateAuditingTests.java", "diffHunk": "@@ -82,6 +84,20 @@ public void testModifiedPrevProperties() {\n \t\tthis.datastoreTemplate.saveAll(Collections.singletonList(testEntity));\n \t}\n \n+\t@Test\n+\tpublic void testInTransaction() {\n+\t\twhen(datastore.runInTransaction(any()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb40156407d388982494b445a5195920569f5941"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "278d09cf68d2ad8d0224b1ae905352fb5f59800b", "author": {"user": {"login": "fpavageau", "name": "Frank Pavageau"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/278d09cf68d2ad8d0224b1ae905352fb5f59800b", "committedDate": "2020-11-30T21:19:56Z", "message": "Fix auditing when running through DatastoreTemplate.performTransaction\n\nThe new `DatastoreTemplate` instance should have the same\n`ApplicationEventPublisher` as the original one, so that `AuditingHandler`\ncan be called."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb40156407d388982494b445a5195920569f5941", "author": {"user": {"login": "fpavageau", "name": "Frank Pavageau"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/fb40156407d388982494b445a5195920569f5941", "committedDate": "2020-11-30T16:28:40Z", "message": "Fix auditing when running through DatastoreTemplate.performTransaction\n\nThe new `DatastoreTemplate` instance should have the same\n`ApplicationEventPublisher` as the original one, so that `AuditingHandler`\ncan be called."}, "afterCommit": {"oid": "278d09cf68d2ad8d0224b1ae905352fb5f59800b", "author": {"user": {"login": "fpavageau", "name": "Frank Pavageau"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/278d09cf68d2ad8d0224b1ae905352fb5f59800b", "committedDate": "2020-11-30T21:19:56Z", "message": "Fix auditing when running through DatastoreTemplate.performTransaction\n\nThe new `DatastoreTemplate` instance should have the same\n`ApplicationEventPublisher` as the original one, so that `AuditingHandler`\ncan be called."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMzM5NzI1", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2604#pullrequestreview-541339725", "createdAt": "2020-11-30T22:16:54Z", "commit": {"oid": "278d09cf68d2ad8d0224b1ae905352fb5f59800b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 429, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}