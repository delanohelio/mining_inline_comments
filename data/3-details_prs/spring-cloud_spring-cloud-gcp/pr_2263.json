{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMzM1Nzg4", "number": 2263, "title": "Add support for spring.cloud.gcp.secretmanager.version property", "bodyText": "", "createdAt": "2020-03-20T03:43:24Z", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263", "merged": true, "mergeCommit": {"oid": "e909037872e06679efc4e6dbd0d2106cd44568d6"}, "closed": true, "closedAt": "2020-03-21T21:36:00Z", "author": {"login": "eddumelendez"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPYrgHgBqjMxNDgwMDQ5ODI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcP8DJKgFqTM3ODk1MzUxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53fdcd33e2e2f1861f698c4c1db5e900422f3abc", "author": {"user": {"login": "eddumelendez", "name": "Edd\u00fa Mel\u00e9ndez Gonzales"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/53fdcd33e2e2f1861f698c4c1db5e900422f3abc", "committedDate": "2020-03-20T03:39:24Z", "message": "Add support for spring.cloud.gcp.secretmanager.version property\n\nSee gh-2260"}, "afterCommit": {"oid": "489dde6722f67249c1a5863243d00d4dda24c0a4", "author": {"user": {"login": "eddumelendez", "name": "Edd\u00fa Mel\u00e9ndez Gonzales"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/489dde6722f67249c1a5863243d00d4dda24c0a4", "committedDate": "2020-03-20T04:20:04Z", "message": "Add support for spring.cloud.gcp.secretmanager.version property\n\nSee gh-2260"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e80f5fabbcf3841984bfe2f4b6731d49a4866cba", "author": {"user": {"login": "eddumelendez", "name": "Edd\u00fa Mel\u00e9ndez Gonzales"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/e80f5fabbcf3841984bfe2f4b6731d49a4866cba", "committedDate": "2020-03-20T04:21:41Z", "message": "Add support for spring.cloud.gcp.secretmanager.version property\n\nSee gh-2260"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51b74c76c9dcf99ba835a4df7669fc965bf5b012", "author": {"user": {"login": "eddumelendez", "name": "Edd\u00fa Mel\u00e9ndez Gonzales"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/51b74c76c9dcf99ba835a4df7669fc965bf5b012", "committedDate": "2020-03-20T05:03:31Z", "message": "Add support to load specific secret versions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "489dde6722f67249c1a5863243d00d4dda24c0a4", "author": {"user": {"login": "eddumelendez", "name": "Edd\u00fa Mel\u00e9ndez Gonzales"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/489dde6722f67249c1a5863243d00d4dda24c0a4", "committedDate": "2020-03-20T04:20:04Z", "message": "Add support for spring.cloud.gcp.secretmanager.version property\n\nSee gh-2260"}, "afterCommit": {"oid": "51b74c76c9dcf99ba835a4df7669fc965bf5b012", "author": {"user": {"login": "eddumelendez", "name": "Edd\u00fa Mel\u00e9ndez Gonzales"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/51b74c76c9dcf99ba835a4df7669fc965bf5b012", "committedDate": "2020-03-20T05:03:31Z", "message": "Add support to load specific secret versions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NTI0MzIz", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#pullrequestreview-378524323", "createdAt": "2020-03-20T14:21:03Z", "commit": {"oid": "51b74c76c9dcf99ba835a4df7669fc965bf5b012"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoyMTowNFrOF5VqtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoyNjo1NlrOF5V6pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY2ODE0OQ==", "bodyText": "I think I would rather just keep it null to indicate to use the default.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#discussion_r395668149", "createdAt": "2020-03-20T14:21:04Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/secretmanager/GcpSecretManagerProperties.java", "diffHunk": "@@ -42,6 +45,18 @@\n \t */\n \tprivate String secretNamePrefix = \"\";\n \n+\tprivate static final String LATEST_VERSION_STRING = \"latest\";\n+\n+\t/**\n+\t * Defines the secret's version to be used.\n+\t */\n+\tprivate String version = LATEST_VERSION_STRING;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51b74c76c9dcf99ba835a4df7669fc965bf5b012"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY2ODc0OA==", "bodyText": "This change to the constructor would be breaking. Can we instead add an additional constructor with extra version params?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#discussion_r395668748", "createdAt": "2020-03-20T14:21:56Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/secretmanager/SecretManagerPropertySource.java", "diffHunk": "@@ -48,12 +47,14 @@ public SecretManagerPropertySource(\n \t\t\tString propertySourceName,\n \t\t\tSecretManagerServiceClient client,\n \t\t\tGcpProjectIdProvider projectIdProvider,\n-\t\t\tString secretsPrefix) {\n+\t\t\tString secretsPrefix,\n+\t\t\tString version,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51b74c76c9dcf99ba835a4df7669fc965bf5b012"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY3MDkzNQ==", "bodyText": "Again, maybe add an additional constructor rather than introducing a breaking change?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#discussion_r395670935", "createdAt": "2020-03-20T14:25:02Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/secretmanager/SecretManagerPropertySourceLocator.java", "diffHunk": "@@ -40,13 +43,21 @@\n \n \tprivate final String secretsPrefix;\n \n+\tprivate final String version;\n+\n+\tprivate final Map<String, String> versions;\n+\n \tSecretManagerPropertySourceLocator(\n \t\t\tSecretManagerServiceClient client,\n \t\t\tGcpProjectIdProvider projectIdProvider,\n-\t\t\tString secretsPrefix) {\n+\t\t\tString secretsPrefix,\n+\t\t\tString version,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51b74c76c9dcf99ba835a4df7669fc965bf5b012"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY3MjIzMA==", "bodyText": "Can we add another test where both secretmanager.version and secretmanager.versions are specified and verify that the second takes precedence?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#discussion_r395672230", "createdAt": "2020-03-20T14:26:56Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-autoconfigure/src/test/java/org/springframework/cloud/gcp/autoconfigure/secretmanager/it/SecretManagerIntegrationTests.java", "diffHunk": "@@ -103,13 +103,52 @@ public void testConfigurationDisabled() {\n \t\t\t\t.getProperty(\"spring-cloud-gcp.secrets.my-secret\")).isNull();\n \t}\n \n+\t@Test\n+\tpublic void testVersion() {\n+\t\tthis.context = new SpringApplicationBuilder()\n+\t\t\t\t.sources(GcpContextAutoConfiguration.class, GcpSecretManagerBootstrapConfiguration.class)\n+\t\t\t\t.web(WebApplicationType.NONE)\n+\t\t\t\t.properties(\"spring.cloud.gcp.secretmanager.bootstrap.enabled=true\")\n+\t\t\t\t.properties(\"spring.cloud.gcp.secretmanager.bootstrap.version=2\")\n+\t\t\t\t.run();\n+\n+\t\tcreateSecret(TEST_SECRET_ID, \"the secret data\");\n+\t\tassertThat(secretExists(TEST_SECRET_ID, \"1\")).isTrue();\n+\t\tcreateSecret(TEST_SECRET_ID, \"the secret data v2\");\n+\t\tassertThat(secretExists(TEST_SECRET_ID, \"2\")).isTrue();\n+\t\tassertThat(secretExists(TEST_SECRET_ID, \"latest\")).isTrue();\n+\n+\t\tbyte[] byteArraySecret = this.context.getEnvironment().getProperty(\"my-secret\", byte[].class);\n+\t\tassertThat(byteArraySecret).isEqualTo(\"the secret data v2.\".getBytes());\n+\t}\n+\n+\t@Test\n+\tpublic void testSecretsWithSpecificVersion() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51b74c76c9dcf99ba835a4df7669fc965bf5b012"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f30671e80c135fb975b890933958816bc6f87fdf", "author": {"user": {"login": "eddumelendez", "name": "Edd\u00fa Mel\u00e9ndez Gonzales"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/f30671e80c135fb975b890933958816bc6f87fdf", "committedDate": "2020-03-20T16:04:36Z", "message": "Add test to ensure specific version has priority over the global"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5e701193f52bda6fc5303834e573fb5c0d8f8f9", "author": {"user": {"login": "eddumelendez", "name": "Edd\u00fa Mel\u00e9ndez Gonzales"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/e5e701193f52bda6fc5303834e573fb5c0d8f8f9", "committedDate": "2020-03-20T16:05:13Z", "message": "Fix filter due to getName() doesn't contain the version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5236687eba0be4c925a0daf86fe75e19faf8e342", "author": {"user": {"login": "eddumelendez", "name": "Edd\u00fa Mel\u00e9ndez Gonzales"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/5236687eba0be4c925a0daf86fe75e19faf8e342", "committedDate": "2020-03-20T18:02:07Z", "message": "Remove latest default value for version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b53502e5d95065bf8cc1457d83f054e67a468f6", "author": {"user": {"login": "eddumelendez", "name": "Edd\u00fa Mel\u00e9ndez Gonzales"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/1b53502e5d95065bf8cc1457d83f054e67a468f6", "committedDate": "2020-03-21T01:37:51Z", "message": "Add docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "946954064336210449a36874f4cf56fe346e3879", "author": {"user": {"login": "eddumelendez", "name": "Edd\u00fa Mel\u00e9ndez Gonzales"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/946954064336210449a36874f4cf56fe346e3879", "committedDate": "2020-03-21T01:48:58Z", "message": "Polish"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODg1MTk4", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#pullrequestreview-378885198", "createdAt": "2020-03-21T02:36:52Z", "commit": {"oid": "946954064336210449a36874f4cf56fe346e3879"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMjozNjo1MlrOF5nF9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMjozNzo0MVrOF5nGMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MzY1Mg==", "bodyText": "The effective default is latest.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#discussion_r395953652", "createdAt": "2020-03-21T02:36:52Z", "author": {"login": "meltsufin"}, "path": "docs/src/main/asciidoc/secretmanager.adoc", "diffHunk": "@@ -51,6 +51,8 @@ Spring Cloud GCP Secret Manager offers several configuration properties to custo\n | Name | Description | Required | Default value\n | `spring.cloud.gcp.secretmanager.bootstrap.enabled` | Enables loading secrets from Secret Manager as a bootstrap property source. Set this to **true** to enable the feature. | No | `false`\n | `spring.cloud.gcp.secretmanager.secret-name-prefix` | A prefix string to prepend to the property names of secrets read from Secret Manager | No | \"\" (empty string)\n+| `spring.cloud.gcp.secretmanager.version` | Defines a specific version of secrets to read from Secret Manager | No | \"\" (empty string)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "946954064336210449a36874f4cf56fe346e3879"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MzcxNQ==", "bodyText": "Should probably mention that it takes precedence over s.c.g.secretmanager.version.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#discussion_r395953715", "createdAt": "2020-03-21T02:37:41Z", "author": {"login": "meltsufin"}, "path": "docs/src/main/asciidoc/secretmanager.adoc", "diffHunk": "@@ -51,6 +51,8 @@ Spring Cloud GCP Secret Manager offers several configuration properties to custo\n | Name | Description | Required | Default value\n | `spring.cloud.gcp.secretmanager.bootstrap.enabled` | Enables loading secrets from Secret Manager as a bootstrap property source. Set this to **true** to enable the feature. | No | `false`\n | `spring.cloud.gcp.secretmanager.secret-name-prefix` | A prefix string to prepend to the property names of secrets read from Secret Manager | No | \"\" (empty string)\n+| `spring.cloud.gcp.secretmanager.version` | Defines a specific version of secrets to read from Secret Manager | No | \"\" (empty string)\n+| `spring.cloud.gcp.secretmanager.versions.<secret-id>` | Defines a version for a specific secret-id to read from Secret Manager | No | \"\" (empty string)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "946954064336210449a36874f4cf56fe346e3879"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c19dda4b911a79585932dcf0533e47aad73eb74f", "author": {"user": {"login": "eddumelendez", "name": "Edd\u00fa Mel\u00e9ndez Gonzales"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/c19dda4b911a79585932dcf0533e47aad73eb74f", "committedDate": "2020-03-21T16:34:45Z", "message": "Polish docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4OTUzNTE5", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#pullrequestreview-378953519", "createdAt": "2020-03-21T21:32:41Z", "commit": {"oid": "c19dda4b911a79585932dcf0533e47aad73eb74f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 576, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}