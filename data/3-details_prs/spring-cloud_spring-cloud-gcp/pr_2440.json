{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2NzEzMTc1", "number": 2440, "title": "Add the \"spring.cloud.gcp.storage.project-id\" autoconfig", "bodyText": "Fixes #2435\n@meltsufin @dzou hey guys, this is an attempt to add the feature as requested on the issue. I'm really not sure if I'm on the right path, but, please review and help or maybe point the right direction.", "createdAt": "2020-06-18T19:16:48Z", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2440", "merged": true, "mergeCommit": {"oid": "5e940060579850d1a27bf5774ce6a8ae85496ba0"}, "closed": true, "closedAt": "2020-06-19T14:21:18Z", "author": {"login": "kioie"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsjXs9gH2gAyNDM2NzEzMTc1OjFhNjNlOWEzZDdlYzMyZmNiNDE3NjBhZjk2MTgzMjI2MTdmYjFkMzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcszziWAFqTQzNDExNDk4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1a63e9a3d7ec32fcb41760af9618322617fb1d32", "author": {"user": {"login": "kioie", "name": "Chief"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/1a63e9a3d7ec32fcb41760af9618322617fb1d32", "committedDate": "2020-06-18T19:11:19Z", "message": "Add the \"spring.cloud.gcp.storage.project-id\" autoconfig"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNjM0OTE5", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2440#pullrequestreview-433634919", "createdAt": "2020-06-18T20:47:04Z", "commit": {"oid": "1a63e9a3d7ec32fcb41760af9618322617fb1d32"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQyMDo0NzowNFrOGl_pJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQyMDo0ODoyOFrOGl_ruw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ5MzIyMA==", "bodyText": "Why are you removing the projectIdProvider parameter?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2440#discussion_r442493220", "createdAt": "2020-06-18T20:47:04Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/storage/GcpStorageAutoConfiguration.java", "diffHunk": "@@ -53,20 +54,22 @@\n @ConditionalOnProperty(value = \"spring.cloud.gcp.storage.enabled\", matchIfMissing = true)\n @EnableConfigurationProperties({GcpProperties.class, GcpStorageProperties.class})\n @Import(GoogleStorageProtocolResolver.class)\n-public abstract class GcpStorageAutoConfiguration { //NOSONAR squid:S1610 must be a class for Spring\n+public abstract class GcpStorageAutoConfiguration {\n+\tprivate GcpProjectIdProvider gcpProjectIdProvider; //NOSONAR squid:S1610 must be a class for Spring\n \n \t@Bean\n \t@ConditionalOnMissingBean\n-\tpublic static Storage storage(CredentialsProvider credentialsProvider,\n-\t\t\tGcpStorageProperties gcpStorageProperties,\n-\t\t\tGcpProjectIdProvider projectIdProvider) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a63e9a3d7ec32fcb41760af9618322617fb1d32"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ5MzU3Ng==", "bodyText": "Should be projectIdProvider that was passed in.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2440#discussion_r442493576", "createdAt": "2020-06-18T20:47:51Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/storage/GcpStorageAutoConfiguration.java", "diffHunk": "@@ -53,20 +54,22 @@\n @ConditionalOnProperty(value = \"spring.cloud.gcp.storage.enabled\", matchIfMissing = true)\n @EnableConfigurationProperties({GcpProperties.class, GcpStorageProperties.class})\n @Import(GoogleStorageProtocolResolver.class)\n-public abstract class GcpStorageAutoConfiguration { //NOSONAR squid:S1610 must be a class for Spring\n+public abstract class GcpStorageAutoConfiguration {\n+\tprivate GcpProjectIdProvider gcpProjectIdProvider; //NOSONAR squid:S1610 must be a class for Spring\n \n \t@Bean\n \t@ConditionalOnMissingBean\n-\tpublic static Storage storage(CredentialsProvider credentialsProvider,\n-\t\t\tGcpStorageProperties gcpStorageProperties,\n-\t\t\tGcpProjectIdProvider projectIdProvider) throws IOException {\n+\tpublic Storage storage(CredentialsProvider credentialsProvider, GcpStorageProperties gcpStorageProperties) throws IOException {\n+\t\tthis.gcpProjectIdProvider = gcpStorageProperties.getProjectId() != null\n+\t\t\t\t? gcpStorageProperties::getProjectId\n+\t\t\t\t: new DefaultGcpProjectIdProvider();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a63e9a3d7ec32fcb41760af9618322617fb1d32"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ5Mzg4Mw==", "bodyText": "I would just add another test with and without the property.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2440#discussion_r442493883", "createdAt": "2020-06-18T20:48:28Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-autoconfigure/src/test/java/org/springframework/cloud/gcp/autoconfigure/storage/GcpStorageAutoConfigurationTests.java", "diffHunk": "@@ -46,9 +45,11 @@\n  * @author Elena Felder\n  */\n public class GcpStorageAutoConfigurationTests {\n+\tprivate static final String PROJECT_NAME = \"hollow-light-of-the-sealed-land\";\n \n \tprivate ApplicationContextRunner contextRunner = new ApplicationContextRunner()\n \t\t.withConfiguration(AutoConfigurations.of(GcpStorageAutoConfiguration.class))\n+\t\t\t.withPropertyValues(\"spring.cloud.gcp.storage.project-id=\" + PROJECT_NAME)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a63e9a3d7ec32fcb41760af9618322617fb1d32"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70bf50f00fd00b878b4b035f541266d18cc3c3ec", "author": {"user": {"login": "dzou", "name": "Daniel Zou"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/70bf50f00fd00b878b4b035f541266d18cc3c3ec", "committedDate": "2020-06-18T20:51:19Z", "message": "polish"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b87cd6a9f3024c4a3208f24ad72cb57acad1693f", "author": {"user": {"login": "dzou", "name": "Daniel Zou"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/b87cd6a9f3024c4a3208f24ad72cb57acad1693f", "committedDate": "2020-06-18T21:23:09Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNzUwMDQz", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2440#pullrequestreview-433750043", "createdAt": "2020-06-19T01:40:07Z", "commit": {"oid": "b87cd6a9f3024c4a3208f24ad72cb57acad1693f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTE0OTg0", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2440#pullrequestreview-434114984", "createdAt": "2020-06-19T14:20:12Z", "commit": {"oid": "b87cd6a9f3024c4a3208f24ad72cb57acad1693f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 481, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}