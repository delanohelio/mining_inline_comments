{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5NjQ4MDkw", "number": 2156, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNTo1OTowN1rODcR7Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMTowMjo0MFrODcW2Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwOTgwMzY3OnYy", "diffSide": "LEFT", "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNTo1OTowN1rOFkP30w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNTo1OTowN1rOFkP30w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU1MzEwNw==", "bodyText": "if you will check the invocation stack you will find that the method 'resolveEntityClassNames' has been already applied to queryTagValue.sql", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373553107", "createdAt": "2020-01-31T15:59:07Z", "author": {"login": "s13o"}, "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "diffHunk": "@@ -245,8 +245,7 @@ private List executeReadSql(Pageable pageable, Sort sort, QueryTagValue queryTag\n \n \t\tqueryTagValue.sql = SpannerStatementQueryExecutor\n \t\t\t\t.applySortingPagingQueryOptions(this.entityType, spannerQueryOptions,\n-\t\t\t\t\t\tresolveEntityClassNames(queryTagValue.sql),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57ef9afdebe865b046d3fd5574192aacbc1925d8"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwOTg5MzYxOnYy", "diffSide": "LEFT", "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNjoyNzoyNVrOFkQwfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxODozMzozNFrOFkUImA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2NzYxNA==", "bodyText": "could you clarify why was the call to resolveEntityClassNames removed?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373567614", "createdAt": "2020-01-31T16:27:25Z", "author": {"login": "dmitry-s"}, "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "diffHunk": "@@ -245,8 +245,7 @@ private List executeReadSql(Pageable pageable, Sort sort, QueryTagValue queryTag\n \n \t\tqueryTagValue.sql = SpannerStatementQueryExecutor\n \t\t\t\t.applySortingPagingQueryOptions(this.entityType, spannerQueryOptions,\n-\t\t\t\t\t\tresolveEntityClassNames(queryTagValue.sql),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57ef9afdebe865b046d3fd5574192aacbc1925d8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2OTc5NA==", "bodyText": "the executeReadSql method is invoked only from the executeRawResult where resolveEntityClassNames  already invoked in the line 222", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373569794", "createdAt": "2020-01-31T16:31:37Z", "author": {"login": "s13o"}, "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "diffHunk": "@@ -245,8 +245,7 @@ private List executeReadSql(Pageable pageable, Sort sort, QueryTagValue queryTag\n \n \t\tqueryTagValue.sql = SpannerStatementQueryExecutor\n \t\t\t\t.applySortingPagingQueryOptions(this.entityType, spannerQueryOptions,\n-\t\t\t\t\t\tresolveEntityClassNames(queryTagValue.sql),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2NzYxNA=="}, "originalCommit": {"oid": "57ef9afdebe865b046d3fd5574192aacbc1925d8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU3MjIwNw==", "bodyText": "we should better invoke it once in the constructor of QueryTagValue and mark the field 'sql' as final", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373572207", "createdAt": "2020-01-31T16:36:25Z", "author": {"login": "s13o"}, "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "diffHunk": "@@ -245,8 +245,7 @@ private List executeReadSql(Pageable pageable, Sort sort, QueryTagValue queryTag\n \n \t\tqueryTagValue.sql = SpannerStatementQueryExecutor\n \t\t\t\t.applySortingPagingQueryOptions(this.entityType, spannerQueryOptions,\n-\t\t\t\t\t\tresolveEntityClassNames(queryTagValue.sql),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2NzYxNA=="}, "originalCommit": {"oid": "57ef9afdebe865b046d3fd5574192aacbc1925d8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU3Mzg2Ng==", "bodyText": "Ok so executeReadSql is only called from executeRawResult, and resolveEntityClassNames is done there.\nI think the best way to fix that would be to call resolveEntityClassNames in the constructor, this way the sql field will always have resolved class names and there will be no need for any individual method to do that.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373573866", "createdAt": "2020-01-31T16:39:52Z", "author": {"login": "dmitry-s"}, "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "diffHunk": "@@ -245,8 +245,7 @@ private List executeReadSql(Pageable pageable, Sort sort, QueryTagValue queryTag\n \n \t\tqueryTagValue.sql = SpannerStatementQueryExecutor\n \t\t\t\t.applySortingPagingQueryOptions(this.entityType, spannerQueryOptions,\n-\t\t\t\t\t\tresolveEntityClassNames(queryTagValue.sql),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2NzYxNA=="}, "originalCommit": {"oid": "57ef9afdebe865b046d3fd5574192aacbc1925d8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU4MDAwOA==", "bodyText": "Basically It is already like this, but without changing the constructor's signature.\nI've just removed a double invocation because I believe this method is costly", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373580008", "createdAt": "2020-01-31T16:52:35Z", "author": {"login": "s13o"}, "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "diffHunk": "@@ -245,8 +245,7 @@ private List executeReadSql(Pageable pageable, Sort sort, QueryTagValue queryTag\n \n \t\tqueryTagValue.sql = SpannerStatementQueryExecutor\n \t\t\t\t.applySortingPagingQueryOptions(this.entityType, spannerQueryOptions,\n-\t\t\t\t\t\tresolveEntityClassNames(queryTagValue.sql),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2NzYxNA=="}, "originalCommit": {"oid": "57ef9afdebe865b046d3fd5574192aacbc1925d8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU4MTUyNA==", "bodyText": "Well, what if I'll add one more commit? Will it become added to the PR automatically or I should cancel the PR and create a new one?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373581524", "createdAt": "2020-01-31T16:55:52Z", "author": {"login": "s13o"}, "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "diffHunk": "@@ -245,8 +245,7 @@ private List executeReadSql(Pageable pageable, Sort sort, QueryTagValue queryTag\n \n \t\tqueryTagValue.sql = SpannerStatementQueryExecutor\n \t\t\t\t.applySortingPagingQueryOptions(this.entityType, spannerQueryOptions,\n-\t\t\t\t\t\tresolveEntityClassNames(queryTagValue.sql),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2NzYxNA=="}, "originalCommit": {"oid": "57ef9afdebe865b046d3fd5574192aacbc1925d8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYyMjkzNg==", "bodyText": "it will be added to the PR", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373622936", "createdAt": "2020-01-31T18:33:34Z", "author": {"login": "dmitry-s"}, "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "diffHunk": "@@ -245,8 +245,7 @@ private List executeReadSql(Pageable pageable, Sort sort, QueryTagValue queryTag\n \n \t\tqueryTagValue.sql = SpannerStatementQueryExecutor\n \t\t\t\t.applySortingPagingQueryOptions(this.entityType, spannerQueryOptions,\n-\t\t\t\t\t\tresolveEntityClassNames(queryTagValue.sql),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2NzYxNA=="}, "originalCommit": {"oid": "57ef9afdebe865b046d3fd5574192aacbc1925d8"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMDYxMDY3OnYy", "diffSide": "RIGHT", "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMTowMjo0MFrOFkX2sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMToxOTowNVrOFkYO4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY4Mzg4OQ==", "bodyText": "I knew that, but you requested to modify the constructor :)", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373683889", "createdAt": "2020-01-31T21:02:40Z", "author": {"login": "s13o"}, "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "diffHunk": "@@ -301,11 +301,10 @@ else if (expression instanceof CompositeStringExpression) {\n \n \t\tString sql;\n \n-\t\tQueryTagValue(List<String> tags, Object[] rawParams, Object[] params, String sql,\n-\t\t\t\tSpannerMappingContext spannerMappingContext) {\n+\t\tQueryTagValue(List<String> tags, Object[] rawParams, Object[] params, String sql) {\n \t\t\tthis.tags = tags;\n \t\t\tthis.intialParams = params;\n-\t\t\tthis.sql = resolveEntityClassNames(sql, spannerMappingContext);\n+\t\t\tthis.sql = sql;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae5f9d1defc712bbcb39a6421f62c18e1987af9f"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY5MDA4Mw==", "bodyText": "not that constructor :)", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373690083", "createdAt": "2020-01-31T21:19:05Z", "author": {"login": "dmitry-s"}, "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "diffHunk": "@@ -301,11 +301,10 @@ else if (expression instanceof CompositeStringExpression) {\n \n \t\tString sql;\n \n-\t\tQueryTagValue(List<String> tags, Object[] rawParams, Object[] params, String sql,\n-\t\t\t\tSpannerMappingContext spannerMappingContext) {\n+\t\tQueryTagValue(List<String> tags, Object[] rawParams, Object[] params, String sql) {\n \t\t\tthis.tags = tags;\n \t\t\tthis.intialParams = params;\n-\t\t\tthis.sql = resolveEntityClassNames(sql, spannerMappingContext);\n+\t\t\tthis.sql = sql;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY4Mzg4OQ=="}, "originalCommit": {"oid": "ae5f9d1defc712bbcb39a6421f62c18e1987af9f"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2204, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}