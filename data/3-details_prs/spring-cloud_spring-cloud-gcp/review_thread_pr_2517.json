{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0MzMxNzY3", "number": 2517, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMjoxMDo0MVrOEiWsnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxODo1Mjo1MFrOEip3tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NDU4OTExOnYy", "diffSide": "RIGHT", "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/sql/GcpCloudSqlAutoConfiguration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMjoxMDo0MlrOHQLwiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzoxNToyOVrOHQRKxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjczMTkxMg==", "bodyText": "Have you considered putting this logic into DefaultCloudSqlJdbcInfoProvider instead?\nThat class is specifically designed for creating the JDBC URL string.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517#discussion_r486731912", "createdAt": "2020-09-11T02:10:42Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/sql/GcpCloudSqlAutoConfiguration.java", "diffHunk": "@@ -161,7 +162,11 @@ public DataSourceProperties cloudSqlDataSourceProperties(\n \t\t\t\tLOGGER.warn(\"Ignoring provided spring.datasource.url. Overwriting it based on the \" +\n \t\t\t\t\t\t\"spring.cloud.gcp.sql.instance-connection-name.\");\n \t\t\t}\n-\t\t\tproperties.setUrl(cloudSqlJdbcInfoProvider.getJdbcUrl());\n+\t\t\tString jdbcUrl = cloudSqlJdbcInfoProvider.getJdbcUrl();\n+\t\t\tif (StringUtils.hasText(gcpCloudSqlProperties.getIpTypes())) {\n+\t\t\t\tjdbcUrl = String.format(jdbcUrl + \"&ipTypes=%s\", gcpCloudSqlProperties.getIpTypes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0a3770379dfda9264f37c2ee49d000355591a13"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgyMDU0OQ==", "bodyText": "No. I remember that I looked at patching the jdbcUrlTemplate in DatabaseType, but I didn't have the GcpCloudSqlProperties there. I must have overlooked DefaultCloudSqlJdbcInfoProvider.\nCode moved.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517#discussion_r486820549", "createdAt": "2020-09-11T07:15:29Z", "author": {"login": "ohardeng"}, "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/sql/GcpCloudSqlAutoConfiguration.java", "diffHunk": "@@ -161,7 +162,11 @@ public DataSourceProperties cloudSqlDataSourceProperties(\n \t\t\t\tLOGGER.warn(\"Ignoring provided spring.datasource.url. Overwriting it based on the \" +\n \t\t\t\t\t\t\"spring.cloud.gcp.sql.instance-connection-name.\");\n \t\t\t}\n-\t\t\tproperties.setUrl(cloudSqlJdbcInfoProvider.getJdbcUrl());\n+\t\t\tString jdbcUrl = cloudSqlJdbcInfoProvider.getJdbcUrl();\n+\t\t\tif (StringUtils.hasText(gcpCloudSqlProperties.getIpTypes())) {\n+\t\t\t\tjdbcUrl = String.format(jdbcUrl + \"&ipTypes=%s\", gcpCloudSqlProperties.getIpTypes());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjczMTkxMg=="}, "originalCommit": {"oid": "c0a3770379dfda9264f37c2ee49d000355591a13"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NDU5NTUwOnYy", "diffSide": "RIGHT", "path": "docs/src/main/asciidoc/sql.adoc", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMjoxNDoyMVrOHQL0SQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxODo1MjowMlrOHQqEjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjczMjg3Mw==", "bodyText": "Can you mention the default PUBLIC,PRIVATE here?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517#discussion_r486732873", "createdAt": "2020-09-11T02:14:21Z", "author": {"login": "meltsufin"}, "path": "docs/src/main/asciidoc/sql.adoc", "diffHunk": "@@ -64,6 +64,7 @@ There is also some configuration specific to Google Cloud SQL:\n | `spring.cloud.gcp.sql.database-name` | Name of the database to connect to. |\n | `spring.cloud.gcp.sql.instance-connection-name` | A string containing a Google Cloud SQL instance's project ID, region and name, each separated by a colon.\n For example, `my-project-id:my-region:my-instance-name`. |\n+| `spring.cloud.gcp.sql.ip-types` | Allows you to specify a comma delimited list of preferred IP types for connecting to a Cloud SQL instance. See https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory#specifying-ip-types[Cloud SQL Socket Factory - Specifying IP Types] |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0a3770379dfda9264f37c2ee49d000355591a13"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgyMDU4NQ==", "bodyText": "Done", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517#discussion_r486820585", "createdAt": "2020-09-11T07:15:32Z", "author": {"login": "ohardeng"}, "path": "docs/src/main/asciidoc/sql.adoc", "diffHunk": "@@ -64,6 +64,7 @@ There is also some configuration specific to Google Cloud SQL:\n | `spring.cloud.gcp.sql.database-name` | Name of the database to connect to. |\n | `spring.cloud.gcp.sql.instance-connection-name` | A string containing a Google Cloud SQL instance's project ID, region and name, each separated by a colon.\n For example, `my-project-id:my-region:my-instance-name`. |\n+| `spring.cloud.gcp.sql.ip-types` | Allows you to specify a comma delimited list of preferred IP types for connecting to a Cloud SQL instance. See https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory#specifying-ip-types[Cloud SQL Socket Factory - Specifying IP Types] |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjczMjg3Mw=="}, "originalCommit": {"oid": "c0a3770379dfda9264f37c2ee49d000355591a13"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA2MDYyNA==", "bodyText": "If you look at the preview, there is also a \"Default value\" column you can populate.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517#discussion_r487060624", "createdAt": "2020-09-11T13:53:52Z", "author": {"login": "meltsufin"}, "path": "docs/src/main/asciidoc/sql.adoc", "diffHunk": "@@ -64,6 +64,7 @@ There is also some configuration specific to Google Cloud SQL:\n | `spring.cloud.gcp.sql.database-name` | Name of the database to connect to. |\n | `spring.cloud.gcp.sql.instance-connection-name` | A string containing a Google Cloud SQL instance's project ID, region and name, each separated by a colon.\n For example, `my-project-id:my-region:my-instance-name`. |\n+| `spring.cloud.gcp.sql.ip-types` | Allows you to specify a comma delimited list of preferred IP types for connecting to a Cloud SQL instance. See https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory#specifying-ip-types[Cloud SQL Socket Factory - Specifying IP Types] |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjczMjg3Mw=="}, "originalCommit": {"oid": "c0a3770379dfda9264f37c2ee49d000355591a13"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE1OTA0Ng==", "bodyText": "Yes, I saw the \"Default value\" column, but felt that populating that would signify that spring-cloud-gcp was setting thoose default values. I now see that spring.cloud.gcp.sql.credentials.location specifies that it's Spring GCP Boot starter that supplying the defaults.\nSuggested rewrite:\n| spring.cloud.gcp.sql.ip-types | Allows you to specify a comma delimited list of preferred IP types for connecting to a Cloud SQL instance. See https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory#specifying-ip-types[Cloud SQL Socket Factory - Specifying IP Types] |  Default values (PUBLIC,PRIVATE) provided by Cloud SQL Socket Factory", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517#discussion_r487159046", "createdAt": "2020-09-11T16:33:57Z", "author": {"login": "ohardeng"}, "path": "docs/src/main/asciidoc/sql.adoc", "diffHunk": "@@ -64,6 +64,7 @@ There is also some configuration specific to Google Cloud SQL:\n | `spring.cloud.gcp.sql.database-name` | Name of the database to connect to. |\n | `spring.cloud.gcp.sql.instance-connection-name` | A string containing a Google Cloud SQL instance's project ID, region and name, each separated by a colon.\n For example, `my-project-id:my-region:my-instance-name`. |\n+| `spring.cloud.gcp.sql.ip-types` | Allows you to specify a comma delimited list of preferred IP types for connecting to a Cloud SQL instance. See https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory#specifying-ip-types[Cloud SQL Socket Factory - Specifying IP Types] |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjczMjg3Mw=="}, "originalCommit": {"oid": "c0a3770379dfda9264f37c2ee49d000355591a13"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIyODU1OA==", "bodyText": "The default doesn't have to be provided by this project. The column is there to make it more clear what would be the default.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517#discussion_r487228558", "createdAt": "2020-09-11T18:52:02Z", "author": {"login": "meltsufin"}, "path": "docs/src/main/asciidoc/sql.adoc", "diffHunk": "@@ -64,6 +64,7 @@ There is also some configuration specific to Google Cloud SQL:\n | `spring.cloud.gcp.sql.database-name` | Name of the database to connect to. |\n | `spring.cloud.gcp.sql.instance-connection-name` | A string containing a Google Cloud SQL instance's project ID, region and name, each separated by a colon.\n For example, `my-project-id:my-region:my-instance-name`. |\n+| `spring.cloud.gcp.sql.ip-types` | Allows you to specify a comma delimited list of preferred IP types for connecting to a Cloud SQL instance. See https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory#specifying-ip-types[Cloud SQL Socket Factory - Specifying IP Types] |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjczMjg3Mw=="}, "originalCommit": {"oid": "c0a3770379dfda9264f37c2ee49d000355591a13"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NzczMDQ2OnYy", "diffSide": "RIGHT", "path": "docs/src/main/asciidoc/sql.adoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxODo1Mjo1MFrOHQqGHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxODo1Mjo1MFrOHQqGHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIyODk1Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | `spring.cloud.gcp.sql.ip-types` | Allows you to specify a comma delimited list of preferred IP types for connecting to a Cloud SQL instance. Left unconfigured Cloud SQL Socket Factory will default it to `PUBLIC,PRIVATE`. See https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory#specifying-ip-types[Cloud SQL Socket Factory - Specifying IP Types] |\n          \n          \n            \n            | `spring.cloud.gcp.sql.ip-types` | Allows you to specify a comma delimited list of preferred IP types for connecting to a Cloud SQL instance. Left unconfigured Cloud SQL Socket Factory will default it to `PUBLIC,PRIVATE`. See https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory#specifying-ip-types[Cloud SQL Socket Factory - Specifying IP Types] | `PUBLIC,PRIVATE`", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517#discussion_r487228957", "createdAt": "2020-09-11T18:52:50Z", "author": {"login": "meltsufin"}, "path": "docs/src/main/asciidoc/sql.adoc", "diffHunk": "@@ -64,6 +64,7 @@ There is also some configuration specific to Google Cloud SQL:\n | `spring.cloud.gcp.sql.database-name` | Name of the database to connect to. |\n | `spring.cloud.gcp.sql.instance-connection-name` | A string containing a Google Cloud SQL instance's project ID, region and name, each separated by a colon.\n For example, `my-project-id:my-region:my-instance-name`. |\n+| `spring.cloud.gcp.sql.ip-types` | Allows you to specify a comma delimited list of preferred IP types for connecting to a Cloud SQL instance. Left unconfigured Cloud SQL Socket Factory will default it to `PUBLIC,PRIVATE`. See https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory#specifying-ip-types[Cloud SQL Socket Factory - Specifying IP Types] |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "234b8e1faf6db2ac38a7ce9101fa58ac9a28c188"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2049, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}