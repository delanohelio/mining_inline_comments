{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0MzU4OTk4", "number": 2518, "title": "Spanner - add NUMERIC type", "bodyText": "fixes #2515", "createdAt": "2020-09-10T21:42:06Z", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2518", "merged": true, "mergeCommit": {"oid": "fda989f4ac3a298b96859406ec37be9a4357b846"}, "closed": true, "closedAt": "2020-09-16T13:58:27Z", "author": {"login": "dmitry-s"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHnz-_gH2gAyNDg0MzU4OTk4OjY1M2Y3NjA5NzIyYmM0ZTRmNmU4MDU3YjQ3NjRkZjNjYjcyODUyZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJbHFsAFqTQ4OTU0OTE2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "653f7609722bc4e4f6e8057b4764df3cb72852dd", "author": {"user": {"login": "dmitry-s", "name": null}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/653f7609722bc4e4f6e8057b4764df3cb72852dd", "committedDate": "2020-09-10T21:37:47Z", "message": "add NUMERIC type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MzUzODAw", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2518#pullrequestreview-486353800", "createdAt": "2020-09-10T22:27:26Z", "commit": {"oid": "653f7609722bc4e4f6e8057b4764df3cb72852dd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMjoyNzoyNlrOHQH3ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMjozMDozMlrOHQH7zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2ODE5NQ==", "bodyText": "This looks like a duplicate of the above map, but there's probably some obscure reason for it. :)", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2518#discussion_r486668195", "createdAt": "2020-09-10T22:27:26Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/core/convert/StructAccessor.java", "diffHunk": "@@ -91,6 +94,7 @@\n \t\t\t\t.put(double[].class, AbstractStructReader::getDoubleArray)\n \t\t\t\t.put(long[].class, AbstractStructReader::getLongArray)\n \t\t\t\t.put(boolean[].class, AbstractStructReader::getBooleanArray)\n+\t\t\t\t.put(BigDecimal.class, AbstractStructReader::getBigDecimal)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "653f7609722bc4e4f6e8057b4764df3cb72852dd"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2OTI2Mg==", "bodyText": "price is actually a perfect field to use BigDecimal for.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2518#discussion_r486669262", "createdAt": "2020-09-10T22:30:32Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-data-spanner/src/test/java/org/springframework/cloud/gcp/data/spanner/repository/query/SpannerStatementQueryTests.java", "diffHunk": "@@ -100,26 +102,28 @@ public void compoundNameConventionTest() throws NoSuchMethodException {\n \t\twhen(this.queryMethod.getName()).thenReturn(\n \t\t\t\t\"findTop3DistinctByActionIgnoreCaseAndSymbolOrTraderIdAndPriceLessThanOrPriceGreater\"\n \t\t\t\t\t\t+ \"ThanEqualAndIdIsNotNullAndTraderIdIsNullAndTraderIdLikeAndPriceTrueAndPriceFalse\"\n-\t\t\t\t\t\t+ \"AndPriceGreaterThanAndPriceLessThanEqualAndPriceInOrderByIdDesc\");\n+\t\t\t\t\t\t+ \"AndPriceGreaterThanAndPriceLessThanEqualAndPriceIn\"\n+\t\t\t\t\t\t+ \"AndValueLessThanOrderByIdDesc\");\n \t\tthis.partTreeSpannerQuery = spy(createQuery());\n \n \t\tObject[] params = new Object[] { Trade.Action.BUY, \"abcd\", \"abc123\",\n \t\t\t\t8, // an int is not a natively supported type, and is intentionally used to use custom\n \t\t\t\t\t// converters\n \t\t\t\t3.33, \"ignored\",\n-\t\t\t\t\"ignored\", \"blahblah\", \"ignored\", \"ignored\", 1.11, 2.22, Arrays.asList(1, 2) };\n+\t\t\t\t\"ignored\", \"blahblah\", \"ignored\", \"ignored\", 1.11, 2.22, Arrays.asList(1, 2), BigDecimal.ONE };\n \n \t\twhen(this.spannerTemplate.query((Class<Object>) any(), any(), any()))\n \t\t\t\t.thenAnswer((invocation) -> {\n \t\t\t\t\tStatement statement = invocation.getArgument(1);\n \n \t\t\t\t\tString expectedQuery =\n-\t\t\t\t\t\t\t\"SELECT DISTINCT shares, trader_id, ticker, price, action, id \"\n+\t\t\t\t\t\t\t\"SELECT DISTINCT shares, trader_id, ticker, price, action, id, value \"\n \t\t\t\t\t\t\t\t\t+ \"FROM trades WHERE ( LOWER(action)=LOWER(@tag0) \"\n \t\t\t\t\t\t\t\t\t+ \"AND ticker=@tag1 ) OR \"\n \t\t\t\t\t\t\t\t\t+ \"( trader_id=@tag2 AND price<@tag3 ) OR ( price>=@tag4 AND id<>NULL AND \"\n \t\t\t\t\t\t\t\t\t+ \"trader_id=NULL AND trader_id LIKE @tag7 AND price=TRUE AND price=FALSE AND \"\n-\t\t\t\t\t\t\t\t\t+ \"price>@tag10 AND price<=@tag11 AND price IN UNNEST(@tag12) ) ORDER BY id DESC LIMIT 3\";\n+\t\t\t\t\t\t\t\t\t+ \"price>@tag10 AND price<=@tag11 AND price IN UNNEST(@tag12) \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "653f7609722bc4e4f6e8057b4764df3cb72852dd"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MzU1NTc4", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2518#pullrequestreview-486355578", "createdAt": "2020-09-10T22:31:47Z", "commit": {"oid": "653f7609722bc4e4f6e8057b4764df3cb72852dd"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMjozMTo0N1rOHQH9bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMjozMzowM1rOHQH_PA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2OTY3Ng==", "bodyText": "same nit -- should this go before the primitive arrays?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2518#discussion_r486669676", "createdAt": "2020-09-10T22:31:47Z", "author": {"login": "elefeint"}, "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/core/convert/StructAccessor.java", "diffHunk": "@@ -91,6 +94,7 @@\n \t\t\t\t.put(double[].class, AbstractStructReader::getDoubleArray)\n \t\t\t\t.put(long[].class, AbstractStructReader::getLongArray)\n \t\t\t\t.put(boolean[].class, AbstractStructReader::getBooleanArray)\n+\t\t\t\t.put(BigDecimal.class, AbstractStructReader::getBigDecimal)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "653f7609722bc4e4f6e8057b4764df3cb72852dd"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3MDE0MA==", "bodyText": "nit: Should this go to before array types?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2518#discussion_r486670140", "createdAt": "2020-09-10T22:33:03Z", "author": {"login": "elefeint"}, "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/core/convert/StructAccessor.java", "diffHunk": "@@ -71,6 +73,7 @@\n \t\t\t\t.put(double[].class, AbstractStructReader::getDoubleArray)\n \t\t\t\t.put(long[].class, AbstractStructReader::getLongArray)\n \t\t\t\t.put(boolean[].class, AbstractStructReader::getBooleanArray)\n+\t\t\t\t.put(BigDecimal.class, AbstractStructReader::getBigDecimal)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "653f7609722bc4e4f6e8057b4764df3cb72852dd"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "939b1d777c432e151a9545274b9d24cdf6b54951", "author": {"user": {"login": "dmitry-s", "name": null}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/939b1d777c432e151a9545274b9d24cdf6b54951", "committedDate": "2020-09-14T23:39:02Z", "message": "Merge branch 'master' of github.com:spring-cloud/spring-cloud-gcp into spanner-numeric-type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a7bb71833c04b888eaf20d70d88828fa7708169", "author": {"user": {"login": "dmitry-s", "name": null}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/9a7bb71833c04b888eaf20d70d88828fa7708169", "committedDate": "2020-09-15T00:02:34Z", "message": "PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "907b613477ad252e7718cfbf9d63e2540274eff9", "author": {"user": {"login": "dmitry-s", "name": null}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/907b613477ad252e7718cfbf9d63e2540274eff9", "committedDate": "2020-09-15T01:08:54Z", "message": "fix firestore dependency issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4Mjc5Mzc1", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2518#pullrequestreview-488279375", "createdAt": "2020-09-15T02:29:11Z", "commit": {"oid": "907b613477ad252e7718cfbf9d63e2540274eff9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwMjoyOToxMVrOHRuNZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQwMjoyOToxMVrOHRuNZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODM0NDkzMg==", "bodyText": "This is unrelated. Can we please put it in a separate PR?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2518#discussion_r488344932", "createdAt": "2020-09-15T02:29:11Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/util/Util.java", "diffHunk": "@@ -27,7 +25,20 @@ private Util() {\n \t}\n \n \tpublic static String extractDatabasePath(String parent) {\n-\t\treturn parent.substring(0, StringUtils.ordinalIndexOf(parent, \"/\", 4));\n+\t\t//the parent looks like this: projects/{project_id}/databases/{database_id}/...", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "907b613477ad252e7718cfbf9d63e2540274eff9"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e296093ebfe2e85ca4f6225b7f07828ccece73ad", "author": {"user": {"login": "dmitry-s", "name": null}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/e296093ebfe2e85ca4f6225b7f07828ccece73ad", "committedDate": "2020-09-15T20:33:43Z", "message": "Merge branch 'master' of github.com:spring-cloud/spring-cloud-gcp into spanner-numeric-type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjEwNDk5", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2518#pullrequestreview-489210499", "createdAt": "2020-09-16T01:23:37Z", "commit": {"oid": "e296093ebfe2e85ca4f6225b7f07828ccece73ad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTQ5MTYw", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2518#pullrequestreview-489549160", "createdAt": "2020-09-16T11:57:44Z", "commit": {"oid": "e296093ebfe2e85ca4f6225b7f07828ccece73ad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 415, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}