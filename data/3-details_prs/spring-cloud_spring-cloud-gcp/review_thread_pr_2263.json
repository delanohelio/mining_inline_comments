{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMzM1Nzg4", "number": 2263, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoyMTowNFrODp4vvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMjozNzo0MVrODqDeRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1MjQ3OTMzOnYy", "diffSide": "RIGHT", "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/secretmanager/GcpSecretManagerProperties.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoyMTowNFrOF5VqtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoyMTowNFrOF5VqtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY2ODE0OQ==", "bodyText": "I think I would rather just keep it null to indicate to use the default.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#discussion_r395668149", "createdAt": "2020-03-20T14:21:04Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/secretmanager/GcpSecretManagerProperties.java", "diffHunk": "@@ -42,6 +45,18 @@\n \t */\n \tprivate String secretNamePrefix = \"\";\n \n+\tprivate static final String LATEST_VERSION_STRING = \"latest\";\n+\n+\t/**\n+\t * Defines the secret's version to be used.\n+\t */\n+\tprivate String version = LATEST_VERSION_STRING;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51b74c76c9dcf99ba835a4df7669fc965bf5b012"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1MjQ4MzA5OnYy", "diffSide": "RIGHT", "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/secretmanager/SecretManagerPropertySource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoyMTo1NlrOF5VtDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoyMTo1NlrOF5VtDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY2ODc0OA==", "bodyText": "This change to the constructor would be breaking. Can we instead add an additional constructor with extra version params?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#discussion_r395668748", "createdAt": "2020-03-20T14:21:56Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/secretmanager/SecretManagerPropertySource.java", "diffHunk": "@@ -48,12 +47,14 @@ public SecretManagerPropertySource(\n \t\t\tString propertySourceName,\n \t\t\tSecretManagerServiceClient client,\n \t\t\tGcpProjectIdProvider projectIdProvider,\n-\t\t\tString secretsPrefix) {\n+\t\t\tString secretsPrefix,\n+\t\t\tString version,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51b74c76c9dcf99ba835a4df7669fc965bf5b012"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1MjQ5NjQzOnYy", "diffSide": "RIGHT", "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/secretmanager/SecretManagerPropertySourceLocator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoyNTowMlrOF5V1lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoyNTowMlrOF5V1lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY3MDkzNQ==", "bodyText": "Again, maybe add an additional constructor rather than introducing a breaking change?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#discussion_r395670935", "createdAt": "2020-03-20T14:25:02Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/secretmanager/SecretManagerPropertySourceLocator.java", "diffHunk": "@@ -40,13 +43,21 @@\n \n \tprivate final String secretsPrefix;\n \n+\tprivate final String version;\n+\n+\tprivate final Map<String, String> versions;\n+\n \tSecretManagerPropertySourceLocator(\n \t\t\tSecretManagerServiceClient client,\n \t\t\tGcpProjectIdProvider projectIdProvider,\n-\t\t\tString secretsPrefix) {\n+\t\t\tString secretsPrefix,\n+\t\t\tString version,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51b74c76c9dcf99ba835a4df7669fc965bf5b012"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1MjUwNDUyOnYy", "diffSide": "RIGHT", "path": "spring-cloud-gcp-autoconfigure/src/test/java/org/springframework/cloud/gcp/autoconfigure/secretmanager/it/SecretManagerIntegrationTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoyNjo1NlrOF5V6pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoyNjo1NlrOF5V6pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY3MjIzMA==", "bodyText": "Can we add another test where both secretmanager.version and secretmanager.versions are specified and verify that the second takes precedence?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#discussion_r395672230", "createdAt": "2020-03-20T14:26:56Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-autoconfigure/src/test/java/org/springframework/cloud/gcp/autoconfigure/secretmanager/it/SecretManagerIntegrationTests.java", "diffHunk": "@@ -103,13 +103,52 @@ public void testConfigurationDisabled() {\n \t\t\t\t.getProperty(\"spring-cloud-gcp.secrets.my-secret\")).isNull();\n \t}\n \n+\t@Test\n+\tpublic void testVersion() {\n+\t\tthis.context = new SpringApplicationBuilder()\n+\t\t\t\t.sources(GcpContextAutoConfiguration.class, GcpSecretManagerBootstrapConfiguration.class)\n+\t\t\t\t.web(WebApplicationType.NONE)\n+\t\t\t\t.properties(\"spring.cloud.gcp.secretmanager.bootstrap.enabled=true\")\n+\t\t\t\t.properties(\"spring.cloud.gcp.secretmanager.bootstrap.version=2\")\n+\t\t\t\t.run();\n+\n+\t\tcreateSecret(TEST_SECRET_ID, \"the secret data\");\n+\t\tassertThat(secretExists(TEST_SECRET_ID, \"1\")).isTrue();\n+\t\tcreateSecret(TEST_SECRET_ID, \"the secret data v2\");\n+\t\tassertThat(secretExists(TEST_SECRET_ID, \"2\")).isTrue();\n+\t\tassertThat(secretExists(TEST_SECRET_ID, \"latest\")).isTrue();\n+\n+\t\tbyte[] byteArraySecret = this.context.getEnvironment().getProperty(\"my-secret\", byte[].class);\n+\t\tassertThat(byteArraySecret).isEqualTo(\"the secret data v2.\".getBytes());\n+\t}\n+\n+\t@Test\n+\tpublic void testSecretsWithSpecificVersion() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51b74c76c9dcf99ba835a4df7669fc965bf5b012"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDIzNjM5OnYy", "diffSide": "RIGHT", "path": "docs/src/main/asciidoc/secretmanager.adoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMjozNjo1MlrOF5nF9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMjozNjo1MlrOF5nF9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MzY1Mg==", "bodyText": "The effective default is latest.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#discussion_r395953652", "createdAt": "2020-03-21T02:36:52Z", "author": {"login": "meltsufin"}, "path": "docs/src/main/asciidoc/secretmanager.adoc", "diffHunk": "@@ -51,6 +51,8 @@ Spring Cloud GCP Secret Manager offers several configuration properties to custo\n | Name | Description | Required | Default value\n | `spring.cloud.gcp.secretmanager.bootstrap.enabled` | Enables loading secrets from Secret Manager as a bootstrap property source. Set this to **true** to enable the feature. | No | `false`\n | `spring.cloud.gcp.secretmanager.secret-name-prefix` | A prefix string to prepend to the property names of secrets read from Secret Manager | No | \"\" (empty string)\n+| `spring.cloud.gcp.secretmanager.version` | Defines a specific version of secrets to read from Secret Manager | No | \"\" (empty string)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "946954064336210449a36874f4cf56fe346e3879"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDIzNjg2OnYy", "diffSide": "RIGHT", "path": "docs/src/main/asciidoc/secretmanager.adoc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMjozNzo0MVrOF5nGMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMjozNzo0MVrOF5nGMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MzcxNQ==", "bodyText": "Should probably mention that it takes precedence over s.c.g.secretmanager.version.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2263#discussion_r395953715", "createdAt": "2020-03-21T02:37:41Z", "author": {"login": "meltsufin"}, "path": "docs/src/main/asciidoc/secretmanager.adoc", "diffHunk": "@@ -51,6 +51,8 @@ Spring Cloud GCP Secret Manager offers several configuration properties to custo\n | Name | Description | Required | Default value\n | `spring.cloud.gcp.secretmanager.bootstrap.enabled` | Enables loading secrets from Secret Manager as a bootstrap property source. Set this to **true** to enable the feature. | No | `false`\n | `spring.cloud.gcp.secretmanager.secret-name-prefix` | A prefix string to prepend to the property names of secrets read from Secret Manager | No | \"\" (empty string)\n+| `spring.cloud.gcp.secretmanager.version` | Defines a specific version of secrets to read from Secret Manager | No | \"\" (empty string)\n+| `spring.cloud.gcp.secretmanager.versions.<secret-id>` | Defines a version for a specific secret-id to read from Secret Manager | No | \"\" (empty string)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "946954064336210449a36874f4cf56fe346e3879"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2310, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}