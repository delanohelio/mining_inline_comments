{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0MzMxNzY3", "number": 2517, "title": "Adding support to autoconfigure Cloud SQL ipTypes", "bodyText": "Closes #2513", "createdAt": "2020-09-10T21:09:27Z", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517", "merged": true, "mergeCommit": {"oid": "a90619c67d77ead90b35b91a3c2d2c4a2ab921a6"}, "closed": true, "closedAt": "2020-09-11T18:54:35Z", "author": {"login": "ohardeng"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHJsGOgH2gAyNDg0MzMxNzY3OmMwYTM3NzAzNzlkZmRhOTI2NGYzN2MyZWU0OWQwMDAzNTU1OTFhMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdH6Eq5AFqTQ4NzA0NjU5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c0a3770379dfda9264f37c2ee49d000355591a13", "author": {"user": {"login": "ohardeng", "name": "\u00d8ystein Urdahl Hardeng"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/c0a3770379dfda9264f37c2ee49d000355591a13", "committedDate": "2020-09-09T10:32:01Z", "message": "Adding support to autoconfigure Cloud SQL ipTypes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NDI2Njcw", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517#pullrequestreview-486426670", "createdAt": "2020-09-11T02:10:41Z", "commit": {"oid": "c0a3770379dfda9264f37c2ee49d000355591a13"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMjoxMDo0MlrOHQLwiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMjoxNDoyMVrOHQL0SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjczMTkxMg==", "bodyText": "Have you considered putting this logic into DefaultCloudSqlJdbcInfoProvider instead?\nThat class is specifically designed for creating the JDBC URL string.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517#discussion_r486731912", "createdAt": "2020-09-11T02:10:42Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-autoconfigure/src/main/java/org/springframework/cloud/gcp/autoconfigure/sql/GcpCloudSqlAutoConfiguration.java", "diffHunk": "@@ -161,7 +162,11 @@ public DataSourceProperties cloudSqlDataSourceProperties(\n \t\t\t\tLOGGER.warn(\"Ignoring provided spring.datasource.url. Overwriting it based on the \" +\n \t\t\t\t\t\t\"spring.cloud.gcp.sql.instance-connection-name.\");\n \t\t\t}\n-\t\t\tproperties.setUrl(cloudSqlJdbcInfoProvider.getJdbcUrl());\n+\t\t\tString jdbcUrl = cloudSqlJdbcInfoProvider.getJdbcUrl();\n+\t\t\tif (StringUtils.hasText(gcpCloudSqlProperties.getIpTypes())) {\n+\t\t\t\tjdbcUrl = String.format(jdbcUrl + \"&ipTypes=%s\", gcpCloudSqlProperties.getIpTypes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0a3770379dfda9264f37c2ee49d000355591a13"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjczMjg3Mw==", "bodyText": "Can you mention the default PUBLIC,PRIVATE here?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517#discussion_r486732873", "createdAt": "2020-09-11T02:14:21Z", "author": {"login": "meltsufin"}, "path": "docs/src/main/asciidoc/sql.adoc", "diffHunk": "@@ -64,6 +64,7 @@ There is also some configuration specific to Google Cloud SQL:\n | `spring.cloud.gcp.sql.database-name` | Name of the database to connect to. |\n | `spring.cloud.gcp.sql.instance-connection-name` | A string containing a Google Cloud SQL instance's project ID, region and name, each separated by a colon.\n For example, `my-project-id:my-region:my-instance-name`. |\n+| `spring.cloud.gcp.sql.ip-types` | Allows you to specify a comma delimited list of preferred IP types for connecting to a Cloud SQL instance. See https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory#specifying-ip-types[Cloud SQL Socket Factory - Specifying IP Types] |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0a3770379dfda9264f37c2ee49d000355591a13"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "234b8e1faf6db2ac38a7ce9101fa58ac9a28c188", "author": {"user": {"login": "ohardeng", "name": "\u00d8ystein Urdahl Hardeng"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/234b8e1faf6db2ac38a7ce9101fa58ac9a28c188", "committedDate": "2020-09-11T07:10:54Z", "message": "Fixing PR comments ...\n\n* Moving implementation to DefaultCloudSqlJdbcInfoProvider\n* Adding Cloud SQL Socket Factory default ipTypes to documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MDQ1NzI5", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517#pullrequestreview-487045729", "createdAt": "2020-09-11T18:52:49Z", "commit": {"oid": "234b8e1faf6db2ac38a7ce9101fa58ac9a28c188"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxODo1Mjo1MFrOHQqGHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxODo1Mjo1MFrOHQqGHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIyODk1Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | `spring.cloud.gcp.sql.ip-types` | Allows you to specify a comma delimited list of preferred IP types for connecting to a Cloud SQL instance. Left unconfigured Cloud SQL Socket Factory will default it to `PUBLIC,PRIVATE`. See https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory#specifying-ip-types[Cloud SQL Socket Factory - Specifying IP Types] |\n          \n          \n            \n            | `spring.cloud.gcp.sql.ip-types` | Allows you to specify a comma delimited list of preferred IP types for connecting to a Cloud SQL instance. Left unconfigured Cloud SQL Socket Factory will default it to `PUBLIC,PRIVATE`. See https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory#specifying-ip-types[Cloud SQL Socket Factory - Specifying IP Types] | `PUBLIC,PRIVATE`", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517#discussion_r487228957", "createdAt": "2020-09-11T18:52:50Z", "author": {"login": "meltsufin"}, "path": "docs/src/main/asciidoc/sql.adoc", "diffHunk": "@@ -64,6 +64,7 @@ There is also some configuration specific to Google Cloud SQL:\n | `spring.cloud.gcp.sql.database-name` | Name of the database to connect to. |\n | `spring.cloud.gcp.sql.instance-connection-name` | A string containing a Google Cloud SQL instance's project ID, region and name, each separated by a colon.\n For example, `my-project-id:my-region:my-instance-name`. |\n+| `spring.cloud.gcp.sql.ip-types` | Allows you to specify a comma delimited list of preferred IP types for connecting to a Cloud SQL instance. Left unconfigured Cloud SQL Socket Factory will default it to `PUBLIC,PRIVATE`. See https://github.com/GoogleCloudPlatform/cloud-sql-jdbc-socket-factory#specifying-ip-types[Cloud SQL Socket Factory - Specifying IP Types] |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "234b8e1faf6db2ac38a7ce9101fa58ac9a28c188"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f310696ae509dbc2b32d3811eaabe7812f645ca", "author": {"user": {"login": "meltsufin", "name": "Mike Eltsufin"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/4f310696ae509dbc2b32d3811eaabe7812f645ca", "committedDate": "2020-09-11T18:53:18Z", "message": "Update docs/src/main/asciidoc/sql.adoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MDQ2NTk3", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2517#pullrequestreview-487046597", "createdAt": "2020-09-11T18:54:18Z", "commit": {"oid": "4f310696ae509dbc2b32d3811eaabe7812f645ca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 414, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}