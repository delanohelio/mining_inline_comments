{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNTIyOTY3", "number": 2186, "title": "Datastore slice query projection", "bodyText": "fixes #2171", "createdAt": "2020-02-07T17:33:54Z", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2186", "merged": true, "mergeCommit": {"oid": "e4e566d0cb691ef3e16c130d322d7230bc63c9e3"}, "closed": true, "closedAt": "2020-02-07T22:06:47Z", "author": {"login": "dmitry-s"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCCfYWgH2gAyMzcyNTIyOTY3OmE3MGRjZTY0NTJhNmU4ZTg0OGRkODNiYTVjYTgxOGYxM2ZkNDU2Njk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcCGpdpgFqTM1NTQ2MjA2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a70dce6452a6e8e848dd83ba5ca818f13fd45669", "author": {"user": {"login": "dmitry-s", "name": null}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/a70dce6452a6e8e848dd83ba5ca818f13fd45669", "committedDate": "2020-02-07T17:08:01Z", "message": "fix slice projection for @Query annotated methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b6addbd627b4db7d642c877a14b7fb8f609196d", "author": {"user": {"login": "dmitry-s", "name": null}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/5b6addbd627b4db7d642c877a14b7fb8f609196d", "committedDate": "2020-02-07T17:22:13Z", "message": "fix slice projection for @Query annotated methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31e3f656996531d00a9098e41a406e74fb99241c", "author": {"user": {"login": "dmitry-s", "name": null}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/31e3f656996531d00a9098e41a406e74fb99241c", "committedDate": "2020-02-07T17:31:21Z", "message": "fix slice projection for @Query annotated methods"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MzkxODQ5", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2186#pullrequestreview-355391849", "createdAt": "2020-02-07T19:40:06Z", "commit": {"oid": "31e3f656996531d00a9098e41a406e74fb99241c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxOTo0MDowNlrOFnIHlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxOTo0NzoyNVrOFnIUBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU3MTc5OQ==", "bodyText": "found could be null as Sonar points out.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2186#discussion_r376571799", "createdAt": "2020-02-07T19:40:06Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-data-datastore/src/main/java/org/springframework/cloud/gcp/data/datastore/repository/query/GqlDatastoreQuery.java", "diffHunk": "@@ -169,6 +157,19 @@ else if (this.queryMethod.isCollectionQuery()) {\n \t\treturn result;\n \t}\n \n+\tprivate Object buildPageOrSlice(Object[] parameters, ParsedQueryWithTagsAndValues parsedQueryWithTagsAndValues,\n+\t\t\tDatastoreResultsIterable found) {\n+\t\tPageable pageableParam =\n+\t\t\t\tnew ParametersParameterAccessor(getQueryMethod().getParameters(), parameters).getPageable();\n+\t\tList resultsList = found == null ? Collections.emptyList()\n+\t\t\t\t: (List) StreamSupport.stream(found.spliterator(), false).collect(Collectors.toList());\n+\n+\t\tObject result = isPageQuery()\n+\t\t\t\t? buildPage(pageableParam, parsedQueryWithTagsAndValues, found.getCursor(), resultsList)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31e3f656996531d00a9098e41a406e74fb99241c"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU3NDk4MA==", "bodyText": "Why do we no longer need to convertOnRead and applyProjection?\nI'm having a hard time following what the fix is conceptually.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2186#discussion_r376574980", "createdAt": "2020-02-07T19:47:25Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-data-datastore/src/main/java/org/springframework/cloud/gcp/data/datastore/repository/query/GqlDatastoreQuery.java", "diffHunk": "@@ -169,6 +157,19 @@ else if (this.queryMethod.isCollectionQuery()) {\n \t\treturn result;\n \t}\n \n+\tprivate Object buildPageOrSlice(Object[] parameters, ParsedQueryWithTagsAndValues parsedQueryWithTagsAndValues,\n+\t\t\tDatastoreResultsIterable found) {\n+\t\tPageable pageableParam =\n+\t\t\t\tnew ParametersParameterAccessor(getQueryMethod().getParameters(), parameters).getPageable();\n+\t\tList resultsList = found == null ? Collections.emptyList()\n+\t\t\t\t: (List) StreamSupport.stream(found.spliterator(), false).collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31e3f656996531d00a9098e41a406e74fb99241c"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NDE5MjY0", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2186#pullrequestreview-355419264", "createdAt": "2020-02-07T20:31:34Z", "commit": {"oid": "31e3f656996531d00a9098e41a406e74fb99241c"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMDozMTozNFrOFnJbHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QyMDozMTozNFrOFnJbHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU5MzE4Mw==", "bodyText": "Perhaps a PR description would help? I am equally confused, BTW :)", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2186#discussion_r376593183", "createdAt": "2020-02-07T20:31:34Z", "author": {"login": "elefeint"}, "path": "spring-cloud-gcp-data-datastore/src/main/java/org/springframework/cloud/gcp/data/datastore/repository/query/GqlDatastoreQuery.java", "diffHunk": "@@ -169,6 +157,19 @@ else if (this.queryMethod.isCollectionQuery()) {\n \t\treturn result;\n \t}\n \n+\tprivate Object buildPageOrSlice(Object[] parameters, ParsedQueryWithTagsAndValues parsedQueryWithTagsAndValues,\n+\t\t\tDatastoreResultsIterable found) {\n+\t\tPageable pageableParam =\n+\t\t\t\tnew ParametersParameterAccessor(getQueryMethod().getParameters(), parameters).getPageable();\n+\t\tList resultsList = found == null ? Collections.emptyList()\n+\t\t\t\t: (List) StreamSupport.stream(found.spliterator(), false).collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU3NDk4MA=="}, "originalCommit": {"oid": "31e3f656996531d00a9098e41a406e74fb99241c"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbe69248d65712dfdbd113b8481fe2ed9cb59b80", "author": {"user": {"login": "dmitry-s", "name": null}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/dbe69248d65712dfdbd113b8481fe2ed9cb59b80", "committedDate": "2020-02-07T21:42:34Z", "message": "fix slice projection for @Query annotated methods"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NDYyMDY3", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2186#pullrequestreview-355462067", "createdAt": "2020-02-07T21:58:39Z", "commit": {"oid": "dbe69248d65712dfdbd113b8481fe2ed9cb59b80"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 529, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}