{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5Nzc1Njg4", "number": 2164, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMToyNDowMVrODcXJ3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNDozOTo1MFrODcp3jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMDY2MDc4OnYy", "diffSide": "RIGHT", "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/repository/query/PartTreeFirestoreQuery.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMToyNDowMVrOFkYWHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMToyNDowMVrOFkYWHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY5MTkzNA==", "bodyText": "Doesn't support 'OR', would be a more straight forward message imo?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2164#discussion_r373691934", "createdAt": "2020-01-31T21:24:01Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/repository/query/PartTreeFirestoreQuery.java", "diffHunk": "@@ -88,18 +88,31 @@ public PartTreeFirestoreQuery(FirestoreQueryMethod queryMethod, FirestoreReactiv\n \t\tthis.tree = new PartTree(queryMethod.getName(), returnedType.getDomainType());\n \t\tthis.persistentEntity = mappingContext.getPersistentEntity(returnedType.getDomainType());\n \t\tthis.classMapper = classMapper;\n+\t\tvalidate();\n \t}\n \n-\t@Override\n-\tpublic Object execute(Object[] parameters) {\n+\tprivate void validate() {\n \t\tList parts = this.tree.get().collect(Collectors.toList());\n \t\tif (parts.size() > 1 && parts.get(0) instanceof PartTree.OrPart) {\n \t\t\t\tthrow new FirestoreDataException(\n-\t\t\t\t\t\t\"Cloud Firestore only supports multiple filters combined with AND.\");\n+\t\t\t\t\t\t\"Cloud Firestore only supports multiple filters combined with AND (\" + this.getQueryMethod().getName() + \")\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6921db3eb3b6d15d2709650c4336bf4925144f07"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMDY2MTQwOnYy", "diffSide": "RIGHT", "path": "spring-cloud-gcp-data-firestore/src/test/java/org/springframework/cloud/gcp/data/firestore/repository/query/PartTreeFirestoreQueryTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMToyNDoyMVrOFkYWig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMToyNDoyMVrOFkYWig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY5MjA0Mg==", "bodyText": "Can we just say Between?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2164#discussion_r373692042", "createdAt": "2020-01-31T21:24:21Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-data-firestore/src/test/java/org/springframework/cloud/gcp/data/firestore/repository/query/PartTreeFirestoreQueryTests.java", "diffHunk": "@@ -128,20 +128,19 @@ public void testPartTreeQueryParameterException() {\n \n \t@Test\n \tpublic void testPartTreeQueryFilterException() {\n-\t\tPartTreeFirestoreQuery partTreeFirestoreQuery =\n-\t\t\t\tcreatePartTreeQuery(\"findByAgeBetween\");\n-\t\tassertThatThrownBy(() -> partTreeFirestoreQuery.execute(new Object[]{0, 100}))\n+\t\tassertThatThrownBy(() -> createPartTreeQuery(\"findByAgeBetweenAndNameRegex\"))\n \t\t\t\t.isInstanceOf(FirestoreDataException.class)\n-\t\t\t\t.hasMessage(\"Unsupported predicate keyword: BETWEEN (2): [IsBetween, Between]\");\n+\t\t\t\t.hasMessage(\"Unsupported predicate keywords: \" +\n+\t\t\t\t\t\t\"[BETWEEN (2): [IsBetween, Between], \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6921db3eb3b6d15d2709650c4336bf4925144f07"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMzcxNjk5OnYy", "diffSide": "RIGHT", "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/repository/query/PartTreeFirestoreQuery.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNDozNzowMlrOFkzfcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNDozNzowMlrOFkzfcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDEzNjY4OQ==", "bodyText": "nit: move .map() to the next line for readability.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2164#discussion_r374136689", "createdAt": "2020-02-03T14:37:02Z", "author": {"login": "elefeint"}, "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/repository/query/PartTreeFirestoreQuery.java", "diffHunk": "@@ -88,18 +88,31 @@ public PartTreeFirestoreQuery(FirestoreQueryMethod queryMethod, FirestoreReactiv\n \t\tthis.tree = new PartTree(queryMethod.getName(), returnedType.getDomainType());\n \t\tthis.persistentEntity = mappingContext.getPersistentEntity(returnedType.getDomainType());\n \t\tthis.classMapper = classMapper;\n+\t\tvalidate();\n \t}\n \n-\t@Override\n-\tpublic Object execute(Object[] parameters) {\n+\tprivate void validate() {\n \t\tList parts = this.tree.get().collect(Collectors.toList());\n \t\tif (parts.size() > 1 && parts.get(0) instanceof PartTree.OrPart) {\n \t\t\t\tthrow new FirestoreDataException(\n-\t\t\t\t\t\t\"Cloud Firestore only supports multiple filters combined with AND.\");\n+\t\t\t\t\t\t\"Cloud Firestore doesn't support 'OR' (\" + this.getQueryMethod().getName() + \")\");\n+\t\t}\n+\t\tList<String> unsupportedParts = this.tree.getParts().stream()\n+\t\t\t\t.filter(part -> !isSupportedPart(part.getType())).map(part -> part.getType().toString())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32313b07f454931e7d5d2690998bfd96bf4c6219"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxMzcyNjg1OnYy", "diffSide": "RIGHT", "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/repository/query/PartTreeFirestoreQuery.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNDozOTo1MFrOFkzlqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxNDozOTo1MFrOFkzlqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDEzODI4Mg==", "bodyText": "Would it help the caller to see (method name: [METHOD]) as opposed to just ([METHOD])?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2164#discussion_r374138282", "createdAt": "2020-02-03T14:39:50Z", "author": {"login": "elefeint"}, "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/repository/query/PartTreeFirestoreQuery.java", "diffHunk": "@@ -88,18 +88,31 @@ public PartTreeFirestoreQuery(FirestoreQueryMethod queryMethod, FirestoreReactiv\n \t\tthis.tree = new PartTree(queryMethod.getName(), returnedType.getDomainType());\n \t\tthis.persistentEntity = mappingContext.getPersistentEntity(returnedType.getDomainType());\n \t\tthis.classMapper = classMapper;\n+\t\tvalidate();\n \t}\n \n-\t@Override\n-\tpublic Object execute(Object[] parameters) {\n+\tprivate void validate() {\n \t\tList parts = this.tree.get().collect(Collectors.toList());\n \t\tif (parts.size() > 1 && parts.get(0) instanceof PartTree.OrPart) {\n \t\t\t\tthrow new FirestoreDataException(\n-\t\t\t\t\t\t\"Cloud Firestore only supports multiple filters combined with AND.\");\n+\t\t\t\t\t\t\"Cloud Firestore doesn't support 'OR' (\" + this.getQueryMethod().getName() + \")\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32313b07f454931e7d5d2690998bfd96bf4c6219"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2215, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}