{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MDA5Mzgw", "number": 2323, "title": "Refactor Pub/sub integration test to reduce duplication", "bodyText": "removed finally blocks; setup and teardown are now done with junit.\nReplaced custom output capture with a rule.\nremoved custom publisher/subscriber factory configuration; now that topic/subscription creation happens before each test, the customness is not necessary.", "createdAt": "2020-04-15T21:57:04Z", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2323", "merged": true, "mergeCommit": {"oid": "0e97f1453482ac40bdadf5c314c8c55ce0c96491"}, "closed": true, "closedAt": "2020-04-16T13:57:23Z", "author": {"login": "elefeint"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcX_Wf4AH2gAyNDA0MDA5MzgwOjZkMGNkN2FlMTkxZWYxYzAzZmUzZWMyMmYxMmQzYWRiMGExMDE5MDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX_gDNAFqTM5NDE2NzI1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6d0cd7ae191ef1c03fe3ec22f12d3adb0a101905", "author": {"user": {"login": "elefeint", "name": "Elena Felder"}}, "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/6d0cd7ae191ef1c03fe3ec22f12d3adb0a101905", "committedDate": "2020-04-15T21:54:56Z", "message": "refactor test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MTY3MjU0", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2323#pullrequestreview-394167254", "createdAt": "2020-04-15T22:03:30Z", "commit": {"oid": "6d0cd7ae191ef1c03fe3ec22f12d3adb0a101905"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMjowMzozMFrOGGNNGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMjowMzozMFrOGGNNGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE2MDk4NQ==", "bodyText": "Do we want to do this per test, or once for the whole class?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2323#discussion_r409160985", "createdAt": "2020-04-15T22:03:30Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-autoconfigure/src/test/java/org/springframework/cloud/gcp/autoconfigure/pubsub/it/PubSubChannelAdaptersIntegrationTests.java", "diffHunk": "@@ -80,103 +72,120 @@\n  *\n  * @author Jo\u00e3o Andr\u00e9 Martins\n  * @author Mike Eltsufin\n+ * @author Elena Felder\n  */\n public class PubSubChannelAdaptersIntegrationTests {\n \n \tprivate static final int RECEIVE_TIMEOUT_MS = 10000;\n \n-\tprivate static PrintStream systemOut;\n+\tstatic PubSubAdmin pubSubAdmin;\n \n-\tprivate static ByteArrayOutputStream baos;\n+\t/** Capture output for verification. */\n+\t@Rule\n+\tpublic OutputCaptureRule outputCaptureRule = new OutputCaptureRule();\n \n-\tprivate ApplicationContextRunner contextRunner = new ApplicationContextRunner()\n-\t\t\t.withConfiguration(AutoConfigurations.of(\n-\t\t\t\t\tGcpContextAutoConfiguration.class,\n-\t\t\t\t\tGcpPubSubAutoConfiguration.class))\n-\t\t\t.withUserConfiguration(PollableConfiguration.class, CommonConfiguration.class);\n+\tString topicName;\n+\n+\tString subscriptionName;\n+\n+\tApplicationContextRunner contextRunner;\n \n \t@BeforeClass\n \tpublic static void enableTests() {\n \t\tassumeThat(System.getProperty(\"it.pubsub\")).isEqualTo(\"true\");\n \t}\n \n \t@BeforeClass\n-\tpublic static void captureStdout() {\n-\t\tsystemOut = System.out;\n-\t\tbaos = new ByteArrayOutputStream();\n-\t\tTeeOutputStream out = new TeeOutputStream(systemOut, baos);\n-\t\tSystem.setOut(new PrintStream(out));\n+\tpublic static void initializePubSubAdmin() throws Exception {\n+\t\tpubSubAdmin = new PubSubAdmin(\n+\t\t\t\tnew DefaultGcpProjectIdProvider(),\n+\t\t\t\tnew DefaultCredentialsProvider(() -> new Credentials())\n+\t\t);\n \t}\n \n-\t@AfterClass\n-\tpublic static void resetStdout() {\n-\t\tSystem.setOut(systemOut);\n+\t@Before", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d0cd7ae191ef1c03fe3ec22f12d3adb0a101905"}, "originalPosition": 110}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 437, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}