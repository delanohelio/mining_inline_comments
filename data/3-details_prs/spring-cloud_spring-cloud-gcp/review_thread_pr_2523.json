{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MzM1MzU0", "number": 2523, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNToxOToxOVrOEjpN6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNjoxMjozN1rOEjqsaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODEwOTIwOnYy", "diffSide": "LEFT", "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/util/Util.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNToxOToxOVrOHSHICw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo1MzozNFrOHSNgpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc1MzE2Mw==", "bodyText": "What happened to StringUtils? Why can't we use it anymore?", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2523#discussion_r488753163", "createdAt": "2020-09-15T15:19:19Z", "author": {"login": "meltsufin"}, "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/util/Util.java", "diffHunk": "@@ -27,7 +25,20 @@ private Util() {\n \t}\n \n \tpublic static String extractDatabasePath(String parent) {\n-\t\treturn parent.substring(0, StringUtils.ordinalIndexOf(parent, \"/\", 4));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f31436cec4f667573ab351ab352c90a2ebbb9fa2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1Nzc2Ng==", "bodyText": "org.apache.commons.lang3 was removed from dependencies and I don't want to bring it in only for this one method.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2523#discussion_r488857766", "createdAt": "2020-09-15T17:53:34Z", "author": {"login": "dmitry-s"}, "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/util/Util.java", "diffHunk": "@@ -27,7 +25,20 @@ private Util() {\n \t}\n \n \tpublic static String extractDatabasePath(String parent) {\n-\t\treturn parent.substring(0, StringUtils.ordinalIndexOf(parent, \"/\", 4));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc1MzE2Mw=="}, "originalCommit": {"oid": "f31436cec4f667573ab351ab352c90a2ebbb9fa2"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODM1MTEzOnYy", "diffSide": "RIGHT", "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/util/Util.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNjoxMjozN1rOHSJdRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo1NjowN1rOHSNmjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5MTM2NQ==", "bodyText": "Since you're appending each character at a time anyway in a StringBuilder, might as well just do String.split(\"/\") and then do return arr[0] + \"/\" + arr[1] + ... + arr[3]; would be more readable (only 2-3 lines total).", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2523#discussion_r488791365", "createdAt": "2020-09-15T16:12:37Z", "author": {"login": "dzou"}, "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/util/Util.java", "diffHunk": "@@ -27,7 +25,20 @@ private Util() {\n \t}\n \n \tpublic static String extractDatabasePath(String parent) {\n-\t\treturn parent.substring(0, StringUtils.ordinalIndexOf(parent, \"/\", 4));\n+\t\t//the parent looks like this: projects/{project_id}/databases/{database_id}/...\n+\t\t//and the database path is the first 4 segments, separated by /\n+\t\tStringBuilder sb = new StringBuilder();\n+\t\tint count = 0;\n+\t\tfor (int i = 0; i < parent.length(); i++) {\n+\t\t\tchar c = parent.charAt(i);\n+\t\t\tif (c == '/') {\n+\t\t\t\tcount++;\n+\t\t\t}\n+\t\t\tif (count == 4) {\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t\t\tsb.append(c);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f31436cec4f667573ab351ab352c90a2ebbb9fa2"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5MjgxNg==", "bodyText": "You can even make it more efficient using the limit arg in String.split: https://docs.oracle.com/javase/7/docs/api/java/lang/String.html#split(java.lang.String,%20int)", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2523#discussion_r488792816", "createdAt": "2020-09-15T16:14:42Z", "author": {"login": "dzou"}, "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/util/Util.java", "diffHunk": "@@ -27,7 +25,20 @@ private Util() {\n \t}\n \n \tpublic static String extractDatabasePath(String parent) {\n-\t\treturn parent.substring(0, StringUtils.ordinalIndexOf(parent, \"/\", 4));\n+\t\t//the parent looks like this: projects/{project_id}/databases/{database_id}/...\n+\t\t//and the database path is the first 4 segments, separated by /\n+\t\tStringBuilder sb = new StringBuilder();\n+\t\tint count = 0;\n+\t\tfor (int i = 0; i < parent.length(); i++) {\n+\t\t\tchar c = parent.charAt(i);\n+\t\t\tif (c == '/') {\n+\t\t\t\tcount++;\n+\t\t\t}\n+\t\t\tif (count == 4) {\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t\t\tsb.append(c);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5MTM2NQ=="}, "originalCommit": {"oid": "f31436cec4f667573ab351ab352c90a2ebbb9fa2"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1NzE2MQ==", "bodyText": "I was trying to avoid unnecessary computation, since split allocates an array and then we need to combine the items. Also, split is a regex based method so the computational complexity is higher.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2523#discussion_r488857161", "createdAt": "2020-09-15T17:52:30Z", "author": {"login": "dmitry-s"}, "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/util/Util.java", "diffHunk": "@@ -27,7 +25,20 @@ private Util() {\n \t}\n \n \tpublic static String extractDatabasePath(String parent) {\n-\t\treturn parent.substring(0, StringUtils.ordinalIndexOf(parent, \"/\", 4));\n+\t\t//the parent looks like this: projects/{project_id}/databases/{database_id}/...\n+\t\t//and the database path is the first 4 segments, separated by /\n+\t\tStringBuilder sb = new StringBuilder();\n+\t\tint count = 0;\n+\t\tfor (int i = 0; i < parent.length(); i++) {\n+\t\t\tchar c = parent.charAt(i);\n+\t\t\tif (c == '/') {\n+\t\t\t\tcount++;\n+\t\t\t}\n+\t\t\tif (count == 4) {\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t\t\tsb.append(c);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5MTM2NQ=="}, "originalCommit": {"oid": "f31436cec4f667573ab351ab352c90a2ebbb9fa2"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1OTI3Nw==", "bodyText": "I see, makes sense.", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2523#discussion_r488859277", "createdAt": "2020-09-15T17:56:07Z", "author": {"login": "dzou"}, "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/util/Util.java", "diffHunk": "@@ -27,7 +25,20 @@ private Util() {\n \t}\n \n \tpublic static String extractDatabasePath(String parent) {\n-\t\treturn parent.substring(0, StringUtils.ordinalIndexOf(parent, \"/\", 4));\n+\t\t//the parent looks like this: projects/{project_id}/databases/{database_id}/...\n+\t\t//and the database path is the first 4 segments, separated by /\n+\t\tStringBuilder sb = new StringBuilder();\n+\t\tint count = 0;\n+\t\tfor (int i = 0; i < parent.length(); i++) {\n+\t\t\tchar c = parent.charAt(i);\n+\t\t\tif (c == '/') {\n+\t\t\t\tcount++;\n+\t\t\t}\n+\t\t\tif (count == 4) {\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t\t\tsb.append(c);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5MTM2NQ=="}, "originalCommit": {"oid": "f31436cec4f667573ab351ab352c90a2ebbb9fa2"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2058, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}