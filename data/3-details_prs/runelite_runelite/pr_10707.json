{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5ODMyNTAx", "number": 10707, "title": "PluginManager: require start/stop to be invoked on the EDT", "bodyText": "The current way of invoking it on the executor would let the client have\na start and a stop for a plugin sitting in the executor's queue, making\nit toggle endlessly. This only was because we were using invokeAndWait\nin startPlugin, which can't be invoked on the EDT because it would\ndeadlock with itself.\nFixes #10677", "createdAt": "2020-02-01T01:13:06Z", "url": "https://github.com/runelite/runelite/pull/10707", "merged": true, "mergeCommit": {"oid": "04216368f524e5a8a2b729e443d8d78f1a1ba90b"}, "closed": true, "closedAt": "2020-02-10T00:56:21Z", "author": {"login": "abextm"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcCa_wVAFqTM1NTU2OTE3Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcCnl4IABqjMwMjA1NTM4MDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTY5MTc3", "url": "https://github.com/runelite/runelite/pull/10707#pullrequestreview-355569177", "createdAt": "2020-02-08T21:09:54Z", "commit": {"oid": "ce204ca2d44780dc1e2fcf6e35ce37b26aaac851"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQyMTowOTo1NFrOFnSDkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQyMTowOTo1NFrOFnSDkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjczNDYwOA==", "bodyText": "Are you sure this is the correct way to handle this?", "url": "https://github.com/runelite/runelite/pull/10707#discussion_r376734608", "createdAt": "2020-02-08T21:09:54Z", "author": {"login": "Adam-"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/PluginManager.java", "diffHunk": "@@ -215,12 +217,22 @@ public void startPlugins()\n \t\t{\n \t\t\ttry\n \t\t\t{\n-\t\t\t\tstartPlugin(plugin);\n+\t\t\t\tSwingUtilities.invokeAndWait(() ->\n+\t\t\t\t{\n+\t\t\t\t\ttry\n+\t\t\t\t\t{\n+\t\t\t\t\t\tstartPlugin(plugin);\n+\t\t\t\t\t}\n+\t\t\t\t\tcatch (PluginInstantiationException ex)\n+\t\t\t\t\t{\n+\t\t\t\t\t\tlog.warn(\"Unable to start plugin {}\", plugin.getClass().getSimpleName(), ex);\n+\t\t\t\t\t\tplugins.remove(plugin);\n+\t\t\t\t\t}\n+\t\t\t\t});\n \t\t\t}\n-\t\t\tcatch (PluginInstantiationException ex)\n+\t\t\tcatch (InterruptedException | InvocationTargetException e)\n \t\t\t{\n-\t\t\t\tlog.warn(\"Unable to start plugin {}\", plugin.getClass().getSimpleName(), ex);\n-\t\t\t\tplugins.remove(plugin);\n+\t\t\t\tthrow new RuntimeException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce204ca2d44780dc1e2fcf6e35ce37b26aaac851"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NTcwNDkz", "url": "https://github.com/runelite/runelite/pull/10707#pullrequestreview-355570493", "createdAt": "2020-02-08T21:41:58Z", "commit": {"oid": "ce204ca2d44780dc1e2fcf6e35ce37b26aaac851"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQyMTo0MTo1OFrOFnSKVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOFQyMTo0MTo1OFrOFnSKVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjczNjM0Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\t\tcatch (Exception e2)\n          \n          \n            \n            \t\t\t\t\t\tcatch (Exception e)", "url": "https://github.com/runelite/runelite/pull/10707#discussion_r376736342", "createdAt": "2020-02-08T21:41:58Z", "author": {"login": "Adam-"}, "path": "runelite-client/src/main/java/net/runelite/client/externalplugins/ExternalPluginManager.java", "diffHunk": "@@ -242,9 +244,19 @@ private void refreshPlugins()\n \t\t\t\tlog.info(\"Stopping external plugin \\\"{}\\\"\", p.getClass());\n \t\t\t\ttry\n \t\t\t\t{\n-\t\t\t\t\tpluginManager.stopPlugin(p);\n+\t\t\t\t\tSwingUtilities.invokeAndWait(() ->\n+\t\t\t\t\t{\n+\t\t\t\t\t\ttry\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tpluginManager.stopPlugin(p);\n+\t\t\t\t\t\t}\n+\t\t\t\t\t\tcatch (Exception e2)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce204ca2d44780dc1e2fcf6e35ce37b26aaac851"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "089a793ba01f0c20745dd933cbc9550784444360", "author": {"user": {"login": "abextm", "name": "Abex"}}, "url": "https://github.com/runelite/runelite/commit/089a793ba01f0c20745dd933cbc9550784444360", "committedDate": "2020-02-09T12:20:47Z", "message": "PluginManager: require start/stop to be invoked on the EDT\n\nThe current way of invoking it on the executor would let the client have\na start and a stop for a plugin sitting in the executor's queue, making\nit toggle endlessly. This only was because we were using invokeAndWait\nin startPlugin, which can't be invoked on the EDT because it would\ndeadlock with itself."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce204ca2d44780dc1e2fcf6e35ce37b26aaac851", "author": {"user": {"login": "abextm", "name": "Abex"}}, "url": "https://github.com/runelite/runelite/commit/ce204ca2d44780dc1e2fcf6e35ce37b26aaac851", "committedDate": "2020-02-01T01:10:28Z", "message": "PluginManager: require start/stop to be invoked on the EDT\n\nThe current way of invoking it on the executor would let the client have\na start and a stop for a plugin sitting in the executor's queue, making\nit toggle endlessly. This only was because we were using invokeAndWait\nin startPlugin, which can't be invoked on the EDT because it would\ndeadlock with itself."}, "afterCommit": {"oid": "089a793ba01f0c20745dd933cbc9550784444360", "author": {"user": {"login": "abextm", "name": "Abex"}}, "url": "https://github.com/runelite/runelite/commit/089a793ba01f0c20745dd933cbc9550784444360", "committedDate": "2020-02-09T12:20:47Z", "message": "PluginManager: require start/stop to be invoked on the EDT\n\nThe current way of invoking it on the executor would let the client have\na start and a stop for a plugin sitting in the executor's queue, making\nit toggle endlessly. This only was because we were using invokeAndWait\nin startPlugin, which can't be invoked on the EDT because it would\ndeadlock with itself."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4192, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}