{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzMzIwNDYy", "number": 10945, "title": "Hiscore: autocomplete recent search history", "bodyText": "Saves a certain amount of names (set to 25 right now) to the configuration. Only those that had been successfully queried.\nHappy to get any remarks.\nCloses #10809", "createdAt": "2020-03-04T03:34:29Z", "url": "https://github.com/runelite/runelite/pull/10945", "merged": true, "mergeCommit": {"oid": "c1d5e3ae161b6c195f37306a5c67e8eef4904562"}, "closed": true, "closedAt": "2020-03-17T14:26:35Z", "author": {"login": "DSerp"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKO8x5gFqTM2ODQ5MzcxNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOjUfkgBqjMxMzc0OTE5MzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NDkzNzE1", "url": "https://github.com/runelite/runelite/pull/10945#pullrequestreview-368493715", "createdAt": "2020-03-04T04:10:20Z", "commit": {"oid": "8b14963c74c5b455f2de2e4c7fcc7c353682abfa"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNDoxMDoyMFrOFxfcTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNDoxMDoyMFrOFxfcTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQzOTY5NA==", "bodyText": "Can't these classes be replaced with an evicting queue?", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r387439694", "createdAt": "2020-03-04T04:10:20Z", "author": {"login": "raiyni"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/SearchHistoryManager.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * Copyright (c) 2020, Daniel <serpa88@hotmail.ca>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.hiscore;\n+\n+import com.google.inject.Inject;\n+import java.util.ArrayList;\n+import java.util.stream.Collectors;\n+import static net.runelite.http.api.RuneLiteAPI.GSON;\n+import net.runelite.http.api.hiscore.HiscoreResult;\n+\n+public class SearchHistoryManager", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b14963c74c5b455f2de2e4c7fcc7c353682abfa"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8b14963c74c5b455f2de2e4c7fcc7c353682abfa", "author": {"user": {"login": "DSerp", "name": "Daniel"}}, "url": "https://github.com/runelite/runelite/commit/8b14963c74c5b455f2de2e4c7fcc7c353682abfa", "committedDate": "2020-03-04T03:31:21Z", "message": "Hiscore: autocomplete recent search history\n\nSaves a certain amount of names to the configuration that were successfully queried"}, "afterCommit": {"oid": "ad77a51f002700556008071b4f95473e05804be3", "author": {"user": {"login": "DSerp", "name": "Daniel"}}, "url": "https://github.com/runelite/runelite/commit/ad77a51f002700556008071b4f95473e05804be3", "committedDate": "2020-03-05T00:40:50Z", "message": "Hiscore: autocomplete recent search history"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MjQwNjM3", "url": "https://github.com/runelite/runelite/pull/10945#pullrequestreview-369240637", "createdAt": "2020-03-05T01:27:46Z", "commit": {"oid": "ad77a51f002700556008071b4f95473e05804be3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwMToyNzo0NlrOFyDjVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwMjoxNDo0MVrOFyETng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAzMTMxNw==", "bodyText": "initialize the size here", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r388031317", "createdAt": "2020-03-05T01:27:46Z", "author": {"login": "raiyni"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/NameAutocompleter.java", "diffHunk": "@@ -50,15 +54,22 @@\n \t/**\n \t * Non-breaking space character.\n \t */\n-\tprivate static final String NBSP = Character.toString((char)160);\n+\tprivate static final String NBSP = Character.toString((char) 160);\n \n \t/**\n \t * Character class for characters that cannot be in an RSN.\n \t */\n \tprivate static final Pattern INVALID_CHARS = Pattern.compile(\"[^a-zA-Z0-9_ -]\");\n \n+\tprivate static final Pattern RSN_PATTERN = Pattern.compile(\"[A-Za-z0-9 ]+\");\n+\tprivate static final int MAX_SEARCH_HISTORY = 25;\n+\n \tprivate final Client client;\n \n+\tprivate final HiscoreConfig config;\n+\n+\tprivate EvictingQueue<String> searchHistory;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad77a51f002700556008071b4f95473e05804be3"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAzMjAwNQ==", "bodyText": "I don't think using this matcher really matters? It can just be initialized with the values split from Text::COMMA_SPLITTER", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r388032005", "createdAt": "2020-03-05T01:30:12Z", "author": {"login": "raiyni"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/NameAutocompleter.java", "diffHunk": "@@ -241,6 +260,27 @@ private boolean findAutocompleteName(String nameStart)\n \t\treturn autocompleteName.isPresent();\n \t}\n \n+\tprivate void populateSearchHistory()\n+\t{\n+\t\tsearchHistory = EvictingQueue.create(MAX_SEARCH_HISTORY);\n+\t\tMatcher m = RSN_PATTERN.matcher(config.searchHistory());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad77a51f002700556008071b4f95473e05804be3"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA0MzQ1Ng==", "bodyText": "There are a lot of irrelevant changes in this, are you using our style format file?", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r388043456", "createdAt": "2020-03-05T02:13:49Z", "author": {"login": "raiyni"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/NameAutocompleter.java", "diffHunk": "@@ -145,7 +158,7 @@ public void keyTyped(KeyEvent e)\n \n \tprivate void newAutocomplete(KeyEvent e)\n \t{\n-\t\tfinal JTextComponent input = (JTextComponent)e.getSource();\n+\t\tfinal JTextComponent input = (JTextComponent) e.getSource();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad77a51f002700556008071b4f95473e05804be3"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA0MzY3OA==", "bodyText": "You should be able to use String::join", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r388043678", "createdAt": "2020-03-05T02:14:41Z", "author": {"login": "raiyni"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/NameAutocompleter.java", "diffHunk": "@@ -241,6 +260,27 @@ private boolean findAutocompleteName(String nameStart)\n \t\treturn autocompleteName.isPresent();\n \t}\n \n+\tprivate void populateSearchHistory()\n+\t{\n+\t\tsearchHistory = EvictingQueue.create(MAX_SEARCH_HISTORY);\n+\t\tMatcher m = RSN_PATTERN.matcher(config.searchHistory());\n+\n+\t\twhile (m.find())\n+\t\t{\n+\t\t\tsearchHistory.add(m.group());\n+\t\t}\n+\t}\n+\n+\tvoid addToSearchHistory(@NonNull String name)\n+\t{\n+\t\tif (!searchHistory.contains(name))\n+\t\t{\n+\t\t\tsearchHistory.offer(name);\n+\t\t\tString result = searchHistory.stream().collect(Collectors.joining(\",\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad77a51f002700556008071b4f95473e05804be3"}, "originalPosition": 127}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MjkwNTI5", "url": "https://github.com/runelite/runelite/pull/10945#pullrequestreview-369290529", "createdAt": "2020-03-05T04:36:15Z", "commit": {"oid": "0e69821cd2a88ab26ae2ead7d1008928aedcf3ec"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwNDozNjoxNVrOFyGLBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwNDozNjoxNVrOFyGLBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA3NDI0NQ==", "bodyText": "This will need to be able to populate when you log into a runelite account too", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r388074245", "createdAt": "2020-03-05T04:36:15Z", "author": {"login": "raiyni"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/NameAutocompleter.java", "diffHunk": "@@ -70,9 +79,11 @@\n \tprivate Pattern autocompleteNamePattern;\n \n \t@Inject\n-\tprivate NameAutocompleter(@Nullable Client client)\n+\tprivate NameAutocompleter(@Nullable Client client, HiscoreConfig config)\n \t{\n \t\tthis.client = client;\n+\t\tthis.config = config;\n+\t\tsearchHistory.addAll(Text.fromCSV(config.searchHistory()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e69821cd2a88ab26ae2ead7d1008928aedcf3ec"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzIwNDEz", "url": "https://github.com/runelite/runelite/pull/10945#pullrequestreview-370720413", "createdAt": "2020-03-07T03:59:09Z", "commit": {"oid": "23689b1daaa8aa705e0da016f706a07f9b6c051f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwMzo1OTowOVrOFzMb5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QwNDo1Mjo0OFrOFzMnHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyNTQ0NA==", "bodyText": "Make this a package-private-only getter:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t@Getter\n          \n          \n            \n            \t@Getter(AccessLevel.PACKAGE)", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r389225444", "createdAt": "2020-03-07T03:59:09Z", "author": {"login": "Nightfirecat"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/HiscorePlugin.java", "diffHunk": "@@ -89,6 +90,7 @@\n \tprivate HiscorePanel hiscorePanel;\n \n \t@Inject\n+\t@Getter", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23689b1daaa8aa705e0da016f706a07f9b6c051f"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyNzkwMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tif (!autocompleteName.isPresent())\n          \n          \n            \n            \t\t// Search friends if previous searches weren't matched\n          \n          \n            \n            \t\tif (!autocompleteName.isPresent())", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r389227901", "createdAt": "2020-03-07T04:44:08Z", "author": {"login": "Nightfirecat"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/NameAutocompleter.java", "diffHunk": "@@ -191,15 +200,21 @@ private boolean findAutocompleteName(String nameStart)\n \n \t\tautocompleteName = Optional.empty();\n \n-\t\t// TODO: Search lookup history\n+\t\t// Search all previous successful queries\n+\t\tautocompleteName = searchHistory.stream()\n+\t\t\t.filter(n -> pattern.matcher(n).matches())\n+\t\t\t.findFirst();\n \n-\t\tNameableContainer<Friend> friendContainer = client.getFriendContainer();\n-\t\tif (friendContainer != null)\n+\t\tif (!autocompleteName.isPresent())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23689b1daaa8aa705e0da016f706a07f9b6c051f"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyODMxOQ==", "bodyText": "This is no longer used and can be removed. (as can the HiscorePanelTest change)", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r389228319", "createdAt": "2020-03-07T04:52:48Z", "author": {"login": "Nightfirecat"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/HiscoreConfig.java", "diffHunk": "@@ -85,4 +85,22 @@ default boolean bountylookup()\n \t{\n \t\treturn false;\n \t}\n-}\n\\ No newline at end of file\n+\n+\t@ConfigItem(\n+\t\tkeyName = \"searchHistory\",\n+\t\tname = \"\",\n+\t\tdescription = \"\",\n+\t\thidden = true\n+\t)\n+\tdefault String searchHistory()\n+\t{\n+\t\treturn \"\";\n+\t}\n+\n+\t@ConfigItem(\n+\t\tkeyName = \"searchHistory\",\n+\t\tname = \"\",\n+\t\tdescription = \"\"\n+\t)\n+\tvoid searchHistory(String searchHistory);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "23689b1daaa8aa705e0da016f706a07f9b6c051f"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMTk0NzY0", "url": "https://github.com/runelite/runelite/pull/10945#pullrequestreview-372194764", "createdAt": "2020-03-10T18:00:12Z", "commit": {"oid": "1429bfa3cb3e26403b28e1116c4592dd6fd5fb68"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "729d948040e20d06ecdf5ea2fde89300990e2024", "author": {"user": {"login": "Adam-", "name": "Adam"}}, "url": "https://github.com/runelite/runelite/commit/729d948040e20d06ecdf5ea2fde89300990e2024", "committedDate": "2020-03-17T00:21:08Z", "message": "hiscore panel: autocomplete recent search history\n\nCo-authored-by: Daniel <serpa88@hotmail.ca>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1429bfa3cb3e26403b28e1116c4592dd6fd5fb68", "author": {"user": {"login": "DSerp", "name": "Daniel"}}, "url": "https://github.com/runelite/runelite/commit/1429bfa3cb3e26403b28e1116c4592dd6fd5fb68", "committedDate": "2020-03-09T03:32:55Z", "message": "remove unused config"}, "afterCommit": {"oid": "729d948040e20d06ecdf5ea2fde89300990e2024", "author": {"user": {"login": "Adam-", "name": "Adam"}}, "url": "https://github.com/runelite/runelite/commit/729d948040e20d06ecdf5ea2fde89300990e2024", "committedDate": "2020-03-17T00:21:08Z", "message": "hiscore panel: autocomplete recent search history\n\nCo-authored-by: Daniel <serpa88@hotmail.ca>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4018, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}