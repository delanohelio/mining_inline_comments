{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxNDgyMDYz", "number": 11859, "title": "LootTracker support for shade chests; support ground items", "bodyText": "This commit makes it so LootTracker tracks items that fall on the floor during an inventory-based loot. This works because ItemSpawned/ItemQuantityChanged events happen before ItemContainerChanged events.\nIt keeps a running track of items that spawned directly below the player during the current tick, and if that is in the same tick as as an inventory change that correlates to (e.g.) a chest or seed pack event, we include the ground items as part of the loot. I've tested this fairly extensively for crystal chests, with good results.\nThe shades part is relatively straightforward, and uses the object IDs. The only tricky thing is that unlike seed packs, just clicking \"Open\" is not sufficient \u2013 you need to also have a key in your inventory. The game gives you a message if you fail to have a key, so we match against this. Fixes #8817", "createdAt": "2020-06-09T01:34:06Z", "url": "https://github.com/runelite/runelite/pull/11859", "merged": true, "mergeCommit": {"oid": "a799051aae5a0357c41dfbaa8a0e2e325f30d4b0"}, "closed": true, "closedAt": "2020-06-16T10:01:03Z", "author": {"login": "leejt"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpyuX8gFqTQyNzcwNDM1Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcryS9JgFqTQzMTM0OTExNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NzA0MzUy", "url": "https://github.com/runelite/runelite/pull/11859#pullrequestreview-427704352", "createdAt": "2020-06-10T04:35:34Z", "commit": {"oid": "5b2e2fbe1f4a8e9300387fd26768db0647f07f45"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwNDozNTozNFrOGhkipw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQwNToyMjoxOFrOGhlQ6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg1NDg4Nw==", "bodyText": "Remove this extra newline at EOF\n\n  \n    \n      \n        Suggested change", "url": "https://github.com/runelite/runelite/pull/11859#discussion_r437854887", "createdAt": "2020-06-10T04:35:34Z", "author": {"login": "Nightfirecat"}, "path": "runelite-client/src/main/java/net/runelite/client/game/LootManager.java", "diffHunk": "@@ -403,4 +404,26 @@ private WorldPoint getAdjacentSquareLootTile(NPC npc)\n \n \t\treturn new WorldPoint(x, y, worldLocation.getPlane());\n \t}\n+\n+\t/**\n+\t * Get the list of items present at the provided WorldPoint that spawned this tick.\n+\t *\n+\t * @param worldPoint the location in question\n+\t * @return the list of item stacks\n+\t */\n+\tpublic Collection<ItemStack> getItemSpawns(WorldPoint worldPoint)\n+\t{\n+\t\tLocalPoint localPoint = LocalPoint.fromWorld(client, worldPoint);\n+\t\tif (localPoint == null)\n+\t\t{\n+\t\t\treturn Collections.emptyList();\n+\t\t}\n+\n+\t\tfinal int sceneX = localPoint.getSceneX();\n+\t\tfinal int sceneY = localPoint.getSceneY();\n+\t\tfinal int packed = sceneX << 8 | sceneY;\n+\t\tfinal List<ItemStack> itemStacks = itemSpawns.get(packed);\n+\t\treturn Collections.unmodifiableList(itemStacks);\n+\t}\n }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b2e2fbe1f4a8e9300387fd26768db0647f07f45"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg1NDkyNg==", "bodyText": "And this one\n\n  \n    \n      \n        Suggested change", "url": "https://github.com/runelite/runelite/pull/11859#discussion_r437854926", "createdAt": "2020-06-10T04:35:44Z", "author": {"login": "Nightfirecat"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java", "diffHunk": "@@ -891,3 +942,4 @@ private void lootReceivedChatMessage(final Collection<ItemStack> items, final St\n \t\t\t\t.build());\n \t}\n }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b2e2fbe1f4a8e9300387fd26768db0647f07f45"}, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg2NTA2Mw==", "bodyText": "All the clue scroll event cases should have their breaks become returns.", "url": "https://github.com/runelite/runelite/pull/11859#discussion_r437865063", "createdAt": "2020-06-10T05:16:30Z", "author": {"login": "Nightfirecat"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java", "diffHunk": "@@ -619,6 +649,13 @@ public void onChatMessage(ChatMessage event)\n \t\t\t\t\tbreak;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b2e2fbe1f4a8e9300387fd26768db0647f07f45"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg2NjczMA==", "bodyText": "As written, this would make every chest of different key color recorded in a different loot group, which is kind of weird. I'd expect users to care only about the chest color, not about the key color.", "url": "https://github.com/runelite/runelite/pull/11859#discussion_r437866730", "createdAt": "2020-06-10T05:22:18Z", "author": {"login": "Nightfirecat"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java", "diffHunk": "@@ -657,6 +698,13 @@ public void onMenuOptionClicked(MenuOptionClicked event)\n \t\t\tlootRecordType = LootRecordType.EVENT;\n \t\t\ttakeInventorySnapshot();\n \t\t}\n+\n+\t\tif (event.getMenuOption().equals(\"Open\") && SHADE_CHEST_OBJECTS.containsKey(event.getId()))\n+\t\t{\n+\t\t\teventType = SHADE_CHEST_OBJECTS.get(event.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b2e2fbe1f4a8e9300387fd26768db0647f07f45"}, "originalPosition": 97}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjAxNTYz", "url": "https://github.com/runelite/runelite/pull/11859#pullrequestreview-430201563", "createdAt": "2020-06-14T09:15:00Z", "commit": {"oid": "d0ab37afc7dd3feb883a2362c3f3c67dc4d20243"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fba6d7fcf63cd0e29fe5e84f6937918321158285", "author": {"user": {"login": "leejt", "name": "Jonathan Lee"}}, "url": "https://github.com/runelite/runelite/commit/fba6d7fcf63cd0e29fe5e84f6937918321158285", "committedDate": "2020-06-15T01:04:37Z", "message": "LootTracker: track ground items in addition to inventory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88e3845d97eb2b099ecb5eca87838f8cde396c43", "author": {"user": {"login": "leejt", "name": "Jonathan Lee"}}, "url": "https://github.com/runelite/runelite/commit/88e3845d97eb2b099ecb5eca87838f8cde396c43", "committedDate": "2020-06-15T01:04:55Z", "message": "LootTracker: track shade chest loot"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMzQ5MTE3", "url": "https://github.com/runelite/runelite/pull/11859#pullrequestreview-431349117", "createdAt": "2020-06-16T10:00:47Z", "commit": {"oid": "88e3845d97eb2b099ecb5eca87838f8cde396c43"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3602, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}