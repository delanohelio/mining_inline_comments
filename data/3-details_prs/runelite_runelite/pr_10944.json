{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzMjk3NjUw", "number": 10944, "title": "chatfilter: add filtering by username", "bodyText": "Closes #10923\nCan use regular expressions or just word filtering. \"Censor Words\" option stars out the entire message which is a bit ham-fisted but I'm not sure what to do in that case, open to suggestions.\nhttps://i.imgur.com/FBsZiaF.gifv", "createdAt": "2020-03-04T02:10:11Z", "url": "https://github.com/runelite/runelite/pull/10944", "merged": true, "mergeCommit": {"oid": "dc6942197ea0c6b9ebbe11fcc32a8963d7bffa21"}, "closed": true, "closedAt": "2020-03-05T20:28:06Z", "author": {"login": "ThatGamerBlue"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKiDwaAFqTM2OTI1Nzk5Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKuitOAH2gAyMzgzMjk3NjUwOjZjYzAxMGFmMWZmZmY2MDQ3NTliZjFkOTM4NWE2M2JhZjQ1ZjA5NWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MjU3OTk2", "url": "https://github.com/runelite/runelite/pull/10944#pullrequestreview-369257996", "createdAt": "2020-03-05T02:26:12Z", "commit": {"oid": "5c78038bb78f8a4b94242def6ea75c66d07a2041"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwMjoyNjoxMlrOFyEfJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwMjoyNjoxMlrOFyEfJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA0NjYzMQ==", "bodyText": "Any reason these can't be the same config?", "url": "https://github.com/runelite/runelite/pull/10944#discussion_r388046631", "createdAt": "2020-03-05T02:26:12Z", "author": {"login": "raiyni"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/chatfilter/ChatFilterConfig.java", "diffHunk": "@@ -65,11 +65,33 @@ default String filteredRegex()\n \t\treturn \"\";\n \t}\n \n+\t@ConfigItem(\n+\t\tkeyName = \"filteredNames\",\n+\t\tname = \"Filtered Names\",\n+\t\tdescription = \"List of filtered names, seperated by commas\",\n+\t\tposition = 4\n+\t)\n+\tdefault String filteredNames()\n+\t{\n+\t\treturn \"\";\n+\t}\n+\n+\t@ConfigItem(\n+\t\tkeyName = \"filteredNamesRegex\",\n+\t\tname = \"Filtered Names Regex\",\n+\t\tdescription = \"List of filtered regular expressions for usernames, one per line\",\n+\t\tposition = 5\n+\t)\n+\tdefault String filteredNamesRegex()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c78038bb78f8a4b94242def6ea75c66d07a2041"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MjkwNjk4", "url": "https://github.com/runelite/runelite/pull/10944#pullrequestreview-369290698", "createdAt": "2020-03-05T04:37:04Z", "commit": {"oid": "b43fdd5209f4a45370598eac8db96b43a2d3f7ee"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwNDozNzowNFrOFyGLjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwNDozOToyNVrOFyGNIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA3NDM4Mg==", "bodyText": "Move the CENSOR_WORDS code to a separate method and use it here and in the filteredPatterns loop.", "url": "https://github.com/runelite/runelite/pull/10944#discussion_r388074382", "createdAt": "2020-03-05T04:37:04Z", "author": {"login": "Nightfirecat"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/chatfilter/ChatFilterPlugin.java", "diffHunk": "@@ -183,10 +185,22 @@ boolean shouldFilterPlayerMessage(String playerName)\n \t\t\t(config.filterClan() || !clanManager.isClanMember(playerName));\n \t}\n \n-\tString censorMessage(final String message)\n+\tString censorMessage(final String username, final String message)\n \t{\n \t\tString strippedMessage = jagexPrintableCharMatcher.retainFrom(message)\n \t\t\t.replace('\\u00A0', ' ');\n+\t\tif (shouldFilterByName(username))\n+\t\t{\n+\t\t\tswitch (config.filterType())\n+\t\t\t{\n+\t\t\t\tcase CENSOR_WORDS:\n+\t\t\t\t\treturn StringUtils.repeat('*', strippedMessage.length());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b43fdd5209f4a45370598eac8db96b43a2d3f7ee"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA3NDUxMw==", "bodyText": "This can be static\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tprivate Pattern compilePattern(String pattern)\n          \n          \n            \n            \tprivate static Pattern compilePattern(String pattern)", "url": "https://github.com/runelite/runelite/pull/10944#discussion_r388074513", "createdAt": "2020-03-05T04:37:48Z", "author": {"login": "Nightfirecat"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/chatfilter/ChatFilterPlugin.java", "diffHunk": "@@ -219,25 +233,33 @@ String censorMessage(final String message)\n \tvoid updateFilteredPatterns()\n \t{\n \t\tfilteredPatterns.clear();\n+\t\tfilteredNamePatterns.clear();\n \n \t\tText.fromCSV(config.filteredWords()).stream()\n \t\t\t.map(s -> Pattern.compile(Pattern.quote(s), Pattern.CASE_INSENSITIVE))\n \t\t\t.forEach(filteredPatterns::add);\n \n \t\tNEWLINE_SPLITTER.splitToList(config.filteredRegex()).stream()\n-\t\t\t.map(s ->\n-\t\t\t{\n-\t\t\t\ttry\n-\t\t\t\t{\n-\t\t\t\t\treturn Pattern.compile(s, Pattern.CASE_INSENSITIVE);\n-\t\t\t\t}\n-\t\t\t\tcatch (PatternSyntaxException ex)\n-\t\t\t\t{\n-\t\t\t\t\treturn null;\n-\t\t\t\t}\n-\t\t\t})\n+\t\t\t.map(this::compilePattern)\n \t\t\t.filter(Objects::nonNull)\n \t\t\t.forEach(filteredPatterns::add);\n+\n+\t\tNEWLINE_SPLITTER.splitToList(config.filteredNames()).stream()\n+\t\t\t.map(this::compilePattern)\n+\t\t\t.filter(Objects::nonNull)\n+\t\t\t.forEach(filteredNamePatterns::add);\n+\t}\n+\n+\tprivate Pattern compilePattern(String pattern)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b43fdd5209f4a45370598eac8db96b43a2d3f7ee"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA3NDc4Ng==", "bodyText": "Re-use the censor message from plugin. (make it package-private and @VisibleForTesting)", "url": "https://github.com/runelite/runelite/pull/10944#discussion_r388074786", "createdAt": "2020-03-05T04:39:25Z", "author": {"login": "Nightfirecat"}, "path": "runelite-client/src/test/java/net/runelite/client/plugins/chatfilter/ChatFilterPluginTest.java", "diffHunk": "@@ -64,6 +69,8 @@\n \t@Inject\n \tprivate ChatFilterPlugin chatFilterPlugin;\n \n+\tprivate static final String CENSOR_MESSAGE_STRING = \"Hey, everyone, I just tried to say something very silly!\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b43fdd5209f4a45370598eac8db96b43a2d3f7ee"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4ae4e639fdc02e5e9bf59f35005cf8c3c70cd39", "author": {"user": {"login": "ThatGamerBlue", "name": null}}, "url": "https://github.com/runelite/runelite/commit/c4ae4e639fdc02e5e9bf59f35005cf8c3c70cd39", "committedDate": "2020-03-05T15:28:50Z", "message": "rlapi: MessageNode extends CacheableNode (but Node is close enough)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cc010af1ffff604759bf1d9385a63baf45f095e", "author": {"user": {"login": "ThatGamerBlue", "name": null}}, "url": "https://github.com/runelite/runelite/commit/6cc010af1ffff604759bf1d9385a63baf45f095e", "committedDate": "2020-03-05T16:58:52Z", "message": "chatfilter: add filtering by username"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4014, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}