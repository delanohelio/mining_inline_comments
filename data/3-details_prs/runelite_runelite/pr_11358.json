{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4MzA2NzI3", "number": 11358, "title": "client session manager: fix shutdown race deleting a null session", "bodyText": "Saw this as a good easy bug to fix to get introduced to runelite. Is this a good solution?\n#11354", "createdAt": "2020-04-24T03:21:06Z", "url": "https://github.com/runelite/runelite/pull/11358", "merged": true, "mergeCommit": {"oid": "db684c98d9554214844f6140457727e04efbfbc3"}, "closed": true, "closedAt": "2020-05-02T17:43:21Z", "author": {"login": "Doxterpepper"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcao4MvABqjMyNjc2NzM2OTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABca5g5XABqjMyNzEyNjA1MDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "088ac2004d6708a1a22c7a4dba0cdccbc1c1e7e3", "author": {"user": {"login": "Doxterpepper", "name": "Dock"}}, "url": "https://github.com/runelite/runelite/commit/088ac2004d6708a1a22c7a4dba0cdccbc1c1e7e3", "committedDate": "2020-04-24T03:17:24Z", "message": "Preventing ClientSessionManager from calling onClinetShutdown\nmultiple times."}, "afterCommit": {"oid": "ec994cbee037057423c008711c5b85ccfdf881ea", "author": {"user": {"login": "Doxterpepper", "name": "Dock"}}, "url": "https://github.com/runelite/runelite/commit/ec994cbee037057423c008711c5b85ccfdf881ea", "committedDate": "2020-04-24T03:25:15Z", "message": "Preventing ClientSessionManager from calling onClinetShutdown\nmultiple times."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec994cbee037057423c008711c5b85ccfdf881ea", "author": {"user": {"login": "Doxterpepper", "name": "Dock"}}, "url": "https://github.com/runelite/runelite/commit/ec994cbee037057423c008711c5b85ccfdf881ea", "committedDate": "2020-04-24T03:25:15Z", "message": "Preventing ClientSessionManager from calling onClinetShutdown\nmultiple times."}, "afterCommit": {"oid": "65f65e4b32058d7c03fe1dafff24d72ba268e81f", "author": {"user": {"login": "Doxterpepper", "name": "Dock"}}, "url": "https://github.com/runelite/runelite/commit/65f65e4b32058d7c03fe1dafff24d72ba268e81f", "committedDate": "2020-04-24T03:41:59Z", "message": "Preventing ClientSessionManager from calling onClinetShutdown\nmultiple times."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65f65e4b32058d7c03fe1dafff24d72ba268e81f", "author": {"user": {"login": "Doxterpepper", "name": "Dock"}}, "url": "https://github.com/runelite/runelite/commit/65f65e4b32058d7c03fe1dafff24d72ba268e81f", "committedDate": "2020-04-24T03:41:59Z", "message": "Preventing ClientSessionManager from calling onClinetShutdown\nmultiple times."}, "afterCommit": {"oid": "ea6a83bd7a9c3a6c353ec2afb442432529a8dd7b", "author": {"user": {"login": "Doxterpepper", "name": "Dock"}}, "url": "https://github.com/runelite/runelite/commit/ea6a83bd7a9c3a6c353ec2afb442432529a8dd7b", "committedDate": "2020-04-24T04:13:40Z", "message": "Keep from calling onClientShutdown with null sessionId\n\nCalling onClientShutdown twice will always have a null session ID and so\nwill throw a null pointer exception. Adding a check to the beginning of\nonClientShutdown to return early if sessionId is null."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMTIwMzk1", "url": "https://github.com/runelite/runelite/pull/11358#pullrequestreview-400120395", "createdAt": "2020-04-24T17:02:19Z", "commit": {"oid": "ea6a83bd7a9c3a6c353ec2afb442432529a8dd7b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNzowMjoyMFrOGLg6Kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNzowMjoyMFrOGLg6Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDcyNjY5OA==", "bodyText": "this null check should be down next to the delete call", "url": "https://github.com/runelite/runelite/pull/11358#discussion_r414726698", "createdAt": "2020-04-24T17:02:20Z", "author": {"login": "Adam-"}, "path": "runelite-client/src/main/java/net/runelite/client/ClientSessionManager.java", "diffHunk": "@@ -75,6 +75,11 @@ public void start()\n \t@Subscribe\r\n \tprivate void onClientShutdown(ClientShutdown e)\r\n \t{\r\n+\t\tif (sessionId == null)\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea6a83bd7a9c3a6c353ec2afb442432529a8dd7b"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea6a83bd7a9c3a6c353ec2afb442432529a8dd7b", "author": {"user": {"login": "Doxterpepper", "name": "Dock"}}, "url": "https://github.com/runelite/runelite/commit/ea6a83bd7a9c3a6c353ec2afb442432529a8dd7b", "committedDate": "2020-04-24T04:13:40Z", "message": "Keep from calling onClientShutdown with null sessionId\n\nCalling onClientShutdown twice will always have a null session ID and so\nwill throw a null pointer exception. Adding a check to the beginning of\nonClientShutdown to return early if sessionId is null."}, "afterCommit": {"oid": "14123c5e087ba3c91ff51916287b3cb18bc45516", "author": {"user": {"login": "Doxterpepper", "name": "Dock"}}, "url": "https://github.com/runelite/runelite/commit/14123c5e087ba3c91ff51916287b3cb18bc45516", "committedDate": "2020-04-24T17:13:35Z", "message": "Keep from calling onClientShutdown with null sessionId\n\nCalling onClientShutdown twice will always have a null session ID and so\nwill throw a null pointer exception. Adding a check to the beginning of\nonClientShutdown to return early if sessionId is null."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMTcyMzM2", "url": "https://github.com/runelite/runelite/pull/11358#pullrequestreview-400172336", "createdAt": "2020-04-24T18:19:14Z", "commit": {"oid": "14123c5e087ba3c91ff51916287b3cb18bc45516"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxODoxOToxNFrOGLjvsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxODoxOToxNFrOGLjvsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3MzE2OQ==", "bodyText": "There are potentially ~3 threads here (event, which comes in on EDT?), this thread, and the thread executing ping, so this is not thread safe. You should make a local reference to sessionId and then use that.", "url": "https://github.com/runelite/runelite/pull/11358#discussion_r414773169", "createdAt": "2020-04-24T18:19:14Z", "author": {"login": "Adam-"}, "path": "runelite-client/src/main/java/net/runelite/client/ClientSessionManager.java", "diffHunk": "@@ -81,7 +81,10 @@ private void onClientShutdown(ClientShutdown e)\n \t\t{\r\n \t\t\ttry\r\n \t\t\t{\r\n-\t\t\t\tsessionClient.delete(sessionId);\r\n+\t\t\t\tif (sessionId != null)\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14123c5e087ba3c91ff51916287b3cb18bc45516"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "14123c5e087ba3c91ff51916287b3cb18bc45516", "author": {"user": {"login": "Doxterpepper", "name": "Dock"}}, "url": "https://github.com/runelite/runelite/commit/14123c5e087ba3c91ff51916287b3cb18bc45516", "committedDate": "2020-04-24T17:13:35Z", "message": "Keep from calling onClientShutdown with null sessionId\n\nCalling onClientShutdown twice will always have a null session ID and so\nwill throw a null pointer exception. Adding a check to the beginning of\nonClientShutdown to return early if sessionId is null."}, "afterCommit": {"oid": "f85a49d4c2d141f823a2084f5fbc96fb97c3973a", "author": {"user": {"login": "Doxterpepper", "name": "Dock"}}, "url": "https://github.com/runelite/runelite/commit/f85a49d4c2d141f823a2084f5fbc96fb97c3973a", "committedDate": "2020-04-24T19:53:22Z", "message": "Keep from calling onClientShutdown with null sessionId\n\nCalling onClientShutdown twice will always have a null session ID and so\nwill throw a null pointer exception. Adding a check to the beginning of\nonClientShutdown to return early if sessionId is null."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMzExNTUw", "url": "https://github.com/runelite/runelite/pull/11358#pullrequestreview-400311550", "createdAt": "2020-04-24T22:46:49Z", "commit": {"oid": "f85a49d4c2d141f823a2084f5fbc96fb97c3973a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMjo0Njo0OVrOGLru9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMjo0Njo0OVrOGLru9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkwNDA1NA==", "bodyText": "this should be localUuid", "url": "https://github.com/runelite/runelite/pull/11358#discussion_r414904054", "createdAt": "2020-04-24T22:46:49Z", "author": {"login": "Adam-"}, "path": "runelite-client/src/main/java/net/runelite/client/ClientSessionManager.java", "diffHunk": "@@ -81,7 +81,11 @@ private void onClientShutdown(ClientShutdown e)\n \t\t{\r\n \t\t\ttry\r\n \t\t\t{\r\n-\t\t\t\tsessionClient.delete(sessionId);\r\n+\t\t\t\tUUID localUuid = sessionId;\r\n+\t\t\t\tif (localUuid != null)\r\n+\t\t\t\t{\r\n+\t\t\t\t\tsessionClient.delete(sessionId);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f85a49d4c2d141f823a2084f5fbc96fb97c3973a"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "498b720e4a6d75e0f5ed3de134bcb65418447bee", "author": {"user": {"login": "Doxterpepper", "name": "Dock"}}, "url": "https://github.com/runelite/runelite/commit/498b720e4a6d75e0f5ed3de134bcb65418447bee", "committedDate": "2020-04-24T22:48:33Z", "message": "Keep from calling onClientShutdown with null sessionId\n\nCalling onClientShutdown twice will always have a null session ID and so\nwill throw a null pointer exception. Adding a check to the beginning of\nonClientShutdown to return early if sessionId is null."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f85a49d4c2d141f823a2084f5fbc96fb97c3973a", "author": {"user": {"login": "Doxterpepper", "name": "Dock"}}, "url": "https://github.com/runelite/runelite/commit/f85a49d4c2d141f823a2084f5fbc96fb97c3973a", "committedDate": "2020-04-24T19:53:22Z", "message": "Keep from calling onClientShutdown with null sessionId\n\nCalling onClientShutdown twice will always have a null session ID and so\nwill throw a null pointer exception. Adding a check to the beginning of\nonClientShutdown to return early if sessionId is null."}, "afterCommit": {"oid": "498b720e4a6d75e0f5ed3de134bcb65418447bee", "author": {"user": {"login": "Doxterpepper", "name": "Dock"}}, "url": "https://github.com/runelite/runelite/commit/498b720e4a6d75e0f5ed3de134bcb65418447bee", "committedDate": "2020-04-24T22:48:33Z", "message": "Keep from calling onClientShutdown with null sessionId\n\nCalling onClientShutdown twice will always have a null session ID and so\nwill throw a null pointer exception. Adding a check to the beginning of\nonClientShutdown to return early if sessionId is null."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3930, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}