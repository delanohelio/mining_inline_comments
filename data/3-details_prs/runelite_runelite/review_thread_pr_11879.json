{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzMzczNDkx", "number": 11879, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoyNDoyNlrOEMJtgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwMzo1MTowMVrOEUQNWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTc3NDc1OnYy", "diffSide": "RIGHT", "path": "runelite-client/src/main/java/net/runelite/client/plugins/inventorygrid/InventoryGridOverlay.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoyNDoyNlrOGuGPmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoyNDoyNlrOGuGPmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk4OTk3OA==", "bodyText": "This will just throw a bunch of npes under normal operation.", "url": "https://github.com/runelite/runelite/pull/11879#discussion_r450989978", "createdAt": "2020-07-07T16:24:26Z", "author": {"login": "Adam-"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/inventorygrid/InventoryGridOverlay.java", "diffHunk": "@@ -130,6 +151,25 @@ else if (config.showGrid())\n \t\treturn null;\n \t}\n \n+\tprivate int getDraggedIndex(Widget inventoryWidget, Widget draggingWidget)\n+\t{\n+\t\tfor (int i = 0; i < INVENTORY_SIZE; i++)\n+\t\t{\n+\t\t\tif (inventoryWidget.getChild(i) == draggingWidget)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1451957f33b4ef4c2bb20b333e86486145705cc2"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTc4OTg5OnYy", "diffSide": "RIGHT", "path": "runelite-client/src/main/java/net/runelite/client/plugins/inventorygrid/InventoryGridOverlay.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjoyODoyOFrOGuGZWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwMzozMzoyOFrOG6bMgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MjQ3Mg==", "bodyText": "Widgets are safe to reference compare, not sure why you have removed this here?", "url": "https://github.com/runelite/runelite/pull/11879#discussion_r450992472", "createdAt": "2020-07-07T16:28:28Z", "author": {"login": "Adam-"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/inventorygrid/InventoryGridOverlay.java", "diffHunk": "@@ -72,10 +72,24 @@ private InventoryGridOverlay(InventoryGridConfig config, Client client, ItemMana\n \t@Override\n \tpublic Dimension render(Graphics2D graphics)\n \t{\n-\t\tfinal Widget if1DraggingWidget = client.getIf1DraggedWidget();\n-\t\tfinal Widget inventoryWidget = client.getWidget(WidgetInfo.INVENTORY);\n+\t\tWidget draggingWidget = client.getIf1DraggedWidget();\n+\t\tfinal int draggedItemIndex;\n+\t\tfinal Widget inventoryWidget;\n+\t\tfinal boolean dynamic = draggingWidget == null;\n \n-\t\tif (if1DraggingWidget == null || if1DraggingWidget != inventoryWidget)\n+\t\tif (dynamic)\n+\t\t{\n+\t\t\tinventoryWidget = client.getWidget(WidgetInfo.BANK_INVENTORY_ITEMS_CONTAINER);\n+\t\t\tdraggingWidget = client.getDraggedWidget();\n+\t\t\tdraggedItemIndex = getDraggedIndex(inventoryWidget, draggingWidget);\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tinventoryWidget = client.getWidget(WidgetInfo.INVENTORY);\n+\t\t\tdraggedItemIndex = client.getIf1DraggedItemIndex();\n+\t\t}\n+\n+\t\tif (draggingWidget == null || inventoryWidget == null || draggingWidget.getId() != inventoryWidget.getId())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1451957f33b4ef4c2bb20b333e86486145705cc2"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkxNDA1Mw==", "bodyText": "It seems the draggedWidget and inventoryWidget instances are not the same when getting the widget from client.getDraggedWidget()\nlog.info(\"{} {} {} {} {} {}\", dynamic, draggingWidget, inventoryWidget, draggingWidget.getId(), inventoryWidget.getId(), draggingWidget == inventoryWidget);\n\nfalse hd@6e685864 hd@6e685864 9764864 9764864 true\ntrue hd@12ba306b hd@50c028a2 983043 983043 false", "url": "https://github.com/runelite/runelite/pull/11879#discussion_r463914053", "createdAt": "2020-08-01T03:11:13Z", "author": {"login": "while-loop"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/inventorygrid/InventoryGridOverlay.java", "diffHunk": "@@ -72,10 +72,24 @@ private InventoryGridOverlay(InventoryGridConfig config, Client client, ItemMana\n \t@Override\n \tpublic Dimension render(Graphics2D graphics)\n \t{\n-\t\tfinal Widget if1DraggingWidget = client.getIf1DraggedWidget();\n-\t\tfinal Widget inventoryWidget = client.getWidget(WidgetInfo.INVENTORY);\n+\t\tWidget draggingWidget = client.getIf1DraggedWidget();\n+\t\tfinal int draggedItemIndex;\n+\t\tfinal Widget inventoryWidget;\n+\t\tfinal boolean dynamic = draggingWidget == null;\n \n-\t\tif (if1DraggingWidget == null || if1DraggingWidget != inventoryWidget)\n+\t\tif (dynamic)\n+\t\t{\n+\t\t\tinventoryWidget = client.getWidget(WidgetInfo.BANK_INVENTORY_ITEMS_CONTAINER);\n+\t\t\tdraggingWidget = client.getDraggedWidget();\n+\t\t\tdraggedItemIndex = getDraggedIndex(inventoryWidget, draggingWidget);\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tinventoryWidget = client.getWidget(WidgetInfo.INVENTORY);\n+\t\t\tdraggedItemIndex = client.getIf1DraggedItemIndex();\n+\t\t}\n+\n+\t\tif (draggingWidget == null || inventoryWidget == null || draggingWidget.getId() != inventoryWidget.getId())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MjQ3Mg=="}, "originalCommit": {"oid": "1451957f33b4ef4c2bb20b333e86486145705cc2"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkxNjE2Mg==", "bodyText": "Added comment explaining why we're not comparing references.", "url": "https://github.com/runelite/runelite/pull/11879#discussion_r463916162", "createdAt": "2020-08-01T03:33:28Z", "author": {"login": "while-loop"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/inventorygrid/InventoryGridOverlay.java", "diffHunk": "@@ -72,10 +72,24 @@ private InventoryGridOverlay(InventoryGridConfig config, Client client, ItemMana\n \t@Override\n \tpublic Dimension render(Graphics2D graphics)\n \t{\n-\t\tfinal Widget if1DraggingWidget = client.getIf1DraggedWidget();\n-\t\tfinal Widget inventoryWidget = client.getWidget(WidgetInfo.INVENTORY);\n+\t\tWidget draggingWidget = client.getIf1DraggedWidget();\n+\t\tfinal int draggedItemIndex;\n+\t\tfinal Widget inventoryWidget;\n+\t\tfinal boolean dynamic = draggingWidget == null;\n \n-\t\tif (if1DraggingWidget == null || if1DraggingWidget != inventoryWidget)\n+\t\tif (dynamic)\n+\t\t{\n+\t\t\tinventoryWidget = client.getWidget(WidgetInfo.BANK_INVENTORY_ITEMS_CONTAINER);\n+\t\t\tdraggingWidget = client.getDraggedWidget();\n+\t\t\tdraggedItemIndex = getDraggedIndex(inventoryWidget, draggingWidget);\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tinventoryWidget = client.getWidget(WidgetInfo.INVENTORY);\n+\t\t\tdraggedItemIndex = client.getIf1DraggedItemIndex();\n+\t\t}\n+\n+\t\tif (draggingWidget == null || inventoryWidget == null || draggingWidget.getId() != inventoryWidget.getId())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5MjQ3Mg=="}, "originalCommit": {"oid": "1451957f33b4ef4c2bb20b333e86486145705cc2"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTc5OTE3OnYy", "diffSide": "RIGHT", "path": "runelite-client/src/main/java/net/runelite/client/plugins/inventorygrid/InventoryGridOverlay.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjozMDo1MlrOGuGfWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjozMDo1MlrOGuGfWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk5NDAwOA==", "bodyText": "Im pretty sure this is just draggingWidget.getIndex()", "url": "https://github.com/runelite/runelite/pull/11879#discussion_r450994008", "createdAt": "2020-07-07T16:30:52Z", "author": {"login": "Adam-"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/inventorygrid/InventoryGridOverlay.java", "diffHunk": "@@ -72,10 +72,24 @@ private InventoryGridOverlay(InventoryGridConfig config, Client client, ItemMana\n \t@Override\n \tpublic Dimension render(Graphics2D graphics)\n \t{\n-\t\tfinal Widget if1DraggingWidget = client.getIf1DraggedWidget();\n-\t\tfinal Widget inventoryWidget = client.getWidget(WidgetInfo.INVENTORY);\n+\t\tWidget draggingWidget = client.getIf1DraggedWidget();\n+\t\tfinal int draggedItemIndex;\n+\t\tfinal Widget inventoryWidget;\n+\t\tfinal boolean dynamic = draggingWidget == null;\n \n-\t\tif (if1DraggingWidget == null || if1DraggingWidget != inventoryWidget)\n+\t\tif (dynamic)\n+\t\t{\n+\t\t\tinventoryWidget = client.getWidget(WidgetInfo.BANK_INVENTORY_ITEMS_CONTAINER);\n+\t\t\tdraggingWidget = client.getDraggedWidget();\n+\t\t\tdraggedItemIndex = getDraggedIndex(inventoryWidget, draggingWidget);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1451957f33b4ef4c2bb20b333e86486145705cc2"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NjcyNTMwOnYy", "diffSide": "RIGHT", "path": "runelite-client/src/main/java/net/runelite/client/plugins/inventorygrid/InventoryGridOverlay.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwMzo1MDo1MFrOG6bRfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwMzo1MDo1MFrOG6bRfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkxNzQzNg==", "bodyText": "private static WidgetItem getWidgetItem(Widget parentWidget, int idx)\n    {\n        if (parentWidget.isIf3())\n        {\n            Widget wi = parentWidget.getChild(idx);\n            return new WidgetItem(wi.getItemId(), wi.getItemQuantity(), -1, wi.getBounds(), parentWidget, null);\n        }\n        else\n        {\n            return parentWidget.getWidgetItem(idx);\n        }\n    }", "url": "https://github.com/runelite/runelite/pull/11879#discussion_r463917436", "createdAt": "2020-08-01T03:50:50Z", "author": {"login": "Adam-"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/inventorygrid/InventoryGridOverlay.java", "diffHunk": "@@ -130,6 +154,12 @@ else if (config.showGrid())\n \t\treturn null;\n \t}\n \n+\tprivate WidgetItem getWidgetItem(Widget parentWidget, int idx)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77d212e44e23acef9865d90dae7dc1ff01ac4634"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NjcyNTM4OnYy", "diffSide": "RIGHT", "path": "runelite-client/src/main/java/net/runelite/client/plugins/inventorygrid/InventoryGridOverlay.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwMzo1MTowMVrOG6bRhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwMzo1MTowMVrOG6bRhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkxNzQ0Ng==", "bodyText": "draggingWidget.isIf3() ? draggingWidget.getParent() != inventoryWidget : draggingWidget != inventoryWidget", "url": "https://github.com/runelite/runelite/pull/11879#discussion_r463917446", "createdAt": "2020-08-01T03:51:01Z", "author": {"login": "Adam-"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/inventorygrid/InventoryGridOverlay.java", "diffHunk": "@@ -72,10 +72,27 @@ private InventoryGridOverlay(InventoryGridConfig config, Client client, ItemMana\n \t@Override\n \tpublic Dimension render(Graphics2D graphics)\n \t{\n-\t\tfinal Widget if1DraggingWidget = client.getIf1DraggedWidget();\n-\t\tfinal Widget inventoryWidget = client.getWidget(WidgetInfo.INVENTORY);\n+\t\tWidget draggingWidget = client.getIf1DraggedWidget();\n+\t\tfinal int draggedItemIndex;\n+\t\tfinal Widget inventoryWidget;\n+\t\tfinal boolean isIf3 = draggingWidget == null;\n \n-\t\tif (if1DraggingWidget == null || if1DraggingWidget != inventoryWidget)\n+\t\tif (isIf3)\n+\t\t{\n+\t\t\tinventoryWidget = client.getWidget(WidgetInfo.BANK_INVENTORY_ITEMS_CONTAINER);\n+\t\t\tdraggingWidget = client.getDraggedWidget();\n+\t\t\tdraggedItemIndex = draggingWidget != null ? draggingWidget.getIndex() : -1;\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tinventoryWidget = client.getWidget(WidgetInfo.INVENTORY);\n+\t\t\tdraggedItemIndex = client.getIf1DraggedItemIndex();\n+\t\t}\n+\n+\t\t// Compare the widgets against their ID and not reference.\n+\t\t// When using `if1` widgets the dragging and inventory widgets instances are the same.\n+\t\t// When using `if3` widgets the widget instances are different, but share the same parent ID.\n+\t\tif (draggingWidget == null || inventoryWidget == null || draggingWidget.getId() != inventoryWidget.getId())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77d212e44e23acef9865d90dae7dc1ff01ac4634"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3503, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}