{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxMzYwNTI0", "number": 11660, "title": "banktags: save last opened tab when opening worn items", "bodyText": "Closes #10824. This request is in two parts.\nPart 1/Commit 1: Addressing the cited issue directly\nDiagnosing the problem, I found 3 behaviors:\n\nOpening the \"worn items\" doesn't change the hidden state of tab interface\nSaving the last tag tab happens on the tick\nSwitching from main bank interface to gear interface and back can be done on the same tick\n\nTherefore the issue is present in these two scenarios:\n\nYou click \"worn items\", a tick happens and you check for hidden: tabs are not hidden, so don't save the last tab; at this point the last tab is forgotten\nYou click \"worn items\" and quickly return to main screen before a tick happens: the hidden check doesn't even happen so there's no chance to save the last tab; last tab is forgotten\n\nMy proposed fix modifies the definition of the tabs hidden state, and moves the code to save the last tab outside of the tick-controlled function update and into its own function, controlled by onWidgetHiddenChanged.\nPart 2/Commit 2: Addressing a related issue found during my testing\nIndependent of the above work (i.e. reproducible on both master and my first commit), I found that in the following scenario, the saved tag tab gets overwritten:\nAfter selecting a bank tag tab, exit the bank, (log out) and fully close RL client. Relaunch RL, log in and open bank.\nMy proposed fix adds a boolean to make sure that the code responsible for the error in behavior cannot possibly be run until the bank has been opened once after RL startup. (Short reason: the variable activeTab is not properly assigned (instead it's null) until bank is opened once after startup, which breaks some of the logic. Only after that does the logic with activeTab work properly.)", "createdAt": "2020-05-21T13:45:04Z", "url": "https://github.com/runelite/runelite/pull/11660", "merged": true, "mergeCommit": {"oid": "3e7b9e169f48174f093560d4f9e15ed17fdb1ded"}, "closed": true, "closedAt": "2020-06-24T04:04:16Z", "author": {"login": "johannfrias"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckuwPkgBqjMzNjk5ODM1OTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqEkzLgH2gAyNDIxMzYwNTI0OmUxMzE5YTRiOGRjMzJjNDJmZmY0MmNlNTFlOWVkNmYxMGY0NWQ2NTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d3dfda75b983465ac5f295c448c18d38eb29dc9", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/9d3dfda75b983465ac5f295c448c18d38eb29dc9", "committedDate": "2020-05-21T12:42:06Z", "message": "banktags: not overwrite last opened tab on first login after startup\n\nGiven the circumstance that you exit the bank and save the last opened\ntab, close the client (not just log out), then launch the client and log\n in, current code overwrites the last saved tab after login. This\n solution adds a boolean that turns true and stays true only when the\n tab interface is, while not being hidden, initialized for the first\n time after client startup, i.e. when the bank is opened for the first\n time after client startup. The last saved tab should now keep its value\n  between client sessions."}, "afterCommit": {"oid": "34240bc23207e012b2a9b364efa50864547d15fc", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/34240bc23207e012b2a9b364efa50864547d15fc", "committedDate": "2020-05-25T11:43:47Z", "message": "banktags: fix render of incinerator when enabling it and staying in bank\n\nIndependent of all my previous commits (i.e. currently replicable in\nmaster), given the situation when you open the bank with incinerator\ndisabled, enable the incinerator, and return to the main bank interface,\n the incinerator image is rendered larger than normal (normal being when\n you open the bank with incinerator enabled). This commit removes the\n error and, given the same situation, renders the incinerator as normal."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "34240bc23207e012b2a9b364efa50864547d15fc", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/34240bc23207e012b2a9b364efa50864547d15fc", "committedDate": "2020-05-25T11:43:47Z", "message": "banktags: fix render of incinerator when enabling it and staying in bank\n\nIndependent of all my previous commits (i.e. currently replicable in\nmaster), given the situation when you open the bank with incinerator\ndisabled, enable the incinerator, and return to the main bank interface,\n the incinerator image is rendered larger than normal (normal being when\n you open the bank with incinerator enabled). This commit removes the\n error and, given the same situation, renders the incinerator as normal."}, "afterCommit": {"oid": "3f369395e1a35aee16f898f091e02744546413b8", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/3f369395e1a35aee16f898f091e02744546413b8", "committedDate": "2020-05-26T11:28:29Z", "message": "banktags: reassign trigger to recall tag tab when staying within bank\n\nAs per the suggestion, I changed the trigger that recalls the last tag\ntab when switching interfaces within the bank, from checking that the\nmain bank interface is not hidden, to checking that one of two buttons\nhas been clicked, \"Hide worn items\" and \"Hide menu\". This must use the\ninvokeLater method because clicking either button changes the state of\nisHidden but the client must complete that process before recalling the\nsaved tag tab. The behavior should remain the same as the last commit."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f369395e1a35aee16f898f091e02744546413b8", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/3f369395e1a35aee16f898f091e02744546413b8", "committedDate": "2020-05-26T11:28:29Z", "message": "banktags: reassign trigger to recall tag tab when staying within bank\n\nAs per the suggestion, I changed the trigger that recalls the last tag\ntab when switching interfaces within the bank, from checking that the\nmain bank interface is not hidden, to checking that one of two buttons\nhas been clicked, \"Hide worn items\" and \"Hide menu\". This must use the\ninvokeLater method because clicking either button changes the state of\nisHidden but the client must complete that process before recalling the\nsaved tag tab. The behavior should remain the same as the last commit."}, "afterCommit": {"oid": "4330f84cf098d5fc312d82a82c251482820293a2", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/4330f84cf098d5fc312d82a82c251482820293a2", "committedDate": "2020-05-26T11:49:57Z", "message": "banktags: reassign trigger to recall tag tab when staying within bank\n\nAs per the suggestion, I changed the trigger that recalls the last tag\ntab when switching interfaces within the bank, from checking that the\nmain bank interface is not hidden, to checking that one of two buttons\nhas been clicked, \"Hide worn items\" and \"Hide menu\". This must use the\ninvokeLater method because clicking either button changes the state of\nisHidden but the client must complete that process before recalling the\nsaved tag tab. The behavior should remain the same as the last commit."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4330f84cf098d5fc312d82a82c251482820293a2", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/4330f84cf098d5fc312d82a82c251482820293a2", "committedDate": "2020-05-26T11:49:57Z", "message": "banktags: reassign trigger to recall tag tab when staying within bank\n\nAs per the suggestion, I changed the trigger that recalls the last tag\ntab when switching interfaces within the bank, from checking that the\nmain bank interface is not hidden, to checking that one of two buttons\nhas been clicked, \"Hide worn items\" and \"Hide menu\". This must use the\ninvokeLater method because clicking either button changes the state of\nisHidden but the client must complete that process before recalling the\nsaved tag tab. The behavior should remain the same as the last commit."}, "afterCommit": {"oid": "d9e389deab94a333f888e83aab0e3be9249875a2", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/d9e389deab94a333f888e83aab0e3be9249875a2", "committedDate": "2020-05-30T01:44:58Z", "message": "banktags: save search when clicking buttons that show a new panel\n\nCo-authored-by: Ron Young <admin@ryoung.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d9e389deab94a333f888e83aab0e3be9249875a2", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/d9e389deab94a333f888e83aab0e3be9249875a2", "committedDate": "2020-05-30T01:44:58Z", "message": "banktags: save search when clicking buttons that show a new panel\n\nCo-authored-by: Ron Young <admin@ryoung.io>"}, "afterCommit": {"oid": "63fb3a34b7339459b99e52344f659d5c49090081", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/63fb3a34b7339459b99e52344f659d5c49090081", "committedDate": "2020-06-01T09:38:10Z", "message": "banktags: simplify actions upon clicking hide equipment or hide menu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "207c6f012ecf4f0fa13578e707fa4bed5b6fba51", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/207c6f012ecf4f0fa13578e707fa4bed5b6fba51", "committedDate": "2020-06-02T01:44:22Z", "message": "banktags: save last opened tab when opening worn items\n\nCurrent code overwrites the last opened tab when opening the worn items\ninterface within the bank. The change treats the worn items interface as\n a hidden state of the tabs and modifies the conditions under which the\n last opened tab is saved and recalled. Switching among any interface\n within the bank should remember the last opened tab normally."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "433355372d72befbd2fc8dc76cb0ea78e5bb3447", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/433355372d72befbd2fc8dc76cb0ea78e5bb3447", "committedDate": "2020-06-02T01:44:22Z", "message": "banktags: not overwrite last opened tab on first login after startup\n\nGiven the circumstance that you exit the bank and save the last opened\ntab, close the client (not just log out), then launch the client and log\n in, current code overwrites the last saved tab after login. This\n solution adds a boolean that turns true and stays true only when the\n tab interface is, while not being hidden, initialized for the first\n time after client startup, i.e. when the bank is opened for the first\n time after client startup. The last saved tab should now keep its value\n  between client sessions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c717dd0bb83b90683b103ef88614e080dce64392", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/c717dd0bb83b90683b103ef88614e080dce64392", "committedDate": "2020-06-02T01:44:22Z", "message": "banktags: reassign trigger to save tag tab when staying within bank\n\nAs per the suggestion, I changed the trigger that saves the last tag tab\n when switching interfaces within the bank, from checking that the main\nbank interface is hidden, to checking that one of two buttons has been\nclicked, \"Show worn items\" and \"Show menu\". I added new constants as\nnecessary and adjusted parts of the relevant logic. The logic to recall\nthe saved tag tab remains the same, barring further suggestions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c899b97613b740c83a0a8c177929af9a01d4d5b", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/7c899b97613b740c83a0a8c177929af9a01d4d5b", "committedDate": "2020-06-02T01:44:22Z", "message": "banktags: remove duplication of widgets when staying within bank\n\nFrom one of my previous commits, in the scenario where you start in the\nmain bank interface, click on either gear or settings, then return to\nmain bank interface, the code created duplicate widgets for upButton,\ndownButton, newTab and all tag tabs. This error was not visible unless\nyou right clicked on said widgets and found duplicate settings. The\nchange introduces an if block that differentiates the case of opening\nthe bank, and the case of switching among bank interfaces and returning\nto the main bank interface. This should get rid of duplicates without\nside effects."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ba0fc7158dd088e12ecae1b052298febff6d68e", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/4ba0fc7158dd088e12ecae1b052298febff6d68e", "committedDate": "2020-06-02T01:44:22Z", "message": "banktags: fix render of incinerator when enabling it and staying in bank\n\nIndependent of all my previous commits (i.e. currently replicable in\nmaster), given the situation when you open the bank with incinerator\ndisabled, enable the incinerator, and return to the main bank interface,\n the incinerator image is rendered larger than normal (normal being when\n you open the bank with incinerator enabled). This commit removes the\n error and, given the same situation, renders the incinerator as normal."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fe7ed6be95bf9b8662c75c72628e39f8cbab49b", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/8fe7ed6be95bf9b8662c75c72628e39f8cbab49b", "committedDate": "2020-06-02T01:44:22Z", "message": "banktags: edit trigger to save tag tab when staying within bank\n\nAdded a corner case of clicking on the bank tutorial button when a tag\ntab is selected to save tag tab."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90cf4c70a07fb6bc497074efcaed58b44676cdc9", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/90cf4c70a07fb6bc497074efcaed58b44676cdc9", "committedDate": "2020-06-02T01:44:23Z", "message": "banktags: reassign trigger to recall tag tab when staying within bank\n\nAs per the suggestion, I changed the trigger that recalls the last tag\ntab when switching interfaces within the bank, from checking that the\nmain bank interface is not hidden, to checking that one of two buttons\nhas been clicked, \"Hide worn items\" and \"Hide menu\". This must use the\ninvokeLater method because clicking either button changes the state of\nisHidden but the client must complete that process before recalling the\nsaved tag tab. The behavior should remain the same as the last commit."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bc1e867b5c8aedd7bea63919d44acf2e2d9b842", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/0bc1e867b5c8aedd7bea63919d44acf2e2d9b842", "committedDate": "2020-06-02T01:44:23Z", "message": "banktags: save search when clicking buttons that show a new panel\n\nCo-authored-by: Ron Young <admin@ryoung.io>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2ad40cf58fdded52c834ee159ccd70c3d8270ab", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/c2ad40cf58fdded52c834ee159ccd70c3d8270ab", "committedDate": "2020-06-02T01:44:23Z", "message": "banktags: simplify actions upon clicking hide equipment or hide menu"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e326f9028589ada6dc1d4807a03bb42238b3d85c", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/e326f9028589ada6dc1d4807a03bb42238b3d85c", "committedDate": "2020-06-02T01:44:23Z", "message": "banktags: search remembered search on panel close\n\nCo-authored-by: Ron Young <admin@ryoung.io>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63fb3a34b7339459b99e52344f659d5c49090081", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/63fb3a34b7339459b99e52344f659d5c49090081", "committedDate": "2020-06-01T09:38:10Z", "message": "banktags: simplify actions upon clicking hide equipment or hide menu"}, "afterCommit": {"oid": "e326f9028589ada6dc1d4807a03bb42238b3d85c", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/e326f9028589ada6dc1d4807a03bb42238b3d85c", "committedDate": "2020-06-02T01:44:23Z", "message": "banktags: search remembered search on panel close\n\nCo-authored-by: Ron Young <admin@ryoung.io>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNzQ5Njk2", "url": "https://github.com/runelite/runelite/pull/11660#pullrequestreview-422749696", "createdAt": "2020-06-02T14:42:06Z", "commit": {"oid": "e326f9028589ada6dc1d4807a03bb42238b3d85c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNDo0MjowNlrOGd1BAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNDo0Mjo0OFrOGd1DFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkzMDQ5Ng==", "bodyText": "remove this", "url": "https://github.com/runelite/runelite/pull/11660#discussion_r433930496", "createdAt": "2020-06-02T14:42:06Z", "author": {"login": "raiyni"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/banktags/tabs/TabInterface.java", "diffHunk": "@@ -150,6 +155,7 @@\n \tprivate Instant startScroll = Instant.now();\n \tprivate String rememberedSearch;\n \tprivate boolean waitSearchTick;\n+\tprivate boolean initializedOnce;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e326f9028589ada6dc1d4807a03bb42238b3d85c"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkzMDU2Nw==", "bodyText": "remove this", "url": "https://github.com/runelite/runelite/pull/11660#discussion_r433930567", "createdAt": "2020-06-02T14:42:12Z", "author": {"login": "raiyni"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/banktags/tabs/TabInterface.java", "diffHunk": "@@ -202,6 +208,7 @@ public void init()\n \n \t\tcurrentTabIndex = config.position();\n \t\tparent = client.getWidget(WidgetInfo.BANK_CONTENT_CONTAINER);\n+\t\tinitializedOnce = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e326f9028589ada6dc1d4807a03bb42238b3d85c"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkzMTAzMQ==", "bodyText": "remove this", "url": "https://github.com/runelite/runelite/pull/11660#discussion_r433931031", "createdAt": "2020-06-02T14:42:48Z", "author": {"login": "raiyni"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/banktags/tabs/TabInterface.java", "diffHunk": "@@ -1092,6 +1123,7 @@ private void updateBounds()\n \t\t\tchild.setType(WidgetType.GRAPHIC);\n \t\t\tchild.setSpriteId(TabSprites.INCINERATOR.getSpriteId());\n \t\t\tincinerator.revalidate();\n+\t\t\tchild.revalidate();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e326f9028589ada6dc1d4807a03bb42238b3d85c"}, "originalPosition": 131}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67278cfed970e2b3ae6f86eb5d2e07d0582e27fe", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/67278cfed970e2b3ae6f86eb5d2e07d0582e27fe", "committedDate": "2020-06-03T01:28:19Z", "message": "banktags: apply suggested changes, including revert 4333553 4ba0fc7"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzcwMDU1", "url": "https://github.com/runelite/runelite/pull/11660#pullrequestreview-425770055", "createdAt": "2020-06-06T21:24:43Z", "commit": {"oid": "67278cfed970e2b3ae6f86eb5d2e07d0582e27fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQyMToyNDo0M1rOGgFvxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQyMToyNDo0M1rOGgFvxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMwMTc2Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tpublic void saveTab()\n          \n          \n            \n            \tprivate void saveTab()", "url": "https://github.com/runelite/runelite/pull/11660#discussion_r436301766", "createdAt": "2020-06-06T21:24:43Z", "author": {"login": "Adam-"}, "path": "runelite-client/src/main/java/net/runelite/client/plugins/banktags/tabs/TabInterface.java", "diffHunk": "@@ -578,6 +567,32 @@ else if (waitSearchTick)\n \t\tscrollTab(0);\n \t}\n \n+\tpublic void saveTab()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67278cfed970e2b3ae6f86eb5d2e07d0582e27fe"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzgwMDUw", "url": "https://github.com/runelite/runelite/pull/11660#pullrequestreview-425780050", "createdAt": "2020-06-07T01:23:52Z", "commit": {"oid": "67278cfed970e2b3ae6f86eb5d2e07d0582e27fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1319a4b8dc32c42fff42ce51e9ed6f10f45d656", "author": {"user": {"login": "johannfrias", "name": null}}, "url": "https://github.com/runelite/runelite/commit/e1319a4b8dc32c42fff42ce51e9ed6f10f45d656", "committedDate": "2020-06-11T02:10:43Z", "message": "banktags: update method modifier\n\nCo-authored-by: Adam <adam@sigterm.info>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3800, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}