{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0MjUxOTAz", "number": 2600, "title": "Ensure default permissions are used with some wrapped subjects", "bodyText": "See #2599\nThe reason I make this a PR at first is to:\na) make sure I'm not accidently causing a big security hole; and\nb) talk about the notion of a default permission in the API.\nAs you can see in the diff, I have the following:\nif (target instanceof SubjectBridge) {\n    return ((SubjectBridge) target).bridge$permDefault(permission).asBoolean();\n}\n\nWould it be better to graduate bridge$permDefault(permission) to the API Subject interface (as defaultPermission) so that we don't need to check if the object is of type SubjectBridge and allow third-party Subjects (e.g. ProxySources) to have their own defaults, and make hasPermission(...) check defaultPermision(...) if the value is undefined?\nSuch an API change shouldn't affect permission plugins.\n(Note, I'm willing to pull this whenever, even if we decide to put defaults into the API, it's just a thought I had)\n@clienthax please test this - it worked for me but I'd like to make sure it works for you too.", "createdAt": "2020-05-06T18:09:47Z", "url": "https://github.com/SpongePowered/Sponge/pull/2600", "merged": true, "mergeCommit": {"oid": "c18043b5480b5cbad6401164d67a92957b32ed8b"}, "closed": true, "closedAt": "2020-05-08T12:08:12Z", "author": {"login": "dualspiral"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceso-FgH2gAyNDE0MjUxOTAzOmM4OGMwMGRkNWQ2OGEzMzhhNTVjMDdlZTM0ZjRlNzA5OGQ1Y2RkMmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcetpUQAH2gAyNDE0MjUxOTAzOmNlNzQwMDgzNmYxZGMwMzBmN2Y5Zjg0NTgzOTU0YWI5ZGY1ZjFlMzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c88c00dd5d68a338a55c07ee34f4e7098d5cdd2a", "author": {"user": {"login": "dualspiral", "name": "Daniel Naylor"}}, "url": "https://github.com/SpongePowered/Sponge/commit/c88c00dd5d68a338a55c07ee34f4e7098d5cdd2a", "committedDate": "2020-05-06T18:04:23Z", "message": "Ensure default permissions are used with some wrapped subjects\n\nFixes #2599"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2ODY3OTUy", "url": "https://github.com/SpongePowered/Sponge/pull/2600#pullrequestreview-406867952", "createdAt": "2020-05-06T18:13:58Z", "commit": {"oid": "c88c00dd5d68a338a55c07ee34f4e7098d5cdd2a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxODoxMzo1OVrOGRfc3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxODoxMzo1OVrOGRfc3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk5NDI3MQ==", "bodyText": "Point of discussion: I feel like maybe I don't need to, or worse, shouldn't check for this. A ProxySource might define its own hasPermission et. al. checks - we just know SpongeProxySource doesn't. Does it make sense to remove this?", "url": "https://github.com/SpongePowered/Sponge/pull/2600#discussion_r420994271", "createdAt": "2020-05-06T18:13:59Z", "author": {"login": "dualspiral"}, "path": "src/main/java/org/spongepowered/common/command/AndPermissionLevelSubject.java", "diffHunk": "@@ -93,4 +96,24 @@ public SubjectData getSubjectData() {\n     public MemorySubjectData getTransientSubjectData() {\n         return this.opLevelData;\n     }\n+\n+    @Override\n+    public boolean hasPermission(Set<Context> contexts, String permission) {\n+        final Tristate value = getPermissionValue(contexts, permission);\n+        if (value == Tristate.UNDEFINED) {\n+            Subject target = this.delegate;\n+            while (target instanceof ProxySource) {\n+                if (target instanceof SpongeProxySource) {\n+                    target = ((SpongeProxySource) target).getSubjectDelegate();\n+                } else {\n+                    target = ((ProxySource) target).getOriginalSource();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c88c00dd5d68a338a55c07ee34f4e7098d5cdd2a"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce7400836f1dc030f7f9f84583954ab9df5f1e30", "author": {"user": {"login": "dualspiral", "name": "Daniel Naylor"}}, "url": "https://github.com/SpongePowered/Sponge/commit/ce7400836f1dc030f7f9f84583954ab9df5f1e30", "committedDate": "2020-05-06T19:14:40Z", "message": "Yep, gonna go with this..."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 896, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}