{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMjIxMDc0", "number": 3166, "title": "Add SpongeImplHook for entity reach distance (#2513)", "bodyText": "What title says.\nAlso fixes MC-107103 by removing eye sight check in interaction packet handler.", "createdAt": "2020-09-21T11:18:38Z", "url": "https://github.com/SpongePowered/Sponge/pull/3166", "merged": true, "mergeCommit": {"oid": "93573d687d6094f6d9466942450716f1847e6f3f"}, "closed": true, "closedAt": "2020-09-24T04:38:26Z", "author": {"login": "PolyacovYury"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLBbmLgH2gAyNDkwMjIxMDc0OmIzOWI5NjBkMTM0OWI0OWNjNGIxNGYxOTI1YzNkNGIyNmU4ZmRhYTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdL5m7vgFqTQ5NTIxMzQ0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b39b960d1349b49cc4b14f1925c3d4b26e8fdaa3", "author": {"user": {"login": "PolyacovYury", "name": null}}, "url": "https://github.com/SpongePowered/Sponge/commit/b39b960d1349b49cc4b14f1925c3d4b26e8fdaa3", "committedDate": "2020-09-21T11:10:27Z", "message": "Add SpongeImplHook for entity reach distance (#2513)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODA5Mjcw", "url": "https://github.com/SpongePowered/Sponge/pull/3166#pullrequestreview-492809270", "createdAt": "2020-09-21T16:58:03Z", "commit": {"oid": "b39b960d1349b49cc4b14f1925c3d4b26e8fdaa3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjo1ODowM1rOHVaJhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjo1ODowM1rOHVaJhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIxMDU2Ng==", "bodyText": "I'm actually not really sure about \"adding (removing)\" this straight up. It feels to me that this was intended to work as a way to ensure \"line of sight\" for an interaction. The removal of this check means that I could, in theory, reach though a few blocks to interact with a switch on the other side, when I don't think that's intended.\nI don't think this \"fix\" is correct and that the real bug is client side. I can see hack clients possibly making use of this to activate things though walls and such.", "url": "https://github.com/SpongePowered/Sponge/pull/3166#discussion_r492210566", "createdAt": "2020-09-21T16:58:03Z", "author": {"login": "dualspiral"}, "path": "src/main/java/org/spongepowered/common/mixin/core/network/NetHandlerPlayServerMixin.java", "diffHunk": "@@ -811,12 +811,16 @@ public void processUseEntity(final CPacketUseEntity packetIn) {\n         this.player.markPlayerActive();\n \n         if (entity != null) {\n-            final boolean flag = this.player.canEntityBeSeen(entity);\n-            double d0 = 36.0D; // 6 blocks\n-\n-            if (!flag) {\n-                d0 = 9.0D; // 1.5 blocks\n-            }\n+            // Sponge start - flag is not necessary, see below\n+            // final boolean flag = this.player.canEntityBeSeen(entity);\n+            // compatibility with Forge reachDistance attribute\n+            double d0 = SpongeImplHooks.getEntityReachDistanceSq(this.player);\n+\n+            // this check introduces MC-107103", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b39b960d1349b49cc4b14f1925c3d4b26e8fdaa3"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODIxMDQx", "url": "https://github.com/SpongePowered/Sponge/pull/3166#pullrequestreview-492821041", "createdAt": "2020-09-21T17:13:47Z", "commit": {"oid": "b39b960d1349b49cc4b14f1925c3d4b26e8fdaa3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoxMzo0N1rOHVas1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzoxMzo0N1rOHVas1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIxOTYwNg==", "bodyText": "So I went ahead and looked at the Forge patch for this class and this is not one of the changes they make, d0 = 36.0D here is left alone. Why should we change the behaviour away from Forge here?", "url": "https://github.com/SpongePowered/Sponge/pull/3166#discussion_r492219606", "createdAt": "2020-09-21T17:13:47Z", "author": {"login": "dualspiral"}, "path": "src/main/java/org/spongepowered/common/mixin/core/network/NetHandlerPlayServerMixin.java", "diffHunk": "@@ -811,12 +811,16 @@ public void processUseEntity(final CPacketUseEntity packetIn) {\n         this.player.markPlayerActive();\n \n         if (entity != null) {\n-            final boolean flag = this.player.canEntityBeSeen(entity);\n-            double d0 = 36.0D; // 6 blocks\n-\n-            if (!flag) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b39b960d1349b49cc4b14f1925c3d4b26e8fdaa3"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb008292fa92becb990ba381db9d27bbb67a0abb", "author": {"user": {"login": "PolyacovYury", "name": null}}, "url": "https://github.com/SpongePowered/Sponge/commit/fb008292fa92becb990ba381db9d27bbb67a0abb", "committedDate": "2020-09-22T13:01:24Z", "message": "Don't fix vanilla issue in a PR that isn't aimed at a vanilla issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzNjQxMTIw", "url": "https://github.com/SpongePowered/Sponge/pull/3166#pullrequestreview-493641120", "createdAt": "2020-09-22T16:25:46Z", "commit": {"oid": "fb008292fa92becb990ba381db9d27bbb67a0abb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNjoyNTo0N1rOHWChSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNjoyNTo0N1rOHWChSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg3MjAxMA==", "bodyText": "Can you just javadoc the method for the reasoning why it's a spongeimplhook (aside from the place that it's used) since in a SpongeVanilla workspace, this won't make much sense as to why it exists if not for SpongeForge ;)", "url": "https://github.com/SpongePowered/Sponge/pull/3166#discussion_r492872010", "createdAt": "2020-09-22T16:25:47Z", "author": {"login": "gabizou"}, "path": "src/main/java/org/spongepowered/common/SpongeImplHooks.java", "diffHunk": "@@ -176,6 +176,14 @@ public static double getBlockReachDistance(final EntityPlayerMP player) {\n         return 5.0d;\n     }\n \n+    public static double getEntityReachDistanceSq(final EntityPlayerMP player, Entity entity) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb008292fa92becb990ba381db9d27bbb67a0abb"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30a7923a59a050430a06b0db0c67098da5f206fa", "author": {"user": {"login": "PolyacovYury", "name": null}}, "url": "https://github.com/SpongePowered/Sponge/commit/30a7923a59a050430a06b0db0c67098da5f206fa", "committedDate": "2020-09-22T18:50:19Z", "message": "add javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MjEzNDQ4", "url": "https://github.com/SpongePowered/Sponge/pull/3166#pullrequestreview-495213448", "createdAt": "2020-09-24T04:37:31Z", "commit": {"oid": "30a7923a59a050430a06b0db0c67098da5f206fa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 746, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}