{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNDI4ODUw", "number": 3167, "title": "Add max-chunk-lifetime setting used by chunk gc", "bodyText": "mostly useful for those who need to disable full auto-saves controlled by auto-save-interval\nspreads out server load induced by chunk saving\nallows to periodically save chunks kept active by players for a long time\n\nAs I said in Discord:\nIf I only use chunk GC and set auto-save-interval to 0, then if a player stays afk in the same place for hours - chunks around them would never be saved, and if the server crashes - everything will be rolled back.\nThe reason why I want to turn auto-save off is - when it happens, the server completely stops processing anything for up to 10 seconds, since it usually needs to save up to 5k chunks, sometimes even up to 10k.\n        # The auto-save tick interval used to save all loaded chunks in a world.\n        # Set to 0 to disable. (Default: 900)\n        # Note: 20 ticks is equivalent to 1 second.\n        auto-save-interval=12000\n\n[08:20:26] [Server thread/WARN] [minecraft/MinecraftServer]: Can't keep up! Did the system time change, or is the server overloaded? Running 4570ms behind, skipping 91 tick(s) \n[08:30:30] [Server thread/WARN] [minecraft/MinecraftServer]: Can't keep up! Did the system time change, or is the server overloaded? Running 6581ms behind, skipping 131 tick(s) \n\nI'd like to propose a setting for chunk GC. Something like max-chunk-lifetime. So, if a chunk has been loaded for e.g. 5 minutes, it gets saved to disk by the chunk GC code, even if it is still queried by a player.\nThis way the chunks wouldn't be saved all at once, but they will still get saved regularly.", "createdAt": "2020-09-21T16:45:59Z", "url": "https://github.com/SpongePowered/Sponge/pull/3167", "merged": true, "mergeCommit": {"oid": "3e9590a1a9b628d2d0fbfb1930c4ac077b68c316"}, "closed": true, "closedAt": "2020-11-15T00:03:19Z", "author": {"login": "PolyacovYury"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLGLgYAH2gAyNDkwNDI4ODUwOmQyYTNmZjZkZGQwZjRmZWNkNGFlMmEzZTMzODk4YTk1NTcxMGE3MTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLGjZrAH2gAyNDkwNDI4ODUwOjAwOTZlNjA5MDIxNzMxNDdhNzk3ZWVlOGM2YjYzNjNjODRmYTAzY2E=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d2a3ff6ddd0f4fecd4ae2a3e33898a955710a715", "author": {"user": {"login": "PolyacovYury", "name": null}}, "url": "https://github.com/SpongePowered/Sponge/commit/d2a3ff6ddd0f4fecd4ae2a3e33898a955710a715", "committedDate": "2020-09-21T16:42:24Z", "message": "Add max-chunk-lifetime setting used by chunk gc\n- mostly useful for those who need to disable full auto-saves controlled by auto-save-interval\n- spreads out server load induced by chunk saving\n- allows to periodically save chunks kept active by players for a long time"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODAxNTE2", "url": "https://github.com/SpongePowered/Sponge/pull/3167#pullrequestreview-492801516", "createdAt": "2020-09-21T16:47:52Z", "commit": {"oid": "d2a3ff6ddd0f4fecd4ae2a3e33898a955710a715"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjo0Nzo1MlrOHVZycw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjo0Nzo1MlrOHVZycw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwNDY1OQ==", "bodyText": "bridge$isChunkDirty", "url": "https://github.com/SpongePowered/Sponge/pull/3167#discussion_r492204659", "createdAt": "2020-09-21T16:47:52Z", "author": {"login": "Zidane"}, "path": "src/main/java/org/spongepowered/common/bridge/world/chunk/ChunkBridge.java", "diffHunk": "@@ -106,6 +106,10 @@\n \n     boolean bridge$isQueuedForUnload();\n \n+    long bridge$getLastSaveTime();\n+\n+    boolean bridge$getChunkDirty();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2a3ff6ddd0f4fecd4ae2a3e33898a955710a715"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODAxNzEz", "url": "https://github.com/SpongePowered/Sponge/pull/3167#pullrequestreview-492801713", "createdAt": "2020-09-21T16:48:08Z", "commit": {"oid": "d2a3ff6ddd0f4fecd4ae2a3e33898a955710a715"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjo0ODowOFrOHVZy_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjo0ODowOFrOHVZy_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwNDc5OQ==", "bodyText": "Formatting", "url": "https://github.com/SpongePowered/Sponge/pull/3167#discussion_r492204799", "createdAt": "2020-09-21T16:48:08Z", "author": {"login": "Zidane"}, "path": "src/main/java/org/spongepowered/common/mixin/core/world/chunk/ChunkMixin.java", "diffHunk": "@@ -155,11 +156,23 @@\n         this.dirty = true;\n     }\n \n+    @Override\n+    public boolean bridge$getChunkDirty()\n+    {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2a3ff6ddd0f4fecd4ae2a3e33898a955710a715"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0096e60902173147a797eee8c6b6363c84fa03ca", "author": {"user": {"login": "PolyacovYury", "name": null}}, "url": "https://github.com/SpongePowered/Sponge/commit/0096e60902173147a797eee8c6b6363c84fa03ca", "committedDate": "2020-09-21T17:08:30Z", "message": "getChunkDirty => isChunkDirty, consistent formatting"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 748, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}