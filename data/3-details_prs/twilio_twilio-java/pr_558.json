{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1NzM1NTg3", "number": 558, "title": "fix: encode path parameters", "bodyText": "This PR is intended to be a more robust solution to the URL encoding bug found in #557", "createdAt": "2020-07-07T22:41:52Z", "url": "https://github.com/twilio/twilio-java/pull/558", "merged": true, "mergeCommit": {"oid": "965c0bff1f267d10974e895287c9b2c78b4c1d6f"}, "closed": true, "closedAt": "2020-07-09T17:58:45Z", "author": {"login": "eshanholtz"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcytuxvgH2gAyNDQ1NzM1NTg3OjI2NDA0Zjc4NDJmZjU5Yjk4MzQwY2UzOTQ5M2FhYjNmOThmZmYzYzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczP7SMgFqTQ0NTY2NjI2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "26404f7842ff59b98340ce39493aab3f98fff3c4", "author": {"user": {"login": "eshanholtz", "name": "Elise Shanholtz"}}, "url": "https://github.com/twilio/twilio-java/commit/26404f7842ff59b98340ce39493aab3f98fff3c4", "committedDate": "2020-07-07T22:39:07Z", "message": "fix: encode path parameters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MzM1Mjcz", "url": "https://github.com/twilio/twilio-java/pull/558#pullrequestreview-444335273", "createdAt": "2020-07-08T00:26:49Z", "commit": {"oid": "26404f7842ff59b98340ce39493aab3f98fff3c4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMDoyNjo0OVrOGuUAXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMDoyNzozNVrOGuUBOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIxNTQ1Mg==", "bodyText": "Why is this case called out separately, when the above code on line 39 checks for all values >=2? Should we call both functions if expectedParts.length == 3?", "url": "https://github.com/twilio/twilio-java/pull/558#discussion_r451215452", "createdAt": "2020-07-08T00:26:49Z", "author": {"login": "thinkingserious"}, "path": "src/test/java/com/twilio/Assert.java", "diffHunk": "@@ -30,15 +30,18 @@ public static void assertUrlsEqual(final String expected, final URL actual) {\n     }\n \n     public static void assertUrlsEqual(final String expected, final String actual) {\n-        String[] expectedParts = expected.split(\"\\\\?\");\n-        String[] actualParts = actual.split(\"\\\\?\");\n+        String[] expectedParts = expected.split(\"[?#]\");\n+        String[] actualParts = actual.split(\"[?#]\");\n \n         assertEquals(expectedParts.length, actualParts.length);\n         assertEquals(expectedParts[0], actualParts[0]);\n \n-        if (expectedParts.length == 2) {\n+        if (expectedParts.length >= 2) {\n             assertQueryStringsEqual(expectedParts[1], actualParts[1]);\n         }\n+        if (expectedParts.length == 3) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26404f7842ff59b98340ce39493aab3f98fff3c4"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIxNTY3NA==", "bodyText": "Should we keep the old test, and also add this one? (testing with and without #bar in the URL)", "url": "https://github.com/twilio/twilio-java/pull/558#discussion_r451215674", "createdAt": "2020-07-08T00:27:35Z", "author": {"login": "thinkingserious"}, "path": "src/test/java/com/twilio/http/RequestTest.java", "diffHunk": "@@ -196,13 +205,13 @@ public void testRegionAndEdgeInUrl() throws MalformedURLException {\n     }\n \n     @Test\n-    public void testRegionInConstructor() throws MalformedURLException {\n-        final Request request = new Request(HttpMethod.GET, Domains.ACCOUNTS.toString(), \"/path/to/something.json?foo=12.34\", \"region\");\n+    public void testRegionInConstructor() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26404f7842ff59b98340ce39493aab3f98fff3c4"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c48185b3721ead18655dd3995d33b06775c67f5", "author": {"user": {"login": "eshanholtz", "name": "Elise Shanholtz"}}, "url": "https://github.com/twilio/twilio-java/commit/0c48185b3721ead18655dd3995d33b06775c67f5", "committedDate": "2020-07-08T22:43:25Z", "message": "Merge branch 'master' into encode"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MjIxMjYx", "url": "https://github.com/twilio/twilio-java/pull/558#pullrequestreview-445221261", "createdAt": "2020-07-09T00:54:46Z", "commit": {"oid": "0c48185b3721ead18655dd3995d33b06775c67f5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NjY2MjY4", "url": "https://github.com/twilio/twilio-java/pull/558#pullrequestreview-445666268", "createdAt": "2020-07-09T14:22:37Z", "commit": {"oid": "0c48185b3721ead18655dd3995d33b06775c67f5"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDoyMjozN1rOGvTfIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDoyOToxNVrOGvTxaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI1NTUyMw==", "bodyText": "\ud83c\udf89", "url": "https://github.com/twilio/twilio-java/pull/558#discussion_r452255523", "createdAt": "2020-07-09T14:22:37Z", "author": {"login": "childish-sambino"}, "path": "src/main/java/com/twilio/http/Request.java", "diffHunk": "@@ -167,15 +169,14 @@ private String buildURL() {\n                 if (targetEdge != null && targetRegion == null)\n                     targetRegion = DEFAULT_REGION;\n \n-                final String host = joinIgnoreNull(\".\", product, targetEdge, targetRegion, domain);\n-\n-                return new URL(parsedUrl.getProtocol(), host, parsedUrl.getPort(), parsedUrl.getFile()).toString();\n-            } catch (final MalformedURLException e) {\n-                throw new ApiException(\"Bad URL: \" + url, e);\n+                host = joinIgnoreNull(\".\", product, targetEdge, targetRegion, domain);\n             }\n-        }\n \n-        return url;\n+            return new URI(parsedUrl.getProtocol(), parsedUrl.getUserInfo(), host, parsedUrl.getPort(),\n+                    parsedUrl.getPath(), parsedUrl.getQuery(), parsedUrl.getRef()).toURL().toString();\n+        } catch (final MalformedURLException | URISyntaxException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c48185b3721ead18655dd3995d33b06775c67f5"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI2MDIwMw==", "bodyText": "It's a legitimate concern. Like, what if things only work when both query params and fragments are used but fail when it's just one or the other. Not saying it doesn't work in those cases, but someone later may refactor the logic where it does in fact not work properly, but this test would still pass.\nBut, yes, in general, I'm against more test code that can be reduced. Test code is just like source code: it needs to be maintained.", "url": "https://github.com/twilio/twilio-java/pull/558#discussion_r452260203", "createdAt": "2020-07-09T14:29:15Z", "author": {"login": "childish-sambino"}, "path": "src/test/java/com/twilio/http/RequestTest.java", "diffHunk": "@@ -196,13 +205,13 @@ public void testRegionAndEdgeInUrl() throws MalformedURLException {\n     }\n \n     @Test\n-    public void testRegionInConstructor() throws MalformedURLException {\n-        final Request request = new Request(HttpMethod.GET, Domains.ACCOUNTS.toString(), \"/path/to/something.json?foo=12.34\", \"region\");\n+    public void testRegionInConstructor() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIxNTY3NA=="}, "originalCommit": {"oid": "26404f7842ff59b98340ce39493aab3f98fff3c4"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3125, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}