{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MDYxOTk0", "number": 606, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODozNzozNFrOE83zaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMToxMzo1MFrOE-6Ifw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjY0Mjk3OnYy", "diffSide": "RIGHT", "path": "README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODozNzozNFrOH5QNLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODozNzozNFrOH5QNLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc5NjM5OQ==", "bodyText": "I prefer the format \"path/to/log4j2.xml\" in situations like these", "url": "https://github.com/twilio/twilio-java/pull/606#discussion_r529796399", "createdAt": "2020-11-24T18:37:34Z", "author": {"login": "eshanholtz"}, "path": "README.md", "diffHunk": "@@ -92,6 +92,13 @@ Twilio.setEdge(\"sydney\");\n \n This will result in the `hostname` transforming from `api.twilio.com` to `api.sydney.au1.twilio.com`.\n \n+### Enable Debug Logging\n+In order to enable debug logging, create a configuration file named log4j2.xml that defines the logger at the root level to at least 'debug'. An example of the configuration file can be found [here](src/main/java/com/twilio/example/log4j2.xml). For more configuration options please see the log4j configuration [documentation](https://logging.apache.org/log4j/2.x/manual/configuration.html).\n+```java\n+Twilio.init(accountSid, authToken);\n+Twilio.setLoggerConfiguration(\"path_to_log4j2.xml\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f73a300fd46612bc367670a99b9cd304d3083bc7"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjY1MDEwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/twilio/Twilio.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODozOTozMlrOH5QReA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODozOTozMlrOH5QReA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc5NzQ5Ng==", "bodyText": "nit: can we make the input variable name a smidge more specific. Maybe filePath?", "url": "https://github.com/twilio/twilio-java/pull/606#discussion_r529797496", "createdAt": "2020-11-24T18:39:32Z", "author": {"login": "eshanholtz"}, "path": "src/main/java/com/twilio/Twilio.java", "diffHunk": "@@ -150,6 +154,17 @@ public static synchronized void setEdge(final String edge) {\n         Twilio.edge = edge;\n     }\n \n+    /**\n+     * Set the logger configuration file path.\n+     *\n+     * @param path path to logging configuration file\n+     */\n+    public static synchronized void setLoggerConfiguration(final String path) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f73a300fd46612bc367670a99b9cd304d3083bc7"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjY1ODg4OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/twilio/http/TwilioRestClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODo0MTozNFrOH5QWtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxOToxOTo1OFrOH5RtEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc5ODgzNw==", "bodyText": "What happens if there's no logger configured?", "url": "https://github.com/twilio/twilio-java/pull/606#discussion_r529798837", "createdAt": "2020-11-24T18:41:34Z", "author": {"login": "eshanholtz"}, "path": "src/main/java/com/twilio/http/TwilioRestClient.java", "diffHunk": "@@ -50,7 +57,16 @@ public Response request(final Request request) {\n         if (edge != null)\n             request.setEdge(edge);\n \n-        return httpClient.reliableRequest(request);\n+        logRequest(request);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f73a300fd46612bc367670a99b9cd304d3083bc7"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTgyMDk0NQ==", "bodyText": "If no logger configuration is provided log4j uses a default logging configuration that sets ERROR as the logging level displayed to the console. No logging output will be shown since nothing in the library is using log4j to log anything and DEBUG is a higher intLevel.", "url": "https://github.com/twilio/twilio-java/pull/606#discussion_r529820945", "createdAt": "2020-11-24T19:19:58Z", "author": {"login": "JenniferMah"}, "path": "src/main/java/com/twilio/http/TwilioRestClient.java", "diffHunk": "@@ -50,7 +57,16 @@ public Response request(final Request request) {\n         if (edge != null)\n             request.setEdge(edge);\n \n-        return httpClient.reliableRequest(request);\n+        logRequest(request);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc5ODgzNw=="}, "originalCommit": {"oid": "f73a300fd46612bc367670a99b9cd304d3083bc7"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjY2MjU0OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/twilio/http/LoggingTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODo0MjozMVrOH5QY8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxODo0MjozMVrOH5QY8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc5OTQwOQ==", "bodyText": "If behavior is different when no logger is configured (i.e. no output), can we add a test for that scenario?", "url": "https://github.com/twilio/twilio-java/pull/606#discussion_r529799409", "createdAt": "2020-11-24T18:42:31Z", "author": {"login": "eshanholtz"}, "path": "src/test/java/com/twilio/http/LoggingTest.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.twilio.http;\n+\n+import com.twilio.Twilio;\n+import com.twilio.rest.Domains;\n+import com.twilio.rest.api.v2010.account.Message;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.Assert;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+\n+public class LoggingTest {\n+    @Before\n+    public void setUp() throws Exception {\n+        Twilio.init(\"AC123\", \"AUTH TOKEN\");\n+    }\n+\n+    @Test\n+    public void testDebuggingLogging() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f73a300fd46612bc367670a99b9cd304d3083bc7"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzExNTg3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/twilio/http/TwilioRestClient.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDoxMjo1NFrOH8MHNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDoxMjo1NFrOH8MHNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg3NTA2Mg==", "bodyText": "nit: can this be if (!queryParams.isEmpty()) {?", "url": "https://github.com/twilio/twilio-java/pull/606#discussion_r532875062", "createdAt": "2020-11-30T20:12:54Z", "author": {"login": "eshanholtz"}, "path": "src/main/java/com/twilio/http/TwilioRestClient.java", "diffHunk": "@@ -126,4 +142,29 @@ public TwilioRestClient build() {\n         }\n     }\n \n+    /**\n+     * Logging debug information about HTTP request.\n+     */\n+    public void logRequest(final Request request) {\n+        logger.debug(\"-- BEGIN Twilio API Request --\");\n+        logger.debug(\"request method: \" + request.getMethod());\n+        logger.debug(\"request URL: \" + request.getUrl());\n+        final Map<String, List<String>> queryParams = request.getQueryParams();\n+        final Map<String, List<String>> headerParams = request.getHeaderParams();\n+\n+        if (queryParams.isEmpty() == false) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99f5d209d5e71b146247fe0b217807e37621971b"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzExNjUxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/twilio/http/TwilioRestClient.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDoxMzowM1rOH8MHkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDoxMzowM1rOH8MHkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg3NTE1Mw==", "bodyText": "nit: same as above ^", "url": "https://github.com/twilio/twilio-java/pull/606#discussion_r532875153", "createdAt": "2020-11-30T20:13:03Z", "author": {"login": "eshanholtz"}, "path": "src/main/java/com/twilio/http/TwilioRestClient.java", "diffHunk": "@@ -126,4 +142,29 @@ public TwilioRestClient build() {\n         }\n     }\n \n+    /**\n+     * Logging debug information about HTTP request.\n+     */\n+    public void logRequest(final Request request) {\n+        logger.debug(\"-- BEGIN Twilio API Request --\");\n+        logger.debug(\"request method: \" + request.getMethod());\n+        logger.debug(\"request URL: \" + request.getUrl());\n+        final Map<String, List<String>> queryParams = request.getQueryParams();\n+        final Map<String, List<String>> headerParams = request.getHeaderParams();\n+\n+        if (queryParams.isEmpty() == false) {\n+            logger.debug(\"query parameters: \" + queryParams);\n+        }\n+\n+        if (headerParams.isEmpty() == false) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99f5d209d5e71b146247fe0b217807e37621971b"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0Mzg3NzgzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/twilio/Twilio.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDoyMzoxNFrOH8TMHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDoyMzoxNFrOH8TMHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk5MTAwNw==", "bodyText": "We may want to expose the parameter for getContext with a default set to false in setLoggerConfiguration.", "url": "https://github.com/twilio/twilio-java/pull/606#discussion_r532991007", "createdAt": "2020-12-01T00:23:14Z", "author": {"login": "thinkingserious"}, "path": "src/main/java/com/twilio/Twilio.java", "diffHunk": "@@ -150,6 +154,17 @@ public static synchronized void setEdge(final String edge) {\n         Twilio.edge = edge;\n     }\n \n+    /**\n+     * Set the logger configuration file path.\n+     *\n+     * @param filePath path to logging configuration file\n+     */\n+    public static synchronized void setLoggerConfiguration(final String filePath) {\n+        LoggerContext context = (org.apache.logging.log4j.core.LoggerContext) LogManager.getContext(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "340d780da8298c07ba765c47b042852c6b6c23f5"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0Mzg4NjY4OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/twilio/http/TwilioRestClient.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDoyNjo0N1rOH8TRIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDoyNjo0N1rOH8TRIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk5MjI4OQ==", "bodyText": "Can we avoid wildcard imports here?", "url": "https://github.com/twilio/twilio-java/pull/606#discussion_r532992289", "createdAt": "2020-12-01T00:26:47Z", "author": {"login": "thinkingserious"}, "path": "src/main/java/com/twilio/http/TwilioRestClient.java", "diffHunk": "@@ -4,6 +4,12 @@\n import com.fasterxml.jackson.datatype.jsr310.JavaTimeModule;\n \n import java.util.function.Predicate;\n+import java.io.*;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "340d780da8298c07ba765c47b042852c6b6c23f5"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0Mzk4NTIyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/twilio/http/TwilioRestClient.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMTowODo0N1rOH8UIow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwNDoyNTozOVrOH8XseQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwNjQ5OQ==", "bodyText": "Should \"TwilioRestClient\" be configurable?", "url": "https://github.com/twilio/twilio-java/pull/606#discussion_r533006499", "createdAt": "2020-12-01T01:08:47Z", "author": {"login": "thinkingserious"}, "path": "src/main/java/com/twilio/http/TwilioRestClient.java", "diffHunk": "@@ -19,6 +25,7 @@\n     private final String region;\n     private final String edge;\n     private final HttpClient httpClient;\n+    private static final Logger logger = LogManager.getLogger(\"TwilioRestClient\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "340d780da8298c07ba765c47b042852c6b6c23f5"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA2NDgyNQ==", "bodyText": "I don't think it would be necessary for this to be configurable because it should be the class name. I have now changed this to now use the name of the calling class based on the log4j documentation recommendation.", "url": "https://github.com/twilio/twilio-java/pull/606#discussion_r533064825", "createdAt": "2020-12-01T04:25:39Z", "author": {"login": "JenniferMah"}, "path": "src/main/java/com/twilio/http/TwilioRestClient.java", "diffHunk": "@@ -19,6 +25,7 @@\n     private final String region;\n     private final String edge;\n     private final HttpClient httpClient;\n+    private static final Logger logger = LogManager.getLogger(\"TwilioRestClient\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwNjQ5OQ=="}, "originalCommit": {"oid": "340d780da8298c07ba765c47b042852c6b6c23f5"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0Mzk4NjE1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/twilio/http/TwilioRestClient.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMTowOToxNlrOH8UJOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMTowOToxNlrOH8UJOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwNjY1MQ==", "bodyText": "respone/response", "url": "https://github.com/twilio/twilio-java/pull/606#discussion_r533006651", "createdAt": "2020-12-01T01:09:16Z", "author": {"login": "thinkingserious"}, "path": "src/main/java/com/twilio/http/TwilioRestClient.java", "diffHunk": "@@ -50,7 +57,16 @@ public Response request(final Request request) {\n         if (edge != null)\n             request.setEdge(edge);\n \n-        return httpClient.reliableRequest(request);\n+        logRequest(request);\n+        Response response = httpClient.reliableRequest(request);\n+        logger.debug(\"status code: \" + response.getStatusCode());\n+        org.apache.http.Header[] responseHeaders = response.getHeaders();\n+        logger.debug(\"respone headers:\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "340d780da8298c07ba765c47b042852c6b6c23f5"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0Mzk5NjE1OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/twilio/http/LoggingTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMToxMzo1MFrOH8UO9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMToxMzo1MFrOH8UO9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwODExOQ==", "bodyText": "nit: duplicate code in these two tests:\nByteArrayOutputStream output = new ByteArrayOutputStream();\nPrintStream outputStream = new PrintStream(output);\nPrintStream originalStream = System.out;\nSystem.setOut(outputStream);\nTwilioRestClient twilioRestClient = Twilio.getRestClient();\ntwilioRestClient.logRequest(request);\nSystem.out.flush();\nSystem.setOut(originalStream);", "url": "https://github.com/twilio/twilio-java/pull/606#discussion_r533008119", "createdAt": "2020-12-01T01:13:50Z", "author": {"login": "thinkingserious"}, "path": "src/test/java/com/twilio/http/LoggingTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+package com.twilio.http;\n+\n+import com.twilio.Twilio;\n+import com.twilio.rest.Domains;\n+import com.twilio.rest.api.v2010.account.Message;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.Assert;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+\n+public class LoggingTest {\n+    @Before\n+    public void setUp() throws Exception {\n+        Twilio.init(\"AC123\", \"AUTH TOKEN\");\n+    }\n+\n+    @Test\n+    public void testDebugLogging() {\n+        ByteArrayOutputStream output = new ByteArrayOutputStream();\n+        PrintStream outputStream = new PrintStream(output);\n+        PrintStream originalStream = System.out;\n+        System.setOut(outputStream);\n+        Twilio.setLoggerConfiguration(\"src/main/java/com/twilio/example/log4j2.xml\");\n+        final Request request = new Request(HttpMethod.GET, Domains.API.toString(),\n+                \"/2010-04-01/Accounts/AC123/Messages/MM123.json\");\n+        request.addHeaderParam(\"Authorization\", \"authorization value\");\n+        request.addHeaderParam(\"Test Header\", \"test value\");\n+        TwilioRestClient twilioRestClient = Twilio.getRestClient();\n+        twilioRestClient.logRequest(request);\n+        System.out.flush();\n+        System.setOut(originalStream);\n+        Assert.assertTrue(output.toString().contains(\"GET\"));\n+        Assert.assertFalse(output.toString().contains(\"Authorization\"));\n+    }\n+\n+    @Test\n+    public void testUsingDefaultConfigurationFileDebugLogging() {\n+        ByteArrayOutputStream output = new ByteArrayOutputStream();\n+        PrintStream outputStream = new PrintStream(output);\n+        PrintStream originalStream = System.out;\n+        System.setOut(outputStream);\n+        final Request request = new Request(HttpMethod.GET, Domains.API.toString(),\n+                \"/2010-04-01/Accounts/AC123/Messages/MM123.json\");\n+        request.addHeaderParam(\"Authorization\", \"authorization value\");\n+        request.addHeaderParam(\"Test Header\", \"test value\");\n+        TwilioRestClient twilioRestClient = Twilio.getRestClient();\n+        twilioRestClient.logRequest(request);\n+        System.out.flush();\n+        System.setOut(originalStream);\n+        Assert.assertTrue(output.toString().isEmpty());\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "340d780da8298c07ba765c47b042852c6b6c23f5"}, "originalPosition": 53}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1955, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}