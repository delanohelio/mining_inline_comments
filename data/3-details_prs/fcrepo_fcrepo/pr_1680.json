{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NDI5MTc2", "number": 1680, "title": "Adds search endpoint with a minimal integration test.", "bodyText": "**Initial starting point for simple search implementation **\n\nJIRA Ticket: Resolves: https://jira.lyrasis.org/browse/FCREPO-3282\n\nOther Relevant Links (Mailing list discussion, related pull requests, etc.)\n\nWhat does this Pull Request do?\n\nAdds two new modules: fcrepo-search-api and fcrepo-search-impl\nAdds an integration test to ensure that the search api is returning a valid json result.\n\nHow should this be tested?\njava  -Dfcrepo.ocfl.staging.dir=target/fcrepo-data/staging -Dfcrepo.ocfl.storage.root.dir=target/fcrepo-data/ocfl-root -Dfcrepo.ocfl.work.dir=target/fcrepo-data/work    -jar fcrepo-webapp/target/fcrepo-webapp-6.0.0-SNAPSHOT-jetty-console.jar --headless\n\ncurl -u fedoraAdmin:fedoraAdmin http://localhost:8080/rest/fcr:search -i\n\nVerify that it returns 200 and some json.  Ignore the values within the search results since they are not actually connected to anything yet.\nInterested parties\nTag (@ mention) interested parties or, if unsure, @fcrepo4/committers", "createdAt": "2020-05-08T20:53:35Z", "url": "https://github.com/fcrepo/fcrepo/pull/1680", "merged": true, "mergeCommit": {"oid": "39663513707a3a896d6b164ef59deb701982129c"}, "closed": true, "closedAt": "2020-05-21T13:50:26Z", "author": {"login": "dbernstein"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfYG2IAH2gAyNDE1NDI5MTc2OjQwN2IwMjE5NzhhMmVmMDcxZDFhM2FlY2E3ZWNkNTk3NGQ2M2JjMjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjVoP6AH2gAyNDE1NDI5MTc2OjgwNjdkY2IyMjM3YzU3NDZkOTE0ZjYwMTk5OWIxM2VjNTE0OTYwNDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "407b021978a2ef071d1a3aeca7ecd5974d63bc22", "author": {"user": {"login": "dbernstein", "name": "dbernstein"}}, "url": "https://github.com/fcrepo/fcrepo/commit/407b021978a2ef071d1a3aeca7ecd5974d63bc22", "committedDate": "2020-05-08T20:42:56Z", "message": "Adds search endpoint with a minimal integration test.\n\nResolves: https://jira.lyrasis.org/browse/FCREPO-3282"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMjMyNDM2", "url": "https://github.com/fcrepo/fcrepo/pull/1680#pullrequestreview-412232436", "createdAt": "2020-05-14T22:36:48Z", "commit": {"oid": "407b021978a2ef071d1a3aeca7ecd5974d63bc22"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQyMjozNjo0OFrOGVwjqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQyMjo1MToxOFrOGVw2CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ2ODg0Mw==", "bodyText": "I believe the recommendation is to use the constant: StandardCharsets.UTF_8.", "url": "https://github.com/fcrepo/fcrepo/pull/1680#discussion_r425468843", "createdAt": "2020-05-14T22:36:48Z", "author": {"login": "awoods"}, "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraSearchIT.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.integration.http.api;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpGet;\n+import org.fcrepo.search.api.SearchResult;\n+import org.junit.Test;\n+\n+import java.net.URLEncoder;\n+\n+import static javax.ws.rs.core.Response.Status.OK;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+\n+/**\n+ * @author dbernstein\n+ * @since 05/06/20\n+ */\n+public class FedoraSearchIT extends AbstractResourceIT {\n+\n+\n+    @Test\n+    public void testSearchAllResources() throws Exception {\n+\n+        final var condition = \"fedoraId=*\";\n+        final String searchUrl = serverAddress + \"fcr:search\" + \"?query=\" + doubleEncode(condition);\n+        try (final CloseableHttpResponse response = execute(new HttpGet(searchUrl))) {\n+            assertEquals(OK.getStatusCode(), getStatus(response));\n+            final ObjectMapper objectMapper = new ObjectMapper();\n+            final SearchResult result = objectMapper.readValue(response.getEntity().getContent(), SearchResult.class);\n+            assertNotNull(result);\n+            assertNotNull(result.getPagination());\n+            assertEquals(0, result.getResults().size());\n+        }\n+    }\n+\n+    private String encode(final String value) throws Exception {\n+        return URLEncoder.encode(value, \"UTF-8\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "407b021978a2ef071d1a3aeca7ecd5974d63bc22"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ2OTY4OQ==", "bodyText": "I am surprised that the build did not fail, given the lack of JavaDoc on these public methods... something must have regressed in our checkstyle configuration.", "url": "https://github.com/fcrepo/fcrepo/pull/1680#discussion_r425469689", "createdAt": "2020-05-14T22:39:11Z", "author": {"login": "awoods"}, "path": "fcrepo-search-api/src/main/java/org/fcrepo/search/api/SearchResult.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.search.api;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * @author dbernstein\n+ */\n+public class SearchResult {\n+    @JsonProperty\n+    private PaginationInfo pagination = new PaginationInfo();\n+    @JsonProperty\n+    private List<Map<String, Object>> results = new ArrayList();\n+\n+    public SearchResult() {\n+\n+    }\n+\n+    public PaginationInfo getPagination() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "407b021978a2ef071d1a3aeca7ecd5974d63bc22"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ3MDMwOQ==", "bodyText": "JavaDocs explaining something about the nature of the expected query parameter will be helpful for whoever comes along to implement this.", "url": "https://github.com/fcrepo/fcrepo/pull/1680#discussion_r425470309", "createdAt": "2020-05-14T22:41:00Z", "author": {"login": "awoods"}, "path": "fcrepo-search-api/src/main/java/org/fcrepo/search/api/SearchParameters.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.search.api;\n+\n+/**\n+ * A pojo encapsulating the parameters of a search\n+ */\n+public class SearchParameters {\n+    public SearchParameters(final String query) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "407b021978a2ef071d1a3aeca7ecd5974d63bc22"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ3MTY5NQ==", "bodyText": "Maybe add the scope:test if this is test gear.", "url": "https://github.com/fcrepo/fcrepo/pull/1680#discussion_r425471695", "createdAt": "2020-05-14T22:45:35Z", "author": {"login": "awoods"}, "path": "fcrepo-search-impl/pom.xml", "diffHunk": "@@ -0,0 +1,60 @@\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+  <modelVersion>4.0.0</modelVersion>\n+  <parent>\n+    <groupId>org.fcrepo</groupId>\n+    <artifactId>fcrepo</artifactId>\n+    <version>6.0.0-SNAPSHOT</version>\n+  </parent>\n+  <artifactId>fcrepo-search-impl</artifactId>\n+  <name>Fedora Repository Search Impl</name>\n+  <description>Fedora Repository Default Search API Implementation</description>\n+  <packaging>bundle</packaging>\n+\n+  <properties>\n+    <osgi.import.packages>\n+      javax.inject,\n+      *\n+    </osgi.import.packages>\n+    <osgi.export.packages>\n+      org.fcrepo.search.impl.*;version=${project.version}\n+    </osgi.export.packages>\n+  </properties>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.felix</groupId>\n+        <artifactId>maven-bundle-plugin</artifactId>\n+      </plugin>\n+    </plugins>\n+  </build>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.fcrepo</groupId>\n+      <artifactId>fcrepo-search-api</artifactId>\n+      <version>${project.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>com.fasterxml.jackson.core</groupId>\n+      <artifactId>jackson-annotations</artifactId>\n+    </dependency>\n+\n+    <!-- test gear -->\n+    <dependency>\n+      <groupId>junit</groupId>\n+      <artifactId>junit</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.mockito</groupId>\n+      <artifactId>mockito-core</artifactId>\n+      <scope>test</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.springframework</groupId>\n+      <artifactId>spring-context</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "407b021978a2ef071d1a3aeca7ecd5974d63bc22"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ3MzU0NA==", "bodyText": "I believe this should be a scope:test dependency.", "url": "https://github.com/fcrepo/fcrepo/pull/1680#discussion_r425473544", "createdAt": "2020-05-14T22:51:18Z", "author": {"login": "awoods"}, "path": "fcrepo-http-api/pom.xml", "diffHunk": "@@ -58,6 +59,18 @@\n       <version>${project.version}</version>\n     </dependency>\n \n+    <dependency>\n+      <groupId>org.fcrepo</groupId>\n+      <artifactId>fcrepo-search-api</artifactId>\n+      <version>${project.version}</version>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.fcrepo</groupId>\n+      <artifactId>fcrepo-search-impl</artifactId>\n+      <version>${project.version}</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "407b021978a2ef071d1a3aeca7ecd5974d63bc22"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bcae043c4985e61a0f6b88f34cb6e5d9a39ee65", "author": {"user": {"login": "dbernstein", "name": "dbernstein"}}, "url": "https://github.com/fcrepo/fcrepo/commit/1bcae043c4985e61a0f6b88f34cb6e5d9a39ee65", "committedDate": "2020-05-15T19:01:39Z", "message": "Addresses PR feedback:\nAdds javadocs.\nAdds Query class to encapulate the Query datastructure and string parsing."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8067dcb2237c5746d914f601999b13ec51496040", "author": {"user": {"login": "dbernstein", "name": "dbernstein"}}, "url": "https://github.com/fcrepo/fcrepo/commit/8067dcb2237c5746d914f601999b13ec51496040", "committedDate": "2020-05-21T04:05:24Z", "message": "Moves spring context dependency out of test gear section."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3117, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}