{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0ODM1MDU2", "number": 1738, "title": "FCREPO-3399 - External URI case sensitivity and handling changes", "bodyText": "JIRA Ticket: https://jira.lyrasis.org/browse/FCREPO-3399\nWhat does this Pull Request do?\n\nBackports fix for external uri validation case sensitivity issues with file uris from Fedora 6\nBackports most of the external binary integration tests from Fedora 6\nFixes bug when switching between redirect and proxy handling on an existing external binary, where it would retain the previous content uri and handling in modeshape. This would result in the \"proxy\" handling taking precedence, even if it was not the type selected by more recent updates.\n\nHow should this be tested?\nRun automated tests. For notes on how to manually test, see:\n#1735\nIf on a file system that is case sensitive (not macOs), can try creating an external binary with capital letters in it, which should succeed. Can then try switching it back and forth to proxy/redirect, the handling should reflect your updates.\nmvn -Dfcrepo.home=target/fcrepo -Dfcrepo.external.content.allowed=fcrepo-http-api/src/test/resources/allowed_external_paths.txt clean jetty:run -pl fcrepo-webapp -Denforcer.skip -Dmaven.javadoc.skip=true\n\n\n# create external binary with a file containing capital letters, with proxy handling\ncurl -i -H\"Link: <file:///Users/bbpennel/git/fcrepo4/README.md>; rel=\\\"http://fedora.info/definitions/fcrepo#ExternalContent\\\"; handling=\\\"proxy\\\"; type=\\\"text/plain\\\"\" -XPUT -ufedoraAdmin:fedoraAdmin http://localhost:8080/rest/test_case_sensitive\n\n# Head request should indicate it would return the file directly\ncurl -I -ufedoraAdmin:fedoraAdmin http://localhost:8080/rest/test_case_sensitive\n\nHTTP/1.1 200 OK\nContent-Location: file:/Users/bbpennel/git/fcrepo4/README.md\n\n\n# Replace the binary with a different one, using redirect\ncurl -i -H\"Link: <file:///Users/bbpennel/git/fcrepo4/pom.xml>; rel=\\\"http://fedora.info/definitions/fcrepo#ExternalContent\\\"; handling=\\\"redirect\\\"; type=\\\"text/plain\\\"\" -XPUT -ufedoraAdmin:fedoraAdmin http://localhost:8080/rest/test_case_sensitive\n\n# Head request should indicate that it would redirect to the file\ncurl -I -ufedoraAdmin:fedoraAdmin http://localhost:8080/rest/test_case_sensitive\n\nHTTP/1.1 307 Temporary Redirect\nLocation: file:/Users/bbpennel/git/fcrepo4/pom.xml", "createdAt": "2020-08-07T21:08:51Z", "url": "https://github.com/fcrepo/fcrepo/pull/1738", "merged": true, "mergeCommit": {"oid": "c1e187796ac86136137da09aa622b6bbc835acfe"}, "closed": true, "closedAt": "2020-08-21T19:25:20Z", "author": {"login": "bbpennel"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9iw24AH2gAyNDY0ODM1MDU2OmJhOTJkNzNiMjdhMzdlOGU2OTI5OWVkNzJkYjVmYTI5MDZjNTAzOTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBJ7NvgFqTQ3Mjc2NzM2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ba92d73b27a37e8e69299ed72db5fa2906c50396", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/fcrepo/fcrepo/commit/ba92d73b27a37e8e69299ed72db5fa2906c50396", "committedDate": "2020-08-10T14:05:36Z", "message": "Fix issue with external content where the validator would reject file paths containing capital letters in case sensitive file systems"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58270cf72ebeb5c8311a886b621aacd5764960e0", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/fcrepo/fcrepo/commit/58270cf72ebeb5c8311a886b621aacd5764960e0", "committedDate": "2020-08-10T14:05:36Z", "message": "Clear proxy or redirect uri for external binaries when switching external binary handling. Back port integration tests for external binary handling"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9af1dcaa73394638a4e8b97fba0cdf7f225682a9", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/fcrepo/fcrepo/commit/9af1dcaa73394638a4e8b97fba0cdf7f225682a9", "committedDate": "2020-08-07T20:40:13Z", "message": "Clear proxy or redirect uri for external binaries when switching external binary handling. Back port integration tests for external binary handling"}, "afterCommit": {"oid": "58270cf72ebeb5c8311a886b621aacd5764960e0", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/fcrepo/fcrepo/commit/58270cf72ebeb5c8311a886b621aacd5764960e0", "committedDate": "2020-08-10T14:05:36Z", "message": "Clear proxy or redirect uri for external binaries when switching external binary handling. Back port integration tests for external binary handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNTQyMjk0", "url": "https://github.com/fcrepo/fcrepo/pull/1738#pullrequestreview-472542294", "createdAt": "2020-08-21T14:33:32Z", "commit": {"oid": "58270cf72ebeb5c8311a886b621aacd5764960e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNDozMzozMlrOHEvqsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNDozMzozMlrOHEvqsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDczNzMyOA==", "bodyText": "May as well remove this commented-out import.", "url": "https://github.com/fcrepo/fcrepo/pull/1738#discussion_r474737328", "createdAt": "2020-08-21T14:33:32Z", "author": {"login": "awoods"}, "path": "fcrepo-kernel-modeshape/src/main/java/org/fcrepo/kernel/modeshape/UrlBinary.java", "diffHunk": "@@ -17,10 +17,10 @@\n  */\n package org.fcrepo.kernel.modeshape;\n \n-//import static org.modeshape.jcr.api.JcrConstants.JCR_DATA;\n-import static org.slf4j.LoggerFactory.getLogger;\n import static org.fcrepo.kernel.api.FedoraExternalContent.PROXY;\n import static org.fcrepo.kernel.api.FedoraExternalContent.REDIRECT;\n+//import static org.modeshape.jcr.api.JcrConstants.JCR_DATA;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58270cf72ebeb5c8311a886b621aacd5764960e0"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNzY3MzY0", "url": "https://github.com/fcrepo/fcrepo/pull/1738#pullrequestreview-472767364", "createdAt": "2020-08-21T19:24:59Z", "commit": {"oid": "58270cf72ebeb5c8311a886b621aacd5764960e0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3182, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}