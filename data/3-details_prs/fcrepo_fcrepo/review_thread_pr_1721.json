{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4NTA4NDYy", "number": 1721, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMjowMjoyNVrOEOAsvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwODoyNjoxOVrOEPBoLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMTI2OTc0OnYy", "diffSide": "RIGHT", "path": ".travis/deploy.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMjowMjoyNVrOGw7umQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxODowNDo0NlrOGxfOAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk2MzQxNw==", "bodyText": "Should this be uncommented?", "url": "https://github.com/fcrepo/fcrepo/pull/1721#discussion_r453963417", "createdAt": "2020-07-13T22:02:25Z", "author": {"login": "awoods"}, "path": ".travis/deploy.sh", "diffHunk": "@@ -2,6 +2,18 @@ if [ ! -z \"$TRAVIS_TAG\" ]\n then\n     echo \"on a tag -> $TRAVIS_TAG and therefore we will do nothing. Tagged releases are deployed to sonatype manually.\"\n else\n-    echo \"not on a tag -> deploying to sonatype snapshot repo...\"\n-    ./mvnw clean deploy --settings .travis/settings.xml -DskipTests=true -B -U\n+    echo \"not on a tag -> deploying to dockerhub and sonatype...\"\n+    FCREPO_VERSION=$(./mvnw org.apache.maven.plugins:maven-help-plugin:3.1.0:evaluate -Dexpression=project.version -q -DforceStdout)\n+    \n+    echo \"clone fcrepo4-labs/fcrepo-docker repository\"\n+    git clone https://github.com/fcrepo4-labs/fcrepo-docker.git\n+    echo \"building docker container\"\n+    cd fcrepo-docker\n+    ./build.sh ../fcrepo-webapp/target/fcrepo-webapp-${FCREPO_VERSION}.war\n+    echo \"push image to dockerhub\"\n+    ./push.sh latest ${FCREPO_VERSION}\n+    cd ..\n+\n+    echo \"deploying to sonatype snapshot repo...\"\n+#    ./mvnw clean deploy --settings .travis/settings.xml -DskipTests=true -B -U", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5b31a0dd334cc35ca1105b8974be523c62320e7"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU0NDg5Ng==", "bodyText": "oops - yes - good catch.", "url": "https://github.com/fcrepo/fcrepo/pull/1721#discussion_r454544896", "createdAt": "2020-07-14T18:04:46Z", "author": {"login": "dbernstein"}, "path": ".travis/deploy.sh", "diffHunk": "@@ -2,6 +2,18 @@ if [ ! -z \"$TRAVIS_TAG\" ]\n then\n     echo \"on a tag -> $TRAVIS_TAG and therefore we will do nothing. Tagged releases are deployed to sonatype manually.\"\n else\n-    echo \"not on a tag -> deploying to sonatype snapshot repo...\"\n-    ./mvnw clean deploy --settings .travis/settings.xml -DskipTests=true -B -U\n+    echo \"not on a tag -> deploying to dockerhub and sonatype...\"\n+    FCREPO_VERSION=$(./mvnw org.apache.maven.plugins:maven-help-plugin:3.1.0:evaluate -Dexpression=project.version -q -DforceStdout)\n+    \n+    echo \"clone fcrepo4-labs/fcrepo-docker repository\"\n+    git clone https://github.com/fcrepo4-labs/fcrepo-docker.git\n+    echo \"building docker container\"\n+    cd fcrepo-docker\n+    ./build.sh ../fcrepo-webapp/target/fcrepo-webapp-${FCREPO_VERSION}.war\n+    echo \"push image to dockerhub\"\n+    ./push.sh latest ${FCREPO_VERSION}\n+    cd ..\n+\n+    echo \"deploying to sonatype snapshot repo...\"\n+#    ./mvnw clean deploy --settings .travis/settings.xml -DskipTests=true -B -U", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk2MzQxNw=="}, "originalCommit": {"oid": "b5b31a0dd334cc35ca1105b8974be523c62320e7"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MTkwMzIzOnYy", "diffSide": "RIGHT", "path": ".travis/deploy.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwODoyNTowN1rOGygZYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxOTo1ODozMVrOGy6owQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTYxMjc3MQ==", "bodyText": "We might want to build the container within the default travis pipeline instead of in the deploy part and only include the push command here.", "url": "https://github.com/fcrepo/fcrepo/pull/1721#discussion_r455612771", "createdAt": "2020-07-16T08:25:07Z", "author": {"login": "tomcbe"}, "path": ".travis/deploy.sh", "diffHunk": "@@ -2,6 +2,18 @@ if [ ! -z \"$TRAVIS_TAG\" ]\n then\n     echo \"on a tag -> $TRAVIS_TAG and therefore we will do nothing. Tagged releases are deployed to sonatype manually.\"\n else\n-    echo \"not on a tag -> deploying to sonatype snapshot repo...\"\n+    echo \"not on a tag -> deploying to dockerhub and sonatype...\"\n+    FCREPO_VERSION=$(./mvnw org.apache.maven.plugins:maven-help-plugin:3.1.0:evaluate -Dexpression=project.version -q -DforceStdout)\n+    \n+    echo \"clone fcrepo4-labs/fcrepo-docker repository\"\n+    git clone https://github.com/fcrepo4-labs/fcrepo-docker.git\n+    echo \"building docker container\"\n+    cd fcrepo-docker\n+    ./build.sh ../fcrepo-webapp/target/fcrepo-webapp-${FCREPO_VERSION}.war", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25ae09e188eef52f5f93d79297600d817c2b2ccb"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA0MjY4OQ==", "bodyText": "Per our conversation in the meeting this morning,  we can defer until this change becomes necessary.", "url": "https://github.com/fcrepo/fcrepo/pull/1721#discussion_r456042689", "createdAt": "2020-07-16T19:58:31Z", "author": {"login": "dbernstein"}, "path": ".travis/deploy.sh", "diffHunk": "@@ -2,6 +2,18 @@ if [ ! -z \"$TRAVIS_TAG\" ]\n then\n     echo \"on a tag -> $TRAVIS_TAG and therefore we will do nothing. Tagged releases are deployed to sonatype manually.\"\n else\n-    echo \"not on a tag -> deploying to sonatype snapshot repo...\"\n+    echo \"not on a tag -> deploying to dockerhub and sonatype...\"\n+    FCREPO_VERSION=$(./mvnw org.apache.maven.plugins:maven-help-plugin:3.1.0:evaluate -Dexpression=project.version -q -DforceStdout)\n+    \n+    echo \"clone fcrepo4-labs/fcrepo-docker repository\"\n+    git clone https://github.com/fcrepo4-labs/fcrepo-docker.git\n+    echo \"building docker container\"\n+    cd fcrepo-docker\n+    ./build.sh ../fcrepo-webapp/target/fcrepo-webapp-${FCREPO_VERSION}.war", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTYxMjc3MQ=="}, "originalCommit": {"oid": "25ae09e188eef52f5f93d79297600d817c2b2ccb"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MTkwNzY0OnYy", "diffSide": "RIGHT", "path": ".travis/deploy.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwODoyNjoxOVrOGygcVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwODoyNjoxOVrOGygcVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTYxMzUyNg==", "bodyText": "Change message to: \"on a tag -> $TRAVIS_TAG and therefore we will do nothing. Tagged releases are deployed to sonatype and Docker Hub manually.\"", "url": "https://github.com/fcrepo/fcrepo/pull/1721#discussion_r455613526", "createdAt": "2020-07-16T08:26:19Z", "author": {"login": "tomcbe"}, "path": ".travis/deploy.sh", "diffHunk": "@@ -2,6 +2,18 @@ if [ ! -z \"$TRAVIS_TAG\" ]\n then\n     echo \"on a tag -> $TRAVIS_TAG and therefore we will do nothing. Tagged releases are deployed to sonatype manually.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25ae09e188eef52f5f93d79297600d817c2b2ccb"}, "originalPosition": 2}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1872, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}