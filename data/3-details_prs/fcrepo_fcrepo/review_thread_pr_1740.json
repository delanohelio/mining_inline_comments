{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NTY3NjU1", "number": 1740, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNDowOTowM1rOEXOlJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMzoyODo0NFrOEa95Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNzkxNTkxOnYy", "diffSide": "RIGHT", "path": ".travis.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNDowOTowM1rOG-5ljg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNDo0MjowOFrOG-7Ouw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODYwODM5OA==", "bodyText": "doesn't seem to make a difference here, but might be a good idea to remove the double slash", "url": "https://github.com/fcrepo/fcrepo/pull/1740#discussion_r468608398", "createdAt": "2020-08-11T14:09:03Z", "author": {"login": "bbpennel"}, "path": ".travis.yml", "diffHunk": "@@ -1,13 +1,69 @@\n \n jobs:\n   include:\n-    - os: linux\n-      language: java\n+    - name: Build - Linux\n+      os: linux\n       dist: trusty\n       sudo: true\n+      language: java\n       jdk: openjdk11\n-    - os: windows\n+      env: DEPLOY=true\n+    - name: Build - Windows\n+      os: windows\n       language: shell\n+    - name: ITests - PostgreSQL\n+      os: linux\n+      dist: focal\n+      sudo: true\n+      language: java\n+      jdk: openjdk11\n+      addons:\n+        postgresql: '12'\n+        apt:\n+          packages:\n+            - postgresql-12\n+            - postgresql-client-12\n+      env:\n+        - DB=postgresql\n+        - DB_PORT=5432\n+        - ITEST=true\n+      before_script:\n+        - psql -c 'CREATE DATABASE fcrepo;' -U postgres\n+    - name: ITests - MariaDB\n+      os: linux\n+      dist: trusty\n+      sudo: true\n+      language: java\n+      jdk: openjdk11\n+      addons:\n+        mariadb: \"10.4\"\n+      env:\n+        - DB=mariadb\n+        - DB_PORT=3306\n+        - ITEST=true\n+      before_script:\n+        - mysql -e 'CREATE DATABASE IF NOT EXISTS fcrepo;'\n+    - name: ITests - MySQL\n+      os: linux\n+      dist: xenial\n+      sudo: true\n+      language: java\n+      jdk: openjdk11\n+      env:\n+        - DB=mysql\n+        - DB_PORT=3306\n+        - ITEST=true\n+      services:\n+        - mysql\n+      before_script:\n+        - wget https://repo.mysql.com//mysql-apt-config_0.8.10-1_all.deb", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ad698bfab4edcf9098283a6afd52f4a538e981e"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODYzNTMyMw==", "bodyText": "fixed", "url": "https://github.com/fcrepo/fcrepo/pull/1740#discussion_r468635323", "createdAt": "2020-08-11T14:42:08Z", "author": {"login": "pwinckles"}, "path": ".travis.yml", "diffHunk": "@@ -1,13 +1,69 @@\n \n jobs:\n   include:\n-    - os: linux\n-      language: java\n+    - name: Build - Linux\n+      os: linux\n       dist: trusty\n       sudo: true\n+      language: java\n       jdk: openjdk11\n-    - os: windows\n+      env: DEPLOY=true\n+    - name: Build - Windows\n+      os: windows\n       language: shell\n+    - name: ITests - PostgreSQL\n+      os: linux\n+      dist: focal\n+      sudo: true\n+      language: java\n+      jdk: openjdk11\n+      addons:\n+        postgresql: '12'\n+        apt:\n+          packages:\n+            - postgresql-12\n+            - postgresql-client-12\n+      env:\n+        - DB=postgresql\n+        - DB_PORT=5432\n+        - ITEST=true\n+      before_script:\n+        - psql -c 'CREATE DATABASE fcrepo;' -U postgres\n+    - name: ITests - MariaDB\n+      os: linux\n+      dist: trusty\n+      sudo: true\n+      language: java\n+      jdk: openjdk11\n+      addons:\n+        mariadb: \"10.4\"\n+      env:\n+        - DB=mariadb\n+        - DB_PORT=3306\n+        - ITEST=true\n+      before_script:\n+        - mysql -e 'CREATE DATABASE IF NOT EXISTS fcrepo;'\n+    - name: ITests - MySQL\n+      os: linux\n+      dist: xenial\n+      sudo: true\n+      language: java\n+      jdk: openjdk11\n+      env:\n+        - DB=mysql\n+        - DB_PORT=3306\n+        - ITEST=true\n+      services:\n+        - mysql\n+      before_script:\n+        - wget https://repo.mysql.com//mysql-apt-config_0.8.10-1_all.deb", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODYwODM5OA=="}, "originalCommit": {"oid": "0ad698bfab4edcf9098283a6afd52f4a538e981e"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyODAzNzU3OnYy", "diffSide": "RIGHT", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNDozMDoxM1rOG-6spA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxNTowMToxOFrOG-8G_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODYyNjU5Ng==", "bodyText": "If i'm understanding correctly, this change basically increases wiggle room allowed between the expected timestamp and the real timestamp up to the minutes range? Sort of wondering if it can tell apart the 4 mementos created in that test since they are separated by 1 second each, but it seems like that already would have been an issue since it seems like it was trimming off the seconds from the timestamp.\nI'm actually kind of surprised this test is passing since the logs for it are cranking out a lot of grizzly Method Not Allowed errors. But I can't really remember where versioning support stands in fedora 6 at the moment anyway.", "url": "https://github.com/fcrepo/fcrepo/pull/1740#discussion_r468626596", "createdAt": "2020-08-11T14:30:13Z", "author": {"login": "bbpennel"}, "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -853,8 +853,8 @@ private void assertMementoLink(final Link expected, final Link actual) {\n \n             final var expectedUri = expected.getUri().toString();\n             final var actualUri = actual.getUri().toString();\n-            assertEquals(expectedUri.substring(0, expectedUri.length() - 2),\n-                    actualUri.substring(0, actualUri.length() - 2));\n+            assertEquals(expectedUri.substring(0, expectedUri.length() - 3),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ad698bfab4edcf9098283a6afd52f4a538e981e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODYzNDI5NQ==", "bodyText": "Yes, it increased the wiggle room. It's not as good as it could be if the waits were longer, but I personally don't think it's worth inserting longer waits into the tests.\nThe comparison behavior works like this:\n\nIs the timestamp exactly what we expected?\n\nIf yes, we're done -- PASS\nIf no, continue\n\n\nAre the Instants within 5 seconds of each other?\n\nIf yes, continue\nIf no, we're done -- FAIL\n\n\nAre the first parts of the memento strings the same (this is the part I just modified)?\n\nIf yes, we're done -- PASS\nIf no, we're done -- FAIL\n\n\n\nSo, in the ideal case, the strings will match exactly. But, if they don't match, it checks to see that they're at least close and that they're formatted correctly.", "url": "https://github.com/fcrepo/fcrepo/pull/1740#discussion_r468634295", "createdAt": "2020-08-11T14:40:46Z", "author": {"login": "pwinckles"}, "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -853,8 +853,8 @@ private void assertMementoLink(final Link expected, final Link actual) {\n \n             final var expectedUri = expected.getUri().toString();\n             final var actualUri = actual.getUri().toString();\n-            assertEquals(expectedUri.substring(0, expectedUri.length() - 2),\n-                    actualUri.substring(0, actualUri.length() - 2));\n+            assertEquals(expectedUri.substring(0, expectedUri.length() - 3),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODYyNjU5Ng=="}, "originalCommit": {"oid": "0ad698bfab4edcf9098283a6afd52f4a538e981e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODY0OTcyNg==", "bodyText": "Thanks for the explanation, I hadn't followed it all the way through. That seems moderately safe, although there's obviously still some chance of false positive, but that seems outside the scope of this PR.", "url": "https://github.com/fcrepo/fcrepo/pull/1740#discussion_r468649726", "createdAt": "2020-08-11T15:01:18Z", "author": {"login": "bbpennel"}, "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -853,8 +853,8 @@ private void assertMementoLink(final Link expected, final Link actual) {\n \n             final var expectedUri = expected.getUri().toString();\n             final var actualUri = actual.getUri().toString();\n-            assertEquals(expectedUri.substring(0, expectedUri.length() - 2),\n-                    actualUri.substring(0, actualUri.length() - 2));\n+            assertEquals(expectedUri.substring(0, expectedUri.length() - 3),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODYyNjU5Ng=="}, "originalCommit": {"oid": "0ad698bfab4edcf9098283a6afd52f4a538e981e"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NDUzNTEwOnYy", "diffSide": "RIGHT", "path": "fcrepo-auth-webac/src/test/java/org/fcrepo/integration/auth/webac/LinuxTestIsolationExecutionListener.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMTo1Njo0NVrOHEUqxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNDowNjowMlrOHEumHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5NDk4MQ==", "bodyText": "We can likely delete this class, since the only use in the fcrepo-auth-webac module is actually referencing the copy of this class found in fcrepo-http-api.\nhttps://github.com/fcrepo4/fcrepo4/pull/1740/files#diff-cd44216a669bfca1b37f93a8ab06cf01R77", "url": "https://github.com/fcrepo/fcrepo/pull/1740#discussion_r474294981", "createdAt": "2020-08-20T21:56:45Z", "author": {"login": "awoods"}, "path": "fcrepo-auth-webac/src/test/java/org/fcrepo/integration/auth/webac/LinuxTestIsolationExecutionListener.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.integration.auth.webac;\n+\n+import edu.wisc.library.ocfl.api.MutableOcflRepository;\n+import org.apache.commons.lang3.SystemUtils;\n+import org.fcrepo.http.commons.test.util.ContainerWrapper;\n+import org.fcrepo.persistence.ocfl.RepositoryInitializer;\n+import org.springframework.test.context.TestContext;\n+import org.springframework.test.context.support.AbstractTestExecutionListener;\n+\n+/**\n+ * Listener that baselines the DB and OCFL repo between every test.\n+ * It does not baseline on Windows due to difficulties associated with deleting and immediately recreating directories.\n+ *\n+ * @author pwinckles\n+ */\n+public class LinuxTestIsolationExecutionListener extends AbstractTestExecutionListener {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "038e3ec23c16afe42d899e06b9f369ac8892dfab"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDcxOTc3Mg==", "bodyText": "Ah, I didn't realize that fcrepo-http-api was building a test jar.", "url": "https://github.com/fcrepo/fcrepo/pull/1740#discussion_r474719772", "createdAt": "2020-08-21T14:06:02Z", "author": {"login": "pwinckles"}, "path": "fcrepo-auth-webac/src/test/java/org/fcrepo/integration/auth/webac/LinuxTestIsolationExecutionListener.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.integration.auth.webac;\n+\n+import edu.wisc.library.ocfl.api.MutableOcflRepository;\n+import org.apache.commons.lang3.SystemUtils;\n+import org.fcrepo.http.commons.test.util.ContainerWrapper;\n+import org.fcrepo.persistence.ocfl.RepositoryInitializer;\n+import org.springframework.test.context.TestContext;\n+import org.springframework.test.context.support.AbstractTestExecutionListener;\n+\n+/**\n+ * Listener that baselines the DB and OCFL repo between every test.\n+ * It does not baseline on Windows due to difficulties associated with deleting and immediately recreating directories.\n+ *\n+ * @author pwinckles\n+ */\n+public class LinuxTestIsolationExecutionListener extends AbstractTestExecutionListener {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5NDk4MQ=="}, "originalCommit": {"oid": "038e3ec23c16afe42d899e06b9f369ac8892dfab"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NDU1OTAwOnYy", "diffSide": "RIGHT", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMjowNTo0NlrOHEU42Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQyMjowNTo0NlrOHEU42Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI5ODU4NQ==", "bodyText": "A comment here explaining the magic number (3) would be helpful to our future selves.", "url": "https://github.com/fcrepo/fcrepo/pull/1740#discussion_r474298585", "createdAt": "2020-08-20T22:05:46Z", "author": {"login": "awoods"}, "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraVersioningIT.java", "diffHunk": "@@ -853,8 +857,8 @@ private void assertMementoLink(final Link expected, final Link actual) {\n \n             final var expectedUri = expected.getUri().toString();\n             final var actualUri = actual.getUri().toString();\n-            assertEquals(expectedUri.substring(0, expectedUri.length() - 2),\n-                    actualUri.substring(0, actualUri.length() - 2));\n+            assertEquals(expectedUri.substring(0, expectedUri.length() - 3),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "038e3ec23c16afe42d899e06b9f369ac8892dfab"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2NzEyNDk4OnYy", "diffSide": "RIGHT", "path": ".travis.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxMzoyODo0NFrOHEtLGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNDowNzowM1rOHEuobg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY5NjQ3Mg==", "bodyText": "The profile name should match the name defined in the pom.xml: db-test (vs db-tests)", "url": "https://github.com/fcrepo/fcrepo/pull/1740#discussion_r474696472", "createdAt": "2020-08-21T13:28:44Z", "author": {"login": "awoods"}, "path": ".travis.yml", "diffHunk": "@@ -48,7 +106,8 @@ before_script:\n    fi\n     \n script:\n- - ./mvnw --settings .travis/settings.xml -Dgpg.skip -Dfcrepo.streaming.parallel=true install -B -V\n+ - if [ \"$ITEST\" != \"true\" ]; then ./mvnw --settings .travis/settings.xml -Dgpg.skip -Dfcrepo.streaming.parallel=true install -B -V; fi\n+ - if [ \"$ITEST\" = \"true\" ]; then ./mvnw -Dfcrepo.db.url=\"jdbc:${DB}://localhost:${DB_PORT}/fcrepo\" -Dfcrepo.db.user=\"travis\" -Dfcrepo.db.password=\"\" clean install -P db-tests; fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "038e3ec23c16afe42d899e06b9f369ac8892dfab"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDcyMDM2Ng==", "bodyText": "Thanks! I was baffled why the profile wasn't working on Travis and was hoping it'd magically start working after it was merged... \ud83d\ude01", "url": "https://github.com/fcrepo/fcrepo/pull/1740#discussion_r474720366", "createdAt": "2020-08-21T14:07:03Z", "author": {"login": "pwinckles"}, "path": ".travis.yml", "diffHunk": "@@ -48,7 +106,8 @@ before_script:\n    fi\n     \n script:\n- - ./mvnw --settings .travis/settings.xml -Dgpg.skip -Dfcrepo.streaming.parallel=true install -B -V\n+ - if [ \"$ITEST\" != \"true\" ]; then ./mvnw --settings .travis/settings.xml -Dgpg.skip -Dfcrepo.streaming.parallel=true install -B -V; fi\n+ - if [ \"$ITEST\" = \"true\" ]; then ./mvnw -Dfcrepo.db.url=\"jdbc:${DB}://localhost:${DB_PORT}/fcrepo\" -Dfcrepo.db.user=\"travis\" -Dfcrepo.db.password=\"\" clean install -P db-tests; fi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY5NjQ3Mg=="}, "originalCommit": {"oid": "038e3ec23c16afe42d899e06b9f369ac8892dfab"}, "originalPosition": 101}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1892, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}