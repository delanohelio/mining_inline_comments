{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyOTI0NzMw", "number": 1810, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozMDo1OVrOE9ov4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozMDo1OVrOE9ov4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMDY2MjExOnYy", "diffSide": "RIGHT", "path": "fcrepo-kernel-impl/src/main/java/org/fcrepo/kernel/impl/models/ResourceFactoryImpl.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxMzozMDo1OVrOH6bjIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxNDo1Mzo1M1rOH6eo2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzMDgxOQ==", "bodyText": "This code is only relevant when loading a container, correct? If so, I think we should only do this lookup when necessary.\nThis code would also be a good candidate for caching in the future.", "url": "https://github.com/fcrepo/fcrepo/pull/1810#discussion_r531030819", "createdAt": "2020-11-26T13:30:59Z", "author": {"login": "pwinckles"}, "path": "fcrepo-kernel-impl/src/main/java/org/fcrepo/kernel/impl/models/ResourceFactoryImpl.java", "diffHunk": "@@ -193,14 +194,18 @@ private FedoraResource instantiateResource(final String transactionId,\n         }\n     }\n \n-    private void populateResourceHeaders(final FedoraResourceImpl resc, final ResourceHeaders headers,\n-                                         final Instant version) {\n+    private void populateResourceHeaders(final String transactionId, final FedoraResourceImpl resc,\n+                                         final ResourceHeaders headers, final Instant version) {\n         resc.setCreatedBy(headers.getCreatedBy());\n         resc.setCreatedDate(headers.getCreatedDate());\n         resc.setLastModifiedBy(headers.getLastModifiedBy());\n         resc.setLastModifiedDate(headers.getLastModifiedDate());\n         resc.setParentId(headers.getParent());\n-        resc.setEtag(headers.getStateToken());\n+        final Instant containmentUpdated = containmentIndex.containmentLastUpdated(transactionId, resc.getFedoraId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9701cd98084752071169fd8e39d85c9e27831f55"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzMzE3OA==", "bodyText": "I'm guessing that there will be similar code to this for membership? It might be nice to abstract the etag computation out into its own class, but you don't necessarily need to do so here.", "url": "https://github.com/fcrepo/fcrepo/pull/1810#discussion_r531033178", "createdAt": "2020-11-26T13:35:08Z", "author": {"login": "pwinckles"}, "path": "fcrepo-kernel-impl/src/main/java/org/fcrepo/kernel/impl/models/ResourceFactoryImpl.java", "diffHunk": "@@ -193,14 +194,18 @@ private FedoraResource instantiateResource(final String transactionId,\n         }\n     }\n \n-    private void populateResourceHeaders(final FedoraResourceImpl resc, final ResourceHeaders headers,\n-                                         final Instant version) {\n+    private void populateResourceHeaders(final String transactionId, final FedoraResourceImpl resc,\n+                                         final ResourceHeaders headers, final Instant version) {\n         resc.setCreatedBy(headers.getCreatedBy());\n         resc.setCreatedDate(headers.getCreatedDate());\n         resc.setLastModifiedBy(headers.getLastModifiedBy());\n         resc.setLastModifiedDate(headers.getLastModifiedDate());\n         resc.setParentId(headers.getParent());\n-        resc.setEtag(headers.getStateToken());\n+        final Instant containmentUpdated = containmentIndex.containmentLastUpdated(transactionId, resc.getFedoraId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzMDgxOQ=="}, "originalCommit": {"oid": "9701cd98084752071169fd8e39d85c9e27831f55"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTA4MTQzMg==", "bodyText": "One of the reasons I liked the previous implementation is that if the containment didn't change then neither did the eTag. But this was more consistent across DBs. Perhaps we just need to stream all containment and generate a hash in code rather than trying to do it in the database.", "url": "https://github.com/fcrepo/fcrepo/pull/1810#discussion_r531081432", "createdAt": "2020-11-26T14:53:53Z", "author": {"login": "whikloj"}, "path": "fcrepo-kernel-impl/src/main/java/org/fcrepo/kernel/impl/models/ResourceFactoryImpl.java", "diffHunk": "@@ -193,14 +194,18 @@ private FedoraResource instantiateResource(final String transactionId,\n         }\n     }\n \n-    private void populateResourceHeaders(final FedoraResourceImpl resc, final ResourceHeaders headers,\n-                                         final Instant version) {\n+    private void populateResourceHeaders(final String transactionId, final FedoraResourceImpl resc,\n+                                         final ResourceHeaders headers, final Instant version) {\n         resc.setCreatedBy(headers.getCreatedBy());\n         resc.setCreatedDate(headers.getCreatedDate());\n         resc.setLastModifiedBy(headers.getLastModifiedBy());\n         resc.setLastModifiedDate(headers.getLastModifiedDate());\n         resc.setParentId(headers.getParent());\n-        resc.setEtag(headers.getStateToken());\n+        final Instant containmentUpdated = containmentIndex.containmentLastUpdated(transactionId, resc.getFedoraId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTAzMDgxOQ=="}, "originalCommit": {"oid": "9701cd98084752071169fd8e39d85c9e27831f55"}, "originalPosition": 47}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1728, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}