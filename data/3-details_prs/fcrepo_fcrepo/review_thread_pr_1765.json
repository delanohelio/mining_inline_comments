{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NTcxODM3", "number": 1765, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQyMDoxNDo1OFrOEq578w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMDo1NDo1OVrOErWprQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzNDI0ODgzOnYy", "diffSide": "RIGHT", "path": "fcrepo-http-api/src/main/java/org/fcrepo/http/api/FedoraLdp.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQyMDoxNDo1OFrOHdYTcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQyMDoxNDo1OFrOHdYTcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2ODk0NQ==", "bodyText": "Maybe change \"immutable node\" to \"immutable resource\"?", "url": "https://github.com/fcrepo/fcrepo/pull/1765#discussion_r500568945", "createdAt": "2020-10-06T20:14:58Z", "author": {"login": "awoods"}, "path": "fcrepo-http-api/src/main/java/org/fcrepo/http/api/FedoraLdp.java", "diffHunk": "@@ -404,6 +405,10 @@ public Response createOrReplaceObjectRdf(\n             //}\n         }\n \n+        if (isGhostNode(transaction(), fedoraId)) {\n+            throw new GhostNodeException(\"Resource path \" + externalPath() + \" is an immutable node.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa46232ca6f8f4f74deecef52dddd5666abd2de5"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzNDI2ODY0OnYy", "diffSide": "RIGHT", "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/models/ResourceFactory.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQyMDoyMDo1MlrOHdYfhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMzoxOTo0MFrOHdy7tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU3MjAzOA==", "bodyText": "This seems more like a method that would be on FedoraResource than ResourceFactory.\n..such as isAcl() and isMemento().", "url": "https://github.com/fcrepo/fcrepo/pull/1765#discussion_r500572038", "createdAt": "2020-10-06T20:20:52Z", "author": {"login": "awoods"}, "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/models/ResourceFactory.java", "diffHunk": "@@ -112,4 +112,17 @@ public FedoraResource getResource(final String transactionId, final FedoraId fed\n      * @return Stream of child resources\n      */\n     public Stream<FedoraResource> getChildren(final String transactionId, final FedoraId resourceId);\n+\n+    /**\n+     * Is the resource a \"ghost node\". Ghost nodes are defined as a resource that does not exist, but whose URI is part\n+     * of the URI of another resource? For example:\n+     *\n+     * http://localhost/rest/a/b - does exist\n+     * http://localhost/rest/a - does not exist and is therefore a ghost node.\n+     *\n+     * @param transaction The transaction\n+     * @param resourceId Identifier of the resource\n+     * @return Whether the resource does not exist, but has\n+     */\n+    public boolean isGhostNode(final Transaction transaction, final FedoraId resourceId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa46232ca6f8f4f74deecef52dddd5666abd2de5"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk5OTM0Mw==", "bodyText": "The use of isGhostNode in the mintNewPid, seems to make adding this method to FedoraResource make less sense. Alternatively I can move the actual check down to the AbstractService which also has access to the ContainmentIndex.", "url": "https://github.com/fcrepo/fcrepo/pull/1765#discussion_r500999343", "createdAt": "2020-10-07T13:11:33Z", "author": {"login": "whikloj"}, "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/models/ResourceFactory.java", "diffHunk": "@@ -112,4 +112,17 @@ public FedoraResource getResource(final String transactionId, final FedoraId fed\n      * @return Stream of child resources\n      */\n     public Stream<FedoraResource> getChildren(final String transactionId, final FedoraId resourceId);\n+\n+    /**\n+     * Is the resource a \"ghost node\". Ghost nodes are defined as a resource that does not exist, but whose URI is part\n+     * of the URI of another resource? For example:\n+     *\n+     * http://localhost/rest/a/b - does exist\n+     * http://localhost/rest/a - does not exist and is therefore a ghost node.\n+     *\n+     * @param transaction The transaction\n+     * @param resourceId Identifier of the resource\n+     * @return Whether the resource does not exist, but has\n+     */\n+    public boolean isGhostNode(final Transaction transaction, final FedoraId resourceId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU3MjAzOA=="}, "originalCommit": {"oid": "fa46232ca6f8f4f74deecef52dddd5666abd2de5"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTAwNTIzOQ==", "bodyText": "Actually the use of isGhostNode in the mintNewPid means this needs to exist here, because in that case we don't fail we just mint a new pid. So I think the current location is best and the use of ResourceFactory is just because we don't Inject the ContainmentIndex to the Http layer.", "url": "https://github.com/fcrepo/fcrepo/pull/1765#discussion_r501005239", "createdAt": "2020-10-07T13:19:40Z", "author": {"login": "whikloj"}, "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/models/ResourceFactory.java", "diffHunk": "@@ -112,4 +112,17 @@ public FedoraResource getResource(final String transactionId, final FedoraId fed\n      * @return Stream of child resources\n      */\n     public Stream<FedoraResource> getChildren(final String transactionId, final FedoraId resourceId);\n+\n+    /**\n+     * Is the resource a \"ghost node\". Ghost nodes are defined as a resource that does not exist, but whose URI is part\n+     * of the URI of another resource? For example:\n+     *\n+     * http://localhost/rest/a/b - does exist\n+     * http://localhost/rest/a - does not exist and is therefore a ghost node.\n+     *\n+     * @param transaction The transaction\n+     * @param resourceId Identifier of the resource\n+     * @return Whether the resource does not exist, but has\n+     */\n+    public boolean isGhostNode(final Transaction transaction, final FedoraId resourceId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU3MjAzOA=="}, "originalCommit": {"oid": "fa46232ca6f8f4f74deecef52dddd5666abd2de5"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzNDI3OTU0OnYy", "diffSide": "RIGHT", "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/ContainmentIndex.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQyMDoyNDoxNVrOHdYmXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMzoxNDoyMlrOHdysDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU3Mzc5MQ==", "bodyText": "Maybe as a separate clean-up task, this interface should normalize on using ID or Id. Currently it is a complete mix.", "url": "https://github.com/fcrepo/fcrepo/pull/1765#discussion_r500573791", "createdAt": "2020-10-06T20:24:15Z", "author": {"login": "awoods"}, "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/ContainmentIndex.java", "diffHunk": "@@ -124,4 +124,11 @@\n      */\n     void reset();\n \n+    /**\n+     * Find whether there are any resources that starts with the ID provided.\n+     * @param txID The transaction id, or null if no transaction.\n+     * @param fedoraId The ID to use to look for other IDs.\n+     * @return Are there any matching IDs.\n+     */\n+    boolean hasResourcesStartingWith(final String txID, final FedoraId fedoraId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa46232ca6f8f4f74deecef52dddd5666abd2de5"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTAwMTIyOA==", "bodyText": "I'll clean it up now.", "url": "https://github.com/fcrepo/fcrepo/pull/1765#discussion_r501001228", "createdAt": "2020-10-07T13:14:22Z", "author": {"login": "whikloj"}, "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/ContainmentIndex.java", "diffHunk": "@@ -124,4 +124,11 @@\n      */\n     void reset();\n \n+    /**\n+     * Find whether there are any resources that starts with the ID provided.\n+     * @param txID The transaction id, or null if no transaction.\n+     * @param fedoraId The ID to use to look for other IDs.\n+     * @return Are there any matching IDs.\n+     */\n+    boolean hasResourcesStartingWith(final String txID, final FedoraId fedoraId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU3Mzc5MQ=="}, "originalCommit": {"oid": "fa46232ca6f8f4f74deecef52dddd5666abd2de5"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzODk1MzQxOnYy", "diffSide": "RIGHT", "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/ContainmentIndex.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMDo1NDo1OVrOHeFLfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMDo1ODo0NlrOHeFS-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMwNDE5MQ==", "bodyText": "Very minor: one last fedoraID", "url": "https://github.com/fcrepo/fcrepo/pull/1765#discussion_r501304191", "createdAt": "2020-10-07T20:54:59Z", "author": {"login": "awoods"}, "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/ContainmentIndex.java", "diffHunk": "@@ -105,23 +105,30 @@\n     /**\n      * Check if the resourceID exists in the containment index. Which should mean it exists.\n      *\n-     * @param txID The transaction id, or null if no transaction\n+     * @param txId The transaction id, or null if no transaction\n      * @param fedoraID The resource's FedoraId.\n      * @return True if it is in the index.\n      */\n-    boolean resourceExists(final String txID, final FedoraId fedoraID);\n+    boolean resourceExists(final String txId, final FedoraId fedoraID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7a04639480f9ed71e013e16d1f075b625d086b0"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMwNjEwNw==", "bodyText": "Doh \ud83e\udd26", "url": "https://github.com/fcrepo/fcrepo/pull/1765#discussion_r501306107", "createdAt": "2020-10-07T20:58:46Z", "author": {"login": "whikloj"}, "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/ContainmentIndex.java", "diffHunk": "@@ -105,23 +105,30 @@\n     /**\n      * Check if the resourceID exists in the containment index. Which should mean it exists.\n      *\n-     * @param txID The transaction id, or null if no transaction\n+     * @param txId The transaction id, or null if no transaction\n      * @param fedoraID The resource's FedoraId.\n      * @return True if it is in the index.\n      */\n-    boolean resourceExists(final String txID, final FedoraId fedoraID);\n+    boolean resourceExists(final String txId, final FedoraId fedoraID);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMwNDE5MQ=="}, "originalCommit": {"oid": "c7a04639480f9ed71e013e16d1f075b625d086b0"}, "originalPosition": 66}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1679, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}