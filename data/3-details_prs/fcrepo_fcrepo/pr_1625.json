{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwNDYyNjQ2", "number": 1625, "title": "Automatic rebuild of Fedora to OCFL Index on start", "bodyText": "Automatic rebuild of Fedora to OCFL Index on start\n\nJIRA Ticket: https://jira.lyrasis.org/browse/FCREPO-3195\n\nOther Relevant Links (Mailing list discussion, related pull requests, etc.)\n\nWhat does this Pull Request do?\nEnables automatic rebuild on start when fedora to ocfl index file is not present.\nWhat's new?\n\nFedoraToOCFLIndexUtil component which implements the index rebuild logic.\nIntegration test covering the functionality.\nMinor related fixes.\nUpdate to the ocfl-java client to support the new feature.\n\nHow should this be tested?\n# fire up fedora\njava -Dfcrepo.ocfl.staging.dir=target/fcrepo-data/staging -Dfcrepo.ocfl.storage.root.dir=target/fcrepo-data/ocfl-root -Dfcrepo.ocfl.work.dir=target/fcrepo-data/work  -jar fcrepo-webapp/target/fcrepo-webapp-6.0.0-SNAPSHOT-jetty-console.jar --headless\n\n#  create a resource\ncurl -u fedoraAdmin:fedoraAdmin http://localhost:8080/rest/test -v  -H \"Content-Type: text/turtle\"  -X PUT --data \"<> <http://purl.org/dc/elements/1.1/title> 'My Test RDF'\"\n# kill fedora process\n\n# delete the work directory\nrm -rf target/fcrepo-data/work\n\n# restart fedora\n\n# verify the resource is accessible\ncurl -u fedoraAdmin:fedoraAdmin http://localhost:8080/rest/test -i\n\n\nAdditional Notes:\nAny additional information that you think would be helpful when reviewing this PR.\nInterested parties\nTag (@ mention) interested parties or, if unsure, @fcrepo4/committers", "createdAt": "2020-02-03T18:38:47Z", "url": "https://github.com/fcrepo/fcrepo/pull/1625", "merged": true, "mergeCommit": {"oid": "88a3ee0973a85eca1a73286d3c1645b7a9c7d79a"}, "closed": true, "closedAt": "2020-02-13T15:23:34Z", "author": {"login": "dbernstein"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcAxRw5AH2gAyMzcwNDYyNjQ2OjkwNDUxYjJlNGE0MzE5NjAxZmY4YTRlYTU5M2RhYTc0NzgzNzE4Zjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcD8lTLAFqTM1ODMwNDkzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "90451b2e4a4319601ff8a4ea593daa74783718f8", "author": {"user": {"login": "dbernstein", "name": "dbernstein"}}, "url": "https://github.com/fcrepo/fcrepo/commit/90451b2e4a4319601ff8a4ea593daa74783718f8", "committedDate": "2020-02-03T18:30:50Z", "message": "Enables automatic rebuild on start when fedora to ocfl index file is not present.\nResolves: https://jira.lyrasis.org/browse/FCREPO-3195"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNTA0MzAz", "url": "https://github.com/fcrepo/fcrepo/pull/1625#pullrequestreview-352504303", "createdAt": "2020-02-03T19:29:11Z", "commit": {"oid": "90451b2e4a4319601ff8a4ea593daa74783718f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxOToyOToxMlrOFk9K_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QxOToyOToxMlrOFk9K_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI5NTI5NQ==", "bodyText": "The stream should be closed when you're done with it.\ntry (final Stream ocflIds = ocflReposiotry.listObjectIds()) {\n}\nshould do the trick.", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r374295295", "createdAt": "2020-02-03T19:29:12Z", "author": {"login": "pwinckles"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/FedoraToOCFLObjectIndexUtilImpl.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import edu.wisc.library.ocfl.api.OcflRepository;\n+import org.fcrepo.kernel.api.exception.RepositoryRuntimeException;\n+import org.fcrepo.persistence.api.exceptions.PersistentStorageException;\n+import org.fcrepo.persistence.ocfl.api.FedoraToOCFLObjectIndex;\n+import org.fcrepo.persistence.ocfl.api.FedoraToOCFLObjectIndexUtil;\n+import org.fcrepo.persistence.ocfl.api.OCFLObjectSessionFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+import javax.inject.Inject;\n+\n+import java.util.stream.Stream;\n+\n+import static org.fcrepo.persistence.common.ResourceHeaderSerializationUtils.deserializeHeaders;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.getSidecarSubpath;\n+\n+/**\n+ * An implementation of {@link FedoraToOCFLObjectIndexUtil}\n+ *\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+@Component\n+public class FedoraToOCFLObjectIndexUtilImpl implements FedoraToOCFLObjectIndexUtil {\n+\n+    private static Logger LOGGER = LoggerFactory.getLogger(FedoraToOCFLObjectIndexUtilImpl.class);\n+\n+    @Inject\n+    private OCFLObjectSessionFactory objectSessionFactory;\n+\n+    @Inject\n+    private FedoraToOCFLObjectIndex fedoraToOCFLObjectIndex;\n+\n+    @Inject\n+    private OcflRepository ocflRepository;\n+\n+    /**\n+     * Default constructor\n+     */\n+    public FedoraToOCFLObjectIndexUtilImpl() {\n+    }\n+\n+\n+    @Override\n+    public void rebuild() {\n+\n+        final Stream<String> ocflIds = ocflRepository.listObjectIds();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90451b2e4a4319601ff8a4ea593daa74783718f8"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68f721f18faaef0dbf156e73b691f75c8af30380", "author": {"user": {"login": "dbernstein", "name": "dbernstein"}}, "url": "https://github.com/fcrepo/fcrepo/commit/68f721f18faaef0dbf156e73b691f75c8af30380", "committedDate": "2020-02-06T15:36:07Z", "message": "Ensures ocfl id stream is closed properly."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NTk3OTcw", "url": "https://github.com/fcrepo/fcrepo/pull/1625#pullrequestreview-354597970", "createdAt": "2020-02-06T16:37:09Z", "commit": {"oid": "68f721f18faaef0dbf156e73b691f75c8af30380"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNjozNzowOVrOFmh-zQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNjozNzowOVrOFmh-zQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk0Njk1Nw==", "bodyText": "An empty public constructor is implicit and can be removed here.", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r375946957", "createdAt": "2020-02-06T16:37:09Z", "author": {"login": "awoods"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/FedoraToOCFLObjectIndexUtilImpl.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import edu.wisc.library.ocfl.api.OcflRepository;\n+import org.fcrepo.kernel.api.exception.RepositoryRuntimeException;\n+import org.fcrepo.persistence.api.exceptions.PersistentStorageException;\n+import org.fcrepo.persistence.ocfl.api.FedoraToOCFLObjectIndex;\n+import org.fcrepo.persistence.ocfl.api.FedoraToOCFLObjectIndexUtil;\n+import org.fcrepo.persistence.ocfl.api.OCFLObjectSessionFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+import javax.inject.Inject;\n+\n+import static org.fcrepo.persistence.common.ResourceHeaderSerializationUtils.deserializeHeaders;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.getSidecarSubpath;\n+\n+/**\n+ * An implementation of {@link FedoraToOCFLObjectIndexUtil}\n+ *\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+@Component\n+public class FedoraToOCFLObjectIndexUtilImpl implements FedoraToOCFLObjectIndexUtil {\n+\n+    private static Logger LOGGER = LoggerFactory.getLogger(FedoraToOCFLObjectIndexUtilImpl.class);\n+\n+    @Inject\n+    private OCFLObjectSessionFactory objectSessionFactory;\n+\n+    @Inject\n+    private FedoraToOCFLObjectIndex fedoraToOCFLObjectIndex;\n+\n+    @Inject\n+    private OcflRepository ocflRepository;\n+\n+    /**\n+     * Default constructor\n+     */\n+    public FedoraToOCFLObjectIndexUtilImpl() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68f721f18faaef0dbf156e73b691f75c8af30380"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0416872f7988460cc67b18f2123847e4d3aeafe2", "author": {"user": {"login": "dbernstein", "name": "dbernstein"}}, "url": "https://github.com/fcrepo/fcrepo/commit/0416872f7988460cc67b18f2123847e4d3aeafe2", "committedDate": "2020-02-10T19:09:56Z", "message": "Remove implied empty default constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "author": {"user": {"login": "dbernstein", "name": "dbernstein"}}, "url": "https://github.com/fcrepo/fcrepo/commit/7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc", "committedDate": "2020-02-11T06:49:00Z", "message": "Ensures that binaries and nested ocfl resources are included in the rebuild."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2OTU5MjQ1", "url": "https://github.com/fcrepo/fcrepo/pull/1625#pullrequestreview-356959245", "createdAt": "2020-02-11T20:09:41Z", "commit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMDowOTo0MVrOFoXakg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQyMToxNjo1MlrOFoZYWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg3MDk5NA==", "bodyText": "space", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377870994", "createdAt": "2020-02-11T20:09:41Z", "author": {"login": "bbpennel"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/RepositoryInitializer.java", "diffHunk": "@@ -58,6 +71,12 @@ public void initialize() {\n         final PersistentStorageSession session = this.sessionManager.getSession(\"initializationSession\" +\n                                                                                  System.currentTimeMillis());\n \n+        if(!FEDORA_TO_OCFL_INDEX_FILE.exists()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg3NjIwNw==", "bodyText": "This isn't being used in this class", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377876207", "createdAt": "2020-02-11T20:21:15Z", "author": {"login": "bbpennel"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/RepositoryInitializer.java", "diffHunk": "@@ -49,6 +53,15 @@\n     @Inject\n     private RdfSourceOperationFactory operationFactory;\n \n+    @Inject\n+    private FedoraToOCFLObjectIndex fedoraToOCFLObjectIndex;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg3NjI1NA==", "bodyText": "This isn't being used in this class", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377876254", "createdAt": "2020-02-11T20:21:20Z", "author": {"login": "bbpennel"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/RepositoryInitializer.java", "diffHunk": "@@ -49,6 +53,15 @@\n     @Inject\n     private RdfSourceOperationFactory operationFactory;\n \n+    @Inject\n+    private FedoraToOCFLObjectIndex fedoraToOCFLObjectIndex;\n+\n+    @Inject\n+    private FedoraToOCFLObjectIndexUtil fedoraToOCFLObjectIndexUtil;\n+\n+    @Inject\n+    private OCFLObjectSessionFactory objectSessionFactory;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4NjEwNQ==", "bodyText": "You're welcome to disagree, but even though java is pretty lose with conventions, in my experience Util usually denotes a class containing static utility methods. That seems to be the case in the fedora codebase too (See FedoraIdUtils, OCFLPersistentStorageUtils, StreamUtils, ResourceHeaderSerializationUtils, etc).\nBased on your javadoc here, I wonder if FedoraToOCFLObjectIndexManager might be better", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377886105", "createdAt": "2020-02-11T20:41:54Z", "author": {"login": "bbpennel"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/api/FedoraToOCFLObjectIndexUtil.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.api;\n+\n+\n+/**\n+ * Utility for managing the FedoraToOCFLObjectIndex.\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+public interface FedoraToOCFLObjectIndexUtil {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4NjM2Mg==", "bodyText": "fix indent", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377886362", "createdAt": "2020-02-11T20:42:24Z", "author": {"login": "bbpennel"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/DefaultOCFLObjectSessionFactory.java", "diffHunk": "@@ -56,31 +54,20 @@\n      * are not set, default directories will be created in java.io.tmpdir.\n      */\n     public DefaultOCFLObjectSessionFactory() {\n-        this(STAGING_DIR, OCFL_STORAGE_ROOT_DIR, OCFL_WORK_DIR);\n+        this(STAGING_DIR);\n     }\n \n     /**\n      * Constructor\n      *\n      * @param ocflStagingDir     The OCFL staging directory\n-     * @param ocflStorageRootDir The OCFL storage root directory\n-     * @param ocflWorkDir        The OCFL work directory\n      */\n-    public DefaultOCFLObjectSessionFactory(final File ocflStagingDir, final File ocflStorageRootDir,\n-                                           final File ocflWorkDir) {\n-        LOGGER.info(\"Fedora OCFL persistence directories:\\n- {}\\n- {}\\n- {}\",\n-                ocflStagingDir, ocflStorageRootDir, ocflWorkDir);\n+    public DefaultOCFLObjectSessionFactory(final File ocflStagingDir) {\n+        LOGGER.info(\"Fedora OCFL persistence staging directory:\\n- {}\",\n+                ocflStagingDir);\n \n         ocflStagingDir.mkdirs();\n-        ocflStorageRootDir.mkdirs();\n-        ocflWorkDir.mkdirs();\n-\n-        this.ocflStagingDir = ocflStagingDir;\n-        this.ocflRepository = new OcflRepositoryBuilder()\n-                .layoutConfig(DefaultLayoutConfig.nTupleHashConfig())\n-                .buildMutable(FileSystemOcflStorage.builder().build(\n-                        ocflStorageRootDir.toPath()), ocflWorkDir.toPath());\n-\n+       this.ocflStagingDir = ocflStagingDir;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg4NzA4OQ==", "bodyText": "This isn't being used", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377887089", "createdAt": "2020-02-11T20:43:58Z", "author": {"login": "bbpennel"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/FedoraToOCFLObjectIndexImpl.java", "diffHunk": "@@ -47,6 +48,9 @@\n \n     private Map<String, FedoraOCFLMapping> fedoraOCFLMappingMap = Collections.synchronizedMap(new HashMap<>());\n \n+    @Inject\n+    private OCFLObjectSessionFactory objectSessionFactory;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg5MjU1MQ==", "bodyText": "Its probably premature to worry about efficiency here, but might as well mention that the sidecar files are isolated in a single subdirectory the OCFL object. So it seems like the ocfl client would have to walk and return at least double the number of files it would if we were able to ask the client for a subpath of the object.", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377892551", "createdAt": "2020-02-11T20:55:02Z", "author": {"login": "bbpennel"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/FedoraToOCFLObjectIndexUtilImpl.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import edu.wisc.library.ocfl.api.OcflRepository;\n+import org.fcrepo.kernel.api.exception.RepositoryRuntimeException;\n+import org.fcrepo.persistence.api.exceptions.PersistentStorageException;\n+import org.fcrepo.persistence.ocfl.api.FedoraToOCFLObjectIndex;\n+import org.fcrepo.persistence.ocfl.api.FedoraToOCFLObjectIndexUtil;\n+import org.fcrepo.persistence.ocfl.api.OCFLObjectSessionFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+import javax.inject.Inject;\n+\n+import static java.lang.String.format;\n+import static org.fcrepo.persistence.common.ResourceHeaderSerializationUtils.deserializeHeaders;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.getSidecarSubpath;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.isSidecarSubpath;\n+\n+/**\n+ * An implementation of {@link FedoraToOCFLObjectIndexUtil}\n+ *\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+@Component\n+public class FedoraToOCFLObjectIndexUtilImpl implements FedoraToOCFLObjectIndexUtil {\n+\n+    private static Logger LOGGER = LoggerFactory.getLogger(FedoraToOCFLObjectIndexUtilImpl.class);\n+\n+    @Inject\n+    private OCFLObjectSessionFactory objectSessionFactory;\n+\n+    @Inject\n+    private FedoraToOCFLObjectIndex fedoraToOCFLObjectIndex;\n+\n+    @Inject\n+    private OcflRepository ocflRepository;\n+\n+    @Override\n+    public void rebuild() {\n+\n+        LOGGER.info(\"Initiating index rebuild.\");\n+        fedoraToOCFLObjectIndex.reset();\n+        LOGGER.debug(\"Reading object ids...\");\n+        try (final var ocflIds = ocflRepository.listObjectIds()) {\n+            ocflIds.forEach(ocflId -> {\n+                LOGGER.debug(\"Reading {}\", ocflId);\n+                final var objSession = objectSessionFactory.create(ocflId, null);\n+\n+                //list all the subpaths\n+                try (final var subpaths = objSession.listHeadSubpaths()) {\n+\n+                    //but first resolve the root identifier\n+                    final var sidecarSubpath = getSidecarSubpath(ocflId);\n+                    final var rootHeaders = deserializeHeaders(objSession.read(sidecarSubpath));\n+                    final var fedoraRootIdentifier = rootHeaders.getId();\n+\n+                    subpaths.forEach(subpath -> {\n+                        if (isSidecarSubpath(subpath)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkwMDIzOA==", "bodyText": "not used", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377900238", "createdAt": "2020-02-11T21:10:35Z", "author": {"login": "bbpennel"}, "path": "fcrepo-persistence-ocfl/src/test/java/org/fcrepo/persistence/ocfl/impl/FedoraToOCFLObjectIndexUtilImplTest.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import org.fcrepo.kernel.api.operations.CreateResourceOperation;\n+import org.fcrepo.kernel.api.operations.NonRdfSourceOperation;\n+import org.fcrepo.kernel.api.operations.RdfSourceOperation;\n+import org.fcrepo.persistence.ocfl.api.FedoraOCFLMappingNotFoundException;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import java.io.ByteArrayInputStream;\n+\n+import static org.fcrepo.kernel.api.operations.ResourceOperationType.CREATE;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.createRepository;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.fail;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+import static org.mockito.Mockito.withSettings;\n+import static org.springframework.test.util.ReflectionTestUtils.setField;\n+\n+/**\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+public class FedoraToOCFLObjectIndexUtilImplTest {\n+\n+    private static final String RESOURCE_ID_1 = \"info:fedora/resource\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkwMTc5OA==", "bodyText": "not currently being used", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377901798", "createdAt": "2020-02-11T21:13:52Z", "author": {"login": "bbpennel"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/OCFLPersistenceConfig.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import edu.wisc.library.ocfl.api.MutableOcflRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+import static org.fcrepo.persistence.ocfl.impl.OCFLConstants.OCFL_STORAGE_ROOT_DIR;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLConstants.OCFL_WORK_DIR;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.createRepository;\n+\n+/**\n+ * A Configuration for OCFL dependencies\n+ *\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+\n+@Configuration\n+public class OCFLPersistenceConfig {\n+\n+    private static final Logger log = LoggerFactory.getLogger(OCFLPersistenceConfig.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkwMzE5NA==", "bodyText": "I don't think this is doing anything and can be removed", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r377903194", "createdAt": "2020-02-11T21:16:52Z", "author": {"login": "bbpennel"}, "path": "fcrepo-persistence-ocfl/src/test/java/org/fcrepo/persistence/ocfl/impl/FedoraToOCFLObjectIndexUtilImplTest.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import org.fcrepo.kernel.api.operations.CreateResourceOperation;\n+import org.fcrepo.kernel.api.operations.NonRdfSourceOperation;\n+import org.fcrepo.kernel.api.operations.RdfSourceOperation;\n+import org.fcrepo.persistence.ocfl.api.FedoraOCFLMappingNotFoundException;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import java.io.ByteArrayInputStream;\n+\n+import static org.fcrepo.kernel.api.operations.ResourceOperationType.CREATE;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.createRepository;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.fail;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+import static org.mockito.Mockito.withSettings;\n+import static org.springframework.test.util.ReflectionTestUtils.setField;\n+\n+/**\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+public class FedoraToOCFLObjectIndexUtilImplTest {\n+\n+    private static final String RESOURCE_ID_1 = \"info:fedora/resource\";\n+\n+    @Rule\n+    public TemporaryFolder tempFolder = new TemporaryFolder();\n+\n+    @Test\n+    public void testRebuild() throws Exception {\n+\n+        final var repoDir = tempFolder.newFolder(\"ocfl-repo\");\n+        final var workDir = tempFolder.newFolder(\"ocfl-work\");\n+        final var staging = tempFolder.newFolder(\"ocfl-staging\");\n+        final var repository = createRepository(repoDir, workDir);\n+\n+        final var index = new FedoraToOCFLObjectIndexImpl();\n+\n+        final var ocflObjectSessionFactory = new DefaultOCFLObjectSessionFactory(staging);\n+        setField(ocflObjectSessionFactory, \"ocflRepository\", repository);\n+\n+        final var sessionManager = new OCFLPersistentSessionManager();\n+        setField(sessionManager, \"fedoraOcflIndex\", index);\n+        setField(sessionManager, \"objectSessionFactory\", ocflObjectSessionFactory);\n+\n+        final var util = new FedoraToOCFLObjectIndexUtilImpl();\n+        setField(util, \"ocflRepository\", repository);\n+        setField(util, \"fedoraToOCFLObjectIndex\", index);\n+        setField(util, \"objectSessionFactory\", ocflObjectSessionFactory);\n+\n+        final var session1Id = \"session1\";\n+        final var resource1 = \"info:fedora/resource1\";\n+        final var resource2 =  resource1 + \"/resource2\";\n+\n+        final var session = sessionManager.getSession(session1Id);\n+\n+        final var operation = mock(RdfSourceOperation.class, withSettings().extraInterfaces(\n+                CreateResourceOperation.class));\n+        when(operation.getResourceId()).thenReturn(resource1);\n+        when(operation.getType()).thenReturn(CREATE);\n+        when(((CreateResourceOperation)operation).isArchivalGroup()).thenReturn(true);\n+        session.persist(operation);\n+\n+        final var operation2 = mock(NonRdfSourceOperation.class, withSettings().extraInterfaces(\n+                CreateResourceOperation.class));\n+        when(operation2.getResourceId()).thenReturn(resource2);\n+        when(operation2.getType()).thenReturn(CREATE);\n+        final var bytes = \"test\".getBytes();\n+        final var stream = new ByteArrayInputStream(bytes);\n+        when(operation2.getContentSize()).thenReturn((long)bytes.length);\n+        when(operation2.getContentStream()).thenReturn(stream);\n+        when(operation2.getMimeType()).thenReturn(\"text/plain\");\n+        when(operation2.getFilename()).thenReturn(\"test\");\n+        when(((CreateResourceOperation)operation2).getParentId()).thenReturn(resource1);\n+        session.persist(operation2);\n+        session.commit();\n+        assertNotNull(index.getMapping(resource1));\n+        index.reset();\n+\n+        try {\n+            index.getMapping(resource1);\n+            fail(resource1 + \" should not exist in index\");\n+        } catch (final FedoraOCFLMappingNotFoundException e) {\n+            //do nothing - expected\n+        }\n+\n+        ocflObjectSessionFactory.create(resource1, session1Id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 108}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MTYxNDE0", "url": "https://github.com/fcrepo/fcrepo/pull/1625#pullrequestreview-357161414", "createdAt": "2020-02-12T03:00:11Z", "commit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwMzowMDoxMVrOFogXEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwNDozNjoyNFrOFohi7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAxNzU1Mw==", "bodyText": "Remove newline.", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378017553", "createdAt": "2020-02-12T03:00:11Z", "author": {"login": "awoods"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/api/OCFLObjectSession.java", "diffHunk": "@@ -123,5 +125,17 @@\n      * The instant at which the session was created.\n      * @return\n      */\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAxNzYwMw==", "bodyText": "Remove newline", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378017603", "createdAt": "2020-02-12T03:00:21Z", "author": {"login": "awoods"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/api/OCFLObjectSession.java", "diffHunk": "@@ -123,5 +125,17 @@\n      * The instant at which the session was created.\n      * @return\n      */\n+\n     Instant getCreated();\n-}\n\\ No newline at end of file\n+\n+    /**\n+     * Lists the subpaths associated with the HEAD (ie the latest committed state)\n+     *\n+     * @return the subpaths as a stream\n+     * @throws PersistentStorageException If subpaths cannot be listed due to the underlying session being closed\n+     *                                    or for some other reason.\n+     */\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAxNzg4Ng==", "bodyText": "Changes to this file can be reverted.", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378017886", "createdAt": "2020-02-12T03:01:37Z", "author": {"login": "awoods"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/api/OCFLObjectSessionFactory.java", "diffHunk": "@@ -31,4 +31,6 @@\n      * @return The newly created session.\n      */\n     OCFLObjectSession create(final String ocflId, final String persistentStorageSessionId);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNjI4Ng==", "bodyText": "Please add log message indicating location of storageRootDir and workDir.\n..like: https://github.com/fcrepo4/fcrepo4/pull/1625/files#diff-f2c25ea789161a21300d5fa03b8a3965L71-L72", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378036286", "createdAt": "2020-02-12T04:32:37Z", "author": {"login": "awoods"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/OCFLPersistentStorageUtils.java", "diffHunk": "@@ -338,4 +352,21 @@ public static String mintOCFLObjectId(final String fedoraIdentifier) {\n \n         return bareFedoraIdentifier;\n     }\n+\n+    /**\n+     * Create a new ocfl repository\n+     * @param ocflStorageRootDir The ocfl storage root directory\n+     * @param ocflWorkDir The ocfl work directory\n+     * @return the repository\n+     */\n+    public static MutableOcflRepository createRepository(final File ocflStorageRootDir, final File ocflWorkDir) {\n+        ocflStorageRootDir.mkdirs();\n+        ocflWorkDir.mkdirs();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNjk3Mw==", "bodyText": "Unit tests should only write test artifacts to the Maven module's target directory.", "url": "https://github.com/fcrepo/fcrepo/pull/1625#discussion_r378036973", "createdAt": "2020-02-12T04:36:24Z", "author": {"login": "awoods"}, "path": "fcrepo-persistence-ocfl/src/test/java/org/fcrepo/persistence/ocfl/impl/FedoraToOCFLObjectIndexUtilImplTest.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to DuraSpace under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional information\n+ * regarding copyright ownership.\n+ *\n+ * DuraSpace licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except in\n+ * compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.fcrepo.persistence.ocfl.impl;\n+\n+import org.fcrepo.kernel.api.operations.CreateResourceOperation;\n+import org.fcrepo.kernel.api.operations.NonRdfSourceOperation;\n+import org.fcrepo.kernel.api.operations.RdfSourceOperation;\n+import org.fcrepo.persistence.ocfl.api.FedoraOCFLMappingNotFoundException;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+import java.io.ByteArrayInputStream;\n+\n+import static org.fcrepo.kernel.api.operations.ResourceOperationType.CREATE;\n+import static org.fcrepo.persistence.ocfl.impl.OCFLPersistentStorageUtils.createRepository;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.fail;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+import static org.mockito.Mockito.withSettings;\n+import static org.springframework.test.util.ReflectionTestUtils.setField;\n+\n+/**\n+ * @author dbernstein\n+ * @since 6.0.0\n+ */\n+public class FedoraToOCFLObjectIndexUtilImplTest {\n+\n+    private static final String RESOURCE_ID_1 = \"info:fedora/resource\";\n+\n+    @Rule\n+    public TemporaryFolder tempFolder = new TemporaryFolder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fd0faab735bae53bca6bafd0f9ec2b62d2cb5cc"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5021bbebc6afdce5b6f77109168fd346a97f771", "author": {"user": {"login": "dbernstein", "name": "dbernstein"}}, "url": "https://github.com/fcrepo/fcrepo/commit/d5021bbebc6afdce5b6f77109168fd346a97f771", "committedDate": "2020-02-13T05:30:49Z", "message": "Fixes formatting issues and ensures unit test directory\nis both nested in target/ and is not destroyed after the test completes."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "30ab83ed7fdb71469a94a9d3c524b6307225e55b", "author": {"user": {"login": "dbernstein", "name": "dbernstein"}}, "url": "https://github.com/fcrepo/fcrepo/commit/30ab83ed7fdb71469a94a9d3c524b6307225e55b", "committedDate": "2020-02-13T00:15:53Z", "message": "Fixes formatting issues and ensures unit test directory\nis both nested in target/ and is not destroyed after the test completes."}, "afterCommit": {"oid": "d5021bbebc6afdce5b6f77109168fd346a97f771", "author": {"user": {"login": "dbernstein", "name": "dbernstein"}}, "url": "https://github.com/fcrepo/fcrepo/commit/d5021bbebc6afdce5b6f77109168fd346a97f771", "committedDate": "2020-02-13T05:30:49Z", "message": "Fixes formatting issues and ensures unit test directory\nis both nested in target/ and is not destroyed after the test completes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4MjM3OTg3", "url": "https://github.com/fcrepo/fcrepo/pull/1625#pullrequestreview-358237987", "createdAt": "2020-02-13T14:02:05Z", "commit": {"oid": "d5021bbebc6afdce5b6f77109168fd346a97f771"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4MzA0OTM2", "url": "https://github.com/fcrepo/fcrepo/pull/1625#pullrequestreview-358304936", "createdAt": "2020-02-13T15:22:54Z", "commit": {"oid": "d5021bbebc6afdce5b6f77109168fd346a97f771"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3223, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}