{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMzY4Nzk4", "number": 1657, "title": "fix concurrency bugs", "bodyText": "JIRA: https://jira.lyrasis.org/browse/FCREPO-3243\nWhat does this Pull Request do?\nFixes a few concurrency bugs in Fedora's ocfl code.\nInterested parties\n@fcrepo4/committers", "createdAt": "2020-04-07T16:16:49Z", "url": "https://github.com/fcrepo/fcrepo/pull/1657", "merged": true, "mergeCommit": {"oid": "99065fc9a7f4cda5a1d2c7edd46908282ffc9a81"}, "closed": true, "closedAt": "2020-04-08T16:05:53Z", "author": {"login": "pwinckles"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVVsisgH2gAyNDAwMzY4Nzk4OjAwOWI0NWIxNDU2OWYzNmZkYWIwNWM4Y2RjMmY0YjQwMWZjOGFkYTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVqI0MAFqTM5MDExNzI3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "009b45b14569f36fdab05c8cdc2f4b401fc8ada7", "author": {"user": {"login": "pwinckles", "name": "Peter Winckles"}}, "url": "https://github.com/fcrepo/fcrepo/commit/009b45b14569f36fdab05c8cdc2f4b401fc8ada7", "committedDate": "2020-04-07T16:15:09Z", "message": "fix concurrency bugs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NDYzMjM0", "url": "https://github.com/fcrepo/fcrepo/pull/1657#pullrequestreview-389463234", "createdAt": "2020-04-07T20:25:21Z", "commit": {"oid": "009b45b14569f36fdab05c8cdc2f4b401fc8ada7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMDoyNToyMVrOGCUuvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMDoyNToyMVrOGCUuvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA4OTk4MQ==", "bodyText": "Is this line needed as it is repeated inside the synchronized (this) { block? I feel like it was just an oversight?", "url": "https://github.com/fcrepo/fcrepo/pull/1657#discussion_r405089981", "createdAt": "2020-04-07T20:25:21Z", "author": {"login": "whikloj"}, "path": "fcrepo-persistence-ocfl/src/main/java/org/fcrepo/persistence/ocfl/impl/OCFLPersistentSessionManager.java", "diffHunk": "@@ -61,23 +61,20 @@ public PersistentStorageSession getSession(final String sessionId) {\n             throw new IllegalArgumentException(\"session id must be non-null\");\n         }\n \n-        final PersistentStorageSession session = sessionMap.get(sessionId);\n-\n-        if (session != null) {\n-            return session;\n-        }\n-\n-        final PersistentStorageSession newSession = new OCFLPersistentStorageSession(sessionId,\n+        return sessionMap.computeIfAbsent(sessionId, key -> new OCFLPersistentStorageSession(\n+                key,\n                 fedoraOcflIndex,\n-                objectSessionFactory);\n-        sessionMap.put(sessionId, newSession);\n-        return newSession;\n+                objectSessionFactory));\n     }\n \n     @Override\n     public PersistentStorageSession getReadOnlySession() {\n         if (this.readOnlySession == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "009b45b14569f36fdab05c8cdc2f4b401fc8ada7"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5OTU0MjUz", "url": "https://github.com/fcrepo/fcrepo/pull/1657#pullrequestreview-389954253", "createdAt": "2020-04-08T13:06:02Z", "commit": {"oid": "009b45b14569f36fdab05c8cdc2f4b401fc8ada7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5OTY4OTk3", "url": "https://github.com/fcrepo/fcrepo/pull/1657#pullrequestreview-389968997", "createdAt": "2020-04-08T13:23:28Z", "commit": {"oid": "009b45b14569f36fdab05c8cdc2f4b401fc8ada7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d98e4d6a6d7913333e3177632b764127f3b1969", "author": {"user": {"login": "pwinckles", "name": "Peter Winckles"}}, "url": "https://github.com/fcrepo/fcrepo/commit/2d98e4d6a6d7913333e3177632b764127f3b1969", "committedDate": "2020-04-08T14:35:17Z", "message": "fixed double-checked locking for java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTE3Mjc0", "url": "https://github.com/fcrepo/fcrepo/pull/1657#pullrequestreview-390117274", "createdAt": "2020-04-08T16:04:08Z", "commit": {"oid": "2d98e4d6a6d7913333e3177632b764127f3b1969"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3076, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}