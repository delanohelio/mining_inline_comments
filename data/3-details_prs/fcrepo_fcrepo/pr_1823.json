{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMjAwNjcz", "number": 1823, "title": "add resource locking", "bodyText": "JIRA Ticket: https://jira.lyrasis.org/browse/FCREPO-3123\nThis PR requires fcrepo/fcrepo-storage-ocfl#25 to work\nWhat does this Pull Request do?\nAdds resource locking so that a resource cannot be concurrently modified in different transaction.\nIn this implementation,\n\nA transaction holds a lock on a resource for the duration of the transaction\nThe same transaction may modify a resource that it holds a lock on multiple times\nAGs are locked when any of their children are modified\nBinaries are locked when their description is modified\nBinary descriptions are locked when their binary is modified\n\nHow should this be tested?\n\nCreate a resource\nStart a transaction\nModify the resource in a transaction, but do not commit\nAttempt to modify the same resource outside of the transaction. This should fail with a 409.\n\nInterested parties\n@fcrepo/committers", "createdAt": "2020-12-02T18:16:57Z", "url": "https://github.com/fcrepo/fcrepo/pull/1823", "merged": true, "mergeCommit": {"oid": "edf919a5aa9677daa94ca53defb39a29a9c8e31c"}, "closed": true, "closedAt": "2020-12-04T15:08:53Z", "author": {"login": "pwinckles"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiADEqgH2gAyNTMxMjAwNjczOjlhOGEwODkxOGE4MjcxNzhlNzE0NTRmNjRiMDhjOTM3NzM1YTYyMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdi5MRNgFqTU0NTA0MDg0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9a8a08918a827178e71454f64b08c937735a6235", "author": {"user": {"login": "pwinckles", "name": "Peter Winckles"}}, "url": "https://github.com/fcrepo/fcrepo/commit/9a8a08918a827178e71454f64b08c937735a6235", "committedDate": "2020-12-01T20:34:01Z", "message": "added archiveGroupId header"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e080448503cc3c075c743233a69959e303d97d5d", "author": {"user": {"login": "pwinckles", "name": "Peter Winckles"}}, "url": "https://github.com/fcrepo/fcrepo/commit/e080448503cc3c075c743233a69959e303d97d5d", "committedDate": "2020-12-02T18:10:08Z", "message": "add resource locking"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMjM1NTM0", "url": "https://github.com/fcrepo/fcrepo/pull/1823#pullrequestreview-543235534", "createdAt": "2020-12-02T21:04:36Z", "commit": {"oid": "e080448503cc3c075c743233a69959e303d97d5d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMTowNDozN1rOH9uFtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMTowNDozN1rOH9uFtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ4MDMwOQ==", "bodyText": "Is this just going to be a log message? Seems like it could be a bigger problem or am I over estimating its severity?", "url": "https://github.com/fcrepo/fcrepo/pull/1823#discussion_r534480309", "createdAt": "2020-12-02T21:04:37Z", "author": {"login": "whikloj"}, "path": "fcrepo-kernel-impl/src/main/java/org/fcrepo/kernel/impl/TransactionImpl.java", "diffHunk": "@@ -238,6 +255,12 @@ private void failIfRolledback() {\n         }\n     }\n \n+    private void releaseLocks() {\n+        execQuietly(\"Failed to release resource locks cleanly. You may need to restart Fedora.\", () -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e080448503cc3c075c743233a69959e303d97d5d"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MDU4Mzg2", "url": "https://github.com/fcrepo/fcrepo/pull/1823#pullrequestreview-544058386", "createdAt": "2020-12-03T15:16:08Z", "commit": {"oid": "e080448503cc3c075c743233a69959e303d97d5d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7e9ade170bb80fea2d11dafbe0a7e3df6baef2e", "author": {"user": {"login": "pwinckles", "name": "Peter Winckles"}}, "url": "https://github.com/fcrepo/fcrepo/commit/c7e9ade170bb80fea2d11dafbe0a7e3df6baef2e", "committedDate": "2020-12-03T17:03:55Z", "message": "reduce the number of concurrent requests to make the test flap less"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0fcb95ed28c49c5b786251bf3e759bbfdb12a06", "author": {"user": {"login": "pwinckles", "name": "Peter Winckles"}}, "url": "https://github.com/fcrepo/fcrepo/commit/f0fcb95ed28c49c5b786251bf3e759bbfdb12a06", "committedDate": "2020-12-03T17:15:53Z", "message": "further reduce concurrency..."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e783018324515ec5a10538293168a99923081ca7", "author": {"user": {"login": "pwinckles", "name": "Peter Winckles"}}, "url": "https://github.com/fcrepo/fcrepo/commit/e783018324515ec5a10538293168a99923081ca7", "committedDate": "2020-12-03T17:46:31Z", "message": "changed to use the thread method to see if it works any better"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f2cc0221767d1daf801456bfa3492ae64afd487", "author": {"user": {"login": "pwinckles", "name": "Peter Winckles"}}, "url": "https://github.com/fcrepo/fcrepo/commit/0f2cc0221767d1daf801456bfa3492ae64afd487", "committedDate": "2020-12-03T17:58:04Z", "message": "and reduce concurrency again... :("}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c6bbb060c6c2d4bf0e06e1d4fc5cfc04e4a0d5a", "author": {"user": {"login": "pwinckles", "name": "Peter Winckles"}}, "url": "https://github.com/fcrepo/fcrepo/commit/2c6bbb060c6c2d4bf0e06e1d4fc5cfc04e4a0d5a", "committedDate": "2020-12-03T18:29:53Z", "message": "replaced flapping test with a transaction based test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MDQwODQ0", "url": "https://github.com/fcrepo/fcrepo/pull/1823#pullrequestreview-545040844", "createdAt": "2020-12-04T15:08:39Z", "commit": {"oid": "2c6bbb060c6c2d4bf0e06e1d4fc5cfc04e4a0d5a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3044, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}