{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0OTM0MTc0", "number": 1815, "title": "Removes need to disable triggers on PostgresQL", "bodyText": "Removes need to disable triggers on PostgresQL which was causing a problem database administrator does not have super admin control as is the case on AWS RDS.\nJIRA Ticket:  https://jira.lyrasis.org/browse/FCREPO-3540\n\nOther Relevant Links (Mailing list discussion, related pull requests, etc.)\n\nWhat does this Pull Request do?\nNo functional change.\n\nRemoves the need to disable triggers on truncation in postgresql\n\nHow should this be tested?\nIntegration tests should already cover it.\nI build a new docker image and deployed it to fcrepo/fcrepo:6.0.0-SNAPSHOT-3540-test and verified that postgresql now works when I deploy using this PR of fcrepo-aws-deployer: fcrepo-exts/fcrepo-aws-deployer#3\nYou can test these changes in AWS yourself using the instructions in the aforementioned PR.\nInterested parties\n@awoods", "createdAt": "2020-11-20T20:26:59Z", "url": "https://github.com/fcrepo/fcrepo/pull/1815", "merged": true, "mergeCommit": {"oid": "4b42bac00ce584af948c6e9b6976f9298ac4ed35"}, "closed": true, "closedAt": "2020-11-23T18:17:15Z", "author": {"login": "dbernstein"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeeG-YAH2gAyNTI0OTM0MTc0OmI4OGRjZjYwZTZlMzhlMGY1ZWI3M2U0MjY2YjFkMmY0OTdjNDUxNWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfZSzRgFqTUzNjczMjE2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b88dcf60e6e38e0f5eb73e4266b1d2f497c4515f", "author": {"user": {"login": "dbernstein", "name": "dbernstein"}}, "url": "https://github.com/fcrepo/fcrepo/commit/b88dcf60e6e38e0f5eb73e4266b1d2f497c4515f", "committedDate": "2020-11-20T21:19:44Z", "message": "With this update, We no longer disable triggers in postgresql which was causing a problem database administrator does not have super admin control as is the case on AWS RDS.\n\nResolves: https://jira.lyrasis.org/browse/FCREPO-3540"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a73ee0f982cccd5eb6c3306915aebe7ba487d5d", "author": {"user": {"login": "dbernstein", "name": "dbernstein"}}, "url": "https://github.com/fcrepo/fcrepo/commit/6a73ee0f982cccd5eb6c3306915aebe7ba487d5d", "committedDate": "2020-11-20T19:19:12Z", "message": "Removes need for foreign key constraint enable/disable on truncate for all but h2 by reordering truncate statements.  Now we no longer disable triggers in postgresql which was causing a problem database administrator does not have super admin control as is the case on AWS RDS.\n\nResolves: https://jira.lyrasis.org/browse/FCREPO-3540"}, "afterCommit": {"oid": "b88dcf60e6e38e0f5eb73e4266b1d2f497c4515f", "author": {"user": {"login": "dbernstein", "name": "dbernstein"}}, "url": "https://github.com/fcrepo/fcrepo/commit/b88dcf60e6e38e0f5eb73e4266b1d2f497c4515f", "committedDate": "2020-11-20T21:19:44Z", "message": "With this update, We no longer disable triggers in postgresql which was causing a problem database administrator does not have super admin control as is the case on AWS RDS.\n\nResolves: https://jira.lyrasis.org/browse/FCREPO-3540"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODcwMDkw", "url": "https://github.com/fcrepo/fcrepo/pull/1815#pullrequestreview-535870090", "createdAt": "2020-11-21T01:47:18Z", "commit": {"oid": "b88dcf60e6e38e0f5eb73e4266b1d2f497c4515f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwMTo0NzoxOFrOH3lsfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwMTo0NzoxOFrOH3lsfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODA1MTMyNg==", "bodyText": "Your description says this is now only needed for H2, so could we stop doing this for MySQL and MariaDB too. Maybe repurpose the isPostgres() into isH2()?", "url": "https://github.com/fcrepo/fcrepo/pull/1815#discussion_r528051326", "createdAt": "2020-11-21T01:47:18Z", "author": {"login": "whikloj"}, "path": "fcrepo-search-impl/src/main/java/org/fcrepo/search/impl/DbSearchIndexImpl.java", "diffHunk": "@@ -471,11 +472,7 @@ public void reset() {\n     private List<String> toggleForeignKeyChecks(final boolean enable) {\n \n         if (isPostgres()) {\n-            return List.of(\n-                    togglePostgresTriggers(SEARCH_RESOURCE_RDF_TYPE_TABLE, enable),\n-                    togglePostgresTriggers(SEARCH_RDF_TYPE_TABLE, enable),\n-                    togglePostgresTriggers(SIMPLE_SEARCH_TABLE, enable)\n-            );\n+            return EMPTY_LIST;\n         } else {\n             return List.of(\"SET FOREIGN_KEY_CHECKS = \" + (enable ? 1 : 0) + \";\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b88dcf60e6e38e0f5eb73e4266b1d2f497c4515f"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NzMyMTYz", "url": "https://github.com/fcrepo/fcrepo/pull/1815#pullrequestreview-536732163", "createdAt": "2020-11-23T18:17:03Z", "commit": {"oid": "b88dcf60e6e38e0f5eb73e4266b1d2f497c4515f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3035, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}