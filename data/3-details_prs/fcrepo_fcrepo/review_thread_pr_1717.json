{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NDQ4Nzk4", "number": 1717, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDoyNjowM1rOEM60ZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDo0MzowOVrOEM7SxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxOTgyMDUyOnYy", "diffSide": "RIGHT", "path": "fcrepo-http-api/src/main/java/org/fcrepo/http/api/FedoraSearch.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDoyNjowM1rOGvToiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDoyNjowM1rOGvToiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI1NzkzMQ==", "bodyText": "Minor: Can you bring the closing ) to follow directly after orderBy?", "url": "https://github.com/fcrepo/fcrepo/pull/1717#discussion_r452257931", "createdAt": "2020-07-09T14:26:03Z", "author": {"login": "awoods"}, "path": "fcrepo-http-api/src/main/java/org/fcrepo/http/api/FedoraSearch.java", "diffHunk": "@@ -82,7 +82,10 @@ public FedoraSearch() {\n     public Response doSearch(@QueryParam(value = \"condition\") final List<String> conditions,\n                              @QueryParam(value = \"fields\") final String fields,\n                              @DefaultValue(\"100\") @QueryParam(\"max_results\") final int maxResults,\n-                             @DefaultValue(\"0\") @QueryParam(\"offset\") final int offset) {\n+                             @DefaultValue(\"0\") @QueryParam(\"offset\") final int offset,\n+                             @DefaultValue(\"asc\") @QueryParam(\"order\") final String order,\n+                             @DefaultValue(\"fedora_id\") @QueryParam(\"order_by\") final String orderBy\n+    ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c28f4154bdf5dbf6efa627cff09726ca766579e"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxOTg2ODcwOnYy", "diffSide": "RIGHT", "path": "fcrepo-http-api/src/main/java/org/fcrepo/http/api/FedoraSearch.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDozNjo0MVrOGvUGWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDozNjo0MVrOGvUGWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI2NTU2MA==", "bodyText": "There are two valid values for the order field: asc and desc.\nWhat is the purpose of listing all of the potential fields? ...likely should be removed.", "url": "https://github.com/fcrepo/fcrepo/pull/1717#discussion_r452265560", "createdAt": "2020-07-09T14:36:41Z", "author": {"login": "awoods"}, "path": "fcrepo-http-api/src/main/java/org/fcrepo/http/api/FedoraSearch.java", "diffHunk": "@@ -105,7 +108,21 @@ public Response doSearch(@QueryParam(value = \"condition\") final List<String> con\n                 }\n             }\n \n-            final var params = new SearchParameters(parsedFields, conditionList, maxResults, offset);\n+            final Condition.Field orderByField;\n+            try {\n+                orderByField = Condition.Field.fromString(orderBy);\n+            } catch (final Exception e) {\n+                throw new InvalidQueryException(\"The order_by field must contain a valid value such as \" +\n+                        StringUtils.join(Condition.Field.values()));\n+            }\n+\n+            if (!(order.equalsIgnoreCase(\"asc\") || order.equalsIgnoreCase(\"desc\"))) {\n+                throw new InvalidQueryException(\"The order field is invalid:  valid values are \\\"asc\\\" and \\\"desc\\\"\" +\n+                        StringUtils.join(Condition.Field.values()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c28f4154bdf5dbf6efa627cff09726ca766579e"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxOTg3Nzc2OnYy", "diffSide": "RIGHT", "path": "fcrepo-http-api/src/main/java/org/fcrepo/http/api/FedoraSearch.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDozODo0MVrOGvUMBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDozODo0MVrOGvUMBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI2NzAxMg==", "bodyText": "Likely want to add a separator, such as:\nStringUtils.join(Condition.Field.values(), \", \"));", "url": "https://github.com/fcrepo/fcrepo/pull/1717#discussion_r452267012", "createdAt": "2020-07-09T14:38:41Z", "author": {"login": "awoods"}, "path": "fcrepo-http-api/src/main/java/org/fcrepo/http/api/FedoraSearch.java", "diffHunk": "@@ -105,7 +108,21 @@ public Response doSearch(@QueryParam(value = \"condition\") final List<String> con\n                 }\n             }\n \n-            final var params = new SearchParameters(parsedFields, conditionList, maxResults, offset);\n+            final Condition.Field orderByField;\n+            try {\n+                orderByField = Condition.Field.fromString(orderBy);\n+            } catch (final Exception e) {\n+                throw new InvalidQueryException(\"The order_by field must contain a valid value such as \" +\n+                        StringUtils.join(Condition.Field.values()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c28f4154bdf5dbf6efa627cff09726ca766579e"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxOTg5ODI5OnYy", "diffSide": "RIGHT", "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraSearchIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDo0MzowOVrOGvUZDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDo0MzowOVrOGvUZDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI3MDM0OA==", "bodyText": "Since this test is named to be testing the \"default\" ordering, I would suggest removing the order_by and order query parameters... and rely on the defaults.\nA new, separate test could be useful to test desc order.", "url": "https://github.com/fcrepo/fcrepo/pull/1717#discussion_r452270348", "createdAt": "2020-07-09T14:43:09Z", "author": {"login": "awoods"}, "path": "fcrepo-http-api/src/test/java/org/fcrepo/integration/http/api/FedoraSearchIT.java", "diffHunk": "@@ -435,6 +435,52 @@ public void testMalformedCondition() throws Exception {\n         }\n     }\n \n+    @Test\n+    public void testDefaultOrdering() throws Exception {\n+        final var prefix = getRandomUniqueId();\n+        final var resources = createResources(prefix, 3);\n+        final var condition = FEDORA_ID + \"=\" + prefix + \"*\";\n+        final String searchUrl = getSearchEndpoint() + \"condition=\" + encode(condition) +\n+                \"&order_by=fedora_id&order=asc\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c28f4154bdf5dbf6efa627cff09726ca766579e"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1869, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}