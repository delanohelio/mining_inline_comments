{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NTcxODM3", "number": 1765, "title": "Make ghost nodes immutable - FCREPO-3256", "bodyText": "JIRA Ticket: https://jira.lyrasis.org/browse/FCREPO-3256\nWhat does this Pull Request do?\nMakes it so you can't create a real resource at the address of a ghost node.\nHow should this be tested?\nTesting steps in the ticket or\n\nCreate a resource a/b/c - curl -i -ufedoraAdmin:fedoraAdmin -XPUT http://localhost:8080/rest/a/b/c\nTry to create resource a/b - curl -i -ufedoraAdmin:fedoraAdmin -XPUT http://localhost:8080/rest/a/b\nWithout this PR get a 201 Created, with this PR get a 409 Conflict.\nDelete resource a/b/c - curl -i -ufedoraAdmin:fedoraAdmin -XDELETE http://localhost:8080/rest/a/b/c\nWith the PR, you still can't create at a/b due to the tombstone. Running step 2 still returns a 409 Conflict.\nDelete the a/b/c/fcr:tombstone - curl -i -ufedoraAdmin:fedoraAdmin -XDELETE http://localhost:8080/rest/a/b/c/fcr:tombstone\nNow you can create a resource at a/b - curl -i -ufedoraAdmin:fedoraAdmin -XPUT http://localhost:8080/rest/a/b\n\nInterested parties\n@fcrepo/committers", "createdAt": "2020-10-06T14:03:53Z", "url": "https://github.com/fcrepo/fcrepo/pull/1765", "merged": true, "mergeCommit": {"oid": "2fae76d702c8f8074fdd511f99977b0826f4f0f3"}, "closed": true, "closedAt": "2020-10-07T22:58:16Z", "author": {"login": "whikloj"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP-a37AFqTUwMzMyMzU3Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQVHeuAFqTUwNDMyMzUwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMzIzNTcz", "url": "https://github.com/fcrepo/fcrepo/pull/1765#pullrequestreview-503323573", "createdAt": "2020-10-06T20:14:58Z", "commit": {"oid": "fa46232ca6f8f4f74deecef52dddd5666abd2de5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQyMDoxNDo1OFrOHdYTcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQyMDoyNDoxNVrOHdYmXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2ODk0NQ==", "bodyText": "Maybe change \"immutable node\" to \"immutable resource\"?", "url": "https://github.com/fcrepo/fcrepo/pull/1765#discussion_r500568945", "createdAt": "2020-10-06T20:14:58Z", "author": {"login": "awoods"}, "path": "fcrepo-http-api/src/main/java/org/fcrepo/http/api/FedoraLdp.java", "diffHunk": "@@ -404,6 +405,10 @@ public Response createOrReplaceObjectRdf(\n             //}\n         }\n \n+        if (isGhostNode(transaction(), fedoraId)) {\n+            throw new GhostNodeException(\"Resource path \" + externalPath() + \" is an immutable node.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa46232ca6f8f4f74deecef52dddd5666abd2de5"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU3MjAzOA==", "bodyText": "This seems more like a method that would be on FedoraResource than ResourceFactory.\n..such as isAcl() and isMemento().", "url": "https://github.com/fcrepo/fcrepo/pull/1765#discussion_r500572038", "createdAt": "2020-10-06T20:20:52Z", "author": {"login": "awoods"}, "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/models/ResourceFactory.java", "diffHunk": "@@ -112,4 +112,17 @@ public FedoraResource getResource(final String transactionId, final FedoraId fed\n      * @return Stream of child resources\n      */\n     public Stream<FedoraResource> getChildren(final String transactionId, final FedoraId resourceId);\n+\n+    /**\n+     * Is the resource a \"ghost node\". Ghost nodes are defined as a resource that does not exist, but whose URI is part\n+     * of the URI of another resource? For example:\n+     *\n+     * http://localhost/rest/a/b - does exist\n+     * http://localhost/rest/a - does not exist and is therefore a ghost node.\n+     *\n+     * @param transaction The transaction\n+     * @param resourceId Identifier of the resource\n+     * @return Whether the resource does not exist, but has\n+     */\n+    public boolean isGhostNode(final Transaction transaction, final FedoraId resourceId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa46232ca6f8f4f74deecef52dddd5666abd2de5"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU3Mzc5MQ==", "bodyText": "Maybe as a separate clean-up task, this interface should normalize on using ID or Id. Currently it is a complete mix.", "url": "https://github.com/fcrepo/fcrepo/pull/1765#discussion_r500573791", "createdAt": "2020-10-06T20:24:15Z", "author": {"login": "awoods"}, "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/ContainmentIndex.java", "diffHunk": "@@ -124,4 +124,11 @@\n      */\n     void reset();\n \n+    /**\n+     * Find whether there are any resources that starts with the ID provided.\n+     * @param txID The transaction id, or null if no transaction.\n+     * @param fedoraId The ID to use to look for other IDs.\n+     * @return Are there any matching IDs.\n+     */\n+    boolean hasResourcesStartingWith(final String txID, final FedoraId fedoraId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa46232ca6f8f4f74deecef52dddd5666abd2de5"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "724325e82e96115d6ba483c966c956dd14fbce5a", "author": {"user": {"login": "whikloj", "name": "Jared Whiklo"}}, "url": "https://github.com/fcrepo/fcrepo/commit/724325e82e96115d6ba483c966c956dd14fbce5a", "committedDate": "2020-10-07T18:38:02Z", "message": "Make ghost nodes immutable - FCREPO-3256"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0266dc575e830e53ac6609a89739380d4d4b0fff", "author": {"user": {"login": "whikloj", "name": "Jared Whiklo"}}, "url": "https://github.com/fcrepo/fcrepo/commit/0266dc575e830e53ac6609a89739380d4d4b0fff", "committedDate": "2020-10-07T18:38:02Z", "message": "Code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "222a8983b242eaf526cda668e3eec33a47ccca30", "author": {"user": {"login": "whikloj", "name": "Jared Whiklo"}}, "url": "https://github.com/fcrepo/fcrepo/commit/222a8983b242eaf526cda668e3eec33a47ccca30", "committedDate": "2020-10-07T18:38:02Z", "message": "One last javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7a04639480f9ed71e013e16d1f075b625d086b0", "author": {"user": {"login": "whikloj", "name": "Jared Whiklo"}}, "url": "https://github.com/fcrepo/fcrepo/commit/c7a04639480f9ed71e013e16d1f075b625d086b0", "committedDate": "2020-10-07T18:40:52Z", "message": "Add method to ContainmentIndexMetrics"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ae11ce6300795cbd6828b7c6b1b4fd083f1e7d2", "author": {"user": {"login": "whikloj", "name": "Jared Whiklo"}}, "url": "https://github.com/fcrepo/fcrepo/commit/3ae11ce6300795cbd6828b7c6b1b4fd083f1e7d2", "committedDate": "2020-10-07T13:24:42Z", "message": "One last javadoc"}, "afterCommit": {"oid": "c7a04639480f9ed71e013e16d1f075b625d086b0", "author": {"user": {"login": "whikloj", "name": "Jared Whiklo"}}, "url": "https://github.com/fcrepo/fcrepo/commit/c7a04639480f9ed71e013e16d1f075b625d086b0", "committedDate": "2020-10-07T18:40:52Z", "message": "Add method to ContainmentIndexMetrics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MjU5NjUz", "url": "https://github.com/fcrepo/fcrepo/pull/1765#pullrequestreview-504259653", "createdAt": "2020-10-07T20:54:59Z", "commit": {"oid": "c7a04639480f9ed71e013e16d1f075b625d086b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMDo1NDo1OVrOHeFLfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMDo1NDo1OVrOHeFLfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMwNDE5MQ==", "bodyText": "Very minor: one last fedoraID", "url": "https://github.com/fcrepo/fcrepo/pull/1765#discussion_r501304191", "createdAt": "2020-10-07T20:54:59Z", "author": {"login": "awoods"}, "path": "fcrepo-kernel-api/src/main/java/org/fcrepo/kernel/api/ContainmentIndex.java", "diffHunk": "@@ -105,23 +105,30 @@\n     /**\n      * Check if the resourceID exists in the containment index. Which should mean it exists.\n      *\n-     * @param txID The transaction id, or null if no transaction\n+     * @param txId The transaction id, or null if no transaction\n      * @param fedoraID The resource's FedoraId.\n      * @return True if it is in the index.\n      */\n-    boolean resourceExists(final String txID, final FedoraId fedoraID);\n+    boolean resourceExists(final String txId, final FedoraId fedoraID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7a04639480f9ed71e013e16d1f075b625d086b0"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "825ed063828d28ebaa5a2f0c2f5e18b75b3e01b0", "author": {"user": {"login": "whikloj", "name": "Jared Whiklo"}}, "url": "https://github.com/fcrepo/fcrepo/commit/825ed063828d28ebaa5a2f0c2f5e18b75b3e01b0", "committedDate": "2020-10-07T21:02:41Z", "message": "Last ID"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f766bb5ab8f84647cf3894ca7abce51d591f58c", "author": {"user": {"login": "whikloj", "name": "Jared Whiklo"}}, "url": "https://github.com/fcrepo/fcrepo/commit/0f766bb5ab8f84647cf3894ca7abce51d591f58c", "committedDate": "2020-10-07T22:34:49Z", "message": "Refactor ResourceFactory"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MzIzNTAx", "url": "https://github.com/fcrepo/fcrepo/pull/1765#pullrequestreview-504323501", "createdAt": "2020-10-07T22:56:12Z", "commit": {"oid": "0f766bb5ab8f84647cf3894ca7abce51d591f58c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2973, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}