{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MTAxMTQ1", "number": 1152, "title": "HIVE-23730: TezCompiler tracking the original TS key columnName", "bodyText": "TezCompiler tracking the original TS key columnName used for MJ probedecode\nChange-Id: Ia1f42f36bb6ea7108628d99f306d3c74398dca6b\nNOTICE\nPlease create an issue in ASF JIRA before opening a pull request,\nand you need to set the title of the pull request which starts with\nthe corresponding JIRA issue number. (e.g. HIVE-XXXXX: Fix a typo in YYY)\nFor more details, please see https://cwiki.apache.org/confluence/display/Hive/HowToContribute", "createdAt": "2020-06-19T13:26:07Z", "url": "https://github.com/apache/hive/pull/1152", "merged": true, "mergeCommit": {"oid": "2f735d133349846799e47d27d60bf60b942c3f99"}, "closed": true, "closedAt": "2020-07-20T02:52:15Z", "author": {"login": "pgaref"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctlswjgFqTQzNDU0NjQwNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcw-VDAgH2gAyNDM3MTAxMTQ1OmQ2MTI1ZjFlNTlmZTM3YzY5M2U2ZWEzMjY2ZjgxZDllMzkzOGM3NjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTQ2NDA2", "url": "https://github.com/apache/hive/pull/1152#pullrequestreview-434546406", "createdAt": "2020-06-22T00:16:58Z", "commit": {"oid": "bd7e3a0dbad207cda42580e29e52565f4e3b537c"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwMDoxNjo1OFrOGmvI4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwMDoyNzo1NVrOGmvM8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI3MTM5NQ==", "bodyText": "Can you check if this can already be done by any of the utility methods in OperatorUtils? If it is not, can we move it to that class with rest of utility methods in case it is useful in the future?", "url": "https://github.com/apache/hive/pull/1152#discussion_r443271395", "createdAt": "2020-06-22T00:16:58Z", "author": {"login": "jcamachor"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/parse/TezCompiler.java", "diffHunk": "@@ -1566,13 +1569,38 @@ private void removeSemijoinsParallelToMapJoin(OptimizeTezProcContext procCtx)\n \n       List<ExprNodeDesc> keyDesc = selectedMJOp.getConf().getKeys().get(posBigTable);\n       ExprNodeColumnDesc keyCol = (ExprNodeColumnDesc) keyDesc.get(0);\n-\n-      tsProbeDecodeCtx = new TableScanOperator.ProbeDecodeContext(mjCacheKey, mjSmallTablePos,\n-          keyCol.getColumn(), selectedMJOpRatio);\n+      String realTSColName = getOriginalTSColName(selectedMJOp, keyCol.getColumn());\n+      if (realTSColName != null) {\n+        tsProbeDecodeCtx = new TableScanOperator.ProbeDecodeContext(mjCacheKey, mjSmallTablePos,\n+                realTSColName, selectedMJOpRatio);\n+      } else {\n+        LOG.warn(\"ProbeDecode could not find TSColName for ColKey {} with MJ Schema {} \", keyCol, selectedMJOp.getSchema());\n+      }\n     }\n     return tsProbeDecodeCtx;\n   }\n \n+  private static String getOriginalTSColName(MapJoinOperator mjOp, String internalCoName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd7e3a0dbad207cda42580e29e52565f4e3b537c"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI3MjQzMw==", "bodyText": "You could throw an error only if you are running in test mode:\nif (conf.getBoolVar(ConfVars.HIVE_IN_TEST)) {\n...\n\nWhile I am not a huge fan of interleaving a check like this within the production code, it may help you identify any issues, gaps, or regressions in the future.\nIf you do not want to do that, an alternative is uploading a patch throwing an error instead of printing the warning to get a complete test run, then create follow-up issues if there are any. It will not help you with regressions in the future, but you will be able to identify any existing issue.", "url": "https://github.com/apache/hive/pull/1152#discussion_r443272433", "createdAt": "2020-06-22T00:27:55Z", "author": {"login": "jcamachor"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/parse/TezCompiler.java", "diffHunk": "@@ -1566,13 +1569,38 @@ private void removeSemijoinsParallelToMapJoin(OptimizeTezProcContext procCtx)\n \n       List<ExprNodeDesc> keyDesc = selectedMJOp.getConf().getKeys().get(posBigTable);\n       ExprNodeColumnDesc keyCol = (ExprNodeColumnDesc) keyDesc.get(0);\n-\n-      tsProbeDecodeCtx = new TableScanOperator.ProbeDecodeContext(mjCacheKey, mjSmallTablePos,\n-          keyCol.getColumn(), selectedMJOpRatio);\n+      String realTSColName = getOriginalTSColName(selectedMJOp, keyCol.getColumn());\n+      if (realTSColName != null) {\n+        tsProbeDecodeCtx = new TableScanOperator.ProbeDecodeContext(mjCacheKey, mjSmallTablePos,\n+                realTSColName, selectedMJOpRatio);\n+      } else {\n+        LOG.warn(\"ProbeDecode could not find TSColName for ColKey {} with MJ Schema {} \", keyCol, selectedMJOp.getSchema());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd7e3a0dbad207cda42580e29e52565f4e3b537c"}, "originalPosition": 39}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e647f903b1ab0f501452b52eeadc023701ad6f2b", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/e647f903b1ab0f501452b52eeadc023701ad6f2b", "committedDate": "2020-06-23T13:21:39Z", "message": "Reverting hybrid_grace hashjoin out\n\nChange-Id: I4402f7030bf860eb7735efc4eea7292bc5e75bfc"}, "afterCommit": {"oid": "fadae3e5eb5ce638c19f92626111cb5a5bae17bc", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/fadae3e5eb5ce638c19f92626111cb5a5bae17bc", "committedDate": "2020-06-23T20:11:51Z", "message": "hybridgrace hashjoin FIX\n\nChange-Id: I523aefff8bdeb1e2f91b82686dcd625a8f8cc7d2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fadae3e5eb5ce638c19f92626111cb5a5bae17bc", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/fadae3e5eb5ce638c19f92626111cb5a5bae17bc", "committedDate": "2020-06-23T20:11:51Z", "message": "hybridgrace hashjoin FIX\n\nChange-Id: I523aefff8bdeb1e2f91b82686dcd625a8f8cc7d2"}, "afterCommit": {"oid": "7ec2787d20bb844da1930626ac4662fc62e9279f", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/7ec2787d20bb844da1930626ac4662fc62e9279f", "committedDate": "2020-06-24T14:12:31Z", "message": "hybridgrace hashjoin FIX\n\nChange-Id: I523aefff8bdeb1e2f91b82686dcd625a8f8cc7d2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7783279ff2200311054c14ee91080adda9d30f67", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/7783279ff2200311054c14ee91080adda9d30f67", "committedDate": "2020-06-25T13:19:55Z", "message": "HIVE-23730: TezCompiler tracking the original TS key columnName used for MJ probedecode\n\nChange-Id: Ia1f42f36bb6ea7108628d99f306d3c74398dca6b"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c6d629cf8c0d6f9e173ea63ccb5fa0a05d8dbc1", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/9c6d629cf8c0d6f9e173ea63ccb5fa0a05d8dbc1", "committedDate": "2020-06-25T13:19:55Z", "message": "TezCompiler using RowSchema instead for original TS colname mapping\n\nChange-Id: I23536ec54839e600e886fc7ab7a23e11ffc3acc2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ff5e773bb3d601656e12612a053529737c88d9e", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/3ff5e773bb3d601656e12612a053529737c88d9e", "committedDate": "2020-06-25T13:19:55Z", "message": "Moving helper method finding TS colnmae to OperatorUtils.\nEnabling probedecode and throw exceptions to discover more issues/regressions\n\nChange-Id: Ib705ed06e2bd7fb4cf80f97e63d7ed5ba820e8d1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "259a66ccd8ec8eec524b00eba763e52e890e1e5c", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/259a66ccd8ec8eec524b00eba763e52e890e1e5c", "committedDate": "2020-06-25T13:19:56Z", "message": "Enabling probedecode by default and Updating query out\n\nChange-Id: I31f131621f32c1a04e637fc13bb6698b27b00309"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fed5f9e36e01c6b87a40909be3cc49bf56d44db9", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/fed5f9e36e01c6b87a40909be3cc49bf56d44db9", "committedDate": "2020-06-25T13:19:56Z", "message": "Reverting hybrid_grace hashjoin out\n\nChange-Id: I4402f7030bf860eb7735efc4eea7292bc5e75bfc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1eeb57a96c97fe201fc771eec353128ae724f931", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/1eeb57a96c97fe201fc771eec353128ae724f931", "committedDate": "2020-06-25T13:19:56Z", "message": "hybridgrace hashjoin FIX\n\nChange-Id: I523aefff8bdeb1e2f91b82686dcd625a8f8cc7d2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99286d4609f0531045ecc74e482ff345c971fc76", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/99286d4609f0531045ecc74e482ff345c971fc76", "committedDate": "2020-06-25T13:19:56Z", "message": "Fixing hybridgrace_hashjoin for LLAP\n\nChange-Id: I8a045cd3b0833357de21210dc2488057fbcbb585"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7023e69a232ccd72f956a3c8b7639ff04bfec966", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/7023e69a232ccd72f956a3c8b7639ff04bfec966", "committedDate": "2020-06-24T17:50:03Z", "message": "Fixing hybridgrace_hashjoin for LLAP\n\nChange-Id: I8a045cd3b0833357de21210dc2488057fbcbb585"}, "afterCommit": {"oid": "99286d4609f0531045ecc74e482ff345c971fc76", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/99286d4609f0531045ecc74e482ff345c971fc76", "committedDate": "2020-06-25T13:19:56Z", "message": "Fixing hybridgrace_hashjoin for LLAP\n\nChange-Id: I8a045cd3b0833357de21210dc2488057fbcbb585"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6125f1e59fe37c693e6ea3266f81d9e3938c765", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/d6125f1e59fe37c693e6ea3266f81d9e3938c765", "committedDate": "2020-07-02T12:51:33Z", "message": "Extend OpUtils findTableColNameOf method to look for column mappings in operator columnExpressions\n\nChange-Id: I9535b75ba2140d33ad2168204c34e8673650cbde"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3684, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}