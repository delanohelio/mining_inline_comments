{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwODI4MjA5", "number": 1787, "title": "HIVE-24470: Separate HiveMetaStore Thrift and Driver logic", "bodyText": "Supersedes/Copy of #1740 and #1777\nWhat changes were proposed in this pull request?\nRefactor HiveMetastore.HMSHandler into its own class\nWhy are the changes needed?\nThis will pave the way for cleaner changes since now we don't have the driver class nested with 10,000 line HMSHandler file so there is a clearer separation of duties.\nDoes this PR introduce any user-facing change?\nNo\nHow was this patch tested?\nExisting unit tests, building/running manually\nNot additional tests were added since this was a pure refactoring", "createdAt": "2020-12-16T01:35:20Z", "url": "https://github.com/apache/hive/pull/1787", "merged": true, "mergeCommit": {"oid": "b0309b7f023d9785c3a842d70d0fc471252101bf"}, "closed": true, "closedAt": "2021-02-02T04:15:00Z", "author": {"login": "dataproc-metastore"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmk_wrgBqjQxMTc0NTAwNDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd2AdHigBqjQyNzY1NjMyMDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f029ad264c5dc64f84d994a2d364081776f4d892", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/f029ad264c5dc64f84d994a2d364081776f4d892", "committedDate": "2020-12-16T01:30:02Z", "message": "Copy HMSHandler to a separate class out of HiveMetastore"}, "afterCommit": {"oid": "396c655ff43b06226267a2d4095050eb08eee4ab", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/396c655ff43b06226267a2d4095050eb08eee4ab", "committedDate": "2020-12-16T01:52:05Z", "message": "Copy HMSHandler to a separate class out of HiveMetastore"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "396c655ff43b06226267a2d4095050eb08eee4ab", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/396c655ff43b06226267a2d4095050eb08eee4ab", "committedDate": "2020-12-16T01:52:05Z", "message": "Copy HMSHandler to a separate class out of HiveMetastore"}, "afterCommit": {"oid": "a669fce5a0c7336d6168851361a4bd5c6e5fa945", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/a669fce5a0c7336d6168851361a4bd5c6e5fa945", "committedDate": "2020-12-16T20:49:50Z", "message": "Copy HMSHandler to a separate class out of HiveMetastore"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a669fce5a0c7336d6168851361a4bd5c6e5fa945", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/a669fce5a0c7336d6168851361a4bd5c6e5fa945", "committedDate": "2020-12-16T20:49:50Z", "message": "Copy HMSHandler to a separate class out of HiveMetastore"}, "afterCommit": {"oid": "4742788eb76e48fa83fbdf1480aab5d26936c5c6", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/4742788eb76e48fa83fbdf1480aab5d26936c5c6", "committedDate": "2020-12-16T21:25:12Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4742788eb76e48fa83fbdf1480aab5d26936c5c6", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/4742788eb76e48fa83fbdf1480aab5d26936c5c6", "committedDate": "2020-12-16T21:25:12Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder"}, "afterCommit": {"oid": "fdeb88a5d87890a7e747c0d350c9578d2ddbb79f", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/fdeb88a5d87890a7e747c0d350c9578d2ddbb79f", "committedDate": "2020-12-17T00:17:22Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fdeb88a5d87890a7e747c0d350c9578d2ddbb79f", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/fdeb88a5d87890a7e747c0d350c9578d2ddbb79f", "committedDate": "2020-12-17T00:17:22Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder."}, "afterCommit": {"oid": "c4db25db438c66dee59aad40635f4168286a6bfa", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/c4db25db438c66dee59aad40635f4168286a6bfa", "committedDate": "2020-12-17T00:26:01Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c4db25db438c66dee59aad40635f4168286a6bfa", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/c4db25db438c66dee59aad40635f4168286a6bfa", "committedDate": "2020-12-17T00:26:01Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder."}, "afterCommit": {"oid": "9959e28ba4c7b0d86608a1037ca3e8c1b37814f4", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/9959e28ba4c7b0d86608a1037ca3e8c1b37814f4", "committedDate": "2020-12-17T00:34:12Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9959e28ba4c7b0d86608a1037ca3e8c1b37814f4", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/9959e28ba4c7b0d86608a1037ca3e8c1b37814f4", "committedDate": "2020-12-17T00:34:12Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder."}, "afterCommit": {"oid": "0f941bfd34668de39feb6bc1b200afc26a2c99c8", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/0f941bfd34668de39feb6bc1b200afc26a2c99c8", "committedDate": "2020-12-19T06:57:09Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0f941bfd34668de39feb6bc1b200afc26a2c99c8", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/0f941bfd34668de39feb6bc1b200afc26a2c99c8", "committedDate": "2020-12-19T06:57:09Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder."}, "afterCommit": {"oid": "f756d12f4f57daf507c729128d3a7443833180e0", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/f756d12f4f57daf507c729128d3a7443833180e0", "committedDate": "2020-12-19T08:05:16Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f756d12f4f57daf507c729128d3a7443833180e0", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/f756d12f4f57daf507c729128d3a7443833180e0", "committedDate": "2020-12-19T08:05:16Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder."}, "afterCommit": {"oid": "66952cf5e3d78ffdf68d4e6c17c2d57edba728c6", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/66952cf5e3d78ffdf68d4e6c17c2d57edba728c6", "committedDate": "2020-12-19T17:53:10Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "66952cf5e3d78ffdf68d4e6c17c2d57edba728c6", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/66952cf5e3d78ffdf68d4e6c17c2d57edba728c6", "committedDate": "2020-12-19T17:53:10Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder."}, "afterCommit": {"oid": "ca1fca8f87e068c5aca32c1b71f75aacd8d90929", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/ca1fca8f87e068c5aca32c1b71f75aacd8d90929", "committedDate": "2020-12-19T20:09:45Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NjExMzMy", "url": "https://github.com/apache/hive/pull/1787#pullrequestreview-556611332", "createdAt": "2020-12-21T19:25:05Z", "commit": {"oid": "090a3956de518599cefac468953d1a09eb71137a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxOToyNTowNVrOIJjXEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxOTo1NTowM1rOIJkL3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg4NzQ0MA==", "bodyText": "You can remove Constants just like in the previous patch. Same is true for other classes where you've removed unused imports in the previous patch, but not in this one for some reason.", "url": "https://github.com/apache/hive/pull/1787#discussion_r546887440", "createdAt": "2020-12-21T19:25:05Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/security/authorization/StorageBasedAuthorizationProvider.java", "diffHunk": "@@ -28,7 +28,7 @@\n import javax.security.auth.login.LoginException;\n \n import org.apache.hadoop.hive.conf.Constants;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "090a3956de518599cefac468953d1a09eb71137a"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg4OTc0NQ==", "bodyText": "Please fix the indentation. There are a lot of other indentation issues introduced since the last version (also some fixed). Please run a checkstyle check (mvn checkstyle:checkstyle) on the metastore-server project, and fix at least the indentation issues in the HMSHandler class (preferably all the other issues too in this class).", "url": "https://github.com/apache/hive/pull/1787#discussion_r546889745", "createdAt": "2020-12-21T19:30:38Z", "author": {"login": "miklosgergely"}, "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/HMSHandler.java", "diffHunk": "@@ -0,0 +1,10189 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hive.metastore;\n+\n+import com.codahale.metrics.Counter;\n+import com.codahale.metrics.Timer;\n+import com.facebook.fb303.FacebookBase;\n+import com.facebook.fb303.fb_status;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Preconditions;\n+import com.google.common.base.Splitter;\n+import com.google.common.base.Supplier;\n+import com.google.common.base.Suppliers;\n+import com.google.common.collect.Lists;\n+import com.google.common.util.concurrent.ThreadFactoryBuilder;\n+import org.apache.commons.collections.CollectionUtils;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileStatus;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.hive.common.AcidConstants;\n+import org.apache.hadoop.hive.common.AcidMetaDataFile;\n+import org.apache.hadoop.hive.common.StatsSetupConst;\n+import org.apache.hadoop.hive.common.TableName;\n+import org.apache.hadoop.hive.common.ValidReaderWriteIdList;\n+import org.apache.hadoop.hive.common.ValidWriteIdList;\n+import org.apache.hadoop.hive.common.repl.ReplConst;\n+import org.apache.hadoop.hive.metastore.api.*;\n+import org.apache.hadoop.hive.metastore.conf.MetastoreConf;\n+import org.apache.hadoop.hive.metastore.conf.MetastoreConf.ConfVars;\n+import org.apache.hadoop.hive.metastore.events.AbortTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.AcidWriteEvent;\n+import org.apache.hadoop.hive.metastore.events.AddCheckConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddDefaultConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddForeignKeyEvent;\n+import org.apache.hadoop.hive.metastore.events.AddNotNullConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.AddPrimaryKeyEvent;\n+import org.apache.hadoop.hive.metastore.events.AddSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.AddUniqueConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AllocWriteIdEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterTableEvent;\n+import org.apache.hadoop.hive.metastore.events.CommitTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.CommitCompactionEvent;\n+import org.apache.hadoop.hive.metastore.events.ConfigChangeEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateFunctionEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateTableEvent;\n+import org.apache.hadoop.hive.metastore.events.DeletePartitionColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.DeleteTableColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.DropCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.DropConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.DropDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.DropFunctionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.DropPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropTableEvent;\n+import org.apache.hadoop.hive.metastore.events.InsertEvent;\n+import org.apache.hadoop.hive.metastore.events.LoadPartitionDoneEvent;\n+import org.apache.hadoop.hive.metastore.events.OpenTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAddPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAddSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAuthorizationCallEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreEventContext;\n+import org.apache.hadoop.hive.metastore.events.PreLoadPartitionDoneEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadhSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.UpdatePartitionColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.UpdateTableColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.messaging.EventMessage;\n+import org.apache.hadoop.hive.metastore.messaging.EventMessage.EventType;\n+import org.apache.hadoop.hive.metastore.metrics.Metrics;\n+import org.apache.hadoop.hive.metastore.metrics.MetricsConstants;\n+import org.apache.hadoop.hive.metastore.metrics.PerfLogger;\n+import org.apache.hadoop.hive.metastore.partition.spec.PartitionSpecProxy;\n+import org.apache.hadoop.hive.metastore.txn.CompactionInfo;\n+import org.apache.hadoop.hive.metastore.txn.TxnStore;\n+import org.apache.hadoop.hive.metastore.txn.TxnUtils;\n+import org.apache.hadoop.hive.metastore.utils.FileUtils;\n+import org.apache.hadoop.hive.metastore.utils.FilterUtils;\n+import org.apache.hadoop.hive.metastore.utils.HdfsUtils;\n+import org.apache.hadoop.hive.metastore.utils.JavaUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetaStoreServerUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetaStoreUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetastoreVersionInfo;\n+import org.apache.hadoop.hive.metastore.utils.SecurityUtils;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.apache.hadoop.util.ReflectionUtils;\n+import org.apache.thrift.TException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.jdo.JDOException;\n+import java.io.IOException;\n+import java.lang.reflect.Constructor;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Modifier;\n+import java.lang.reflect.UndeclaredThrowableException;\n+import java.nio.ByteBuffer;\n+import java.security.PrivilegedExceptionAction;\n+import java.util.AbstractMap;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.BitSet;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.LinkedHashMap;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.regex.Pattern;\n+\n+import static org.apache.commons.lang3.StringUtils.isBlank;\n+import static org.apache.commons.lang3.StringUtils.join;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_CATALOG_NAME;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_DATABASE_COMMENT;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_DATABASE_NAME;\n+import static org.apache.hadoop.hive.metastore.Warehouse.getCatalogQualifiedTableName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.CAT_NAME;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.DB_NAME;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.getDefaultCatalog;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.parseDbName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.prependCatalogToDbName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.prependNotNullCatToDbName;\n+\n+public class HMSHandler extends FacebookBase implements IHMSHandler {\n+  public static final Logger LOG = LoggerFactory.getLogger(HMSHandler.class);\n+  private final Configuration conf; // stores datastore (jpox) properties,\n+                                   // right now they come from jpox.properties\n+\n+  // Flag to control that always threads are initialized only once\n+  // instead of multiple times\n+  private final static AtomicBoolean alwaysThreadsInitialized =\n+      new AtomicBoolean(false);\n+\n+  private static String currentUrl;\n+  private FileMetadataManager fileMetadataManager;\n+  private PartitionExpressionProxy expressionProxy;\n+  private StorageSchemaReader storageSchemaReader;\n+  private IMetaStoreMetadataTransformer transformer;\n+\n+  // Variables for metrics\n+  // Package visible so that HMSMetricsListener can see them.\n+  static AtomicInteger databaseCount, tableCount, partCount;\n+\n+  public static final String PARTITION_NUMBER_EXCEED_LIMIT_MSG =\n+      \"Number of partitions scanned (=%d) on table '%s' exceeds limit (=%d). This is controlled on the metastore server by %s.\";\n+\n+  // Used for testing to simulate method timeout.\n+  @VisibleForTesting\n+  static boolean TEST_TIMEOUT_ENABLED = false;\n+  @VisibleForTesting\n+  static long TEST_TIMEOUT_VALUE = -1;\n+\n+  public static final String ADMIN = \"admin\";\n+  public static final String PUBLIC = \"public\";\n+\n+  static final String NO_FILTER_STRING = \"\";\n+  static final int UNLIMITED_MAX_PARTITIONS = -1;\n+\n+  private Warehouse wh; // hdfs warehouse\n+  private static final ThreadLocal<RawStore> threadLocalMS =\n+      new ThreadLocal<RawStore>() {\n+        @Override\n+        protected RawStore initialValue() {\n+          return null;\n+        }\n+      };\n+\n+  private static final ThreadLocal<TxnStore> threadLocalTxn = new ThreadLocal<TxnStore>() {\n+    @Override\n+    protected TxnStore initialValue() {\n+      return null;\n+    }\n+  };\n+\n+  private static final ThreadLocal<Map<String, com.codahale.metrics.Timer.Context>> timerContexts =\n+      new ThreadLocal<Map<String, com.codahale.metrics.Timer.Context>>() {\n+    @Override", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "090a3956de518599cefac468953d1a09eb71137a"}, "originalPosition": 235}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5OTk5Mg==", "bodyText": "Unnecessary import.", "url": "https://github.com/apache/hive/pull/1787#discussion_r546899992", "createdAt": "2020-12-21T19:52:42Z", "author": {"login": "miklosgergely"}, "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/TSetIpAddressProcessor.java", "diffHunk": "@@ -21,7 +21,7 @@\n import java.lang.reflect.InvocationTargetException;\n import java.net.Socket;\n \n-import org.apache.hadoop.hive.metastore.HiveMetaStore.HMSHandler;\n+import org.apache.hadoop.hive.metastore.HMSHandler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "090a3956de518599cefac468953d1a09eb71137a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkwMDk1OA==", "bodyText": "Unnecessary import.", "url": "https://github.com/apache/hive/pull/1787#discussion_r546900958", "createdAt": "2020-12-21T19:55:03Z", "author": {"login": "miklosgergely"}, "path": "standalone-metastore/metastore-server/src/test/java/org/apache/hadoop/hive/metastore/IpAddressListener.java", "diffHunk": "@@ -22,7 +22,7 @@\n import java.net.UnknownHostException;\n \n import org.apache.hadoop.conf.Configuration;\n-import org.apache.hadoop.hive.metastore.HiveMetaStore.HMSHandler;\n+import org.apache.hadoop.hive.metastore.HMSHandler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "090a3956de518599cefac468953d1a09eb71137a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MTY0NDEx", "url": "https://github.com/apache/hive/pull/1787#pullrequestreview-557164411", "createdAt": "2020-12-22T15:30:53Z", "commit": {"oid": "3bb9aa4ff6d223f4bcc5aa9c13f9e326d21c3cb5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY5NTYyMDYz", "url": "https://github.com/apache/hive/pull/1787#pullrequestreview-569562063", "createdAt": "2021-01-15T19:31:51Z", "commit": {"oid": "948f06762577c5be35d34ee95149b7493685396a"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQxOTozMTo1MVrOIUrE6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQxOTozNToyMFrOIUrMkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODU0ODIwMQ==", "bodyText": "Since this is top level class, can you add a class level comment here on what is the main purpose of this class and any additional useful details to know for someone who is not familiar with code?", "url": "https://github.com/apache/hive/pull/1787#discussion_r558548201", "createdAt": "2021-01-15T19:31:51Z", "author": {"login": "vihangk1"}, "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/HMSHandler.java", "diffHunk": "@@ -0,0 +1,10155 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hive.metastore;\n+\n+import com.codahale.metrics.Counter;\n+import com.codahale.metrics.Timer;\n+import com.facebook.fb303.FacebookBase;\n+import com.facebook.fb303.fb_status;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Preconditions;\n+import com.google.common.base.Splitter;\n+import com.google.common.base.Supplier;\n+import com.google.common.base.Suppliers;\n+import com.google.common.collect.Lists;\n+import com.google.common.util.concurrent.ThreadFactoryBuilder;\n+import org.apache.commons.collections.CollectionUtils;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileStatus;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.hive.common.AcidConstants;\n+import org.apache.hadoop.hive.common.AcidMetaDataFile;\n+import org.apache.hadoop.hive.common.StatsSetupConst;\n+import org.apache.hadoop.hive.common.TableName;\n+import org.apache.hadoop.hive.common.ValidReaderWriteIdList;\n+import org.apache.hadoop.hive.common.ValidWriteIdList;\n+import org.apache.hadoop.hive.common.repl.ReplConst;\n+import org.apache.hadoop.hive.metastore.api.*;\n+import org.apache.hadoop.hive.metastore.conf.MetastoreConf;\n+import org.apache.hadoop.hive.metastore.events.AbortTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.AcidWriteEvent;\n+import org.apache.hadoop.hive.metastore.events.AddCheckConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddDefaultConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddForeignKeyEvent;\n+import org.apache.hadoop.hive.metastore.events.AddNotNullConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.AddPrimaryKeyEvent;\n+import org.apache.hadoop.hive.metastore.events.AddSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.AddUniqueConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AllocWriteIdEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterTableEvent;\n+import org.apache.hadoop.hive.metastore.events.CommitTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.ConfigChangeEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateFunctionEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateTableEvent;\n+import org.apache.hadoop.hive.metastore.events.DeletePartitionColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.DeleteTableColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.DropCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.DropConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.DropDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.DropFunctionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.DropPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropTableEvent;\n+import org.apache.hadoop.hive.metastore.events.InsertEvent;\n+import org.apache.hadoop.hive.metastore.events.LoadPartitionDoneEvent;\n+import org.apache.hadoop.hive.metastore.events.OpenTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAddPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAddSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAuthorizationCallEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreEventContext;\n+import org.apache.hadoop.hive.metastore.events.PreLoadPartitionDoneEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadhSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.UpdatePartitionColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.UpdateTableColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.messaging.EventMessage;\n+import org.apache.hadoop.hive.metastore.metrics.Metrics;\n+import org.apache.hadoop.hive.metastore.metrics.MetricsConstants;\n+import org.apache.hadoop.hive.metastore.metrics.PerfLogger;\n+import org.apache.hadoop.hive.metastore.partition.spec.PartitionSpecProxy;\n+import org.apache.hadoop.hive.metastore.txn.CompactionInfo;\n+import org.apache.hadoop.hive.metastore.txn.TxnStore;\n+import org.apache.hadoop.hive.metastore.txn.TxnUtils;\n+import org.apache.hadoop.hive.metastore.utils.FileUtils;\n+import org.apache.hadoop.hive.metastore.utils.FilterUtils;\n+import org.apache.hadoop.hive.metastore.utils.HdfsUtils;\n+import org.apache.hadoop.hive.metastore.utils.JavaUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetaStoreServerUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetaStoreUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetastoreVersionInfo;\n+import org.apache.hadoop.hive.metastore.utils.SecurityUtils;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.apache.hadoop.util.ReflectionUtils;\n+import org.apache.thrift.TException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.jdo.JDOException;\n+import java.io.IOException;\n+import java.lang.reflect.Constructor;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Modifier;\n+import java.lang.reflect.UndeclaredThrowableException;\n+import java.nio.ByteBuffer;\n+import java.security.PrivilegedExceptionAction;\n+import java.util.AbstractMap;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.BitSet;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.LinkedHashMap;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.regex.Pattern;\n+\n+import static org.apache.commons.lang3.StringUtils.isBlank;\n+import static org.apache.commons.lang3.StringUtils.join;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_CATALOG_NAME;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_DATABASE_COMMENT;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_DATABASE_NAME;\n+import static org.apache.hadoop.hive.metastore.Warehouse.getCatalogQualifiedTableName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.CAT_NAME;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.DB_NAME;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.getDefaultCatalog;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.parseDbName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.prependCatalogToDbName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.prependNotNullCatToDbName;\n+\n+public class HMSHandler extends FacebookBase implements IHMSHandler {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "948f06762577c5be35d34ee95149b7493685396a"}, "originalPosition": 178}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODU0OTAzNQ==", "bodyText": "Is this a copy of the nested class or did you have to make any changes to it? If yes, can you please describe the changes so that it is easier to review?", "url": "https://github.com/apache/hive/pull/1787#discussion_r558549035", "createdAt": "2021-01-15T19:32:50Z", "author": {"login": "vihangk1"}, "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/HMSHandler.java", "diffHunk": "@@ -0,0 +1,10155 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hadoop.hive.metastore;\n+\n+import com.codahale.metrics.Counter;\n+import com.codahale.metrics.Timer;\n+import com.facebook.fb303.FacebookBase;\n+import com.facebook.fb303.fb_status;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Preconditions;\n+import com.google.common.base.Splitter;\n+import com.google.common.base.Supplier;\n+import com.google.common.base.Suppliers;\n+import com.google.common.collect.Lists;\n+import com.google.common.util.concurrent.ThreadFactoryBuilder;\n+import org.apache.commons.collections.CollectionUtils;\n+import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.fs.FileStatus;\n+import org.apache.hadoop.fs.FileSystem;\n+import org.apache.hadoop.fs.Path;\n+import org.apache.hadoop.hive.common.AcidConstants;\n+import org.apache.hadoop.hive.common.AcidMetaDataFile;\n+import org.apache.hadoop.hive.common.StatsSetupConst;\n+import org.apache.hadoop.hive.common.TableName;\n+import org.apache.hadoop.hive.common.ValidReaderWriteIdList;\n+import org.apache.hadoop.hive.common.ValidWriteIdList;\n+import org.apache.hadoop.hive.common.repl.ReplConst;\n+import org.apache.hadoop.hive.metastore.api.*;\n+import org.apache.hadoop.hive.metastore.conf.MetastoreConf;\n+import org.apache.hadoop.hive.metastore.events.AbortTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.AcidWriteEvent;\n+import org.apache.hadoop.hive.metastore.events.AddCheckConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddDefaultConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddForeignKeyEvent;\n+import org.apache.hadoop.hive.metastore.events.AddNotNullConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AddPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.AddPrimaryKeyEvent;\n+import org.apache.hadoop.hive.metastore.events.AddSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.AddUniqueConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.AllocWriteIdEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.AlterTableEvent;\n+import org.apache.hadoop.hive.metastore.events.CommitTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.ConfigChangeEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateFunctionEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.CreateTableEvent;\n+import org.apache.hadoop.hive.metastore.events.DeletePartitionColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.DeleteTableColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.DropCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.DropConstraintEvent;\n+import org.apache.hadoop.hive.metastore.events.DropDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.DropFunctionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.DropPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.DropTableEvent;\n+import org.apache.hadoop.hive.metastore.events.InsertEvent;\n+import org.apache.hadoop.hive.metastore.events.LoadPartitionDoneEvent;\n+import org.apache.hadoop.hive.metastore.events.OpenTxnEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAddPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAddSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAlterTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreAuthorizationCallEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreCreateTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropPartitionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.PreDropTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreEventContext;\n+import org.apache.hadoop.hive.metastore.events.PreLoadPartitionDoneEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadCatalogEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadDatabaseEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadISchemaEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadTableEvent;\n+import org.apache.hadoop.hive.metastore.events.PreReadhSchemaVersionEvent;\n+import org.apache.hadoop.hive.metastore.events.UpdatePartitionColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.events.UpdateTableColumnStatEvent;\n+import org.apache.hadoop.hive.metastore.messaging.EventMessage;\n+import org.apache.hadoop.hive.metastore.metrics.Metrics;\n+import org.apache.hadoop.hive.metastore.metrics.MetricsConstants;\n+import org.apache.hadoop.hive.metastore.metrics.PerfLogger;\n+import org.apache.hadoop.hive.metastore.partition.spec.PartitionSpecProxy;\n+import org.apache.hadoop.hive.metastore.txn.CompactionInfo;\n+import org.apache.hadoop.hive.metastore.txn.TxnStore;\n+import org.apache.hadoop.hive.metastore.txn.TxnUtils;\n+import org.apache.hadoop.hive.metastore.utils.FileUtils;\n+import org.apache.hadoop.hive.metastore.utils.FilterUtils;\n+import org.apache.hadoop.hive.metastore.utils.HdfsUtils;\n+import org.apache.hadoop.hive.metastore.utils.JavaUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetaStoreServerUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetaStoreUtils;\n+import org.apache.hadoop.hive.metastore.utils.MetastoreVersionInfo;\n+import org.apache.hadoop.hive.metastore.utils.SecurityUtils;\n+import org.apache.hadoop.security.UserGroupInformation;\n+import org.apache.hadoop.util.ReflectionUtils;\n+import org.apache.thrift.TException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import javax.jdo.JDOException;\n+import java.io.IOException;\n+import java.lang.reflect.Constructor;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Modifier;\n+import java.lang.reflect.UndeclaredThrowableException;\n+import java.nio.ByteBuffer;\n+import java.security.PrivilegedExceptionAction;\n+import java.util.AbstractMap;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.BitSet;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.LinkedHashMap;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.regex.Pattern;\n+\n+import static org.apache.commons.lang3.StringUtils.isBlank;\n+import static org.apache.commons.lang3.StringUtils.join;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_CATALOG_NAME;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_DATABASE_COMMENT;\n+import static org.apache.hadoop.hive.metastore.Warehouse.DEFAULT_DATABASE_NAME;\n+import static org.apache.hadoop.hive.metastore.Warehouse.getCatalogQualifiedTableName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.CAT_NAME;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.DB_NAME;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.getDefaultCatalog;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.parseDbName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.prependCatalogToDbName;\n+import static org.apache.hadoop.hive.metastore.utils.MetaStoreUtils.prependNotNullCatToDbName;\n+\n+public class HMSHandler extends FacebookBase implements IHMSHandler {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "948f06762577c5be35d34ee95149b7493685396a"}, "originalPosition": 178}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODU1MDE2Mw==", "bodyText": "This method is exclusively doing all the operations in HMSHandler. Does it make sense to have this method here?", "url": "https://github.com/apache/hive/pull/1787#discussion_r558550163", "createdAt": "2021-01-15T19:35:20Z", "author": {"login": "vihangk1"}, "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java", "diffHunk": "@@ -10740,7 +10740,7 @@ private static String getServerHostName() throws Exception {\n     }\n   }\n \n-  private static void cleanupRawStore() {\n+  static void cleanupRawStore() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "948f06762577c5be35d34ee95149b7493685396a"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8d82006367d1febbbc4d768aaf120420a7e6ab88", "author": {"user": {"login": "dataproc-metastore", "name": "Dataproc Metastore"}}, "url": "https://github.com/apache/hive/commit/8d82006367d1febbbc4d768aaf120420a7e6ab88", "committedDate": "2021-01-17T14:34:31Z", "message": "Move cleanupRawStore method from HiveMetaStore to HMSHandler. Add a class-level comment to HMSHandler"}, "afterCommit": {"oid": "84d36d307e4d9a8b8ecb8399a2ab1dc5bb9996d9", "author": {"user": {"login": "dataproc-metastore", "name": "Dataproc Metastore"}}, "url": "https://github.com/apache/hive/commit/84d36d307e4d9a8b8ecb8399a2ab1dc5bb9996d9", "committedDate": "2021-01-22T16:25:37Z", "message": "Move new features from HiveMetaStore.HMSHandler to standalone HMSHandler to resolve merge conflicts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc1NzQ1ODY0", "url": "https://github.com/apache/hive/pull/1787#pullrequestreview-575745864", "createdAt": "2021-01-25T19:39:57Z", "commit": {"oid": "84d36d307e4d9a8b8ecb8399a2ab1dc5bb9996d9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee7b44e169f0fde4da2ceb83bba3517593a81a5c", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/ee7b44e169f0fde4da2ceb83bba3517593a81a5c", "committedDate": "2021-01-31T19:57:31Z", "message": "Copy HMSHandler to a separate class out of HiveMetastore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c49ab9352b6d7588d5b44e2b965e1781b7cc027", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/0c49ab9352b6d7588d5b44e2b965e1781b7cc027", "committedDate": "2021-01-31T19:57:54Z", "message": "Modify related files to use HMSHanlder instead of HiveMetastore.HMSHanlder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72f53dca34e9e69ad8debf285715023aa6fa9258", "author": {"user": {"login": "dataproc-metastore", "name": "Dataproc Metastore"}}, "url": "https://github.com/apache/hive/commit/72f53dca34e9e69ad8debf285715023aa6fa9258", "committedDate": "2021-01-31T19:57:58Z", "message": "Remove unused imports in HiveMetaStore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e122199482cb381a07652986889b576e166581c9", "author": {"user": {"login": "dataproc-metastore", "name": "Dataproc Metastore"}}, "url": "https://github.com/apache/hive/commit/e122199482cb381a07652986889b576e166581c9", "committedDate": "2021-01-31T19:57:58Z", "message": "Remove unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99815d0369078f23389c1db1280090487c1432c9", "author": {"user": {"login": "dataproc-metastore", "name": "Dataproc Metastore"}}, "url": "https://github.com/apache/hive/commit/99815d0369078f23389c1db1280090487c1432c9", "committedDate": "2021-01-31T19:57:58Z", "message": "Fix indentation and other Checkstyle violations in HMSHandler, HiveMetaStore, HMSMetricsListener, HiveMetaStoreChecker, TestHiveMetaStoreTimeout, IHMSHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d7f508c3ca5975e504cb0b4befe84a6760fcc87", "author": {"user": {"login": "dataproc-metastore", "name": "Dataproc Metastore"}}, "url": "https://github.com/apache/hive/commit/5d7f508c3ca5975e504cb0b4befe84a6760fcc87", "committedDate": "2021-01-31T19:57:59Z", "message": "Move cleanupRawStore method from HiveMetaStore to HMSHandler. Add a class-level comment to HMSHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "611f14714864f8e852646179c1e3d5dec69e5414", "author": {"user": {"login": "dataproc-metastore", "name": "Dataproc Metastore"}}, "url": "https://github.com/apache/hive/commit/611f14714864f8e852646179c1e3d5dec69e5414", "committedDate": "2021-01-31T19:57:59Z", "message": "Move new features from HiveMetaStore.HMSHandler to standalone HMSHandler to resolve merge conflicts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ad0078ceba44b75e299b737a929dca304fca43b", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/3ad0078ceba44b75e299b737a929dca304fca43b", "committedDate": "2021-01-31T20:01:25Z", "message": "Modify HMSHanlder to merge changes from HIVE-24667"}, "afterCommit": {"oid": "611f14714864f8e852646179c1e3d5dec69e5414", "author": {"user": {"login": "dataproc-metastore", "name": "Dataproc Metastore"}}, "url": "https://github.com/apache/hive/commit/611f14714864f8e852646179c1e3d5dec69e5414", "committedDate": "2021-01-31T19:57:59Z", "message": "Move new features from HiveMetaStore.HMSHandler to standalone HMSHandler to resolve merge conflicts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ea04ad53595deccdd03513d1b47933404e6b3cb", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/6ea04ad53595deccdd03513d1b47933404e6b3cb", "committedDate": "2021-01-31T20:18:54Z", "message": "Modify HMSHanlder to merge changes from HIVE-24667"}, "afterCommit": {"oid": "109f30be4f3661dce5fde2a9f2bd1967db15d2e7", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/109f30be4f3661dce5fde2a9f2bd1967db15d2e7", "committedDate": "2021-01-31T20:20:09Z", "message": "Modify HMSHanlder to merge changes from HIVE-24667"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "109f30be4f3661dce5fde2a9f2bd1967db15d2e7", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/109f30be4f3661dce5fde2a9f2bd1967db15d2e7", "committedDate": "2021-01-31T20:20:09Z", "message": "Modify HMSHanlder to merge changes from HIVE-24667"}, "afterCommit": {"oid": "7f1f72e41b6a33c27700b64ee5db5b561d63b660", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/7f1f72e41b6a33c27700b64ee5db5b561d63b660", "committedDate": "2021-02-01T00:39:21Z", "message": "Modify HMSHanlder to merge changes from HIVE-24667."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f1f72e41b6a33c27700b64ee5db5b561d63b660", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/7f1f72e41b6a33c27700b64ee5db5b561d63b660", "committedDate": "2021-02-01T00:39:21Z", "message": "Modify HMSHanlder to merge changes from HIVE-24667."}, "afterCommit": {"oid": "bc15db7427f291725813d61f0791ca6754c5aed0", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/bc15db7427f291725813d61f0791ca6754c5aed0", "committedDate": "2021-02-01T03:04:40Z", "message": "Modify HMSHanlder to merge changes from HIVE-24667"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bc15db7427f291725813d61f0791ca6754c5aed0", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/bc15db7427f291725813d61f0791ca6754c5aed0", "committedDate": "2021-02-01T03:04:40Z", "message": "Modify HMSHanlder to merge changes from HIVE-24667"}, "afterCommit": {"oid": "203fd72c373c33cb267754d8fa02a720da05ef65", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/203fd72c373c33cb267754d8fa02a720da05ef65", "committedDate": "2021-02-01T17:01:27Z", "message": "Modify HMSHanlder to merge changes from HIVE-24667."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2894240c7370117e1a04129fa6f032a98b7b9ff", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/a2894240c7370117e1a04129fa6f032a98b7b9ff", "committedDate": "2021-02-02T00:20:27Z", "message": "Modify HMSHanlder to merge changes from HIVE-24667"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "203fd72c373c33cb267754d8fa02a720da05ef65", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/203fd72c373c33cb267754d8fa02a720da05ef65", "committedDate": "2021-02-01T17:01:27Z", "message": "Modify HMSHanlder to merge changes from HIVE-24667."}, "afterCommit": {"oid": "a2894240c7370117e1a04129fa6f032a98b7b9ff", "author": {"user": {"login": "coufon", "name": "Zhou Fang"}}, "url": "https://github.com/apache/hive/commit/a2894240c7370117e1a04129fa6f032a98b7b9ff", "committedDate": "2021-02-02T00:20:27Z", "message": "Modify HMSHanlder to merge changes from HIVE-24667"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2935, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}