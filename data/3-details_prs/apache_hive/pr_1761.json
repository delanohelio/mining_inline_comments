{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1NzgxNjIy", "number": 1761, "title": "HIVE-24514: UpdateMDatabaseURI does not update managed location URI", "bodyText": "What changes were proposed in this pull request?\nWhen FS Root is updated using metatool, if the DB has managed location defined,\nupdateMDatabaseURI API should update the managed location as well. Currently it only updates location uri.\nWhy are the changes needed?\nHive metatool is used for cases where NN changes and the metastore fs root has to be updated. When updating the fs root using metatool, if the databases have MANAGEDLOCATION explicitly defined the tool misses to update the fs root of the managed location.\nDoes this PR introduce any user-facing change?\nFixes user facing bug for specific fs root change scenario.\nHow was this patch tested?\nManually in test cluster which has ability to Update FS Root.", "createdAt": "2020-12-10T09:14:56Z", "url": "https://github.com/apache/hive/pull/1761", "merged": true, "mergeCommit": {"oid": "89073a94354f0cc14ec4ae0a43e05aae29276b4d"}, "closed": true, "closedAt": "2021-01-15T13:52:08Z", "author": {"login": "prasanthj"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdlPYLUgFqTU1MDYwOTQ4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdwUK3PABqjQyMDk4MDc0NTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNjA5NDgz", "url": "https://github.com/apache/hive/pull/1761#pullrequestreview-550609483", "createdAt": "2020-12-11T22:07:24Z", "commit": {"oid": "b4bb8e8cba20214dc01d082c1e2ff150fa58dc9a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMjowNzoyNVrOIERJ9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMjowNzoyNVrOIERJ9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM0NjI5Mw==", "bodyText": "Looks like we are setting the value of locationURI for managedLocation. dbLoc is based on mDB.getLocationURI(). Instead we should have similar logic where string substitutions are performed on DB's managedlocation as well.", "url": "https://github.com/apache/hive/pull/1761#discussion_r541346293", "createdAt": "2020-12-11T22:07:25Z", "author": {"login": "nrg4878"}, "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/ObjectStore.java", "diffHunk": "@@ -8556,6 +8556,9 @@ public UpdateMDatabaseURIRetVal updateMDatabaseURI(URI oldLoc, URI newLoc, boole\n             updateLocations.put(locationURI.toString(), dbLoc);\n             if (!dryRun) {\n               mDB.setLocationUri(dbLoc);\n+              if (org.apache.commons.lang3.StringUtils.isNotBlank(mDB.getManagedLocationUri())) {\n+                mDB.setManagedLocationUri(dbLoc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4bb8e8cba20214dc01d082c1e2ff150fa58dc9a"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a55aadad6f77035ba42cac1f2523cfafb4ef2c9", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/3a55aadad6f77035ba42cac1f2523cfafb4ef2c9", "committedDate": "2020-12-15T07:42:43Z", "message": "addressed Naveen's review comments"}, "afterCommit": {"oid": "8626009a6a1c4b977cdcb5facd9b3f37a99902da", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/8626009a6a1c4b977cdcb5facd9b3f37a99902da", "committedDate": "2021-01-12T10:12:02Z", "message": "addressed Naveen's review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8626009a6a1c4b977cdcb5facd9b3f37a99902da", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/8626009a6a1c4b977cdcb5facd9b3f37a99902da", "committedDate": "2021-01-12T10:12:02Z", "message": "addressed Naveen's review comments"}, "afterCommit": {"oid": "1ffbc9810403084df3a5c9e388c47c4d6fecf261", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/1ffbc9810403084df3a5c9e388c47c4d6fecf261", "committedDate": "2021-01-13T11:42:48Z", "message": "addressed Naveen's review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3NTg1MzYy", "url": "https://github.com/apache/hive/pull/1761#pullrequestreview-567585362", "createdAt": "2021-01-13T20:17:57Z", "commit": {"oid": "1ffbc9810403084df3a5c9e388c47c4d6fecf261"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e533d699e69dd2fb8c73955f6e24ed84d2c4e133", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/e533d699e69dd2fb8c73955f6e24ed84d2c4e133", "committedDate": "2021-01-15T07:55:17Z", "message": "HIVE-24514: UpdateMDatabaseURI does not update managed location URI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ee4a5a6d4fd891978b2daa6c4618115d3803baa", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/0ee4a5a6d4fd891978b2daa6c4618115d3803baa", "committedDate": "2021-01-15T07:55:17Z", "message": "addressed Naveen's review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1ffbc9810403084df3a5c9e388c47c4d6fecf261", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/1ffbc9810403084df3a5c9e388c47c4d6fecf261", "committedDate": "2021-01-13T11:42:48Z", "message": "addressed Naveen's review comments"}, "afterCommit": {"oid": "0ee4a5a6d4fd891978b2daa6c4618115d3803baa", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/0ee4a5a6d4fd891978b2daa6c4618115d3803baa", "committedDate": "2021-01-15T07:55:17Z", "message": "addressed Naveen's review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2899, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}