{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0OTQ5MzI1", "number": 1650, "title": "HIVE-24353: performance: do not throw exceptions when parsing timestamps", "bodyText": "This resolves https://issues.apache.org/jira/browse/HIVE-24353\nWhat changes were proposed in this pull request?\nChange timestampTZ parsing from using convenience methods that throw exceptions to a chain of queries against the parsed temporalAccessor.\nWhy are the changes needed?\nThis improves the performance for timestamp parsing.\nDoes this PR introduce any user-facing change?\nNo.\nHow was this patch tested?\nExisting tests are covering all branches already.\nOne test was added, but it has no assertions.", "createdAt": "2020-11-03T19:32:46Z", "url": "https://github.com/apache/hive/pull/1650", "merged": true, "mergeCommit": {"oid": "8ef7f094f8d6050f59184ec6b05bd46bd5de5c2d"}, "closed": true, "closedAt": "2021-02-02T19:00:15Z", "author": {"login": "VPriesnitz"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdY-U1GgH2gAyNTE0OTQ5MzI1OmJkNTY0YTc3MTI4Y2Y0OWJmYmFmYTRhODY3YmFlYzk4Y2E2NGU2ZTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd09CRJgH2gAyNTE0OTQ5MzI1OjFmZWQ5OWQ4Y2VhYmY4Mzc5MmQzMWEzMGI0YTg4OTEyY2RlODc0YzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bd564a77128cf49bfbafa4a867baec98ca64e6e0", "author": {"user": {"login": "VPriesnitz", "name": null}}, "url": "https://github.com/apache/hive/commit/bd564a77128cf49bfbafa4a867baec98ca64e6e0", "committedDate": "2020-11-03T19:28:17Z", "message": "performance: do not throw exceptions when parsing dates"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMDYxMTUz", "url": "https://github.com/apache/hive/pull/1650#pullrequestreview-530061153", "createdAt": "2020-11-13T13:29:51Z", "commit": {"oid": "bd564a77128cf49bfbafa4a867baec98ca64e6e0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMzoyOTo1MlrOHyuWUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxMzozMDozNlrOHyuX6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjk1MDIyNQ==", "bodyText": "First loop redundant?", "url": "https://github.com/apache/hive/pull/1650#discussion_r522950225", "createdAt": "2020-11-13T13:29:52Z", "author": {"login": "pgaref"}, "path": "common/src/test/org/apache/hadoop/hive/common/type/TestTimestampTZ.java", "diffHunk": "@@ -84,6 +86,18 @@ public void testVariations() {\n     TimestampTZUtil.parse(\"2017-05-08 07:45:00-3:00\");\n   }\n \n+  @Test\n+  public void testPerformance() {\n+    for (int i = 0; i < 100; i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd564a77128cf49bfbafa4a867baec98ca64e6e0"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjk1MDYzMw==", "bodyText": "Can we add some randomness on the parsed timestamp? Maybe use i as part of time?", "url": "https://github.com/apache/hive/pull/1650#discussion_r522950633", "createdAt": "2020-11-13T13:30:36Z", "author": {"login": "pgaref"}, "path": "common/src/test/org/apache/hadoop/hive/common/type/TestTimestampTZ.java", "diffHunk": "@@ -84,6 +86,18 @@ public void testVariations() {\n     TimestampTZUtil.parse(\"2017-05-08 07:45:00-3:00\");\n   }\n \n+  @Test\n+  public void testPerformance() {\n+    for (int i = 0; i < 100; i++) {\n+      TimestampTZUtil.parse(\"2017-01-01 13:33:00\", ZoneId.of(\"UTC\"));\n+    }\n+    Stopwatch sw = Stopwatch.createStarted();\n+    for (int i = 0; i < 10000; i++) {\n+      TimestampTZUtil.parse(\"2017-01-01 13:33:00\", ZoneId.of(\"UTC\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd564a77128cf49bfbafa4a867baec98ca64e6e0"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "955cae36f5117fc26edca2f22124b063c2c92e81", "author": {"user": {"login": "VPriesnitz", "name": null}}, "url": "https://github.com/apache/hive/commit/955cae36f5117fc26edca2f22124b063c2c92e81", "committedDate": "2020-11-21T13:44:27Z", "message": "Address PR concerns."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MzMyMzkx", "url": "https://github.com/apache/hive/pull/1650#pullrequestreview-536332391", "createdAt": "2020-11-23T10:17:29Z", "commit": {"oid": "955cae36f5117fc26edca2f22124b063c2c92e81"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMDoxNzozMFrOH4G8JQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMDoxNzozMFrOH4G8JQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU5NjAwNQ==", "bodyText": "I see -- usually we test the correctness with Junit tests and the performance sensitive parts with jmh tests (where you could for example test and compare the old behaviour with the new) -- check itests->hive-jmh package.\nNot critical for this change though", "url": "https://github.com/apache/hive/pull/1650#discussion_r528596005", "createdAt": "2020-11-23T10:17:30Z", "author": {"login": "pgaref"}, "path": "common/src/test/org/apache/hadoop/hive/common/type/TestTimestampTZ.java", "diffHunk": "@@ -84,6 +86,18 @@ public void testVariations() {\n     TimestampTZUtil.parse(\"2017-05-08 07:45:00-3:00\");\n   }\n \n+  @Test\n+  public void testPerformance() {\n+    for (int i = 0; i < 100; i++) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjk1MDIyNQ=="}, "originalCommit": {"oid": "bd564a77128cf49bfbafa4a867baec98ca64e6e0"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcxMDA0NDg5", "url": "https://github.com/apache/hive/pull/1650#pullrequestreview-571004489", "createdAt": "2021-01-19T08:31:58Z", "commit": {"oid": "955cae36f5117fc26edca2f22124b063c2c92e81"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fed99d8ceabf83792d31a30b4a88912cde874c0", "author": {"user": {"login": "VPriesnitz", "name": null}}, "url": "https://github.com/apache/hive/commit/1fed99d8ceabf83792d31a30b4a88912cde874c0", "committedDate": "2021-01-29T17:47:59Z", "message": "removed performance test."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3010, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}