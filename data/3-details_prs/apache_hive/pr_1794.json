{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNzM4NDAw", "number": 1794, "title": "HIVE-24553. Exclude calcite from test-jar dependency of hive-exec", "bodyText": "What changes were proposed in this pull request?\n\nThis patch proposes to exclude calcite dependencies from test-jar dependency of hive-exec.\nWhy are the changes needed?\n\nThe test \"org.apache.hive.beeline.cli.TestHiveCli - testSetHeaderValue\" we found the exception:\nCaused by: java.lang.NoSuchMethodError: org.apache.calcite.rel.RelCollationImpl.<init>(Lorg/apache/hive/com/google/common/collect/ImmutableList;)V\n\tat org.apache.hadoop.hive.ql.optimizer.calcite.HiveRelCollation.<init>(HiveRelCollation.java:29) ~[hive-exec-2.3.8.jar:2.3.8]\n\tat org.apache.hadoop.hive.ql.optimizer.calcite.RelOptHiveTable.getCollationList(RelOptHiveTable.java:181) ~[hive-exec-2.3.8.jar:2.3.8]\n\tat org.apache.calcite.rel.metadata.RelMdCollation.table(RelMdCollation.java:175) ~[calcite-core-1.10.0.jar:1.10.0]\n\tat org.apache.calcite.rel.metadata.RelMdCollation.collations(RelMdCollation.java:122) ~[calcite-core-1.10.0.jar:1.10.0]\n\tat GeneratedMetadataHandler_Collation.collations_$(Unknown Source) ~[?:?]\n\tat GeneratedMetadataHandler_Collation.collations(Unknown Source) ~[?:?]\n\tat org.apache.calcite.rel.metadata.RelMetadataQuery.collations(RelMetadataQuery.java:482) ~[calcite-core-1.10.0.jar:1.10.0]\n\tat org.apache.calcite.sql2rel.RelFieldTrimmer.trimChild(RelFieldTrimmer.java:189) ~[calcite-core-1.10.0.jar:1.10.0]\n\tat org.apache.calcite.sql2rel.RelFieldTrimmer.trimFields(RelFieldTrimmer.java:374) ~[calcite-core-1.10.0.jar:1.10.0]\n\tat org.apache.hadoop.hive.ql.optimizer.calcite.rules.HiveRelFieldTrimmer.trimFields(HiveRelFieldTrimmer.java:273) ~[hive-exec-2.3.8.jar:2.3.8]\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_262]\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_262]\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_262]\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_262]\n\tat org.apache.calcite.util.ReflectUtil$2.invoke(ReflectUtil.java:531) ~[calcite-core-1.10.0.jar:1.10.0]\n\tat org.apache.calcite.sql2rel.RelFieldTrimmer.dispatchTrimFields(RelFieldTrimmer.java:270) ~[calcite-core-1.10.0.jar:1.10.0]\n\tat org.apache.calcite.sql2rel.RelFieldTrimmer.trim(RelFieldTrimmer.java:160) ~[calcite-core-1.10.0.jar:1.10.0]\n\tat org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.apply(CalcitePlanner.java:1331) ~[hive-exec-2.3.8.jar:2.3.8]\n\tat org.apache.hadoop.hive.ql.parse.CalcitePlanner$CalcitePlannerAction.apply(CalcitePlanner.java:1261) ~[hive-exec-2.3.8.jar:2.3.8]\n\tat org.apache.calcite.tools.Frameworks$1.apply(Frameworks.java:113) ~[calcite-core-1.10.0.jar:1.10.0]\n\tat org.apache.calcite.prepare.CalcitePrepareImpl.perform(CalcitePrepareImpl.java:997) ~[calcite-core-1.10.0.jar:1.10.0]\n\tat org.apache.calcite.tools.Frameworks.withPrepare(Frameworks.java:149) ~[calcite-core-1.10.0.jar:1.10.0]\n\tat org.apache.calcite.tools.Frameworks.withPlanner(Frameworks.java:106) ~[calcite-core-1.10.0.jar:1.10.0]\n\tat org.apache.hadoop.hive.ql.parse.CalcitePlanner.logicalPlan(CalcitePlanner.java:1069) ~[hive-exec-2.3.8.jar:2.3.8]\n\tat org.apache.hadoop.hive.ql.parse.CalcitePlanner.getOptimizedAST(CalcitePlanner.java:1085) ~[hive-exec-2.3.8.jar:2.3.8]\n\tat org.apache.hadoop.hive.ql.parse.CalcitePlanner.genOPTree(CalcitePlanner.java:364) ~[hive-exec-2.3.8.jar:2.3.8]\n\tat org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:11138) ~[hive-exec-2.3.8.jar:2.3.8]\n\tat org.apache.hadoop.hive.ql.parse.CalcitePlanner.analyzeInternal(CalcitePlanner.java:286) ~[hive-exec-2.3.8.jar:2.3.8]\n\tat org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:258) ~[hive-exec-2.3.8.jar:2.3.8]\n\tat org.apache.hadoop.hive.ql.Driver.compile(Driver.java:512) ~[hive-exec-2.3.8.jar:2.3.8]\n\tat org.apache.hadoop.hive.ql.Driver.compileInternal(Driver.java:1317) ~[hive-exec-2.3.8.jar:2.3.8]\n\tat org.apache.hadoop.hive.ql.Driver.compileAndRespond(Driver.java:1295) ~[hive-exec-2.3.8.jar:2.3.8]\n\tat org.apache.hive.service.cli.operation.SQLOperation.prepare(SQLOperation.java:204) ~[hive-service-2.3.8.jar:2.3.8]\n\t... 50 more\n\nThis looks like adding dependency of test-jar of hive-exec pulls in the unshaded calcite dependencies which conflicts with shaded calcite. We should exclude unshaded calcite when adding test-jar of hive-exec.\nDoes this PR introduce any user-facing change?\n\nNo\nHow was this patch tested?\n\nUnit test.", "createdAt": "2020-12-18T19:39:08Z", "url": "https://github.com/apache/hive/pull/1794", "merged": true, "mergeCommit": {"oid": "d7caeaf5d24c924720a93999ca1b8ef0f971c44e"}, "closed": true, "closedAt": "2020-12-21T18:18:12Z", "author": {"login": "viirya"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdndbk7gH2gAyNTQyNzM4NDAwOmNmZWNmOTkwNDdmZDFlMGUwNGVkOTgyYmRhZjgzMzNlODRkMTI4NTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoaEufAFqTU1NjU3Mzg0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cfecf99047fd1e0e04ed982bdaf8333e84d12852", "author": {"user": {"login": "viirya", "name": "Liang-Chi Hsieh"}}, "url": "https://github.com/apache/hive/commit/cfecf99047fd1e0e04ed982bdaf8333e84d12852", "committedDate": "2020-12-18T19:37:39Z", "message": "Exclude calcite in beeline."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTYwNjg4", "url": "https://github.com/apache/hive/pull/1794#pullrequestreview-555960688", "createdAt": "2020-12-19T18:39:58Z", "commit": {"oid": "cfecf99047fd1e0e04ed982bdaf8333e84d12852"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxODozOTo1OVrOII9o0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQxODozOTo1OVrOII9o0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI2OTM5Mg==", "bodyText": "Looks good as I no longer see the test failure \ud83d\udc4d . BTW do you know why we need to exclude calcite here but not in other places where hive-exec is also used?", "url": "https://github.com/apache/hive/pull/1794#discussion_r546269392", "createdAt": "2020-12-19T18:39:59Z", "author": {"login": "sunchao"}, "path": "beeline/pom.xml", "diffHunk": "@@ -99,6 +99,20 @@\n       <version>${project.version}</version>\n       <classifier>tests</classifier>\n       <scope>test</scope>\n+      <exclusions>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfecf99047fd1e0e04ed982bdaf8333e84d12852"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4d05d0c227b871914e4463da7e1d58e46890fce", "author": {"user": {"login": "viirya", "name": "Liang-Chi Hsieh"}}, "url": "https://github.com/apache/hive/commit/b4d05d0c227b871914e4463da7e1d58e46890fce", "committedDate": "2020-12-19T21:55:42Z", "message": "Exclude calcite when adding hive-exec test classifier dependency."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NTczODQ1", "url": "https://github.com/apache/hive/pull/1794#pullrequestreview-556573845", "createdAt": "2020-12-21T18:16:54Z", "commit": {"oid": "b4d05d0c227b871914e4463da7e1d58e46890fce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2943, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}