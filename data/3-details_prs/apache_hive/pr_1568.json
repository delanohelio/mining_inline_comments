{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwODU3NDgw", "number": 1568, "title": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows", "bodyText": "", "createdAt": "2020-10-09T22:57:50Z", "url": "https://github.com/apache/hive/pull/1568", "merged": true, "mergeCommit": {"oid": "8eba401198fac2fca40c6efc9f72f767dce51ee4"}, "closed": true, "closedAt": "2020-10-13T16:37:48Z", "author": {"login": "nareshpr"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdR4yATgBqjM4Njc5MzY4Nzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSECctABqjM4Njk5MTA5MTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e1627219fe93e34f256764aef486188212651604", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/e1627219fe93e34f256764aef486188212651604", "committedDate": "2020-10-09T22:55:58Z", "message": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows"}, "afterCommit": {"oid": "03345d69a68b573cb8d3af621845761bec4881c9", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/03345d69a68b573cb8d3af621845761bec4881c9", "committedDate": "2020-10-12T19:02:54Z", "message": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2ODY4NDQ1", "url": "https://github.com/apache/hive/pull/1568#pullrequestreview-506868445", "createdAt": "2020-10-12T19:36:45Z", "commit": {"oid": "03345d69a68b573cb8d3af621845761bec4881c9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "03345d69a68b573cb8d3af621845761bec4881c9", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/03345d69a68b573cb8d3af621845761bec4881c9", "committedDate": "2020-10-12T19:02:54Z", "message": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows"}, "afterCommit": {"oid": "f4627086307828b82a557099b855e792dc8891ad", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/f4627086307828b82a557099b855e792dc8891ad", "committedDate": "2020-10-12T21:53:17Z", "message": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTgwODgw", "url": "https://github.com/apache/hive/pull/1568#pullrequestreview-506980880", "createdAt": "2020-10-12T23:47:25Z", "commit": {"oid": "f4627086307828b82a557099b855e792dc8891ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMzo0NzoyNlrOHgQmig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQyMzo0NzoyNlrOHgQmig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU4ODQ5MA==", "bodyText": "Can we move this check to just after getting TableScanOperator i.e. line 94/95? We will avoid un-necessary checkQBpForGlobalLimit and findOperators.", "url": "https://github.com/apache/hive/pull/1568#discussion_r503588490", "createdAt": "2020-10-12T23:47:26Z", "author": {"login": "vineetgarg02"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/optimizer/GlobalLimitOptimizer.java", "diffHunk": "@@ -99,27 +99,31 @@ public ParseContext transform(ParseContext pctx) throws SemanticException {\n         LimitDesc tempGlobalLimitDesc = tempGlobalLimit.getConf();\n         Table tab = ts.getConf().getTableMetadata();\n         Set<FilterOperator> filterOps = OperatorUtils.findOperators(ts, FilterOperator.class);\n-\n-        if (!tab.isPartitioned()) {\n-          if (filterOps.size() == 0) {\n-            Integer tempOffset = tempGlobalLimitDesc.getOffset();\n-            globalLimitCtx.enableOpt(tempGlobalLimitDesc.getLimit(),\n-                (tempOffset == null) ? 0 : tempOffset);\n-          }\n-        } else {\n-          // check if the pruner only contains partition columns\n-          if (onlyContainsPartnCols(tab, filterOps)) {\n-\n-            String alias = (String) topOps.keySet().toArray()[0];\n-            PrunedPartitionList partsList = pctx.getPrunedPartitions(alias, ts);\n-\n-            // If there is any unknown partition, create a map-reduce job for\n-            // the filter to prune correctly\n-            if (!partsList.hasUnknownPartitions()) {\n+        // StorageHandlers will always have empty tablePath.\n+        // GenMapRedUtils.setMapWork removes empty tablePath from input dir with select-Limit\n+        // InputFormat.getSplits wont be called if no input path & TS Vertex will have 0 task parallelism\n+        if (tab.getStorageHandler() == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4627086307828b82a557099b855e792dc8891ad"}, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f4627086307828b82a557099b855e792dc8891ad", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/f4627086307828b82a557099b855e792dc8891ad", "committedDate": "2020-10-12T21:53:17Z", "message": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows"}, "afterCommit": {"oid": "c6aa48c262cdfda3a9be3da9bedfee47deb2f0bc", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/c6aa48c262cdfda3a9be3da9bedfee47deb2f0bc", "committedDate": "2020-10-13T00:19:27Z", "message": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2OTkyNjc1", "url": "https://github.com/apache/hive/pull/1568#pullrequestreview-506992675", "createdAt": "2020-10-13T00:22:29Z", "commit": {"oid": "c6aa48c262cdfda3a9be3da9bedfee47deb2f0bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf464ffaf65ab269a8c954b7985146df5e7132ee", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/cf464ffaf65ab269a8c954b7985146df5e7132ee", "committedDate": "2020-10-13T08:09:54Z", "message": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c6aa48c262cdfda3a9be3da9bedfee47deb2f0bc", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/c6aa48c262cdfda3a9be3da9bedfee47deb2f0bc", "committedDate": "2020-10-13T00:19:27Z", "message": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows"}, "afterCommit": {"oid": "cf464ffaf65ab269a8c954b7985146df5e7132ee", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/cf464ffaf65ab269a8c954b7985146df5e7132ee", "committedDate": "2020-10-13T08:09:54Z", "message": "HIVE-24255: StorageHandler with select-limit query is returning 0 rows"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3165, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}