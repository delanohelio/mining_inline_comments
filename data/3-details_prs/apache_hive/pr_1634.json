{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzMTE4NzY5", "number": 1634, "title": "HIVE-24332: Make AbstractSerDe Superclass of all SerDes", "bodyText": "What changes were proposed in this pull request?\n\nWhy are the changes needed?\n\nDoes this PR introduce any user-facing change?\n\nHow was this patch tested?", "createdAt": "2020-10-30T16:20:34Z", "url": "https://github.com/apache/hive/pull/1634", "merged": true, "mergeCommit": {"oid": "a97448f84167e4e8c3615908556fe2e4163a43ca"}, "closed": true, "closedAt": "2020-12-21T14:29:14Z", "author": {"login": "belugabehr"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfcr5zgBqjQwMjk4NjU4MDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoE1JygFqTU1NjAzNjgxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2f84a395e44c4ff726aaaf06e0a023f77831f2e4", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/2f84a395e44c4ff726aaaf06e0a023f77831f2e4", "committedDate": "2020-11-02T15:06:04Z", "message": "Exclude older versions of Log4J"}, "afterCommit": {"oid": "242a97f465095e920fcddd96edc5afbf9f959786", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/242a97f465095e920fcddd96edc5afbf9f959786", "committedDate": "2020-11-23T22:13:50Z", "message": "Make parent SerDe interface"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8dea8f9ca465155b661214e33f3ff6d4191ee1a7", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/8dea8f9ca465155b661214e33f3ff6d4191ee1a7", "committedDate": "2020-11-24T16:01:01Z", "message": "Fix build. Reduce number of changes"}, "afterCommit": {"oid": "cfeffdeee24314d705805fef61e24c3ac0af769c", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/cfeffdeee24314d705805fef61e24c3ac0af769c", "committedDate": "2020-11-24T19:11:48Z", "message": "Make parent SerDe interface"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cfeffdeee24314d705805fef61e24c3ac0af769c", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/cfeffdeee24314d705805fef61e24c3ac0af769c", "committedDate": "2020-11-24T19:11:48Z", "message": "Make parent SerDe interface"}, "afterCommit": {"oid": "b45742bef0fc4d32b98d2382128a563b3b876c20", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/b45742bef0fc4d32b98d2382128a563b3b876c20", "committedDate": "2020-11-24T20:55:48Z", "message": "Fix compile errors"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b45742bef0fc4d32b98d2382128a563b3b876c20", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/b45742bef0fc4d32b98d2382128a563b3b876c20", "committedDate": "2020-11-24T20:55:48Z", "message": "Fix compile errors"}, "afterCommit": {"oid": "e296dd8ccb114dd189bf4165074780dcaac3e743", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/e296dd8ccb114dd189bf4165074780dcaac3e743", "committedDate": "2020-11-25T14:09:49Z", "message": "Fix compile errors"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e296dd8ccb114dd189bf4165074780dcaac3e743", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/e296dd8ccb114dd189bf4165074780dcaac3e743", "committedDate": "2020-11-25T14:09:49Z", "message": "Fix compile errors"}, "afterCommit": {"oid": "a82a5a1a471dd2448b6c8c36f52dd39b6bf5e27c", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/a82a5a1a471dd2448b6c8c36f52dd39b6bf5e27c", "committedDate": "2020-11-25T15:00:08Z", "message": "Fix compile errors"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a82a5a1a471dd2448b6c8c36f52dd39b6bf5e27c", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/a82a5a1a471dd2448b6c8c36f52dd39b6bf5e27c", "committedDate": "2020-11-25T15:00:08Z", "message": "Fix compile errors"}, "afterCommit": {"oid": "075e119f06d7904704e15cc9b99ca5e423396fff", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/075e119f06d7904704e15cc9b99ca5e423396fff", "committedDate": "2020-11-25T21:48:12Z", "message": "Fix compile errors"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "075e119f06d7904704e15cc9b99ca5e423396fff", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/075e119f06d7904704e15cc9b99ca5e423396fff", "committedDate": "2020-11-25T21:48:12Z", "message": "Fix compile errors"}, "afterCommit": {"oid": "189342618df30cad639cd39c1185008f4b2eb2a9", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/189342618df30cad639cd39c1185008f4b2eb2a9", "committedDate": "2020-12-02T20:17:55Z", "message": "Use correct configuration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwOTc0NTA0", "url": "https://github.com/apache/hive/pull/1634#pullrequestreview-550974504", "createdAt": "2020-12-13T23:28:57Z", "commit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xM1QyMzoyODo1OFrOIE68sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xM1QyMzo1ODozMFrOIE7ROg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMTAyNg==", "bodyText": "Nit: please rename tt_desc so that it follows the java naming conventions.", "url": "https://github.com/apache/hive/pull/1634#discussion_r542031026", "createdAt": "2020-12-13T23:28:58Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/optimizer/GenMapRedUtils.java", "diffHunk": "@@ -775,7 +775,7 @@ public static void setTaskPlan(Path path, String alias,\n     if (topOp instanceof TableScanOperator) {\n       try {\n         Utilities.addSchemaEvolutionToTableScanOperator(\n-          (StructObjectInspector) tt_desc.getDeserializer().getObjectInspector(),\n+          (StructObjectInspector) tt_desc.getSerDe().getObjectInspector(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMTA4OA==", "bodyText": "Please call the variable serDe.", "url": "https://github.com/apache/hive/pull/1634#discussion_r542031088", "createdAt": "2020-12-13T23:29:20Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/optimizer/TablePropertyEnrichmentOptimizer.java", "diffHunk": "@@ -115,13 +115,13 @@ public Object process(Node nd, Stack<Node> stack, NodeProcessorCtx procCtx, Obje\n       String deserializerClassName = null;\n       try {\n         deserializerClassName = tableScanDesc.getTableMetadata().getSd().getSerdeInfo().getSerializationLib();\n-        Deserializer deserializer = ReflectionUtil.newInstance(\n+        AbstractSerDe deserializer = ReflectionUtil.newInstance(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMTE3NQ==", "bodyText": "Please call the variable serDe, and the function getSerDeClass, to be consistent with TableDesc.", "url": "https://github.com/apache/hive/pull/1634#discussion_r542031175", "createdAt": "2020-12-13T23:29:38Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/plan/PartitionDesc.java", "diffHunk": "@@ -171,9 +171,9 @@ public String getDeserializerClassName() {\n   public Deserializer getDeserializer(Configuration conf) throws Exception {\n     Properties schema = getProperties();\n     String clazzName = getDeserializerClassName();\n-    Deserializer deserializer = ReflectionUtil.newInstance(conf.getClassByName(clazzName)\n-        .asSubclass(Deserializer.class), conf);\n-    SerDeUtils.initializeSerDe(deserializer, conf, getTableDesc().getProperties(), schema);\n+    AbstractSerDe deserializer = ReflectionUtil.newInstance(conf.getClassByName(clazzName)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMTY2Mw==", "bodyText": "I suggest to call it inputKeySerDe, and it can be created under this name, no need to call it serde for an interim time.", "url": "https://github.com/apache/hive/pull/1634#discussion_r542031663", "createdAt": "2020-12-13T23:32:21Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/tez/ReduceRecordSource.java", "diffHunk": "@@ -152,10 +152,11 @@ void init(JobConf jconf, Operator<?> reducer, boolean vectorized, TableDesc keyT\n     this.tag = tag;\n \n     try {\n-      inputKeyDeserializer = ReflectionUtils.newInstance(keyTableDesc\n-          .getDeserializerClass(), null);\n-      SerDeUtils.initializeSerDe(inputKeyDeserializer, null, keyTableDesc.getProperties(), null);\n-      keyObjectInspector = inputKeyDeserializer.getObjectInspector();\n+      AbstractSerDe serde = ReflectionUtils.newInstance(keyTableDesc.getSerDeClass(), null);\n+      serde.initialize(null, keyTableDesc.getProperties(), null);\n+\n+      inputKeyDeserializer = serde; ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMTcwMQ==", "bodyText": "Please call this inputValueSerDe", "url": "https://github.com/apache/hive/pull/1634#discussion_r542031701", "createdAt": "2020-12-13T23:32:33Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/tez/ReduceRecordSource.java", "diffHunk": "@@ -164,10 +165,8 @@ void init(JobConf jconf, Operator<?> reducer, boolean vectorized, TableDesc keyT\n \n       // We should initialize the SerDe with the TypeInfo when available.\n       this.valueTableDesc = valueTableDesc;\n-      inputValueDeserializer = (AbstractSerDe) ReflectionUtils.newInstance(\n-          valueTableDesc.getDeserializerClass(), null);\n-      SerDeUtils.initializeSerDe(inputValueDeserializer, null,\n-          valueTableDesc.getProperties(), null);\n+      inputValueDeserializer = (AbstractSerDe) ReflectionUtils.newInstance(valueTableDesc.getSerDeClass(), null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMTc2Mg==", "bodyText": "Please call this serDe.", "url": "https://github.com/apache/hive/pull/1634#discussion_r542031762", "createdAt": "2020-12-13T23:32:44Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/tez/DynamicValueRegistryTez.java", "diffHunk": "@@ -104,8 +105,8 @@ public void init(RegistryConf conf) throws Exception {\n       RuntimeValuesInfo runtimeValuesInfo = rct.baseWork.getInputSourceToRuntimeValuesInfo().get(inputSourceName);\n \n       // Setup deserializer/obj inspectors for the incoming data source\n-      Deserializer deserializer = ReflectionUtils.newInstance(runtimeValuesInfo.getTableDesc().getDeserializerClass(), null);\n-      deserializer.initialize(rct.conf, runtimeValuesInfo.getTableDesc().getProperties());\n+      AbstractSerDe deserializer = ReflectionUtils.newInstance(runtimeValuesInfo.getTableDesc().getSerDeClass(), null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMjI4Mw==", "bodyText": "Please call this inputValueSerDe.", "url": "https://github.com/apache/hive/pull/1634#discussion_r542032283", "createdAt": "2020-12-13T23:36:04Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/spark/SparkReduceRecordHandler.java", "diffHunk": "@@ -154,10 +157,11 @@ public void init(JobConf job, OutputCollector output, Reporter reporter) throws\n       for (int tag = 0; tag < gWork.getTagToValueDesc().size(); tag++) {\n         // We should initialize the SerDe with the TypeInfo when available.\n         valueTableDesc[tag] = gWork.getTagToValueDesc().get(tag);\n-        inputValueDeserializer[tag] = ReflectionUtils.newInstance(\n-            valueTableDesc[tag].getDeserializerClass(), null);\n-        SerDeUtils.initializeSerDe(inputValueDeserializer[tag], null,\n-            valueTableDesc[tag].getProperties(), null);\n+\n+        AbstractSerDe sd = ReflectionUtils.newInstance(valueTableDesc[tag].getSerDeClass(), null);\n+        sd.initialize(null, valueTableDesc[tag].getProperties(), null);\n+\n+        inputValueDeserializer[tag] = sd;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMjYyOA==", "bodyText": "Please call this inputKeySerDe. Also no need to create a variable called serde for an interim time.", "url": "https://github.com/apache/hive/pull/1634#discussion_r542032628", "createdAt": "2020-12-13T23:37:53Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/spark/SparkReduceRecordHandler.java", "diffHunk": "@@ -132,10 +133,12 @@ public void init(JobConf job, OutputCollector output, Reporter reporter) throws\n     isTagged = gWork.getNeedsTagging();\n     try {\n       keyTableDesc = gWork.getKeyDesc();\n-      inputKeyDeserializer = ReflectionUtils.newInstance(keyTableDesc\n-        .getDeserializerClass(), null);\n-      SerDeUtils.initializeSerDe(inputKeyDeserializer, null, keyTableDesc.getProperties(), null);\n-      keyObjectInspector = inputKeyDeserializer.getObjectInspector();\n+      AbstractSerDe serde = ReflectionUtils.newInstance(keyTableDesc\n+        .getSerDeClass(), null);\n+      serde.initialize(null, keyTableDesc.getProperties(), null);\n+      keyObjectInspector = serde.getObjectInspector();\n+\n+      inputKeyDeserializer = serde;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMjgwNw==", "bodyText": "Please call this inputKeySerDe, also no need for the interim serde variable.", "url": "https://github.com/apache/hive/pull/1634#discussion_r542032807", "createdAt": "2020-12-13T23:39:01Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/mr/ExecReducer.java", "diffHunk": "@@ -100,20 +101,19 @@ public void configure(JobConf job) {\n     isTagged = gWork.getNeedsTagging();\n     try {\n       keyTableDesc = gWork.getKeyDesc();\n-      inputKeyDeserializer = ReflectionUtils.newInstance(keyTableDesc\n-          .getDeserializerClass(), null);\n-      SerDeUtils.initializeSerDe(inputKeyDeserializer, null, keyTableDesc.getProperties(), null);\n+      AbstractSerDe serDe = ReflectionUtils.newInstance(keyTableDesc\n+          .getSerDeClass(), null);\n+      serDe.initialize(null, keyTableDesc.getProperties(), null);\n+      inputKeyDeserializer = serDe;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMjg0Mw==", "bodyText": "Please call this valueObjectSerDe", "url": "https://github.com/apache/hive/pull/1634#discussion_r542032843", "createdAt": "2020-12-13T23:39:16Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/mr/ExecReducer.java", "diffHunk": "@@ -100,20 +101,19 @@ public void configure(JobConf job) {\n     isTagged = gWork.getNeedsTagging();\n     try {\n       keyTableDesc = gWork.getKeyDesc();\n-      inputKeyDeserializer = ReflectionUtils.newInstance(keyTableDesc\n-          .getDeserializerClass(), null);\n-      SerDeUtils.initializeSerDe(inputKeyDeserializer, null, keyTableDesc.getProperties(), null);\n+      AbstractSerDe serDe = ReflectionUtils.newInstance(keyTableDesc\n+          .getSerDeClass(), null);\n+      serDe.initialize(null, keyTableDesc.getProperties(), null);\n+      inputKeyDeserializer = serDe;\n       keyObjectInspector = inputKeyDeserializer.getObjectInspector();\n       valueTableDesc = new TableDesc[gWork.getTagToValueDesc().size()];\n       for (int tag = 0; tag < gWork.getTagToValueDesc().size(); tag++) {\n         // We should initialize the SerDe with the TypeInfo when available.\n         valueTableDesc[tag] = gWork.getTagToValueDesc().get(tag);\n-        inputValueDeserializer[tag] = ReflectionUtils.newInstance(\n-            valueTableDesc[tag].getDeserializerClass(), null);\n-        SerDeUtils.initializeSerDe(inputValueDeserializer[tag], null,\n-                                   valueTableDesc[tag].getProperties(), null);\n-        valueObjectInspector[tag] = inputValueDeserializer[tag]\n-            .getObjectInspector();\n+        AbstractSerDe sd = ReflectionUtils.newInstance(valueTableDesc[tag].getSerDeClass(), null);\n+        sd.initialize(null, valueTableDesc[tag].getProperties(), null);\n+        inputValueDeserializer[tag] = sd;\n+        valueObjectInspector[tag] = inputValueDeserializer[tag].getObjectInspector();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMzAxNw==", "bodyText": "Nit: outputSerDe for consistency.", "url": "https://github.com/apache/hive/pull/1634#discussion_r542033017", "createdAt": "2020-12-13T23:40:11Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/ScriptOperator.java", "diffHunk": "@@ -273,15 +273,14 @@ protected void initializeOp(Configuration hconf) throws HiveException {\n     try {\n       this.hconf = hconf;\n \n-      scriptOutputDeserializer = conf.getScriptOutputInfo()\n-          .getDeserializerClass().newInstance();\n-      SerDeUtils.initializeSerDe(scriptOutputDeserializer, hconf,\n-                                 conf.getScriptOutputInfo().getProperties(), null);\n+      AbstractSerDe outputSerde = conf.getScriptOutputInfo().getSerDeClass().newInstance();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMzA5NA==", "bodyText": "Nit: inputSerDe for consistency.", "url": "https://github.com/apache/hive/pull/1634#discussion_r542033094", "createdAt": "2020-12-13T23:40:40Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/ScriptOperator.java", "diffHunk": "@@ -273,15 +273,14 @@ protected void initializeOp(Configuration hconf) throws HiveException {\n     try {\n       this.hconf = hconf;\n \n-      scriptOutputDeserializer = conf.getScriptOutputInfo()\n-          .getDeserializerClass().newInstance();\n-      SerDeUtils.initializeSerDe(scriptOutputDeserializer, hconf,\n-                                 conf.getScriptOutputInfo().getProperties(), null);\n+      AbstractSerDe outputSerde = conf.getScriptOutputInfo().getSerDeClass().newInstance();\n+      outputSerde.initialize(hconf, conf.getScriptOutputInfo().getProperties(), null);\n \n-      scriptInputSerializer = (Serializer) conf.getScriptInputInfo()\n-          .getDeserializerClass().newInstance();\n-      scriptInputSerializer.initialize(hconf, conf.getScriptInputInfo()\n-          .getProperties());\n+      AbstractSerDe inputSerde = conf.getScriptInputInfo().getSerDeClass().newInstance();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMzI5OA==", "bodyText": "Nit: AbstractSerDe serDe for consistency.", "url": "https://github.com/apache/hive/pull/1634#discussion_r542033298", "createdAt": "2020-12-13T23:41:46Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/MapOperator.java", "diffHunk": "@@ -407,7 +407,7 @@ public void initEmptyInputChildren(List<Operator<?>> children, Configuration hco\n       StructObjectInspector soi = null;\n       PartitionDesc partDesc = conf.getAliasToPartnInfo().get(tsOp.getConf().getAlias());\n       Configuration newConf = tableNameToConf.get(partDesc.getTableDesc().getTableName());\n-      Deserializer serde = partDesc.getTableDesc().getDeserializer();\n+      Deserializer serde = partDesc.getTableDesc().getSerDe();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMzM1MA==", "bodyText": "Please call this keySerDe", "url": "https://github.com/apache/hive/pull/1634#discussion_r542033350", "createdAt": "2020-12-13T23:42:03Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/MapJoinOperator.java", "diffHunk": "@@ -352,8 +351,8 @@ public void generateMapMetaData() throws HiveException {\n     try {\n       TableDesc keyTableDesc = conf.getKeyTblDesc();\n       AbstractSerDe keySerializer = (AbstractSerDe) ReflectionUtil.newInstance(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMzQ2Mg==", "bodyText": "Nit: please call this keySerDe for consistency.", "url": "https://github.com/apache/hive/pull/1634#discussion_r542033462", "createdAt": "2020-12-13T23:42:32Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/HashTableSinkOperator.java", "diffHunk": "@@ -179,18 +178,18 @@ protected void initializeOp(Configuration hconf) throws HiveException {\n     }\n     try {\n       TableDesc keyTableDesc = conf.getKeyTblDesc();\n-      AbstractSerDe keySerde = (AbstractSerDe) ReflectionUtils.newInstance(keyTableDesc.getDeserializerClass(),\n+      AbstractSerDe keySerde = (AbstractSerDe) ReflectionUtils.newInstance(keyTableDesc.getSerDeClass(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMzUzNQ==", "bodyText": "Nit: please call this serDe for consistency.", "url": "https://github.com/apache/hive/pull/1634#discussion_r542033535", "createdAt": "2020-12-13T23:42:49Z", "author": {"login": "miklosgergely"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/HashTableDummyOperator.java", "diffHunk": "@@ -45,8 +44,8 @@ protected void initializeOp(Configuration hconf) throws HiveException {\n     super.initializeOp(hconf);\n     TableDesc tbl = this.getConf().getTbl();\n     try {\n-      Deserializer serde = tbl.getDeserializerClass().newInstance();\n-      SerDeUtils.initializeSerDe(serde, hconf, tbl.getProperties(), null);\n+      AbstractSerDe serde = tbl.getSerDeClass().newInstance();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzMzgxMw==", "bodyText": "Nit: please call this serDe for consistency.", "url": "https://github.com/apache/hive/pull/1634#discussion_r542033813", "createdAt": "2020-12-13T23:44:25Z", "author": {"login": "miklosgergely"}, "path": "hcatalog/core/src/main/java/org/apache/hive/hcatalog/mapreduce/InternalUtil.java", "diffHunk": "@@ -143,18 +142,16 @@ private static ObjectInspector getObjectInspector(TypeInfo type) throws IOExcept\n   //TODO this has to find a better home, it's also hardcoded as default in hive would be nice\n   // if the default was decided by the serde\n   static void initializeOutputSerDe(AbstractSerDe serDe, Configuration conf, OutputJobInfo jobInfo)\n-    throws SerDeException {\n-    SerDeUtils.initializeSerDe(serDe, conf,\n-                               getSerdeProperties(jobInfo.getTableInfo(),\n-                                                  jobInfo.getOutputSchema()),\n-                               null);\n+      throws SerDeException {\n+    serDe.initialize(conf, getSerdeProperties(jobInfo.getTableInfo(), jobInfo.getOutputSchema()), null);\n   }\n \n   static void initializeDeserializer(Deserializer deserializer, Configuration conf,\n                      HCatTableInfo info, HCatSchema schema) throws SerDeException {\n     Properties props = getSerdeProperties(info, schema);\n     LOG.info(\"Initializing \" + deserializer.getClass().getName() + \" with properties \" + props);\n-    SerDeUtils.initializeSerDe(deserializer, conf, props, null);\n+    AbstractSerDe serde = (AbstractSerDe)deserializer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAzNjI4Mg==", "bodyText": "Modify comment to \"(de)serializing\"", "url": "https://github.com/apache/hive/pull/1634#discussion_r542036282", "createdAt": "2020-12-13T23:58:30Z", "author": {"login": "miklosgergely"}, "path": "serde/src/java/org/apache/hadoop/hive/serde2/SerDe.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hive.serde2;\n+\n+/**\n+ * A Hive Serializer/Deserializer.\n+ */\n+public interface SerDe {\n+\n+  /**\n+   * Returns statistics collected when serializing", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fb20950d08e5e7d987f5f14224dad05b6e1c269", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/4fb20950d08e5e7d987f5f14224dad05b6e1c269", "committedDate": "2020-12-15T14:09:15Z", "message": "HIVE-24332: Make AbstractSerDe Superclass of all Classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "727b55b7c60e31d4344bcc1444f0cc5dd31d6d82", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/727b55b7c60e31d4344bcc1444f0cc5dd31d6d82", "committedDate": "2020-12-15T14:09:16Z", "message": "Fix compile errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c33e304954bc8bd0ce615aa5358b29e49f51eecd", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/c33e304954bc8bd0ce615aa5358b29e49f51eecd", "committedDate": "2020-12-15T14:09:16Z", "message": "Use correct configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09590a8b381a54f7a856a865cb34874a8eb4431a", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/09590a8b381a54f7a856a865cb34874a8eb4431a", "committedDate": "2020-12-15T14:09:16Z", "message": "expose getter for configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "810813ac84bec00abba53050a1397de8e140f133", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/810813ac84bec00abba53050a1397de8e140f133", "committedDate": "2020-12-15T14:09:16Z", "message": "Two more fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b105873989bbac95a3aa33e1d67f6f9014cf8364", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/b105873989bbac95a3aa33e1d67f6f9014cf8364", "committedDate": "2020-12-15T14:09:16Z", "message": "next batch of fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71c3005f0021e051127818a65bd182291e93c588", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/71c3005f0021e051127818a65bd182291e93c588", "committedDate": "2020-12-15T14:09:16Z", "message": "Use partition configurations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f1f6a9a2d953c41b1be5f7442c33388dfd09b86", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/4f1f6a9a2d953c41b1be5f7442c33388dfd09b86", "committedDate": "2020-12-15T14:33:16Z", "message": "Updated based on review feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b3d1d6b73c535f089cad3bd4878a68242550aede", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/b3d1d6b73c535f089cad3bd4878a68242550aede", "committedDate": "2020-12-11T15:57:49Z", "message": "Use partition configurations"}, "afterCommit": {"oid": "4f1f6a9a2d953c41b1be5f7442c33388dfd09b86", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/4f1f6a9a2d953c41b1be5f7442c33388dfd09b86", "committedDate": "2020-12-15T14:33:16Z", "message": "Updated based on review feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MDM2ODEx", "url": "https://github.com/apache/hive/pull/1634#pullrequestreview-556036811", "createdAt": "2020-12-20T17:31:53Z", "commit": {"oid": "4f1f6a9a2d953c41b1be5f7442c33388dfd09b86"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2986, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}