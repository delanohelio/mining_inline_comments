{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0NjY2ODM5", "number": 1380, "title": "Show tables in database with owner policy", "bodyText": "What changes were proposed in this pull request?\n\nOwner of the tables in DB will be able to see the tables while issuing the command \"Show tables in database\" without the need of ranger policy.\nWhy are the changes needed?\n\nOwner of the tables should be able to see the tables.\nDoes this PR introduce any user-facing change?\n\nNo.\nHow was this patch tested?\n\nFrom spark-shell client and add a unit test case.", "createdAt": "2020-08-07T15:28:26Z", "url": "https://github.com/apache/hive/pull/1380", "merged": true, "mergeCommit": {"oid": "595d2f3fdfc5b61ea9916690714e3111cab45cd8"}, "closed": true, "closedAt": "2020-10-05T23:45:25Z", "author": {"login": "saihemanth-cloudera"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8l_TPAH2gAyNDY0NjY2ODM5OjA3OGUzNzkxNmE0OTI2ODgxMGI0NGQxMTBkNzc2MzIxNjBlN2ZhYTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPp7RigFqTUwMjQwMTM0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "078e37916a49268810b44d110d77632160e7faa5", "author": {"user": {"login": "saihemanth-cloudera", "name": "Sai Hemanth Gantasala"}}, "url": "https://github.com/apache/hive/commit/078e37916a49268810b44d110d77632160e7faa5", "committedDate": "2020-08-07T15:17:10Z", "message": "Show tables in database with owner policy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b1250d98e5209c05d2a5612deeaf1f2c973dc89", "author": {"user": {"login": "saihemanth-cloudera", "name": "Sai Hemanth Gantasala"}}, "url": "https://github.com/apache/hive/commit/9b1250d98e5209c05d2a5612deeaf1f2c973dc89", "committedDate": "2020-08-07T18:22:34Z", "message": "Trigger ptests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5MjYzNzY1", "url": "https://github.com/apache/hive/pull/1380#pullrequestreview-479263765", "createdAt": "2020-09-01T01:17:55Z", "commit": {"oid": "078e37916a49268810b44d110d77632160e7faa5"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMToxNzo1NVrOHKR5mQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQwMTozNToxN1rOHKTCxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDU0MTA4MQ==", "bodyText": "Better follow the same pattern as the original function, return at the end.", "url": "https://github.com/apache/hive/pull/1380#discussion_r480541081", "createdAt": "2020-09-01T01:17:55Z", "author": {"login": "yongzhi"}, "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java", "diffHunk": "@@ -5695,8 +5695,16 @@ private void alter_table_core(String catName, String dbname, String name, Table\n       String[] parsedDbName = parseDbName(dbname, conf);\n       try {\n         ret = getMS().getTables(parsedDbName[CAT_NAME], parsedDbName[DB_NAME], pattern);\n-        ret = FilterUtils.filterTableNamesIfEnabled(isServerFilterEnabled, filterHook,\n-            parsedDbName[CAT_NAME], parsedDbName[DB_NAME], ret);\n+        if(ret !=  null && !ret.isEmpty()) {\n+          List<Table> tableInfo = new ArrayList<>();\n+          tableInfo = getMS().getTableObjectsByName(parsedDbName[CAT_NAME], parsedDbName[DB_NAME], ret);\n+          tableInfo = FilterUtils.filterTablesIfEnabled(isServerFilterEnabled, filterHook, tableInfo);\n+          List<String> result = new ArrayList<>(); // Cannot do ret.clear() because of query cannot be modified error in tests.\n+          for (Table tbl : tableInfo) {\n+            result.add(tbl.getTableName());\n+          }\n+          return result;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "078e37916a49268810b44d110d77632160e7faa5"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDU1NDM4Mw==", "bodyText": "Please add comments on why you pass-in tableInfo objects", "url": "https://github.com/apache/hive/pull/1380#discussion_r480554383", "createdAt": "2020-09-01T01:30:18Z", "author": {"login": "yongzhi"}, "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java", "diffHunk": "@@ -5695,8 +5695,16 @@ private void alter_table_core(String catName, String dbname, String name, Table\n       String[] parsedDbName = parseDbName(dbname, conf);\n       try {\n         ret = getMS().getTables(parsedDbName[CAT_NAME], parsedDbName[DB_NAME], pattern);\n-        ret = FilterUtils.filterTableNamesIfEnabled(isServerFilterEnabled, filterHook,\n-            parsedDbName[CAT_NAME], parsedDbName[DB_NAME], ret);\n+        if(ret !=  null && !ret.isEmpty()) {\n+          List<Table> tableInfo = new ArrayList<>();\n+          tableInfo = getMS().getTableObjectsByName(parsedDbName[CAT_NAME], parsedDbName[DB_NAME], ret);\n+          tableInfo = FilterUtils.filterTablesIfEnabled(isServerFilterEnabled, filterHook, tableInfo);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "078e37916a49268810b44d110d77632160e7faa5"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDU1ODM4OQ==", "bodyText": "Not quite understand the comment.  Maybe ret = new ArrayList<>();   good enough?", "url": "https://github.com/apache/hive/pull/1380#discussion_r480558389", "createdAt": "2020-09-01T01:33:55Z", "author": {"login": "yongzhi"}, "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java", "diffHunk": "@@ -5695,8 +5695,16 @@ private void alter_table_core(String catName, String dbname, String name, Table\n       String[] parsedDbName = parseDbName(dbname, conf);\n       try {\n         ret = getMS().getTables(parsedDbName[CAT_NAME], parsedDbName[DB_NAME], pattern);\n-        ret = FilterUtils.filterTableNamesIfEnabled(isServerFilterEnabled, filterHook,\n-            parsedDbName[CAT_NAME], parsedDbName[DB_NAME], ret);\n+        if(ret !=  null && !ret.isEmpty()) {\n+          List<Table> tableInfo = new ArrayList<>();\n+          tableInfo = getMS().getTableObjectsByName(parsedDbName[CAT_NAME], parsedDbName[DB_NAME], ret);\n+          tableInfo = FilterUtils.filterTablesIfEnabled(isServerFilterEnabled, filterHook, tableInfo);\n+          List<String> result = new ArrayList<>(); // Cannot do ret.clear() because of query cannot be modified error in tests.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "078e37916a49268810b44d110d77632160e7faa5"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDU1OTgxMw==", "bodyText": "Is that possible also to assert on owner related values?", "url": "https://github.com/apache/hive/pull/1380#discussion_r480559813", "createdAt": "2020-09-01T01:35:17Z", "author": {"login": "yongzhi"}, "path": "itests/hive-unit/src/test/java/org/apache/hadoop/hive/ql/security/authorization/plugin/TestHiveAuthorizerCheckInvocation.java", "diffHunk": "@@ -600,6 +600,22 @@ public void testReplDump() throws Exception {\n     assertEquals(\"table name\", inDbTableName.toLowerCase(), dbObj.getObjectName());\n   }\n \n+  @Test\n+  public void showTablesInDB() throws Exception{\n+    final String tableName1 = \"table1\";\n+    driver.run(\"create table \" + dbName+\".\"+tableName1 + \"(eid int, yoj int)\");\n+    final String tableName2 = \"table2\";\n+    driver.run(\"create table \" + dbName+\".\"+tableName2 + \"(eid int, ecode int)\");\n+    reset(mockedAuthorizer);\n+\n+    int status = driver.compile(\"show tables in \"+dbName, true);\n+    assertEquals(0, status);\n+    Pair<List<HivePrivilegeObject>, List<HivePrivilegeObject>> io = getHivePrivilegeObjectInputs();\n+    List<HivePrivilegeObject> inputs = io.getLeft();\n+    HivePrivilegeObject dbObj = inputs.get(0);\n+    assertEquals(\"input type\", HivePrivilegeObjectType.DATABASE, dbObj.getType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "078e37916a49268810b44d110d77632160e7faa5"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19098453d9918d0b05156c8b2be2fd2f41943bde", "author": {"user": {"login": "saihemanth-cloudera", "name": "Sai Hemanth Gantasala"}}, "url": "https://github.com/apache/hive/commit/19098453d9918d0b05156c8b2be2fd2f41943bde", "committedDate": "2020-10-02T22:20:14Z", "message": "HIVE-23969: Show tables in database with owner policy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be2eb65d339e928a3adda67d2def4d6220245458", "author": {"user": {"login": "saihemanth-cloudera", "name": "Sai Hemanth Gantasala"}}, "url": "https://github.com/apache/hive/commit/be2eb65d339e928a3adda67d2def4d6220245458", "committedDate": "2020-10-02T22:27:27Z", "message": "Merge branch 'master' into hive23969"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31ae71e07d3b529d2f3f498d8a4dc9db41c456d4", "author": {"user": {"login": "saihemanth-cloudera", "name": "Sai Hemanth Gantasala"}}, "url": "https://github.com/apache/hive/commit/31ae71e07d3b529d2f3f498d8a4dc9db41c456d4", "committedDate": "2020-10-02T22:41:42Z", "message": "Merge branch 'hive23969' of https://github.com/saihemanth-cloudera/hive into hive23969"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7090f910a4ae946ec023ad4dd8f5504c8cd13cc", "author": {"user": {"login": "saihemanth-cloudera", "name": "Sai Hemanth Gantasala"}}, "url": "https://github.com/apache/hive/commit/f7090f910a4ae946ec023ad4dd8f5504c8cd13cc", "committedDate": "2020-10-03T17:30:15Z", "message": "Trigger ptests again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11f918d212702e895ef2e95b404330ef6f9c94ef", "author": {"user": {"login": "saihemanth-cloudera", "name": "Sai Hemanth Gantasala"}}, "url": "https://github.com/apache/hive/commit/11f918d212702e895ef2e95b404330ef6f9c94ef", "committedDate": "2020-10-04T02:09:35Z", "message": "Trigger ptests again"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMjU1Mjc3", "url": "https://github.com/apache/hive/pull/1380#pullrequestreview-502255277", "createdAt": "2020-10-05T17:07:20Z", "commit": {"oid": "11f918d212702e895ef2e95b404330ef6f9c94ef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyNDAxMzQz", "url": "https://github.com/apache/hive/pull/1380#pullrequestreview-502401343", "createdAt": "2020-10-05T20:36:57Z", "commit": {"oid": "11f918d212702e895ef2e95b404330ef6f9c94ef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3434, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}