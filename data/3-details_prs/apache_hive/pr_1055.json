{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MjU3Mjg4", "number": 1055, "title": "HIVE-23602: Use Java Concurrent Package for Operation Handle Set", "bodyText": "", "createdAt": "2020-06-03T14:53:18Z", "url": "https://github.com/apache/hive/pull/1055", "merged": true, "mergeCommit": {"oid": "7725d08f926ee38626e9e3ee1639fea58ba6d181"}, "closed": true, "closedAt": "2020-06-18T22:34:46Z", "author": {"login": "belugabehr"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnqoy3AH2gAyNDI3MjU3Mjg4OmIyZWVkZGUyOTgyMDE0YWI5OTlhNWRmNTBiMTIyODhlYjQzNjI3Njg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsh6hGAFqTQzMzQ5OTk5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b2eedde2982014ab999a5df50b12288eb4362768", "author": {"user": {"login": "belugabehr", "name": null}}, "url": "https://github.com/apache/hive/commit/b2eedde2982014ab999a5df50b12288eb4362768", "committedDate": "2020-06-03T14:49:42Z", "message": "HIVE-23602: Use Java Concurrent Package for Operation Handle Set"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMTcwNjYy", "url": "https://github.com/apache/hive/pull/1055#pullrequestreview-432170662", "createdAt": "2020-06-17T08:24:12Z", "commit": {"oid": "b2eedde2982014ab999a5df50b12288eb4362768"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwODoyNDoxM1rOGk7HCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwODoyNDoxM1rOGk7HCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM3MDM3Ng==", "bodyText": "What happens when a new operation arrived concurrently?", "url": "https://github.com/apache/hive/pull/1055#discussion_r441370376", "createdAt": "2020-06-17T08:24:13Z", "author": {"login": "pvary"}, "path": "service/src/java/org/apache/hive/service/cli/session/HiveSessionImpl.java", "diffHunk": "@@ -757,14 +754,13 @@ public void close() throws HiveSQLException {\n     try {\n       acquire(true, false);\n       // Iterate through the opHandles and close their operations\n-      List<OperationHandle> ops = null;\n-      synchronized (opHandleSet) {\n-        ops = new ArrayList<>(opHandleSet);\n-        opHandleSet.clear();\n-      }\n-      for (OperationHandle opHandle : ops) {\n+      List<OperationHandle> closedOps = new ArrayList<>();\n+      for (OperationHandle opHandle : opHandleSet) {\n         operationManager.closeOperation(opHandle);\n+        closedOps.add(opHandle);\n       }\n+      opHandleSet.removeAll(closedOps);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2eedde2982014ab999a5df50b12288eb4362768"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNDk5OTk1", "url": "https://github.com/apache/hive/pull/1055#pullrequestreview-433499995", "createdAt": "2020-06-18T17:29:32Z", "commit": {"oid": "b2eedde2982014ab999a5df50b12288eb4362768"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3794, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}