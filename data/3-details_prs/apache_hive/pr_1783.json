{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwMjYzMTYz", "number": 1783, "title": "HIVE-24539: OrcInputFormat schema generation should respect column delimiter", "bodyText": "What changes were proposed in this pull request?\nOrcInputFormat  getDesiredRowTypeDescr method should use column delimiter to generate column names.\nWhy are the changes needed?\nCurrent logic can create wrong names when column names contain commas.\nDoes this PR introduce any user-facing change?\nno\nHow was this patch tested?\nq file", "createdAt": "2020-12-15T13:43:42Z", "url": "https://github.com/apache/hive/pull/1783", "merged": true, "mergeCommit": {"oid": "25a1d1c50744c0b40bd0c2ab1938220cd8f6dce0"}, "closed": true, "closedAt": "2021-01-11T16:24:58Z", "author": {"login": "pgaref"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmdM3-AH2gAyNTQwMjYzMTYzOjMwN2M5ZWJlNjhmM2I5ODAzNWFhNWRlZDU2NjBlODAyYmZjZDU0Njk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtyEPpgFqTU2MzM5ODI1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "307c9ebe68f3b98035aa5ded5660e802bfcd5469", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/307c9ebe68f3b98035aa5ded5660e802bfcd5469", "committedDate": "2020-12-15T16:47:40Z", "message": "HIVE-24539: OrcInputFormat schema generation should respect column delimiter\n\nChange-Id: I7009a15ac8c135633b516583428be2812ecd3574"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15253c04c0fad99d9c0a405e4d8d868f2a967cda", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/15253c04c0fad99d9c0a405e4d8d868f2a967cda", "committedDate": "2020-12-15T13:40:52Z", "message": "HIVE-24539: OrcInputFormat schema generation should respect column delimiter\n\nChange-Id: I7009a15ac8c135633b516583428be2812ecd3574"}, "afterCommit": {"oid": "307c9ebe68f3b98035aa5ded5660e802bfcd5469", "author": {"user": {"login": "pgaref", "name": "Panagiotis Garefalakis"}}, "url": "https://github.com/apache/hive/commit/307c9ebe68f3b98035aa5ded5660e802bfcd5469", "committedDate": "2020-12-15T16:47:40Z", "message": "HIVE-24539: OrcInputFormat schema generation should respect column delimiter\n\nChange-Id: I7009a15ac8c135633b516583428be2812ecd3574"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNDMzNDYx", "url": "https://github.com/apache/hive/pull/1783#pullrequestreview-553433461", "createdAt": "2020-12-16T07:58:19Z", "commit": {"oid": "307c9ebe68f3b98035aa5ded5660e802bfcd5469"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwNzo1ODoxOVrOIG4X0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwNzo1ODoxOVrOIG4X0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4NTk2OQ==", "bodyText": "this makes me think that in order to use commas in column names, you need to define another column name delimiter, otherwise those are cannot be distinguished from each other, right?\nI mean, could you please include an example where the configuration can be used for this purpose? I haven't seen that in q test, what's the valid use-case for multiple columns? what happens if you try to do something like:\ncreate table test_n4 (`x,y` int, z int);\nselect `x,y`, z from test_n4 where `x,y` >= 2 and z = 0;\n\nother than this, the patch is simple and neat, which I like :)", "url": "https://github.com/apache/hive/pull/1783#discussion_r544085969", "createdAt": "2020-12-16T07:58:19Z", "author": {"login": "abstractdog"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/io/orc/OrcInputFormat.java", "diffHunk": "@@ -2675,12 +2676,13 @@ public static TypeDescription convertTypeInfo(TypeInfo info) {\n   public static TypeDescription getDesiredRowTypeDescr(Configuration conf,\n                                                        boolean isAcidRead,\n                                                        int dataColumns) {\n-\n     String columnNameProperty = null;\n     String columnTypeProperty = null;\n \n     ArrayList<String> schemaEvolutionColumnNames = null;\n     ArrayList<TypeDescription> schemaEvolutionTypeDescrs = null;\n+    // Make sure we split colNames using the right Delimiter\n+    final String columnNameDelimiter = conf.get(serdeConstants.COLUMN_NAME_DELIMITER, String.valueOf(SerDeUtils.COMMA));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "307c9ebe68f3b98035aa5ded5660e802bfcd5469"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMzk4MjUz", "url": "https://github.com/apache/hive/pull/1783#pullrequestreview-563398253", "createdAt": "2021-01-07T11:03:43Z", "commit": {"oid": "307c9ebe68f3b98035aa5ded5660e802bfcd5469"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2927, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}