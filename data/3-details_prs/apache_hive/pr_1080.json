{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxMjg5OTM1", "number": 1080, "title": "HIVE-23026: Allow for custom YARN application name for TEZ queries (branch-2)", "bodyText": "What is this PR for?\n\nadd a configuration item to support setting tez job name\n\nWhat type of PR is it?\n\nfeature\n\nWhat is the Jira issue?\n\nhttps://issues.apache.org/jira/browse/HIVE-23026\n\nHow to use?\n\nWe can use 'set tez.job.name=<customized_job_name>;' or '--hiveconf ez.job.name=<customized_job_name>' to use this function to customize Yarn application name when we run a sql.\nWe recommend setting  the 'customized_job_name' to a Java String.format() string that can accept the hive session ID as a single parameter.", "createdAt": "2020-06-08T17:29:41Z", "url": "https://github.com/apache/hive/pull/1080", "merged": true, "mergeCommit": {"oid": "4ef384c655ecebd38e590110ba1ee071a4d8202a"}, "closed": true, "closedAt": "2020-06-17T13:32:26Z", "author": {"login": "xiejiajun"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpT0nxgH2gAyNDMxMjg5OTM1OmYyYzliNDk1MTBjM2Y4MDQ3MjZjY2U3YjU3YTE2NjI0NWYzMjlmOGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp6zzLgH2gAyNDMxMjg5OTM1OjZlZGU1NWZiYTgzZDYwMTY2ZjVhYTlkYWZkOTM3NjY2OTU2NmZhYTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f2c9b49510c3f804726cce7b57a166245f329f8a", "author": {"user": {"login": "xiejiajun", "name": "Jake Xie"}}, "url": "https://github.com/apache/hive/commit/f2c9b49510c3f804726cce7b57a166245f329f8a", "committedDate": "2020-06-08T17:22:39Z", "message": "Support for setup tez job name\n\nadd a configuration item 'tez.job.name'  to set tez job name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e716908e288ff391058f78e2b5fedbec50a2684b", "author": {"user": {"login": "xiejiajun", "name": "Jake Xie"}}, "url": "https://github.com/apache/hive/commit/e716908e288ff391058f78e2b5fedbec50a2684b", "committedDate": "2020-06-08T17:25:33Z", "message": "support for set the tez job name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3Mjc3ODkw", "url": "https://github.com/apache/hive/pull/1080#pullrequestreview-427277890", "createdAt": "2020-06-09T15:24:29Z", "commit": {"oid": "e716908e288ff391058f78e2b5fedbec50a2684b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNToyNDoyOVrOGhP_rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNToyNDo1NlrOGhQBdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxODI1NQ==", "bodyText": "The second value here, I believe is a 'default' value. The default should be HIVE-%s. Also please update comments to explain how this works.", "url": "https://github.com/apache/hive/pull/1080#discussion_r437518255", "createdAt": "2020-06-09T15:24:29Z", "author": {"login": "belugabehr"}, "path": "common/src/java/org/apache/hadoop/hive/conf/HiveConf.java", "diffHunk": "@@ -1500,6 +1500,9 @@ private static void populateLlapDaemonVarsSet(Set<String> llapDaemonVarsSetLocal\n     HIVEQUERYNAME (\"hive.query.name\", null,\n         \"This named is used by Tez to set the dag name. This name in turn will appear on \\n\" +\n         \"the Tez UI representing the work that was done.\"),\n+    HIVETEZJOBNAME(\"tez.job.name\", null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e716908e288ff391058f78e2b5fedbec50a2684b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxODcwOQ==", "bodyText": "Here is what I am suggesting:\n    String tezJobNameFormat = HiveConf.getVar(conf, ConfVars.HIVETEZJOBNAME);\n    final TezClient session = TezClient.newBuilder(String.format(tezJobNameFormat, sessionId), tezConfig)", "url": "https://github.com/apache/hive/pull/1080#discussion_r437518709", "createdAt": "2020-06-09T15:24:56Z", "author": {"login": "belugabehr"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/tez/TezSessionState.java", "diffHunk": "@@ -317,7 +317,8 @@ protected void openInternal(final HiveConf conf, Collection<String> additionalFi\n \n     setupSessionAcls(tezConfig, conf);\n \n-    final TezClient session = TezClient.newBuilder(\"HIVE-\" + sessionId, tezConfig)\n+    String tezJobName = HiveConf.getVar(conf, ConfVars.HIVETEZJOBNAME, sessionId);\n+    final TezClient session = TezClient.newBuilder(String.format(\"HIVE-%s\", tezJobName), tezConfig)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e716908e288ff391058f78e2b5fedbec50a2684b"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6853b449f8523e7d7e5e1f211b443018364e1f9c", "author": {"user": {"login": "xiejiajun", "name": "Jake Xie"}}, "url": "https://github.com/apache/hive/commit/6853b449f8523e7d7e5e1f211b443018364e1f9c", "committedDate": "2020-06-09T15:54:23Z", "message": "update tez job name default scheme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90d222dabb5e8ade9f55e303ac236a8e135e21ab", "author": {"user": {"login": "xiejiajun", "name": "Jake Xie"}}, "url": "https://github.com/apache/hive/commit/90d222dabb5e8ade9f55e303ac236a8e135e21ab", "committedDate": "2020-06-09T15:59:23Z", "message": "update tez job format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MDM2Mjc3", "url": "https://github.com/apache/hive/pull/1080#pullrequestreview-428036277", "createdAt": "2020-06-10T13:11:34Z", "commit": {"oid": "90d222dabb5e8ade9f55e303ac236a8e135e21ab"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzoxMTozNFrOGh0FjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzoxMTozNFrOGh0FjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEwOTU4MQ==", "bodyText": "Still need to update this comment.  Something like:\nThe job name may be a Java String.format() String, to which a the session ID will be supplied as the single parameter.", "url": "https://github.com/apache/hive/pull/1080#discussion_r438109581", "createdAt": "2020-06-10T13:11:34Z", "author": {"login": "belugabehr"}, "path": "common/src/java/org/apache/hadoop/hive/conf/HiveConf.java", "diffHunk": "@@ -1500,6 +1500,9 @@ private static void populateLlapDaemonVarsSet(Set<String> llapDaemonVarsSetLocal\n     HIVEQUERYNAME (\"hive.query.name\", null,\n         \"This named is used by Tez to set the dag name. This name in turn will appear on \\n\" +\n         \"the Tez UI representing the work that was done.\"),\n+    HIVETEZJOBNAME(\"tez.job.name\", \"HIVE-%s\",\n+        \"This named is used by Tez to set the job name. This name in turn will appear on \\n\" +\n+        \"the Yarn UI representing the Yarn Application Name.\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90d222dabb5e8ade9f55e303ac236a8e135e21ab"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b37ba64d918325ec778ead26baeadff2bb609f7f", "author": {"user": {"login": "xiejiajun", "name": "Jake Xie"}}, "url": "https://github.com/apache/hive/commit/b37ba64d918325ec778ead26baeadff2bb609f7f", "committedDate": "2020-06-10T14:39:21Z", "message": "update tez job name desc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ede55fba83d60166f5aa9dafd9376669566faa3", "author": {"user": {"login": "xiejiajun", "name": "Jake Xie"}}, "url": "https://github.com/apache/hive/commit/6ede55fba83d60166f5aa9dafd9376669566faa3", "committedDate": "2020-06-10T14:48:03Z", "message": "Format the HIVETEZJOBNAME desc"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3827, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}