{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczMjk0NTIz", "number": 1432, "title": "HIVE-24072 HiveAggregateJoinTransposeRule may try to create an invalid transformation", "bodyText": "What changes were proposed in this pull request?\n\nWhy are the changes needed?\n\nDoes this PR introduce any user-facing change?\n\nHow was this patch tested?", "createdAt": "2020-08-25T15:42:14Z", "url": "https://github.com/apache/hive/pull/1432", "merged": true, "mergeCommit": {"oid": "d078d86bad1e891524fa82d69a6895188438c008"}, "closed": true, "closedAt": "2020-09-09T08:36:57Z", "author": {"login": "kgyrtkirk"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7UJAQgH2gAyNDczMjk0NTIzOjQ2OWM4ZmVjNDFlMTU5MTY3NThmYTAyMzMwYTQ1YWRmODk4MGY1MWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHEAISAFqTQ4NDY0MzAzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "469c8fec41e15916758fa02330a45adf8980f51f", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/469c8fec41e15916758fa02330a45adf8980f51f", "committedDate": "2020-08-03T15:55:33Z", "message": "a"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43701563c5f69780899a00ab125872094cf63d4b", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/43701563c5f69780899a00ab125872094cf63d4b", "committedDate": "2020-08-04T09:56:40Z", "message": "disable unstable tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4560fc77d479a3d14492fc1957804dd5eaa62940", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/4560fc77d479a3d14492fc1957804dd5eaa62940", "committedDate": "2020-08-11T08:26:50Z", "message": "some changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5eab19dbf84d05d030ecda567596008e1d7a07f6", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/5eab19dbf84d05d030ecda567596008e1d7a07f6", "committedDate": "2020-08-11T08:27:21Z", "message": "git staMerge remote-tracking branch 'apache/master' into DWX-4878-aggpush"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92e2ef6d034cfeb6795daf386e8fd4e78f8f04ed", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/92e2ef6d034cfeb6795daf386e8fd4e78f8f04ed", "committedDate": "2020-08-11T08:29:50Z", "message": "use tpch .001"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "159bbc5e4a4acdae18c4e19b437768934c75e3a8", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/159bbc5e4a4acdae18c4e19b437768934c75e3a8", "committedDate": "2020-08-11T09:05:04Z", "message": "update q.out"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9fbd6a9dd869016240ee397748af94d9e0628ad", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/b9fbd6a9dd869016240ee397748af94d9e0628ad", "committedDate": "2020-08-25T08:33:44Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b761df6b287f7fe0e32f3965d2b7236b1b168bc", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/6b761df6b287f7fe0e32f3965d2b7236b1b168bc", "committedDate": "2020-08-25T09:29:42Z", "message": "add a"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2775462c430b24f6087af675b42f58964d4d9889", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/2775462c430b24f6087af675b42f58964d4d9889", "committedDate": "2020-08-25T13:53:01Z", "message": "update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e60a56c9a79e4bde40f58e84e44bda8fa4d098a3", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/e60a56c9a79e4bde40f58e84e44bda8fa4d098a3", "committedDate": "2020-08-25T14:28:01Z", "message": "why intersect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98cb30e6640c32cedca0cd39befa3017d94f09b0", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/98cb30e6640c32cedca0cd39befa3017d94f09b0", "committedDate": "2020-08-25T15:41:04Z", "message": "add"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57750a44529fcf9e779241c4466c03d34202e338", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/57750a44529fcf9e779241c4466c03d34202e338", "committedDate": "2020-08-27T15:12:11Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b84a24fc41d81dc936927ff239ab0e17f25a6c30", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/b84a24fc41d81dc936927ff239ab0e17f25a6c30", "committedDate": "2020-08-27T15:18:29Z", "message": "update q.out"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74520518ba7afd974f4aae069286661768303651", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/74520518ba7afd974f4aae069286661768303651", "committedDate": "2020-08-27T15:21:34Z", "message": "remove EXPLAIN; update q.out"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b915d5a01c5d5d73d4428074175c1ebe279139b", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/0b915d5a01c5d5d73d4428074175c1ebe279139b", "committedDate": "2020-08-27T15:25:13Z", "message": "resultset diffs against old"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa705cb8e21b2f5f75574fd1288bf9ff0dba234c", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/fa705cb8e21b2f5f75574fd1288bf9ff0dba234c", "committedDate": "2020-08-27T15:25:38Z", "message": "restore patch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2ODQwNDQ0", "url": "https://github.com/apache/hive/pull/1432#pullrequestreview-476840444", "createdAt": "2020-08-27T15:31:09Z", "commit": {"oid": "fa705cb8e21b2f5f75574fd1288bf9ff0dba234c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTozMTowOVrOHIV1OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTozMTowOVrOHIV1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUwODM0NA==", "bodyText": "@jcamachor\nI think this intersect is not needed; it cause some trouble in case\n\ngrouped by say 1,3,4\ncolumns 1,2,3 is coming from left side of join; column 2 is the join key\nthe intersect will remove column 2 ; which will induce a shift in the mapping - and will rotate in the join key into a projkect later on\n\nI think in calcite the following is true:\nfor a join betwen inputs:\n\nT1(a,b,c)\nT2(d,e,f)\nthe output is always a,b,c,d,e,f - independently the join condition\nso I see no rational need for this intersect...it was here for a few years now...and the class \"borned\" with this line in it...", "url": "https://github.com/apache/hive/pull/1432#discussion_r478508344", "createdAt": "2020-08-27T15:31:09Z", "author": {"login": "kgyrtkirk"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/optimizer/calcite/rules/HiveAggregateJoinTransposeRule.java", "diffHunk": "@@ -145,8 +145,7 @@ public void onMatch(RelOptRuleCall call) {\n         int fieldCount = joinInput.getRowType().getFieldCount();\n         final ImmutableBitSet fieldSet =\n             ImmutableBitSet.range(offset, offset + fieldCount);\n-        final ImmutableBitSet belowAggregateKeyNotShifted =\n-            belowAggregateColumns.intersect(fieldSet);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa705cb8e21b2f5f75574fd1288bf9ff0dba234c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4ODA5ODkz", "url": "https://github.com/apache/hive/pull/1432#pullrequestreview-478809893", "createdAt": "2020-08-31T17:37:17Z", "commit": {"oid": "fa705cb8e21b2f5f75574fd1288bf9ff0dba234c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNzozNzoxN1rOHKCIIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNzozNzoxN1rOHKCIIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI4MjY1Ng==", "bodyText": "The aggregate call column is also part of the group by key now.", "url": "https://github.com/apache/hive/pull/1432#discussion_r480282656", "createdAt": "2020-08-31T17:37:17Z", "author": {"login": "jcamachor"}, "path": "ql/src/test/results/clientpositive/llap/groupby_join_pushdown.q.out", "diffHunk": "@@ -644,29 +646,18 @@ STAGE PLANS:\n                       Statistics: Num rows: 9173 Data size: 82188 Basic stats: COMPLETE Column stats: COMPLETE\n                       Group By Operator\n                         aggregations: max(_col0)\n-                        keys: _col1 (type: bigint)\n-                        minReductionHashAggr: 0.49994552\n+                        keys: _col1 (type: bigint), _col0 (type: int)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa705cb8e21b2f5f75574fd1288bf9ff0dba234c"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "683b63cf161128dbea670b606db849833388306c", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/683b63cf161128dbea670b606db849833388306c", "committedDate": "2020-09-02T14:03:35Z", "message": "git stMerge remote-tracking branch 'apache/master' into HIVE-24072-aggjoin-mapping"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60359407d9a20a364bff92c6d0417f5f3995032c", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/60359407d9a20a364bff92c6d0417f5f3995032c", "committedDate": "2020-09-03T14:49:58Z", "message": "remove duplicate semicolon"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f19549a7768c3a00b11e7093e167d47666c3c4d1", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/f19549a7768c3a00b11e7093e167d47666c3c4d1", "committedDate": "2020-09-03T14:52:15Z", "message": "add tpch18"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd6c9cda7c1ff8ed49ac61c2e417d1a2e724315c", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/cd6c9cda7c1ff8ed49ac61c2e417d1a2e724315c", "committedDate": "2020-09-07T04:51:05Z", "message": "put back intersect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee00ba27aaea73461553143147c43be29b6e09ac", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/ee00ba27aaea73461553143147c43be29b6e09ac", "committedDate": "2020-09-07T11:47:53Z", "message": "fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aef16e6b5bba03057ce03122506bbf87715561bb", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/aef16e6b5bba03057ce03122506bbf87715561bb", "committedDate": "2020-09-07T11:49:37Z", "message": "redo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6abcd5d8f8a2c84f4f0ab266d43681687f169a02", "author": {"user": {"login": "kgyrtkirk", "name": "Zoltan Haindrich"}}, "url": "https://github.com/apache/hive/commit/6abcd5d8f8a2c84f4f0ab266d43681687f169a02", "committedDate": "2020-09-07T14:16:44Z", "message": "remove tpch18"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NjQzMDMy", "url": "https://github.com/apache/hive/pull/1432#pullrequestreview-484643032", "createdAt": "2020-09-09T03:54:28Z", "commit": {"oid": "6abcd5d8f8a2c84f4f0ab266d43681687f169a02"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3246, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}