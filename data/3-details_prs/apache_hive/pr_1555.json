{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MzI2MTEx", "number": 1555, "title": "HIVE-24233: Except subquery throws nullpointer", "bodyText": "What changes were proposed in this pull request?\nThrow semanticException for except when cbo is disabled\nWhy are the changes needed?\nDoes this PR introduce any user-facing change?\nNo\nHow was this patch tested?\nnegative q test", "createdAt": "2020-10-06T07:17:22Z", "url": "https://github.com/apache/hive/pull/1555", "merged": true, "mergeCommit": {"oid": "68468bf73dda602f9869d836c9bde4e7aa2e80f4"}, "closed": true, "closedAt": "2020-11-09T12:50:13Z", "author": {"login": "pvargacl"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPzEDUgH2gAyNDk4MzI2MTExOjg4YWE4MTIyNGVmZWM2OTA2Zjk0YjYwYmUyMDNjNjY1MmZiNTlkYzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdY-FS9gH2gAyNDk4MzI2MTExOjcwODMxZWY4YWM4Nzk1MThjOTAwMTg5ZDkzMjY1MjlhZDQ5Y2RhNTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "88aa81224efec6906f94b60be203c6652fb59dc9", "author": {"user": {"login": "pvargacl", "name": "Peter Varga"}}, "url": "https://github.com/apache/hive/commit/88aa81224efec6906f94b60be203c6652fb59dc9", "committedDate": "2020-10-06T07:15:41Z", "message": "HIVE-24233: Except subquery throws nullpointer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be11c59a36c7040a846a55a6e1463d8396316281", "author": {"user": {"login": "pvargacl", "name": "Peter Varga"}}, "url": "https://github.com/apache/hive/commit/be11c59a36c7040a846a55a6e1463d8396316281", "committedDate": "2020-11-03T09:17:34Z", "message": "Merge remote-tracking branch 'origin/master' into HIVE-24233-except"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNDYwODU5", "url": "https://github.com/apache/hive/pull/1555#pullrequestreview-522460859", "createdAt": "2020-11-03T12:47:41Z", "commit": {"oid": "be11c59a36c7040a846a55a6e1463d8396316281"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMjo0Nzo0MVrOHstPxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMjo0Nzo0MVrOHstPxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY0MDcwOA==", "bodyText": "Could we say instead or something like this?\n\"EXCEPT and INTERSECT operations are only supported with Cost Based Optimizations enabled. Please set 'hive.cbo.enable' to true\"", "url": "https://github.com/apache/hive/pull/1555#discussion_r516640708", "createdAt": "2020-11-03T12:47:41Z", "author": {"login": "pvary"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/parse/SemanticAnalyzer.java", "diffHunk": "@@ -11628,6 +11628,11 @@ private void setupStats(TableScanDesc tsDesc, QBParseInfo qbp, Table tab, String\n   }\n \n   private Operator genPlan(QB parent, QBExpr qbexpr) throws SemanticException {\n+    if (qbexpr.getOpcode() == QBExpr.Opcode.EXCEPT || qbexpr.getOpcode() == QBExpr.Opcode.EXCEPTALL\n+        || qbexpr.getOpcode() == QBExpr.Opcode.INTERSECT || qbexpr.getOpcode() == QBExpr.Opcode.INTERSECTALL) {\n+      throw new SemanticException(\n+          \"Except and intersect operations are only supported with Cost Based Optimizations enabled. Turn on hive.cbo.enable\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be11c59a36c7040a846a55a6e1463d8396316281"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNDYxMzYy", "url": "https://github.com/apache/hive/pull/1555#pullrequestreview-522461362", "createdAt": "2020-11-03T12:48:23Z", "commit": {"oid": "be11c59a36c7040a846a55a6e1463d8396316281"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMjo0ODoyM1rOHstRLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMjo0ODoyM1rOHstRLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY0MTA3MA==", "bodyText": "Do we have positive tests?", "url": "https://github.com/apache/hive/pull/1555#discussion_r516641070", "createdAt": "2020-11-03T12:48:23Z", "author": {"login": "pvary"}, "path": "ql/src/test/queries/clientnegative/except_cbooff.q", "diffHunk": "@@ -0,0 +1,5 @@\n+set hive.cbo.enable=false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be11c59a36c7040a846a55a6e1463d8396316281"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0e78fb681ece6395217afc344eec2e0dfec7589", "author": {"user": {"login": "pvargacl", "name": "Peter Varga"}}, "url": "https://github.com/apache/hive/commit/e0e78fb681ece6395217afc344eec2e0dfec7589", "committedDate": "2020-11-03T14:02:16Z", "message": "Change exception message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTI3OTQ1", "url": "https://github.com/apache/hive/pull/1555#pullrequestreview-522527945", "createdAt": "2020-11-03T14:07:30Z", "commit": {"oid": "e0e78fb681ece6395217afc344eec2e0dfec7589"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70831ef8ac879518c900189d9326529ad49cda52", "author": {"user": {"login": "pvargacl", "name": "Peter Varga"}}, "url": "https://github.com/apache/hive/commit/70831ef8ac879518c900189d9326529ad49cda52", "committedDate": "2020-11-03T19:11:19Z", "message": "fix q out"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3140, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}