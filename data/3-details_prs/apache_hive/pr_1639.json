{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzODQxNTIx", "number": 1639, "title": "HIVE-24342: isPathEncrypted should make sure resolved path also from HDFS.", "bodyText": "https://issues.apache.org/jira/browse/HIVE-24342\nWhat changes were proposed in this pull request?\nif the path is hdfs and if the fs is mounted fs, then we will use resolvePath to recheck whether the path is really on hdfs. In the case ViewFS based file systems, the target fs could be on some other fs, ex: o3fs://\nWhy are the changes needed?\nThis is needed for supporting ViewHDFS like functionality as it supported mounting other fs-es under hdfs paths.\nDoes this PR introduce any user-facing change?\nNo\nHow was this patch tested?\nThis has been tested in real cluster installation with mounting to o3fs paths. The JIRA description provided the details about verification. After this fix, querying from table succeeded.", "createdAt": "2020-11-02T07:01:36Z", "url": "https://github.com/apache/hive/pull/1639", "merged": true, "mergeCommit": {"oid": "fdc2c5c9c8e3a22f68a160144003a98ac95d76bd"}, "closed": true, "closedAt": "2020-11-04T03:50:38Z", "author": {"login": "umamaheswararao"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdY1grogH2gAyNTEzODQxNTIxOjcxNGViZDAwMDMzYWFlM2ZkNWU4ZTg1MDJjZTQ0ZGQzNThmOTdjY2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdY_eHiAFqTUyMjg2Mjc1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "714ebd00033aae3fd5e8e8502ce44dd358f97ccd", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/714ebd00033aae3fd5e8e8502ce44dd358f97ccd", "committedDate": "2020-11-03T09:12:05Z", "message": "HIVE-24342: isPathEncrypted should make sure resolved path also from HDFS."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b51e926b6a1e19c66abdb9a5c02f4e005ef3456", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/1b51e926b6a1e19c66abdb9a5c02f4e005ef3456", "committedDate": "2020-11-02T06:53:36Z", "message": "HIVE-24342: isPathEncrypted should make sure resolved path also from HDFS."}, "afterCommit": {"oid": "714ebd00033aae3fd5e8e8502ce44dd358f97ccd", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/714ebd00033aae3fd5e8e8502ce44dd358f97ccd", "committedDate": "2020-11-03T09:12:05Z", "message": "HIVE-24342: isPathEncrypted should make sure resolved path also from HDFS."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b964a5f9c1e8bdc8b57435f8a14e27fd0615599", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/2b964a5f9c1e8bdc8b57435f8a14e27fd0615599", "committedDate": "2020-11-03T17:45:22Z", "message": "Updated commnets."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNzk0OTMw", "url": "https://github.com/apache/hive/pull/1639#pullrequestreview-522794930", "createdAt": "2020-11-03T19:03:38Z", "commit": {"oid": "714ebd00033aae3fd5e8e8502ce44dd358f97ccd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxOTowMzozOFrOHs8kwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxOTowMzozOFrOHs8kwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg5MTg0MQ==", "bodyText": "Is there a case that HDFS file system can be mounted as other file systems?", "url": "https://github.com/apache/hive/pull/1639#discussion_r516891841", "createdAt": "2020-11-03T19:03:38Z", "author": {"login": "yongzhi"}, "path": "shims/0.23/src/main/java/org/apache/hadoop/hive/shims/Hadoop23Shims.java", "diffHunk": "@@ -1236,13 +1236,35 @@ public boolean isPathEncrypted(Path path) throws IOException {\n       } else {\n         fullPath = path.getFileSystem(conf).makeQualified(path);\n       }\n-      if(!\"hdfs\".equalsIgnoreCase(path.toUri().getScheme())) {\n+      if (!isFileInHdfs(path.getFileSystem(conf), path)) {\n         return false;\n       }\n \n       return (getEncryptionZoneForPath(fullPath) != null);\n     }\n \n+    /**\n+     * Returns true if the given fs supports mount functionality. In general we\n+     * can have child file systems only in the case of mount fs like\n+     * ViewFileSystem, ViewFsOverloadScheme or ViewDistributedFileSystem.\n+     * Returns false if the getChildFileSystems API returns null.\n+     */\n+    private boolean isMountedFs(FileSystem fs) {\n+      return fs.getChildFileSystems() != null;\n+    }\n+\n+    private boolean isFileInHdfs(FileSystem fs, Path path) throws IOException {\n+      String hdfsScheme = \"hdfs\";\n+      boolean isHdfs = hdfsScheme.equalsIgnoreCase(path.toUri().getScheme());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "714ebd00033aae3fd5e8e8502ce44dd358f97ccd"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a2b699205ee01d43a737c012054906c06cdcaad", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/7a2b699205ee01d43a737c012054906c06cdcaad", "committedDate": "2020-11-03T20:44:18Z", "message": "Updated commnets for better clarifying ViewHDFS cases."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyODYyNzUy", "url": "https://github.com/apache/hive/pull/1639#pullrequestreview-522862752", "createdAt": "2020-11-03T20:48:20Z", "commit": {"oid": "7a2b699205ee01d43a737c012054906c06cdcaad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2994, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}