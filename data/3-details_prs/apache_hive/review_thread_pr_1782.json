{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwMTYxNTAw", "number": 1782, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNTo1NDozNVrOFInpoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMTowMzoyNVrOFIvgxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NTgyNTYxOnYy", "diffSide": "RIGHT", "path": "ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNTo1NDozNVrOIKoz3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwMzo1MzoxN1rOINk6Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAyNTMwOA==", "bodyText": "nit. Import to avoid using fully-qualified class name here?", "url": "https://github.com/apache/hive/pull/1782#discussion_r548025308", "createdAt": "2020-12-23T15:54:35Z", "author": {"login": "jcamachor"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java", "diffHunk": "@@ -1831,7 +1832,8 @@ public RelOptMaterialization getMaterializedViewForRebuild(String dbName, String\n \n   private List<RelOptMaterialization> getValidMaterializedViews(List<Table> materializedViewTables,\n       List<String> tablesUsed, boolean forceMVContentsUpToDate, boolean expandGroupingSets,\n-      HiveTxnManager txnMgr) throws HiveException {\n+      HiveTxnManager txnMgr, EnumSet<org.apache.hadoop.hive.ql.metadata.Materialization.RewriteAlgorithm> scope)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4762427b245b6dbd866560804915f077227937fd"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTEwNzA3NA==", "bodyText": "We already have a Materialization class so renamed this one to HiveRelOptMaterialization which fixed this.", "url": "https://github.com/apache/hive/pull/1782#discussion_r551107074", "createdAt": "2021-01-04T03:53:17Z", "author": {"login": "kasakrisz"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java", "diffHunk": "@@ -1831,7 +1832,8 @@ public RelOptMaterialization getMaterializedViewForRebuild(String dbName, String\n \n   private List<RelOptMaterialization> getValidMaterializedViews(List<Table> materializedViewTables,\n       List<String> tablesUsed, boolean forceMVContentsUpToDate, boolean expandGroupingSets,\n-      HiveTxnManager txnMgr) throws HiveException {\n+      HiveTxnManager txnMgr, EnumSet<org.apache.hadoop.hive.ql.metadata.Materialization.RewriteAlgorithm> scope)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAyNTMwOA=="}, "originalCommit": {"oid": "4762427b245b6dbd866560804915f077227937fd"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NzA2MjE3OnYy", "diffSide": "RIGHT", "path": "ql/src/java/org/apache/hadoop/hive/ql/metadata/Materialization.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMDo1MDo1NlrOIK1HNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwMzo1MjowMFrOINk5FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIyNjg3MA==", "bodyText": "Should this class extend RelOptMaterialization rather than wrapping it? I think it would make sense since we may extend it with other properties in the future and may be convenient to be accessible anywhere in Calcite code.", "url": "https://github.com/apache/hive/pull/1782#discussion_r548226870", "createdAt": "2020-12-23T20:50:56Z", "author": {"login": "jcamachor"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/metadata/Materialization.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hive.ql.metadata;\n+\n+import org.apache.calcite.plan.RelOptMaterialization;\n+\n+import java.util.EnumSet;\n+\n+import static org.apache.commons.collections.CollectionUtils.intersection;\n+\n+/**\n+ * Wrapper class of {@link RelOptMaterialization} and corresponding flags.\n+ */\n+public class Materialization {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4762427b245b6dbd866560804915f077227937fd"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTEwNjgzNw==", "bodyText": "Changed this to extend RelOptMaterialization.", "url": "https://github.com/apache/hive/pull/1782#discussion_r551106837", "createdAt": "2021-01-04T03:52:00Z", "author": {"login": "kasakrisz"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/metadata/Materialization.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hive.ql.metadata;\n+\n+import org.apache.calcite.plan.RelOptMaterialization;\n+\n+import java.util.EnumSet;\n+\n+import static org.apache.commons.collections.CollectionUtils.intersection;\n+\n+/**\n+ * Wrapper class of {@link RelOptMaterialization} and corresponding flags.\n+ */\n+public class Materialization {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIyNjg3MA=="}, "originalCommit": {"oid": "4762427b245b6dbd866560804915f077227937fd"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NzExMzY0OnYy", "diffSide": "RIGHT", "path": "ql/src/java/org/apache/hadoop/hive/ql/parse/CBOPlan.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMTowMzoyNVrOIK1olQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwMzo1MDo1NVrOINk4dQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIzNTQxMw==", "bodyText": "nit. null -> Null", "url": "https://github.com/apache/hive/pull/1782#discussion_r548235413", "createdAt": "2020-12-23T21:03:25Z", "author": {"login": "jcamachor"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/parse/CBOPlan.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hive.ql.parse;\n+\n+import org.apache.calcite.rel.RelNode;\n+\n+/**\n+ * Wrapper of Calcite plan.\n+ */\n+public class CBOPlan {\n+  private final RelNode plan;\n+  private final String invalidAutomaticRewritingMaterializationReason;\n+\n+  public CBOPlan(RelNode plan, String invalidAutomaticRewritingMaterializationReason) {\n+    this.plan = plan;\n+    this.invalidAutomaticRewritingMaterializationReason = invalidAutomaticRewritingMaterializationReason;\n+  }\n+\n+  /**\n+   * Root node of plan.\n+   * @return Root {@link RelNode}\n+   */\n+  public RelNode getPlan() {\n+    return plan;\n+  }\n+\n+  /**\n+   * Returns an error message if this plan can not be a definition of a Materialized view which is an input of\n+   * Calcite based materialized view query rewrite.\n+   * null or empty string otherwise.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4762427b245b6dbd866560804915f077227937fd"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTEwNjY3Nw==", "bodyText": "fixed", "url": "https://github.com/apache/hive/pull/1782#discussion_r551106677", "createdAt": "2021-01-04T03:50:55Z", "author": {"login": "kasakrisz"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/parse/CBOPlan.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hadoop.hive.ql.parse;\n+\n+import org.apache.calcite.rel.RelNode;\n+\n+/**\n+ * Wrapper of Calcite plan.\n+ */\n+public class CBOPlan {\n+  private final RelNode plan;\n+  private final String invalidAutomaticRewritingMaterializationReason;\n+\n+  public CBOPlan(RelNode plan, String invalidAutomaticRewritingMaterializationReason) {\n+    this.plan = plan;\n+    this.invalidAutomaticRewritingMaterializationReason = invalidAutomaticRewritingMaterializationReason;\n+  }\n+\n+  /**\n+   * Root node of plan.\n+   * @return Root {@link RelNode}\n+   */\n+  public RelNode getPlan() {\n+    return plan;\n+  }\n+\n+  /**\n+   * Returns an error message if this plan can not be a definition of a Materialized view which is an input of\n+   * Calcite based materialized view query rewrite.\n+   * null or empty string otherwise.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIzNTQxMw=="}, "originalCommit": {"oid": "4762427b245b6dbd866560804915f077227937fd"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 161, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}