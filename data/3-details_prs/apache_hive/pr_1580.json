{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzNDE4Nzg0", "number": 1580, "title": "HIVE-24253: HMS and HS2 needs to support keystore/truststores types b\u2026", "bodyText": "\u2026esides JKS by config\nHiveServer2:\nAdd new properties:\nhive.server2.keystore.type\nJDBC:\nRemove hard-coded SSL_TRUST_STORE_TYPE(JKS) from jdbc connection for HS2\nAdd trustStoreType param for jdbc connection\nHive MetaStore:\nNew properties for service and client:\nmetastore.keystore.type\nmetastore.truststore.type\nAdd bcfks into metastore.dbaccess.ssl.truststore.type stringvalidator\nTests:\nUnit tests for HS2 and HMS\n\nWhat changes were proposed in this pull request?\n\nWhy are the changes needed?\n\nDoes this PR introduce any user-facing change?\n\nHow was this patch tested?", "createdAt": "2020-10-14T14:30:32Z", "url": "https://github.com/apache/hive/pull/1580", "merged": true, "mergeCommit": {"oid": "036ee740eb423714af99a06f32d76c9708f4201b"}, "closed": true, "closedAt": "2020-10-15T21:00:01Z", "author": {"login": "yongzhi"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSj5Z3gFqTUwODczNzExOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdS21JoAFqTUwOTY5NTYwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NzM3MTE4", "url": "https://github.com/apache/hive/pull/1580#pullrequestreview-508737118", "createdAt": "2020-10-14T21:15:51Z", "commit": {"oid": "f948a3ff27fb3a2ed2deeacc2ae9e50a3f4b704d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMToxNTo1MVrOHhlU2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMToxNTo1MVrOHhlU2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk3NjYwMg==", "bodyText": "keyStoreAlgorithm looks unused? Might have to be used around line 153?", "url": "https://github.com/apache/hive/pull/1580#discussion_r504976602", "createdAt": "2020-10-14T21:15:51Z", "author": {"login": "risdenk"}, "path": "service/src/java/org/apache/hive/service/cli/thrift/ThriftHttpCLIService.java", "diffHunk": "@@ -136,6 +136,12 @@ public void onClosed(Connection connection) {\n               ConfVars.HIVE_SERVER2_SSL_KEYSTORE_PATH.varname \n               + \" Not configured for SSL connection\");\n         }\n+        String keyStoreType = hiveConf.getVar(ConfVars.HIVE_SERVER2_SSL_KEYSTORE_TYPE).trim();\n+        if (keyStoreType.isEmpty()) {\n+          keyStoreType = KeyStore.getDefaultType();\n+        }\n+        String keyStoreAlgorithm = hiveConf.getVar(ConfVars.HIVE_SERVER2_SSL_KEYSTORE_ALGORITHM).trim();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f948a3ff27fb3a2ed2deeacc2ae9e50a3f4b704d"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63316cb8fa4603a6da904b38ac9417c40ba4b31b", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/63316cb8fa4603a6da904b38ac9417c40ba4b31b", "committedDate": "2020-10-14T23:44:50Z", "message": "HIVE-24253: HMS and HS2 needs to support keystore/truststores types besides JKS by config\n\nAdd following optional properties for SSL related configs:\nHiveServer2:\n Add new properties:\n  hive.server2.keystore.type\n  hive.server2.keymanagerfactory.algorithm\n JDBC:\n  Remove hard-coded SSL_TRUST_STORE_TYPE(JKS) from jdbc connection for HS2\n  Add trustStoreType param for jdbc connection\n  Add trustManagerFactoryAlgorithm\nHive MetaStore:\n  New properties for service and client:\n   metastore.keystore.type\n   metastore.keymanagerfactory.algorithm\n   metastore.truststore.type\n   metastore.trustmanagerfactory.algorithm\n  Add bcfks into metastore.dbaccess.ssl.truststore.type stringvalidator\nTests:\n Unit tests for HS2 and HMS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f948a3ff27fb3a2ed2deeacc2ae9e50a3f4b704d", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/f948a3ff27fb3a2ed2deeacc2ae9e50a3f4b704d", "committedDate": "2020-10-14T14:04:07Z", "message": "HIVE-24253: HMS and HS2 needs to support keystore/truststores types besides JKS by config\n\nHiveServer2:\n Add new properties:\n  hive.server2.keystore.type\n JDBC:\n  Remove hard-coded SSL_TRUST_STORE_TYPE(JKS) from jdbc connection for HS2\n  Add trustStoreType param for jdbc connection\nHive MetaStore:\n  New properties for service and client:\n   metastore.keystore.type\n   metastore.truststore.type\n  Add bcfks into metastore.dbaccess.ssl.truststore.type stringvalidator\nTests:\n Unit tests for HS2 and HMS"}, "afterCommit": {"oid": "63316cb8fa4603a6da904b38ac9417c40ba4b31b", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/63316cb8fa4603a6da904b38ac9417c40ba4b31b", "committedDate": "2020-10-14T23:44:50Z", "message": "HIVE-24253: HMS and HS2 needs to support keystore/truststores types besides JKS by config\n\nAdd following optional properties for SSL related configs:\nHiveServer2:\n Add new properties:\n  hive.server2.keystore.type\n  hive.server2.keymanagerfactory.algorithm\n JDBC:\n  Remove hard-coded SSL_TRUST_STORE_TYPE(JKS) from jdbc connection for HS2\n  Add trustStoreType param for jdbc connection\n  Add trustManagerFactoryAlgorithm\nHive MetaStore:\n  New properties for service and client:\n   metastore.keystore.type\n   metastore.keymanagerfactory.algorithm\n   metastore.truststore.type\n   metastore.trustmanagerfactory.algorithm\n  Add bcfks into metastore.dbaccess.ssl.truststore.type stringvalidator\nTests:\n Unit tests for HS2 and HMS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NjY2NzU4", "url": "https://github.com/apache/hive/pull/1580#pullrequestreview-509666758", "createdAt": "2020-10-15T18:40:29Z", "commit": {"oid": "63316cb8fa4603a6da904b38ac9417c40ba4b31b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxODo0MDoyOVrOHiVO-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxODo0MDoyOVrOHiVO-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc2MTUzMA==", "bodyText": "This import seems un-necessary. Can be removed.\nI did not like the idea of adding a dependency on this class into the Hive JDBC module but looks like its not needed.", "url": "https://github.com/apache/hive/pull/1580#discussion_r505761530", "createdAt": "2020-10-15T18:40:29Z", "author": {"login": "nrg4878"}, "path": "jdbc/src/java/org/apache/hive/jdbc/HiveConnection.java", "diffHunk": "@@ -19,6 +19,7 @@\n package org.apache.hive.jdbc;\n \n import com.google.common.annotations.VisibleForTesting;\n+import org.apache.hadoop.hive.metastore.conf.MetastoreConf;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63316cb8fa4603a6da904b38ac9417c40ba4b31b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02c2ecb8c4d179f824d4332fa318404a5f2856be", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/02c2ecb8c4d179f824d4332fa318404a5f2856be", "committedDate": "2020-10-15T18:56:18Z", "message": "Remove unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5Njg0NTAw", "url": "https://github.com/apache/hive/pull/1580#pullrequestreview-509684500", "createdAt": "2020-10-15T19:04:36Z", "commit": {"oid": "63316cb8fa4603a6da904b38ac9417c40ba4b31b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxOTowNDozNlrOHiWDtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxOTowNDozNlrOHiWDtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc3NTAzMQ==", "bodyText": "So now instead of defaulting to JKS, the client always has to provide \"trustStoreType=JKS\" in the connection params? Wouldnt this break backward compatibility with existing applications ?", "url": "https://github.com/apache/hive/pull/1580#discussion_r505775031", "createdAt": "2020-10-15T19:04:36Z", "author": {"login": "nrg4878"}, "path": "jdbc/src/java/org/apache/hive/jdbc/Utils.java", "diffHunk": "@@ -105,6 +105,8 @@\n     public static final String USE_SSL = \"ssl\";\n     public static final String SSL_TRUST_STORE = \"sslTrustStore\";\n     public static final String SSL_TRUST_STORE_PASSWORD = \"trustStorePassword\";\n+    public static final String SSL_TRUST_STORE_TYPE = \"trustStoreType\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63316cb8fa4603a6da904b38ac9417c40ba4b31b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5Njk1NjAy", "url": "https://github.com/apache/hive/pull/1580#pullrequestreview-509695602", "createdAt": "2020-10-15T19:20:48Z", "commit": {"oid": "63316cb8fa4603a6da904b38ac9417c40ba4b31b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3181, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}