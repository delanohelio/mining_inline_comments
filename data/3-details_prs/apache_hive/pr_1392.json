{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2MzQ5NDQ3", "number": 1392, "title": "HIVE-24074: Incorrect handling of timestamp in Parquet/Avro when written in certain time zones in versions before Hive 3.x", "bodyText": "What changes were proposed in this pull request?\n\nWhy are the changes needed?\n\nDoes this PR introduce any user-facing change?\n\nHow was this patch tested?", "createdAt": "2020-08-11T20:53:03Z", "url": "https://github.com/apache/hive/pull/1392", "merged": true, "mergeCommit": {"oid": "5aa00869a0dd5132431855f81431349dc53c61ce"}, "closed": true, "closedAt": "2020-08-28T15:17:37Z", "author": {"login": "jcamachor"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc99L3fAH2gAyNDY2MzQ5NDQ3OjYyYjFkZGRhYzI4OTdkZWU2NDI5ZDEwYzM5MTMyN2ExMWE4MzdlNDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDMHx7AH2gAyNDY2MzQ5NDQ3OmI3ZTA5NjEwMzM4MmRjY2Y5YTFmMmU2MDc0YTRkN2ExYjNlYjg0OTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "62b1dddac2897dee6429d10c391327a11a837e46", "author": {"user": {"login": "jcamachor", "name": "Jes\u00fas Camacho Rodr\u00edguez"}}, "url": "https://github.com/apache/hive/commit/62b1dddac2897dee6429d10c391327a11a837e46", "committedDate": "2020-08-11T20:52:38Z", "message": "[WiP] Parquet conversion tz"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1NDI2MTM2", "url": "https://github.com/apache/hive/pull/1392#pullrequestreview-465426136", "createdAt": "2020-08-11T21:01:42Z", "commit": {"oid": "62b1dddac2897dee6429d10c391327a11a837e46"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQyMTowMTo0MlrOG_JG1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQyMTowMTo0MlrOG_JG1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg2MjY3OA==", "bodyText": "should this be a threadlocal value? using this way is pretty slow iirc..", "url": "https://github.com/apache/hive/pull/1392#discussion_r468862678", "createdAt": "2020-08-11T21:01:42Z", "author": {"login": "prasanthj"}, "path": "common/src/java/org/apache/hadoop/hive/common/type/TimestampTZUtil.java", "diffHunk": "@@ -145,13 +149,33 @@ public static ZoneId parseTimeZone(String timeZoneStr) {\n     }\n   }\n \n+  public static Timestamp convertTimestampToZone(Timestamp ts, ZoneId fromZone, ZoneId toZone) {\n+    return convertTimestampToZone(ts, fromZone, toZone, false);\n+  }\n+\n   /**\n    * Timestamps are technically time zone agnostic, and this method sort of cheats its logic.\n    * Timestamps are supposed to represent nanos since [UTC epoch]. Here,\n    * the input timestamp represents nanoseconds since [epoch at fromZone], and\n    * we return a Timestamp representing nanoseconds since [epoch at toZone].\n    */\n-  public static Timestamp convertTimestampToZone(Timestamp ts, ZoneId fromZone, ZoneId toZone) {\n+  public static Timestamp convertTimestampToZone(Timestamp ts, ZoneId fromZone, ZoneId toZone,\n+      boolean legacyConversion) {\n+    if (legacyConversion) {\n+      try {\n+        DateFormat formatter = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62b1dddac2897dee6429d10c391327a11a837e46"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c36fa04d7e5af1cd0925d0c93d91a56cc7c314c", "author": {"user": {"login": "jcamachor", "name": "Jes\u00fas Camacho Rodr\u00edguez"}}, "url": "https://github.com/apache/hive/commit/7c36fa04d7e5af1cd0925d0c93d91a56cc7c314c", "committedDate": "2020-08-11T22:46:53Z", "message": "test file changes and addressing review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "718d4d2600e8342b15b786986aa9befac99223ec", "author": {"user": {"login": "jcamachor", "name": "Jes\u00fas Camacho Rodr\u00edguez"}}, "url": "https://github.com/apache/hive/commit/718d4d2600e8342b15b786986aa9befac99223ec", "committedDate": "2020-08-11T22:48:43Z", "message": "remove outdated comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6523fd6f91432db620322f9a54167e045e19661b", "author": {"user": {"login": "jcamachor", "name": "Jes\u00fas Camacho Rodr\u00edguez"}}, "url": "https://github.com/apache/hive/commit/6523fd6f91432db620322f9a54167e045e19661b", "committedDate": "2020-08-12T02:21:13Z", "message": "adding debug config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd34bb31b32c7c366d295faf9638b5cc6f183ddb", "author": {"user": {"login": "jcamachor", "name": "Jes\u00fas Camacho Rodr\u00edguez"}}, "url": "https://github.com/apache/hive/commit/dd34bb31b32c7c366d295faf9638b5cc6f183ddb", "committedDate": "2020-08-25T00:09:01Z", "message": "tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eeb96a9b62321b2fe7dde9f17154c45b3bafd555", "author": {"user": {"login": "jcamachor", "name": "Jes\u00fas Camacho Rodr\u00edguez"}}, "url": "https://github.com/apache/hive/commit/eeb96a9b62321b2fe7dde9f17154c45b3bafd555", "committedDate": "2020-08-26T22:57:00Z", "message": "isolate new tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cab508ebdc2bc9d483de6eaaf7ab1e37cc683d0a", "author": {"user": {"login": "jcamachor", "name": "Jes\u00fas Camacho Rodr\u00edguez"}}, "url": "https://github.com/apache/hive/commit/cab508ebdc2bc9d483de6eaaf7ab1e37cc683d0a", "committedDate": "2020-08-28T03:05:59Z", "message": "Revert \"isolate new tests\"\n\nThis reverts commit eeb96a9b62321b2fe7dde9f17154c45b3bafd555."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7e096103382dccf9a1f2e6074a4d7a1b3eb8498", "author": {"user": {"login": "jcamachor", "name": "Jes\u00fas Camacho Rodr\u00edguez"}}, "url": "https://github.com/apache/hive/commit/b7e096103382dccf9a1f2e6074a4d7a1b3eb8498", "committedDate": "2020-08-28T03:06:22Z", "message": "disable after test run to avoid side effects"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3448, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}