{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1MzI3Njc5", "number": 1382, "title": "HIVE-24020: Fix Automatic compaction for streaming ingest with dynamic partition", "bodyText": "What changes were proposed in this pull request?\nWe need to keep info about the updated partition as well, and pass this to addDynamicPartitions. Here i am reusing addedParitions, as I don't see any effect on stats either. Reviewers please suggest if you think it can affect.\nWhy are the changes needed?\nTo fix automatic compaction in case of streaming ingest with dynamic partition.\nDoes this PR introduce any user-facing change?\nNo\nHow was this patch tested?\nAdded unit-test.", "createdAt": "2020-08-10T07:24:17Z", "url": "https://github.com/apache/hive/pull/1382", "merged": true, "mergeCommit": {"oid": "0a0c03b570752c9a923021195134666eaf9961fe"}, "closed": true, "closedAt": "2020-08-26T17:51:19Z", "author": {"login": "vpnvishv"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9c4yhAH2gAyNDY1MzI3Njc5OmFmNWM1ZmQ5Mzc1YzhkODI2Y2UxNmQwMmFmNDBhMTE1MWM2NWM3MDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdB6X1MgFqTQ3MzEwMzM4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "af5c5fd9375c8d826ce16d02af40a1151c65c708", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/af5c5fd9375c8d826ce16d02af40a1151c65c708", "committedDate": "2020-08-10T07:14:50Z", "message": "HIVE-24020: Fix Automaction compaction for streaming ingest with dynamic partition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyOTkxMTI4", "url": "https://github.com/apache/hive/pull/1382#pullrequestreview-472991128", "createdAt": "2020-08-23T08:19:26Z", "commit": {"oid": "af5c5fd9375c8d826ce16d02af40a1151c65c708"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QwODoxOToyNlrOHFLPoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QwODoxOToyNlrOHFLPoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTE4OTE1Mw==", "bodyText": "Can we please rename the 'addedPartitions' to something like more resembling the actual usage, like 'updatedPartitions', or 'changedPartitions', or whatever? Maybe a comment on the attribute/and getter should be good as well.\nOtherwise LGTM.\nThanks, Peter", "url": "https://github.com/apache/hive/pull/1382#discussion_r475189153", "createdAt": "2020-08-23T08:19:26Z", "author": {"login": "pvary"}, "path": "streaming/src/java/org/apache/hive/streaming/AbstractRecordWriter.java", "diffHunk": "@@ -581,16 +582,9 @@ protected RecordUpdater getRecordUpdater(List<String> partitionValues, int bucke\n           destLocation = new Path(table.getSd().getLocation());\n         } else {\n           PartitionInfo partitionInfo = conn.createPartitionIfNotExists(partitionValues);\n-          // collect the newly added partitions. connection.commitTransaction() will report the dynamically added\n-          // partitions to TxnHandler\n-          if (!partitionInfo.isExists()) {\n-            addedPartitions.add(partitionInfo.getName());\n-          } else {\n-            if (LOG.isDebugEnabled()) {\n-              LOG.debug(\"Partition {} already exists for table {}\",\n-                  partitionInfo.getName(), fullyQualifiedTableName);\n-            }\n-          }\n+          // collect the newly added/updated partitions. connection.commitTransaction() will report the dynamically\n+          // added partitions to TxnHandler\n+          addedPartitions.add(partitionInfo.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af5c5fd9375c8d826ce16d02af40a1151c65c708"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "943d70a947dc1fc705da9d8ace6e029a0ebac85c", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/943d70a947dc1fc705da9d8ace6e029a0ebac85c", "committedDate": "2020-08-23T13:21:04Z", "message": "review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMTAzMzg4", "url": "https://github.com/apache/hive/pull/1382#pullrequestreview-473103388", "createdAt": "2020-08-24T03:51:41Z", "commit": {"oid": "943d70a947dc1fc705da9d8ace6e029a0ebac85c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3437, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}