{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNzg0ODE0", "number": 1795, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMToyMTo1MVrOFK2zfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMToyMTo1MVrOFK2zfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2OTI3OTk2OnYy", "diffSide": "RIGHT", "path": "ql/src/java/org/apache/hadoop/hive/ql/DriverTxnHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMToyMTo1MVrOINuLEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMjowMzozNFrOINvSjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI1ODg5OQ==", "bodyText": "If the TxnManager is handling a new query, would the old transaction be closed correctly?", "url": "https://github.com/apache/hive/pull/1795#discussion_r551258899", "createdAt": "2021-01-04T11:21:51Z", "author": {"login": "pvary"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/DriverTxnHandler.java", "diffHunk": "@@ -527,11 +527,15 @@ void release() {\n     release(!hiveLocks.isEmpty());\n   }\n \n-  void destroy() {\n+  void destroy(String queryIdFromDriver) {\n+    // We need cleanup transactions, even if we did not acquired locks yet\n+    // However TxnManager is bound to session, so wee need to check if it is already handling a new query", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6267383d2bc43deb5544ad31d45a970d28c834b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI3NzE5OA==", "bodyText": "If txnManager is handling a new query, the previous one must be either committed or aborted otherwise the second query's openTxn call would have failed with an exception.", "url": "https://github.com/apache/hive/pull/1795#discussion_r551277198", "createdAt": "2021-01-04T12:03:34Z", "author": {"login": "pvargacl"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/DriverTxnHandler.java", "diffHunk": "@@ -527,11 +527,15 @@ void release() {\n     release(!hiveLocks.isEmpty());\n   }\n \n-  void destroy() {\n+  void destroy(String queryIdFromDriver) {\n+    // We need cleanup transactions, even if we did not acquired locks yet\n+    // However TxnManager is bound to session, so wee need to check if it is already handling a new query", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTI1ODg5OQ=="}, "originalCommit": {"oid": "b6267383d2bc43deb5544ad31d45a970d28c834b"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 183, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}