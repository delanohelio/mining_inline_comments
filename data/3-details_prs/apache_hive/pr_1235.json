{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3MTY2OTgz", "number": 1235, "title": "HIVE-23830: Remove shutdownRunner runner after query is committed", "bodyText": "Each query creates a shutdownRunner which will release transactional resources in case JVM exits mid-query. These shutdownRunners are not removed until session is closed. Session lifetime is unbounded. These shutdown hooks can cause OOM. We should remove them once query is committed or rolled back.\nChange-Id: I0b747bbfb2a451c2be1a28f21d4fb6354f76ee5a\nNOTICE\nPlease create an issue in ASF JIRA before opening a pull request,\nand you need to set the title of the pull request which starts with\nthe corresponding JIRA issue number. (e.g. HIVE-XXXXX: Fix a typo in YYY)\nFor more details, please see https://cwiki.apache.org/confluence/display/Hive/HowToContribute", "createdAt": "2020-07-10T01:05:42Z", "url": "https://github.com/apache/hive/pull/1235", "merged": true, "mergeCommit": {"oid": "6720320b1f8760d767ff4d8d710f9ddf4ac9b7c6"}, "closed": true, "closedAt": "2020-07-13T09:00:25Z", "author": {"login": "mustafaiman"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczb_sxAFqTQ0NjExNTQyMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABczmJRCAFqTQ0NjUzMzAwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MTE1NDIw", "url": "https://github.com/apache/hive/pull/1235#pullrequestreview-446115420", "createdAt": "2020-07-10T04:33:14Z", "commit": {"oid": "e9c3da0d2c8467d876343e2a9ab486908c6b1488"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNDozMzoxNFrOGvpiVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNDozMzoxNFrOGvpiVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYxNjc5MA==", "bodyText": "This method starts to look like a cleanup.\nShall we separate out the functions to a different method, or just change the name?", "url": "https://github.com/apache/hive/pull/1235#discussion_r452616790", "createdAt": "2020-07-10T04:33:14Z", "author": {"login": "pvary"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/DriverTxnHandler.java", "diffHunk": "@@ -553,11 +553,13 @@ private void release(boolean releaseLocks) {\n         LOG.warn(\"Exception when releasing locking in destroy: \" + e.getMessage());\n       }\n     }\n-    ShutdownHookManager.removeShutdownHook(shutdownRunner);\n+    ShutdownHookManager.removeShutdownHook(txnRollbackRunner);\n   }\n \n   void releaseLocksAndCommitOrRollback(boolean commit) throws LockException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9c3da0d2c8467d876343e2a9ab486908c6b1488"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NDg3MjQ3", "url": "https://github.com/apache/hive/pull/1235#pullrequestreview-446487247", "createdAt": "2020-07-10T15:18:02Z", "commit": {"oid": "e9c3da0d2c8467d876343e2a9ab486908c6b1488"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bab325b553fb25f3842bda1518e6bc755c7f55a", "author": {"user": {"login": "mustafaiman", "name": "Mustafa \u0130man"}}, "url": "https://github.com/apache/hive/commit/4bab325b553fb25f3842bda1518e6bc755c7f55a", "committedDate": "2020-07-10T15:54:49Z", "message": "HIVE-23830: Remove shutdownRunner runner after query is committed\n\nEach query creates a shutdownRunner which will release transactional resources in case JVM exits mid-query. These shutdownRunners are not removed until session is closed. Session lifetime is unbounded. These shutdown hooks can cause OOM. We should remove them once query is committed or rolled back.\n\nChange-Id: I0b747bbfb2a451c2be1a28f21d4fb6354f76ee5a"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9c3da0d2c8467d876343e2a9ab486908c6b1488", "author": {"user": {"login": "mustafaiman", "name": "Mustafa \u0130man"}}, "url": "https://github.com/apache/hive/commit/e9c3da0d2c8467d876343e2a9ab486908c6b1488", "committedDate": "2020-07-10T01:03:29Z", "message": "HIVE-23830: Remove shutdownRunner runner after query is committed\n\nEach query creates a shutdownRunner which will release transactional resources in case JVM exits mid-query. These shutdownRunners are not removed until session is closed. Session lifetime is unbounded. These shutdown hooks can cause OOM. We should remove them once query is committed or rolled back.\n\nChange-Id: I0b747bbfb2a451c2be1a28f21d4fb6354f76ee5a"}, "afterCommit": {"oid": "4bab325b553fb25f3842bda1518e6bc755c7f55a", "author": {"user": {"login": "mustafaiman", "name": "Mustafa \u0130man"}}, "url": "https://github.com/apache/hive/commit/4bab325b553fb25f3842bda1518e6bc755c7f55a", "committedDate": "2020-07-10T15:54:49Z", "message": "HIVE-23830: Remove shutdownRunner runner after query is committed\n\nEach query creates a shutdownRunner which will release transactional resources in case JVM exits mid-query. These shutdownRunners are not removed until session is closed. Session lifetime is unbounded. These shutdown hooks can cause OOM. We should remove them once query is committed or rolled back.\n\nChange-Id: I0b747bbfb2a451c2be1a28f21d4fb6354f76ee5a"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NTMzMDA1", "url": "https://github.com/apache/hive/pull/1235#pullrequestreview-446533005", "createdAt": "2020-07-10T16:22:44Z", "commit": {"oid": "4bab325b553fb25f3842bda1518e6bc755c7f55a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3514, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}