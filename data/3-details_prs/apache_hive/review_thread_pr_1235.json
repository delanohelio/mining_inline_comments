{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3MTY2OTgz", "number": 1235, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNDozMzoxNFrOENIs8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNDozMzoxNFrOENIs8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjA5NTIyOnYy", "diffSide": "RIGHT", "path": "ql/src/java/org/apache/hadoop/hive/ql/DriverTxnHandler.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNDozMzoxNFrOGvpiVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNTo1NDoyNlrOGv8pDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYxNjc5MA==", "bodyText": "This method starts to look like a cleanup.\nShall we separate out the functions to a different method, or just change the name?", "url": "https://github.com/apache/hive/pull/1235#discussion_r452616790", "createdAt": "2020-07-10T04:33:14Z", "author": {"login": "pvary"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/DriverTxnHandler.java", "diffHunk": "@@ -553,11 +553,13 @@ private void release(boolean releaseLocks) {\n         LOG.warn(\"Exception when releasing locking in destroy: \" + e.getMessage());\n       }\n     }\n-    ShutdownHookManager.removeShutdownHook(shutdownRunner);\n+    ShutdownHookManager.removeShutdownHook(txnRollbackRunner);\n   }\n \n   void releaseLocksAndCommitOrRollback(boolean commit) throws LockException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9c3da0d2c8467d876343e2a9ab486908c6b1488"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYzOTc4OQ==", "bodyText": "This is the one method that is called from everywhere to end a transaction in either way. Definitely more than a cleanup method. So I think we should not rename it to something that signals it is just a cleanup. I did not want to extract the two lines of clean up to another method either. What is your suggestion?", "url": "https://github.com/apache/hive/pull/1235#discussion_r452639789", "createdAt": "2020-07-10T06:07:08Z", "author": {"login": "mustafaiman"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/DriverTxnHandler.java", "diffHunk": "@@ -553,11 +553,13 @@ private void release(boolean releaseLocks) {\n         LOG.warn(\"Exception when releasing locking in destroy: \" + e.getMessage());\n       }\n     }\n-    ShutdownHookManager.removeShutdownHook(shutdownRunner);\n+    ShutdownHookManager.removeShutdownHook(txnRollbackRunner);\n   }\n \n   void releaseLocksAndCommitOrRollback(boolean commit) throws LockException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYxNjc5MA=="}, "originalCommit": {"oid": "e9c3da0d2c8467d876343e2a9ab486908c6b1488"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY0MzY3Nw==", "bodyText": "I do not have better idea than separate out to a cleanup method. I was hoping you come up with a golden one :)\nDoing cleanup in something called as \"releaseLocksAndCommitOrRollback\" is definitely not a good idea IMHO.", "url": "https://github.com/apache/hive/pull/1235#discussion_r452643677", "createdAt": "2020-07-10T06:19:39Z", "author": {"login": "pvary"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/DriverTxnHandler.java", "diffHunk": "@@ -553,11 +553,13 @@ private void release(boolean releaseLocks) {\n         LOG.warn(\"Exception when releasing locking in destroy: \" + e.getMessage());\n       }\n     }\n-    ShutdownHookManager.removeShutdownHook(shutdownRunner);\n+    ShutdownHookManager.removeShutdownHook(txnRollbackRunner);\n   }\n \n   void releaseLocksAndCommitOrRollback(boolean commit) throws LockException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYxNjc5MA=="}, "originalCommit": {"oid": "e9c3da0d2c8467d876343e2a9ab486908c6b1488"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY3NzkyMw==", "bodyText": "After some more thought, I still was not able to come up with a really good idea :(\nThe best I can think is that we should rename the method to commitAndCleanUp\nBut I still open for any other ideas if you have some.\nThanks,\nPeter", "url": "https://github.com/apache/hive/pull/1235#discussion_r452677923", "createdAt": "2020-07-10T07:43:12Z", "author": {"login": "pvary"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/DriverTxnHandler.java", "diffHunk": "@@ -553,11 +553,13 @@ private void release(boolean releaseLocks) {\n         LOG.warn(\"Exception when releasing locking in destroy: \" + e.getMessage());\n       }\n     }\n-    ShutdownHookManager.removeShutdownHook(shutdownRunner);\n+    ShutdownHookManager.removeShutdownHook(txnRollbackRunner);\n   }\n \n   void releaseLocksAndCommitOrRollback(boolean commit) throws LockException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYxNjc5MA=="}, "originalCommit": {"oid": "e9c3da0d2c8467d876343e2a9ab486908c6b1488"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjkyOTgwNg==", "bodyText": "I would not rename to commitAndCleanup because this method also rolls back transaction. I'll rename it to endTransactionAndCleanup", "url": "https://github.com/apache/hive/pull/1235#discussion_r452929806", "createdAt": "2020-07-10T15:54:26Z", "author": {"login": "mustafaiman"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/DriverTxnHandler.java", "diffHunk": "@@ -553,11 +553,13 @@ private void release(boolean releaseLocks) {\n         LOG.warn(\"Exception when releasing locking in destroy: \" + e.getMessage());\n       }\n     }\n-    ShutdownHookManager.removeShutdownHook(shutdownRunner);\n+    ShutdownHookManager.removeShutdownHook(txnRollbackRunner);\n   }\n \n   void releaseLocksAndCommitOrRollback(boolean commit) throws LockException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYxNjc5MA=="}, "originalCommit": {"oid": "e9c3da0d2c8467d876343e2a9ab486908c6b1488"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 555, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}