{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4NDgxNzEw", "number": 1064, "title": "HIVE-23624: Add metastore metrics to show the compaction status", "bodyText": "Update metrics when the initiator runs, and we have every data at hand", "createdAt": "2020-06-05T14:21:33Z", "url": "https://github.com/apache/hive/pull/1064", "merged": true, "mergeCommit": {"oid": "bfdaeabb85ec4d91a816f50a44927e2e17cb1b5b"}, "closed": true, "closedAt": "2020-06-09T07:58:36Z", "author": {"login": "pvary"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoTZxeAH2gAyNDI4NDgxNzEwOmY1OGEyMDhiMzE2NGU5MDViOGQ5NTA0YWZmYjY0N2YzZWUwZjBlMjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpOthNAH2gAyNDI4NDgxNzEwOmQ0ZTRiZDZiMzYxNGE2ZWE1OTg5ZDMzYmQ5NGZiODk4NGM3ZjliNGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f58a208b3164e905b8d9504affb647f3ee0f0e22", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/hive/commit/f58a208b3164e905b8d9504affb647f3ee0f0e22", "committedDate": "2020-06-05T14:19:24Z", "message": "HIVE-23624: Add metastore metrics to show the compaction status"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MzYzNTM2", "url": "https://github.com/apache/hive/pull/1064#pullrequestreview-425363536", "createdAt": "2020-06-05T14:41:28Z", "commit": {"oid": "f58a208b3164e905b8d9504affb647f3ee0f0e22"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNDo0MToyOFrOGfxX9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNDo0MToyOFrOGfxX9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTk2Nzk4OA==", "bodyText": "element.getPartitionname() can return null, resulting in a key=\"dbName/tableName/null\"", "url": "https://github.com/apache/hive/pull/1064#discussion_r435967988", "createdAt": "2020-06-05T14:41:28Z", "author": {"login": "lcspinter"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/txn/compactor/Initiator.java", "diffHunk": "@@ -487,4 +492,31 @@ private boolean isEligibleForCompaction(CompactionInfo ci, ShowCompactResponse c\n     }\n     return true;\n   }\n+\n+  @VisibleForTesting\n+  protected static void updateCompactionMetrics(ShowCompactResponse showCompactResponse) {\n+    Map<String, ShowCompactResponseElement> lastElements = new HashMap<>();\n+\n+    // Get the last compaction for each db/table/partition\n+    for(ShowCompactResponseElement element : showCompactResponse.getCompacts()) {\n+      String key = element.getDbname() + \"/\" + element.getTablename() + \"/\" + element.getPartitionname();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58a208b3164e905b8d9504affb647f3ee0f0e22"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "199f65fc5e6cb37a21713ac42362aee057d6e3d3", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/hive/commit/199f65fc5e6cb37a21713ac42362aee057d6e3d3", "committedDate": "2020-06-05T14:51:28Z", "message": "Added null check as Laszlo Pinter suggested"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1Mzg3NTY5", "url": "https://github.com/apache/hive/pull/1064#pullrequestreview-425387569", "createdAt": "2020-06-05T15:10:04Z", "commit": {"oid": "199f65fc5e6cb37a21713ac42362aee057d6e3d3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fc5d0fa976aae44afe82361ecba9da569b3a852", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/hive/commit/6fc5d0fa976aae44afe82361ecba9da569b3a852", "committedDate": "2020-06-08T08:02:44Z", "message": "only update  metrics if needed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4e4bd6b3614a6ea5989d33bd94fb8984c7f9b4f", "author": {"user": {"login": "pvary", "name": null}}, "url": "https://github.com/apache/hive/commit/d4e4bd6b3614a6ea5989d33bd94fb8984c7f9b4f", "committedDate": "2020-06-08T11:25:22Z", "message": "Fixing pre-commit test failure"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3806, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}