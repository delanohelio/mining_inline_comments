{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MjM5MjI5", "number": 1145, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzoyNToyMFrOEHHXug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzozOTo0MVrOEHHqaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1ODk2MjUwOnYy", "diffSide": "RIGHT", "path": "service/src/java/org/apache/hive/service/cli/operation/Operation.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzoyNToyMFrOGmUvBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDo0MzozN1rOGmXUgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjgzODc4OQ==", "bodyText": "I don't feel that this method should be closely connected to this interface", "url": "https://github.com/apache/hive/pull/1145#discussion_r442838789", "createdAt": "2020-06-19T13:25:20Z", "author": {"login": "kgyrtkirk"}, "path": "service/src/java/org/apache/hive/service/cli/operation/Operation.java", "diffHunk": "@@ -452,4 +452,8 @@ public String getQueryTag() {\n   public String getQueryId() {\n     return queryState.getQueryId();\n   }\n+\n+  public boolean showOperationDrilldownLink() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5b5fa5b94b5a6cca2deb497343203a70c04094c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg4MTE1Mg==", "bodyText": "Nice find, perhaps I can move the check to the OperationManager.", "url": "https://github.com/apache/hive/pull/1145#discussion_r442881152", "createdAt": "2020-06-19T14:43:37Z", "author": {"login": "dengzhhu653"}, "path": "service/src/java/org/apache/hive/service/cli/operation/Operation.java", "diffHunk": "@@ -452,4 +452,8 @@ public String getQueryTag() {\n   public String getQueryId() {\n     return queryState.getQueryId();\n   }\n+\n+  public boolean showOperationDrilldownLink() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjgzODc4OQ=="}, "originalCommit": {"oid": "a5b5fa5b94b5a6cca2deb497343203a70c04094c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1ODk5MDE5OnYy", "diffSide": "RIGHT", "path": "service/src/java/org/apache/hive/service/cli/CLIService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzozNDowMVrOGmVA1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDo0NjoyNVrOGmXaKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg0MzM1MQ==", "bodyText": "instead of giving access to the HiveServer2 object: how about a method like getWebServerUrl() ?", "url": "https://github.com/apache/hive/pull/1145#discussion_r442843351", "createdAt": "2020-06-19T13:34:01Z", "author": {"login": "kgyrtkirk"}, "path": "service/src/java/org/apache/hive/service/cli/CLIService.java", "diffHunk": "@@ -149,6 +149,10 @@ public UserGroupInformation getHttpUGI() {\n     return this.httpUGI;\n   }\n \n+  public HiveServer2 getHiveServer2() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5b5fa5b94b5a6cca2deb497343203a70c04094c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg4MjYwMw==", "bodyText": "yes, thank you for your good advice, @kgyrtkirk!", "url": "https://github.com/apache/hive/pull/1145#discussion_r442882603", "createdAt": "2020-06-19T14:46:25Z", "author": {"login": "dengzhhu653"}, "path": "service/src/java/org/apache/hive/service/cli/CLIService.java", "diffHunk": "@@ -149,6 +149,10 @@ public UserGroupInformation getHttpUGI() {\n     return this.httpUGI;\n   }\n \n+  public HiveServer2 getHiveServer2() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg0MzM1MQ=="}, "originalCommit": {"oid": "a5b5fa5b94b5a6cca2deb497343203a70c04094c"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1OTAxMDMzOnYy", "diffSide": "RIGHT", "path": "service/src/java/org/apache/hive/service/cli/thrift/ThriftCLIService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzozOTo0MVrOGmVNIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDo1NToxM1rOGmXtMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg0NjQ5OQ==", "bodyText": "I think this should be moved to somewhere around CliService#executeStatement", "url": "https://github.com/apache/hive/pull/1145#discussion_r442846499", "createdAt": "2020-06-19T13:39:41Z", "author": {"login": "kgyrtkirk"}, "path": "service/src/java/org/apache/hive/service/cli/thrift/ThriftCLIService.java", "diffHunk": "@@ -569,7 +569,19 @@ public TExecuteStatementResp ExecuteStatement(TExecuteStatementReq req) throws T\n               queryTimeout) : cliService.executeStatement(sessionHandle, statement, confOverlay,\n               queryTimeout);\n       resp.setOperationHandle(operationHandle.toTOperationHandle());\n-      resp.setStatus(OK_STATUS);\n+      Operation operation = cliService.getSessionManager().getOperationManager()\n+          .getOperation(operationHandle);\n+      if (operation.showOperationDrilldownLink() && cliService.getHiveServer2().getWebServerUrl() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5b5fa5b94b5a6cca2deb497343203a70c04094c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg4NzQ3NA==", "bodyText": "CliService defines the executeStatement returning OperationHandle, which has little relationship with thrift interface/definition. It's may not nice to wrap the thrift message here. Thanks for the review, @kgyrtkirk!", "url": "https://github.com/apache/hive/pull/1145#discussion_r442887474", "createdAt": "2020-06-19T14:55:13Z", "author": {"login": "dengzhhu653"}, "path": "service/src/java/org/apache/hive/service/cli/thrift/ThriftCLIService.java", "diffHunk": "@@ -569,7 +569,19 @@ public TExecuteStatementResp ExecuteStatement(TExecuteStatementReq req) throws T\n               queryTimeout) : cliService.executeStatement(sessionHandle, statement, confOverlay,\n               queryTimeout);\n       resp.setOperationHandle(operationHandle.toTOperationHandle());\n-      resp.setStatus(OK_STATUS);\n+      Operation operation = cliService.getSessionManager().getOperationManager()\n+          .getOperation(operationHandle);\n+      if (operation.showOperationDrilldownLink() && cliService.getHiveServer2().getWebServerUrl() != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg0NjQ5OQ=="}, "originalCommit": {"oid": "a5b5fa5b94b5a6cca2deb497343203a70c04094c"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 647, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}