{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0MzM3MTA4", "number": 1808, "title": "HIVE-24561: Deflake TestCachedStoreUpdateUsingEvents test", "bodyText": "What changes were proposed in this pull request?\nThis PR modifies the test TestCachedStoreUpdateUsingEvents to not use \"file:/tmp\" which is error prone since clean up method can delete all the files in /tmp. Also fixes a harmless NPE which unnecessarily spams the log file.\nWhy are the changes needed?\nI observed this test to be failing on a unrelated PR. I am hoping that these changes will help remove any flakiness if present.\nDoes this PR introduce any user-facing change?\nNo\nHow was this patch tested?\nRan the test locally.", "createdAt": "2020-12-22T20:01:53Z", "url": "https://github.com/apache/hive/pull/1808", "merged": true, "mergeCommit": {"oid": "5171037313f0fc370f502f06c10c58766a6483d1"}, "closed": true, "closedAt": "2020-12-23T17:59:22Z", "author": {"login": "vihangk1"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdowIUSAH2gAyNTQ0MzM3MTA4Ojc4NmQzMDVmM2M3NDYwMTM1ZjM0ZjM0MDhlYzc3MTc3NWU3MTgwY2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoyiUugFqTU1NzQwOTc5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "786d305f3c7460135f34f3408ec771775e7180cb", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/786d305f3c7460135f34f3408ec771775e7180cb", "committedDate": "2020-12-22T19:58:44Z", "message": "HIVE-24561: Deflake TestCachedStoreUpdateUsingEvents test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "942c6ea777e04ed2c6c9a74741f5dafefd75f7d1", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/942c6ea777e04ed2c6c9a74741f5dafefd75f7d1", "committedDate": "2020-12-22T20:02:45Z", "message": "removed unused imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MzU4Njk5", "url": "https://github.com/apache/hive/pull/1808#pullrequestreview-557358699", "createdAt": "2020-12-22T20:49:11Z", "commit": {"oid": "942c6ea777e04ed2c6c9a74741f5dafefd75f7d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MzU5NjY1", "url": "https://github.com/apache/hive/pull/1808#pullrequestreview-557359665", "createdAt": "2020-12-22T20:51:00Z", "commit": {"oid": "942c6ea777e04ed2c6c9a74741f5dafefd75f7d1"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQyMDo1MTowMVrOIKI2Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQyMDo1MToyM1rOIKI25g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzUwMTYzOA==", "bodyText": "Even the dbName can be same across multiple tests, which can get cleaned up. Would it be a good idea to use the current timestamp or generate a random number and prepend that to dbName and use that for the temporary directory ?", "url": "https://github.com/apache/hive/pull/1808#discussion_r547501638", "createdAt": "2020-12-22T20:51:01Z", "author": {"login": "kishendas"}, "path": "itests/hive-unit/src/test/java/org/apache/hadoop/hive/metastore/cache/TestCachedStoreUpdateUsingEvents.java", "diffHunk": "@@ -82,9 +84,9 @@ public void setUp() throws Exception {\n     HiveMetaStore.HMSHandler.createDefaultCatalog(rawStore, new Warehouse(conf));\n   }\n \n-  private Database createTestDb(String dbName, String dbOwner) {\n+  private Database createTestDb(String dbName, String dbOwner) throws IOException {\n     String dbDescription = dbName;\n-    String dbLocation = \"file:/tmp\";\n+    String dbLocation = Files.createTempDirectory(dbName).toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "942c6ea777e04ed2c6c9a74741f5dafefd75f7d1"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzUwMTc5OA==", "bodyText": "Even the dbName and tblName can be same across multiple tests, which can get cleaned up. Would it be a good idea to use the current timestamp or generate a random number and prepend that to dbName and use that for the temporary directory ?", "url": "https://github.com/apache/hive/pull/1808#discussion_r547501798", "createdAt": "2020-12-22T20:51:23Z", "author": {"login": "kishendas"}, "path": "itests/hive-unit/src/test/java/org/apache/hadoop/hive/metastore/cache/TestCachedStoreUpdateUsingEvents.java", "diffHunk": "@@ -94,8 +96,9 @@ private Database createTestDb(String dbName, String dbOwner) {\n   }\n \n   private Table createTestTblParam(String dbName, String tblName, String tblOwner,\n-                              List<FieldSchema> cols, List<FieldSchema> ptnCols, Map<String, String> tblParams) {\n-    String serdeLocation = \"file:/tmp\";\n+                              List<FieldSchema> cols, List<FieldSchema> ptnCols, Map<String, String> tblParams)\n+      throws IOException {\n+    String serdeLocation = Files.createTempDirectory(dbName + \"_\" + tblName).toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "942c6ea777e04ed2c6c9a74741f5dafefd75f7d1"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NDA5Nzk5", "url": "https://github.com/apache/hive/pull/1808#pullrequestreview-557409799", "createdAt": "2020-12-22T22:46:57Z", "commit": {"oid": "942c6ea777e04ed2c6c9a74741f5dafefd75f7d1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2955, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}