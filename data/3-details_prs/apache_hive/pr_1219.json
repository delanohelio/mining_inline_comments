{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1Mzc0NzY3", "number": 1219, "title": "HIVE-23525: TestAcidTxnCleanerService is unstable", "bodyText": "Fix flaky test", "createdAt": "2020-07-07T12:17:48Z", "url": "https://github.com/apache/hive/pull/1219", "merged": true, "mergeCommit": {"oid": "f98e136bdd5642e3de10d2fd1a4c14d1d6762113"}, "closed": true, "closedAt": "2020-07-09T07:56:08Z", "author": {"login": "pvargacl"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyk09-AH2gAyNDQ1Mzc0NzY3OjNmYjYyY2YyYTA2Y2ViNzYxM2ZkYzQ2ODliYzJlODA0YzM1N2Y5Y2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczKSDDgFqTQ0NTM3MzY4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3fb62cf2a06ceb7613fdc4689bc2e804c357f9ce", "author": {"user": {"login": "pvargacl", "name": "Peter Varga"}}, "url": "https://github.com/apache/hive/commit/3fb62cf2a06ceb7613fdc4689bc2e804c357f9ce", "committedDate": "2020-07-07T12:16:44Z", "message": "HIVE-23525: TestAcidTxnCleanerService is unstable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0a47d167f03e4071cfaaa0fbf3f60e75f0e5b78", "author": {"user": {"login": "pvargacl", "name": "Peter Varga"}}, "url": "https://github.com/apache/hive/commit/e0a47d167f03e4071cfaaa0fbf3f60e75f0e5b78", "committedDate": "2020-07-07T12:21:58Z", "message": "Remove ignore"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzODM2MjUz", "url": "https://github.com/apache/hive/pull/1219#pullrequestreview-443836253", "createdAt": "2020-07-07T12:22:17Z", "commit": {"oid": "3fb62cf2a06ceb7613fdc4689bc2e804c357f9ce"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxMjoyMjoxN1rOGt8CAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxMjoyMjoxN1rOGt8CAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDgyMjY1Ng==", "bodyText": "nit: should", "url": "https://github.com/apache/hive/pull/1219#discussion_r450822656", "createdAt": "2020-07-07T12:22:17Z", "author": {"login": "pvary"}, "path": "standalone-metastore/metastore-server/src/test/java/org/apache/hadoop/hive/metastore/txn/TestAcidTxnCleanerService.java", "diffHunk": "@@ -135,7 +136,7 @@ public void cleansCommittedAndEmptyAbortedOnly() throws Exception {\n \n     // kept only the 5 non-empty aborted ones\n     Assert.assertEquals(5, getTxnCount());\n-    Assert.assertEquals(15, getMaxTxnId());\n+    Assert.assertTrue(\"The max txnId shoul be at least 15\", getMaxTxnId() >= 15);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fb62cf2a06ceb7613fdc4689bc2e804c357f9ce"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzODM2Mzgx", "url": "https://github.com/apache/hive/pull/1219#pullrequestreview-443836381", "createdAt": "2020-07-07T12:22:28Z", "commit": {"oid": "3fb62cf2a06ceb7613fdc4689bc2e804c357f9ce"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxMjoyMjoyOFrOGt8CaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxMjoyMjoyOFrOGt8CaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDgyMjc2MQ==", "bodyText": "nit: should", "url": "https://github.com/apache/hive/pull/1219#discussion_r450822761", "createdAt": "2020-07-07T12:22:28Z", "author": {"login": "pvary"}, "path": "standalone-metastore/metastore-server/src/test/java/org/apache/hadoop/hive/metastore/txn/TestAcidTxnCleanerService.java", "diffHunk": "@@ -148,16 +149,16 @@ public void cleansEmptyAbortedBatchTxns() throws Exception {\n         TxnStore.TIMED_OUT_TXN_ABORT_BATCH_SIZE + 50);\n     OpenTxnsResponse resp = txnHandler.openTxns(new OpenTxnRequest(\n         TxnStore.TIMED_OUT_TXN_ABORT_BATCH_SIZE + 50, \"user\", \"hostname\"));\n+    txnHandler.setOpenTxnTimeOutMillis(1);\n     txnHandler.abortTxns(new AbortTxnsRequest(resp.getTxn_ids()));\n     GetOpenTxnsResponse openTxns = txnHandler.getOpenTxns();\n     Assert.assertEquals(TxnStore.TIMED_OUT_TXN_ABORT_BATCH_SIZE + 50 + 1, openTxns.getOpen_txnsSize());\n-    txnHandler.setOpenTxnTimeOutMillis(1);\n \n     underTest.run();\n \n     openTxns = txnHandler.getOpenTxns();\n     Assert.assertEquals(2, openTxns.getOpen_txnsSize());\n-    Assert.assertEquals(TxnStore.TIMED_OUT_TXN_ABORT_BATCH_SIZE + 50 + 1, getMaxTxnId());\n+    Assert.assertTrue(\"The max txnId shoul be at least\", getMaxTxnId() >= TxnStore.TIMED_OUT_TXN_ABORT_BATCH_SIZE + 50 + 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fb62cf2a06ceb7613fdc4689bc2e804c357f9ce"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzODM3MDk1", "url": "https://github.com/apache/hive/pull/1219#pullrequestreview-443837095", "createdAt": "2020-07-07T12:23:30Z", "commit": {"oid": "3fb62cf2a06ceb7613fdc4689bc2e804c357f9ce"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxMjoyMzozMFrOGt8EhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxMjoyMzozMFrOGt8EhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDgyMzMwMQ==", "bodyText": "Why is this change?", "url": "https://github.com/apache/hive/pull/1219#discussion_r450823301", "createdAt": "2020-07-07T12:23:30Z", "author": {"login": "pvary"}, "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/txn/TxnHandler.java", "diffHunk": "@@ -568,6 +568,7 @@ public OpenTxnsResponse openTxns(OpenTxnRequest rqst) throws MetaException {\n            */\n           LOG.error(\"OpenTxnTimeOut exceeded commit duration {}, deleting transactionIds: {}\", elapsedMillis, txnIds);\n           deleteInvalidOpenTransactions(dbConn, txnIds);\n+          dbConn.commit();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fb62cf2a06ceb7613fdc4689bc2e804c357f9ce"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88f07505f97630914e99461109cbde9cc95f5628", "author": {"user": {"login": "pvargacl", "name": "Peter Varga"}}, "url": "https://github.com/apache/hive/commit/88f07505f97630914e99461109cbde9cc95f5628", "committedDate": "2020-07-07T12:30:18Z", "message": "typos"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1MzczNjg2", "url": "https://github.com/apache/hive/pull/1219#pullrequestreview-445373686", "createdAt": "2020-07-09T07:54:59Z", "commit": {"oid": "88f07505f97630914e99461109cbde9cc95f5628"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3483, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}