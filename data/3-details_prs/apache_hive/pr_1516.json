{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNjkxODU4", "number": 1516, "title": "HIVE-24188: CTLT from MM to External or External to MM are failing with hive.strict.managed.tables & hive.create.as.acid", "bodyText": "What changes were proposed in this pull request?\nIncluded check to skip TXN tblproperties for external table from MMM\nWhy are the changes needed?\nCTLT is failing from MM to External\nDoes this PR introduce any user-facing change?\nno\nHow was this patch tested?\nUsing repro sql, included it as part of testcase.", "createdAt": "2020-09-22T05:01:40Z", "url": "https://github.com/apache/hive/pull/1516", "merged": true, "mergeCommit": {"oid": "90ad548d7309c4813ace6f51798fd545c2abe185"}, "closed": true, "closedAt": "2020-09-24T00:57:45Z", "author": {"login": "nareshpr"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLTI5bgBqjM3OTE5MDM3ODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLxLI3gBqjM3OTk1NTMxNjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93107fe5cb34f276da66853973713e3b4bc6284b", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/93107fe5cb34f276da66853973713e3b4bc6284b", "committedDate": "2020-09-22T04:54:26Z", "message": "HIVE-24188 - CTLT from MM to External fails because table txn properties are not skipped"}, "afterCommit": {"oid": "2d0181ca78e5f2c746a586aec14781062f5bfc09", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/2d0181ca78e5f2c746a586aec14781062f5bfc09", "committedDate": "2020-09-22T07:47:47Z", "message": "HIVE-24188 - CTLT from MM to External fails because table txn properties are not skipped"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d0181ca78e5f2c746a586aec14781062f5bfc09", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/2d0181ca78e5f2c746a586aec14781062f5bfc09", "committedDate": "2020-09-22T07:47:47Z", "message": "HIVE-24188 - CTLT from MM to External fails because table txn properties are not skipped"}, "afterCommit": {"oid": "9cbe05374a6aa77e0a10a794946872130d0c2c2d", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/9cbe05374a6aa77e0a10a794946872130d0c2c2d", "committedDate": "2020-09-22T20:33:29Z", "message": "HIVE-24188 - CTLT from MM to External fails because table txn properties are not skipped"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0MTM4NjY3", "url": "https://github.com/apache/hive/pull/1516#pullrequestreview-494138667", "createdAt": "2020-09-23T05:25:47Z", "commit": {"oid": "9cbe05374a6aa77e0a10a794946872130d0c2c2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNToyNTo0N1rOHWW2vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNToyNTo0N1rOHWW2vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIwNTE4Mw==", "bodyText": "This is a bit counterintuitive to me. Why is this table property set to insert only whereas in the other case it is default?", "url": "https://github.com/apache/hive/pull/1516#discussion_r493205183", "createdAt": "2020-09-23T05:25:47Z", "author": {"login": "pvary"}, "path": "ql/src/test/results/clientpositive/llap/create_like2.q.out", "diffHunk": "@@ -59,3 +59,285 @@ Bucket Columns:     \t[]\n Sort Columns:       \t[]                  \t \n Storage Desc Params:\t \t \n \tserialization.format\t1                   \n+PREHOOK: query: create table test_mm(empno int, name string) partitioned by(dept string) stored as orc tblproperties('transactional'='true', 'transactional_properties'='default')\n+PREHOOK: type: CREATETABLE\n+PREHOOK: Output: database:default\n+PREHOOK: Output: default@test_mm\n+POSTHOOK: query: create table test_mm(empno int, name string) partitioned by(dept string) stored as orc tblproperties('transactional'='true', 'transactional_properties'='default')\n+POSTHOOK: type: CREATETABLE\n+POSTHOOK: Output: database:default\n+POSTHOOK: Output: default@test_mm\n+PREHOOK: query: desc formatted test_mm\n+PREHOOK: type: DESCTABLE\n+PREHOOK: Input: default@test_mm\n+POSTHOOK: query: desc formatted test_mm\n+POSTHOOK: type: DESCTABLE\n+POSTHOOK: Input: default@test_mm\n+# col_name            \tdata_type           \tcomment             \n+empno               \tint                 \t                    \n+name                \tstring              \t                    \n+\t \t \n+# Partition Information\t \t \n+# col_name            \tdata_type           \tcomment             \n+dept                \tstring              \t                    \n+\t \t \n+# Detailed Table Information\t \t \n+Database:           \tdefault             \t \n+#### A masked pattern was here ####\n+Retention:          \t0                   \t \n+#### A masked pattern was here ####\n+Table Type:         \tMANAGED_TABLE       \t \n+Table Parameters:\t \t \n+\tCOLUMN_STATS_ACCURATE\t{\\\"BASIC_STATS\\\":\\\"true\\\"}\n+\tbucketing_version   \t2                   \n+\tnumFiles            \t0                   \n+\tnumPartitions       \t0                   \n+\tnumRows             \t0                   \n+\trawDataSize         \t0                   \n+\ttotalSize           \t0                   \n+\ttransactional       \ttrue                \n+\ttransactional_properties\tdefault             \n+#### A masked pattern was here ####\n+\t \t \n+# Storage Information\t \t \n+SerDe Library:      \torg.apache.hadoop.hive.ql.io.orc.OrcSerde\t \n+InputFormat:        \torg.apache.hadoop.hive.ql.io.orc.OrcInputFormat\t \n+OutputFormat:       \torg.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\t \n+Compressed:         \tNo                  \t \n+Num Buckets:        \t-1                  \t \n+Bucket Columns:     \t[]                  \t \n+Sort Columns:       \t[]                  \t \n+#### A masked pattern was here ####\n+PREHOOK: type: CREATETABLE\n+#### A masked pattern was here ####\n+PREHOOK: Output: database:default\n+PREHOOK: Output: default@test_external\n+#### A masked pattern was here ####\n+POSTHOOK: type: CREATETABLE\n+#### A masked pattern was here ####\n+POSTHOOK: Output: database:default\n+POSTHOOK: Output: default@test_external\n+PREHOOK: query: desc formatted test_external\n+PREHOOK: type: DESCTABLE\n+PREHOOK: Input: default@test_external\n+POSTHOOK: query: desc formatted test_external\n+POSTHOOK: type: DESCTABLE\n+POSTHOOK: Input: default@test_external\n+# col_name            \tdata_type           \tcomment             \n+empno               \tint                 \t                    \n+name                \tstring              \t                    \n+\t \t \n+# Partition Information\t \t \n+# col_name            \tdata_type           \tcomment             \n+dept                \tstring              \t                    \n+\t \t \n+# Detailed Table Information\t \t \n+Database:           \tdefault             \t \n+#### A masked pattern was here ####\n+Retention:          \t0                   \t \n+#### A masked pattern was here ####\n+Table Type:         \tEXTERNAL_TABLE      \t \n+Table Parameters:\t \t \n+\tCOLUMN_STATS_ACCURATE\t{\\\"BASIC_STATS\\\":\\\"true\\\"}\n+\tEXTERNAL            \tTRUE                \n+\tbucketing_version   \t2                   \n+\tdiscover.partitions \ttrue                \n+\tnumFiles            \t0                   \n+\tnumPartitions       \t0                   \n+\tnumRows             \t0                   \n+\trawDataSize         \t0                   \n+\ttotalSize           \t0                   \n+#### A masked pattern was here ####\n+\t \t \n+# Storage Information\t \t \n+SerDe Library:      \torg.apache.hadoop.hive.ql.io.orc.OrcSerde\t \n+InputFormat:        \torg.apache.hadoop.hive.ql.io.orc.OrcInputFormat\t \n+OutputFormat:       \torg.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\t \n+Compressed:         \tNo                  \t \n+Num Buckets:        \t-1                  \t \n+Bucket Columns:     \t[]                  \t \n+Sort Columns:       \t[]                  \t \n+PREHOOK: query: create table test_mm1 like test_external\n+PREHOOK: type: CREATETABLE\n+PREHOOK: Output: database:default\n+PREHOOK: Output: default@test_mm1\n+POSTHOOK: query: create table test_mm1 like test_external\n+POSTHOOK: type: CREATETABLE\n+POSTHOOK: Output: database:default\n+POSTHOOK: Output: default@test_mm1\n+PREHOOK: query: desc formatted test_mm1\n+PREHOOK: type: DESCTABLE\n+PREHOOK: Input: default@test_mm1\n+POSTHOOK: query: desc formatted test_mm1\n+POSTHOOK: type: DESCTABLE\n+POSTHOOK: Input: default@test_mm1\n+# col_name            \tdata_type           \tcomment             \n+empno               \tint                 \t                    \n+name                \tstring              \t                    \n+\t \t \n+# Partition Information\t \t \n+# col_name            \tdata_type           \tcomment             \n+dept                \tstring              \t                    \n+\t \t \n+# Detailed Table Information\t \t \n+Database:           \tdefault             \t \n+#### A masked pattern was here ####\n+Retention:          \t0                   \t \n+#### A masked pattern was here ####\n+Table Type:         \tMANAGED_TABLE       \t \n+Table Parameters:\t \t \n+\tCOLUMN_STATS_ACCURATE\t{\\\"BASIC_STATS\\\":\\\"true\\\"}\n+\tbucketing_version   \t2                   \n+\tnumFiles            \t0                   \n+\tnumPartitions       \t0                   \n+\tnumRows             \t0                   \n+\trawDataSize         \t0                   \n+\ttotalSize           \t0                   \n+\ttransactional       \ttrue                \n+\ttransactional_properties\tinsert_only         ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cbe05374a6aa77e0a10a794946872130d0c2c2d"}, "originalPosition": 139}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0MTQ0ODU3", "url": "https://github.com/apache/hive/pull/1516#pullrequestreview-494144857", "createdAt": "2020-09-23T05:29:43Z", "commit": {"oid": "9cbe05374a6aa77e0a10a794946872130d0c2c2d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNToyOTo0M1rOHWW7Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNToyOTo0M1rOHWW7Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIwNjMyNw==", "bodyText": "The pull request title says that we have a problem with converting from mm to external tables. The tests convert from external tables to mm. Maybe fix the jira description?  Or add more tests?", "url": "https://github.com/apache/hive/pull/1516#discussion_r493206327", "createdAt": "2020-09-23T05:29:43Z", "author": {"login": "pvary"}, "path": "ql/src/test/queries/clientpositive/create_like2.q", "diffHunk": "@@ -7,3 +7,34 @@ ALTER TABLE table1_n20 SET TBLPROPERTIES ('a'='1', 'b'='2', 'c'='3', 'd' = '4');\n SET hive.ddl.createtablelike.properties.whitelist=a,c,D;\n CREATE TABLE table2_n14 LIKE table1_n20;\n DESC FORMATTED table2_n14;\n+\n+set hive.support.concurrency=true;\n+set hive.txn.manager=org.apache.hadoop.hive.ql.lockmgr.DbTxnManager;\n+set hive.strict.managed.tables=true;\n+set hive.create.as.acid=true;\n+set hive.create.as.insert.only=true;\n+\n+create table test_mm(empno int, name string) partitioned by(dept string) stored as orc tblproperties('transactional'='true', 'transactional_properties'='default');\n+desc formatted test_mm;\n+\n+-- Conversion from MM to External\n+create external table test_external like test_mm LOCATION '${system:test.tmp.dir}/create_like_mm_to_external';\n+desc formatted test_external;\n+\n+-- Conversion from External to MM\n+create table test_mm1 like test_external;\n+desc formatted test_mm1;\n+\n+-- Conversion from External to External\n+create external table test_external1 like test_external;\n+desc formatted test_external1;\n+\n+-- Conversion from mm to mm\n+create table test_mm2 like test_mm;\n+desc formatted test_mm2;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cbe05374a6aa77e0a10a794946872130d0c2c2d"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9cbe05374a6aa77e0a10a794946872130d0c2c2d", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/9cbe05374a6aa77e0a10a794946872130d0c2c2d", "committedDate": "2020-09-22T20:33:29Z", "message": "HIVE-24188 - CTLT from MM to External fails because table txn properties are not skipped"}, "afterCommit": {"oid": "153c3bc2ffde9fb15cd184933f7ad0e22013913f", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/153c3bc2ffde9fb15cd184933f7ad0e22013913f", "committedDate": "2020-09-23T07:13:58Z", "message": "HIVE-24188 - CTLT from MM to External fails because table txn properties are not skipped"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0MzY1MDYw", "url": "https://github.com/apache/hive/pull/1516#pullrequestreview-494365060", "createdAt": "2020-09-23T07:38:08Z", "commit": {"oid": "153c3bc2ffde9fb15cd184933f7ad0e22013913f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "153c3bc2ffde9fb15cd184933f7ad0e22013913f", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/153c3bc2ffde9fb15cd184933f7ad0e22013913f", "committedDate": "2020-09-23T07:13:58Z", "message": "HIVE-24188 - CTLT from MM to External fails because table txn properties are not skipped"}, "afterCommit": {"oid": "0409147d5891aa9db5de6429fa8921cddc08c99e", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/0409147d5891aa9db5de6429fa8921cddc08c99e", "committedDate": "2020-09-23T16:29:05Z", "message": "HIVE-24188 - CTLT from MM to External fails because table txn properties are not skipped"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab78f835faae45ba04c4a6c53d6ad69a1088a42d", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/ab78f835faae45ba04c4a6c53d6ad69a1088a42d", "committedDate": "2020-09-23T18:47:43Z", "message": "HIVE-24188 - CTLT from MM to External fails because table txn properties are not skipped"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0409147d5891aa9db5de6429fa8921cddc08c99e", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/0409147d5891aa9db5de6429fa8921cddc08c99e", "committedDate": "2020-09-23T16:29:05Z", "message": "HIVE-24188 - CTLT from MM to External fails because table txn properties are not skipped"}, "afterCommit": {"oid": "ab78f835faae45ba04c4a6c53d6ad69a1088a42d", "author": {"user": {"login": "nareshpr", "name": "Naresh P R"}}, "url": "https://github.com/apache/hive/commit/ab78f835faae45ba04c4a6c53d6ad69a1088a42d", "committedDate": "2020-09-23T18:47:43Z", "message": "HIVE-24188 - CTLT from MM to External fails because table txn properties are not skipped"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3090, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}