{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4MTM2NDg2", "number": 1460, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMTowNDozMVrOEjieBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMTowNDozMVrOEjieBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1NzAwMzU2OnYy", "diffSide": "RIGHT", "path": "ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFFromUnixTime.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxMTowNDozMVrOHR8c_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QyMzowMDowNVrOHT4Usg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU3ODMwMg==", "bodyText": "please don't start a new session here\n\nin case you don't have a session - you may read this info from a new HiveConf()\nbumping into this issue from the HMS side is kinda unexpected - could you please leave a note about why this is needed here\ncould you cover this issue with a testcase - or that's not possible because we are running embedded metastore in the tests?", "url": "https://github.com/apache/hive/pull/1460#discussion_r488578302", "createdAt": "2020-09-15T11:04:31Z", "author": {"login": "kgyrtkirk"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFFromUnixTime.java", "diffHunk": "@@ -107,6 +107,10 @@ public ObjectInspector initialize(ObjectInspector[] arguments) throws UDFArgumen\n     }\n \n     if (timeZone == null) {\n+      if (SessionState.get() == null) {\n+        SessionState ss = new SessionState(new HiveConf());\n+        SessionState.setCurrentSessionState(ss);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c478aa9b55316828fd96613c8191168344d823d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYwNzc5NA==", "bodyText": "sorry I did not follow this correctly, I think SessionState will not be available in HMS, can you please guide me how can I retrieve it from new HiveConf(), do  you want me do something like new HiveConf().getLocalTimeZone() ?\nyes that's a rare case while filtering the partition by expression, a query with filter condition having timestamp/date as predicate e.g. following query\nselect * from table_name where hour between from_unixtime(unix_timestamp('2020090120', 'yyyyMMddHH') - 16060, 'yyyyMMddHH') and from_unixtime(unix_timestamp('2020090122', 'yyyyMMddHH') + 26060, 'yyyyMMddHH');\n\nin case of  PartitionExpressionForMetastore proxy, the filter expression is based on ql class/package and thats where user will see such exception.\n\nI think its difficult to reproduce with embedded HMS.", "url": "https://github.com/apache/hive/pull/1460#discussion_r490607794", "createdAt": "2020-09-17T23:00:05Z", "author": {"login": "rajkrrsingh"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/udf/generic/GenericUDFFromUnixTime.java", "diffHunk": "@@ -107,6 +107,10 @@ public ObjectInspector initialize(ObjectInspector[] arguments) throws UDFArgumen\n     }\n \n     if (timeZone == null) {\n+      if (SessionState.get() == null) {\n+        SessionState ss = new SessionState(new HiveConf());\n+        SessionState.setCurrentSessionState(ss);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODU3ODMwMg=="}, "originalCommit": {"oid": "6c478aa9b55316828fd96613c8191168344d823d"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 412, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}