{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxNTU5MDE0", "number": 1792, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMjo1MDoyNFrOFGfx9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMjo1MDoyNFrOFGfx9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMzU2NDY4OnYy", "diffSide": "RIGHT", "path": "ql/pom.xml", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QwMjo1MDoyNFrOIHiQgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwMjozNDoyN1rOIIQxxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MjIyNQ==", "bodyText": "One question. Will this be flaky? Once calcite changes transitive dependencies, seems we also need to update this.", "url": "https://github.com/apache/hive/pull/1792#discussion_r544772225", "createdAt": "2020-12-17T02:50:24Z", "author": {"login": "viirya"}, "path": "ql/pom.xml", "diffHunk": "@@ -880,6 +880,12 @@\n                   <include>joda-time:joda-time</include>\n                   <include>org.apache.calcite:*</include>\n                   <include>org.apache.calcite.avatica:avatica</include>\n+                  <!-- include all of calcite's transitive dependencies as well since\n+                    otherwise they'll be removed in assembly packaging -->\n+                  <include>net.hydromatic:eigenbase-properties</include>\n+                  <include>org.codehaus.janino:janino</include>\n+                  <include>org.codehaus.janino:commons-compiler</include>\n+                  <include>org.pentaho:pentaho-aggdesigner-algorithm</include>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1f542fc1ecfc5a74942e72a48052f1e2aed9eb"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3OTkzOQ==", "bodyText": "Yeah that's the downside of it - whenever we upgrade calcite we should check its dependencies and update here as well. I'm not sure if there is an easy way to include an artifact and all its transitive dependencies in the maven-shade-plugin", "url": "https://github.com/apache/hive/pull/1792#discussion_r544779939", "createdAt": "2020-12-17T03:13:30Z", "author": {"login": "sunchao"}, "path": "ql/pom.xml", "diffHunk": "@@ -880,6 +880,12 @@\n                   <include>joda-time:joda-time</include>\n                   <include>org.apache.calcite:*</include>\n                   <include>org.apache.calcite.avatica:avatica</include>\n+                  <!-- include all of calcite's transitive dependencies as well since\n+                    otherwise they'll be removed in assembly packaging -->\n+                  <include>net.hydromatic:eigenbase-properties</include>\n+                  <include>org.codehaus.janino:janino</include>\n+                  <include>org.codehaus.janino:commons-compiler</include>\n+                  <include>org.pentaho:pentaho-aggdesigner-algorithm</include>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MjIyNQ=="}, "originalCommit": {"oid": "1d1f542fc1ecfc5a74942e72a48052f1e2aed9eb"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ3ODM0Nw==", "bodyText": "BTW, I remember in the latest branch, the shading guava PR doesn't include transitive dependencies like that. Do we also need to do it for the branch?", "url": "https://github.com/apache/hive/pull/1792#discussion_r545478347", "createdAt": "2020-12-17T23:43:41Z", "author": {"login": "viirya"}, "path": "ql/pom.xml", "diffHunk": "@@ -880,6 +880,12 @@\n                   <include>joda-time:joda-time</include>\n                   <include>org.apache.calcite:*</include>\n                   <include>org.apache.calcite.avatica:avatica</include>\n+                  <!-- include all of calcite's transitive dependencies as well since\n+                    otherwise they'll be removed in assembly packaging -->\n+                  <include>net.hydromatic:eigenbase-properties</include>\n+                  <include>org.codehaus.janino:janino</include>\n+                  <include>org.codehaus.janino:commons-compiler</include>\n+                  <include>org.pentaho:pentaho-aggdesigner-algorithm</include>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MjIyNQ=="}, "originalCommit": {"oid": "1d1f542fc1ecfc5a74942e72a48052f1e2aed9eb"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ4MDg4MA==", "bodyText": "I still need to verify whether there is issue in master/4.0.0 as well - it uses calcite 1.21 which no longer depend on eigenbase that is causing the issue in our case, but I think it might be good to always include transitive dependencies anyway.", "url": "https://github.com/apache/hive/pull/1792#discussion_r545480880", "createdAt": "2020-12-17T23:50:30Z", "author": {"login": "sunchao"}, "path": "ql/pom.xml", "diffHunk": "@@ -880,6 +880,12 @@\n                   <include>joda-time:joda-time</include>\n                   <include>org.apache.calcite:*</include>\n                   <include>org.apache.calcite.avatica:avatica</include>\n+                  <!-- include all of calcite's transitive dependencies as well since\n+                    otherwise they'll be removed in assembly packaging -->\n+                  <include>net.hydromatic:eigenbase-properties</include>\n+                  <include>org.codehaus.janino:janino</include>\n+                  <include>org.codehaus.janino:commons-compiler</include>\n+                  <include>org.pentaho:pentaho-aggdesigner-algorithm</include>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MjIyNQ=="}, "originalCommit": {"oid": "1d1f542fc1ecfc5a74942e72a48052f1e2aed9eb"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTUzMTI2MQ==", "bodyText": "So I tried master branch and didn't hit the issue. However I think I may still open another PR for it since we don't really when the transitive dependencies will be needed at runtime.", "url": "https://github.com/apache/hive/pull/1792#discussion_r545531261", "createdAt": "2020-12-18T02:25:00Z", "author": {"login": "sunchao"}, "path": "ql/pom.xml", "diffHunk": "@@ -880,6 +880,12 @@\n                   <include>joda-time:joda-time</include>\n                   <include>org.apache.calcite:*</include>\n                   <include>org.apache.calcite.avatica:avatica</include>\n+                  <!-- include all of calcite's transitive dependencies as well since\n+                    otherwise they'll be removed in assembly packaging -->\n+                  <include>net.hydromatic:eigenbase-properties</include>\n+                  <include>org.codehaus.janino:janino</include>\n+                  <include>org.codehaus.janino:commons-compiler</include>\n+                  <include>org.pentaho:pentaho-aggdesigner-algorithm</include>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MjIyNQ=="}, "originalCommit": {"oid": "1d1f542fc1ecfc5a74942e72a48052f1e2aed9eb"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTUzNDQwNA==", "bodyText": "Oh actually in master we already handles this here, as part of HIVE-22126. I think we should follow the same approach and explicitly add the transitive dependency in Hive's top-level pom. I think this is also how Spark manages its transitive dependencies? it might be better than pulling out the classes and putting them in the fat jar.", "url": "https://github.com/apache/hive/pull/1792#discussion_r545534404", "createdAt": "2020-12-18T02:34:27Z", "author": {"login": "sunchao"}, "path": "ql/pom.xml", "diffHunk": "@@ -880,6 +880,12 @@\n                   <include>joda-time:joda-time</include>\n                   <include>org.apache.calcite:*</include>\n                   <include>org.apache.calcite.avatica:avatica</include>\n+                  <!-- include all of calcite's transitive dependencies as well since\n+                    otherwise they'll be removed in assembly packaging -->\n+                  <include>net.hydromatic:eigenbase-properties</include>\n+                  <include>org.codehaus.janino:janino</include>\n+                  <include>org.codehaus.janino:commons-compiler</include>\n+                  <include>org.pentaho:pentaho-aggdesigner-algorithm</include>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDc3MjIyNQ=="}, "originalCommit": {"oid": "1d1f542fc1ecfc5a74942e72a48052f1e2aed9eb"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 180, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}