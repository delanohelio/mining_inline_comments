{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxNjY1Mzkx", "number": 1676, "title": "HIVE-24389: Trailing zeros of constant decimal numbers are removed", "bodyText": "What changes were proposed in this pull request?\nIn some case Hive removes trailing zeros of constant decimal numbers\nselect cast(cast(1.1 as decimal(22, 2)) as string), cast(cast(sum(1.1) as decimal(22, 2)) as string)\n1.1\t1.10\n\nPostgres returns 1.10 for both expressions.\nWhy are the changes needed?\nPadding decimal values with trailing zeros is not consistent.\nDoes this PR introduce any user-facing change?\nYes. With this patch Hive will pad constant decimal values with trailing zeros up to the specified scale.\nHow was this patch tested?\n1.Run queries mentioned in the jira.\n2. Added test case to decimal_2.q\n3.\nmvn test -Dtest=TestUDFOPDivide,TestUDFOPMod,TestUDFPosMod,TestGenericUDFOPDivide,TestGenericUDFOPMinus,TestGenericUDFOPMod,TestGenericUDFOPMultiply,TestGenericUDFOPPlus,TestGenericUDFPosMod -pl ql\nmvn test -Dtest=TestHiveDecimal -pl storage-api\nmvn test -Dtest.output.overwrite -DskipSparkTests -Dtest=TestCliDriver -Dqfile=auto_join13.q,auto_join2.q,bucketmapjoin_negative3.q,decimal_6.q,decimal_udf.q,input8.q,num_op_type_conv.q,orc_createas1.q,ppd_constant_expr.q,rcfile_createas1.q,rcfile_merge1.q,rcfile_merge2.q,skewjoin.q,udf_case.q,udf_pmod.q,udf_when.q,vectorization_15.q,vectorization_5.q,vectorization_short_regress.q,vectorized_math_funcs.q,windowing_expressions.q -pl itests/qtest -Pitests\nmvn test -Dtest.output.overwrite -DskipSparkTests -Dtest=TestNegativeCliDriver -Dqfile=,udf_assert_true2.q -pl itests/qtest -Pitests", "createdAt": "2020-11-16T13:31:55Z", "url": "https://github.com/apache/hive/pull/1676", "merged": true, "mergeCommit": {"oid": "aed7c86cdd59f0b2a4979633fbd191d451f2fd75"}, "closed": true, "closedAt": "2020-11-26T14:58:46Z", "author": {"login": "kasakrisz"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddUZoOABqjQwMDM5NjcyNjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgUOBrAFqTUzOTM4MzI3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2bd8a5f6e3230fd57aafb55853e5347452ac7b5e", "author": {"user": {"login": "kasakrisz", "name": "Krisztian Kasa"}}, "url": "https://github.com/apache/hive/commit/2bd8a5f6e3230fd57aafb55853e5347452ac7b5e", "committedDate": "2020-11-16T13:24:10Z", "message": "HIVE-24389: Trailing zeros of constant decimal numbers are removed"}, "afterCommit": {"oid": "9b3b9979f11dc9826d890cdd6246810b1bab7773", "author": {"user": {"login": "kasakrisz", "name": "Krisztian Kasa"}}, "url": "https://github.com/apache/hive/commit/9b3b9979f11dc9826d890cdd6246810b1bab7773", "committedDate": "2020-11-17T07:26:46Z", "message": "HIVE-24389: Trailing zeros of constant decimal numbers are removed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MTMwNDU5", "url": "https://github.com/apache/hive/pull/1676#pullrequestreview-535130459", "createdAt": "2020-11-20T05:46:25Z", "commit": {"oid": "9b3b9979f11dc9826d890cdd6246810b1bab7773"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNTo0NjoyNVrOH2_i9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwNTo0NjoyNVrOH2_i9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQyNjI5Mw==", "bodyText": "Why does precision need to be overridden here (while scale does not)? Could we possibly remove this too?", "url": "https://github.com/apache/hive/pull/1676#discussion_r527426293", "createdAt": "2020-11-20T05:46:25Z", "author": {"login": "jcamachor"}, "path": "serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/primitive/WritableConstantHiveDecimalObjectInspector.java", "diffHunk": "@@ -62,13 +62,4 @@ public int precision() {\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b3b9979f11dc9826d890cdd6246810b1bab7773"}, "originalPosition": 1}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9b3b9979f11dc9826d890cdd6246810b1bab7773", "author": {"user": {"login": "kasakrisz", "name": "Krisztian Kasa"}}, "url": "https://github.com/apache/hive/commit/9b3b9979f11dc9826d890cdd6246810b1bab7773", "committedDate": "2020-11-17T07:26:46Z", "message": "HIVE-24389: Trailing zeros of constant decimal numbers are removed"}, "afterCommit": {"oid": "22c04850a19398cb1b3b1155f329bb83a3abdfdb", "author": {"user": {"login": "kasakrisz", "name": "Krisztian Kasa"}}, "url": "https://github.com/apache/hive/commit/22c04850a19398cb1b3b1155f329bb83a3abdfdb", "committedDate": "2020-11-20T14:56:25Z", "message": "HIVE-24389: Trailing zeros of constant decimal numbers are removed - remove override of precision()"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22c04850a19398cb1b3b1155f329bb83a3abdfdb", "author": {"user": {"login": "kasakrisz", "name": "Krisztian Kasa"}}, "url": "https://github.com/apache/hive/commit/22c04850a19398cb1b3b1155f329bb83a3abdfdb", "committedDate": "2020-11-20T14:56:25Z", "message": "HIVE-24389: Trailing zeros of constant decimal numbers are removed - remove override of precision()"}, "afterCommit": {"oid": "804a1e0327a6bc95d708a8dabf8b7d2ab080c87b", "author": {"user": {"login": "kasakrisz", "name": "Krisztian Kasa"}}, "url": "https://github.com/apache/hive/commit/804a1e0327a6bc95d708a8dabf8b7d2ab080c87b", "committedDate": "2020-11-23T08:50:48Z", "message": "HIVE-24389: Trailing zeros of constant decimal numbers are removed - remove override of precision()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2OTA2MDcx", "url": "https://github.com/apache/hive/pull/1676#pullrequestreview-536906071", "createdAt": "2020-11-23T22:48:30Z", "commit": {"oid": "804a1e0327a6bc95d708a8dabf8b7d2ab080c87b"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMjo0ODozMVrOH4iZ2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMjo1MzoxMlrOH4iiAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA0NTk3Ng==", "bodyText": "Difference in precision and scale for column. Why has this changed?", "url": "https://github.com/apache/hive/pull/1676#discussion_r529045976", "createdAt": "2020-11-23T22:48:31Z", "author": {"login": "jcamachor"}, "path": "ql/src/test/results/clientpositive/llap/materialized_view_rewrite_window.q.out", "diffHunk": "@@ -166,7 +166,7 @@ POSTHOOK: Input: arc_view@wealth\n #### A masked pattern was here ####\n CBO PLAN:\n HiveSortLimit(sort0=[$0], dir0=[ASC])\n-  HiveProject(quartile=[$0], total=[$1])\n+  HiveProject(quartile=[CAST($0):DECIMAL(12, 1)], total=[$1])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "804a1e0327a6bc95d708a8dabf8b7d2ab080c87b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA0NjA1OQ==", "bodyText": "Difference in precision and scale for column. Why has this changed (same below)?", "url": "https://github.com/apache/hive/pull/1676#discussion_r529046059", "createdAt": "2020-11-23T22:48:45Z", "author": {"login": "jcamachor"}, "path": "ql/src/test/results/clientpositive/llap/materialized_view_rewrite_window.q.out", "diffHunk": "@@ -293,24 +293,24 @@ STAGE PLANS:\n                 Statistics: Num rows: 4 Data size: 480 Basic stats: COMPLETE Column stats: COMPLETE\n                 Group By Operator\n                   aggregations: max(_col1)\n-                  keys: _col2 (type: decimal(12,1))\n+                  keys: _col2 (type: decimal(19,4))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "804a1e0327a6bc95d708a8dabf8b7d2ab080c87b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA0NjYzNA==", "bodyText": "Difference in precision and scale for column. Why has this changed?", "url": "https://github.com/apache/hive/pull/1676#discussion_r529046634", "createdAt": "2020-11-23T22:49:57Z", "author": {"login": "jcamachor"}, "path": "ql/src/test/results/clientpositive/llap/metadata_only_queries.q.out", "diffHunk": "@@ -377,7 +377,7 @@ STAGE PLANS:\n                 outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8\n                 Statistics: Num rows: 1 Data size: 520 Basic stats: COMPLETE Column stats: NONE\n                 Select Operator\n-                  expressions: _col0 (type: bigint), '1' (type: string), _col1 (type: bigint), _col2 (type: decimal(11,1)), 2 (type: int), _col0 (type: bigint), _col3 (type: bigint), 7 (type: decimal(2,0)), _col4 (type: bigint), _col5 (type: bigint), _col6 (type: bigint), _col7 (type: int), _col8 (type: bigint)\n+                  expressions: _col0 (type: bigint), '1' (type: string), _col1 (type: bigint), _col2 (type: decimal(11,1)), 2 (type: int), _col0 (type: bigint), _col3 (type: bigint), 7 (type: decimal(11,0)), _col4 (type: bigint), _col5 (type: bigint), _col6 (type: bigint), _col7 (type: int), _col8 (type: bigint)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "804a1e0327a6bc95d708a8dabf8b7d2ab080c87b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA0NzI4OQ==", "bodyText": "Difference in precision and scale for column. Why has this changed?", "url": "https://github.com/apache/hive/pull/1676#discussion_r529047289", "createdAt": "2020-11-23T22:51:26Z", "author": {"login": "jcamachor"}, "path": "ql/src/test/results/clientpositive/llap/vector_cast_constant.q.out", "diffHunk": "@@ -180,7 +180,7 @@ STAGE PLANS:\n                               native: true\n                               nativeConditionsMet: hive.vectorized.execution.reducesink.new.enabled IS true, hive.execution.engine tez IN [tez, spark] IS true, No PTF TopN IS true, No DISTINCT columns IS true, BinarySortableSerDe for keys IS true, LazyBinarySerDe for values IS true\n                           Statistics: Num rows: 257 Data size: 40092 Basic stats: COMPLETE Column stats: COMPLETE\n-                          value expressions: _col1 (type: bigint), _col2 (type: bigint), _col3 (type: double), _col4 (type: bigint), _col5 (type: decimal(12,0)), _col6 (type: bigint)\n+                          value expressions: _col1 (type: bigint), _col2 (type: bigint), _col3 (type: double), _col4 (type: bigint), _col5 (type: decimal(20,0)), _col6 (type: bigint)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "804a1e0327a6bc95d708a8dabf8b7d2ab080c87b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA0ODA2NQ==", "bodyText": "I think this could lead to a change of behavior, e.g., all integers will have same precision by default, but constant integer would have the precision of the constant value?", "url": "https://github.com/apache/hive/pull/1676#discussion_r529048065", "createdAt": "2020-11-23T22:53:12Z", "author": {"login": "jcamachor"}, "path": "serde/src/java/org/apache/hadoop/hive/serde2/objectinspector/primitive/WritableConstantIntObjectInspector.java", "diffHunk": "@@ -46,12 +46,4 @@ public IntWritable getWritableConstantValue() {\n     return value;\n   }\n \n-  @Override\n-  public int precision() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "804a1e0327a6bc95d708a8dabf8b7d2ab080c87b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "922a4a45710b978a34014419a2b498b3c8f5d9aa", "author": {"user": {"login": "kasakrisz", "name": "Krisztian Kasa"}}, "url": "https://github.com/apache/hive/commit/922a4a45710b978a34014419a2b498b3c8f5d9aa", "committedDate": "2020-11-24T05:39:25Z", "message": "HIVE-24389: Trailing zeros of constant decimal numbers are removed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "804a1e0327a6bc95d708a8dabf8b7d2ab080c87b", "author": {"user": {"login": "kasakrisz", "name": "Krisztian Kasa"}}, "url": "https://github.com/apache/hive/commit/804a1e0327a6bc95d708a8dabf8b7d2ab080c87b", "committedDate": "2020-11-23T08:50:48Z", "message": "HIVE-24389: Trailing zeros of constant decimal numbers are removed - remove override of precision()"}, "afterCommit": {"oid": "922a4a45710b978a34014419a2b498b3c8f5d9aa", "author": {"user": {"login": "kasakrisz", "name": "Krisztian Kasa"}}, "url": "https://github.com/apache/hive/commit/922a4a45710b978a34014419a2b498b3c8f5d9aa", "committedDate": "2020-11-24T05:39:25Z", "message": "HIVE-24389: Trailing zeros of constant decimal numbers are removed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM5MzgzMjcx", "url": "https://github.com/apache/hive/pull/1676#pullrequestreview-539383271", "createdAt": "2020-11-26T14:56:14Z", "commit": {"oid": "922a4a45710b978a34014419a2b498b3c8f5d9aa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3045, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}