{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNTEwNDYx", "number": 1797, "title": "HIVE-24541: add config option for default storage handler class", "bodyText": "What changes were proposed in this pull request?\nAdd new config option to set a default storage handler class. If this config is set to a valid, existing class, the storage handler class won't have to be explicitly provided in the create table statement with the STORED BY clause, but will be 'inserted' under the hood.\nFor example, if hive.default.storage.handler.class=org.apache.iceberg.mr.hive.HiveIcebergStorageHandler is set,\nthen the command CREATE TABLE abc (a int, b string) LOCATION ... will be equivalent to\nCREATE TABLE abc (a int, b string) STORED BY 'org.apache.iceberg.mr.hive.HiveIcebergStorageHandler' LOCATION ...\nWhy are the changes needed?\nIn order to use existing create table commands for new table formats, such as Iceberg, without modification.\nDoes this PR introduce any user-facing change?\nnew config option settable via beeline/hive-site\nHow was this patch tested?\nq tests + manually with local run", "createdAt": "2020-12-21T14:17:47Z", "url": "https://github.com/apache/hive/pull/1797", "merged": true, "mergeCommit": {"oid": "e1b19d8fa67d430341433197933a35ac5c165837"}, "closed": true, "closedAt": "2021-01-06T10:26:40Z", "author": {"login": "marton-bod"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdoWjHCAH2gAyNTQzNTEwNDYxOmU3N2RlMDM3ZDExNzI2NmM0ZWM0YzQ3Y2RjMmU3NDJlMGZkNTBmYjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtIgGoAFqTU2MTY4MjU1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e77de037d117266c4ec4c47cdc2e742e0fd50fb8", "author": {"user": {"login": "marton-bod", "name": "Marton Bod"}}, "url": "https://github.com/apache/hive/commit/e77de037d117266c4ec4c47cdc2e742e0fd50fb8", "committedDate": "2020-12-21T14:10:28Z", "message": "HIVE-24541: add config option for default storage handler class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67dce18c254a18f7574899dfb12bd70a39328730", "author": {"user": {"login": "marton-bod", "name": "Marton Bod"}}, "url": "https://github.com/apache/hive/commit/67dce18c254a18f7574899dfb12bd70a39328730", "committedDate": "2021-01-04T08:57:38Z", "message": "Add new q file to test suite prop file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0505241f17e6c4bb8e88cefbfa599ed495c5f98b", "author": {"user": {"login": "marton-bod", "name": "Marton Bod"}}, "url": "https://github.com/apache/hive/commit/0505241f17e6c4bb8e88cefbfa599ed495c5f98b", "committedDate": "2021-01-04T11:54:47Z", "message": "Add log and skip STORED AS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "597652f4586e2ee6183232e095de674e77bd803e", "author": {"user": {"login": "marton-bod", "name": "Marton Bod"}}, "url": "https://github.com/apache/hive/commit/597652f4586e2ee6183232e095de674e77bd803e", "committedDate": "2021-01-04T12:53:21Z", "message": "Add a test case for the stored as skipping"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aff4461bae936b239cd8abe27e73988312c67b9d", "author": {"user": {"login": "marton-bod", "name": "Marton Bod"}}, "url": "https://github.com/apache/hive/commit/aff4461bae936b239cd8abe27e73988312c67b9d", "committedDate": "2021-01-04T13:15:49Z", "message": "Update docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMDQ2ODYz", "url": "https://github.com/apache/hive/pull/1797#pullrequestreview-561046863", "createdAt": "2021-01-04T13:56:42Z", "commit": {"oid": "aff4461bae936b239cd8abe27e73988312c67b9d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMzo1Njo0MlrOINyjlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMzo1Njo0MlrOINyjlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMzMDcwOQ==", "bodyText": "Could be please use underscores to separate names? I understand that the ones before and after are not using them, but currently the underscore is the \"standard\"", "url": "https://github.com/apache/hive/pull/1797#discussion_r551330709", "createdAt": "2021-01-04T13:56:42Z", "author": {"login": "pvary"}, "path": "common/src/java/org/apache/hadoop/hive/conf/HiveConf.java", "diffHunk": "@@ -1991,6 +1991,10 @@ private static void populateLlapDaemonVarsSet(Set<String> llapDaemonVarsSetLocal\n         \"Default file format for CREATE TABLE statement applied to managed tables only. External tables will be \\n\" +\n         \"created with format specified by hive.default.fileformat. Leaving this null will result in using hive.default.fileformat \\n\" +\n         \"for all tables.\"),\n+    HIVEDEFAULTSTORAGEHANDLER(\"hive.default.storage.handler.class\", \"\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aff4461bae936b239cd8abe27e73988312c67b9d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMDQ3NTIz", "url": "https://github.com/apache/hive/pull/1797#pullrequestreview-561047523", "createdAt": "2021-01-04T13:57:36Z", "commit": {"oid": "aff4461bae936b239cd8abe27e73988312c67b9d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMzo1NzozNlrOINyldw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMzo1NzozNlrOINyldw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMzMTE5MQ==", "bodyText": "Maybe log?", "url": "https://github.com/apache/hive/pull/1797#discussion_r551331191", "createdAt": "2021-01-04T13:57:36Z", "author": {"login": "pvary"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/parse/StorageFormat.java", "diffHunk": "@@ -69,6 +69,12 @@ public boolean fillStorageFormat(ASTNode child) throws SemanticException {\n       }\n       break;\n     case HiveParser.TOK_FILEFORMAT_GENERIC:\n+      if (storageHandler != null) {\n+        // Under normal circumstances, we should not get here (since STORED BY and STORED AS are incompatible within the\n+        // same command). Only scenario we can end up here is if a default storage handler class is set in the config.\n+        // In this case, we opt to ignore the STORED AS clause.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aff4461bae936b239cd8abe27e73988312c67b9d"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bb05cb90051d4f50a16936371c43ba0bb5baf4b", "author": {"user": {"login": "marton-bod", "name": "Marton Bod"}}, "url": "https://github.com/apache/hive/commit/1bb05cb90051d4f50a16936371c43ba0bb5baf4b", "committedDate": "2021-01-04T14:42:38Z", "message": "address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxNjgyNTU0", "url": "https://github.com/apache/hive/pull/1797#pullrequestreview-561682554", "createdAt": "2021-01-05T10:38:08Z", "commit": {"oid": "1bb05cb90051d4f50a16936371c43ba0bb5baf4b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2949, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}