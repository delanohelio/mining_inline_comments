{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4MjgzMjMw", "number": 1714, "title": "HIVE-23965: Improve plan regression tests using TPCDS30TB metastore dump and custom configs", "bodyText": "What changes were proposed in this pull request and why?\n\n\nAdd new perf driver, TestTezTPCDS30TBCliDriver, relying on a dockerized metastore.\n\n\nUse Dockerized postgres metastore with TPC-DS 30TB dump\n\n\nRemove old drivers (with and without constraints), related classes\n(e.g., MetastoreDumpUtility), and resources.\n\n\nUse Hive config properties obtained and curated from real-life usages\n\n\nAllow AbstractCliConfig to override metastore DB type\n\n\nRework CorePerfCliDriver to allow pre-initialized metastores\n\n\nRemove redundant logs in System.err. Logging and throwing an exception\nis an anti-pattern.\n\n\nReplace assertions with exceptions and improve the messages.\n\n\nUpgrade postgres JDBC driver to version 42.2.14 to be compatible\nwith the docker image used\n\n\nDisable queries 14 (HIVE-24167), 30 (HIVE-23964)\n\n\nRe-enable CBO plan tests for queries 44, 45, 67, 70, 86\n\n\nThe queries were disabled as part of HIVE-20718. They were supposed to\nbe fixed in Calcite 1.18.0 and currently Hive is in 1.21.0 so it is not\nsurprising that they pass.\n\nAdd missing queries: cbo_query41, cbo_query62, query62\n\nDoes this PR introduce any user-facing change?\nNo, except the fact that old TestTezPerf drivers no longer exist.\nHow was this patch tested?\nmvn test -Dtest=TestTezTPCDS30TBPerfCliDriver", "createdAt": "2020-11-26T22:19:02Z", "url": "https://github.com/apache/hive/pull/1714", "merged": true, "mergeCommit": {"oid": "52cf467836df71485e95b08c9e91e197e9898b79"}, "closed": true, "closedAt": "2020-12-04T12:46:56Z", "author": {"login": "zabetak"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgAo7bgH2gAyNTI4MjgzMjMwOjA1Njc2MTY3Mzc0ZDJlMmUxOWEzNjBlYWNmMWVkZjM0ZTBmMzY1Mjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdijykFAFqTU0Mzk5MTQyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "05676167374d2e2e19a360eacf1edf34e0f36527", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/apache/hive/commit/05676167374d2e2e19a360eacf1edf34e0f36527", "committedDate": "2020-11-25T16:07:31Z", "message": "HIVE-23965: Improve plan regression tests using TPCDS30TB metastore dump and custom configs (Stamatis Zampetakis, reviewed by Zoltan Haindrich)\n\n1. Add new perf driver, TestTezTPCDS30TBCliDriver, relying on a dockerized metastore.\n2. Use Dockerized postgres metastore with TPC-DS 30TB dump\n3. Remove old drivers (with and without constraints), related classes\n(e.g., MetastoreDumpUtility), and resources.\n\nAfter discussion in the JIRA we decided that keeping the old drivers\nis most likely useless.\n\n4. Use Hive config properties obtained and curated from real-life usages\n5. Allow AbstractCliConfig to override metastore DB type\n6. Rework CorePerfCliDriver to allow pre-initialized metastores\n\nRemove system property settings in the initialization of the driver and\nleave in the configuration to set it up if needed. This is necessary to\nbe able to use the driver with a preinitialised metastore.\n\nRemove redundant logs in System.err. Logging and throwing an exception\nis an anti-pattern.\n\nReplace assertions with exceptions and improve the messages.\n\n7. Upgrade postgres JDBC driver to version 42.2.14 to be compatible\nwith the docker image used\n8. Update path to new postgres version in TestBeelineArgParsing\n9. Display plans using hive.explain.user set to false which seems\nto be preferrable for performing a diff and checking regressions\n\n10. Disable queries 14 (HIVE-24167), 30 (HIVE-23964)\n11. Re-enable CBO plan tests for queries 44, 45, 67, 70, 86\n\nThe queries were disabled as part of HIVE-20718. They were supposed to\nbe fixed in Calcite 1.18.0 and currently Hive is in 1.21.0 so it is not\nsurprising that they pass.\n\n12. Add missing queries: cbo_query41, cbo_query62, query62\n\nCloses apache/hive#1347"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df6e610c7f7b11b0bf06b500b25613c1a811c055", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/apache/hive/commit/df6e610c7f7b11b0bf06b500b25613c1a811c055", "committedDate": "2020-11-26T22:10:12Z", "message": "HIVE-23965: Support metastore schema upgrades without image rebuilds\n\nIncorporate the logic for upgrading the dockerized metastore inside\nPostgresTPCDS rule to avoid the need for rebuilding the respective\nDocker image every time there is change in the metastore schema on\nmaster.\n\nBump the image version to 1.2 providing a metastore schema at version\n3.1.3000 (and not an already partially upgraded 4.0.0 as before)."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzOTkxNDIz", "url": "https://github.com/apache/hive/pull/1714#pullrequestreview-543991423", "createdAt": "2020-12-03T14:12:33Z", "commit": {"oid": "df6e610c7f7b11b0bf06b500b25613c1a811c055"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNDoxMjozM1rOH-dmgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNDoxMjozM1rOH-dmgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI1ODc1NA==", "bodyText": "@zabetak qq: will this file be maintained  from now on parallel with upgrade-3.2.0-to-4.0.0.postgres.sql ? Is this needed for upstream?", "url": "https://github.com/apache/hive/pull/1714#discussion_r535258754", "createdAt": "2020-12-03T14:12:33Z", "author": {"login": "pvargacl"}, "path": "standalone-metastore/metastore-server/src/test/resources/sql/postgres/upgrade-3.1.3000-to-4.0.0.postgres.sql", "diffHunk": "@@ -0,0 +1,77 @@\n+-- The file has some overlapping with upgrade-3.2.0-to-4.0.0.postgres.sql\n+SELECT 'Upgrading MetaStore schema from 3.1.3000 to 4.0.0';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df6e610c7f7b11b0bf06b500b25613c1a811c055"}, "originalPosition": 2}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2827, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}