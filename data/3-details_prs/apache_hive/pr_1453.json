{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MTg2MTY0", "number": 1453, "title": "HIVE-24104: NPE due to null key columns in ReduceSink after deduplication", "bodyText": "What changes were proposed in this pull request?\nRemove double backtracking of columns inside ReduceSinkDeDuplicationUtils#ggressiveDedup.\nWhy are the changes needed?\nTo prevent NPE during planning or execution. Examples in the JIRA case.\nDoes this PR introduce any user-facing change?\nChanges in the EXPLAIN plans but probably for the best.\nHow was this patch tested?\nmvn test -Dtest=TestMiniLlapLocalCliDriver -Dqfile=reduce_deduplicate_null_keys.q", "createdAt": "2020-09-01T16:05:20Z", "url": "https://github.com/apache/hive/pull/1453", "merged": true, "mergeCommit": {"oid": "4a90b9de02cf73f684687c21948f56080f3415ff"}, "closed": true, "closedAt": "2020-09-07T10:49:58Z", "author": {"login": "zabetak"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEpmtJgH2gAyNDc3MTg2MTY0OjZjZGNiMTAwODY5Y2UwZTdiNzQwZjkyN2IzYTFlYjdiYWY0OGQyNDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFLnPAAFqTQ4MTU3MzA1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6cdcb100869ce0e7b740f927b3a1eb7baf48d241", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/apache/hive/commit/6cdcb100869ce0e7b740f927b3a1eb7baf48d241", "committedDate": "2020-09-01T16:01:19Z", "message": "HIVE-24104: NPE due to null key columns in ReduceSink after deduplication\n\n1. Remove double backtracking of columns inside\nReduceSinkDeDuplicationUtils#ggressiveDedup.\n\n2. Add unit test reproducing the problem (throwing NPE at runtime)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c1c58f78be4738ad2ac865a09b8ac4a6012e930", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/apache/hive/commit/4c1c58f78be4738ad2ac865a09b8ac4a6012e930", "committedDate": "2020-09-02T12:41:15Z", "message": "HIVE-24112: Disable flaky test dynamic_semijoin_reduction_on_aggcol.q"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a89277fa9bb359e0fbf190fff36b9b6ebb76f90", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/apache/hive/commit/1a89277fa9bb359e0fbf190fff36b9b6ebb76f90", "committedDate": "2020-09-02T13:05:23Z", "message": "HIVE-24104: Add assertions to prevent null columns in ReduceSinkDesc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNTY1MTU2", "url": "https://github.com/apache/hive/pull/1453#pullrequestreview-481565156", "createdAt": "2020-09-03T07:27:13Z", "commit": {"oid": "1a89277fa9bb359e0fbf190fff36b9b6ebb76f90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzoyNzoxNFrOHMZlbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzoyNzoxNFrOHMZlbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc2NDE0Mg==", "bodyText": "I've just saw another PR failing with this test as well - please ping me somehow to get things like this in sooner than later\nI think another option could be to open a ticketless PR to merge in the disablement of the tests; with that it will only need 1 click from a committer (and it can be even done from phone as well)", "url": "https://github.com/apache/hive/pull/1453#discussion_r482764142", "createdAt": "2020-09-03T07:27:14Z", "author": {"login": "kgyrtkirk"}, "path": "ql/src/test/queries/clientpositive/dynamic_semijoin_reduction_on_aggcol.q", "diffHunk": "@@ -1,3 +1,4 @@\n+--! qt:disabled:flaky HIVE-24112", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a89277fa9bb359e0fbf190fff36b9b6ebb76f90"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNTczMDUx", "url": "https://github.com/apache/hive/pull/1453#pullrequestreview-481573051", "createdAt": "2020-09-03T07:38:07Z", "commit": {"oid": "1a89277fa9bb359e0fbf190fff36b9b6ebb76f90"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzozODowN1rOHMZ-Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwNzozODowN1rOHMZ-Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc3MDQzOQ==", "bodyText": "this seems to be a 3 year old typo; I wonder why it didn't surfaced earlier", "url": "https://github.com/apache/hive/pull/1453#discussion_r482770439", "createdAt": "2020-09-03T07:38:07Z", "author": {"login": "kgyrtkirk"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/ReduceSinkDeDuplicationUtils.java", "diffHunk": "@@ -570,7 +570,7 @@ protected static boolean aggressiveDedup(ReduceSinkOperator cRS, ReduceSinkOpera\n         return false;\n       }\n     }\n-    cRS.getConf().setKeyCols(ExprNodeDescUtils.backtrack(cKeysInParentRS, cRS, pRS));\n+    cRS.getConf().setKeyCols(cKeysInParentRS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a89277fa9bb359e0fbf190fff36b9b6ebb76f90"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3270, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}