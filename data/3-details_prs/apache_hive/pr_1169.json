{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4NTcwNzU0", "number": 1169, "title": "HIVE-20447: Add JSON Output Format to beeline", "bodyText": "Mostly ported from SQLLine with a change to how characters are escaped. I want to note that SQLLine uses JsonOutputFormat rather than JSON..., but that project also uses Xml and this one uses XML... so I went with all caps for internal-consistency.\nAlso added .vscode directory to .gitignore and apache-rat exclude, let me know if this should be submitted as a separate trivial update.", "createdAt": "2020-06-23T13:26:53Z", "url": "https://github.com/apache/hive/pull/1169", "merged": true, "mergeCommit": {"oid": "e56a775c38732da5928c0f6555dc167b5a6d1fa7"}, "closed": true, "closedAt": "2020-07-21T13:10:47Z", "author": {"login": "HunterL"}, "timelineItems": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvERtOgBqjM0ODY4ODczNjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc2xxASAFqTQ1MTYxMTg5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ff47e14bc3a91a2e7282f54060043fd6d447565d", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/ff47e14bc3a91a2e7282f54060043fd6d447565d", "committedDate": "2020-06-26T14:38:21Z", "message": "Fixed null values being printed as \"NULL\""}, "afterCommit": {"oid": "1b646676998b6305832aff1456b49082dc3c5dd3", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/1b646676998b6305832aff1456b49082dc3c5dd3", "committedDate": "2020-06-26T14:39:18Z", "message": "Fixed null values being printed as \"NULL\""}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwODM5ODE0", "url": "https://github.com/apache/hive/pull/1169#pullrequestreview-440839814", "createdAt": "2020-07-01T12:52:25Z", "commit": {"oid": "1b646676998b6305832aff1456b49082dc3c5dd3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjo1MjoyNVrOGrklbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxMjo1Mzo0M1rOGrkoFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0MTM1OA==", "bodyText": "Since this has nothing to do with JSON formatting in beeline, save it for another JIRA.", "url": "https://github.com/apache/hive/pull/1169#discussion_r448341358", "createdAt": "2020-07-01T12:52:25Z", "author": {"login": "belugabehr"}, "path": "pom.xml", "diffHunk": "@@ -1486,6 +1486,7 @@\n       <exclude>**/patchprocess/**</exclude>\n       <exclude>**/metastore_db/**</exclude>\n       <exclude>**/test/resources/**/*.ldif</exclude>\n+      <exclude>.vscode/**</exclude>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b646676998b6305832aff1456b49082dc3c5dd3"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0MTQzMg==", "bodyText": "Add a new line to end of file", "url": "https://github.com/apache/hive/pull/1169#discussion_r448341432", "createdAt": "2020-07-01T12:52:33Z", "author": {"login": "belugabehr"}, "path": "beeline/src/test/org/apache/hive/beeline/TestJSONOutputFormat.java", "diffHunk": "@@ -0,0 +1,137 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hive.beeline;\n+\n+import static org.mockito.ArgumentMatchers.anyInt;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.mockito.invocation.InvocationOnMock;\n+import org.mockito.stubbing.Answer;\n+\n+import java.io.PrintStream;\n+import java.sql.ResultSet;\n+import java.sql.ResultSetMetaData;\n+import java.sql.SQLException;\n+import java.sql.Types;\n+import java.util.ArrayList;\n+\n+import static org.junit.Assert.assertArrayEquals;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+public class TestJSONOutputFormat {\n+\n+  private final Object[][] mockRowData = {\n+      {\"aaa\", true, null, Double.valueOf(3.14), \"\\\\/\\b\\f\\n\\r\\t\"}\n+  };\n+  private TestJSONOutputFormat.BeelineMock mockBeeline;\n+  private ResultSet mockResultSet;\n+  private MockRow mockRow;\n+\n+  @Before\n+  public void setupMockData() throws SQLException {\n+    mockBeeline = new TestJSONOutputFormat.BeelineMock();\n+    mockResultSet = mock(ResultSet.class);\n+\n+    ResultSetMetaData mockResultSetMetaData = mock(ResultSetMetaData.class);\n+    when(mockResultSetMetaData.getColumnCount()).thenReturn(5);\n+    when(mockResultSetMetaData.getColumnLabel(1)).thenReturn(\"string\");\n+    when(mockResultSetMetaData.getColumnLabel(2)).thenReturn(\"boolean\");\n+    when(mockResultSetMetaData.getColumnLabel(3)).thenReturn(\"null\");\n+    when(mockResultSetMetaData.getColumnLabel(4)).thenReturn(\"double\");\n+    when(mockResultSetMetaData.getColumnLabel(5)).thenReturn(\"special symbols\");\n+    when(mockResultSetMetaData.getColumnType(1)).thenReturn(Types.VARCHAR);\n+    when(mockResultSetMetaData.getColumnType(2)).thenReturn(Types.BOOLEAN);\n+    when(mockResultSetMetaData.getColumnType(3)).thenReturn(Types.NULL);\n+    when(mockResultSetMetaData.getColumnType(4)).thenReturn(Types.DOUBLE);\n+    when(mockResultSetMetaData.getColumnType(5)).thenReturn(Types.VARCHAR);\n+    when(mockResultSet.getMetaData()).thenReturn(mockResultSetMetaData);\n+\n+    mockRow = new MockRow();\n+    // returns true as long as there is more data in mockResultData array\n+    when(mockResultSet.next()).thenAnswer(new Answer<Boolean>() {\n+      private int mockRowDataIndex = 0;\n+\n+      @Override\n+      public Boolean answer(final InvocationOnMock invocation) {\n+        if (mockRowDataIndex < mockRowData.length) {\n+          mockRow.setCurrentRowData(mockRowData[mockRowDataIndex]);\n+          mockRowDataIndex++;\n+          return true;\n+        } else {\n+          return false;\n+        }\n+      }\n+    });\n+\n+    when(mockResultSet.getObject(anyInt())).thenAnswer(new Answer<Object>() {\n+      @Override\n+      public Object answer(final InvocationOnMock invocation) {\n+        Object[] args = invocation.getArguments();\n+        int index = ((Integer) args[0]);\n+        return mockRow.getColumn(index);\n+      }\n+    });\n+  }\n+\n+  /**\n+   * Test printing output data with JsonOutputFormat\n+   */\n+  @Test\n+  public final void testPrint() throws SQLException {\n+    setupMockData();\n+    BufferedRows bfRows = new BufferedRows(mockBeeline, mockResultSet);\n+    JSONOutputFormat instance = new JSONOutputFormat(mockBeeline);\n+    instance.print(bfRows);\n+    ArrayList<String> actualOutput = mockBeeline.getLines();\n+    ArrayList<String> expectedOutput = new ArrayList<>(6);\n+    expectedOutput.add(\"{\\\"resultset\\\":[\");\n+    expectedOutput.add(\"{\\\"string\\\":\\\"aaa\\\",\" + \"\\\"boolean\\\":true,\" + \"\\\"null\\\":null,\" + \"\\\"double\\\":3.14,\"\n+        + \"\\\"special symbols\\\":\\\"\\\\\\\\\\\\/\\\\b\\\\f\\\\n\\\\r\\\\t\\\"}\");\n+    expectedOutput.add(\"]}\");\n+    assertArrayEquals(expectedOutput.toArray(), actualOutput.toArray());\n+  }\n+\n+  public class BeelineMock extends BeeLine {\n+\n+    private ArrayList<String> lines = new ArrayList<>();\n+\n+    @Override\n+    final void output(final ColorBuffer msg, boolean newline, PrintStream out) {\n+      lines.add(msg.getMono());\n+      super.output(msg, newline, out);\n+    }\n+\n+    private ArrayList<String> getLines() {\n+      return lines;\n+    }\n+  }\n+\n+  static class MockRow {\n+    Object[] rowData;\n+\n+    public void setCurrentRowData(Object[] rowData) {\n+      this.rowData = rowData;\n+    }\n+\n+    public Object getColumn(int idx) {\n+      return rowData[idx - 1];\n+    }\n+  }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b646676998b6305832aff1456b49082dc3c5dd3"}, "originalPosition": 137}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0MTg2Nw==", "bodyText": "Take a look at this:\nhttps://fasterxml.github.io/jackson-core/javadoc/2.8/com/fasterxml/jackson/core/JsonGenerator.html\nPlease use the Jackson JSON generator to... generate JSON. :)", "url": "https://github.com/apache/hive/pull/1169#discussion_r448341867", "createdAt": "2020-07-01T12:53:21Z", "author": {"login": "belugabehr"}, "path": "beeline/src/java/org/apache/hive/beeline/JSONOutputFormat.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+ * This source file is based on code taken from SQLLine 1.9\n+ * See SQLLine notice in LICENSE\n+ */\n+package org.apache.hive.beeline;\n+\n+import java.sql.SQLException;\n+import java.sql.Types;\n+\n+import com.fasterxml.jackson.core.io.JsonStringEncoder;\n+\n+/**\n+ * OutputFormat for standard JSON format.\n+ *\n+ */ \n+public class JSONOutputFormat extends AbstractOutputFormat {\n+  private final BeeLine beeLine;\n+  private int[] columnTypes;\n+  private JsonStringEncoder jse = JsonStringEncoder.getInstance();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b646676998b6305832aff1456b49082dc3c5dd3"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM0MjAzNw==", "bodyText": "Add this in a separate JIRA", "url": "https://github.com/apache/hive/pull/1169#discussion_r448342037", "createdAt": "2020-07-01T12:53:43Z", "author": {"login": "belugabehr"}, "path": ".gitignore", "diffHunk": "@@ -38,3 +38,4 @@ standalone-metastore/metastore-server/src/gen/version\n launch.json\n settings.json\n kafka-handler/src/test/gen\n+.vscode/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b646676998b6305832aff1456b49082dc3c5dd3"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0ODI5NjQ0", "url": "https://github.com/apache/hive/pull/1169#pullrequestreview-444829644", "createdAt": "2020-07-08T14:34:50Z", "commit": {"oid": "55ce6341e5853a837d1bfa03354b0a5320edbd39"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDozNDo1MVrOGurGUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNDo0OToyMFrOGurwGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU5MzgwOQ==", "bodyText": "Nit: The Hive style guidelines require a period at the end of the first sentence here.\nPlease provide an example and provide some additional context... something like...\nThis output format matches the same format as a Hive table created with JSONFILE file format:\n\nCREATE TABLE ... STORED AS JSONFILE;\n\nThen provide a sample output in the JavaDoc.  Feel free to use HTML tags and JavaDoc docs to format and enhance.", "url": "https://github.com/apache/hive/pull/1169#discussion_r451593809", "createdAt": "2020-07-08T14:34:51Z", "author": {"login": "belugabehr"}, "path": "beeline/src/java/org/apache/hive/beeline/JSONFileOutputFormat.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+ * This source file is based on code taken from SQLLine 1.9\n+ * See SQLLine notice in LICENSE\n+ */\n+package org.apache.hive.beeline;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.core.util.MinimalPrettyPrinter;\n+\n+/**\n+ * OutputFormat for hive JSON file format\n+ * Removes \"{ \"resultset\": [...] }\" wrapping and prints one object per line\n+ * ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55ce6341e5853a837d1bfa03354b0a5320edbd39"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU5OTQwOQ==", "bodyText": "Add newline to end of files :)", "url": "https://github.com/apache/hive/pull/1169#discussion_r451599409", "createdAt": "2020-07-08T14:42:24Z", "author": {"login": "belugabehr"}, "path": "beeline/src/java/org/apache/hive/beeline/JSONFileOutputFormat.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+ * This source file is based on code taken from SQLLine 1.9\n+ * See SQLLine notice in LICENSE\n+ */\n+package org.apache.hive.beeline;\n+\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.core.util.MinimalPrettyPrinter;\n+\n+/**\n+ * OutputFormat for hive JSON file format\n+ * Removes \"{ \"resultset\": [...] }\" wrapping and prints one object per line\n+ * \n+ */ \n+public class JSONFileOutputFormat extends JSONOutputFormat {\n+  \n+\n+  JSONFileOutputFormat(BeeLine beeLine) {\n+    super(beeLine);\n+    this.generator.setPrettyPrinter(new MinimalPrettyPrinter(\"\\n\"));\n+  }\n+\n+  @Override\n+  void printHeader(Rows.Row header) {}\n+\n+  @Override\n+  void printFooter(Rows.Row header) {}\n+\n+  @Override\n+  void printRow(Rows rows, Rows.Row header, Rows.Row row) {\n+    try {\n+      this.generator.writeStartObject();\n+      super.printRow(rows, header, row);\n+      this.generator.writeEndObject();\n+    } catch (IOException e) {\n+      this.beeLine.handleException(e);\n+    }\n+  }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55ce6341e5853a837d1bfa03354b0a5320edbd39"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYwMDE0MA==", "bodyText": "I'm a bit surprised by this.  Why does this not write a startObject/endObject per row?", "url": "https://github.com/apache/hive/pull/1169#discussion_r451600140", "createdAt": "2020-07-08T14:43:22Z", "author": {"login": "belugabehr"}, "path": "beeline/src/java/org/apache/hive/beeline/JSONOutputFormat.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+ * This source file is based on code taken from SQLLine 1.9\n+ * See SQLLine notice in LICENSE\n+ */\n+package org.apache.hive.beeline;\n+\n+import java.sql.SQLException;\n+import java.sql.Types;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.core.JsonEncoding;\n+import com.fasterxml.jackson.core.JsonFactory;\n+import com.fasterxml.jackson.core.JsonGenerator;\n+\n+/**\n+ * OutputFormat for standard JSON format.\n+ *\n+ */ \n+public class JSONOutputFormat extends AbstractOutputFormat {\n+  protected final BeeLine beeLine;\n+  protected JsonGenerator generator;\n+  \n+\n+  /**\n+   * @param beeLine\n+   */\n+  JSONOutputFormat(BeeLine beeLine){ \n+    this.beeLine = beeLine;\n+    ByteArrayOutputStream buf = new ByteArrayOutputStream();\n+    try{\n+      this.generator = new JsonFactory().createGenerator(buf, JsonEncoding.UTF8);\n+    }catch(IOException e){\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printHeader(Rows.Row header) {\n+    try {\n+      generator.writeStartObject();\n+      generator.writeArrayFieldStart(\"resultset\");\n+    } catch (IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printFooter(Rows.Row header) {\n+    try {\n+      generator.writeEndArray();\n+      generator.writeEndObject();\n+      beeLine.output(generator.getOutputTarget().toString());\n+      generator.flush();\n+    } catch (IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printRow(Rows rows, Rows.Row header, Rows.Row row) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55ce6341e5853a837d1bfa03354b0a5320edbd39"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYwMDYxMQ==", "bodyText": "Needs jsonfile as well", "url": "https://github.com/apache/hive/pull/1169#discussion_r451600611", "createdAt": "2020-07-08T14:44:01Z", "author": {"login": "belugabehr"}, "path": "beeline/src/main/resources/BeeLine.properties", "diffHunk": "@@ -194,7 +194,7 @@ cmd-usage: Usage: java org.apache.hive.cli.beeline.BeeLine \\n \\\n \\  --silent=[true/false]           be more silent\\n \\\n \\  --report=[true/false]           show number of rows and execution time after query execution\\n \\\n \\  --autosave=[true/false]         automatically save preferences\\n \\\n-\\  --outputformat=[table/vertical/csv2/tsv2/dsv/csv/tsv]  format mode for result display\\n \\\n+\\  --outputformat=[table/vertical/csv2/tsv2/dsv/csv/tsv/json]  format mode for result display\\n \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55ce6341e5853a837d1bfa03354b0a5320edbd39"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYwMzcwMg==", "bodyText": "Typically you want to flush the object to the underlying stream (ByteArrayOutputStream in this case) in case the object is doing any kind of internal buffering in order to \"flush\" its content out.\nWhile your beeLine.output is technically correct.  It's a bit confusing to other coders.\nOrder of operations should be:\n\nFlush the generator to clear any buffering into the target OutputStream\nConvert the OutputStream into the target output format (String in this situation)\nPlease use a new String() with UTF-8 encoding explicitly specified here\n\nhttps://docs.oracle.com/javase/8/docs/api/java/lang/String.html#String-byte:A-java.nio.charset.Charset-", "url": "https://github.com/apache/hive/pull/1169#discussion_r451603702", "createdAt": "2020-07-08T14:48:16Z", "author": {"login": "belugabehr"}, "path": "beeline/src/java/org/apache/hive/beeline/JSONOutputFormat.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+ * This source file is based on code taken from SQLLine 1.9\n+ * See SQLLine notice in LICENSE\n+ */\n+package org.apache.hive.beeline;\n+\n+import java.sql.SQLException;\n+import java.sql.Types;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.core.JsonEncoding;\n+import com.fasterxml.jackson.core.JsonFactory;\n+import com.fasterxml.jackson.core.JsonGenerator;\n+\n+/**\n+ * OutputFormat for standard JSON format.\n+ *\n+ */ \n+public class JSONOutputFormat extends AbstractOutputFormat {\n+  protected final BeeLine beeLine;\n+  protected JsonGenerator generator;\n+  \n+\n+  /**\n+   * @param beeLine\n+   */\n+  JSONOutputFormat(BeeLine beeLine){ \n+    this.beeLine = beeLine;\n+    ByteArrayOutputStream buf = new ByteArrayOutputStream();\n+    try{\n+      this.generator = new JsonFactory().createGenerator(buf, JsonEncoding.UTF8);\n+    }catch(IOException e){\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printHeader(Rows.Row header) {\n+    try {\n+      generator.writeStartObject();\n+      generator.writeArrayFieldStart(\"resultset\");\n+    } catch (IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printFooter(Rows.Row header) {\n+    try {\n+      generator.writeEndArray();\n+      generator.writeEndObject();\n+      beeLine.output(generator.getOutputTarget().toString());\n+      generator.flush();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55ce6341e5853a837d1bfa03354b0a5320edbd39"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYwNDUwNw==", "bodyText": "Nit: formatting issue", "url": "https://github.com/apache/hive/pull/1169#discussion_r451604507", "createdAt": "2020-07-08T14:49:20Z", "author": {"login": "belugabehr"}, "path": "beeline/src/java/org/apache/hive/beeline/JSONOutputFormat.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+ * This source file is based on code taken from SQLLine 1.9\n+ * See SQLLine notice in LICENSE\n+ */\n+package org.apache.hive.beeline;\n+\n+import java.sql.SQLException;\n+import java.sql.Types;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.core.JsonEncoding;\n+import com.fasterxml.jackson.core.JsonFactory;\n+import com.fasterxml.jackson.core.JsonGenerator;\n+\n+/**\n+ * OutputFormat for standard JSON format.\n+ *\n+ */ \n+public class JSONOutputFormat extends AbstractOutputFormat {\n+  protected final BeeLine beeLine;\n+  protected JsonGenerator generator;\n+  \n+\n+  /**\n+   * @param beeLine\n+   */\n+  JSONOutputFormat(BeeLine beeLine){ \n+    this.beeLine = beeLine;\n+    ByteArrayOutputStream buf = new ByteArrayOutputStream();\n+    try{\n+      this.generator = new JsonFactory().createGenerator(buf, JsonEncoding.UTF8);\n+    }catch(IOException e){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55ce6341e5853a837d1bfa03354b0a5320edbd39"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0ODYxMDUw", "url": "https://github.com/apache/hive/pull/1169#pullrequestreview-444861050", "createdAt": "2020-07-08T15:06:39Z", "commit": {"oid": "55ce6341e5853a837d1bfa03354b0a5320edbd39"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNTowNjozOVrOGusi5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxNTowNjozOVrOGusi5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYxNzUwOA==", "bodyText": "Take a look at using Boolean#parse instead:\nhttps://docs.oracle.com/javase/8/docs/api/java/lang/Boolean.html#parseBoolean-java.lang.String-", "url": "https://github.com/apache/hive/pull/1169#discussion_r451617508", "createdAt": "2020-07-08T15:06:39Z", "author": {"login": "belugabehr"}, "path": "beeline/src/java/org/apache/hive/beeline/JSONOutputFormat.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+ * This source file is based on code taken from SQLLine 1.9\n+ * See SQLLine notice in LICENSE\n+ */\n+package org.apache.hive.beeline;\n+\n+import java.sql.SQLException;\n+import java.sql.Types;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.core.JsonEncoding;\n+import com.fasterxml.jackson.core.JsonFactory;\n+import com.fasterxml.jackson.core.JsonGenerator;\n+\n+/**\n+ * OutputFormat for standard JSON format.\n+ *\n+ */ \n+public class JSONOutputFormat extends AbstractOutputFormat {\n+  protected final BeeLine beeLine;\n+  protected JsonGenerator generator;\n+  \n+\n+  /**\n+   * @param beeLine\n+   */\n+  JSONOutputFormat(BeeLine beeLine){ \n+    this.beeLine = beeLine;\n+    ByteArrayOutputStream buf = new ByteArrayOutputStream();\n+    try{\n+      this.generator = new JsonFactory().createGenerator(buf, JsonEncoding.UTF8);\n+    }catch(IOException e){\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printHeader(Rows.Row header) {\n+    try {\n+      generator.writeStartObject();\n+      generator.writeArrayFieldStart(\"resultset\");\n+    } catch (IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printFooter(Rows.Row header) {\n+    try {\n+      generator.writeEndArray();\n+      generator.writeEndObject();\n+      beeLine.output(generator.getOutputTarget().toString());\n+      generator.flush();\n+    } catch (IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printRow(Rows rows, Rows.Row header, Rows.Row row) {\n+    String[] head = header.values;\n+    String[] vals = row.values;\n+    try{\n+      for (int i = 0; (i < head.length) && (i < vals.length); i++) {\n+        generator.writeFieldName(head[i]);\n+        switch(rows.rsMeta.getColumnType(i)) {\n+          case Types.TINYINT:\n+          case Types.SMALLINT:\n+          case Types.INTEGER:\n+          case Types.BIGINT:\n+          case Types.REAL:\n+          case Types.FLOAT:\n+          case Types.DOUBLE:\n+          case Types.DECIMAL:\n+          case Types.NUMERIC:\n+            generator.writeNumber(vals[i]);\n+            break;\n+          case Types.NULL:\n+            generator.writeNull();\n+            break;\n+          case Types.BOOLEAN:\n+            generator.writeBoolean(vals[i].equalsIgnoreCase(\"true\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55ce6341e5853a837d1bfa03354b0a5320edbd39"}, "originalPosition": 101}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MzM2MTQ1", "url": "https://github.com/apache/hive/pull/1169#pullrequestreview-448336145", "createdAt": "2020-07-14T17:55:39Z", "commit": {"oid": "7eda09b6f58f83fe9e5ecea9bdec2148026e8dbc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNzo1NTo0MFrOGxe4Sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNzo1NTo0MFrOGxe4Sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUzOTMzOA==", "bodyText": "Check out StandardCharsets.UTF_8.  It's not a requirement that all JVMs support UTF-8.\nhttps://docs.oracle.com/javase/7/docs/api/java/nio/charset/StandardCharsets.html", "url": "https://github.com/apache/hive/pull/1169#discussion_r454539338", "createdAt": "2020-07-14T17:55:40Z", "author": {"login": "belugabehr"}, "path": "beeline/src/java/org/apache/hive/beeline/JSONOutputFormat.java", "diffHunk": "@@ -0,0 +1,129 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+ * This source file is based on code taken from SQLLine 1.9\n+ * See SQLLine notice in LICENSE\n+ */\n+package org.apache.hive.beeline;\n+\n+import java.sql.SQLException;\n+import java.sql.Types;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.core.JsonEncoding;\n+import com.fasterxml.jackson.core.JsonFactory;\n+import com.fasterxml.jackson.core.JsonGenerator;\n+\n+/**\n+ * OutputFormat for standard JSON format.\n+ * \n+ */ \n+public class JSONOutputFormat extends AbstractOutputFormat {\n+  protected final BeeLine beeLine;\n+  protected JsonGenerator generator;\n+  \n+\n+  /**\n+   * @param beeLine\n+   */\n+  JSONOutputFormat(BeeLine beeLine){ \n+    this.beeLine = beeLine;\n+    ByteArrayOutputStream buf = new ByteArrayOutputStream();\n+    try {\n+      this.generator = new JsonFactory().createGenerator(buf, JsonEncoding.UTF8);\n+    } catch(IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printHeader(Rows.Row header) {\n+    try {\n+      generator.writeStartObject();\n+      generator.writeArrayFieldStart(\"resultset\");\n+    } catch(IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printFooter(Rows.Row header) {\n+    try {\n+      generator.writeEndArray();\n+      generator.writeEndObject();\n+      generator.flush();\n+      String out = ((ByteArrayOutputStream) generator.getOutputTarget()).toString(\"UTF-8\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7eda09b6f58f83fe9e5ecea9bdec2148026e8dbc"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MzM4Njk2", "url": "https://github.com/apache/hive/pull/1169#pullrequestreview-448338696", "createdAt": "2020-07-14T17:58:59Z", "commit": {"oid": "7eda09b6f58f83fe9e5ecea9bdec2148026e8dbc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNzo1OTowMFrOGxfAMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNzo1OTowMFrOGxfAMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU0MTM2Mg==", "bodyText": "This looks a bit suspect to me.  Should be able to just put one of these before the loop and the corresponding writeEndObject after the loop.\nfinal int printCount = Math.min(colCount, Math.min(head.length, vals.length));\ngenerator.writeStartObject();\nfor (int i = 0; i < printCount; i++) {\n    ...\n}\ngenerator.writeEndObject();", "url": "https://github.com/apache/hive/pull/1169#discussion_r454541362", "createdAt": "2020-07-14T17:59:00Z", "author": {"login": "belugabehr"}, "path": "beeline/src/java/org/apache/hive/beeline/JSONOutputFormat.java", "diffHunk": "@@ -0,0 +1,129 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+ * This source file is based on code taken from SQLLine 1.9\n+ * See SQLLine notice in LICENSE\n+ */\n+package org.apache.hive.beeline;\n+\n+import java.sql.SQLException;\n+import java.sql.Types;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.core.JsonEncoding;\n+import com.fasterxml.jackson.core.JsonFactory;\n+import com.fasterxml.jackson.core.JsonGenerator;\n+\n+/**\n+ * OutputFormat for standard JSON format.\n+ * \n+ */ \n+public class JSONOutputFormat extends AbstractOutputFormat {\n+  protected final BeeLine beeLine;\n+  protected JsonGenerator generator;\n+  \n+\n+  /**\n+   * @param beeLine\n+   */\n+  JSONOutputFormat(BeeLine beeLine){ \n+    this.beeLine = beeLine;\n+    ByteArrayOutputStream buf = new ByteArrayOutputStream();\n+    try {\n+      this.generator = new JsonFactory().createGenerator(buf, JsonEncoding.UTF8);\n+    } catch(IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printHeader(Rows.Row header) {\n+    try {\n+      generator.writeStartObject();\n+      generator.writeArrayFieldStart(\"resultset\");\n+    } catch(IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printFooter(Rows.Row header) {\n+    try {\n+      generator.writeEndArray();\n+      generator.writeEndObject();\n+      generator.flush();\n+      String out = ((ByteArrayOutputStream) generator.getOutputTarget()).toString(\"UTF-8\");\n+      beeLine.output(out);\n+    } catch(IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printRow(Rows rows, Rows.Row header, Rows.Row row) {\n+    String[] head = header.values;\n+    String[] vals = row.values;\n+    \n+    try {\n+      int colCount = rows.rsMeta.getColumnCount();\n+      boolean objStartFlag = true;\n+\n+      for (int i = 0; (i < head.length) && (i < vals.length); i++) {\n+        if (objStartFlag) {\n+          generator.writeStartObject();\n+          objStartFlag = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7eda09b6f58f83fe9e5ecea9bdec2148026e8dbc"}, "originalPosition": 91}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MzM5MzA1", "url": "https://github.com/apache/hive/pull/1169#pullrequestreview-448339305", "createdAt": "2020-07-14T17:59:50Z", "commit": {"oid": "7eda09b6f58f83fe9e5ecea9bdec2148026e8dbc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNzo1OTo1MFrOGxfCUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNzo1OTo1MFrOGxfCUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU0MTkwNQ==", "bodyText": "Need a type for BINARY data.  Make it spit it out as Base-64 to be text-friendly.", "url": "https://github.com/apache/hive/pull/1169#discussion_r454541905", "createdAt": "2020-07-14T17:59:50Z", "author": {"login": "belugabehr"}, "path": "beeline/src/java/org/apache/hive/beeline/JSONOutputFormat.java", "diffHunk": "@@ -0,0 +1,129 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+ * This source file is based on code taken from SQLLine 1.9\n+ * See SQLLine notice in LICENSE\n+ */\n+package org.apache.hive.beeline;\n+\n+import java.sql.SQLException;\n+import java.sql.Types;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.core.JsonEncoding;\n+import com.fasterxml.jackson.core.JsonFactory;\n+import com.fasterxml.jackson.core.JsonGenerator;\n+\n+/**\n+ * OutputFormat for standard JSON format.\n+ * \n+ */ \n+public class JSONOutputFormat extends AbstractOutputFormat {\n+  protected final BeeLine beeLine;\n+  protected JsonGenerator generator;\n+  \n+\n+  /**\n+   * @param beeLine\n+   */\n+  JSONOutputFormat(BeeLine beeLine){ \n+    this.beeLine = beeLine;\n+    ByteArrayOutputStream buf = new ByteArrayOutputStream();\n+    try {\n+      this.generator = new JsonFactory().createGenerator(buf, JsonEncoding.UTF8);\n+    } catch(IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printHeader(Rows.Row header) {\n+    try {\n+      generator.writeStartObject();\n+      generator.writeArrayFieldStart(\"resultset\");\n+    } catch(IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printFooter(Rows.Row header) {\n+    try {\n+      generator.writeEndArray();\n+      generator.writeEndObject();\n+      generator.flush();\n+      String out = ((ByteArrayOutputStream) generator.getOutputTarget()).toString(\"UTF-8\");\n+      beeLine.output(out);\n+    } catch(IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printRow(Rows rows, Rows.Row header, Rows.Row row) {\n+    String[] head = header.values;\n+    String[] vals = row.values;\n+    \n+    try {\n+      int colCount = rows.rsMeta.getColumnCount();\n+      boolean objStartFlag = true;\n+\n+      for (int i = 0; (i < head.length) && (i < vals.length); i++) {\n+        if (objStartFlag) {\n+          generator.writeStartObject();\n+          objStartFlag = false;\n+        }\n+\n+        generator.writeFieldName(head[i]);\n+        switch(rows.rsMeta.getColumnType(i+1)) {\n+          case Types.TINYINT:\n+          case Types.SMALLINT:\n+          case Types.INTEGER:\n+          case Types.BIGINT:\n+          case Types.REAL:\n+          case Types.FLOAT:\n+          case Types.DOUBLE:\n+          case Types.DECIMAL:\n+          case Types.NUMERIC:\n+          case Types.ROWID:\n+            generator.writeNumber(vals[i]);\n+            break;\n+          case Types.NULL:\n+            generator.writeNull();\n+            break;\n+          case Types.BOOLEAN:\n+            generator.writeBoolean(Boolean.parseBoolean(vals[i]));\n+            break;\n+          default:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7eda09b6f58f83fe9e5ecea9bdec2148026e8dbc"}, "originalPosition": 114}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4Mzk4NjI4", "url": "https://github.com/apache/hive/pull/1169#pullrequestreview-448398628", "createdAt": "2020-07-14T19:24:56Z", "commit": {"oid": "a8c0da2358df56ded0632514760b9f2abe98f0f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxOToyNDo1NlrOGxh_-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxOToyNDo1NlrOGxh_-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU5MDQ1Nw==", "bodyText": "Please clear the ByteArrayInputStream here otherwise it will carry around all the buffered data for a while.", "url": "https://github.com/apache/hive/pull/1169#discussion_r454590457", "createdAt": "2020-07-14T19:24:56Z", "author": {"login": "belugabehr"}, "path": "beeline/src/java/org/apache/hive/beeline/JSONOutputFormat.java", "diffHunk": "@@ -0,0 +1,118 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+ * This source file is based on code taken from SQLLine 1.9\n+ * See SQLLine notice in LICENSE\n+ */\n+package org.apache.hive.beeline;\n+\n+import java.sql.SQLException;\n+import java.sql.Types;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+\n+import com.fasterxml.jackson.core.JsonEncoding;\n+import com.fasterxml.jackson.core.JsonFactory;\n+import com.fasterxml.jackson.core.JsonGenerator;\n+\n+/**\n+ * OutputFormat for standard JSON format.\n+ * \n+ */ \n+public class JSONOutputFormat extends AbstractOutputFormat {\n+  protected final BeeLine beeLine;\n+  protected JsonGenerator generator;\n+  \n+\n+  /**\n+   * @param beeLine\n+   */\n+  JSONOutputFormat(BeeLine beeLine){ \n+    this.beeLine = beeLine;\n+    ByteArrayOutputStream buf = new ByteArrayOutputStream();\n+    try {\n+      this.generator = new JsonFactory().createGenerator(buf, JsonEncoding.UTF8);\n+    } catch(IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printHeader(Rows.Row header) {\n+    try {\n+      generator.writeStartObject();\n+      generator.writeArrayFieldStart(\"resultset\");\n+    } catch(IOException e) {\n+      beeLine.handleException(e);\n+    }\n+  }\n+\n+  @Override \n+  void printFooter(Rows.Row header) {\n+    try {\n+      generator.writeEndArray();\n+      generator.writeEndObject();\n+      generator.flush();\n+      String out = ((ByteArrayOutputStream) generator.getOutputTarget()).toString(\"UTF-8\");\n+      beeLine.output(out);\n+    } catch(IOException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8c0da2358df56ded0632514760b9f2abe98f0f2"}, "originalPosition": 74}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d9e47fd9ff4367ff7962fcd1df2babf52d2ac8ee", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/d9e47fd9ff4367ff7962fcd1df2babf52d2ac8ee", "committedDate": "2020-07-15T18:40:58Z", "message": "Changed how JSON types handle binary data types"}, "afterCommit": {"oid": "64ad49aafe370f7f381f5c885956b69bf73d7d9a", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/64ad49aafe370f7f381f5c885956b69bf73d7d9a", "committedDate": "2020-07-15T20:32:41Z", "message": "Changed Binary format types back because of other JIRA ticket"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5a99425c8ead087d24dbf3660561d71dacde37b", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/e5a99425c8ead087d24dbf3660561d71dacde37b", "committedDate": "2020-07-16T13:28:05Z", "message": "Add JSON Output Format to beeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40b5ac47702e6bc72529113289b1c709ca215d1e", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/40b5ac47702e6bc72529113289b1c709ca215d1e", "committedDate": "2020-07-16T13:28:06Z", "message": "Switched from apache-commons-text to Jackson for JSON string escaping"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bba4a66f69dc57773fd28f35ce6a0792593df08", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/9bba4a66f69dc57773fd28f35ce6a0792593df08", "committedDate": "2020-07-16T13:28:06Z", "message": "Fixed null values being printed as \"NULL\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5c3ea419feaba928b3d8200d797985f84611399", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/f5c3ea419feaba928b3d8200d797985f84611399", "committedDate": "2020-07-16T13:28:06Z", "message": "- Changed to Jackson JSONGenerator from JsonStringEncoder\n- Removed VS code modifications from pom.xml and .gitignore\n- Added JSONFileOutputFormat which should match Hive JSON file format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d76b3f9bfe4244f2325c55ccf46e5be4fde5ba5f", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/d76b3f9bfe4244f2325c55ccf46e5be4fde5ba5f", "committedDate": "2020-07-16T13:28:06Z", "message": "Updated beeline.properties. Added newline to end of TestJSONOutputFormat.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a564778fbcc8a4a733fb6b8e1ad288b75580a24", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/6a564778fbcc8a4a733fb6b8e1ad288b75580a24", "committedDate": "2020-07-16T13:28:06Z", "message": "Fixed order of operations in JSONOutputFormat\nUpdated string for outputformats in BeeLine.properties\nAdded example to top of JSONFileOutputFormat"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b33989d2c19b56aea56bf2ee7004f29c3da8614", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/9b33989d2c19b56aea56bf2ee7004f29c3da8614", "committedDate": "2020-07-16T13:28:06Z", "message": "Added tests for JSON output types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "870da31aad3778072439f03ceb7d3ce315330171", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/870da31aad3778072439f03ceb7d3ce315330171", "committedDate": "2020-07-16T13:28:06Z", "message": "Small error in tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "469b56602537a0ccced1a0793d34efc57efe8630", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/469b56602537a0ccced1a0793d34efc57efe8630", "committedDate": "2020-07-16T13:28:06Z", "message": "Fixed some logic in JsonOutputFormat, fixed test format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdf59d069d5601efcd0e5f64c39e508da69783fa", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/fdf59d069d5601efcd0e5f64c39e508da69783fa", "committedDate": "2020-07-16T13:28:06Z", "message": "Updated licenses on JSON output types and tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b508f76d628d94f4b1b8f3c3e6245156fa19c858", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/b508f76d628d94f4b1b8f3c3e6245156fa19c858", "committedDate": "2020-07-16T13:28:06Z", "message": "Small whitespace issue and triggering CI builds again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3fc56461426a065483f715f8e8ad24d2ad6411a", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/f3fc56461426a065483f715f8e8ad24d2ad6411a", "committedDate": "2020-07-16T13:28:06Z", "message": "Fixed JSONOutputFormat logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e882159a6c3de4f82f50f78651d8ce6e4a9eb5e8", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/e882159a6c3de4f82f50f78651d8ce6e4a9eb5e8", "committedDate": "2020-07-16T13:28:06Z", "message": "Added a reset to buffer, changed to StandardCharset for clarity on converting buffer to string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90dfa9314c4d0a193c61447c84094ae5a397b181", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/90dfa9314c4d0a193c61447c84094ae5a397b181", "committedDate": "2020-07-16T13:28:06Z", "message": "Changed how JSON types handle binary data types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f77b8470fe0b45b51cc056ab2ecbeb1bd53281e5", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/f77b8470fe0b45b51cc056ab2ecbeb1bd53281e5", "committedDate": "2020-07-16T13:28:06Z", "message": "Changed Binary format types back because of other JIRA ticket"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b600a9480bdd8c7001da2851c84faee8ae6b002", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/7b600a9480bdd8c7001da2851c84faee8ae6b002", "committedDate": "2020-07-16T13:28:06Z", "message": "Small formatting issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7341daf7ac6739ff966e63d3ac3eb5cf2fb0c0c", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/e7341daf7ac6739ff966e63d3ac3eb5cf2fb0c0c", "committedDate": "2020-07-16T13:28:06Z", "message": "Updated tests to reflect changes to binary encoding"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e255e3f13fca8d80c7cab475cfd4e06dd8ca7b7", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/9e255e3f13fca8d80c7cab475cfd4e06dd8ca7b7", "committedDate": "2020-07-15T20:58:10Z", "message": "Small formatting issue"}, "afterCommit": {"oid": "e7341daf7ac6739ff966e63d3ac3eb5cf2fb0c0c", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/e7341daf7ac6739ff966e63d3ac3eb5cf2fb0c0c", "committedDate": "2020-07-16T13:28:06Z", "message": "Updated tests to reflect changes to binary encoding"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5OTA5ODUz", "url": "https://github.com/apache/hive/pull/1169#pullrequestreview-449909853", "createdAt": "2020-07-16T14:33:55Z", "commit": {"oid": "e7341daf7ac6739ff966e63d3ac3eb5cf2fb0c0c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNDozMzo1NVrOGyt6Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNDozNDo0NVrOGyt9IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTgzNDE3OA==", "bodyText": "Let's make this a bit more JUNIT-ish.\nPlease use the @BeforeClass annotation on the setupMockData() instead of calling like this manually", "url": "https://github.com/apache/hive/pull/1169#discussion_r455834178", "createdAt": "2020-07-16T14:33:55Z", "author": {"login": "belugabehr"}, "path": "beeline/src/test/org/apache/hive/beeline/TestJSONFileOutputFormat.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hive.beeline;\n+\n+import static org.mockito.ArgumentMatchers.anyInt;\n+\n+import java.sql.ResultSet;\n+import java.sql.ResultSetMetaData;\n+import java.sql.SQLException;\n+import java.sql.Types;\n+\n+import static org.junit.Assert.assertEquals;\n+import org.junit.Test;\n+import static org.mockito.Mockito.when;\n+import org.mockito.invocation.InvocationOnMock;\n+import org.mockito.stubbing.Answer;\n+import static org.mockito.Mockito.mock;\n+\n+public class TestJSONFileOutputFormat {\n+\n+  public class BeelineMock extends BeeLine {\n+\n+    private String output;\n+\n+    @Override\n+    final void output(String out) {\n+      output = out;\n+      super.output(out);\n+    }\n+\n+    private String getOutput() {\n+      return output;\n+    }\n+  }\n+\n+  private final String[][] mockRowData = {\n+    {\"aaa\",\"1\",\"3.14\",\"true\",\"\",\"SGVsbG8sIFdvcmxkIQ\"},\n+    {\"bbb\",\"2\",\"2.718\",\"false\",\"Null\",\"RWFzdGVyCgllZ2cu\"}\n+  };\n+  private BeelineMock mockBeeline;\n+  private ResultSet mockResultSet;\n+  private TestBufferedRows.MockRow mockRow;\n+\n+  /**\n+   * Test of print method, of class TableOutputFormat. There was an empty extra column after the\n+   * last one.\n+   */\n+  @Test\n+  public final void testPrint() throws SQLException {\n+    setupMockData();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7341daf7ac6739ff966e63d3ac3eb5cf2fb0c0c"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTgzNDkxMg==", "bodyText": "Please just use Mockito to capture the argument instead of making a mock manually like this.\nhttps://www.baeldung.com/mockito-void-methods", "url": "https://github.com/apache/hive/pull/1169#discussion_r455834912", "createdAt": "2020-07-16T14:34:45Z", "author": {"login": "belugabehr"}, "path": "beeline/src/test/org/apache/hive/beeline/TestJSONFileOutputFormat.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.hive.beeline;\n+\n+import static org.mockito.ArgumentMatchers.anyInt;\n+\n+import java.sql.ResultSet;\n+import java.sql.ResultSetMetaData;\n+import java.sql.SQLException;\n+import java.sql.Types;\n+\n+import static org.junit.Assert.assertEquals;\n+import org.junit.Test;\n+import static org.mockito.Mockito.when;\n+import org.mockito.invocation.InvocationOnMock;\n+import org.mockito.stubbing.Answer;\n+import static org.mockito.Mockito.mock;\n+\n+public class TestJSONFileOutputFormat {\n+\n+  public class BeelineMock extends BeeLine {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7341daf7ac6739ff966e63d3ac3eb5cf2fb0c0c"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de01b56c693788c6ad03f6e6dcae84277bd8541e", "author": {"user": {"login": "HunterL", "name": "Hunter"}}, "url": "https://github.com/apache/hive/commit/de01b56c693788c6ad03f6e6dcae84277bd8541e", "committedDate": "2020-07-17T18:47:33Z", "message": "Fixed JSONFileOutputFormat to clear buffer after output. Updated tests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNjExODk2", "url": "https://github.com/apache/hive/pull/1169#pullrequestreview-451611896", "createdAt": "2020-07-20T13:36:52Z", "commit": {"oid": "de01b56c693788c6ad03f6e6dcae84277bd8541e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3701, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}