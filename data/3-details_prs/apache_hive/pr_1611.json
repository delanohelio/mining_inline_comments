{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMDIzMzAx", "number": 1611, "title": "HIVE-12371 Adding a timeout connection parameter for JDBC", "bodyText": "What changes were proposed in this pull request?\n\nImprovement HIVE-12371: Adding a timeout connection parameter for JDBC\nWhy are the changes needed?\n\nWe run into the problem of HIVE-22196: Socket timeouts happen when other drivers set DriverManager.loginTimeout.\nIt is a good idea to add timeout parameter to hiveserver2 jdbc url. So that we do not use the global DriverManager.loginTimeout which may be unexpected set by other components in the program.\nDoes this PR introduce any user-facing change?\n\nNo\nHow was this patch tested?\n\nTested by local install jar", "createdAt": "2020-10-26T13:18:50Z", "url": "https://github.com/apache/hive/pull/1611", "merged": true, "mergeCommit": {"oid": "7935534588d96516a6e86bdaf33247ba0cae1a85"}, "closed": true, "closedAt": "2021-02-16T17:54:25Z", "author": {"login": "jshmchenxi"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYdvVbABqjM5NDYyODE1NTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdreTHygBqjQxNTkwNjQ2Nzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e62ce7821d2eb13bf5017f62a663f96457f743ce", "author": {"user": {"login": "jshmchenxi", "name": null}}, "url": "https://github.com/apache/hive/commit/e62ce7821d2eb13bf5017f62a663f96457f743ce", "committedDate": "2020-10-26T13:04:18Z", "message": "HIVE-12371 Adding a timeout connection parameter for JDBC"}, "afterCommit": {"oid": "5c23fec8072978f92829ed0c2b5c050f60149d3e", "author": {"user": {"login": "jshmchenxi", "name": null}}, "url": "https://github.com/apache/hive/commit/5c23fec8072978f92829ed0c2b5c050f60149d3e", "committedDate": "2020-11-02T05:28:58Z", "message": "HIVE-12371: Adding a timeout connection parameter for JDBC"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c23fec8072978f92829ed0c2b5c050f60149d3e", "author": {"user": {"login": "jshmchenxi", "name": null}}, "url": "https://github.com/apache/hive/commit/5c23fec8072978f92829ed0c2b5c050f60149d3e", "committedDate": "2020-11-02T05:28:58Z", "message": "HIVE-12371: Adding a timeout connection parameter for JDBC"}, "afterCommit": {"oid": "c66dce1213cfc3e7edc9832ef9cbfa04d11dfc9d", "author": {"user": {"login": "jshmchenxi", "name": null}}, "url": "https://github.com/apache/hive/commit/c66dce1213cfc3e7edc9832ef9cbfa04d11dfc9d", "committedDate": "2020-12-11T02:39:59Z", "message": "HIVE-12371: Adding a timeout connection parameter for JDBC"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNjExNDcz", "url": "https://github.com/apache/hive/pull/1611#pullrequestreview-553611473", "createdAt": "2020-12-16T11:50:32Z", "commit": {"oid": "c66dce1213cfc3e7edc9832ef9cbfa04d11dfc9d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTo1MDozMlrOIHBhsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTo1MDozMlrOIHBhsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNTk1Mg==", "bodyText": "What if the default value set to TimeUnit.SECONDS.toMillis(DriverManager.getLoginTimeout())?", "url": "https://github.com/apache/hive/pull/1611#discussion_r544235952", "createdAt": "2020-12-16T11:50:32Z", "author": {"login": "dengzhhu653"}, "path": "jdbc/src/java/org/apache/hive/jdbc/HiveConnection.java", "diffHunk": "@@ -1002,11 +1002,19 @@ private String getSessionValue(String varName, String varDefault) {\n     return varValue;\n   }\n \n-  // copy loginTimeout from driver manager. Thrift timeout needs to be in millis\n+  // use socketTimeout from jdbc connection url. Thrift timeout needs to be in millis\n   private void setupLoginTimeout() {\n-    long timeOut = TimeUnit.SECONDS.toMillis(DriverManager.getLoginTimeout());\n+    String socketTimeoutStr = sessConfMap.getOrDefault(JdbcConnectionParams.SOCKET_TIMEOUT, \"0\");\n+    long timeOut = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c66dce1213cfc3e7edc9832ef9cbfa04d11dfc9d"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNjEyMzM1", "url": "https://github.com/apache/hive/pull/1611#pullrequestreview-553612335", "createdAt": "2020-12-16T11:51:46Z", "commit": {"oid": "c66dce1213cfc3e7edc9832ef9cbfa04d11dfc9d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTo1MTo0NlrOIHBkog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMTo1MTo0NlrOIHBkog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNjcwNg==", "bodyText": "A space may be needed here after of value", "url": "https://github.com/apache/hive/pull/1611#discussion_r544236706", "createdAt": "2020-12-16T11:51:46Z", "author": {"login": "dengzhhu653"}, "path": "jdbc/src/java/org/apache/hive/jdbc/HiveConnection.java", "diffHunk": "@@ -1002,11 +1002,19 @@ private String getSessionValue(String varName, String varDefault) {\n     return varValue;\n   }\n \n-  // copy loginTimeout from driver manager. Thrift timeout needs to be in millis\n+  // use socketTimeout from jdbc connection url. Thrift timeout needs to be in millis\n   private void setupLoginTimeout() {\n-    long timeOut = TimeUnit.SECONDS.toMillis(DriverManager.getLoginTimeout());\n+    String socketTimeoutStr = sessConfMap.getOrDefault(JdbcConnectionParams.SOCKET_TIMEOUT, \"0\");\n+    long timeOut = 0;\n+    try {\n+      timeOut = Long.parseLong(socketTimeoutStr);\n+    } catch (NumberFormatException e) {\n+      LOG.info(\"Failed to parse socketTimeout of value\" + socketTimeoutStr);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c66dce1213cfc3e7edc9832ef9cbfa04d11dfc9d"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c66dce1213cfc3e7edc9832ef9cbfa04d11dfc9d", "author": {"user": {"login": "jshmchenxi", "name": null}}, "url": "https://github.com/apache/hive/commit/c66dce1213cfc3e7edc9832ef9cbfa04d11dfc9d", "committedDate": "2020-12-11T02:39:59Z", "message": "HIVE-12371: Adding a timeout connection parameter for JDBC"}, "afterCommit": {"oid": "d1487322367b350d322266b8f296af0c0c09b4d7", "author": {"user": {"login": "jshmchenxi", "name": null}}, "url": "https://github.com/apache/hive/commit/d1487322367b350d322266b8f296af0c0c09b4d7", "committedDate": "2020-12-21T06:46:32Z", "message": "HIVE-12371: Adding a timeout connection parameter for JDBC"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d5ebda77e7a51b18410b10368b0367c45817f0c", "author": {"user": {"login": "jshmchenxi", "name": null}}, "url": "https://github.com/apache/hive/commit/2d5ebda77e7a51b18410b10368b0367c45817f0c", "committedDate": "2020-12-31T06:52:54Z", "message": "HIVE-12371: Adding a timeout connection parameter for JDBC"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d1487322367b350d322266b8f296af0c0c09b4d7", "author": {"user": {"login": "jshmchenxi", "name": null}}, "url": "https://github.com/apache/hive/commit/d1487322367b350d322266b8f296af0c0c09b4d7", "committedDate": "2020-12-21T06:46:32Z", "message": "HIVE-12371: Adding a timeout connection parameter for JDBC"}, "afterCommit": {"oid": "2d5ebda77e7a51b18410b10368b0367c45817f0c", "author": {"user": {"login": "jshmchenxi", "name": null}}, "url": "https://github.com/apache/hive/commit/2d5ebda77e7a51b18410b10368b0367c45817f0c", "committedDate": "2020-12-31T06:52:54Z", "message": "HIVE-12371: Adding a timeout connection parameter for JDBC"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2967, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}