{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxNzE2NTM2", "number": 1518, "title": "HIVE-24191: Introduce configurable user to run compaction as", "bodyText": "What changes were proposed in this pull request?\nAdd a restricted config.\nWhy are the changes needed?\nSometimes we want to run compaction as a specific user.\nDoes this PR introduce any user-facing change?\nAdmin can optionally specify a user that will run compaction and list files in compaction Initiator and Cleaner.\nHow was this patch tested?\nUnit tests", "createdAt": "2020-09-23T11:45:46Z", "url": "https://github.com/apache/hive/pull/1518", "merged": true, "mergeCommit": {"oid": "478930554ef17e309b3da79c46a9a552ed99c246"}, "closed": true, "closedAt": "2020-09-24T09:27:58Z", "author": {"login": "klcopp"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLqsKRgH2gAyNDkxNzE2NTM2OjllZTc2ZDBhYTBiOTY3MWY1Njk0MGNlOTU0M2NjZGM2OTdhYjJmNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdL9vQvAFqTQ5NTM4MzU5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9ee76d0aa0b9671f56940ce9543ccdc697ab2f51", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/9ee76d0aa0b9671f56940ce9543ccdc697ab2f51", "committedDate": "2020-09-23T11:14:39Z", "message": "HIVE-24191: Introduce configurable user to run compaction as NOTE: TestRestrictedList will fail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f5ff016967eb26f86d086e6cbc1cdaa6a54a84e", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/1f5ff016967eb26f86d086e6cbc1cdaa6a54a84e", "committedDate": "2020-09-23T11:32:39Z", "message": "Move config from MetastoreConf to HiveConf because HiveConf has restricted list"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NTkyODI5", "url": "https://github.com/apache/hive/pull/1518#pullrequestreview-494592829", "createdAt": "2020-09-23T12:13:56Z", "commit": {"oid": "1f5ff016967eb26f86d086e6cbc1cdaa6a54a84e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjoxMzo1NlrOHWp2uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMjoxMzo1NlrOHWp2uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUxNjQ3Mg==", "bodyText": "This will be used on HMS and occasionally on HS2 (if the Worker is HS2).\nWhere are those other Compaction related configs? If everything is on HMS side, please move this there too", "url": "https://github.com/apache/hive/pull/1518#discussion_r493516472", "createdAt": "2020-09-23T12:13:56Z", "author": {"login": "pvary"}, "path": "common/src/java/org/apache/hadoop/hive/conf/HiveConf.java", "diffHunk": "@@ -3098,6 +3098,10 @@ private static void populateLlapDaemonVarsSet(Set<String> llapDaemonVarsSetLocal\n         \"This is set to compactor from within the query based compactor. This enables the Tez SplitGrouper \"\n         + \"to group splits based on their bucket number, so that all rows from different bucket files \"\n         + \" for the same bucket number can end up in the same bucket file after the compaction.\"),\n+    // MetastoreConf doesn't have a restricted list. Otherwise can be moved there.\n+    COMPACTOR_RUN_AS_USER(\"hive.compactor.run.as.user\", \"\",\n+        \"Specify the user to run compaction (Worker) and compaction-related file listing (Initiator, Cleaner) as. \" +\n+        \"If empty string, defaults to table/partition directory owner. Restricted.\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f5ff016967eb26f86d086e6cbc1cdaa6a54a84e"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad9c13e2ab80dc458281bc30d51f4417d74d6874", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/ad9c13e2ab80dc458281bc30d51f4417d74d6874", "committedDate": "2020-09-23T12:42:41Z", "message": "Move config back to HiveConf; remove from restricted list. Reasoning: Compactor thread configs can't be changed without a HS2/HMS restart"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NjIwMTA1", "url": "https://github.com/apache/hive/pull/1518#pullrequestreview-494620105", "createdAt": "2020-09-23T12:46:09Z", "commit": {"oid": "ad9c13e2ab80dc458281bc30d51f4417d74d6874"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73701d0253cc8a977204989b0e6eb43efbb40817", "author": {"user": null}, "url": "https://github.com/apache/hive/commit/73701d0253cc8a977204989b0e6eb43efbb40817", "committedDate": "2020-09-24T07:45:16Z", "message": "Fix tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MzgzNTk4", "url": "https://github.com/apache/hive/pull/1518#pullrequestreview-495383598", "createdAt": "2020-09-24T09:26:14Z", "commit": {"oid": "73701d0253cc8a977204989b0e6eb43efbb40817"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3093, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}