{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0MTU2MzIy", "number": 1532, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwODoyOToyN1rOEpXrjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwODozNzowN1rOEpX3iA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExODE1MDUyOnYy", "diffSide": "RIGHT", "path": "ql/src/java/org/apache/hadoop/hive/ql/io/AcidUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwODoyOToyN1rOHa_5tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMjoyODo1M1rOHbIBOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA3MTk5MQ==", "bodyText": "could we remove those and reference constants from AcidConstants directly", "url": "https://github.com/apache/hive/pull/1532#discussion_r498071991", "createdAt": "2020-10-01T08:29:27Z", "author": {"login": "deniskuzZ"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/io/AcidUtils.java", "diffHunk": "@@ -114,16 +114,16 @@\n public class AcidUtils {\n   // This key will be put in the conf file when planning an acid operation\n   public static final String CONF_ACID_KEY = \"hive.doing.acid\";\n-  public static final String BASE_PREFIX = \"base_\";\n+  public static final String BASE_PREFIX = AcidConstants.BASE_PREFIX;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0a942a9916809e02130647980229c6a3ac76b35"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIwNDk4Nw==", "bodyText": "I am not sure I want to remove these public constants, the AcidUtils is unfortunately is being used by spark-acid and it might break compatibility...", "url": "https://github.com/apache/hive/pull/1532#discussion_r498204987", "createdAt": "2020-10-01T12:28:53Z", "author": {"login": "pvargacl"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/io/AcidUtils.java", "diffHunk": "@@ -114,16 +114,16 @@\n public class AcidUtils {\n   // This key will be put in the conf file when planning an acid operation\n   public static final String CONF_ACID_KEY = \"hive.doing.acid\";\n-  public static final String BASE_PREFIX = \"base_\";\n+  public static final String BASE_PREFIX = AcidConstants.BASE_PREFIX;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA3MTk5MQ=="}, "originalCommit": {"oid": "d0a942a9916809e02130647980229c6a3ac76b35"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExODE1MzIwOnYy", "diffSide": "RIGHT", "path": "ql/src/java/org/apache/hadoop/hive/ql/ddl/table/misc/truncate/TruncateTableAnalyzer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwODozMDoxMFrOHa_7XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwODozMDoxMFrOHa_7XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA3MjQxMw==", "bodyText": "could we rename local var to truncateFiles or something (same as below)", "url": "https://github.com/apache/hive/pull/1532#discussion_r498072413", "createdAt": "2020-10-01T08:30:10Z", "author": {"login": "deniskuzZ"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/ddl/table/misc/truncate/TruncateTableAnalyzer.java", "diffHunk": "@@ -112,23 +113,27 @@ private void checkTruncateEligibility(ASTNode ast, ASTNode root, String tableNam\n \n   private void addTruncateTableOutputs(ASTNode root, Table table, Map<String, String> partitionSpec)\n       throws SemanticException {\n+    boolean shared = AcidUtils.isTransactionalTable(table) &&", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0a942a9916809e02130647980229c6a3ac76b35"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExODE4MTIwOnYy", "diffSide": "RIGHT", "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwODozNzowN1rOHbAMMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMzowMDoxMFrOHbJOiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA3NjcyMQ==", "bodyText": "Do you think it would make sense to move metaFile creation under MetaDataFile class, not sure however it should be under AcidConstants?", "url": "https://github.com/apache/hive/pull/1532#discussion_r498076721", "createdAt": "2020-10-01T08:37:07Z", "author": {"login": "deniskuzZ"}, "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java", "diffHunk": "@@ -3357,6 +3355,52 @@ private void truncateTableInternal(String dbName, String tableName, List<String>\n       }\n     }\n \n+    /**\n+     * Add an empty baseDir with a truncate metadatafile\n+     * @param location\n+     * @param writeId\n+     * @param fs\n+     * @throws Exception\n+     */\n+    private void addTruncateBaseFile(Path location, long writeId, FileSystem fs) throws Exception {\n+      Path basePath = new Path(location, AcidConstants.baseDir(writeId));\n+      fs.mkdirs(basePath);\n+      // We can not leave the folder empty, otherwise it will be skipped at some file listing in AcidUtils\n+      // No need for a data file, a simple metadata is enough", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0a942a9916809e02130647980229c6a3ac76b35"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIyNDc3Ng==", "bodyText": "added the write to the MetaDataFile and moved it out from the AcidConstants class", "url": "https://github.com/apache/hive/pull/1532#discussion_r498224776", "createdAt": "2020-10-01T13:00:10Z", "author": {"login": "pvargacl"}, "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java", "diffHunk": "@@ -3357,6 +3355,52 @@ private void truncateTableInternal(String dbName, String tableName, List<String>\n       }\n     }\n \n+    /**\n+     * Add an empty baseDir with a truncate metadatafile\n+     * @param location\n+     * @param writeId\n+     * @param fs\n+     * @throws Exception\n+     */\n+    private void addTruncateBaseFile(Path location, long writeId, FileSystem fs) throws Exception {\n+      Path basePath = new Path(location, AcidConstants.baseDir(writeId));\n+      fs.mkdirs(basePath);\n+      // We can not leave the folder empty, otherwise it will be skipped at some file listing in AcidUtils\n+      // No need for a data file, a simple metadata is enough", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODA3NjcyMQ=="}, "originalCommit": {"oid": "d0a942a9916809e02130647980229c6a3ac76b35"}, "originalPosition": 93}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 302, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}