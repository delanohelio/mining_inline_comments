{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzOTk1MTAz", "number": 1804, "title": "HIVE-24558 : Handle update in table level regular expression", "bodyText": "What changes were proposed in this pull request?\n\nWhy are the changes needed?\n\nDoes this PR introduce any user-facing change?\n\nHow was this patch tested?", "createdAt": "2020-12-22T09:34:14Z", "url": "https://github.com/apache/hive/pull/1804", "merged": true, "mergeCommit": {"oid": "0061f50db97ebce4880b4c2c774d4d8ddde91174"}, "closed": true, "closedAt": "2021-01-19T05:50:13Z", "author": {"login": "aasha"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdooUTTgBqjQxMzk2MzczMDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdxhxckABqjQyMjA0MTI4OTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "698f8a19bc4cf60ce190792dc19d7e7c6172c9a2", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/698f8a19bc4cf60ce190792dc19d7e7c6172c9a2", "committedDate": "2020-12-22T09:33:34Z", "message": "HIVE-24558 : Handle update in table level regular expression"}, "afterCommit": {"oid": "9e9f15745a5f584983496c6feb7734998344b7d3", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/9e9f15745a5f584983496c6feb7734998344b7d3", "committedDate": "2020-12-22T10:52:11Z", "message": "HIVE-24558 : Handle update in table level regular expression"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e9f15745a5f584983496c6feb7734998344b7d3", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/9e9f15745a5f584983496c6feb7734998344b7d3", "committedDate": "2020-12-22T10:52:11Z", "message": "HIVE-24558 : Handle update in table level regular expression"}, "afterCommit": {"oid": "5bc9524b591ee1468825a770b73e143d5699b641", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/5bc9524b591ee1468825a770b73e143d5699b641", "committedDate": "2020-12-23T13:04:54Z", "message": "HIVE-24558 : Handle update in table level regular expression"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5bc9524b591ee1468825a770b73e143d5699b641", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/5bc9524b591ee1468825a770b73e143d5699b641", "committedDate": "2020-12-23T13:04:54Z", "message": "HIVE-24558 : Handle update in table level regular expression"}, "afterCommit": {"oid": "fbed68b1b7fd28bed06b93063f9a50133191abf3", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/fbed68b1b7fd28bed06b93063f9a50133191abf3", "committedDate": "2020-12-23T13:50:35Z", "message": "HIVE-24558 : Handle update in table level regular expression"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fbed68b1b7fd28bed06b93063f9a50133191abf3", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/fbed68b1b7fd28bed06b93063f9a50133191abf3", "committedDate": "2020-12-23T13:50:35Z", "message": "HIVE-24558 : Handle update in table level regular expression"}, "afterCommit": {"oid": "6dc8dcc574441d6a7755667faf64dad5d9a4a348", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/6dc8dcc574441d6a7755667faf64dad5d9a4a348", "committedDate": "2020-12-24T13:53:46Z", "message": "HIVE-24558 : Handle update in table level regular expression"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6dc8dcc574441d6a7755667faf64dad5d9a4a348", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/6dc8dcc574441d6a7755667faf64dad5d9a4a348", "committedDate": "2020-12-24T13:53:46Z", "message": "HIVE-24558 : Handle update in table level regular expression"}, "afterCommit": {"oid": "f3fd18359136568cfb618097363fc9d2f0b0e5a5", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/f3fd18359136568cfb618097363fc9d2f0b0e5a5", "committedDate": "2021-01-04T18:41:44Z", "message": "HIVE-24558 : Handle update in table level regular expression"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f3fd18359136568cfb618097363fc9d2f0b0e5a5", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/f3fd18359136568cfb618097363fc9d2f0b0e5a5", "committedDate": "2021-01-04T18:41:44Z", "message": "HIVE-24558 : Handle update in table level regular expression"}, "afterCommit": {"oid": "dd929520b0cbf71879383db845ed4dc83be5de19", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/dd929520b0cbf71879383db845ed4dc83be5de19", "committedDate": "2021-01-06T04:46:06Z", "message": "HIVE-24558 : Handle update in table level regular expression"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1MDA1NjE1", "url": "https://github.com/apache/hive/pull/1804#pullrequestreview-565005615", "createdAt": "2021-01-11T03:12:28Z", "commit": {"oid": "dd929520b0cbf71879383db845ed4dc83be5de19"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQwMzoxMjoyOVrOIQ-aUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQwMzoyNToyNlrOIQ-izA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDY3MDY3NQ==", "bodyText": "nit: getExcludedTableNames() /getIncludedTableNames() methods can be replaced by replScope.excludedTableNamePattern and replScope.includedTableNamePattern respectively.", "url": "https://github.com/apache/hive/pull/1804#discussion_r554670675", "createdAt": "2021-01-11T03:12:29Z", "author": {"login": "pkumarsinha"}, "path": "standalone-metastore/metastore-common/src/main/java/org/apache/hadoop/hive/common/repl/ReplScope.java", "diffHunk": "@@ -116,4 +117,27 @@ private boolean inTableExcludedList(final String tableName) {\n     }\n     return excludedTableNamePattern.matcher(tableName).matches();\n   }\n+\n+  @Override\n+  public boolean equals(Object o) {\n+    if (o == this) {\n+      return true;\n+    }\n+    if (! (o instanceof ReplScope)) {\n+      return false;\n+    }\n+\n+    ReplScope replScope = (ReplScope)o;\n+    return ((replScope.getExcludedTableNames() == null ?  (this.excludedTableNames == null) :\n+      replScope.getExcludedTableNames().equals(this.excludedTableNames))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd929520b0cbf71879383db845ed4dc83be5de19"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDY3Mjg0NA==", "bodyText": "dmd.setDump(DumpType.BOOTSTRAP, bootDumpBeginReplId, bootDumpEndReplId, cmRoot, executorId,\nwork.oldReplScope != null);\nShouldn't this line also also previousReplScopeModified() otherwise load will always assume that there is change in expession.", "url": "https://github.com/apache/hive/pull/1804#discussion_r554672844", "createdAt": "2021-01-11T03:25:26Z", "author": {"login": "pkumarsinha"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/repl/ReplDumpTask.java", "diffHunk": "@@ -410,12 +413,16 @@ private boolean shouldDump(Path previousDumpPath) throws IOException {\n    * @return true if need to examine tables for dump and false if not.\n    */\n   private boolean shouldExamineTablesToDump() {\n-    return (work.oldReplScope != null)\n+    return (previousReplScopeModified())\n             || !tablesForBootstrap.isEmpty()\n             || conf.getBoolVar(HiveConf.ConfVars.REPL_BOOTSTRAP_ACID_TABLES)\n             || conf.getBoolVar(HiveConf.ConfVars.REPL_INCLUDE_EXTERNAL_TABLES);\n   }\n \n+  private boolean previousReplScopeModified() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd929520b0cbf71879383db845ed4dc83be5de19"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33eed686b11be8498a089c8e0b1b27aadd44eeba", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/33eed686b11be8498a089c8e0b1b27aadd44eeba", "committedDate": "2021-01-11T15:37:53Z", "message": "Resolve review comments"}, "afterCommit": {"oid": "4d2e9bbe532604244bbedb339e37392157a2e888", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/4d2e9bbe532604244bbedb339e37392157a2e888", "committedDate": "2021-01-12T06:46:10Z", "message": "Resolve review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY2ODg0Njc0", "url": "https://github.com/apache/hive/pull/1804#pullrequestreview-566884674", "createdAt": "2021-01-13T04:26:46Z", "commit": {"oid": "4f579bd960532366d2fad54abdde71d8429fac8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QwNDoyNjo0NlrOISfGYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QwNDoyNjo0NlrOISfGYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjI1NDgxOQ==", "bodyText": "We can  reuse the  same DumpMetaData object in the below check also, would avoid FileSystem read call:\nif (isBootStrap) {\nreturn shouldResumePreviousDump(new DumpMetaData(hiveDumpPath, conf));\n}\nSecond thing, I was also wondering if isBootStrap is true , do we even need that check or we can simply return false.", "url": "https://github.com/apache/hive/pull/1804#discussion_r556254819", "createdAt": "2021-01-13T04:26:46Z", "author": {"login": "pkumarsinha"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/repl/ReplDumpTask.java", "diffHunk": "@@ -968,6 +979,9 @@ private boolean shouldResumePreviousDump(Path lastDumpPath, boolean isBootStrap)\n       return false;\n     }\n     Path hiveDumpPath = new Path(lastDumpPath, ReplUtils.REPL_HIVE_BASE_DIR);\n+    if (tableExpressionModified(new DumpMetaData(hiveDumpPath, conf))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f579bd960532366d2fad54abdde71d8429fac8f"}, "originalPosition": 77}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f579bd960532366d2fad54abdde71d8429fac8f", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/4f579bd960532366d2fad54abdde71d8429fac8f", "committedDate": "2021-01-12T18:32:20Z", "message": "Resolve review comments"}, "afterCommit": {"oid": "4101a88fba3e55be4809d916016a8d712df07b23", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/4101a88fba3e55be4809d916016a8d712df07b23", "committedDate": "2021-01-13T06:24:28Z", "message": "Resolve review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "648fd52fada0606a77269ef4b15fe9e388f26bb2", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/648fd52fada0606a77269ef4b15fe9e388f26bb2", "committedDate": "2021-01-15T14:29:06Z", "message": "Resolve test fixes"}, "afterCommit": {"oid": "e7d45a865cda2160ccbd172a119d69ca9887f4de", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/e7d45a865cda2160ccbd172a119d69ca9887f4de", "committedDate": "2021-01-18T13:20:50Z", "message": "Resolve test fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcwNDk5MTE5", "url": "https://github.com/apache/hive/pull/1804#pullrequestreview-570499119", "createdAt": "2021-01-18T13:41:06Z", "commit": {"oid": "e7d45a865cda2160ccbd172a119d69ca9887f4de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e7d45a865cda2160ccbd172a119d69ca9887f4de", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/e7d45a865cda2160ccbd172a119d69ca9887f4de", "committedDate": "2021-01-18T13:20:50Z", "message": "Resolve test fixes"}, "afterCommit": {"oid": "98b3bf4ee2528550e1a42115f628ba35ac921901", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/98b3bf4ee2528550e1a42115f628ba35ac921901", "committedDate": "2021-01-18T16:39:07Z", "message": "Fix tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98b3bf4ee2528550e1a42115f628ba35ac921901", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/98b3bf4ee2528550e1a42115f628ba35ac921901", "committedDate": "2021-01-18T16:39:07Z", "message": "Fix tests"}, "afterCommit": {"oid": "333798445c977b218d8cd3e43d0a16d06bb735f7", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/333798445c977b218d8cd3e43d0a16d06bb735f7", "committedDate": "2021-01-18T16:55:16Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "add277f56b57ce086a5be00e3004fd6ec64ddcc6", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/add277f56b57ce086a5be00e3004fd6ec64ddcc6", "committedDate": "2021-01-19T02:12:09Z", "message": "HIVE-24558 : Handle update in table level regular expression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7345a247ae360c99bef56666276cec0837c0b8a5", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/7345a247ae360c99bef56666276cec0837c0b8a5", "committedDate": "2021-01-19T02:12:09Z", "message": "Resolve review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68a0823c1278760b47275c0daacdb529575fbb3b", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/68a0823c1278760b47275c0daacdb529575fbb3b", "committedDate": "2021-01-19T02:12:09Z", "message": "Resolve review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ab31f0fc9a77ab112218c9864be05b418ec3ec5", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/5ab31f0fc9a77ab112218c9864be05b418ec3ec5", "committedDate": "2021-01-19T02:12:09Z", "message": "Resolve test fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b2fb2de46e4e72fc21a9df18288550cc1b54e22", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/9b2fb2de46e4e72fc21a9df18288550cc1b54e22", "committedDate": "2021-01-19T02:19:58Z", "message": "Fix tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "333798445c977b218d8cd3e43d0a16d06bb735f7", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/333798445c977b218d8cd3e43d0a16d06bb735f7", "committedDate": "2021-01-18T16:55:16Z", "message": "Fix tests"}, "afterCommit": {"oid": "9b2fb2de46e4e72fc21a9df18288550cc1b54e22", "author": {"user": {"login": "aasha", "name": "aasha"}}, "url": "https://github.com/apache/hive/commit/9b2fb2de46e4e72fc21a9df18288550cc1b54e22", "committedDate": "2021-01-19T02:19:58Z", "message": "Fix tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2953, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}