{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2NTg0MTQy", "number": 1544, "title": "HIVE-24221: Use vectorizable expression to combine multiple columns in semijoin bloom filters", "bodyText": "What changes were proposed in this pull request?\nUse hash(hash(hash(a,b),c),d) instead of hash(a,b,c,d) when constructing\nthe multi-col semijoin reducer.\nWhy are the changes needed?\nIn order to use fully vectorized execution on multi-col semijoin reducers.\nDoes this PR introduce any user-facing change?\nOnly changes in EXPLAIN plans.\nHow was this patch tested?\nmvn test -Dtest=TestTezPerfCliDriver -Dqfile=\"query50.q\"", "createdAt": "2020-10-01T22:38:32Z", "url": "https://github.com/apache/hive/pull/1544", "merged": true, "mergeCommit": {"oid": "c3fd3c2f143e889178c91faf137c494006e5c001"}, "closed": true, "closedAt": "2021-02-04T10:58:22Z", "author": {"login": "zabetak"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSYo-cgFqTUwODA5MzcxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABd2ic7fgBqjQyODYwOTA2Mzk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MDkzNzE3", "url": "https://github.com/apache/hive/pull/1544#pullrequestreview-508093717", "createdAt": "2020-10-14T08:07:15Z", "commit": {"oid": "5985e250350ed627c93dce1104506a16841010d4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODowNzoxNVrOHhHI2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwODowNzoxNVrOHhHI2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ4MjAxMA==", "bodyText": "it seems like we have some inconsistency in GenericUDFMurmurHash which is registered as murmur_hash in the FunctionRegistry ; however in the UDF's annotation it only has hash - and here as well we use simply \"hash\".\na change like this will most likely cause a lot of q.out changes - could you file a follow-up ticket?", "url": "https://github.com/apache/hive/pull/1544#discussion_r504482010", "createdAt": "2020-10-14T08:07:15Z", "author": {"login": "kgyrtkirk"}, "path": "ql/src/java/org/apache/hadoop/hive/ql/plan/ExprNodeDescUtils.java", "diffHunk": "@@ -233,6 +235,23 @@ public static ExprNodeGenericFuncDesc and(List<ExprNodeDesc> exps) {\n     return new ExprNodeGenericFuncDesc(TypeInfoFactory.booleanTypeInfo, new GenericUDFOPAnd(), \"and\", flatExps);\n   }\n \n+  /**\n+   * Create an expression for computing a hash by recursively hashing given expressions by two:\n+   * <pre>\n+   * Input: HASH(A, B, C, D)\n+   * Output: HASH(HASH(HASH(A,B),C),D)\n+   * </pre>\n+   */\n+  public static ExprNodeGenericFuncDesc hash(List<ExprNodeDesc> exps) {\n+    assert exps.size() >= 2;\n+    ExprNodeDesc hashExp = exps.get(0);\n+    for (int i = 1; i < exps.size(); i++) {\n+      List<ExprNodeDesc> hArgs = Arrays.asList(hashExp, exps.get(i));\n+      hashExp = new ExprNodeGenericFuncDesc(TypeInfoFactory.intTypeInfo, new GenericUDFMurmurHash(), \"hash\", hArgs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5985e250350ed627c93dce1104506a16841010d4"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5985e250350ed627c93dce1104506a16841010d4", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/apache/hive/commit/5985e250350ed627c93dce1104506a16841010d4", "committedDate": "2020-10-02T13:14:27Z", "message": "HIVE-24221: Update stale qtests"}, "afterCommit": {"oid": "0a9fecd47f7b2d9bf9d8436884f4c683dc48dabd", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/apache/hive/commit/0a9fecd47f7b2d9bf9d8436884f4c683dc48dabd", "committedDate": "2021-01-26T17:57:59Z", "message": "HIVE-24221: Use vectorizable expression to combine multiple columns in semijoin bloom filters\n\nUse hash(hash(hash(a,b),c),d) instead of hash(a,b,c,d) when constructing\nthe multi-col semijoin reducer."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a9fecd47f7b2d9bf9d8436884f4c683dc48dabd", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/apache/hive/commit/0a9fecd47f7b2d9bf9d8436884f4c683dc48dabd", "committedDate": "2021-01-26T17:57:59Z", "message": "HIVE-24221: Use vectorizable expression to combine multiple columns in semijoin bloom filters\n\nUse hash(hash(hash(a,b),c),d) instead of hash(a,b,c,d) when constructing\nthe multi-col semijoin reducer."}, "afterCommit": {"oid": "7fdc04fd165039ae64c459756d18a403ff61914f", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/apache/hive/commit/7fdc04fd165039ae64c459756d18a403ff61914f", "committedDate": "2021-01-28T09:14:43Z", "message": "HIVE-24221: Use vectorizable expression to combine multiple columns in semijoin bloom filters\n\nUse hash(hash(hash(a,b),c),d) instead of hash(a,b,c,d) when constructing\nthe multi-col semijoin reducer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c4af56bcec22b47a3031c151b39599691966d55", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/apache/hive/commit/3c4af56bcec22b47a3031c151b39599691966d55", "committedDate": "2021-02-03T15:56:54Z", "message": "HIVE-24221: Use vectorizable expression to combine multiple columns in semijoin bloom filters\n\nUse hash(hash(hash(a,b),c),d) instead of hash(a,b,c,d) when constructing\nthe multi-col semijoin reducer."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7fdc04fd165039ae64c459756d18a403ff61914f", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/apache/hive/commit/7fdc04fd165039ae64c459756d18a403ff61914f", "committedDate": "2021-01-28T09:14:43Z", "message": "HIVE-24221: Use vectorizable expression to combine multiple columns in semijoin bloom filters\n\nUse hash(hash(hash(a,b),c),d) instead of hash(a,b,c,d) when constructing\nthe multi-col semijoin reducer."}, "afterCommit": {"oid": "3c4af56bcec22b47a3031c151b39599691966d55", "author": {"user": {"login": "zabetak", "name": "Stamatis Zampetakis"}}, "url": "https://github.com/apache/hive/commit/3c4af56bcec22b47a3031c151b39599691966d55", "committedDate": "2021-02-03T15:56:54Z", "message": "HIVE-24221: Use vectorizable expression to combine multiple columns in semijoin bloom filters\n\nUse hash(hash(hash(a,b),c),d) instead of hash(a,b,c,d) when constructing\nthe multi-col semijoin reducer."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3128, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}