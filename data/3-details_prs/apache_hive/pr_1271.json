{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwODY5NTQ2", "number": 1271, "title": "HIVE-23851: MSCK REPAIR Command With Partition Filtering Fails While Dropping Partitions", "bodyText": "Refer: https://issues.apache.org/jira/browse/HIVE-23851 for more information", "createdAt": "2020-07-17T07:36:02Z", "url": "https://github.com/apache/hive/pull/1271", "merged": true, "mergeCommit": {"oid": "d61c9160ffa5afbd729887c3db690eccd7ef8238"}, "closed": true, "closedAt": "2020-10-09T08:21:58Z", "author": {"login": "shameersss1"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc11PCsAFqTQ1MDczNTM2Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQLo-UAFqTUwMzc5NzUyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNzM1MzY3", "url": "https://github.com/apache/hive/pull/1271#pullrequestreview-450735367", "createdAt": "2020-07-17T15:05:28Z", "commit": {"oid": "d6980856ea9600e9c29d38d8000c0f296b16e8aa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNTowNToyOFrOGzWnJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNTowNToyOFrOGzWnJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUwMTAyOQ==", "bodyText": "@kgyrtkirk Is this change okay? I mean we could have used reflection again to call serde classes but it will make code more complex and non-readable.", "url": "https://github.com/apache/hive/pull/1271#discussion_r456501029", "createdAt": "2020-07-17T15:05:28Z", "author": {"login": "shameersss1"}, "path": "standalone-metastore/metastore-server/pom.xml", "diffHunk": "@@ -204,6 +204,11 @@\n       <artifactId>hive-storage-api</artifactId>\n       <version>${storage-api.version}</version>\n     </dependency>\n+    <dependency>\n+      <groupId>org.apache.hive</groupId>\n+      <artifactId>hive-serde</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6980856ea9600e9c29d38d8000c0f296b16e8aa"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "612cf578cd32e2b9619545260779c2c5fe00c95a", "author": {"user": {"login": "srahman-qubole", "name": "Syed Shameerur Rahman"}}, "url": "https://github.com/apache/hive/commit/612cf578cd32e2b9619545260779c2c5fe00c95a", "committedDate": "2020-07-31T07:11:58Z", "message": "Trigger Build"}, "afterCommit": {"oid": "94051c8059c31b13fc550225514676fa0f2d0d8d", "author": {"user": {"login": "srahman-qubole", "name": "Syed Shameerur Rahman"}}, "url": "https://github.com/apache/hive/commit/94051c8059c31b13fc550225514676fa0f2d0d8d", "committedDate": "2020-07-31T14:58:55Z", "message": "Add more test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MTc3NDIz", "url": "https://github.com/apache/hive/pull/1271#pullrequestreview-484177423", "createdAt": "2020-09-08T14:07:47Z", "commit": {"oid": "b2d6235d46e73a1966f37d3ef0d87279780b93aa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNDowNzo0N1rOHOe8mA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNDowNzo0N1rOHOe8mA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk0OTE0NA==", "bodyText": "I don't know - have you explored using the SA approach ? seeing the ql class thru reflection looks a bit wierd.\nother way around could be to move Expr related classes out from ql (not sure if that's possible)", "url": "https://github.com/apache/hive/pull/1271#discussion_r484949144", "createdAt": "2020-09-08T14:07:47Z", "author": {"login": "kgyrtkirk"}, "path": "standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/MsckPartitionExpressionProxy.java", "diffHunk": "@@ -1,114 +0,0 @@\n-package org.apache.hadoop.hive.metastore;\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- * <p>\n- * http://www.apache.org/licenses/LICENSE-2.0\n- * <p>\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-\n-import java.nio.charset.StandardCharsets;\n-import java.util.ArrayList;\n-import java.util.HashSet;\n-import java.util.List;\n-import java.util.Set;\n-\n-import org.apache.hadoop.hive.metastore.api.FieldSchema;\n-import org.apache.hadoop.hive.metastore.api.FileMetadataExprType;\n-import org.apache.hadoop.hive.metastore.api.MetaException;\n-import org.apache.hadoop.hive.metastore.utils.FileUtils;\n-import org.apache.hadoop.hive.ql.io.sarg.SearchArgument;\n-import org.apache.hadoop.util.StringUtils;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-\n-// This is added as part of moving MSCK code from ql to standalone-metastore. There is a metastore API to drop\n-// partitions by name but we cannot use it because msck typically will contain partition value (year=2014). We almost\n-// never drop partition by name (year). So we need to construct expression filters, the current\n-// PartitionExpressionProxy implementations (PartitionExpressionForMetastore and HCatClientHMSImpl.ExpressionBuilder)\n-// all depend on ql code to build ExprNodeDesc for the partition expressions. It also depends on kryo for serializing\n-// the expression objects to byte[]. For MSCK drop partition, we don't need complex expression generator. For now,\n-// all we do is split the partition spec (year=2014/month=24) into filter expression year='2014' and month='24' and\n-// rely on metastore database to deal with type conversions. Ideally, PartitionExpressionProxy default implementation\n-// should use SearchArgument (storage-api) to construct the filter expression and not depend on ql, but the usecase\n-// for msck is pretty simple and this specific implementation should suffice.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2d6235d46e73a1966f37d3ef0d87279780b93aa"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b4e3836b827d8573459f60b18d290e29ff4b5db", "author": {"user": {"login": "srahman-qubole", "name": "Syed Shameerur Rahman"}}, "url": "https://github.com/apache/hive/commit/1b4e3836b827d8573459f60b18d290e29ff4b5db", "committedDate": "2020-09-09T11:18:45Z", "message": "HIVE-23851: MSCK REPAIR Command With Partition Filtering Fails While Dropping Partitions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "822d80aeab42d00bd54ed2ff775937edd2dc6640", "author": {"user": {"login": "srahman-qubole", "name": "Syed Shameerur Rahman"}}, "url": "https://github.com/apache/hive/commit/822d80aeab42d00bd54ed2ff775937edd2dc6640", "committedDate": "2020-09-09T14:08:46Z", "message": "Refactorig"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18fad95a2fc2031d0bb1484ba9e10386d12219aa", "author": {"user": {"login": "srahman-qubole", "name": "Syed Shameerur Rahman"}}, "url": "https://github.com/apache/hive/commit/18fad95a2fc2031d0bb1484ba9e10386d12219aa", "committedDate": "2020-09-09T14:37:50Z", "message": "Renaming flags"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2d6235d46e73a1966f37d3ef0d87279780b93aa", "author": {"user": {"login": "srahman-qubole", "name": "Syed Shameerur Rahman"}}, "url": "https://github.com/apache/hive/commit/b2d6235d46e73a1966f37d3ef0d87279780b93aa", "committedDate": "2020-08-01T00:02:44Z", "message": "Trigger Build"}, "afterCommit": {"oid": "18fad95a2fc2031d0bb1484ba9e10386d12219aa", "author": {"user": {"login": "srahman-qubole", "name": "Syed Shameerur Rahman"}}, "url": "https://github.com/apache/hive/commit/18fad95a2fc2031d0bb1484ba9e10386d12219aa", "committedDate": "2020-09-09T14:37:50Z", "message": "Renaming flags"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a61a2a5fdf78d7f129449a4490b66e06073f9a32", "author": {"user": {"login": "srahman-qubole", "name": "Syed Shameerur Rahman"}}, "url": "https://github.com/apache/hive/commit/a61a2a5fdf78d7f129449a4490b66e06073f9a32", "committedDate": "2020-09-29T07:37:52Z", "message": "Refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzNzk3NTIy", "url": "https://github.com/apache/hive/pull/1271#pullrequestreview-503797522", "createdAt": "2020-10-07T11:53:44Z", "commit": {"oid": "a61a2a5fdf78d7f129449a4490b66e06073f9a32"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3568, "cost": 1, "resetAt": "2021-10-29T19:57:52Z"}}}