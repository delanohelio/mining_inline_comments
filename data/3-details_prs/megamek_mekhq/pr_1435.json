{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4NjU5Mzk5", "number": 1435, "title": "Fix and log invalid lc ammo bin", "bodyText": "Corrects an issue where campaigns fail to load due to an invalid class cast to largecraftammobin\nThis happens infrequently with dropship refits.  Fix allows the campaign to load anyway and logs which ship and equipment number are bugged so the unit can be repaired.", "createdAt": "2020-01-29T16:46:17Z", "url": "https://github.com/MegaMek/mekhq/pull/1435", "merged": true, "mergeCommit": {"oid": "07b9ea95e159b8058380dafa9ad7b453e9a1a99b"}, "closed": true, "closedAt": "2020-01-30T02:49:09Z", "author": {"login": "mkerensky"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_ItOoAH2gAyMzY4NjU5Mzk5OjY4ZGY5YjZhNjk2NTlhYTAyODk2MDY4OTY4MzViYjgxZjMxMDhjYWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_JF-nAFqTM1MDI3NTkxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "68df9b6a69659aa0289606896835bb81f3108cac", "author": {"user": {"login": "mkerensky", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/68df9b6a69659aa0289606896835bb81f3108cac", "committedDate": "2020-01-29T16:40:48Z", "message": "Fix and log invalid lc ammo bin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMjYzMDg4", "url": "https://github.com/MegaMek/mekhq/pull/1435#pullrequestreview-350263088", "createdAt": "2020-01-29T16:50:40Z", "commit": {"oid": "68df9b6a69659aa0289606896835bb81f3108cac"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNjo1MDo0MFrOFjP0mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNjo1MDo0MFrOFjP0mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUwMzcwNw==", "bodyText": "You definitely need a null check on mounted before calling mounted.getType(). I'd suggest moving the logic from the if statement on line 280 into the if statement on line 276, then making 280 an \"else\".", "url": "https://github.com/MegaMek/mekhq/pull/1435#discussion_r372503707", "createdAt": "2020-01-29T16:50:40Z", "author": {"login": "apokrovski"}, "path": "MekHQ/src/mekhq/campaign/parts/equipment/LargeCraftAmmoBin.java", "diffHunk": "@@ -270,9 +270,14 @@ public MissingPart getMissingPart() {\n \n     @Override\n     public void updateConditionFromEntity(boolean checkForDestruction) {\n+        final String METHOD_NAME = \"updateConditionFromEntity()\"; //$NON-NLS-1$\n         if(null != unit) {\n             Mounted mounted = unit.getEntity().getEquipment(equipmentNum);\n-            if(null != mounted) {\n+            if (!(mounted.getType() instanceof AmmoType)) {\n+                MekHQ.getLogger().log(LargeCraftAmmoBin.class, METHOD_NAME, LogLevel.WARNING,\n+                        unit.getName() + \" has invalid ammo bin at equipment number \" + equipmentNum);\n+            }\n+            if(null != mounted && mounted.getType() instanceof AmmoType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68df9b6a69659aa0289606896835bb81f3108cac"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMjY0NDI3", "url": "https://github.com/MegaMek/mekhq/pull/1435#pullrequestreview-350264427", "createdAt": "2020-01-29T16:52:28Z", "commit": {"oid": "68df9b6a69659aa0289606896835bb81f3108cac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNjo1MjoyOFrOFjP4nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNjo1MjoyOFrOFjP4nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUwNDczMg==", "bodyText": "Mounted can't be null at this point because if it were it would have thrown a NullPointerException on line 276. If it's possible that this is null, then that needs to be part of the check (which should also be logged, since that's also a problem).", "url": "https://github.com/MegaMek/mekhq/pull/1435#discussion_r372504732", "createdAt": "2020-01-29T16:52:28Z", "author": {"login": "neoancient"}, "path": "MekHQ/src/mekhq/campaign/parts/equipment/LargeCraftAmmoBin.java", "diffHunk": "@@ -270,9 +270,14 @@ public MissingPart getMissingPart() {\n \n     @Override\n     public void updateConditionFromEntity(boolean checkForDestruction) {\n+        final String METHOD_NAME = \"updateConditionFromEntity()\"; //$NON-NLS-1$\n         if(null != unit) {\n             Mounted mounted = unit.getEntity().getEquipment(equipmentNum);\n-            if(null != mounted) {\n+            if (!(mounted.getType() instanceof AmmoType)) {\n+                MekHQ.getLogger().log(LargeCraftAmmoBin.class, METHOD_NAME, LogLevel.WARNING,\n+                        unit.getName() + \" has invalid ammo bin at equipment number \" + equipmentNum);\n+            }\n+            if(null != mounted && mounted.getType() instanceof AmmoType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68df9b6a69659aa0289606896835bb81f3108cac"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46d7327c07911d6e7d5fa15cd231ed97a9640726", "author": {"user": {"login": "mkerensky", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/46d7327c07911d6e7d5fa15cd231ed97a9640726", "committedDate": "2020-01-29T17:05:52Z", "message": "Improves log message and logs null mounted"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMjc1OTEw", "url": "https://github.com/MegaMek/mekhq/pull/1435#pullrequestreview-350275910", "createdAt": "2020-01-29T17:07:50Z", "commit": {"oid": "46d7327c07911d6e7d5fa15cd231ed97a9640726"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4444, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}