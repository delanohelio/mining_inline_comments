{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0MDMzNDQ3", "number": 2308, "title": "Add EquipmentPart unit tests", "bodyText": "This PR adds EquipmentPart unit tests and fixes five bugs found along the way:\n\nVariable weight sizes were not saved in some circumstances.\nWeapon Bays weren't checked for destruction in remove. Well, they weren't before due to a bug, then removed as a \"dead code path\". This restores it.\nLAM bomb bays always reported 60 minutes to fix, even when not broken.\nMissingEquipmentPart's did not apply variable sized sticker prices correctly\nMissingEquipmentPart did not override MissingPart::clone\n\nTODO:\n\n EquipmentPart::checkWeaponBay Test\n MissingEquipmentPart tests", "createdAt": "2020-12-22T10:40:32Z", "url": "https://github.com/MegaMek/mekhq/pull/2308", "merged": true, "mergeCommit": {"oid": "03a9d1a083aa392490ba1f01f9efb9db6df7f981"}, "closed": true, "closedAt": "2020-12-25T02:15:28Z", "author": {"login": "sixlettervariables"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdooKmNgBqjQxMzk2MDE2MDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdpd86zgFqTU1ODczMDg5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f5444024acf3ec3c0b12d58dc0b75929b432aee3", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/f5444024acf3ec3c0b12d58dc0b75929b432aee3", "committedDate": "2020-12-22T10:38:01Z", "message": "Cleanup checkWeaponBay and add it back to remove"}, "afterCommit": {"oid": "9f85cfbb13271bd37356b4e16394d66b179c320d", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/9f85cfbb13271bd37356b4e16394d66b179c320d", "committedDate": "2020-12-22T10:41:49Z", "message": "Cleanup checkWeaponBay and add it back to remove"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MDU5NjE5", "url": "https://github.com/MegaMek/mekhq/pull/2308#pullrequestreview-558059619", "createdAt": "2020-12-23T16:30:00Z", "commit": {"oid": "a22d75bcad9e385ffde189c6c46769a06048f245"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNjozMDowMVrOIKpyKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNzowNDo0MVrOIKqsEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA0MTI1Ng==", "bodyText": "Not even going to ask why we're passing around string location names.", "url": "https://github.com/MegaMek/mekhq/pull/2308#discussion_r548041256", "createdAt": "2020-12-23T16:30:01Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/parts/equipment/EquipmentPart.java", "diffHunk": "@@ -633,46 +633,24 @@ public boolean isOmniPoddable() {\n \n     @Override\n     public String getLocationName() {\n-        if (null != unit) {\n-            Mounted mounted = unit.getEntity().getEquipment(equipmentNum);\n-            if (null != mounted && mounted.getLocation() != -1) {\n-                return unit.getEntity().getLocationName(mounted.getLocation());\n-            }\n+        final Mounted mounted = getMounted();\n+        if ((mounted != null) && (mounted.getLocation() != Entity.LOC_NONE)) {\n+            return getUnit().getEntity().getLocationName(mounted.getLocation());\n         }\n+\n         return null;\n     }\n \n     @Override\n     public boolean isInLocation(String loc) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a22d75bcad9e385ffde189c6c46769a06048f245"}, "originalPosition": 429}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA1NjA4MQ==", "bodyText": "Do we want to un-set the unit afterwards?", "url": "https://github.com/MegaMek/mekhq/pull/2308#discussion_r548056081", "createdAt": "2020-12-23T17:04:41Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/parts/equipment/MissingEquipmentPart.java", "diffHunk": "@@ -178,149 +188,118 @@ public boolean isAcceptableReplacement(Part part, boolean refit) {\n         //they are not acceptable substitutes, so we need to check for that as\n         //well\n         //http://bg.battletech.com/forums/strategic-operations/(answered)-can-a-lance-for-a-35-ton-mech-be-used-on-a-40-ton-mech-and-so-on/\n-        Part newPart = getNewPart();\n-        newPart.setUnit(unit);\n-        if(part instanceof EquipmentPart) {\n-            EquipmentPart eqpart = (EquipmentPart)part;\n-            EquipmentType et = eqpart.getType();\n-            return (type.equals(et) && getTonnage() == part.getTonnage())\n-                    && (size == eqpart.getSize())\n-                    && part.getStickerPrice().equals(newPart.getStickerPrice());\n+        EquipmentPart newPart = getNewPart();\n+        newPart.setEquipmentNum(getEquipmentNum());\n+        newPart.setUnit(unit); // CAW: find a way to do this without setting a unit", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a22d75bcad9e385ffde189c6c46769a06048f245"}, "originalPosition": 88}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MTc2Njk0", "url": "https://github.com/MegaMek/mekhq/pull/2308#pullrequestreview-558176694", "createdAt": "2020-12-23T18:58:26Z", "commit": {"oid": "a22d75bcad9e385ffde189c6c46769a06048f245"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cf1746e45c57975925f50945f86e6bf3c80961c", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/7cf1746e45c57975925f50945f86e6bf3c80961c", "committedDate": "2020-12-24T14:24:24Z", "message": "Fix bug with variable equipment sizing not saving\n\nUse more derived class for getMissingPart\n\nUse LOC_NONE instead of -1 for equipment numbers\n\nAdd basic EquipmentPart tests\n\nAdd EquipmentPart::getMounted helper\n\nAdd Part::setHits to help testing repair actions\n\nAdd needsFixing and fix tests\n\nAdd isPartForEquipment and omnipoddable tests\n\nAdd getLocationName test\n\nAdd busted/destroyed location tests\n\nAdd checkFixable test and revise other tests\n\nCleanup EquipmentPart mounted location code\n\nCleanup checkWeaponBay and add it back to remove\n\nUse Mounted::isSplit to check for a secondary location\n\nAdd update condition tests\n\n...and fix LGTM nits.\n\nAdd isInLocation test\n\nAdd getBaseTime test\n\n- Fix bug where LAM bomb bays reported 60 minutes even when fixed\n\nAdd isSamePartType test\n\nUpdate MissingEquipmentPart to match EquipmentPart\n\nAdd MissingPart tests\n\n- Fix MissingPart::isAcceptableReplacement to take into account variable costs\n\nDon't log if there is supposed to be no equipment\n\nAdd checkWeaponBay tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95327db1c22e07124b36f44b281a43f0c1e0bf87", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/95327db1c22e07124b36f44b281a43f0c1e0bf87", "committedDate": "2020-12-24T14:24:30Z", "message": "Update history.txt"}, "afterCommit": {"oid": "7cf1746e45c57975925f50945f86e6bf3c80961c", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/7cf1746e45c57975925f50945f86e6bf3c80961c", "committedDate": "2020-12-24T14:24:24Z", "message": "Fix bug with variable equipment sizing not saving\n\nUse more derived class for getMissingPart\n\nUse LOC_NONE instead of -1 for equipment numbers\n\nAdd basic EquipmentPart tests\n\nAdd EquipmentPart::getMounted helper\n\nAdd Part::setHits to help testing repair actions\n\nAdd needsFixing and fix tests\n\nAdd isPartForEquipment and omnipoddable tests\n\nAdd getLocationName test\n\nAdd busted/destroyed location tests\n\nAdd checkFixable test and revise other tests\n\nCleanup EquipmentPart mounted location code\n\nCleanup checkWeaponBay and add it back to remove\n\nUse Mounted::isSplit to check for a secondary location\n\nAdd update condition tests\n\n...and fix LGTM nits.\n\nAdd isInLocation test\n\nAdd getBaseTime test\n\n- Fix bug where LAM bomb bays reported 60 minutes even when fixed\n\nAdd isSamePartType test\n\nUpdate MissingEquipmentPart to match EquipmentPart\n\nAdd MissingPart tests\n\n- Fix MissingPart::isAcceptableReplacement to take into account variable costs\n\nDon't log if there is supposed to be no equipment\n\nAdd checkWeaponBay tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4NzMwODk4", "url": "https://github.com/MegaMek/mekhq/pull/2308#pullrequestreview-558730898", "createdAt": "2020-12-25T01:21:55Z", "commit": {"oid": "7cf1746e45c57975925f50945f86e6bf3c80961c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3959, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}