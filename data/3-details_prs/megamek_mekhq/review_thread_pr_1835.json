{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MTEyNzg0", "number": 1835, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxOTo0Mjo1OFrOELUbEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxOTo0NTozM1rOELUcRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMzA0NDAzOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/gui/view/ContractSummaryPanel.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxOTo0Mjo1OFrOGs29BA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQwMTowMDoxNlrOGs5EMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MDg4NA==", "bodyText": "This seems more awkward than the previous syntax, is there any way to make it less, uh...", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449690884", "createdAt": "2020-07-03T19:42:58Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/gui/view/ContractSummaryPanel.java", "diffHunk": "@@ -226,7 +226,9 @@ public void mouseClicked(MouseEvent e) {\n             mainPanel.add(lblDistance, gridBagConstraintsLabels);\n \n             JumpPath path = campaign.calculateJumpPath(campaign.getCurrentSystem(), contract.getSystem());\n-            int days = (int) Math.ceil(path.getTotalTime(Utilities.getDateTimeDay(contract.getStartDate()),\n+\n+            int days = (int) Math.ceil(path.getTotalTime(\n+                    contract.getStartDate().toInstant().atZone(ZoneId.systemDefault()).toLocalDate(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "618da4a9b5b8c69fe8967107936b0d18bd561e57"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MTU1MA==", "bodyText": "This is temporary, until I switch contracts to LocalDate", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449691550", "createdAt": "2020-07-03T19:46:49Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/view/ContractSummaryPanel.java", "diffHunk": "@@ -226,7 +226,9 @@ public void mouseClicked(MouseEvent e) {\n             mainPanel.add(lblDistance, gridBagConstraintsLabels);\n \n             JumpPath path = campaign.calculateJumpPath(campaign.getCurrentSystem(), contract.getSystem());\n-            int days = (int) Math.ceil(path.getTotalTime(Utilities.getDateTimeDay(contract.getStartDate()),\n+\n+            int days = (int) Math.ceil(path.getTotalTime(\n+                    contract.getStartDate().toInstant().atZone(ZoneId.systemDefault()).toLocalDate(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MDg4NA=="}, "originalCommit": {"oid": "618da4a9b5b8c69fe8967107936b0d18bd561e57"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcyNTQ4OQ==", "bodyText": "Sounds good.", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449725489", "createdAt": "2020-07-04T01:00:16Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/gui/view/ContractSummaryPanel.java", "diffHunk": "@@ -226,7 +226,9 @@ public void mouseClicked(MouseEvent e) {\n             mainPanel.add(lblDistance, gridBagConstraintsLabels);\n \n             JumpPath path = campaign.calculateJumpPath(campaign.getCurrentSystem(), contract.getSystem());\n-            int days = (int) Math.ceil(path.getTotalTime(Utilities.getDateTimeDay(contract.getStartDate()),\n+\n+            int days = (int) Math.ceil(path.getTotalTime(\n+                    contract.getStartDate().toInstant().atZone(ZoneId.systemDefault()).toLocalDate(),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MDg4NA=="}, "originalCommit": {"oid": "618da4a9b5b8c69fe8967107936b0d18bd561e57"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMzA0NzExOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/universe/Planet.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxOTo0NTozM1rOGs2-qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNjo1OTo0MlrOGtDlWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MTMwNg==", "bodyText": "This seems like it's a behavior change from existing behavior, can you go into a little detail on why it was done?", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449691306", "createdAt": "2020-07-03T19:45:33Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/universe/Planet.java", "diffHunk": "@@ -314,18 +297,22 @@ public Planet(String tsvData, List<DateTime> years) throws Exception {\n \n                 // dirty hack here assumes that there's only one faction per event, which is true in the case\n                 // of this spreadsheet\n-                if(x == 3 || !eventList.get(eventList.size() - 1).faction.get(0).equals(newFaction)) {\n-                    PlanetaryEvent pe = new PlanetaryEvent();\n-                    DateTime eventDate = years.get(x - 3);\n-                    pe.faction = new ArrayList<String>();\n+                if ((x == 3) || !eventList.get(eventList.size() - 1).faction.get(0).equals(newFaction)) {\n+                    LocalDate eventDate = years.get(x - 3);\n+\n+                    PlanetaryEvent pe = events.getOrDefault(eventDate, new PlanetaryEvent());\n+                    pe.faction = new ArrayList<>();\n                     pe.faction.add(newFaction);\n-                    pe.date = eventDate;\n \n-                    this.eventList.add(pe);\n-                    this.events.put(eventDate, pe);\n+                    if (!events.containsKey(eventDate)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "618da4a9b5b8c69fe8967107936b0d18bd561e57"}, "originalPosition": 185}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc3NzE1Ng==", "bodyText": "This was done to improve the code in question (as a single event can change anything on a given day) by removing the same day event hack of placing an event slightly later in the day, which is no longer possible (LocalDate only stores year, month, day). It was also significantly easier to do this than replace it with LocalDateTime, which would require conversions.", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449777156", "createdAt": "2020-07-04T14:21:11Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/universe/Planet.java", "diffHunk": "@@ -314,18 +297,22 @@ public Planet(String tsvData, List<DateTime> years) throws Exception {\n \n                 // dirty hack here assumes that there's only one faction per event, which is true in the case\n                 // of this spreadsheet\n-                if(x == 3 || !eventList.get(eventList.size() - 1).faction.get(0).equals(newFaction)) {\n-                    PlanetaryEvent pe = new PlanetaryEvent();\n-                    DateTime eventDate = years.get(x - 3);\n-                    pe.faction = new ArrayList<String>();\n+                if ((x == 3) || !eventList.get(eventList.size() - 1).faction.get(0).equals(newFaction)) {\n+                    LocalDate eventDate = years.get(x - 3);\n+\n+                    PlanetaryEvent pe = events.getOrDefault(eventDate, new PlanetaryEvent());\n+                    pe.faction = new ArrayList<>();\n                     pe.faction.add(newFaction);\n-                    pe.date = eventDate;\n \n-                    this.eventList.add(pe);\n-                    this.events.put(eventDate, pe);\n+                    if (!events.containsKey(eventDate)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MTMwNg=="}, "originalCommit": {"oid": "618da4a9b5b8c69fe8967107936b0d18bd561e57"}, "originalPosition": 185}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg4NzQzMQ==", "bodyText": "Sounds good in theory, although in practice, we'll need to take a look at the planetary events data and see if we have any events like that which will need to be merged (in order to avoid throwing away any events past the first).", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449887431", "createdAt": "2020-07-05T15:02:51Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/universe/Planet.java", "diffHunk": "@@ -314,18 +297,22 @@ public Planet(String tsvData, List<DateTime> years) throws Exception {\n \n                 // dirty hack here assumes that there's only one faction per event, which is true in the case\n                 // of this spreadsheet\n-                if(x == 3 || !eventList.get(eventList.size() - 1).faction.get(0).equals(newFaction)) {\n-                    PlanetaryEvent pe = new PlanetaryEvent();\n-                    DateTime eventDate = years.get(x - 3);\n-                    pe.faction = new ArrayList<String>();\n+                if ((x == 3) || !eventList.get(eventList.size() - 1).faction.get(0).equals(newFaction)) {\n+                    LocalDate eventDate = years.get(x - 3);\n+\n+                    PlanetaryEvent pe = events.getOrDefault(eventDate, new PlanetaryEvent());\n+                    pe.faction = new ArrayList<>();\n                     pe.faction.add(newFaction);\n-                    pe.date = eventDate;\n \n-                    this.eventList.add(pe);\n-                    this.events.put(eventDate, pe);\n+                    if (!events.containsKey(eventDate)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MTMwNg=="}, "originalCommit": {"oid": "618da4a9b5b8c69fe8967107936b0d18bd561e57"}, "originalPosition": 185}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5Njc5Mg==", "bodyText": "That is already handled in the code, this is just a place that was missed.", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449896792", "createdAt": "2020-07-05T16:47:25Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/universe/Planet.java", "diffHunk": "@@ -314,18 +297,22 @@ public Planet(String tsvData, List<DateTime> years) throws Exception {\n \n                 // dirty hack here assumes that there's only one faction per event, which is true in the case\n                 // of this spreadsheet\n-                if(x == 3 || !eventList.get(eventList.size() - 1).faction.get(0).equals(newFaction)) {\n-                    PlanetaryEvent pe = new PlanetaryEvent();\n-                    DateTime eventDate = years.get(x - 3);\n-                    pe.faction = new ArrayList<String>();\n+                if ((x == 3) || !eventList.get(eventList.size() - 1).faction.get(0).equals(newFaction)) {\n+                    LocalDate eventDate = years.get(x - 3);\n+\n+                    PlanetaryEvent pe = events.getOrDefault(eventDate, new PlanetaryEvent());\n+                    pe.faction = new ArrayList<>();\n                     pe.faction.add(newFaction);\n-                    pe.date = eventDate;\n \n-                    this.eventList.add(pe);\n-                    this.events.put(eventDate, pe);\n+                    if (!events.containsKey(eventDate)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MTMwNg=="}, "originalCommit": {"oid": "618da4a9b5b8c69fe8967107936b0d18bd561e57"}, "originalPosition": 185}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5Njg1NQ==", "bodyText": "Although the changes should use that method, so I'll fit that bit.", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449896855", "createdAt": "2020-07-05T16:48:18Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/universe/Planet.java", "diffHunk": "@@ -314,18 +297,22 @@ public Planet(String tsvData, List<DateTime> years) throws Exception {\n \n                 // dirty hack here assumes that there's only one faction per event, which is true in the case\n                 // of this spreadsheet\n-                if(x == 3 || !eventList.get(eventList.size() - 1).faction.get(0).equals(newFaction)) {\n-                    PlanetaryEvent pe = new PlanetaryEvent();\n-                    DateTime eventDate = years.get(x - 3);\n-                    pe.faction = new ArrayList<String>();\n+                if ((x == 3) || !eventList.get(eventList.size() - 1).faction.get(0).equals(newFaction)) {\n+                    LocalDate eventDate = years.get(x - 3);\n+\n+                    PlanetaryEvent pe = events.getOrDefault(eventDate, new PlanetaryEvent());\n+                    pe.faction = new ArrayList<>();\n                     pe.faction.add(newFaction);\n-                    pe.date = eventDate;\n \n-                    this.eventList.add(pe);\n-                    this.events.put(eventDate, pe);\n+                    if (!events.containsKey(eventDate)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MTMwNg=="}, "originalCommit": {"oid": "618da4a9b5b8c69fe8967107936b0d18bd561e57"}, "originalPosition": 185}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NzgxNw==", "bodyText": "And the changes are fixed, it properly adds it to the eventList now without causing issues from duplicate events (which currently will occur).", "url": "https://github.com/MegaMek/mekhq/pull/1835#discussion_r449897817", "createdAt": "2020-07-05T16:59:42Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/universe/Planet.java", "diffHunk": "@@ -314,18 +297,22 @@ public Planet(String tsvData, List<DateTime> years) throws Exception {\n \n                 // dirty hack here assumes that there's only one faction per event, which is true in the case\n                 // of this spreadsheet\n-                if(x == 3 || !eventList.get(eventList.size() - 1).faction.get(0).equals(newFaction)) {\n-                    PlanetaryEvent pe = new PlanetaryEvent();\n-                    DateTime eventDate = years.get(x - 3);\n-                    pe.faction = new ArrayList<String>();\n+                if ((x == 3) || !eventList.get(eventList.size() - 1).faction.get(0).equals(newFaction)) {\n+                    LocalDate eventDate = years.get(x - 3);\n+\n+                    PlanetaryEvent pe = events.getOrDefault(eventDate, new PlanetaryEvent());\n+                    pe.faction = new ArrayList<>();\n                     pe.faction.add(newFaction);\n-                    pe.date = eventDate;\n \n-                    this.eventList.add(pe);\n-                    this.events.put(eventDate, pe);\n+                    if (!events.containsKey(eventDate)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5MTMwNg=="}, "originalCommit": {"oid": "618da4a9b5b8c69fe8967107936b0d18bd561e57"}, "originalPosition": 185}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2346, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}