{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NjQ4OTc5", "number": 2189, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTozNTowNFrOE2Nozw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTo0ODo1M1rOE2N4YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MjgxOTk5OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTozNTowNFrOHu68AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTozNTowNFrOHu68AQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk2MjE3Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                getCampaign().getShoppingList().addShoppingItem((Armor)newArmorSupplies.getNewPart(),1,getCampaign());\n          \n          \n            \n                                getCampaign().getShoppingList().addShoppingItem((Armor) newArmorSupplies.getNewPart(), 1, getCampaign());", "url": "https://github.com/MegaMek/mekhq/pull/2189#discussion_r518962177", "createdAt": "2020-11-06T19:35:04Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "diffHunk": "@@ -1126,7 +1130,7 @@ else if (part instanceof IAcquisitionWork) {\n                 }\n                 while(armorSupplied < armorNeeded) {\n                     armorSupplied += ((Armor)newArmorSupplies.getNewPart()).getAmount();\n-                    oldUnit.getCampaign().getShoppingList().addShoppingItem((Armor)newArmorSupplies.getNewPart(),1,oldUnit.getCampaign());\n+                    getCampaign().getShoppingList().addShoppingItem((Armor)newArmorSupplies.getNewPart(),1,getCampaign());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5382ad3a6c68d00fad1a9e1c6449d10268e35c64"}, "originalPosition": 108}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MjgyMzA1OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTozNTo1NlrOHu690Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTozNTo1NlrOHu690Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk2MjY0MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            Part suit = new BattleArmorSuit((BattleArmor)newEntity, t, getCampaign());\n          \n          \n            \n                            Part suit = new BattleArmorSuit((BattleArmor) newEntity, t, getCampaign());", "url": "https://github.com/MegaMek/mekhq/pull/2189#discussion_r518962641", "createdAt": "2020-11-06T19:35:56Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "diffHunk": "@@ -1426,7 +1430,7 @@ private void complete() {\n         //We've already made the old suits go *poof*; now we materialize new ones.\n         if (newEntity instanceof BattleArmor) {\n             for (int t = BattleArmor.LOC_TROOPER_1; t < newEntity.locations(); t++) {\n-                Part suit = new BattleArmorSuit((BattleArmor)newEntity, t, oldUnit.getCampaign());\n+                Part suit = new BattleArmorSuit((BattleArmor)newEntity, t, getCampaign());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5382ad3a6c68d00fad1a9e1c6449d10268e35c64"}, "originalPosition": 258}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1MjgzMjUzOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTozOToyNlrOHu7D3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTozOToyNlrOHu7D3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk2NDE5MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    pw1.println(MekHqXmlUtil.writeEntityToXmlString(newEntity, indentLvl+1, getCampaign().getEntities()));\n          \n          \n            \n                    pw1.println(MekHqXmlUtil.writeEntityToXmlString(newEntity, indentLvl + 1, getCampaign().getEntities()));", "url": "https://github.com/MegaMek/mekhq/pull/2189#discussion_r518964190", "createdAt": "2020-11-06T19:39:26Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "diffHunk": "@@ -1891,7 +1895,7 @@ public String checkFixable() {\n     @Override\n     public void writeToXml(PrintWriter pw1, int indentLvl) {\n         pw1.println(MekHqXmlUtil.indentStr(indentLvl) + \"<refit>\");\n-        pw1.println(MekHqXmlUtil.writeEntityToXmlString(newEntity, indentLvl+1, oldUnit.getCampaign().getEntities()));\n+        pw1.println(MekHqXmlUtil.writeEntityToXmlString(newEntity, indentLvl+1, getCampaign().getEntities()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5382ad3a6c68d00fad1a9e1c6449d10268e35c64"}, "originalPosition": 369}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1Mjg1MzYxOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTo0Njo0MVrOHu7Qrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTo0Njo0MVrOHu7Qrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk2NzQ3MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    //      location...but I don't think that's likely.\n          \n          \n            \n                    //      location... but I don't think that's likely.", "url": "https://github.com/MegaMek/mekhq/pull/2189#discussion_r518967471", "createdAt": "2020-11-06T19:46:41Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "diffHunk": "@@ -74,39 +71,32 @@ public AmmoStorage clone() {\n     \treturn storage;\n     }\n \n+    @Override\n+    public AmmoType getType() {\n+        return (AmmoType) super.getType();\n+    }\n+\n     @Override\n     public double getTonnage() {\n-    \tif(((AmmoType)type).getKgPerShot() > 0) {\n-    \t\treturn ((AmmoType)type).getKgPerShot() * shots/1000.0;\n+    \tif (getType().getKgPerShot() > 0) {\n+    \t\treturn getType().getKgPerShot() * shots/1000.0;\n     \t}\n-     \treturn ((double)shots / ((AmmoType)type).getShots());\n+     \treturn ((double)shots / getType().getShots());\n     }\n \n     @Override\n     public Money getStickerPrice() {\n-    \t//costs are a total nightmare\n-        //some costs depend on entity, but we can't do it that way\n-        //because spare parts don't have entities. If parts start on an entity\n-        //that's fine, but this will become problematic when we set up a parts\n-        //store. For now I am just going to pass in a null entity and attempt\n-    \t//to catch any resulting NPEs\n-    \tEntity en = null;\n-    \tboolean isArmored = false;\n-    \tif (unit != null) {\n-            en = unit.getEntity();\n-            Mounted mounted = unit.getEntity().getEquipment(equipmentNum);\n-            if(null != mounted) {\n-            \tisArmored = mounted.isArmored();\n-            }\n-    \t}\n-\n-        Money itemCost = Money.zero();\n-        try {\n-        \titemCost = itemCost.plus(type.getCost(en, isArmored, -1));\n-        } catch(NullPointerException ex) {\n-            MekHQ.getLogger().error(AmmoStorage.class, \"getStickerPrice\", ex);\n-        }\n-    \treturn itemCost;\n+        // CAW: previously we went thru AmmoType::getCost, which\n+        //      for AmmoType was the default implementation\n+        //      that simply returned 'cost'. Avoid the hassle for\n+        //      now and just return the raw cost as our sticker price.\n+        //\n+        //      We should revisit this if you can ever have ammo that\n+        //      should be sold for more based on the unit which carries\n+        //      it, or which location the ammo is stored in, or if\n+        //      the unit which carries the ammo does so in an armored\n+        //      location...but I don't think that's likely.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5382ad3a6c68d00fad1a9e1c6449d10268e35c64"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1Mjg1NDc5OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTo0NzowM1rOHu7Rbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTo0NzowM1rOHu7Rbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk2NzY2Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            return getType().getMunitionType() == ((AmmoStorage)part).getType().getMunitionType()\n          \n          \n            \n                                    && getType().equals( (Object)((EquipmentPart)part).getType());\n          \n          \n            \n                            return getType().getMunitionType() == ((AmmoStorage) part).getType().getMunitionType()\n          \n          \n            \n                                    && getType().equals( (Object) ((EquipmentPart) part).getType());", "url": "https://github.com/MegaMek/mekhq/pull/2189#discussion_r518967662", "createdAt": "2020-11-06T19:47:03Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "diffHunk": "@@ -136,8 +126,8 @@ public boolean isSamePartType(Part part) {\n                 return ((EquipmentPart)part).getType() instanceof BombType\n                         && ((BombType)getType()).getBombType() == ((BombType)((EquipmentPart)part).getType()).getBombType();\n             } else {\n-                return ((AmmoType)getType()).getMunitionType() == ((AmmoType)((AmmoStorage)part).getType()).getMunitionType()\n-                        && ((AmmoType)getType()).equals( (Object)((EquipmentPart)part).getType());\n+                return getType().getMunitionType() == ((AmmoStorage)part).getType().getMunitionType()\n+                        && getType().equals( (Object)((EquipmentPart)part).getType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5382ad3a6c68d00fad1a9e1c6449d10268e35c64"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1Mjg1NTYyOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTo0NzoxN1rOHu7R9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTo0NzoxN1rOHu7R9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk2Nzc5OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            && ((AmmoStorage)part).getType().equals(curType)\n          \n          \n            \n                            && ((AmmoStorage) part).getType().equals(curType)", "url": "https://github.com/MegaMek/mekhq/pull/2189#discussion_r518967798", "createdAt": "2020-11-06T19:47:17Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "diffHunk": "@@ -293,8 +283,8 @@ public String failToFind() {\n     public static boolean IsRightAmmo(Part part, AmmoType curType) {\n         return part instanceof AmmoStorage\n                 && part.isPresent()\n-                && ((AmmoType)((AmmoStorage)part).getType()).equals(curType)\n-                && curType.getMunitionType() == ((AmmoType) ((AmmoStorage) part).getType()).getMunitionType();\n+                && ((AmmoStorage)part).getType().equals(curType)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5382ad3a6c68d00fad1a9e1c6449d10268e35c64"}, "originalPosition": 135}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1Mjg1ODk0OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTo0ODozN1rOHu7UHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTo0ODozN1rOHu7UHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk2ODM1MQ==", "bodyText": "Formatting looks odd...", "url": "https://github.com/MegaMek/mekhq/pull/2189#discussion_r518968351", "createdAt": "2020-11-06T19:48:37Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "diffHunk": "@@ -61,8 +58,8 @@ public AmmoStorage() {\n     public AmmoStorage(int tonnage, EquipmentType et, int shots, Campaign c) {\n         super(tonnage, et, -1, 1.0, c);\n         this.shots = shots;\n-        if(null != type && type instanceof AmmoType) {\n-        \tthis.munition = ((AmmoType)type).getMunitionType();\n+        if (type instanceof AmmoType) {\n+        \tthis.munition = ((AmmoType) type).getMunitionType();\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5382ad3a6c68d00fad1a9e1c6449d10268e35c64"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1Mjg1OTg0OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQxOTo0ODo1M1rOHu7Uog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMzoxMzozNFrOHvAT6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk2ODQ4Mg==", "bodyText": "Wait, we require this to be AmmoType as per getType. Is the if necessary, and if not this should be swapped to using getType.", "url": "https://github.com/MegaMek/mekhq/pull/2189#discussion_r518968482", "createdAt": "2020-11-06T19:48:53Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "diffHunk": "@@ -61,8 +58,8 @@ public AmmoStorage() {\n     public AmmoStorage(int tonnage, EquipmentType et, int shots, Campaign c) {\n         super(tonnage, et, -1, 1.0, c);\n         this.shots = shots;\n-        if(null != type && type instanceof AmmoType) {\n-        \tthis.munition = ((AmmoType)type).getMunitionType();\n+        if (type instanceof AmmoType) {\n+        \tthis.munition = ((AmmoType) type).getMunitionType();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5382ad3a6c68d00fad1a9e1c6449d10268e35c64"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTA1MDIxOA==", "bodyText": "Not sure how that didn't get replaced!", "url": "https://github.com/MegaMek/mekhq/pull/2189#discussion_r519050218", "createdAt": "2020-11-06T23:13:34Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "diffHunk": "@@ -61,8 +58,8 @@ public AmmoStorage() {\n     public AmmoStorage(int tonnage, EquipmentType et, int shots, Campaign c) {\n         super(tonnage, et, -1, 1.0, c);\n         this.shots = shots;\n-        if(null != type && type instanceof AmmoType) {\n-        \tthis.munition = ((AmmoType)type).getMunitionType();\n+        if (type instanceof AmmoType) {\n+        \tthis.munition = ((AmmoType) type).getMunitionType();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk2ODQ4Mg=="}, "originalCommit": {"oid": "5382ad3a6c68d00fad1a9e1c6449d10268e35c64"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2154, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}