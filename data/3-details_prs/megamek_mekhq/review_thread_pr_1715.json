{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyMjI5ODI4", "number": 1715, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwMToyMTo0MVrOD8Slcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwMToyNDoyM1rOD8SnLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NTQ1NjUwOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/ResolveScenarioTracker.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwMToyMTo0MVrOGVI45Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQyMTo0MTozNlrOGWcy0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDgxODkxNw==", "bodyText": "You probably still need to say which hash.", "url": "https://github.com/MegaMek/mekhq/pull/1715#discussion_r424818917", "createdAt": "2020-05-14T01:21:41Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/ResolveScenarioTracker.java", "diffHunk": "@@ -951,24 +952,21 @@ private void processPrisonerCapture(List<TestUnit> unitsToProcess) {\n                 if (null != en.getCrew()) {\n                     currentHits = en.getCrew().getHits();\n                 }\n-                int newHits = (int) Math.max(0, currentHits - existingHits);\n-                casualties = (int) Math.ceil(Compute.getFullCrewSize(en) * (newHits/6.0));\n+                int newHits = Math.max(0, currentHits - existingHits);\n+                casualties = (int) Math.ceil(Compute.getFullCrewSize(en) * (newHits / 6.0));\n             }\n-            for(Person p : crew) {\n-                // Give them a UUID. We won't actually use this for the campaign, but to\n-                //identify them in the prisonerStatus hash\n-                UUID id = p.getId();\n-                if (null == id) {\n-                    id = UUID.randomUUID();\n-                    p.setId(id);\n-                }\n-                PrisonerStatus status = new PrisonerStatus(p.getFullName(), u.getEntity().getDisplayName(), p);\n+            for (Person p : crew) {\n+                // We need to assign them a UUID now to place them into the hash", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3c4762ecd5c5f399cd7f5ff2d4aaf47adaa9583"}, "originalPosition": 148}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE5MzYxOA==", "bodyText": "Added clarification to the comment in question.", "url": "https://github.com/MegaMek/mekhq/pull/1715#discussion_r426193618", "createdAt": "2020-05-16T21:41:36Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/ResolveScenarioTracker.java", "diffHunk": "@@ -951,24 +952,21 @@ private void processPrisonerCapture(List<TestUnit> unitsToProcess) {\n                 if (null != en.getCrew()) {\n                     currentHits = en.getCrew().getHits();\n                 }\n-                int newHits = (int) Math.max(0, currentHits - existingHits);\n-                casualties = (int) Math.ceil(Compute.getFullCrewSize(en) * (newHits/6.0));\n+                int newHits = Math.max(0, currentHits - existingHits);\n+                casualties = (int) Math.ceil(Compute.getFullCrewSize(en) * (newHits / 6.0));\n             }\n-            for(Person p : crew) {\n-                // Give them a UUID. We won't actually use this for the campaign, but to\n-                //identify them in the prisonerStatus hash\n-                UUID id = p.getId();\n-                if (null == id) {\n-                    id = UUID.randomUUID();\n-                    p.setId(id);\n-                }\n-                PrisonerStatus status = new PrisonerStatus(p.getFullName(), u.getEntity().getDisplayName(), p);\n+            for (Person p : crew) {\n+                // We need to assign them a UUID now to place them into the hash", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDgxODkxNw=="}, "originalCommit": {"oid": "e3c4762ecd5c5f399cd7f5ff2d4aaf47adaa9583"}, "originalPosition": 148}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NTQ2MDkyOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/personnel/Person.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwMToyNDoyM1rOGVI7nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQyMTozOTo0M1rOGWcyUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDgxOTYxMg==", "bodyText": "Seems almost identical to the Bondsman functionality. Is this a) intended, and b) if it is, can it be consolidated?", "url": "https://github.com/MegaMek/mekhq/pull/1715#discussion_r424819612", "createdAt": "2020-05-14T01:24:23Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/personnel/Person.java", "diffHunk": "@@ -516,44 +507,75 @@ public void setDependent(boolean tf) {\n         }\n     }\n \n-    public boolean isPrisoner() {\n-        return prisonerStatus == PRISONER_YES;\n-    }\n-\n-    public void setPrisoner() {\n-        prisonerStatus = PRISONER_YES;\n-        setRankNumeric(Ranks.RANK_PRISONER);\n-    }\n-\n-    public boolean isBondsman() {\n-        return prisonerStatus == PRISONER_BONDSMAN;\n-    }\n-\n-    public void setBondsman() {\n-        prisonerStatus = PRISONER_BONDSMAN;\n-        willingToDefect = false;\n-        setRankNumeric(Ranks.RANK_BONDSMAN);\n+    public PrisonerStatus getPrisonerStatus() {\n+        return prisonerStatus;\n     }\n \n-    public boolean isFree() {\n-        return (!isPrisoner() && !isBondsman());\n+    public void setPrisonerStatus(PrisonerStatus prisonerStatus) {\n+        setPrisonerStatus(prisonerStatus, true);\n     }\n \n-    public void setFreeMan() {\n-        prisonerStatus = PRISONER_NOT;\n-        willingToDefect = false;\n-    }\n+    public void setPrisonerStatus(PrisonerStatus prisonerStatus, boolean log) {\n+        boolean freed = !this.prisonerStatus.isFree();\n+        this.prisonerStatus = prisonerStatus;\n \n-    public int getPrisonerStatus() {\n-        return prisonerStatus;\n-    }\n+        // Now, we need to fix values and ranks based on the Person's status\n+        switch (prisonerStatus) {\n+            case PRISONER:\n+            case PRISONER_DEFECTOR:\n+                // They don't get to have a rank. Their rank is Bondsman.\n+                getCampaign().changeRank(this, Ranks.RANK_BONDSMAN, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3c4762ecd5c5f399cd7f5ff2d4aaf47adaa9583"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE5MzQ5MQ==", "bodyText": "It is intended, albeit with a typo on the line in question (it should say RANK_PRISONER). However, I consolidated it. I'm also going to create a story to remove the RANK_BONDSMAN and RANK_PRISONER ranks and replacement with leading displays for ranks, as that is significantly more realistic.", "url": "https://github.com/MegaMek/mekhq/pull/1715#discussion_r426193491", "createdAt": "2020-05-16T21:39:43Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/personnel/Person.java", "diffHunk": "@@ -516,44 +507,75 @@ public void setDependent(boolean tf) {\n         }\n     }\n \n-    public boolean isPrisoner() {\n-        return prisonerStatus == PRISONER_YES;\n-    }\n-\n-    public void setPrisoner() {\n-        prisonerStatus = PRISONER_YES;\n-        setRankNumeric(Ranks.RANK_PRISONER);\n-    }\n-\n-    public boolean isBondsman() {\n-        return prisonerStatus == PRISONER_BONDSMAN;\n-    }\n-\n-    public void setBondsman() {\n-        prisonerStatus = PRISONER_BONDSMAN;\n-        willingToDefect = false;\n-        setRankNumeric(Ranks.RANK_BONDSMAN);\n+    public PrisonerStatus getPrisonerStatus() {\n+        return prisonerStatus;\n     }\n \n-    public boolean isFree() {\n-        return (!isPrisoner() && !isBondsman());\n+    public void setPrisonerStatus(PrisonerStatus prisonerStatus) {\n+        setPrisonerStatus(prisonerStatus, true);\n     }\n \n-    public void setFreeMan() {\n-        prisonerStatus = PRISONER_NOT;\n-        willingToDefect = false;\n-    }\n+    public void setPrisonerStatus(PrisonerStatus prisonerStatus, boolean log) {\n+        boolean freed = !this.prisonerStatus.isFree();\n+        this.prisonerStatus = prisonerStatus;\n \n-    public int getPrisonerStatus() {\n-        return prisonerStatus;\n-    }\n+        // Now, we need to fix values and ranks based on the Person's status\n+        switch (prisonerStatus) {\n+            case PRISONER:\n+            case PRISONER_DEFECTOR:\n+                // They don't get to have a rank. Their rank is Bondsman.\n+                getCampaign().changeRank(this, Ranks.RANK_BONDSMAN, true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDgxOTYxMg=="}, "originalCommit": {"oid": "e3c4762ecd5c5f399cd7f5ff2d4aaf47adaa9583"}, "originalPosition": 88}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2459, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}