{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3MjIzNjc3", "number": 1609, "title": "Person LocalDate", "bodyText": "This PR switches the Person class to use java.time.LocalDate instead of the mixture of Joda, Gregorian Calendar, and Date.\nLocalDate for campaign is currently just a conversion call, as we don't need to track the same thing three times.\nThis was stirred on to make it easier to implement parts of the RandomDeath code.", "createdAt": "2020-04-01T20:45:48Z", "url": "https://github.com/MegaMek/mekhq/pull/1609", "merged": true, "mergeCommit": {"oid": "2af05e3a54ac51a943c79ffff94eb35334355b1f"}, "closed": true, "closedAt": "2020-04-03T01:36:10Z", "author": {"login": "Windchild292"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTaZjQgH2gAyMzk3MjIzNjc3OjJkNWQ2YTljM2Q4ZjljNjRjNDIwYTI1OWY0ZjY0MzNhMzlkNDk5ODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcT2piMgFqTM4Njg4MzU4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2d5d6a9c3d8f9c64c420a259f4f6433a39d49986", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/2d5d6a9c3d8f9c64c420a259f4f6433a39d49986", "committedDate": "2020-04-01T16:36:05Z", "message": "Cleaning up FormerSpouse"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7317296f0ffcd04b0582ea90077d92e92eb7291", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/e7317296f0ffcd04b0582ea90077d92e92eb7291", "committedDate": "2020-04-01T17:52:37Z", "message": "Implementing local date for personnel, part 1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74d6c197a39ed99c6247aaeaba4a1c9216b0dc42", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/74d6c197a39ed99c6247aaeaba4a1c9216b0dc42", "committedDate": "2020-04-01T17:53:48Z", "message": "Adding personnel LocalDate to HireBulkPersonnel and fixing potential NPEs in the class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47330f018528c8cc6291dedd77d2048f6a53e418", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/47330f018528c8cc6291dedd77d2048f6a53e418", "committedDate": "2020-04-01T18:12:22Z", "message": "Fixing for local date in customizepersondialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cecb33fcb0f55bcb8119a83bc18e4fa3b0cad14", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/0cecb33fcb0f55bcb8119a83bc18e4fa3b0cad14", "committedDate": "2020-04-01T18:13:06Z", "message": "Removing unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a18fd69fe2075c523455b49cacac897c7acd7c2", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/7a18fd69fe2075c523455b49cacac897c7acd7c2", "committedDate": "2020-04-01T19:05:28Z", "message": "Fixing bugs in localdate implementation\n:"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "308bf9cfb2c74a3e594cc11b35686e2e58097578", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/308bf9cfb2c74a3e594cc11b35686e2e58097578", "committedDate": "2020-04-01T19:06:30Z", "message": "Fixing incorrect ordering for Time in Serviceg"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a661feb787326b8d905446b791a7cd720e60ff7b", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/a661feb787326b8d905446b791a7cd720e60ff7b", "committedDate": "2020-04-01T19:12:21Z", "message": "Fixing tab spacing in CustomizePersonDialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e30a8a14abb8630a9e0678b3847375e8b78802c5", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/e30a8a14abb8630a9e0678b3847375e8b78802c5", "committedDate": "2020-04-01T20:28:58Z", "message": "Fixing merge conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48b38872c1d2d9c47112ba0a9f31c2b89139a3b1", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/48b38872c1d2d9c47112ba0a9f31c2b89139a3b1", "committedDate": "2020-04-01T20:42:18Z", "message": "Fixing minor bugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "092bf0b3c2d3cc396fe22e09ac9df5df8c8030db", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/092bf0b3c2d3cc396fe22e09ac9df5df8c8030db", "committedDate": "2020-04-01T21:02:08Z", "message": "Switching to using ChronoUnit.WEEKS to properly calculate the number of weeks at one time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15e06bd4da93656043a8d82e5ef53fa45722c69f", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/15e06bd4da93656043a8d82e5ef53fa45722c69f", "committedDate": "2020-04-01T21:05:26Z", "message": "Switching to using a ternary for leap year days"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a194dc02c90a5464a0d090e08dbf309c297597b", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/1a194dc02c90a5464a0d090e08dbf309c297597b", "committedDate": "2020-04-01T21:06:37Z", "message": "Removing unused import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b3846bc891dfc3097e386ead0b859ea47122c80", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/7b3846bc891dfc3097e386ead0b859ea47122c80", "committedDate": "2020-04-01T21:07:18Z", "message": "Removing unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b253d89a41501c955429c062be4f7b91a0047da", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/4b253d89a41501c955429c062be4f7b91a0047da", "committedDate": "2020-04-01T21:08:45Z", "message": "removing old import in former spouse"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "377462bc827fec47a6896f05bcd32eecd01c2b37", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/377462bc827fec47a6896f05bcd32eecd01c2b37", "committedDate": "2020-04-01T21:11:23Z", "message": "Removing more unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba2c7fcedd7415e167c7e83cc23ea9ba41e644e2", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/ba2c7fcedd7415e167c7e83cc23ea9ba41e644e2", "committedDate": "2020-04-01T21:19:23Z", "message": "Fixing capitalization of two private constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89f8d8f2e5be002e107ae0c7958b6295b486af21", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/89f8d8f2e5be002e107ae0c7958b6295b486af21", "committedDate": "2020-04-01T21:19:35Z", "message": "Fixing capitalization of two private constants"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2ODc3Njc4", "url": "https://github.com/MegaMek/mekhq/pull/1609#pullrequestreview-386877678", "createdAt": "2020-04-03T01:09:51Z", "commit": {"oid": "89f8d8f2e5be002e107ae0c7958b6295b486af21"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMTowOTo1MVrOGABxmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMToxNDoxMVrOGAB2Cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4MjI2NA==", "bodyText": "I hate to ask, but is this going to impact this type of export? Not that I've ever even heard of a MercRoster database, but...", "url": "https://github.com/MegaMek/mekhq/pull/1609#discussion_r402682264", "createdAt": "2020-04-03T01:09:51Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/MercRosterAccess.java", "diffHunk": "@@ -473,10 +473,10 @@ private void writePersonnelData() {\n                 preparedStatement.setInt(6, forceId);\n                 preparedStatement.setInt(7, 1);\n                 //TODO: get joining date right\n-                preparedStatement.setDate(8, new java.sql.Date(p.getBirthday().getTimeInMillis()));\n+                preparedStatement.setDate(8, java.sql.Date.valueOf(p.getBirthday()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f8d8f2e5be002e107ae0c7958b6295b486af21"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4MzQwMw==", "bodyText": "Is there a way to just parse a date without specifying the exact format? Seems like a built-in library should be smart enough to contain that logic already.", "url": "https://github.com/MegaMek/mekhq/pull/1609#discussion_r402683403", "createdAt": "2020-04-03T01:14:11Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/personnel/Person.java", "diffHunk": "@@ -2228,13 +2209,27 @@ public static Person generateInstanceFromXML(Node wn, Campaign c, Version versio\n                         retVal.formerSpouses.add(FormerSpouse.generateInstanceFromXML(wn3));\n                     }\n                 } else if (wn2.getNodeName().equalsIgnoreCase(\"dueDate\")) {\n-                    SimpleDateFormat df = new SimpleDateFormat(\"yyyy-MM-dd hh:mm:ss\");\n-                    retVal.dueDate = (GregorianCalendar) GregorianCalendar.getInstance();\n-                    retVal.dueDate.setTime(df.parse(wn2.getTextContent().trim()));\n+                    if (version.isLowerThan(\"0.47.6\")) {\n+                        try {\n+                            retVal.dueDate = LocalDate.parse(wn2.getTextContent().trim(),\n+                                    DateTimeFormatter.ofPattern(\"yyyy-MM-dd hh:mm:ss\"));\n+                        } catch (Exception ignored) {\n+                        }\n+                    } else {\n+                        retVal.dueDate = LocalDate.parse(wn2.getTextContent().trim(),\n+                                DateTimeFormatter.ofPattern(DATE_SAVE_FORMAT));\n+                    }\n                 } else if (wn2.getNodeName().equalsIgnoreCase(\"expectedDueDate\")) {\n-                    SimpleDateFormat df = new SimpleDateFormat(\"yyyy-MM-dd hh:mm:ss\");\n-                    retVal.expectedDueDate = (GregorianCalendar) GregorianCalendar.getInstance();\n-                    retVal.expectedDueDate.setTime(df.parse(wn2.getTextContent().trim()));\n+                    if (version.isLowerThan(\"0.47.6\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f8d8f2e5be002e107ae0c7958b6295b486af21"}, "originalPosition": 335}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2ODgzNTg0", "url": "https://github.com/MegaMek/mekhq/pull/1609#pullrequestreview-386883584", "createdAt": "2020-04-03T01:30:50Z", "commit": {"oid": "89f8d8f2e5be002e107ae0c7958b6295b486af21"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMTozMDo1MFrOGACHGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMTozMDo1MFrOGACHGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4Nzc3MA==", "bodyText": "All right, in that case, let's consolidate this logic into a separate function.", "url": "https://github.com/MegaMek/mekhq/pull/1609#discussion_r402687770", "createdAt": "2020-04-03T01:30:50Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/personnel/Person.java", "diffHunk": "@@ -2228,13 +2209,27 @@ public static Person generateInstanceFromXML(Node wn, Campaign c, Version versio\n                         retVal.formerSpouses.add(FormerSpouse.generateInstanceFromXML(wn3));\n                     }\n                 } else if (wn2.getNodeName().equalsIgnoreCase(\"dueDate\")) {\n-                    SimpleDateFormat df = new SimpleDateFormat(\"yyyy-MM-dd hh:mm:ss\");\n-                    retVal.dueDate = (GregorianCalendar) GregorianCalendar.getInstance();\n-                    retVal.dueDate.setTime(df.parse(wn2.getTextContent().trim()));\n+                    if (version.isLowerThan(\"0.47.6\")) {\n+                        try {\n+                            retVal.dueDate = LocalDate.parse(wn2.getTextContent().trim(),\n+                                    DateTimeFormatter.ofPattern(\"yyyy-MM-dd hh:mm:ss\"));\n+                        } catch (Exception ignored) {\n+                        }\n+                    } else {\n+                        retVal.dueDate = LocalDate.parse(wn2.getTextContent().trim(),\n+                                DateTimeFormatter.ofPattern(DATE_SAVE_FORMAT));\n+                    }\n                 } else if (wn2.getNodeName().equalsIgnoreCase(\"expectedDueDate\")) {\n-                    SimpleDateFormat df = new SimpleDateFormat(\"yyyy-MM-dd hh:mm:ss\");\n-                    retVal.expectedDueDate = (GregorianCalendar) GregorianCalendar.getInstance();\n-                    retVal.expectedDueDate.setTime(df.parse(wn2.getTextContent().trim()));\n+                    if (version.isLowerThan(\"0.47.6\")) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4MzQwMw=="}, "originalCommit": {"oid": "89f8d8f2e5be002e107ae0c7958b6295b486af21"}, "originalPosition": 335}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4342, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}