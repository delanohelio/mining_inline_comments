{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NDQ4OTYw", "number": 1509, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMDowNzoxMVrODh_3BA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQwMToxODoxMFrODiDaDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2OTc1ODc2OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/service/AutosaveService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMDowNzoxMVrOFtDJyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMDoxNToyNVrOFtDXDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc4MTg5OA==", "bodyText": "nit: whiteline", "url": "https://github.com/MegaMek/mekhq/pull/1509#discussion_r382781898", "createdAt": "2020-02-21T20:07:11Z", "author": {"login": "VicenteCartas"}, "path": "MekHQ/src/mekhq/service/AutosaveService.java", "diffHunk": "@@ -73,20 +82,33 @@ private boolean isWeeklyAutosaveEnabled() {\n         return this.userPreferences.getBoolean(MekHqConstants.SAVE_WEEKLY_KEY, false);\n     }\n \n+    private boolean isMonthlyAutosaveEnabled() {\n+        return this.userPreferences.getBoolean(MekHqConstants.SAVE_MONTHLY_KEY, false);\n+    }\n+\n+    private boolean isYearlyAutosaveEnabled() {\n+        return this.userPreferences.getBoolean(MekHqConstants.SAVE_YEARLY_KEY, false);\n+    }\n+\n     private boolean isMissionAutosaveEnabled() {\n         return this.userPreferences.getBoolean(MekHqConstants.SAVE_BEFORE_MISSIONS_KEY, false);\n     }\n \n     private void performAutosave(Campaign campaign) {\n         try {\n             String fileName = this.getAutosaveFilename(campaign);\n-\n-            try (FileOutputStream fos = new FileOutputStream(fileName);\n-                 GZIPOutputStream output = new GZIPOutputStream(fos)) {\n-                PrintWriter writer = new PrintWriter(new OutputStreamWriter(output, \"UTF-8\"));\n-                campaign.writeToXml(writer);\n-                writer.flush();\n-                writer.close();\n+            if (!StringUtil.isNullOrEmpty(fileName)) {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "287b082c5fe655c6be953f7ea106301d506769d6"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc4NTI5Mg==", "bodyText": "Whoops, fixed", "url": "https://github.com/MegaMek/mekhq/pull/1509#discussion_r382785292", "createdAt": "2020-02-21T20:15:25Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/service/AutosaveService.java", "diffHunk": "@@ -73,20 +82,33 @@ private boolean isWeeklyAutosaveEnabled() {\n         return this.userPreferences.getBoolean(MekHqConstants.SAVE_WEEKLY_KEY, false);\n     }\n \n+    private boolean isMonthlyAutosaveEnabled() {\n+        return this.userPreferences.getBoolean(MekHqConstants.SAVE_MONTHLY_KEY, false);\n+    }\n+\n+    private boolean isYearlyAutosaveEnabled() {\n+        return this.userPreferences.getBoolean(MekHqConstants.SAVE_YEARLY_KEY, false);\n+    }\n+\n     private boolean isMissionAutosaveEnabled() {\n         return this.userPreferences.getBoolean(MekHqConstants.SAVE_BEFORE_MISSIONS_KEY, false);\n     }\n \n     private void performAutosave(Campaign campaign) {\n         try {\n             String fileName = this.getAutosaveFilename(campaign);\n-\n-            try (FileOutputStream fos = new FileOutputStream(fileName);\n-                 GZIPOutputStream output = new GZIPOutputStream(fos)) {\n-                PrintWriter writer = new PrintWriter(new OutputStreamWriter(output, \"UTF-8\"));\n-                campaign.writeToXml(writer);\n-                writer.flush();\n-                writer.close();\n+            if (!StringUtil.isNullOrEmpty(fileName)) {\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc4MTg5OA=="}, "originalCommit": {"oid": "287b082c5fe655c6be953f7ea106301d506769d6"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MDMzOTk3OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/service/AutosaveService.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQwMToxODoxMFrOFtIoTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQyMDo0MTowNVrOFtvHHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg3MTYyOQ==", "bodyText": "Seems like if you turned autosaveFiles into a map, you could get an O(1) run time here, rather than O(#files)", "url": "https://github.com/MegaMek/mekhq/pull/1509#discussion_r382871629", "createdAt": "2020-02-22T01:18:10Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/service/AutosaveService.java", "diffHunk": "@@ -98,39 +119,51 @@ private String getAutosaveFilename(Campaign campaign) {\n         // Get all autosave files in ascending order of date creation\n         String savesDirectoryPath = MekHQ.getCampaignsDirectory().getValue();\n         File folder = new File(savesDirectoryPath);\n-        List<File> autosaveFiles = Arrays.stream(folder.listFiles())\n-                .filter(f -> f.getName().startsWith(\"Autosave-\"))\n-                .sorted(Comparator.comparing(f -> f.lastModified()))\n-                .collect(Collectors.toList());\n-\n-        // Delete older autosave files if needed\n-        int maxNumberAutosaves = this.userPreferences.getInt(MekHqConstants.MAXIMUM_NUMBER_SAVES_KEY, MekHqConstants.DEFAULT_NUMBER_SAVES);\n-        while (autosaveFiles.size() >= maxNumberAutosaves && autosaveFiles.size() > 0) {\n-            autosaveFiles.get(0).delete();\n-            autosaveFiles.remove(0);\n-        }\n+        File[] files = folder.listFiles();\n+        if (files != null) {\n+            List<File> autosaveFiles = Arrays.stream(files)\n+                    .filter(f -> f.getName().startsWith(\"Autosave-\"))\n+                    .sorted(Comparator.comparing(File::lastModified))\n+                    .collect(Collectors.toList());\n+\n+            // Delete older autosave files if needed\n+            int maxNumberAutosaves = this.userPreferences.getInt(MekHqConstants.MAXIMUM_NUMBER_SAVES_KEY,\n+                    MekHqConstants.DEFAULT_NUMBER_SAVES);\n+\n+            int index = 0;\n+            while (autosaveFiles.size() >= maxNumberAutosaves && autosaveFiles.size() > index) {\n+                if (autosaveFiles.get(index).delete()) {\n+                    autosaveFiles.remove(index);\n+                } else {\n+                    this.logger.error(this.getClass(), \"getAutosaveFilename\",\n+                            \"Unable to delete file \" + autosaveFiles.get(index).getName());\n+                    index++;\n+                }\n+            }\n \n-        // Find a unique name for this autosave\n-        String fileName = null;\n-\n-        boolean repeatedName = true;\n-        int index = 0;\n-        while (repeatedName) {\n-            fileName = String.format(\n-                    \"Autosave-%d-%s-%s.cpnx.gz\",\n-                    index++,\n-                    campaign.getName(),\n-                    campaign.getShortDateAsString());\n-\n-            repeatedName = false;\n-            for (File file : autosaveFiles) {\n-                if (file.getName().compareToIgnoreCase(fileName) == 0) {\n-                    repeatedName = true;\n-                    break;\n+            // Find a unique name for this autosave\n+            String fileName = null;\n+\n+            boolean repeatedName = true;\n+            index = 1;\n+            while (repeatedName) {\n+                fileName = String.format(\n+                        \"Autosave-%d-%s-%s.cpnx.gz\",\n+                        index++,\n+                        campaign.getName(),\n+                        campaign.getShortDateAsString());\n+\n+                repeatedName = false;\n+                for (File file : autosaveFiles) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "22e5df395c560692739a4daa7c79e5dc789f8a8d"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg3Njg3OQ==", "bodyText": "Given an expected n of 5, I would expect it would actually be a performance drop to switch it out", "url": "https://github.com/MegaMek/mekhq/pull/1509#discussion_r382876879", "createdAt": "2020-02-22T02:10:29Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/service/AutosaveService.java", "diffHunk": "@@ -98,39 +119,51 @@ private String getAutosaveFilename(Campaign campaign) {\n         // Get all autosave files in ascending order of date creation\n         String savesDirectoryPath = MekHQ.getCampaignsDirectory().getValue();\n         File folder = new File(savesDirectoryPath);\n-        List<File> autosaveFiles = Arrays.stream(folder.listFiles())\n-                .filter(f -> f.getName().startsWith(\"Autosave-\"))\n-                .sorted(Comparator.comparing(f -> f.lastModified()))\n-                .collect(Collectors.toList());\n-\n-        // Delete older autosave files if needed\n-        int maxNumberAutosaves = this.userPreferences.getInt(MekHqConstants.MAXIMUM_NUMBER_SAVES_KEY, MekHqConstants.DEFAULT_NUMBER_SAVES);\n-        while (autosaveFiles.size() >= maxNumberAutosaves && autosaveFiles.size() > 0) {\n-            autosaveFiles.get(0).delete();\n-            autosaveFiles.remove(0);\n-        }\n+        File[] files = folder.listFiles();\n+        if (files != null) {\n+            List<File> autosaveFiles = Arrays.stream(files)\n+                    .filter(f -> f.getName().startsWith(\"Autosave-\"))\n+                    .sorted(Comparator.comparing(File::lastModified))\n+                    .collect(Collectors.toList());\n+\n+            // Delete older autosave files if needed\n+            int maxNumberAutosaves = this.userPreferences.getInt(MekHqConstants.MAXIMUM_NUMBER_SAVES_KEY,\n+                    MekHqConstants.DEFAULT_NUMBER_SAVES);\n+\n+            int index = 0;\n+            while (autosaveFiles.size() >= maxNumberAutosaves && autosaveFiles.size() > index) {\n+                if (autosaveFiles.get(index).delete()) {\n+                    autosaveFiles.remove(index);\n+                } else {\n+                    this.logger.error(this.getClass(), \"getAutosaveFilename\",\n+                            \"Unable to delete file \" + autosaveFiles.get(index).getName());\n+                    index++;\n+                }\n+            }\n \n-        // Find a unique name for this autosave\n-        String fileName = null;\n-\n-        boolean repeatedName = true;\n-        int index = 0;\n-        while (repeatedName) {\n-            fileName = String.format(\n-                    \"Autosave-%d-%s-%s.cpnx.gz\",\n-                    index++,\n-                    campaign.getName(),\n-                    campaign.getShortDateAsString());\n-\n-            repeatedName = false;\n-            for (File file : autosaveFiles) {\n-                if (file.getName().compareToIgnoreCase(fileName) == 0) {\n-                    repeatedName = true;\n-                    break;\n+            // Find a unique name for this autosave\n+            String fileName = null;\n+\n+            boolean repeatedName = true;\n+            index = 1;\n+            while (repeatedName) {\n+                fileName = String.format(\n+                        \"Autosave-%d-%s-%s.cpnx.gz\",\n+                        index++,\n+                        campaign.getName(),\n+                        campaign.getShortDateAsString());\n+\n+                repeatedName = false;\n+                for (File file : autosaveFiles) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg3MTYyOQ=="}, "originalCommit": {"oid": "22e5df395c560692739a4daa7c79e5dc789f8a8d"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ5ODM3OQ==", "bodyText": "@NickAragua\nThoughts on the above?", "url": "https://github.com/MegaMek/mekhq/pull/1509#discussion_r383498379", "createdAt": "2020-02-24T20:32:56Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/service/AutosaveService.java", "diffHunk": "@@ -98,39 +119,51 @@ private String getAutosaveFilename(Campaign campaign) {\n         // Get all autosave files in ascending order of date creation\n         String savesDirectoryPath = MekHQ.getCampaignsDirectory().getValue();\n         File folder = new File(savesDirectoryPath);\n-        List<File> autosaveFiles = Arrays.stream(folder.listFiles())\n-                .filter(f -> f.getName().startsWith(\"Autosave-\"))\n-                .sorted(Comparator.comparing(f -> f.lastModified()))\n-                .collect(Collectors.toList());\n-\n-        // Delete older autosave files if needed\n-        int maxNumberAutosaves = this.userPreferences.getInt(MekHqConstants.MAXIMUM_NUMBER_SAVES_KEY, MekHqConstants.DEFAULT_NUMBER_SAVES);\n-        while (autosaveFiles.size() >= maxNumberAutosaves && autosaveFiles.size() > 0) {\n-            autosaveFiles.get(0).delete();\n-            autosaveFiles.remove(0);\n-        }\n+        File[] files = folder.listFiles();\n+        if (files != null) {\n+            List<File> autosaveFiles = Arrays.stream(files)\n+                    .filter(f -> f.getName().startsWith(\"Autosave-\"))\n+                    .sorted(Comparator.comparing(File::lastModified))\n+                    .collect(Collectors.toList());\n+\n+            // Delete older autosave files if needed\n+            int maxNumberAutosaves = this.userPreferences.getInt(MekHqConstants.MAXIMUM_NUMBER_SAVES_KEY,\n+                    MekHqConstants.DEFAULT_NUMBER_SAVES);\n+\n+            int index = 0;\n+            while (autosaveFiles.size() >= maxNumberAutosaves && autosaveFiles.size() > index) {\n+                if (autosaveFiles.get(index).delete()) {\n+                    autosaveFiles.remove(index);\n+                } else {\n+                    this.logger.error(this.getClass(), \"getAutosaveFilename\",\n+                            \"Unable to delete file \" + autosaveFiles.get(index).getName());\n+                    index++;\n+                }\n+            }\n \n-        // Find a unique name for this autosave\n-        String fileName = null;\n-\n-        boolean repeatedName = true;\n-        int index = 0;\n-        while (repeatedName) {\n-            fileName = String.format(\n-                    \"Autosave-%d-%s-%s.cpnx.gz\",\n-                    index++,\n-                    campaign.getName(),\n-                    campaign.getShortDateAsString());\n-\n-            repeatedName = false;\n-            for (File file : autosaveFiles) {\n-                if (file.getName().compareToIgnoreCase(fileName) == 0) {\n-                    repeatedName = true;\n-                    break;\n+            // Find a unique name for this autosave\n+            String fileName = null;\n+\n+            boolean repeatedName = true;\n+            index = 1;\n+            while (repeatedName) {\n+                fileName = String.format(\n+                        \"Autosave-%d-%s-%s.cpnx.gz\",\n+                        index++,\n+                        campaign.getName(),\n+                        campaign.getShortDateAsString());\n+\n+                repeatedName = false;\n+                for (File file : autosaveFiles) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg3MTYyOQ=="}, "originalCommit": {"oid": "22e5df395c560692739a4daa7c79e5dc789f8a8d"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzUwMjExMQ==", "bodyText": "I suppose it's unlikely that you'll encounter too many name overlaps like this. May as well leave it.", "url": "https://github.com/MegaMek/mekhq/pull/1509#discussion_r383502111", "createdAt": "2020-02-24T20:41:05Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/service/AutosaveService.java", "diffHunk": "@@ -98,39 +119,51 @@ private String getAutosaveFilename(Campaign campaign) {\n         // Get all autosave files in ascending order of date creation\n         String savesDirectoryPath = MekHQ.getCampaignsDirectory().getValue();\n         File folder = new File(savesDirectoryPath);\n-        List<File> autosaveFiles = Arrays.stream(folder.listFiles())\n-                .filter(f -> f.getName().startsWith(\"Autosave-\"))\n-                .sorted(Comparator.comparing(f -> f.lastModified()))\n-                .collect(Collectors.toList());\n-\n-        // Delete older autosave files if needed\n-        int maxNumberAutosaves = this.userPreferences.getInt(MekHqConstants.MAXIMUM_NUMBER_SAVES_KEY, MekHqConstants.DEFAULT_NUMBER_SAVES);\n-        while (autosaveFiles.size() >= maxNumberAutosaves && autosaveFiles.size() > 0) {\n-            autosaveFiles.get(0).delete();\n-            autosaveFiles.remove(0);\n-        }\n+        File[] files = folder.listFiles();\n+        if (files != null) {\n+            List<File> autosaveFiles = Arrays.stream(files)\n+                    .filter(f -> f.getName().startsWith(\"Autosave-\"))\n+                    .sorted(Comparator.comparing(File::lastModified))\n+                    .collect(Collectors.toList());\n+\n+            // Delete older autosave files if needed\n+            int maxNumberAutosaves = this.userPreferences.getInt(MekHqConstants.MAXIMUM_NUMBER_SAVES_KEY,\n+                    MekHqConstants.DEFAULT_NUMBER_SAVES);\n+\n+            int index = 0;\n+            while (autosaveFiles.size() >= maxNumberAutosaves && autosaveFiles.size() > index) {\n+                if (autosaveFiles.get(index).delete()) {\n+                    autosaveFiles.remove(index);\n+                } else {\n+                    this.logger.error(this.getClass(), \"getAutosaveFilename\",\n+                            \"Unable to delete file \" + autosaveFiles.get(index).getName());\n+                    index++;\n+                }\n+            }\n \n-        // Find a unique name for this autosave\n-        String fileName = null;\n-\n-        boolean repeatedName = true;\n-        int index = 0;\n-        while (repeatedName) {\n-            fileName = String.format(\n-                    \"Autosave-%d-%s-%s.cpnx.gz\",\n-                    index++,\n-                    campaign.getName(),\n-                    campaign.getShortDateAsString());\n-\n-            repeatedName = false;\n-            for (File file : autosaveFiles) {\n-                if (file.getName().compareToIgnoreCase(fileName) == 0) {\n-                    repeatedName = true;\n-                    break;\n+            // Find a unique name for this autosave\n+            String fileName = null;\n+\n+            boolean repeatedName = true;\n+            index = 1;\n+            while (repeatedName) {\n+                fileName = String.format(\n+                        \"Autosave-%d-%s-%s.cpnx.gz\",\n+                        index++,\n+                        campaign.getName(),\n+                        campaign.getShortDateAsString());\n+\n+                repeatedName = false;\n+                for (File file : autosaveFiles) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg3MTYyOQ=="}, "originalCommit": {"oid": "22e5df395c560692739a4daa7c79e5dc789f8a8d"}, "originalPosition": 154}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1928, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}