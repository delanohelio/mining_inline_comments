{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyMDY1Mjk3", "number": 1538, "title": "Groundwork for distributed MekHQ", "bodyText": "This PR lands the groundwork for distributed MekHQ games:\n\nHave a CampaignController that handles the timeline\nRefactor some logic to ensure a centralized location or event manages the actions", "createdAt": "2020-03-01T16:34:25Z", "url": "https://github.com/MegaMek/mekhq/pull/1538", "merged": true, "mergeCommit": {"oid": "7c25e8ac922412134632e9e9f07598b3c7ec326b"}, "closed": true, "closedAt": "2020-03-01T23:56:10Z", "author": {"login": "sixlettervariables"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJa5JSgH2gAyMzgyMDY1Mjk3OjZmMzNiM2U5ZmM2M2JmNjFlM2JhOTc1OWYyYTM1OTEzN2VlOGU0ODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJgN80AFqTM2Njg4OTEwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6f33b3e9fc63bf61e3ba9759f2a359137ee8e485", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/6f33b3e9fc63bf61e3ba9759f2a359137ee8e485", "committedDate": "2020-03-01T15:31:21Z", "message": "Add a CampaignController to handle the timeline\n\n- Moves CampaignGUI day ending and new day actions to event handlers\n- Makes a local campaign always the host"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76061831a31861f4d80dd9e52d1cce0266883d7b", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/76061831a31861f4d80dd9e52d1cce0266883d7b", "committedDate": "2020-03-01T16:03:15Z", "message": "Consolidate setGMMode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c801eb56fa46db494b8b04c9bc1da994f89fba89", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/c801eb56fa46db494b8b04c9bc1da994f89fba89", "committedDate": "2020-03-01T16:09:54Z", "message": "Restrict advancing multiple days to the session host"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21", "committedDate": "2020-03-01T16:31:34Z", "message": "Put GM moving current location directly into Campaign\n\n- Use eventing to notify CampaignGUI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODcxNDY1", "url": "https://github.com/MegaMek/mekhq/pull/1538#pullrequestreview-366871465", "createdAt": "2020-03-01T16:45:37Z", "commit": {"oid": "3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQxNjo0NTozOFrOFwPCyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQxNjo0NTozOFrOFwPCyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMjQ0MQ==", "bodyText": "Spacing issues with the if statement and the first two calls.", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386122441", "createdAt": "2020-03-01T16:45:38Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/DataLoadingDialog.java", "diffHunk": "@@ -304,7 +303,8 @@ public Void doInBackground() {\n         public void done() {\n         \tsetVisible(false);\n         \tif(!cancelled) {\n-        \t\tapp.setCampaign(campaign);\n+                app.setCampaign(campaign);\n+                app.getCampaignController().setHost(campaign.getId());\n         \t\tframe.setVisible(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODcxNDg0", "url": "https://github.com/MegaMek/mekhq/pull/1538#pullrequestreview-366871484", "createdAt": "2020-03-01T16:45:54Z", "commit": {"oid": "3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQxNjo0NTo1NFrOFwPC8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQxNjo0NTo1NFrOFwPC8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMjQ4Mw==", "bodyText": "Do we need this anymore?", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386122483", "createdAt": "2020-03-01T16:45:54Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/MedicalViewDialog.java", "diffHunk": "@@ -116,16 +116,14 @@\n     private transient Font handwritingFont;\n     private transient Color labelColor;\n     private transient ImageIcon healImageIcon;\n-    \n-    private boolean gmMode;\n \n     public MedicalViewDialog(Window parent, Campaign c, Person p, IconPackage ip) {\n         super();\n         this.campaign = Objects.requireNonNull(c);\n         this.person = Objects.requireNonNull(p);\n         //this.iconPackage = Objects.requireNonNull(ip);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODcxNTA1", "url": "https://github.com/MegaMek/mekhq/pull/1538#pullrequestreview-366871505", "createdAt": "2020-03-01T16:46:14Z", "commit": {"oid": "3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQxNjo0NjoxNFrOFwPDCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQxNjo0NjoxNFrOFwPDCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMjUwNA==", "bodyText": "Spacing", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386122504", "createdAt": "2020-03-01T16:46:14Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/MedicalViewDialog.java", "diffHunk": "@@ -326,30 +324,30 @@ private JPanel fillDoll(JPanel panel, Campaign c, Person p) {\n                         default:\n                             col = Color.WHITE;\n                             break;\n-                        \n+\n                     }\n                     doll.setLocColor(bl, col);\n                 }\n             });\n-        if(isGMMode()) {\n+        if(campaign.isGM()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21"}, "originalPosition": 155}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODcxNTMx", "url": "https://github.com/MegaMek/mekhq/pull/1538#pullrequestreview-366871531", "createdAt": "2020-03-01T16:46:39Z", "commit": {"oid": "3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQxNjo0NjozOVrOFwPDMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQxNjo0NjozOVrOFwPDMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMjU0NA==", "bodyText": "spacing", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386122544", "createdAt": "2020-03-01T16:46:39Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/MedicalViewDialog.java", "diffHunk": "@@ -499,30 +497,30 @@ private JPanel fillInjuries(JPanel panel, Campaign c, Person p) {\n                         injLabel = genWrittenText(String.format(resourceMap.getString(\"injuriesTextAndDuration.format\"), //$NON-NLS-1$\n                             inj.getType().getSimpleName(), inj.getStart().toString(DATE_FORMATTER), genTimePeriod(inj.getTime())));\n                     }\n-                    if(isGMMode()) {\n+                    if(campaign.isGM()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21"}, "originalPosition": 287}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0bc829e20283299a1e1a9e656022f9df7bc2b8d0", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/0bc829e20283299a1e1a9e656022f9df7bc2b8d0", "committedDate": "2020-03-01T20:08:49Z", "message": "Fix mixed tabs and spaces"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODg5MTA4", "url": "https://github.com/MegaMek/mekhq/pull/1538#pullrequestreview-366889108", "createdAt": "2020-03-01T21:43:27Z", "commit": {"oid": "0bc829e20283299a1e1a9e656022f9df7bc2b8d0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQyMTo0MzoyN1rOFwQVIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQyMTo0MzoyN1rOFwQVIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE0MzUyMg==", "bodyText": "I assume these TODOs are about notifying the other campaigns when the day is forwarded.", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386143522", "createdAt": "2020-03-01T21:43:27Z", "author": {"login": "neoancient"}, "path": "MekHQ/src/mekhq/campaign/CampaignController.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright (c) 2020 The MegaMek Team.\n+ *\n+ * This file is part of MekHQ.\n+ *\n+ * MekHQ is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * MekHQ is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with MekHQ.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package mekhq.campaign;\n+\n+import java.util.UUID;\n+\n+/**\n+ * Manages the timeline of a {@link Campaign}.\n+ */\n+public class CampaignController {\n+    private final Campaign localCampaign;\n+    private boolean isHost;\n+    private UUID host;\n+\n+    /**\n+     * Creates a new {@code CampaignController} for\n+     * the given {@link Campaign}\n+     * @param c The {@link Campaign} being used locally.\n+     */\n+    public CampaignController(Campaign c) {\n+        localCampaign = c;\n+    }\n+\n+    /**\n+     * Gets the local {@link Campaign}.\n+     * @return The local {@link Campaign}.\n+     */\n+    public Campaign getLocalCampaign() {\n+        return localCampaign;\n+    }\n+\n+    /**\n+     * Gets the unique identifier of the campaign hosting\n+     * this session.\n+     * @return The unique identifier of the host campaign.\n+     */\n+    public UUID getHost() {\n+        return host;\n+    }\n+\n+    /**\n+     * Sets the unique identifier of the campaign hosting\n+     * this session.\n+     * @param id The unique identifier of the host compaign.\n+     */\n+    public void setHost(UUID id) {\n+        host = id;\n+        isHost = getLocalCampaign().getId().equals(id);\n+    }\n+\n+    /**\n+     * Gets a value indicating whether or not the local Campaign\n+     * is hosting this session.\n+     * @return {@code true} if the local campaign is hosting\n+     *         this session, otherwise {@code false}.\n+     */\n+    public boolean isHost() {\n+        return isHost;\n+    }\n+\n+    /**\n+     * Advances the local {@link Campaign} to the next day.\n+     */\n+    public void advanceDay() {\n+        if (isHost) {\n+            if (getLocalCampaign().newDay()) {\n+                // TODO: notifyDayChangedEvent();\n+            }\n+        } else {\n+            // TODO: requestNewDay();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bc829e20283299a1e1a9e656022f9df7bc2b8d0"}, "originalPosition": 86}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4488, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}