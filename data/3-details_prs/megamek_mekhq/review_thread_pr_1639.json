{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMzUwNjY4", "number": 1639, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNTo0Nzo0M1rODvoARA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMDo1NTozNFrODvy1Ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMjY1MDkyOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/finances/Finances.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNTo0Nzo0M1rOGCKHNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNTo0Nzo0M1rOGCKHNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkxNjAyMg==", "bodyText": "This is the new addition to track shares.", "url": "https://github.com/MegaMek/mekhq/pull/1639#discussion_r404916022", "createdAt": "2020-04-07T15:47:43Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/finances/Finances.java", "diffHunk": "@@ -407,6 +391,43 @@ public void newDay(Campaign campaign) {\n         loans = newLoans;\n     }\n \n+\n+    private void payoutShares(Campaign campaign, Contract contract, GregorianCalendar calendar) {\n+        if (campaign.getCampaignOptions().getUseAtB() && campaign.getCampaignOptions().getUseShareSystem()\n+                && (contract instanceof AtBContract)) {\n+            Money shares = contract.getMonthlyPayOut().multipliedBy(((AtBContract) contract).getSharesPct())\n+                    .dividedBy(100);\n+            if (debit(shares, Transaction.C_SALARY,\n+                    String.format(resourceMap.getString(\"ContractSharePayment.text\"), contract.getName()),\n+                    calendar.getTime())) {\n+                campaign.addReport(String.format(resourceMap.getString(\"DistributedShares.text\"),\n+                        shares.toAmountAndSymbolString()));\n+\n+                if (campaign.getCampaignOptions().trackTotalEarnings()) {\n+                    int numberOfShares = 0;\n+                    boolean sharesForAll = campaign.getCampaignOptions().getSharesForAll();\n+                    for (Person person : campaign.getActivePersonnel()) {\n+                        numberOfShares += person.getNumShares(sharesForAll);\n+                    }\n+\n+                    Money singleShare = shares.dividedBy(numberOfShares);\n+                    for (Person person : campaign.getActivePersonnel()) {\n+                        person.payPersonShares(singleShare, sharesForAll);\n+                    }\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c55ad76dc19bd63db911de1ab9fa72641c736d6"}, "originalPosition": 112}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDQxMDY5OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMDo0Nzo0OVrOGCbL6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTozNTozNVrOGCb9qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE5NTc1NA==", "bodyText": "This one seems like an \"if it ain't broke don't fix it\" scenario.", "url": "https://github.com/MegaMek/mekhq/pull/1639#discussion_r405195754", "createdAt": "2020-04-08T00:47:49Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -3755,24 +3755,18 @@ public Money getPayRoll() {\n     }\n \n     public Money getPayRoll(boolean noInfantry) {\n-        if(!campaignOptions.payForSalaries()) {\n+        if (getCampaignOptions().payForSalaries()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b20a2762738e92ae671fa88711574482f583902"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIwODQ5MA==", "bodyText": "See the next one for my reasoning on the change.", "url": "https://github.com/MegaMek/mekhq/pull/1639#discussion_r405208490", "createdAt": "2020-04-08T01:35:35Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -3755,24 +3755,18 @@ public Money getPayRoll() {\n     }\n \n     public Money getPayRoll(boolean noInfantry) {\n-        if(!campaignOptions.payForSalaries()) {\n+        if (getCampaignOptions().payForSalaries()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE5NTc1NA=="}, "originalCommit": {"oid": "4b20a2762738e92ae671fa88711574482f583902"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDQxMjc5OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMDo0ODo1M1rOGCbNGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTozNDoyOFrOGCb8kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE5NjA1Ng==", "bodyText": "Same here, not really sure of the point of rearranging the if block.", "url": "https://github.com/MegaMek/mekhq/pull/1639#discussion_r405196056", "createdAt": "2020-04-08T00:48:53Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -3806,11 +3800,11 @@ public Money getWeeklyMaintenanceCosts() {\n     }\n \n     public Money getOverheadExpenses() {\n-        if(!campaignOptions.payForOverhead()) {\n+        if (getCampaignOptions().payForOverhead()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b20a2762738e92ae671fa88711574482f583902"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIwODIxMA==", "bodyText": "This is to prevent potential issues from the statement being false first and true second (I don't really care, but I've seen this result in bugs from lazy devs who didnt check for a false statement first more often than you'd expect)", "url": "https://github.com/MegaMek/mekhq/pull/1639#discussion_r405208210", "createdAt": "2020-04-08T01:34:28Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -3806,11 +3800,11 @@ public Money getWeeklyMaintenanceCosts() {\n     }\n \n     public Money getOverheadExpenses() {\n-        if(!campaignOptions.payForOverhead()) {\n+        if (getCampaignOptions().payForOverhead()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE5NjA1Ng=="}, "originalCommit": {"oid": "4b20a2762738e92ae671fa88711574482f583902"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxNDQyNTIzOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/personnel/Person.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMDo1NTozNFrOGCbUYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMTo1MToyM1rOGCcNjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE5NzkyMA==", "bodyText": "I think this method is going to require an explanation of the sharesForAll parameter. Also, I'm wondering if it'll be a little more efficient if we cache the results of all this logic. No need to store it permanently, just invalidate it when something happens to change the number of shares.", "url": "https://github.com/MegaMek/mekhq/pull/1639#discussion_r405197920", "createdAt": "2020-04-08T00:55:34Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/personnel/Person.java", "diffHunk": "@@ -4309,37 +4362,33 @@ public void setOriginalUnit(Unit unit) {\n     }\n \n     public int getNumShares(boolean sharesForAll) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b20a2762738e92ae671fa88711574482f583902"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxMjU1OA==", "bodyText": "Oh, it will be... but that's for a future PR (trying to keep features separate, and that is definitely a new internal feature). As for the comment, that has been added.", "url": "https://github.com/MegaMek/mekhq/pull/1639#discussion_r405212558", "createdAt": "2020-04-08T01:51:23Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/personnel/Person.java", "diffHunk": "@@ -4309,37 +4362,33 @@ public void setOriginalUnit(Unit unit) {\n     }\n \n     public int getNumShares(boolean sharesForAll) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE5NzkyMA=="}, "originalCommit": {"oid": "4b20a2762738e92ae671fa88711574482f583902"}, "originalPosition": 107}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2413, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}