{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5Njg1NjQ1", "number": 1883, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxNzowMzo1NlrOEUZmPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDo0NTozMFrOEUonpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5ODI2MzY3OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/finances/Loan.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxNzowMzo1NlrOG6mbyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxNzowMzo1NlrOG6mbyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwMDI5OQ==", "bodyText": "This logic needs an explanation, if you're just looking for the next Monday/Sunday or something like that there is a more obvious way:\nd.with(TemporalAdjusters.next(DayOfWeek.MONDAY));", "url": "https://github.com/MegaMek/mekhq/pull/1883#discussion_r464100299", "createdAt": "2020-08-02T17:03:56Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/campaign/finances/Loan.java", "diffHunk": "@@ -93,102 +85,79 @@ public Loan(Money p, int r, int c, int y, int s, GregorianCalendar today, String\n     }\n \n     public void setFirstPaymentDate() {\n-        boolean keepGoing = true;\n         //We are going to assume a standard grace period, so you have to go\n         //through the first full time length (not partial) before your first\n         //payment\n-        int grace = 1;\n-        switch(schedule) {\n-        case Finances.SCHEDULE_BIWEEKLY:\n-            grace = 2;\n-            break;\n-        case Finances.SCHEDULE_QUARTERLY:\n-            grace = 3;\n-            break;\n-        }\n-        while(keepGoing) {\n-            nextPayment.add(GregorianCalendar.DAY_OF_YEAR, 1);\n-            switch(schedule) {\n+\n+        // First, we need to increase the number of days by one\n+        nextPayment = nextPayment.plusDays(1);\n+\n+        // Then, we create a variable to hold temporary difference values\n+        int temp;\n+\n+        // Finally, we use that and the schedule type to determine the length including the grace period\n+        switch (schedule) {\n             case Finances.SCHEDULE_BIWEEKLY:\n-                if(nextPayment.get(Calendar.DAY_OF_WEEK) == 1) {\n-                    if(grace > 0) {\n-                        grace--;\n-                    }\n-                    else {\n-                        keepGoing = false;\n-                    }\n+                temp = 8 - nextPayment.getDayOfWeek().getValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0eec87fa138f4e4fbdae0e8899a46484bcbf3dc6"}, "originalPosition": 140}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5ODI2Mzk4OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/finances/Loan.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxNzowNDoxOFrOG6mb7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxNzowNDoxOFrOG6mb7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwMDMzMw==", "bodyText": "Same as above comment.", "url": "https://github.com/MegaMek/mekhq/pull/1883#discussion_r464100333", "createdAt": "2020-08-02T17:04:18Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/campaign/finances/Loan.java", "diffHunk": "@@ -93,102 +85,79 @@ public Loan(Money p, int r, int c, int y, int s, GregorianCalendar today, String\n     }\n \n     public void setFirstPaymentDate() {\n-        boolean keepGoing = true;\n         //We are going to assume a standard grace period, so you have to go\n         //through the first full time length (not partial) before your first\n         //payment\n-        int grace = 1;\n-        switch(schedule) {\n-        case Finances.SCHEDULE_BIWEEKLY:\n-            grace = 2;\n-            break;\n-        case Finances.SCHEDULE_QUARTERLY:\n-            grace = 3;\n-            break;\n-        }\n-        while(keepGoing) {\n-            nextPayment.add(GregorianCalendar.DAY_OF_YEAR, 1);\n-            switch(schedule) {\n+\n+        // First, we need to increase the number of days by one\n+        nextPayment = nextPayment.plusDays(1);\n+\n+        // Then, we create a variable to hold temporary difference values\n+        int temp;\n+\n+        // Finally, we use that and the schedule type to determine the length including the grace period\n+        switch (schedule) {\n             case Finances.SCHEDULE_BIWEEKLY:\n-                if(nextPayment.get(Calendar.DAY_OF_WEEK) == 1) {\n-                    if(grace > 0) {\n-                        grace--;\n-                    }\n-                    else {\n-                        keepGoing = false;\n-                    }\n+                temp = 8 - nextPayment.getDayOfWeek().getValue();\n+                if (temp != 7) {\n+                    nextPayment = nextPayment.plusDays(temp);\n                 }\n+                nextPayment = nextPayment.plusWeeks(2);\n                 break;\n             case Finances.SCHEDULE_MONTHLY:\n-                if(nextPayment.get(Calendar.DAY_OF_MONTH) == 1) {\n-                    if(grace > 0) {\n-                        grace--;\n-                    }\n-                    else {\n-                        keepGoing = false;\n-                    }\n+                temp = nextPayment.getDayOfMonth();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0eec87fa138f4e4fbdae0e8899a46484bcbf3dc6"}, "originalPosition": 154}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5ODI2NjYzOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/finances/Finances.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxNzowODowMVrOG6mdJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDoxMjowOFrOG67INw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwMDY0NQ==", "bodyText": "Does this logic match the old logic, the old logic gave you days % 365 > 0 ? 1 : 0. Is this equivalent?", "url": "https://github.com/MegaMek/mekhq/pull/1883#discussion_r464100645", "createdAt": "2020-08-02T17:08:01Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/campaign/finances/Finances.java", "diffHunk": "@@ -111,37 +109,42 @@ public boolean isInDebt() {\n         return getLoanBalance().isPositive();\n     }\n \n-    public int getFullYearsInDebt(GregorianCalendar cal) {\n-        if (null == wentIntoDebt) {\n+    public int getFullYearsInDebt(LocalDate date) {\n+        if (wentIntoDebt == null) {\n             return 0;\n+        } else {\n+            return Math.toIntExact(ChronoUnit.YEARS.between(wentIntoDebt, date));\n         }\n-        return Utilities.getDiffFullYears(wentIntoDebt, cal);\n     }\n \n-    public int getPartialYearsInDebt(GregorianCalendar cal) {\n-        if (wentIntoDebt == null) {\n-            return 0;\n+    public int getPartialYearsInDebt(LocalDate date) {\n+        if (wentIntoDebt != null) {\n+            Period period = Period.between(wentIntoDebt, date);\n+            if ((period.getMonths() > 0) || (period.getDays() > 0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0eec87fa138f4e4fbdae0e8899a46484bcbf3dc6"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQzOTM1MQ==", "bodyText": "It does. Period in single calculations will split the time between into days, months, and years. If there is no difference in a category, the value will be 0.", "url": "https://github.com/MegaMek/mekhq/pull/1883#discussion_r464439351", "createdAt": "2020-08-03T14:12:08Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/finances/Finances.java", "diffHunk": "@@ -111,37 +109,42 @@ public boolean isInDebt() {\n         return getLoanBalance().isPositive();\n     }\n \n-    public int getFullYearsInDebt(GregorianCalendar cal) {\n-        if (null == wentIntoDebt) {\n+    public int getFullYearsInDebt(LocalDate date) {\n+        if (wentIntoDebt == null) {\n             return 0;\n+        } else {\n+            return Math.toIntExact(ChronoUnit.YEARS.between(wentIntoDebt, date));\n         }\n-        return Utilities.getDiffFullYears(wentIntoDebt, cal);\n     }\n \n-    public int getPartialYearsInDebt(GregorianCalendar cal) {\n-        if (wentIntoDebt == null) {\n-            return 0;\n+    public int getPartialYearsInDebt(LocalDate date) {\n+        if (wentIntoDebt != null) {\n+            Period period = Period.between(wentIntoDebt, date);\n+            if ((period.getMonths() > 0) || (period.getDays() > 0)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwMDY0NQ=="}, "originalCommit": {"oid": "0eec87fa138f4e4fbdae0e8899a46484bcbf3dc6"}, "originalPosition": 102}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5ODI2NzYzOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/gui/dialog/CustomizeScenarioDialog.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxNzowOToxN1rOG6mdnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxNzowOToxN1rOG6mdnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwMDc2NA==", "bodyText": "Use TemporalAdjusters.", "url": "https://github.com/MegaMek/mekhq/pull/1883#discussion_r464100764", "createdAt": "2020-08-02T17:09:17Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/gui/dialog/CustomizeScenarioDialog.java", "diffHunk": "@@ -371,44 +370,37 @@ private void btnCloseActionPerformed(java.awt.event.ActionEvent evt) {\n \n     private void changeDate() {\n         // show the date chooser\n-        GregorianCalendar day = GregorianCalendar.from(date.atStartOfDay(ZoneId.systemDefault()));\n-        DateChooser dc = new DateChooser(frame, day);\n+        DateChooser dc = new DateChooser(frame, date);\n         // user can either choose a date or cancel by closing\n         if (dc.showDateChooser() == DateChooser.OK_OPTION) {\n             if (scenario.isCurrent()) {\n-                if (dc.getDate().getTime().before(campaign.getDate())) {\n+                if (dc.getDate().isBefore(campaign.getLocalDate())) {\n                     JOptionPane.showMessageDialog(frame,\n                             \"You cannot choose a date before the current date for a pending battle.\",\n                             \"Invalid date\",\n                             JOptionPane.ERROR_MESSAGE);\n                     return;\n                 } else {\n-                    //Calendar math necessitated by variations in locales\n-                    GregorianCalendar nextMonday = new GregorianCalendar();\n-                    nextMonday.setTime(campaign.getDate());\n-                    nextMonday.add(Calendar.DAY_OF_MONTH, 1);\n-                    while (nextMonday.get(Calendar.DAY_OF_WEEK) != Calendar.MONDAY) {\n-                        nextMonday.add(Calendar.DAY_OF_MONTH, 1);\n-                    }\n+                    LocalDate nextMonday = campaign.getLocalDate()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0eec87fa138f4e4fbdae0e8899a46484bcbf3dc6"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkwMDcyNDg3OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/finances/Loan.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDo0NTozMFrOG68cVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDo1MzozN1rOG68wEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ2MDg4NQ==", "bodyText": "Still needed?", "url": "https://github.com/MegaMek/mekhq/pull/1883#discussion_r464460885", "createdAt": "2020-08-03T14:45:30Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/campaign/finances/Loan.java", "diffHunk": "@@ -93,102 +87,72 @@ public Loan(Money p, int r, int c, int y, int s, GregorianCalendar today, String\n     }\n \n     public void setFirstPaymentDate() {\n-        boolean keepGoing = true;\n         //We are going to assume a standard grace period, so you have to go\n         //through the first full time length (not partial) before your first\n         //payment\n-        int grace = 1;\n-        switch(schedule) {\n-        case Finances.SCHEDULE_BIWEEKLY:\n-            grace = 2;\n-            break;\n-        case Finances.SCHEDULE_QUARTERLY:\n-            grace = 3;\n-            break;\n-        }\n-        while(keepGoing) {\n-            nextPayment.add(GregorianCalendar.DAY_OF_YEAR, 1);\n-            switch(schedule) {\n+\n+        // First, we need to increase the number of days by one\n+        nextPayment = nextPayment.plusDays(1);\n+\n+        // Then, we create a variable to hold temporary difference values\n+        int temp;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5b9445c3def0a8ea4ff613865db4368ad1a169f"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ2NTkzOQ==", "bodyText": "Nope, and odd that my IDE didn't prompt about it being unused.", "url": "https://github.com/MegaMek/mekhq/pull/1883#discussion_r464465939", "createdAt": "2020-08-03T14:53:37Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/finances/Loan.java", "diffHunk": "@@ -93,102 +87,72 @@ public Loan(Money p, int r, int c, int y, int s, GregorianCalendar today, String\n     }\n \n     public void setFirstPaymentDate() {\n-        boolean keepGoing = true;\n         //We are going to assume a standard grace period, so you have to go\n         //through the first full time length (not partial) before your first\n         //payment\n-        int grace = 1;\n-        switch(schedule) {\n-        case Finances.SCHEDULE_BIWEEKLY:\n-            grace = 2;\n-            break;\n-        case Finances.SCHEDULE_QUARTERLY:\n-            grace = 3;\n-            break;\n-        }\n-        while(keepGoing) {\n-            nextPayment.add(GregorianCalendar.DAY_OF_YEAR, 1);\n-            switch(schedule) {\n+\n+        // First, we need to increase the number of days by one\n+        nextPayment = nextPayment.plusDays(1);\n+\n+        // Then, we create a variable to hold temporary difference values\n+        int temp;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ2MDg4NQ=="}, "originalCommit": {"oid": "e5b9445c3def0a8ea4ff613865db4368ad1a169f"}, "originalPosition": 130}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2373, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}