{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5Njg1NjQ1", "number": 1883, "title": "LocalDate: Finances Swapover", "bodyText": "This moves finances to LocalDate, one of the last few systems to do so for.\nFinances has fingers all over the product, so this one has a bunch of files changed.\nWhitespace differences off, and I'd do the first two commits separately as both are code cleanup, formatting fixes, and light refactoring.", "createdAt": "2020-07-31T00:18:12Z", "url": "https://github.com/MegaMek/mekhq/pull/1883", "merged": true, "mergeCommit": {"oid": "dd527cea6d8cd91054c58d204519683d228ef111"}, "closed": true, "closedAt": "2020-08-03T15:16:11Z", "author": {"login": "Windchild292"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4u1M1gH2gAyNDU5Njg1NjQ1OjMxNjQxZGY0NmY3ZTI3MzMwMDU1ZTliZjcyZTQ5YjQ2NzEwYjdmMGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7TQrxAH2gAyNDU5Njg1NjQ1Ojk4OGQ0ZWRlOWY4MzZkYTJlNGEwZWYxYzQ5ZTdlZjk3NGMzNTU0ZGU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "31641df46f7e27330055e9bf72e49b46710b7f0d", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/31641df46f7e27330055e9bf72e49b46710b7f0d", "committedDate": "2020-07-26T15:19:35Z", "message": "Initial Finances code cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa4b0690356596f1ccbdbc4d106d47694f219cf5", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/fa4b0690356596f1ccbdbc4d106d47694f219cf5", "committedDate": "2020-07-26T15:20:27Z", "message": "Fixing tab spacing in Loan.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52ce2d0ebab8f7e711bc8a161667d76ea368923f", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/52ce2d0ebab8f7e711bc8a161667d76ea368923f", "committedDate": "2020-07-26T16:40:45Z", "message": "Implementing most of the Finances swapover to LocalDate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21ad1d9e670a2732186826a3f0914daeba6fa809", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/21ad1d9e670a2732186826a3f0914daeba6fa809", "committedDate": "2020-07-26T17:35:44Z", "message": "Moving DateChooser to LocalDate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f00647976761d0e47160bf64b86716bc722e8f1", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/4f00647976761d0e47160bf64b86716bc722e8f1", "committedDate": "2020-07-30T23:48:00Z", "message": "Fixing merge conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0eec87fa138f4e4fbdae0e8899a46484bcbf3dc6", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/0eec87fa138f4e4fbdae0e8899a46484bcbf3dc6", "committedDate": "2020-07-31T00:14:35Z", "message": "Fixing missed parts of the implementation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NjYzOTEw", "url": "https://github.com/MegaMek/mekhq/pull/1883#pullrequestreview-459663910", "createdAt": "2020-08-02T17:03:56Z", "commit": {"oid": "0eec87fa138f4e4fbdae0e8899a46484bcbf3dc6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxNzowMzo1NlrOG6mbyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxNzowOToxN1rOG6mdnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwMDI5OQ==", "bodyText": "This logic needs an explanation, if you're just looking for the next Monday/Sunday or something like that there is a more obvious way:\nd.with(TemporalAdjusters.next(DayOfWeek.MONDAY));", "url": "https://github.com/MegaMek/mekhq/pull/1883#discussion_r464100299", "createdAt": "2020-08-02T17:03:56Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/campaign/finances/Loan.java", "diffHunk": "@@ -93,102 +85,79 @@ public Loan(Money p, int r, int c, int y, int s, GregorianCalendar today, String\n     }\n \n     public void setFirstPaymentDate() {\n-        boolean keepGoing = true;\n         //We are going to assume a standard grace period, so you have to go\n         //through the first full time length (not partial) before your first\n         //payment\n-        int grace = 1;\n-        switch(schedule) {\n-        case Finances.SCHEDULE_BIWEEKLY:\n-            grace = 2;\n-            break;\n-        case Finances.SCHEDULE_QUARTERLY:\n-            grace = 3;\n-            break;\n-        }\n-        while(keepGoing) {\n-            nextPayment.add(GregorianCalendar.DAY_OF_YEAR, 1);\n-            switch(schedule) {\n+\n+        // First, we need to increase the number of days by one\n+        nextPayment = nextPayment.plusDays(1);\n+\n+        // Then, we create a variable to hold temporary difference values\n+        int temp;\n+\n+        // Finally, we use that and the schedule type to determine the length including the grace period\n+        switch (schedule) {\n             case Finances.SCHEDULE_BIWEEKLY:\n-                if(nextPayment.get(Calendar.DAY_OF_WEEK) == 1) {\n-                    if(grace > 0) {\n-                        grace--;\n-                    }\n-                    else {\n-                        keepGoing = false;\n-                    }\n+                temp = 8 - nextPayment.getDayOfWeek().getValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0eec87fa138f4e4fbdae0e8899a46484bcbf3dc6"}, "originalPosition": 140}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwMDMzMw==", "bodyText": "Same as above comment.", "url": "https://github.com/MegaMek/mekhq/pull/1883#discussion_r464100333", "createdAt": "2020-08-02T17:04:18Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/campaign/finances/Loan.java", "diffHunk": "@@ -93,102 +85,79 @@ public Loan(Money p, int r, int c, int y, int s, GregorianCalendar today, String\n     }\n \n     public void setFirstPaymentDate() {\n-        boolean keepGoing = true;\n         //We are going to assume a standard grace period, so you have to go\n         //through the first full time length (not partial) before your first\n         //payment\n-        int grace = 1;\n-        switch(schedule) {\n-        case Finances.SCHEDULE_BIWEEKLY:\n-            grace = 2;\n-            break;\n-        case Finances.SCHEDULE_QUARTERLY:\n-            grace = 3;\n-            break;\n-        }\n-        while(keepGoing) {\n-            nextPayment.add(GregorianCalendar.DAY_OF_YEAR, 1);\n-            switch(schedule) {\n+\n+        // First, we need to increase the number of days by one\n+        nextPayment = nextPayment.plusDays(1);\n+\n+        // Then, we create a variable to hold temporary difference values\n+        int temp;\n+\n+        // Finally, we use that and the schedule type to determine the length including the grace period\n+        switch (schedule) {\n             case Finances.SCHEDULE_BIWEEKLY:\n-                if(nextPayment.get(Calendar.DAY_OF_WEEK) == 1) {\n-                    if(grace > 0) {\n-                        grace--;\n-                    }\n-                    else {\n-                        keepGoing = false;\n-                    }\n+                temp = 8 - nextPayment.getDayOfWeek().getValue();\n+                if (temp != 7) {\n+                    nextPayment = nextPayment.plusDays(temp);\n                 }\n+                nextPayment = nextPayment.plusWeeks(2);\n                 break;\n             case Finances.SCHEDULE_MONTHLY:\n-                if(nextPayment.get(Calendar.DAY_OF_MONTH) == 1) {\n-                    if(grace > 0) {\n-                        grace--;\n-                    }\n-                    else {\n-                        keepGoing = false;\n-                    }\n+                temp = nextPayment.getDayOfMonth();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0eec87fa138f4e4fbdae0e8899a46484bcbf3dc6"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwMDY0NQ==", "bodyText": "Does this logic match the old logic, the old logic gave you days % 365 > 0 ? 1 : 0. Is this equivalent?", "url": "https://github.com/MegaMek/mekhq/pull/1883#discussion_r464100645", "createdAt": "2020-08-02T17:08:01Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/campaign/finances/Finances.java", "diffHunk": "@@ -111,37 +109,42 @@ public boolean isInDebt() {\n         return getLoanBalance().isPositive();\n     }\n \n-    public int getFullYearsInDebt(GregorianCalendar cal) {\n-        if (null == wentIntoDebt) {\n+    public int getFullYearsInDebt(LocalDate date) {\n+        if (wentIntoDebt == null) {\n             return 0;\n+        } else {\n+            return Math.toIntExact(ChronoUnit.YEARS.between(wentIntoDebt, date));\n         }\n-        return Utilities.getDiffFullYears(wentIntoDebt, cal);\n     }\n \n-    public int getPartialYearsInDebt(GregorianCalendar cal) {\n-        if (wentIntoDebt == null) {\n-            return 0;\n+    public int getPartialYearsInDebt(LocalDate date) {\n+        if (wentIntoDebt != null) {\n+            Period period = Period.between(wentIntoDebt, date);\n+            if ((period.getMonths() > 0) || (period.getDays() > 0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0eec87fa138f4e4fbdae0e8899a46484bcbf3dc6"}, "originalPosition": 102}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDEwMDc2NA==", "bodyText": "Use TemporalAdjusters.", "url": "https://github.com/MegaMek/mekhq/pull/1883#discussion_r464100764", "createdAt": "2020-08-02T17:09:17Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/gui/dialog/CustomizeScenarioDialog.java", "diffHunk": "@@ -371,44 +370,37 @@ private void btnCloseActionPerformed(java.awt.event.ActionEvent evt) {\n \n     private void changeDate() {\n         // show the date chooser\n-        GregorianCalendar day = GregorianCalendar.from(date.atStartOfDay(ZoneId.systemDefault()));\n-        DateChooser dc = new DateChooser(frame, day);\n+        DateChooser dc = new DateChooser(frame, date);\n         // user can either choose a date or cancel by closing\n         if (dc.showDateChooser() == DateChooser.OK_OPTION) {\n             if (scenario.isCurrent()) {\n-                if (dc.getDate().getTime().before(campaign.getDate())) {\n+                if (dc.getDate().isBefore(campaign.getLocalDate())) {\n                     JOptionPane.showMessageDialog(frame,\n                             \"You cannot choose a date before the current date for a pending battle.\",\n                             \"Invalid date\",\n                             JOptionPane.ERROR_MESSAGE);\n                     return;\n                 } else {\n-                    //Calendar math necessitated by variations in locales\n-                    GregorianCalendar nextMonday = new GregorianCalendar();\n-                    nextMonday.setTime(campaign.getDate());\n-                    nextMonday.add(Calendar.DAY_OF_MONTH, 1);\n-                    while (nextMonday.get(Calendar.DAY_OF_WEEK) != Calendar.MONDAY) {\n-                        nextMonday.add(Calendar.DAY_OF_MONTH, 1);\n-                    }\n+                    LocalDate nextMonday = campaign.getLocalDate()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0eec87fa138f4e4fbdae0e8899a46484bcbf3dc6"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93a114417c2a5bf797cc57dad5e7e85e449f83b3", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/93a114417c2a5bf797cc57dad5e7e85e449f83b3", "committedDate": "2020-08-03T13:47:41Z", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_FinancesLocalDate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5b9445c3def0a8ea4ff613865db4368ad1a169f", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/e5b9445c3def0a8ea4ff613865db4368ad1a169f", "committedDate": "2020-08-03T14:12:26Z", "message": "Swapping over to use TemporalAdjusters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMDg4MDMw", "url": "https://github.com/MegaMek/mekhq/pull/1883#pullrequestreview-460088030", "createdAt": "2020-08-03T14:45:30Z", "commit": {"oid": "e5b9445c3def0a8ea4ff613865db4368ad1a169f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDo0NTozMFrOG68cVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDo0NTozMFrOG68cVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ2MDg4NQ==", "bodyText": "Still needed?", "url": "https://github.com/MegaMek/mekhq/pull/1883#discussion_r464460885", "createdAt": "2020-08-03T14:45:30Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/campaign/finances/Loan.java", "diffHunk": "@@ -93,102 +87,72 @@ public Loan(Money p, int r, int c, int y, int s, GregorianCalendar today, String\n     }\n \n     public void setFirstPaymentDate() {\n-        boolean keepGoing = true;\n         //We are going to assume a standard grace period, so you have to go\n         //through the first full time length (not partial) before your first\n         //payment\n-        int grace = 1;\n-        switch(schedule) {\n-        case Finances.SCHEDULE_BIWEEKLY:\n-            grace = 2;\n-            break;\n-        case Finances.SCHEDULE_QUARTERLY:\n-            grace = 3;\n-            break;\n-        }\n-        while(keepGoing) {\n-            nextPayment.add(GregorianCalendar.DAY_OF_YEAR, 1);\n-            switch(schedule) {\n+\n+        // First, we need to increase the number of days by one\n+        nextPayment = nextPayment.plusDays(1);\n+\n+        // Then, we create a variable to hold temporary difference values\n+        int temp;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5b9445c3def0a8ea4ff613865db4368ad1a169f"}, "originalPosition": 130}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "988d4ede9f836da2e4a0ef1c49e7ef974c3554de", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/988d4ede9f836da2e4a0ef1c49e7ef974c3554de", "committedDate": "2020-08-03T14:54:02Z", "message": "Removing unused variable"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4329, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}