{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2NDk4ODE1", "number": 2088, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozNTozNVrOEpm2Ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTo0NDoyOVrOEpnAAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDYzNTc5OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/MissingBattleArmorSuit.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozNTozNVrOHbYR2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozNTozNVrOHbYR2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3MTM4Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\tfor(Part p : bestPart.getChildParts()) {\n          \n          \n            \n            \t\t\t\t\tfor (Part p : bestPart.getChildParts()) {", "url": "https://github.com/MegaMek/mekhq/pull/2088#discussion_r498471386", "createdAt": "2020-10-01T19:35:35Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/MissingBattleArmorSuit.java", "diffHunk": "@@ -332,25 +329,19 @@ public Part findReplacement(boolean refit) {\n \t\t\t\t\tint currentPartArmor = 0;\n \t\t\t\t\tint bestPartQuantity = 0;\n \t\t\t\t\tint currentPartQuantity = 0;\n-\t\t\t\t\tfor(int childId : bestPart.childPartIds) {\n-\t\t\t\t\t\tPart p = campaign.getPart(childId);\n-\t\t\t\t\t\tif(p != null) {\n-\t\t\t\t\t\t\tif(p instanceof BaArmor) {\n-\t\t\t\t\t\t\t\tbestPartArmor = ((BaArmor)p).getAmount();\n-\t\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t\tbestPartQuantity++;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n+\t\t\t\t\tfor(Part p : bestPart.getChildParts()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08ab72f94acb7b6296948c563bf55ed99a32b44c"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDYzNjc0OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/MissingBattleArmorSuit.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozNjowMlrOHbYSgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTo1MzowMFrOHbYxPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3MTU1Mg==", "bodyText": "This looks odd, likely tab vs space issues", "url": "https://github.com/MegaMek/mekhq/pull/2088#discussion_r498471552", "createdAt": "2020-10-01T19:36:02Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/MissingBattleArmorSuit.java", "diffHunk": "@@ -253,14 +251,13 @@ public void fix() {\n                 }\n                 missingStuff.add(missingBaEquip);\n             }\n-            for(int childId : replacement.getChildPartIds()) {\n-        \t\tPart childPart = campaign.getPart(childId);\n-        \t\tif(childPart instanceof BaArmor && null != origArmor) {\n+            for (Part childPart : replacement.getChildParts()) {\n+        \t\tif (childPart instanceof BaArmor && null != origArmor) {\n         \t\t\tunit.getEntity().setArmor(((BaArmor)childPart).getAmount(), trooper);\n         \t\t\torigArmor.updateConditionFromEntity(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08ab72f94acb7b6296948c563bf55ed99a32b44c"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3OTQyMg==", "bodyText": "Agreed. Because of the //region code used, I cannot use formatting anymore with VSCode or I'll break them. I'll see what I can do to switch the file to spaces without breaking region comments.", "url": "https://github.com/MegaMek/mekhq/pull/2088#discussion_r498479422", "createdAt": "2020-10-01T19:53:00Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/campaign/parts/MissingBattleArmorSuit.java", "diffHunk": "@@ -253,14 +251,13 @@ public void fix() {\n                 }\n                 missingStuff.add(missingBaEquip);\n             }\n-            for(int childId : replacement.getChildPartIds()) {\n-        \t\tPart childPart = campaign.getPart(childId);\n-        \t\tif(childPart instanceof BaArmor && null != origArmor) {\n+            for (Part childPart : replacement.getChildParts()) {\n+        \t\tif (childPart instanceof BaArmor && null != origArmor) {\n         \t\t\tunit.getEntity().setArmor(((BaArmor)childPart).getAmount(), trooper);\n         \t\t\torigArmor.updateConditionFromEntity(false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3MTU1Mg=="}, "originalCommit": {"oid": "08ab72f94acb7b6296948c563bf55ed99a32b44c"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDY0NTQxOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/BattleArmorSuit.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozODo1MFrOHbYX-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozODo1MFrOHbYX-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3Mjk1Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for(Part p : getChildParts()) {\n          \n          \n            \n                    for (Part p : getChildParts()) {", "url": "https://github.com/MegaMek/mekhq/pull/2088#discussion_r498472952", "createdAt": "2020-10-01T19:38:50Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/BattleArmorSuit.java", "diffHunk": "@@ -267,14 +267,11 @@ public Money getStickerPrice() {\n             cost = cost.plus(50000 * (jumpMP + 1));\n         }\n         cost = cost.plus(25000 * (groundMP-1));\n-        for(int childId : getChildPartIds()) {\n-            Part p = campaign.getPart(childId);\n-            if(null != p) {\n-                if(p instanceof BaArmor) {\n-                    cost = cost.plus(p.getCurrentValue());\n-                } else if (!(p instanceof BattleArmorSuit)) {\n-                    cost = cost.plus(p.getStickerPrice());\n-                }\n+        for(Part p : getChildParts()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08ab72f94acb7b6296948c563bf55ed99a32b44c"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDY0NTg2OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/BattleArmorSuit.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozOTowMlrOHbYYSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozOTowMlrOHbYYSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3MzAzMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(null == unit && getChildParts().isEmpty()) {\n          \n          \n            \n                    if ((null == unit) && getChildParts().isEmpty()) {", "url": "https://github.com/MegaMek/mekhq/pull/2088#discussion_r498473032", "createdAt": "2020-10-01T19:39:02Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/BattleArmorSuit.java", "diffHunk": "@@ -234,7 +234,7 @@ else if(jumpType == EntityMovementMode.VTOL) {\n     public Money getStickerPrice() {\n         //if there are no linked parts and the unit is null,\n         //then use the pre-recorded alternate costs\n-        if(null == unit && getChildPartIds().size()==0) {\n+        if(null == unit && getChildParts().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08ab72f94acb7b6296948c563bf55ed99a32b44c"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDY0NjQ1OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/BattleArmorSuit.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozOToxOVrOHbYYwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozOToxOVrOHbYYwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3MzE1NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for(Part p : getChildParts()) {\n          \n          \n            \n                    for (Part p : getChildParts()) {", "url": "https://github.com/MegaMek/mekhq/pull/2088#discussion_r498473154", "createdAt": "2020-10-01T19:39:19Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/BattleArmorSuit.java", "diffHunk": "@@ -218,12 +219,11 @@ else if(jumpType == EntityMovementMode.VTOL) {\n         }\n         //if there are no linked parts and the unit is null,\n         //then use the pre-recorded extra costs\n-        if(null == unit && getChildPartIds().size()==0) {\n+        if(null == unit && getChildParts().isEmpty()) {\n             tons += alternateTon;\n         }\n-        for(int childId : getChildPartIds()) {\n-            Part p = campaign.getPart(childId);\n-            if(null != p && !(p instanceof BattleArmorSuit)) {\n+        for(Part p : getChildParts()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08ab72f94acb7b6296948c563bf55ed99a32b44c"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDY0NjgyOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/BattleArmorSuit.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozOToyN1rOHbYZBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozOToyN1rOHbYZBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3MzIyMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(null == unit && getChildParts().isEmpty()) {\n          \n          \n            \n                    if ((null == unit) && getChildParts().isEmpty()) {", "url": "https://github.com/MegaMek/mekhq/pull/2088#discussion_r498473223", "createdAt": "2020-10-01T19:39:27Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/BattleArmorSuit.java", "diffHunk": "@@ -218,12 +219,11 @@ else if(jumpType == EntityMovementMode.VTOL) {\n         }\n         //if there are no linked parts and the unit is null,\n         //then use the pre-recorded extra costs\n-        if(null == unit && getChildPartIds().size()==0) {\n+        if(null == unit && getChildParts().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08ab72f94acb7b6296948c563bf55ed99a32b44c"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDY0NzA3OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/BattleArmorSuit.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozOTozNlrOHbYZNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTozOTozNlrOHbYZNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3MzI3MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(null == unit && getChildParts().isEmpty()) {\n          \n          \n            \n                    if ((null == unit) && getChildParts().isEmpty()) {", "url": "https://github.com/MegaMek/mekhq/pull/2088#discussion_r498473271", "createdAt": "2020-10-01T19:39:36Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/BattleArmorSuit.java", "diffHunk": "@@ -139,7 +140,7 @@ public void setTrooper(int i) {\n     public double getTonnage() {\n         //if there are no linked parts and the unit is null,\n         //then use the pre-recorded alternate costs\n-        if(null == unit && getChildPartIds().size()==0) {\n+        if(null == unit && getChildParts().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08ab72f94acb7b6296948c563bf55ed99a32b44c"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDY1MDk0OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTo0MDo1MFrOHbYbwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTo0MDo1MFrOHbYbwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3MzkyMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (null == p.getUnit() && !p.hasParentPart()) {\n          \n          \n            \n                    if ((null == p.getUnit()) && !p.hasParentPart()) {", "url": "https://github.com/MegaMek/mekhq/pull/2088#discussion_r498473920", "createdAt": "2020-10-01T19:40:50Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -1634,7 +1634,7 @@ public void addPart(Part p, int transitDays) {\n             p.setId(-1);\n             return;\n         }\n-        if (null == p.getUnit()) {\n+        if (null == p.getUnit() && !p.hasParentPart()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08ab72f94acb7b6296948c563bf55ed99a32b44c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDY1ODUwOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/Part.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTo0Mzo0NVrOHbYgyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTo0Mzo0NVrOHbYgyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3NTIxMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    /**\n          \n          \n            \n                     *\n          \n          \n            \n                     */\n          \n          \n            \n                    private static final long serialVersionUID = 1L;\n          \n          \n            \n                    private static final long serialVersionUID = 1L;", "url": "https://github.com/MegaMek/mekhq/pull/2088#discussion_r498475210", "createdAt": "2020-10-01T19:43:45Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/Part.java", "diffHunk": "@@ -1775,4 +1761,144 @@ public SimpleTechLevel getStaticTechLevel() {\n         }\n         return getTechAdvancement().getStaticTechLevel();\n     }\n+\n+    public void fixupPartReferences(Map<Integer, Part> knownParts) {\n+        if (parentPart instanceof PartRef) {\n+            int id = parentPart.getId();\n+            parentPart = knownParts.get(id);\n+            if (parentPart == null) {\n+                MekHQ.getLogger().error(PartRef.class,\n+                    String.format(\"Part %d ('%s') references missing parent part %d\",\n+                        getId(), getName(), id));\n+            }\n+        }\n+\n+        for (int ii = childParts.size() - 1; ii >= 0; --ii) {\n+            Part childPart = childParts.get(ii);\n+            if (childPart instanceof PartRef) {\n+                Part realPart = knownParts.get(childPart.getId());\n+                if (realPart != null) {\n+                    childParts.set(ii, realPart);\n+                } else {\n+                    MekHQ.getLogger().error(PartRef.class,\n+                        String.format(\"Part %d ('%s') references missing child part %d\",\n+                            getId(), getName(), id));\n+                    childParts.remove(ii);\n+                }\n+            }\n+        }\n+    }\n+\n+    public static class PartRef extends Part {\n+        /**\n+         *\n+         */\n+        private static final long serialVersionUID = 1L;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08ab72f94acb7b6296948c563bf55ed99a32b44c"}, "originalPosition": 200}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDY1OTI1OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/Part.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTo0NDowMlrOHbYhRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTo1MjowNlrOHbYvrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3NTMzNQ==", "bodyText": "Why 1L instead of an actual serialVersionUID?", "url": "https://github.com/MegaMek/mekhq/pull/2088#discussion_r498475335", "createdAt": "2020-10-01T19:44:02Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/Part.java", "diffHunk": "@@ -1775,4 +1761,144 @@ public SimpleTechLevel getStaticTechLevel() {\n         }\n         return getTechAdvancement().getStaticTechLevel();\n     }\n+\n+    public void fixupPartReferences(Map<Integer, Part> knownParts) {\n+        if (parentPart instanceof PartRef) {\n+            int id = parentPart.getId();\n+            parentPart = knownParts.get(id);\n+            if (parentPart == null) {\n+                MekHQ.getLogger().error(PartRef.class,\n+                    String.format(\"Part %d ('%s') references missing parent part %d\",\n+                        getId(), getName(), id));\n+            }\n+        }\n+\n+        for (int ii = childParts.size() - 1; ii >= 0; --ii) {\n+            Part childPart = childParts.get(ii);\n+            if (childPart instanceof PartRef) {\n+                Part realPart = knownParts.get(childPart.getId());\n+                if (realPart != null) {\n+                    childParts.set(ii, realPart);\n+                } else {\n+                    MekHQ.getLogger().error(PartRef.class,\n+                        String.format(\"Part %d ('%s') references missing child part %d\",\n+                            getId(), getName(), id));\n+                    childParts.remove(ii);\n+                }\n+            }\n+        }\n+    }\n+\n+    public static class PartRef extends Part {\n+        /**\n+         *\n+         */\n+        private static final long serialVersionUID = 1L;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08ab72f94acb7b6296948c563bf55ed99a32b44c"}, "originalPosition": 200}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3OTAyMg==", "bodyText": "1 is a valid version UID.", "url": "https://github.com/MegaMek/mekhq/pull/2088#discussion_r498479022", "createdAt": "2020-10-01T19:52:06Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/campaign/parts/Part.java", "diffHunk": "@@ -1775,4 +1761,144 @@ public SimpleTechLevel getStaticTechLevel() {\n         }\n         return getTechAdvancement().getStaticTechLevel();\n     }\n+\n+    public void fixupPartReferences(Map<Integer, Part> knownParts) {\n+        if (parentPart instanceof PartRef) {\n+            int id = parentPart.getId();\n+            parentPart = knownParts.get(id);\n+            if (parentPart == null) {\n+                MekHQ.getLogger().error(PartRef.class,\n+                    String.format(\"Part %d ('%s') references missing parent part %d\",\n+                        getId(), getName(), id));\n+            }\n+        }\n+\n+        for (int ii = childParts.size() - 1; ii >= 0; --ii) {\n+            Part childPart = childParts.get(ii);\n+            if (childPart instanceof PartRef) {\n+                Part realPart = knownParts.get(childPart.getId());\n+                if (realPart != null) {\n+                    childParts.set(ii, realPart);\n+                } else {\n+                    MekHQ.getLogger().error(PartRef.class,\n+                        String.format(\"Part %d ('%s') references missing child part %d\",\n+                            getId(), getName(), id));\n+                    childParts.remove(ii);\n+                }\n+            }\n+        }\n+    }\n+\n+    public static class PartRef extends Part {\n+        /**\n+         *\n+         */\n+        private static final long serialVersionUID = 1L;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3NTMzNQ=="}, "originalCommit": {"oid": "08ab72f94acb7b6296948c563bf55ed99a32b44c"}, "originalPosition": 200}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMDY2MDUwOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/Part.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTo0NDoyOVrOHbYiFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxOTo0NDoyOVrOHbYiFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3NTU0Mw==", "bodyText": "Please clear out the TODOs unless they are useful.", "url": "https://github.com/MegaMek/mekhq/pull/2088#discussion_r498475543", "createdAt": "2020-10-01T19:44:29Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/Part.java", "diffHunk": "@@ -1775,4 +1761,144 @@ public SimpleTechLevel getStaticTechLevel() {\n         }\n         return getTechAdvancement().getStaticTechLevel();\n     }\n+\n+    public void fixupPartReferences(Map<Integer, Part> knownParts) {\n+        if (parentPart instanceof PartRef) {\n+            int id = parentPart.getId();\n+            parentPart = knownParts.get(id);\n+            if (parentPart == null) {\n+                MekHQ.getLogger().error(PartRef.class,\n+                    String.format(\"Part %d ('%s') references missing parent part %d\",\n+                        getId(), getName(), id));\n+            }\n+        }\n+\n+        for (int ii = childParts.size() - 1; ii >= 0; --ii) {\n+            Part childPart = childParts.get(ii);\n+            if (childPart instanceof PartRef) {\n+                Part realPart = knownParts.get(childPart.getId());\n+                if (realPart != null) {\n+                    childParts.set(ii, realPart);\n+                } else {\n+                    MekHQ.getLogger().error(PartRef.class,\n+                        String.format(\"Part %d ('%s') references missing child part %d\",\n+                            getId(), getName(), id));\n+                    childParts.remove(ii);\n+                }\n+            }\n+        }\n+    }\n+\n+    public static class PartRef extends Part {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08ab72f94acb7b6296948c563bf55ed99a32b44c"}, "originalPosition": 196}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2002, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}