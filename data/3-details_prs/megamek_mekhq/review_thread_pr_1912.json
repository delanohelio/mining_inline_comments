{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1MDk4Mzg0", "number": 1912, "reviewThreads": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjowNzo0M1rOEWotTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMTozMDo1N1rOEXBVVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTcxMDg1OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjowNzo0M1rOG9_vFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDoxNToxM1rOG-A9JQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MDU2Ng==", "bodyText": "Why not just chain appends?", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467660566", "createdAt": "2020-08-10T02:07:43Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5663,12 +5663,17 @@ public TargetRoll getTargetForAcquisition(IAcquisitionWork acquisition,\n                 et = ((MissingEquipmentPart) acquisition).getType();\n             }\n \n+            StringBuilder partAvailabilityLog = new StringBuilder();\n+            partAvailabilityLog.append(\"Part Rating Level: \" + partAvailability);\n+            partAvailabilityLog.append(\"(\" + EquipmentType.ratingNames[partAvailability] + \")\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY3OTcxMw==", "bodyText": "I found it easier to read the code that way, but I can probably just put the append on the next line as well.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467679713", "createdAt": "2020-08-10T04:10:17Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5663,12 +5663,17 @@ public TargetRoll getTargetForAcquisition(IAcquisitionWork acquisition,\n                 et = ((MissingEquipmentPart) acquisition).getType();\n             }\n \n+            StringBuilder partAvailabilityLog = new StringBuilder();\n+            partAvailabilityLog.append(\"Part Rating Level: \" + partAvailability);\n+            partAvailabilityLog.append(\"(\" + EquipmentType.ratingNames[partAvailability] + \")\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MDU2Ng=="}, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4MDU0OQ==", "bodyText": "I'd recommend the next line append, as it is somewhat cleaner in file.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467680549", "createdAt": "2020-08-10T04:15:13Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5663,12 +5663,17 @@ public TargetRoll getTargetForAcquisition(IAcquisitionWork acquisition,\n                 et = ((MissingEquipmentPart) acquisition).getType();\n             }\n \n+            StringBuilder partAvailabilityLog = new StringBuilder();\n+            partAvailabilityLog.append(\"Part Rating Level: \" + partAvailability);\n+            partAvailabilityLog.append(\"(\" + EquipmentType.ratingNames[partAvailability] + \")\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MDU2Ng=="}, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTcxMTQyOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjowODoyMVrOG9_vYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjowODoyMVrOG9_vYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MDY0Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                if (((megamek.common.AmmoType) et).getMunitionType() == megamek.common.AmmoType.M_STANDARD) {                        \n          \n          \n            \n                                if (((megamek.common.AmmoType) et).getMunitionType() == megamek.common.AmmoType.M_STANDARD) {", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467660642", "createdAt": "2020-08-10T02:08:21Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5682,27 +5687,33 @@ public TargetRoll getTargetForAcquisition(IAcquisitionWork acquisition,\n                         && !(et instanceof megamek.common.weapons.flamers.FlamerWeapon)\n                         && partAvailability < EquipmentType.RATING_C) {\n                     partAvailability = EquipmentType.RATING_C;\n+                    partAvailabilityLog.append(\";(non-flamer lasers)\");\n                 }\n                 if (et instanceof megamek.common.weapons.autocannons.ACWeapon) {\n                     partAvailability -= 2;\n+                    partAvailabilityLog.append(\";(autocannon): -2\");\n                 }\n                 if (et instanceof megamek.common.weapons.gaussrifles.GaussWeapon\n                         || et instanceof megamek.common.weapons.flamers.FlamerWeapon) {\n                     partAvailability--;\n+                    partAvailabilityLog.append(\";(gauss rifle or flamer): -1\");\n                 }\n                 if (et instanceof megamek.common.AmmoType) {\n                     switch (((megamek.common.AmmoType) et).getAmmoType()) {\n                         case megamek.common.AmmoType.T_AC:\n                             partAvailability -= 2;\n+                            partAvailabilityLog.append(\";(autocannon ammo): -2\");\n                             break;\n                         case megamek.common.AmmoType.T_GAUSS:\n                             partAvailability -= 1;\n+                            partAvailabilityLog.append(\";(gauss ammo): -1\");\n+                            break;\n                     }\n-                    if (((megamek.common.AmmoType) et).getMunitionType() == megamek.common.AmmoType.M_STANDARD) {\n+                    if (((megamek.common.AmmoType) et).getMunitionType() == megamek.common.AmmoType.M_STANDARD) {                        ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTcxMjkxOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjowOTo1M1rOG9_wIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjoxMDoxNFrOG9_wag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MDgzNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    AtBContract contract = acquisition != null ? getAttachedAtBContract(acquisition.getUnit()) : null;\n          \n          \n            \n                    AtBContract contract = (acquisition != null) ? getAttachedAtBContract(acquisition.getUnit()) : null;", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467660834", "createdAt": "2020-08-10T02:09:53Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5746,28 +5759,44 @@ public int totalBonusParts() {\n         return retVal;\n     }\n \n-    private int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition) {\n-        AtBContract contract = getAttachedAtBContract(acquisition.getUnit());\n+    public int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition, StringBuilder reportBuilder) {\n+        AtBContract contract = acquisition != null ? getAttachedAtBContract(acquisition.getUnit()) : null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MDkwNg==", "bodyText": "Very much just a suggestion, but one I find makes it easier to parse later.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467660906", "createdAt": "2020-08-10T02:10:14Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5746,28 +5759,44 @@ public int totalBonusParts() {\n         return retVal;\n     }\n \n-    private int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition) {\n-        AtBContract contract = getAttachedAtBContract(acquisition.getUnit());\n+    public int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition, StringBuilder reportBuilder) {\n+        AtBContract contract = acquisition != null ? getAttachedAtBContract(acquisition.getUnit()) : null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MDgzNA=="}, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTcxODAzOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjoxNDo0MVrOG9_ywQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjoxNDo0MVrOG9_ywQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MTUwNQ==", "bodyText": "This could be simplified and its performance can be boosted by swapping to an if statement checking hasActiveContract() followed by using getActiveContracts()", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467661505", "createdAt": "2020-08-10T02:14:41Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5746,28 +5759,44 @@ public int totalBonusParts() {\n         return retVal;\n     }\n \n-    private int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition) {\n-        AtBContract contract = getAttachedAtBContract(acquisition.getUnit());\n+    public int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition, StringBuilder reportBuilder) {\n+        AtBContract contract = acquisition != null ? getAttachedAtBContract(acquisition.getUnit()) : null;\n         /*\n          * If the unit is not assigned to a contract, use the least restrictive active\n-         * contract\n+         * contract. Don't restrict parts availability by contract if it has not started.\n          */\n         for (Mission m : getMissions()) {\n-            if (m.isActive() && m instanceof AtBContract) {\n+            if (m.isActive() && m instanceof AtBContract && ((AtBContract) m).getStartDate().isBefore(currentDay)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTcxOTA4OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjoxNToxM1rOG9_zNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjoxNToxM1rOG9_zNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MTYyMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (null != contract && contract.getStartDate().isBefore(currentDay)) {\n          \n          \n            \n                    if ((null != contract) && contract.getStartDate().isBefore(currentDay)) {", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467661620", "createdAt": "2020-08-10T02:15:13Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5746,28 +5759,44 @@ public int totalBonusParts() {\n         return retVal;\n     }\n \n-    private int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition) {\n-        AtBContract contract = getAttachedAtBContract(acquisition.getUnit());\n+    public int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition, StringBuilder reportBuilder) {\n+        AtBContract contract = acquisition != null ? getAttachedAtBContract(acquisition.getUnit()) : null;\n         /*\n          * If the unit is not assigned to a contract, use the least restrictive active\n-         * contract\n+         * contract. Don't restrict parts availability by contract if it has not started.\n          */\n         for (Mission m : getMissions()) {\n-            if (m.isActive() && m instanceof AtBContract) {\n+            if (m.isActive() && m instanceof AtBContract && ((AtBContract) m).getStartDate().isBefore(currentDay)) {\n                 if (null == contract\n                         || ((AtBContract) m).getPartsAvailabilityLevel() > contract.getPartsAvailabilityLevel()) {\n                     contract = (AtBContract) m;\n                 }\n             }\n         }\n-        if (null != contract) {\n+        \n+        // if we have a contract and it has started\n+        if (null != contract && contract.getStartDate().isBefore(currentDay)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 96}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTcxOTYwOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjoxNTozMVrOG9_zcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjoxNTozMVrOG9_zcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MTY4Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if(adminLog != null) {\n          \n          \n            \n                        if (adminLog != null) {", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467661683", "createdAt": "2020-08-10T02:15:31Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5746,28 +5759,44 @@ public int totalBonusParts() {\n         return retVal;\n     }\n \n-    private int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition) {\n-        AtBContract contract = getAttachedAtBContract(acquisition.getUnit());\n+    public int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition, StringBuilder reportBuilder) {\n+        AtBContract contract = acquisition != null ? getAttachedAtBContract(acquisition.getUnit()) : null;\n         /*\n          * If the unit is not assigned to a contract, use the least restrictive active\n-         * contract\n+         * contract. Don't restrict parts availability by contract if it has not started.\n          */\n         for (Mission m : getMissions()) {\n-            if (m.isActive() && m instanceof AtBContract) {\n+            if (m.isActive() && m instanceof AtBContract && ((AtBContract) m).getStartDate().isBefore(currentDay)) {\n                 if (null == contract\n                         || ((AtBContract) m).getPartsAvailabilityLevel() > contract.getPartsAvailabilityLevel()) {\n                     contract = (AtBContract) m;\n                 }\n             }\n         }\n-        if (null != contract) {\n+        \n+        // if we have a contract and it has started\n+        if (null != contract && contract.getStartDate().isBefore(currentDay)) {\n+            if (reportBuilder != null) {\n+                reportBuilder.append(contract.getPartsAvailabilityLevel() + \" (\" + contract.getType() +\")\");\n+            }\n             return contract.getPartsAvailabilityLevel();\n         }\n         /* If contract is still null, the unit is not in a contract. */\n         Person adminLog = findBestInRole(Person.T_ADMIN_LOG, SkillType.S_ADMIN);\n         int adminLogExp = (adminLog == null) ? SkillType.EXP_ULTRA_GREEN\n                 : adminLog.getSkill(SkillType.S_ADMIN).getExperienceLevel();\n-        return getUnitRatingMod() + adminLogExp - SkillType.EXP_REGULAR;\n+        int adminMod = adminLogExp - SkillType.EXP_REGULAR;\n+        \n+        if (reportBuilder != null) {\n+            reportBuilder.append(getUnitRatingMod() + \"(unit rating)\");\n+            if(adminLog != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 111}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTcyMTMyOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjoxNzoyMlrOG9_0Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjoxNzoyMlrOG9_0Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MTkyMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(!getCampaign().getCampaignOptions().getUseAtB()) {\n          \n          \n            \n                    if (!getCampaign().getCampaignOptions().getUseAtB()) {", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467661922", "createdAt": "2020-08-10T02:17:22Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "diffHunk": "@@ -2586,6 +2590,16 @@ private void refreshTempMedics() {\n         String text = \"<html><b>Temp Medics:</b> \" + getCampaign().getMedicPool() + \"</html>\";\n         lblTempMedics.setText(text);\n     }\n+    \n+    private void refreshPartsAvailability() {\n+        if(!getCampaign().getCampaignOptions().getUseAtB()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTcyMTUxOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjoxNzozNVrOG9_0fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjoxNzozNVrOG9_0fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MTk1MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467661950", "createdAt": "2020-08-10T02:17:35Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "diffHunk": "@@ -2662,7 +2680,18 @@ public void handle(MedicPoolChangedEvent ev) {\n     public void handleLocationChanged(LocationChangedEvent ev) {\n         refreshLocation();\n     }\n-\n+    \n+    @Subscribe\n+    public void handleMissionChanged(MissionEvent ev) {\n+        refreshPartsAvailability();\n+    }\n+    \n+    @Subscribe\n+    public void handleMissionChanged(PersonChangedEvent ev) {\n+        refreshPartsAvailability();\n+    }\n+    \n+    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 111}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTcyMjQzOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjoxODoyNlrOG9_1AA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDo1NzowOVrOG-BZxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MjA4MA==", "bodyText": "This name doesn't make sense, did you mean to name it handlePersonChanged?\nAlso, why are we refreshing parts whenever any person is changed?", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467662080", "createdAt": "2020-08-10T02:18:26Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "diffHunk": "@@ -2662,7 +2680,18 @@ public void handle(MedicPoolChangedEvent ev) {\n     public void handleLocationChanged(LocationChangedEvent ev) {\n         refreshLocation();\n     }\n-\n+    \n+    @Subscribe\n+    public void handleMissionChanged(MissionEvent ev) {\n+        refreshPartsAvailability();\n+    }\n+    \n+    @Subscribe\n+    public void handleMissionChanged(PersonChangedEvent ev) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4MDExMQ==", "bodyText": "Parts availability depends, in part on the highest-skilled logistics admin. I could probably limit it to refreshing only when the logistics skill changed, but I'm not sure if that's possible. I'll take a look.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467680111", "createdAt": "2020-08-10T04:12:44Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "diffHunk": "@@ -2662,7 +2680,18 @@ public void handle(MedicPoolChangedEvent ev) {\n     public void handleLocationChanged(LocationChangedEvent ev) {\n         refreshLocation();\n     }\n-\n+    \n+    @Subscribe\n+    public void handleMissionChanged(MissionEvent ev) {\n+        refreshPartsAvailability();\n+    }\n+    \n+    @Subscribe\n+    public void handleMissionChanged(PersonChangedEvent ev) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MjA4MA=="}, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4MDY1Ng==", "bodyText": "I'm pretty sure it isn't currently, annoyingly.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467680656", "createdAt": "2020-08-10T04:15:52Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "diffHunk": "@@ -2662,7 +2680,18 @@ public void handle(MedicPoolChangedEvent ev) {\n     public void handleLocationChanged(LocationChangedEvent ev) {\n         refreshLocation();\n     }\n-\n+    \n+    @Subscribe\n+    public void handleMissionChanged(MissionEvent ev) {\n+        refreshPartsAvailability();\n+    }\n+    \n+    @Subscribe\n+    public void handleMissionChanged(PersonChangedEvent ev) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MjA4MA=="}, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4MzQxMQ==", "bodyText": "Looks like I can at least check that the person who was changed has a logistics admin role.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467683411", "createdAt": "2020-08-10T04:31:59Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "diffHunk": "@@ -2662,7 +2680,18 @@ public void handle(MedicPoolChangedEvent ev) {\n     public void handleLocationChanged(LocationChangedEvent ev) {\n         refreshLocation();\n     }\n-\n+    \n+    @Subscribe\n+    public void handleMissionChanged(MissionEvent ev) {\n+        refreshPartsAvailability();\n+    }\n+    \n+    @Subscribe\n+    public void handleMissionChanged(PersonChangedEvent ev) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MjA4MA=="}, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4MzYzMg==", "bodyText": "That will almost certainly be better performing, so can that be implemented?", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467683632", "createdAt": "2020-08-10T04:33:32Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "diffHunk": "@@ -2662,7 +2680,18 @@ public void handle(MedicPoolChangedEvent ev) {\n     public void handleLocationChanged(LocationChangedEvent ev) {\n         refreshLocation();\n     }\n-\n+    \n+    @Subscribe\n+    public void handleMissionChanged(MissionEvent ev) {\n+        refreshPartsAvailability();\n+    }\n+    \n+    @Subscribe\n+    public void handleMissionChanged(PersonChangedEvent ev) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MjA4MA=="}, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4MzY4Nw==", "bodyText": "Yep. Checking now.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467683687", "createdAt": "2020-08-10T04:33:53Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "diffHunk": "@@ -2662,7 +2680,18 @@ public void handle(MedicPoolChangedEvent ev) {\n     public void handleLocationChanged(LocationChangedEvent ev) {\n         refreshLocation();\n     }\n-\n+    \n+    @Subscribe\n+    public void handleMissionChanged(MissionEvent ev) {\n+        refreshPartsAvailability();\n+    }\n+    \n+    @Subscribe\n+    public void handleMissionChanged(PersonChangedEvent ev) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MjA4MA=="}, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4Nzg3OQ==", "bodyText": "Done.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467687879", "createdAt": "2020-08-10T04:57:09Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "diffHunk": "@@ -2662,7 +2680,18 @@ public void handle(MedicPoolChangedEvent ev) {\n     public void handleLocationChanged(LocationChangedEvent ev) {\n         refreshLocation();\n     }\n-\n+    \n+    @Subscribe\n+    public void handleMissionChanged(MissionEvent ev) {\n+        refreshPartsAvailability();\n+    }\n+    \n+    @Subscribe\n+    public void handleMissionChanged(PersonChangedEvent ev) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MjA4MA=="}, "originalCommit": {"oid": "78dbd3fb0d0c898f11240784decde68d6192ce48"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTkxMTg0OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDo1NjozN1rOG-BZVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDo1NjozN1rOG-BZVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4Nzc2Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if (c instanceof AtBContract && \n          \n          \n            \n                            if ((c instanceof AtBContract) &&", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467687766", "createdAt": "2020-08-10T04:56:37Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5761,15 +5762,18 @@ public int totalBonusParts() {\n \n     public int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition, StringBuilder reportBuilder) {\n         AtBContract contract = (acquisition != null) ? getAttachedAtBContract(acquisition.getUnit()) : null;\n+        \n         /*\n          * If the unit is not assigned to a contract, use the least restrictive active\n          * contract. Don't restrict parts availability by contract if it has not started.\n          */\n-        for (Mission m : getMissions()) {\n-            if (m.isActive() && m instanceof AtBContract && ((AtBContract) m).getStartDate().isBefore(currentDay)) {\n-                if (null == contract\n-                        || ((AtBContract) m).getPartsAvailabilityLevel() > contract.getPartsAvailabilityLevel()) {\n-                    contract = (AtBContract) m;\n+        if (hasActiveContract() && (contract == null)) {\n+            for (Contract c : getActiveContracts()) {\n+                if (c instanceof AtBContract && ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2d55d9939e019ec8c0edbd22d39d539c80ff677"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTkxMjEyOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDo1Njo0OFrOG-BZfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDo1Njo0OFrOG-BZfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4NzgwNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    (contract == null || \n          \n          \n            \n                                    ((contract == null) ||", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467687804", "createdAt": "2020-08-10T04:56:48Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5761,15 +5762,18 @@ public int totalBonusParts() {\n \n     public int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition, StringBuilder reportBuilder) {\n         AtBContract contract = (acquisition != null) ? getAttachedAtBContract(acquisition.getUnit()) : null;\n+        \n         /*\n          * If the unit is not assigned to a contract, use the least restrictive active\n          * contract. Don't restrict parts availability by contract if it has not started.\n          */\n-        for (Mission m : getMissions()) {\n-            if (m.isActive() && m instanceof AtBContract && ((AtBContract) m).getStartDate().isBefore(currentDay)) {\n-                if (null == contract\n-                        || ((AtBContract) m).getPartsAvailabilityLevel() > contract.getPartsAvailabilityLevel()) {\n-                    contract = (AtBContract) m;\n+        if (hasActiveContract() && (contract == null)) {\n+            for (Contract c : getActiveContracts()) {\n+                if (c instanceof AtBContract && \n+                        c.getStartDate().isBefore(currentDay) && \n+                        (contract == null || ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2d55d9939e019ec8c0edbd22d39d539c80ff677"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTkxMjUzOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDo1NzowNFrOG-BZtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDo1NzowNFrOG-BZtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4Nzg2MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(ev.getPerson().hasRole(Person.T_ADMIN_LOG)) {\n          \n          \n            \n                    if (ev.getPerson().hasRole(Person.T_ADMIN_LOG)) {", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467687860", "createdAt": "2020-08-10T04:57:04Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "diffHunk": "@@ -2687,8 +2687,12 @@ public void handleMissionChanged(MissionEvent ev) {\n     }\n     \n     @Subscribe\n-    public void handleMissionChanged(PersonChangedEvent ev) {\n-        refreshPartsAvailability();\n+    public void handlePersonUpdate(PersonEvent ev) {\n+        // only bother recalculating AtB parts availability if a logistics admin has been changed\n+        // refreshPartsAvailability cuts out early with a \"use AtB\" check so it's not necessary here\n+        if(ev.getPerson().hasRole(Person.T_ADMIN_LOG)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2d55d9939e019ec8c0edbd22d39d539c80ff677"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTkxNDk3OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDo1OTowNlrOG-BbCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNDoyNzoyMFrOG-Q7sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4ODIwMw==", "bodyText": "Isn't there an option to determine which type of personnel does this?", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467688203", "createdAt": "2020-08-10T04:59:06Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "diffHunk": "@@ -2687,8 +2687,12 @@ public void handleMissionChanged(MissionEvent ev) {\n     }\n     \n     @Subscribe\n-    public void handleMissionChanged(PersonChangedEvent ev) {\n-        refreshPartsAvailability();\n+    public void handlePersonUpdate(PersonEvent ev) {\n+        // only bother recalculating AtB parts availability if a logistics admin has been changed\n+        // refreshPartsAvailability cuts out early with a \"use AtB\" check so it's not necessary here\n+        if(ev.getPerson().hasRole(Person.T_ADMIN_LOG)) {\n+            refreshPartsAvailability();\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35411c63ff4ccc5a6b754fe459fa18e80a2c0f8a"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk0MjMyMg==", "bodyText": "For AtB, it always uses the logistics admin.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467942322", "createdAt": "2020-08-10T14:27:20Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/gui/CampaignGUI.java", "diffHunk": "@@ -2687,8 +2687,12 @@ public void handleMissionChanged(MissionEvent ev) {\n     }\n     \n     @Subscribe\n-    public void handleMissionChanged(PersonChangedEvent ev) {\n-        refreshPartsAvailability();\n+    public void handlePersonUpdate(PersonEvent ev) {\n+        // only bother recalculating AtB parts availability if a logistics admin has been changed\n+        // refreshPartsAvailability cuts out early with a \"use AtB\" check so it's not necessary here\n+        if(ev.getPerson().hasRole(Person.T_ADMIN_LOG)) {\n+            refreshPartsAvailability();\n+        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4ODIwMw=="}, "originalCommit": {"oid": "35411c63ff4ccc5a6b754fe459fa18e80a2c0f8a"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyMTkxNjM5OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNTowMDowNFrOG-Bbyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNTowMDowNFrOG-Bbyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4ODM5NQ==", "bodyText": "contact == null should be impossible for hasActiveContact, otherwise it is a bug in hasActiveContact.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r467688395", "createdAt": "2020-08-10T05:00:04Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5761,26 +5762,30 @@ public int totalBonusParts() {\n \n     public int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition, StringBuilder reportBuilder) {\n         AtBContract contract = (acquisition != null) ? getAttachedAtBContract(acquisition.getUnit()) : null;\n+        \n         /*\n          * If the unit is not assigned to a contract, use the least restrictive active\n          * contract. Don't restrict parts availability by contract if it has not started.\n          */\n-        for (Mission m : getMissions()) {\n-            if (m.isActive() && m instanceof AtBContract && ((AtBContract) m).getStartDate().isBefore(currentDay)) {\n-                if (null == contract\n-                        || ((AtBContract) m).getPartsAvailabilityLevel() > contract.getPartsAvailabilityLevel()) {\n-                    contract = (AtBContract) m;\n+        if (hasActiveContract() && (contract == null)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35411c63ff4ccc5a6b754fe459fa18e80a2c0f8a"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNTcxMDQxOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMToxMzozNlrOG-k82A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMToxMzozNlrOG-k82A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI3MDI5Ng==", "bodyText": "These three are all cancelled out by the getActiveContracts, which only returns those whose date is active.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r468270296", "createdAt": "2020-08-11T01:13:36Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5734,19 +5734,19 @@ public int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition, StringBui\n          * If the unit is not assigned to a contract, use the least restrictive active\n          * contract. Don't restrict parts availability by contract if it has not started.\n          */\n-        if (hasActiveContract() && (contract == null)) {\n+        if (hasActiveContract()) {\n             for (Contract c : getActiveContracts()) {\n-                if (c instanceof AtBContract && \n-                        c.getStartDate().isBefore(currentDay) && \n-                        (contract == null || \n+                if ((c instanceof AtBContract) && \n+                        (c.getStartDate().isBefore(currentDay) || c.getStartDate().equals(currentDay)) && \n+                        ((contract == null) || ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0660141d6b7cd3266767b4479a126f75326e7536"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNTcxNTc5OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMToxNjoyOFrOG-k_5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMToyNTo0MlrOG-lKeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI3MTA3OA==", "bodyText": "The getStartDate stuff is not required because of the use of getActiveContracts. Additionally, currentDay should never be directly used outside of the increase day.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r468271078", "createdAt": "2020-08-11T01:16:28Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5734,19 +5734,19 @@ public int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition, StringBui\n          * If the unit is not assigned to a contract, use the least restrictive active\n          * contract. Don't restrict parts availability by contract if it has not started.\n          */\n-        if (hasActiveContract() && (contract == null)) {\n+        if (hasActiveContract()) {\n             for (Contract c : getActiveContracts()) {\n-                if (c instanceof AtBContract && \n-                        c.getStartDate().isBefore(currentDay) && \n-                        (contract == null || \n+                if ((c instanceof AtBContract) && \n+                        (c.getStartDate().isBefore(currentDay) || c.getStartDate().equals(currentDay)) && \n+                        ((contract == null) || \n                         (((AtBContract) c).getPartsAvailabilityLevel() > contract.getPartsAvailabilityLevel()))) {\n                     contract = (AtBContract) c;\n                 }\n             }\n         }\n         \n         // if we have a contract and it has started\n-        if ((null != contract) && contract.getStartDate().isBefore(currentDay)) {\n+        if ((null != contract) && (contract.getStartDate().isBefore(currentDay) || contract.getStartDate().equals(currentDay))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0660141d6b7cd3266767b4479a126f75326e7536"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI3MTU0MQ==", "bodyText": "I'm not sure about that getStartDate thing, because the contract may not come from the \"activeContracts\" loop.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r468271541", "createdAt": "2020-08-11T01:17:55Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5734,19 +5734,19 @@ public int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition, StringBui\n          * If the unit is not assigned to a contract, use the least restrictive active\n          * contract. Don't restrict parts availability by contract if it has not started.\n          */\n-        if (hasActiveContract() && (contract == null)) {\n+        if (hasActiveContract()) {\n             for (Contract c : getActiveContracts()) {\n-                if (c instanceof AtBContract && \n-                        c.getStartDate().isBefore(currentDay) && \n-                        (contract == null || \n+                if ((c instanceof AtBContract) && \n+                        (c.getStartDate().isBefore(currentDay) || c.getStartDate().equals(currentDay)) && \n+                        ((contract == null) || \n                         (((AtBContract) c).getPartsAvailabilityLevel() > contract.getPartsAvailabilityLevel()))) {\n                     contract = (AtBContract) c;\n                 }\n             }\n         }\n         \n         // if we have a contract and it has started\n-        if ((null != contract) && contract.getStartDate().isBefore(currentDay)) {\n+        if ((null != contract) && (contract.getStartDate().isBefore(currentDay) || contract.getStartDate().equals(currentDay))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI3MTA3OA=="}, "originalCommit": {"oid": "0660141d6b7cd3266767b4479a126f75326e7536"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI3MjQxMw==", "bodyText": "Missed that part, you are correct. Still the latter currentDay bit holds, plus you can just do a !getLocalDate().isBefore(contract.getStartDate()) to test if it is either before or equal to the current day", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r468272413", "createdAt": "2020-08-11T01:20:47Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5734,19 +5734,19 @@ public int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition, StringBui\n          * If the unit is not assigned to a contract, use the least restrictive active\n          * contract. Don't restrict parts availability by contract if it has not started.\n          */\n-        if (hasActiveContract() && (contract == null)) {\n+        if (hasActiveContract()) {\n             for (Contract c : getActiveContracts()) {\n-                if (c instanceof AtBContract && \n-                        c.getStartDate().isBefore(currentDay) && \n-                        (contract == null || \n+                if ((c instanceof AtBContract) && \n+                        (c.getStartDate().isBefore(currentDay) || c.getStartDate().equals(currentDay)) && \n+                        ((contract == null) || \n                         (((AtBContract) c).getPartsAvailabilityLevel() > contract.getPartsAvailabilityLevel()))) {\n                     contract = (AtBContract) c;\n                 }\n             }\n         }\n         \n         // if we have a contract and it has started\n-        if ((null != contract) && contract.getStartDate().isBefore(currentDay)) {\n+        if ((null != contract) && (contract.getStartDate().isBefore(currentDay) || contract.getStartDate().equals(currentDay))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI3MTA3OA=="}, "originalCommit": {"oid": "0660141d6b7cd3266767b4479a126f75326e7536"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI3Mzc4NA==", "bodyText": "Yeah, that's a lot cleaner.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r468273784", "createdAt": "2020-08-11T01:25:42Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5734,19 +5734,19 @@ public int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition, StringBui\n          * If the unit is not assigned to a contract, use the least restrictive active\n          * contract. Don't restrict parts availability by contract if it has not started.\n          */\n-        if (hasActiveContract() && (contract == null)) {\n+        if (hasActiveContract()) {\n             for (Contract c : getActiveContracts()) {\n-                if (c instanceof AtBContract && \n-                        c.getStartDate().isBefore(currentDay) && \n-                        (contract == null || \n+                if ((c instanceof AtBContract) && \n+                        (c.getStartDate().isBefore(currentDay) || c.getStartDate().equals(currentDay)) && \n+                        ((contract == null) || \n                         (((AtBContract) c).getPartsAvailabilityLevel() > contract.getPartsAvailabilityLevel()))) {\n                     contract = (AtBContract) c;\n                 }\n             }\n         }\n         \n         // if we have a contract and it has started\n-        if ((null != contract) && contract.getStartDate().isBefore(currentDay)) {\n+        if ((null != contract) && (contract.getStartDate().isBefore(currentDay) || contract.getStartDate().equals(currentDay))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI3MTA3OA=="}, "originalCommit": {"oid": "0660141d6b7cd3266767b4479a126f75326e7536"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNTc0NTQ4OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMTozMDo1N1rOG-lQbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMTozMDo1N1rOG-lQbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI3NTMwOQ==", "bodyText": "This is still superfluous.", "url": "https://github.com/MegaMek/mekhq/pull/1912#discussion_r468275309", "createdAt": "2020-08-11T01:30:57Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -5713,28 +5727,48 @@ public int totalBonusParts() {\n         return retVal;\n     }\n \n-    private int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition) {\n-        AtBContract contract = getAttachedAtBContract(acquisition.getUnit());\n+    public int findAtBPartsAvailabilityLevel(IAcquisitionWork acquisition, StringBuilder reportBuilder) {\n+        AtBContract contract = (acquisition != null) ? getAttachedAtBContract(acquisition.getUnit()) : null;\n+        \n         /*\n          * If the unit is not assigned to a contract, use the least restrictive active\n-         * contract\n+         * contract. Don't restrict parts availability by contract if it has not started.\n          */\n-        for (Mission m : getMissions()) {\n-            if (m.isActive() && m instanceof AtBContract) {\n-                if (null == contract\n-                        || ((AtBContract) m).getPartsAvailabilityLevel() > contract.getPartsAvailabilityLevel()) {\n-                    contract = (AtBContract) m;\n+        if (hasActiveContract()) {\n+            for (Contract c : getActiveContracts()) {\n+                if ((c instanceof AtBContract) && \n+                        getLocalDate().isBefore(c.getStartDate()) && ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27a8099ef1f3d747d09a1ae503fac20d61b89b36"}, "originalPosition": 93}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2206, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}