{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0MDMzNDQ3", "number": 2308, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNjozMDowMVrOFIoSvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNzowNDo0MVrOFIo5Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NTkzMDg2OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/equipment/EquipmentPart.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNjozMDowMVrOIKpyKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNzowOTo1NVrOIKq0Xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA0MTI1Ng==", "bodyText": "Not even going to ask why we're passing around string location names.", "url": "https://github.com/MegaMek/mekhq/pull/2308#discussion_r548041256", "createdAt": "2020-12-23T16:30:01Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/parts/equipment/EquipmentPart.java", "diffHunk": "@@ -633,46 +633,24 @@ public boolean isOmniPoddable() {\n \n     @Override\n     public String getLocationName() {\n-        if (null != unit) {\n-            Mounted mounted = unit.getEntity().getEquipment(equipmentNum);\n-            if (null != mounted && mounted.getLocation() != -1) {\n-                return unit.getEntity().getLocationName(mounted.getLocation());\n-            }\n+        final Mounted mounted = getMounted();\n+        if ((mounted != null) && (mounted.getLocation() != Entity.LOC_NONE)) {\n+            return getUnit().getEntity().getLocationName(mounted.getLocation());\n         }\n+\n         return null;\n     }\n \n     @Override\n     public boolean isInLocation(String loc) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a22d75bcad9e385ffde189c6c46769a06048f245"}, "originalPosition": 429}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA1ODIwNg==", "bodyText": "I tried my absolute damnedest to touch the least external code possible.\nMy last attempts at comprehensive tests seemed to have missed corner cases here and there. This time I have a much higher confidence level because I left the smelly code smelly.", "url": "https://github.com/MegaMek/mekhq/pull/2308#discussion_r548058206", "createdAt": "2020-12-23T17:09:55Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/campaign/parts/equipment/EquipmentPart.java", "diffHunk": "@@ -633,46 +633,24 @@ public boolean isOmniPoddable() {\n \n     @Override\n     public String getLocationName() {\n-        if (null != unit) {\n-            Mounted mounted = unit.getEntity().getEquipment(equipmentNum);\n-            if (null != mounted && mounted.getLocation() != -1) {\n-                return unit.getEntity().getLocationName(mounted.getLocation());\n-            }\n+        final Mounted mounted = getMounted();\n+        if ((mounted != null) && (mounted.getLocation() != Entity.LOC_NONE)) {\n+            return getUnit().getEntity().getLocationName(mounted.getLocation());\n         }\n+\n         return null;\n     }\n \n     @Override\n     public boolean isInLocation(String loc) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA0MTI1Ng=="}, "originalCommit": {"oid": "a22d75bcad9e385ffde189c6c46769a06048f245"}, "originalPosition": 429}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NjAyOTE0OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/equipment/MissingEquipmentPart.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNzowNDo0MVrOIKqsEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxNzowODoxMlrOIKqxkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA1NjA4MQ==", "bodyText": "Do we want to un-set the unit afterwards?", "url": "https://github.com/MegaMek/mekhq/pull/2308#discussion_r548056081", "createdAt": "2020-12-23T17:04:41Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/parts/equipment/MissingEquipmentPart.java", "diffHunk": "@@ -178,149 +188,118 @@ public boolean isAcceptableReplacement(Part part, boolean refit) {\n         //they are not acceptable substitutes, so we need to check for that as\n         //well\n         //http://bg.battletech.com/forums/strategic-operations/(answered)-can-a-lance-for-a-35-ton-mech-be-used-on-a-40-ton-mech-and-so-on/\n-        Part newPart = getNewPart();\n-        newPart.setUnit(unit);\n-        if(part instanceof EquipmentPart) {\n-            EquipmentPart eqpart = (EquipmentPart)part;\n-            EquipmentType et = eqpart.getType();\n-            return (type.equals(et) && getTonnage() == part.getTonnage())\n-                    && (size == eqpart.getSize())\n-                    && part.getStickerPrice().equals(newPart.getStickerPrice());\n+        EquipmentPart newPart = getNewPart();\n+        newPart.setEquipmentNum(getEquipmentNum());\n+        newPart.setUnit(unit); // CAW: find a way to do this without setting a unit", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a22d75bcad9e385ffde189c6c46769a06048f245"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA1NzQ4OA==", "bodyText": "It gets garbage collected after this call. Now that I have a good test I'll probably move the variable cost calculator to a shared class and use that here instead of this tomfoolery.", "url": "https://github.com/MegaMek/mekhq/pull/2308#discussion_r548057488", "createdAt": "2020-12-23T17:08:12Z", "author": {"login": "sixlettervariables"}, "path": "MekHQ/src/mekhq/campaign/parts/equipment/MissingEquipmentPart.java", "diffHunk": "@@ -178,149 +188,118 @@ public boolean isAcceptableReplacement(Part part, boolean refit) {\n         //they are not acceptable substitutes, so we need to check for that as\n         //well\n         //http://bg.battletech.com/forums/strategic-operations/(answered)-can-a-lance-for-a-35-ton-mech-be-used-on-a-40-ton-mech-and-so-on/\n-        Part newPart = getNewPart();\n-        newPart.setUnit(unit);\n-        if(part instanceof EquipmentPart) {\n-            EquipmentPart eqpart = (EquipmentPart)part;\n-            EquipmentType et = eqpart.getType();\n-            return (type.equals(et) && getTonnage() == part.getTonnage())\n-                    && (size == eqpart.getSize())\n-                    && part.getStickerPrice().equals(newPart.getStickerPrice());\n+        EquipmentPart newPart = getNewPart();\n+        newPart.setEquipmentNum(getEquipmentNum());\n+        newPart.setUnit(unit); // CAW: find a way to do this without setting a unit", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA1NjA4MQ=="}, "originalCommit": {"oid": "a22d75bcad9e385ffde189c6c46769a06048f245"}, "originalPosition": 88}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1989, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}