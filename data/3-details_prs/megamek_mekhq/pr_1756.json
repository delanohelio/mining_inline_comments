{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5ODczNjk1", "number": 1756, "title": "fix sandblaster issues", "bodyText": "A recent MegaMek PR changed the Sandblaster SPA so that it points to a particular weapon, but caused a bunch of issues in MekHQ with personnel generation, in multiple areas. This PR fixes those errors, and also limits randomly generated personnel with Sandblaster to just weapons that can potentially use cluster tables.", "createdAt": "2020-05-19T04:43:52Z", "url": "https://github.com/MegaMek/mekhq/pull/1756", "merged": true, "mergeCommit": {"oid": "00670f7ee41496c077239e1b9cf0dda32964ade7"}, "closed": true, "closedAt": "2020-05-20T21:15:00Z", "author": {"login": "NickAragua"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcis7e1AH2gAyNDE5ODczNjk1OjBmZGVlNjc5MzA1ZmFmNTRkN2FlNzU3NDMyYTA3N2QwMjJkOWNmZjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjPu7eAH2gAyNDE5ODczNjk1OmQyNjE0MWZjNDAwODVkMmQxNGU5NmY0Y2JlNGEyYTk3M2FjODgxNDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0fdee679305faf54d7ae757432a077d022d9cff1", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/0fdee679305faf54d7ae757432a077d022d9cff1", "committedDate": "2020-05-19T04:40:18Z", "message": "fix sandblaster issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NDg5NzEz", "url": "https://github.com/MegaMek/mekhq/pull/1756#pullrequestreview-414489713", "createdAt": "2020-05-19T14:15:42Z", "commit": {"oid": "0fdee679305faf54d7ae757432a077d022d9cff1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNDoxNTo0MlrOGXig5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNDoxNTo0MlrOGXig5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMzNTkwOA==", "bodyText": "After building a list of all eligible weapons, you're still picking randomly from all weapons.", "url": "https://github.com/MegaMek/mekhq/pull/1756#discussion_r427335908", "createdAt": "2020-05-19T14:15:42Z", "author": {"login": "neoancient"}, "path": "MekHQ/src/mekhq/campaign/mission/CrewSkillUpgrader.java", "diffHunk": "@@ -216,7 +221,16 @@ private boolean extraEligibilityCheck(SpecialAbility spa, Entity entity) {\n      * @param entity The entity being manipulated\n      * @return Weapon name\n      */\n-    private String pickRandomWeapon(Entity entity) {\n+    private String pickRandomWeapon(Entity entity, boolean clusterOnly) {\n+        List<Mounted> weapons = entity.getIndividualWeaponList();\n+        List<Mounted> eligibleWeapons = new ArrayList<>();\n+        \n+        for(Mounted weapon : weapons) {\n+            if(SpecialAbility.isWeaponEligibleForSPA(weapon.getType(), Person.T_NONE, clusterOnly)) {\n+                eligibleWeapons.add(weapon);\n+            }\n+        }\n+        \n         int weaponIndex = Compute.randomInt(entity.getIndividualWeaponList().size());\n         return entity.getIndividualWeaponList().get(weaponIndex).getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fdee679305faf54d7ae757432a077d022d9cff1"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91581dd492d8322912c3f470cf317432d3502a95", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/91581dd492d8322912c3f470cf317432d3502a95", "committedDate": "2020-05-19T14:29:28Z", "message": "Update CrewSkillUpgrader.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NzYxOTU2", "url": "https://github.com/MegaMek/mekhq/pull/1756#pullrequestreview-414761956", "createdAt": "2020-05-19T19:34:56Z", "commit": {"oid": "91581dd492d8322912c3f470cf317432d3502a95"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxOTozNDo1NlrOGXvpAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxOTozNDo1NlrOGXvpAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzU1MDk3OQ==", "bodyText": "What happens if the entity doesn't have any eligible weapons?", "url": "https://github.com/MegaMek/mekhq/pull/1756#discussion_r427550979", "createdAt": "2020-05-19T19:34:56Z", "author": {"login": "neoancient"}, "path": "MekHQ/src/mekhq/campaign/mission/CrewSkillUpgrader.java", "diffHunk": "@@ -216,9 +221,18 @@ private boolean extraEligibilityCheck(SpecialAbility spa, Entity entity) {\n      * @param entity The entity being manipulated\n      * @return Weapon name\n      */\n-    private String pickRandomWeapon(Entity entity) {\n-        int weaponIndex = Compute.randomInt(entity.getIndividualWeaponList().size());\n-        return entity.getIndividualWeaponList().get(weaponIndex).getName();\n+    private String pickRandomWeapon(Entity entity, boolean clusterOnly) {\n+        List<Mounted> weapons = entity.getIndividualWeaponList();\n+        List<Mounted> eligibleWeapons = new ArrayList<>();\n+        \n+        for(Mounted weapon : weapons) {\n+            if(SpecialAbility.isWeaponEligibleForSPA(weapon.getType(), Person.T_NONE, clusterOnly)) {\n+                eligibleWeapons.add(weapon);\n+            }\n+        }\n+        \n+        int weaponIndex = Compute.randomInt(eligibleWeapons.size());\n+        return eligibleWeapons.get(weaponIndex).getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91581dd492d8322912c3f470cf317432d3502a95"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e0957d6d39116235e97568210b1ffe64d40c2fa", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/5e0957d6d39116235e97568210b1ffe64d40c2fa", "committedDate": "2020-05-20T00:11:49Z", "message": "bullet-proofing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NzA0MDgy", "url": "https://github.com/MegaMek/mekhq/pull/1756#pullrequestreview-415704082", "createdAt": "2020-05-20T20:50:42Z", "commit": {"oid": "5e0957d6d39116235e97568210b1ffe64d40c2fa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d26141fc40085d2d14e96f4cbe4a2a973ac88148", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/d26141fc40085d2d14e96f4cbe4a2a973ac88148", "committedDate": "2020-05-20T21:13:16Z", "message": "more code review changes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4258, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}