{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MTA2NjMz", "number": 2123, "title": "Split Unit duties into a Hangar class", "bodyText": "This PR is part of a project of mine to reduce the cognitive burden of Campaign.java and move it into smaller, easier to understand classes. The first step I took was to move the \"accounting\" functions of Units into a logical Hangar class. This could mean a foray into tracking multiple units on multiple places...but let's not go there just yet.\nThis also significantly reduces the memory burden of certain areas and on larger campaigns certain actions will be faster, as there won't be giant copies of the unit list made.\nNote: this is a draft while I do some more testing, but functionally this was a lift-n-shift.", "createdAt": "2020-10-05T20:43:49Z", "url": "https://github.com/MegaMek/mekhq/pull/2123", "merged": true, "mergeCommit": {"oid": "3f55aabad31fb84ff1e5af9c8caac7bd8c8999a0"}, "closed": true, "closedAt": "2020-10-07T18:32:39Z", "author": {"login": "sixlettervariables"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP9VXrgH2gAyNDk4MTA2NjMzOmUxNDUwMThkMzcyMjA3OTViMmM0MTY1MmFjY2EwZWJmNzI0YTE3NzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQRIF_gH2gAyNDk4MTA2NjMzOjYwMTdlYTM2OTBlY2Q1YTRhM2ZhODgxYmMyMDgzNTliZmU3ZDJkNjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e145018d37220795b2c41652acca0ebf724a1770", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/e145018d37220795b2c41652acca0ebf724a1770", "committedDate": "2020-10-06T19:13:39Z", "message": "Add a Hangar class to handle unit related actions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c830304a7dc1c67a19f9a76be2f76e290c33953a", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/c830304a7dc1c67a19f9a76be2f76e290c33953a", "committedDate": "2020-10-06T19:13:39Z", "message": "Move the Campaign to use the new Hangar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fbf6ddf6ab8334212a53acc4413373866a0b70b", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/0fbf6ddf6ab8334212a53acc4413373866a0b70b", "committedDate": "2020-10-06T19:13:39Z", "message": "Rename Campaign::addUnit to addNewUnit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "211a0bb678070803c080859b84d42ddfc9c385c2", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/211a0bb678070803c080859b84d42ddfc9c385c2", "committedDate": "2020-10-06T19:13:40Z", "message": "Split out sorted views of the hangar into HangarSorter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a8709b596b25c291adb76fdb772eaa1f503729f", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/8a8709b596b25c291adb76fdb772eaa1f503729f", "committedDate": "2020-10-06T19:13:40Z", "message": "Move specialized requirements on getUnits to callers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb461f07fa33a6b4ea2ca65fa5de5b7ebafce619", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/eb461f07fa33a6b4ea2ca65fa5de5b7ebafce619", "committedDate": "2020-10-06T19:14:26Z", "message": "Transition away from Campaign::getUnits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "committedDate": "2020-10-06T19:14:28Z", "message": "Remove unnecessary import"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "874649b63b2ce8e96ba445734285ee481db1dc2b", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/874649b63b2ce8e96ba445734285ee481db1dc2b", "committedDate": "2020-10-05T20:40:18Z", "message": "Remove unnecessary import"}, "afterCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "committedDate": "2020-10-06T19:14:28Z", "message": "Remove unnecessary import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMjk1ODUz", "url": "https://github.com/MegaMek/mekhq/pull/2123#pullrequestreview-503295853", "createdAt": "2020-10-06T19:35:50Z", "commit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "state": "APPROVED", "comments": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxOTozNTo1MFrOHdXB9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQyMDowODowNlrOHdYExA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU0ODA4NA==", "bodyText": "Tab spacing", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500548084", "createdAt": "2020-10-06T19:35:50Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/PersonnelMarketDialog.java", "diffHunk": "@@ -365,14 +365,7 @@ private void addUnit(Entity en, boolean pay) {\n \t\t\t\tcampaign.getLocalDate())) {\n \t\t\treturn;\n \t\t}\n-\t\tcampaign.addUnit(en, false, 0);\n-\t\tUnit unit = null;\n-\t\tfor (Unit u : campaign.getUnits()) {\n-\t\t\tif (u.getEntity() == en) {\n-\t\t\t\tunit = u;\n-\t\t\t\tbreak;\n-\t\t\t}\n-        }\n+\t\tUnit unit = campaign.addNewUnit(en, false, 0);\n         if (unit == null) {\n             // No such unit matching the entity.\n             return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1MDAwNg==", "bodyText": "We should never have a null unit, so we probably want to fix the backend reason for this check if it still exists", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500550006", "createdAt": "2020-10-06T19:39:36Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/rating/CampaignOpsReputation.java", "diffHunk": "@@ -248,8 +247,7 @@ private int getTotalForceUnits() {\n         // Count total units for transport\n         getTotalCombatUnits();\n \n-        List<Unit> unitList = getCampaign().getCopyOfUnits();\n-        for (Unit u : unitList) {\n+        for (Unit u : getCampaign().getHangar().getUnits()) {\n             if (u == null) {\n                 continue;\n             }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1MjY0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if(j == units.size()) {\n          \n          \n            \n                        if (j == units.size()) {", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500552647", "createdAt": "2020-10-06T19:44:38Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/PayCollateralDialog.java", "diffHunk": "@@ -137,7 +137,7 @@ private void initComponents() {\n             gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;\n             gridBagConstraints.fill = GridBagConstraints.HORIZONTAL;\n             gridBagConstraints.weightx = 1.0;\n-            if(j == (units.size())) {\n+            if(j == units.size()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1NDYwMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    UUID id = unit.getId();\n          \n          \n            \n                    if (id == null) {\n          \n          \n            \n                        id = UUID.randomUUID();\n          \n          \n            \n                        unit.setId(id);\n          \n          \n            \n                    }\n          \n          \n            \n            \n          \n          \n            \n                    units.put(id, unit);\n          \n          \n            \n                    if (unit.getId() == null) {\n          \n          \n            \n                        unit.setId(UUID.randomUUID());\n          \n          \n            \n                    }\n          \n          \n            \n            \n          \n          \n            \n                    units.put(unit.getId(), unit);", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500554603", "createdAt": "2020-10-06T19:48:27Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Hangar.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/*\n+ * Hangar.java\n+ *\n+ * Copyright (c) 2020 - The MegaMek Team. All Rights Reserved.\n+ *\n+ * This file is part of MekHQ.\n+ *\n+ * MekHQ is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * MekHQ is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with MekHQ. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package mekhq.campaign;\n+\n+import java.io.PrintWriter;\n+import java.util.Collection;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.UUID;\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+import java.util.function.Predicate;\n+import java.util.stream.Stream;\n+\n+import mekhq.MekHqXmlUtil;\n+import mekhq.campaign.finances.Money;\n+import mekhq.campaign.unit.Unit;\n+\n+/**\n+ * Represents a hangar which contains zero or more units.\n+ */\n+public class Hangar {\n+    private Map<UUID, Unit> units = new LinkedHashMap<>();\n+\n+    /**\n+     * Adds a unit to the hangar.\n+     *\n+     * If the unit does not have an ID, one is\n+     * assigned to it.\n+     *\n+     * @param unit The unit to add to the hangar.\n+     */\n+    public void addUnit(Unit unit) {\n+        if (unit == null) {\n+            return;\n+        }\n+\n+        UUID id = unit.getId();\n+        if (id == null) {\n+            id = UUID.randomUUID();\n+            unit.setId(id);\n+        }\n+\n+        units.put(id, unit);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1NTU3OQ==", "bodyText": "Just an idea, because this is a default getter it should be fine", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500555579", "createdAt": "2020-10-06T19:50:24Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Hangar.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/*\n+ * Hangar.java\n+ *\n+ * Copyright (c) 2020 - The MegaMek Team. All Rights Reserved.\n+ *\n+ * This file is part of MekHQ.\n+ *\n+ * MekHQ is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * MekHQ is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with MekHQ. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package mekhq.campaign;\n+\n+import java.io.PrintWriter;\n+import java.util.Collection;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.UUID;\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+import java.util.function.Predicate;\n+import java.util.stream.Stream;\n+\n+import mekhq.MekHqXmlUtil;\n+import mekhq.campaign.finances.Money;\n+import mekhq.campaign.unit.Unit;\n+\n+/**\n+ * Represents a hangar which contains zero or more units.\n+ */\n+public class Hangar {\n+    private Map<UUID, Unit> units = new LinkedHashMap<>();\n+\n+    /**\n+     * Adds a unit to the hangar.\n+     *\n+     * If the unit does not have an ID, one is\n+     * assigned to it.\n+     *\n+     * @param unit The unit to add to the hangar.\n+     */\n+    public void addUnit(Unit unit) {\n+        if (unit == null) {\n+            return;\n+        }\n+\n+        UUID id = unit.getId();\n+        if (id == null) {\n+            id = UUID.randomUUID();\n+            unit.setId(id);\n+        }\n+\n+        units.put(id, unit);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1NDYwMw=="}, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1NzU4Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    pw1.println(MekHqXmlUtil.indentStr(indent) + \"<\" + tag + \">\");\n          \n          \n            \n                    MekHqXmlUtil.writeSimpleXMLOpenIndentedLine(pw1, indent, tag);", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500557583", "createdAt": "2020-10-06T19:54:06Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Hangar.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/*\n+ * Hangar.java\n+ *\n+ * Copyright (c) 2020 - The MegaMek Team. All Rights Reserved.\n+ *\n+ * This file is part of MekHQ.\n+ *\n+ * MekHQ is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * MekHQ is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with MekHQ. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package mekhq.campaign;\n+\n+import java.io.PrintWriter;\n+import java.util.Collection;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.UUID;\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+import java.util.function.Predicate;\n+import java.util.stream.Stream;\n+\n+import mekhq.MekHqXmlUtil;\n+import mekhq.campaign.finances.Money;\n+import mekhq.campaign.unit.Unit;\n+\n+/**\n+ * Represents a hangar which contains zero or more units.\n+ */\n+public class Hangar {\n+    private Map<UUID, Unit> units = new LinkedHashMap<>();\n+\n+    /**\n+     * Adds a unit to the hangar.\n+     *\n+     * If the unit does not have an ID, one is\n+     * assigned to it.\n+     *\n+     * @param unit The unit to add to the hangar.\n+     */\n+    public void addUnit(Unit unit) {\n+        if (unit == null) {\n+            return;\n+        }\n+\n+        UUID id = unit.getId();\n+        if (id == null) {\n+            id = UUID.randomUUID();\n+            unit.setId(id);\n+        }\n+\n+        units.put(id, unit);\n+    }\n+\n+    /**\n+     * Gets a unit by a given ID.\n+     * @param id The unique identifier of a unit.\n+     * @return The unit matching the unique identifier,\n+     *         otherwise null if that unit does not exist.\n+     */\n+    public Unit getUnit(UUID id) {\n+        return units.get(id);\n+    }\n+\n+    /**\n+     * Gets a collection of units in the hangar.\n+     * @return A collection of units in the hangar.\n+     */\n+    public Collection<Unit> getUnits() {\n+        return units.values();\n+    }\n+\n+    /**\n+     * Gets a Stream of units in the hangar.\n+     * @return A Stream of units in the hangar.\n+     */\n+    public Stream<Unit> getUnitsStream() {\n+        return units.values().stream();\n+    }\n+\n+    /**\n+     * Calculates the total costs for the units in the hangar.\n+     * @param getCosts A function which returns a cost for a unit.\n+     * @return The total costs for the units.\n+     */\n+    public Money getUnitCosts(Function<Unit, Money> getCosts) {\n+        return getUnitsStream().map(getCosts).reduce(Money.zero(), Money::plus);\n+    }\n+\n+    /**\n+     * Calculates the total costs for the units matching a predicate\n+     * in the hangar.\n+     * @param predicate A function to use to select a unit.\n+     * @param getCosts A function which returns a cost for a selected unit.\n+     * @return The total costs for the units selected by the predicate.\n+     */\n+    public Money getUnitCosts(Predicate<Unit> predicate, Function<Unit, Money> getCosts) {\n+        return getUnitsStream().filter(predicate).map(getCosts).reduce(Money.zero(), Money::plus);\n+    }\n+\n+    /**\n+     * Executes a function for each unit in the hangar.\n+     * @param consumer A function to apply to each unit.\n+     */\n+    public void forEachUnit(Consumer<Unit> consumer) {\n+        units.forEach((id, unit) -> consumer.accept(unit));\n+    }\n+\n+    /**\n+     * Executes a function for each unit in the hangar.\n+     * @param consumer A function to apply to each ID-unit pair.\n+     */\n+    public void forEachUnit(BiConsumer<UUID, Unit> consumer) {\n+        units.forEach(consumer);\n+    }\n+\n+    /**\n+     * Searches for a specific unit using the given predicate.\n+     * @param predicate A function to use to select a given unit.\n+     * @return The first unit found which matches the predicate,\n+     *         otherwise null if no unit was found.\n+     */\n+    public Unit findUnit(Predicate<Unit> predicate) {\n+        if (predicate == null) {\n+            return null;\n+        }\n+\n+        for (Unit unit : units.values()) {\n+            if (predicate.test(unit)) {\n+                return unit;\n+            }\n+        }\n+        return null;\n+    }\n+\n+    /**\n+     * Removes a unit from the hangar.\n+     * @param id The unit ID.\n+     * @return true if the unit was removed, otherwise false.\n+     */\n+    public boolean removeUnit(UUID id) {\n+        return null != units.remove(id);\n+    }\n+\n+\tpublic void writeToXml(PrintWriter pw1, int indent, String tag) {\n+        pw1.println(MekHqXmlUtil.indentStr(indent) + \"<\" + tag + \">\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 158}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1ODAyNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    pw1.println(MekHqXmlUtil.indentStr(indent) + \"</\" + tag + \">\");\n          \n          \n            \n                    MekHqXmlUtil.writeSimpleXMLCloseIndentedLine(pw1, indent, tag);", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500558025", "createdAt": "2020-10-06T19:54:57Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Hangar.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/*\n+ * Hangar.java\n+ *\n+ * Copyright (c) 2020 - The MegaMek Team. All Rights Reserved.\n+ *\n+ * This file is part of MekHQ.\n+ *\n+ * MekHQ is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * MekHQ is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with MekHQ. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package mekhq.campaign;\n+\n+import java.io.PrintWriter;\n+import java.util.Collection;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.UUID;\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+import java.util.function.Predicate;\n+import java.util.stream.Stream;\n+\n+import mekhq.MekHqXmlUtil;\n+import mekhq.campaign.finances.Money;\n+import mekhq.campaign.unit.Unit;\n+\n+/**\n+ * Represents a hangar which contains zero or more units.\n+ */\n+public class Hangar {\n+    private Map<UUID, Unit> units = new LinkedHashMap<>();\n+\n+    /**\n+     * Adds a unit to the hangar.\n+     *\n+     * If the unit does not have an ID, one is\n+     * assigned to it.\n+     *\n+     * @param unit The unit to add to the hangar.\n+     */\n+    public void addUnit(Unit unit) {\n+        if (unit == null) {\n+            return;\n+        }\n+\n+        UUID id = unit.getId();\n+        if (id == null) {\n+            id = UUID.randomUUID();\n+            unit.setId(id);\n+        }\n+\n+        units.put(id, unit);\n+    }\n+\n+    /**\n+     * Gets a unit by a given ID.\n+     * @param id The unique identifier of a unit.\n+     * @return The unit matching the unique identifier,\n+     *         otherwise null if that unit does not exist.\n+     */\n+    public Unit getUnit(UUID id) {\n+        return units.get(id);\n+    }\n+\n+    /**\n+     * Gets a collection of units in the hangar.\n+     * @return A collection of units in the hangar.\n+     */\n+    public Collection<Unit> getUnits() {\n+        return units.values();\n+    }\n+\n+    /**\n+     * Gets a Stream of units in the hangar.\n+     * @return A Stream of units in the hangar.\n+     */\n+    public Stream<Unit> getUnitsStream() {\n+        return units.values().stream();\n+    }\n+\n+    /**\n+     * Calculates the total costs for the units in the hangar.\n+     * @param getCosts A function which returns a cost for a unit.\n+     * @return The total costs for the units.\n+     */\n+    public Money getUnitCosts(Function<Unit, Money> getCosts) {\n+        return getUnitsStream().map(getCosts).reduce(Money.zero(), Money::plus);\n+    }\n+\n+    /**\n+     * Calculates the total costs for the units matching a predicate\n+     * in the hangar.\n+     * @param predicate A function to use to select a unit.\n+     * @param getCosts A function which returns a cost for a selected unit.\n+     * @return The total costs for the units selected by the predicate.\n+     */\n+    public Money getUnitCosts(Predicate<Unit> predicate, Function<Unit, Money> getCosts) {\n+        return getUnitsStream().filter(predicate).map(getCosts).reduce(Money.zero(), Money::plus);\n+    }\n+\n+    /**\n+     * Executes a function for each unit in the hangar.\n+     * @param consumer A function to apply to each unit.\n+     */\n+    public void forEachUnit(Consumer<Unit> consumer) {\n+        units.forEach((id, unit) -> consumer.accept(unit));\n+    }\n+\n+    /**\n+     * Executes a function for each unit in the hangar.\n+     * @param consumer A function to apply to each ID-unit pair.\n+     */\n+    public void forEachUnit(BiConsumer<UUID, Unit> consumer) {\n+        units.forEach(consumer);\n+    }\n+\n+    /**\n+     * Searches for a specific unit using the given predicate.\n+     * @param predicate A function to use to select a given unit.\n+     * @return The first unit found which matches the predicate,\n+     *         otherwise null if no unit was found.\n+     */\n+    public Unit findUnit(Predicate<Unit> predicate) {\n+        if (predicate == null) {\n+            return null;\n+        }\n+\n+        for (Unit unit : units.values()) {\n+            if (predicate.test(unit)) {\n+                return unit;\n+            }\n+        }\n+        return null;\n+    }\n+\n+    /**\n+     * Removes a unit from the hangar.\n+     * @param id The unit ID.\n+     * @return true if the unit was removed, otherwise false.\n+     */\n+    public boolean removeUnit(UUID id) {\n+        return null != units.remove(id);\n+    }\n+\n+\tpublic void writeToXml(PrintWriter pw1, int indent, String tag) {\n+        pw1.println(MekHqXmlUtil.indentStr(indent) + \"<\" + tag + \">\");\n+\n+        forEachUnit(unit -> {\n+            unit.writeToXml(pw1, indent + 1);\n+        });\n+\n+        pw1.println(MekHqXmlUtil.indentStr(indent) + \"</\" + tag + \">\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 164}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2MDg3Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            .filter(u -> u.requiresMaintenance() && null != u.getTech())\n          \n          \n            \n                            .filter(u -> u.requiresMaintenance() && (null != u.getTech()))", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500560876", "createdAt": "2020-10-06T20:00:17Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -3676,24 +3617,19 @@ private Money getTheoreticalPayroll(boolean noInfantry) {\n     }\n \n     public Money getMaintenanceCosts() {\n-        Money costs = Money.zero();\n         if (campaignOptions.payForMaintain()) {\n-            for (Map.Entry<UUID, Unit> mu : units.entrySet()) {\n-                Unit u = mu.getValue();\n-                if (u.requiresMaintenance() && null != u.getTech()) {\n-                    costs = costs.plus(u.getMaintenanceCost());\n-                }\n-            }\n+            return getHangar().getUnitsStream()\n+                .filter(u -> u.requiresMaintenance() && null != u.getTech())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 302}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2MzMxMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500563312", "createdAt": "2020-10-06T20:04:38Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 545}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2MzQzNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500563435", "createdAt": "2020-10-06T20:04:50Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getMechCapacity)\n+            .sum());\n     }\n \n     public int getTotalASFBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getASFCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 556}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2MzUyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500563522", "createdAt": "2020-10-06T20:04:57Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getMechCapacity)\n+            .sum());\n     }\n \n     public int getTotalASFBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getASFCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getASFCapacity)\n+            .sum());\n     }\n \n     public int getTotalSmallCraftBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getSmallCraftCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getSmallCraftCapacity)\n+            .sum());\n     }\n \n     public int getTotalBattleArmorBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getBattleArmorCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 578}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2MzU5Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500563597", "createdAt": "2020-10-06T20:05:02Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getMechCapacity)\n+            .sum());\n     }\n \n     public int getTotalASFBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getASFCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getASFCapacity)\n+            .sum());\n     }\n \n     public int getTotalSmallCraftBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getSmallCraftCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 567}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NDA0Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500564043", "createdAt": "2020-10-06T20:05:48Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getMechCapacity)\n+            .sum());\n     }\n \n     public int getTotalASFBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getASFCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getASFCapacity)\n+            .sum());\n     }\n \n     public int getTotalSmallCraftBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getSmallCraftCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getSmallCraftCapacity)\n+            .sum());\n     }\n \n     public int getTotalBattleArmorBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getBattleArmorCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getBattleArmorCapacity)\n+            .sum());\n     }\n \n     public int getTotalInfantryBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getInfantryCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getInfantryCapacity)\n+            .sum());\n     }\n \n     public int getTotalHeavyVehicleBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getHeavyVehicleCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getHeavyVehicleCapacity)\n+            .sum());\n     }\n \n     public int getTotalLightVehicleBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getLightVehicleCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 611}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NDA4NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500564084", "createdAt": "2020-10-06T20:05:54Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getMechCapacity)\n+            .sum());\n     }\n \n     public int getTotalASFBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getASFCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getASFCapacity)\n+            .sum());\n     }\n \n     public int getTotalSmallCraftBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getSmallCraftCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getSmallCraftCapacity)\n+            .sum());\n     }\n \n     public int getTotalBattleArmorBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getBattleArmorCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getBattleArmorCapacity)\n+            .sum());\n     }\n \n     public int getTotalInfantryBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getInfantryCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getInfantryCapacity)\n+            .sum());\n     }\n \n     public int getTotalHeavyVehicleBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getHeavyVehicleCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 600}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NDEzNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500564134", "createdAt": "2020-10-06T20:06:00Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getMechCapacity)\n+            .sum());\n     }\n \n     public int getTotalASFBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getASFCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getASFCapacity)\n+            .sum());\n     }\n \n     public int getTotalSmallCraftBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getSmallCraftCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getSmallCraftCapacity)\n+            .sum());\n     }\n \n     public int getTotalBattleArmorBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getBattleArmorCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getBattleArmorCapacity)\n+            .sum());\n     }\n \n     public int getTotalInfantryBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getInfantryCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 589}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NDMwOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500564309", "createdAt": "2020-10-06T20:06:23Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getMechCapacity)\n+            .sum());\n     }\n \n     public int getTotalASFBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getASFCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getASFCapacity)\n+            .sum());\n     }\n \n     public int getTotalSmallCraftBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getSmallCraftCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getSmallCraftCapacity)\n+            .sum());\n     }\n \n     public int getTotalBattleArmorBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getBattleArmorCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getBattleArmorCapacity)\n+            .sum());\n     }\n \n     public int getTotalInfantryBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getInfantryCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getInfantryCapacity)\n+            .sum());\n     }\n \n     public int getTotalHeavyVehicleBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getHeavyVehicleCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getHeavyVehicleCapacity)\n+            .sum());\n     }\n \n     public int getTotalLightVehicleBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getLightVehicleCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getLightVehicleCapacity)\n+            .sum());\n     }\n \n     public int getTotalProtomechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getProtomechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 622}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NTE4OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            if (null != p.getUnitId() && null != getHangar().getUnit(p.getUnitId())\n          \n          \n            \n                                            if ((null != p.getUnitId()) && (null != getHangar().getUnit(p.getUnitId()))", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500565188", "createdAt": "2020-10-06T20:08:06Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -8194,8 +8101,8 @@ public void initAtB(boolean newCampaign) {\n                                     // TODO : Fix this so we aren't using a hack that just assumes IS2\n                                     p.setOriginalUnitTech(Person.TECH_IS2);\n                                 }\n-                                if (null != p.getUnitId() && null != units.get(p.getUnitId())\n-                                        && ms.getName().equals(units.get(p.getUnitId()).getEntity().getShortNameRaw())) {\n+                                if (null != p.getUnitId() && null != getHangar().getUnit(p.getUnitId())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca"}, "originalPosition": 703}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb64714e6e2b7d03de487c72eb18c3c09948b6c6", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/cb64714e6e2b7d03de487c72eb18c3c09948b6c6", "committedDate": "2020-10-07T03:24:27Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6017ea3690ecd5a4a3fa881bc208359bfe7d2d61", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/6017ea3690ecd5a4a3fa881bc208359bfe7d2d61", "committedDate": "2020-10-07T18:17:15Z", "message": "Address PR feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3996, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}