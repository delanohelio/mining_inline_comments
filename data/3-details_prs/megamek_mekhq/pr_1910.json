{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0NzY4NjQ2", "number": 1910, "title": "retain force structure in destination campaign", "bodyText": "Two changes in this one:\nFirst, the campaign export wizard now tries to re-construct force structure for exported units. So, if a mech was in Alpha Company/Fire Lance in the source campaign, it'll either create that force structure in the destination or place the mech there if it exists already.\nSecond, the personnel selection list in the export wizard displays the call sign of a person in addition to the role.", "createdAt": "2020-08-07T18:55:12Z", "url": "https://github.com/MegaMek/mekhq/pull/1910", "merged": true, "mergeCommit": {"oid": "173c48af757505a96e26153d8bb3683a471bc580"}, "closed": true, "closedAt": "2020-08-10T04:09:37Z", "author": {"login": "NickAragua"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8pEH6gH2gAyNDY0NzY4NjQ2OjBkNDZjYTQzMWM1MWEzMmE5M2QxMDlmYmE0MTAyOWEyODNkOTBhMjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9aOn5AH2gAyNDY0NzY4NjQ2OjlkMDIzYTY3YjFlNmM4NzNlZGE1NThkZjVhZWUzODlhZDgwMjM2M2U=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0d46ca431c51a32a93d109fba41029a283d90a24", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/0d46ca431c51a32a93d109fba41029a283d90a24", "committedDate": "2020-08-07T18:52:09Z", "message": "retain force structure in destination campaign"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTM4ODYw", "url": "https://github.com/MegaMek/mekhq/pull/1910#pullrequestreview-463538860", "createdAt": "2020-08-07T18:57:50Z", "commit": {"oid": "0d46ca431c51a32a93d109fba41029a283d90a24"}, "state": "COMMENTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxODo1Nzo1MFrOG9kmuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxODo1OTozN1rOG9kqDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjA1Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(sourceForce == null) {\n          \n          \n            \n                    if (sourceForce == null) {", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216056", "createdAt": "2020-08-07T18:57:50Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d46ca431c51a32a93d109fba41029a283d90a24"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjEwNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(sourceForce.getParentForce() == null) {\n          \n          \n            \n                        destinationCampaign.getForces().addUnit(unit.getId());\n          \n          \n            \n                    if (sourceForce.getParentForce() == null) {\n          \n          \n            \n                        destinationCampaign.getForces().addUnit(unit.getId());", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216104", "createdAt": "2020-08-07T18:57:57Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d46ca431c51a32a93d109fba41029a283d90a24"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjE2Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(destForce != null) {\n          \n          \n            \n                    if (destForce != null) {", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216166", "createdAt": "2020-08-07T18:58:05Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d46ca431c51a32a93d109fba41029a283d90a24"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjM0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for(int x = parentForces.size() - 1; x >= 0; x--) {\n          \n          \n            \n                        for (int x = parentForces.size() - 1; x >= 0; x--) {", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216347", "createdAt": "2020-08-07T18:58:26Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {\n+            destForce.addUnit(unit.getId());\n+        } else {\n+            List<Force> parentForces = getForceAndParents(sourceForce);\n+            Force currentDestinationForce = destinationCampaign.getForces();\n+            \n+            for(int x = parentForces.size() - 1; x >= 0; x--) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d46ca431c51a32a93d109fba41029a283d90a24"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjQ4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if(nextDestinationForce == null) {\n          \n          \n            \n                            if (nextDestinationForce == null) {", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216482", "createdAt": "2020-08-07T18:58:43Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {\n+            destForce.addUnit(unit.getId());\n+        } else {\n+            List<Force> parentForces = getForceAndParents(sourceForce);\n+            Force currentDestinationForce = destinationCampaign.getForces();\n+            \n+            for(int x = parentForces.size() - 1; x >= 0; x--) {\n+                Force nextSourceForce = parentForces.get(x);\n+                Force nextDestinationForce = findForce(nextSourceForce.getFullName(), currentDestinationForce);\n+                \n+                // if this level doesn't exist yet, add it to where we currently are\n+                if(nextDestinationForce == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d46ca431c51a32a93d109fba41029a283d90a24"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjU0Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(force.getFullName().equals(forceName)) {\n          \n          \n            \n                    if (force.getFullName().equals(forceName)) {", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216546", "createdAt": "2020-08-07T18:58:52Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {\n+            destForce.addUnit(unit.getId());\n+        } else {\n+            List<Force> parentForces = getForceAndParents(sourceForce);\n+            Force currentDestinationForce = destinationCampaign.getForces();\n+            \n+            for(int x = parentForces.size() - 1; x >= 0; x--) {\n+                Force nextSourceForce = parentForces.get(x);\n+                Force nextDestinationForce = findForce(nextSourceForce.getFullName(), currentDestinationForce);\n+                \n+                // if this level doesn't exist yet, add it to where we currently are\n+                if(nextDestinationForce == null) {\n+                    Force forceCopy = new Force(nextSourceForce.getName());\n+                    destinationCampaign.addForce(forceCopy, currentDestinationForce);\n+                    currentDestinationForce = forceCopy;\n+                // otherwise, update current location and move to next level\n+                } else {\n+                    currentDestinationForce = nextDestinationForce;\n+                }\n+            }\n+            \n+            currentDestinationForce.addUnit(unit.getId());\n+        }\n+    }\n+    \n+    /**\n+     * Recurses through a Force structure to look for a force with the given \"full force name\"\n+     */\n+    private Force findForce(String forceName, Force force) {\n+        if(force.getFullName().equals(forceName)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d46ca431c51a32a93d109fba41029a283d90a24"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjYyNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for(Force subForce : force.getSubForces()) {\n          \n          \n            \n                        for (Force subForce : force.getSubForces()) {", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216627", "createdAt": "2020-08-07T18:59:00Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {\n+            destForce.addUnit(unit.getId());\n+        } else {\n+            List<Force> parentForces = getForceAndParents(sourceForce);\n+            Force currentDestinationForce = destinationCampaign.getForces();\n+            \n+            for(int x = parentForces.size() - 1; x >= 0; x--) {\n+                Force nextSourceForce = parentForces.get(x);\n+                Force nextDestinationForce = findForce(nextSourceForce.getFullName(), currentDestinationForce);\n+                \n+                // if this level doesn't exist yet, add it to where we currently are\n+                if(nextDestinationForce == null) {\n+                    Force forceCopy = new Force(nextSourceForce.getName());\n+                    destinationCampaign.addForce(forceCopy, currentDestinationForce);\n+                    currentDestinationForce = forceCopy;\n+                // otherwise, update current location and move to next level\n+                } else {\n+                    currentDestinationForce = nextDestinationForce;\n+                }\n+            }\n+            \n+            currentDestinationForce.addUnit(unit.getId());\n+        }\n+    }\n+    \n+    /**\n+     * Recurses through a Force structure to look for a force with the given \"full force name\"\n+     */\n+    private Force findForce(String forceName, Force force) {\n+        if(force.getFullName().equals(forceName)) {\n+            return force;\n+        } else {\n+            for(Force subForce : force.getSubForces()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d46ca431c51a32a93d109fba41029a283d90a24"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjY2NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if(foundForce != null) {\n          \n          \n            \n                            if (foundForce != null) {", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216665", "createdAt": "2020-08-07T18:59:05Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {\n+            destForce.addUnit(unit.getId());\n+        } else {\n+            List<Force> parentForces = getForceAndParents(sourceForce);\n+            Force currentDestinationForce = destinationCampaign.getForces();\n+            \n+            for(int x = parentForces.size() - 1; x >= 0; x--) {\n+                Force nextSourceForce = parentForces.get(x);\n+                Force nextDestinationForce = findForce(nextSourceForce.getFullName(), currentDestinationForce);\n+                \n+                // if this level doesn't exist yet, add it to where we currently are\n+                if(nextDestinationForce == null) {\n+                    Force forceCopy = new Force(nextSourceForce.getName());\n+                    destinationCampaign.addForce(forceCopy, currentDestinationForce);\n+                    currentDestinationForce = forceCopy;\n+                // otherwise, update current location and move to next level\n+                } else {\n+                    currentDestinationForce = nextDestinationForce;\n+                }\n+            }\n+            \n+            currentDestinationForce.addUnit(unit.getId());\n+        }\n+    }\n+    \n+    /**\n+     * Recurses through a Force structure to look for a force with the given \"full force name\"\n+     */\n+    private Force findForce(String forceName, Force force) {\n+        if(force.getFullName().equals(forceName)) {\n+            return force;\n+        } else {\n+            for(Force subForce : force.getSubForces()) {\n+                Force foundForce = findForce(forceName, subForce);\n+                \n+                if(foundForce != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d46ca431c51a32a93d109fba41029a283d90a24"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjczMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    while(force.getParentForce() != null) {\n          \n          \n            \n                    while (force.getParentForce() != null) {", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216733", "createdAt": "2020-08-07T18:59:13Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {\n+            destForce.addUnit(unit.getId());\n+        } else {\n+            List<Force> parentForces = getForceAndParents(sourceForce);\n+            Force currentDestinationForce = destinationCampaign.getForces();\n+            \n+            for(int x = parentForces.size() - 1; x >= 0; x--) {\n+                Force nextSourceForce = parentForces.get(x);\n+                Force nextDestinationForce = findForce(nextSourceForce.getFullName(), currentDestinationForce);\n+                \n+                // if this level doesn't exist yet, add it to where we currently are\n+                if(nextDestinationForce == null) {\n+                    Force forceCopy = new Force(nextSourceForce.getName());\n+                    destinationCampaign.addForce(forceCopy, currentDestinationForce);\n+                    currentDestinationForce = forceCopy;\n+                // otherwise, update current location and move to next level\n+                } else {\n+                    currentDestinationForce = nextDestinationForce;\n+                }\n+            }\n+            \n+            currentDestinationForce.addUnit(unit.getId());\n+        }\n+    }\n+    \n+    /**\n+     * Recurses through a Force structure to look for a force with the given \"full force name\"\n+     */\n+    private Force findForce(String forceName, Force force) {\n+        if(force.getFullName().equals(forceName)) {\n+            return force;\n+        } else {\n+            for(Force subForce : force.getSubForces()) {\n+                Force foundForce = findForce(forceName, subForce);\n+                \n+                if(foundForce != null) {\n+                    return foundForce;\n+                }\n+            }\n+            \n+            return null;\n+        }\n+    }\n \n+    /** \n+     * Moves through a force's ancestors and returns a flattened list of force names in order\n+     * from me to furtherst ancestor.\n+     */\n+    private List<Force> getForceAndParents(Force force) {\n+        List<Force> retval = new ArrayList<>();\n+        retval.add(force);\n+        \n+        Force ancestorForce;\n+        while(force.getParentForce() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d46ca431c51a32a93d109fba41029a283d90a24"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjc5Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if(ancestorForce.getParentForce() != null) {\n          \n          \n            \n                        if (ancestorForce.getParentForce() != null) {", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216797", "createdAt": "2020-08-07T18:59:22Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -633,7 +641,89 @@ private boolean exportToCampaign(File file) {\n \n         return saved;\n     }\n+    \n+    private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n+        Force sourceForce = sourceCampaign.getForce(sourceForceID);\n+        if(sourceForce == null) {\n+            return;\n+        }\n+        \n+        // this indicates a unit assigned to the root-level force\n+        if(sourceForce.getParentForce() == null) {\n+            destinationCampaign.getForces().addUnit(unit.getId());\n+        }\n+        \n+        // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n+        // if we find one, add the unit to it\n+        // otherwise,\n+        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n+        if(destForce != null) {\n+            destForce.addUnit(unit.getId());\n+        } else {\n+            List<Force> parentForces = getForceAndParents(sourceForce);\n+            Force currentDestinationForce = destinationCampaign.getForces();\n+            \n+            for(int x = parentForces.size() - 1; x >= 0; x--) {\n+                Force nextSourceForce = parentForces.get(x);\n+                Force nextDestinationForce = findForce(nextSourceForce.getFullName(), currentDestinationForce);\n+                \n+                // if this level doesn't exist yet, add it to where we currently are\n+                if(nextDestinationForce == null) {\n+                    Force forceCopy = new Force(nextSourceForce.getName());\n+                    destinationCampaign.addForce(forceCopy, currentDestinationForce);\n+                    currentDestinationForce = forceCopy;\n+                // otherwise, update current location and move to next level\n+                } else {\n+                    currentDestinationForce = nextDestinationForce;\n+                }\n+            }\n+            \n+            currentDestinationForce.addUnit(unit.getId());\n+        }\n+    }\n+    \n+    /**\n+     * Recurses through a Force structure to look for a force with the given \"full force name\"\n+     */\n+    private Force findForce(String forceName, Force force) {\n+        if(force.getFullName().equals(forceName)) {\n+            return force;\n+        } else {\n+            for(Force subForce : force.getSubForces()) {\n+                Force foundForce = findForce(forceName, subForce);\n+                \n+                if(foundForce != null) {\n+                    return foundForce;\n+                }\n+            }\n+            \n+            return null;\n+        }\n+    }\n \n+    /** \n+     * Moves through a force's ancestors and returns a flattened list of force names in order\n+     * from me to furtherst ancestor.\n+     */\n+    private List<Force> getForceAndParents(Force force) {\n+        List<Force> retval = new ArrayList<>();\n+        retval.add(force);\n+        \n+        Force ancestorForce;\n+        while(force.getParentForce() != null) {\n+            ancestorForce = force.getParentForce();\n+            \n+            // we don't want the top-level force\n+            if(ancestorForce.getParentForce() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d46ca431c51a32a93d109fba41029a283d90a24"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxNjkxMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if((person.getCallsign() != null) && (person.getCallsign().trim().length() > 0)) {\n          \n          \n            \n                        if ((person.getCallsign() != null) && (person.getCallsign().trim().length() > 0)) {", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467216910", "createdAt": "2020-08-07T18:59:37Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -704,7 +794,15 @@ public Component getListCellRendererComponent(JList<?> list, Object value, int i\n                                                       boolean isSelected, boolean cellHasFocus) {\n             Component cmp = super.getListCellRendererComponent(list, value, index, isSelected, cellHasFocus);\n             Person person = (Person) value;\n-            String cellValue = String.format(\"%s (%s)\", person.getFullName(), person.getPrimaryRoleDesc());\n+            String callsign = \"\";\n+            if((person.getCallsign() != null) && (person.getCallsign().trim().length() > 0)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d46ca431c51a32a93d109fba41029a283d90a24"}, "originalPosition": 129}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5db636f63ec34e60bbf05f4acb87cc086a452077", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/5db636f63ec34e60bbf05f4acb87cc086a452077", "committedDate": "2020-08-08T03:15:59Z", "message": "fix export issue when root campaign names don't match"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91fa9b8b62cdc9dffbb3cdb5a32099a462f7dc9b", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/91fa9b8b62cdc9dffbb3cdb5a32099a462f7dc9b", "committedDate": "2020-08-08T03:18:39Z", "message": "whitespace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2265642c1403c06e6698d4e7c921e0be64481c62", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/2265642c1403c06e6698d4e7c921e0be64481c62", "committedDate": "2020-08-08T03:20:12Z", "message": "whitespace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e72155460f1711af9115ecd735b86cacf245806", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/6e72155460f1711af9115ecd735b86cacf245806", "committedDate": "2020-08-08T03:21:09Z", "message": "whitespace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0d61d5719942ef1b63f420f27bdb7d71408363f", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/e0d61d5719942ef1b63f420f27bdb7d71408363f", "committedDate": "2020-08-09T03:06:21Z", "message": "merge from upstream"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzOTI5MjU5", "url": "https://github.com/MegaMek/mekhq/pull/1910#pullrequestreview-463929259", "createdAt": "2020-08-10T02:04:37Z", "commit": {"oid": "e0d61d5719942ef1b63f420f27bdb7d71408363f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjowNDozN1rOG9_tgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwMjowNDozN1rOG9_tgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2MDE2Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String sourceForceFullName = getDestinationFullName (sourceForce, sourceCampaign, destinationCampaign);\n          \n          \n            \n                    String sourceForceFullName = getDestinationFullName(sourceForce, sourceCampaign, destinationCampaign);", "url": "https://github.com/MegaMek/mekhq/pull/1910#discussion_r467660162", "createdAt": "2020-08-10T02:04:37Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java", "diffHunk": "@@ -644,31 +648,36 @@ private boolean exportToCampaign(File file) {\n     \n     private void attemptToAssignToForce(Unit unit, int sourceForceID, Campaign sourceCampaign, Campaign destinationCampaign) {\n         Force sourceForce = sourceCampaign.getForce(sourceForceID);\n-        if(sourceForce == null) {\n+        if (sourceForce == null) {\n             return;\n         }\n         \n         // this indicates a unit assigned to the root-level force\n-        if(sourceForce.getParentForce() == null) {\n+        if (sourceForce.getParentForce() == null) {\n             destinationCampaign.getForces().addUnit(unit.getId());\n         }\n         \n         // first thing we will try is to identify a force with the same name and tree structure in the destination campaign\n         // if we find one, add the unit to it\n-        // otherwise,\n-        Force destForce = findForce(sourceForce.getFullName(), destinationCampaign.getForces());\n-        if(destForce != null) {\n+        // otherwise, chain-add forces\n+\n+        // hack: the root forces are irrelevant, so we replace the source root force name with the destination root force name\n+        String sourceForceFullName = getDestinationFullName (sourceForce, sourceCampaign, destinationCampaign);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0d61d5719942ef1b63f420f27bdb7d71408363f"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d023a67b1e6c873eda558df5aee389ad802363e", "author": {"user": {"login": "NickAragua", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/9d023a67b1e6c873eda558df5aee389ad802363e", "committedDate": "2020-08-10T04:08:58Z", "message": "Update MekHQ/src/mekhq/gui/dialog/CampaignExportWizard.java\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4159, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}