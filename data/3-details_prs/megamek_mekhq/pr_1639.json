{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwMzUwNjY4", "number": 1639, "title": "1218: Personnel Total Earnings", "bodyText": "This fixes #1218 by implementing tracking for the total earnings of personnel.\nTo review: whitespace differences off, and there is a comment on what has changed in the functionality I moved to a private method.", "createdAt": "2020-04-07T15:46:19Z", "url": "https://github.com/MegaMek/mekhq/pull/1639", "merged": true, "mergeCommit": {"oid": "b9771a7b3d0a4d35436aa1a64132b4de517a28e0"}, "closed": true, "closedAt": "2020-04-09T14:20:44Z", "author": {"login": "Windchild292"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcU13XygH2gAyNDAwMzUwNjY4OmI2MjVjYjA0ODFiOGY1ZWNlMDc2MGQ5Y2IxN2NjZjE4YzA4Nzg4ZmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVzet0AFqTM5MDQ2MDAwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b625cb0481b8f5ece0760d9cb17ccf18c08788fb", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/b625cb0481b8f5ece0760d9cb17ccf18c08788fb", "committedDate": "2020-04-06T03:10:01Z", "message": "Initial few lines of total earnings code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e537c79e4d5cc839b2c5f00ca563386f4914661a", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/e537c79e4d5cc839b2c5f00ca563386f4914661a", "committedDate": "2020-04-07T04:34:16Z", "message": "Adding option to enable the tracking, and adding missing methods for Person"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3026dcfdc944f6f9423d8b65eaab2906a6faf632", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/3026dcfdc944f6f9423d8b65eaab2906a6faf632", "committedDate": "2020-04-07T13:52:28Z", "message": "Cleaning up financial methods while determining how to implement the payment tracking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d122306d12de8a1293915388d5b92dd428da89df", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/d122306d12de8a1293915388d5b92dd428da89df", "committedDate": "2020-04-07T14:06:41Z", "message": "Cleaning up personnel shares while figuring out the implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4c966ed1c9f3a98675045e50c76d72232f380e9", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/c4c966ed1c9f3a98675045e50c76d72232f380e9", "committedDate": "2020-04-07T14:25:42Z", "message": "Adding functionality to payout the value of a share"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78becf98fb674954cf33dfceef4b6e1351d74285", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/78becf98fb674954cf33dfceef4b6e1351d74285", "committedDate": "2020-04-07T14:43:58Z", "message": "Adding salary payments to total earnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42643abf3d5452047adf4e829e6bb54973d4e853", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/42643abf3d5452047adf4e829e6bb54973d4e853", "committedDate": "2020-04-07T15:27:43Z", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_1218"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4550990d3f41e4df0f1014c787c14cd36b99e20", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/d4550990d3f41e4df0f1014c787c14cd36b99e20", "committedDate": "2020-04-07T15:29:29Z", "message": "Fixing shares payment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c55ad76dc19bd63db911de1ab9fa72641c736d6", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/5c55ad76dc19bd63db911de1ab9fa72641c736d6", "committedDate": "2020-04-07T15:43:52Z", "message": "Fixing salary payment issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MjUwNzU3", "url": "https://github.com/MegaMek/mekhq/pull/1639#pullrequestreview-389250757", "createdAt": "2020-04-07T15:47:42Z", "commit": {"oid": "5c55ad76dc19bd63db911de1ab9fa72641c736d6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNTo0Nzo0M1rOGCKHNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNTo0Nzo0M1rOGCKHNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkxNjAyMg==", "bodyText": "This is the new addition to track shares.", "url": "https://github.com/MegaMek/mekhq/pull/1639#discussion_r404916022", "createdAt": "2020-04-07T15:47:43Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/finances/Finances.java", "diffHunk": "@@ -407,6 +391,43 @@ public void newDay(Campaign campaign) {\n         loans = newLoans;\n     }\n \n+\n+    private void payoutShares(Campaign campaign, Contract contract, GregorianCalendar calendar) {\n+        if (campaign.getCampaignOptions().getUseAtB() && campaign.getCampaignOptions().getUseShareSystem()\n+                && (contract instanceof AtBContract)) {\n+            Money shares = contract.getMonthlyPayOut().multipliedBy(((AtBContract) contract).getSharesPct())\n+                    .dividedBy(100);\n+            if (debit(shares, Transaction.C_SALARY,\n+                    String.format(resourceMap.getString(\"ContractSharePayment.text\"), contract.getName()),\n+                    calendar.getTime())) {\n+                campaign.addReport(String.format(resourceMap.getString(\"DistributedShares.text\"),\n+                        shares.toAmountAndSymbolString()));\n+\n+                if (campaign.getCampaignOptions().trackTotalEarnings()) {\n+                    int numberOfShares = 0;\n+                    boolean sharesForAll = campaign.getCampaignOptions().getSharesForAll();\n+                    for (Person person : campaign.getActivePersonnel()) {\n+                        numberOfShares += person.getNumShares(sharesForAll);\n+                    }\n+\n+                    Money singleShare = shares.dividedBy(numberOfShares);\n+                    for (Person person : campaign.getActivePersonnel()) {\n+                        person.payPersonShares(singleShare, sharesForAll);\n+                    }\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c55ad76dc19bd63db911de1ab9fa72641c736d6"}, "originalPosition": 112}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b20a2762738e92ae671fa88711574482f583902", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/4b20a2762738e92ae671fa88711574482f583902", "committedDate": "2020-04-07T17:15:33Z", "message": "Adding display for total earnings, and fixing the display order for ease of future changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTg0MTg2", "url": "https://github.com/MegaMek/mekhq/pull/1639#pullrequestreview-389584186", "createdAt": "2020-04-08T00:47:48Z", "commit": {"oid": "4b20a2762738e92ae671fa88711574482f583902"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMDo0Nzo0OVrOGCbL6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQwMDo1NTozNFrOGCbUYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE5NTc1NA==", "bodyText": "This one seems like an \"if it ain't broke don't fix it\" scenario.", "url": "https://github.com/MegaMek/mekhq/pull/1639#discussion_r405195754", "createdAt": "2020-04-08T00:47:49Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -3755,24 +3755,18 @@ public Money getPayRoll() {\n     }\n \n     public Money getPayRoll(boolean noInfantry) {\n-        if(!campaignOptions.payForSalaries()) {\n+        if (getCampaignOptions().payForSalaries()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b20a2762738e92ae671fa88711574482f583902"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE5NjA1Ng==", "bodyText": "Same here, not really sure of the point of rearranging the if block.", "url": "https://github.com/MegaMek/mekhq/pull/1639#discussion_r405196056", "createdAt": "2020-04-08T00:48:53Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -3806,11 +3800,11 @@ public Money getWeeklyMaintenanceCosts() {\n     }\n \n     public Money getOverheadExpenses() {\n-        if(!campaignOptions.payForOverhead()) {\n+        if (getCampaignOptions().payForOverhead()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b20a2762738e92ae671fa88711574482f583902"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTE5NzkyMA==", "bodyText": "I think this method is going to require an explanation of the sharesForAll parameter. Also, I'm wondering if it'll be a little more efficient if we cache the results of all this logic. No need to store it permanently, just invalidate it when something happens to change the number of shares.", "url": "https://github.com/MegaMek/mekhq/pull/1639#discussion_r405197920", "createdAt": "2020-04-08T00:55:34Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/personnel/Person.java", "diffHunk": "@@ -4309,37 +4362,33 @@ public void setOriginalUnit(Unit unit) {\n     }\n \n     public int getNumShares(boolean sharesForAll) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b20a2762738e92ae671fa88711574482f583902"}, "originalPosition": 107}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8150fcee74cd8b0419261ae3c2a0a65f9979341", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/a8150fcee74cd8b0419261ae3c2a0a65f9979341", "committedDate": "2020-04-08T01:47:08Z", "message": "Fixing merge conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3108bfc2e0be0493c39782a07fb4157d9c0398c", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/b3108bfc2e0be0493c39782a07fb4157d9c0398c", "committedDate": "2020-04-08T01:50:45Z", "message": "Adding comment describing sharesForAll"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNDYwMDAx", "url": "https://github.com/MegaMek/mekhq/pull/1639#pullrequestreview-390460001", "createdAt": "2020-04-09T02:57:12Z", "commit": {"oid": "b3108bfc2e0be0493c39782a07fb4157d9c0398c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4368, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}