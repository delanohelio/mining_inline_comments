{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg4OTE5MjM4", "number": 2018, "title": "Improved tracking of integrated heat sink changes during refit", "bodyText": "Fix for #630", "createdAt": "2020-09-17T20:38:01Z", "url": "https://github.com/MegaMek/mekhq/pull/2018", "merged": true, "mergeCommit": {"oid": "9f1a3c3dd6d730a52c6ab3d539cbea8885862e74"}, "closed": true, "closedAt": "2020-09-18T05:04:54Z", "author": {"login": "RexPearce"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJnsMDgH2gAyNDg4OTE5MjM4Ojk0NTIzZDlhNTFjZTgwMjdiNWMwMDk3NmNiZWI0YzU5YWRhODkwNDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJ-ChEgH2gAyNDg4OTE5MjM4OjQ2Y2VlYjQ5NzVkOGEwZDE3NzVkYTQwZmViMDE0ZjNlMjQ3NmE4NzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "94523d9a51ce8027b5c00976cbeb4c59ada89040", "author": {"user": {"login": "RexPearce", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/94523d9a51ce8027b5c00976cbeb4c59ada89040", "committedDate": "2020-09-17T02:37:07Z", "message": "new integrated heat sinks should be added as MissingParts, otherwise they will be ignored by shoppingList"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bd5efc05ca97a538a068f3d324daa0dea1d6745", "author": {"user": {"login": "RexPearce", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/1bd5efc05ca97a538a068f3d324daa0dea1d6745", "committedDate": "2020-09-17T05:06:09Z", "message": "cleanup Integrated heat sink parts: don't actually add them to the unit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "518eff0aabb071820c8226d20465dbc5ff7c6050", "author": {"user": {"login": "RexPearce", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/518eff0aabb071820c8226d20465dbc5ff7c6050", "committedDate": "2020-09-17T05:46:40Z", "message": "when refitting internal heat sinks, check warehouse for spares before ordering new ones"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2c532c163c25c04e9c5fdbe46df73ca77882f82", "author": {"user": {"login": "RexPearce", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/d2c532c163c25c04e9c5fdbe46df73ca77882f82", "committedDate": "2020-09-17T13:39:54Z", "message": "Merge remote-tracking branch 'upstream/master' into fix-refit-integrated-heat-sinks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45f407c020714ed45a4a98d068aa42ea6350b5e3", "author": {"user": {"login": "RexPearce", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/45f407c020714ed45a4a98d068aa42ea6350b5e3", "committedDate": "2020-09-17T18:20:05Z", "message": "better cleanup of integrated heat sinks for Tanks and Aeros"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMDE2Mjg3", "url": "https://github.com/MegaMek/mekhq/pull/2018#pullrequestreview-491016287", "createdAt": "2020-09-17T21:55:28Z", "commit": {"oid": "45f407c020714ed45a4a98d068aa42ea6350b5e3"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QyMTo1NToyOVrOHT24ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QyMTo1NzoyOFrOHT277g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU4NDIyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for(Part nHsPart : newIntegratedHS) {\n          \n          \n            \n                    for (Part nHsPart : newIntegratedHS) {", "url": "https://github.com/MegaMek/mekhq/pull/2018#discussion_r490584222", "createdAt": "2020-09-17T21:55:29Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "diffHunk": "@@ -907,15 +906,40 @@ public void calculate() {\n             if (oldHS != newHS) {\n                 Part hsPart = heatSinkPart(newEntity); // only single HS allowed, so they have to be of the same type\n                 for (int i = oldHS; i < newHS; i++) {\n-                    newIntegratedHS.add(hsPart.clone());\n+                    // Heat sink added for supply chain tracking purposes and removed from refit later\n+                    newIntegratedHS.add(hsPart.clone().getMissingPart());\n                 }\n                 for (int i = newHS; i < oldHS; i++) {\n                     oldIntegratedHS.add(hsPart.clone());\n                 }\n             }\n         }\n         time += (oldIntegratedHS.size() + newIntegratedHS.size()) * 90;\n-        shoppingList.addAll(newIntegratedHS);\n+        for(Part nHsPart : newIntegratedHS) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f407c020714ed45a4a98d068aa42ea6350b5e3"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU4NDg4OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if((null != replacement) && (null == partQuantity.get(replacement.getId()))) {\n          \n          \n            \n                        if ((null != replacement) && (null == partQuantity.get(replacement.getId()))) {", "url": "https://github.com/MegaMek/mekhq/pull/2018#discussion_r490584889", "createdAt": "2020-09-17T21:57:05Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "diffHunk": "@@ -907,15 +906,40 @@ public void calculate() {\n             if (oldHS != newHS) {\n                 Part hsPart = heatSinkPart(newEntity); // only single HS allowed, so they have to be of the same type\n                 for (int i = oldHS; i < newHS; i++) {\n-                    newIntegratedHS.add(hsPart.clone());\n+                    // Heat sink added for supply chain tracking purposes and removed from refit later\n+                    newIntegratedHS.add(hsPart.clone().getMissingPart());\n                 }\n                 for (int i = newHS; i < oldHS; i++) {\n                     oldIntegratedHS.add(hsPart.clone());\n                 }\n             }\n         }\n         time += (oldIntegratedHS.size() + newIntegratedHS.size()) * 90;\n-        shoppingList.addAll(newIntegratedHS);\n+        for(Part nHsPart : newIntegratedHS) {\n+            // Check warehouse for spare heat sinks before adding to shopping list\n+            Part replacement = ((MissingPart)nHsPart).findReplacement(true);\n+            //check quantity\n+            if((null != replacement) && (null == partQuantity.get(replacement.getId()))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f407c020714ed45a4a98d068aa42ea6350b5e3"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU4NDkzOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Part replacement = ((MissingPart)nHsPart).findReplacement(true);\n          \n          \n            \n                        Part replacement = ((MissingPart) nHsPart).findReplacement(true);", "url": "https://github.com/MegaMek/mekhq/pull/2018#discussion_r490584938", "createdAt": "2020-09-17T21:57:11Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "diffHunk": "@@ -907,15 +906,40 @@ public void calculate() {\n             if (oldHS != newHS) {\n                 Part hsPart = heatSinkPart(newEntity); // only single HS allowed, so they have to be of the same type\n                 for (int i = oldHS; i < newHS; i++) {\n-                    newIntegratedHS.add(hsPart.clone());\n+                    // Heat sink added for supply chain tracking purposes and removed from refit later\n+                    newIntegratedHS.add(hsPart.clone().getMissingPart());\n                 }\n                 for (int i = newHS; i < oldHS; i++) {\n                     oldIntegratedHS.add(hsPart.clone());\n                 }\n             }\n         }\n         time += (oldIntegratedHS.size() + newIntegratedHS.size()) * 90;\n-        shoppingList.addAll(newIntegratedHS);\n+        for(Part nHsPart : newIntegratedHS) {\n+            // Check warehouse for spare heat sinks before adding to shopping list\n+            Part replacement = ((MissingPart)nHsPart).findReplacement(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f407c020714ed45a4a98d068aa42ea6350b5e3"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU4NTAwNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if((null != replacement) && (partQuantity.get(replacement.getId())) > 0) {\n          \n          \n            \n                        if ((null != replacement) && (partQuantity.get(replacement.getId())) > 0) {", "url": "https://github.com/MegaMek/mekhq/pull/2018#discussion_r490585005", "createdAt": "2020-09-17T21:57:19Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "diffHunk": "@@ -907,15 +906,40 @@ public void calculate() {\n             if (oldHS != newHS) {\n                 Part hsPart = heatSinkPart(newEntity); // only single HS allowed, so they have to be of the same type\n                 for (int i = oldHS; i < newHS; i++) {\n-                    newIntegratedHS.add(hsPart.clone());\n+                    // Heat sink added for supply chain tracking purposes and removed from refit later\n+                    newIntegratedHS.add(hsPart.clone().getMissingPart());\n                 }\n                 for (int i = newHS; i < oldHS; i++) {\n                     oldIntegratedHS.add(hsPart.clone());\n                 }\n             }\n         }\n         time += (oldIntegratedHS.size() + newIntegratedHS.size()) * 90;\n-        shoppingList.addAll(newIntegratedHS);\n+        for(Part nHsPart : newIntegratedHS) {\n+            // Check warehouse for spare heat sinks before adding to shopping list\n+            Part replacement = ((MissingPart)nHsPart).findReplacement(true);\n+            //check quantity\n+            if((null != replacement) && (null == partQuantity.get(replacement.getId()))) {\n+                partQuantity.put(replacement.getId(), replacement.getQuantity());\n+            }\n+            if((null != replacement) && (partQuantity.get(replacement.getId())) > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f407c020714ed45a4a98d068aa42ea6350b5e3"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU4NTA3MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            partQuantity.put(replacement.getId(), partQuantity.get(replacement.getId())-1);\n          \n          \n            \n                            partQuantity.put(replacement.getId(), partQuantity.get(replacement.getId()) - 1);", "url": "https://github.com/MegaMek/mekhq/pull/2018#discussion_r490585070", "createdAt": "2020-09-17T21:57:28Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "diffHunk": "@@ -907,15 +906,40 @@ public void calculate() {\n             if (oldHS != newHS) {\n                 Part hsPart = heatSinkPart(newEntity); // only single HS allowed, so they have to be of the same type\n                 for (int i = oldHS; i < newHS; i++) {\n-                    newIntegratedHS.add(hsPart.clone());\n+                    // Heat sink added for supply chain tracking purposes and removed from refit later\n+                    newIntegratedHS.add(hsPart.clone().getMissingPart());\n                 }\n                 for (int i = newHS; i < oldHS; i++) {\n                     oldIntegratedHS.add(hsPart.clone());\n                 }\n             }\n         }\n         time += (oldIntegratedHS.size() + newIntegratedHS.size()) * 90;\n-        shoppingList.addAll(newIntegratedHS);\n+        for(Part nHsPart : newIntegratedHS) {\n+            // Check warehouse for spare heat sinks before adding to shopping list\n+            Part replacement = ((MissingPart)nHsPart).findReplacement(true);\n+            //check quantity\n+            if((null != replacement) && (null == partQuantity.get(replacement.getId()))) {\n+                partQuantity.put(replacement.getId(), replacement.getQuantity());\n+            }\n+            if((null != replacement) && (partQuantity.get(replacement.getId())) > 0) {\n+                newUnitParts.add(replacement.getId());\n+                //adjust quantity\n+                partQuantity.put(replacement.getId(), partQuantity.get(replacement.getId())-1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f407c020714ed45a4a98d068aa42ea6350b5e3"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03309dbf8f46910e840d753d89824ac1f5187667", "author": {"user": {"login": "RexPearce", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/03309dbf8f46910e840d753d89824ac1f5187667", "committedDate": "2020-09-17T23:29:30Z", "message": "style formatting fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMTI2MDg1", "url": "https://github.com/MegaMek/mekhq/pull/2018#pullrequestreview-491126085", "createdAt": "2020-09-18T03:32:47Z", "commit": {"oid": "03309dbf8f46910e840d753d89824ac1f5187667"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwMzozMjo0N1rOHT8v2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQwMzozMjo0N1rOHT8v2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY4MDI4Mw==", "bodyText": "Can't this just be newHS.getMissingPart() ?", "url": "https://github.com/MegaMek/mekhq/pull/2018#discussion_r490680283", "createdAt": "2020-09-18T03:32:47Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "diffHunk": "@@ -881,14 +878,16 @@ public void calculate() {\n                     oldIntegratedHS.add(oldHS.clone());\n                 }\n                 for (int i = 0; i < newCount - oldCount; i++) {\n-                    newIntegratedHS.add(oldHS.clone());\n+                    // Heat sink added for supply chain tracking purposes and removed from refit later\n+                    newIntegratedHS.add(newHS.clone().getMissingPart());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03309dbf8f46910e840d753d89824ac1f5187667"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxMTMzNDM5", "url": "https://github.com/MegaMek/mekhq/pull/2018#pullrequestreview-491133439", "createdAt": "2020-09-18T03:51:56Z", "commit": {"oid": "03309dbf8f46910e840d753d89824ac1f5187667"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46ceeb4975d8a0d1775da40feb014f3e2476a870", "author": {"user": {"login": "RexPearce", "name": null}}, "url": "https://github.com/MegaMek/mekhq/commit/46ceeb4975d8a0d1775da40feb014f3e2476a870", "committedDate": "2020-09-18T04:39:25Z", "message": "unnecessary clones"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4200, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}