{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwNjQwODg3", "number": 1948, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMjoyMjoyM1rOEagMlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMjoyMzoxN1rOEagN0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MjI1OTQzOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMjoyMjoyM1rOHD-Trg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMjoyMjoyM1rOHD-Trg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkyODYyMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            && curType.getMunitionType() == ((AmmoType)((AmmoStorage)part).getType()).getMunitionType();\n          \n          \n            \n                            && curType.getMunitionType() == ((AmmoType) ((AmmoStorage) part).getType()).getMunitionType();", "url": "https://github.com/MegaMek/mekhq/pull/1948#discussion_r473928622", "createdAt": "2020-08-20T12:22:23Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "diffHunk": "@@ -286,13 +286,20 @@ public String failToFind() {\n         return \"<font color='red'><b> part not found</b>.</font>\";\n     }\n \n-    public void changeAmountAvailable(int amount, final AmmoType curType) {\n-        final long curMunition = curType.getMunitionType();\n-        AmmoStorage a = (AmmoStorage)campaign.findSparePart(part -> {\n-            return part instanceof AmmoStorage\n+    /**\n+     * Boolean function that determines if the given part is of the correct ammo. \n+     * Useful as a predicate for campaign.findSparePart()\n+     */\n+    public static boolean IsRightAmmo(Part part, AmmoType curType) {\n+        return part instanceof AmmoStorage\n                 && part.isPresent()\n                 && ((AmmoType)((AmmoStorage)part).getType()).equals(curType)\n-                && curMunition == ((AmmoType)((AmmoStorage)part).getType()).getMunitionType();\n+                && curType.getMunitionType() == ((AmmoType)((AmmoStorage)part).getType()).getMunitionType();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88756b3d1ccfd7f9984193f9069787e14ed60a3b"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MjI2MDExOnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMjoyMjozNFrOHD-UFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMjoyMjozNFrOHD-UFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkyODcyNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    AmmoStorage a = (AmmoStorage)campaign.findSparePart(part -> {\n          \n          \n            \n                    AmmoStorage a = (AmmoStorage) campaign.findSparePart(part -> {", "url": "https://github.com/MegaMek/mekhq/pull/1948#discussion_r473928724", "createdAt": "2020-08-20T12:22:34Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/AmmoStorage.java", "diffHunk": "@@ -286,13 +286,20 @@ public String failToFind() {\n         return \"<font color='red'><b> part not found</b>.</font>\";\n     }\n \n-    public void changeAmountAvailable(int amount, final AmmoType curType) {\n-        final long curMunition = curType.getMunitionType();\n-        AmmoStorage a = (AmmoStorage)campaign.findSparePart(part -> {\n-            return part instanceof AmmoStorage\n+    /**\n+     * Boolean function that determines if the given part is of the correct ammo. \n+     * Useful as a predicate for campaign.findSparePart()\n+     */\n+    public static boolean IsRightAmmo(Part part, AmmoType curType) {\n+        return part instanceof AmmoStorage\n                 && part.isPresent()\n                 && ((AmmoType)((AmmoStorage)part).getType()).equals(curType)\n-                && curMunition == ((AmmoType)((AmmoStorage)part).getType()).getMunitionType();\n+                && curType.getMunitionType() == ((AmmoType)((AmmoStorage)part).getType()).getMunitionType();\n+    }\n+    \n+    public void changeAmountAvailable(int amount, final AmmoType curType) {\n+        AmmoStorage a = (AmmoStorage)campaign.findSparePart(part -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88756b3d1ccfd7f9984193f9069787e14ed60a3b"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MjI2MjU4OnYy", "diffSide": "RIGHT", "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMjoyMzoxN1rOHD-ViQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMjoyMzoxN1rOHD-ViQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkyOTA5Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if (foundAmmo == null || (((AmmoStorage) foundAmmo).getShots() < bin.getShotsNeeded())) {\n          \n          \n            \n                            if ((foundAmmo == null) || (((AmmoStorage) foundAmmo).getShots() < bin.getShotsNeeded())) {", "url": "https://github.com/MegaMek/mekhq/pull/1948#discussion_r473929097", "createdAt": "2020-08-20T12:23:17Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/campaign/parts/Refit.java", "diffHunk": "@@ -1168,15 +1169,20 @@ public boolean acquireParts() {\n                 }\n             }\n         }\n-        // Cycle through newUnitParts, find any ammo bins and if they need loading, try to load them\n+        \n+        // Cycle through newUnitParts, find any ammo bins and see if we have the ammo to load them\n         boolean missingAmmo = false;\n-        for(int pid : newUnitParts) {\n-            Part part = oldUnit.getCampaign().getPart(pid);\n-            if(part instanceof AmmoBin && null == part.getUnit()) {\n-                AmmoBin bin = (AmmoBin)part;\n-                bin.loadBin();\n-                if(bin.needsFixing()) {\n+        for (int pid : newUnitParts) {\n+            Part part = getCampaign().getPart(pid);\n+            \n+            if (part instanceof AmmoBin) {\n+                AmmoBin bin = (AmmoBin) part;\n+                Part foundAmmo = getCampaign().findSparePart(campaignPart -> AmmoStorage.IsRightAmmo(campaignPart, (AmmoType) bin.getType()));\n+\n+                if (foundAmmo == null || (((AmmoStorage) foundAmmo).getShots() < bin.getShotsNeeded())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88756b3d1ccfd7f9984193f9069787e14ed60a3b"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2219, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}