{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NjQ0OTQ2", "number": 1419, "title": "Improve performance of purchasing parts and fix refit bug", "bodyText": "While investigating an issue where ammo could not be bought, I noticed a number of huge performance slowdowns in the Purchase Parts screen. I also found a bug w.r.t. refit ID's.\n\nCache CurrencyManager::getDefaultCurrency. This was extremely expensive and called constantly 25bed25.\nRemove text \"sanitizing\" from PartsInUse 21d2f0f.\nAdd Campaign::streamSpareParts and use it where allocating a huge ArrayList is unnecessary 51ffcd3.\nAdd Campaign::findSparePart to take a predicate to quickly find a matching part e8b0652.\nSpeed up AmmoStorage 43da701, Armor 72ce2f3, BaArmor b1c5751, ProtomekArmor c9fc5c5, and SVArmor a0ab221 bc100ad with findSparePart.\nSpeed up AmmoBin with findSparePart and streamSpareParts 18a608a. This one could use some eyes\nFix incorrect usage of reference equality of Refit ID's when value equality was intended a90d59b.\n\nThe time it takes to purchase 1000 units of AC/20 ammo by clicking 'Buy' is cut by ~70% on my desktop.\nThese commits are best viewed one by one with whitespace ignored (although I tried to minimize whitespace changes).", "createdAt": "2020-01-22T03:28:04Z", "url": "https://github.com/MegaMek/mekhq/pull/1419", "merged": true, "mergeCommit": {"oid": "517e75e44475bc0b4daa93384907c04fba662d70"}, "closed": true, "closedAt": "2020-01-24T10:19:56Z", "author": {"login": "sixlettervariables"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8rz6GAH2gAyMzY1NjQ0OTQ2OjI1YmVkMjVmODQ3YTRkZmZhZGM4NmM5MmQ2Yzg3ZTEzM2U1ZWFjMWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9YxYTAFqTM0Nzc2NjA2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "25bed25f847a4dffadc86c92d6c87e133e5eac1e", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/25bed25f847a4dffadc86c92d6c87e133e5eac1e", "committedDate": "2020-01-22T01:53:00Z", "message": "Cache default currency lookups per day"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21d2f0fc924d78794285eb22c9bc4d799b9b8f08", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/21d2f0fc924d78794285eb22c9bc4d799b9b8f08", "committedDate": "2020-01-22T01:54:50Z", "message": "Don't use expensive regexes to screen silly text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51ffcd3796fce7bdab5884b41932b4a3426465bc", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/51ffcd3796fce7bdab5884b41932b4a3426465bc", "committedDate": "2020-01-22T01:55:32Z", "message": "Stream spare parts to speed up calculations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8b06529b96c6f7a733bf88b8fea274585b95222", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/e8b06529b96c6f7a733bf88b8fea274585b95222", "committedDate": "2020-01-22T03:01:44Z", "message": "Add findSparePart utility to Campaign"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43da701c39ce3d6d85befaeca38244fa2a87e348", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/43da701c39ce3d6d85befaeca38244fa2a87e348", "committedDate": "2020-01-22T03:03:41Z", "message": "Use findSparePart in AmmoStorage::changeAmountAvailable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72ce2f34b2aaa4fd87e656f3b932ef071e96c738", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/72ce2f34b2aaa4fd87e656f3b932ef071e96c738", "committedDate": "2020-01-22T03:05:09Z", "message": "Use findSparePart in Armor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1c5751cca8a867ec7be65b965918727ad97ab34", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/b1c5751cca8a867ec7be65b965918727ad97ab34", "committedDate": "2020-01-22T03:06:19Z", "message": "Use findSparePart in BaArmor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9fc5c5ca898770a035030757e8baf5329b32323", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/c9fc5c5ca898770a035030757e8baf5329b32323", "committedDate": "2020-01-22T03:07:08Z", "message": "Use findSparePart in ProtomekArmor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0ab2215187faf9790824a6b14760fac3018484f", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/a0ab2215187faf9790824a6b14760fac3018484f", "committedDate": "2020-01-22T03:07:32Z", "message": "Use findSparePart in SVArmor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18a608a389edbd640afc20366e7125fe1fc187d0", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/18a608a389edbd640afc20366e7125fe1fc187d0", "committedDate": "2020-01-22T03:08:42Z", "message": "Use findSparePart and streamSpareParts in AmmoBin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a90d59b4c68d4044ebbd2e025a4d8eb894f03d5c", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/a90d59b4c68d4044ebbd2e025a4d8eb894f03d5c", "committedDate": "2020-01-22T03:12:05Z", "message": "Fix comparisons of refit ID in armor and refits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc100adad5646cef4d05a1dccacd692b4f30636a", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/bc100adad5646cef4d05a1dccacd692b4f30636a", "committedDate": "2020-01-22T03:19:42Z", "message": "Add missing check to SVArmor::changeAmountAvailable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2MzQyMzA1", "url": "https://github.com/MegaMek/mekhq/pull/1419#pullrequestreview-346342305", "createdAt": "2020-01-22T04:41:00Z", "commit": {"oid": "bc100adad5646cef4d05a1dccacd692b4f30636a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwNDo0MTowMFrOFgQZbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQwNDo0MTowMFrOFgQZbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM2NzQwNA==", "bodyText": "Nice idea saving the currency for the day!", "url": "https://github.com/MegaMek/mekhq/pull/1419#discussion_r369367404", "createdAt": "2020-01-22T04:41:00Z", "author": {"login": "VicenteCartas"}, "path": "MekHQ/src/mekhq/campaign/finances/CurrencyManager.java", "diffHunk": "@@ -116,17 +120,26 @@ MoneyFormatter getUiAmountAndNamePrinter() {\n         return this.uiAmountAndNamePrinter;\n     }\n \n-    Currency getDefaultCurrency() {\n-        if (campaign != null) {\n-            HashMap<String, Currency> possibleCurrencies = new HashMap<>();\n+    synchronized Currency getDefaultCurrency() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc100adad5646cef4d05a1dccacd692b4f30636a"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NDA5ODc2", "url": "https://github.com/MegaMek/mekhq/pull/1419#pullrequestreview-347409876", "createdAt": "2020-01-23T15:56:20Z", "commit": {"oid": "bc100adad5646cef4d05a1dccacd692b4f30636a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNTo1NjoyMFrOFhDbjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNTo1Nzo1M1rOFhDfYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIwMzUzMw==", "bodyText": "What happens if the user moves around between systems (e.g. using gm move?) We probably want to invalidate the cached value in that case as well.", "url": "https://github.com/MegaMek/mekhq/pull/1419#discussion_r370203533", "createdAt": "2020-01-23T15:56:20Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/finances/CurrencyManager.java", "diffHunk": "@@ -116,17 +120,26 @@ MoneyFormatter getUiAmountAndNamePrinter() {\n         return this.uiAmountAndNamePrinter;\n     }\n \n-    Currency getDefaultCurrency() {\n-        if (campaign != null) {\n-            HashMap<String, Currency> possibleCurrencies = new HashMap<>();\n+    synchronized Currency getDefaultCurrency() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM2NzQwNA=="}, "originalCommit": {"oid": "bc100adad5646cef4d05a1dccacd692b4f30636a"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIwNDUxNA==", "bodyText": "lol", "url": "https://github.com/MegaMek/mekhq/pull/1419#discussion_r370204514", "createdAt": "2020-01-23T15:57:53Z", "author": {"login": "NickAragua"}, "path": "MekHQ/src/mekhq/campaign/parts/PartInUse.java", "diffHunk": "@@ -1,17 +1,13 @@\n package mekhq.campaign.parts;\n \n import java.util.Objects;\n-import java.util.regex.Pattern;\n \n import megamek.common.AmmoType;\n import mekhq.campaign.finances.Money;\n import mekhq.campaign.unit.Unit;\n import mekhq.campaign.work.IAcquisitionWork;\n \n public class PartInUse {\n-    private static final Pattern cleanUp1 = Pattern.compile(\"\\\\d+\\\\shit\\\\(s\\\\),\\\\s\"); //$NON-NLS-1$", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc100adad5646cef4d05a1dccacd692b4f30636a"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e0d633ac94f78f5b0c16cd949acf2e42abbc02c", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/8e0d633ac94f78f5b0c16cd949acf2e42abbc02c", "committedDate": "2020-01-24T05:36:32Z", "message": "Invalidate default currency if campaign system changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "284a7434f2f2e6d82ac47645080f2c53ac82453b", "author": {"user": {"login": "sixlettervariables", "name": "Christopher Watford"}}, "url": "https://github.com/MegaMek/mekhq/commit/284a7434f2f2e6d82ac47645080f2c53ac82453b", "committedDate": "2020-01-24T05:45:47Z", "message": "Omit repair details from PartInUse\n\n- Add new overload for IPartWork::getDetails to\noptionally include repair details."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NzY2MDYy", "url": "https://github.com/MegaMek/mekhq/pull/1419#pullrequestreview-347766062", "createdAt": "2020-01-24T06:15:58Z", "commit": {"oid": "284a7434f2f2e6d82ac47645080f2c53ac82453b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4434, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}