{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4MzQyODI5", "number": 1627, "title": "PersonnelTableModel: GM Menu Only Shows for GMs", "bodyText": "To Review: This one my IDE played around with the formatting, so I'll add comments for the areas that are actually changed.\nThe changes are moving the GM-only pregnancy methods to be in the GM Menu, switching add pregnancy to use the standard requirements, and hiding the GM Menu for non-GMs.", "createdAt": "2020-04-03T19:18:01Z", "url": "https://github.com/MegaMek/mekhq/pull/1627", "merged": true, "mergeCommit": {"oid": "bdd84f3e361045e8d8e2b75d80c5edfba38d63a2"}, "closed": true, "closedAt": "2020-04-04T18:19:09Z", "author": {"login": "Windchild292"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUFD7ZgH2gAyMzk4MzQyODI5OmRkMjI3ZjRmNDUxNDgxOTgwN2ZkOTE5YTQzN2M5MzM3OTJiYzU4N2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUZqo3AFqTM4NzcyMjM1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dd227f4f4514819807fd919a437c933792bc587f", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/dd227f4f4514819807fd919a437c933792bc587f", "committedDate": "2020-04-03T18:18:23Z", "message": "Creating a proper GM menu in PersonnelTableMouseAdapter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6b34d0906f0d29b8d9117aef96180c889050b67", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/b6b34d0906f0d29b8d9117aef96180c889050b67", "committedDate": "2020-04-03T18:18:50Z", "message": "Adding canProcreate function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8db6cc0a6bd0a1e3d2b15bdb467a4530162a2d3", "author": {"user": {"login": "Windchild292", "name": "Justin Bowen"}}, "url": "https://github.com/MegaMek/mekhq/commit/e8db6cc0a6bd0a1e3d2b15bdb467a4530162a2d3", "committedDate": "2020-04-03T18:28:09Z", "message": "Fixing the menu that add/remove pregnancy are on"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NTU3ODcw", "url": "https://github.com/MegaMek/mekhq/pull/1627#pullrequestreview-387557870", "createdAt": "2020-04-03T20:25:26Z", "commit": {"oid": "e8db6cc0a6bd0a1e3d2b15bdb467a4530162a2d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDoyNToyN1rOGAn5ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDoyNToyN1rOGAn5ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwNjk0Nw==", "bodyText": "Change: removed pregnancy from here", "url": "https://github.com/MegaMek/mekhq/pull/1627#discussion_r403306947", "createdAt": "2020-04-03T20:25:27Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/adapter/PersonnelTableMouseAdapter.java", "diffHunk": "@@ -1671,22 +1671,7 @@ private void maybeShowPopup(MouseEvent e) {\n             cbMenuItem.setActionCommand(makeCommand(CMD_REMOVE_UNIT, \"-1\")); //$NON-NLS-1$\n             cbMenuItem.addActionListener(this);\n             menu.add(cbMenuItem);\n-            if (oneSelected) {\n-                if (!person.isChild() && (person.isFemale()) && !person.isPregnant()) {\n-                    menuItem = new JMenuItem(resourceMap.getString(\"addPregnancy.text\")); //$NON-NLS-1$\n-                    menuItem.setActionCommand(CMD_ADD_PREGNANCY);\n-                    menuItem.addActionListener(this);\n-                    menuItem.setEnabled(gui.getCampaign().isGM());\n-                    popup.add(menuItem);\n-                }\n-                if (person.isPregnant()) {\n-                    menuItem = new JMenuItem(resourceMap.getString(\"removePregnancy.text\")); //$NON-NLS-1$\n-                    menuItem.setActionCommand(CMD_REMOVE_PREGNANCY);\n-                    menuItem.addActionListener(this);\n-                    menuItem.setEnabled(gui.getCampaign().isGM());\n-                    popup.add(menuItem);\n-                }\n-            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8db6cc0a6bd0a1e3d2b15bdb467a4530162a2d3"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NTU4MzQ4", "url": "https://github.com/MegaMek/mekhq/pull/1627#pullrequestreview-387558348", "createdAt": "2020-04-03T20:26:17Z", "commit": {"oid": "e8db6cc0a6bd0a1e3d2b15bdb467a4530162a2d3"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDoyNjoxN1rOGAn8OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDoyNzoxNVrOGAn_Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwNzU3Nw==", "bodyText": "Change, only add the GM menu if you are a GM", "url": "https://github.com/MegaMek/mekhq/pull/1627#discussion_r403307577", "createdAt": "2020-04-03T20:26:17Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/adapter/PersonnelTableMouseAdapter.java", "diffHunk": "@@ -2492,108 +2501,125 @@ private void maybeShowPopup(MouseEvent e) {\n             menuItem.addActionListener(ev -> gui.miExportPersonActionPerformed(ev));\n             menuItem.setEnabled(true);\n             popup.add(menuItem);\n+\n             if (gui.getCampaign().getCampaignOptions().getUseAtB()\n                     && StaticChecks.areAllActive(selected)) {\n                 menuItem = new JMenuItem(resourceMap.getString(\"sack.text\")); //$NON-NLS-1$\n                 menuItem.setActionCommand(CMD_SACK);\n                 menuItem.addActionListener(this);\n                 popup.add(menuItem);\n             }\n-            menu = new JMenu(resourceMap.getString(\"gmMode.text\")); //$NON-NLS-1$\n-\n-            menuItem = new JMenu(resourceMap.getString(\"changePrisonerStatus.text\")); //$NON-NLS-1$\n-            menuItem.add(newCheckboxMenu(\n-                    Person.getPrisonerStatusName(Person.PRISONER_NOT),\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_FREE),\n-                    person.getPrisonerStatus() == Person.PRISONER_NOT));\n-            menuItem.add(newCheckboxMenu(\n-                    Person.getPrisonerStatusName(Person.PRISONER_YES),\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_IMPRISONED),\n-                    (person.getPrisonerStatus() == Person.PRISONER_YES) && !person.isWillingToDefect()));\n-            menuItem.add(newCheckboxMenu(\n-                    resourceMap.getString(\"prisonerWillingToDefect.text\"), //$NON-NLS-1$\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_IMPRISONED_DEFECTING),\n-                    (person.getPrisonerStatus() == Person.PRISONER_YES) && person.isWillingToDefect()));\n-            menuItem.add(newCheckboxMenu(\n-                    Person.getPrisonerStatusName(Person.PRISONER_BONDSMAN),\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_BONDSMAN),\n-                    person.getPrisonerStatus() == Person.PRISONER_BONDSMAN));\n-            menuItem.setEnabled(gui.getCampaign().isGM());\n-            menu.add(menuItem);\n-\n-            menuItem = new JMenuItem(resourceMap.getString(\"removePerson.text\")); //$NON-NLS-1$\n-            menuItem.setActionCommand(CMD_REMOVE);\n-            menuItem.addActionListener(this);\n-            menuItem.setEnabled(gui.getCampaign().isGM());\n-            menu.add(menuItem);\n-            if (!gui.getCampaign().getCampaignOptions().useAdvancedMedical()) {\n-                menuItem = new JMenuItem(resourceMap.getString(\"editHits.text\")); //$NON-NLS-1$\n-                menuItem.setActionCommand(CMD_EDIT_HITS);\n+\n+            //region GM Menu\n+            if (gui.getCampaign().isGM()) {\n+                popup.addSeparator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8db6cc0a6bd0a1e3d2b15bdb467a4530162a2d3"}, "originalPosition": 419}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwODMzOA==", "bodyText": "Moved procreation to here", "url": "https://github.com/MegaMek/mekhq/pull/1627#discussion_r403308338", "createdAt": "2020-04-03T20:27:15Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/gui/adapter/PersonnelTableMouseAdapter.java", "diffHunk": "@@ -2492,108 +2501,125 @@ private void maybeShowPopup(MouseEvent e) {\n             menuItem.addActionListener(ev -> gui.miExportPersonActionPerformed(ev));\n             menuItem.setEnabled(true);\n             popup.add(menuItem);\n+\n             if (gui.getCampaign().getCampaignOptions().getUseAtB()\n                     && StaticChecks.areAllActive(selected)) {\n                 menuItem = new JMenuItem(resourceMap.getString(\"sack.text\")); //$NON-NLS-1$\n                 menuItem.setActionCommand(CMD_SACK);\n                 menuItem.addActionListener(this);\n                 popup.add(menuItem);\n             }\n-            menu = new JMenu(resourceMap.getString(\"gmMode.text\")); //$NON-NLS-1$\n-\n-            menuItem = new JMenu(resourceMap.getString(\"changePrisonerStatus.text\")); //$NON-NLS-1$\n-            menuItem.add(newCheckboxMenu(\n-                    Person.getPrisonerStatusName(Person.PRISONER_NOT),\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_FREE),\n-                    person.getPrisonerStatus() == Person.PRISONER_NOT));\n-            menuItem.add(newCheckboxMenu(\n-                    Person.getPrisonerStatusName(Person.PRISONER_YES),\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_IMPRISONED),\n-                    (person.getPrisonerStatus() == Person.PRISONER_YES) && !person.isWillingToDefect()));\n-            menuItem.add(newCheckboxMenu(\n-                    resourceMap.getString(\"prisonerWillingToDefect.text\"), //$NON-NLS-1$\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_IMPRISONED_DEFECTING),\n-                    (person.getPrisonerStatus() == Person.PRISONER_YES) && person.isWillingToDefect()));\n-            menuItem.add(newCheckboxMenu(\n-                    Person.getPrisonerStatusName(Person.PRISONER_BONDSMAN),\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_BONDSMAN),\n-                    person.getPrisonerStatus() == Person.PRISONER_BONDSMAN));\n-            menuItem.setEnabled(gui.getCampaign().isGM());\n-            menu.add(menuItem);\n-\n-            menuItem = new JMenuItem(resourceMap.getString(\"removePerson.text\")); //$NON-NLS-1$\n-            menuItem.setActionCommand(CMD_REMOVE);\n-            menuItem.addActionListener(this);\n-            menuItem.setEnabled(gui.getCampaign().isGM());\n-            menu.add(menuItem);\n-            if (!gui.getCampaign().getCampaignOptions().useAdvancedMedical()) {\n-                menuItem = new JMenuItem(resourceMap.getString(\"editHits.text\")); //$NON-NLS-1$\n-                menuItem.setActionCommand(CMD_EDIT_HITS);\n+\n+            //region GM Menu\n+            if (gui.getCampaign().isGM()) {\n+                popup.addSeparator();\n+\n+                menu = new JMenu(resourceMap.getString(\"gmMode.text\")); //$NON-NLS-1$\n+\n+                menuItem = new JMenu(resourceMap.getString(\"changePrisonerStatus.text\")); //$NON-NLS-1$\n+                menuItem.add(newCheckboxMenu(\n+                        Person.getPrisonerStatusName(Person.PRISONER_NOT),\n+                        makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_FREE),\n+                        person.getPrisonerStatus() == Person.PRISONER_NOT));\n+                menuItem.add(newCheckboxMenu(\n+                        Person.getPrisonerStatusName(Person.PRISONER_YES),\n+                        makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_IMPRISONED),\n+                        (person.getPrisonerStatus() == Person.PRISONER_YES) && !person.isWillingToDefect()));\n+                menuItem.add(newCheckboxMenu(\n+                        resourceMap.getString(\"prisonerWillingToDefect.text\"), //$NON-NLS-1$\n+                        makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_IMPRISONED_DEFECTING),\n+                        (person.getPrisonerStatus() == Person.PRISONER_YES) && person.isWillingToDefect()));\n+                menuItem.add(newCheckboxMenu(\n+                        Person.getPrisonerStatusName(Person.PRISONER_BONDSMAN),\n+                        makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_BONDSMAN),\n+                        person.getPrisonerStatus() == Person.PRISONER_BONDSMAN));\n+                menu.add(menuItem);\n+\n+                menuItem = new JMenuItem(resourceMap.getString(\"removePerson.text\")); //$NON-NLS-1$\n+                menuItem.setActionCommand(CMD_REMOVE);\n                 menuItem.addActionListener(this);\n-                menuItem.setEnabled(gui.getCampaign().isGM());\n                 menu.add(menuItem);\n-            }\n-            menuItem = new JMenuItem(resourceMap.getString(\"add1XP.text\")); //$NON-NLS-1$\n-            menuItem.setActionCommand(CMD_ADD_1_XP);\n-            menuItem.addActionListener(this);\n-            menuItem.setEnabled(gui.getCampaign().isGM());\n-            menu.add(menuItem);\n-            menuItem = new JMenuItem(resourceMap.getString(\"addXP.text\")); //$NON-NLS-1$\n-            menuItem.setActionCommand(CMD_ADD_XP);\n-            menuItem.addActionListener(this);\n-            menuItem.setEnabled(gui.getCampaign().isGM());\n-            menu.add(menuItem);\n-            menuItem = new JMenuItem(resourceMap.getString(\"setXP.text\")); //$NON-NLS-1$\n-            menuItem.setActionCommand(CMD_SET_XP);\n-            menuItem.addActionListener(this);\n-            menuItem.setEnabled(gui.getCampaign().isGM());\n-            menu.add(menuItem);\n-            if (gui.getCampaign().getCampaignOptions().useEdge()) {\n-                menuItem = new JMenuItem(resourceMap.getString(\"setEdge.text\")); //$NON-NLS-1$\n-                menuItem.setActionCommand(CMD_SET_EDGE);\n+\n+                if (!gui.getCampaign().getCampaignOptions().useAdvancedMedical()) {\n+                    menuItem = new JMenuItem(resourceMap.getString(\"editHits.text\")); //$NON-NLS-1$\n+                    menuItem.setActionCommand(CMD_EDIT_HITS);\n+                    menuItem.addActionListener(this);\n+                    menu.add(menuItem);\n+                }\n+\n+                menuItem = new JMenuItem(resourceMap.getString(\"add1XP.text\")); //$NON-NLS-1$\n+                menuItem.setActionCommand(CMD_ADD_1_XP);\n                 menuItem.addActionListener(this);\n-                menuItem.setEnabled(gui.getCampaign().isGM());\n                 menu.add(menuItem);\n-            }\n-            if (oneSelected) {\n-                menuItem = new JMenuItem(resourceMap.getString(\"edit.text\")); //$NON-NLS-1$\n-                menuItem.setActionCommand(CMD_EDIT);\n+\n+                menuItem = new JMenuItem(resourceMap.getString(\"addXP.text\")); //$NON-NLS-1$\n+                menuItem.setActionCommand(CMD_ADD_XP);\n                 menuItem.addActionListener(this);\n-                menuItem.setEnabled(gui.getCampaign().isGM());\n                 menu.add(menuItem);\n \n-                if (null == person.getUnitId()) {\n-                    menuItem = new JMenuItem(resourceMap.getString(\"rollForUnit.text\")); //$NON-NLS-1$\n-                    menuItem.setActionCommand(CMD_ROLL_MECH);\n+                menuItem = new JMenuItem(resourceMap.getString(\"setXP.text\")); //$NON-NLS-1$\n+                menuItem.setActionCommand(CMD_SET_XP);\n+                menuItem.addActionListener(this);\n+                menu.add(menuItem);\n+\n+                if (gui.getCampaign().getCampaignOptions().useEdge()) {\n+                    menuItem = new JMenuItem(resourceMap.getString(\"setEdge.text\")); //$NON-NLS-1$\n+                    menuItem.setActionCommand(CMD_SET_EDGE);\n                     menuItem.addActionListener(this);\n-                    menuItem.setEnabled(gui.getCampaign().isGM());\n                     menu.add(menuItem);\n                 }\n-            }\n-            if (gui.getCampaign().getCampaignOptions().useAdvancedMedical()) {\n-                menuItem = new JMenuItem(resourceMap.getString(\"removeAllInjuries.text\")); //$NON-NLS-1$\n-                menuItem.setActionCommand(CMD_CLEAR_INJURIES);\n-                menuItem.addActionListener(this);\n-                menuItem.setEnabled(gui.getCampaign().isGM());\n-                menu.add(menuItem);\n+\n                 if (oneSelected) {\n-                    for (Injury i : person.getInjuries()) {\n-                        menuItem = new JMenuItem(String.format(resourceMap.getString(\"removeInjury.format\"), i.getName())); //$NON-NLS-1$\n-                        menuItem.setActionCommand(makeCommand(CMD_REMOVE_INJURY, i.getUUID().toString()));\n+                    menuItem = new JMenuItem(resourceMap.getString(\"edit.text\")); //$NON-NLS-1$\n+                    menuItem.setActionCommand(CMD_EDIT);\n+                    menuItem.addActionListener(this);\n+                    menu.add(menuItem);\n+\n+                    if (person.getUnitId() == null) {\n+                        menuItem = new JMenuItem(resourceMap.getString(\"rollForUnit.text\")); //$NON-NLS-1$\n+                        menuItem.setActionCommand(CMD_ROLL_MECH);\n                         menuItem.addActionListener(this);\n-                        menuItem.setEnabled(gui.getCampaign().isGM());\n                         menu.add(menuItem);\n                     }\n-\n-                    menuItem = new JMenuItem(resourceMap.getString(\"editInjuries.text\")); //$NON-NLS-1$\n-                    menuItem.setActionCommand(CMD_EDIT_INJURIES);\n+                }\n+                if (gui.getCampaign().getCampaignOptions().useAdvancedMedical()) {\n+                    menuItem = new JMenuItem(resourceMap.getString(\"removeAllInjuries.text\")); //$NON-NLS-1$\n+                    menuItem.setActionCommand(CMD_CLEAR_INJURIES);\n                     menuItem.addActionListener(this);\n-                    menuItem.setEnabled(gui.getCampaign().isGM());\n                     menu.add(menuItem);\n+\n+                    if (oneSelected) {\n+                        for (Injury i : person.getInjuries()) {\n+                            menuItem = new JMenuItem(String.format(resourceMap.getString(\"removeInjury.format\"), i.getName())); //$NON-NLS-1$\n+                            menuItem.setActionCommand(makeCommand(CMD_REMOVE_INJURY, i.getUUID().toString()));\n+                            menuItem.addActionListener(this);\n+                            menu.add(menuItem);\n+                        }\n+\n+                        menuItem = new JMenuItem(resourceMap.getString(\"editInjuries.text\")); //$NON-NLS-1$\n+                        menuItem.setActionCommand(CMD_EDIT_INJURIES);\n+                        menuItem.addActionListener(this);\n+                        menu.add(menuItem);\n+                    }\n                 }\n+\n+                if (oneSelected) {\n+                    if (person.canProcreate()) {\n+                        menuItem = new JMenuItem(resourceMap.getString(\"addPregnancy.text\"));\n+                        menuItem.setActionCommand(CMD_ADD_PREGNANCY);\n+                        menuItem.addActionListener(this);\n+                        menu.add(menuItem);\n+                    } else if (person.isPregnant()) {\n+                        menuItem = new JMenuItem(resourceMap.getString(\"removePregnancy.text\"));\n+                        menuItem.setActionCommand(CMD_REMOVE_PREGNANCY);\n+                        menuItem.addActionListener(this);\n+                        menu.add(menuItem);\n+                    }\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8db6cc0a6bd0a1e3d2b15bdb467a4530162a2d3"}, "originalPosition": 567}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NzIyMzU0", "url": "https://github.com/MegaMek/mekhq/pull/1627#pullrequestreview-387722354", "createdAt": "2020-04-04T18:18:46Z", "commit": {"oid": "e8db6cc0a6bd0a1e3d2b15bdb467a4530162a2d3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4357, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}