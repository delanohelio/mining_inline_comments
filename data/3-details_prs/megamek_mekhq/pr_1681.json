{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NTIzMzY2", "number": 1681, "title": "Change refit model weight calculation to work with BA", "bodyText": "Fixes an undocumented bug where the available refit dialog won't appear due to an index out of bounds exception. This happens when refitting squads that have models with different numbers of troopers, such as IS/WoB versions of the Phalanx.", "createdAt": "2020-04-18T16:22:27Z", "url": "https://github.com/MegaMek/mekhq/pull/1681", "merged": true, "mergeCommit": {"oid": "11ad073225089d2f89557ab60f55fdcb02108741"}, "closed": true, "closedAt": "2020-04-19T00:57:09Z", "author": {"login": "mkerensky"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcY4WLDAH2gAyNDA1NTIzMzY2OmQyODVjZDJjNzY1Y2JiZWM4NTQ4NjA4NzFkNjZiMGY4MjEzN2M1MDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcY91wBgFqTM5NTk1NzMxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d285cd2c765cbbec854860871d66b0f82137c500", "author": {"user": null}, "url": "https://github.com/MegaMek/mekhq/commit/d285cd2c765cbbec854860871d66b0f82137c500", "committedDate": "2020-04-18T16:19:10Z", "message": "Change refit model weight calculation to work with BA"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77d1dd2adb72fc003e225bea2ed57483a703f52e", "author": {"user": null}, "url": "https://github.com/MegaMek/mekhq/commit/77d1dd2adb72fc003e225bea2ed57483a703f52e", "committedDate": "2020-04-18T16:24:03Z", "message": "Change order of weight test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1OTI4Mjgz", "url": "https://github.com/MegaMek/mekhq/pull/1681#pullrequestreview-395928283", "createdAt": "2020-04-18T16:23:52Z", "commit": {"oid": "d285cd2c765cbbec854860871d66b0f82137c500"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQxNjoyMzo1MlrOGHsRHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQxNjoyNzo0M1rOGHsSmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcxODQ5NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if (((BattleArmor)en).getTroopers() != (int) summary.getTWweight()) {\n          \n          \n            \n                            if (((BattleArmor) en).getTroopers() != (int) summary.getTWweight()) {", "url": "https://github.com/MegaMek/mekhq/pull/1681#discussion_r410718494", "createdAt": "2020-04-18T16:23:52Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/Utilities.java", "diffHunk": "@@ -369,17 +369,29 @@ public static File lastFileModified(String dir, FilenameFilter filter) {\n         CampaignOptions options = campaign.getCampaignOptions();\n         ArrayList<String> variants = new ArrayList<>();\n         for(MechSummary summary : MechSummaryCache.getInstance().getAllMechs()) {\n-            // If this isn't the same chassis, is our current unit, or is a different weight we continue\n-            if(!en.getChassis().equalsIgnoreCase(summary.getChassis())\n+            // If this isn't the same chassis, is our current unit, we continue\n+            if (!en.getChassis().equalsIgnoreCase(summary.getChassis())\n                     || en.getModel().equalsIgnoreCase(summary.getModel())\n-                    || summary.getTons() != en.getWeight()\n                     || !summary.getUnitType().equals(UnitType.determineUnitType(en))) {\n                 continue;\n             }\n             // If we only allow canon units and this isn't canon we continue\n-            if(!summary.isCanon() && options.allowCanonRefitOnly()) {\n+            if (!summary.isCanon() && options.allowCanonRefitOnly()) {\n                 continue;\n             }\n+            \n+            // Weight of the two units must match or we continue, but BA weight gets\n+            // checked differently\n+            if (en instanceof BattleArmor) {\n+                if (((BattleArmor)en).getTroopers() != (int) summary.getTWweight()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d285cd2c765cbbec854860871d66b0f82137c500"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcxODc3Ng==", "bodyText": "Can we swap this to use UnitType.getTypeName(e.getUnitType()), as the current method is deprecated.", "url": "https://github.com/MegaMek/mekhq/pull/1681#discussion_r410718776", "createdAt": "2020-04-18T16:26:34Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/Utilities.java", "diffHunk": "@@ -369,17 +369,30 @@ public static File lastFileModified(String dir, FilenameFilter filter) {\n         CampaignOptions options = campaign.getCampaignOptions();\n         ArrayList<String> variants = new ArrayList<>();\n         for(MechSummary summary : MechSummaryCache.getInstance().getAllMechs()) {\n-            // If this isn't the same chassis, is our current unit, or is a different weight we continue\n-            if(!en.getChassis().equalsIgnoreCase(summary.getChassis())\n+            // If this isn't the same chassis, is our current unit, we continue\n+            if (!en.getChassis().equalsIgnoreCase(summary.getChassis())\n                     || en.getModel().equalsIgnoreCase(summary.getModel())\n-                    || summary.getTons() != en.getWeight()\n                     || !summary.getUnitType().equals(UnitType.determineUnitType(en))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77d1dd2adb72fc003e225bea2ed57483a703f52e"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcxODg3Mg==", "bodyText": "Also, should this be based on the ADVANCED_TACOPS_BA_WEIGHT option?", "url": "https://github.com/MegaMek/mekhq/pull/1681#discussion_r410718872", "createdAt": "2020-04-18T16:27:43Z", "author": {"login": "Windchild292"}, "path": "MekHQ/src/mekhq/Utilities.java", "diffHunk": "@@ -369,17 +369,29 @@ public static File lastFileModified(String dir, FilenameFilter filter) {\n         CampaignOptions options = campaign.getCampaignOptions();\n         ArrayList<String> variants = new ArrayList<>();\n         for(MechSummary summary : MechSummaryCache.getInstance().getAllMechs()) {\n-            // If this isn't the same chassis, is our current unit, or is a different weight we continue\n-            if(!en.getChassis().equalsIgnoreCase(summary.getChassis())\n+            // If this isn't the same chassis, is our current unit, we continue\n+            if (!en.getChassis().equalsIgnoreCase(summary.getChassis())\n                     || en.getModel().equalsIgnoreCase(summary.getModel())\n-                    || summary.getTons() != en.getWeight()\n                     || !summary.getUnitType().equals(UnitType.determineUnitType(en))) {\n                 continue;\n             }\n             // If we only allow canon units and this isn't canon we continue\n-            if(!summary.isCanon() && options.allowCanonRefitOnly()) {\n+            if (!summary.isCanon() && options.allowCanonRefitOnly()) {\n                 continue;\n             }\n+            \n+            // Weight of the two units must match or we continue, but BA weight gets\n+            // checked differently\n+            if (en instanceof BattleArmor) {\n+                if (((BattleArmor)en).getTroopers() != (int) summary.getTWweight()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcxODQ5NA=="}, "originalCommit": {"oid": "d285cd2c765cbbec854860871d66b0f82137c500"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42ce134ca0628e384f34445d268884a6e99a3928", "author": {"user": null}, "url": "https://github.com/MegaMek/mekhq/commit/42ce134ca0628e384f34445d268884a6e99a3928", "committedDate": "2020-04-18T18:07:38Z", "message": "Implement 1st round change requests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1OTU3MzEw", "url": "https://github.com/MegaMek/mekhq/pull/1681#pullrequestreview-395957310", "createdAt": "2020-04-18T22:43:11Z", "commit": {"oid": "42ce134ca0628e384f34445d268884a6e99a3928"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4393, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}