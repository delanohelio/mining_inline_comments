{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0NDUwMzUy", "number": 983, "title": "Vsam integration tests", "bodyText": "This PR adds caching service integration tests which are independent of each other and tests the vulnerabilities that the multiple retrieval method had with regards to user name.\nIt also splits the VSAM to read and write mode usage .\nThe @Retryable mechanic is present but not tested, will be done in subsequent PR\nThis build is built successfully on internal pipeline", "createdAt": "2020-12-08T13:26:53Z", "url": "https://github.com/zowe/api-layer/pull/983", "merged": true, "mergeCommit": {"oid": "714228a7f7e72716969f8cdcc04209aa6aa7e9ae"}, "closed": true, "closedAt": "2020-12-11T12:23:12Z", "author": {"login": "jandadav"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkKHKbgH2gAyNTM0NDUwMzUyOjk4Y2E1MzM0MTBhM2FkZGM3ZDFlODdlMzdkMzVkZTlmMDNlMzM4NGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlG2ehAH2gAyNTM0NDUwMzUyOmZmYjZkNDIzYjAxZmUyOGZjNmUwYmRmYTRjZWQ2ZmJiNmFkNDk2NGM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "98ca533410a3addc7d1e87e37d35de9f03e3384d", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/98ca533410a3addc7d1e87e37d35de9f03e3384d", "committedDate": "2020-12-08T13:25:23Z", "message": "refactor of vsam classes\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "013bb8e64673c83ba33a0d0dc358f5eed83c515d", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/013bb8e64673c83ba33a0d0dc358f5eed83c515d", "committedDate": "2020-12-08T13:36:41Z", "message": "fix\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "192fc3217b46ab371626eeb7c4c6378481e0414c", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/192fc3217b46ab371626eeb7c4c6378481e0414c", "committedDate": "2020-12-09T09:21:16Z", "message": "retry\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c68afe55ac858a074c3066b2b74f36b63a20e4a", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/0c68afe55ac858a074c3066b2b74f36b63a20e4a", "committedDate": "2020-12-09T10:54:16Z", "message": "add aop\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3802dfaf1bbb79eb1b68145727ee4c81eb8acf6d", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/3802dfaf1bbb79eb1b68145727ee4c81eb8acf6d", "committedDate": "2020-12-10T13:23:40Z", "message": "working serial integration tests\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "944c681eb0a8901d750f0e995cec78855bd09f98", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/944c681eb0a8901d750f0e995cec78855bd09f98", "committedDate": "2020-12-10T14:55:05Z", "message": "cleanup\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3c3ef89e6348d03b27326ab9ff24035549efd3a", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/e3c3ef89e6348d03b27326ab9ff24035549efd3a", "committedDate": "2020-12-10T14:56:13Z", "message": "Merge branch 'master' into rip/GH863/concurrent-zfile-usage-merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcc1889a2fbef1c08b75420737a1089fcf44e83a", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/bcc1889a2fbef1c08b75420737a1089fcf44e83a", "committedDate": "2020-12-10T15:12:24Z", "message": "fix nullpointer\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5OTAwNzkw", "url": "https://github.com/zowe/api-layer/pull/983#pullrequestreview-549900790", "createdAt": "2020-12-11T08:45:06Z", "commit": {"oid": "bcc1889a2fbef1c08b75420737a1089fcf44e83a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwODo0NTowNlrOIDus8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwODo0NTowNlrOIDus8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc4MTgxMA==", "bodyText": "Maybe add a comment if it is intentionally empty?", "url": "https://github.com/zowe/api-layer/pull/983#discussion_r540781810", "createdAt": "2020-12-11T08:45:06Z", "author": {"login": "balhar-jakub"}, "path": "caching-service/src/main/java/org/zowe/apiml/caching/service/vsam/VsamFile.java", "diffHunk": "@@ -17,31 +17,59 @@\n import org.zowe.apiml.zfile.*;\n \n import java.io.Closeable;\n+import java.io.UnsupportedEncodingException;\n+import java.util.*;\n import java.util.regex.Pattern;\n \n /**\n  * ZFile wrapper providing convenience methods and implementing Closeable interface\n- *\n- * Creates a proxy of com.ibm.jzos.ZFileException and wraps it's methods\n- *\n+ * This class is intended for serialized access to VSAM file.\n+ * Concurrency is to be handled by retrying.\n+ * Creates a proxy of com.ibm.jzos.ZFileException and provides high level methods for CRUD operations\n  */\n \n @Slf4j\n-public class VsamFile implements Closeable, ZFile {\n+public class VsamFile implements Closeable {\n \n     private ZFile zfile;\n     private VsamConfig vsamConfig;\n-    private String options = \"ab+,type=record\";\n+    private final VsamConfig.VsamOptions options;\n+\n+    public static final String VSAM_RECORD_ERROR_MESSAGE = \"VsamRecordException occured: {}\";\n+    public static final String RECORD_FOUND_MESSAGE = \"Record found: {}\";\n+    public static final String UNSUPPORTED_ENCODING_MESSAGE = \"Unsupported encoding: {}\";\n+\n     private static final Pattern REGEX_CORRECT_FILENAME = Pattern.compile(\"^\\\\/\\\\/\\\\'.*'\");\n \n-    public VsamFile(VsamConfig config) {\n+    public VsamFile(VsamConfig config, VsamConfig.VsamOptions options) {\n+        this(config, options, false);\n+    }\n+\n+    public VsamFile(VsamConfig config, VsamConfig.VsamOptions options, boolean performWarmup) {\n         if (config == null) {\n             throw new IllegalArgumentException(\"Cannot create VsamFile with null configuration\");\n         }\n+\n         this.vsamConfig = config;\n+        this.options = options;\n+        log.info(\"VsamFile::new with parameters: {}, Vsam options: {}\", this.vsamConfig, this.options);\n+\n+        if (!REGEX_CORRECT_FILENAME.matcher(vsamConfig.getFileName()).find()) {\n+            throw new IllegalArgumentException(\"VsamFile name does not conform to //'VSAM.DATASET.NAME' pattern\");\n+        }\n+\n         try {\n             this.zfile = openZfile();\n-        } catch (ZFileException e) {\n+\n+            if (performWarmup) {\n+                log.info(\"Warming up VSAM file\");\n+                warmUpVsamFile();\n+            } else {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcc1889a2fbef1c08b75420737a1089fcf44e83a"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f307af284e2dd3237e1dba602e249469b18a47b8", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/f307af284e2dd3237e1dba602e249469b18a47b8", "committedDate": "2020-12-11T09:04:43Z", "message": "remove redundant else and sonar\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd647aea2f1c66434231d7d4fa7dda4329874161", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/bd647aea2f1c66434231d7d4fa7dda4329874161", "committedDate": "2020-12-11T09:14:55Z", "message": "disable js coverage\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5OTI0ODcy", "url": "https://github.com/zowe/api-layer/pull/983#pullrequestreview-549924872", "createdAt": "2020-12-11T09:18:53Z", "commit": {"oid": "bcc1889a2fbef1c08b75420737a1089fcf44e83a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ab9949807f66f7585d90f7eb919d9de46fccd3a", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/6ab9949807f66f7585d90f7eb919d9de46fccd3a", "committedDate": "2020-12-11T09:45:12Z", "message": "Add mock zosmf users\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f753c2d163327db184806091f0e8b74d5b5bcae8", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/f753c2d163327db184806091f0e8b74d5b5bcae8", "committedDate": "2020-12-11T09:50:09Z", "message": "jenkinsfile error fix\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea7269d038f44c8f9424156e0c3811588d18768e", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/ea7269d038f44c8f9424156e0c3811588d18768e", "committedDate": "2020-12-11T10:05:41Z", "message": "jenkinsfile disable archiving UI test resutlts\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4fbe8a33609db316c2d1bcea8d2922ebf41ef2d", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/e4fbe8a33609db316c2d1bcea8d2922ebf41ef2d", "committedDate": "2020-12-11T10:18:53Z", "message": "jenkinsfile disable archiving UI test resutlts\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0daec76dbb8f9737db649bd813f7a8ec2c379fd", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/a0daec76dbb8f9737db649bd813f7a8ec2c379fd", "committedDate": "2020-12-11T12:10:05Z", "message": "Merge branch 'master' into rip/GH863/concurrent-zfile-usage-merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffb6d423b01fe28fc6e0bdfa4ced6fbb6ad4964c", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/ffb6d423b01fe28fc6e0bdfa4ced6fbb6ad4964c", "committedDate": "2020-12-11T12:11:22Z", "message": "reintroduce js coverage\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4787, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}