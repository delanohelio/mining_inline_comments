{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNjUzMTA1", "number": 1025, "title": "Expressions and dummy implementation of SAF resource check", "bodyText": "This PR adds the feature to define the checking of SAF resource from Spring security expression language. It contains just the dummy implementation. SAF resources could be defined via YML files. Other implementation (SAF using JZOS and endpoint, ie. ZSS) will be in the next PRs.\nFixes # (issue)\nType of change\nPlease delete options that are not relevant.\n\n New feature (non-breaking change which adds functionality)\n This change requires a documentation update (as separated PR with all implementation)\n\nChecklist:\n\n My code follows the style guidelines of this project\n I have performed a self-review of my own code\n I have commented my code, particularly in hard-to-understand areas\n My changes generate no new warnings\n I have added tests that prove my fix is effective or that my feature works\n New and existing unit tests pass locally with my changes\n\nFor more details about how should the code look like read the Contributing guideline", "createdAt": "2020-12-18T16:36:37Z", "url": "https://github.com/zowe/api-layer/pull/1025", "merged": true, "mergeCommit": {"oid": "766a0aed0b7676a90a75af0fd89f3ec171c0f79a"}, "closed": true, "closedAt": "2020-12-22T23:15:24Z", "author": {"login": "pj892031"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnamdIgH2gAyNTQyNjUzMTA1Ojg0MTViY2MzZGNlNTBmMTY2NmNlM2UzYWJkNWYwNjY4MjljNzZjNWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoypSCgH2gAyNTQyNjUzMTA1OmU1NDY5NzNhMWFkMTM2MTViYzViY2RkNzlmNGY0MjFhOWFkNGExYzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8415bcc3dce50f1666ce3e3abd5f066829c76c5b", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/8415bcc3dce50f1666ce3e3abd5f066829c76c5b", "committedDate": "2020-12-18T16:19:49Z", "message": "expressions and dummy implementation\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2876abcc3c42c250da0e70a9ca8fc0e2380b069", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/f2876abcc3c42c250da0e70a9ca8fc0e2380b069", "committedDate": "2020-12-18T16:58:59Z", "message": "Sonar fixes\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2MzEwMjQz", "url": "https://github.com/zowe/api-layer/pull/1025#pullrequestreview-556310243", "createdAt": "2020-12-21T11:24:11Z", "commit": {"oid": "f2876abcc3c42c250da0e70a9ca8fc0e2380b069"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxMToyNDoxMVrOIJVCQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxMToyNDoyM1rOIJVCgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY1MjczOA==", "bodyText": "Logger will be used?", "url": "https://github.com/zowe/api-layer/pull/1025#discussion_r546652738", "createdAt": "2020-12-21T11:24:11Z", "author": {"login": "achmelo"}, "path": "apiml-security-common/src/main/java/org/zowe/apiml/security/common/auth/saf/SafResourceAccessConfig.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ * This program and the accompanying materials are made available under the terms of the\n+ * Eclipse Public License v2.0 which accompanies this distribution, and is available at\n+ * https://www.eclipse.org/legal/epl-v20.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Copyright Contributors to the Zowe Project.\n+ */\n+package org.zowe.apiml.security.common.auth.saf;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+import java.io.IOException;\n+\n+@Configuration\n+@Slf4j\n+public class SafResourceAccessConfig {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2876abcc3c42c250da0e70a9ca8fc0e2380b069"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY1Mjc3NA==", "bodyText": "could be a conditional bean? but can be done in the next PR, once another implementation is available", "url": "https://github.com/zowe/api-layer/pull/1025#discussion_r546652774", "createdAt": "2020-12-21T11:24:17Z", "author": {"login": "achmelo"}, "path": "apiml-security-common/src/main/java/org/zowe/apiml/security/common/auth/saf/SafResourceAccessConfig.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ * This program and the accompanying materials are made available under the terms of the\n+ * Eclipse Public License v2.0 which accompanies this distribution, and is available at\n+ * https://www.eclipse.org/legal/epl-v20.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Copyright Contributors to the Zowe Project.\n+ */\n+package org.zowe.apiml.security.common.auth.saf;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+import java.io.IOException;\n+\n+@Configuration\n+@Slf4j\n+public class SafResourceAccessConfig {\n+\n+    @Bean\n+    public SafResourceAccessVerifying safResourceAccessVerifying() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2876abcc3c42c250da0e70a9ca8fc0e2380b069"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY1MjgwMg==", "bodyText": "Could you please add some comment or rename the load and set methods so we better know what they are doing. For future maintenance.", "url": "https://github.com/zowe/api-layer/pull/1025#discussion_r546652802", "createdAt": "2020-12-21T11:24:23Z", "author": {"login": "achmelo"}, "path": "apiml-security-common/src/main/java/org/zowe/apiml/security/common/auth/saf/SafResourceAccessDummy.java", "diffHunk": "@@ -0,0 +1,125 @@\n+/*\n+ * This program and the accompanying materials are made available under the terms of the\n+ * Eclipse Public License v2.0 which accompanies this distribution, and is available at\n+ * https://www.eclipse.org/legal/epl-v20.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Copyright Contributors to the Zowe Project.\n+ */\n+package org.zowe.apiml.security.common.auth.saf;\n+\n+import lombok.Builder;\n+import lombok.Value;\n+import org.springframework.security.core.Authentication;\n+import org.yaml.snakeyaml.Yaml;\n+\n+import java.io.*;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class SafResourceAccessDummy implements SafResourceAccessVerifying {\n+\n+    private static final String SAF_ACCESS = \"safAccess\";\n+    private static final String DEFAULT_FILE_LOCATION = \"saf.yml\";\n+    private static final String DEFAULT_RESOURCE_LOCATION = \"mock-saf.yml\";\n+\n+    private Map<ResourceUser, AccessLevel> resourceUserToAccessLevel = new HashMap<>();\n+\n+    public SafResourceAccessDummy() throws IOException {\n+        File file = getFile();\n+        if (file.exists()) {\n+            try (\n+                FileInputStream fis = new FileInputStream(file);\n+                BufferedInputStream bis = new BufferedInputStream(fis)\n+            ) {\n+                load(bis);\n+            }\n+        } else {\n+            try (InputStream inputStream = this.getClass().getClassLoader().getResourceAsStream(DEFAULT_RESOURCE_LOCATION)) {\n+                load(inputStream);\n+            }\n+        }\n+    }\n+\n+    protected File getFile() {\n+        return new File(DEFAULT_FILE_LOCATION);\n+    }\n+\n+    public SafResourceAccessDummy(InputStream inputStream) {\n+        load(inputStream);\n+    }\n+\n+    @Override\n+    public boolean hasSafResourceAccess(Authentication authentication, String resourceClass, String resourceName, String accessLevel) {\n+        ResourceUser resourceUser = ResourceUser.builder()\n+            .resourceClass(resourceClass)\n+            .resourceName(resourceName)\n+            .userId(authentication.getName())\n+            .build();\n+        AccessLevel currentLevel = resourceUserToAccessLevel.get(resourceUser);\n+        if (currentLevel == null) return false;\n+        return currentLevel.compareTo(AccessLevel.valueOf(accessLevel)) >= 0;\n+    }\n+\n+    private void load(InputStream inputStream) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2876abcc3c42c250da0e70a9ca8fc0e2380b069"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc8d08d0d91c619d0d3f7cfe5f9862e45e620081", "author": {"user": {"login": "achmelo", "name": null}}, "url": "https://github.com/zowe/api-layer/commit/cc8d08d0d91c619d0d3f7cfe5f9862e45e620081", "committedDate": "2020-12-22T08:47:12Z", "message": "Merge branch 'master' into protectors/safHasResourceSecurityExpression"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e33318ce4dd7b1f49760b595047c072567cf63f", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/4e33318ce4dd7b1f49760b595047c072567cf63f", "committedDate": "2020-12-22T11:32:55Z", "message": "fix by code review\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d6889715171100309d736eb5e228559dc484889", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/5d6889715171100309d736eb5e228559dc484889", "committedDate": "2020-12-22T14:04:03Z", "message": "Merge branch 'master' into protectors/safHasResourceSecurityExpression"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MTQzNDkx", "url": "https://github.com/zowe/api-layer/pull/1025#pullrequestreview-557143491", "createdAt": "2020-12-22T15:02:10Z", "commit": {"oid": "5d6889715171100309d736eb5e228559dc484889"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e546973a1ad13615bc5bcdd79f4f421a9ad4a1c3", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/e546973a1ad13615bc5bcdd79f4f421a9ad4a1c3", "committedDate": "2020-12-22T22:54:33Z", "message": "Merge branch 'master' into protectors/safHasResourceSecurityExpression"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4796, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}