{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNDg0NDE5", "number": 596, "title": "Fix throughput via ZUUL with bypass authentication scheme", "bodyText": "This PR fixes the authentication scheme bypass. It contains:\n\nIf the original request is signed, request to service is signed too.\nDon't verify JWT globally. JWT is verified only if the authentication scheme required that.\nImplemented verifying of the certificate. Before PR all signed requests were authenticated (if the certificate could be verified by Zowe APIML truststore). The new version allows authenticating only with Zowe APIML server certificate (other certificates are removed).", "createdAt": "2020-04-07T20:25:21Z", "url": "https://github.com/zowe/api-layer/pull/596", "merged": true, "mergeCommit": {"oid": "3b0d8cea9639e58362ef70d5b1d45d9ff2f4d9a7"}, "closed": true, "closedAt": "2020-04-09T13:09:52Z", "author": {"login": "pj892031"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTqznXAH2gAyNDAwNDg0NDE5OmY5OTNiYzI1N2MyZmFkY2NlZjZjNzU2MDI0ZjQwNWQzY2JkYzFlOWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcV7tkkAFqTM5MDc0OTMyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f993bc257c2fadccef6c756024f405d3cbdc1e9b", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/f993bc257c2fadccef6c756024f405d3cbdc1e9b", "committedDate": "2020-04-02T11:43:02Z", "message": "draft of implementation\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73206d05c061131a536086661b43fd2893e3b672", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/73206d05c061131a536086661b43fd2893e3b672", "committedDate": "2020-04-07T20:20:57Z", "message": "fix discoverable client and integration test, filter sign by certificates to use only APIML certificate\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f8c8bb86adff3d36ed7b9192284f5c1e066aa91", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/5f8c8bb86adff3d36ed7b9192284f5c1e066aa91", "committedDate": "2020-04-07T20:33:19Z", "message": "Merge remote-tracking branch 'remotes/origin/master' into protectors/zuulThroughput\n\n# Conflicts:\n#\tgateway-service/src/main/java/org/zowe/apiml/gateway/filters/pre/JwtValidatorFilter.java\n#\tgateway-service/src/main/java/org/zowe/apiml/gateway/routing/ApimlRoutingConfig.java\n#\tgateway-service/src/test/java/org/zowe/apiml/gateway/filters/pre/JwtValidatorFilterTest.java\n#\tgateway-service/src/test/java/org/zowe/apiml/gateway/security/service/schema/HttpBasicPassTicketSchemeTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3901dcfc34a62c4ea22986691142876bca49f7f9", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/3901dcfc34a62c4ea22986691142876bca49f7f9", "committedDate": "2020-04-07T20:42:01Z", "message": "fix test after merge\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d96ce359b3747acc29134348f29db94e5b37eb8", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/5d96ce359b3747acc29134348f29db94e5b37eb8", "committedDate": "2020-04-08T10:05:08Z", "message": "fix integration tests\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e68bc40a6447a1a37d37a517205761e3e82ee0f", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/1e68bc40a6447a1a37d37a517205761e3e82ee0f", "committedDate": "2020-04-08T10:22:31Z", "message": "Merge branch 'master' into protectors/zuulThroughput"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "309b10d606f268e0581a0226310fc853f11413c6", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/309b10d606f268e0581a0226310fc853f11413c6", "committedDate": "2020-04-08T10:26:40Z", "message": "fix merge (imports)\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b059d1c3e436bef87c598399eb73078906890b7", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/8b059d1c3e436bef87c598399eb73078906890b7", "committedDate": "2020-04-08T13:05:40Z", "message": "fix integration tests\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4efdc9885ce58cfb2e59d4375905ce109deb8cac", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/4efdc9885ce58cfb2e59d4375905ce109deb8cac", "committedDate": "2020-04-08T16:01:08Z", "message": "code coverage improve\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0af776381f269f91c2f5bfec66cdac9b2b708c47", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/0af776381f269f91c2f5bfec66cdac9b2b708c47", "committedDate": "2020-04-08T17:07:31Z", "message": "fix integration tests\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d17dfc6414864d4e2661d956541c1afd20200ea9", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/d17dfc6414864d4e2661d956541c1afd20200ea9", "committedDate": "2020-04-08T20:43:33Z", "message": "fix integration test - revert status on accessServiceWithIncorrectApplId\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNTM1MDA4", "url": "https://github.com/zowe/api-layer/pull/596#pullrequestreview-390535008", "createdAt": "2020-04-09T06:59:30Z", "commit": {"oid": "d17dfc6414864d4e2661d956541c1afd20200ea9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNjo1OTozMFrOGDL83A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNjo1OTozMFrOGDL83A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk5NDcxNg==", "bodyText": "What is the current message if not ZWAG102E?", "url": "https://github.com/zowe/api-layer/pull/596#discussion_r405994716", "createdAt": "2020-04-09T06:59:30Z", "author": {"login": "plavjanik"}, "path": "integration-tests/src/test/java/org/zowe/apiml/gatewayservice/ZosmfSsoIntegrationTest.java", "diffHunk": "@@ -126,9 +126,7 @@ public void doZosmfCallWithInvalidToken() {\n         .when()\n             .get(String.format(\"%s://%s:%d%s%s\", scheme, host, port, BASE_PATH, ZOSMF_ENDPOINT))\n         .then()\n-            .statusCode(is(SC_UNAUTHORIZED))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d17dfc6414864d4e2661d956541c1afd20200ea9"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNTY3OTMy", "url": "https://github.com/zowe/api-layer/pull/596#pullrequestreview-390567932", "createdAt": "2020-04-09T07:55:44Z", "commit": {"oid": "d17dfc6414864d4e2661d956541c1afd20200ea9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNzo1NTo0NFrOGDNnYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQwNzo1NTo0NFrOGDNnYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjAyMTk4NQ==", "bodyText": "What is the purpose of this regex?", "url": "https://github.com/zowe/api-layer/pull/596#discussion_r406021985", "createdAt": "2020-04-09T07:55:44Z", "author": {"login": "plavjanik"}, "path": "gateway-service/src/main/java/org/zowe/apiml/gateway/security/config/SecurityConfiguration.java", "diffHunk": "@@ -92,7 +96,10 @@ protected void configure(HttpSecurity http) throws Exception {\n             .authorizeRequests()\n             .antMatchers(HttpMethod.POST, authConfigurationProperties.getGatewayTicketEndpoint()).authenticated()\n             .and()\n-            .x509().userDetailsService(x509UserDetailsService())\n+            .x509()\n+                .x509AuthenticationFilter(apimlX509AuthenticationFilter())\n+                .subjectPrincipalRegex(\"CN=(.*?)(?:,|$)\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d17dfc6414864d4e2661d956541c1afd20200ea9"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fd21de167bbf3507ad2a599800db86eaa7d4ac9", "author": {"user": {"login": "pj892031", "name": "Pavel Jare\u0161"}}, "url": "https://github.com/zowe/api-layer/commit/7fd21de167bbf3507ad2a599800db86eaa7d4ac9", "committedDate": "2020-04-09T08:15:20Z", "message": "fix code smells\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNTg3NjEz", "url": "https://github.com/zowe/api-layer/pull/596#pullrequestreview-390587613", "createdAt": "2020-04-09T08:24:37Z", "commit": {"oid": "7fd21de167bbf3507ad2a599800db86eaa7d4ac9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzQ5MzI4", "url": "https://github.com/zowe/api-layer/pull/596#pullrequestreview-390749328", "createdAt": "2020-04-09T12:32:40Z", "commit": {"oid": "7fd21de167bbf3507ad2a599800db86eaa7d4ac9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4947, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}