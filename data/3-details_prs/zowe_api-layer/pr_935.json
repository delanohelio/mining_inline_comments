{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MjczOTk2", "number": 935, "title": "Zaas client enhancements", "bodyText": "Description\n\nAdds overloaded query method to ZaasClient interface to take an HttpServletRequest object and retrieve the jwt token from cookie or auth header\nThe above function already existed in the GW AuthenticationService code, so this code was moved to apiml-common to avoid repetition and avoid unneeded security filtering in apiml-security-common.\nZaasJwtService was improved to throw more appropriate error codes based on the errors when querying the token.\n\nNote that when a token is mangled OR expired, an invalid token message is thrown, as there is no way to distinguish which case happened based on the 401 response from the GW.\nFixes # 897\nType of change\nPlease delete options that are not relevant.\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Breaking change (fix or feature that would cause existing functionality to not work as expected)\n This change requires a documentation update\n\nChecklist:\n\n My code follows the style guidelines of this project\n I have performed a self-review of my own code\n I have commented my code, particularly in hard-to-understand areas\n I have made corresponding changes to the documentation\n My changes generate no new warnings\n I have added tests that prove my fix is effective or that my feature works\n New and existing unit tests pass locally with my changes\n\nFor more details about how should the code look like read the Contributing guideline", "createdAt": "2020-11-19T22:27:35Z", "url": "https://github.com/zowe/api-layer/pull/935", "merged": true, "mergeCommit": {"oid": "0b9563ac510c88f6cd733a6e936a9582a7050fd4"}, "closed": true, "closedAt": "2020-11-24T13:46:32Z", "author": {"login": "CarsonCook"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdd0jkOgH2gAyNTI0MjczOTk2Ojg5NDZiMmEzN2EzZmEzMGJlYWI0OTE4NGVkMDcyOTQ5Mjc2NGE2MjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfptx-AH2gAyNTI0MjczOTk2OmQxZDVlZjUzYmNkNDBlNmZjZjk2ZjU4MjNhYzdlODgwM2ExNTI4OWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8946b2a37a3fa30beab49184ed0729492764a620", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/8946b2a37a3fa30beab49184ed0729492764a620", "committedDate": "2020-11-18T20:54:57Z", "message": "Move get jwt from request to apiml security common\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb7ccf8dde79d584bec5c942b0719b745300d1be", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/eb7ccf8dde79d584bec5c942b0719b745300d1be", "committedDate": "2020-11-18T21:11:54Z", "message": "Add apiml security common dependency to zaas client\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22a71190326a3ef019f13dbc1efa93b55f97807a", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/22a71190326a3ef019f13dbc1efa93b55f97807a", "committedDate": "2020-11-18T22:08:47Z", "message": "Implement get jwt from request in query\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e0d3a23933e241890f153667d8995b8d82f7746", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/1e0d3a23933e241890f153667d8995b8d82f7746", "committedDate": "2020-11-19T16:32:56Z", "message": "Add unit tests\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c432b1323f9741f199b461062b03d89b80bb632e", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/c432b1323f9741f199b461062b03d89b80bb632e", "committedDate": "2020-11-19T16:47:39Z", "message": "Merge branch 'master' of github.com:zowe/api-layer into carsoncook/gh897/zaasEnhancements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57c9b0e7d26e79d09ed2c32b0bbcba4a1c7060f3", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/57c9b0e7d26e79d09ed2c32b0bbcba4a1c7060f3", "committedDate": "2020-11-19T17:31:59Z", "message": "Move TokenUtils to common service to avoid login filters\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "205ca64925cbb9b579969bef3e19521c646c49fd", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/205ca64925cbb9b579969bef3e19521c646c49fd", "committedDate": "2020-11-19T21:07:48Z", "message": "Improve error responses\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94ed48a7952d35a7b37f5a9262dd53f5c45a5866", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/94ed48a7952d35a7b37f5a9262dd53f5c45a5866", "committedDate": "2020-11-19T22:08:40Z", "message": "Mock static function for zaas unit tests\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16007eb3c5b76cd5589adda0236ab17da34705dd", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/16007eb3c5b76cd5589adda0236ab17da34705dd", "committedDate": "2020-11-19T22:11:54Z", "message": "Improve error message for invalid token\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a546e0688a269c0125f9d1f33c0ddf9b97f738bd", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/a546e0688a269c0125f9d1f33c0ddf9b97f738bd", "committedDate": "2020-11-19T22:19:50Z", "message": "Add documentation:\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MTgyMTU1", "url": "https://github.com/zowe/api-layer/pull/935#pullrequestreview-535182155", "createdAt": "2020-11-20T07:51:41Z", "commit": {"oid": "a546e0688a269c0125f9d1f33c0ddf9b97f738bd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MjA1Njg5", "url": "https://github.com/zowe/api-layer/pull/935#pullrequestreview-535205689", "createdAt": "2020-11-20T08:21:40Z", "commit": {"oid": "a546e0688a269c0125f9d1f33c0ddf9b97f738bd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwODoyMzo0NlrOH3FKXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwODoyMzo0NlrOH3FKXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzUxODMwMQ==", "bodyText": "I am sorry that this is not written somewhere, but it's something relevant. A bit of history: We used to publish a library that was security-client-spring which offered shared spring security classes, and basically all of zaas client's functionality. It was dependend on other libraries from our project. The outcome was that it was not easy for consumers to include because 1) it dragged a lot of dependencies and 2) our use of component scan made it difficult to even build. And that's why zaas-client was created. To provide a simple client with minimal dependencies for extenders to consume without need to worry about depending on anything from api-layer. In the light of this fact, the inclusion of apiml-common goes against that principle. I totally get the desire to use shared code, but if we want to isolate this module, I think it's ok to accept some degree of code duplication.", "url": "https://github.com/zowe/api-layer/pull/935#discussion_r527518301", "createdAt": "2020-11-20T08:23:46Z", "author": {"login": "jandadav"}, "path": "zaas-client/build.gradle", "diffHunk": "@@ -1,13 +1,18 @@\n dependencies {\n+    implementation project(':apiml-common')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "235d5fecac2befafa8fab84199585519d5570391"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1a9a69094be52cfe2542e1a7ef3240fb5b61521", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/c1a9a69094be52cfe2542e1a7ef3240fb5b61521", "committedDate": "2020-11-23T13:18:44Z", "message": "Merge branch 'master' of github.com:zowe/api-layer into carsoncook/gh897/zaasEnhancements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cac5b03c9dec027e1263e8e893c592e25e09f78", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/5cac5b03c9dec027e1263e8e893c592e25e09f78", "committedDate": "2020-11-23T13:34:55Z", "message": "Fix code smells\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8afb27ab81f9e2a3ab496a76a44c1150fad2e50", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/d8afb27ab81f9e2a3ab496a76a44c1150fad2e50", "committedDate": "2020-11-23T14:59:42Z", "message": "Remove zaas depedency on apiml-common\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43e5f3c32dc6b6d79d4868947b4d0b277489b8d2", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/43e5f3c32dc6b6d79d4868947b4d0b277489b8d2", "committedDate": "2020-11-23T15:26:29Z", "message": "Remove DC secure off flags\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "235d5fecac2befafa8fab84199585519d5570391", "author": {"user": {"login": "balhar-jakub", "name": "Jakub Balhar"}}, "url": "https://github.com/zowe/api-layer/commit/235d5fecac2befafa8fab84199585519d5570391", "committedDate": "2020-11-20T07:51:47Z", "message": "Merge branch 'master' into carsoncook/gh897/zaasEnhancements"}, "afterCommit": {"oid": "43e5f3c32dc6b6d79d4868947b4d0b277489b8d2", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/43e5f3c32dc6b6d79d4868947b4d0b277489b8d2", "committedDate": "2020-11-23T15:26:29Z", "message": "Remove DC secure off flags\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddc1521b051fd8b22fa20c09a7668e16c95fcde7", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/ddc1521b051fd8b22fa20c09a7668e16c95fcde7", "committedDate": "2020-11-23T16:21:07Z", "message": "Fix code smell\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8f747d6007ca6b2104195e9f536b18d9c6a710c", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/e8f747d6007ca6b2104195e9f536b18d9c6a710c", "committedDate": "2020-11-23T18:42:00Z", "message": "Remove problem dependency\n\nSigned-off-by: Carson Cook <carson.cook@ibm.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3MTQzODcz", "url": "https://github.com/zowe/api-layer/pull/935#pullrequestreview-537143873", "createdAt": "2020-11-24T07:35:00Z", "commit": {"oid": "e8f747d6007ca6b2104195e9f536b18d9c6a710c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1d5ef53bcd40e6fcf96f5823ac7e8803a15289b", "author": {"user": {"login": "CarsonCook", "name": "Carson Cook"}}, "url": "https://github.com/zowe/api-layer/commit/d1d5ef53bcd40e6fcf96f5823ac7e8803a15289b", "committedDate": "2020-11-24T13:25:00Z", "message": "Merge branch 'master' into carsoncook/gh897/zaasEnhancements"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4779, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}