{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0NjQyNTAy", "number": 805, "title": "Improve performance of query endpoint and ZAAS client", "bodyText": "Description\nImprove performance of query endpoint and ZAAS client\nThe ZAAS client had query performance measured on SDK sample including ZAAS client around 700ms. With heavy load, we measured a performance degradation up to 10x (7s per request)\nAfter the fix, with heavy load, the requests take around 300ms and do not scale with load\nType of change\nPlease delete options that are not relevant.\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Breaking change (fix or feature that would cause existing functionality to not work as expected)\n This change requires a documentation update", "createdAt": "2020-08-27T11:41:31Z", "url": "https://github.com/zowe/api-layer/pull/805", "merged": true, "mergeCommit": {"oid": "8e96c590bf29b6aeff52022bb9db372575e0d562"}, "closed": true, "closedAt": "2020-08-27T13:58:32Z", "author": {"login": "jandadav"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdC_CyigH2gAyNDc0NjQyNTAyOjgyYTA1NWZmOTAxN2E3OTA5ZWY4MzU2NzUyMWFiODg2NTczYWJkZTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDA12zAFqTQ3Njc0Nzc5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "82a055ff9017a7909ef83567521ab886573abde7", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/82a055ff9017a7909ef83567521ab886573abde7", "committedDate": "2020-08-27T11:52:09Z", "message": "leverage caching effectively\nthis fixes a cache miss\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "025351768cc310c1b379e9abd6e0d58cb0e7e17d", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/025351768cc310c1b379e9abd6e0d58cb0e7e17d", "committedDate": "2020-08-27T11:52:09Z", "message": "Reuse HttpClients\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8315ed005e2505cd86333d2246673cbd8e48ca2c", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/8315ed005e2505cd86333d2246673cbd8e48ca2c", "committedDate": "2020-08-27T09:15:16Z", "message": "Reuse HttpClients\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}, "afterCommit": {"oid": "025351768cc310c1b379e9abd6e0d58cb0e7e17d", "author": {"user": {"login": "jandadav", "name": "David Janda"}}, "url": "https://github.com/zowe/api-layer/commit/025351768cc310c1b379e9abd6e0d58cb0e7e17d", "committedDate": "2020-08-27T11:52:09Z", "message": "Reuse HttpClients\n\nSigned-off-by: jandadav <janda.david@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NzI3ODQ2", "url": "https://github.com/zowe/api-layer/pull/805#pullrequestreview-476727846", "createdAt": "2020-08-27T13:37:11Z", "commit": {"oid": "025351768cc310c1b379e9abd6e0d58cb0e7e17d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxMzozNzoxMVrOHIQu1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxMzozNzoxMVrOHIQu1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQyNDc4OQ==", "bodyText": "There is a TODO left. Beside that, it looks fine", "url": "https://github.com/zowe/api-layer/pull/805#discussion_r478424789", "createdAt": "2020-08-27T13:37:11Z", "author": {"login": "taban03"}, "path": "zaas-client/src/main/java/org/zowe/apiml/zaasclient/service/internal/HttpsClientProvider.java", "diffHunk": "@@ -58,30 +63,30 @@ public HttpsClientProvider(ConfigProperties configProperties) throws ZaasConfigu\n     }\n \n     @Override\n-    public CloseableHttpClient getHttpsClientWithTrustStore() throws ZaasConfigurationException {\n-        return sharedHttpClientConfiguration(getSSLContext())\n-            .build();\n-    }\n-\n-    @Override\n-    public CloseableHttpClient getHttpsClientWithTrustStore(BasicCookieStore cookieStore) throws ZaasConfigurationException {\n-        return sharedHttpClientConfiguration(getSSLContext())\n-            .setDefaultCookieStore(cookieStore)\n-            .build();\n+    public synchronized CloseableHttpClient getHttpsClientWithTrustStore() throws ZaasConfigurationException {\n+        if (httpsClientWithTruststore == null) {\n+            httpsClientWithTruststore = sharedHttpClientConfiguration(getSSLContext())\n+                .build();\n+        }\n+        return httpsClientWithTruststore;\n     }\n \n+    //TODO how is this working compared to the other method to get the client?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "025351768cc310c1b379e9abd6e0d58cb0e7e17d"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NzQ3Nzk2", "url": "https://github.com/zowe/api-layer/pull/805#pullrequestreview-476747796", "createdAt": "2020-08-27T13:57:50Z", "commit": {"oid": "025351768cc310c1b379e9abd6e0d58cb0e7e17d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4830, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}