{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MTQzOTY4", "number": 575, "title": "Use ZosmfServiceV2 only if the authentication endpoint exists", "bodyText": "The z/OSMF provides /zosmf/services/authenticate only if the JWT support is activated even on the latest version.\nThe code is changed to use ZosmfServiceV2 only when the endpoint is available.\nReported by @jackjia-ibm: https://openmainframeproject.slack.com/archives/CC5UUL005/p1585348336019100\nSigned-off-by: Petr Plavjanik plavjanik@gmail.com", "createdAt": "2020-03-28T19:39:22Z", "url": "https://github.com/zowe/api-layer/pull/575", "merged": true, "mergeCommit": {"oid": "63b8013597feb77c6fc5ac63c0b893585e5fd957"}, "closed": true, "closedAt": "2020-03-30T09:06:05Z", "author": {"login": "plavjanik"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSKjVjAH2gAyMzk1MTQzOTY4OjdjZmJiZDBlODNjNDkzNTgwZTcxOGY0YmM4MWQ4Nzk1MmQ4ZDA3YWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSqqgzAFqTM4MzY1NTY5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7cfbbd0e83c493580e718f4bc81d87952d8d07ae", "author": {"user": {"login": "plavjanik", "name": "Petr Plavjanik"}}, "url": "https://github.com/zowe/api-layer/commit/7cfbbd0e83c493580e718f4bc81d87952d8d07ae", "committedDate": "2020-03-28T19:34:22Z", "message": "Use ZosmfServiceV2 only if the authentication endpoint exists\n\nSigned-off-by: Petr Plavjanik <plavjanik@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzQ5MDcw", "url": "https://github.com/zowe/api-layer/pull/575#pullrequestreview-383349070", "createdAt": "2020-03-28T20:58:45Z", "commit": {"oid": "7cfbbd0e83c493580e718f4bc81d87952d8d07ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQyMDo1ODo0NVrOF9MSig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQyMDo1ODo0NVrOF9MSig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcwODgxMA==", "bodyText": "This was necessary to make it work on March 28 before the daylight savings time changed.", "url": "https://github.com/zowe/api-layer/pull/575#discussion_r399708810", "createdAt": "2020-03-28T20:58:45Z", "author": {"login": "plavjanik"}, "path": "gateway-service/src/test/java/org/zowe/apiml/gateway/security/service/AuthenticationServiceTest.java", "diffHunk": "@@ -208,7 +208,7 @@ public void shouldParseJwtTokenAsQueryResponse() {\n         assertEquals(DOMAIN, parsedToken.getDomain());\n         assertEquals(USER, parsedToken.getUserId());\n         assertEquals(parsedToken.getCreation().toString().substring(0, 16), dateNow);\n-        Date toBeExpired = DateUtils.addDays(parsedToken.getCreation(), 1);\n+        Date toBeExpired = DateUtils.addHours(parsedToken.getCreation(), 24);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cfbbd0e83c493580e718f4bc81d87952d8d07ae"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNTY1NjEy", "url": "https://github.com/zowe/api-layer/pull/575#pullrequestreview-383565612", "createdAt": "2020-03-30T06:40:41Z", "commit": {"oid": "7cfbbd0e83c493580e718f4bc81d87952d8d07ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwNjo0MDo0MlrOF9beow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwNjo0MDo0MlrOF9beow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1NzY2Nw==", "bodyText": "I would still use dummy for local development.", "url": "https://github.com/zowe/api-layer/pull/575#discussion_r399957667", "createdAt": "2020-03-30T06:40:42Z", "author": {"login": "JirkaAichler"}, "path": "config/local/gateway-service.yml", "diffHunk": "@@ -8,12 +8,12 @@ apiml:\n         discoveryServiceUrls: https://localhost:10011/eureka/\n     security:\n         auth:\n-            provider: dummy", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cfbbd0e83c493580e718f4bc81d87952d8d07ae"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNTY1NzQ1", "url": "https://github.com/zowe/api-layer/pull/575#pullrequestreview-383565745", "createdAt": "2020-03-30T06:40:59Z", "commit": {"oid": "7cfbbd0e83c493580e718f4bc81d87952d8d07ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwNjo0MDo1OVrOF9bfDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwNjo0MDo1OVrOF9bfDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk1Nzc3NA==", "bodyText": "Why false?", "url": "https://github.com/zowe/api-layer/pull/575#discussion_r399957774", "createdAt": "2020-03-30T06:40:59Z", "author": {"login": "JirkaAichler"}, "path": "config/local/gateway-service.yml", "diffHunk": "@@ -8,12 +8,12 @@ apiml:\n         discoveryServiceUrls: https://localhost:10011/eureka/\n     security:\n         auth:\n-            provider: dummy\n+            provider: zosmf\n             zosmfServiceId: zosmf  # Replace me with the correct z/OSMF service id\n             passTicket:\n                 timeout: 360 # [s] - default timeout to expire (z/OS has 10 mins as default)\n         ssl:\n-            verifySslCertificatesOfServices: true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cfbbd0e83c493580e718f4bc81d87952d8d07ae"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "206ba535bae60f5b1d06d16c073fdccec0ddd186", "author": {"user": {"login": "plavjanik", "name": "Petr Plavjanik"}}, "url": "https://github.com/zowe/api-layer/commit/206ba535bae60f5b1d06d16c073fdccec0ddd186", "committedDate": "2020-03-30T06:53:20Z", "message": "Reverting to the better values for development"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNTc0MTgw", "url": "https://github.com/zowe/api-layer/pull/575#pullrequestreview-383574180", "createdAt": "2020-03-30T06:58:14Z", "commit": {"oid": "206ba535bae60f5b1d06d16c073fdccec0ddd186"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f537990197f3db2d859b1ce1ed7dcc5c826b17de", "author": {"user": {"login": "plavjanik", "name": "Petr Plavjanik"}}, "url": "https://github.com/zowe/api-layer/commit/f537990197f3db2d859b1ce1ed7dcc5c826b17de", "committedDate": "2020-03-30T08:23:22Z", "message": "Log potential exceptions\n\nSigned-off-by: Petr Plavjanik <plavjanik@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "188cef300af7198c8ae7c59bc956d410fbf140ac", "author": {"user": {"login": "plavjanik", "name": "Petr Plavjanik"}}, "url": "https://github.com/zowe/api-layer/commit/188cef300af7198c8ae7c59bc956d410fbf140ac", "committedDate": "2020-03-30T08:23:42Z", "message": "Merge branch 'protectors/fix-zosmf-jwt' of https://github.com/zowe/api-layer into protectors/fix-zosmf-jwt\n\nSigned-off-by: Petr Plavjanik <plavjanik@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNjQ3Njkx", "url": "https://github.com/zowe/api-layer/pull/575#pullrequestreview-383647691", "createdAt": "2020-03-30T08:48:57Z", "commit": {"oid": "188cef300af7198c8ae7c59bc956d410fbf140ac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNjU1Njk2", "url": "https://github.com/zowe/api-layer/pull/575#pullrequestreview-383655696", "createdAt": "2020-03-30T08:59:10Z", "commit": {"oid": "188cef300af7198c8ae7c59bc956d410fbf140ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwODo1OToxMFrOF9f-tA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwODo1OToxMFrOF9f-tA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAzMTQxMg==", "bodyText": "Is it reasonable expectation that the V1 will be always supported?", "url": "https://github.com/zowe/api-layer/pull/575#discussion_r400031412", "createdAt": "2020-03-30T08:59:10Z", "author": {"login": "balhar-jakub"}, "path": "gateway-service/src/main/java/org/zowe/apiml/gateway/security/service/zosmf/ZosmfServiceV1.java", "diffHunk": "@@ -89,12 +92,12 @@ public void validate(TokenType type, String token) {\n \n     @Override\n     public void invalidate(TokenType type, String token) {\n-        // not supported by z/OSMF\n+        // not supported by this version of z/OSMF\n     }\n \n     @Override\n-    public boolean matchesVersion(int version) {\n-        return version <= 25;\n+    public boolean isSupported(int version) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "188cef300af7198c8ae7c59bc956d410fbf140ac"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4932, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}