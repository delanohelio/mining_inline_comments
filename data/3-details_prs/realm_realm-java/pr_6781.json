{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxMzk0MjQw", "number": 6781, "title": "Switch to using Github Docker Registry", "bodyText": "Switches the Registry from which we download the Stitch images from AWS to Github. This removes the requirement of having access to our secret AWS credentials.\nIt also now correctly stores any relevant logs: LogCat, Command Server, MongoDB Realm and MongoDB itself.\nAfter this PR has been merged. You need to create a GitHub access token to run the integration tests. There is a HOWTO in the start_server.sh file.", "createdAt": "2020-03-20T07:46:05Z", "url": "https://github.com/realm/realm-java/pull/6781", "merged": true, "mergeCommit": {"oid": "c4c93a48c59dbb69a20eb9df7d5cc7ec4ee336b9"}, "closed": true, "closedAt": "2020-03-27T23:18:25Z", "author": {"login": "cmelchior"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPbmXGgH2gAyMzkxMzk0MjQwOjk5ZTI1NGRjNjlmMDgzOTAwNWM3MWI0NzkwNWE0MzNmNjg5ZTcwYTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRxLEbAFqTM4Mjg4MjgxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "99e254dc69f0839005c71b47905a433f689e70a4", "author": {"user": {"login": "cmelchior", "name": "Christian Melchior"}}, "url": "https://github.com/realm/realm-java/commit/99e254dc69f0839005c71b47905a433f689e70a4", "committedDate": "2020-03-20T07:44:17Z", "message": "Use GitHub Docker Registery instead of AWS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e67c31a225df3562b088abeae45eaf0a11b8aca6", "author": {"user": {"login": "cmelchior", "name": "Christian Melchior"}}, "url": "https://github.com/realm/realm-java/commit/e67c31a225df3562b088abeae45eaf0a11b8aca6", "committedDate": "2020-03-20T07:57:06Z", "message": "Add description on how to use script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3b6db0dba4097657987ab4afbeaa0ca6d9a86df", "author": {"user": {"login": "cmelchior", "name": "Christian Melchior"}}, "url": "https://github.com/realm/realm-java/commit/c3b6db0dba4097657987ab4afbeaa0ca6d9a86df", "committedDate": "2020-03-20T09:06:53Z", "message": "Store server logs. Remove references to CLI image."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5Mzg5NDIw", "url": "https://github.com/realm/realm-java/pull/6781#pullrequestreview-379389420", "createdAt": "2020-03-23T12:39:44Z", "commit": {"oid": "c3b6db0dba4097657987ab4afbeaa0ca6d9a86df"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjozOTo0NFrOF6DjQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMjozOTo0NFrOF6DjQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQxOTkwNg==", "bodyText": "Need to also use docker pull to ensure we are pulling the latest version", "url": "https://github.com/realm/realm-java/pull/6781#discussion_r396419906", "createdAt": "2020-03-23T12:39:44Z", "author": {"login": "cmelchior"}, "path": "tools/sync_test_server/start_server.sh", "diffHunk": "@@ -10,21 +31,16 @@ adb reverse tcp:9080 tcp:9080 && \\\n adb reverse tcp:9090 tcp:9090 && \\\n adb reverse tcp:8888 tcp:8888 || { echo \"Failed to reverse adb port.\" ; exit 1 ; }\n \n-# Make sure that Docker works correctly with AWS by logging in\n-DOCKER_LOGIN=$(aws ecr get-login --no-include-email)\n-eval $DOCKER_LOGIN\n-\n-# Work-around for getting latest Stich image\n-LATEST_MONGODB_REALM_VERSION=$(aws ecr describe-images --repository-name ci/mongodb-realm-images --query 'sort_by(imageDetails,& imagePushedAt)[-1].imageTags[0]' | cut -d '\"' -f 2)\n-LATEST_CLI_VERSION=\"190\"\n+# Make sure that Docker works correctly with Github Docker Registry by logging in\n+docker login docker.pkg.github.com -u $GITHUB_DOCKER_USER -p $GITHUB_DOCKER_TOKEN\n \n # Run Stitch and Stitch CLI Docker images\n docker network create mongodb-realm-network\n docker build $DOCKERFILE_DIR -t mongodb-realm-command-server || { echo \"Failed to build Docker image.\" ; exit 1 ; }\n-ID=$(docker run --rm -i -t -d --network mongodb-realm-network  -p 8888:8888 -p 9090:9090 --name mongodb-realm 012067661104.dkr.ecr.eu-west-1.amazonaws.com/ci/mongodb-realm-images:\"$LATEST_MONGODB_REALM_VERSION\")\n+ID=$(docker run --rm -i -t -d --network mongodb-realm-network -p 9090:9090 -p 8888:8888 --name mongodb-realm docker.pkg.github.com/realm/ci/mongodb-realm-test-server:latest)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3b6db0dba4097657987ab4afbeaa0ca6d9a86df"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NjIyMjA4", "url": "https://github.com/realm/realm-java/pull/6781#pullrequestreview-379622208", "createdAt": "2020-03-23T16:52:00Z", "commit": {"oid": "c3b6db0dba4097657987ab4afbeaa0ca6d9a86df"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ba6e9b9760278c69a2ad7254ba268a7d9c9ce99", "author": {"user": {"login": "cmelchior", "name": "Christian Melchior"}}, "url": "https://github.com/realm/realm-java/commit/7ba6e9b9760278c69a2ad7254ba268a7d9c9ce99", "committedDate": "2020-03-25T10:31:06Z", "message": "Use tagged version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df1c89cd8cc3e46a45450d2674258f769177d91c", "author": {"user": {"login": "cmelchior", "name": "Christian Melchior"}}, "url": "https://github.com/realm/realm-java/commit/df1c89cd8cc3e46a45450d2674258f769177d91c", "committedDate": "2020-03-25T10:50:32Z", "message": "Naming of property"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8f9f625718b973218d2f0578fce0c0cfe65daca", "author": {"user": {"login": "cmelchior", "name": "Christian Melchior"}}, "url": "https://github.com/realm/realm-java/commit/a8f9f625718b973218d2f0578fce0c0cfe65daca", "committedDate": "2020-03-25T14:44:33Z", "message": "Auto login"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyODgyODE2", "url": "https://github.com/realm/realm-java/pull/6781#pullrequestreview-382882816", "createdAt": "2020-03-27T14:00:14Z", "commit": {"oid": "a8f9f625718b973218d2f0578fce0c0cfe65daca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2457, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}