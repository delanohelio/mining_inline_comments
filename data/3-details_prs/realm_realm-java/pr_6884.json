{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0NDE2NTI4", "number": 6884, "title": "Migrating and enabling sync session integration test", "bodyText": "This migrates the sync session test to Kotlin and reenables them for the new sync.\nIssues uncovered and fixed:\n\n Partition values were not serialized correctly\n SyncConfig did not consider partitionValue when testing for equality\n Connection state listeners does not work #6909\n\nIssues uncovered but not address\n\n Realms with different partition keys do not have distinct paths #6882\n Bad changeset errors, when re-syncing the same scheme against a server after updating the partition value. Only seems to be an issue if scheme contains double (in which case the resynced type is float) or schema contains list (in which case the resynced type differs in nullability). Apparently the server does not support Double and list with nullable elements. Issues are filed on server side.\n Other ignored tests with not yet uncovered causes. Could just be a matter of erroneous test/test framework (not all tests are migrated to use BlockingLoooperThread), but needs investigation. Reasons are:\n\nNeed to clean server between tests/runs\nDoes not terminate\nRe-logging in does not authorize\nAsserts with no_session when tearing down, meaning that all session are not closed, but realm seems to be closed, so further investigation is needed", "createdAt": "2020-05-28T11:12:02Z", "url": "https://github.com/realm/realm-java/pull/6884", "merged": true, "mergeCommit": {"oid": "aa0ffc48d4e152308a6d3782187e34e0d583c274"}, "closed": true, "closedAt": "2020-06-04T18:01:26Z", "author": {"login": "rorbech"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclF8TEAH2gAyNDI0NDE2NTI4OmY2YzRkM2FmOThjNDFlYTU1MTViNTkwZDI4NzFiZGFjMTRkYTI0YTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoBsXYgH2gAyNDI0NDE2NTI4OmM4OGZmZDczMTg1MjA0MWNlNTBjM2RhNmUyYWI2NjJkZGM1MmYyMWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f6c4d3af98c41ea5515b590d2871bdac14da24a2", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/f6c4d3af98c41ea5515b590d2871bdac14da24a2", "committedDate": "2020-05-26T14:56:40Z", "message": "Move integration tests to Kotlin source set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a254cf82a57246fb212b5227b4451f2c359c3b1", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/1a254cf82a57246fb212b5227b4451f2c359c3b1", "committedDate": "2020-05-26T15:10:10Z", "message": "Automatic conversion of integration test to Kotlin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b25841a8066a08cb0d8287830626cac072bc6fce", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/b25841a8066a08cb0d8287830626cac072bc6fce", "committedDate": "2020-05-28T10:21:46Z", "message": "Fix serialization of partition values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "914fa1a79bd59f1ed07bc360e1c8c8d5bda6de4a", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/914fa1a79bd59f1ed07bc360e1c8c8d5bda6de4a", "committedDate": "2020-05-28T10:26:40Z", "message": "Revert conversion of SyncedRealmIntegrationTests to keep PR smaller"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e3a5b980c15c8d4e59d444ffd37342c618e1468", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/8e3a5b980c15c8d4e59d444ffd37342c618e1468", "committedDate": "2020-05-28T10:28:20Z", "message": "Updated SyncSessionTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b7b4c117ba4e736a6ecb8992dcbd39aa912605d", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/5b7b4c117ba4e736a6ecb8992dcbd39aa912605d", "committedDate": "2020-05-28T10:44:41Z", "message": "Add primary keys for synced classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de035639e369cb46a4ed9981ea64ff1a359b2a03", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/de035639e369cb46a4ed9981ea64ff1a359b2a03", "committedDate": "2020-05-28T10:51:35Z", "message": "Make SyncConfigurations with diffferent partitionValue differ"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d434c07b9f2695b8a119cc5c203a2af52e1917e", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/6d434c07b9f2695b8a119cc5c203a2af52e1917e", "committedDate": "2020-05-28T13:09:17Z", "message": "Revert \"Add primary keys for synced classes\"\n\nThis reverts commit 5b7b4c117ba4e736a6ecb8992dcbd39aa912605d."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbcef54eb60ae1cf41703d4b0d457de182abaf20", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/fbcef54eb60ae1cf41703d4b0d457de182abaf20", "committedDate": "2020-05-28T14:47:40Z", "message": "Add separate sync entities with primary keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5010964214cf5be6b98c9ddf4bb437b67fdb00d", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/e5010964214cf5be6b98c9ddf4bb437b67fdb00d", "committedDate": "2020-05-29T08:35:31Z", "message": "Move partition value serialization out of basic flavor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "661b2fc7a031b15b0c107d587784b39346ca089d", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/661b2fc7a031b15b0c107d587784b39346ca089d", "committedDate": "2020-05-30T21:54:52Z", "message": "Merge branch 'v10' into cr/sync-integration-test-session"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c1aa7f562f4d12dce501c54d8a15ee5e75f6a68", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/8c1aa7f562f4d12dce501c54d8a15ee5e75f6a68", "committedDate": "2020-05-30T22:10:54Z", "message": "Fix SyncConfigruation equals"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec7162dbb67e1bb6bd623576c5cb242bc7145630", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/ec7162dbb67e1bb6bd623576c5cb242bc7145630", "committedDate": "2020-06-02T20:33:00Z", "message": "Add scheme with supported types only to allow testing without bad change sets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecf475144699be5ab276332ae69b00f9bd38df87", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/ecf475144699be5ab276332ae69b00f9bd38df87", "committedDate": "2020-06-02T21:06:58Z", "message": "Clean up test cases for sync with different partition values"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMzYwNzQ0", "url": "https://github.com/realm/realm-java/pull/6884#pullrequestreview-423360744", "createdAt": "2020-06-03T09:07:03Z", "commit": {"oid": "ecf475144699be5ab276332ae69b00f9bd38df87"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdb01a370ef66d9791de15e7c45e3552ff94e5ac", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/bdb01a370ef66d9791de15e7c45e3552ff94e5ac", "committedDate": "2020-06-03T11:16:17Z", "message": "Merge branch 'v10' into cr/sync-integration-test-session\n\n# Conflicts:\n#\trealm/realm-library/build.gradle\n#\trealm/realm-library/src/objectServer/java/io/realm/internal/SyncObjectServerFacade.java\n#\trealm/realm-library/src/objectServer/java/io/realm/mongodb/sync/SyncConfiguration.java\n#\trealm/realm-library/src/syncTestUtils/kotlin/io/realm/TestSyncConfigurationFactory.kt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fee820b010f527613b9b17d95b2078f27e5867ce", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/fee820b010f527613b9b17d95b2078f27e5867ce", "committedDate": "2020-06-04T07:57:23Z", "message": "Merge branch 'v10' into cr/sync-integration-test-session"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72af903e6b3266b058f73968cf877821256c389d", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/72af903e6b3266b058f73968cf877821256c389d", "committedDate": "2020-06-04T10:25:14Z", "message": "Fix sync session connection state listeners"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1760905bdfed61dda355815d246dc92b534848c2", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/1760905bdfed61dda355815d246dc92b534848c2", "committedDate": "2020-06-04T15:01:44Z", "message": "Merge branch 'v10' into cr/sync-integration-test-session"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjM3NjQ4", "url": "https://github.com/realm/realm-java/pull/6884#pullrequestreview-424637648", "createdAt": "2020-06-04T16:43:31Z", "commit": {"oid": "1760905bdfed61dda355815d246dc92b534848c2"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNjo0MzozMlrOGfOs1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNjo0NjoxMlrOGfOzSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM5OTg5Mg==", "bodyText": "Most of these will fail unless made @required, right?", "url": "https://github.com/realm/realm-java/pull/6884#discussion_r435399892", "createdAt": "2020-06-04T16:43:32Z", "author": {"login": "cmelchior"}, "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/entities/SyncAllTypes.kt", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.entities\n+\n+import io.realm.MutableRealmInteger\n+import io.realm.RealmList\n+import io.realm.RealmObject\n+import io.realm.TestHelper\n+import io.realm.annotations.PrimaryKey\n+import io.realm.annotations.RealmField\n+import io.realm.annotations.Required\n+import org.bson.types.Decimal128\n+import org.bson.types.ObjectId\n+import java.math.BigDecimal\n+import java.util.*\n+\n+open class SyncAllTypes : RealmObject() {\n+\n+    companion object {\n+        const val CLASS_NAME = \"AllTypes\"\n+        const val FIELD_STRING = \"columnString\"\n+        const val FIELD_LONG = \"columnLong\"\n+        const val FIELD_FLOAT = \"columnFloat\"\n+        const val FIELD_DOUBLE = \"columnDouble\"\n+        const val FIELD_BOOLEAN = \"columnBoolean\"\n+        const val FIELD_DATE = \"columnDate\"\n+        const val FIELD_BINARY = \"columnBinary\"\n+        const val FIELD_MUTABLEREALMINTEGER = \"columnMutableRealmInteger\"\n+        const val FIELD_DECIMAL128 = \"columnDecimal128\"\n+        const val FIELD_OBJECT_ID = \"columnObjectId\"\n+        const val FIELD_REALMOBJECT = \"columnRealmObject\"\n+        const val FIELD_REALMLIST = \"columnRealmList\"\n+        const val FIELD_STRING_LIST = \"columnStringList\"\n+        const val FIELD_BINARY_LIST = \"columnBinaryList\"\n+        const val FIELD_BOOLEAN_LIST = \"columnBooleanList\"\n+        const val FIELD_LONG_LIST = \"columnLongList\"\n+        const val FIELD_DOUBLE_LIST = \"columnDoubleList\"\n+        const val FIELD_FLOAT_LIST = \"columnFloatList\"\n+        const val FIELD_DATE_LIST = \"columnDateList\"\n+        val INVALID_TYPES_FIELDS_FOR_DISTINCT = arrayOf(FIELD_REALMOBJECT, FIELD_REALMLIST, FIELD_DOUBLE, FIELD_FLOAT,\n+                FIELD_STRING_LIST, FIELD_BINARY_LIST, FIELD_BOOLEAN_LIST, FIELD_LONG_LIST,\n+                FIELD_DOUBLE_LIST, FIELD_FLOAT_LIST, FIELD_DATE_LIST)\n+    }\n+\n+    @PrimaryKey\n+    @RealmField(name = \"_id\")\n+    var id = ObjectId()\n+\n+    @Required\n+    var columnString = \"\"\n+    var columnLong: Long = 0\n+    var columnFloat = 0f\n+    var columnDouble = 0.0\n+    var isColumnBoolean = false\n+\n+    @Required\n+    var columnDate = Date(0)\n+\n+    @Required\n+    var columnBinary = ByteArray(0)\n+\n+    @Required\n+    var columnDecimal128 = Decimal128(BigDecimal.ZERO)\n+\n+    @Required\n+    var columnObjectId = ObjectId(TestHelper.randomObjectIdHexString())\n+    val columnRealmInteger = MutableRealmInteger.ofNull()\n+    var columnRealmObject: SyncDog? = null\n+    var columnRealmList: RealmList<SyncDog>? = null\n+    var columnStringList: RealmList<String>? = null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1760905bdfed61dda355815d246dc92b534848c2"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM5OTk5Mw==", "bodyText": "License is duplicated", "url": "https://github.com/realm/realm-java/pull/6884#discussion_r435399993", "createdAt": "2020-06-04T16:43:41Z", "author": {"login": "cmelchior"}, "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/entities/SyncAllTypesSchema.kt", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1760905bdfed61dda355815d246dc92b534848c2"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwMDc3OA==", "bodyText": "Not sure I get having both this class and SyncAllTypes we should probably only keep one of them?", "url": "https://github.com/realm/realm-java/pull/6884#discussion_r435400778", "createdAt": "2020-06-04T16:45:01Z", "author": {"login": "cmelchior"}, "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/entities/SyncSupportedTypes.kt", "diffHunk": "@@ -0,0 +1,102 @@\n+/*\n+ * Copyright 2020 Realm Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.realm.entities\n+\n+import io.realm.MutableRealmInteger\n+import io.realm.RealmList\n+import io.realm.RealmObject\n+import io.realm.TestHelper\n+import io.realm.annotations.PrimaryKey\n+import io.realm.annotations.RealmField\n+import io.realm.annotations.Required\n+import org.bson.types.Decimal128\n+import org.bson.types.ObjectId\n+import java.math.BigDecimal\n+import java.util.*\n+\n+open class SyncSupportedTypes : RealmObject() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1760905bdfed61dda355815d246dc92b534848c2"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwMTU0Nw==", "bodyText": "We should probably rename the java_syncmanager_class variables as that is no longer accurate", "url": "https://github.com/realm/realm-java/pull/6884#discussion_r435401547", "createdAt": "2020-06-04T16:46:12Z", "author": {"login": "cmelchior"}, "path": "realm/realm-library/src/main/cpp/io_realm_mongodb_sync_SyncSession.cpp", "diffHunk": "@@ -252,17 +252,17 @@ JNIEXPORT jlong JNICALL Java_io_realm_mongodb_sync_SyncSession_nativeAddConnecti\n             return 0;\n         }\n \n-        static JavaClass java_syncmanager_class(env, \"io/realm/mongodb/sync/Sync\");\n-        static JavaMethod java_notify_connection_listener(env, java_syncmanager_class, \"notifyConnectionListeners\", \"(Ljava/lang/String;JJ)V\", true);\n+        static JavaClass java_syncmanager_class(env, \"io/realm/mongodb/sync/SyncSession\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1760905bdfed61dda355815d246dc92b534848c2"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c88ffd731852041ce50c3da6e2ab662ddc52f21e", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/c88ffd731852041ce50c3da6e2ab662ddc52f21e", "committedDate": "2020-06-04T17:41:25Z", "message": "Merge branch 'v10' into cr/sync-integration-test-session"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2565, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}