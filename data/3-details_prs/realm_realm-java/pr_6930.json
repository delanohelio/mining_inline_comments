{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxMDI4ODI5", "number": 6930, "title": "Support for custom user data", "bodyText": "Adds support for custom user data.\nThe custom user data is available from User through:\npublic Document getCustomData()\n\nClosed #6907", "createdAt": "2020-06-08T10:17:36Z", "url": "https://github.com/realm/realm-java/pull/6930", "merged": true, "mergeCommit": {"oid": "239e7aa5c3d1ae46b48860a851f9a87ddef6a86b"}, "closed": true, "closedAt": "2020-06-11T11:08:51Z", "author": {"login": "rorbech"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpNs-WAH2gAyNDMxMDI4ODI5OjUyNDVmNGYxYzA5NWIxMTE3NmY4YTdlOWU1YzVhZGUzYzNkZDkxMWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqMH0RAFqTQyODgwMzYyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5245f4f1c095b11176f8a7e9e5c5ade3c3dd911f", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/5245f4f1c095b11176f8a7e9e5c5ade3c3dd911f", "committedDate": "2020-06-08T10:14:52Z", "message": "Support for custom user data"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MTE4NDcy", "url": "https://github.com/realm/realm-java/pull/6930#pullrequestreview-426118472", "createdAt": "2020-06-08T10:55:32Z", "commit": {"oid": "5245f4f1c095b11176f8a7e9e5c5ade3c3dd911f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMDo1NTozM1rOGgYtqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMDo1NTozM1rOGgYtqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjYxMjUyMg==", "bodyText": "Looks like we also need to expose refreshCustomData():  https://github.com/realm/realm-object-store/blob/v10/src/sync/app.hpp#L238 ... and since that is a network request, it should probably be:\npublic Document getCustomData()\npublic Document refreshCustomData()\npublic RealmAsyncTask refreshCustomData(Result<Document> callback)", "url": "https://github.com/realm/realm-java/pull/6930#discussion_r436612522", "createdAt": "2020-06-08T10:55:33Z", "author": {"login": "cmelchior"}, "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/User.java", "diffHunk": "@@ -280,6 +282,18 @@ public State getState() {\n         throw new IllegalStateException(\"Unknown state: \" + nativeState);\n     }\n \n+    /**\n+     * Return the custom user data associated with the user in the Realm App.\n+     * <p>\n+     * The data is only refreshed when the user's access token is refreshed.\n+     *\n+     * @return The custom user data associated with the user.\n+     */\n+    public Document getCustomData() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5245f4f1c095b11176f8a7e9e5c5ade3c3dd911f"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5da855052377e5a13575b98535b8018283a677a7", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/5da855052377e5a13575b98535b8018283a677a7", "committedDate": "2020-06-09T08:50:46Z", "message": "Support for custom user data refresh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f4bb64f980e2990b7046eb8023b4b869576673b", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/0f4bb64f980e2990b7046eb8023b4b869576673b", "committedDate": "2020-06-09T09:07:07Z", "message": "Trying to rework import to avoid stale service references"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTk5OTgw", "url": "https://github.com/realm/realm-java/pull/6930#pullrequestreview-427999980", "createdAt": "2020-06-10T12:27:13Z", "commit": {"oid": "0f4bb64f980e2990b7046eb8023b4b869576673b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MDE4ODc3", "url": "https://github.com/realm/realm-java/pull/6930#pullrequestreview-428018877", "createdAt": "2020-06-10T12:51:33Z", "commit": {"oid": "0f4bb64f980e2990b7046eb8023b4b869576673b"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMjo1MTozM1rOGhzRsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxMzoxNTo1N1rOGh0Qjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA5NjMwNg==", "bodyText": "This comment seems to indicate the data is lazy-loaded somehow? I don't assume that is true? Same wording is used thoughout this class.", "url": "https://github.com/realm/realm-java/pull/6930#discussion_r438096306", "createdAt": "2020-06-10T12:51:33Z", "author": {"login": "cmelchior"}, "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/UserTests.kt", "diffHunk": "@@ -327,4 +332,78 @@ class UserTests {\n         assertEquals(user.hashCode(), sameUserNewLogin.hashCode())\n     }\n \n+    @Test\n+    fun customData_initiallyEmpty() {\n+        val user = app.registerUserAndLogin(TestHelper.getRandomEmail(), \"123456\")\n+        // Data is not immediately available", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f4bb64f980e2990b7046eb8023b4b869576673b"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEwMDU3MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * {@link #refreshCustomData() refreshed}.\n          \n          \n            \n                 * calling {@link #refreshCustomData()}.", "url": "https://github.com/realm/realm-java/pull/6930#discussion_r438100571", "createdAt": "2020-06-10T12:58:02Z", "author": {"login": "cmelchior"}, "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/User.java", "diffHunk": "@@ -280,6 +282,51 @@ public State getState() {\n         throw new IllegalStateException(\"Unknown state: \" + nativeState);\n     }\n \n+    /**\n+     * Return the custom user data associated with the user in the Realm App.\n+     * <p>\n+     * The data is only refreshed when the user's access token is refreshed or when explicitly\n+     * {@link #refreshCustomData() refreshed}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f4bb64f980e2990b7046eb8023b4b869576673b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEwMDc4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 *", "url": "https://github.com/realm/realm-java/pull/6930#discussion_r438100782", "createdAt": "2020-06-10T12:58:21Z", "author": {"login": "cmelchior"}, "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/User.java", "diffHunk": "@@ -280,6 +282,51 @@ public State getState() {\n         throw new IllegalStateException(\"Unknown state: \" + nativeState);\n     }\n \n+    /**\n+     * Return the custom user data associated with the user in the Realm App.\n+     * <p>\n+     * The data is only refreshed when the user's access token is refreshed or when explicitly\n+     * {@link #refreshCustomData() refreshed}.\n+     *\n+     * @return The custom user data associated with the user.\n+     */\n+    public Document getCustomData() {\n+        return osUser.getCustomData();\n+    }\n+\n+    /**\n+     * Re-fetch custom user data from the Realm App.\n+     *\n+     * @return The updated custom user data associated with the user.\n+     *", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f4bb64f980e2990b7046eb8023b4b869576673b"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEwMTgyMQ==", "bodyText": "Looks like a fun thing to debug \ud83d\ude48", "url": "https://github.com/realm/realm-java/pull/6930#discussion_r438101821", "createdAt": "2020-06-10T12:59:53Z", "author": {"login": "cmelchior"}, "path": "tools/sync_test_server/setup_mongodb_realm.sh", "diffHunk": "@@ -64,10 +64,10 @@ stitch-cli import \\\n                   --config-path=/tmp/stitch-config \\\n                   --base-url=http://localhost:9090 \\\n                   --path=/tmp/app_config \\\n-                  --app-name realm-sdk-integration-tests \\\n+                  --app-id=\"realm-sdk-integration-tests-$APP_ID_SUFFIX\" \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f4bb64f980e2990b7046eb8023b4b869576673b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEwMjUwOA==", "bodyText": "What is this for?", "url": "https://github.com/realm/realm-java/pull/6930#discussion_r438102508", "createdAt": "2020-06-10T13:00:47Z", "author": {"login": "cmelchior"}, "path": "tools/sync_test_server/setup_mongodb_realm.sh", "diffHunk": "@@ -42,7 +42,7 @@ yes | stitch-cli login --config-path=/tmp/stitch-config \\\n IMPORT_RESPONSE=$(stitch-cli import \\\n                   --config-path=/tmp/stitch-config \\\n                   --base-url=http://localhost:9090 \\\n-                  --path=/tmp/app_config \\\n+                  --path=/tmp/app_config_empty \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f4bb64f980e2990b7046eb8023b4b869576673b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODExMjM5OA==", "bodyText": "What is this app_config_empty doing? If you intend to import two different apps, I'm not sure you are doing it correctly? Because we only store one app_id_suffix used by the integration tests?", "url": "https://github.com/realm/realm-java/pull/6930#discussion_r438112398", "createdAt": "2020-06-10T13:15:57Z", "author": {"login": "cmelchior"}, "path": "tools/sync_test_server/start_server.sh", "diffHunk": "@@ -41,6 +41,7 @@ ID=$(docker run --rm -i -t -d --network mongodb-realm-network -p9090:9090 -p8888\n docker run --rm -i -t -d --network container:$ID -v$TMP_DIR:/tmp --name mongodb-realm-command-server mongodb-realm-command-server\n \n docker cp \"$DOCKERFILE_DIR\"/app_config mongodb-realm:/tmp/app_config\n+docker cp \"$DOCKERFILE_DIR\"/app_config_empty mongodb-realm:/tmp/app_config_empty", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0f4bb64f980e2990b7046eb8023b4b869576673b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65c102a46ead0c54b03387032964c2fee312dc29", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/65c102a46ead0c54b03387032964c2fee312dc29", "committedDate": "2020-06-11T09:27:42Z", "message": "Revert \"Trying to rework import to avoid stale service references\"\n\nThis reverts commit 0f4bb64f980e2990b7046eb8023b4b869576673b."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed4e1ddffc04a2395e6ef9e8da117db4c31bd2f8", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/ed4e1ddffc04a2395e6ef9e8da117db4c31bd2f8", "committedDate": "2020-06-11T09:29:45Z", "message": "Merge branch 'v10' into cr/custom-user-data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f034892edeb3c486ff800a4d42ff9ab3c7e8d39b", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/f034892edeb3c486ff800a4d42ff9ab3c7e8d39b", "committedDate": "2020-06-11T09:30:10Z", "message": "Updates according to code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24f5abaa9b86ef1b399ac19de6dfb57bc61d0163", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/24f5abaa9b86ef1b399ac19de6dfb57bc61d0163", "committedDate": "2020-06-11T09:38:01Z", "message": "Ignore tests that was not possible to automate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59d840ebfac3782f3318cb2e7b002373120694d9", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/59d840ebfac3782f3318cb2e7b002373120694d9", "committedDate": "2020-06-11T10:03:12Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Christian Melchior <christian@ilios.dk>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f54fb26535b047eea031ac388304f4c990c3071f", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/f54fb26535b047eea031ac388304f4c990c3071f", "committedDate": "2020-06-11T10:26:23Z", "message": "Apply comments from code review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4ODAzNjIz", "url": "https://github.com/realm/realm-java/pull/6930#pullrequestreview-428803623", "createdAt": "2020-06-11T10:58:18Z", "commit": {"oid": "f54fb26535b047eea031ac388304f4c990c3071f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2590, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}