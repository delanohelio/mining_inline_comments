{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4NzE0NTg5", "number": 7220, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxODoxODoxMFrOE-Esxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxODo0OToyMFrOE-FCHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNTI0MTY3OnYy", "diffSide": "RIGHT", "path": "realm/realm-annotations-processor/src/main/java/io/realm/processor/RealmProxyClassGenerator.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxODoxODoxMFrOH7F1uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxODoxODoxMFrOH7F1uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcyMzcwNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change", "url": "https://github.com/realm/realm-java/pull/7220#discussion_r531723707", "createdAt": "2020-11-27T18:18:10Z", "author": {"login": "rorbech"}, "path": "realm/realm-annotations-processor/src/main/java/io/realm/processor/RealmProxyClassGenerator.kt", "diffHunk": "@@ -2410,5 +2407,39 @@ class RealmProxyClassGenerator(private val processingEnvironment: ProcessingEnvi\n             }\n             return count\n         }\n+\n+    }\n+\n+    // Returns whether a type of a  Realm field is embedded or not.\n+    // If the type class is part of this processing round then lookup the class metadata from 'classCollection'\n+    // then invoke 'embedded' property, Otherwise the class might not be present within the 'classCollection' because it was\n+    // processed from another module for example, then use the compiler tool api to find out if it was annotated with 'embedded'\n+    // the second method could be slightly slower this is why we default to the first appraoch.\n+    private fun isFieldTypeEmbedded(type: TypeMirror) : Boolean  {\n+        val fieldType = QualifiedClassName(type)\n+        val fieldTypeMetaData: ClassMetaData? = classCollection.getClassFromQualifiedNameOrNull(fieldType)\n+        return fieldTypeMetaData?.embedded ?: type.isEmbedded()\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "100d8d0e4355593062721e425fc0efcc0870e3c9"}, "originalPosition": 401}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNTI1OTU0OnYy", "diffSide": "RIGHT", "path": "realm/realm-annotations-processor/src/main/java/io/realm/processor/RealmProxyClassGenerator.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxODoyNzo1MlrOH7F_nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxODoyNzo1MlrOH7F_nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcyNjIzNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // Returns whether a type of a  Realm field is embedded or not.\n          \n          \n            \n                // If the type class is part of this processing round then lookup the class metadata from 'classCollection'\n          \n          \n            \n                // then invoke 'embedded' property, Otherwise the class might not be present within the 'classCollection' because it was\n          \n          \n            \n                // processed from another module for example, then use the compiler tool api to find out if it was annotated with 'embedded'\n          \n          \n            \n                // the second method could be slightly slower this is why we default to the first appraoch.\n          \n          \n            \n                // Returns whether a type of a Realm field is embedded or not.\n          \n          \n            \n                // For types which are part of this processing round we can look it up immediately from \n          \n          \n            \n                // the metadata in the `classCollection`. For types defined in other modules we will \n          \n          \n            \n                // have to use the slower approach of inspecting the `embedded` property of the\n          \n          \n            \n                // RealmClass annotation using the compiler tool api.", "url": "https://github.com/realm/realm-java/pull/7220#discussion_r531726236", "createdAt": "2020-11-27T18:27:52Z", "author": {"login": "rorbech"}, "path": "realm/realm-annotations-processor/src/main/java/io/realm/processor/RealmProxyClassGenerator.kt", "diffHunk": "@@ -2410,5 +2407,39 @@ class RealmProxyClassGenerator(private val processingEnvironment: ProcessingEnvi\n             }\n             return count\n         }\n+\n+    }\n+\n+    // Returns whether a type of a  Realm field is embedded or not.\n+    // If the type class is part of this processing round then lookup the class metadata from 'classCollection'\n+    // then invoke 'embedded' property, Otherwise the class might not be present within the 'classCollection' because it was\n+    // processed from another module for example, then use the compiler tool api to find out if it was annotated with 'embedded'\n+    // the second method could be slightly slower this is why we default to the first appraoch.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "100d8d0e4355593062721e425fc0efcc0870e3c9"}, "originalPosition": 395}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNTI2MDc0OnYy", "diffSide": "RIGHT", "path": "realm/realm-annotations-processor/src/main/java/io/realm/processor/RealmProxyClassGenerator.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxODoyODozNlrOH7GAQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxODoyODozNlrOH7GAQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcyNjQwMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change", "url": "https://github.com/realm/realm-java/pull/7220#discussion_r531726401", "createdAt": "2020-11-27T18:28:36Z", "author": {"login": "rorbech"}, "path": "realm/realm-annotations-processor/src/main/java/io/realm/processor/RealmProxyClassGenerator.kt", "diffHunk": "@@ -2032,9 +2030,9 @@ class RealmProxyClassGenerator(private val processingEnvironment: ProcessingEnvi\n             emitEmptyLine()\n         }\n     }\n-   \n \n-   \n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "100d8d0e4355593062721e425fc0efcc0870e3c9"}, "originalPosition": 344}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNTI5MjY4OnYy", "diffSide": "RIGHT", "path": "realm/realm-annotations-processor/build.gradle", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxODo0Njo1M1rOH7GSEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxODo0Njo1M1rOH7GSEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTczMDk2Mw==", "bodyText": "Nice \ud83d\udc4d", "url": "https://github.com/realm/realm-java/pull/7220#discussion_r531730963", "createdAt": "2020-11-27T18:46:53Z", "author": {"login": "cmelchior"}, "path": "realm/realm-annotations-processor/build.gradle", "diffHunk": "@@ -15,15 +15,16 @@ dependencies {\n     implementation \"io.realm:realm-annotations:${version}\"\n     implementation \"org.mongodb:bson:${properties.getProperty('BSON_DEPENDENCY')}\"\n     implementation \"org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version\"\n+    implementation files(Jvm.current().toolsJar)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "100d8d0e4355593062721e425fc0efcc0870e3c9"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNTI5NjMxOnYy", "diffSide": "RIGHT", "path": "realm/realm-annotations-processor/src/main/java/io/realm/processor/RealmProxyClassGenerator.kt", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxODo0OToyMFrOH7GUSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxOToyMzozOFrOH7GzZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTczMTUzMQ==", "bodyText": "Should we break after this?", "url": "https://github.com/realm/realm-java/pull/7220#discussion_r531731531", "createdAt": "2020-11-27T18:49:20Z", "author": {"login": "cmelchior"}, "path": "realm/realm-annotations-processor/src/main/java/io/realm/processor/RealmProxyClassGenerator.kt", "diffHunk": "@@ -2410,5 +2407,39 @@ class RealmProxyClassGenerator(private val processingEnvironment: ProcessingEnvi\n             }\n             return count\n         }\n+\n+    }\n+\n+    // Returns whether a type of a  Realm field is embedded or not.\n+    // If the type class is part of this processing round then lookup the class metadata from 'classCollection'\n+    // then invoke 'embedded' property, Otherwise the class might not be present within the 'classCollection' because it was\n+    // processed from another module for example, then use the compiler tool api to find out if it was annotated with 'embedded'\n+    // the second method could be slightly slower this is why we default to the first appraoch.\n+    private fun isFieldTypeEmbedded(type: TypeMirror) : Boolean  {\n+        val fieldType = QualifiedClassName(type)\n+        val fieldTypeMetaData: ClassMetaData? = classCollection.getClassFromQualifiedNameOrNull(fieldType)\n+        return fieldTypeMetaData?.embedded ?: type.isEmbedded()\n+    }\n+\n+\n+    private fun TypeMirror.isEmbedded() : Boolean {\n+        var isEmbedded = false\n+\n+        if (this is Type.ClassType) {\n+            val declarationAttributes: com.sun.tools.javac.util.List<Attribute.Compound>? = tsym.metadata?.declarationAttributes\n+            if (declarationAttributes != null) {\n+                for (attribute: Attribute.Compound in declarationAttributes) {\n+                    if (attribute.type.tsym.qualifiedName.toString() == \"io.realm.annotations.RealmClass\") {\n+                        for (pair: Pair<Symbol.MethodSymbol, Attribute> in attribute.values) {\n+                            if (pair.fst.name.toString() == \"embedded\") {\n+                                isEmbedded = pair.snd.value as Boolean", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "100d8d0e4355593062721e425fc0efcc0870e3c9"}, "originalPosition": 413}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTczOTQ5Mw==", "bodyText": "yes good catch", "url": "https://github.com/realm/realm-java/pull/7220#discussion_r531739493", "createdAt": "2020-11-27T19:23:38Z", "author": {"login": "nhachicha"}, "path": "realm/realm-annotations-processor/src/main/java/io/realm/processor/RealmProxyClassGenerator.kt", "diffHunk": "@@ -2410,5 +2407,39 @@ class RealmProxyClassGenerator(private val processingEnvironment: ProcessingEnvi\n             }\n             return count\n         }\n+\n+    }\n+\n+    // Returns whether a type of a  Realm field is embedded or not.\n+    // If the type class is part of this processing round then lookup the class metadata from 'classCollection'\n+    // then invoke 'embedded' property, Otherwise the class might not be present within the 'classCollection' because it was\n+    // processed from another module for example, then use the compiler tool api to find out if it was annotated with 'embedded'\n+    // the second method could be slightly slower this is why we default to the first appraoch.\n+    private fun isFieldTypeEmbedded(type: TypeMirror) : Boolean  {\n+        val fieldType = QualifiedClassName(type)\n+        val fieldTypeMetaData: ClassMetaData? = classCollection.getClassFromQualifiedNameOrNull(fieldType)\n+        return fieldTypeMetaData?.embedded ?: type.isEmbedded()\n+    }\n+\n+\n+    private fun TypeMirror.isEmbedded() : Boolean {\n+        var isEmbedded = false\n+\n+        if (this is Type.ClassType) {\n+            val declarationAttributes: com.sun.tools.javac.util.List<Attribute.Compound>? = tsym.metadata?.declarationAttributes\n+            if (declarationAttributes != null) {\n+                for (attribute: Attribute.Compound in declarationAttributes) {\n+                    if (attribute.type.tsym.qualifiedName.toString() == \"io.realm.annotations.RealmClass\") {\n+                        for (pair: Pair<Symbol.MethodSymbol, Attribute> in attribute.values) {\n+                            if (pair.fst.name.toString() == \"embedded\") {\n+                                isEmbedded = pair.snd.value as Boolean", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTczMTUzMQ=="}, "originalCommit": {"oid": "100d8d0e4355593062721e425fc0efcc0870e3c9"}, "originalPosition": 413}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 388, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}