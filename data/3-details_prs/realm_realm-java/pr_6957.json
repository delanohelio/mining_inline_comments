{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MDE5MzIx", "number": 6957, "title": "Migrating sync integration auth tests", "bodyText": "Deleted overlapping tests and moved the rest to appropriated existing classes.\nTo get the exact deletion/relocation see the comments of 1aa1fe6", "createdAt": "2020-06-19T10:22:57Z", "url": "https://github.com/realm/realm-java/pull/6957", "merged": true, "mergeCommit": {"oid": "66493c899986d6ebc55321a28e80d8b87b84963d"}, "closed": true, "closedAt": "2020-07-02T12:42:42Z", "author": {"login": "rorbech"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqJgy0AH2gAyNDM3MDE5MzIxOjU5M2FiZGFhZGY2Y2M0ZGI1NjM3ODM3MzFkZTA2NTMwNzAwOWNlN2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcw9GLKAH2gAyNDM3MDE5MzIxOmFkNjI2YzRjOTgxN2IzNTdmMzE1ZWIxYzE3MGE4MmM2Mzk5YjJhNDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "593abdaadf6cc4db563783731de065307009ce7c", "author": {"user": {"login": "cmelchior", "name": "Christian Melchior"}}, "url": "https://github.com/realm/realm-java/commit/593abdaadf6cc4db563783731de065307009ce7c", "committedDate": "2020-06-11T07:55:52Z", "message": "Delete tests no longer needed + describe gotchas in remaining ones"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad613ac75b124a30c4010c817e39d3a1edda63da", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/ad613ac75b124a30c4010c817e39d3a1edda63da", "committedDate": "2020-06-16T07:07:37Z", "message": "Move AuthTests to Kotlin source set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4191c3b52354f75a6d32501d6ce4d6f6f7b96734", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/4191c3b52354f75a6d32501d6ce4d6f6f7b96734", "committedDate": "2020-06-16T07:14:54Z", "message": "Automatic conversion of AuthTests to Kotlin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1aa1fe6609088d30c23a015c47a21c978d39a8c5", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/1aa1fe6609088d30c23a015c47a21c978d39a8c5", "committedDate": "2020-06-19T10:18:41Z", "message": "Migrating AuthTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8ecfb76ec7003994b09bb62350f1f84bd7321d0", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/c8ecfb76ec7003994b09bb62350f1f84bd7321d0", "committedDate": "2020-06-19T10:18:53Z", "message": "Merge branch 'v10' into cr/sync-integration-test-auth"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5079b5959c5a3d45c43fb29e4ef9a6fe4b48e2c", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/e5079b5959c5a3d45c43fb29e4ef9a6fe4b48e2c", "committedDate": "2020-06-22T11:36:18Z", "message": "Clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12669eea98b10bcec8b2fff8cc385ee4df7ea599", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/12669eea98b10bcec8b2fff8cc385ee4df7ea599", "committedDate": "2020-06-22T11:36:46Z", "message": "Merge branch 'v10' into cr/sync-integration-test-auth"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNDI1OTUw", "url": "https://github.com/realm/realm-java/pull/6957#pullrequestreview-441425950", "createdAt": "2020-07-02T07:41:45Z", "commit": {"oid": "12669eea98b10bcec8b2fff8cc385ee4df7ea599"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNzo0MTo0NVrOGsBHtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwNzo0Mjo1N1rOGsBKGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODgwODg4Nw==", "bodyText": "I don't think that is a problem. Comparing the String is fine.", "url": "https://github.com/realm/realm-java/pull/6957#discussion_r448808887", "createdAt": "2020-07-02T07:41:45Z", "author": {"login": "cmelchior"}, "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/UserTests.kt", "diffHunk": "@@ -300,6 +348,32 @@ class UserTests {\n     @Ignore(\"Not implemented yet\")\n     fun refreshToken() { }\n \n+\n+    @Test\n+    fun revokedRefreshTokenIsNotSameAfterLogin() = looperThread.runBlocking {\n+        val password = \"password\"\n+        val user = app.registerUserAndLogin(TestHelper.getRandomEmail(), password)\n+        val refreshToken = user.refreshToken\n+\n+        app.addAuthenticationListener(object: AuthenticationListener {\n+            override fun loggedIn(user: User) { }\n+\n+            override fun loggedOut(user: User) {\n+                app.loginAsync(Credentials.emailPassword(user.email, password)) {\n+                    // FIXME Old API allowed verification of token identity", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12669eea98b10bcec8b2fff8cc385ee4df7ea599"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODgwOTQ5Ng==", "bodyText": "This comment doesn't seem to be true anymore?", "url": "https://github.com/realm/realm-java/pull/6957#discussion_r448809496", "createdAt": "2020-07-02T07:42:57Z", "author": {"login": "cmelchior"}, "path": "realm/realm-library/src/androidTestObjectServer/kotlin/io/realm/UserTests.kt", "diffHunk": "@@ -300,6 +348,32 @@ class UserTests {\n     @Ignore(\"Not implemented yet\")\n     fun refreshToken() { }\n \n+\n+    @Test\n+    fun revokedRefreshTokenIsNotSameAfterLogin() = looperThread.runBlocking {\n+        val password = \"password\"\n+        val user = app.registerUserAndLogin(TestHelper.getRandomEmail(), password)\n+        val refreshToken = user.refreshToken\n+\n+        app.addAuthenticationListener(object: AuthenticationListener {\n+            override fun loggedIn(user: User) { }\n+\n+            override fun loggedOut(user: User) {\n+                app.loginAsync(Credentials.emailPassword(user.email, password)) {\n+                    // FIXME Old API allowed verification of token identity\n+                    // assertEquals(revokedRefreshToken.identity(), token.identity())\n+\n+                    // FIXME The below assertion does not hold. I guess the user is still the same", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12669eea98b10bcec8b2fff8cc385ee4df7ea599"}, "originalPosition": 85}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ead6285208f05b68d658aa3b629cf71b73a4ab2", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/3ead6285208f05b68d658aa3b629cf71b73a4ab2", "committedDate": "2020-07-02T10:06:47Z", "message": "Remove superflous FIXMEs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad626c4c9817b357f315eb1c170a82c6399b2a45", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/ad626c4c9817b357f315eb1c170a82c6399b2a45", "committedDate": "2020-07-02T11:25:24Z", "message": "Merge branch 'v10' into cr/sync-integration-test-auth"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2611, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}