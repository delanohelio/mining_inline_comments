{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxNzM4MzM3", "number": 7052, "title": "Automate uploading docs to MongoDB Realm website", "bodyText": "One step closer to having a fully automated release...\nIt works by:\n\nUploading new docs to a version folder\nUpdate the redirect found in /java/latest and kotlin/latest\n\nNote, there is a also a redirect for the Kotlin docs since Dokka output a slightly annoying format where there only exist a style.css in the root and you have to go to a subfolder for the index.html.\nTODO\n\n Avoid copying the same docs twice and use redirects instead.", "createdAt": "2020-08-21T16:49:13Z", "url": "https://github.com/realm/realm-java/pull/7052", "merged": true, "mergeCommit": {"oid": "d37d73d6f849bf9823b90c28e2638987a4c6cfb8"}, "closed": true, "closedAt": "2020-08-24T07:55:27Z", "author": {"login": "cmelchior"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdBHqsuAH2gAyNDcxNzM4MzM3OmY1NjBkOGNlNmU1YzAwZTQyZGU5MzliNGE4MTk4MzYyNGRjMzI3Nzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdB91yRgFqTQ3MzE5ODQ1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f560d8ce6e5c00e42de939b4a81983624dc32779", "author": {"user": {"login": "cmelchior", "name": "Christian Melchior"}}, "url": "https://github.com/realm/realm-java/commit/f560d8ce6e5c00e42de939b4a81983624dc32779", "committedDate": "2020-08-21T16:47:08Z", "message": "Add task that automatically upload docs to the MongoDB Realm website"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3ec7a9d1e7df5c7486991b651d842bea764c801", "author": {"user": {"login": "cmelchior", "name": "Christian Melchior"}}, "url": "https://github.com/realm/realm-java/commit/b3ec7a9d1e7df5c7486991b651d842bea764c801", "committedDate": "2020-08-24T06:41:50Z", "message": "Add redirects to make uploading faster and updates safer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02acd624912e5f50d1362a708c4a060750228ba6", "author": {"user": {"login": "cmelchior", "name": "Christian Melchior"}}, "url": "https://github.com/realm/realm-java/commit/02acd624912e5f50d1362a708c4a060750228ba6", "committedDate": "2020-08-24T06:45:02Z", "message": "Correct description"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMTU4OTk3", "url": "https://github.com/realm/realm-java/pull/7052#pullrequestreview-473158997", "createdAt": "2020-08-24T06:46:57Z", "commit": {"oid": "b3ec7a9d1e7df5c7486991b651d842bea764c801"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMTU5NzUy", "url": "https://github.com/realm/realm-java/pull/7052#pullrequestreview-473159752", "createdAt": "2020-08-24T06:48:33Z", "commit": {"oid": "02acd624912e5f50d1362a708c4a060750228ba6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNjo0ODozNFrOHFWpJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNjo0ODozNFrOHFWpJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM3NTkwOQ==", "bodyText": "Is it actually called from somewhere? Or maybe it was just automated yet?", "url": "https://github.com/realm/realm-java/pull/7052#discussion_r475375909", "createdAt": "2020-08-24T06:48:34Z", "author": {"login": "rorbech"}, "path": "build.gradle", "diffHunk": "@@ -195,21 +195,81 @@ task javadoc(type:GradleBuild) {\n     configure copyProperties\n }\n \n-task javadocPackage(type: Zip) {\n-    description = 'Generate a Zip file with all SDK docs'\n+// Find property in either System environment or Gradle properties.\n+// If set in both places, Gradle properties win.\n+def getPropertyValueOrThrow(String propertyName) {\n+    def value = System.getenv(propertyName)\n+    if (project.hasProperty(propertyName)) {\n+        value = project.getProperty(propertyName)\n+    }\n+    if (value == null || value.trim().isEmpty()) {\n+        throw new GradleException(\"Could not find '$propertyName'. \" +\n+                \"Most be provided as either environment variable or \" +\n+                \"a Gradle property.\")\n+    }\n+    return value\n+}\n+\n+task createLatestJavadocRedirectFile(type: Copy) {\n+    description = 'Redirects from /java/latest/ to correct version'\n+    from 'realm/templates'\n+    into \"$buildDir/outputs/doc_redirects/java_latest\"\n+    include 'redirect.html.template'\n+    rename { file -> 'index.html' }\n+    expand(title: \"Realm Java ${currentVersion}\", url: \"../${currentVersion}/index.html\")\n+}\n+\n+task createLatestKotlindocRedirectFile(type: Copy) {\n+    description = 'Redirects from /kotlin/latest/ to correct version'\n+    from 'realm/templates'\n+    into \"$buildDir/outputs/doc_redirects/kotlin_latest\"\n+    include 'redirect.html.template'\n+    rename { file -> 'index.html' }\n+    expand(title: \"Kotlin Extensions ${currentVersion}\", url: \"../${currentVersion}/index.html\")\n+}\n+\n+task createKotlinRootRedirectFile(type: Copy) {\n+    description = 'Redirects from /kotlin/<version>/ to /kotlin/<version>/kotlin-extensions, which is the real root folder'\n+    from 'realm/templates'\n+    into \"$buildDir/outputs/doc_redirects/kotlin_root\"\n+    include 'redirect.html.template'\n+    rename { file -> 'index.html' }\n+    expand(title: \"Kotlin Extensions ${currentVersion}\", url: \"./kotlin-extensions/index.html\")\n+}\n+\n+task uploadJavadoc {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02acd624912e5f50d1362a708c4a060750228ba6"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMTk4NDU5", "url": "https://github.com/realm/realm-java/pull/7052#pullrequestreview-473198459", "createdAt": "2020-08-24T07:54:07Z", "commit": {"oid": "02acd624912e5f50d1362a708c4a060750228ba6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2333, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}