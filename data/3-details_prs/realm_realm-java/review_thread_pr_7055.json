{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNDM4NDQz", "number": 7055, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNjowMDowNFrOEcpJKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwOToxNzoxN1rOEeOlOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4NDY5NjczOnYy", "diffSide": "RIGHT", "path": "realm/realm-library/src/androidTest/java/io/realm/RealmTests.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNjowMDowNFrOHHS-Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNjowMDowNFrOHHS-Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQxMjk2Ng==", "bodyText": "Replacing this with long objectCount = realm.where(AllJavaTypes.class).count(); works. This could indicate that it is the TableView created by findAll() that somehow isn't being updated correctly thus leaking the version and causing the test to crash.\nI'll try to move this to ObjectStore and see if I can replicate the behavior there.", "url": "https://github.com/realm/realm-java/pull/7055#discussion_r477412966", "createdAt": "2020-08-26T16:00:04Z", "author": {"login": "cmelchior"}, "path": "realm/realm-library/src/androidTest/java/io/realm/RealmTests.java", "diffHunk": "@@ -4560,6 +4560,58 @@ public void hittingMaxNumberOfVersionsThrows() {\n         }\n     }\n \n+    @Test\n+    @RunTestInLooperThread\n+    // FIXME Maybe a bit convoluted, consider deleting it again.\n+    public void numberOfVersionsDecreasedOnClose() {\n+        int count = 50;\n+        final CountDownLatch bgThreadDoneLatch = new CountDownLatch(count);\n+\n+        RealmConfiguration config = configFactory.createConfigurationBuilder()\n+                // The multiple embedded threads seems to cause trouble with factory's directory setting\n+                .directory(context.getFilesDir())\n+                .name(\"versions-test.realm\")\n+                .maxNumberOfActiveVersions(5)\n+                .build();\n+\n+        // Read only instance\n+        looperThread.postRunnable(() -> {\n+            Realm realm = Realm.getInstance(config);\n+            realm.addChangeListener(realm1 -> {\n+                // FIXME Seems like versions are not deprecated if we do queries here\n+                //int objectCount = realm.where(AllJavaTypes.class).findAll().size();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ddf7297f5def1b07ed02d7e86e0adee97f4b969"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMTMxNjQwOnYy", "diffSide": "RIGHT", "path": "CHANGELOG.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwOToxNzoxN1rOHJw_Zg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwOToxNzoxN1rOHJw_Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDAwMTg5NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Addded `Realm.getNumberOfActiveVersions()`, which give back the current number of active versions maintained by the Realm file.\n          \n          \n            \n            * Added `Realm.getNumberOfActiveVersions()`, which returns the current number of active versions maintained by the Realm file.", "url": "https://github.com/realm/realm-java/pull/7055#discussion_r480001894", "createdAt": "2020-08-31T09:17:17Z", "author": {"login": "rorbech"}, "path": "CHANGELOG.md", "diffHunk": "@@ -1,4 +1,21 @@\n-## 7.0.2(2020-08-14)\n+## 7.0.3 (YYYY-MM-DD)\n+\n+### Enhancements\n+* Addded `Realm.getNumberOfActiveVersions()`, which give back the current number of active versions maintained by the Realm file.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f12fac6e6f6814bde5faea266608d080773dd67"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 504, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}