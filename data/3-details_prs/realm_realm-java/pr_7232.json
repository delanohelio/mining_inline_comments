{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyMzkwMjgw", "number": 7232, "title": "Clean up local JNI references to prevent overflow", "bodyText": "Deleting local reference to prevent local reference table overflow.\nCloses #7217", "createdAt": "2020-12-04T09:00:10Z", "url": "https://github.com/realm/realm-java/pull/7232", "merged": true, "mergeCommit": {"oid": "3313e36d3ee70afc325ad541efe568e8f57606f8"}, "closed": true, "closedAt": "2020-12-08T10:31:11Z", "author": {"login": "rorbech"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdizx5PgH2gAyNTMyMzkwMjgwOjM1YWZjNjY4MWFlMTBkMmUzNWU3MTA4ZTdlNThhMzk0NDM3MTdkOTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj2ZOwgFqTU0NjE5OTEzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "35afc6681ae10d2e35e7108e7e58a39443717d98", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/35afc6681ae10d2e35e7108e7e58a39443717d98", "committedDate": "2020-12-04T08:50:19Z", "message": "Clean up local JNI references to prevent overflow"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0OTA3NjA2", "url": "https://github.com/realm/realm-java/pull/7232#pullrequestreview-544907606", "createdAt": "2020-12-04T12:15:29Z", "commit": {"oid": "35afc6681ae10d2e35e7108e7e58a39443717d98"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMjoxNToyOVrOH_OWew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxMjoxOToxOFrOH_OeRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1NzQ2Nw==", "bodyText": "Is this being used anywhere?", "url": "https://github.com/realm/realm-java/pull/7232#discussion_r536057467", "createdAt": "2020-12-04T12:15:29Z", "author": {"login": "cmelchior"}, "path": "realm/realm-library/src/main/cpp/java_accessor.hpp", "diffHunk": "@@ -154,6 +154,11 @@ class JObjectArrayAccessor {\n     jsize m_size;\n };\n \n+template<>\n+inline JStringAccessor JObjectArrayAccessor<JStringAccessor,jstring>::operator[](const int index) const noexcept {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35afc6681ae10d2e35e7108e7e58a39443717d98"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1ODYyNg==", "bodyText": "Any reason to introduce the owned boolean for just this case? Couldn't we delete it after calling the ref after calling the completionBlock?", "url": "https://github.com/realm/realm-java/pull/7232#discussion_r536058626", "createdAt": "2020-12-04T12:17:37Z", "author": {"login": "cmelchior"}, "path": "realm/realm-library/src/main/cpp/java_network_transport.hpp", "diffHunk": "@@ -92,7 +103,7 @@ struct JavaNetworkTransport : public app::GenericNetworkTransport {\n \n             jint http_code = env->CallIntMethod(response, get_http_code_method);\n             jint custom_code = env->CallIntMethod(response, get_custom_code_method);\n-            JStringAccessor java_body(env, (jstring) env->CallObjectMethod(response, get_body_method));\n+            JStringAccessor java_body(env, (jstring) env->CallObjectMethod(response, get_body_method), true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35afc6681ae10d2e35e7108e7e58a39443717d98"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1OTQ2Mg==", "bodyText": "This name is a bit confusing to me. Owned by who? Looking at the code, it seems to imply \"owned by this class\" so maybe \"owned_by_accessor\" or \"delete_on_free\" or pr. the comment above, just remove it? \ud83e\udd14", "url": "https://github.com/realm/realm-java/pull/7232#discussion_r536059462", "createdAt": "2020-12-04T12:19:18Z", "author": {"login": "cmelchior"}, "path": "realm/realm-library/src/main/cpp/util.cpp", "diffHunk": "@@ -331,6 +335,7 @@ struct JStringCharsAccessor {\n     const jstring m_string;\n     const jchar* const m_data;\n     const size_t m_size;\n+    const bool m_owned;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35afc6681ae10d2e35e7108e7e58a39443717d98"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3ce5b22453bdcdf2a1f5f77fd7fcbaecaf4dee1", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/a3ce5b22453bdcdf2a1f5f77fd7fcbaecaf4dee1", "committedDate": "2020-12-04T13:48:25Z", "message": "More descriptive argument/member names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f9fad3a6510c8032d67e2102cb56b73ba3d6627", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/6f9fad3a6510c8032d67e2102cb56b73ba3d6627", "committedDate": "2020-12-07T08:05:12Z", "message": "Merge branch 'releases' into cr/jni-reference-overflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cad4980186754074ab2eef1a1df7fe309f23a0bb", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/cad4980186754074ab2eef1a1df7fe309f23a0bb", "committedDate": "2020-12-07T08:10:31Z", "message": "Add CHANGELOG entry"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MDE5NTcx", "url": "https://github.com/realm/realm-java/pull/7232#pullrequestreview-546019571", "createdAt": "2020-12-07T10:34:38Z", "commit": {"oid": "cad4980186754074ab2eef1a1df7fe309f23a0bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxMDozNDozOFrOIAgNOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxMDozNDozOFrOIAgNOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM5ODU4NQ==", "bodyText": "Add FIXME to ensure alignment of future updates", "url": "https://github.com/realm/realm-java/pull/7232#discussion_r537398585", "createdAt": "2020-12-07T10:34:38Z", "author": {"login": "rorbech"}, "path": "realm/realm-library/src/main/cpp/util.cpp", "diffHunk": "@@ -306,16 +306,20 @@ struct JcharTraits {\n };\n \n struct JStringCharsAccessor {\n-    JStringCharsAccessor(JNIEnv* e, jstring s)\n+    JStringCharsAccessor(JNIEnv* e, jstring s, bool delete_jstring_ref_on_delete)\n         : m_env(e)\n         , m_string(s)\n         , m_data(e->GetStringChars(s, 0))\n         , m_size(get_size(e, s))\n+        , m_delete_jstring_ref_on_delete(delete_jstring_ref_on_delete)\n     {\n     }\n     ~JStringCharsAccessor()\n     {\n         m_env->ReleaseStringChars(m_string, m_data);\n+        if (m_delete_jstring_ref_on_delete) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cad4980186754074ab2eef1a1df7fe309f23a0bb"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ce9737185a6221c4c28956c32bcc67f75f83c83", "author": {"user": {"login": "rorbech", "name": "Claus R\u00f8rbech"}}, "url": "https://github.com/realm/realm-java/commit/1ce9737185a6221c4c28956c32bcc67f75f83c83", "committedDate": "2020-12-07T11:06:02Z", "message": "Add TODO for revisiting deletion of local reference for JstringCharsAccessor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MTk5MTM3", "url": "https://github.com/realm/realm-java/pull/7232#pullrequestreview-546199137", "createdAt": "2020-12-07T14:27:01Z", "commit": {"oid": "1ce9737185a6221c4c28956c32bcc67f75f83c83"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2231, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}