{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NzEwOTQ3", "number": 11656, "title": "[BEAM-9942] reduce groovy code duplication in python test-suites", "bodyText": "Reduced Python test-suites code duplication for easy introduce of new Python versions.\nThis change affects following tests invocation.\n\npythonPreCommit\npython3xPostCommit\nportablePythonPreCommit\n\nTest-suites for Python 2 which are not applying common.gradle are left as it is considering Python 2.7 support will be dropped in the near future.\nAnd tests specific version tied like hdfsIntegrationTest will be  modified version-switchable in another PR.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-05-10T12:07:19Z", "url": "https://github.com/apache/beam/pull/11656", "merged": true, "mergeCommit": {"oid": "873a3aa76d9c7a5877ee29e27010299e4b7ee9a4"}, "closed": true, "closedAt": "2020-05-13T20:16:08Z", "author": {"login": "lazylynx"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgPvf9gH2gAyNDE1NzEwOTQ3OjZmNjkzOTYwZmFkM2E0NjgzYmM5MTliZDhlYzIzYTBlNDBkNGQ2Y2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcg8rpNAFqTQxMTE1NjUyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6f693960fad3a4683bc919bd8ec23a0e40d4d6cb", "author": {"user": {"login": "lazylynx", "name": "yoshiki.obata"}}, "url": "https://github.com/apache/beam/commit/6f693960fad3a4683bc919bd8ec23a0e40d4d6cb", "committedDate": "2020-05-11T13:32:07Z", "message": "[BEAM-9942] reduce groovy code duplication in python test-suites"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3cbaeb290b1eb62fa4350356411179878070d703", "author": {"user": {"login": "lazylynx", "name": "yoshiki.obata"}}, "url": "https://github.com/apache/beam/commit/3cbaeb290b1eb62fa4350356411179878070d703", "committedDate": "2020-05-10T11:54:33Z", "message": "[BEAM-9942] reduce groovy code duplication in python test-suites"}, "afterCommit": {"oid": "6f693960fad3a4683bc919bd8ec23a0e40d4d6cb", "author": {"user": {"login": "lazylynx", "name": "yoshiki.obata"}}, "url": "https://github.com/apache/beam/commit/6f693960fad3a4683bc919bd8ec23a0e40d4d6cb", "committedDate": "2020-05-11T13:32:07Z", "message": "[BEAM-9942] reduce groovy code duplication in python test-suites"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMTU2NTI3", "url": "https://github.com/apache/beam/pull/11656#pullrequestreview-411156527", "createdAt": "2020-05-13T17:43:22Z", "commit": {"oid": "6f693960fad3a4683bc919bd8ec23a0e40d4d6cb"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzo0MzoyMlrOGU8pDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzo1MjozMlrOGU8-qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYxODI1NA==", "bodyText": "We can move preCommitIT out as well, in a separate change. This is an example of a test that we currently run against only one of high priority versions.", "url": "https://github.com/apache/beam/pull/11656#discussion_r424618254", "createdAt": "2020-05-13T17:43:22Z", "author": {"login": "tvalentyn"}, "path": "sdks/python/test-suites/dataflow/py37/build.gradle", "diffHunk": "@@ -24,19 +24,12 @@ dependencies {\n   distTarBall project(path: \":sdks:python\", configuration: \"distTarBall\")\n }\n \n-// Required to setup a Python 3 virtualenv.\n+// Required to setup a Python 3 virtualenv and task names.\n pythonVersion = '3.7'\n-\n+apply from: \"../common.gradle\"\n \n def runScriptsDir = \"${rootDir}/sdks/python/scripts\"\n \n-// Basic test options for ITs running on Jenkins.\n-def basicTestOpts = [\n-    \"--nocapture\",  // print stdout instantly\n-    \"--processes=8\",  // run tests in parallel\n-    \"--process-timeout=4500\", // timeout of whole command execution\n-]\n-\n def preCommitIT(String runScriptsDir, String envdir, Boolean streaming, Boolean runnerV2) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f693960fad3a4683bc919bd8ec23a0e40d4d6cb"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYyMzc4NQ==", "bodyText": "CrossLanguage tests, SparkVR tests, also need to be configured to run against one of high-priority versions, looks like currently they are hardcoded to run in Python 2. This can be also done in a future change.  Feel free to open a JIRA to to track this cleanup.", "url": "https://github.com/apache/beam/pull/11656#discussion_r424623785", "createdAt": "2020-05-13T17:52:32Z", "author": {"login": "tvalentyn"}, "path": "sdks/python/test-suites/portable/py2/build.gradle", "diffHunk": "@@ -113,28 +98,6 @@ task crossLanguagePortableWordCount {\n   }\n }\n \n-task postCommitPy2IT {\n-  dependsOn 'installGcpTest'\n-  dependsOn 'setupVirtualenv'\n-  dependsOn ':runners:flink:1.10:job-server:shadowJar'\n-\n-  doLast {\n-    def tests = [\n-        \"apache_beam.io.gcp.bigquery_read_it_test\",\n-    ]\n-    def testOpts = [\"--tests=${tests.join(',')}\"]\n-    def cmdArgs = mapToArgString([\n-        \"test_opts\": testOpts,\n-        \"suite\": \"postCommitIT-flink-py2\",\n-        \"pipeline_opts\": \"--runner=FlinkRunner --project=apache-beam-testing --environment_type=LOOPBACK --temp_location=gs://temp-storage-for-end-to-end-tests/temp-it\",\n-    ])\n-    exec {\n-      executable 'sh'\n-      args '-c', \". ${envdir}/bin/activate && ${runScriptsDir}/run_integration_test.sh $cmdArgs\"\n-    }\n-  }\n-}\n-\n task crossLanguageTests {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f693960fad3a4683bc919bd8ec23a0e40d4d6cb"}, "originalPosition": 53}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4930, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}