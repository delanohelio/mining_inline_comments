{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5NDc0NjU0", "number": 13436, "title": "[BEAM-11075] Go SDK SideInput load tests", "bodyText": "This PR adds SideInput load tests for Go SDK.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-11-30T11:12:55Z", "url": "https://github.com/apache/beam/pull/13436", "merged": true, "mergeCommit": {"oid": "ded03252412b566137eea6c7a2c2ded5e31e4dc2"}, "closed": true, "closedAt": "2020-12-16T09:45:25Z", "author": {"login": "tszerszen"}, "timelineItems": {"totalCount": 45, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdfQV1WgH2gAyNTI5NDc0NjU0OmRjZGVhNjU4NjQ1YjgwYzQ3YzQ3YzI3ZTRkMDJjYjlmMzc1ZmExMzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmrwOagFqTU1MzUxMzkzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dcdea658645b80c47c47c27e4d02cb9f375fa134", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/dcdea658645b80c47c47c27e4d02cb9f375fa134", "committedDate": "2020-11-23T07:51:13Z", "message": "sideinput go"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dbaed0861ef4419e1c0a2ab52cf92ba7c7c582e", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/2dbaed0861ef4419e1c0a2ab52cf92ba7c7c582e", "committedDate": "2020-11-23T08:40:37Z", "message": "wip: sideinput try to change collection to iterable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "029410062d018e8ed9d9369165676a107cd7f74b", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/029410062d018e8ed9d9369165676a107cd7f74b", "committedDate": "2020-11-23T10:46:55Z", "message": "sideinput"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56b5cde721cfe02f623c6bed2d63293b79bf1ee2", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/56b5cde721cfe02f623c6bed2d63293b79bf1ee2", "committedDate": "2020-11-26T07:55:13Z", "message": "error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf840742e77dc141d8218cea4b419221ee81a4ab", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/bf840742e77dc141d8218cea4b419221ee81a4ab", "committedDate": "2020-11-26T08:10:05Z", "message": "Merge branch 'master' into go_sdk_sideinput"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a803f76d825322aa9164708ccb6f4ea4baaa1a9", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/9a803f76d825322aa9164708ccb6f4ea4baaa1a9", "committedDate": "2020-11-26T08:59:19Z", "message": "look for kv type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd4e053f57082380df0427a2a4d96ec21dd82c19", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/fd4e053f57082380df0427a2a4d96ec21dd82c19", "committedDate": "2020-11-26T09:59:04Z", "message": "elementsToAcccess from numElements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b568ceab46d871b67101f387346c426117bf711", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/0b568ceab46d871b67101f387346c426117bf711", "committedDate": "2020-11-26T10:11:21Z", "message": "sideinput with array works"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8ac0796fe3ce9ccb4739899a4f7dd8dfc455971", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/b8ac0796fe3ce9ccb4739899a4f7dd8dfc455971", "committedDate": "2020-11-26T10:33:36Z", "message": "sideinput with array works"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5534379491dd2c5ef203839d8d37a293ff45c42c", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/5534379491dd2c5ef203839d8d37a293ff45c42c", "committedDate": "2020-11-27T07:35:48Z", "message": "sideinput iterator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "014df350b6f9daf4e4d549eceaff51ac01c0ac03", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/014df350b6f9daf4e4d549eceaff51ac01c0ac03", "committedDate": "2020-11-29T15:17:16Z", "message": "sideinput v3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40857ca524bfa399532dac51cc389e7c0b5b3ec0", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/40857ca524bfa399532dac51cc389e7c0b5b3ec0", "committedDate": "2020-11-29T16:27:33Z", "message": "go sideinput"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e074d297f9fcf3d7b466fb378fb671b5618b235d", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/e074d297f9fcf3d7b466fb378fb671b5618b235d", "committedDate": "2020-11-30T09:49:54Z", "message": "i++"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e5b680f3a09b4ce0a4f01fb97d2099e6f1cef81", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/0e5b680f3a09b4ce0a4f01fb97d2099e6f1cef81", "committedDate": "2020-11-30T11:08:34Z", "message": "add load test .groovy and build sideinput in build.gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e77516f1fdf942cd1bc58e1049e781af75ac05c", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/3e77516f1fdf942cd1bc58e1049e781af75ac05c", "committedDate": "2020-11-30T11:17:41Z", "message": "remove .list from sideinput loadtest groovy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwODMwOTk4", "url": "https://github.com/apache/beam/pull/13436#pullrequestreview-540830998", "createdAt": "2020-11-30T11:43:05Z", "commit": {"oid": "3e77516f1fdf942cd1bc58e1049e781af75ac05c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTo0MzowNlrOH73avQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTo0MzowNlrOH73avQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUzNTk5Nw==", "bodyText": "Why ${now}? We would quickly end up with tons of different measurements in the database with only one element.", "url": "https://github.com/apache/beam/pull/13436#discussion_r532535997", "createdAt": "2020-11-30T11:43:06Z", "author": {"login": "kamilwu"}, "path": ".test-infra/jenkins/job_LoadTests_SideInput_Flink_Go.groovy", "diffHunk": "@@ -0,0 +1,101 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import CommonTestProperties\n+import CommonJobProperties as commonJobProperties\n+import LoadTestsBuilder as loadTestsBuilder\n+import PhraseTriggeringPostCommitBuilder\n+import InfluxDBCredentialsHelper\n+\n+def now = new Date().format(\"MMddHHmmss\", TimeZone.getTimeZone('UTC'))\n+\n+def fromTemplate = { mode, name, id, testSpecificOptions ->\n+  [\n+    title          : \"SideInput Go Load test: ${name}\",\n+    test           : 'sideinput',\n+    runner         : CommonTestProperties.Runner.FLINK,\n+    pipelineOptions: [\n+      job_name           : \"load-tests-go-flink-${mode}-sideinput-${id}-${now}\",\n+      influx_namespace   : 'flink',\n+      influx_measurement : \"go_${mode}_sideinput_${id}_${now}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e77516f1fdf942cd1bc58e1049e781af75ac05c"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwODMyMTQx", "url": "https://github.com/apache/beam/pull/13436#pullrequestreview-540832141", "createdAt": "2020-11-30T11:44:59Z", "commit": {"oid": "3e77516f1fdf942cd1bc58e1049e781af75ac05c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTo0NDo1OVrOH73eXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTo0NDo1OVrOH73eXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUzNjkyNg==", "bodyText": "Please do not provide any default values for this parameter, as it should be required.", "url": "https://github.com/apache/beam/pull/13436#discussion_r532536926", "createdAt": "2020-11-30T11:44:59Z", "author": {"login": "kamilwu"}, "path": "sdks/go/test/load/sideinput/sideinput.go", "diffHunk": "@@ -0,0 +1,82 @@\n+// Licensed to the Apache Software Foundation (ASF) under one or more\n+// contributor license agreements.  See the NOTICE file distributed with\n+// this work for additional information regarding copyright ownership.\n+// The ASF licenses this file to You under the Apache License, Version 2.0\n+// (the \"License\"); you may not use this file except in compliance with\n+// the License.  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package main\n+\n+import (\n+\t\"context\"\n+\t\"flag\"\n+\n+\t\"github.com/apache/beam/sdks/go/pkg/beam\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/io/synthetic\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/log\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/x/beamx\"\n+\t\"github.com/apache/beam/sdks/go/test/load\"\n+)\n+\n+var (\n+\taccessPercentage = flag.Int(\n+\t\t\"access_percentage\",\n+\t\t100,\n+\t\t\"Specifies the percentage of elements in the side input to be accessed.\")\n+\tsyntheticSourceConfig = flag.String(\n+\t\t\"input_options\",\n+\t\t\"{\"+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e77516f1fdf942cd1bc58e1049e781af75ac05c"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwODM2NTg0", "url": "https://github.com/apache/beam/pull/13436#pullrequestreview-540836584", "createdAt": "2020-11-30T11:51:33Z", "commit": {"oid": "3e77516f1fdf942cd1bc58e1049e781af75ac05c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTo1MTozM1rOH73tEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMTo1MTozM1rOH73tEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU0MDY5MA==", "bodyText": "beamx.Run -> beamx.RunWithMetrics. Please also add the code for sending results to the database.", "url": "https://github.com/apache/beam/pull/13436#discussion_r532540690", "createdAt": "2020-11-30T11:51:33Z", "author": {"login": "kamilwu"}, "path": "sdks/go/test/load/sideinput/sideinput.go", "diffHunk": "@@ -0,0 +1,82 @@\n+// Licensed to the Apache Software Foundation (ASF) under one or more\n+// contributor license agreements.  See the NOTICE file distributed with\n+// this work for additional information regarding copyright ownership.\n+// The ASF licenses this file to You under the Apache License, Version 2.0\n+// (the \"License\"); you may not use this file except in compliance with\n+// the License.  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package main\n+\n+import (\n+\t\"context\"\n+\t\"flag\"\n+\n+\t\"github.com/apache/beam/sdks/go/pkg/beam\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/io/synthetic\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/log\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/x/beamx\"\n+\t\"github.com/apache/beam/sdks/go/test/load\"\n+)\n+\n+var (\n+\taccessPercentage = flag.Int(\n+\t\t\"access_percentage\",\n+\t\t100,\n+\t\t\"Specifies the percentage of elements in the side input to be accessed.\")\n+\tsyntheticSourceConfig = flag.String(\n+\t\t\"input_options\",\n+\t\t\"{\"+\n+\t\t\t\"\\\"num_records\\\": 300, \"+\n+\t\t\t\"\\\"key_size\\\": 5, \"+\n+\t\t\t\"\\\"value_size\\\": 15}\",\n+\t\t\"A JSON object that describes the configuration for synthetic source\")\n+)\n+\n+func parseSyntheticConfig() synthetic.SourceConfig {\n+\tif *syntheticSourceConfig == \"\" {\n+\t\tpanic(\"--input_options not provided\")\n+\t} else {\n+\t\tencoded := []byte(*syntheticSourceConfig)\n+\t\treturn synthetic.DefaultSourceConfig().BuildFromJSON(encoded)\n+\t}\n+}\n+\n+func main() {\n+\tflag.Parse()\n+\tbeam.Init()\n+\tctx := context.Background()\n+\tp, s := beam.NewPipelineWithRoot()\n+\n+\tsyntheticConfig := parseSyntheticConfig()\n+\telementsToAccess := syntheticConfig.NumElements * *accessPercentage / 100\n+\n+\tsrc := synthetic.SourceSingle(s, syntheticConfig)\n+\tsrc = beam.ParDo(s, &load.RuntimeMonitor{}, src)\n+\n+\tsrc = beam.ParDo(s, func(_ []byte, values func(*[]byte, *[]byte) bool, emit func([]byte, []byte)) {\n+\t\tvar key []byte\n+\t\tvar value []byte\n+\t\ti := 0\n+\t\tfor values(&key, &value) {\n+\t\t\tif i == elementsToAccess {\n+\t\t\t\tbreak\n+\t\t\t}\n+\t\t\temit(key, value)\n+\t\t\ti++\n+\t\t}\n+\t}, beam.Impulse(s), beam.SideInput{Input: src})\n+\n+\tbeam.ParDo(s, &load.RuntimeMonitor{}, src)\n+\n+\tif err := beamx.Run(ctx, p); err != nil {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e77516f1fdf942cd1bc58e1049e781af75ac05c"}, "originalPosition": 79}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "437f63e6432073486f95c79e5f9d3018d64b4753", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/437f63e6432073486f95c79e5f9d3018d64b4753", "committedDate": "2020-11-30T12:16:05Z", "message": "dont use templates in loadTestJob"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2b8d7dc835c5bdbf6f16eb3cd63e385d2349701", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/e2b8d7dc835c5bdbf6f16eb3cd63e385d2349701", "committedDate": "2020-11-30T12:30:47Z", "message": "fix: run with metrics, remove now from .groovy and remove default synthetic source config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70d5d9be738ea2b9d1fdec17485605b32bd715a0", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/70d5d9be738ea2b9d1fdec17485605b32bd715a0", "committedDate": "2020-11-30T12:59:18Z", "message": "Merge branch 'master' into go_sdk_sideinput"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwODg5NDg4", "url": "https://github.com/apache/beam/pull/13436#pullrequestreview-540889488", "createdAt": "2020-11-30T13:06:26Z", "commit": {"oid": "70d5d9be738ea2b9d1fdec17485605b32bd715a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMzowNjoyN1rOH76QdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMzowNjoyN1rOH76QdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU4MjUxNw==", "bodyText": "This test is exactly the same as one below. Did you miss access_elements?\nEDIT: access_percentage", "url": "https://github.com/apache/beam/pull/13436#discussion_r532582517", "createdAt": "2020-11-30T13:06:27Z", "author": {"login": "kamilwu"}, "path": ".test-infra/jenkins/job_LoadTests_SideInput_Flink_Go.groovy", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import CommonTestProperties\n+import CommonJobProperties as commonJobProperties\n+import LoadTestsBuilder as loadTestsBuilder\n+import PhraseTriggeringPostCommitBuilder\n+import InfluxDBCredentialsHelper\n+\n+def now = new Date().format(\"MMddHHmmss\", TimeZone.getTimeZone('UTC'))\n+\n+def batchScenarios = {\n+  [\n+    [\n+      title          : 'SideInput Go Load test: 10gb-1kb-10workers-1window-first-iterable',\n+      test           : 'sideinput',\n+      runner         : CommonTestProperties.Runner.FLINK,\n+      pipelineOptions: [\n+        job_name           : \"load-tests-go-flink-batch-sideinput-1-${now}\",\n+        influx_namespace   : 'flink',\n+        influx_measurement : 'go_batch_sideinput_1',\n+        input_options      : '\\'{' +\n+        '\"num_records\": 10000000,' +\n+        '\"key_size\": 100,' +\n+        '\"value_size\": 900}\\'',\n+        parallelism        : 10,\n+        endpoint           : 'localhost:8099',\n+        environment_type   : 'DOCKER',\n+        environment_config : \"${DOCKER_CONTAINER_REGISTRY}/beam_go_sdk:latest\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70d5d9be738ea2b9d1fdec17485605b32bd715a0"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwODk1NjY0", "url": "https://github.com/apache/beam/pull/13436#pullrequestreview-540895664", "createdAt": "2020-11-30T13:14:41Z", "commit": {"oid": "70d5d9be738ea2b9d1fdec17485605b32bd715a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMzoxNDo0MVrOH76jMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMzoxNDo0MVrOH76jMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU4NzMxNQ==", "bodyText": "You cannot use 1 here. This number is an ID that uniquely identifies the test. For side input tests:\n\n1 corresponds to the 1gb-1kb-10workers-1window-1key-percent-dict test\n2 corresponds to the 1gb-1kb-10workers-1window-99key-percent-dict test\nand so on and so forth. You can see a full set of side input tests here: https://github.com/apache/beam/blob/master/.test-infra/jenkins/job_LoadTests_SideInput_Python.groovy", "url": "https://github.com/apache/beam/pull/13436#discussion_r532587315", "createdAt": "2020-11-30T13:14:41Z", "author": {"login": "kamilwu"}, "path": ".test-infra/jenkins/job_LoadTests_SideInput_Flink_Go.groovy", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import CommonTestProperties\n+import CommonJobProperties as commonJobProperties\n+import LoadTestsBuilder as loadTestsBuilder\n+import PhraseTriggeringPostCommitBuilder\n+import InfluxDBCredentialsHelper\n+\n+def now = new Date().format(\"MMddHHmmss\", TimeZone.getTimeZone('UTC'))\n+\n+def batchScenarios = {\n+  [\n+    [\n+      title          : 'SideInput Go Load test: 10gb-1kb-10workers-1window-first-iterable',\n+      test           : 'sideinput',\n+      runner         : CommonTestProperties.Runner.FLINK,\n+      pipelineOptions: [\n+        job_name           : \"load-tests-go-flink-batch-sideinput-1-${now}\",\n+        influx_namespace   : 'flink',\n+        influx_measurement : 'go_batch_sideinput_1',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70d5d9be738ea2b9d1fdec17485605b32bd715a0"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e8c20ae8a9ddbe32a0287fda12ac09b9bcab841", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/6e8c20ae8a9ddbe32a0287fda12ac09b9bcab841", "committedDate": "2020-11-30T13:18:54Z", "message": "change corresponding tests numbers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54cedb599d8afbf7e81a290d1d4580ba3cea6fa4", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/54cedb599d8afbf7e81a290d1d4580ba3cea6fa4", "committedDate": "2020-11-30T13:23:23Z", "message": "fix access_percentage in first test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "356a762f446f7d5b41f0f65a6c14ba0909a25f5d", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/356a762f446f7d5b41f0f65a6c14ba0909a25f5d", "committedDate": "2020-11-30T13:38:06Z", "message": "add import import static LoadTestsBuilder.DOCKER_CONTAINER_REGISTRY"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad7247b09879585036247b827b9d52a8b23d6a9a", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/ad7247b09879585036247b827b9d52a8b23d6a9a", "committedDate": "2020-12-01T10:05:21Z", "message": "func must be registered"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feeb905c433054894c48b4bcb46c4a89cb7aba5b", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/feeb905c433054894c48b4bcb46c4a89cb7aba5b", "committedDate": "2020-12-01T12:18:45Z", "message": "registerDoFn"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8debda23e867632bcf86ab57aed77189d3e28ca9", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/8debda23e867632bcf86ab57aed77189d3e28ca9", "committedDate": "2020-12-01T12:20:02Z", "message": "registerDoFn"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "376eaf92cf214c9d5d232ad93cd5da9908c52c41", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/376eaf92cf214c9d5d232ad93cd5da9908c52c41", "committedDate": "2020-12-01T14:06:33Z", "message": "fix errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NDg1NTgy", "url": "https://github.com/apache/beam/pull/13436#pullrequestreview-547485582", "createdAt": "2020-12-08T17:55:30Z", "commit": {"oid": "376eaf92cf214c9d5d232ad93cd5da9908c52c41"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNzo1NTozMVrOIBtayQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNzo1NTozMVrOIBtayQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY2MzYyNQ==", "bodyText": "This isn't the main problem, we're debugging, but Structural DoFn fields must be exported to get serialized properly.\neg. ElementsToAccess instead.", "url": "https://github.com/apache/beam/pull/13436#discussion_r538663625", "createdAt": "2020-12-08T17:55:31Z", "author": {"login": "lostluck"}, "path": "sdks/go/test/load/sideinput/sideinput.go", "diffHunk": "@@ -0,0 +1,100 @@\n+// Licensed to the Apache Software Foundation (ASF) under one or more\n+// contributor license agreements.  See the NOTICE file distributed with\n+// this work for additional information regarding copyright ownership.\n+// The ASF licenses this file to You under the Apache License, Version 2.0\n+// (the \"License\"); you may not use this file except in compliance with\n+// the License.  You may obtain a copy of the License at\n+//\n+//    http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package main\n+\n+import (\n+\t\"context\"\n+\t\"flag\"\n+\t\"reflect\"\n+\n+\t\"github.com/apache/beam/sdks/go/pkg/beam\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/io/synthetic\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/log\"\n+\t\"github.com/apache/beam/sdks/go/pkg/beam/x/beamx\"\n+\t\"github.com/apache/beam/sdks/go/test/load\"\n+)\n+\n+func init() {\n+\tbeam.RegisterDoFn(reflect.TypeOf((*doFn)(nil)))\n+}\n+\n+var (\n+\taccessPercentage = flag.Int(\n+\t\t\"access_percentage\",\n+\t\t100,\n+\t\t\"Specifies the percentage of elements in the side input to be accessed.\")\n+\tsyntheticSourceConfig = flag.String(\n+\t\t\"input_options\",\n+\t\t\"\",\n+\t\t\"A JSON object that describes the configuration for synthetic source\")\n+)\n+\n+func parseSyntheticConfig() synthetic.SourceConfig {\n+\tif *syntheticSourceConfig == \"\" {\n+\t\tpanic(\"--input_options not provided\")\n+\t} else {\n+\t\tencoded := []byte(*syntheticSourceConfig)\n+\t\treturn synthetic.DefaultSourceConfig().BuildFromJSON(encoded)\n+\t}\n+}\n+\n+type doFn struct {\n+\telementsToAccess int", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "376eaf92cf214c9d5d232ad93cd5da9908c52c41"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f89cce0562ba19369b28287bfd2cb77915be5eba", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/f89cce0562ba19369b28287bfd2cb77915be5eba", "committedDate": "2020-12-08T22:50:31Z", "message": "make Structural DoFn field as exported"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27b5ec8c99cdf585a1f30ef7934bb419fddf143b", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/27b5ec8c99cdf585a1f30ef7934bb419fddf143b", "committedDate": "2020-12-08T23:14:03Z", "message": "merge master into sideinput"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b95846e34f0be539f82cd9a81e201edcb0a9aad7", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/b95846e34f0be539f82cd9a81e201edcb0a9aad7", "committedDate": "2020-12-09T10:46:26Z", "message": "skip 10gb sideinput load tests add 2gb sideinput load test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f0eec40f566cf999645e2db477ef1bb34eecf11", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/8f0eec40f566cf999645e2db477ef1bb34eecf11", "committedDate": "2020-12-09T12:57:38Z", "message": "sideinput 7 and 8 with 500mb data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e652be9b63ee0bc5b842f4d32581f16b38b66d8", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/9e652be9b63ee0bc5b842f4d32581f16b38b66d8", "committedDate": "2020-12-09T16:30:42Z", "message": "400mb works both on dataflow and flink"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3be1cf922ea0e5912279ad8f4ce2c9f5874cf464", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/3be1cf922ea0e5912279ad8f4ce2c9f5874cf464", "committedDate": "2020-12-09T16:35:24Z", "message": "400mb works both on dataflow and flink"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64123f3a058590df261ff6f310b6b8e9ea4861f0", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/64123f3a058590df261ff6f310b6b8e9ea4861f0", "committedDate": "2020-12-14T13:46:15Z", "message": "add dataflow groovy for jenkins, add comment which informs that 400mb sideinput test is max for now"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNDk1OTM5", "url": "https://github.com/apache/beam/pull/13436#pullrequestreview-551495939", "createdAt": "2020-12-14T15:43:45Z", "commit": {"oid": "64123f3a058590df261ff6f310b6b8e9ea4861f0"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNTo0Mzo0NVrOIFWv9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNTo0NzoxMFrOIFW6ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ4NjUxNg==", "bodyText": "In the Flink job, the title begins with 10gb, while here it begins with 400mb. Please choose one of these and stick to it.", "url": "https://github.com/apache/beam/pull/13436#discussion_r542486516", "createdAt": "2020-12-14T15:43:45Z", "author": {"login": "kamilwu"}, "path": ".test-infra/jenkins/job_LoadTests_SideInput_Go.groovy", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+import CommonJobProperties as commonJobProperties\n+import CommonTestProperties\n+import LoadTestsBuilder as loadTestsBuilder\n+import PhraseTriggeringPostCommitBuilder\n+import InfluxDBCredentialsHelper\n+\n+String now = new Date().format('MMddHHmmss', TimeZone.getTimeZone('UTC'))\n+\n+def batchScenarios = {\n+  [\n+    [\n+      title          : 'SideInput Go Load test: 400mb-1kb-10workers-1window-first-iterable',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64123f3a058590df261ff6f310b6b8e9ea4861f0"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ4OTE5NA==", "bodyText": "The comment is OK, but you should also specify additional options for Flink. And while there is a link to Python Jenkins job, you could also add links to your newly defined jobs.", "url": "https://github.com/apache/beam/pull/13436#discussion_r542489194", "createdAt": "2020-12-14T15:47:10Z", "author": {"login": "kamilwu"}, "path": ".test-infra/metrics/grafana/dashboards/perftests_metrics/SideInput_Load_Tests.json", "diffHunk": "@@ -21,7 +21,7 @@\n   \"links\": [],\n   \"panels\": [\n     {\n-      \"content\": \"The following options are common to all tests:\\n* key size: 100B\\n* value size: 900B\\n* number of workers: 10\\n* size of the window (if fixed windows are used): 1 second\\n\\nAdditional common options for Dataflow:\\n* experiments: use_runner_v2\\n* autoscaling_algorithm: NONE\\n\\n\\n[Jenkins job definition (Python, Dataflow)](https://github.com/apache/beam/blob/master/.test-infra/jenkins/job_LoadTests_SideInput_Python.groovy)\\n\\n\",\n+      \"content\": \"The following options are common to all tests:\\n* key size: 100B\\n* value size: 900B\\n* number of workers: 10\\n* size of the window (if fixed windows are used): 1 second\\n\\nAdditional common options for Dataflow:\\n* experiments: use_runner_v2\\n* autoscaling_algorithm: NONE\\n\\n\\n[Jenkins job definition (Python, Dataflow)](https://github.com/apache/beam/blob/master/.test-infra/jenkins/job_LoadTests_SideInput_Python.groovy)\\n\\nUntil the issue [BEAM-11427](https://issues.apache.org/jira/browse/BEAM-11427) in Go SDK is resolved, sideinput iteration test have 400MB, instead of 10GB.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64123f3a058590df261ff6f310b6b8e9ea4861f0"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b7c6c75e7ac9a59199f148e61e888f833f70f79", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/0b7c6c75e7ac9a59199f148e61e888f833f70f79", "committedDate": "2020-12-14T20:58:36Z", "message": "10gb -> 400mb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f87d89ad7025783229a88fc930f64968b421018a", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/f87d89ad7025783229a88fc930f64968b421018a", "committedDate": "2020-12-14T21:01:44Z", "message": "Merge branch 'master' of https://github.com/apache/beam into go_sdk_sideinput"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "067fe64f1902cf0766b95be3b096daaebc4d3e75", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/067fe64f1902cf0766b95be3b096daaebc4d3e75", "committedDate": "2020-12-15T09:23:40Z", "message": "add links to groovy Jenkins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "868d292b25282d8347838a7e056ee5ecd64dd958", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/868d292b25282d8347838a7e056ee5ecd64dd958", "committedDate": "2020-12-15T09:29:25Z", "message": "add links to groovy Jenkins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98ce479d735140e1628bd474eaf08ef6397c7e78", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/98ce479d735140e1628bd474eaf08ef6397c7e78", "committedDate": "2020-12-15T12:23:41Z", "message": "make grafana sideinput smaller"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNTEzOTM0", "url": "https://github.com/apache/beam/pull/13436#pullrequestreview-553513934", "createdAt": "2020-12-16T09:44:57Z", "commit": {"oid": "98ce479d735140e1628bd474eaf08ef6397c7e78"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4624, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}