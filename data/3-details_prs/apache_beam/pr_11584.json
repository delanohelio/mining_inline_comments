{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExODI0NTcz", "number": 11584, "title": "[BEAM-9136]support isRelease tag for docker build command & update release guide", "bodyText": "R: @tvalentyn\nCc: @ibzib\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-04-30T20:41:22Z", "url": "https://github.com/apache/beam/pull/11584", "merged": true, "mergeCommit": {"oid": "8862c370c5142d10246c079c5d6c62a8592807ec"}, "closed": true, "closedAt": "2020-05-15T18:25:37Z", "author": {"login": "Hannah-Jiang"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcczTsjABqjMyOTEyNjk3OTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcha9AagBqjMzMzkzNzIzNTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "450861839321d784da7bea1dd135d85ee2aa0bee", "author": {"user": {"login": "Hannah-Jiang", "name": "Hannah Jiang"}}, "url": "https://github.com/apache/beam/commit/450861839321d784da7bea1dd135d85ee2aa0bee", "committedDate": "2020-04-30T20:39:31Z", "message": "support isRelease tag for docker build command & update release guide"}, "afterCommit": {"oid": "54754a11dc28abd5f4cfd05cbc7c47461a1e6d4d", "author": {"user": {"login": "Hannah-Jiang", "name": "Hannah Jiang"}}, "url": "https://github.com/apache/beam/commit/54754a11dc28abd5f4cfd05cbc7c47461a1e6d4d", "committedDate": "2020-04-30T20:42:21Z", "message": "support isRelease tag for docker build command & update release guide"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzODY0NzI4", "url": "https://github.com/apache/beam/pull/11584#pullrequestreview-403864728", "createdAt": "2020-04-30T20:45:58Z", "commit": {"oid": "450861839321d784da7bea1dd135d85ee2aa0bee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQyMDo0NjoxOVrOGO5uAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQyMDo0NjoxOVrOGO5uAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODI3ODkxNA==", "bodyText": "Currently, the isRelease tag needs to be passed with commands. Ideally, this tag should be set by checking branch name.\nDetecting isRelease for docker image build is not that helpful for now, but could be used when we support auto setting isRelease tag.", "url": "https://github.com/apache/beam/pull/11584#discussion_r418278914", "createdAt": "2020-04-30T20:46:19Z", "author": {"login": "Hannah-Jiang"}, "path": "sdks/python/container/py2/build.gradle", "diffHunk": "@@ -66,7 +66,8 @@ docker {\n                   project.rootProject[\"docker-tag\"] : project.sdk_version)\n   files \"../Dockerfile\", \"./build\"\n   buildArgs(['py_version': \"2.7\",\n-             'pull_licenses': project.rootProject.hasProperty([\"docker-pull-licenses\"])])\n+             'pull_licenses': project.rootProject.hasProperty([\"docker-pull-licenses\"]) ||\n+                     project.rootProject.hasProperty([\"isRelease\"])])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54754a11dc28abd5f4cfd05cbc7c47461a1e6d4d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTM5MzEz", "url": "https://github.com/apache/beam/pull/11584#pullrequestreview-403939313", "createdAt": "2020-04-30T23:14:45Z", "commit": {"oid": "54754a11dc28abd5f4cfd05cbc7c47461a1e6d4d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NDMzODA2", "url": "https://github.com/apache/beam/pull/11584#pullrequestreview-404433806", "createdAt": "2020-05-01T22:37:44Z", "commit": {"oid": "54754a11dc28abd5f4cfd05cbc7c47461a1e6d4d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMjozNzo0NFrOGPXduA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQyMjozOTozN1rOGPXfyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc2NjI2NA==", "bodyText": "@ibzib , this part should be verified BEFORE pushing Python images. I'm not sure when this PR can be merged because of website issues, so explicitly pinging you here.", "url": "https://github.com/apache/beam/pull/11584#discussion_r418766264", "createdAt": "2020-05-01T22:37:44Z", "author": {"login": "Hannah-Jiang"}, "path": "website/src/contribute/release-guide.md", "diffHunk": "@@ -688,8 +688,20 @@ Verify that files are [present](https://dist.apache.org/repos/dist/dev/beam).\n * Build Python images and push to DockerHub.\n \n ```\n-./gradlew :sdks:python:container:buildAll -Pdocker-tag=${RELEASE}_rc{RC_NUM}\n+./gradlew :sdks:python:container:buildAll -Pdocker-pull-licenses -Pdocker-tag=${RELEASE}_rc{RC_NUM}\n+```\n+\n+Verify that third party licenses are included by logging in to the images. For Python SDK images, there should be around 80 ~ 100 dependencies. \n+Please note that dependencies for the SDKs with different Python versions vary. \n+Need to verify all Python images by replacing `${ver}` in the following command to `python2.7, python3.5, python3.6, python3.7`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54754a11dc28abd5f4cfd05cbc7c47461a1e6d4d"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc2Njc5NQ==", "bodyText": "@ibzib , this part changed slightly. Please note the change from dockerPush to docker at L714.\nAfter creating the Java image, we should verify it BEFORE pushing to DockerHub. I'm not sure when this PR can be merged because of website issues, so explicitly pinging you here.", "url": "https://github.com/apache/beam/pull/11584#discussion_r418766795", "createdAt": "2020-05-01T22:39:37Z", "author": {"login": "Hannah-Jiang"}, "path": "website/src/contribute/release-guide.md", "diffHunk": "@@ -699,7 +711,18 @@ done\n * Build Java images and push to DockerHub.\n \n ```\n-./gradlew :sdks:java:container:dockerPush -Pdocker-pull-licenses -Pdocker-tag=${RELEASE}_rc{RC_NUM}\n+./gradlew :sdks:java:container:docker -Pdocker-pull-licenses -Pdocker-tag=${RELEASE}_rc{RC_NUM}\n+```\n+\n+Verify that third party licenses are included by logging in to the images. For Java SDK images, there should be around 1400 dependencies. \n+```\n+docker run -it --entrypoint=/bin/bash apache/beam_java_sdk:${RELEASE}_rc{RC_NUM}\n+ls -al /opt/apache/beam/third_party_licenses/ | wc -l\n+```\n+\n+After verifying the third party licenses are included correctly, push the images to DockerHub.\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54754a11dc28abd5f4cfd05cbc7c47461a1e6d4d"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b75515e96a3c3f3c11b3c107cd7fda86204092f2", "author": {"user": {"login": "Hannah-Jiang", "name": "Hannah Jiang"}}, "url": "https://github.com/apache/beam/commit/b75515e96a3c3f3c11b3c107cd7fda86204092f2", "committedDate": "2020-05-15T05:09:35Z", "message": "support isRelease tag for docker build command & update release guide"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "54754a11dc28abd5f4cfd05cbc7c47461a1e6d4d", "author": {"user": {"login": "Hannah-Jiang", "name": "Hannah Jiang"}}, "url": "https://github.com/apache/beam/commit/54754a11dc28abd5f4cfd05cbc7c47461a1e6d4d", "committedDate": "2020-04-30T20:42:21Z", "message": "support isRelease tag for docker build command & update release guide"}, "afterCommit": {"oid": "b75515e96a3c3f3c11b3c107cd7fda86204092f2", "author": {"user": {"login": "Hannah-Jiang", "name": "Hannah Jiang"}}, "url": "https://github.com/apache/beam/commit/b75515e96a3c3f3c11b3c107cd7fda86204092f2", "committedDate": "2020-05-15T05:09:35Z", "message": "support isRelease tag for docker build command & update release guide"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4138, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}