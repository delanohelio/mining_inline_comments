{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMjcxNDYw", "number": 12137, "title": "[BEAM-10392] Attempt to fix/enable detection of rabbitmq:test stuckness.", "bodyText": "Ensure that the Consumer uses a thread safe object to pass the messages through (Consumer is invoked on a separate thread as per https://rabbitmq.github.io/rabbitmq-java-client/api/current/com/rabbitmq/client/Consumer.html)\nAdd a timeout for the entire test class so we can get a stack trace to narrow down where we are seeing stuckness\n\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-06-30T20:20:37Z", "url": "https://github.com/apache/beam/pull/12137", "merged": true, "mergeCommit": {"oid": "4cfd4bf73ffb239ec8c5efaab5ca6c9671e56e31"}, "closed": true, "closedAt": "2020-07-03T14:21:28Z", "author": {"login": "lukecwik"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwbjUuAH2gAyNDQyMjcxNDYwOjhiODcxZjRhZTBmYmI2YmRkZGRiZDRiYzJkODc5MWQ3NDhjMGQzY2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxUNDmAFqTQ0MjQ0NDA5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8b871f4ae0fbb6bddddbd4bc2d8791d748c0d3cb", "author": {"user": {"login": "lukecwik", "name": "Lukasz Cwik"}}, "url": "https://github.com/apache/beam/commit/8b871f4ae0fbb6bddddbd4bc2d8791d748c0d3cb", "committedDate": "2020-06-30T20:20:28Z", "message": "[BEAM-10392] Attempt to fix/enable detection of rabbitmq:test stuckness.\n\n* Ensure that the Consumer uses a thread safe object to pass the messages through (Consumer is invoked on a separate thread as per https://rabbitmq.github.io/rabbitmq-java-client/api/current/com/rabbitmq/client/Consumer.html)\n* Add a timeout for the entire test class so we can get a stack trace to narrow down where we are seeing stuckness"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f523d13c0420f944ff566e9afb26c6b431ac78a5", "author": {"user": {"login": "lukecwik", "name": "Lukasz Cwik"}}, "url": "https://github.com/apache/beam/commit/f523d13c0420f944ff566e9afb26c6b431ac78a5", "committedDate": "2020-06-30T20:15:50Z", "message": "[BEAM-10392] Attempt to fix/enable detection of rabbitmq:test stuckness.\n\n* Ensure that the Consumer uses a thread safe object to pass the messages through (Consumer is invoked on a separate thread as per https://rabbitmq.github.io/rabbitmq-java-client/api/current/com/rabbitmq/client/Consumer.html)\n* Add a timeout for the entire test class so we can get a stack trace to narrow down where we are seeing stuckness"}, "afterCommit": {"oid": "8b871f4ae0fbb6bddddbd4bc2d8791d748c0d3cb", "author": {"user": {"login": "lukecwik", "name": "Lukasz Cwik"}}, "url": "https://github.com/apache/beam/commit/8b871f4ae0fbb6bddddbd4bc2d8791d748c0d3cb", "committedDate": "2020-06-30T20:20:28Z", "message": "[BEAM-10392] Attempt to fix/enable detection of rabbitmq:test stuckness.\n\n* Ensure that the Consumer uses a thread safe object to pass the messages through (Consumer is invoked on a separate thread as per https://rabbitmq.github.io/rabbitmq-java-client/api/current/com/rabbitmq/client/Consumer.html)\n* Add a timeout for the entire test class so we can get a stack trace to narrow down where we are seeing stuckness"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNTgwMzMy", "url": "https://github.com/apache/beam/pull/12137#pullrequestreview-440580332", "createdAt": "2020-07-01T06:32:44Z", "commit": {"oid": "8b871f4ae0fbb6bddddbd4bc2d8791d748c0d3cb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwNjozMjo0NVrOGrYh8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQwNjozMjo0NVrOGrYh8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE0Mzg1Ng==", "bodyText": "nit: I doubt this matters because you only add elements to the received list. but might be safer style to use the same reference instead of calling getReceived() 3 times. Which ensures the exact same snapshot. Up to you if you want to change it.", "url": "https://github.com/apache/beam/pull/12137#discussion_r448143856", "createdAt": "2020-07-01T06:32:45Z", "author": {"login": "ajamato"}, "path": "sdks/java/io/rabbitmq/src/test/java/org/apache/beam/sdk/io/rabbitmq/RabbitMqIOTest.java", "diffHunk": "@@ -396,18 +394,18 @@ public void testWriteQueue() throws Exception {\n       connection = connectionFactory.newConnection();\n       channel = connection.createChannel();\n       channel.queueDeclare(\"TEST\", true, false, false, null);\n-      Consumer consumer = new RabbitMqTestUtils.TestConsumer(channel, received);\n+      RabbitMqTestUtils.TestConsumer consumer = new RabbitMqTestUtils.TestConsumer(channel);\n       channel.basicConsume(\"TEST\", true, consumer);\n \n       p.run();\n \n-      while (received.size() < maxNumRecords) {\n+      while (consumer.getReceived().size() < maxNumRecords) {\n         Thread.sleep(500);\n       }\n \n-      assertEquals(maxNumRecords, received.size());\n+      assertEquals(maxNumRecords, consumer.getReceived().size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b871f4ae0fbb6bddddbd4bc2d8791d748c0d3cb"}, "originalPosition": 110}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNzU3MTUw", "url": "https://github.com/apache/beam/pull/12137#pullrequestreview-440757150", "createdAt": "2020-07-01T10:46:50Z", "commit": {"oid": "8b871f4ae0fbb6bddddbd4bc2d8791d748c0d3cb"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNDQ0MDkw", "url": "https://github.com/apache/beam/pull/12137#pullrequestreview-442444090", "createdAt": "2020-07-03T14:20:44Z", "commit": {"oid": "8b871f4ae0fbb6bddddbd4bc2d8791d748c0d3cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3248, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}