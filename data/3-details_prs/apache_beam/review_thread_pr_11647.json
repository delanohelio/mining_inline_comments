{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NDc4MDc0", "number": 11647, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzoxMzozNVrOD7VHJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzoxNjozOVrOD7VMBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTM4NDcwOnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzoxMzozNVrOGTlnXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzoxMzozNVrOGTlnXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5MjQxNQ==", "bodyText": "Can you add some comments here or in class comment so clarify the ordering of getting planner names? E.g. get the class name set in SqlTransform first and the try pipeline options.", "url": "https://github.com/apache/beam/pull/11647#discussion_r423192415", "createdAt": "2020-05-11T17:13:35Z", "author": {"login": "amaliujia"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -103,6 +105,8 @@\n \n   abstract @Nullable String defaultTableProvider();\n \n+  abstract @Nullable String queryPlannerClassName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7198723f94eb05879a45969ddbcb99dcb06d897a"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTM5MTY3OnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/zetasql/src/test/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSQLDialectSpecTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzoxNToyM1rOGTlr3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzoxNToyM1rOGTlr3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5MzU2Ng==", "bodyText": "Can you add a test to show when withQueryPlannerClass(ZetaSQLQueryPlanner.class) is not used and BeamSqlPipelineOptions is set (to test that the ordering of finding the planner name is working).", "url": "https://github.com/apache/beam/pull/11647#discussion_r423193566", "createdAt": "2020-05-11T17:15:23Z", "author": {"login": "amaliujia"}, "path": "sdks/java/extensions/sql/zetasql/src/test/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSQLDialectSpecTest.java", "diffHunk": "@@ -144,6 +145,34 @@ public void testSimpleSelect() {\n     pipeline.run().waitUntilFinish(Duration.standardMinutes(PIPELINE_EXECUTION_WAITTIME_MINUTES));\n   }\n \n+  @Test\n+  public void testSimpleSelectWithPlannerName() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7198723f94eb05879a45969ddbcb99dcb06d897a"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzNTM5NzE4OnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzoxNjozOVrOGTlvPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMDowOTo1NlrOGTrjeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5NDQyOQ==", "bodyText": "Do you think if it is helpful to find a \"working\" class name, rather than a \"non null\" parameter? (meaning that try first class name even if it is non-null, if there is an exception, try the next one.)", "url": "https://github.com/apache/beam/pull/11647#discussion_r423194429", "createdAt": "2020-05-11T17:16:39Z", "author": {"login": "amaliujia"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -123,7 +127,9 @@\n     }\n \n     sqlEnvBuilder.setQueryPlannerClassName(\n-        input.getPipeline().getOptions().as(BeamSqlPipelineOptions.class).getPlannerName());\n+        MoreObjects.firstNonNull(\n+            queryPlannerClassName(),\n+            input.getPipeline().getOptions().as(BeamSqlPipelineOptions.class).getPlannerName()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7198723f94eb05879a45969ddbcb99dcb06d897a"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3MTc4OQ==", "bodyText": "Hm.. I think maybe that would be surprising for the user.\nI think it would be better to just try to use a non-working class name and fail, than to fall back to a different planner - since changing the planner has implications on acceptable query syntax.", "url": "https://github.com/apache/beam/pull/11647#discussion_r423271789", "createdAt": "2020-05-11T19:35:14Z", "author": {"login": "TheNeuralBit"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -123,7 +127,9 @@\n     }\n \n     sqlEnvBuilder.setQueryPlannerClassName(\n-        input.getPipeline().getOptions().as(BeamSqlPipelineOptions.class).getPlannerName());\n+        MoreObjects.firstNonNull(\n+            queryPlannerClassName(),\n+            input.getPipeline().getOptions().as(BeamSqlPipelineOptions.class).getPlannerName()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5NDQyOQ=="}, "originalCommit": {"oid": "7198723f94eb05879a45969ddbcb99dcb06d897a"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4OTcyMA==", "bodyText": "that makes sense", "url": "https://github.com/apache/beam/pull/11647#discussion_r423289720", "createdAt": "2020-05-11T20:09:56Z", "author": {"login": "amaliujia"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -123,7 +127,9 @@\n     }\n \n     sqlEnvBuilder.setQueryPlannerClassName(\n-        input.getPipeline().getOptions().as(BeamSqlPipelineOptions.class).getPlannerName());\n+        MoreObjects.firstNonNull(\n+            queryPlannerClassName(),\n+            input.getPipeline().getOptions().as(BeamSqlPipelineOptions.class).getPlannerName()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5NDQyOQ=="}, "originalCommit": {"oid": "7198723f94eb05879a45969ddbcb99dcb06d897a"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3886, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}