{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4MjUzNTU3", "number": 13434, "title": "[BEAM-11357] Add annotations to PTransforms and enable them in Go SDK", "bodyText": "Adds annotations to PTransform and enables them in Go SDK as described in https://lists.apache.org/thread.html/ra4f90560ac82bdbedfef36b3cd508da70ee7cf23383a0451d3875e45%40%3Cdev.beam.apache.org%3E.\n\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-11-26T20:14:03Z", "url": "https://github.com/apache/beam/pull/13434", "merged": true, "mergeCommit": {"oid": "e2e777a828f1ed36b4e61aa1a5d3c9118b4783e6"}, "closed": true, "closedAt": "2021-01-13T22:54:08Z", "author": {"login": "miracvbasaran"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgBwTygH2gAyNTI4MjUzNTU3OmUyZDc3NWY0ZDU5YWEyZDhiYWY1NWJmZGU2MWUwNDkxMTY1MjE1Y2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdv3z5CAFqTU2NzcyNDM1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e2d775f4d59aa2d8baf55bfde61e0491165215ce", "author": {"user": {"login": "miracvbasaran", "name": "Mira\u00e7 Vuslat Ba\u015faran"}}, "url": "https://github.com/apache/beam/commit/e2d775f4d59aa2d8baf55bfde61e0491165215ce", "committedDate": "2020-11-25T17:25:29Z", "message": "Add annotation to PTransforms and enable them in Go SDK"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "118c52953790210aa8d319654f373f9aba9c7f3b", "author": {"user": {"login": "miracvbasaran", "name": "Mira\u00e7 Vuslat Ba\u015faran"}}, "url": "https://github.com/apache/beam/commit/118c52953790210aa8d319654f373f9aba9c7f3b", "committedDate": "2020-11-26T20:07:35Z", "message": "[BEAM-11357] Add annotations to PTransforms and enable them in Go SDK"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79e7182b154385312282cec6aa8eb1375f914396", "author": {"user": {"login": "miracvbasaran", "name": "Mira\u00e7 Vuslat Ba\u015faran"}}, "url": "https://github.com/apache/beam/commit/79e7182b154385312282cec6aa8eb1375f914396", "committedDate": "2020-11-26T20:11:13Z", "message": "Merge branch 'annotations' of https://github.com/miracvbasaran/beam into annotations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NDY2NjEz", "url": "https://github.com/apache/beam/pull/13434#pullrequestreview-544466613", "createdAt": "2020-12-03T21:33:10Z", "commit": {"oid": "79e7182b154385312282cec6aa8eb1375f914396"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMTozMzoxMFrOH-1LrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMTozMzoxMFrOH-1LrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTY0NTEwMA==", "bodyText": "As discussed on the list, we specifically don't want to use these for resource preferences.", "url": "https://github.com/apache/beam/pull/13434#discussion_r535645100", "createdAt": "2020-12-03T21:33:10Z", "author": {"login": "robertwb"}, "path": "model/pipeline/src/main/proto/beam_runner_api.proto", "diffHunk": "@@ -188,6 +188,13 @@ message PTransform {\n   // Transforms that are required to be implemented by a runner must omit this.\n   // All other transforms are required to specify this.\n   string environment_id = 7;\n+\n+  // (Optional) A map from URNs designating a type of annotation, to the\n+  // annotation in binary format. For example, an annotation could indicate\n+  // that this PTransform has specific resource preferences.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79e7182b154385312282cec6aa8eb1375f914396"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MjI5ODk1", "url": "https://github.com/apache/beam/pull/13434#pullrequestreview-545229895", "createdAt": "2020-12-04T19:14:00Z", "commit": {"oid": "79e7182b154385312282cec6aa8eb1375f914396"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxOToxNDowMFrOH_ec0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxOToxNDowMFrOH_ec0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMyMTIzMg==", "bodyText": "I think we should add \"Therefore annotations MUST NOT be used for metadata that can affect correct execution of the transform.\" to to be unambiguous about the intent around this rule. It's easier to relax restrictions than to tighten them up later.", "url": "https://github.com/apache/beam/pull/13434#discussion_r536321232", "createdAt": "2020-12-04T19:14:00Z", "author": {"login": "lostluck"}, "path": "model/pipeline/src/main/proto/beam_runner_api.proto", "diffHunk": "@@ -188,6 +188,13 @@ message PTransform {\n   // Transforms that are required to be implemented by a runner must omit this.\n   // All other transforms are required to specify this.\n   string environment_id = 7;\n+\n+  // (Optional) A map from URNs designating a type of annotation, to the\n+  // annotation in binary format. For example, an annotation could indicate\n+  // that this PTransform has specific resource preferences.\n+  //\n+  // A runner MAY ignore types of annotations it doesn't understand.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79e7182b154385312282cec6aa8eb1375f914396"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e9bf8649e53f7598540c7e42ed5335bb9ded366", "author": {"user": {"login": "miracvbasaran", "name": "Mira\u00e7 Vuslat Ba\u015faran"}}, "url": "https://github.com/apache/beam/commit/3e9bf8649e53f7598540c7e42ed5335bb9ded366", "committedDate": "2020-12-30T16:42:08Z", "message": "Resolve PTransform documentation comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0NjY3Mzc5", "url": "https://github.com/apache/beam/pull/13434#pullrequestreview-564667379", "createdAt": "2021-01-09T01:05:29Z", "commit": {"oid": "3e9bf8649e53f7598540c7e42ed5335bb9ded366"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1NTM5NjAz", "url": "https://github.com/apache/beam/pull/13434#pullrequestreview-565539603", "createdAt": "2021-01-11T16:41:00Z", "commit": {"oid": "3e9bf8649e53f7598540c7e42ed5335bb9ded366"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1Njg2ODI3", "url": "https://github.com/apache/beam/pull/13434#pullrequestreview-565686827", "createdAt": "2021-01-11T19:51:22Z", "commit": {"oid": "3e9bf8649e53f7598540c7e42ed5335bb9ded366"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxOTo1MToyM1rOIRkvoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxOTo1MToyM1rOIRkvoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTI5ODcyMQ==", "bodyText": "Indirect is a package function, not a method on Value. You'll need to change this up with\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\taf := val.Indirect().FieldByName(\"Annotations\")\n          \n          \n            \n            \t\taf := reflect.Indirect(val).FieldByName(\"Annotations\")\n          \n      \n    \n    \n  \n\nhttps://golang.org/pkg/reflect/#Indirect", "url": "https://github.com/apache/beam/pull/13434#discussion_r555298721", "createdAt": "2021-01-11T19:51:23Z", "author": {"login": "lostluck"}, "path": "sdks/go/pkg/beam/core/graph/fn.go", "diffHunk": "@@ -104,6 +106,14 @@ func NewFn(fn interface{}) (*Fn, error) {\n \n \tcase reflect.Struct:\n \t\tmethods := make(map[string]*funcx.Fn)\n+\t\tannotations := make(map[string][]byte)\n+\t\taf := val.Indirect().FieldByName(\"Annotations\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e9bf8649e53f7598540c7e42ed5335bb9ded366"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ee7784356e42c76cde55b075e3e19ed2464e238", "author": {"user": {"login": "miracvbasaran", "name": "Mira\u00e7 Vuslat Ba\u015faran"}}, "url": "https://github.com/apache/beam/commit/4ee7784356e42c76cde55b075e3e19ed2464e238", "committedDate": "2021-01-13T13:05:33Z", "message": "Add unit test and resolve reflect.Indirect bug."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3NDYwMjcz", "url": "https://github.com/apache/beam/pull/13434#pullrequestreview-567460273", "createdAt": "2021-01-13T17:31:46Z", "commit": {"oid": "4ee7784356e42c76cde55b075e3e19ed2464e238"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QxNzozMTo0NlrOIS6iEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QxNzozMTo0NlrOIS6iEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjcwNDI3NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \treturn f.methods[finishBundleName]f\n          \n          \n            \n            \treturn f.methods[finishBundleName]", "url": "https://github.com/apache/beam/pull/13434#discussion_r556704274", "createdAt": "2021-01-13T17:31:46Z", "author": {"login": "lostluck"}, "path": "sdks/go/pkg/beam/core/graph/fn.go", "diffHunk": "@@ -232,7 +242,7 @@ func (f *DoFn) ProcessElementFn() *funcx.Fn {\n \n // FinishBundleFn returns the \"FinishBundle\" function, if present.\n func (f *DoFn) FinishBundleFn() *funcx.Fn {\n-\treturn f.methods[finishBundleName]\n+\treturn f.methods[finishBundleName]f", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ee7784356e42c76cde55b075e3e19ed2464e238"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0af4813a368097e1ac659b08accebdaf1e8d12e8", "author": {"user": {"login": "lostluck", "name": "Robert Burke"}}, "url": "https://github.com/apache/beam/commit/0af4813a368097e1ac659b08accebdaf1e8d12e8", "committedDate": "2021-01-13T17:31:59Z", "message": "remove spurious f"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3NDY5MTA4", "url": "https://github.com/apache/beam/pull/13434#pullrequestreview-567469108", "createdAt": "2021-01-13T17:42:37Z", "commit": {"oid": "0af4813a368097e1ac659b08accebdaf1e8d12e8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QxNzo0MjozOFrOIS69ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xM1QxNzo0MjozOFrOIS69ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjcxMTMwNg==", "bodyText": "Consider using an Impulse instead, which simplifies the pipe to just the 2 transforms. The element would then be input _ []byte since impulse is traditionally ignored.)\nHowever, I'm not going to worry about it at this juncture, since it would not meaningfully shrink the PR.", "url": "https://github.com/apache/beam/pull/13434#discussion_r556711306", "createdAt": "2021-01-13T17:42:38Z", "author": {"login": "lostluck"}, "path": "sdks/go/pkg/beam/pardo_test.go", "diffHunk": "@@ -61,3 +71,65 @@ func TestFormatParDoError(t *testing.T) {\n \t\tt.Errorf(\"formatParDoError(testFunction,2,1) = %v, want = %v\", got, want)\n \t}\n }\n+\n+func TestAnnotations(t *testing.T) {\n+\tm := make(map[string][]byte)\n+\tm[\"privacy_property\"] = []byte(\"differential_privacy\")\n+\tdoFn := &AnnotationsFn{Annotations: m}\n+\n+\tp := NewPipeline()\n+\ts := p.Root()\n+\n+\tvalues := [2]int{0, 1}\n+\tcol := CreateList(s, values)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0af4813a368097e1ac659b08accebdaf1e8d12e8"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edef65c5839eb3235f2d6a6311330f4b1169fdde", "author": {"user": {"login": "lostluck", "name": "Robert Burke"}}, "url": "https://github.com/apache/beam/commit/edef65c5839eb3235f2d6a6311330f4b1169fdde", "committedDate": "2021-01-13T18:32:15Z", "message": "Add annotation method to graph.DoFn"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "486bf6bbe5f7ddc4c0eb9740515dfa6b87454589", "author": {"user": {"login": "lostluck", "name": "Robert Burke"}}, "url": "https://github.com/apache/beam/commit/486bf6bbe5f7ddc4c0eb9740515dfa6b87454589", "committedDate": "2021-01-13T18:32:25Z", "message": "Regen Go Protos"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY3NzI0MzU0", "url": "https://github.com/apache/beam/pull/13434#pullrequestreview-567724354", "createdAt": "2021-01-13T22:53:08Z", "commit": {"oid": "486bf6bbe5f7ddc4c0eb9740515dfa6b87454589"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4601, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}