{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNzYzMTM4", "number": 12001, "title": "[BEAM-10082] Remove dependency on java.xml.ws and remove deprecated MetricName methods", "bodyText": "Java 11 removed some Java EE modules. The dependency in MetricsHttpSink\nis for HttpException. Replace this instead with an IOException. Also clean up\na couple deprecated methods, get and namespace, in the process.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-06-12T16:00:13Z", "url": "https://github.com/apache/beam/pull/12001", "merged": true, "mergeCommit": {"oid": "9eab347073422e627b8eca47cc99c7beb44880ad"}, "closed": true, "closedAt": "2020-06-22T06:53:26Z", "author": {"login": "tysonjh"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqlh4oABqjM0MzkxNDQ4MjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcs2Wn2ABqjM0NjMzMTQ3MzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "780a3adcea14335e961b2eff3bf3450c8e466598", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/780a3adcea14335e961b2eff3bf3450c8e466598", "committedDate": "2020-06-12T15:28:41Z", "message": "[BEAM-10082] Remove dependency on java.xml.ws.\n\nJava 11 removed some Java EE modules. The dependency in MetricsHttpSink\nis for HttpException. Replace this instead with an IOException."}, "afterCommit": {"oid": "abfe85e4597e0ae9a75ea88a1715517c0a84c2ae", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/abfe85e4597e0ae9a75ea88a1715517c0a84c2ae", "committedDate": "2020-06-12T16:33:52Z", "message": "[BEAM-10082] Remove dependency on java.xml.ws.\n\nJava 11 removed some Java EE modules. The dependency in MetricsHttpSink\nis for HttpException. Replace this instead with an IOException.\n\nfixup! Spotless errors."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "abfe85e4597e0ae9a75ea88a1715517c0a84c2ae", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/abfe85e4597e0ae9a75ea88a1715517c0a84c2ae", "committedDate": "2020-06-12T16:33:52Z", "message": "[BEAM-10082] Remove dependency on java.xml.ws.\n\nJava 11 removed some Java EE modules. The dependency in MetricsHttpSink\nis for HttpException. Replace this instead with an IOException.\n\nfixup! Spotless errors."}, "afterCommit": {"oid": "9e045b1f4c21fa72278982909ea3c30777b17597", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/9e045b1f4c21fa72278982909ea3c30777b17597", "committedDate": "2020-06-12T16:35:28Z", "message": "[BEAM-10082] Remove dependency on java.xml.ws.\n\nJava 11 removed some Java EE modules. The dependency in MetricsHttpSink\nis for HttpException. Replace this instead with an IOException.\n\nfixup! Spotless errors."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNDg0NDEw", "url": "https://github.com/apache/beam/pull/12001#pullrequestreview-431484410", "createdAt": "2020-06-16T13:09:44Z", "commit": {"oid": "9e045b1f4c21fa72278982909ea3c30777b17597"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMzowOTo0NFrOGkafpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMzoxMzozMVrOGkapkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgzNjAwNA==", "bodyText": "thanks for adding this missing javadoc", "url": "https://github.com/apache/beam/pull/12001#discussion_r440836004", "createdAt": "2020-06-16T13:09:44Z", "author": {"login": "echauchot"}, "path": "runners/extensions-java/metrics/src/main/java/org/apache/beam/runners/extensions/metrics/MetricsHttpSink.java", "diffHunk": "@@ -50,6 +49,12 @@ public MetricsHttpSink(MetricsOptions pipelineOptions) {\n     this.urlString = pipelineOptions.getMetricsHttpSinkUrl();\n   }\n \n+  /**\n+   * Writes the metricQueryResults via HTTP POST to metrics sink endpoint.\n+   *\n+   * @param metricQueryResults query results to write.\n+   * @throws Exception throws IOException for non-200 response from endpoint.\n+   */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e045b1f4c21fa72278982909ea3c30777b17597"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgzODU0Nw==", "bodyText": "Agreed as there is no suitable http exception in java.net regular package. But please change the message to add more context \"Exception while writing metrics to MetricsHttpSink : expected HTTP 200 OK response but received \"", "url": "https://github.com/apache/beam/pull/12001#discussion_r440838547", "createdAt": "2020-06-16T13:13:31Z", "author": {"login": "echauchot"}, "path": "runners/extensions-java/metrics/src/main/java/org/apache/beam/runners/extensions/metrics/MetricsHttpSink.java", "diffHunk": "@@ -69,7 +74,7 @@ public void writeMetrics(MetricQueryResults metricQueryResults) throws Exception\n     }\n     int responseCode = connection.getResponseCode();\n     if (responseCode != 200) {\n-      throw new HTTPException(responseCode);\n+      throw new IOException(\"Expected OK 200 response but received: \" + responseCode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e045b1f4c21fa72278982909ea3c30777b17597"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNTk1NjQy", "url": "https://github.com/apache/beam/pull/12001#pullrequestreview-431595642", "createdAt": "2020-06-16T14:58:42Z", "commit": {"oid": "9e713d92e4b8454af1cd82028660b045a7c6f852"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDo1ODo0M1rOGkfisw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDo1OTowOVrOGkfkHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkxODcwNw==", "bodyText": "You're welcome.", "url": "https://github.com/apache/beam/pull/12001#discussion_r440918707", "createdAt": "2020-06-16T14:58:43Z", "author": {"login": "tysonjh"}, "path": "runners/extensions-java/metrics/src/main/java/org/apache/beam/runners/extensions/metrics/MetricsHttpSink.java", "diffHunk": "@@ -50,6 +49,12 @@ public MetricsHttpSink(MetricsOptions pipelineOptions) {\n     this.urlString = pipelineOptions.getMetricsHttpSinkUrl();\n   }\n \n+  /**\n+   * Writes the metricQueryResults via HTTP POST to metrics sink endpoint.\n+   *\n+   * @param metricQueryResults query results to write.\n+   * @throws Exception throws IOException for non-200 response from endpoint.\n+   */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgzNjAwNA=="}, "originalCommit": {"oid": "9e045b1f4c21fa72278982909ea3c30777b17597"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkxOTA2OQ==", "bodyText": "These were deprecated.", "url": "https://github.com/apache/beam/pull/12001#discussion_r440919069", "createdAt": "2020-06-16T14:59:09Z", "author": {"login": "tysonjh"}, "path": "runners/extensions-java/metrics/src/main/java/org/apache/beam/runners/extensions/metrics/MetricsHttpSink.java", "diffHunk": "@@ -86,8 +93,8 @@ public MetricNameSerializer(Class<MetricName> t) {\n     public void serialize(MetricName value, JsonGenerator gen, SerializerProvider provider)\n         throws IOException {\n       gen.writeStartObject();\n-      gen.writeObjectField(\"name\", value.name());\n-      gen.writeObjectField(\"namespace\", value.namespace());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e713d92e4b8454af1cd82028660b045a7c6f852"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNjgyODE0", "url": "https://github.com/apache/beam/pull/12001#pullrequestreview-431682814", "createdAt": "2020-06-16T16:26:05Z", "commit": {"oid": "9e713d92e4b8454af1cd82028660b045a7c6f852"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNjoyNjowNVrOGkjb5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNjo0MjowNVrOGlOICQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk4MjUwMw==", "bodyText": "sed s/MetricsSinkHttp/MetricsHttpSink/", "url": "https://github.com/apache/beam/pull/12001#discussion_r440982503", "createdAt": "2020-06-16T16:26:05Z", "author": {"login": "echauchot"}, "path": "runners/extensions-java/metrics/src/main/java/org/apache/beam/runners/extensions/metrics/MetricsHttpSink.java", "diffHunk": "@@ -74,7 +74,9 @@ public void writeMetrics(MetricQueryResults metricQueryResults) throws Exception\n     }\n     int responseCode = connection.getResponseCode();\n     if (responseCode != 200) {\n-      throw new IOException(\"Expected OK 200 response but received: \" + responseCode);\n+      throw new IOException(\n+          \"Expected HTTP 200 OK response while writing metrics to MetricsSinkHttp but received \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e713d92e4b8454af1cd82028660b045a7c6f852"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY4MTkyOQ==", "bodyText": "yes I replaced them with get* versions to simplify serialization code but they were re-introduced to be compatible with dataflow hosted engine which uses .name and .namespace which I could not know of because it is not opensource. Anyway good catch !  Dataflow is supposed to have migrated to .get* versions now, can you check ? If so we can remove the deprecated versions from the api.", "url": "https://github.com/apache/beam/pull/12001#discussion_r441681929", "createdAt": "2020-06-17T16:42:05Z", "author": {"login": "echauchot"}, "path": "runners/extensions-java/metrics/src/main/java/org/apache/beam/runners/extensions/metrics/MetricsHttpSink.java", "diffHunk": "@@ -86,8 +93,8 @@ public MetricNameSerializer(Class<MetricName> t) {\n     public void serialize(MetricName value, JsonGenerator gen, SerializerProvider provider)\n         throws IOException {\n       gen.writeStartObject();\n-      gen.writeObjectField(\"name\", value.name());\n-      gen.writeObjectField(\"namespace\", value.namespace());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkxOTA2OQ=="}, "originalCommit": {"oid": "9e713d92e4b8454af1cd82028660b045a7c6f852"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzOTM0OTYx", "url": "https://github.com/apache/beam/pull/12001#pullrequestreview-433934961", "createdAt": "2020-06-19T09:32:51Z", "commit": {"oid": "29ed8840bbfd0c5033810f9c3b7ae467b4f9a63a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6499899072e294486de57d5fcc8392375ef1bac4", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/6499899072e294486de57d5fcc8392375ef1bac4", "committedDate": "2020-06-19T17:15:06Z", "message": "[BEAM-10082] Remove dependency on java.xml.ws.\n\nJava 11 removed some Java EE modules. The dependency in MetricsHttpSink\nis for HttpException. Replace this instead with an IOException.\n\nfixup! Spotless errors."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02f0d9a0a6a0e483d49848d006e0c79b7e6af209", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/02f0d9a0a6a0e483d49848d006e0c79b7e6af209", "committedDate": "2020-06-19T17:15:06Z", "message": "Remove deprecated MetricName methods.\n\nMetricName.name() and MetricName.namespace() are no longer used by\nDataflow and can be safely removed. A typo is also fixed in\na MetricsHttpSink exception message."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "29ed8840bbfd0c5033810f9c3b7ae467b4f9a63a", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/29ed8840bbfd0c5033810f9c3b7ae467b4f9a63a", "committedDate": "2020-06-17T22:16:00Z", "message": "fixup! Review comments, remove deprecated methods."}, "afterCommit": {"oid": "02f0d9a0a6a0e483d49848d006e0c79b7e6af209", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/02f0d9a0a6a0e483d49848d006e0c79b7e6af209", "committedDate": "2020-06-19T17:15:06Z", "message": "Remove deprecated MetricName methods.\n\nMetricName.name() and MetricName.namespace() are no longer used by\nDataflow and can be safely removed. A typo is also fixed in\na MetricsHttpSink exception message."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3415, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}