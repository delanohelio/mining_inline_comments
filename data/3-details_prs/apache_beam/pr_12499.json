{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0NzEyODQ3", "number": 12499, "title": "[BEAM-10602] Fix load test metrics in Grafana dashboard", "bodyText": "This reverts the recent changes to the dashboards and adds a commit which adds a latency and checkpoint duration panel.\nAlso, it modifies the Flink streaming tests to write into the _pardo_1 table. This way, the results will show up in the dashboard together with all the other Runners' data.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-07T16:47:22Z", "url": "https://github.com/apache/beam/pull/12499", "merged": true, "mergeCommit": {"oid": "d2ef73e0319f6793355a5a8a14e867e104e430dc"}, "closed": true, "closedAt": "2020-08-12T12:20:20Z", "author": {"login": "mxm"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8nMW4AH2gAyNDY0NzEyODQ3OmI1OGNiYTNmNDRjOTk2MzE4OWRlNzk3N2VhZjY5YTQ4OTFhZGM2YWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-KXnfABqjM2NDczODQ1NDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b58cba3f44c9963189de7977eaf69a4891adc6ad", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/b58cba3f44c9963189de7977eaf69a4891adc6ad", "committedDate": "2020-08-07T16:41:20Z", "message": "Revert \"Merge pull request #12408: [BEAM-10602] Display Python streaming metrics in Grafana dashboard\"\n\nThis reverts commit cdc24753054d3aa23805511879ec712f952e2a92, reversing\nchanges made to 835805dfc9beaa7b3aecc690dd49c2ae04f14f98.\n\nRevert \"Merge pull request #12451: [BEAM-10602] Use python_streaming_pardo_5 table for latency results\"\n\nThis reverts commit 2f47b824507b3a1486ed6cdc8fb4ea6639c924ca, reversing\nchanges made to d971ba13b8ed31de3413558f701d752cbf202d47."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNDgzNjIz", "url": "https://github.com/apache/beam/pull/12499#pullrequestreview-463483623", "createdAt": "2020-08-07T17:29:47Z", "commit": {"oid": "8c4125492d6b32e9ee7fac4eb15211e1b1d00821"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzoyOTo0OFrOG9iFPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzoyOTo0OFrOG9iFPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE3NDcxNw==", "bodyText": "nit: add a newline?", "url": "https://github.com/apache/beam/pull/12499#discussion_r467174717", "createdAt": "2020-08-07T17:29:48Z", "author": {"login": "amaliujia"}, "path": ".test-infra/metrics/grafana/dashboards/perftests_metrics/ParDo_Load_Tests.json", "diffHunk": "@@ -619,5 +855,5 @@\n   \"variables\": {\n     \"list\": []\n   },\n-  \"version\": 2\n+  \"version\": 8\n }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c4125492d6b32e9ee7fac4eb15211e1b1d00821"}, "originalPosition": 443}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNDkzMDYw", "url": "https://github.com/apache/beam/pull/12499#pullrequestreview-463493060", "createdAt": "2020-08-07T17:45:06Z", "commit": {"oid": "8c4125492d6b32e9ee7fac4eb15211e1b1d00821"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzo0NTowN1rOG9ih9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzo0NTowN1rOG9ih9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE4MjA3MA==", "bodyText": "For my own understanding, could you elaborate on this?", "url": "https://github.com/apache/beam/pull/12499#discussion_r467182070", "createdAt": "2020-08-07T17:45:07Z", "author": {"login": "tysonjh"}, "path": ".test-infra/jenkins/job_LoadTests_ParDo_Flink_Python.groovy", "diffHunk": "@@ -161,12 +164,13 @@ def streamingScenarios = { datasetName ->\n       test           : 'apache_beam.testing.load_tests.pardo_test',\n       runner         : CommonTestProperties.Runner.PORTABLE,\n       pipelineOptions: [\n-        job_name             : 'load-tests-python-flink-streaming-pardo-5-' + now,\n+        job_name             : 'load-tests-python-flink-streaming-pardo-1-' + now,\n         project              : 'apache-beam-testing',\n         publish_to_big_query : true,\n         metrics_dataset      : datasetName,\n+        // Keep the old name to not break the legacy dashboard", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c4125492d6b32e9ee7fac4eb15211e1b1d00821"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0MjMyNjMw", "url": "https://github.com/apache/beam/pull/12499#pullrequestreview-464232630", "createdAt": "2020-08-10T13:35:12Z", "commit": {"oid": "8c4125492d6b32e9ee7fac4eb15211e1b1d00821"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxMzozNToxMlrOG-Oy5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxMzozNToxMlrOG-Oy5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkwNzMwMQ==", "bodyText": "I have mixed feelings about it. This test is not load-tests-python-flink-batch-pardo-1 but on streaming. There are more differences between them: batch-pardo-1 uses 10 iterations, this test uses 5 iterations. 0 counters in batch-pardo-1 vs. 3 counters right here. Because of that, I think we should stay with the previous job_name: load-tests-python-flink-streaming-pardo-5.\nThe general idea behind load tests is that we run the same configuration on different runners, in different SDKs and in different mode (batch or streaming). Grafana dashboards for load tests were designed with that convention in mind. If you choose java and streaming from the list, Grafana will pull data from these measurements: java_streaming_pardo_1, java_streaming_pardo_2 and so. Your streaming tests are a bit problematic, because they are not being run on Dataflow and batch. Also, they have no Java counterpart.\nThat being said, I think about two solutions:\n\nAdd more charts. We would end up with a total of six charts. The fifth and the sixth chart would be empty in most cases (for Java and for batch).\nCreate a separate, more specific version of dashboard just for these two tests (streaming-pardo-5 and streaming-pardo-6). Leave \"ParDo Load Tests\" dashboard intact.\n\n@mxm What do you think?", "url": "https://github.com/apache/beam/pull/12499#discussion_r467907301", "createdAt": "2020-08-10T13:35:12Z", "author": {"login": "kamilwu"}, "path": ".test-infra/jenkins/job_LoadTests_ParDo_Flink_Python.groovy", "diffHunk": "@@ -161,12 +164,13 @@ def streamingScenarios = { datasetName ->\n       test           : 'apache_beam.testing.load_tests.pardo_test',\n       runner         : CommonTestProperties.Runner.PORTABLE,\n       pipelineOptions: [\n-        job_name             : 'load-tests-python-flink-streaming-pardo-5-' + now,\n+        job_name             : 'load-tests-python-flink-streaming-pardo-1-' + now,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c4125492d6b32e9ee7fac4eb15211e1b1d00821"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "026a972a67188f544b95368547ac01ba8c083326", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/026a972a67188f544b95368547ac01ba8c083326", "committedDate": "2020-08-12T12:13:36Z", "message": "[BEAM-10602] Add latency/checkpoint duration as separate panels in ParDo Load Test\n\nThe Flink streaming tests were reported in a separate table and made avaible\nthrough this dashboard: https://apache-beam-testing.appspot.com/explore?dashboard=5751884853805056\n\nTurns out, this is not optimal for the new Grafana-based dashboard. We have to\nchange the table name because the query capability of InfluxDb is very limited.\n\nThis way the results will be shown together with the other Runners' load test results."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8c4125492d6b32e9ee7fac4eb15211e1b1d00821", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/8c4125492d6b32e9ee7fac4eb15211e1b1d00821", "committedDate": "2020-08-07T16:42:29Z", "message": "[BEAM-10602] Add latency/checkpoint duration as separate panels in ParDo Load Test\n\nThe Flink streaming tests were reported in a separate table and made avaible\nthrough this dashboard: https://apache-beam-testing.appspot.com/explore?dashboard=5751884853805056\n\nTurns out, this is not optimal for the new Grafana-based dashboard. We have to\nchange the table name because the query capability of InfluxDb is very limited.\n\nThis way the results will be shown together with the other Runners' load test results."}, "afterCommit": {"oid": "026a972a67188f544b95368547ac01ba8c083326", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/026a972a67188f544b95368547ac01ba8c083326", "committedDate": "2020-08-12T12:13:36Z", "message": "[BEAM-10602] Add latency/checkpoint duration as separate panels in ParDo Load Test\n\nThe Flink streaming tests were reported in a separate table and made avaible\nthrough this dashboard: https://apache-beam-testing.appspot.com/explore?dashboard=5751884853805056\n\nTurns out, this is not optimal for the new Grafana-based dashboard. We have to\nchange the table name because the query capability of InfluxDb is very limited.\n\nThis way the results will be shown together with the other Runners' load test results."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3816, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}