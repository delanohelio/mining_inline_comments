{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5MzEyNTIx", "number": 13189, "title": "[BEAM-11116] Make Java SDK container pull licenses without gradle subprocess", "bodyText": "Before:\n\n:sdks:java:container:pullLicenses runs a shell script that invokes Gradle at the top level as a subprocess\nno artifacts are shared\nalways has --rerun-tasks so it also reruns everything\nthe two gradle processes overwrite and clobber/corrupt the same artifacts sometimes\nseems to do a full java compile of some modules as part of the subprocess (sometimes?) which takes 7.5 minutes on my laptop\nfinds 80 license files and 22 notice files\n\nAfter:\n\nartifacts are shared\nintermediate outputs are cached\nno more clobbering\nfrom a clean state takes 1 minute (most of it gradle configuration time) on my laptop\nfinds 182 license files and 41 notice files, and diff shows it is a strict superset (hence safe)\n\nsome of these appear to be duplicate pulls, but not all\nbefore and after, this is entirely driven by what deps the generateLicenseReport task thinks matter\nbefore it was counting on a global run to cause projects to get configured; after, it is explicitly configuring the project we need. I think afterwards it is more accurate and deterministic, and ready to be refined.\n\n\n\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-10-24T02:42:22Z", "url": "https://github.com/apache/beam/pull/13189", "merged": true, "mergeCommit": {"oid": "ac9135c3a8c2a5b3d71189250e5c206955b8a06d"}, "closed": true, "closedAt": "2020-10-27T20:36:20Z", "author": {"login": "kennknowles"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdViE5dABqjM5MTYyNTI4NTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWt7krAFqTUxNzk5MjYyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "151cfa809b037f3e071bf4ad0a56bb94827c0e4c", "author": {"user": {"login": "kennknowles", "name": "Kenn Knowles"}}, "url": "https://github.com/apache/beam/commit/151cfa809b037f3e071bf4ad0a56bb94827c0e4c", "committedDate": "2020-10-24T02:38:17Z", "message": "Make Java SDK container pull licenses without gradle subprocess"}, "afterCommit": {"oid": "06beb7c5fb0ec0ee524010285e6a99cf21aafbdd", "author": {"user": {"login": "kennknowles", "name": "Kenn Knowles"}}, "url": "https://github.com/apache/beam/commit/06beb7c5fb0ec0ee524010285e6a99cf21aafbdd", "committedDate": "2020-10-24T02:51:38Z", "message": "Make Java SDK container pull licenses without gradle subprocess"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "06beb7c5fb0ec0ee524010285e6a99cf21aafbdd", "author": {"user": {"login": "kennknowles", "name": "Kenn Knowles"}}, "url": "https://github.com/apache/beam/commit/06beb7c5fb0ec0ee524010285e6a99cf21aafbdd", "committedDate": "2020-10-24T02:51:38Z", "message": "Make Java SDK container pull licenses without gradle subprocess"}, "afterCommit": {"oid": "922b4c1652fd972b494eae2ad6ff994f6dd8d9c5", "author": {"user": {"login": "kennknowles", "name": "Kenn Knowles"}}, "url": "https://github.com/apache/beam/commit/922b4c1652fd972b494eae2ad6ff994f6dd8d9c5", "committedDate": "2020-10-24T20:23:57Z", "message": "Make Java SDK container pull licenses without gradle subprocess"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef4ff8234fc280ab08aff3cadaca99ca03953b53", "author": {"user": {"login": "kennknowles", "name": "Kenn Knowles"}}, "url": "https://github.com/apache/beam/commit/ef4ff8234fc280ab08aff3cadaca99ca03953b53", "committedDate": "2020-10-24T21:44:12Z", "message": "Make Java SDK container pull licenses without gradle subprocess"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebd65e5314eb42131eace3be62390b3570e71292", "author": {"user": {"login": "kennknowles", "name": "Kenn Knowles"}}, "url": "https://github.com/apache/beam/commit/ebd65e5314eb42131eace3be62390b3570e71292", "committedDate": "2020-10-24T21:44:12Z", "message": "Do not read dependency report from cache"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "61c8448573f846d2cccde60cef052b7b17acd6cb", "author": {"user": {"login": "kennknowles", "name": "Kenn Knowles"}}, "url": "https://github.com/apache/beam/commit/61c8448573f846d2cccde60cef052b7b17acd6cb", "committedDate": "2020-10-24T20:44:55Z", "message": "Do not read dependency report from cache"}, "afterCommit": {"oid": "ebd65e5314eb42131eace3be62390b3570e71292", "author": {"user": {"login": "kennknowles", "name": "Kenn Knowles"}}, "url": "https://github.com/apache/beam/commit/ebd65e5314eb42131eace3be62390b3570e71292", "committedDate": "2020-10-24T21:44:12Z", "message": "Do not read dependency report from cache"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3MDA2NDUw", "url": "https://github.com/apache/beam/pull/13189#pullrequestreview-517006450", "createdAt": "2020-10-26T17:18:45Z", "commit": {"oid": "ebd65e5314eb42131eace3be62390b3570e71292"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNzoxODo0NVrOHoaPTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNzoxODo0NVrOHoaPTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjEzNDk5MA==", "bodyText": "I believe these lines are the key to not needing the global run and not needing --rerun-tasks", "url": "https://github.com/apache/beam/pull/13189#discussion_r512134990", "createdAt": "2020-10-26T17:18:45Z", "author": {"login": "kennknowles"}, "path": "sdks/java/container/build.gradle", "diffHunk": "@@ -24,6 +24,9 @@ plugins {\n applyGoNature()\n applyDockerNature()\n \n+evaluationDependsOn(\":sdks:java:harness\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebd65e5314eb42131eace3be62390b3570e71292"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3OTkyNjI1", "url": "https://github.com/apache/beam/pull/13189#pullrequestreview-517992625", "createdAt": "2020-10-27T17:56:12Z", "commit": {"oid": "ebd65e5314eb42131eace3be62390b3570e71292"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNzo1NjoxMlrOHpJgMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNzo1NjoxMlrOHpJgMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkwOTM2Mw==", "bodyText": "error messages are printed out at L313, this is duplicate.", "url": "https://github.com/apache/beam/pull/13189#discussion_r512909363", "createdAt": "2020-10-27T17:56:12Z", "author": {"login": "Hannah-Jiang"}, "path": "sdks/java/container/license_scripts/pull_licenses_java.py", "diffHunk": "@@ -275,6 +277,7 @@ def execute(dep):\n                  'and \"notice\" (if available) field to {yaml_file} for each ' \\\n                  'missing license. Dependency List: [{dep_list}]'.format(\n             dep_list=','.join(sorted(no_licenses)), yaml_file=dep_url_yaml)\n+        logging.error(how_to)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebd65e5314eb42131eace3be62390b3570e71292"}, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4973, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}