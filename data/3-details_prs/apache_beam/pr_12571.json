{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NTg0NTA4", "number": 12571, "title": "[BEAM-10702] Do not implicitly decompress artifacts", "bodyText": "Context: https://issues.apache.org/jira/browse/BEAM-10702\nLooks like the artifact service started with --job_endpoint=embed uses FileSystems.open to read the artifacts to be staged, which by default decompresses the artifacts if they are compressed. PIP packages are compressed as .tar.gz, so when the worker container retrieves the PIP packages to install, they see .tar.gz files whose contents is actually the underlying .tar file.\nI would appreciate guidance for where to add tests for this.\n\nartifact_service_test uses an in-memory file reader fn that doesn't actually share the code being used in production. Should I change that?\nworker_handlers_test does not exist - there's fn_runner_test.py in that directory but I'm not sure how to test the artifact staging codepath via there.\nDo we have any ValidatesRunner tests at all with job_endpoint=embed? If not, how would I go about adding some?\n\nR: @robertwb @pabloem\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-13T19:15:27Z", "url": "https://github.com/apache/beam/pull/12571", "merged": true, "mergeCommit": {"oid": "caabb8b77ca81a9476cdb2f0239d8803438a6460"}, "closed": true, "closedAt": "2020-08-14T01:21:49Z", "author": {"login": "jkff"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-qEQfgFqTQ2NzI0ODc2NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-qOGYABqjM2NTQzODc4Njk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MjQ4NzY1", "url": "https://github.com/apache/beam/pull/12571#pullrequestreview-467248765", "createdAt": "2020-08-14T01:10:02Z", "commit": {"oid": "8e57e9864133a4609d2432bd86f2e0330d43d1b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMToxMDowM1rOHAkS0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMToxMDowM1rOHAkS0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM1NjY5MQ==", "bodyText": "I suggest moving this to \n  \n    \n      beam/sdks/python/test-suites/portable/common.gradle\n    \n    \n         Line 183\n      in\n      0f04de7\n    \n    \n    \n    \n\n        \n          \n           ':runners:spark:job-server:shadowJar',", "url": "https://github.com/apache/beam/pull/12571#discussion_r470356691", "createdAt": "2020-08-14T01:10:03Z", "author": {"login": "tvalentyn"}, "path": "sdks/python/test-suites/portable/common.gradle", "diffHunk": "@@ -188,6 +212,7 @@ project.task(\"postCommitPy${pythonVersionSuffix}IT\") {\n   dependsOn = [\n           'setupVirtualenv',\n           'installGcpTest',\n+          'portableLocalRunnerJuliaSetWithSetupPy',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e57e9864133a4609d2432bd86f2e0330d43d1b0"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MjQ4Nzkz", "url": "https://github.com/apache/beam/pull/12571#pullrequestreview-467248793", "createdAt": "2020-08-14T01:10:07Z", "commit": {"oid": "8e57e9864133a4609d2432bd86f2e0330d43d1b0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b37f1f63cc056da8a89d7d7752728b9fe04d045b", "author": {"user": {"login": "jkff", "name": "Eugene Kirpichov"}}, "url": "https://github.com/apache/beam/commit/b37f1f63cc056da8a89d7d7752728b9fe04d045b", "committedDate": "2020-08-14T01:20:35Z", "message": "[BEAM-10702] Do not implicitly decompress artifacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b214d1b2a4d5008c528a9fe3e0dd6e849f625505", "author": {"user": {"login": "jkff", "name": "Eugene Kirpichov"}}, "url": "https://github.com/apache/beam/commit/b214d1b2a4d5008c528a9fe3e0dd6e849f625505", "committedDate": "2020-08-14T01:20:35Z", "message": "Adds a Julia Set test on portable local runner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5da2089473f3282901dcc69dea700f57c997bdb", "author": {"user": {"login": "jkff", "name": "Eugene Kirpichov"}}, "url": "https://github.com/apache/beam/commit/c5da2089473f3282901dcc69dea700f57c997bdb", "committedDate": "2020-08-14T01:20:35Z", "message": "Address review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e57e9864133a4609d2432bd86f2e0330d43d1b0", "author": {"user": {"login": "jkff", "name": "Eugene Kirpichov"}}, "url": "https://github.com/apache/beam/commit/8e57e9864133a4609d2432bd86f2e0330d43d1b0", "committedDate": "2020-08-13T22:52:51Z", "message": "Adds a Julia Set test on portable local runner"}, "afterCommit": {"oid": "c5da2089473f3282901dcc69dea700f57c997bdb", "author": {"user": {"login": "jkff", "name": "Eugene Kirpichov"}}, "url": "https://github.com/apache/beam/commit/c5da2089473f3282901dcc69dea700f57c997bdb", "committedDate": "2020-08-14T01:20:35Z", "message": "Address review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3504, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}