{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwMzc2MjE1", "number": 11154, "title": "[BEAM-1819] Key should be available in @OnTimer methods", "bodyText": "Thank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-03-18T11:21:14Z", "url": "https://github.com/apache/beam/pull/11154", "merged": true, "mergeCommit": {"oid": "591de3473144de54beef0932131025e2a4d8504b"}, "closed": true, "closedAt": "2020-04-27T16:31:30Z", "author": {"login": "rehmanmuradali"}, "timelineItems": {"totalCount": 64, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJtySDgH2gAyMzkwMzc2MjE1OjJlNDg4MGEzOGU4ODVhMTkzNmIxN2I3ZDk2ZGI1YzI4OTc2ZmQ1MTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbzDTMAFqTQwMTE4NzE2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2e4880a38e885a1936b17b7d96db5c28976fd517", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/2e4880a38e885a1936b17b7d96db5c28976fd517", "committedDate": "2020-03-02T13:32:03Z", "message": "Adding test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2de0744ecd574477d964a74f4cb5d0e2f8dca7a8", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/2de0744ecd574477d964a74f4cb5d0e2f8dca7a8", "committedDate": "2020-03-06T14:10:24Z", "message": "Adding Key Parameter with String return type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "018d8198b5f4eadbb489b8c18d88a94b6b1d76d4", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/018d8198b5f4eadbb489b8c18d88a94b6b1d76d4", "committedDate": "2020-03-10T10:09:46Z", "message": "Adding Key Parameter with String return type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc1d7b8dce9dd17fe82c3841cbddc2901014bb14", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/cc1d7b8dce9dd17fe82c3841cbddc2901014bb14", "committedDate": "2020-03-11T10:32:20Z", "message": "Test TimerSpec update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d9a1267c60756ed6f1d87f965b475acaf0834b0", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/1d9a1267c60756ed6f1d87f965b475acaf0834b0", "committedDate": "2020-03-11T14:57:54Z", "message": "Added Type Matching Functionality of Key Parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f54bab5cb7e27718754f42b03d90c28f2b788351", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/f54bab5cb7e27718754f42b03d90c28f2b788351", "committedDate": "2020-03-12T11:58:22Z", "message": "Added Type Matching Test Case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e921447f0faf28d24b0973d9e18921152bef3dc3", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/e921447f0faf28d24b0973d9e18921152bef3dc3", "committedDate": "2020-03-12T12:13:41Z", "message": "Merge branch 'master' into feature/BEAM-1819\n\n# Conflicts:\n#\trunners/core-java/src/main/java/org/apache/beam/runners/core/SimpleDoFnRunner.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "552f26ca3220f6aa21c7bccc9b095ab004420f16", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/552f26ca3220f6aa21c7bccc9b095ab004420f16", "committedDate": "2020-03-12T12:19:19Z", "message": "Generic name update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2be35d15582a7624e8a73ff9db20e2470a80160", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/e2be35d15582a7624e8a73ff9db20e2470a80160", "committedDate": "2020-03-16T08:23:00Z", "message": "Merge branch 'master' into feature/BEAM-1819\n\n# Conflicts:\n#\tsdks/java/core/src/main/java/org/apache/beam/sdk/transforms/DoFnTester.java\n#\tsdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnSignatures.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2daf158aac74e77db9d1afc61a96a2b8a4e71a15", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/2daf158aac74e77db9d1afc61a96a2b8a4e71a15", "committedDate": "2020-03-16T08:33:15Z", "message": "Updating DoFnSignatures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "976602184c6a36b568244182f0458729800f349c", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/976602184c6a36b568244182f0458729800f349c", "committedDate": "2020-03-18T08:26:30Z", "message": "Updating Test Cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00c6e6c5e3b43bda3d1e320532df81ed8cd90c1f", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/00c6e6c5e3b43bda3d1e320532df81ed8cd90c1f", "committedDate": "2020-03-18T08:31:47Z", "message": "Merge branch 'master' into feature/BEAM-1819"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42b5bea1611e60e6a34c3b77efc13ef613963dc3", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/42b5bea1611e60e6a34c3b77efc13ef613963dc3", "committedDate": "2020-03-18T08:38:45Z", "message": "Removing extra ontimer constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72e230d7d47a50fc0f5150e54fca16101fddb01e", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/72e230d7d47a50fc0f5150e54fca16101fddb01e", "committedDate": "2020-03-18T09:10:52Z", "message": "Spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f42b6f36fc43ff3648bf04e9a32c970d1c511eb", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/6f42b6f36fc43ff3648bf04e9a32c970d1c511eb", "committedDate": "2020-03-18T10:33:08Z", "message": "Added UsesKey Tag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe35a20d6b81e0e7a43b546a422e9304ce365a7f", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/fe35a20d6b81e0e7a43b546a422e9304ce365a7f", "committedDate": "2020-03-18T12:15:41Z", "message": "Adding empty string as default key parameter in onTimer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6009b3923aaddb8f6ffa8172b440c11e6be2ccc6", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/6009b3923aaddb8f6ffa8172b440c11e6be2ccc6", "committedDate": "2020-03-18T12:30:29Z", "message": "Changing Key annotation to KeyId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "118cb52fba2fb2bbf73dd6636a12b7e8f84f2738", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/118cb52fba2fb2bbf73dd6636a12b7e8f84f2738", "committedDate": "2020-03-18T12:45:01Z", "message": "Adding empty string as default in pushbackDoFnRunner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b2ef5320d3666ab88d7f179b13b54072e4ebc79", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/7b2ef5320d3666ab88d7f179b13b54072e4ebc79", "committedDate": "2020-03-19T09:22:53Z", "message": "Merge branch 'master' into feature/BEAM-1819"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c693d534579e9b97189d3e8d709da4b50c7c03d3", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/c693d534579e9b97189d3e8d709da4b50c7c03d3", "committedDate": "2020-03-19T09:35:32Z", "message": "Updating CHANGES.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58cf89c92d990daf5ab32ec06ede3662603dc368", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/58cf89c92d990daf5ab32ec06ede3662603dc368", "committedDate": "2020-03-19T17:00:30Z", "message": "Updating validations in DoFnSignatures, Excluding flink runner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42fa4fb17add9568e9bb1269370e95944db8e640", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/42fa4fb17add9568e9bb1269370e95944db8e640", "committedDate": "2020-03-19T17:06:03Z", "message": "Merge branch 'master' into feature/BEAM-1819\n\n# Conflicts:\n#\trunners/core-java/src/main/java/org/apache/beam/runners/core/OutputAndTimeBoundedSplittableProcessElementInvoker.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c36afa3a8e40cc9a4b0305b0d56ebec2c1b9541", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/3c36afa3a8e40cc9a4b0305b0d56ebec2c1b9541", "committedDate": "2020-03-20T13:08:03Z", "message": "Adding support for DataFlow"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NDc4MjYx", "url": "https://github.com/apache/beam/pull/11154#pullrequestreview-378478261", "createdAt": "2020-03-20T13:25:19Z", "commit": {"oid": "3c36afa3a8e40cc9a4b0305b0d56ebec2c1b9541"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxMzoyNToxOVrOF5TiAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxMzoyNToxOVrOF5TiAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzMzE1NQ==", "bodyText": "you'll need the change to StreamingDataflowWorker as well, without it, the key will always be null.", "url": "https://github.com/apache/beam/pull/11154#discussion_r395633155", "createdAt": "2020-03-20T13:25:19Z", "author": {"login": "steveniemitz"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/SimpleParDoFn.java", "diffHunk": "@@ -361,6 +361,7 @@ private void processUserTimer(TimerData timer) throws Exception {\n       fnRunner.onTimer(\n           timer.getTimerId(),\n           timer.getTimerFamilyId(),\n+          this.stepContext.stateInternals().getKey(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c36afa3a8e40cc9a4b0305b0d56ebec2c1b9541"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b2f738ed152be677d5cf3bb2350dae0615df08c", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/1b2f738ed152be677d5cf3bb2350dae0615df08c", "committedDate": "2020-03-20T13:31:18Z", "message": "Adding support for DataFlow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0dd289bd9599bfd27a42d0fd4e4981938dd2891e", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/0dd289bd9599bfd27a42d0fd4e4981938dd2891e", "committedDate": "2020-03-20T13:42:52Z", "message": "Added test case that support Generic Key type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODE5ODU0", "url": "https://github.com/apache/beam/pull/11154#pullrequestreview-378819854", "createdAt": "2020-03-20T21:23:01Z", "commit": {"oid": "0dd289bd9599bfd27a42d0fd4e4981938dd2891e"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQyMToyMzowMVrOF5jlGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNjo0NjozM1rOF6OZCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5NjA5MQ==", "bodyText": "should this instead return KeyT?", "url": "https://github.com/apache/beam/pull/11154#discussion_r395896091", "createdAt": "2020-03-20T21:23:01Z", "author": {"login": "reuvenlax"}, "path": "runners/core-java/src/main/java/org/apache/beam/runners/core/SimpleDoFnRunner.java", "diffHunk": "@@ -686,6 +697,11 @@ public TimeDomain timeDomain() {\n       return timeDomain;\n     }\n \n+    @Override\n+    public Object key() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd289bd9599bfd27a42d0fd4e4981938dd2891e"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5Njk1Mg==", "bodyText": "It looks like it should be easy to set the correct key here.", "url": "https://github.com/apache/beam/pull/11154#discussion_r395896952", "createdAt": "2020-03-20T21:25:28Z", "author": {"login": "reuvenlax"}, "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/translation/functions/FlinkStatefulDoFnFunction.java", "diffHunk": "@@ -218,6 +218,7 @@ private void fireTimer(TimerInternals.TimerData timer, DoFnRunner<KV<K, V>, Outp\n     doFnRunner.onTimer(\n         timer.getTimerId(),\n         timer.getTimerFamilyId(),\n+        \"\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd289bd9599bfd27a42d0fd4e4981938dd2891e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5NzMwOA==", "bodyText": "Also should be easy to do here.", "url": "https://github.com/apache/beam/pull/11154#discussion_r395897308", "createdAt": "2020-03-20T21:26:20Z", "author": {"login": "reuvenlax"}, "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java", "diffHunk": "@@ -847,6 +847,7 @@ protected void fireTimer(InternalTimer<ByteBuffer, TimerData> timer) {\n     pushbackDoFnRunner.onTimer(\n         timerData.getTimerId(),\n         timerData.getTimerFamilyId(),\n+        \"\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd289bd9599bfd27a42d0fd4e4981938dd2891e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU5NDI4OQ==", "bodyText": "I'm not sure I understand why this is needed.", "url": "https://github.com/apache/beam/pull/11154#discussion_r396594289", "createdAt": "2020-03-23T16:42:09Z", "author": {"login": "reuvenlax"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/StreamingDataflowWorker.java", "diffHunk": "@@ -1155,6 +1156,10 @@ public Instant getStateStartTime() {\n     // Note that TimerOrElementCoder is a backwards-compatibility class\n     // that is really a FakeKeyedWorkItemCoder\n     Coder<?> valueCoder = ((WindowedValueCoder<?>) readCoder).getValueCoder();\n+\n+    if (valueCoder instanceof KvCoder<?, ?>) {\n+      return ((KvCoder<?, ?>) valueCoder).getKeyCoder();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd289bd9599bfd27a42d0fd4e4981938dd2891e"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU5NTg3NQ==", "bodyText": "I think should just be named Key, not KeyId.\nAlso I wouldn't reference OnTimer here, as @key also makes sense in processElement (instead of getting a KV you should be able to get they key and the value in separate parameters.", "url": "https://github.com/apache/beam/pull/11154#discussion_r396595875", "createdAt": "2020-03-23T16:44:15Z", "author": {"login": "reuvenlax"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/DoFn.java", "diffHunk": "@@ -481,6 +481,12 @@ public Duration getAllowedTimestampSkew() {\n     String value();\n   }\n \n+  /** Parameter annotation for the input element key for {@link OnTimer} methods. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd289bd9599bfd27a42d0fd4e4981938dd2891e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU5NjY1Nw==", "bodyText": "Need javadoc", "url": "https://github.com/apache/beam/pull/11154#discussion_r396596657", "createdAt": "2020-03-23T16:45:23Z", "author": {"login": "reuvenlax"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnInvoker.java", "diffHunk": "@@ -167,6 +167,8 @@ void invokeOnTimer(\n     /** Provide a reference to the input element. */\n     InputT element(DoFn<InputT, OutputT> doFn);\n \n+    Object key();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd289bd9599bfd27a42d0fd4e4981938dd2891e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU5NzUxNQ==", "bodyText": "I think we also need to verify that the input type is a KV", "url": "https://github.com/apache/beam/pull/11154#discussion_r396597515", "createdAt": "2020-03-23T16:46:33Z", "author": {"login": "reuvenlax"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/DoFnSignatures.java", "diffHunk": "@@ -1282,6 +1283,14 @@ private static Parameter analyzeExtraParameter(\n           rawType.equals(Instant.class),\n           \"@Timestamp argument must have type org.joda.time.Instant.\");\n       return Parameter.timestampParameter();\n+    } else if (hasAnnotation(DoFn.KeyId.class, param.getAnnotations())) {\n+      Type keyType = ((ParameterizedType) inputT.getType()).getActualTypeArguments()[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0dd289bd9599bfd27a42d0fd4e4981938dd2891e"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9af6015fecb4e09a17ece8df37e44433cee01aa", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/e9af6015fecb4e09a17ece8df37e44433cee01aa", "committedDate": "2020-03-24T09:10:37Z", "message": "Merge branch 'master' into feature/BEAM-1819"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bc07aaccf50fb656380438bd5550576883aa840", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/1bc07aaccf50fb656380438bd5550576883aa840", "committedDate": "2020-03-24T12:09:11Z", "message": "Updaing KeyId annotation to Key"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4a91f414e27db74736ba84be00ca7649c557327", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/d4a91f414e27db74736ba84be00ca7649c557327", "committedDate": "2020-03-24T12:09:49Z", "message": "Updaing KeyId annotation to Key"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d128aca779b389f0f9da99d3f8f612fefe4472b8", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/d128aca779b389f0f9da99d3f8f612fefe4472b8", "committedDate": "2020-03-24T12:10:24Z", "message": "Added Flink Support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09c252ebd78175ce8c1901e6aa5e3afb59452be4", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/09c252ebd78175ce8c1901e6aa5e3afb59452be4", "committedDate": "2020-03-24T13:02:33Z", "message": "Added javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e3f379bf49c5caf2da525db0496ff839970c375", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/1e3f379bf49c5caf2da525db0496ff839970c375", "committedDate": "2020-03-24T14:02:58Z", "message": "Added validations of KV pair"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20bff9557052ee5fda0557c3b48b3c56901bfa23", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/20bff9557052ee5fda0557c3b48b3c56901bfa23", "committedDate": "2020-03-26T13:03:56Z", "message": "Merge branch 'master' into feature/BEAM-1819\n\n# Conflicts:\n#\tCHANGES.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "688c0791fe42e6af61c381d7d4e94b1eace17f30", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/688c0791fe42e6af61c381d7d4e94b1eace17f30", "committedDate": "2020-04-01T07:10:54Z", "message": "Including Flink Runner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f82e74f39c4bad228b44753c616f2065a3742bc", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/1f82e74f39c4bad228b44753c616f2065a3742bc", "committedDate": "2020-04-02T11:47:59Z", "message": "Change default as null, Removing TestStream, Checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2Nzk2Mjk2", "url": "https://github.com/apache/beam/pull/11154#pullrequestreview-386796296", "createdAt": "2020-04-02T21:39:30Z", "commit": {"oid": "1f82e74f39c4bad228b44753c616f2065a3742bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMTozOTozMFrOF_9d0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMTozOTozMFrOF_9d0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYxMTY2NQ==", "bodyText": "Can we pass the key through here?  We might need to include it in the coder for BufferedElements.Timer", "url": "https://github.com/apache/beam/pull/11154#discussion_r402611665", "createdAt": "2020-04-02T21:39:30Z", "author": {"login": "reuvenlax"}, "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/stableinput/BufferedElements.java", "diffHunk": "@@ -90,7 +90,8 @@ public int hashCode() {\n \n     @Override\n     public void processWith(DoFnRunner doFnRunner) {\n-      doFnRunner.onTimer(timerId, timerFamilyId, window, timestamp, outputTimestamp, timeDomain);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f82e74f39c4bad228b44753c616f2065a3742bc"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2ODk0NzMy", "url": "https://github.com/apache/beam/pull/11154#pullrequestreview-386894732", "createdAt": "2020-04-03T02:12:22Z", "commit": {"oid": "1f82e74f39c4bad228b44753c616f2065a3742bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMjoxMjoyMlrOGACvKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwMjoxMjoyMlrOGACvKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY5ODAyNA==", "bodyText": "the changes in this file don't seem necessary. We've got rid of an import but introduced a fully qualified class name for the same import instead.", "url": "https://github.com/apache/beam/pull/11154#discussion_r402698024", "createdAt": "2020-04-03T02:12:22Z", "author": {"login": "shehzaadn-vd"}, "path": "examples/java/src/main/java/org/apache/beam/examples/complete/AutoComplete.java", "diffHunk": "@@ -386,7 +385,8 @@ public FormatForDatastore(String kind, String ancestorKey) {\n     @ProcessElement\n     public void processElement(ProcessContext c) {\n       Entity.Builder entityBuilder = Entity.newBuilder();\n-      Key key = makeKey(makeKey(kind, ancestorKey).build(), kind, c.element().getKey()).build();\n+      com.google.datastore.v1.Key key =\n+          makeKey(makeKey(kind, ancestorKey).build(), kind, c.element().getKey()).build();\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f82e74f39c4bad228b44753c616f2065a3742bc"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ac020cdfceefa245e8fc7aadbfff4fb7b573a63", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/9ac020cdfceefa245e8fc7aadbfff4fb7b573a63", "committedDate": "2020-04-03T10:14:43Z", "message": "Adding Key in BufferedElements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9105984b1f7d934c2f78f8f7d814c624ec1d0f12", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/9105984b1f7d934c2f78f8f7d814c624ec1d0f12", "committedDate": "2020-04-03T11:50:22Z", "message": "Minor Test case fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NzY0NDM5", "url": "https://github.com/apache/beam/pull/11154#pullrequestreview-387764439", "createdAt": "2020-04-04T22:37:03Z", "commit": {"oid": "9ac020cdfceefa245e8fc7aadbfff4fb7b573a63"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQyMjozNzowM1rOGA2t6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQyMjozNzowM1rOGA2t6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzU0OTY3Mg==", "bodyText": "On a closer look, I think adding to the Coder is the wrong way to preserve the key. DoFnOperator has a stateInternals() which should provide access to the current key, and that way we don't have to encode the key again.\nSorry for the bad suggestion.", "url": "https://github.com/apache/beam/pull/11154#discussion_r403549672", "createdAt": "2020-04-04T22:37:03Z", "author": {"login": "reuvenlax"}, "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/stableinput/BufferingDoFnRunner.java", "diffHunk": "@@ -125,8 +129,8 @@ public void processElement(WindowedValue<InputT> elem) {\n       Instant outputTimestamp,\n       TimeDomain timeDomain) {\n     currentBufferingElementsHandler.buffer(\n-        new BufferedElements.Timer(\n-            timerId, timerFamilyId, window, timestamp, outputTimestamp, timeDomain));\n+        new BufferedElements.Timer<>(\n+            timerId, timerFamilyId, key, window, timestamp, outputTimestamp, timeDomain));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ac020cdfceefa245e8fc7aadbfff4fb7b573a63"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d3c1ffeb764d95011080123b272351228c48c2f", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/1d3c1ffeb764d95011080123b272351228c48c2f", "committedDate": "2020-04-06T10:58:43Z", "message": "Removing encoding and decoding of Key in BufferedElements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec224289eafa9bbcef99c533d6d5bc6ec75a8620", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/ec224289eafa9bbcef99c533d6d5bc6ec75a8620", "committedDate": "2020-04-10T09:19:47Z", "message": "Merge branch 'master' into feature/BEAM-1819"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b739efac41563432feb685e7c5af649191202ca2", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/b739efac41563432feb685e7c5af649191202ca2", "committedDate": "2020-04-10T10:29:20Z", "message": "Compilation Fix in DoFnOperator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "faad2a321e729b1135f555d71741631c5dad87cf", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/faad2a321e729b1135f555d71741631c5dad87cf", "committedDate": "2020-04-13T09:51:23Z", "message": "DoFnOperatorTest failing Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0df57baac11258587cb66c23ffd7a0dfe740bf13", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/0df57baac11258587cb66c23ffd7a0dfe740bf13", "committedDate": "2020-04-14T09:10:58Z", "message": "Merge branch 'master' into feature/BEAM-1819"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "703f84dc824c598a92896534e6e59cf4b7775d29", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/703f84dc824c598a92896534e6e59cf4b7775d29", "committedDate": "2020-04-14T09:50:28Z", "message": "Portable Flink Key implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cb32299b1627a91cbe174ebb1fe0dfcbb3f4d8e", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/0cb32299b1627a91cbe174ebb1fe0dfcbb3f4d8e", "committedDate": "2020-04-15T13:27:11Z", "message": "Flink Validates Runner Fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NzkxODQy", "url": "https://github.com/apache/beam/pull/11154#pullrequestreview-394791842", "createdAt": "2020-04-16T16:15:29Z", "commit": {"oid": "0cb32299b1627a91cbe174ebb1fe0dfcbb3f4d8e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNjoxNToyOVrOGGs9yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNjoxNToyOVrOGGs9yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY4MTM1NQ==", "bodyText": "@mxm Can you take a quick look and verify that this key handling is correct here?", "url": "https://github.com/apache/beam/pull/11154#discussion_r409681355", "createdAt": "2020-04-16T16:15:29Z", "author": {"login": "reuvenlax"}, "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java", "diffHunk": "@@ -837,11 +837,15 @@ public void onProcessingTime(InternalTimer<ByteBuffer, TimerData> timer) {\n \n   // allow overriding this in ExecutableStageDoFnOperator to set the key context\n   protected void fireTimerInternal(Object key, TimerData timerData) {\n-    fireTimer(timerData);\n+    if (key instanceof java.nio.ByteBuffer) {\n+      key = FlinkKeyUtils.decodeKey((ByteBuffer) key, keyCoder);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0cb32299b1627a91cbe174ebb1fe0dfcbb3f4d8e"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NDE5MzE5", "url": "https://github.com/apache/beam/pull/11154#pullrequestreview-395419319", "createdAt": "2020-04-17T12:43:15Z", "commit": {"oid": "0cb32299b1627a91cbe174ebb1fe0dfcbb3f4d8e"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMjo0MzoxNVrOGHMaHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMjo0OToyNFrOGHMm7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE5NjUwOQ==", "bodyText": "The key is always stored as ByteBuffer. This is also reflected in the method calls to this method. Please change the signature of the method to be\nvoid fireTimerInternal(ByteBuffer key, TimerData timerdata)", "url": "https://github.com/apache/beam/pull/11154#discussion_r410196509", "createdAt": "2020-04-17T12:43:15Z", "author": {"login": "mxm"}, "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java", "diffHunk": "@@ -837,11 +837,15 @@ public void onProcessingTime(InternalTimer<ByteBuffer, TimerData> timer) {\n \n   // allow overriding this in ExecutableStageDoFnOperator to set the key context\n   protected void fireTimerInternal(Object key, TimerData timerData) {\n-    fireTimer(timerData);\n+    if (key instanceof java.nio.ByteBuffer) {\n+      key = FlinkKeyUtils.decodeKey((ByteBuffer) key, keyCoder);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY4MTM1NQ=="}, "originalCommit": {"oid": "0cb32299b1627a91cbe174ebb1fe0dfcbb3f4d8e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE5NzU0OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              protected void fireTimerInternal(Object key, TimerData timerData) {\n          \n          \n            \n              protected void fireTimerInternal(ByteBuffer key, TimerData timerData) {", "url": "https://github.com/apache/beam/pull/11154#discussion_r410197549", "createdAt": "2020-04-17T12:45:16Z", "author": {"login": "mxm"}, "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java", "diffHunk": "@@ -837,11 +837,15 @@ public void onProcessingTime(InternalTimer<ByteBuffer, TimerData> timer) {\n \n   // allow overriding this in ExecutableStageDoFnOperator to set the key context\n   protected void fireTimerInternal(Object key, TimerData timerData) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0cb32299b1627a91cbe174ebb1fe0dfcbb3f4d8e"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE5Nzc3MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              protected void fireTimer(Object key, TimerData timerData) {\n          \n          \n            \n              protected void fireTimer(ByteBuffer key, TimerData timerData) {", "url": "https://github.com/apache/beam/pull/11154#discussion_r410197770", "createdAt": "2020-04-17T12:45:39Z", "author": {"login": "mxm"}, "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java", "diffHunk": "@@ -837,11 +837,15 @@ public void onProcessingTime(InternalTimer<ByteBuffer, TimerData> timer) {\n \n   // allow overriding this in ExecutableStageDoFnOperator to set the key context\n   protected void fireTimerInternal(Object key, TimerData timerData) {\n-    fireTimer(timerData);\n+    if (key instanceof java.nio.ByteBuffer) {\n+      key = FlinkKeyUtils.decodeKey((ByteBuffer) key, keyCoder);\n+    }\n+\n+    fireTimer(key, timerData);\n   }\n \n   // allow overriding this in WindowDoFnOperator\n-  protected void fireTimer(TimerData timerData) {\n+  protected void fireTimer(Object key, TimerData timerData) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0cb32299b1627a91cbe174ebb1fe0dfcbb3f4d8e"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE5OTc4OA==", "bodyText": "If you decide the decode the key already in the calling method, then use the key type here.", "url": "https://github.com/apache/beam/pull/11154#discussion_r410199788", "createdAt": "2020-04-17T12:49:24Z", "author": {"login": "mxm"}, "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java", "diffHunk": "@@ -837,11 +837,15 @@ public void onProcessingTime(InternalTimer<ByteBuffer, TimerData> timer) {\n \n   // allow overriding this in ExecutableStageDoFnOperator to set the key context\n   protected void fireTimerInternal(Object key, TimerData timerData) {\n-    fireTimer(timerData);\n+    if (key instanceof java.nio.ByteBuffer) {\n+      key = FlinkKeyUtils.decodeKey((ByteBuffer) key, keyCoder);\n+    }\n+\n+    fireTimer(key, timerData);\n   }\n \n   // allow overriding this in WindowDoFnOperator\n-  protected void fireTimer(TimerData timerData) {\n+  protected void fireTimer(Object key, TimerData timerData) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE5Nzc3MA=="}, "originalCommit": {"oid": "0cb32299b1627a91cbe174ebb1fe0dfcbb3f4d8e"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ab54b47cd0de0d97bcb2784ce4f3e2c90b16c5b", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/0ab54b47cd0de0d97bcb2784ce4f3e2c90b16c5b", "committedDate": "2020-04-20T16:22:24Z", "message": "Added TODO to change method signature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d00f3aa69b152236603bbf1254a4706019a8254", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/4d00f3aa69b152236603bbf1254a4706019a8254", "committedDate": "2020-04-21T13:21:11Z", "message": "testStateRestore Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cffd991b3bc60c40c8c0f972377cd8509acf030", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/7cffd991b3bc60c40c8c0f972377cd8509acf030", "committedDate": "2020-04-21T13:29:21Z", "message": "testTimerRestore Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a674b9529e66c13de0af27f12a0a8b20adf4d41f", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/a674b9529e66c13de0af27f12a0a8b20adf4d41f", "committedDate": "2020-04-22T09:38:54Z", "message": "keyedParDoSideInputCheckpointing Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffd50734065343dc5f7d66e4a25210d8987c0053", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/ffd50734065343dc5f7d66e4a25210d8987c0053", "committedDate": "2020-04-22T09:47:25Z", "message": "testWatermarkContract Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4aedb68155ed14429f6754d06a1a8393fc8e0042", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/4aedb68155ed14429f6754d06a1a8393fc8e0042", "committedDate": "2020-04-22T09:58:32Z", "message": "testLateDroppingForStatefulFn Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c9851ae7472b87b260cc59326447b839a2f95e5", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/1c9851ae7472b87b260cc59326447b839a2f95e5", "committedDate": "2020-04-22T10:29:51Z", "message": "testStateGCForStatefulFn Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "106bea888413d29ce195dfd6d7d8b81cdd1e663b", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/106bea888413d29ce195dfd6d7d8b81cdd1e663b", "committedDate": "2020-04-22T11:38:51Z", "message": "keyedParDoPushbackDataCheckpointing Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80bcbc36cd93b68f17445964288304a7afd41315", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/80bcbc36cd93b68f17445964288304a7afd41315", "committedDate": "2020-04-22T11:50:04Z", "message": "testKeyedParDoSideInputs Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c27d1c069c5fc96e700fbb0c9e32c4113249736f", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/c27d1c069c5fc96e700fbb0c9e32c4113249736f", "committedDate": "2020-04-22T12:26:45Z", "message": "Minor Fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55439e3e9cf00bbe3a97a133b5b276b4d33fb787", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/55439e3e9cf00bbe3a97a133b5b276b4d33fb787", "committedDate": "2020-04-22T13:24:35Z", "message": "Merge branch 'master' into feature/BEAM-1819"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NTA2Nzgy", "url": "https://github.com/apache/beam/pull/11154#pullrequestreview-398506782", "createdAt": "2020-04-22T19:26:32Z", "commit": {"oid": "55439e3e9cf00bbe3a97a133b5b276b4d33fb787"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxOToyNjozM1rOGKHSTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxOToyNjozM1rOGKHSTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI1ODMxOQ==", "bodyText": "Can we change this to ByteBuffer now? Same in ExecutableStageDoFnOperator where it is overridden.", "url": "https://github.com/apache/beam/pull/11154#discussion_r413258319", "createdAt": "2020-04-22T19:26:33Z", "author": {"login": "mxm"}, "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/translation/wrappers/streaming/DoFnOperator.java", "diffHunk": "@@ -837,11 +837,15 @@ public void onProcessingTime(InternalTimer<ByteBuffer, TimerData> timer) {\n \n   // allow overriding this in ExecutableStageDoFnOperator to set the key context\n   protected void fireTimerInternal(Object key, TimerData timerData) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE5NzU0OQ=="}, "originalCommit": {"oid": "0cb32299b1627a91cbe174ebb1fe0dfcbb3f4d8e"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c4ef9604faa8761e2159e4b13a2ed2791646a27", "author": {"user": {"login": "rehmanmuradali", "name": "Rehman Murad Ali"}}, "url": "https://github.com/apache/beam/commit/4c4ef9604faa8761e2159e4b13a2ed2791646a27", "committedDate": "2020-04-22T19:36:40Z", "message": "fireTimerInternal method signature changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTg3MTY3", "url": "https://github.com/apache/beam/pull/11154#pullrequestreview-401187167", "createdAt": "2020-04-27T17:49:55Z", "commit": {"oid": "4c4ef9604faa8761e2159e4b13a2ed2791646a27"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNzo0OTo1NVrOGMwCKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNzo0OTo1NVrOGMwCKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjAyMzA4MA==", "bodyText": "The intent of these context objects was to not create a new one when processing each element/timer and instead to reference a member variable as can be seen in:\n\n  \n    \n      beam/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnApiDoFnRunner.java\n    \n    \n         Line 1468\n      in\n      591de34\n    \n    \n    \n    \n\n        \n          \n           return pipelineOptions; \n        \n    \n  \n\n\n\n  \n    \n      beam/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnApiDoFnRunner.java\n    \n    \n         Line 1506\n      in\n      591de34\n    \n    \n    \n    \n\n        \n          \n           return currentElement.getValue(); \n        \n    \n  \n\n\nIt would have made more sense to have OnTimerContext just return currentTimer.getUserKey()", "url": "https://github.com/apache/beam/pull/11154#discussion_r416023080", "createdAt": "2020-04-27T17:49:55Z", "author": {"login": "lukecwik"}, "path": "sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnApiDoFnRunner.java", "diffHunk": "@@ -560,7 +560,6 @@ public Instant timestamp(DoFn<InputT, OutputT> doFn) {\n         throw new IllegalStateException(\n             String.format(\"Unknown URN %s\", pTransform.getSpec().getUrn()));\n     }\n-    this.onTimerContext = new OnTimerContext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c4ef9604faa8761e2159e4b13a2ed2791646a27"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2801, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}