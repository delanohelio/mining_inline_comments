{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2MDA5MTg1", "number": 11877, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMDowODoxOFrOEBf2wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwOToxMTo1NVrOECeUjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMDA1OTU0OnYy", "diffSide": "RIGHT", "path": ".github/workflows/build_wheels.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQyMDowODoxOFrOGdYZBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwOTo1NTo0MVrOGdqjzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQ2MTUxMQ==", "bodyText": "Should we pin the version of python here?", "url": "https://github.com/apache/beam/pull/11877#discussion_r433461511", "createdAt": "2020-06-01T20:08:18Z", "author": {"login": "epicfaace"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,91 @@\n+on: [push]\n+name: Build python wheels\n+\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c564874666d4b1fb691a3b557d506b11b8d86d5"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc1OTE4MA==", "bodyText": "Yes, we should :) thanks for pointing it out, I missed it.\nGitHub Actions documentations says here:\n\nWe recommend using setup-python to configure the version of Python used in your workflows because it helps make your dependencies explicit.", "url": "https://github.com/apache/beam/pull/11877#discussion_r433759180", "createdAt": "2020-06-02T09:55:41Z", "author": {"login": "TobKed"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,91 @@\n+on: [push]\n+name: Build python wheels\n+\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v1", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQ2MTUxMQ=="}, "originalCommit": {"oid": "4c564874666d4b1fb691a3b557d506b11b8d86d5"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwNzg4NzI0OnYy", "diffSide": "RIGHT", "path": ".github/workflows/build_wheels.yml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNzowMjo1NlrOGelRSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNjo1MDozNVrOGfO9qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyMTA5OQ==", "bodyText": "@tvalentyn - is py3.8 ready to be added here?", "url": "https://github.com/apache/beam/pull/11877#discussion_r434721099", "createdAt": "2020-06-03T17:02:56Z", "author": {"login": "aaltay"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: sdks/python/dist\n+\n+  prepare_gcs:\n+    name: Prepare GCS\n+    needs: build_source\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Remove existing files on GCS bucket\n+        run: gsutil rm -r \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\" || true\n+\n+  upload_source_to_gcs:\n+    name: Upload source to GCS bucket\n+    needs: prepare_gcs\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Download wheels\n+        uses: actions/download-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: source/\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Copy sources to GCS bucket\n+        run: gsutil cp -r -a public-read source/* gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\n+      - name: List sources on GCS bucket\n+        run: |\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.tar.gz\"\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.zip\"\n+\n+  build_wheels:\n+    name: Build wheels on ${{ matrix.os }}\n+    needs: prepare_gcs\n+    runs-on: ${{ matrix.os }}\n+    strategy:\n+      matrix:\n+        os : [ubuntu-18.04, macos-10.15]\n+    steps:\n+    - name: Download source\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: source\n+        path: apache-beam-source\n+    - name: Install Python\n+      uses: actions/setup-python@v2\n+      with:\n+        python-version: 3.7\n+    - name: Install packages on Mac\n+      if: startsWith(matrix.os, 'macos')\n+      run: |\n+        brew update\n+        brew install pkg-config\n+    - name: Install cibuildwheel\n+      run: pip install cibuildwheel==1.4.2\n+    - name: Build wheel\n+      working-directory: apache-beam-source\n+      env:\n+        CIBW_BUILD: cp27-* cp35-* cp36-* cp37-*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc3OTY4MQ==", "bodyText": "Yes, let's add py3.8. Thanks.", "url": "https://github.com/apache/beam/pull/11877#discussion_r434779681", "createdAt": "2020-06-03T18:45:18Z", "author": {"login": "tvalentyn"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: sdks/python/dist\n+\n+  prepare_gcs:\n+    name: Prepare GCS\n+    needs: build_source\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Remove existing files on GCS bucket\n+        run: gsutil rm -r \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\" || true\n+\n+  upload_source_to_gcs:\n+    name: Upload source to GCS bucket\n+    needs: prepare_gcs\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Download wheels\n+        uses: actions/download-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: source/\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Copy sources to GCS bucket\n+        run: gsutil cp -r -a public-read source/* gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\n+      - name: List sources on GCS bucket\n+        run: |\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.tar.gz\"\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.zip\"\n+\n+  build_wheels:\n+    name: Build wheels on ${{ matrix.os }}\n+    needs: prepare_gcs\n+    runs-on: ${{ matrix.os }}\n+    strategy:\n+      matrix:\n+        os : [ubuntu-18.04, macos-10.15]\n+    steps:\n+    - name: Download source\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: source\n+        path: apache-beam-source\n+    - name: Install Python\n+      uses: actions/setup-python@v2\n+      with:\n+        python-version: 3.7\n+    - name: Install packages on Mac\n+      if: startsWith(matrix.os, 'macos')\n+      run: |\n+        brew update\n+        brew install pkg-config\n+    - name: Install cibuildwheel\n+      run: pip install cibuildwheel==1.4.2\n+    - name: Build wheel\n+      working-directory: apache-beam-source\n+      env:\n+        CIBW_BUILD: cp27-* cp35-* cp36-* cp37-*", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyMTA5OQ=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwNDIwMg==", "bodyText": "Sure, I will add it \ud83d\udc4d", "url": "https://github.com/apache/beam/pull/11877#discussion_r435404202", "createdAt": "2020-06-04T16:50:35Z", "author": {"login": "TobKed"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: sdks/python/dist\n+\n+  prepare_gcs:\n+    name: Prepare GCS\n+    needs: build_source\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Remove existing files on GCS bucket\n+        run: gsutil rm -r \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\" || true\n+\n+  upload_source_to_gcs:\n+    name: Upload source to GCS bucket\n+    needs: prepare_gcs\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Download wheels\n+        uses: actions/download-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: source/\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Copy sources to GCS bucket\n+        run: gsutil cp -r -a public-read source/* gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\n+      - name: List sources on GCS bucket\n+        run: |\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.tar.gz\"\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.zip\"\n+\n+  build_wheels:\n+    name: Build wheels on ${{ matrix.os }}\n+    needs: prepare_gcs\n+    runs-on: ${{ matrix.os }}\n+    strategy:\n+      matrix:\n+        os : [ubuntu-18.04, macos-10.15]\n+    steps:\n+    - name: Download source\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: source\n+        path: apache-beam-source\n+    - name: Install Python\n+      uses: actions/setup-python@v2\n+      with:\n+        python-version: 3.7\n+    - name: Install packages on Mac\n+      if: startsWith(matrix.os, 'macos')\n+      run: |\n+        brew update\n+        brew install pkg-config\n+    - name: Install cibuildwheel\n+      run: pip install cibuildwheel==1.4.2\n+    - name: Build wheel\n+      working-directory: apache-beam-source\n+      env:\n+        CIBW_BUILD: cp27-* cp35-* cp36-* cp37-*", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyMTA5OQ=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 109}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwNzg5MTA0OnYy", "diffSide": "RIGHT", "path": ".github/workflows/build_wheels.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNzowNDowM1rOGelT3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxMTo0Mjo0OVrOGfB6sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyMTc1Nw==", "bodyText": "I am not familiar with github ci. This is a question for my learning. Does each build step (job?) work in a different os environment?", "url": "https://github.com/apache/beam/pull/11877#discussion_r434721757", "createdAt": "2020-06-03T17:04:03Z", "author": {"login": "aaltay"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE5MDQ0OQ==", "bodyText": "You can specify the runner type for each job in a workflow. Each job in a workflow executes in a fresh instance of the virtual machine. All steps in the job execute in the same instance of the virtual machine, allowing the actions in that job to share information using the filesystem.\n\nsource: https://help.github.com/en/actions/reference/virtual-environments-for-github-hosted-runners", "url": "https://github.com/apache/beam/pull/11877#discussion_r435190449", "createdAt": "2020-06-04T11:42:49Z", "author": {"login": "TobKed"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyMTc1Nw=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwNzg5Njk4OnYy", "diffSide": "RIGHT", "path": ".github/workflows/build_wheels.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNzowNTo1M1rOGelX0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxMTo0ODowMlrOGfCEig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyMjc3MA==", "bodyText": "Should we use ubuntu-20.04 instead?\n(Apparently this is now supported: actions/virtual-environments#228)", "url": "https://github.com/apache/beam/pull/11877#discussion_r434722770", "createdAt": "2020-06-03T17:05:53Z", "author": {"login": "aaltay"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE5Mjk3MA==", "bodyText": "I found information in the documentation (source) which says:\n\nNote: The Ubuntu 20.04 virtual environment is currently provided as a preview only. The ubuntu-latest YAML workflow label still uses the Ubuntu 18.04 virtual environment.\n\nIn this case using ubuntu-latest label may be a good idea. WDYT?", "url": "https://github.com/apache/beam/pull/11877#discussion_r435192970", "createdAt": "2020-06-04T11:48:02Z", "author": {"login": "TobKed"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyMjc3MA=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwNzkwNTM1OnYy", "diffSide": "RIGHT", "path": ".github/workflows/build_wheels.yml", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNzowODoxOFrOGeldPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMTo1NzoxOVrOGm9fHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyNDE1Nw==", "bodyText": "What does this do? Is it re-compressing the source folder. I wonder if we can use the sdist output as it?\n(Ideally the resulting GCS output look something close enoguh to a release output, e.g. https://dist.apache.org/repos/dist/release/beam/2.21.0/python/ )", "url": "https://github.com/apache/beam/pull/11877#discussion_r434724157", "createdAt": "2020-06-03T17:08:18Z", "author": {"login": "aaltay"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTIwMzA5Mg==", "bodyText": "It is uploading sdist output (zip,tag.gz) files as artifacts where they are picked up by upload_source_to_gcs jobs. An additional advantage of the artifacts is fact that they can be downloaded from GitHub Actions workflow web view as well.\nExample of  GCS output for build_source -> upload_source_to_gcs jobs:\ngs://**/apache-beam-2.23.0.dev0.tar.gz\ngs://**/apache-beam-2.23.0.dev0.zip\n\nhere you can check GitHub Action which ran on my fork.\nWheel files (*.whl) are processed accordingly by build_wheels -> upload_wheels_to_gcs jobs.\nExample of GCS output at the end of the workflow:\ngs://**/apache-beam-2.23.0.dev0.tar.gz\ngs://**/apache-beam-2.23.0.dev0.zip\ngs://**/apache_beam-2.23.0.dev0-cp27-cp27m-macosx_10_9_x86_64.whl\ngs://**/apache_beam-2.23.0.dev0-cp27-cp27m-manylinux1_i686.whl\ngs://**/apache_beam-2.23.0.dev0-cp27-cp27m-manylinux1_x86_64.whl\ngs://**/apache_beam-2.23.0.dev0-cp27-cp27m-manylinux2010_i686.whl\ngs://**/apache_beam-2.23.0.dev0-cp27-cp27m-manylinux2010_x86_64.whl\ngs://**/apache_beam-2.23.0.dev0-cp27-cp27mu-manylinux1_i686.whl\ngs://**/apache_beam-2.23.0.dev0-cp27-cp27mu-manylinux1_x86_64.whl\ngs://**/apache_beam-2.23.0.dev0-cp27-cp27mu-manylinux2010_i686.whl\ngs://**/apache_beam-2.23.0.dev0-cp27-cp27mu-manylinux2010_x86_64.whl\ngs://**/apache_beam-2.23.0.dev0-cp35-cp35m-macosx_10_9_x86_64.whl\ngs://**/apache_beam-2.23.0.dev0-cp35-cp35m-manylinux1_i686.whl\ngs://**/apache_beam-2.23.0.dev0-cp35-cp35m-manylinux1_x86_64.whl\ngs://**/apache_beam-2.23.0.dev0-cp35-cp35m-manylinux2010_i686.whl\ngs://**/apache_beam-2.23.0.dev0-cp35-cp35m-manylinux2010_x86_64.whl\ngs://**/apache_beam-2.23.0.dev0-cp36-cp36m-macosx_10_9_x86_64.whl\ngs://**/apache_beam-2.23.0.dev0-cp36-cp36m-manylinux1_i686.whl\ngs://**/apache_beam-2.23.0.dev0-cp36-cp36m-manylinux1_x86_64.whl\ngs://**/apache_beam-2.23.0.dev0-cp36-cp36m-manylinux2010_i686.whl\ngs://**/apache_beam-2.23.0.dev0-cp36-cp36m-manylinux2010_x86_64.whl\ngs://**/apache_beam-2.23.0.dev0-cp37-cp37m-macosx_10_9_x86_64.whl\ngs://**/apache_beam-2.23.0.dev0-cp37-cp37m-manylinux1_i686.whl\ngs://**/apache_beam-2.23.0.dev0-cp37-cp37m-manylinux1_x86_64.whl\ngs://**/apache_beam-2.23.0.dev0-cp37-cp37m-manylinux2010_i686.whl\ngs://**/apache_beam-2.23.0.dev0-cp37-cp37m-manylinux2010_x86_64.whl", "url": "https://github.com/apache/beam/pull/11877#discussion_r435203092", "createdAt": "2020-06-04T12:08:07Z", "author": {"login": "TobKed"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyNDE1Nw=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzMDgyMw==", "bodyText": "Very nice.\n2 follow up questions:\n\nCan we add a very last stage that can run: gsutil ls \"gs://*/$GITHUB_REF##//\" -> so that we can get the whole output of the gcs folder all at once.\n\n(btw, do we have a mechanism to clean up these gcs locations?)\n\nWhat is the difference between \"Build python wheels / Build wheels on ...\" job executing \"Upload wheels\" step and \"Upload wheels to GCS bucket ...\" job?", "url": "https://github.com/apache/beam/pull/11877#discussion_r435630823", "createdAt": "2020-06-05T00:40:36Z", "author": {"login": "aaltay"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyNDE1Nw=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA2NzYzOA==", "bodyText": "Currently two steps: List sources on GCS bucket and Copy wheels to GCS bucket are listing files of specific types. Instead of this two separate steps I could create job which will list all files in specific gcs folder. I think it would be much cleaner and explicit. Did I understand correctly your idea?\n\nAbout cleaning up these GCS locations I consider two options:\n\nsetting lifecycle management on the bucket which will delete files older than some arbitrary age, e.g. 365 days. I think advantage of this is that will be maintenance free.\ncreating another scheduled workflow on github actions which will delete gcs folders if corresponding branch does not exist anymore. Could be scheduled to run e.g. once pre week.\n\nWhich option has more sense for you?\n\n\"Upload\" steps perform file upload as artifacts so they could be passed between jobs and being available for download for 90 days (if not deleted earlier). These artifacts are picked up later by \"Upload to GCS\" jobs. What do you think about renaming these steps e.g.: \"Upload wheels\" -> \"Upload wheels as artifacts\" ?", "url": "https://github.com/apache/beam/pull/11877#discussion_r436067638", "createdAt": "2020-06-05T17:39:53Z", "author": {"login": "TobKed"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyNDE1Nw=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU5NDk4OQ==", "bodyText": "Sorry, I missed this earlier.\n\nI think it would be much cleaner and explicit. Did I understand correctly your idea?\nYes. Your understanding is correct. This sounds good to me.\n\n\nClean up:\nBoth options are good. Can we do both?\n\n\nWhat do you think about renaming these steps e.g.: \"Upload wheels\" -> \"Upload wheels as artifacts\" ?\nSounds good.", "url": "https://github.com/apache/beam/pull/11877#discussion_r442594989", "createdAt": "2020-06-19T02:15:31Z", "author": {"login": "aaltay"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyNDE1Nw=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzUwNjQ2Mw==", "bodyText": "I think it would be much cleaner and explicit. Did I understand correctly your idea?\nYes. Your understanding is correct. This sounds good to me.\n\nI renamed steps. Please take a look is there no mistakes.\n\nClean up:\nBoth options are good. Can we do both?\n\nSure. We can do both.\nRelated to versioning and lifecycle management: I added information in the PR description.\nFor periodic cleaning tasks I created separate dependent draft PR: #12049", "url": "https://github.com/apache/beam/pull/11877#discussion_r443506463", "createdAt": "2020-06-22T11:57:19Z", "author": {"login": "TobKed"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyNDE1Nw=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwNzkyNjA5OnYy", "diffSide": "RIGHT", "path": ".github/workflows/build_wheels.yml", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNzoxNDo0MlrOGelrGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNzo0MTowN1rOGf3fjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyNzcwNQ==", "bodyText": "Are we planning to add windows here or to another file?", "url": "https://github.com/apache/beam/pull/11877#discussion_r434727705", "createdAt": "2020-06-03T17:14:42Z", "author": {"login": "aaltay"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: sdks/python/dist\n+\n+  prepare_gcs:\n+    name: Prepare GCS\n+    needs: build_source\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Remove existing files on GCS bucket\n+        run: gsutil rm -r \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\" || true\n+\n+  upload_source_to_gcs:\n+    name: Upload source to GCS bucket\n+    needs: prepare_gcs\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Download wheels\n+        uses: actions/download-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: source/\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Copy sources to GCS bucket\n+        run: gsutil cp -r -a public-read source/* gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\n+      - name: List sources on GCS bucket\n+        run: |\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.tar.gz\"\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.zip\"\n+\n+  build_wheels:\n+    name: Build wheels on ${{ matrix.os }}\n+    needs: prepare_gcs\n+    runs-on: ${{ matrix.os }}\n+    strategy:\n+      matrix:\n+        os : [ubuntu-18.04, macos-10.15]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTIxMjM5MA==", "bodyText": "Since some unix specific c libraries are not present on windows (unistd.h, get_clocktime) I will work on it in separate branch/PR. I think there will be no need to create seperate file for windows", "url": "https://github.com/apache/beam/pull/11877#discussion_r435212390", "createdAt": "2020-06-04T12:25:12Z", "author": {"login": "TobKed"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: sdks/python/dist\n+\n+  prepare_gcs:\n+    name: Prepare GCS\n+    needs: build_source\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Remove existing files on GCS bucket\n+        run: gsutil rm -r \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\" || true\n+\n+  upload_source_to_gcs:\n+    name: Upload source to GCS bucket\n+    needs: prepare_gcs\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Download wheels\n+        uses: actions/download-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: source/\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Copy sources to GCS bucket\n+        run: gsutil cp -r -a public-read source/* gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\n+      - name: List sources on GCS bucket\n+        run: |\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.tar.gz\"\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.zip\"\n+\n+  build_wheels:\n+    name: Build wheels on ${{ matrix.os }}\n+    needs: prepare_gcs\n+    runs-on: ${{ matrix.os }}\n+    strategy:\n+      matrix:\n+        os : [ubuntu-18.04, macos-10.15]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyNzcwNQ=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzMTE0MQ==", "bodyText": "Perfect. (just to clarify my understanding: we will have a single github ci config, this is correct, right?)", "url": "https://github.com/apache/beam/pull/11877#discussion_r435631141", "createdAt": "2020-06-05T00:41:54Z", "author": {"login": "aaltay"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: sdks/python/dist\n+\n+  prepare_gcs:\n+    name: Prepare GCS\n+    needs: build_source\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Remove existing files on GCS bucket\n+        run: gsutil rm -r \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\" || true\n+\n+  upload_source_to_gcs:\n+    name: Upload source to GCS bucket\n+    needs: prepare_gcs\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Download wheels\n+        uses: actions/download-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: source/\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Copy sources to GCS bucket\n+        run: gsutil cp -r -a public-read source/* gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\n+      - name: List sources on GCS bucket\n+        run: |\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.tar.gz\"\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.zip\"\n+\n+  build_wheels:\n+    name: Build wheels on ${{ matrix.os }}\n+    needs: prepare_gcs\n+    runs-on: ${{ matrix.os }}\n+    strategy:\n+      matrix:\n+        os : [ubuntu-18.04, macos-10.15]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyNzcwNQ=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA2ODIzOA==", "bodyText": "Hopefully yes \ud83d\ude04", "url": "https://github.com/apache/beam/pull/11877#discussion_r436068238", "createdAt": "2020-06-05T17:41:07Z", "author": {"login": "TobKed"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: sdks/python/dist\n+\n+  prepare_gcs:\n+    name: Prepare GCS\n+    needs: build_source\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Remove existing files on GCS bucket\n+        run: gsutil rm -r \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\" || true\n+\n+  upload_source_to_gcs:\n+    name: Upload source to GCS bucket\n+    needs: prepare_gcs\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Download wheels\n+        uses: actions/download-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: source/\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Copy sources to GCS bucket\n+        run: gsutil cp -r -a public-read source/* gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\n+      - name: List sources on GCS bucket\n+        run: |\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.tar.gz\"\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.zip\"\n+\n+  build_wheels:\n+    name: Build wheels on ${{ matrix.os }}\n+    needs: prepare_gcs\n+    runs-on: ${{ matrix.os }}\n+    strategy:\n+      matrix:\n+        os : [ubuntu-18.04, macos-10.15]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcyNzcwNQ=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMDIxODMwOnYy", "diffSide": "RIGHT", "path": ".github/workflows/build_wheels.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwODo1MTozN1rOGe8G5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNzo0MToyOVrOGf3gOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTA5NTI3MQ==", "bodyText": "typo", "url": "https://github.com/apache/beam/pull/11877#discussion_r435095271", "createdAt": "2020-06-04T08:51:37Z", "author": {"login": "kamilwu"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA2ODQxMA==", "bodyText": "Thanks!. Fixed", "url": "https://github.com/apache/beam/pull/11877#discussion_r436068410", "createdAt": "2020-06-05T17:41:29Z", "author": {"login": "TobKed"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTA5NTI3MQ=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMDI0NDY4OnYy", "diffSide": "RIGHT", "path": ".github/workflows/build_wheels.yml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwODo1ODo0M1rOGe8X1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNzo0MTo1M1rOGf3g_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTA5OTYwNw==", "bodyText": "Do we need higher verbosity normally?", "url": "https://github.com/apache/beam/pull/11877#discussion_r435099607", "createdAt": "2020-06-04T08:58:43Z", "author": {"login": "kamilwu"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: sdks/python/dist\n+\n+  prepare_gcs:\n+    name: Prepare GCS\n+    needs: build_source\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Remove existing files on GCS bucket\n+        run: gsutil rm -r \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\" || true\n+\n+  upload_source_to_gcs:\n+    name: Upload source to GCS bucket\n+    needs: prepare_gcs\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Download wheels\n+        uses: actions/download-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: source/\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Copy sources to GCS bucket\n+        run: gsutil cp -r -a public-read source/* gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\n+      - name: List sources on GCS bucket\n+        run: |\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.tar.gz\"\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.zip\"\n+\n+  build_wheels:\n+    name: Build wheels on ${{ matrix.os }}\n+    needs: prepare_gcs\n+    runs-on: ${{ matrix.os }}\n+    strategy:\n+      matrix:\n+        os : [ubuntu-18.04, macos-10.15]\n+    steps:\n+    - name: Download source\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: source\n+        path: apache-beam-source\n+    - name: Install Python\n+      uses: actions/setup-python@v2\n+      with:\n+        python-version: 3.7\n+    - name: Install packages on Mac\n+      if: startsWith(matrix.os, 'macos')\n+      run: |\n+        brew update\n+        brew install pkg-config\n+    - name: Install cibuildwheel\n+      run: pip install cibuildwheel==1.4.2\n+    - name: Build wheel\n+      working-directory: apache-beam-source\n+      env:\n+        CIBW_BUILD: cp27-* cp35-* cp36-* cp37-*\n+        CIBW_BUILD_VERBOSITY: 3", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwMzg1Ng==", "bodyText": "Good point, we don't need it I think. I will remove this line so the default verbosity will be used.", "url": "https://github.com/apache/beam/pull/11877#discussion_r435403856", "createdAt": "2020-06-04T16:50:03Z", "author": {"login": "TobKed"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: sdks/python/dist\n+\n+  prepare_gcs:\n+    name: Prepare GCS\n+    needs: build_source\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Remove existing files on GCS bucket\n+        run: gsutil rm -r \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\" || true\n+\n+  upload_source_to_gcs:\n+    name: Upload source to GCS bucket\n+    needs: prepare_gcs\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Download wheels\n+        uses: actions/download-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: source/\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Copy sources to GCS bucket\n+        run: gsutil cp -r -a public-read source/* gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\n+      - name: List sources on GCS bucket\n+        run: |\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.tar.gz\"\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.zip\"\n+\n+  build_wheels:\n+    name: Build wheels on ${{ matrix.os }}\n+    needs: prepare_gcs\n+    runs-on: ${{ matrix.os }}\n+    strategy:\n+      matrix:\n+        os : [ubuntu-18.04, macos-10.15]\n+    steps:\n+    - name: Download source\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: source\n+        path: apache-beam-source\n+    - name: Install Python\n+      uses: actions/setup-python@v2\n+      with:\n+        python-version: 3.7\n+    - name: Install packages on Mac\n+      if: startsWith(matrix.os, 'macos')\n+      run: |\n+        brew update\n+        brew install pkg-config\n+    - name: Install cibuildwheel\n+      run: pip install cibuildwheel==1.4.2\n+    - name: Build wheel\n+      working-directory: apache-beam-source\n+      env:\n+        CIBW_BUILD: cp27-* cp35-* cp36-* cp37-*\n+        CIBW_BUILD_VERBOSITY: 3", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTA5OTYwNw=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA2ODYwNA==", "bodyText": "Fixed.", "url": "https://github.com/apache/beam/pull/11877#discussion_r436068604", "createdAt": "2020-06-05T17:41:53Z", "author": {"login": "TobKed"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt\n+      - name: Install wheels\n+        run: python3 -m pip install wheel\n+      - name: Buld source\n+        working-directory: ./sdks/python\n+        run: python3 setup.py sdist --formats=gztar,zip\n+      - name: Unzip source\n+        working-directory: ./sdks/python\n+        run: unzip dist/$(ls dist | grep .zip | head -n 1)\n+      - name: Rename source directory\n+        working-directory: ./sdks/python\n+        run: mv $(ls | grep apache-beam) apache-beam-source\n+      - name: Upload source\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source\n+          path: sdks/python/apache-beam-source\n+      - name: Upload compressed sources\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: sdks/python/dist\n+\n+  prepare_gcs:\n+    name: Prepare GCS\n+    needs: build_source\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Remove existing files on GCS bucket\n+        run: gsutil rm -r \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\" || true\n+\n+  upload_source_to_gcs:\n+    name: Upload source to GCS bucket\n+    needs: prepare_gcs\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Download wheels\n+        uses: actions/download-artifact@v2\n+        with:\n+          name: source_gztar_zip\n+          path: source/\n+      - name: Authenticate on GCP\n+        uses: GoogleCloudPlatform/github-actions/setup-gcloud@master\n+        with:\n+          service_account_email: ${{ secrets.CCP_SA_EMAIL }}\n+          service_account_key: ${{ secrets.CCP_SA_KEY }}\n+      - name: Copy sources to GCS bucket\n+        run: gsutil cp -r -a public-read source/* gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/\n+      - name: List sources on GCS bucket\n+        run: |\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.tar.gz\"\n+          gsutil ls \"gs://${{ secrets.CCP_BUCKET }}/${GITHUB_REF##*/}/*.zip\"\n+\n+  build_wheels:\n+    name: Build wheels on ${{ matrix.os }}\n+    needs: prepare_gcs\n+    runs-on: ${{ matrix.os }}\n+    strategy:\n+      matrix:\n+        os : [ubuntu-18.04, macos-10.15]\n+    steps:\n+    - name: Download source\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: source\n+        path: apache-beam-source\n+    - name: Install Python\n+      uses: actions/setup-python@v2\n+      with:\n+        python-version: 3.7\n+    - name: Install packages on Mac\n+      if: startsWith(matrix.os, 'macos')\n+      run: |\n+        brew update\n+        brew install pkg-config\n+    - name: Install cibuildwheel\n+      run: pip install cibuildwheel==1.4.2\n+    - name: Build wheel\n+      working-directory: apache-beam-source\n+      env:\n+        CIBW_BUILD: cp27-* cp35-* cp36-* cp37-*\n+        CIBW_BUILD_VERBOSITY: 3", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTA5OTYwNw=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMDI5MzkwOnYy", "diffSide": "RIGHT", "path": ".github/workflows/build_wheels.yml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwOToxMTo1NVrOGe83gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNjo1Njo0MVrOGfPMeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTEwNzcxNQ==", "bodyText": "I think we don't need cython at this point, since it's installed and used in build_wheels job. Most probably the same applies to wheels.", "url": "https://github.com/apache/beam/pull/11877#discussion_r435107715", "createdAt": "2020-06-04T09:11:55Z", "author": {"login": "kamilwu"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwNzk5Mw==", "bodyText": "Good point \ud83d\udc4d\nI've tested and for build_source job only python3 -m pip install -r build-requirements.txt is required, then python -m pip install cython is executed in build_wheels.", "url": "https://github.com/apache/beam/pull/11877#discussion_r435407993", "createdAt": "2020-06-04T16:56:41Z", "author": {"login": "TobKed"}, "path": ".github/workflows/build_wheels.yml", "diffHunk": "@@ -0,0 +1,141 @@\n+name: Build python wheels\n+\n+on:\n+  push:\n+    branches:\n+      - master\n+      - release-*\n+    tags:\n+      - v*\n+\n+jobs:\n+\n+  build_source:\n+    runs-on: ubuntu-18.04\n+    steps:\n+      - name: Checkout code\n+        uses: actions/checkout@v2\n+      - name: Install python\n+        uses: actions/setup-python@v2\n+        with:\n+          python-version: 3.7\n+      - name: Get build dependencies\n+        working-directory: ./sdks/python\n+        run: python3 -m pip install cython && python3 -m pip install -r build-requirements.txt", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTEwNzcxNQ=="}, "originalCommit": {"oid": "c9282b21d37ab619cb647b509c791f9d0cfeed69"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3748, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}