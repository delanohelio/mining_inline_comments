{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5MDk3NzI3", "number": 13435, "title": " [BEAM-11358] Remove unused endOfStreamMonitor from nexmark and remove redundant distributions from monitor", "bodyText": "The endOfStreamMonitor in the NexmarkQuery class is not used. The monitor class also had start and end distributions, which used the same values. This PR removes the unused monitor and merges the start and end distributions.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-11-29T11:52:35Z", "url": "https://github.com/apache/beam/pull/13435", "merged": true, "mergeCommit": {"oid": "38464d152b9ca4f725bec51f6909a6d7f19d8f42"}, "closed": true, "closedAt": "2021-01-08T09:39:41Z", "author": {"login": "rHermes"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhR7cXgBqjQwNDkwOTk1MDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABduFdVVgFqTU2NDEyMzAzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "126e037f73812fefc3fe6f7aacef612b492fbd72", "author": {"user": {"login": "rHermes", "name": "Teodor Sp\u00e6ren"}}, "url": "https://github.com/apache/beam/commit/126e037f73812fefc3fe6f7aacef612b492fbd72", "committedDate": "2020-11-29T14:45:16Z", "message": "Merge redundant distributions in nexmark monitor"}, "afterCommit": {"oid": "4b64d6fd53fe601d17cf57802ed1f6d85f3e0e61", "author": {"user": {"login": "rHermes", "name": "Teodor Sp\u00e6ren"}}, "url": "https://github.com/apache/beam/commit/4b64d6fd53fe601d17cf57802ed1f6d85f3e0e61", "committedDate": "2020-11-29T14:49:52Z", "message": "Merge redundant distributions in nexmark monitor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "59fed14609ec082df07b010e7c55b35b2a9daf11", "author": {"user": {"login": "rHermes", "name": "Teodor Sp\u00e6ren"}}, "url": "https://github.com/apache/beam/commit/59fed14609ec082df07b010e7c55b35b2a9daf11", "committedDate": "2020-11-29T21:13:02Z", "message": "Fix mixup from earlier"}, "afterCommit": {"oid": "af09a5b61ab97ec22f175fa9a3b4ef5ff4f28555", "author": {"user": {"login": "rHermes", "name": "Teodor Sp\u00e6ren"}}, "url": "https://github.com/apache/beam/commit/af09a5b61ab97ec22f175fa9a3b4ef5ff4f28555", "committedDate": "2020-11-30T13:40:07Z", "message": "Remove unused endOfStreamMonitor from nexmark"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzODE5MzY1", "url": "https://github.com/apache/beam/pull/13435#pullrequestreview-543819365", "createdAt": "2020-12-03T10:36:57Z", "commit": {"oid": "af09a5b61ab97ec22f175fa9a3b4ef5ff4f28555"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMDozNjo1N1rOH-Snyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxMToxMzoxMlrOIFLkmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTA3ODg1OQ==", "bodyText": "please revert this change as it is unrelated", "url": "https://github.com/apache/beam/pull/13435#discussion_r535078859", "createdAt": "2020-12-03T10:36:57Z", "author": {"login": "echauchot"}, "path": "runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/External.java", "diffHunk": "@@ -78,7 +78,7 @@\n   private static AtomicInteger namespaceCounter = new AtomicInteger(0);\n \n   private static final ExpansionServiceClientFactory DEFAULT =\n-     DefaultExpansionServiceClientFactory.create(\n+      DefaultExpansionServiceClientFactory.create(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af09a5b61ab97ec22f175fa9a3b4ef5ff4f28555"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjI2NjIyMQ==", "bodyText": "+1 on cleaning", "url": "https://github.com/apache/beam/pull/13435#discussion_r542266221", "createdAt": "2020-12-14T10:15:50Z", "author": {"login": "echauchot"}, "path": "sdks/java/testing/nexmark/src/main/java/org/apache/beam/sdk/nexmark/queries/NexmarkQuery.java", "diffHunk": "@@ -39,7 +39,6 @@\n   final NexmarkConfiguration configuration;\n   public final Monitor<Event> eventMonitor;\n   public final Monitor<T> resultMonitor;\n-  private final Monitor<Event> endOfStreamMonitor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af09a5b61ab97ec22f175fa9a3b4ef5ff4f28555"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjI5NTU2MA==", "bodyText": "it is not a timeStamp, it is in processing time (the wall clock) as opposed to a timestamp which is a component of an element put by the source. Please rename to \"processingTime\"", "url": "https://github.com/apache/beam/pull/13435#discussion_r542295560", "createdAt": "2020-12-14T11:00:24Z", "author": {"login": "echauchot"}, "path": "sdks/java/testing/nexmark/src/main/java/org/apache/beam/sdk/nexmark/Monitor.java", "diffHunk": "@@ -39,20 +39,15 @@\n   private class MonitorDoFn extends DoFn<T, T> {\n     final Counter elementCounter = Metrics.counter(name, prefix + \".elements\");\n     final Counter bytesCounter = Metrics.counter(name, prefix + \".bytes\");\n-    final Distribution startTime = Metrics.distribution(name, prefix + \".startTime\");\n-    final Distribution endTime = Metrics.distribution(name, prefix + \".endTime\");\n-    final Distribution startTimestamp = Metrics.distribution(name, prefix + \".startTimestamp\");\n-    final Distribution endTimestamp = Metrics.distribution(name, prefix + \".endTimestamp\");\n+    final Distribution systemTimestamp = Metrics.distribution(name, prefix + \".systemTimestamp\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af09a5b61ab97ec22f175fa9a3b4ef5ff4f28555"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjI5Nzg3OA==", "bodyText": "true that this expression is equivalent and simpler but less readable. I would prefer a revert", "url": "https://github.com/apache/beam/pull/13435#discussion_r542297878", "createdAt": "2020-12-14T11:04:05Z", "author": {"login": "echauchot"}, "path": "sdks/java/testing/nexmark/src/main/java/org/apache/beam/sdk/nexmark/NexmarkLauncher.java", "diffHunk": "@@ -302,7 +302,7 @@ private NexmarkPerf currentPerf(\n       effectiveEnd = eventEnd;\n     }\n \n-    if (effectiveEnd >= 0 && eventStart >= 0 && effectiveEnd >= eventStart) {\n+    if (eventStart >= 0 && effectiveEnd >= eventStart) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af09a5b61ab97ec22f175fa9a3b4ef5ff4f28555"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjI5ODEzMQ==", "bodyText": "same here", "url": "https://github.com/apache/beam/pull/13435#discussion_r542298131", "createdAt": "2020-12-14T11:04:26Z", "author": {"login": "echauchot"}, "path": "sdks/java/testing/nexmark/src/main/java/org/apache/beam/sdk/nexmark/NexmarkLauncher.java", "diffHunk": "@@ -336,7 +336,7 @@ private NexmarkPerf currentPerf(\n       perf.startupDelaySec = (eventStart - startMsSinceEpoch) / 1000.0;\n     }\n \n-    if (resultStart >= 0 && eventStart >= 0 && resultStart >= eventStart) {\n+    if (eventStart >= 0 && resultStart >= eventStart) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af09a5b61ab97ec22f175fa9a3b4ef5ff4f28555"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjMwMzM4NA==", "bodyText": "agree with your simplification for these reasons:\n\nfor each element processed, the distribution metrics start and end will be updated with the same value and, as the distribution reports min, max and average, and, as in MetricsReader we are requesting the minimum and the maximum, there is no impact of having a single distribution\nthe methods in MetricsReader use a SplitIterator on the distributions that is not immutable for the underlying source (which could explain that there was 2 distributions created) but it does only reading (by calling getMin() and getMax()) so there will be no side effect on the underlying distribution.", "url": "https://github.com/apache/beam/pull/13435#discussion_r542303384", "createdAt": "2020-12-14T11:13:12Z", "author": {"login": "echauchot"}, "path": "sdks/java/testing/nexmark/src/main/java/org/apache/beam/sdk/nexmark/Monitor.java", "diffHunk": "@@ -39,20 +39,15 @@\n   private class MonitorDoFn extends DoFn<T, T> {\n     final Counter elementCounter = Metrics.counter(name, prefix + \".elements\");\n     final Counter bytesCounter = Metrics.counter(name, prefix + \".bytes\");\n-    final Distribution startTime = Metrics.distribution(name, prefix + \".startTime\");\n-    final Distribution endTime = Metrics.distribution(name, prefix + \".endTime\");\n-    final Distribution startTimestamp = Metrics.distribution(name, prefix + \".startTimestamp\");\n-    final Distribution endTimestamp = Metrics.distribution(name, prefix + \".endTimestamp\");\n+    final Distribution systemTimestamp = Metrics.distribution(name, prefix + \".systemTimestamp\");\n+    final Distribution eventTimestamp = Metrics.distribution(name, prefix + \".eventTimestamp\");\n \n     @ProcessElement\n     public void processElement(ProcessContext c) {\n       elementCounter.inc();\n       bytesCounter.inc(c.element().sizeInBytes());\n-      long now = System.currentTimeMillis();\n-      startTime.update(now);\n-      endTime.update(now);\n-      startTimestamp.update(c.timestamp().getMillis());\n-      endTimestamp.update(c.timestamp().getMillis());\n+      systemTimestamp.update(System.currentTimeMillis());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af09a5b61ab97ec22f175fa9a3b4ef5ff4f28555"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "995c776192cba6404c6a24cf694ad6a797ede7a7", "author": {"user": {"login": "rHermes", "name": "Teodor Sp\u00e6ren"}}, "url": "https://github.com/apache/beam/commit/995c776192cba6404c6a24cf694ad6a797ede7a7", "committedDate": "2020-12-16T18:42:22Z", "message": "Remove unused endOfStreamMonitor from nexmark"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af09a5b61ab97ec22f175fa9a3b4ef5ff4f28555", "author": {"user": {"login": "rHermes", "name": "Teodor Sp\u00e6ren"}}, "url": "https://github.com/apache/beam/commit/af09a5b61ab97ec22f175fa9a3b4ef5ff4f28555", "committedDate": "2020-11-30T13:40:07Z", "message": "Remove unused endOfStreamMonitor from nexmark"}, "afterCommit": {"oid": "995c776192cba6404c6a24cf694ad6a797ede7a7", "author": {"user": {"login": "rHermes", "name": "Teodor Sp\u00e6ren"}}, "url": "https://github.com/apache/beam/commit/995c776192cba6404c6a24cf694ad6a797ede7a7", "committedDate": "2020-12-16T18:42:22Z", "message": "Remove unused endOfStreamMonitor from nexmark"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMjg2MjU3", "url": "https://github.com/apache/beam/pull/13435#pullrequestreview-563286257", "createdAt": "2021-01-07T08:20:02Z", "commit": {"oid": "995c776192cba6404c6a24cf694ad6a797ede7a7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0b8ffdf8029a44ca090d74cbcdb86e611833338", "author": {"user": {"login": "rHermes", "name": "Teodor Sp\u00e6ren"}}, "url": "https://github.com/apache/beam/commit/b0b8ffdf8029a44ca090d74cbcdb86e611833338", "committedDate": "2021-01-07T10:53:49Z", "message": "Also rename metric"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0MTIzMDM2", "url": "https://github.com/apache/beam/pull/13435#pullrequestreview-564123036", "createdAt": "2021-01-08T09:39:19Z", "commit": {"oid": "b0b8ffdf8029a44ca090d74cbcdb86e611833338"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4608, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}