{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwNjE0NDYx", "number": 10762, "title": "[BEAM-3453] Use project specified in pipeline_options when creating pubsub subscription", "bodyText": "When creating a pubsub subscription, use the default project in GCP if available, rather than the project specified in the pubsub topic.\nR: @aaltay\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-02-04T02:24:41Z", "url": "https://github.com/apache/beam/pull/10762", "merged": true, "mergeCommit": {"oid": "a7059deef4f0c22ee716561b295f79ba782e4e14"}, "closed": true, "closedAt": "2020-02-07T18:58:56Z", "author": {"login": "davidyan74"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcA4AOsgH2gAyMzcwNjE0NDYxOjllNTFjOTcxMzk3MDQwNTY0ZTZmZjY2ZTdmMWU5NWM3ZWUxZjAyZDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBvowuAH2gAyMzcwNjE0NDYxOjk1ZjIzOTM5MDYwMTk4NjQ5NWRlMmEyN2U1NzMwOWM5OTEwYjI3NjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9e51c971397040564e6ff66e7f1e95c7ee1f02d5", "author": {"user": {"login": "davidyan74", "name": "David Yan"}}, "url": "https://github.com/apache/beam/commit/9e51c971397040564e6ff66e7f1e95c7ee1f02d5", "committedDate": "2020-02-04T02:21:01Z", "message": "[BEAM-3453] Use default project when creating pubsub subscription"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNjk0NzM0", "url": "https://github.com/apache/beam/pull/10762#pullrequestreview-352694734", "createdAt": "2020-02-04T02:45:01Z", "commit": {"oid": "9e51c971397040564e6ff66e7f1e95c7ee1f02d5"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMjo0NTowMVrOFlGltw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMjo0OToxNlrOFlGpVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ0OTU5MQ==", "bodyText": "Beam has this pipeline option, project which is generally used to specify project explicitly. Asking user explicitly for resource avoid surprises. Shall we use it. \n  \n    \n      beam/sdks/python/apache_beam/options/pipeline_options.py\n    \n    \n         Line 473\n      in\n      40c2be0\n    \n    \n    \n    \n\n        \n          \n           parser.add_argument('--project',", "url": "https://github.com/apache/beam/pull/10762#discussion_r374449591", "createdAt": "2020-02-04T02:45:01Z", "author": {"login": "angoenka"}, "path": "sdks/python/apache_beam/runners/direct/transform_evaluator.py", "diffHunk": "@@ -499,13 +499,21 @@ def __init__(self, evaluation_context, applied_ptransform,\n     if self.source.id_label:\n       raise NotImplementedError(\n           'DirectRunner: id_label is not supported for PubSub reads')\n+\n+    import google.auth\n+\n+    _, sub_project = google.auth.default()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e51c971397040564e6ff66e7f1e95c7ee1f02d5"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ1MDUxOA==", "bodyText": "We can fall back to topic's project if this fails. This also maintains the current functionality.", "url": "https://github.com/apache/beam/pull/10762#discussion_r374450518", "createdAt": "2020-02-04T02:49:16Z", "author": {"login": "angoenka"}, "path": "sdks/python/apache_beam/runners/direct/transform_evaluator.py", "diffHunk": "@@ -516,7 +524,7 @@ def get_subscription(cls, transform, project, short_topic_name,\n \n     sub_client = pubsub.SubscriberClient()\n     sub_name = sub_client.subscription_path(\n-        project, 'beam_%d_%x' % (int(time.time()), random.randrange(1 << 32)))\n+        sub_project, 'beam_%d_%x' % (int(time.time()), random.randrange(1 << 32)))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e51c971397040564e6ff66e7f1e95c7ee1f02d5"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdcc8b893acf31748946ca357e2a3f4fac79b5ec", "author": {"user": {"login": "davidyan74", "name": "David Yan"}}, "url": "https://github.com/apache/beam/commit/cdcc8b893acf31748946ca357e2a3f4fac79b5ec", "committedDate": "2020-02-05T01:08:24Z", "message": "Use pipeline_options to get the project information first, then the default project from auth, then from the topic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e022e816ed55522a893ccc7d66dbef252a6443f2", "author": {"user": {"login": "davidyan74", "name": "David Yan"}}, "url": "https://github.com/apache/beam/commit/e022e816ed55522a893ccc7d66dbef252a6443f2", "committedDate": "2020-02-06T00:03:57Z", "message": "Merge branch 'master' of https://github.com/apache/beam into BEAM-3453"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f78dd7d507cf3e6ffb60698a40b1f2b657665a61", "author": {"user": {"login": "davidyan74", "name": "David Yan"}}, "url": "https://github.com/apache/beam/commit/f78dd7d507cf3e6ffb60698a40b1f2b657665a61", "committedDate": "2020-02-06T00:10:27Z", "message": "Removed the code that gets the project from google.auth. Added an entry about the change in CHANGES.md since it's potentially backward incompatible."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MTQ0MzM3", "url": "https://github.com/apache/beam/pull/10762#pullrequestreview-354144337", "createdAt": "2020-02-06T01:01:43Z", "commit": {"oid": "f78dd7d507cf3e6ffb60698a40b1f2b657665a61"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MTQ4NjI1", "url": "https://github.com/apache/beam/pull/10762#pullrequestreview-354148625", "createdAt": "2020-02-06T01:15:19Z", "commit": {"oid": "f78dd7d507cf3e6ffb60698a40b1f2b657665a61"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15ce9584c0a10380c599d57f77065c700b20dc9d", "author": {"user": {"login": "davidyan74", "name": "David Yan"}}, "url": "https://github.com/apache/beam/commit/15ce9584c0a10380c599d57f77065c700b20dc9d", "committedDate": "2020-02-06T02:07:09Z", "message": "lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "820d1b16a9e0ea4c8c0bbdb10a7eabe5346d7253", "author": {"user": {"login": "davidyan74", "name": "David Yan"}}, "url": "https://github.com/apache/beam/commit/820d1b16a9e0ea4c8c0bbdb10a7eabe5346d7253", "committedDate": "2020-02-06T19:03:57Z", "message": "Merge branch 'master' of https://github.com/apache/beam into BEAM-3453"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95f239390601986495de2a27e57309c9910b2760", "author": {"user": {"login": "davidyan74", "name": "David Yan"}}, "url": "https://github.com/apache/beam/commit/95f239390601986495de2a27e57309c9910b2760", "committedDate": "2020-02-06T19:10:04Z", "message": "yapf formatting"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3390, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}