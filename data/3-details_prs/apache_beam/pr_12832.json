{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1NTMzNTA2", "number": 12832, "title": "[BEAM-10906] Add basic ToRows transform.", "bodyText": "This will make it easier to create schema'd PCollections.\nThis includes improvements to type inference to be able to better\nunderstand the Row type and apply getattr(...).\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-09-11T22:50:12Z", "url": "https://github.com/apache/beam/pull/12832", "merged": true, "mergeCommit": {"oid": "51cb377d92ffc276f40ae333aab52bb848284929"}, "closed": true, "closedAt": "2020-09-17T23:51:02Z", "author": {"login": "robertwb"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdH9cG-gH2gAyNDg1NTMzNTA2OjExY2RmZjE2Yzc5Y2EyMTU4OTMwYzI0MjhmZGIyYTQ5YWI3MTYxODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJ1IKJAFqTQ5MDg2Njg0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "11cdff16c79ca2158930c2428fdb2a49ab716187", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/11cdff16c79ca2158930c2428fdb2a49ab716187", "committedDate": "2020-09-11T22:49:37Z", "message": "Add basic ToRows transform.\n\nThis will make it easier to create schema'd PCollections.\n\nThis includes improvements to type inference to be able to better\nunderstand the Row type and apply getattr(...)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e92ffc9fb8c58579d9d3aa450cb1eea12f57fcf", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/0e92ffc9fb8c58579d9d3aa450cb1eea12f57fcf", "committedDate": "2020-09-14T22:37:00Z", "message": "lint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjE5MjU0", "url": "https://github.com/apache/beam/pull/12832#pullrequestreview-489219254", "createdAt": "2020-09-16T01:53:02Z", "commit": {"oid": "0e92ffc9fb8c58579d9d3aa450cb1eea12f57fcf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMTo1MzowM1rOHSdK2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMTo1NToxMFrOHSdM8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTExNDMyOQ==", "bodyText": "Nit: For simplicity I'd only support the kwargs format.\n(My personal preference would be to always use kwargs so it's clear what's being mapped to what.)", "url": "https://github.com/apache/beam/pull/12832#discussion_r489114329", "createdAt": "2020-09-16T01:53:03Z", "author": {"login": "udim"}, "path": "sdks/python/apache_beam/transforms/core.py", "diffHunk": "@@ -2519,6 +2520,45 @@ def expand(self, pcoll):\n             (*(key + value))))\n \n \n+class ToRows(PTransform):\n+  \"\"\"Converts the elements of a PCollection into a schema'd PCollection of Rows.\n+\n+  `ToRow(...)` is roughly equivalent to `Map(lambda x: Row(...))` where each\n+  argument (which may be a string or callable) of `ToRow` is applied to `x`.\n+  For example,\n+\n+      pcoll | beam.ToRow('a', b=lambda x: foo(x))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e92ffc9fb8c58579d9d3aa450cb1eea12f57fcf"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTExNDg2Nw==", "bodyText": "I recommend testing internally since this may break some tests.", "url": "https://github.com/apache/beam/pull/12832#discussion_r489114867", "createdAt": "2020-09-16T01:55:10Z", "author": {"login": "udim"}, "path": "sdks/python/apache_beam/typehints/trivial_inference.py", "diffHunk": "@@ -320,6 +325,10 @@ def infer_return_type(c, input_types, debug=False, depth=5):\n             dict: typehints.Dict[Any, Any]\n         }[c]\n       return c\n+    elif (c == getattr and len(input_types) == 2 and", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e92ffc9fb8c58579d9d3aa450cb1eea12f57fcf"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5Nzc0NjU2", "url": "https://github.com/apache/beam/pull/12832#pullrequestreview-489774656", "createdAt": "2020-09-16T15:59:04Z", "commit": {"oid": "0e92ffc9fb8c58579d9d3aa450cb1eea12f57fcf"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNTo1OTowNVrOHS3yFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxNTo1OTozNlrOHS3zXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU1MDM1Ng==", "bodyText": "Done. All looks well.", "url": "https://github.com/apache/beam/pull/12832#discussion_r489550356", "createdAt": "2020-09-16T15:59:05Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/typehints/trivial_inference.py", "diffHunk": "@@ -320,6 +325,10 @@ def infer_return_type(c, input_types, debug=False, depth=5):\n             dict: typehints.Dict[Any, Any]\n         }[c]\n       return c\n+    elif (c == getattr and len(input_types) == 2 and", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTExNDg2Nw=="}, "originalCommit": {"oid": "0e92ffc9fb8c58579d9d3aa450cb1eea12f57fcf"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU1MDY4NA==", "bodyText": "Good call. Done.", "url": "https://github.com/apache/beam/pull/12832#discussion_r489550684", "createdAt": "2020-09-16T15:59:36Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/transforms/core.py", "diffHunk": "@@ -2519,6 +2520,45 @@ def expand(self, pcoll):\n             (*(key + value))))\n \n \n+class ToRows(PTransform):\n+  \"\"\"Converts the elements of a PCollection into a schema'd PCollection of Rows.\n+\n+  `ToRow(...)` is roughly equivalent to `Map(lambda x: Row(...))` where each\n+  argument (which may be a string or callable) of `ToRow` is applied to `x`.\n+  For example,\n+\n+      pcoll | beam.ToRow('a', b=lambda x: foo(x))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTExNDMyOQ=="}, "originalCommit": {"oid": "0e92ffc9fb8c58579d9d3aa450cb1eea12f57fcf"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b66878f36e7bb48f0a366493404a9cd3fefc01af", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/b66878f36e7bb48f0a366493404a9cd3fefc01af", "committedDate": "2020-09-16T15:58:00Z", "message": "Require keyword arguments."}, "afterCommit": {"oid": "0e92ffc9fb8c58579d9d3aa450cb1eea12f57fcf", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/0e92ffc9fb8c58579d9d3aa450cb1eea12f57fcf", "committedDate": "2020-09-14T22:37:00Z", "message": "lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c8b3fd7ded8cacabf375dd53421cec567066679", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/6c8b3fd7ded8cacabf375dd53421cec567066679", "committedDate": "2020-09-17T00:07:20Z", "message": "Rename ToRows to Select."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "616ae9d0dae94cb3923d4b92fdcce0b79af795cb", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/616ae9d0dae94cb3923d4b92fdcce0b79af795cb", "committedDate": "2020-09-17T00:11:32Z", "message": "Merge branch 'master' into to-row"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9616a8213bf48d5706304bda8818d6216cf3168", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/b9616a8213bf48d5706304bda8818d6216cf3168", "committedDate": "2020-09-17T00:34:58Z", "message": "Fix groupby tests."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwODY2ODQw", "url": "https://github.com/apache/beam/pull/12832#pullrequestreview-490866840", "createdAt": "2020-09-17T18:16:26Z", "commit": {"oid": "b9616a8213bf48d5706304bda8818d6216cf3168"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2715, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}