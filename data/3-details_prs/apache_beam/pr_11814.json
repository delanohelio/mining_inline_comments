{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyOTY1MjYz", "number": 11814, "title": "[BEAM-10078] uniquify Dataflow specific jars when staging", "bodyText": "After BEAM-9383, Dataflow specific jars (dataflow-worker.jar, windmill_main) could be overwritten when two or more jobs share the same staging location. Since they 1) should have specific predefined names AND 2) should have unique location for avoiding collision, they need special handling when staging artifacts.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-05-26T03:20:14Z", "url": "https://github.com/apache/beam/pull/11814", "merged": true, "mergeCommit": {"oid": "7978c0fe04385358c6816b79d6a2fcda9a858df0"}, "closed": true, "closedAt": "2020-05-29T15:49:15Z", "author": {"login": "ihji"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcleN5ugH2gAyNDIyOTY1MjYzOjA0ZThlMDk1MDQzZTU2MzA1OTI1NWVkZGE3Nzk1YzUxYTIxZDRiZDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclzvHVAH2gAyNDIyOTY1MjYzOmRlYTc5M2Q5ZGFlNGY2MTJkYzE1MDQ3Yzg5MmY1MjE0N2ZlMTliMmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "04e8e095043e563059255edda7795c51a21d4bd6", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/04e8e095043e563059255edda7795c51a21d4bd6", "committedDate": "2020-05-27T19:13:37Z", "message": "[BEAM-10078] uniquify Dataflow specific jars when staging"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8166fe30f008b6df41d49caf15f0635bc27dcd2c", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/8166fe30f008b6df41d49caf15f0635bc27dcd2c", "committedDate": "2020-05-26T03:06:49Z", "message": "[BEAM-10078] uniquify Dataflow specific jars when staging"}, "afterCommit": {"oid": "04e8e095043e563059255edda7795c51a21d4bd6", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/04e8e095043e563059255edda7795c51a21d4bd6", "committedDate": "2020-05-27T19:13:37Z", "message": "[BEAM-10078] uniquify Dataflow specific jars when staging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NTM3MjY5", "url": "https://github.com/apache/beam/pull/11814#pullrequestreview-419537269", "createdAt": "2020-05-27T19:18:50Z", "commit": {"oid": "04e8e095043e563059255edda7795c51a21d4bd6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOToxODo1MFrOGbZxxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOToxODo1MFrOGbZxxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM4NzA3OQ==", "bodyText": "I'm not sure why we need special treatment for Dataflow jars here. Behavior for these jars should be similar for any other jars uploaded for Dataflow IMO.\n@lukecwik WDYT ?", "url": "https://github.com/apache/beam/pull/11814#discussion_r431387079", "createdAt": "2020-05-27T19:18:50Z", "author": {"login": "chamikaramj"}, "path": "runners/google-cloud-dataflow-java/src/main/java/org/apache/beam/runners/dataflow/util/PackageUtil.java", "diffHunk": "@@ -397,10 +397,21 @@ public static PackageAttributes forFileToStage(\n             String.format(\"Non-existent file to stage: %s\", file.getAbsolutePath()));\n       }\n       checkState(!file.isDirectory(), \"Source file must not be a directory.\");\n+      String target;\n+      switch (dest) {\n+        case \"dataflow-worker.jar\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "04e8e095043e563059255edda7795c51a21d4bd6"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dea793d9dae4f612dc15047c892f52147fe19b2a", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/dea793d9dae4f612dc15047c892f52147fe19b2a", "committedDate": "2020-05-28T20:17:54Z", "message": "add comments and logging"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4346, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}