{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxODcwMzQ1", "number": 11377, "title": "[BEAM-9439] Return split instead of total backlog size in KinesisIO", "bodyText": "This merge request changes how backlog bytes are reported by KinesisReader.\nInstead of total backlog bytes, which could result in Dataflow pipelines not scaling up,\nsplit backlog is now reported.\nThe split backlog size can be over-estimated as it reports the size\nof the records across all shards (and also assumes that all shards\nin the split have the same progress).\nThis can lead to unnecessary decisions to scale up the number of workers\nbut will never fail to scale up when this is necessary.\nAlso the watermark policy of the reader is user configurable and we\ndon't have a control over it. The calculation of backlog bytes should\nalways take into account the time that the record was inserted into\nKinesis as this gives accurate results which are independent of\ncurrent processing time or any other conditions that reader watermark\ncan be using. Therefore a separate, fixed policy is used to track\nprocessed records for the backlog calculation.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-04-10T11:21:50Z", "url": "https://github.com/apache/beam/pull/11377", "merged": true, "mergeCommit": {"oid": "8fdc9ceb55ced2826a973ad283af3bc89440d99e"}, "closed": true, "closedAt": "2020-05-11T11:47:24Z", "author": {"login": "sgraca"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWPQo7AH2gAyNDAxODcwMzQ1OjFlMTgyYzZhYmM4ZTI2NWYzZTRiNjcwNzQ3ZDQ0OGRmNzBiYjdiYjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgOPL5gFqTQwOTA5NzgyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1e182c6abc8e265f3e4b670747d448df70bb7bb0", "author": {"user": {"login": "sgraca", "name": "Sebastian Graca"}}, "url": "https://github.com/apache/beam/commit/1e182c6abc8e265f3e4b670747d448df70bb7bb0", "committedDate": "2020-04-10T11:19:10Z", "message": "[BEAM-9439] Return split instead of total backlog size\n\nThe split backlog size can be over-estimated as it reports the size\nof the records across all shards (and also assumes that all shards\nin the split have the same progress).\nThis can lead to unnecessary decisions to scale up the number of workers\nbut will never fail to scale up when this is necessary.\n\nAlso the watermark policy of the reader is user configurable and we\ndon't have a control over it. The calculation of backlog bytes should\nalways take into account the time that the record was inserted into\nKinesis as this gives accurate results which are independent of\ncurrent processing time or any other conditions that reader watermark\ncan be using. Therefore a separate, fixed policy is used to track\nprocessed records for the backlog calculation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NTgwMTI5", "url": "https://github.com/apache/beam/pull/11377#pullrequestreview-407580129", "createdAt": "2020-05-07T15:20:40Z", "commit": {"oid": "1e182c6abc8e265f3e4b670747d448df70bb7bb0"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNToyMDo0MFrOGSDutg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxNToyMDo0MFrOGSDutg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTU4ODY2Mg==", "bodyText": "Why AtomicReference no more used here?", "url": "https://github.com/apache/beam/pull/11377#discussion_r421588662", "createdAt": "2020-05-07T15:20:40Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/kinesis/src/main/java/org/apache/beam/sdk/io/kinesis/ShardRecordsIterator.java", "diffHunk": "@@ -43,22 +42,23 @@\n   private final RecordFilter filter;\n   private final String streamName;\n   private final String shardId;\n-  private AtomicReference<ShardCheckpoint> checkpoint;\n+  private final AtomicReference<ShardCheckpoint> checkpoint;\n+  private final WatermarkPolicy watermarkPolicy;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e182c6abc8e265f3e4b670747d448df70bb7bb0"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MDk3ODIz", "url": "https://github.com/apache/beam/pull/11377#pullrequestreview-409097823", "createdAt": "2020-05-11T11:46:55Z", "commit": {"oid": "1e182c6abc8e265f3e4b670747d448df70bb7bb0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4604, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}