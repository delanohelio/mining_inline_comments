{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MTExMjE4", "number": 13410, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMjoyNjo1NFrOE8fUaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxODowMzo1NVrOFLYitg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxODYzMTQ0OnYy", "diffSide": "RIGHT", "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "isResolved": false, "comments": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMjoyNjo1NFrOH4o78w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQxNTozODoxMFrOIQWf2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ==", "bodyText": "@scwhittle I was wondering if you could comment on this since you added this line in #11096. Do you know if this change is safe? Is there a reason this needs to use defaultCharset?\nAs it is, testLogRawBytes below can fail if the system encoding isn't UTF-8", "url": "https://github.com/apache/beam/pull/13410#discussion_r529153011", "createdAt": "2020-11-24T02:26:54Z", "author": {"login": "TheNeuralBit"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTkwNTAzNw==", "bodyText": "This class is going to be used to replace the default System.out/System.err which appears to be specified to use the default charset.\nSo it seems better to keep it consistent IMO to avoid surprises when someone expects that charset writing to System.out, not UTF-8.  If the test is incorrect, it should be fixed (by examining or setting the defaultCharset)", "url": "https://github.com/apache/beam/pull/13410#discussion_r529905037", "createdAt": "2020-11-24T21:53:50Z", "author": {"login": "scwhittle"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ=="}, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAwODEwOQ==", "bodyText": "OK thanks, I thought that may be the case\nHow about this - we can make this class (the private constructor and the create() method below) parameterized by Charset. The places where its used as the default System.out/System.err in the Dataflow worker can pass in Charset.defaultCharset(), but the test can pass in Charsets.UTF_8", "url": "https://github.com/apache/beam/pull/13410#discussion_r530008109", "createdAt": "2020-11-24T23:34:04Z", "author": {"login": "TheNeuralBit"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ=="}, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwMDM5Ng==", "bodyText": "@scwhittle  does that work for you? I can make the change if so!", "url": "https://github.com/apache/beam/pull/13410#discussion_r536200396", "createdAt": "2020-12-04T15:56:27Z", "author": {"login": "omarismail94"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ=="}, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQ3NzY4OA==", "bodyText": "Let's go ahead and do that", "url": "https://github.com/apache/beam/pull/13410#discussion_r540477688", "createdAt": "2020-12-10T20:33:55Z", "author": {"login": "TheNeuralBit"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ=="}, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc4Mjc3Nw==", "bodyText": "Sorry lost track of that comment, I believe it's only uses are for System.out/System.err and the test. But allowing the test to specify a specific charset so it passes reliably sounds like a good solution.", "url": "https://github.com/apache/beam/pull/13410#discussion_r540782777", "createdAt": "2020-12-11T08:46:49Z", "author": {"login": "scwhittle"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ=="}, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA4NTk4MQ==", "bodyText": "OK, I will make the changes and re-commit. Thanks!", "url": "https://github.com/apache/beam/pull/13410#discussion_r541085981", "createdAt": "2020-12-11T16:52:26Z", "author": {"login": "omarismail94"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ=="}, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjE2OTM0MQ==", "bodyText": "This hasn't been done yet has it?", "url": "https://github.com/apache/beam/pull/13410#discussion_r552169341", "createdAt": "2021-01-05T20:14:34Z", "author": {"login": "TheNeuralBit"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ=="}, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY4Mjg0Mg==", "bodyText": "How about this - we can make this class (the private constructor and the create() method below) parameterized by Charset.\n\nThe variables that are passed in do not use any of the Charset methods though right?\n\nThe places where its used as the default System.out/System.err in the Dataflow worker can pass in Charset.defaultCharset(), but the test can pass in Charsets.UTF_8\n\nThe test file has StandardCharsets.UTF_8 replacing Charset.defaultCharset().\nLet me know if I am missing something @TheNeuralBit !", "url": "https://github.com/apache/beam/pull/13410#discussion_r553682842", "createdAt": "2021-01-08T01:07:09Z", "author": {"login": "omarismail94"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ=="}, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY5MjY4NQ==", "bodyText": "What I was suggesting is that we should add a new argument to the private constructor and the static create() method: Charset charset. Then in the constructor we'll use charset instead of Charset.defaultCharset() to create encoder.\nCurrently the test is using StandardCharsets.UTF_8, but only to create the expected outputs. It also needs to create a JulHandlerPrintStreamAdapterFactory that uses UTF_8 explicitly, so we need a way to pass that through. I think as it is this test could still fail if the default charset isn't UTF-8", "url": "https://github.com/apache/beam/pull/13410#discussion_r553692685", "createdAt": "2021-01-08T01:42:06Z", "author": {"login": "TheNeuralBit"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ=="}, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY5ODA2OA==", "bodyText": "Oooh, OK! And because the constructor is private, it can only be accessed from create() method inside the class, meaning this is the only file I have to change \ud83e\udd2f\nIll give this a shot!", "url": "https://github.com/apache/beam/pull/13410#discussion_r553698068", "createdAt": "2021-01-08T02:00:54Z", "author": {"login": "omarismail94"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ=="}, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzY5OTU2Ng==", "bodyText": "Well you'll also want to add an argument to create(), and update the places that call it, for example in the test: \n  \n    \n      beam/runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactoryTest.java\n    \n    \n         Line 168\n      in\n      df74d74\n    \n    \n    \n    \n\n        \n          \n           return JulHandlerPrintStreamAdapterFactory.create(handler, LOGGER_NAME, Level.INFO); \n        \n    \n  \n\n\nWould become return JulHandlerPrintStreamAdapterFactory.create(handler, LOGGER_NAME, Level.INFO, StandardCharsets.UTF_8);", "url": "https://github.com/apache/beam/pull/13410#discussion_r553699566", "createdAt": "2021-01-08T02:06:33Z", "author": {"login": "TheNeuralBit"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ=="}, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzcwMTI2MA==", "bodyText": "Will do, thanks!", "url": "https://github.com/apache/beam/pull/13410#discussion_r553701260", "createdAt": "2021-01-08T02:13:05Z", "author": {"login": "omarismail94"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ=="}, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDAxNjczMA==", "bodyText": "@TheNeuralBit  I had to create a new PR for this as this got merged:\nNew PR: #13701", "url": "https://github.com/apache/beam/pull/13410#discussion_r554016730", "createdAt": "2021-01-08T15:38:10Z", "author": {"login": "omarismail94"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ=="}, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2ODg2NDY3OnYy", "diffSide": "RIGHT", "path": "sdks/java/build-tools/src/main/resources/beam/checkstyle.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwOToyMzo0MFrOINqe8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxODoxMzo1MFrOIN7yqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE5ODQ1MA==", "bodyText": "nit: ultra minor (you can ignore me but good if changed) s/ForbidCharset/ForbidDefaultCharset", "url": "https://github.com/apache/beam/pull/13410#discussion_r551198450", "createdAt": "2021-01-04T09:23:40Z", "author": {"login": "iemejia"}, "path": "sdks/java/build-tools/src/main/resources/beam/checkstyle.xml", "diffHunk": "@@ -119,6 +119,14 @@ page at http://checkstyle.sourceforge.net/config.html -->\n       <property name=\"message\" value=\"You are using raw guava, please use vendored guava classes.\"/>\n     </module>\n \n+    <!-- Forbid use of Charset.defaultCharset()-->\n+    <module name=\"RegexpSinglelineJava\">\n+      <property name=\"id\" value=\"ForbidCharset\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f19467a8007d6f5817c89cf175a66e07aa4bdd8d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQ4MjAyNA==", "bodyText": "Updated, thanks!", "url": "https://github.com/apache/beam/pull/13410#discussion_r551482024", "createdAt": "2021-01-04T18:13:50Z", "author": {"login": "omarismail94"}, "path": "sdks/java/build-tools/src/main/resources/beam/checkstyle.xml", "diffHunk": "@@ -119,6 +119,14 @@ page at http://checkstyle.sourceforge.net/config.html -->\n       <property name=\"message\" value=\"You are using raw guava, please use vendored guava classes.\"/>\n     </module>\n \n+    <!-- Forbid use of Charset.defaultCharset()-->\n+    <module name=\"RegexpSinglelineJava\">\n+      <property name=\"id\" value=\"ForbidCharset\"/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE5ODQ1MA=="}, "originalCommit": {"oid": "f19467a8007d6f5817c89cf175a66e07aa4bdd8d"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ3NDgwNzU4OnYy", "diffSide": "RIGHT", "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxODowMzo1NVrOIOhkyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNlQwNToyMDo0N1rOIOyS4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjEwMTA2NA==", "bodyText": "Shouldn't this be ForbidDefaultCharset?", "url": "https://github.com/apache/beam/pull/13410#discussion_r552101064", "createdAt": "2021-01-05T18:03:55Z", "author": {"login": "TheNeuralBit"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -69,6 +69,9 @@\n     private int carryOverBytes;\n     private byte[] carryOverByteArray;\n \n+    @SuppressWarnings({\n+      \"unchecked\" // [BEAM-11327] Replace Charset.defaultCharset() with StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a7823fe84b32a25193c8b47373a2452e2b5fe2c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjEwODkyMQ==", "bodyText": "Yes! Changed to Suppress ForbidDefaultCharset checkstyle", "url": "https://github.com/apache/beam/pull/13410#discussion_r552108921", "createdAt": "2021-01-05T18:17:11Z", "author": {"login": "omarismail94"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -69,6 +69,9 @@\n     private int carryOverBytes;\n     private byte[] carryOverByteArray;\n \n+    @SuppressWarnings({\n+      \"unchecked\" // [BEAM-11327] Replace Charset.defaultCharset() with StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjEwMTA2NA=="}, "originalCommit": {"oid": "4a7823fe84b32a25193c8b47373a2452e2b5fe2c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjE2OTAwNw==", "bodyText": "It's concerning that the precommit didn't break when this was suppressing the wrong warning. Have you seen the new checkstyle rule break checkstyleMain or checkstyleTest?\nI tried to get it to fail locally, but even with the SuppressWarnings removed its not triggering on Charset.defaultCharset", "url": "https://github.com/apache/beam/pull/13410#discussion_r552169007", "createdAt": "2021-01-05T20:13:52Z", "author": {"login": "TheNeuralBit"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -69,6 +69,9 @@\n     private int carryOverBytes;\n     private byte[] carryOverByteArray;\n \n+    @SuppressWarnings({\n+      \"unchecked\" // [BEAM-11327] Replace Charset.defaultCharset() with StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjEwMTA2NA=="}, "originalCommit": {"oid": "4a7823fe84b32a25193c8b47373a2452e2b5fe2c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjM3NTAwOQ==", "bodyText": "Aaaah, I finally found out what causes that. checkstyleMain.enabled is set to false in the build.gradle for the worker project. I set it to true, then removed the SuppressionWarning, and when I run checkstyleMain, I can see the rule gets triggered. I also didn't know you can set the ID used as the label in, SuppressionWarnings, so I fixed that as well!\nIf you want to test, I think if you set the flag to true in the build.gradle file, and comment out the SuppressionWarnings(\"ForbidDefaultCharset\"), then run the checkstyleMain, it should work", "url": "https://github.com/apache/beam/pull/13410#discussion_r552375009", "createdAt": "2021-01-06T05:20:47Z", "author": {"login": "omarismail94"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -69,6 +69,9 @@\n     private int carryOverBytes;\n     private byte[] carryOverByteArray;\n \n+    @SuppressWarnings({\n+      \"unchecked\" // [BEAM-11327] Replace Charset.defaultCharset() with StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjEwMTA2NA=="}, "originalCommit": {"oid": "4a7823fe84b32a25193c8b47373a2452e2b5fe2c"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2641, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}