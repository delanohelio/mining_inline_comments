{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2MDUzMTQ4", "number": 10664, "title": "[BEAM-9172] Add missing parameter to Nexmark CI execution for Flink runner", "bodyText": "Due to two misconfigured parameters:\n\nThe effective runner TestFlinkRunner in CommonTestProperties.groovy\nThe missing --runner parameter in the nexmark arguments.\n\nThe CI tests were not producing good execution results for Flink during the last year :S\n(1) Made the results to be produced into a different table see for example nexmark.nexmark_0_sql_TestFlinkRunner_batch and because of (2) we were producing bad results because if Nexmark does not have the --runner parameter assigned it defaults to execute with Direct runner so all the accumulated results in the TestFlinkRunner tables DO NOT correspond to Flink runner results.\nThis PR fixes both.\nR: @udim @mxm", "createdAt": "2020-01-22T20:41:16Z", "url": "https://github.com/apache/beam/pull/10664", "merged": true, "mergeCommit": {"oid": "681a3edcebd2885a6aec9c07230db4903fda1a1a"}, "closed": true, "closedAt": "2020-01-23T20:58:48Z", "author": {"login": "iemejia"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb88kAWgFqTM0NjkxMjc2Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9N8igAFqTM0NzQ4NDU1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2OTEyNzYy", "url": "https://github.com/apache/beam/pull/10664#pullrequestreview-346912762", "createdAt": "2020-01-22T21:23:54Z", "commit": {"oid": "3c8c9f23ea8d6fd05b6bbe248c76f2a876fb35bf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQyMToyMzo1NVrOFgreUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQyMToyMzo1NVrOFgreUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTgxMTAyNA==", "bodyText": "Does this affect the runner used or just the table name? I'm asking because I believe the runner used is TestFlinkRunner (while the existing table is uses the former runner name).\n@mxm", "url": "https://github.com/apache/beam/pull/10664#discussion_r369811024", "createdAt": "2020-01-22T21:23:55Z", "author": {"login": "udim"}, "path": ".test-infra/jenkins/job_PostCommit_Java_Nexmark_Flink.groovy", "diffHunk": "@@ -43,6 +43,7 @@ NoPhraseTriggeringPostCommitBuilder.postCommitJob('beam_PostCommit_Java_Nexmark_\n       switches('-Pnexmark.runner=\":runners:flink:1.9\"' +\n               ' -Pnexmark.args=\"' +\n               [NexmarkBigqueryProperties.nexmarkBigQueryArgs,\n+               '--runner=FlinkRunner',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c8c9f23ea8d6fd05b6bbe248c76f2a876fb35bf"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3c8c9f23ea8d6fd05b6bbe248c76f2a876fb35bf", "author": {"user": {"login": "iemejia", "name": "Isma\u00ebl Mej\u00eda"}}, "url": "https://github.com/apache/beam/commit/3c8c9f23ea8d6fd05b6bbe248c76f2a876fb35bf", "committedDate": "2020-01-22T20:40:48Z", "message": "[BEAM-9172] Add missing parameter to Nexmark CI execution for Flink runner"}, "afterCommit": {"oid": "eb1774743cfbf3a2818e6ac0a766c876094d69b6", "author": {"user": {"login": "iemejia", "name": "Isma\u00ebl Mej\u00eda"}}, "url": "https://github.com/apache/beam/commit/eb1774743cfbf3a2818e6ac0a766c876094d69b6", "committedDate": "2020-01-22T21:36:28Z", "message": "[BEAM-9172] Add missing parameter to Nexmark CI execution for Flink runner"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MTczNzc5", "url": "https://github.com/apache/beam/pull/10664#pullrequestreview-347173779", "createdAt": "2020-01-23T09:56:18Z", "commit": {"oid": "eb1774743cfbf3a2818e6ac0a766c876094d69b6"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eb1774743cfbf3a2818e6ac0a766c876094d69b6", "author": {"user": {"login": "iemejia", "name": "Isma\u00ebl Mej\u00eda"}}, "url": "https://github.com/apache/beam/commit/eb1774743cfbf3a2818e6ac0a766c876094d69b6", "committedDate": "2020-01-22T21:36:28Z", "message": "[BEAM-9172] Add missing parameter to Nexmark CI execution for Flink runner"}, "afterCommit": {"oid": "a58271057ee511f40622fb1f520b77a3d017cbfa", "author": {"user": {"login": "iemejia", "name": "Isma\u00ebl Mej\u00eda"}}, "url": "https://github.com/apache/beam/commit/a58271057ee511f40622fb1f520b77a3d017cbfa", "committedDate": "2020-01-23T10:22:30Z", "message": "[BEAM-9172] Add missing parameter to Nexmark CI execution for Flink runner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cfca6b1fc02dc03f3c4f1e76a9b951ea4fb2159", "author": {"user": {"login": "iemejia", "name": "Isma\u00ebl Mej\u00eda"}}, "url": "https://github.com/apache/beam/commit/8cfca6b1fc02dc03f3c4f1e76a9b951ea4fb2159", "committedDate": "2020-01-23T15:36:49Z", "message": "[BEAM-9172] Add missing parameter to Nexmark CI execution for Flink runner"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a58271057ee511f40622fb1f520b77a3d017cbfa", "author": {"user": {"login": "iemejia", "name": "Isma\u00ebl Mej\u00eda"}}, "url": "https://github.com/apache/beam/commit/a58271057ee511f40622fb1f520b77a3d017cbfa", "committedDate": "2020-01-23T10:22:30Z", "message": "[BEAM-9172] Add missing parameter to Nexmark CI execution for Flink runner"}, "afterCommit": {"oid": "8cfca6b1fc02dc03f3c4f1e76a9b951ea4fb2159", "author": {"user": {"login": "iemejia", "name": "Isma\u00ebl Mej\u00eda"}}, "url": "https://github.com/apache/beam/commit/8cfca6b1fc02dc03f3c4f1e76a9b951ea4fb2159", "committedDate": "2020-01-23T15:36:49Z", "message": "[BEAM-9172] Add missing parameter to Nexmark CI execution for Flink runner"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NDgwODQz", "url": "https://github.com/apache/beam/pull/10664#pullrequestreview-347480843", "createdAt": "2020-01-23T17:32:59Z", "commit": {"oid": "8cfca6b1fc02dc03f3c4f1e76a9b951ea4fb2159"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNzozMjo1OVrOFhGtNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNzozMzozNlrOFhGuSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI1NzIwNQ==", "bodyText": "It looks like we still want to use TestFlinkRunner here because it auto-sets the --shutdownSourcesOnFinalWatermark flag.", "url": "https://github.com/apache/beam/pull/10664#discussion_r370257205", "createdAt": "2020-01-23T17:32:59Z", "author": {"login": "mxm"}, "path": ".test-infra/jenkins/job_PostCommit_Java_Nexmark_Flink.groovy", "diffHunk": "@@ -43,6 +43,8 @@ NoPhraseTriggeringPostCommitBuilder.postCommitJob('beam_PostCommit_Java_Nexmark_\n       switches('-Pnexmark.runner=\":runners:flink:1.9\"' +\n               ' -Pnexmark.args=\"' +\n               [NexmarkBigqueryProperties.nexmarkBigQueryArgs,\n+              '--runner=FlinkRunner',\n+              '--shutdownSourcesOnFinalWatermark=true',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cfca6b1fc02dc03f3c4f1e76a9b951ea4fb2159"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI1NzQ4Mw==", "bodyText": "This string broke the result reporting because it wrote to the wrong BigQuery table?", "url": "https://github.com/apache/beam/pull/10664#discussion_r370257483", "createdAt": "2020-01-23T17:33:36Z", "author": {"login": "mxm"}, "path": ".test-infra/jenkins/CommonTestProperties.groovy", "diffHunk": "@@ -29,7 +29,7 @@ class CommonTestProperties {\n         DATAFLOW(\"DataflowRunner\"),\n         SPARK(\"SparkRunner\"),\n         SPARK_STRUCTURED_STREAMING(\"SparkStructuredStreamingRunner\"),\n-        FLINK(\"TestFlinkRunner\"),\n+        FLINK(\"FlinkRunner\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cfca6b1fc02dc03f3c4f1e76a9b951ea4fb2159"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3NDg0NTU5", "url": "https://github.com/apache/beam/pull/10664#pullrequestreview-347484559", "createdAt": "2020-01-23T17:39:12Z", "commit": {"oid": "8cfca6b1fc02dc03f3c4f1e76a9b951ea4fb2159"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNzozOToxMlrOFhG4gA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNzozOToxMlrOFhG4gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI2MDA5Ng==", "bodyText": "This can also be removed if we use TestFlinkRunner.", "url": "https://github.com/apache/beam/pull/10664#discussion_r370260096", "createdAt": "2020-01-23T17:39:12Z", "author": {"login": "mxm"}, "path": ".test-infra/jenkins/job_PostCommit_Java_Nexmark_Flink.groovy", "diffHunk": "@@ -107,8 +115,9 @@ PhraseTriggeringPostCommitBuilder.postCommitJob('beam_PostCommit_Java_Nexmark_Fl\n   commonJobProperties.setTopLevelMainJobProperties(delegate, 'master', 240)\n \n   def final JOB_SPECIFIC_OPTIONS = [\n-          'suite'        : 'SMOKE',\n-          'streamTimeout': 60,\n+          'suite' : 'SMOKE',\n+          'streamTimeout' : 60,\n+          'shutdownSourcesOnFinalWatermark' : true,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8cfca6b1fc02dc03f3c4f1e76a9b951ea4fb2159"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3586, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}