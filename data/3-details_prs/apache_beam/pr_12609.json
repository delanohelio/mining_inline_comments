{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5MTQzNTA5", "number": 12609, "title": "[BEAM-10699] Logging BigQuery streaming insert tail latencies", "bodyText": "Thank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n \n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-18T01:13:43Z", "url": "https://github.com/apache/beam/pull/12609", "merged": true, "mergeCommit": {"oid": "d89bbfa5ad7e392371c85586fae94334e8ca9a87"}, "closed": true, "closedAt": "2020-08-27T20:09:06Z", "author": {"login": "ihji"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_-ASEABqjM2NjQzMzU0NDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC0hgsgH2gAyNDY5MTQzNTA5OmIzYmI0NTRlMTdlZTczMTlkZDliZTdjYzVkOTlmY2E2YmUzN2FhY2M=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3cc6c369c0254a5fe521f37fe8f7462cbbbdfdb0", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/3cc6c369c0254a5fe521f37fe8f7462cbbbdfdb0", "committedDate": "2020-08-18T01:11:52Z", "message": "[BEAM-10699] Logging BigQuery streaming insert tail latencies"}, "afterCommit": {"oid": "ed8d4c5b32a438f14d996985d24ca6cb5ae8e017", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/ed8d4c5b32a438f14d996985d24ca6cb5ae8e017", "committedDate": "2020-08-18T02:57:27Z", "message": "[BEAM-10699] Logging BigQuery streaming insert tail latencies"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed8d4c5b32a438f14d996985d24ca6cb5ae8e017", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/ed8d4c5b32a438f14d996985d24ca6cb5ae8e017", "committedDate": "2020-08-18T02:57:27Z", "message": "[BEAM-10699] Logging BigQuery streaming insert tail latencies"}, "afterCommit": {"oid": "ffd1b114ceb68adda532bbde9332dba64b16c89f", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/ffd1b114ceb68adda532bbde9332dba64b16c89f", "committedDate": "2020-08-18T07:06:00Z", "message": "[BEAM-10699] Logging BigQuery streaming insert tail latencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77083a480c4f4975882a38311f8ce25297165023", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/77083a480c4f4975882a38311f8ce25297165023", "committedDate": "2020-08-19T00:21:10Z", "message": "[BEAM-10699] Logging BigQuery streaming insert tail latencies"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ffd1b114ceb68adda532bbde9332dba64b16c89f", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/ffd1b114ceb68adda532bbde9332dba64b16c89f", "committedDate": "2020-08-18T07:06:00Z", "message": "[BEAM-10699] Logging BigQuery streaming insert tail latencies"}, "afterCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/77083a480c4f4975882a38311f8ce25297165023", "committedDate": "2020-08-19T00:21:10Z", "message": "[BEAM-10699] Logging BigQuery streaming insert tail latencies"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMDg2Mzg5", "url": "https://github.com/apache/beam/pull/12609#pullrequestreview-470086389", "createdAt": "2020-08-19T02:43:12Z", "commit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "state": "COMMENTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMjo0NToyM1rOHCuDIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwMzoyMDowNlrOHCvYfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYxMzY2NQ==", "bodyText": "Why restrict this to not allow negatives? Any range of numbers for bucket boundaries is valid", "url": "https://github.com/apache/beam/pull/12609#discussion_r472613665", "createdAt": "2020-08-19T02:45:23Z", "author": {"login": "ajamato"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/util/Histogram.java", "diffHunk": "@@ -0,0 +1,151 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.util;\n+\n+import java.math.RoundingMode;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.math.DoubleMath;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/** A histogram that supports estimated percentile with linear interpolation. */\n+public class Histogram {\n+  private static final Logger LOG = LoggerFactory.getLogger(Histogram.class);\n+\n+  private static final int DEFAULT_NUM_OF_BUCKETS = 50;\n+\n+  private final double rangeFrom;\n+  private final double rangeTo;\n+  private final int numOfBuckets;\n+\n+  private long[] buckets;\n+  private final double bucketSize;\n+  private long totalNumOfRecords;\n+\n+  private final boolean ignoreOutOfRangeRecord;\n+\n+  private Histogram(\n+      double rangeFrom, double rangeTo, int numOfBuckets, boolean ignoreOutOfRangeRecord) {\n+    if (rangeFrom < 0) {\n+      throw new RuntimeException(String.format(\"only positive range allowed: %f\", rangeFrom));\n+    }\n+    if (rangeFrom >= rangeTo) {\n+      throw new RuntimeException(\n+          String.format(\"rangeTo should be larger than rangeFrom: [%f, %f)\", rangeFrom, rangeTo));\n+    }\n+    if (numOfBuckets <= 0) {\n+      throw new RuntimeException(\n+          String.format(\"numOfBuckets should be greater than zero: %d\", numOfBuckets));\n+    }\n+    this.rangeFrom = rangeFrom;\n+    this.rangeTo = rangeTo;\n+    this.numOfBuckets = numOfBuckets;\n+    this.ignoreOutOfRangeRecord = ignoreOutOfRangeRecord;\n+    this.buckets = new long[numOfBuckets];\n+    this.bucketSize = (rangeTo - rangeFrom) / numOfBuckets;\n+    this.totalNumOfRecords = 0;\n+  }\n+\n+  /**\n+   * Create a histogram.\n+   *\n+   * @param rangeFrom The minimum value that this histogram can record. Cannot be negative.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYxODY1OQ==", "bodyText": "I think that we can remove the ignoreOutOfRangeRecord parameter.\nLet the first and last bucket include up to +ve and -ve infinity\ni.e. for n bucket boundaries, the buckets are:\n(-INF, b0), [b0, b1), ... [bn, +INF)", "url": "https://github.com/apache/beam/pull/12609#discussion_r472618659", "createdAt": "2020-08-19T02:53:11Z", "author": {"login": "ajamato"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/util/Histogram.java", "diffHunk": "@@ -0,0 +1,151 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.util;\n+\n+import java.math.RoundingMode;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.math.DoubleMath;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/** A histogram that supports estimated percentile with linear interpolation. */\n+public class Histogram {\n+  private static final Logger LOG = LoggerFactory.getLogger(Histogram.class);\n+\n+  private static final int DEFAULT_NUM_OF_BUCKETS = 50;\n+\n+  private final double rangeFrom;\n+  private final double rangeTo;\n+  private final int numOfBuckets;\n+\n+  private long[] buckets;\n+  private final double bucketSize;\n+  private long totalNumOfRecords;\n+\n+  private final boolean ignoreOutOfRangeRecord;\n+\n+  private Histogram(\n+      double rangeFrom, double rangeTo, int numOfBuckets, boolean ignoreOutOfRangeRecord) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYyMTQzNQ==", "bodyText": "Would you mind please re-doing these parameters so that they represent a linear function. i.e.\nbucket boundaries are define by:\nbi = width * x + start\nfor n bucket boundaries, the buckets are:\n(-INF, b0), [b0, b1), ... [bn, +INF)\npublic static Histogram of(\ndouble startBounds, double bucketWidth, int numOfBuckets, boolean ignoreOutOfRangeRecord)\nThis was one of the histogram bucket definition styles we considered here:\nhttps://docs.google.com/document/d/1kiNG2BAR-51pRdBCK4-XFmc0WuIkSuBzeb__Zv8owbU/edit#heading=h.279ygg7gw109\nI'll enhance this later to add constructors for using exponential and explicit buckets.", "url": "https://github.com/apache/beam/pull/12609#discussion_r472621435", "createdAt": "2020-08-19T02:57:33Z", "author": {"login": "ajamato"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/util/Histogram.java", "diffHunk": "@@ -0,0 +1,151 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.util;\n+\n+import java.math.RoundingMode;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.math.DoubleMath;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/** A histogram that supports estimated percentile with linear interpolation. */\n+public class Histogram {\n+  private static final Logger LOG = LoggerFactory.getLogger(Histogram.class);\n+\n+  private static final int DEFAULT_NUM_OF_BUCKETS = 50;\n+\n+  private final double rangeFrom;\n+  private final double rangeTo;\n+  private final int numOfBuckets;\n+\n+  private long[] buckets;\n+  private final double bucketSize;\n+  private long totalNumOfRecords;\n+\n+  private final boolean ignoreOutOfRangeRecord;\n+\n+  private Histogram(\n+      double rangeFrom, double rangeTo, int numOfBuckets, boolean ignoreOutOfRangeRecord) {\n+    if (rangeFrom < 0) {\n+      throw new RuntimeException(String.format(\"only positive range allowed: %f\", rangeFrom));\n+    }\n+    if (rangeFrom >= rangeTo) {\n+      throw new RuntimeException(\n+          String.format(\"rangeTo should be larger than rangeFrom: [%f, %f)\", rangeFrom, rangeTo));\n+    }\n+    if (numOfBuckets <= 0) {\n+      throw new RuntimeException(\n+          String.format(\"numOfBuckets should be greater than zero: %d\", numOfBuckets));\n+    }\n+    this.rangeFrom = rangeFrom;\n+    this.rangeTo = rangeTo;\n+    this.numOfBuckets = numOfBuckets;\n+    this.ignoreOutOfRangeRecord = ignoreOutOfRangeRecord;\n+    this.buckets = new long[numOfBuckets];\n+    this.bucketSize = (rangeTo - rangeFrom) / numOfBuckets;\n+    this.totalNumOfRecords = 0;\n+  }\n+\n+  /**\n+   * Create a histogram.\n+   *\n+   * @param rangeFrom The minimum value that this histogram can record. Cannot be negative.\n+   * @param rangeTo The maximum value that this histogram can record. Cannot be smaller than or\n+   *     equal to rangeFrom.\n+   * @param numOfBuckets The number of buckets. Larger number of buckets implies a better resolution\n+   *     for percentile estimation.\n+   * @param ignoreOutOfRangeRecord Whether the out-of-range records are discarded. It will throw\n+   *     RuntimeException for the out-of-range records if this is set to false.\n+   * @return a new Histogram instance.\n+   */\n+  public static Histogram of(\n+      double rangeFrom, double rangeTo, int numOfBuckets, boolean ignoreOutOfRangeRecord) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYyMjU2OQ==", "bodyText": "Please place values in the first or last bucket, inlcuding values up to  -INF and +INF", "url": "https://github.com/apache/beam/pull/12609#discussion_r472622569", "createdAt": "2020-08-19T02:59:25Z", "author": {"login": "ajamato"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/util/Histogram.java", "diffHunk": "@@ -0,0 +1,151 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.util;\n+\n+import java.math.RoundingMode;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.math.DoubleMath;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/** A histogram that supports estimated percentile with linear interpolation. */\n+public class Histogram {\n+  private static final Logger LOG = LoggerFactory.getLogger(Histogram.class);\n+\n+  private static final int DEFAULT_NUM_OF_BUCKETS = 50;\n+\n+  private final double rangeFrom;\n+  private final double rangeTo;\n+  private final int numOfBuckets;\n+\n+  private long[] buckets;\n+  private final double bucketSize;\n+  private long totalNumOfRecords;\n+\n+  private final boolean ignoreOutOfRangeRecord;\n+\n+  private Histogram(\n+      double rangeFrom, double rangeTo, int numOfBuckets, boolean ignoreOutOfRangeRecord) {\n+    if (rangeFrom < 0) {\n+      throw new RuntimeException(String.format(\"only positive range allowed: %f\", rangeFrom));\n+    }\n+    if (rangeFrom >= rangeTo) {\n+      throw new RuntimeException(\n+          String.format(\"rangeTo should be larger than rangeFrom: [%f, %f)\", rangeFrom, rangeTo));\n+    }\n+    if (numOfBuckets <= 0) {\n+      throw new RuntimeException(\n+          String.format(\"numOfBuckets should be greater than zero: %d\", numOfBuckets));\n+    }\n+    this.rangeFrom = rangeFrom;\n+    this.rangeTo = rangeTo;\n+    this.numOfBuckets = numOfBuckets;\n+    this.ignoreOutOfRangeRecord = ignoreOutOfRangeRecord;\n+    this.buckets = new long[numOfBuckets];\n+    this.bucketSize = (rangeTo - rangeFrom) / numOfBuckets;\n+    this.totalNumOfRecords = 0;\n+  }\n+\n+  /**\n+   * Create a histogram.\n+   *\n+   * @param rangeFrom The minimum value that this histogram can record. Cannot be negative.\n+   * @param rangeTo The maximum value that this histogram can record. Cannot be smaller than or\n+   *     equal to rangeFrom.\n+   * @param numOfBuckets The number of buckets. Larger number of buckets implies a better resolution\n+   *     for percentile estimation.\n+   * @param ignoreOutOfRangeRecord Whether the out-of-range records are discarded. It will throw\n+   *     RuntimeException for the out-of-range records if this is set to false.\n+   * @return a new Histogram instance.\n+   */\n+  public static Histogram of(\n+      double rangeFrom, double rangeTo, int numOfBuckets, boolean ignoreOutOfRangeRecord) {\n+    return new Histogram(rangeFrom, rangeTo, numOfBuckets, ignoreOutOfRangeRecord);\n+  }\n+\n+  public static Histogram of(double rangeFrom, double rangeTo) {\n+    return new Histogram(rangeFrom, rangeTo, DEFAULT_NUM_OF_BUCKETS, false);\n+  }\n+\n+  public void record(double... values) {\n+    for (double value : values) {\n+      record(value);\n+    }\n+  }\n+\n+  public synchronized void clear() {\n+    this.buckets = new long[numOfBuckets];\n+    this.totalNumOfRecords = 0;\n+  }\n+\n+  public synchronized void record(double value) {\n+    if (value >= rangeTo || value < rangeFrom) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYyNDY1OQ==", "bodyText": "nit: rename to numBuckets", "url": "https://github.com/apache/beam/pull/12609#discussion_r472624659", "createdAt": "2020-08-19T03:02:44Z", "author": {"login": "ajamato"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/util/Histogram.java", "diffHunk": "@@ -0,0 +1,151 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.util;\n+\n+import java.math.RoundingMode;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.math.DoubleMath;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/** A histogram that supports estimated percentile with linear interpolation. */\n+public class Histogram {\n+  private static final Logger LOG = LoggerFactory.getLogger(Histogram.class);\n+\n+  private static final int DEFAULT_NUM_OF_BUCKETS = 50;\n+\n+  private final double rangeFrom;\n+  private final double rangeTo;\n+  private final int numOfBuckets;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYyODIzOA==", "bodyText": "Personally, I think this Histogram class is sufficient for now, and we should proceed with this for now.\nThere may be some arguments to use a histogram library in the future. I.e. to support sparsely populated histograms.\nPlease add a TODO to consider implementing with other potential options, such as.\nApache Commons\nhttps://www.baeldung.com/apache-commons-frequency\nGitHub Hdr Histogram\nhttps://github.com/HdrHistogram/HdrHistogram", "url": "https://github.com/apache/beam/pull/12609#discussion_r472628238", "createdAt": "2020-08-19T03:08:24Z", "author": {"login": "ajamato"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/util/Histogram.java", "diffHunk": "@@ -0,0 +1,151 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.util;\n+\n+import java.math.RoundingMode;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.math.DoubleMath;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/** A histogram that supports estimated percentile with linear interpolation. */\n+public class Histogram {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYyOTkyNw==", "bodyText": "Please rename to LatencyRecordingHttpRequestInitializer (So that we can possibly update it to use metrics instead of logging)", "url": "https://github.com/apache/beam/pull/12609#discussion_r472629927", "createdAt": "2020-08-19T03:11:06Z", "author": {"login": "ajamato"}, "path": "sdks/java/extensions/google-cloud-platform-core/src/main/java/org/apache/beam/sdk/extensions/gcp/util/LoggingHttpRequestInitializer.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.extensions.gcp.util;\n+\n+import com.google.api.client.http.HttpExecuteInterceptor;\n+import com.google.api.client.http.HttpRequest;\n+import com.google.api.client.http.HttpRequestInitializer;\n+import com.google.api.client.http.HttpResponse;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import java.io.IOException;\n+import org.apache.beam.sdk.util.Histogram;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYzMDI1NA==", "bodyText": "Add a comment describing the purpose of this callls, to record the latency of Http based API calls. I.e. for BigQuery IO", "url": "https://github.com/apache/beam/pull/12609#discussion_r472630254", "createdAt": "2020-08-19T03:11:38Z", "author": {"login": "ajamato"}, "path": "sdks/java/extensions/google-cloud-platform-core/src/main/java/org/apache/beam/sdk/extensions/gcp/util/LoggingHttpRequestInitializer.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.extensions.gcp.util;\n+\n+import com.google.api.client.http.HttpExecuteInterceptor;\n+import com.google.api.client.http.HttpRequest;\n+import com.google.api.client.http.HttpRequestInitializer;\n+import com.google.api.client.http.HttpResponse;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import java.io.IOException;\n+import org.apache.beam.sdk.util.Histogram;\n+\n+public class LoggingHttpRequestInitializer implements HttpRequestInitializer {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYzMzY5OA==", "bodyText": "30s seems a bit small. What is the timeout set to? I recommend making the maximum at least another 30s or so larger than the timeout.", "url": "https://github.com/apache/beam/pull/12609#discussion_r472633698", "createdAt": "2020-08-19T03:17:07Z", "author": {"login": "ajamato"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/StreamingWriteFn.java", "diffHunk": "@@ -80,6 +89,20 @@\n     this.toTableRow = toTableRow;\n   }\n \n+  @Setup\n+  public void setup() {\n+    // record latency upto 30 seconds in the resolution of 20ms\n+    histogram = Histogram.of(0, 30000, 1500, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYzNDUyMQ==", "bodyText": "Any reason to suspect that this will not log, if we fail a request snd don't attempt further requests? A logger on a periodic interval might make more sense?", "url": "https://github.com/apache/beam/pull/12609#discussion_r472634521", "createdAt": "2020-08-19T03:18:34Z", "author": {"login": "ajamato"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/StreamingWriteFn.java", "diffHunk": "@@ -125,6 +148,20 @@ public void finishBundle(FinishBundleContext context) throws Exception {\n     for (ValueInSingleWindow<ErrorT> row : failedInserts) {\n       context.output(failedOutputTag, row.getValue(), row.getTimestamp(), row.getWindow());\n     }\n+\n+    if (histogram.getTotalCount() > options.getLatencyLoggingFrequency()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYzNDkxOA==", "bodyText": "I don't think we should be passing in the histogram to the factory for building the service.", "url": "https://github.com/apache/beam/pull/12609#discussion_r472634918", "createdAt": "2020-08-19T03:19:10Z", "author": {"login": "ajamato"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/testing/FakeBigQueryServices.java", "diffHunk": "@@ -68,6 +69,11 @@ public DatasetService getDatasetService(BigQueryOptions bqOptions) {\n     return datasetService;\n   }\n \n+  @Override\n+  public DatasetService getDatasetService(BigQueryOptions bqOptions, Histogram histogram) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYzNTUxNw==", "bodyText": "I don't think we should be passing in the histogram to the factory for building the service. Couldn't we just instantiate it inside the call to newBigQueryClient()", "url": "https://github.com/apache/beam/pull/12609#discussion_r472635517", "createdAt": "2020-08-19T03:20:06Z", "author": {"login": "ajamato"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryServicesImpl.java", "diffHunk": "@@ -131,7 +133,12 @@ public JobService getJobService(BigQueryOptions options) {\n \n   @Override\n   public DatasetService getDatasetService(BigQueryOptions options) {\n-    return new DatasetServiceImpl(options);\n+    return new DatasetServiceImpl(options, null);\n+  }\n+\n+  @Override\n+  public DatasetService getDatasetService(BigQueryOptions options, Histogram histogram) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66a07ac169d8ac90089c12c33aef9ae733dc87a3", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/66a07ac169d8ac90089c12c33aef9ae733dc87a3", "committedDate": "2020-08-20T07:53:07Z", "message": "refactor Histogram"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbff98acba150060f281632a981483b13b8dd8ee", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/bbff98acba150060f281632a981483b13b8dd8ee", "committedDate": "2020-08-20T08:10:54Z", "message": "rename LoggingHttpRequestInitializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d5fdc0aacf1131f91f1a871f7032455a223e911", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/2d5fdc0aacf1131f91f1a871f7032455a223e911", "committedDate": "2020-08-20T08:34:25Z", "message": "add comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa14896f3632c63e2523ce1295e20015c26bdb35", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/aa14896f3632c63e2523ce1295e20015c26bdb35", "committedDate": "2020-08-20T21:00:34Z", "message": "use time instead of element count"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8bcf5b5074d5bb250deb3e21620697b45099034", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/a8bcf5b5074d5bb250deb3e21620697b45099034", "committedDate": "2020-08-20T21:17:59Z", "message": "change millis to seconds"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMDYyMTMz", "url": "https://github.com/apache/beam/pull/12609#pullrequestreview-472062133", "createdAt": "2020-08-21T00:05:24Z", "commit": {"oid": "a8bcf5b5074d5bb250deb3e21620697b45099034"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwMDowNToyNFrOHEXLwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwMDoxMjoxNlrOHEXTIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMzNjE5NA==", "bodyText": "What's the usage pattern here? If you call this one after another for each bucket index, then the histogram can be modified between calls, by another thread.\nMake this private if its only called within the class (which would mean its a non issue)\nIt would be better to copy and return the buckets in a single get call instead\nThough, if you think that's bad for performance, then this might be fine. Though please add a comment warning about this potential threading issue", "url": "https://github.com/apache/beam/pull/12609#discussion_r474336194", "createdAt": "2020-08-21T00:05:24Z", "author": {"login": "ajamato"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/util/Histogram.java", "diffHunk": "@@ -0,0 +1,202 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.util;\n+\n+import com.google.auto.value.AutoValue;\n+import java.math.RoundingMode;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.math.DoubleMath;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * A histogram that supports estimated percentile with linear interpolation.\n+ *\n+ * <p>We may consider using Apache Commons or HdrHistogram library in the future for advanced\n+ * features such as sparsely populated histograms.\n+ */\n+public class Histogram {\n+  private static final Logger LOG = LoggerFactory.getLogger(Histogram.class);\n+\n+  private final BucketType bucketType;\n+\n+  private long[] buckets;\n+  private long numOfRecords;\n+  private long numTopRecords;\n+  private long numBottomRecords;\n+\n+  private Histogram(BucketType bucketType) {\n+    this.bucketType = bucketType;\n+    this.buckets = new long[bucketType.getNumBuckets()];\n+    this.numOfRecords = 0;\n+    this.numTopRecords = 0;\n+    this.numBottomRecords = 0;\n+  }\n+\n+  /**\n+   * Create a histogram with linear buckets.\n+   *\n+   * @param start Lower bound of a starting bucket.\n+   * @param width Bucket width. Smaller width implies a better resolution for percentile estimation.\n+   * @param numBuckets The number of buckets. Upper bound of an ending bucket is defined by start +\n+   *     width * numBuckets.\n+   * @return a new Histogram instance.\n+   */\n+  public static Histogram linear(double start, double width, int numBuckets) {\n+    return new Histogram(LinearBuckets.of(start, width, numBuckets));\n+  }\n+\n+  public void record(double... values) {\n+    for (double value : values) {\n+      record(value);\n+    }\n+  }\n+\n+  public synchronized void clear() {\n+    this.buckets = new long[bucketType.getNumBuckets()];\n+    this.numOfRecords = 0;\n+    this.numTopRecords = 0;\n+    this.numBottomRecords = 0;\n+  }\n+\n+  public synchronized void record(double value) {\n+    double rangeTo = bucketType.getRangeTo();\n+    double rangeFrom = bucketType.getRangeFrom();\n+    if (value >= rangeTo) {\n+      LOG.warn(\"record is out of upper bound {}: {}\", rangeTo, value);\n+      numTopRecords++;\n+    } else if (value < rangeFrom) {\n+      LOG.warn(\"record is out of lower bound {}: {}\", rangeFrom, value);\n+      numBottomRecords++;\n+    } else {\n+      buckets[bucketType.getBucketIndex(value)]++;\n+      numOfRecords++;\n+    }\n+  }\n+\n+  public synchronized long getTotalCount() {\n+    return numOfRecords + numTopRecords + numBottomRecords;\n+  }\n+\n+  public synchronized long getCount(int bucketIndex) {\n+    return buckets[bucketIndex];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8bcf5b5074d5bb250deb3e21620697b45099034"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMzODA4MQ==", "bodyText": "I see, could you rename the variable from \"histogram\" to something describing what the histogram is for, like \"requestLatencies\", \"requestLatenciesHistogram\"", "url": "https://github.com/apache/beam/pull/12609#discussion_r474338081", "createdAt": "2020-08-21T00:12:16Z", "author": {"login": "ajamato"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryServicesImpl.java", "diffHunk": "@@ -131,7 +133,12 @@ public JobService getJobService(BigQueryOptions options) {\n \n   @Override\n   public DatasetService getDatasetService(BigQueryOptions options) {\n-    return new DatasetServiceImpl(options);\n+    return new DatasetServiceImpl(options, null);\n+  }\n+\n+  @Override\n+  public DatasetService getDatasetService(BigQueryOptions options, Histogram histogram) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYzNTUxNw=="}, "originalCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a925ecef6e80e2d94a81ba871e68c73d0b6deec", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/0a925ecef6e80e2d94a81ba871e68c73d0b6deec", "committedDate": "2020-08-21T20:27:14Z", "message": "rename histogram to requestLatencies"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d6e7697a6d557c4563970b5cc51434d2774881b", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/9d6e7697a6d557c4563970b5cc51434d2774881b", "committedDate": "2020-08-21T20:38:41Z", "message": "add comment for getCount"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1MTAxNjg3", "url": "https://github.com/apache/beam/pull/12609#pullrequestreview-475101687", "createdAt": "2020-08-26T02:08:41Z", "commit": {"oid": "9d6e7697a6d557c4563970b5cc51434d2774881b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwMjowODo0MVrOHG4ePg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwMjoyNjo1MFrOHG5NzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njk3ODc1MA==", "bodyText": "Please add backwards compatibility warnings to this so that we can remove this without breaking users.\nAlso, could you clarify why we could not use an existing implementation ?", "url": "https://github.com/apache/beam/pull/12609#discussion_r476978750", "createdAt": "2020-08-26T02:08:41Z", "author": {"login": "chamikaramj"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/util/Histogram.java", "diffHunk": "@@ -0,0 +1,151 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.util;\n+\n+import java.math.RoundingMode;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.math.DoubleMath;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/** A histogram that supports estimated percentile with linear interpolation. */\n+public class Histogram {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYyODIzOA=="}, "originalCommit": {"oid": "77083a480c4f4975882a38311f8ce25297165023"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njk5MDkyNA==", "bodyText": "Did you confirm that there's no performance impact for the default case due to new HTTP request initializer ?", "url": "https://github.com/apache/beam/pull/12609#discussion_r476990924", "createdAt": "2020-08-26T02:26:50Z", "author": {"login": "chamikaramj"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryServicesImpl.java", "diffHunk": "@@ -1014,34 +1021,33 @@ private static boolean nextBackOff(Sleeper sleeper, BackOff backoff) throws Inte\n   }\n \n   /** Returns a BigQuery client builder using the specified {@link BigQueryOptions}. */\n-  private static Bigquery.Builder newBigQueryClient(BigQueryOptions options) {\n+  private static Bigquery.Builder newBigQueryClient(\n+      BigQueryOptions options, @Nullable Histogram requestLatencies) {\n     RetryHttpRequestInitializer httpRequestInitializer =\n         new RetryHttpRequestInitializer(ImmutableList.of(404));\n     httpRequestInitializer.setCustomErrors(createBigQueryClientCustomErrors());\n     httpRequestInitializer.setWriteTimeout(options.getHTTPWriteTimeout());\n+    ImmutableList.Builder<HttpRequestInitializer> initBuilder = ImmutableList.builder();\n+    Credentials credential = options.getGcpCredential();\n+    initBuilder.add(\n+        credential == null\n+            ? new NullCredentialInitializer()\n+            : new HttpCredentialsAdapter(credential));\n+    // Do not log 404. It clutters the output and is possibly even required by the\n+    // caller.\n+    initBuilder.add(httpRequestInitializer);\n+    if (requestLatencies != null) {\n+      initBuilder.add(new LatencyRecordingHttpRequestInitializer(requestLatencies));\n+    }\n+    HttpRequestInitializer chainInitializer =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d6e7697a6d557c4563970b5cc51434d2774881b"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3bb454e17ee7319dd9be7cc5d99fca6be37aacc", "author": {"user": {"login": "ihji", "name": "Heejong Lee"}}, "url": "https://github.com/apache/beam/commit/b3bb454e17ee7319dd9be7cc5d99fca6be37aacc", "committedDate": "2020-08-26T23:36:45Z", "message": "add experimental annotation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4729, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}