{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4MjA3NTU3", "number": 13290, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNzo1Nzo1MFrOE3WEXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNzo1ODo0OFrOE3WFzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDY4NzAyOnYy", "diffSide": "RIGHT", "path": "release/src/main/scripts/build_release_candidate.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNzo1Nzo1MVrOHwosQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMTowMjozN1rOHw14Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc2MDM4Ng==", "bodyText": "Can you add a comment explaining how this deletes the tag?", "url": "https://github.com/apache/beam/pull/13290#discussion_r520760386", "createdAt": "2020-11-10T17:57:51Z", "author": {"login": "ibzib"}, "path": "release/src/main/scripts/build_release_candidate.sh", "diffHunk": "@@ -116,13 +116,21 @@ if [[ $confirmation = \"y\" ]]; then\n   echo \"-------------Building Java Artifacts with Gradle-------------\"\n   git config credential.helper store\n \n-  ./gradlew release -Prelease.newVersion=${RELEASE}-SNAPSHOT \\\n-                -Prelease.releaseVersion=${RELEASE}-RC${RC_NUM} \\\n-                -Prelease.useAutomaticVersion=true --info --no-daemon\n-\n-  git push origin \"${RELEASE_BRANCH}\"\n-  git push origin \"v${RELEASE}-RC${RC_NUM}\"\n-\n+  if git rev-parse \"v${RELEASE}-RC${RC_NUM}\" >/dev/null 2>&1; then\n+    echo \"Tag v${RELEASE}-RC${RC_NUM} already exists.\"\n+    echo \"Delete the tag and create a new tag commit (y) or skip this step (n)? [y/N]\"\n+    read confirmation\n+    if [[ $confirmation = \"y\" ]]; then\n+      git push origin :refs/tags/v${RELEASE}-RC${RC_NUM}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "033d56738e11306cd8bf6cd6e27ead605486a3d5"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk3NjQ4Ng==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/13290#discussion_r520976486", "createdAt": "2020-11-11T01:02:37Z", "author": {"login": "youngoli"}, "path": "release/src/main/scripts/build_release_candidate.sh", "diffHunk": "@@ -116,13 +116,21 @@ if [[ $confirmation = \"y\" ]]; then\n   echo \"-------------Building Java Artifacts with Gradle-------------\"\n   git config credential.helper store\n \n-  ./gradlew release -Prelease.newVersion=${RELEASE}-SNAPSHOT \\\n-                -Prelease.releaseVersion=${RELEASE}-RC${RC_NUM} \\\n-                -Prelease.useAutomaticVersion=true --info --no-daemon\n-\n-  git push origin \"${RELEASE_BRANCH}\"\n-  git push origin \"v${RELEASE}-RC${RC_NUM}\"\n-\n+  if git rev-parse \"v${RELEASE}-RC${RC_NUM}\" >/dev/null 2>&1; then\n+    echo \"Tag v${RELEASE}-RC${RC_NUM} already exists.\"\n+    echo \"Delete the tag and create a new tag commit (y) or skip this step (n)? [y/N]\"\n+    read confirmation\n+    if [[ $confirmation = \"y\" ]]; then\n+      git push origin :refs/tags/v${RELEASE}-RC${RC_NUM}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc2MDM4Ng=="}, "originalCommit": {"oid": "033d56738e11306cd8bf6cd6e27ead605486a3d5"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDY5MDY5OnYy", "diffSide": "RIGHT", "path": "release/src/main/scripts/build_release_candidate.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNzo1ODo0OFrOHwoung==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMTowMjozMlrOHw14Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc2MDk5MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              if [[ $confirmation = \"y\" ]]; then # Expected to only be \"n\" if user chose to skip creating tag.\n          \n          \n            \n              if [[ $confirmation = \"y\" ]]; then # Expected to be \"y\" unless user chose to skip creating tag.", "url": "https://github.com/apache/beam/pull/13290#discussion_r520760990", "createdAt": "2020-11-10T17:58:48Z", "author": {"login": "ibzib"}, "path": "release/src/main/scripts/build_release_candidate.sh", "diffHunk": "@@ -116,13 +116,21 @@ if [[ $confirmation = \"y\" ]]; then\n   echo \"-------------Building Java Artifacts with Gradle-------------\"\n   git config credential.helper store\n \n-  ./gradlew release -Prelease.newVersion=${RELEASE}-SNAPSHOT \\\n-                -Prelease.releaseVersion=${RELEASE}-RC${RC_NUM} \\\n-                -Prelease.useAutomaticVersion=true --info --no-daemon\n-\n-  git push origin \"${RELEASE_BRANCH}\"\n-  git push origin \"v${RELEASE}-RC${RC_NUM}\"\n-\n+  if git rev-parse \"v${RELEASE}-RC${RC_NUM}\" >/dev/null 2>&1; then\n+    echo \"Tag v${RELEASE}-RC${RC_NUM} already exists.\"\n+    echo \"Delete the tag and create a new tag commit (y) or skip this step (n)? [y/N]\"\n+    read confirmation\n+    if [[ $confirmation = \"y\" ]]; then\n+      git push origin :refs/tags/v${RELEASE}-RC${RC_NUM}\n+    fi\n+  fi\n+  if [[ $confirmation = \"y\" ]]; then # Expected to only be \"n\" if user chose to skip creating tag.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "033d56738e11306cd8bf6cd6e27ead605486a3d5"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk3NjQzMQ==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/13290#discussion_r520976431", "createdAt": "2020-11-11T01:02:32Z", "author": {"login": "youngoli"}, "path": "release/src/main/scripts/build_release_candidate.sh", "diffHunk": "@@ -116,13 +116,21 @@ if [[ $confirmation = \"y\" ]]; then\n   echo \"-------------Building Java Artifacts with Gradle-------------\"\n   git config credential.helper store\n \n-  ./gradlew release -Prelease.newVersion=${RELEASE}-SNAPSHOT \\\n-                -Prelease.releaseVersion=${RELEASE}-RC${RC_NUM} \\\n-                -Prelease.useAutomaticVersion=true --info --no-daemon\n-\n-  git push origin \"${RELEASE_BRANCH}\"\n-  git push origin \"v${RELEASE}-RC${RC_NUM}\"\n-\n+  if git rev-parse \"v${RELEASE}-RC${RC_NUM}\" >/dev/null 2>&1; then\n+    echo \"Tag v${RELEASE}-RC${RC_NUM} already exists.\"\n+    echo \"Delete the tag and create a new tag commit (y) or skip this step (n)? [y/N]\"\n+    read confirmation\n+    if [[ $confirmation = \"y\" ]]; then\n+      git push origin :refs/tags/v${RELEASE}-RC${RC_NUM}\n+    fi\n+  fi\n+  if [[ $confirmation = \"y\" ]]; then # Expected to only be \"n\" if user chose to skip creating tag.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc2MDk5MA=="}, "originalCommit": {"oid": "033d56738e11306cd8bf6cd6e27ead605486a3d5"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2740, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}