{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4MjA3NTU3", "number": 13290, "title": "[BEAM-11074] build_release_candidate usability improvements.", "bodyText": "Specifically, this change checks whether a tag exists before calling the gradle release plugin, allowing the user to either delete the existing tag or skip creating the tag. Also avoids going into interactive commit messages with SVN, instead using commit messages built-in to the script.\nNote that the original intention behind this change is to allow finer-grained skipping in the release candidate script to avoid problems if steps need to be repeated if a release candidate fails. For example, in the current implementation if a release candidate fails after creating a release candidate tag and that step gets run again, it'll cause an error due to trying to create an existing tag. I tried to read through the script to find other instances where repeating a step might be problematic, but I couldn't really find anything else that isn't already skippable. Reviewers, let me know if I missed any.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-11-10T04:49:57Z", "url": "https://github.com/apache/beam/pull/13290", "merged": true, "mergeCommit": {"oid": "96814675e8f59d7992edb7c98fec70029ce199d5"}, "closed": true, "closedAt": "2020-11-12T00:51:22Z", "author": {"login": "youngoli"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbB5j3AH2gAyNTE4MjA3NTU3OjAzM2Q1NjczOGUxMTMwNmNkOGJmNmNkNmUyN2VhZDYwNTQ4NmEzZDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbgUz4gFqTUyODMxNzY1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "033d56738e11306cd8bf6cd6e27ead605486a3d5", "author": {"user": {"login": "youngoli", "name": "Daniel Oliveira"}}, "url": "https://github.com/apache/beam/commit/033d56738e11306cd8bf6cd6e27ead605486a3d5", "committedDate": "2020-11-10T04:45:58Z", "message": "[BEAM-11074] build_release_candidate usability improvements.\n\nSpecifically, this change checks whether a tag exists before calling the gradle release plugin, allowing the user to either delete the existing tag or skip creating the tag. Also avoids going into interactive commit messages with SVN, instead using commit messages built-in to the script."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NDY0MjU3", "url": "https://github.com/apache/beam/pull/13290#pullrequestreview-527464257", "createdAt": "2020-11-10T17:57:50Z", "commit": {"oid": "033d56738e11306cd8bf6cd6e27ead605486a3d5"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNzo1Nzo1MVrOHwosQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNzo1ODo0OFrOHwoung==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc2MDM4Ng==", "bodyText": "Can you add a comment explaining how this deletes the tag?", "url": "https://github.com/apache/beam/pull/13290#discussion_r520760386", "createdAt": "2020-11-10T17:57:51Z", "author": {"login": "ibzib"}, "path": "release/src/main/scripts/build_release_candidate.sh", "diffHunk": "@@ -116,13 +116,21 @@ if [[ $confirmation = \"y\" ]]; then\n   echo \"-------------Building Java Artifacts with Gradle-------------\"\n   git config credential.helper store\n \n-  ./gradlew release -Prelease.newVersion=${RELEASE}-SNAPSHOT \\\n-                -Prelease.releaseVersion=${RELEASE}-RC${RC_NUM} \\\n-                -Prelease.useAutomaticVersion=true --info --no-daemon\n-\n-  git push origin \"${RELEASE_BRANCH}\"\n-  git push origin \"v${RELEASE}-RC${RC_NUM}\"\n-\n+  if git rev-parse \"v${RELEASE}-RC${RC_NUM}\" >/dev/null 2>&1; then\n+    echo \"Tag v${RELEASE}-RC${RC_NUM} already exists.\"\n+    echo \"Delete the tag and create a new tag commit (y) or skip this step (n)? [y/N]\"\n+    read confirmation\n+    if [[ $confirmation = \"y\" ]]; then\n+      git push origin :refs/tags/v${RELEASE}-RC${RC_NUM}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "033d56738e11306cd8bf6cd6e27ead605486a3d5"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc2MDk5MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              if [[ $confirmation = \"y\" ]]; then # Expected to only be \"n\" if user chose to skip creating tag.\n          \n          \n            \n              if [[ $confirmation = \"y\" ]]; then # Expected to be \"y\" unless user chose to skip creating tag.", "url": "https://github.com/apache/beam/pull/13290#discussion_r520760990", "createdAt": "2020-11-10T17:58:48Z", "author": {"login": "ibzib"}, "path": "release/src/main/scripts/build_release_candidate.sh", "diffHunk": "@@ -116,13 +116,21 @@ if [[ $confirmation = \"y\" ]]; then\n   echo \"-------------Building Java Artifacts with Gradle-------------\"\n   git config credential.helper store\n \n-  ./gradlew release -Prelease.newVersion=${RELEASE}-SNAPSHOT \\\n-                -Prelease.releaseVersion=${RELEASE}-RC${RC_NUM} \\\n-                -Prelease.useAutomaticVersion=true --info --no-daemon\n-\n-  git push origin \"${RELEASE_BRANCH}\"\n-  git push origin \"v${RELEASE}-RC${RC_NUM}\"\n-\n+  if git rev-parse \"v${RELEASE}-RC${RC_NUM}\" >/dev/null 2>&1; then\n+    echo \"Tag v${RELEASE}-RC${RC_NUM} already exists.\"\n+    echo \"Delete the tag and create a new tag commit (y) or skip this step (n)? [y/N]\"\n+    read confirmation\n+    if [[ $confirmation = \"y\" ]]; then\n+      git push origin :refs/tags/v${RELEASE}-RC${RC_NUM}\n+    fi\n+  fi\n+  if [[ $confirmation = \"y\" ]]; then # Expected to only be \"n\" if user chose to skip creating tag.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "033d56738e11306cd8bf6cd6e27ead605486a3d5"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2699c9dea45750a2577e733bdd45788b2aa43261", "author": {"user": {"login": "youngoli", "name": "Daniel Oliveira"}}, "url": "https://github.com/apache/beam/commit/2699c9dea45750a2577e733bdd45788b2aa43261", "committedDate": "2020-11-11T00:41:56Z", "message": "[BEAM-11074] Fixup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3ODUwMTQ0", "url": "https://github.com/apache/beam/pull/13290#pullrequestreview-527850144", "createdAt": "2020-11-11T04:15:52Z", "commit": {"oid": "2699c9dea45750a2577e733bdd45788b2aa43261"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MzE3NjU5", "url": "https://github.com/apache/beam/pull/13290#pullrequestreview-528317659", "createdAt": "2020-11-11T16:12:53Z", "commit": {"oid": "2699c9dea45750a2577e733bdd45788b2aa43261"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4747, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}