{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0ODY3MzAx", "number": 12505, "title": "[BEAM-8106] Add version to java container image name", "bodyText": "Adding version number to Java 8 image names (in anticipation of releasing java11 container)\nThis PR:\n\nChanges the output tag/name for the docker container task to apache/beam_java8_sdk instead of apache/beam_java_sdk\nAdjusts hardcoded/java8-only references to java_sdk to java8_sdk (leaving tackling the changes to allow for versioning to a different PR)\nRemoves separate Dockerfile for Java11 and add java_version argument to existing Dockerfile. Changes build command:\n\nOld:\n./gradlew :sdks:java:container:docker -Pdockerfile=Dockerfile-java11 ...\n\nNew:\n./gradlew :sdks:java:container:docker -PimageJavaVersion=11 ...\n\nThe actual difference betweeen Dockerfile-java11 and Dockerfile are minimal - literally these COPY lines:\n\n  \n    \n      beam/sdks/java/container/Dockerfile\n    \n    \n        Lines 35 to 36\n      in\n      63f54fd\n    \n    \n    \n    \n\n        \n          \n           COPY target/LICENSE /opt/apache/beam/ \n        \n\n        \n          \n           COPY target/NOTICE /opt/apache/beam/ \n        \n    \n  \n\n\nare the only difference, and I'm pretty sure they should be copied appropriately for the Java11 image as well.\nThings that should be done at submission/after merge:\n\n Add new repository to hub.docker.com/apache before next run of release script.\n Send a notice out to dev@ and user@\n Notify releaser that name of released image will have changed after version 3.XX.00\n\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-07T23:00:33Z", "url": "https://github.com/apache/beam/pull/12505", "merged": true, "mergeCommit": {"oid": "97a270f92911fa2524f16451dae0400ea03ee0cc"}, "closed": true, "closedAt": "2020-09-29T23:10:48Z", "author": {"login": "emilymye"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9ohaxABqjM2NDA0MzMzNTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMJl3hABqjM4MDU0MDk3MDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f63682811781c8e9279ca88f48a16a6e01e57844", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/f63682811781c8e9279ca88f48a16a6e01e57844", "committedDate": "2020-08-07T22:57:28Z", "message": "add param to ReleaseInfo for java image name"}, "afterCommit": {"oid": "35ac254cda952071aa2becf06591cd4469aea0ba", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/35ac254cda952071aa2becf06591cd4469aea0ba", "committedDate": "2020-08-07T22:57:28Z", "message": "use javaVersion argument to version Java container image"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "35ac254cda952071aa2becf06591cd4469aea0ba", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/35ac254cda952071aa2becf06591cd4469aea0ba", "committedDate": "2020-08-07T22:57:28Z", "message": "use javaVersion argument to version Java container image"}, "afterCommit": {"oid": "2c28eff493ab8d624ab1836ae84545dceb3dcd10", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/2c28eff493ab8d624ab1836ae84545dceb3dcd10", "committedDate": "2020-08-07T22:57:28Z", "message": "rename java -> java8 in publish script"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2c28eff493ab8d624ab1836ae84545dceb3dcd10", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/2c28eff493ab8d624ab1836ae84545dceb3dcd10", "committedDate": "2020-08-07T22:57:28Z", "message": "rename java -> java8 in publish script"}, "afterCommit": {"oid": "1c46a53229ff774529bca26598327a4e9ca51e50", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/1c46a53229ff774529bca26598327a4e9ca51e50", "committedDate": "2020-09-01T06:40:24Z", "message": "rename java -> java8 in publish script"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1c46a53229ff774529bca26598327a4e9ca51e50", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/1c46a53229ff774529bca26598327a4e9ca51e50", "committedDate": "2020-09-01T06:40:24Z", "message": "rename java -> java8 in publish script"}, "afterCommit": {"oid": "6595512941db96bb32024c96c1a88f5fc40ffe5f", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/6595512941db96bb32024c96c1a88f5fc40ffe5f", "committedDate": "2020-09-14T00:37:15Z", "message": "use imageJavaVersion argument to Java Dockerfile and images"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6595512941db96bb32024c96c1a88f5fc40ffe5f", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/6595512941db96bb32024c96c1a88f5fc40ffe5f", "committedDate": "2020-09-14T00:37:15Z", "message": "use imageJavaVersion argument to Java Dockerfile and images"}, "afterCommit": {"oid": "46f5df487e9759e5e38ad5ce14250f1084f00460", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/46f5df487e9759e5e38ad5ce14250f1084f00460", "committedDate": "2020-09-14T01:43:28Z", "message": "add java_version arg for building Java harness container"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d221be2e20094a8dc15b07d857c8aff5e084ae3", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/2d221be2e20094a8dc15b07d857c8aff5e084ae3", "committedDate": "2020-09-14T04:14:30Z", "message": "docs changes"}, "afterCommit": {"oid": "48c1242ff51d11d68e2d070b19d6e112de96c554", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/48c1242ff51d11d68e2d070b19d6e112de96c554", "committedDate": "2020-09-14T22:41:55Z", "message": "docs changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4ODU2NDE5", "url": "https://github.com/apache/beam/pull/12505#pullrequestreview-488856419", "createdAt": "2020-09-15T16:23:47Z", "commit": {"oid": "ba2a1fabec8ce7e0b09240e6f92df3ba4664f313"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNjoyMzo0N1rOHSJ6zQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNjo0Mjo1NVrOHSKoqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5ODkyNQ==", "bodyText": "nit: could you make this an exact check for 8 and 11 and throw an exception for other (unsupported) versions", "url": "https://github.com/apache/beam/pull/12505#discussion_r488798925", "createdAt": "2020-09-15T16:23:47Z", "author": {"login": "TheNeuralBit"}, "path": "runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/Environments.java", "diffHunk": "@@ -357,4 +354,14 @@ private static File zipDirectory(File directory) throws IOException {\n       return env;\n     }\n   }\n+\n+  private static String getDefaultJavaSdkHarnessContainerUrl() {\n+    String javaVersionId =\n+        Float.parseFloat(System.getProperty(\"java.specification.version\")) >= 9 ? \"java11\" : \"java8\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba2a1fabec8ce7e0b09240e6f92df3ba4664f313"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgwNDk3OQ==", "bodyText": "typo here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            apache/beam_java_8sdk              latest              16ca619d489e        2 weeks ago        550MB\n          \n          \n            \n            apache/beam_java8_sdk              latest              16ca619d489e        2 weeks ago        550MB\n          \n      \n    \n    \n  \n\nI'm assuming this change and the others like it are the result of a search to find and update all the references to beam_java_sdk, so we don't need to worry about there being other references?", "url": "https://github.com/apache/beam/pull/12505#discussion_r488804979", "createdAt": "2020-09-15T16:33:38Z", "author": {"login": "TheNeuralBit"}, "path": "website/www/site/content/en/documentation/runtime/environments.md", "diffHunk": "@@ -116,8 +116,8 @@ By default, no licenses/notices are added to the docker images.\n \n To examine the containers that you built, run `docker images` from anywhere in the command line. If you successfully built all of the container images, the command prints a table like the following:\n ```\n-REPOSITORY                          TAG                 IMAGE ID            CREATED           SIZE\n-apache/beam_java_sdk               latest              16ca619d489e        2 weeks ago        550MB\n+REPOSITORY                         TAG                 IMAGE ID            CREATED           SIZE\n+apache/beam_java_8sdk              latest              16ca619d489e        2 weeks ago        550MB", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba2a1fabec8ce7e0b09240e6f92df3ba4664f313"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgwOTM0OQ==", "bodyText": "I'm +1 for just removing this. Looks like it was added in #8053 in order to start running a job for testing Java 11. As long as the jobs that use Java 11 still pass after removing this I think it's fine.\nI don't think users should be referencing this Dockerfile directly, if they're building a Java 11 container at all it should be through the gradle command (and even then we don't support Java 11 so they shouldn't be doing it).", "url": "https://github.com/apache/beam/pull/12505#discussion_r488809349", "createdAt": "2020-09-15T16:40:44Z", "author": {"login": "TheNeuralBit"}, "path": "sdks/java/container/Dockerfile-java11", "diffHunk": "@@ -16,6 +16,10 @@\n # limitations under the License.\n ###############################################################################\n \n+##\n+# NOTE: This image is now deprecated.\n+# Use Dockerfile with the appropriate java_version build argument.\n+##", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba2a1fabec8ce7e0b09240e6f92df3ba4664f313"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgxMDY2NQ==", "bodyText": "Also the fact that this Dockerfile doesn't copy LICENSE and NOTICE is problematic.", "url": "https://github.com/apache/beam/pull/12505#discussion_r488810665", "createdAt": "2020-09-15T16:42:55Z", "author": {"login": "TheNeuralBit"}, "path": "sdks/java/container/Dockerfile-java11", "diffHunk": "@@ -16,6 +16,10 @@\n # limitations under the License.\n ###############################################################################\n \n+##\n+# NOTE: This image is now deprecated.\n+# Use Dockerfile with the appropriate java_version build argument.\n+##", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgwOTM0OQ=="}, "originalCommit": {"oid": "ba2a1fabec8ce7e0b09240e6f92df3ba4664f313"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ba2a1fabec8ce7e0b09240e6f92df3ba4664f313", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/ba2a1fabec8ce7e0b09240e6f92df3ba4664f313", "committedDate": "2020-09-14T22:54:35Z", "message": "add deprecation note to Dockerfile-java11"}, "afterCommit": {"oid": "00fb54357856ea443eebd691102190189f07b43f", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/00fb54357856ea443eebd691102190189f07b43f", "committedDate": "2020-09-16T00:32:25Z", "message": "add JavaVersion to Environments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c8c22890033185f723902980ace07efacab6f847", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/c8c22890033185f723902980ace07efacab6f847", "committedDate": "2020-09-16T23:46:46Z", "message": "remove underscore"}, "afterCommit": {"oid": "61e90dfaf3d026db671cae9920c9a7469aeb6a48", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/61e90dfaf3d026db671cae9920c9a7469aeb6a48", "committedDate": "2020-09-16T23:47:03Z", "message": "remove underscore"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "61e90dfaf3d026db671cae9920c9a7469aeb6a48", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/61e90dfaf3d026db671cae9920c9a7469aeb6a48", "committedDate": "2020-09-16T23:47:03Z", "message": "remove underscore"}, "afterCommit": {"oid": "e4ed684d027abe333f20eae70f00b54a9c11ad0a", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/e4ed684d027abe333f20eae70f00b54a9c11ad0a", "committedDate": "2020-09-17T06:26:36Z", "message": "remove underscore"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4ed684d027abe333f20eae70f00b54a9c11ad0a", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/e4ed684d027abe333f20eae70f00b54a9c11ad0a", "committedDate": "2020-09-17T06:26:36Z", "message": "remove underscore"}, "afterCommit": {"oid": "023cb28bde318aba4cf9653b8ff833c18585612c", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/023cb28bde318aba4cf9653b8ff833c18585612c", "committedDate": "2020-09-18T23:51:42Z", "message": "remove underscore"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNzc1MzE2", "url": "https://github.com/apache/beam/pull/12505#pullrequestreview-492775316", "createdAt": "2020-09-21T16:14:20Z", "commit": {"oid": "023cb28bde318aba4cf9653b8ff833c18585612c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fa6ca542aa2b042babbbe522c4314011ad4c6d8", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/9fa6ca542aa2b042babbbe522c4314011ad4c6d8", "committedDate": "2020-09-24T23:11:43Z", "message": "add java_version arg for building Java harness container"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59bae74531a378f9e6a98ccfa0671795b3e1f3e7", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/59bae74531a378f9e6a98ccfa0671795b3e1f3e7", "committedDate": "2020-09-24T23:14:24Z", "message": "change default java container name to java8"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "205e56a5aed27b32899cf695c19cdbd0dc009fb3", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/205e56a5aed27b32899cf695c19cdbd0dc009fb3", "committedDate": "2020-09-24T23:14:31Z", "message": "docs changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49d4b6c4ff6305312e0f08d215ebe8f100d87bfb", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/49d4b6c4ff6305312e0f08d215ebe8f100d87bfb", "committedDate": "2020-09-24T23:14:31Z", "message": "delete Java11 Dockerfile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de808a11434510ecfaa63aa3f22d71cf676bae58", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/de808a11434510ecfaa63aa3f22d71cf676bae58", "committedDate": "2020-09-24T23:14:31Z", "message": "fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2a0f08951b9520cb50a32f3eb62ca6ccb399dbd", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/f2a0f08951b9520cb50a32f3eb62ca6ccb399dbd", "committedDate": "2020-09-24T23:14:31Z", "message": "add JavaVersion to Environments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ec7a3cef306c6cfdac48ff603287c0a144c8d68", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/4ec7a3cef306c6cfdac48ff603287c0a144c8d68", "committedDate": "2020-09-24T23:14:31Z", "message": "fix more references in documentation to beam_java_sdk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69221f6bff47621c4a650944a2623bbd74c09c9c", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/69221f6bff47621c4a650944a2623bbd74c09c9c", "committedDate": "2020-09-24T23:14:32Z", "message": "fix names of functions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0ec608e846f519a4cbb607e89840381096fafbe", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/d0ec608e846f519a4cbb607e89840381096fafbe", "committedDate": "2020-09-24T23:14:32Z", "message": "remove underscore"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "023cb28bde318aba4cf9653b8ff833c18585612c", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/023cb28bde318aba4cf9653b8ff833c18585612c", "committedDate": "2020-09-18T23:51:42Z", "message": "remove underscore"}, "afterCommit": {"oid": "d0ec608e846f519a4cbb607e89840381096fafbe", "author": {"user": {"login": "emilymye", "name": "emily"}}, "url": "https://github.com/apache/beam/commit/d0ec608e846f519a4cbb607e89840381096fafbe", "committedDate": "2020-09-24T23:14:32Z", "message": "remove underscore"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4959, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}