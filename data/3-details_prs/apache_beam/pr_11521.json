{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4ODAzNDg0", "number": 11521, "title": "[BEAM-9577] Update Java Runners to handle dependency-based artifact staging.", "bodyText": "Thank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-04-24T23:12:51Z", "url": "https://github.com/apache/beam/pull/11521", "merged": true, "mergeCommit": {"oid": "35840151fd652006f07a5542d8616fc5b094fb31"}, "closed": true, "closedAt": "2020-05-12T17:36:08Z", "author": {"login": "robertwb"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABca51pfAH2gAyNDA4ODAzNDg0OmE1MjQ1Y2VhYjkxOWFjNmI5NjY3NDliYjM1ZjlkNzU1YTZkZDI0OGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfajXtAH2gAyNDA4ODAzNDg0Ojc4MzhhZTg0NTg5YzMwNzJjYWIxYjVmZjIyZTMyY2QxYmMyYTJkMjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a5245ceab919ac6b966749bb35f9d755a6dd248b", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/a5245ceab919ac6b966749bb35f9d755a6dd248b", "committedDate": "2020-04-24T23:11:18Z", "message": "[BEAM-9577] Update Java Runners to handle dependency-based artifact staging."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1fc7a30b7dfb4b868739cebba580842f457b19a", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/d1fc7a30b7dfb4b868739cebba580842f457b19a", "committedDate": "2020-04-27T21:53:34Z", "message": "Fix flink test message."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbf84f7ae259667781aae2a7611554d5c08f2e2e", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/bbf84f7ae259667781aae2a7611554d5c08f2e2e", "committedDate": "2020-04-28T18:01:38Z", "message": "Fix samza."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de17dc2c81729abeb7e4db23ff6c4bfecb32e61f", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/de17dc2c81729abeb7e4db23ff6c4bfecb32e61f", "committedDate": "2020-04-29T00:50:59Z", "message": "spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2OTMyNDMx", "url": "https://github.com/apache/beam/pull/11521#pullrequestreview-406932431", "createdAt": "2020-05-06T19:44:35Z", "commit": {"oid": "de17dc2c81729abeb7e4db23ff6c4bfecb32e61f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxOTo0NDozNlrOGRisgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzoyNTozMlrOGRtClw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA0NzQyNw==", "bodyText": "Create {@link GrpcFnServer}s?", "url": "https://github.com/apache/beam/pull/11521#discussion_r421047427", "createdAt": "2020-05-06T19:44:36Z", "author": {"login": "ihji"}, "path": "runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/GrpcFnServer.java", "diffHunk": "@@ -39,6 +43,59 @@\n     return new GrpcFnServer<>(server, service, apiServiceDescriptor.build());\n   }\n \n+  /**\n+   * Create a {@link GrpcFnServer}s for the provided {@link FnService}s running on an arbitrary\n+   * port.\n+   */\n+  public static List<GrpcFnServer<? extends FnService>> allocatePortAndCreateFor(\n+      List<? extends FnService> services, ServerFactory factory) throws IOException {\n+    ApiServiceDescriptor.Builder apiServiceDescriptor = ApiServiceDescriptor.newBuilder();\n+    Server server =\n+        factory.allocateAddressAndCreate(\n+            Collections.unmodifiableList(services), apiServiceDescriptor);\n+    AtomicInteger countdown = new AtomicInteger(services.size());\n+    return Lists.transform(\n+        services,\n+        service ->\n+            new SharedGrpcFnServer<>(server, service, apiServiceDescriptor.build(), countdown));\n+  }\n+\n+  /**\n+   * Create a {@link GrpcFnServer}s for the provided {@link FnService}s running on a specified port.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de17dc2c81729abeb7e4db23ff6c4bfecb32e61f"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA0OTE0Ng==", "bodyText": "Create {@link GrpcFnServer}s?", "url": "https://github.com/apache/beam/pull/11521#discussion_r421049146", "createdAt": "2020-05-06T19:47:38Z", "author": {"login": "ihji"}, "path": "runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/GrpcFnServer.java", "diffHunk": "@@ -39,6 +43,59 @@\n     return new GrpcFnServer<>(server, service, apiServiceDescriptor.build());\n   }\n \n+  /**\n+   * Create a {@link GrpcFnServer}s for the provided {@link FnService}s running on an arbitrary", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de17dc2c81729abeb7e4db23ff6c4bfecb32e61f"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNjkxOQ==", "bodyText": "Shouldn't we also close retrievalServer?", "url": "https://github.com/apache/beam/pull/11521#discussion_r421216919", "createdAt": "2020-05-07T03:25:32Z", "author": {"login": "ihji"}, "path": "runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/control/DefaultJobBundleFactory.java", "diffHunk": "@@ -613,7 +620,7 @@ public synchronized void close() {\n       // These will be closed in the reverse creation order:\n       try (AutoCloseable envCloser = environment;\n           AutoCloseable provisioningServer = serverInfo.getProvisioningServer();\n-          AutoCloseable retrievalServer = serverInfo.getRetrievalServer();\n+          AutoCloseable retrievalServer = serverInfo.getLegacyRetrievalServer();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de17dc2c81729abeb7e4db23ff6c4bfecb32e61f"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3OTM1MTQw", "url": "https://github.com/apache/beam/pull/11521#pullrequestreview-407935140", "createdAt": "2020-05-08T01:10:51Z", "commit": {"oid": "de17dc2c81729abeb7e4db23ff6c4bfecb32e61f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMToxMDo1MVrOGSVjhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMToxMDo1MVrOGSVjhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg4MDcxMA==", "bodyText": "Yes, nice catch.", "url": "https://github.com/apache/beam/pull/11521#discussion_r421880710", "createdAt": "2020-05-08T01:10:51Z", "author": {"login": "robertwb"}, "path": "runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/control/DefaultJobBundleFactory.java", "diffHunk": "@@ -613,7 +620,7 @@ public synchronized void close() {\n       // These will be closed in the reverse creation order:\n       try (AutoCloseable envCloser = environment;\n           AutoCloseable provisioningServer = serverInfo.getProvisioningServer();\n-          AutoCloseable retrievalServer = serverInfo.getRetrievalServer();\n+          AutoCloseable retrievalServer = serverInfo.getLegacyRetrievalServer();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNjkxOQ=="}, "originalCommit": {"oid": "de17dc2c81729abeb7e4db23ff6c4bfecb32e61f"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d031905ca5a102e7565d9c010979200cfc742ff", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/5d031905ca5a102e7565d9c010979200cfc742ff", "committedDate": "2020-05-08T01:14:39Z", "message": "Reviewer comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a14f5926583aa369385fb9ce5215c5560f8c457", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/0a14f5926583aa369385fb9ce5215c5560f8c457", "committedDate": "2020-05-08T01:20:35Z", "message": "spotless"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "410ac9275d4af28401eaa058083504071ed290dd", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/410ac9275d4af28401eaa058083504071ed290dd", "committedDate": "2020-05-08T16:06:17Z", "message": "fixup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c80cfbb6ecffcaa89680ead8769bb43c63e3c4f", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/0c80cfbb6ecffcaa89680ead8769bb43c63e3c4f", "committedDate": "2020-05-08T16:22:05Z", "message": "Merge remote-tracking branch 'github/master' into artifact-v2-java-end-to-end"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7838ae84589c3072cab1b5ff22e32cd1bc2a2d25", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/7838ae84589c3072cab1b5ff22e32cd1bc2a2d25", "committedDate": "2020-05-08T23:33:54Z", "message": "Set unused retrieval token.\n\nThis avoids NPEs when it's not needed."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3942, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}