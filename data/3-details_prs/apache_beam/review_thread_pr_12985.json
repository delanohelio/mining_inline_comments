{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1ODY4MzA4", "number": 12985, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo0OTo0OVrOEtJ_0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo0OTo0OVrOEtJ_0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1Nzg1MTcxOnYy", "diffSide": "RIGHT", "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/DataflowWorkProgressUpdater.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo0OTo0OVrOHgynWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxODowMDo1OVrOHhezrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE0NTc1Mw==", "bodyText": "See my earlier comment on #12984 about assuming that key == null is the same thing as not present.", "url": "https://github.com/apache/beam/pull/12985#discussion_r504145753", "createdAt": "2020-10-13T17:49:49Z", "author": {"login": "lukecwik"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/DataflowWorkProgressUpdater.java", "diffHunk": "@@ -103,9 +112,17 @@ protected void reportProgressHelper() throws Exception {\n       if (result.getHotKeyDetection() != null\n           && result.getHotKeyDetection().getUserStepName() != null) {\n         HotKeyDetection hotKeyDetection = result.getHotKeyDetection();\n+\n+        // The key set the in BatchModeExecutionContext is only set in the GroupingShuffleReader\n+        // which is the correct key. The key is also translated into a Java object in the reader.\n+        Object hotkey =\n+            options.isHotKeyLoggingEnabled()\n+                ? workItemStatusClient.getExecutionContext().getKey()\n+                : null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e10b82307ebd12eebc3683c054742e988e44ab9b"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE4MzIxOQ==", "bodyText": "In the BatchModeExecutionContext the getKey method's comment states \"If there is not a currently defined key, returns null.\" Is this an error? Do you want me to update the comment?", "url": "https://github.com/apache/beam/pull/12985#discussion_r504183219", "createdAt": "2020-10-13T18:51:18Z", "author": {"login": "rohdesamuel"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/DataflowWorkProgressUpdater.java", "diffHunk": "@@ -103,9 +112,17 @@ protected void reportProgressHelper() throws Exception {\n       if (result.getHotKeyDetection() != null\n           && result.getHotKeyDetection().getUserStepName() != null) {\n         HotKeyDetection hotKeyDetection = result.getHotKeyDetection();\n+\n+        // The key set the in BatchModeExecutionContext is only set in the GroupingShuffleReader\n+        // which is the correct key. The key is also translated into a Java object in the reader.\n+        Object hotkey =\n+            options.isHotKeyLoggingEnabled()\n+                ? workItemStatusClient.getExecutionContext().getKey()\n+                : null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE0NTc1Mw=="}, "originalCommit": {"oid": "e10b82307ebd12eebc3683c054742e988e44ab9b"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMwMjYwNA==", "bodyText": "That is a bug.", "url": "https://github.com/apache/beam/pull/12985#discussion_r504302604", "createdAt": "2020-10-13T22:50:16Z", "author": {"login": "lukecwik"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/DataflowWorkProgressUpdater.java", "diffHunk": "@@ -103,9 +112,17 @@ protected void reportProgressHelper() throws Exception {\n       if (result.getHotKeyDetection() != null\n           && result.getHotKeyDetection().getUserStepName() != null) {\n         HotKeyDetection hotKeyDetection = result.getHotKeyDetection();\n+\n+        // The key set the in BatchModeExecutionContext is only set in the GroupingShuffleReader\n+        // which is the correct key. The key is also translated into a Java object in the reader.\n+        Object hotkey =\n+            options.isHotKeyLoggingEnabled()\n+                ? workItemStatusClient.getExecutionContext().getKey()\n+                : null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE0NTc1Mw=="}, "originalCommit": {"oid": "e10b82307ebd12eebc3683c054742e988e44ab9b"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2OTgwNw==", "bodyText": "Gotcha, I changed the logging", "url": "https://github.com/apache/beam/pull/12985#discussion_r504869807", "createdAt": "2020-10-14T18:00:59Z", "author": {"login": "rohdesamuel"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/DataflowWorkProgressUpdater.java", "diffHunk": "@@ -103,9 +112,17 @@ protected void reportProgressHelper() throws Exception {\n       if (result.getHotKeyDetection() != null\n           && result.getHotKeyDetection().getUserStepName() != null) {\n         HotKeyDetection hotKeyDetection = result.getHotKeyDetection();\n+\n+        // The key set the in BatchModeExecutionContext is only set in the GroupingShuffleReader\n+        // which is the correct key. The key is also translated into a Java object in the reader.\n+        Object hotkey =\n+            options.isHotKeyLoggingEnabled()\n+                ? workItemStatusClient.getExecutionContext().getKey()\n+                : null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE0NTc1Mw=="}, "originalCommit": {"oid": "e10b82307ebd12eebc3683c054742e988e44ab9b"}, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3083, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}