{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxMzQ0MzQ3", "number": 12654, "title": "[BEAM-10766] Fix flake where ByteString coercion could modify cached type hints", "bodyText": "coerce_to_byte_string now creates a new type hint rather than modifying the existing one.\nR: @udim\nCC: @youngoli\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n \n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-21T02:50:49Z", "url": "https://github.com/apache/beam/pull/12654", "merged": true, "mergeCommit": {"oid": "e6db419c97532f416c8e94d91b22b9688ca837a0"}, "closed": true, "closedAt": "2020-08-21T18:17:00Z", "author": {"login": "TheNeuralBit"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdA7sglgH2gAyNDcxMzQ0MzQ3OmE3YTJmNWFjYjJiM2E3Y2RkODEwNDA3ZDFkMDE4N2NjOGUzMzdmNWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBH1fJgH2gAyNDcxMzQ0MzQ3OjFhZDY0MGEwZmJlOTBlOGY0MGE3MjYzYmVjNjZlYWFlYzk4ZmNkOWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a7a2f5acb2b3a7cdd810407d1d0187cc8e337f5c", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/a7a2f5acb2b3a7cdd810407d1d0187cc8e337f5c", "committedDate": "2020-08-21T02:50:15Z", "message": "Create a new type rather than modifying"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd64ea0db33fd6582989e64b7ef1c9d584dde2e9", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/fd64ea0db33fd6582989e64b7ef1c9d584dde2e9", "committedDate": "2020-08-21T02:47:46Z", "message": "Create a new type rather than modifying"}, "afterCommit": {"oid": "a7a2f5acb2b3a7cdd810407d1d0187cc8e337f5c", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/a7a2f5acb2b3a7cdd810407d1d0187cc8e337f5c", "committedDate": "2020-08-21T02:50:15Z", "message": "Create a new type rather than modifying"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f7bfe6cdc8a2395c7f00258cd7592aa28e9217a", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/5f7bfe6cdc8a2395c7f00258cd7592aa28e9217a", "committedDate": "2020-08-21T02:54:26Z", "message": "yapf"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMTE2NDY0", "url": "https://github.com/apache/beam/pull/12654#pullrequestreview-472116464", "createdAt": "2020-08-21T03:05:57Z", "commit": {"oid": "5f7bfe6cdc8a2395c7f00258cd7592aa28e9217a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNTgyNjE3", "url": "https://github.com/apache/beam/pull/12654#pullrequestreview-472582617", "createdAt": "2020-08-21T15:22:21Z", "commit": {"oid": "5f7bfe6cdc8a2395c7f00258cd7592aa28e9217a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNToyMjoyMVrOHExdtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNToyMjoyMVrOHExdtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc2Njc3Mw==", "bodyText": "Probably should also check if hasattr(typ, '__origin__') to be safe.\nIn native_type_compatibility we also check getattr(typ, '__module__', None) != 'typing' to exclude stuff that's not from the typing module.", "url": "https://github.com/apache/beam/pull/12654#discussion_r474766773", "createdAt": "2020-08-21T15:22:21Z", "author": {"login": "udim"}, "path": "sdks/python/apache_beam/transforms/external.py", "diffHunk": "@@ -127,17 +127,21 @@ def _get_named_tuple_instance(self):\n         for key, value in self._values.items() if value is not None\n     }\n \n+    # In python 2 named_fields_to_schema will not accept str because its\n+    # ambiguous. This converts str hints to ByteString recursively so its clear\n+    # we intend to use BYTES.\n     # TODO(BEAM-7372): Remove coercion to ByteString\n     def coerce_str_to_bytes(typ):\n       if typ == str:\n         return ByteString\n \n       elif hasattr(typ, '__args__'):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f7bfe6cdc8a2395c7f00258cd7592aa28e9217a"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ad640a0fbe90e8f40a7263bec66eaaec98fcd9e", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/1ad640a0fbe90e8f40a7263bec66eaaec98fcd9e", "committedDate": "2020-08-21T16:58:55Z", "message": "add __origin__ attr check"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4853, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}