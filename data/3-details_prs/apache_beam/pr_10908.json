{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NDcyMjE4", "number": 10908, "title": "[BEAM-9339] Declare capabilities for Python SDK.", "bodyText": "Thank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-02-20T00:22:52Z", "url": "https://github.com/apache/beam/pull/10908", "merged": true, "mergeCommit": {"oid": "3aece70c577453cdc86d14763a604fb779fbf880"}, "closed": true, "closedAt": "2020-02-21T21:26:43Z", "author": {"login": "robertwb"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGB-bJgFqTM2MTYwMDYyNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGmLs0ABqjMwNjE4OTg0MTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNjAwNjI1", "url": "https://github.com/apache/beam/pull/10908#pullrequestreview-361600625", "createdAt": "2020-02-20T02:43:10Z", "commit": {"oid": "06f4de4201fc4fde3c8d8f94329b12dbb5e5e3b9"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMjo0MzoxMFrOFsAZWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwMjo0NzoyOFrOFsAh7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTY4ODE1NA==", "bodyText": "nit: should we add a reference to clarify what old/new metrics are ?", "url": "https://github.com/apache/beam/pull/10908#discussion_r381688154", "createdAt": "2020-02-20T02:43:10Z", "author": {"login": "chamikaramj"}, "path": "model/pipeline/src/main/proto/beam_runner_api.proto", "diffHunk": "@@ -1209,6 +1209,30 @@ message ExternalPayload {\n   map<string, string> params = 2;  // Arbitrary extra parameters to pass\n }\n \n+// These URNs are used to indicate capabilities of environments that cannot\n+// simply be expressed as a component (such as a Coder or PTransform) that this\n+// environment understands.\n+message StandardProtocols {\n+  enum Enum {\n+    // Indicates suport for progress reporting via the legacy metric APIs.\n+    LEGACY_PROGRESS_REPORTING = 0 [(beam_urn) = \"beam:protocol:progress_reporting:v0\"];\n+\n+    // Indicates suport for progress reporting via the new metric APIs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06f4de4201fc4fde3c8d8f94329b12dbb5e5e3b9"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTY5MDM1MQ==", "bodyText": "Probably test for every expected capability here ? And also force failure if the test has not been updated to reflect a new capability ?\nThe test can be updated as the list of capabilities are updated.", "url": "https://github.com/apache/beam/pull/10908#discussion_r381690351", "createdAt": "2020-02-20T02:47:28Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/transforms/environments_test.py", "diffHunk": "@@ -53,10 +63,14 @@ def test_environment_encoding(self):\n                             state_cache_size=0, data_buffer_time_limit_ms=0),\n                         SubprocessSDKEnvironment(command_string=u'fo\u00f6')):\n       context = pipeline_context.PipelineContext()\n-      self.assertEqual(\n-          environment,\n-          Environment.from_runner_api(\n-              environment.to_runner_api(context), context))\n+      proto = environment.to_runner_api(context)\n+      reconstructed = Environment.from_runner_api(proto, context)\n+      self.assertEqual(environment, reconstructed)\n+      self.assertEqual(proto, reconstructed.to_runner_api(context))\n+\n+  def test_sdk_capabilities(self):\n+    sdk_capabilities = environments.python_sdk_capabilities()\n+    self.assertIn(common_urns.coders.LENGTH_PREFIX.urn, sdk_capabilities)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06f4de4201fc4fde3c8d8f94329b12dbb5e5e3b9"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71e2d5d38c7f8b2c44fdf8980f6ce9a3e21db32a", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/71e2d5d38c7f8b2c44fdf8980f6ce9a3e21db32a", "committedDate": "2020-02-20T19:28:45Z", "message": "Add standard protocol capabilities to protos."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "28270f9919bace81c7eb616f95e766a01c0c9d9f", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/28270f9919bace81c7eb616f95e766a01c0c9d9f", "committedDate": "2020-02-20T19:28:27Z", "message": "test updates"}, "afterCommit": {"oid": "130867167e9447cf8ee9481fe155d93acdd1a74b", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/130867167e9447cf8ee9481fe155d93acdd1a74b", "committedDate": "2020-02-20T19:28:45Z", "message": "[BEAM-9339] Declare capabilities for Python SDK."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "130867167e9447cf8ee9481fe155d93acdd1a74b", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/130867167e9447cf8ee9481fe155d93acdd1a74b", "committedDate": "2020-02-20T19:28:45Z", "message": "[BEAM-9339] Declare capabilities for Python SDK."}, "afterCommit": {"oid": "783dfc6fe06fd521c85f17668923b514233393ca", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/783dfc6fe06fd521c85f17668923b514233393ca", "committedDate": "2020-02-21T18:05:13Z", "message": "[BEAM-9339] Declare capabilities for Python SDK."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4be0a857acb43e1e8cfc7ea348e6fc3ca225ea13", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/4be0a857acb43e1e8cfc7ea348e6fc3ca225ea13", "committedDate": "2020-02-21T20:58:22Z", "message": "[BEAM-9339] Declare capabilities for Python SDK."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "783dfc6fe06fd521c85f17668923b514233393ca", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/783dfc6fe06fd521c85f17668923b514233393ca", "committedDate": "2020-02-21T18:05:13Z", "message": "[BEAM-9339] Declare capabilities for Python SDK."}, "afterCommit": {"oid": "4be0a857acb43e1e8cfc7ea348e6fc3ca225ea13", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/4be0a857acb43e1e8cfc7ea348e6fc3ca225ea13", "committedDate": "2020-02-21T20:58:22Z", "message": "[BEAM-9339] Declare capabilities for Python SDK."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2789, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}