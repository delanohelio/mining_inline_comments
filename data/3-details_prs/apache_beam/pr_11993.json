{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzMzE0NzM1", "number": 11993, "title": "Change time granularity to seconds in ParDoTest TestStream timer test\u2026", "bodyText": "\u2026s to accomodate Dataflow runner\nDataflow runner backend process Teststream events at second granularity. If advanceWatermark or advanceProcessingTime is set finer than second the Teststream does not advance at all.\nChange advanceProcessingTime duration relative to the unix epoch since the processing time timers are set based on realtime.\nPlease add a meaningful description for your change here\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-06-11T20:25:15Z", "url": "https://github.com/apache/beam/pull/11993", "merged": true, "mergeCommit": {"oid": "eaa41cc4cbcc4f94d0ec1a36ff2b0f3fcee962f9"}, "closed": true, "closedAt": "2020-06-25T22:35:25Z", "author": {"login": "y1chi"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqUJeSgH2gAyNDMzMzE0NzM1OmI1ZTQwYjNjOGRmYjkzNDdlOTNjNzBiOTFiYWE0NWVlMzVkNDRhNmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcu1B3IAH2gAyNDMzMzE0NzM1OjY1N2VlODQ4OTU5NDhmN2JmMTgxMGRmZTE2MDc5MTMxZjBhNDQyNTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b5e40b3c8dfb9347e93c70b91baa45ee35d44a6a", "author": {"user": {"login": "y1chi", "name": "Yichi Zhang"}}, "url": "https://github.com/apache/beam/commit/b5e40b3c8dfb9347e93c70b91baa45ee35d44a6a", "committedDate": "2020-06-11T20:19:21Z", "message": "Change time granularity to seconds in ParDoTest TestStream timer tests to accomodate Dataflow runner"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNDg1Mjg1", "url": "https://github.com/apache/beam/pull/11993#pullrequestreview-433485285", "createdAt": "2020-06-18T17:10:14Z", "commit": {"oid": "b5e40b3c8dfb9347e93c70b91baa45ee35d44a6a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNzoxMDoxNFrOGl4nwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNzoxMDoxNFrOGl4nwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM3ODE3Ng==", "bodyText": "Updating other tests to second granularity makes sense but changing the test to see how END_OF_GLOBAL_WINDOW is interpreted changes what this test is explicitly trying to do.", "url": "https://github.com/apache/beam/pull/11993#discussion_r442378176", "createdAt": "2020-06-18T17:10:14Z", "author": {"login": "lukecwik"}, "path": "sdks/java/core/src/test/java/org/apache/beam/sdk/transforms/ParDoTest.java", "diffHunk": "@@ -3808,15 +3817,24 @@ public void onTimer(\n       TestStream<KV<String, Integer>> stream =\n           TestStream.create(KvCoder.of(StringUtf8Coder.of(), VarIntCoder.of()))\n               // See GlobalWindow,\n-              // END_OF_GLOBAL_WINDOW is TIMESTAMP_MAX_VALUE.minus(Duration.standardDays(1))\n-              .advanceWatermarkTo(BoundedWindow.TIMESTAMP_MAX_VALUE.minus(Duration.standardDays(1)))\n+              // END_OF_GLOBAL_WINDOW is TIMESTAMP_MAX_VALUE.minus(Duration.standardDays(1)),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5e40b3c8dfb9347e93c70b91baa45ee35d44a6a"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cb582cfe0e547e3a12dfd8a9d1605f2d3a9979f", "author": {"user": {"login": "y1chi", "name": "Yichi Zhang"}}, "url": "https://github.com/apache/beam/commit/1cb582cfe0e547e3a12dfd8a9d1605f2d3a9979f", "committedDate": "2020-06-25T20:35:24Z", "message": "Revert change to testEventTimeTimerAlignAfterGcTimeUnbounded"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3ODQzNDA1", "url": "https://github.com/apache/beam/pull/11993#pullrequestreview-437843405", "createdAt": "2020-06-25T20:42:30Z", "commit": {"oid": "1cb582cfe0e547e3a12dfd8a9d1605f2d3a9979f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMDo0MjozMFrOGpLE7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQyMDo0MjozMFrOGpLE7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTgyNjI4Ng==", "bodyText": "nit: use GlobalWindow.INSTANCE.maxTimestamp():\n\n  \n    \n      beam/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/windowing/GlobalWindow.java\n    \n    \n         Line 42\n      in\n      7269e3f\n    \n    \n    \n    \n\n        \n          \n           public Instant maxTimestamp() { \n        \n    \n  \n\n\nHere and below instead of calculating it.", "url": "https://github.com/apache/beam/pull/11993#discussion_r445826286", "createdAt": "2020-06-25T20:42:30Z", "author": {"login": "lukecwik"}, "path": "sdks/java/core/src/test/java/org/apache/beam/sdk/transforms/ParDoTest.java", "diffHunk": "@@ -3817,24 +3817,15 @@ public void onTimer(\n       TestStream<KV<String, Integer>> stream =\n           TestStream.create(KvCoder.of(StringUtf8Coder.of(), VarIntCoder.of()))\n               // See GlobalWindow,\n-              // END_OF_GLOBAL_WINDOW is TIMESTAMP_MAX_VALUE.minus(Duration.standardDays(1)),\n-              // minus 775 milliseconds to make the grainularity to second as required by dataflow\n-              // for TestStream.\n-              .advanceWatermarkTo(\n-                  BoundedWindow.TIMESTAMP_MAX_VALUE\n-                      .minus(Duration.standardDays(1))\n-                      .minus(BoundedWindow.TIMESTAMP_MAX_VALUE.getMillis() % 1000))\n+              // END_OF_GLOBAL_WINDOW is TIMESTAMP_MAX_VALUE.minus(Duration.standardDays(1))\n+              .advanceWatermarkTo(BoundedWindow.TIMESTAMP_MAX_VALUE.minus(Duration.standardDays(1)))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cb582cfe0e547e3a12dfd8a9d1605f2d3a9979f"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "657ee84895948f7bf1810dfe16079131f0a44255", "author": {"user": {"login": "y1chi", "name": "Yichi Zhang"}}, "url": "https://github.com/apache/beam/commit/657ee84895948f7bf1810dfe16079131f0a44255", "committedDate": "2020-06-25T20:53:36Z", "message": "Use GlobalWindow maxTimestamp()"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3400, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}