{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzNjQzNjY0", "number": 13117, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMToyMToxNFrOEtqphg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNzowNjo1M1rOEuF3Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MzIwMTM0OnYy", "diffSide": "RIGHT", "path": "sdks/java/container/license_scripts/pull_licenses_java.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMToyMToxNFrOHhlfHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNjozMToyN1rOHiQUQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk3OTIzMQ==", "bodyText": "Do all source jars follow this pattern?", "url": "https://github.com/apache/beam/pull/13117#discussion_r504979231", "createdAt": "2020-10-14T21:21:14Z", "author": {"login": "Hannah-Jiang"}, "path": "sdks/java/container/license_scripts/pull_licenses_java.py", "diffHunk": "@@ -101,13 +101,22 @@ def pull_from_url(file_name, url, dep, no_list):\n \n def pull_source_code(base_url, dir_name, dep):\n     # base_url example: https://repo1.maven.org/maven2/org/mortbay/jetty/jsp-2.1/6.1.14/\n-    soup = BeautifulSoup(urlopen(base_url).read(), \"html.parser\")\n+    try:\n+      soup = BeautifulSoup(urlopen(base_url).read(), \"html.parser\")\n+    except:\n+      logging.error('Error reading source base from {base_url}'.format(base_url=base_url))\n+      raise\n+    source_count = 0\n     for href in (a[\"href\"] for a in soup.select(\"a[href]\")):\n         if href.endswith(\n-                '.jar') and not 'javadoc' in href:  # download jar file only\n+                '.jar') and 'sources.jar' in href:  # download sources jar file only", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e38d9df43ffe961c3ef8b31cce60db5e3a6d28d5"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY4MDk2MA==", "bodyText": "Yes, and this is guarded by the check that at least one file is found matching.\nif source_count == 0:\n  raise RuntimeError('No source found at {base_url}'.format(base_url=base_url))", "url": "https://github.com/apache/beam/pull/13117#discussion_r505680960", "createdAt": "2020-10-15T16:31:27Z", "author": {"login": "alanmyrvold"}, "path": "sdks/java/container/license_scripts/pull_licenses_java.py", "diffHunk": "@@ -101,13 +101,22 @@ def pull_from_url(file_name, url, dep, no_list):\n \n def pull_source_code(base_url, dir_name, dep):\n     # base_url example: https://repo1.maven.org/maven2/org/mortbay/jetty/jsp-2.1/6.1.14/\n-    soup = BeautifulSoup(urlopen(base_url).read(), \"html.parser\")\n+    try:\n+      soup = BeautifulSoup(urlopen(base_url).read(), \"html.parser\")\n+    except:\n+      logging.error('Error reading source base from {base_url}'.format(base_url=base_url))\n+      raise\n+    source_count = 0\n     for href in (a[\"href\"] for a in soup.select(\"a[href]\")):\n         if href.endswith(\n-                '.jar') and not 'javadoc' in href:  # download jar file only\n+                '.jar') and 'sources.jar' in href:  # download sources jar file only", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk3OTIzMQ=="}, "originalCommit": {"oid": "e38d9df43ffe961c3ef8b31cce60db5e3a6d28d5"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MzIxMjUzOnYy", "diffSide": "RIGHT", "path": "sdks/java/container/license_scripts/pull_licenses_java.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMToyNTowMFrOHhll8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNjozMToyNFrOHiQUEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk4MDk3OA==", "bodyText": "How about changing the level to debug? If there are many packages need to pull source, there would be a lot of log printed out.", "url": "https://github.com/apache/beam/pull/13117#discussion_r504980978", "createdAt": "2020-10-14T21:25:00Z", "author": {"login": "Hannah-Jiang"}, "path": "sdks/java/container/license_scripts/pull_licenses_java.py", "diffHunk": "@@ -101,13 +101,22 @@ def pull_from_url(file_name, url, dep, no_list):\n \n def pull_source_code(base_url, dir_name, dep):\n     # base_url example: https://repo1.maven.org/maven2/org/mortbay/jetty/jsp-2.1/6.1.14/\n-    soup = BeautifulSoup(urlopen(base_url).read(), \"html.parser\")\n+    try:\n+      soup = BeautifulSoup(urlopen(base_url).read(), \"html.parser\")\n+    except:\n+      logging.error('Error reading source base from {base_url}'.format(base_url=base_url))\n+      raise\n+    source_count = 0\n     for href in (a[\"href\"] for a in soup.select(\"a[href]\")):\n         if href.endswith(\n-                '.jar') and not 'javadoc' in href:  # download jar file only\n+                '.jar') and 'sources.jar' in href:  # download sources jar file only\n             file_name = dir_name + '/' + href\n             url = base_url + '/' + href\n+            logging.info('Pulling source from {url}'.format(url=url))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e38d9df43ffe961c3ef8b31cce60db5e3a6d28d5"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY4MDkxMw==", "bodyText": "done", "url": "https://github.com/apache/beam/pull/13117#discussion_r505680913", "createdAt": "2020-10-15T16:31:24Z", "author": {"login": "alanmyrvold"}, "path": "sdks/java/container/license_scripts/pull_licenses_java.py", "diffHunk": "@@ -101,13 +101,22 @@ def pull_from_url(file_name, url, dep, no_list):\n \n def pull_source_code(base_url, dir_name, dep):\n     # base_url example: https://repo1.maven.org/maven2/org/mortbay/jetty/jsp-2.1/6.1.14/\n-    soup = BeautifulSoup(urlopen(base_url).read(), \"html.parser\")\n+    try:\n+      soup = BeautifulSoup(urlopen(base_url).read(), \"html.parser\")\n+    except:\n+      logging.error('Error reading source base from {base_url}'.format(base_url=base_url))\n+      raise\n+    source_count = 0\n     for href in (a[\"href\"] for a in soup.select(\"a[href]\")):\n         if href.endswith(\n-                '.jar') and not 'javadoc' in href:  # download jar file only\n+                '.jar') and 'sources.jar' in href:  # download sources jar file only\n             file_name = dir_name + '/' + href\n             url = base_url + '/' + href\n+            logging.info('Pulling source from {url}'.format(url=url))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk4MDk3OA=="}, "originalCommit": {"oid": "e38d9df43ffe961c3ef8b31cce60db5e3a6d28d5"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2Mzg2NTcyOnYy", "diffSide": "RIGHT", "path": "sdks/java/container/license_scripts/pull_licenses_java.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwMDoxNToxNlrOHhsXmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNjozMToyMFrOHiQT2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA5MTk5Mw==", "bodyText": "Do we only skip self-dependencies for non-auto-pulled libraries? Mostly this function seems very long and complicated to start with, and having the skipping returns at the top would make me feel a little better.", "url": "https://github.com/apache/beam/pull/13117#discussion_r505091993", "createdAt": "2020-10-15T00:15:16Z", "author": {"login": "emilymye"}, "path": "sdks/java/container/license_scripts/pull_licenses_java.py", "diffHunk": "@@ -140,17 +149,22 @@ def execute(dep):\n     }\n     '''\n \n-    name = dep['moduleName'].split(':')[1].lower()\n+    name = dep['moduleName'].split(':')[1]\n     version = dep['moduleVersion']\n     name_version = name + '-' + version\n+    # javac is not a runtime dependency\n+    if name == 'javac':\n+      logging.debug('Skipping', name_version)\n+      return\n     dir_name = '{license_dir}/{name_version}.jar'.format(\n         license_dir=license_dir, name_version=name_version)\n \n     # if auto pulled, directory is existing at {license_dir}\n     if not os.path.isdir(dir_name):\n         # skip self dependencies\n         if dep['moduleName'].startswith('beam'):\n-            logging.debug('Skippig', name_version)\n+            logging.debug('Skipping', name_version)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e38d9df43ffe961c3ef8b31cce60db5e3a6d28d5"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY4MDg1OA==", "bodyText": "Moved to the top.", "url": "https://github.com/apache/beam/pull/13117#discussion_r505680858", "createdAt": "2020-10-15T16:31:20Z", "author": {"login": "alanmyrvold"}, "path": "sdks/java/container/license_scripts/pull_licenses_java.py", "diffHunk": "@@ -140,17 +149,22 @@ def execute(dep):\n     }\n     '''\n \n-    name = dep['moduleName'].split(':')[1].lower()\n+    name = dep['moduleName'].split(':')[1]\n     version = dep['moduleVersion']\n     name_version = name + '-' + version\n+    # javac is not a runtime dependency\n+    if name == 'javac':\n+      logging.debug('Skipping', name_version)\n+      return\n     dir_name = '{license_dir}/{name_version}.jar'.format(\n         license_dir=license_dir, name_version=name_version)\n \n     # if auto pulled, directory is existing at {license_dir}\n     if not os.path.isdir(dir_name):\n         # skip self dependencies\n         if dep['moduleName'].startswith('beam'):\n-            logging.debug('Skippig', name_version)\n+            logging.debug('Skipping', name_version)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA5MTk5Mw=="}, "originalCommit": {"oid": "e38d9df43ffe961c3ef8b31cce60db5e3a6d28d5"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2NzY2MDM0OnYy", "diffSide": "RIGHT", "path": "sdks/java/container/license_scripts/pull_licenses_java.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNzowNjo1M1rOHiRrfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNzoxODozMlrOHiSHzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcwMzI5Mg==", "bodyText": "If I compare to the original code, it should be dep['moduleName'] instead of name. If a beam package is 'beam:xxx' and the xxx does not has beam in it, it wouldn't skipped. And I also recommend applying lower() when checking if startswith 'beam'.", "url": "https://github.com/apache/beam/pull/13117#discussion_r505703292", "createdAt": "2020-10-15T17:06:53Z", "author": {"login": "Hannah-Jiang"}, "path": "sdks/java/container/license_scripts/pull_licenses_java.py", "diffHunk": "@@ -140,17 +149,22 @@ def execute(dep):\n     }\n     '''\n \n-    name = dep['moduleName'].split(':')[1].lower()\n+    name = dep['moduleName'].split(':')[1]\n     version = dep['moduleVersion']\n     name_version = name + '-' + version\n+    # javac is not a runtime dependency\n+    if name == 'javac':\n+      logging.debug('Skipping', name_version)\n+      return\n+    # skip self dependencies\n+    if name.startswith('beam'):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4255e07ecb843c1e4ecb7987ed81c95b480f00a"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcxMDU0Mw==", "bodyText": "Good catch. Changed it to be:\nif dep['moduleName'].lower().startswith('beam'):", "url": "https://github.com/apache/beam/pull/13117#discussion_r505710543", "createdAt": "2020-10-15T17:18:32Z", "author": {"login": "alanmyrvold"}, "path": "sdks/java/container/license_scripts/pull_licenses_java.py", "diffHunk": "@@ -140,17 +149,22 @@ def execute(dep):\n     }\n     '''\n \n-    name = dep['moduleName'].split(':')[1].lower()\n+    name = dep['moduleName'].split(':')[1]\n     version = dep['moduleVersion']\n     name_version = name + '-' + version\n+    # javac is not a runtime dependency\n+    if name == 'javac':\n+      logging.debug('Skipping', name_version)\n+      return\n+    # skip self dependencies\n+    if name.startswith('beam'):", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcwMzI5Mg=="}, "originalCommit": {"oid": "d4255e07ecb843c1e4ecb7987ed81c95b480f00a"}, "originalPosition": 47}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2992, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}