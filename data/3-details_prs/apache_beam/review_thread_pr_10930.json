{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NDY2MDg1", "number": 10930, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMToyNjoyMVrODiBE4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMjowNzoyNlrODiBsOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2OTk1ODA5OnYy", "diffSide": "LEFT", "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/VendorJavaPlugin.groovy", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMToyNjoyMVrOFtFEeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMjowNjoyMlrOFtF_DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjgxMzMwNg==", "bodyText": "A similar change is needed in:\n\n  \n    \n      beam/buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy\n    \n    \n         Line 970\n      in\n      1133f7b\n    \n    \n    \n    \n\n        \n          \n           exclude \"**/module-info.class\"", "url": "https://github.com/apache/beam/pull/10930#discussion_r382813306", "createdAt": "2020-02-21T21:26:21Z", "author": {"login": "lukecwik"}, "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/VendorJavaPlugin.groovy", "diffHunk": "@@ -131,15 +131,15 @@ artifactId=${project.name}\n         inputs.files project.configurations.shadow.artifacts.files\n         doLast {\n           project.configurations.shadow.artifacts.files.each {\n-            FileTree exposedClasses = project.zipTree(it).matching {\n+            FileTree unexpectedlyExposedClasses = project.zipTree(it).matching {\n               include \"**/*.class\"\n               exclude \"org/apache/beam/vendor/**\"\n               // BEAM-5919: Exclude paths for Java 9 multi-release jars.\n-              exclude \"**/module-info.class\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb27a8c7194ba0ecb9109be271d43d7adcd6d77"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjgyODMwMA==", "bodyText": "Done", "url": "https://github.com/apache/beam/pull/10930#discussion_r382828300", "createdAt": "2020-02-21T22:06:22Z", "author": {"login": "suztomo"}, "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/VendorJavaPlugin.groovy", "diffHunk": "@@ -131,15 +131,15 @@ artifactId=${project.name}\n         inputs.files project.configurations.shadow.artifacts.files\n         doLast {\n           project.configurations.shadow.artifacts.files.each {\n-            FileTree exposedClasses = project.zipTree(it).matching {\n+            FileTree unexpectedlyExposedClasses = project.zipTree(it).matching {\n               include \"**/*.class\"\n               exclude \"org/apache/beam/vendor/**\"\n               // BEAM-5919: Exclude paths for Java 9 multi-release jars.\n-              exclude \"**/module-info.class\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjgxMzMwNg=="}, "originalCommit": {"oid": "8fb27a8c7194ba0ecb9109be271d43d7adcd6d77"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2OTk3MTYxOnYy", "diffSide": "LEFT", "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/VendorJavaPlugin.groovy", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMTozMjowOFrOFtFNCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMjowMTo0M1rOFtF4ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjgxNTQ5Ng==", "bodyText": "The glob matching semantics allegedly follow ANT pattern matching so I'm lost as to why **/module-info.class didn't exclude the top level pattern.", "url": "https://github.com/apache/beam/pull/10930#discussion_r382815496", "createdAt": "2020-02-21T21:32:08Z", "author": {"login": "lukecwik"}, "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/VendorJavaPlugin.groovy", "diffHunk": "@@ -131,15 +131,15 @@ artifactId=${project.name}\n         inputs.files project.configurations.shadow.artifacts.files\n         doLast {\n           project.configurations.shadow.artifacts.files.each {\n-            FileTree exposedClasses = project.zipTree(it).matching {\n+            FileTree unexpectedlyExposedClasses = project.zipTree(it).matching {\n               include \"**/*.class\"\n               exclude \"org/apache/beam/vendor/**\"\n               // BEAM-5919: Exclude paths for Java 9 multi-release jars.\n-              exclude \"**/module-info.class\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fb27a8c7194ba0ecb9109be271d43d7adcd6d77"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjgyNDY3Mg==", "bodyText": "**/module-info.class is excluding the top level pattern. If I understand it correctly, the problem is we only want the top level one to be excluded. This was a regression introduced here during the last grpc version change.", "url": "https://github.com/apache/beam/pull/10930#discussion_r382824672", "createdAt": "2020-02-21T21:56:34Z", "author": {"login": "robinyqiu"}, "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/VendorJavaPlugin.groovy", "diffHunk": "@@ -131,15 +131,15 @@ artifactId=${project.name}\n         inputs.files project.configurations.shadow.artifacts.files\n         doLast {\n           project.configurations.shadow.artifacts.files.each {\n-            FileTree exposedClasses = project.zipTree(it).matching {\n+            FileTree unexpectedlyExposedClasses = project.zipTree(it).matching {\n               include \"**/*.class\"\n               exclude \"org/apache/beam/vendor/**\"\n               // BEAM-5919: Exclude paths for Java 9 multi-release jars.\n-              exclude \"**/module-info.class\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjgxNTQ5Ng=="}, "originalCommit": {"oid": "8fb27a8c7194ba0ecb9109be271d43d7adcd6d77"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjgyNjU5Nw==", "bodyText": "Now I understand, misread what the exclusion was for. Thought it was for excluding the file and not for excluding files during validation.", "url": "https://github.com/apache/beam/pull/10930#discussion_r382826597", "createdAt": "2020-02-21T22:01:43Z", "author": {"login": "lukecwik"}, "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/VendorJavaPlugin.groovy", "diffHunk": "@@ -131,15 +131,15 @@ artifactId=${project.name}\n         inputs.files project.configurations.shadow.artifacts.files\n         doLast {\n           project.configurations.shadow.artifacts.files.each {\n-            FileTree exposedClasses = project.zipTree(it).matching {\n+            FileTree unexpectedlyExposedClasses = project.zipTree(it).matching {\n               include \"**/*.class\"\n               exclude \"org/apache/beam/vendor/**\"\n               // BEAM-5919: Exclude paths for Java 9 multi-release jars.\n-              exclude \"**/module-info.class\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjgxNTQ5Ng=="}, "originalCommit": {"oid": "8fb27a8c7194ba0ecb9109be271d43d7adcd6d77"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MDA1ODgxOnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMjowNzoyNlrOFtGAow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQyMjowNzoyNlrOFtGAow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjgyODcwNw==", "bodyText": "Reverting this change https://github.com/apache/beam/pull/10463/files#r382787180 . validateShadedJarDoesntLeakNonProjectClasses should fail upon root module-info.class.", "url": "https://github.com/apache/beam/pull/10930#discussion_r382828707", "createdAt": "2020-02-21T22:07:26Z", "author": {"login": "suztomo"}, "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy", "diffHunk": "@@ -967,7 +967,7 @@ class BeamModulePlugin implements Plugin<Project> {\n                 FileTree exposedClasses = project.zipTree(it).matching {\n                   include \"**/*.class\"\n                   // BEAM-5919: Exclude paths for Java 9 multi-release jars.\n-                  exclude \"**/module-info.class\"\n+                  exclude \"META-INF/versions/*/module-info.class\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6935576731fe5043a5e4a8abfeb82984c2b97ed"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1873, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}