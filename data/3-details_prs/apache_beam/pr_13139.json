{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2MjQ2MDMz", "number": 13139, "title": "[BEAM-9547] Implementation for drop, explode", "bodyText": "This PR primarily adds support for DataFrame.{drop,explode}.\nI also noticed an edge case affecting the generated proxy in rename, so I included a change in this PR to make TransformTest.run_scenario verify that the deferred DataFrame's proxy matches the shape of the expected output. This detected a couple of issues (the aforementioned rename issue, verified in a new test, as well as a problem in str.repeat).\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-10-19T20:06:36Z", "url": "https://github.com/apache/beam/pull/13139", "merged": true, "mergeCommit": {"oid": "5b3828593c5b6a27a545989fe289ebee0c8857d6"}, "closed": true, "closedAt": "2020-10-29T22:30:38Z", "author": {"login": "TheNeuralBit"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTNrdhAH2gAyNTA2MjQ2MDMzOmE1YzdlYmU1N2YyNjNkYjIxNzZmOTc3YzUwOGIyNTI3YWJmYWM0OWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXZRNXgH2gAyNTA2MjQ2MDMzOjAzN2YxMDJiOTkzZDFkY2ZmYTNjZDllOTlmNjlkZDZjOWZhZjEyOGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a5c7ebe57f263db2176f977c508b2527abfac49b", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/a5c7ebe57f263db2176f977c508b2527abfac49b", "committedDate": "2020-10-16T21:58:02Z", "message": "implement drop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac4395f5fa183ea7f9a002f6c32e933b5b8e8d5b", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/ac4395f5fa183ea7f9a002f6c32e933b5b8e8d5b", "committedDate": "2020-10-16T21:59:09Z", "message": "Make TransformsTest verify proxy, fix some bugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35012801287fcaca0832d42cf44e72a2e23bbc99", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/35012801287fcaca0832d42cf44e72a2e23bbc99", "committedDate": "2020-10-19T19:46:26Z", "message": "Add implementation for explode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e27287db91d844a7497ed94493f23d49ee83349", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/9e27287db91d844a7497ed94493f23d49ee83349", "committedDate": "2020-10-27T23:16:42Z", "message": "lint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4OTgyOTk1", "url": "https://github.com/apache/beam/pull/13139#pullrequestreview-518982995", "createdAt": "2020-10-28T18:47:37Z", "commit": {"oid": "9e27287db91d844a7497ed94493f23d49ee83349"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxODo0NzozN1rOHp4uJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxODo1MDoyOVrOHp404A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4Mjk4Mg==", "bodyText": "One danger here of using kwargs.get rather than letting it be a parameter is that you're hard-coding what all the defaults are (rather than using populate_defaults).", "url": "https://github.com/apache/beam/pull/13139#discussion_r513682982", "createdAt": "2020-10-28T18:47:37Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/dataframe/frames.py", "diffHunk": "@@ -619,21 +619,75 @@ def assign(self, **kwargs):\n                                             \"instances are supported.\")\n     return frame_base._elementwise_method('assign')(self, **kwargs)\n \n-\n   apply = frame_base.not_implemented_method('apply')\n-  explode = frame_base.not_implemented_method('explode')\n   isin = frame_base.not_implemented_method('isin')\n   append = frame_base.not_implemented_method('append')\n   combine = frame_base.not_implemented_method('combine')\n   combine_first = frame_base.not_implemented_method('combine_first')\n   count = frame_base.not_implemented_method('count')\n-  drop = frame_base.not_implemented_method('drop')\n   eval = frame_base.not_implemented_method('eval')\n   reindex = frame_base.not_implemented_method('reindex')\n   melt = frame_base.not_implemented_method('melt')\n   pivot = frame_base.not_implemented_method('pivot')\n   pivot_table = frame_base.not_implemented_method('pivot_table')\n \n+  @frame_base.args_to_kwargs(pd.DataFrame)\n+  @frame_base.populate_defaults(pd.DataFrame)\n+  def explode(self, column, ignore_index):\n+    # ignoring the index will not preserve it\n+    preserves = (partitionings.Nothing() if ignore_index\n+                 else partitionings.Singleton())\n+    return frame_base.DeferredFrame.wrap(\n+        expressions.ComputedExpression(\n+            'explode',\n+            lambda df: df.explode(column, ignore_index),\n+            [self._expr],\n+            preserves_partition_by=preserves,\n+            requires_partition_by=partitionings.Nothing()))\n+\n+\n+  @frame_base.args_to_kwargs(pd.DataFrame)\n+  @frame_base.populate_defaults(pd.DataFrame)\n+  @frame_base.maybe_inplace\n+  def drop(self, **kwargs):\n+    labels = kwargs.get('labels', None)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e27287db91d844a7497ed94493f23d49ee83349"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY4NDcwNA==", "bodyText": "Is there a drawback to this being automatically inferred? (Or was it not?)\nSame below.", "url": "https://github.com/apache/beam/pull/13139#discussion_r513684704", "createdAt": "2020-10-28T18:50:29Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/dataframe/frames.py", "diffHunk": "@@ -1513,6 +1584,8 @@ def repeat(self, repeats):\n               'repeat',\n               lambda series: series.str.repeat(repeats),\n               [self._expr],\n+              # Output will also be a str Series", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e27287db91d844a7497ed94493f23d49ee83349"}, "originalPosition": 123}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5eaf6355eac49162989da744ce5174816813e0f2", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/5eaf6355eac49162989da744ce5174816813e0f2", "committedDate": "2020-10-28T22:27:29Z", "message": "remove hard-coded defaults"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5OTA1NDI4", "url": "https://github.com/apache/beam/pull/13139#pullrequestreview-519905428", "createdAt": "2020-10-29T17:24:06Z", "commit": {"oid": "5eaf6355eac49162989da744ce5174816813e0f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "037f102b993d1dcffa3cd9e99f69dd6c9faf128f", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/037f102b993d1dcffa3cd9e99f69dd6c9faf128f", "committedDate": "2020-10-29T21:43:55Z", "message": "add BEAM-11155 link"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2121, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}