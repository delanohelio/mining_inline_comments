{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4MTY1NTg4", "number": 11710, "title": "[BEAM-9964] Setting --workerCacheMB for Streaming Pipeline", "bodyText": "R:@pabloem\nSetting --workerCacheMB seems to affect batch pipelines only. For Streaming, the cache seems to be hardcoded to 100Mb [1]. If possible, I would like to make it allowable to change the cache value in Streaming when setting -workerCacheMB.\nPassed ./gradlew -p runners/google-cloud-dataflow-java check  on my computer\n[1] \n  \n    \n      beam/runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/WindmillStateCache.java\n    \n    \n         Line 73\n      in\n      5e659bb\n    \n    \n    \n    \n\n        \n          \n           .maximumWeight(100000000 /* 100 MB */) \n        \n    \n  \n\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-05-14T18:11:32Z", "url": "https://github.com/apache/beam/pull/11710", "merged": true, "mergeCommit": {"oid": "ac190b8a5b07485de520b858d1af06182a34b6d2"}, "closed": true, "closedAt": "2020-05-15T20:47:46Z", "author": {"login": "omarismail94"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchReVRAH2gAyNDE4MTY1NTg4OmJiMzg3N2FkOTgzNWZlYmE1MDM5ZjNlOGJmNzYzZmI4NzMzOTVhMTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchT_cygH2gAyNDE4MTY1NTg4OmU1ZGZlNWY1Y2Q0ZmQ1NjI5Njg4ZmJhY2VhOTEzNTJkMDAxYTY0YjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bb3877ad9835feba5039f3e8bf763fb873395a19", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/bb3877ad9835feba5039f3e8bf763fb873395a19", "committedDate": "2020-05-14T18:07:06Z", "message": "[BEAM-9964] Setting --workerCacheMB to make its way to the WindmillStateCache constructor. Right now, this is hardcoded at 100MB"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyMDc1NzE0", "url": "https://github.com/apache/beam/pull/11710#pullrequestreview-412075714", "createdAt": "2020-05-14T18:27:14Z", "commit": {"oid": "bb3877ad9835feba5039f3e8bf763fb873395a19"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODoyNzoxNFrOGVpCzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxODoyNzoxNFrOGVpCzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM0NTc0MQ==", "bodyText": "Can you add a check to this test to make sure that the maximumWeight of the cache is the 100 MB? (perhaps use a number different than 100 to be sure).", "url": "https://github.com/apache/beam/pull/11710#discussion_r425345741", "createdAt": "2020-05-14T18:27:14Z", "author": {"login": "pabloem"}, "path": "runners/google-cloud-dataflow-java/worker/src/test/java/org/apache/beam/runners/dataflow/worker/WindmillStateCacheTest.java", "diffHunk": "@@ -130,7 +133,8 @@ private static StateNamespace triggerNamespace(long start, int triggerIdx) {\n \n   @Before\n   public void setUp() {\n-    cache = new WindmillStateCache();\n+    options = PipelineOptionsFactory.as(DataflowWorkerHarnessOptions.class);\n+    cache = new WindmillStateCache(options.getWorkerCacheMb());\n     assertEquals(0, cache.getWeight());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb3877ad9835feba5039f3e8bf763fb873395a19"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5dfe5f5cd4fd5629688fbacea91352d001a64b5", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/e5dfe5f5cd4fd5629688fbacea91352d001a64b5", "committedDate": "2020-05-14T21:03:05Z", "message": "[BEAM-9964] Added testMaxWeight method in WIndmillStateCacheTest as per pabloem's comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4567, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}