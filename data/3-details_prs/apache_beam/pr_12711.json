{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1MDA3Njg1", "number": 12711, "title": "Support read/write ZetaSQL DATETIME/NUMERIC types from/to BigQuery", "bodyText": "Add support to 2 more new types: DATETIME and NUMERIC, similar to #12261\nAlso add the missing mapping for NUMERIC in SchemaUtils in Data Catalog.\nr: @chamikaramj, @TheNeuralBit\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-27T23:48:04Z", "url": "https://github.com/apache/beam/pull/12711", "merged": true, "mergeCommit": {"oid": "6330906371f60c6c2a95c4eac21a29a5a1bd3f49"}, "closed": true, "closedAt": "2020-11-05T21:24:36Z", "author": {"login": "robinyqiu"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdH5DHlAFqTQ4NzAwMDIzMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZo4coAFqTUyNDY2NDA5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MDAwMjMy", "url": "https://github.com/apache/beam/pull/12711#pullrequestreview-487000232", "createdAt": "2020-09-11T17:40:59Z", "commit": {"oid": "705046e2c5275c3efcc3d0f6f541ae53d72df252"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNzo0MDo1OVrOHQn8hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxNzo0MTowOVrOHQn85Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE5MzczNA==", "bodyText": "It's possible for users of BigQueryIO to hit this code path through BigQueryIO.readTableRowsWithSchema() right? This will be a breaking change since the Java type for a DATETIME field changes from Instant to LocalDateTime. I think that's ok since it's experimental, but we should add a note to CHANGES.md", "url": "https://github.com/apache/beam/pull/12711#discussion_r487193734", "createdAt": "2020-09-11T17:40:59Z", "author": {"login": "TheNeuralBit"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryUtils.java", "diffHunk": "@@ -257,10 +263,9 @@ private static FieldType fromTableFieldSchemaType(\n       case \"DATE\":\n         return FieldType.logicalType(SqlTypes.DATE);\n       case \"DATETIME\":\n-        // TODO[BEAM-10240]: map to the new logical type when ZetaSQL DATETIME type is supported\n-        return FieldType.logicalType(\n-            new PassThroughLogicalType<Instant>(\n-                \"SqlTimestampWithLocalTzType\", FieldType.STRING, \"\", FieldType.DATETIME) {});\n+        return FieldType.logicalType(SqlTypes.DATETIME);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "705046e2c5275c3efcc3d0f6f541ae53d72df252"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE5MzgyOQ==", "bodyText": "Could you make sure that BigQueryUtils.fromTableSchema is tested with NUMERIC and DATETIME? It looks like only TIMESTAMP may be tested now (as part of testTableFromSchema_flat): \n  \n    \n      beam/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryUtilsTest.java\n    \n    \n        Lines 91 to 106\n      in\n      738a910\n    \n    \n    \n    \n\n        \n          \n           private static final TableFieldSchema TIMESTAMP_VARIANT1 = \n        \n\n        \n          \n               new TableFieldSchema() \n        \n\n        \n          \n                   .setName(\"timestamp_variant1\") \n        \n\n        \n          \n                   .setType(StandardSQLTypeName.TIMESTAMP.toString()); \n        \n\n        \n          \n           private static final TableFieldSchema TIMESTAMP_VARIANT2 = \n        \n\n        \n          \n               new TableFieldSchema() \n        \n\n        \n          \n                   .setName(\"timestamp_variant2\") \n        \n\n        \n          \n                   .setType(StandardSQLTypeName.TIMESTAMP.toString()); \n        \n\n        \n          \n           private static final TableFieldSchema TIMESTAMP_VARIANT3 = \n        \n\n        \n          \n               new TableFieldSchema() \n        \n\n        \n          \n                   .setName(\"timestamp_variant3\") \n        \n\n        \n          \n                   .setType(StandardSQLTypeName.TIMESTAMP.toString()); \n        \n\n        \n          \n           private static final TableFieldSchema TIMESTAMP_VARIANT4 = \n        \n\n        \n          \n               new TableFieldSchema() \n        \n\n        \n          \n                   .setName(\"timestamp_variant4\") \n        \n\n        \n          \n                   .setType(StandardSQLTypeName.TIMESTAMP.toString());", "url": "https://github.com/apache/beam/pull/12711#discussion_r487193829", "createdAt": "2020-09-11T17:41:09Z", "author": {"login": "TheNeuralBit"}, "path": "sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryUtilsTest.java", "diffHunk": "@@ -452,6 +457,27 @@ public void testMicroPrecisionTimeType() {\n         equalTo(t));\n   }\n \n+  @Test\n+  public void testMicroPrecisionDateTimeType() {\n+    LocalDateTime dt = LocalDateTime.parse(\"2020-06-04T12:34:56.789876\");\n+    assertThat(\n+        BigQueryUtils.convertAvroFormat(\n+            FieldType.logicalType(SqlTypes.DATETIME), new Utf8(dt.toString()), REJECT_OPTIONS),\n+        equalTo(dt));\n+  }\n+\n+  @Test\n+  public void testNumericType() {\n+    // BigQuery NUMERIC type has precision 38 and scale 9\n+    BigDecimal n = new BigDecimal(\"123456789.987654321\").setScale(9);\n+    assertThat(\n+        BigQueryUtils.convertAvroFormat(\n+            FieldType.DECIMAL,\n+            new Conversions.DecimalConversion().toBytes(n, null, LogicalTypes.decimal(38, 9)),\n+            REJECT_OPTIONS),\n+        equalTo(n));\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "705046e2c5275c3efcc3d0f6f541ae53d72df252"}, "originalPosition": 45}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "705046e2c5275c3efcc3d0f6f541ae53d72df252", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/705046e2c5275c3efcc3d0f6f541ae53d72df252", "committedDate": "2020-08-27T23:43:07Z", "message": "Support read/write ZetaSQL DATETIME/NUMERIC types from/to BigQuery"}, "afterCommit": {"oid": "3e373cad7192cd23317acc538ce1d4b3ca0d1e8d", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/3e373cad7192cd23317acc538ce1d4b3ca0d1e8d", "committedDate": "2020-11-02T19:03:54Z", "message": "Support read/write ZetaSQL DATETIME/NUMERIC types from/to BigQuery"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ff1deca30c34658d81e1190e58b513df24e07be", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/8ff1deca30c34658d81e1190e58b513df24e07be", "committedDate": "2020-11-02T21:15:17Z", "message": "Support read/write ZetaSQL DATETIME/NUMERIC types from/to BigQuery"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3e373cad7192cd23317acc538ce1d4b3ca0d1e8d", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/3e373cad7192cd23317acc538ce1d4b3ca0d1e8d", "committedDate": "2020-11-02T19:03:54Z", "message": "Support read/write ZetaSQL DATETIME/NUMERIC types from/to BigQuery"}, "afterCommit": {"oid": "8ff1deca30c34658d81e1190e58b513df24e07be", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/8ff1deca30c34658d81e1190e58b513df24e07be", "committedDate": "2020-11-02T21:15:17Z", "message": "Support read/write ZetaSQL DATETIME/NUMERIC types from/to BigQuery"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e96168a4428ac13fb54e65f8c052da1da9100fd2", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/e96168a4428ac13fb54e65f8c052da1da9100fd2", "committedDate": "2020-11-02T23:22:07Z", "message": "Address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NjY0MDk5", "url": "https://github.com/apache/beam/pull/12711#pullrequestreview-524664099", "createdAt": "2020-11-05T21:03:12Z", "commit": {"oid": "e96168a4428ac13fb54e65f8c052da1da9100fd2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4538, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}