{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1ODU0MjI4", "number": 12192, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMjoxNTozMVrOEMTfpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNzo0MzozMFrOENLMBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzM3NzY0OnYy", "diffSide": "LEFT", "path": "sdks/python/apache_beam/runners/direct/sdf_direct_runner.py", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMjoxNTozMVrOGuVr4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMjoxNTozMVrOGuVr4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI0Mjk3OQ==", "bodyText": "This is handled within the PerWindowInvoker already.", "url": "https://github.com/apache/beam/pull/12192#discussion_r451242979", "createdAt": "2020-07-08T02:15:31Z", "author": {"login": "lukecwik"}, "path": "sdks/python/apache_beam/runners/direct/sdf_direct_runner.py", "diffHunk": "@@ -507,7 +500,6 @@ def initiate_checkpoint():\n       if self._max_num_outputs and output_count >= self._max_num_outputs:\n         initiate_checkpoint()\n \n-    tracker.check_done()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "facc70e7be1ddb8c49bd3a980398500f753262c1"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMzM3ODQxOnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/runners/direct/sdf_direct_runner.py", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMjoxNTo1N1rOGuVsUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMjoxNTo1N1rOGuVsUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI0MzA4OA==", "bodyText": "This is a bug fix, we should be setting checkpoint_state.checkpointed while holding the lock.", "url": "https://github.com/apache/beam/pull/12192#discussion_r451243088", "createdAt": "2020-07-08T02:15:57Z", "author": {"login": "lukecwik"}, "path": "sdks/python/apache_beam/runners/direct/sdf_direct_runner.py", "diffHunk": "@@ -464,19 +461,15 @@ def initiate_checkpoint():\n       with self._checkpoint_lock:\n         if checkpoint_state.checkpointed:\n           return\n-      checkpoint_state.residual_restriction = tracker.checkpoint()\n-      checkpoint_state.checkpointed = object()\n+        checkpoint_state.checkpointed = object()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "facc70e7be1ddb8c49bd3a980398500f753262c1"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjQ4ODMyOnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/runners/common.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNzozODo1OVrOGvtJFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNTozOTo1OVrOGv8JsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY3NTg2MQ==", "bodyText": "New type is just 'object' ?", "url": "https://github.com/apache/beam/pull/12192#discussion_r452675861", "createdAt": "2020-07-10T07:38:59Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/runners/common.py", "diffHunk": "@@ -661,8 +661,8 @@ def __init__(self, placeholder):\n \n   def invoke_process(self,\n                      windowed_value,  # type: WindowedValue\n-                     restriction_tracker=None, # type: Optional[RestrictionTracker]\n-                     watermark_estimator=None, # type: Optional[WatermarkEstimator]\n+                     restriction=None,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8efe84c76ffcce1c361e94c21b057f753bdf25b1"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjkyMTc3Ng==", "bodyText": "Yeah, since the user can choose anything they want for the restriction and watermark estimator state type.", "url": "https://github.com/apache/beam/pull/12192#discussion_r452921776", "createdAt": "2020-07-10T15:39:59Z", "author": {"login": "lukecwik"}, "path": "sdks/python/apache_beam/runners/common.py", "diffHunk": "@@ -661,8 +661,8 @@ def __init__(self, placeholder):\n \n   def invoke_process(self,\n                      windowed_value,  # type: WindowedValue\n-                     restriction_tracker=None, # type: Optional[RestrictionTracker]\n-                     watermark_estimator=None, # type: Optional[WatermarkEstimator]\n+                     restriction=None,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY3NTg2MQ=="}, "originalCommit": {"oid": "8efe84c76ffcce1c361e94c21b057f753bdf25b1"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjQ5MzI0OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/runners/common.py", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNzo0MDoyOFrOGvtMDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNjozMTowNFrOGv90dQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY3NjYyMQ==", "bodyText": "Mention when this can be None.", "url": "https://github.com/apache/beam/pull/12192#discussion_r452676621", "createdAt": "2020-07-10T07:40:28Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/runners/common.py", "diffHunk": "@@ -661,8 +661,8 @@ def __init__(self, placeholder):\n \n   def invoke_process(self,\n                      windowed_value,  # type: WindowedValue\n-                     restriction_tracker=None, # type: Optional[RestrictionTracker]\n-                     watermark_estimator=None, # type: Optional[WatermarkEstimator]\n+                     restriction=None,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8efe84c76ffcce1c361e94c21b057f753bdf25b1"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjkyNTM1NA==", "bodyText": "Done", "url": "https://github.com/apache/beam/pull/12192#discussion_r452925354", "createdAt": "2020-07-10T15:46:35Z", "author": {"login": "lukecwik"}, "path": "sdks/python/apache_beam/runners/common.py", "diffHunk": "@@ -661,8 +661,8 @@ def __init__(self, placeholder):\n \n   def invoke_process(self,\n                      windowed_value,  # type: WindowedValue\n-                     restriction_tracker=None, # type: Optional[RestrictionTracker]\n-                     watermark_estimator=None, # type: Optional[WatermarkEstimator]\n+                     restriction=None,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY3NjYyMQ=="}, "originalCommit": {"oid": "8efe84c76ffcce1c361e94c21b057f753bdf25b1"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk0OTEwOQ==", "bodyText": "Done", "url": "https://github.com/apache/beam/pull/12192#discussion_r452949109", "createdAt": "2020-07-10T16:31:04Z", "author": {"login": "lukecwik"}, "path": "sdks/python/apache_beam/runners/common.py", "diffHunk": "@@ -661,8 +661,8 @@ def __init__(self, placeholder):\n \n   def invoke_process(self,\n                      windowed_value,  # type: WindowedValue\n-                     restriction_tracker=None, # type: Optional[RestrictionTracker]\n-                     watermark_estimator=None, # type: Optional[WatermarkEstimator]\n+                     restriction=None,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY3NjYyMQ=="}, "originalCommit": {"oid": "8efe84c76ffcce1c361e94c21b057f753bdf25b1"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMjUwMjQ1OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/runners/common.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNzo0MzozMFrOGvtRog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNTo0MTo1OVrOGv8OHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY3ODA1MA==", "bodyText": "This is a tuple ?", "url": "https://github.com/apache/beam/pull/12192#discussion_r452678050", "createdAt": "2020-07-10T07:43:30Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/runners/common.py", "diffHunk": "@@ -661,8 +661,8 @@ def __init__(self, placeholder):\n \n   def invoke_process(self,\n                      windowed_value,  # type: WindowedValue\n-                     restriction_tracker=None, # type: Optional[RestrictionTracker]\n-                     watermark_estimator=None, # type: Optional[WatermarkEstimator]\n+                     restriction=None,\n+                     watermark_estimator_state=None,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8efe84c76ffcce1c361e94c21b057f753bdf25b1"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjkyMjkxMQ==", "bodyText": "Its a user chosen value like the restriction. They can store anything they want to restore the state for the estimator. For system provided ones its typically the last reported timestamp.", "url": "https://github.com/apache/beam/pull/12192#discussion_r452922911", "createdAt": "2020-07-10T15:41:59Z", "author": {"login": "lukecwik"}, "path": "sdks/python/apache_beam/runners/common.py", "diffHunk": "@@ -661,8 +661,8 @@ def __init__(self, placeholder):\n \n   def invoke_process(self,\n                      windowed_value,  # type: WindowedValue\n-                     restriction_tracker=None, # type: Optional[RestrictionTracker]\n-                     watermark_estimator=None, # type: Optional[WatermarkEstimator]\n+                     restriction=None,\n+                     watermark_estimator_state=None,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY3ODA1MA=="}, "originalCommit": {"oid": "8efe84c76ffcce1c361e94c21b057f753bdf25b1"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1092, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}