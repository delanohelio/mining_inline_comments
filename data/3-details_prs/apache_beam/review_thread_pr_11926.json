{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4MDk3MDUz", "number": 11926, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNTo1MzozNVrOEDAlHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNTo1MzozNVrOEDAlHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNTkwNjg1OnYy", "diffSide": "RIGHT", "path": "sdks/go/pkg/beam/coder_test.go", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNTo1MzozNVrOGf0FXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNjoyOTo1OVrOGf1S8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAxMjM4Mg==", "bodyText": "Nit: data isn't an array but the error message presents it as one. I would have expected results[%d] there.", "url": "https://github.com/apache/beam/pull/11926#discussion_r436012382", "createdAt": "2020-06-05T15:53:35Z", "author": {"login": "tysonjh"}, "path": "sdks/go/pkg/beam/coder_test.go", "diffHunk": "@@ -63,3 +64,57 @@ func TestJSONCoder(t *testing.T) {\n \t\t}\n \t}\n }\n+\n+func TestCoders(t *testing.T) {\n+\tptrString := \"test *string\"\n+\ttests := []interface{}{\n+\t\t43,\n+\t\t12431235,\n+\t\t-2,\n+\t\t0,\n+\t\t1,\n+\t\ttrue,\n+\t\t\"a string\",\n+\t\tmap[int64]string{1: \"one\", 11: \"oneone\", 21: \"twoone\", 1211: \"onetwooneone\"},\n+\t\tstruct {\n+\t\t\tA int\n+\t\t\tB *string\n+\t\t\tC bool\n+\t\t}{4, &ptrString, false},\n+\t\t[...]int64{1, 2, 3, 4, 5}, // array\n+\t\t[]int64{1, 2, 3, 4, 5},    // slice\n+\t\tstruct {\n+\t\t\tA []int\n+\t\t\tB [3]int\n+\t\t}{A: []int{1, 2, 3}, B: [...]int{4, 5, 6}},\n+\t}\n+\n+\tfor _, test := range tests {\n+\t\tvar results []string\n+\t\trt := reflect.TypeOf(test)\n+\t\tenc := NewElementEncoder(rt)\n+\t\tfor i := 0; i < 10; i++ {\n+\t\t\tvar buf bytes.Buffer\n+\t\t\tif err := enc.Encode(test, &buf); err != nil {\n+\t\t\t\tt.Fatalf(\"Failed to encode %v: %v\", tests, err)\n+\t\t\t}\n+\t\t\tresults = append(results, string(buf.Bytes()))\n+\t\t}\n+\t\tfor i, data := range results {\n+\t\t\tif data != results[0] {\n+\t\t\t\tt.Errorf(\"coder not deterministic: data[%d]: %v != %v \", i, data, results[0])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d31285ff954c19bfd706eb96afb57b855938fa3c"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAzMjI0MA==", "bodyText": "Good catch! Fixed to make it clearer what the test is checking for.", "url": "https://github.com/apache/beam/pull/11926#discussion_r436032240", "createdAt": "2020-06-05T16:29:59Z", "author": {"login": "lostluck"}, "path": "sdks/go/pkg/beam/coder_test.go", "diffHunk": "@@ -63,3 +64,57 @@ func TestJSONCoder(t *testing.T) {\n \t\t}\n \t}\n }\n+\n+func TestCoders(t *testing.T) {\n+\tptrString := \"test *string\"\n+\ttests := []interface{}{\n+\t\t43,\n+\t\t12431235,\n+\t\t-2,\n+\t\t0,\n+\t\t1,\n+\t\ttrue,\n+\t\t\"a string\",\n+\t\tmap[int64]string{1: \"one\", 11: \"oneone\", 21: \"twoone\", 1211: \"onetwooneone\"},\n+\t\tstruct {\n+\t\t\tA int\n+\t\t\tB *string\n+\t\t\tC bool\n+\t\t}{4, &ptrString, false},\n+\t\t[...]int64{1, 2, 3, 4, 5}, // array\n+\t\t[]int64{1, 2, 3, 4, 5},    // slice\n+\t\tstruct {\n+\t\t\tA []int\n+\t\t\tB [3]int\n+\t\t}{A: []int{1, 2, 3}, B: [...]int{4, 5, 6}},\n+\t}\n+\n+\tfor _, test := range tests {\n+\t\tvar results []string\n+\t\trt := reflect.TypeOf(test)\n+\t\tenc := NewElementEncoder(rt)\n+\t\tfor i := 0; i < 10; i++ {\n+\t\t\tvar buf bytes.Buffer\n+\t\t\tif err := enc.Encode(test, &buf); err != nil {\n+\t\t\t\tt.Fatalf(\"Failed to encode %v: %v\", tests, err)\n+\t\t\t}\n+\t\t\tresults = append(results, string(buf.Bytes()))\n+\t\t}\n+\t\tfor i, data := range results {\n+\t\t\tif data != results[0] {\n+\t\t\t\tt.Errorf(\"coder not deterministic: data[%d]: %v != %v \", i, data, results[0])", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAxMjM4Mg=="}, "originalCommit": {"oid": "d31285ff954c19bfd706eb96afb57b855938fa3c"}, "originalPosition": 50}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3617, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}