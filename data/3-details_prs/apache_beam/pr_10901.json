{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2OTYzNjYy", "number": 10901, "title": "[BEAM-8965] Remove duplicate sideinputs in ConsumerTrackingPipelineVisitor", "bodyText": "Summary\nThis PR is mainly preventing BundleBasedDirectRunner evaluates single side_input more than once.\nTo achieve this, this PR changes the logic to get side_input views in ConsumerTrackingPipelineVisitor, and modify the unit tests to make sure that when one single side_input is used in two different PTransforms, it will be evaluated once.\nCheck List\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-02-19T04:54:47Z", "url": "https://github.com/apache/beam/pull/10901", "merged": true, "mergeCommit": {"oid": "079317d6af535376717a086d9e07f7cfb9f65218"}, "closed": true, "closedAt": "2020-02-26T23:36:09Z", "author": {"login": "bobingm"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFuYkFAH2gAyMzc2OTYzNjYyOmVhOTEwMzY3NmQxZGE1NGExMGE2MWU2OGM5NmVmYzJkY2YxMDZmYmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIOkyqAFqTM2NTI5NTY1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ea9103676d1da54a10a61e68c96efc2dcf106fbe", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/ea9103676d1da54a10a61e68c96efc2dcf106fbe", "committedDate": "2020-02-19T03:58:10Z", "message": "Remove duplicate sideinputs in ConsumerTrackingPipelineVisitor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8828018cbd0bf9d2e3637b7d4b14ad5436060f3", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/a8828018cbd0bf9d2e3637b7d4b14ad5436060f3", "committedDate": "2020-02-19T04:52:01Z", "message": "Reduce variable numbers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NDY3NzQ0", "url": "https://github.com/apache/beam/pull/10901#pullrequestreview-364467744", "createdAt": "2020-02-25T21:39:17Z", "commit": {"oid": "a8828018cbd0bf9d2e3637b7d4b14ad5436060f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMTozOToxN1rOFuWKCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMTozOToxN1rOFuWKCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE0MTgzNA==", "bodyText": "Here we may want to only append rather than rebuild all of self.views?\nAn idea is that we may want to keep self._views = set(), add views to the set, and add a @property that returns the set as a list? (no need to implement this way, but we do want to make sure that we are not dropping elements from 'views' that we appended in previous visit_transform calls", "url": "https://github.com/apache/beam/pull/10901#discussion_r384141834", "createdAt": "2020-02-25T21:39:17Z", "author": {"login": "pabloem"}, "path": "sdks/python/apache_beam/runners/direct/consumer_tracking_pipeline_visitor.py", "diffHunk": "@@ -65,5 +66,10 @@ def visit_transform(self, applied_ptransform):\n       self.root_transforms.add(applied_ptransform)\n     self.step_names[applied_ptransform] = 's%d' % (self._num_transforms)\n     self._num_transforms += 1\n+\n     for side_input in applied_ptransform.side_inputs:\n-      self.views.append(side_input)\n+      if side_input not in self._side_input_views:\n+        self._side_input_views[side_input] = side_input\n+    self.views = [", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8828018cbd0bf9d2e3637b7d4b14ad5436060f3"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1487fc51ca1cd9abbbfce90539ac52b4e4e8ca43", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/1487fc51ca1cd9abbbfce90539ac52b4e4e8ca43", "committedDate": "2020-02-26T01:34:44Z", "message": "Address comment and fix linting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1Mjk1NjUx", "url": "https://github.com/apache/beam/pull/10901#pullrequestreview-365295651", "createdAt": "2020-02-26T22:36:20Z", "commit": {"oid": "1487fc51ca1cd9abbbfce90539ac52b4e4e8ca43"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3250, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}