{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4MjM1ODIx", "number": 12764, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNzo1NjozOFrOEgGRKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMDozMTo1NVrOEgMvpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMDkyNTg2OnYy", "diffSide": "RIGHT", "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/schemas/logicaltypes/MicrosInstant.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNzo1NjozOFrOHMxljg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMzo1ODowMVrOHM7HKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE1NzM5MA==", "bodyText": "I see other logical types handle null input in this function and toInputType() as well. Should we also add it here?", "url": "https://github.com/apache/beam/pull/12764#discussion_r483157390", "createdAt": "2020-09-03T17:56:38Z", "author": {"login": "robinyqiu"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/schemas/logicaltypes/MicrosInstant.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.schemas.logicaltypes;\n+\n+import java.time.Instant;\n+import org.apache.beam.sdk.schemas.Schema;\n+import org.apache.beam.sdk.values.Row;\n+\n+/**\n+ * A timestamp represented as microseconds since the epoch.\n+ *\n+ * <p>WARNING: This logical type exists solely for interoperability with other type systems such as\n+ * SQL and other Beam SDKs. It should never be used in a native Java context where the {@code\n+ * java.time.Instant} instances it describes may have higher than microsecond precision. Ignoring\n+ * this will likely result in an {@code AssertionError} at pipeline execution time.\n+ *\n+ * <p>For a more faithful logical type to use with {@code java.time.Instant}, see {@link\n+ * NanosInstant}.\n+ */\n+public class MicrosInstant implements Schema.LogicalType<Instant, Row> {\n+  public static final String IDENTIFIER = \"beam:logical_type:micros_instant:v1\";\n+  private final Schema schema;\n+\n+  public MicrosInstant() {\n+    this.schema = Schema.builder().addInt64Field(\"seconds\").addInt32Field(\"micros\").build();\n+  }\n+\n+  @Override\n+  public Row toBaseType(Instant input) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25618a6fc13673dfe80d680a97521c80de5b212e"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxMzQ1MA==", "bodyText": "That's a good question.. I don't think we have an answer for it documented anywhere. I think we should probably handle null checking outside of toBaseType and toInputType, so that we only do it when the type is marked nullable.", "url": "https://github.com/apache/beam/pull/12764#discussion_r483313450", "createdAt": "2020-09-03T23:58:01Z", "author": {"login": "TheNeuralBit"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/schemas/logicaltypes/MicrosInstant.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.schemas.logicaltypes;\n+\n+import java.time.Instant;\n+import org.apache.beam.sdk.schemas.Schema;\n+import org.apache.beam.sdk.values.Row;\n+\n+/**\n+ * A timestamp represented as microseconds since the epoch.\n+ *\n+ * <p>WARNING: This logical type exists solely for interoperability with other type systems such as\n+ * SQL and other Beam SDKs. It should never be used in a native Java context where the {@code\n+ * java.time.Instant} instances it describes may have higher than microsecond precision. Ignoring\n+ * this will likely result in an {@code AssertionError} at pipeline execution time.\n+ *\n+ * <p>For a more faithful logical type to use with {@code java.time.Instant}, see {@link\n+ * NanosInstant}.\n+ */\n+public class MicrosInstant implements Schema.LogicalType<Instant, Row> {\n+  public static final String IDENTIFIER = \"beam:logical_type:micros_instant:v1\";\n+  private final Schema schema;\n+\n+  public MicrosInstant() {\n+    this.schema = Schema.builder().addInt64Field(\"seconds\").addInt32Field(\"micros\").build();\n+  }\n+\n+  @Override\n+  public Row toBaseType(Instant input) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE1NzM5MA=="}, "originalCommit": {"oid": "25618a6fc13673dfe80d680a97521c80de5b212e"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMDkyODc2OnYy", "diffSide": "RIGHT", "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/schemas/logicaltypes/MicrosInstant.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNzo1NzozMVrOHMxndw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQxOTozMTozNVrOHQrTiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE1Nzg3OQ==", "bodyText": "I think this can be a constant. We don't need to initialize it in constructor.", "url": "https://github.com/apache/beam/pull/12764#discussion_r483157879", "createdAt": "2020-09-03T17:57:31Z", "author": {"login": "robinyqiu"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/schemas/logicaltypes/MicrosInstant.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.schemas.logicaltypes;\n+\n+import java.time.Instant;\n+import org.apache.beam.sdk.schemas.Schema;\n+import org.apache.beam.sdk.values.Row;\n+\n+/**\n+ * A timestamp represented as microseconds since the epoch.\n+ *\n+ * <p>WARNING: This logical type exists solely for interoperability with other type systems such as\n+ * SQL and other Beam SDKs. It should never be used in a native Java context where the {@code\n+ * java.time.Instant} instances it describes may have higher than microsecond precision. Ignoring\n+ * this will likely result in an {@code AssertionError} at pipeline execution time.\n+ *\n+ * <p>For a more faithful logical type to use with {@code java.time.Instant}, see {@link\n+ * NanosInstant}.\n+ */\n+public class MicrosInstant implements Schema.LogicalType<Instant, Row> {\n+  public static final String IDENTIFIER = \"beam:logical_type:micros_instant:v1\";\n+  private final Schema schema;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25618a6fc13673dfe80d680a97521c80de5b212e"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjcwOTE2NQ==", "bodyText": "There's an issue with Dataflow deserializing the logical type if the Schema is static, see BEAM-9113. There should probably be a follow-up to fix that though.. I'll file a jira and add a TODO here and in NanosInstant.", "url": "https://github.com/apache/beam/pull/12764#discussion_r486709165", "createdAt": "2020-09-11T00:44:49Z", "author": {"login": "TheNeuralBit"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/schemas/logicaltypes/MicrosInstant.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.schemas.logicaltypes;\n+\n+import java.time.Instant;\n+import org.apache.beam.sdk.schemas.Schema;\n+import org.apache.beam.sdk.values.Row;\n+\n+/**\n+ * A timestamp represented as microseconds since the epoch.\n+ *\n+ * <p>WARNING: This logical type exists solely for interoperability with other type systems such as\n+ * SQL and other Beam SDKs. It should never be used in a native Java context where the {@code\n+ * java.time.Instant} instances it describes may have higher than microsecond precision. Ignoring\n+ * this will likely result in an {@code AssertionError} at pipeline execution time.\n+ *\n+ * <p>For a more faithful logical type to use with {@code java.time.Instant}, see {@link\n+ * NanosInstant}.\n+ */\n+public class MicrosInstant implements Schema.LogicalType<Instant, Row> {\n+  public static final String IDENTIFIER = \"beam:logical_type:micros_instant:v1\";\n+  private final Schema schema;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE1Nzg3OQ=="}, "originalCommit": {"oid": "25618a6fc13673dfe80d680a97521c80de5b212e"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI0ODc3Nw==", "bodyText": "I see. Thanks!", "url": "https://github.com/apache/beam/pull/12764#discussion_r487248777", "createdAt": "2020-09-11T19:31:35Z", "author": {"login": "robinyqiu"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/schemas/logicaltypes/MicrosInstant.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.schemas.logicaltypes;\n+\n+import java.time.Instant;\n+import org.apache.beam.sdk.schemas.Schema;\n+import org.apache.beam.sdk.values.Row;\n+\n+/**\n+ * A timestamp represented as microseconds since the epoch.\n+ *\n+ * <p>WARNING: This logical type exists solely for interoperability with other type systems such as\n+ * SQL and other Beam SDKs. It should never be used in a native Java context where the {@code\n+ * java.time.Instant} instances it describes may have higher than microsecond precision. Ignoring\n+ * this will likely result in an {@code AssertionError} at pipeline execution time.\n+ *\n+ * <p>For a more faithful logical type to use with {@code java.time.Instant}, see {@link\n+ * NanosInstant}.\n+ */\n+public class MicrosInstant implements Schema.LogicalType<Instant, Row> {\n+  public static final String IDENTIFIER = \"beam:logical_type:micros_instant:v1\";\n+  private final Schema schema;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE1Nzg3OQ=="}, "originalCommit": {"oid": "25618a6fc13673dfe80d680a97521c80de5b212e"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMTk4Njk1OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/typehints/schemas.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMDozMTo1NVrOHM7pcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwMDozMTo1NVrOHM7pcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyMjIyNA==", "bodyText": "Since.", "url": "https://github.com/apache/beam/pull/12764#discussion_r483322224", "createdAt": "2020-09-04T00:31:55Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/typehints/schemas.py", "diffHunk": "@@ -279,3 +301,184 @@ def schema_from_element_type(element_type):  # (type) -> schema_pb2.Schema\n def named_fields_from_element_type(\n     element_type):  # (type) -> typing.List[typing.Tuple[unicode, type]]\n   return named_fields_from_schema(schema_from_element_type(element_type))\n+\n+\n+# Registry of typings for a schema by UUID\n+class LogicalTypeRegistry(object):\n+  def __init__(self):\n+    self.by_urn = {}\n+    self.by_logical_type = {}\n+    self.by_language_type = {}\n+\n+  def add(self, urn, logical_type):\n+    self.by_urn[urn] = logical_type\n+    self.by_logical_type[logical_type] = urn\n+    self.by_language_type[logical_type.language_type()] = logical_type\n+\n+  def get_logical_type_by_urn(self, urn):\n+    return self.by_urn.get(urn, None)\n+\n+  def get_urn_by_logial_type(self, logical_type):\n+    return self.by_logical_type.get(logical_type, None)\n+\n+  def get_logical_type_by_language_type(self, representation_type):\n+    return self.by_language_type.get(representation_type, None)\n+\n+\n+LanguageT = TypeVar('LanguageT')\n+RepresentationT = TypeVar('RepresentationT')\n+ArgT = TypeVar('ArgT')\n+\n+\n+class LogicalType(Generic[LanguageT, RepresentationT, ArgT]):\n+  _known_logical_types = LogicalTypeRegistry()\n+\n+  @classmethod\n+  def urn(cls):\n+    # type: () -> unicode\n+\n+    \"\"\"Return the URN used to identify this logical type\"\"\"\n+    raise NotImplementedError()\n+\n+  @classmethod\n+  def language_type(cls):\n+    # type: () -> type\n+\n+    \"\"\"Return the language type this LogicalType encodes.\n+\n+    The returned type should match LanguageT\"\"\"\n+    raise NotImplementedError()\n+\n+  @classmethod\n+  def representation_type(cls):\n+    # type: () -> type\n+\n+    \"\"\"Return the type of the representation this LogicalType uses to encode the\n+    language type.\n+\n+    The returned type should match RepresentationT\"\"\"\n+    raise NotImplementedError()\n+\n+  @classmethod\n+  def argument_type(cls):\n+    # type: () -> type\n+\n+    \"\"\"Return the type of the argument used for variations of this LogicalType.\n+\n+    The returned type should match ArgT\"\"\"\n+    raise NotImplementedError(cls)\n+\n+  def argument(self):\n+    # type: () -> ArgT\n+\n+    \"\"\"Return the argument for this instance of the LogicalType.\"\"\"\n+    raise NotImplementedError()\n+\n+  def to_representation_type(value):\n+    # type: (LanguageT) -> RepresentationT\n+\n+    \"\"\"Convert an instance of LanguageT to RepresentationT.\"\"\"\n+    raise NotImplementedError()\n+\n+  def to_language_type(value):\n+    # type: (RepresentationT) -> LanguageT\n+\n+    \"\"\"Convert an instance of RepresentationT to LanguageT.\"\"\"\n+    raise NotImplementedError()\n+\n+  @classmethod\n+  def register_logical_type(cls, logical_type_cls):\n+    \"\"\"Register an implementation of LogicalType.\"\"\"\n+    cls._known_logical_types.add(logical_type_cls.urn(), logical_type_cls)\n+\n+  @classmethod\n+  def from_typing(cls, typ):\n+    # type: (type) -> LogicalType\n+\n+    \"\"\"Construct an instance of a registered LogicalType implementation given a\n+    typing.\n+\n+    Raises ValueError if no registered LogicalType implementation can encode the\n+    given typing.\"\"\"\n+\n+    logical_type = cls._known_logical_types.get_logical_type_by_language_type(\n+        typ)\n+    if logical_type is None:\n+      raise ValueError(\"No logical type registered for typing '%s'\" % typ)\n+\n+    return logical_type._from_typing(typ)\n+\n+  @classmethod\n+  def _from_typing(cls, typ):\n+    # type: (type) -> LogicalType\n+\n+    \"\"\"Construct an instance of this LogicalType implementation given a typing.\n+    \"\"\"\n+    raise NotImplementedError()\n+\n+  @classmethod\n+  def from_runner_api(cls, logical_type_proto):\n+    # type: (schema_pb2.LogicalType) -> LogicalType\n+\n+    \"\"\"Construct an instance of a registered LogicalType implementation given a\n+    proto LogicalType.\n+\n+    Raises ValueError if no LogicalType registered for the given URN.\n+    \"\"\"\n+    logical_type = cls._known_logical_types.get_logical_type_by_urn(\n+        logical_type_proto.urn)\n+    if logical_type is None:\n+      raise ValueError(\n+          \"No logical type registered for URN '%s'\" % logical_type_proto.urn)\n+    # TODO(bhulette): Use argument\n+    return logical_type()\n+\n+\n+class NoArgumentLogicalType(LogicalType[LanguageT, RepresentationT, None]):\n+  @classmethod\n+  def argument_type(cls):\n+    # type: () -> type\n+    return None\n+\n+  def argument(self):\n+    # type: () -> ArgT\n+    return None\n+\n+  @classmethod\n+  def _from_typing(cls, typ):\n+    # type: (type) -> LogicalType\n+\n+    # Sicne there's no argument, there can be no additional information encoded", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25618a6fc13673dfe80d680a97521c80de5b212e"}, "originalPosition": 216}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 454, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}