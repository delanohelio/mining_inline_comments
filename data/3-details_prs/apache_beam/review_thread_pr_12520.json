{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NzY2NTM3", "number": 12520, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMjo0MDozNFrOEW_QEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMjo0MDozNFrOEW_QEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkyNTQwNDMyOnYy", "diffSide": "RIGHT", "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/schemas/utils/AutoValueUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMjo0MDozNFrOG-iMGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQwMTowOTowOFrOG-k4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIyNTA0OA==", "bodyText": "I'm not quite sure what the old logic was trying to verify. Now this verifies that every constructor parameter corresponds to a schema field.", "url": "https://github.com/apache/beam/pull/12520#discussion_r468225048", "createdAt": "2020-08-10T22:40:34Z", "author": {"login": "TheNeuralBit"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/schemas/utils/AutoValueUtils.java", "diffHunk": "@@ -139,11 +139,15 @@ private static boolean matchConstructor(\n                 Collectors.toMap(\n                     f -> ReflectUtils.stripGetterPrefix(f.getMethod().getName()),\n                     Function.identity()));\n-    for (FieldValueTypeInformation type : getterTypes) {\n-      if (typeMap.get(type.getName()) == null) {\n+\n+    // Verify that constructor parameters match (name and type) the inferred schema.\n+    for (Parameter parameter : constructor.getParameters()) {\n+      FieldValueTypeInformation type = typeMap.getOrDefault(parameter.getName(), null);\n+      if (type == null || type.getRawType() != parameter.getType()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "690f0643ee58d35d572e56069ec230f7db085d90"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2OTExMg==", "bodyText": "I believe the getterTypes is the list of schema name, where typeMap is the attribute name from AutoValue class. It's trying to verify whether the schema matches the AutoValue class since it wants to get a constructor.", "url": "https://github.com/apache/beam/pull/12520#discussion_r468269112", "createdAt": "2020-08-11T01:09:08Z", "author": {"login": "boyuanzz"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/schemas/utils/AutoValueUtils.java", "diffHunk": "@@ -139,11 +139,15 @@ private static boolean matchConstructor(\n                 Collectors.toMap(\n                     f -> ReflectUtils.stripGetterPrefix(f.getMethod().getName()),\n                     Function.identity()));\n-    for (FieldValueTypeInformation type : getterTypes) {\n-      if (typeMap.get(type.getName()) == null) {\n+\n+    // Verify that constructor parameters match (name and type) the inferred schema.\n+    for (Parameter parameter : constructor.getParameters()) {\n+      FieldValueTypeInformation type = typeMap.getOrDefault(parameter.getName(), null);\n+      if (type == null || type.getRawType() != parameter.getType()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIyNTA0OA=="}, "originalCommit": {"oid": "690f0643ee58d35d572e56069ec230f7db085d90"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 624, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}