{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NTM5MTI4", "number": 11652, "title": "[BEAM-9945] Report data channel progress via a designated counter.", "bodyText": "This turned out to make things a lot cleaner IMHO than depending on the (more distant) output PCollection element counts. Also the index here is now the same space as that used for splitting.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-05-09T08:27:34Z", "url": "https://github.com/apache/beam/pull/11652", "merged": true, "mergeCommit": {"oid": "d8e861627e05515c2c064235751c47f8beb91c78"}, "closed": true, "closedAt": "2020-05-12T15:10:18Z", "author": {"login": "robertwb"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfkD3EAH2gAyNDE1NTM5MTI4OjRlZTAzYmNhNGYzNmU4ZTQwMDU1ZDc2NTFkOGNiM2U1NDYxYmM4ZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgY7BhgH2gAyNDE1NTM5MTI4OmQ4NjQ4YTlkOWVjMDBkZWRiZmNjNTBiOWIyYjM1YTY2MzQyOWQ3NzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4ee03bca4f36e8e40055d7651d8cb3e5461bc8eb", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/4ee03bca4f36e8e40055d7651d8cb3e5461bc8eb", "committedDate": "2020-05-09T10:38:32Z", "message": "[BEAM-9945] Report data channel progress via a designated counter."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd2bb9aadc1f58f4623b5686c0632bccdc4aaf72", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/fd2bb9aadc1f58f4623b5686c0632bccdc4aaf72", "committedDate": "2020-05-09T08:22:22Z", "message": "[BEAM-9945] Report data channel progress via a designated counter."}, "afterCommit": {"oid": "4ee03bca4f36e8e40055d7651d8cb3e5461bc8eb", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/4ee03bca4f36e8e40055d7651d8cb3e5461bc8eb", "committedDate": "2020-05-09T10:38:32Z", "message": "[BEAM-9945] Report data channel progress via a designated counter."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5Mzg5OTgz", "url": "https://github.com/apache/beam/pull/11652#pullrequestreview-409389983", "createdAt": "2020-05-11T17:42:38Z", "commit": {"oid": "4ee03bca4f36e8e40055d7651d8cb3e5461bc8eb"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzo0MjozOFrOGTmrSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzo1MjoyMlrOGTnATA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIwOTgwMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // For an SDK that processe items sequentially, this is equivalently the\n          \n          \n            \n                // For an SDK that processes items sequentially, this is equivalently the", "url": "https://github.com/apache/beam/pull/11652#discussion_r423209801", "createdAt": "2020-05-11T17:42:38Z", "author": {"login": "lukecwik"}, "path": "model/pipeline/src/main/proto/metrics.proto", "diffHunk": "@@ -292,6 +292,21 @@ message MonitoringInfoSpecs {\n         value: \"The remaining amount of work for each active element. Each active element represents an independent amount of work not shared with any other active element.\"\n       }]\n     }];\n+\n+    // The (0-based) index of the latest item processed from the data channel.\n+    // This gives an indication of the SDKs progress through the data channel,\n+    // and is a lower bound on where it is able to split.\n+    // For an SDK that processe items sequentially, this is equivalently the", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ee03bca4f36e8e40055d7651d8cb3e5461bc8eb"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIxMjI4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // number of items fully processed (or -1 if reading has not yet started).\n          \n          \n            \n                // number of items fully processed (or -1 if processing has not yet started).", "url": "https://github.com/apache/beam/pull/11652#discussion_r423212282", "createdAt": "2020-05-11T17:47:09Z", "author": {"login": "lukecwik"}, "path": "model/pipeline/src/main/proto/metrics.proto", "diffHunk": "@@ -292,6 +292,21 @@ message MonitoringInfoSpecs {\n         value: \"The remaining amount of work for each active element. Each active element represents an independent amount of work not shared with any other active element.\"\n       }]\n     }];\n+\n+    // The (0-based) index of the latest item processed from the data channel.\n+    // This gives an indication of the SDKs progress through the data channel,\n+    // and is a lower bound on where it is able to split.\n+    // For an SDK that processe items sequentially, this is equivalently the\n+    // number of items fully processed (or -1 if reading has not yet started).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ee03bca4f36e8e40055d7651d8cb3e5461bc8eb"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIxNTAyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    value: \"The number of items processed from a data channel.\"\n          \n          \n            \n                    value: \"The read index of the data channel.\"", "url": "https://github.com/apache/beam/pull/11652#discussion_r423215022", "createdAt": "2020-05-11T17:52:05Z", "author": {"login": "lukecwik"}, "path": "model/pipeline/src/main/proto/metrics.proto", "diffHunk": "@@ -292,6 +292,21 @@ message MonitoringInfoSpecs {\n         value: \"The remaining amount of work for each active element. Each active element represents an independent amount of work not shared with any other active element.\"\n       }]\n     }];\n+\n+    // The (0-based) index of the latest item processed from the data channel.\n+    // This gives an indication of the SDKs progress through the data channel,\n+    // and is a lower bound on where it is able to split.\n+    // For an SDK that processe items sequentially, this is equivalently the\n+    // number of items fully processed (or -1 if reading has not yet started).\n+    DATA_CHANNEL_READ_INDEX = 18 [(monitoring_info_spec) = {\n+      urn: \"beam:metric:data_channel:read_index:v1\",\n+      type: \"beam:metrics:sum_int64:v1\",\n+      required_labels: [ \"PTRANSFORM\" ],\n+      annotations: [{\n+        key: \"description\",\n+        value: \"The number of items processed from a data channel.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ee03bca4f36e8e40055d7651d8cb3e5461bc8eb"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzIxNTE4MA==", "bodyText": "spacing", "url": "https://github.com/apache/beam/pull/11652#discussion_r423215180", "createdAt": "2020-05-11T17:52:22Z", "author": {"login": "lukecwik"}, "path": "sdks/go/pkg/beam/core/runtime/harness/monitoring.go", "diffHunk": "@@ -265,8 +269,9 @@ func monitoring(p *exec.Plan) ([]*pipepb.MonitoringInfo, map[string][]byte) {\n \t\tif err != nil {\n \t\t\tpanic(err)\n \t\t}\n-\t\tpayloads[getShortID(metrics.PCollectionLabels(snapshot.PID), urnElementCount)] = payload\n \n+    // TODO(BEAM-9934): This metric should account for elements in multiple windows.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ee03bca4f36e8e40055d7651d8cb3e5461bc8eb"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fbb79f9935f2b9488888e1a4ba193d0d3e5af93", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/2fbb79f9935f2b9488888e1a4ba193d0d3e5af93", "committedDate": "2020-05-11T18:51:07Z", "message": "Apply suggestions from code review\n\nCo-authored-by: Lukasz Cwik <lcwik@google.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NTA5MDY5", "url": "https://github.com/apache/beam/pull/11652#pullrequestreview-409509069", "createdAt": "2020-05-11T20:33:53Z", "commit": {"oid": "2fbb79f9935f2b9488888e1a4ba193d0d3e5af93"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMDozMzo1M1rOGTsVrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQyMDozMzo1M1rOGTsVrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMwMjU3NQ==", "bodyText": "Looks like you are missing spec here.", "url": "https://github.com/apache/beam/pull/11652#discussion_r423302575", "createdAt": "2020-05-11T20:33:53Z", "author": {"login": "ibzib"}, "path": "sdks/python/apache_beam/metrics/monitoring_infos.py", "diffHunk": "@@ -56,6 +56,8 @@\n     [USER_COUNTER_URN, USER_DISTRIBUTION_URN, USER_GAUGE_URN])\n WORK_REMAINING_URN = common_urns.monitoring_info_specs.WORK_REMAINING.spec.urn\n WORK_COMPLETED_URN = common_urns.monitoring_info_specs.WORK_COMPLETED.spec.urn\n+DATA_CHANNEL_READ_INDEX = (\n+    common_urns.monitoring_info_specs.DATA_CHANNEL_READ_INDEX.urn)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fbb79f9935f2b9488888e1a4ba193d0d3e5af93"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ba1754a409e1f6d0cee34a9667d0e8d2fc31cc9", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/4ba1754a409e1f6d0cee34a9667d0e8d2fc31cc9", "committedDate": "2020-05-11T20:54:06Z", "message": "Fix tabs, spec.urn."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8648a9d9ec00dedbfcc50b9b2b35a663429d772", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/d8648a9d9ec00dedbfcc50b9b2b35a663429d772", "committedDate": "2020-05-12T00:13:51Z", "message": "Merge branch 'master' into progress-counters"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4919, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}