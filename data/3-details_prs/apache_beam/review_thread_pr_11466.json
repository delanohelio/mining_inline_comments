{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2MjM5ODU3", "number": 11466, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxOToxNzozOFrODz4fFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxOToxOTozMFrODz4iBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NzI5NDI4OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxOToxNzozOFrOGIjwVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxOToyNzoxN1rOGIkGYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYyNzYwNQ==", "bodyText": "s/Unified Worker/Dataflow runner V2 I believe.\ncc: @robertwb @ananvay for the correct wording here.", "url": "https://github.com/apache/beam/pull/11466#discussion_r411627605", "createdAt": "2020-04-20T19:17:38Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -91,6 +91,12 @@\n _LOGGER = logging.getLogger(__name__)\n \n \n+BQ_SOURCE_UW_ERROR = (\n+    'The Read(BigQuerySource(...)) transform is not supported with newer stack '\n+    'features (Fn API, Unified Worker, etc). Please use the transform '", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f5f622e3f343c1c187f5d298b91aee408b3a91c"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYzMzAxNA==", "bodyText": "+1 -- \"Dataflow Runner v2\"", "url": "https://github.com/apache/beam/pull/11466#discussion_r411633014", "createdAt": "2020-04-20T19:26:52Z", "author": {"login": "ananvay"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -91,6 +91,12 @@\n _LOGGER = logging.getLogger(__name__)\n \n \n+BQ_SOURCE_UW_ERROR = (\n+    'The Read(BigQuerySource(...)) transform is not supported with newer stack '\n+    'features (Fn API, Unified Worker, etc). Please use the transform '", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYyNzYwNQ=="}, "originalCommit": {"oid": "5f5f622e3f343c1c187f5d298b91aee408b3a91c"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYzMzI0OQ==", "bodyText": "Done. Waiting for their pointers on wording.", "url": "https://github.com/apache/beam/pull/11466#discussion_r411633249", "createdAt": "2020-04-20T19:27:17Z", "author": {"login": "pabloem"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -91,6 +91,12 @@\n _LOGGER = logging.getLogger(__name__)\n \n \n+BQ_SOURCE_UW_ERROR = (\n+    'The Read(BigQuerySource(...)) transform is not supported with newer stack '\n+    'features (Fn API, Unified Worker, etc). Please use the transform '", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYyNzYwNQ=="}, "originalCommit": {"oid": "5f5f622e3f343c1c187f5d298b91aee408b3a91c"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NzI5ODM2OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "isResolved": false, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxOToxODozMlrOGIjyng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMzo0MDowNlrOGIsJcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYyODE5MA==", "bodyText": "Should we also check for experiment use_runner_v2 or is this adequate ?", "url": "https://github.com/apache/beam/pull/11466#discussion_r411628190", "createdAt": "2020-04-20T19:18:32Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -1182,6 +1188,11 @@ def run_Read(self, transform_node, options):\n         raise ValueError(\n             'BigQuery source is not currently available for use '\n             'in streaming pipelines.')\n+      debug_options = options.view_as(DebugOptions)\n+      use_fn_api = (debug_options.experiments and\n+                    'beam_fn_api' in debug_options.experiments)\n+      if use_fn_api:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f5f622e3f343c1c187f5d298b91aee408b3a91c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYzMzQ3NQ==", "bodyText": "Might make sense to, perhaps even only check use_runner_v2, since that's the top-level option we're expecting users to provide (and then we internally add beam_fn_api).", "url": "https://github.com/apache/beam/pull/11466#discussion_r411633475", "createdAt": "2020-04-20T19:27:42Z", "author": {"login": "ananvay"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -1182,6 +1188,11 @@ def run_Read(self, transform_node, options):\n         raise ValueError(\n             'BigQuery source is not currently available for use '\n             'in streaming pipelines.')\n+      debug_options = options.view_as(DebugOptions)\n+      use_fn_api = (debug_options.experiments and\n+                    'beam_fn_api' in debug_options.experiments)\n+      if use_fn_api:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYyODE5MA=="}, "originalCommit": {"oid": "5f5f622e3f343c1c187f5d298b91aee408b3a91c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYzMzY1MA==", "bodyText": "This is enough. For beam_fn_api is added along with use_runner_v2.", "url": "https://github.com/apache/beam/pull/11466#discussion_r411633650", "createdAt": "2020-04-20T19:27:57Z", "author": {"login": "pabloem"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -1182,6 +1188,11 @@ def run_Read(self, transform_node, options):\n         raise ValueError(\n             'BigQuery source is not currently available for use '\n             'in streaming pipelines.')\n+      debug_options = options.view_as(DebugOptions)\n+      use_fn_api = (debug_options.experiments and\n+                    'beam_fn_api' in debug_options.experiments)\n+      if use_fn_api:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYyODE5MA=="}, "originalCommit": {"oid": "5f5f622e3f343c1c187f5d298b91aee408b3a91c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYzODQ1Nw==", "bodyText": "oops Harsh , I did not see your message. ^^'\nBut the source is not supported on FnApi either, though, right? so that would also help users trying Batch FnApi jobs?", "url": "https://github.com/apache/beam/pull/11466#discussion_r411638457", "createdAt": "2020-04-20T19:36:10Z", "author": {"login": "pabloem"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -1182,6 +1188,11 @@ def run_Read(self, transform_node, options):\n         raise ValueError(\n             'BigQuery source is not currently available for use '\n             'in streaming pipelines.')\n+      debug_options = options.view_as(DebugOptions)\n+      use_fn_api = (debug_options.experiments and\n+                    'beam_fn_api' in debug_options.experiments)\n+      if use_fn_api:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYyODE5MA=="}, "originalCommit": {"oid": "5f5f622e3f343c1c187f5d298b91aee408b3a91c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY0NTc1NQ==", "bodyText": "In general, yes, but the only support way of batch fnapi is with UW -- they shouldn't be trying fnapi batch jobs without it. That said, perhaps it makes sense to check both separately (just to ensure that the --use_runner_v2 also independently triggers this check, just in case someone in the future decides to accidentally modify something)?", "url": "https://github.com/apache/beam/pull/11466#discussion_r411645755", "createdAt": "2020-04-20T19:48:17Z", "author": {"login": "ananvay"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -1182,6 +1188,11 @@ def run_Read(self, transform_node, options):\n         raise ValueError(\n             'BigQuery source is not currently available for use '\n             'in streaming pipelines.')\n+      debug_options = options.view_as(DebugOptions)\n+      use_fn_api = (debug_options.experiments and\n+                    'beam_fn_api' in debug_options.experiments)\n+      if use_fn_api:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYyODE5MA=="}, "originalCommit": {"oid": "5f5f622e3f343c1c187f5d298b91aee408b3a91c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY0Nzk1Ng==", "bodyText": "The unit test that I've added checks both of them separately, so if either of them changes, the unit test will fail. WDYT about that?", "url": "https://github.com/apache/beam/pull/11466#discussion_r411647956", "createdAt": "2020-04-20T19:52:01Z", "author": {"login": "pabloem"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -1182,6 +1188,11 @@ def run_Read(self, transform_node, options):\n         raise ValueError(\n             'BigQuery source is not currently available for use '\n             'in streaming pipelines.')\n+      debug_options = options.view_as(DebugOptions)\n+      use_fn_api = (debug_options.experiments and\n+                    'beam_fn_api' in debug_options.experiments)\n+      if use_fn_api:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYyODE5MA=="}, "originalCommit": {"oid": "5f5f622e3f343c1c187f5d298b91aee408b3a91c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY0OTQxNw==", "bodyText": "Yes, that sounds great, thanks!", "url": "https://github.com/apache/beam/pull/11466#discussion_r411649417", "createdAt": "2020-04-20T19:54:31Z", "author": {"login": "ananvay"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -1182,6 +1188,11 @@ def run_Read(self, transform_node, options):\n         raise ValueError(\n             'BigQuery source is not currently available for use '\n             'in streaming pipelines.')\n+      debug_options = options.view_as(DebugOptions)\n+      use_fn_api = (debug_options.experiments and\n+                    'beam_fn_api' in debug_options.experiments)\n+      if use_fn_api:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYyODE5MA=="}, "originalCommit": {"oid": "5f5f622e3f343c1c187f5d298b91aee408b3a91c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc2MjM5Mw==", "bodyText": "One thing I want to ensure (since I'm not completely familiar with the error semantics of the functions in Python), is that this error will stop the pipeline from being submitted, and essentially be the equivalent of a C++ CheckFail? We want this error to stop everything, otherwise users might miss this.", "url": "https://github.com/apache/beam/pull/11466#discussion_r411762393", "createdAt": "2020-04-20T23:32:43Z", "author": {"login": "ananvay"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -1182,6 +1188,11 @@ def run_Read(self, transform_node, options):\n         raise ValueError(\n             'BigQuery source is not currently available for use '\n             'in streaming pipelines.')\n+      debug_options = options.view_as(DebugOptions)\n+      use_fn_api = (debug_options.experiments and\n+                    'beam_fn_api' in debug_options.experiments)\n+      if use_fn_api:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYyODE5MA=="}, "originalCommit": {"oid": "5f5f622e3f343c1c187f5d298b91aee408b3a91c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc2NTEwNw==", "bodyText": "Yes Harsh, this will stop the pipeline from being submitted, and fail the command. The unit test also goes through this flow (trying to submit to Dataflow, and having the pipeline throw an error, and not be submitted).", "url": "https://github.com/apache/beam/pull/11466#discussion_r411765107", "createdAt": "2020-04-20T23:40:06Z", "author": {"login": "pabloem"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -1182,6 +1188,11 @@ def run_Read(self, transform_node, options):\n         raise ValueError(\n             'BigQuery source is not currently available for use '\n             'in streaming pipelines.')\n+      debug_options = options.view_as(DebugOptions)\n+      use_fn_api = (debug_options.experiments and\n+                    'beam_fn_api' in debug_options.experiments)\n+      if use_fn_api:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYyODE5MA=="}, "originalCommit": {"oid": "5f5f622e3f343c1c187f5d298b91aee408b3a91c"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NzMwMTgwOnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner_test.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxOToxOTozMFrOGIj0vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxOToyODowMlrOGIkIKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYyODczNQ==", "bodyText": "fnapi_fail (to be consistent with the above check).", "url": "https://github.com/apache/beam/pull/11466#discussion_r411628735", "createdAt": "2020-04-20T19:19:30Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner_test.py", "diffHunk": "@@ -258,6 +259,18 @@ def test_biqquery_read_streaming_fail(self):\n                     PipelineOptions(self.default_properties)) as p:\n         _ = p | beam.io.Read(beam.io.BigQuerySource('some.table'))\n \n+  def test_biqquery_read_uw_fail(self):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f5f622e3f343c1c187f5d298b91aee408b3a91c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYzMzcwNw==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/11466#discussion_r411633707", "createdAt": "2020-04-20T19:28:02Z", "author": {"login": "pabloem"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner_test.py", "diffHunk": "@@ -258,6 +259,18 @@ def test_biqquery_read_streaming_fail(self):\n                     PipelineOptions(self.default_properties)) as p:\n         _ = p | beam.io.Read(beam.io.BigQuerySource('some.table'))\n \n+  def test_biqquery_read_uw_fail(self):", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTYyODczNQ=="}, "originalCommit": {"oid": "5f5f622e3f343c1c187f5d298b91aee408b3a91c"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1324, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}