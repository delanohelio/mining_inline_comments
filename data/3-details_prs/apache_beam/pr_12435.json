{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwMjQ3NzQx", "number": 12435, "title": "[BEAM-10616] Added Python Pardo load tests for streaming on Dataflow", "bodyText": "Added streaming tests cases for load tests for Python SDK. It required to parametrise tests and add condition to set specific source for Dataflow tests (Flink uses StatefulLoadGenerator and Dataflow SyntheticSources).\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-07-31T15:26:58Z", "url": "https://github.com/apache/beam/pull/12435", "merged": true, "mergeCommit": {"oid": "bb37b1a1e55f1a34264ed2f6436bea6923983474"}, "closed": true, "closedAt": "2020-09-11T10:43:24Z", "author": {"login": "kkucharc"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc78AiHABqjM2MjQ5MTgzMDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHN5x_gBqjM3NDY0NTM0MTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "73abd042d5536a73c7f3db00d64e6ed145b8e719", "author": {"user": {"login": "kkucharc", "name": "Kasia Kucharczyk"}}, "url": "https://github.com/apache/beam/commit/73abd042d5536a73c7f3db00d64e6ed145b8e719", "committedDate": "2020-08-03T11:29:37Z", "message": "[BEAM-9896] Streaming parameter is null or not appearing in gradle command in python"}, "afterCommit": {"oid": "7f811d9f80dc08c27763023d9c1904a977639689", "author": {"user": {"login": "kkucharc", "name": "Kasia Kucharczyk"}}, "url": "https://github.com/apache/beam/commit/7f811d9f80dc08c27763023d9c1904a977639689", "committedDate": "2020-08-05T14:21:51Z", "message": "[BEAM-10616] Skipped test case with 200 iteration due to timeout"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyODI0OTM1", "url": "https://github.com/apache/beam/pull/12435#pullrequestreview-462824935", "createdAt": "2020-08-06T19:44:49Z", "commit": {"oid": "7f811d9f80dc08c27763023d9c1904a977639689"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOTo0NDo0OVrOG9Bz-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxOTo1NToyOFrOG9CJvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY0NjAxMA==", "bodyText": "Are you planning to investigate this now, soon, or in the future? If it isn't something you'll be looking into immediately and there is some additional context related to the timeouts that you've found while testing it would be helpful to create a Jira issue and link it here instead of a TODO for yourself.", "url": "https://github.com/apache/beam/pull/12435#discussion_r466646010", "createdAt": "2020-08-06T19:44:49Z", "author": {"login": "tysonjh"}, "path": ".test-infra/jenkins/job_LoadTests_ParDo_Python.groovy", "diffHunk": "@@ -151,3 +151,35 @@ CronJobBuilder.cronJob('beam_LoadTests_Python_ParDo_Dataflow_Batch', 'H 13 * * *\n   ]\n   batchLoadTestJob(delegate, CommonTestProperties.TriggeringContext.POST_COMMIT)\n }\n+\n+def streamingLoadTestJob = { scope, triggeringContext ->\n+  scope.description('Runs Python ParDo load tests on Dataflow runner in streaming mode')\n+  commonJobProperties.setTopLevelMainJobProperties(scope, 'master', 120)\n+\n+  def datasetName = loadTestsBuilder.getBigQueryDataset('load_test', triggeringContext)\n+  for (testConfiguration in loadTestConfigurations(\"streaming\", datasetName)) {\n+    // Skipping case 2 in streaming because it timeouts. To be checked TODO: kkucharc", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f811d9f80dc08c27763023d9c1904a977639689"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY0ODQxNg==", "bodyText": "This should be a property in the testConfiguration instead of relying on title implicitly? That would also eliminate adding a 'streaming' property below as well.\nIn fact, doing this may also allow refactoring 'batchLoadTestJob' to a more generic 'loadTestJob' for reuse in both Streaming/Batch cases. It may unnecessarily complicate things, I'll leave it up to your judgement.", "url": "https://github.com/apache/beam/pull/12435#discussion_r466648416", "createdAt": "2020-08-06T19:49:20Z", "author": {"login": "tysonjh"}, "path": ".test-infra/jenkins/job_LoadTests_ParDo_Python.groovy", "diffHunk": "@@ -151,3 +151,35 @@ CronJobBuilder.cronJob('beam_LoadTests_Python_ParDo_Dataflow_Batch', 'H 13 * * *\n   ]\n   batchLoadTestJob(delegate, CommonTestProperties.TriggeringContext.POST_COMMIT)\n }\n+\n+def streamingLoadTestJob = { scope, triggeringContext ->\n+  scope.description('Runs Python ParDo load tests on Dataflow runner in streaming mode')\n+  commonJobProperties.setTopLevelMainJobProperties(scope, 'master', 120)\n+\n+  def datasetName = loadTestsBuilder.getBigQueryDataset('load_test', triggeringContext)\n+  for (testConfiguration in loadTestConfigurations(\"streaming\", datasetName)) {\n+    // Skipping case 2 in streaming because it timeouts. To be checked TODO: kkucharc\n+    if(testConfiguration.title != \"ParDo Python Load test: 2GB 100 byte records 200 times\") {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f811d9f80dc08c27763023d9c1904a977639689"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY1MTU4Mg==", "bodyText": "Why only for the PortableRunner now?", "url": "https://github.com/apache/beam/pull/12435#discussion_r466651582", "createdAt": "2020-08-06T19:55:28Z", "author": {"login": "tysonjh"}, "path": "sdks/python/apache_beam/testing/load_tests/pardo_test.py", "diffHunk": "@@ -125,7 +125,9 @@ def process(self, element, state=state_param):\n             state.add(1)\n         yield element\n \n-    if self.get_option_or_default('streaming', False):\n+    if self.get_option_or_default(\n+        'streaming',\n+        False) and self.pipeline.get_option('runner') == \"PortableRunner\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f811d9f80dc08c27763023d9c1904a977639689"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "052fb1469865cefa26ba477af525f0e688d82ec0", "author": {"user": {"login": "kkucharc", "name": "Kasia Kucharczyk"}}, "url": "https://github.com/apache/beam/commit/052fb1469865cefa26ba477af525f0e688d82ec0", "committedDate": "2020-08-21T14:42:23Z", "message": "[BEAM-10616] Refactored batch ans streaming jenkins pardo python test method"}, "afterCommit": {"oid": "95293c88d7dfb8032649d26fcc90db93a11fa807", "author": {"user": {"login": "kkucharc", "name": "Kasia Kucharczyk"}}, "url": "https://github.com/apache/beam/commit/95293c88d7dfb8032649d26fcc90db93a11fa807", "committedDate": "2020-08-21T15:59:20Z", "message": "[BEAM-10616] fixed jenkins job"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "45a84e877d2833d7f2a341f479ce327cb90f1ab1", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/45a84e877d2833d7f2a341f479ce327cb90f1ab1", "committedDate": "2020-08-31T10:04:09Z", "message": "fix: add --use_stateful_load_generator switch"}, "afterCommit": {"oid": "84b655955925960d063c82a7b3e44fec7832a160", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/84b655955925960d063c82a7b3e44fec7832a160", "committedDate": "2020-08-31T15:06:27Z", "message": "fix: add --use_stateful_load_generator switch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "84b655955925960d063c82a7b3e44fec7832a160", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/84b655955925960d063c82a7b3e44fec7832a160", "committedDate": "2020-08-31T15:06:27Z", "message": "fix: add --use_stateful_load_generator switch"}, "afterCommit": {"oid": "72ae35a7bf70deb2e17cbfef89c73fe2fd715dec", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/72ae35a7bf70deb2e17cbfef89c73fe2fd715dec", "committedDate": "2020-09-08T14:48:34Z", "message": "fix: add --use_stateful_load_generator switch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MjUxMTg1", "url": "https://github.com/apache/beam/pull/12435#pullrequestreview-484251185", "createdAt": "2020-09-08T15:21:51Z", "commit": {"oid": "738143e48c98169d0f9330e3f731e0a59cd562f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5da78c1dcc31daae613524a6372c2b59c13b2ae", "author": {"user": {"login": "kkucharc", "name": "Kasia Kucharczyk"}}, "url": "https://github.com/apache/beam/commit/a5da78c1dcc31daae613524a6372c2b59c13b2ae", "committedDate": "2020-09-09T15:24:07Z", "message": "[BEAM-10616] Added Python Pardo load tests for streaming on Dataflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50926977a931249a806e21508438ce09f178654d", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/50926977a931249a806e21508438ce09f178654d", "committedDate": "2020-09-09T15:26:23Z", "message": "fix: use Dataflow Runner V2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "738143e48c98169d0f9330e3f731e0a59cd562f2", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/738143e48c98169d0f9330e3f731e0a59cd562f2", "committedDate": "2020-09-08T14:57:51Z", "message": "fix: fix variable name"}, "afterCommit": {"oid": "50926977a931249a806e21508438ce09f178654d", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/50926977a931249a806e21508438ce09f178654d", "committedDate": "2020-09-09T15:26:23Z", "message": "fix: use Dataflow Runner V2"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3650, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}