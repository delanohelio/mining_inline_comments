{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3MDkzMDQ5", "number": 12562, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwMToxMzozN1rOEleh5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwMToxMzozN1rOEleh5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3NzMyOTY1OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/utils/profiler.py", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwMToxMzozN1rOHU-ltg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQwMToxMzozN1rOHU-ltg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTc1OTAzMA==", "bodyText": "Let's log the import failure", "url": "https://github.com/apache/beam/pull/12562#discussion_r491759030", "createdAt": "2020-09-21T01:13:37Z", "author": {"login": "angoenka"}, "path": "sdks/python/apache_beam/utils/profiler.py", "diffHunk": "@@ -44,59 +42,91 @@\n \n \n class Profile(object):\n-  \"\"\"cProfile wrapper context for saving and logging profiler results.\"\"\"\n+  \"\"\"cProfile and Heapy wrapper context for saving and logging profiler\n+  results.\"\"\"\n \n   SORTBY = 'cumulative'\n \n   def __init__(\n       self,\n-      profile_id,\n-      profile_location=None,\n-      log_results=False,\n-      file_copy_fn=None,\n-      time_prefix='%Y-%m-%d_%H_%M_%S-'):\n+      profile_id, # type: str\n+      profile_location=None, # type: Optional[str]\n+      log_results=False, # type: bool\n+      file_copy_fn=None, # type: Optional[Callable[[str, str], None]]\n+      time_prefix='%Y-%m-%d_%H_%M_%S-', # type: str\n+      enable_cpu_profiling=False, # type: bool\n+      enable_memory_profiling=False, # type: bool\n+  ):\n+    \"\"\"Creates a Profile object.\n+\n+    Args:\n+      profile_id: Unique id of the profiling session.\n+      profile_location: The file location where the profiling results will be\n+        stored.\n+      log_results: Log the result to console if true.\n+      file_copy_fn: Lambda function for copying files.\n+      time_prefix: Format of the timestamp prefix in profiling result files.\n+      enable_cpu_profiling: CPU profiler will be enabled during the profiling\n+        session.\n+      enable_memory_profiling: Memory profiler will be enabled during the\n+        profiling session, the profiler only records the newly allocated objects\n+        in this session.\n+    \"\"\"\n     self.stats = None\n     self.profile_id = str(profile_id)\n     self.profile_location = profile_location\n     self.log_results = log_results\n     self.file_copy_fn = file_copy_fn or self.default_file_copy_fn\n     self.time_prefix = time_prefix\n     self.profile_output = None\n+    self.enable_cpu_profiling = enable_cpu_profiling\n+    self.enable_memory_profiling = enable_memory_profiling\n \n   def __enter__(self):\n     _LOGGER.info('Start profiling: %s', self.profile_id)\n-    self.profile = cProfile.Profile()\n-    self.profile.enable()\n+    if self.enable_cpu_profiling:\n+      self.profile = cProfile.Profile()\n+      self.profile.enable()\n+    if self.enable_memory_profiling:\n+      try:\n+        from guppy import hpy\n+        self.hpy = hpy()\n+        self.hpy.setrelheap()\n+      except ImportError:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4feb867825307f236ce8da23d9486a0efa936c8"}, "originalPosition": 81}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 673, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}