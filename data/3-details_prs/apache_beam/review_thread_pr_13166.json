{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MTYzMjYy", "number": 13166, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNTozOTo0NVrOEw09yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxNzozMjozNlrOE06ReA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjM0ODg4OnYy", "diffSide": "RIGHT", "path": "sdks/java/io/hadoop-format/src/main/java/org/apache/beam/sdk/io/hadoop/format/HadoopFormatIO.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNTozOTo0NVrOHmoAyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzoyNjowM1rOHqbrVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2MzQ5Nw==", "bodyText": "You need to clear the keyCoder/valueCoder in the non coder based variants otherwise we won't honor the typedescriptor when the user changes the translation function", "url": "https://github.com/apache/beam/pull/13166#discussion_r510263497", "createdAt": "2020-10-22T15:39:45Z", "author": {"login": "lukecwik"}, "path": "sdks/java/io/hadoop-format/src/main/java/org/apache/beam/sdk/io/hadoop/format/HadoopFormatIO.java", "diffHunk": "@@ -437,6 +445,12 @@\n           .build();\n     }\n \n+    /** Transforms the keys read from the source using the given key translation function. */\n+    public Read<K, V> withKeyTranslation(SimpleFunction<?, K> function, Coder<K> coder) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "696ef3b13160df0f0a3478110f36873481ba6782"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI1NTcwMQ==", "bodyText": "Good catch. Fixed", "url": "https://github.com/apache/beam/pull/13166#discussion_r514255701", "createdAt": "2020-10-29T13:26:03Z", "author": {"login": "JozoVilcek"}, "path": "sdks/java/io/hadoop-format/src/main/java/org/apache/beam/sdk/io/hadoop/format/HadoopFormatIO.java", "diffHunk": "@@ -437,6 +445,12 @@\n           .build();\n     }\n \n+    /** Transforms the keys read from the source using the given key translation function. */\n+    public Read<K, V> withKeyTranslation(SimpleFunction<?, K> function, Coder<K> coder) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2MzQ5Nw=="}, "originalCommit": {"oid": "696ef3b13160df0f0a3478110f36873481ba6782"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjM2NjkwOnYy", "diffSide": "RIGHT", "path": "sdks/java/io/hadoop-format/src/main/java/org/apache/beam/sdk/io/hadoop/format/HadoopFormatIO.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNTo0Mzo0MVrOHmoMFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzoyODo1M1rOHqbysg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2NjM5MQ==", "bodyText": "Since we don't need the type information anymore, we should use SerializableFunction instead of SimpleFunction. SimpleFunction implements SerializableFunction so this change enables using simpler lambdas.", "url": "https://github.com/apache/beam/pull/13166#discussion_r510266391", "createdAt": "2020-10-22T15:43:41Z", "author": {"login": "lukecwik"}, "path": "sdks/java/io/hadoop-format/src/main/java/org/apache/beam/sdk/io/hadoop/format/HadoopFormatIO.java", "diffHunk": "@@ -437,6 +445,12 @@\n           .build();\n     }\n \n+    /** Transforms the keys read from the source using the given key translation function. */\n+    public Read<K, V> withKeyTranslation(SimpleFunction<?, K> function, Coder<K> coder) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "696ef3b13160df0f0a3478110f36873481ba6782"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI1NzU4Ng==", "bodyText": "I did try to pass in SerializableFunction but inner code of HadoopFormat does require input and output types for the function for validation, e.g. that input format value class does match translation function input class. I choose to stick with SimpleFunction but just allow to pass in the specific coder.", "url": "https://github.com/apache/beam/pull/13166#discussion_r514257586", "createdAt": "2020-10-29T13:28:53Z", "author": {"login": "JozoVilcek"}, "path": "sdks/java/io/hadoop-format/src/main/java/org/apache/beam/sdk/io/hadoop/format/HadoopFormatIO.java", "diffHunk": "@@ -437,6 +445,12 @@\n           .build();\n     }\n \n+    /** Transforms the keys read from the source using the given key translation function. */\n+    public Read<K, V> withKeyTranslation(SimpleFunction<?, K> function, Coder<K> coder) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2NjM5MQ=="}, "originalCommit": {"oid": "696ef3b13160df0f0a3478110f36873481ba6782"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzOTE2MTUyOnYy", "diffSide": "RIGHT", "path": "sdks/java/io/hadoop-format/src/test/java/org/apache/beam/sdk/io/hadoop/format/HadoopFormatIOReadTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxNzozMjozNlrOHs5bJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QyMDowNToxMVrOHs-oBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg0MDIzMQ==", "bodyText": "nit: I guess the word Function is redundant here (like you called a similar key test testReadObjectCreationFailsIfKeyCoderIsNull )", "url": "https://github.com/apache/beam/pull/13166#discussion_r516840231", "createdAt": "2020-11-03T17:32:36Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/hadoop-format/src/test/java/org/apache/beam/sdk/io/hadoop/format/HadoopFormatIOReadTest.java", "diffHunk": "@@ -229,6 +284,14 @@ public void testReadObjectCreationFailsIfValueTranslationFunctionIsNull() {\n     HadoopFormatIO.<Text, String>read().withConfiguration(serConf.get()).withValueTranslation(null);\n   }\n \n+  @Test\n+  public void testReadObjectCreationFailsIfValueCoderFunctionIsNull() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f060fad8c8701e0eb07e2640edeccf7fb0b613d"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjkyNTQ0NA==", "bodyText": "I agree. Improved by next commit", "url": "https://github.com/apache/beam/pull/13166#discussion_r516925444", "createdAt": "2020-11-03T20:05:11Z", "author": {"login": "JozoVilcek"}, "path": "sdks/java/io/hadoop-format/src/test/java/org/apache/beam/sdk/io/hadoop/format/HadoopFormatIOReadTest.java", "diffHunk": "@@ -229,6 +284,14 @@ public void testReadObjectCreationFailsIfValueTranslationFunctionIsNull() {\n     HadoopFormatIO.<Text, String>read().withConfiguration(serConf.get()).withValueTranslation(null);\n   }\n \n+  @Test\n+  public void testReadObjectCreationFailsIfValueCoderFunctionIsNull() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg0MDIzMQ=="}, "originalCommit": {"oid": "3f060fad8c8701e0eb07e2640edeccf7fb0b613d"}, "originalPosition": 116}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2826, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}