{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxNDQxMjE2", "number": 11777, "title": "[BEAM-10054] Fix watermark hold for on_time_pane", "bodyText": "We have a test pipeline which runs with the DirectRunner. When upgrading from 2.18.0 to 2.21.0 the test failed with the following exception:\ntp = Exception('Monitor task detected a pipeline stall.',), value = None, tb = None\n\n    def raise_(tp, value=None, tb=None):\n        \"\"\"\n        A function that matches the Python 2.x ``raise`` statement. This\n        allows re-raising exceptions with the cls value and traceback on\n        Python 2 and 3.\n        \"\"\"\n        if value is not None and isinstance(tp, Exception):\n            raise TypeError(\"instance exception may not have a separate value\")\n        if value is not None:\n            exc = tp(value)\n        else:\n            exc = tp\n        if exc.__traceback__ is not tb:\n            raise exc.with_traceback(tb)\n>       raise exc\nE       Exception: Monitor task detected a pipeline stall.\n\nI was able to bisect the error. This commit introduced the failure: ea9b1f3\nThe fix lets to the pipeline running correctly.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-05-21T16:05:52Z", "url": "https://github.com/apache/beam/pull/11777", "merged": true, "mergeCommit": {"oid": "0c0302d99d04f16d04826f21230aa28477bb27b4"}, "closed": true, "closedAt": "2020-06-04T10:01:16Z", "author": {"login": "mxm"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjgiM2gFqTQxNjMxNjY0OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnoaFEgBqjM0MDE4NjMwMjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MzE2NjQ4", "url": "https://github.com/apache/beam/pull/11777#pullrequestreview-416316648", "createdAt": "2020-05-21T16:47:44Z", "commit": {"oid": "e48e543788a076e916ed7151475d5b79fee6be9c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNjo0Nzo0NFrOGY6kyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNjo0Nzo0NFrOGY6kyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc3ODY5OA==", "bodyText": "Note that this is the fix in question. Please check @rohdesamuel if that makes sense.", "url": "https://github.com/apache/beam/pull/11777#discussion_r428778698", "createdAt": "2020-05-21T16:47:44Z", "author": {"login": "mxm"}, "path": "sdks/python/apache_beam/transforms/trigger.py", "diffHunk": "@@ -1368,7 +1368,7 @@ def _output(\n     if timestamp is None:\n       # If no watermark hold was set, output at end of window.\n       timestamp = window.max_timestamp()\n-    elif input_watermark < window.end and self.trigger_fn.has_ontime_pane():\n+    elif output_watermark < window.end and self.trigger_fn.has_ontime_pane():", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e48e543788a076e916ed7151475d5b79fee6be9c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa0e94af6fd3cbf70c91f5b8c53610b37307d0ab", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/fa0e94af6fd3cbf70c91f5b8c53610b37307d0ab", "committedDate": "2020-06-03T11:44:17Z", "message": "[BEAM-10054] Add test which demonstrates a pipeline stall"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f028463d4af086d97fbbe294e94592b9e59f131", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/6f028463d4af086d97fbbe294e94592b9e59f131", "committedDate": "2020-06-03T11:44:17Z", "message": "[BEAM-10054] Fix watermark hold for on_time_pane to prevent pipeline stall\n\nWe have a test pipeline which runs with the DirectRunner. When upgrading from\n2.18.0 to 2.21.0 the test failed with the following exception:\n\n```\ntp = Exception('Monitor task detected a pipeline stall.',), value = None, tb = None\n\n    def raise_(tp, value=None, tb=None):\n        \"\"\"\n        A function that matches the Python 2.x ``raise`` statement. This\n        allows re-raising exceptions with the cls value and traceback on\n        Python 2 and 3.\n        \"\"\"\n        if value is not None and isinstance(tp, Exception):\n            raise TypeError(\"instance exception may not have a separate value\")\n        if value is not None:\n            exc = tp(value)\n        else:\n            exc = tp\n        if exc.__traceback__ is not tb:\n            raise exc.with_traceback(tb)\n>       raise exc\nE       Exception: Monitor task detected a pipeline stall.\n```\n\nI was able to bisect the error. This commit introduced the failure:\nea9b1f350b88c2996cafb4d24351869e82857731\n\nThe fix lets to the pipeline running correctly."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dee72197c3d28dcfc3adc746ee67745c3c9a658b", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/dee72197c3d28dcfc3adc746ee67745c3c9a658b", "committedDate": "2020-05-21T16:57:04Z", "message": "linting2"}, "afterCommit": {"oid": "fa0e94af6fd3cbf70c91f5b8c53610b37307d0ab", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/fa0e94af6fd3cbf70c91f5b8c53610b37307d0ab", "committedDate": "2020-06-03T11:44:17Z", "message": "[BEAM-10054] Add test which demonstrates a pipeline stall"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "942115ae1273ec532b77fa52dc1e93e1dd078f9c", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/942115ae1273ec532b77fa52dc1e93e1dd078f9c", "committedDate": "2020-06-03T12:13:38Z", "message": "linting"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7e994930499b75294748d6384a31c75c66af594b", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/7e994930499b75294748d6384a31c75c66af594b", "committedDate": "2020-06-03T11:58:35Z", "message": "linting"}, "afterCommit": {"oid": "942115ae1273ec532b77fa52dc1e93e1dd078f9c", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/942115ae1273ec532b77fa52dc1e93e1dd078f9c", "committedDate": "2020-06-03T12:13:38Z", "message": "linting"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4767, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}