{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5Njc0OTEy", "number": 12089, "title": "[BEAM-10283] Add new overloads of withKeyRanges and withRowFilter met\u2026", "bodyText": "\u2026hods that take ValueProvider as a parameter.\nThis will allow passing runtime parameters from a dataflow template to these methods.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\n\n\n\n\nGo\n\n---\n\n---\n\n\n\nJava\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n\n\nXLang\n---\n---\n\n---\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-06-25T05:33:53Z", "url": "https://github.com/apache/beam/pull/12089", "merged": true, "mergeCommit": {"oid": "21959c9d9bf91f207160100c86a25acc42de50ec"}, "closed": true, "closedAt": "2020-07-07T20:24:00Z", "author": {"login": "rafi-kamal"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuoCIqAH2gAyNDM5Njc0OTEyOjFjMWVlMjk1MjJmZDkxNDgxZmE2YzQ3ZWRhZjA5ZTFhNDgzOWZjYTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyry6_AFqTQ0NDIyMjgxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1c1ee29522fd91481fa6c47edaf09e1a4839fca9", "author": {"user": {"login": "rafi-kamal", "name": "Rafi Kamal"}}, "url": "https://github.com/apache/beam/commit/1c1ee29522fd91481fa6c47edaf09e1a4839fca9", "committedDate": "2020-06-25T05:45:08Z", "message": "[BEAM-10283] Add new overloads of withKeyRanges and withRowFilter methods that take ValueProvider as a parameter."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f148c573acc186f165525be7fbf9ae8ec021046e", "author": {"user": {"login": "rafi-kamal", "name": "Rafi Kamal"}}, "url": "https://github.com/apache/beam/commit/f148c573acc186f165525be7fbf9ae8ec021046e", "committedDate": "2020-06-25T05:30:40Z", "message": "[BEAM-10283] Add new overloads of withKeyRanges and withRowFilter methods that take ValueProvider as a parameter."}, "afterCommit": {"oid": "1c1ee29522fd91481fa6c47edaf09e1a4839fca9", "author": {"user": {"login": "rafi-kamal", "name": "Rafi Kamal"}}, "url": "https://github.com/apache/beam/commit/1c1ee29522fd91481fa6c47edaf09e1a4839fca9", "committedDate": "2020-06-25T05:45:08Z", "message": "[BEAM-10283] Add new overloads of withKeyRanges and withRowFilter methods that take ValueProvider as a parameter."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNDc1Mjk2", "url": "https://github.com/apache/beam/pull/12089#pullrequestreview-443475296", "createdAt": "2020-07-06T23:51:58Z", "commit": {"oid": "1c1ee29522fd91481fa6c47edaf09e1a4839fca9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQyMzo1MTo1OFrOGtqlxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDowNjo1OFrOGtq2CQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUzNjkwMw==", "bodyText": "This will need to go into 2.24 as 2.23 release branch has been cut. Just add a section like 2.23 with empty sections.", "url": "https://github.com/apache/beam/pull/12089#discussion_r450536903", "createdAt": "2020-07-06T23:51:58Z", "author": {"login": "lukecwik"}, "path": "CHANGES.md", "diffHunk": "@@ -63,6 +63,8 @@\n   is experimental. It reads data from BigQuery by exporting data to Avro files, and reading those files. It also supports\n   reading data by exporting to JSON files. This has small differences in behavior for Time and Date-related fields. See\n   Pydoc for more information.\n+* New overloads for BigtableIO.Read.withKeyRange() and BigtableIO.Read.withRowFilter()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1ee29522fd91481fa6c47edaf09e1a4839fca9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU0MDEyMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /** Returns the Row filter to use. */\n          \n          \n            \n              /** Returns the row filter to use. */", "url": "https://github.com/apache/beam/pull/12089#discussion_r450540123", "createdAt": "2020-07-07T00:03:33Z", "author": {"login": "lukecwik"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigtable/BigtableReadOptions.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package org.apache.beam.sdk.io.gcp.bigtable;\n+\n+import static org.apache.beam.vendor.guava.v26_0_jre.com.google.common.base.Preconditions.checkArgument;\n+\n+import com.google.auto.value.AutoValue;\n+import com.google.bigtable.v2.RowFilter;\n+import java.io.Serializable;\n+import java.util.Collections;\n+import java.util.List;\n+import javax.annotation.Nullable;\n+import org.apache.beam.sdk.io.range.ByteKeyRange;\n+import org.apache.beam.sdk.options.ValueProvider;\n+import org.apache.beam.sdk.transforms.display.DisplayData;\n+\n+/** Configuration for which values to read from Bigtable. */\n+@AutoValue\n+abstract class BigtableReadOptions implements Serializable {\n+\n+  /** Returns the Row filter to use. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1ee29522fd91481fa6c47edaf09e1a4839fca9"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU0MTA2NQ==", "bodyText": "nit: currently it seems like overlapping ranges lead to duplicate reads for any keys in the overlapping area, it would be good if either:\n\noverlapping ranges lead to an error\noverlapping ranges are correctly fixed up to not produce duplicates", "url": "https://github.com/apache/beam/pull/12089#discussion_r450541065", "createdAt": "2020-07-07T00:06:58Z", "author": {"login": "lukecwik"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigtable/BigtableIO.java", "diffHunk": "@@ -410,13 +417,22 @@ public Read withKeyRange(ByteKeyRange keyRange) {\n      *\n      * <p>Does not modify this object.\n      */\n-    public Read withKeyRanges(List<ByteKeyRange> keyRanges) {\n+    public Read withKeyRanges(ValueProvider<List<ByteKeyRange>> keyRanges) {\n       checkArgument(keyRanges != null, \"keyRanges can not be null\");\n-      checkArgument(!keyRanges.isEmpty(), \"keyRanges can not be empty\");\n-      for (ByteKeyRange range : keyRanges) {\n-        checkArgument(range != null, \"keyRanges cannot hold null range\");\n-      }\n-      return toBuilder().setKeyRanges(keyRanges).build();\n+      BigtableReadOptions bigtableReadOptions = getBigtableReadOptions();\n+      return toBuilder()\n+          .setBigtableReadOptions(bigtableReadOptions.toBuilder().setKeyRanges(keyRanges).build())\n+          .build();\n+    }\n+\n+    /**\n+     * Returns a new {@link BigtableIO.Read} that will read only rows in the specified ranges.\n+     * Ranges must not overlap.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1ee29522fd91481fa6c47edaf09e1a4839fca9"}, "originalPosition": 141}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNDgwNTg3", "url": "https://github.com/apache/beam/pull/12089#pullrequestreview-443480587", "createdAt": "2020-07-07T00:10:08Z", "commit": {"oid": "1c1ee29522fd91481fa6c47edaf09e1a4839fca9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDoxMDowOFrOGtq5QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMDoxMDoyOFrOGtq5lQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU0MTg4OQ==", "bodyText": "Needs an Apache 2.0 license header in the file. See other files for an example.", "url": "https://github.com/apache/beam/pull/12089#discussion_r450541889", "createdAt": "2020-07-07T00:10:08Z", "author": {"login": "lukecwik"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigtable/BigtableReadOptions.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package org.apache.beam.sdk.io.gcp.bigtable;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1ee29522fd91481fa6c47edaf09e1a4839fca9"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU0MTk3Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        .withTableId(options.getBigtableTableId())\n          \n          \n            \n                        .withTableId(options.getBigtableTableId());", "url": "https://github.com/apache/beam/pull/12089#discussion_r450541973", "createdAt": "2020-07-07T00:10:28Z", "author": {"login": "lukecwik"}, "path": "sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/bigtable/BigtableIOTest.java", "diffHunk": "@@ -1100,7 +1141,7 @@ public void testReadingDisplayDataFromRuntimeParameters() {\n             .withBigtableOptions(BIGTABLE_OPTIONS)\n             .withProjectId(options.getBigtableProject())\n             .withInstanceId(options.getBigtableInstanceId())\n-            .withTableId(options.getBigtableTableId());\n+            .withTableId(options.getBigtableTableId())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c1ee29522fd91481fa6c47edaf09e1a4839fca9"}, "originalPosition": 270}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1df4a9de5c79c8202b977db537ac18b22d0483d2", "author": {"user": {"login": "rafi-kamal", "name": "Rafi Kamal"}}, "url": "https://github.com/apache/beam/commit/1df4a9de5c79c8202b977db537ac18b22d0483d2", "committedDate": "2020-07-07T03:05:38Z", "message": "Update sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigtable/BigtableReadOptions.java\n\nCo-authored-by: Lukasz Cwik <lcwik@google.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6335fdeee0ca41047af043427fc9c31490c26d86", "author": {"user": {"login": "rafi-kamal", "name": "Rafi Kamal"}}, "url": "https://github.com/apache/beam/commit/6335fdeee0ca41047af043427fc9c31490c26d86", "committedDate": "2020-07-07T03:05:47Z", "message": "Update sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/bigtable/BigtableIOTest.java\n\nCo-authored-by: Lukasz Cwik <lcwik@google.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fae4395e3dca731af27fa0bcd786f55b2c5d3857", "author": {"user": {"login": "rafi-kamal", "name": "Rafi Kamal"}}, "url": "https://github.com/apache/beam/commit/fae4395e3dca731af27fa0bcd786f55b2c5d3857", "committedDate": "2020-07-07T03:11:08Z", "message": "Move the feature description in CHANGES.md to 2.24.0 and add a license header for BigtableReadOptions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77b4501163f297129ec02a4488467b48b2967d73", "author": {"user": {"login": "rafi-kamal", "name": "Rafi Kamal"}}, "url": "https://github.com/apache/beam/commit/77b4501163f297129ec02a4488467b48b2967d73", "committedDate": "2020-07-07T03:36:39Z", "message": "Reformatted code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "710721e13f65333a997ae17d4a841739875b7bf8", "author": {"user": {"login": "rafi-kamal", "name": "Rafi Kamal"}}, "url": "https://github.com/apache/beam/commit/710721e13f65333a997ae17d4a841739875b7bf8", "committedDate": "2020-07-07T03:44:16Z", "message": "Reformatted code by running spotlessApply"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MjIyODE4", "url": "https://github.com/apache/beam/pull/12089#pullrequestreview-444222818", "createdAt": "2020-07-07T20:23:50Z", "commit": {"oid": "710721e13f65333a997ae17d4a841739875b7bf8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3871, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}