{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4ODAzNDg0", "number": 11521, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxOTo0NDozNlrOD59_rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzoyNTozMlrOD6E0Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMTExMTQ5OnYy", "diffSide": "RIGHT", "path": "runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/GrpcFnServer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxOTo0NDozNlrOGRisgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxOTo0NDozNlrOGRisgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA0NzQyNw==", "bodyText": "Create {@link GrpcFnServer}s?", "url": "https://github.com/apache/beam/pull/11521#discussion_r421047427", "createdAt": "2020-05-06T19:44:36Z", "author": {"login": "ihji"}, "path": "runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/GrpcFnServer.java", "diffHunk": "@@ -39,6 +43,59 @@\n     return new GrpcFnServer<>(server, service, apiServiceDescriptor.build());\n   }\n \n+  /**\n+   * Create a {@link GrpcFnServer}s for the provided {@link FnService}s running on an arbitrary\n+   * port.\n+   */\n+  public static List<GrpcFnServer<? extends FnService>> allocatePortAndCreateFor(\n+      List<? extends FnService> services, ServerFactory factory) throws IOException {\n+    ApiServiceDescriptor.Builder apiServiceDescriptor = ApiServiceDescriptor.newBuilder();\n+    Server server =\n+        factory.allocateAddressAndCreate(\n+            Collections.unmodifiableList(services), apiServiceDescriptor);\n+    AtomicInteger countdown = new AtomicInteger(services.size());\n+    return Lists.transform(\n+        services,\n+        service ->\n+            new SharedGrpcFnServer<>(server, service, apiServiceDescriptor.build(), countdown));\n+  }\n+\n+  /**\n+   * Create a {@link GrpcFnServer}s for the provided {@link FnService}s running on a specified port.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de17dc2c81729abeb7e4db23ff6c4bfecb32e61f"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMTEyMjY5OnYy", "diffSide": "RIGHT", "path": "runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/GrpcFnServer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxOTo0NzozOFrOGRizOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxOTo0NzozOFrOGRizOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA0OTE0Ng==", "bodyText": "Create {@link GrpcFnServer}s?", "url": "https://github.com/apache/beam/pull/11521#discussion_r421049146", "createdAt": "2020-05-06T19:47:38Z", "author": {"login": "ihji"}, "path": "runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/GrpcFnServer.java", "diffHunk": "@@ -39,6 +43,59 @@\n     return new GrpcFnServer<>(server, service, apiServiceDescriptor.build());\n   }\n \n+  /**\n+   * Create a {@link GrpcFnServer}s for the provided {@link FnService}s running on an arbitrary", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de17dc2c81729abeb7e4db23ff6c4bfecb32e61f"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyMjIyOTEwOnYy", "diffSide": "RIGHT", "path": "runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/control/DefaultJobBundleFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzoyNTozMlrOGRtClw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwMToxMDo1MVrOGSVjhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNjkxOQ==", "bodyText": "Shouldn't we also close retrievalServer?", "url": "https://github.com/apache/beam/pull/11521#discussion_r421216919", "createdAt": "2020-05-07T03:25:32Z", "author": {"login": "ihji"}, "path": "runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/control/DefaultJobBundleFactory.java", "diffHunk": "@@ -613,7 +620,7 @@ public synchronized void close() {\n       // These will be closed in the reverse creation order:\n       try (AutoCloseable envCloser = environment;\n           AutoCloseable provisioningServer = serverInfo.getProvisioningServer();\n-          AutoCloseable retrievalServer = serverInfo.getRetrievalServer();\n+          AutoCloseable retrievalServer = serverInfo.getLegacyRetrievalServer();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de17dc2c81729abeb7e4db23ff6c4bfecb32e61f"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg4MDcxMA==", "bodyText": "Yes, nice catch.", "url": "https://github.com/apache/beam/pull/11521#discussion_r421880710", "createdAt": "2020-05-08T01:10:51Z", "author": {"login": "robertwb"}, "path": "runners/java-fn-execution/src/main/java/org/apache/beam/runners/fnexecution/control/DefaultJobBundleFactory.java", "diffHunk": "@@ -613,7 +620,7 @@ public synchronized void close() {\n       // These will be closed in the reverse creation order:\n       try (AutoCloseable envCloser = environment;\n           AutoCloseable provisioningServer = serverInfo.getProvisioningServer();\n-          AutoCloseable retrievalServer = serverInfo.getRetrievalServer();\n+          AutoCloseable retrievalServer = serverInfo.getLegacyRetrievalServer();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxNjkxOQ=="}, "originalCommit": {"oid": "de17dc2c81729abeb7e4db23ff6c4bfecb32e61f"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1128, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}