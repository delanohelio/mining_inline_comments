{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MjA1MDU0", "number": 12483, "title": "[BEAM-9182] [BEAM-10651] Support NULL query parameters in ZetaSQL and fix nullable ARRAY bug", "bodyText": "Previously we substitute all parameters with literals. This works in most cases except when the parameter is NULL, because some operations allows NULL parameter but not NULL literal.\nTherefore here I translate all NULL parameters to a Calcite RexDynamicParam, and then rebuild them them during unparsing (it's easy to do because we know they are all NULLs). The reason why I did not implement full support of dynamic parameters is because there are limitations on both Calcite (RexDynamicParam only support positional parameters) and ZetaSQL (Java evaluator wrapper only support named parameters) side.\nr: @apilloud\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-06T18:51:16Z", "url": "https://github.com/apache/beam/pull/12483", "merged": true, "mergeCommit": {"oid": "4c3679286f2dc53a9a61bfd430c8e69c59a8fdc5"}, "closed": true, "closedAt": "2020-08-07T20:03:35Z", "author": {"login": "robinyqiu"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8ZReRgFqTQ2Mjk2MDE5MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8pw9DgBqjM2MzQ1MzIwOTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTYwMTkw", "url": "https://github.com/apache/beam/pull/12483#pullrequestreview-462960190", "createdAt": "2020-08-07T00:23:57Z", "commit": {"oid": "da754106272fecd97d3f91917f5e8668e52272eb"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMDoyMzo1N1rOG9IaeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwMDoyMzo1N1rOG9IaeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc1NDE2OA==", "bodyText": "nit: AutoValue might save you some boilerplate (equals, hashcode) in this class.", "url": "https://github.com/apache/beam/pull/12483#discussion_r466754168", "createdAt": "2020-08-07T00:23:57Z", "author": {"login": "apilloud"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigquery/BeamSqlUnparseContext.java", "diffHunk": "@@ -147,4 +165,35 @@ public int hashCode() {\n       return super.hashCode();\n     }\n   }\n+\n+  private static class NamedDynamicParam extends SqlDynamicParam {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da754106272fecd97d3f91917f5e8668e52272eb"}, "originalPosition": 58}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3bf4b9964609321bcc0b761e7e5a6d08bfec0bb1", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/3bf4b9964609321bcc0b761e7e5a6d08bfec0bb1", "committedDate": "2020-08-07T17:12:08Z", "message": "Remove unused methods"}, "afterCommit": {"oid": "7f6863ede7058fbf9fded1de161f05d0ae696ba1", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/7f6863ede7058fbf9fded1de161f05d0ae696ba1", "committedDate": "2020-08-07T17:16:39Z", "message": "Support NULL query parameters in ZetaSQL and fix nullable ARRAY bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99e8c2732b31c9531b40a3669717080bbf0914b3", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/99e8c2732b31c9531b40a3669717080bbf0914b3", "committedDate": "2020-08-07T19:40:24Z", "message": "Support NULL query parameters in ZetaSQL and fix nullable ARRAY bug"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f6863ede7058fbf9fded1de161f05d0ae696ba1", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/7f6863ede7058fbf9fded1de161f05d0ae696ba1", "committedDate": "2020-08-07T17:16:39Z", "message": "Support NULL query parameters in ZetaSQL and fix nullable ARRAY bug"}, "afterCommit": {"oid": "99e8c2732b31c9531b40a3669717080bbf0914b3", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/99e8c2732b31c9531b40a3669717080bbf0914b3", "committedDate": "2020-08-07T19:40:24Z", "message": "Support NULL query parameters in ZetaSQL and fix nullable ARRAY bug"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3768, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}