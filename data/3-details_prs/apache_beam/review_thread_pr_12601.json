{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4OTgyOTAw", "number": 12601, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMDozMDozOVrOEZNknA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMjoyNjo0MFrOEZPkZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0ODcyMjIwOnYy", "diffSide": "RIGHT", "path": "sdks/java/testing/tpcds/src/main/java/org/apache/beam/sdk/tpcds/SqlTransformRunner.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMDozMDozOVrOHB50_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMTozMToyNFrOHB7kDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc1ODA3OA==", "bodyText": "Can you replace this with LOG? Here is an example of LOG: https://github.com/apache/beam/blob/master/sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/CalciteQueryPlanner.java#L75", "url": "https://github.com/apache/beam/pull/12601#discussion_r471758078", "createdAt": "2020-08-17T20:30:39Z", "author": {"login": "amaliujia"}, "path": "sdks/java/testing/tpcds/src/main/java/org/apache/beam/sdk/tpcds/SqlTransformRunner.java", "diffHunk": "@@ -121,19 +152,26 @@ public static void runUsingSqlTransform(String[] args) throws Exception {\n             String queryString = QueryReader.readQuery(queryNameArr[i]);\n             PCollectionTuple tables = getTables(pipelines[i], csvFormat, queryNameArr[i]);\n \n-            tables\n-                    .apply(\n-                            SqlTransform.query(queryString))\n-                    .apply(\n-                            MapElements.into(TypeDescriptors.strings()).via((Row row) -> row.toString()))\n-                    .apply(TextIO.write()\n-                            .to(resultDirectory + \"/\" + dataSize + \"/\" + pipelines[i].getOptions().getJobName())\n-                            .withSuffix(\".txt\")\n-                            .withNumShards(1));\n+            try {\n+                tables\n+                        .apply(\n+                                SqlTransform.query(queryString))\n+                        .apply(\n+                                MapElements.into(TypeDescriptors.strings()).via((Row row) -> row.toString()))\n+                        .apply(TextIO.write()\n+                                .to(RESULT_DIRECTORY + \"/\" + dataSize + \"/\" + pipelines[i].getOptions().getJobName())\n+                                .withSuffix(\".txt\")\n+                                .withNumShards(1));\n+            } catch (Exception e) {\n+                System.out.println(queryNameArr[i] + \" failed to execute\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab432868ee598503314a5e88527ecfd9cd6d777a"}, "originalPosition": 111}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc4NjUwOA==", "bodyText": "Replaced", "url": "https://github.com/apache/beam/pull/12601#discussion_r471786508", "createdAt": "2020-08-17T21:31:24Z", "author": {"login": "Imfuyuwei"}, "path": "sdks/java/testing/tpcds/src/main/java/org/apache/beam/sdk/tpcds/SqlTransformRunner.java", "diffHunk": "@@ -121,19 +152,26 @@ public static void runUsingSqlTransform(String[] args) throws Exception {\n             String queryString = QueryReader.readQuery(queryNameArr[i]);\n             PCollectionTuple tables = getTables(pipelines[i], csvFormat, queryNameArr[i]);\n \n-            tables\n-                    .apply(\n-                            SqlTransform.query(queryString))\n-                    .apply(\n-                            MapElements.into(TypeDescriptors.strings()).via((Row row) -> row.toString()))\n-                    .apply(TextIO.write()\n-                            .to(resultDirectory + \"/\" + dataSize + \"/\" + pipelines[i].getOptions().getJobName())\n-                            .withSuffix(\".txt\")\n-                            .withNumShards(1));\n+            try {\n+                tables\n+                        .apply(\n+                                SqlTransform.query(queryString))\n+                        .apply(\n+                                MapElements.into(TypeDescriptors.strings()).via((Row row) -> row.toString()))\n+                        .apply(TextIO.write()\n+                                .to(RESULT_DIRECTORY + \"/\" + dataSize + \"/\" + pipelines[i].getOptions().getJobName())\n+                                .withSuffix(\".txt\")\n+                                .withNumShards(1));\n+            } catch (Exception e) {\n+                System.out.println(queryNameArr[i] + \" failed to execute\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc1ODA3OA=="}, "originalCommit": {"oid": "ab432868ee598503314a5e88527ecfd9cd6d777a"}, "originalPosition": 111}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0ODczMTMwOnYy", "diffSide": "RIGHT", "path": "sdks/java/testing/tpcds/src/main/java/org/apache/beam/sdk/tpcds/SqlTransformRunner.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMDozMzowN1rOHB56HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMDozMzowN1rOHB56HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc1OTM4OA==", "bodyText": "Have also check the state of the PipelineResult: https://github.com/apache/beam/blob/master/sdks/java/core/src/main/java/org/apache/beam/sdk/PipelineResult.java#L38?\nMake sure only print successful when job state is successful.", "url": "https://github.com/apache/beam/pull/12601#discussion_r471759388", "createdAt": "2020-08-17T20:33:07Z", "author": {"login": "amaliujia"}, "path": "sdks/java/testing/tpcds/src/main/java/org/apache/beam/sdk/tpcds/SqlTransformRunner.java", "diffHunk": "@@ -97,7 +128,7 @@ public static void runUsingSqlTransform(String[] args) throws Exception {\n \n         // Using ExecutorService and CompletionService to fulfill multi-threading functionality\n         ExecutorService executor = Executors.newFixedThreadPool(nThreads);\n-        CompletionService<PipelineResult> completion = new ExecutorCompletionService<>(executor);\n+        CompletionService<TpcdsRunResult> completion = new ExecutorCompletionService<>(executor);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab432868ee598503314a5e88527ecfd9cd6d777a"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0ODczMjg2OnYy", "diffSide": "RIGHT", "path": "sdks/java/testing/tpcds/src/main/java/org/apache/beam/sdk/tpcds/TpcdsRun.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMDozMzo0MVrOHB57EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMTozNDo0N1rOHB7pUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc1OTYzMg==", "bodyText": "check pipeline result state.", "url": "https://github.com/apache/beam/pull/12601#discussion_r471759632", "createdAt": "2020-08-17T20:33:41Z", "author": {"login": "amaliujia"}, "path": "sdks/java/testing/tpcds/src/main/java/org/apache/beam/sdk/tpcds/TpcdsRun.java", "diffHunk": "@@ -24,17 +24,30 @@\n /**\n  * To fulfill multi-threaded execution\n  */\n-public class TpcdsRun implements Callable<PipelineResult> {\n+public class TpcdsRun implements Callable<TpcdsRunResult> {\n     private final Pipeline pipeline;\n \n     public TpcdsRun (Pipeline pipeline) {\n         this.pipeline = pipeline;\n     }\n \n     @Override\n-    public PipelineResult call() {\n-        PipelineResult pipelineResult = pipeline.run();\n-        pipelineResult.waitUntilFinish();\n-        return pipelineResult;\n+    public TpcdsRunResult call() {\n+        TpcdsRunResult tpcdsRunResult;\n+\n+        try {\n+            PipelineResult pipelineResult = pipeline.run();\n+            long startTimeStamp = System.currentTimeMillis();\n+            pipelineResult.waitUntilFinish();\n+            long endTimeStamp = System.currentTimeMillis();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab432868ee598503314a5e88527ecfd9cd6d777a"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc4Nzg1Nw==", "bodyText": "Check added", "url": "https://github.com/apache/beam/pull/12601#discussion_r471787857", "createdAt": "2020-08-17T21:34:47Z", "author": {"login": "Imfuyuwei"}, "path": "sdks/java/testing/tpcds/src/main/java/org/apache/beam/sdk/tpcds/TpcdsRun.java", "diffHunk": "@@ -24,17 +24,30 @@\n /**\n  * To fulfill multi-threaded execution\n  */\n-public class TpcdsRun implements Callable<PipelineResult> {\n+public class TpcdsRun implements Callable<TpcdsRunResult> {\n     private final Pipeline pipeline;\n \n     public TpcdsRun (Pipeline pipeline) {\n         this.pipeline = pipeline;\n     }\n \n     @Override\n-    public PipelineResult call() {\n-        PipelineResult pipelineResult = pipeline.run();\n-        pipelineResult.waitUntilFinish();\n-        return pipelineResult;\n+    public TpcdsRunResult call() {\n+        TpcdsRunResult tpcdsRunResult;\n+\n+        try {\n+            PipelineResult pipelineResult = pipeline.run();\n+            long startTimeStamp = System.currentTimeMillis();\n+            pipelineResult.waitUntilFinish();\n+            long endTimeStamp = System.currentTimeMillis();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc1OTYzMg=="}, "originalCommit": {"oid": "ab432868ee598503314a5e88527ecfd9cd6d777a"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0OTA0OTMzOnYy", "diffSide": "RIGHT", "path": "sdks/java/testing/tpcds/src/main/java/org/apache/beam/sdk/tpcds/TpcdsRun.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMjoyNjo0MFrOHB86ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QyMjoyNzozOFrOHB88Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgwODY3NQ==", "bodyText": "Nit: add parentheses around state == State.DONE;, which increases readability.", "url": "https://github.com/apache/beam/pull/12601#discussion_r471808675", "createdAt": "2020-08-17T22:26:40Z", "author": {"login": "amaliujia"}, "path": "sdks/java/testing/tpcds/src/main/java/org/apache/beam/sdk/tpcds/TpcdsRun.java", "diffHunk": "@@ -19,22 +19,38 @@\n \n import org.apache.beam.sdk.Pipeline;\n import org.apache.beam.sdk.PipelineResult;\n+import org.apache.beam.sdk.PipelineResult.State;\n import java.util.concurrent.Callable;\n \n /**\n  * To fulfill multi-threaded execution\n  */\n-public class TpcdsRun implements Callable<PipelineResult> {\n+public class TpcdsRun implements Callable<TpcdsRunResult> {\n     private final Pipeline pipeline;\n \n     public TpcdsRun (Pipeline pipeline) {\n         this.pipeline = pipeline;\n     }\n \n     @Override\n-    public PipelineResult call() {\n-        PipelineResult pipelineResult = pipeline.run();\n-        pipelineResult.waitUntilFinish();\n-        return pipelineResult;\n+    public TpcdsRunResult call() {\n+        TpcdsRunResult tpcdsRunResult;\n+\n+        try {\n+            PipelineResult pipelineResult = pipeline.run();\n+            long startTimeStamp = System.currentTimeMillis();\n+            State state = pipelineResult.waitUntilFinish();\n+            long endTimeStamp = System.currentTimeMillis();\n+\n+            // Make sure to set the job status to be successful only when pipelineResult's final state is DONE.\n+            boolean isSuccessful = state == State.DONE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e2c9c0b244df4f924bcd365892fb393ec59b2a8"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgwOTAzMQ==", "bodyText": "Actually nvm on this.", "url": "https://github.com/apache/beam/pull/12601#discussion_r471809031", "createdAt": "2020-08-17T22:27:38Z", "author": {"login": "amaliujia"}, "path": "sdks/java/testing/tpcds/src/main/java/org/apache/beam/sdk/tpcds/TpcdsRun.java", "diffHunk": "@@ -19,22 +19,38 @@\n \n import org.apache.beam.sdk.Pipeline;\n import org.apache.beam.sdk.PipelineResult;\n+import org.apache.beam.sdk.PipelineResult.State;\n import java.util.concurrent.Callable;\n \n /**\n  * To fulfill multi-threaded execution\n  */\n-public class TpcdsRun implements Callable<PipelineResult> {\n+public class TpcdsRun implements Callable<TpcdsRunResult> {\n     private final Pipeline pipeline;\n \n     public TpcdsRun (Pipeline pipeline) {\n         this.pipeline = pipeline;\n     }\n \n     @Override\n-    public PipelineResult call() {\n-        PipelineResult pipelineResult = pipeline.run();\n-        pipelineResult.waitUntilFinish();\n-        return pipelineResult;\n+    public TpcdsRunResult call() {\n+        TpcdsRunResult tpcdsRunResult;\n+\n+        try {\n+            PipelineResult pipelineResult = pipeline.run();\n+            long startTimeStamp = System.currentTimeMillis();\n+            State state = pipelineResult.waitUntilFinish();\n+            long endTimeStamp = System.currentTimeMillis();\n+\n+            // Make sure to set the job status to be successful only when pipelineResult's final state is DONE.\n+            boolean isSuccessful = state == State.DONE;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTgwODY3NQ=="}, "originalCommit": {"oid": "8e2c9c0b244df4f924bcd365892fb393ec59b2a8"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 714, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}