{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5NDU3NDI5", "number": 13543, "title": "[BEAM-11457] Add option to skip key-value clone", "bodyText": "Thank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-12-14T13:36:25Z", "url": "https://github.com/apache/beam/pull/13543", "merged": true, "mergeCommit": {"oid": "4165016b523407fa5a3f98f27cd859280067eb68"}, "closed": true, "closedAt": "2021-01-04T14:38:04Z", "author": {"login": "JozoVilcek"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdpQgEFAFqTU1ODQzMzY3Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABds3U87AFqTU2MTA3NzYyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4NDMzNjcz", "url": "https://github.com/apache/beam/pull/13543#pullrequestreview-558433673", "createdAt": "2020-12-24T09:41:38Z", "commit": {"oid": "76af49ec9db17fc63099b7ed8ea6970e6556d04f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4NDQ3MjU3", "url": "https://github.com/apache/beam/pull/13543#pullrequestreview-558447257", "createdAt": "2020-12-24T10:17:21Z", "commit": {"oid": "76af49ec9db17fc63099b7ed8ea6970e6556d04f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQxMDoxNzoyMVrOILEnXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNFQxMjozMzo1NlrOILG2hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ4MDg2MQ==", "bodyText": "Please, make it configurable separately for keys and values like we do with other configuration options.", "url": "https://github.com/apache/beam/pull/13543#discussion_r548480861", "createdAt": "2020-12-24T10:17:21Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/hadoop-format/src/main/java/org/apache/beam/sdk/io/hadoop/format/HadoopFormatIO.java", "diffHunk": "@@ -475,6 +479,18 @@\n       return withValueTranslation(function).toBuilder().setValueCoder(coder).build();\n     }\n \n+    /**\n+     * Determines if key-value clone should be skipped or not (default is 'false'). Hadoop formats\n+     * typically work with Writable data structures which are mutable. Therefore, this IO will clone\n+     * read key-values if they are not in the list of well known immutable types. However, in case\n+     * user does use key/value translation functions, resulting key-values might already be\n+     * immutable. In such case, additional copy is unnecessary overhead and can be avoided by\n+     * setting skip to 'true'.\n+     */\n+    public Read<K, V> withSkipKeyValueClone(boolean value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76af49ec9db17fc63099b7ed8ea6970e6556d04f"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODQ4NzU1NA==", "bodyText": "Please, set default values in read() with a builder.", "url": "https://github.com/apache/beam/pull/13543#discussion_r548487554", "createdAt": "2020-12-24T10:39:33Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/hadoop-format/src/main/java/org/apache/beam/sdk/io/hadoop/format/HadoopFormatIO.java", "diffHunk": "@@ -488,13 +504,16 @@\n       if (valueCoder == null) {\n         valueCoder = getDefaultCoder(getValueTypeDescriptor(), coderRegistry);\n       }\n+      boolean skipKeyValueClone = getSkipKeyValueClone() == null ? false : getSkipKeyValueClone();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76af49ec9db17fc63099b7ed8ea6970e6556d04f"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODUxNjgyNA==", "bodyText": "Should it be used only with withKeyTranslation() or withValueTranslation(), or it can be used independently?", "url": "https://github.com/apache/beam/pull/13543#discussion_r548516824", "createdAt": "2020-12-24T12:31:24Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/hadoop-format/src/main/java/org/apache/beam/sdk/io/hadoop/format/HadoopFormatIO.java", "diffHunk": "@@ -475,6 +479,18 @@\n       return withValueTranslation(function).toBuilder().setValueCoder(coder).build();\n     }\n \n+    /**\n+     * Determines if key-value clone should be skipped or not (default is 'false'). Hadoop formats\n+     * typically work with Writable data structures which are mutable. Therefore, this IO will clone\n+     * read key-values if they are not in the list of well known immutable types. However, in case\n+     * user does use key/value translation functions, resulting key-values might already be", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76af49ec9db17fc63099b7ed8ea6970e6556d04f"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODUxNzUwOQ==", "bodyText": "Please, update HadoopFormatIO's Javadoc as well.", "url": "https://github.com/apache/beam/pull/13543#discussion_r548517509", "createdAt": "2020-12-24T12:33:56Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/hadoop-format/src/main/java/org/apache/beam/sdk/io/hadoop/format/HadoopFormatIO.java", "diffHunk": "@@ -475,6 +479,18 @@\n       return withValueTranslation(function).toBuilder().setValueCoder(coder).build();\n     }\n \n+    /**\n+     * Determines if key-value clone should be skipped or not (default is 'false'). Hadoop formats", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76af49ec9db17fc63099b7ed8ea6970e6556d04f"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b286414e49355c328c6a48b8dd656e0398fad184", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/b286414e49355c328c6a48b8dd656e0398fad184", "committedDate": "2020-12-31T08:51:11Z", "message": "[BEAM-11457] Add option to skip key-value clone"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b21335cbced08122e618e9a28463a7ae74a0297", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/2b21335cbced08122e618e9a28463a7ae74a0297", "committedDate": "2020-12-31T08:51:12Z", "message": "[BEAM-11457] Split option to skip key/value clone"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cdccd576f60f0c91220b871c2e99947393673a9", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/3cdccd576f60f0c91220b871c2e99947393673a9", "committedDate": "2020-12-31T08:57:50Z", "message": "[BEAM-11457] Update CHANGES.md, apply spotless"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef0afe31d91e68248fc475eb11af7f03de054636", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/ef0afe31d91e68248fc475eb11af7f03de054636", "committedDate": "2020-12-31T08:39:43Z", "message": "[BEAM-11457] Split option to skip key/value clone"}, "afterCommit": {"oid": "3cdccd576f60f0c91220b871c2e99947393673a9", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/3cdccd576f60f0c91220b871c2e99947393673a9", "committedDate": "2020-12-31T08:57:50Z", "message": "[BEAM-11457] Update CHANGES.md, apply spotless"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMDc3NjI2", "url": "https://github.com/apache/beam/pull/13543#pullrequestreview-561077626", "createdAt": "2021-01-04T14:37:34Z", "commit": {"oid": "3cdccd576f60f0c91220b871c2e99947393673a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4423, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}