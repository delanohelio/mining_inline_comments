{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3MDM4Nzc5", "number": 12209, "title": "[BEAM-9629] Fix several connection leak issues.", "bodyText": "Make the default max connections to be unlimited. This mirrors the 2.17 and earlier behavior since we used to create one DataSource per execution thread (and hence one connection).\nMove connection fetching to @ProcessElement to not hold a connection for empty bundles.\nMake sure that finalize() closes the connection so that it is returned to the pool if the bundle fails.\n\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n---\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-07-09T19:00:34Z", "url": "https://github.com/apache/beam/pull/12209", "merged": true, "mergeCommit": {"oid": "47a611423053dc50bd55a156a5f58c040c9ab1cd"}, "closed": true, "closedAt": "2020-07-10T17:44:14Z", "author": {"login": "lukecwik"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczTx6YAH2gAyNDQ3MDM4Nzc5OjEzNmU5Zjc4NTM5ZjlmNGNkMmYzZGI1MDk4NjQwMGExOTRhNzc0ODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcznRNhgFqTQ0NjU4MjM4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "136e9f78539f9f4cd2f3db50986400a194a77481", "author": {"user": {"login": "lukecwik", "name": "Lukasz Cwik"}}, "url": "https://github.com/apache/beam/commit/136e9f78539f9f4cd2f3db50986400a194a77481", "committedDate": "2020-07-09T18:58:56Z", "message": "[BEAM-9629] Fix several connection leak issues.\n\n* Make the default max connections to be unlimited. This mirrors the 2.17 and earlier behavior since we used to create one DataSource per execution thread (and hence one connection).\n* Move connection fetching to @ProcessElement to not hold a connection for empty bundles.\n* Make sure that finalize() closes the connection so that it is returned to the pool if the bundle fails."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NTI3OTQ5", "url": "https://github.com/apache/beam/pull/12209#pullrequestreview-446527949", "createdAt": "2020-07-10T16:14:59Z", "commit": {"oid": "136e9f78539f9f4cd2f3db50986400a194a77481"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNjoxNDo1OVrOGv9Tvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNjoxNDo1OVrOGv9Tvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk0MDczNA==", "bodyText": "Since this is a recurrent issue for users I am wondering if It would probably be good to add a snippet of how to achieve this (maybe in a subsequent PR since it is not exactly related).", "url": "https://github.com/apache/beam/pull/12209#discussion_r452940734", "createdAt": "2020-07-10T16:14:59Z", "author": {"login": "iemejia"}, "path": "sdks/java/io/jdbc/src/main/java/org/apache/beam/sdk/io/jdbc/JdbcIO.java", "diffHunk": "@@ -147,10 +147,10 @@\n  * );\n  * }</pre>\n  *\n- * By default, the provided function instantiates a DataSource per execution thread. In some\n- * circumstances, such as DataSources that have a pool of connections, this can quickly overwhelm\n- * the database by requesting too many connections. In that case you should make the DataSource a\n- * static singleton so it gets instantiated only once per JVM.\n+ * <p>By default, the provided function requests a DataSource per execution thread. In some\n+ * circumstances this can quickly overwhelm the database by requesting too many connections. In that\n+ * case you should look into sharing a single instance of a {@link PoolingDataSource} across all the\n+ * execution threads.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "136e9f78539f9f4cd2f3db50986400a194a77481"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NTgyMzgw", "url": "https://github.com/apache/beam/pull/12209#pullrequestreview-446582380", "createdAt": "2020-07-10T17:41:19Z", "commit": {"oid": "136e9f78539f9f4cd2f3db50986400a194a77481"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4006, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}