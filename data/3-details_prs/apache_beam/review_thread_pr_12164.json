{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzMzc2MDg3", "number": 12164, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMjo0MTo1MVrOEMRJKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMjo0MTo1MVrOEMRJKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMjk5MjQzOnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMjo0MTo1MVrOGuSGdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQwMDo1MToyOFrOGyWQKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE4NDI0NQ==", "bodyText": "Can we always assume default environment here ? What about x-lang WindowingStrategies ? Probably this can be tested by running a x-lang GBK test with Dataflow with a WindowingStrategy.", "url": "https://github.com/apache/beam/pull/12164#discussion_r451184245", "createdAt": "2020-07-07T22:41:51Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -864,7 +867,7 @@ def run_GroupByKey(self, transform_node, options):\n     windowing = transform_node.transform.get_windowing(transform_node.inputs)\n     step.add_property(\n         PropertyNames.SERIALIZED_FN,\n-        self.serialize_windowing_strategy(windowing))\n+        self.serialize_windowing_strategy(windowing, self._default_environment))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc65c023483ceca349e896d94b8bacb55cb45eed"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQzMDIwNA==", "bodyText": "No, we can't assume this. I don't know where this is being consumed.", "url": "https://github.com/apache/beam/pull/12164#discussion_r455430204", "createdAt": "2020-07-15T23:53:41Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -864,7 +867,7 @@ def run_GroupByKey(self, transform_node, options):\n     windowing = transform_node.transform.get_windowing(transform_node.inputs)\n     step.add_property(\n         PropertyNames.SERIALIZED_FN,\n-        self.serialize_windowing_strategy(windowing))\n+        self.serialize_windowing_strategy(windowing, self._default_environment))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE4NDI0NQ=="}, "originalCommit": {"oid": "cc65c023483ceca349e896d94b8bacb55cb45eed"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ0MTM3OQ==", "bodyText": "Heejong clarified that what we pass here is just the default.", "url": "https://github.com/apache/beam/pull/12164#discussion_r455441379", "createdAt": "2020-07-16T00:31:26Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -864,7 +867,7 @@ def run_GroupByKey(self, transform_node, options):\n     windowing = transform_node.transform.get_windowing(transform_node.inputs)\n     step.add_property(\n         PropertyNames.SERIALIZED_FN,\n-        self.serialize_windowing_strategy(windowing))\n+        self.serialize_windowing_strategy(windowing, self._default_environment))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE4NDI0NQ=="}, "originalCommit": {"oid": "cc65c023483ceca349e896d94b8bacb55cb45eed"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ0NDc5MA==", "bodyText": "But the default might not be the right thing here if this is from another language, right? I'd like to better understand where this is being used and what can go wrong if it's missing/incorrect.", "url": "https://github.com/apache/beam/pull/12164#discussion_r455444790", "createdAt": "2020-07-16T00:44:39Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -864,7 +867,7 @@ def run_GroupByKey(self, transform_node, options):\n     windowing = transform_node.transform.get_windowing(transform_node.inputs)\n     step.add_property(\n         PropertyNames.SERIALIZED_FN,\n-        self.serialize_windowing_strategy(windowing))\n+        self.serialize_windowing_strategy(windowing, self._default_environment))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE4NDI0NQ=="}, "originalCommit": {"oid": "cc65c023483ceca349e896d94b8bacb55cb45eed"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ0NjM2Nw==", "bodyText": "We simply use the environment passed here as the default environment for PipelineContext that is used when building the windowing proto: https://github.com/apache/beam/blob/master/sdks/python/apache_beam/runners/dataflow/dataflow_runner.py#L1411\nI think x-lang custom windowing fn does not work today. Heejong filed https://issues.apache.org/jira/browse/BEAM-10507. I'll look into this but I think this is less severe and does not affect Kafka.", "url": "https://github.com/apache/beam/pull/12164#discussion_r455446367", "createdAt": "2020-07-16T00:50:39Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -864,7 +867,7 @@ def run_GroupByKey(self, transform_node, options):\n     windowing = transform_node.transform.get_windowing(transform_node.inputs)\n     step.add_property(\n         PropertyNames.SERIALIZED_FN,\n-        self.serialize_windowing_strategy(windowing))\n+        self.serialize_windowing_strategy(windowing, self._default_environment))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE4NDI0NQ=="}, "originalCommit": {"oid": "cc65c023483ceca349e896d94b8bacb55cb45eed"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ0NjU2OA==", "bodyText": "@robertwb The only problematic scenario is when WindowingStrategy comes from different SDK and the proto doesn't have a value in environment_id field. In that case, the host SDK will populate the field with its default environment. But I think it shouldn't happen since it's expansion service's responsibility to pass a semantically correct proto.", "url": "https://github.com/apache/beam/pull/12164#discussion_r455446568", "createdAt": "2020-07-16T00:51:28Z", "author": {"login": "ihji"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -864,7 +867,7 @@ def run_GroupByKey(self, transform_node, options):\n     windowing = transform_node.transform.get_windowing(transform_node.inputs)\n     step.add_property(\n         PropertyNames.SERIALIZED_FN,\n-        self.serialize_windowing_strategy(windowing))\n+        self.serialize_windowing_strategy(windowing, self._default_environment))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE4NDI0NQ=="}, "originalCommit": {"oid": "cc65c023483ceca349e896d94b8bacb55cb45eed"}, "originalPosition": 51}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3465, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}