{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2MzE2NTUw", "number": 13273, "title": "[BEAM-11159] Use GCP pubsub client for TestPubsub", "bodyText": "The official GCP client has better tuned timeouts and retry configs for this application, using it should reduce flakiness.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-11-05T20:21:09Z", "url": "https://github.com/apache/beam/pull/13273", "merged": true, "mergeCommit": {"oid": "2c4c6ff942110fbf23b1e3417022503e0223ddc3"}, "closed": true, "closedAt": "2020-11-06T01:36:27Z", "author": {"login": "TheNeuralBit"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZoTz5gBqjM5NjQyNDc0NDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZr2BcABqjM5NjQ5NjU3NTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f81dc1c77b342572f351f100afac5891797f865b", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/f81dc1c77b342572f351f100afac5891797f865b", "committedDate": "2020-11-05T20:18:32Z", "message": "use GCP pubsub client for TestPubsub"}, "afterCommit": {"oid": "5f4378767d90cf580d39c8cee345bf635b31131e", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/5f4378767d90cf580d39c8cee345bf635b31131e", "committedDate": "2020-11-05T20:22:43Z", "message": "use GCP pubsub client for TestPubsub"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf3bcb21c33c5015cf5ac7e21b681c8af0fbb6ab", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/cf3bcb21c33c5015cf5ac7e21b681c8af0fbb6ab", "committedDate": "2020-11-05T22:12:37Z", "message": "use GCP pubsub client for TestPubsub"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0NzQ2NDIz", "url": "https://github.com/apache/beam/pull/13273#pullrequestreview-524746423", "createdAt": "2020-11-05T23:15:29Z", "commit": {"oid": "5f4378767d90cf580d39c8cee345bf635b31131e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMzoxNTozMFrOHuaUkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQyMzoxNTozMFrOHuaUkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQyNzc5Mg==", "bodyText": "Assert isn't guaranteed to run. Would something like org.apache.beam.sdk.util.Preconditions.checkArgumentNotNull be more appropriate?", "url": "https://github.com/apache/beam/pull/13273#discussion_r518427792", "createdAt": "2020-11-05T23:15:30Z", "author": {"login": "apilloud"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/TestPubsub.java", "diffHunk": "@@ -195,43 +227,46 @@ public SubscriptionPath subscriptionPath() {\n     return subscriptionPath;\n   }\n \n-  private List<SubscriptionPath> listSubscriptions(ProjectPath projectPath, TopicPath topicPath)\n-      throws IOException {\n-    return pubsub.listSubscriptions(projectPath, topicPath).stream()\n-        .filter((path) -> !path.equals(subscriptionPath))\n-        .collect(ImmutableList.toImmutableList());\n+  private Iterable<String> listSubscriptions(TopicPath topicPath) {\n+    assert topicAdmin != null;\n+    return topicAdmin.listTopicSubscriptions(topicPath.getPath()).iterateAll();\n   }\n \n   /** Publish messages to {@link #topicPath()}. */\n-  public void publish(List<PubsubMessage> messages) throws IOException {\n-    List<PubsubClient.OutgoingMessage> outgoingMessages =\n-        messages.stream().map(this::toOutgoingMessage).collect(toList());\n-    pubsub.publish(eventsTopicPath, outgoingMessages);\n-  }\n+  public void publish(List<PubsubMessage> messages) {\n+    assert eventsTopicPath != null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f4378767d90cf580d39c8cee345bf635b31131e"}, "originalPosition": 171}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d62ea2f1de9f2d642449605c0021116293a5cc4", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/7d62ea2f1de9f2d642449605c0021116293a5cc4", "committedDate": "2020-11-06T00:28:00Z", "message": "checkNotNull instead of assert"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5f4378767d90cf580d39c8cee345bf635b31131e", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/5f4378767d90cf580d39c8cee345bf635b31131e", "committedDate": "2020-11-05T20:22:43Z", "message": "use GCP pubsub client for TestPubsub"}, "afterCommit": {"oid": "7d62ea2f1de9f2d642449605c0021116293a5cc4", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/7d62ea2f1de9f2d642449605c0021116293a5cc4", "committedDate": "2020-11-06T00:28:00Z", "message": "checkNotNull instead of assert"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4705, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}