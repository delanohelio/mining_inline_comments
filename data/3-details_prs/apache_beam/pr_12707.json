{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0OTgxMjAy", "number": 12707, "title": "Identify pair-with-none DoFn in CombineGlobally with a named URN.", "bodyText": "Unfortunately, this is a bit messy as the Fn's defnition is split across\nboth the ParDo and DoFn instance, and we must maintain backwards compatibility\nwith the legacy runner.  For now only stateless functions are supported,\nbut this mechanism can be extended for arbitrary DoFns.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-27T22:19:24Z", "url": "https://github.com/apache/beam/pull/12707", "merged": true, "mergeCommit": {"oid": "c7e2710c7a3a3417b7b19292b4e26f33a42e91b8"}, "closed": true, "closedAt": "2020-09-03T20:43:52Z", "author": {"login": "robertwb"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDH-gYgH2gAyNDc0OTgxMjAyOjg2ZWM0MzBiN2ZjYTVjZjNlMGFhMTA3N2JlN2JjZjNmNTkyY2MzZjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFSzylgH2gAyNDc0OTgxMjAyOjZmODMyZDk5MTkzYWM2NDFjZjdhNjI0MDg0MjFlMzQwNzg3NGM1ZGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "86ec430b7fca5cf3e0aa1077be7bcf3f592cc3f5", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/86ec430b7fca5cf3e0aa1077be7bcf3f592cc3f5", "committedDate": "2020-08-27T22:16:37Z", "message": "Identify pair-with-none DoFn in CombineGlobally with a named URN.\n\nUnfortunately, this is a bit messy as the Fn's defnition is split across\nboth the ParDo and DoFn instance, and we must maintain backwards compatibility\nwith the legacy runner.  For now only stateless functions are supported,\nbut this mechanism can be extended for arbitrary DoFns."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODkwMjc5", "url": "https://github.com/apache/beam/pull/12707#pullrequestreview-477890279", "createdAt": "2020-08-28T17:03:04Z", "commit": {"oid": "86ec430b7fca5cf3e0aa1077be7bcf3f592cc3f5"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzowMzowNVrOHJOBRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzowMzowNVrOHJOBRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyODkzNA==", "bodyText": "optional: should this be named serialized_fn or serialized_dofn_data to match the naming in bundle_processor.py?", "url": "https://github.com/apache/beam/pull/12707#discussion_r479428934", "createdAt": "2020-08-28T17:03:05Z", "author": {"login": "yifanmai"}, "path": "sdks/python/apache_beam/transforms/core.py", "diffHunk": "@@ -1493,6 +1488,72 @@ def expand(self, pcoll):\n         pcoll.pipeline, self._do_transform, self._tags, self._main_tag)\n \n \n+class DoFnInfo(object):\n+  \"\"\"This class represents the state in the ParDoPayload's function spec,\n+  which is the actual DoFn together with some data required for invoking it.\n+  \"\"\"\n+  @staticmethod\n+  def register_stateless_dofn(urn):\n+    def wrapper(cls):\n+      StatelessDoFnInfo.REGISTERED_DOFNS[urn] = cls\n+      cls._stateless_dofn_urn = urn\n+      return cls\n+\n+    return wrapper\n+\n+  @classmethod\n+  def create(cls, fn, args, kwargs):\n+    if hasattr(fn, '_stateless_dofn_urn'):\n+      assert not args and not kwargs\n+      return StatelessDoFnInfo(fn._stateless_dofn_urn)\n+    else:\n+      return PickledDoFnInfo(cls._pickled_do_fn_info(fn, args, kwargs))\n+\n+  @staticmethod\n+  def from_runner_api(spec, unused_context):\n+    if spec.urn == python_urns.PICKLED_DOFN_INFO:\n+      return PickledDoFnInfo(spec.payload)\n+    elif spec.urn in StatelessDoFnInfo.REGISTERED_DOFNS:\n+      return StatelessDoFnInfo(spec.urn)\n+    else:\n+      raise ValueError('Unexpected DoFn type: %s' % spec.urn)\n+\n+  @staticmethod\n+  def _pickled_do_fn_info(fn, args, kwargs):\n+    # This can be cleaned up once all runners move to portability.\n+    return pickler.dumps((fn, args, kwargs, None, None))\n+\n+  def serialized_data(self):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86ec430b7fca5cf3e0aa1077be7bcf3f592cc3f5"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00fe11cb226f3a54c5feacae3436a7a74de314d3", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/00fe11cb226f3a54c5feacae3436a7a74de314d3", "committedDate": "2020-09-01T22:30:35Z", "message": "Merge branch 'master' into pair-with-none-urn"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "669ef25827ebce79b74c6f8f44b6523727681b99", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/669ef25827ebce79b74c6f8f44b6523727681b99", "committedDate": "2020-09-01T22:40:21Z", "message": "fix reverse translation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59edd8f44e43dea73810ad7ad8e977c1136bc7dd", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/59edd8f44e43dea73810ad7ad8e977c1136bc7dd", "committedDate": "2020-09-01T22:51:54Z", "message": "rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d7edca25cf351ca86aa22dcd18e98e3e6e62ad7", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/4d7edca25cf351ca86aa22dcd18e98e3e6e62ad7", "committedDate": "2020-09-01T22:53:23Z", "message": "lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f832d99193ac641cf7a62408421e3407874c5df", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/6f832d99193ac641cf7a62408421e3407874c5df", "committedDate": "2020-09-03T16:01:43Z", "message": "fix sensitive test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4518, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}