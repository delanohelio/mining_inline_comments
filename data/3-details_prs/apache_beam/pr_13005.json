{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3MTYxMjA4", "number": 13005, "title": "Add python schema inference docs", "bodyText": "R: @robertwb\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-10-02T22:27:16Z", "url": "https://github.com/apache/beam/pull/13005", "merged": true, "mergeCommit": {"oid": "f338284a374fa1216af240036aca8deebc526eea"}, "closed": true, "closedAt": "2020-10-07T23:47:04Z", "author": {"login": "TheNeuralBit"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOtsVuAH2gAyNDk3MTYxMjA4OmIzNzBiNGM0NTdlOTFlYWEwMzFjNmY4ZWRiZThiNGExOTZkZDY0NjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPn-nBgFqTUwMjMwNzYwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b370b4c457e91eaa031c6f8edbe8b4a196dd6461", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/b370b4c457e91eaa031c6f8edbe8b4a196dd6461", "committedDate": "2020-10-02T22:26:20Z", "message": "Add python schema inference docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMzA3NjA4", "url": "https://github.com/apache/beam/pull/13005#pullrequestreview-502307608", "createdAt": "2020-10-05T18:20:05Z", "commit": {"oid": "b370b4c457e91eaa031c6f8edbe8b4a196dd6461"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxODoyMDowNlrOHcoiWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxODoyMDowNlrOHcoiWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc4NjMzMA==", "bodyText": "Is it worth calling out Select as well?", "url": "https://github.com/apache/beam/pull/13005#discussion_r499786330", "createdAt": "2020-10-05T18:20:06Z", "author": {"login": "robertwb"}, "path": "website/www/site/content/en/documentation/programming-guide.md", "diffHunk": "@@ -2546,10 +2611,68 @@ public abstract class TransactionValue {\n }\n {{< /highlight >}}\n \n+{{< paragraph class=\"language-java\" >}}\n This is all that\u2019s needed to generate a simple AutoValue class, and the above `@DefaultSchema` annotation tells Beam to\n infer a schema from it. This also allows AutoValue elements to be used inside of `PCollection`s.\n+{{< /paragraph >}}\n \n+{{< paragraph class=\"language-java\" >}}\n `@SchemaFieldName` and `@SchemaIgnore` can be used to alter the schema inferred.\n+{{< /paragraph >}}\n+\n+{{< paragraph class=\"language-py\" >}}\n+Beam has a few different mechanisms for inferring schemas from Python code.\n+{{< /paragraph >}}\n+\n+{{< paragraph class=\"language-py\" >}}\n+**NamedTuple classes**\n+{{< /paragraph >}}\n+\n+{{< paragraph class=\"language-py\" >}}\n+A [NamedTuple](https://docs.python.org/3/library/typing.html#typing.NamedTuple)\n+class is a Python class that wraps a `tuple`, assigning a name to each element\n+and restricting it to a particular type. Beam will automatically infer the\n+schema for PCollections with `NamedTuple` output types. For example:\n+{{< /paragraph >}}\n+\n+{{< highlight py >}}\n+class Transaction(typing.NamedTuple):\n+  bank: str\n+  purchase_amount: float\n+\n+pc = input | beam.Map(lambda ...).with_output_types(Transaction)\n+{{< /highlight >}}\n+\n+\n+{{< paragraph class=\"language-py\" >}}\n+**beam.Row**\n+{{< /paragraph >}}\n+\n+{{< paragraph class=\"language-py\" >}}\n+It's also possible to create ad-hoc schema declarations with a simple lambda\n+that returns instances of `beam.Row`:\n+{{< /paragraph >}}\n+\n+{{< highlight py >}}\n+input_pc = ... # {\"bank\": ..., \"purchase_amount\": ...}\n+output_pc = input_pc | beam.Map(lambda item: beam.Row(bank=item[\"bank\"],\n+                                                      purchase_amount=item[\"purchase_amount\"])\n+{{< /highlight >}}\n+\n+{{< paragraph class=\"language-py\" >}}\n+Note that this declaration doesn't include any specific information about the\n+types of the `bank` and `purchase_amount` fields. Beam will attempt to infer\n+type information, if it's unable to it will fall back to the generic type\n+`Any`. Sometimes this is not ideal, you can use casts to make sure Beam\n+correctly infers types with `beam.Row`:\n+{{< /paragraph >}}\n+\n+{{< highlight py >}}\n+input_pc = ... # {\"bank\": ..., \"purchase_amount\": ...}\n+output_pc = input_pc | beam.Map(lambda item: beam.Row(bank=str(item[\"bank\"]),\n+                                                      purchase_amount=float(item[\"purchase_amount\"]))\n+{{< /highlight >}}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b370b4c457e91eaa031c6f8edbe8b4a196dd6461"}, "originalPosition": 270}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2267, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}