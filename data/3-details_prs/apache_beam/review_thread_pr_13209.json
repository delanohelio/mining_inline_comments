{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExMTc0NDkz", "number": 13209, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwNjoxODoyMlrOEzJfYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwNjoxODoyMlrOEzJfYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMDY4MzIyOnYy", "diffSide": "RIGHT", "path": "sdks/go/pkg/beam/coder_test.go", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwNjoxODoyMlrOHqMsAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxOToyMzo0MFrOHqrLQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDAxMDExNQ==", "bodyText": "Is the %v in the format string supposed to be the error? It reads like it's meant to output the expected decoded value (i.e. test).", "url": "https://github.com/apache/beam/pull/13209#discussion_r514010115", "createdAt": "2020-10-29T06:18:22Z", "author": {"login": "youngoli"}, "path": "sdks/go/pkg/beam/coder_test.go", "diffHunk": "@@ -75,46 +134,51 @@ func TestCoders(t *testing.T) {\n \t\t1,\n \t\ttrue,\n \t\t\"a string\",\n-\t\tmap[int64]string{1: \"one\", 11: \"oneone\", 21: \"twoone\", 1211: \"onetwooneone\"},\n+\t\tmap[int64]string{1: \"one\", 11: \"oneone\", 21: \"twoone\", 1211: \"onetwooneone\"}, // (not supported by custom type registration)\n \t\tstruct {\n \t\t\tA int\n \t\t\tB *string\n \t\t\tC bool\n \t\t}{4, &ptrString, false},\n-\t\t[...]int64{1, 2, 3, 4, 5}, // array\n+\t\t[...]int64{1, 2, 3, 4, 5}, // array (not supported by custom type registration)\n \t\t[]int64{1, 2, 3, 4, 5},    // slice\n \t\tstruct {\n \t\t\tA []int\n \t\t\tB [3]int\n \t\t}{A: []int{1, 2, 3}, B: [...]int{4, 5, 6}},\n+\t\t[...]struct{ A int }{{1}, {2}, {3}, {4}, {5}},\n+\t\t[]struct{ B int }{{1}, {2}, {3}, {4}, {5}},\n+\t\tregTestType{[4]int{4, 2, 4, 2}},\n \t}\n \n \tfor _, test := range tests {\n-\t\tvar results []string\n-\t\trt := reflect.TypeOf(test)\n-\t\tenc := NewElementEncoder(rt)\n-\t\tfor i := 0; i < 10; i++ {\n-\t\t\tvar buf bytes.Buffer\n-\t\t\tif err := enc.Encode(test, &buf); err != nil {\n-\t\t\t\tt.Fatalf(\"Failed to encode %v: %v\", tests, err)\n+\t\tt.Run(fmt.Sprintf(\"%T\", test), func(t *testing.T) {\n+\t\t\tvar results []string\n+\t\t\trt := reflect.TypeOf(test)\n+\t\t\tenc := NewElementEncoder(rt)\n+\t\t\tfor i := 0; i < 10; i++ {\n+\t\t\t\tvar buf bytes.Buffer\n+\t\t\t\tif err := enc.Encode(test, &buf); err != nil {\n+\t\t\t\t\tt.Fatalf(\"Failed to encode %v: %v\", test, err)\n+\t\t\t\t}\n+\t\t\t\tresults = append(results, string(buf.Bytes()))\n \t\t\t}\n-\t\t\tresults = append(results, string(buf.Bytes()))\n-\t\t}\n-\t\tfor i, d := range results {\n-\t\t\tif d != results[0] {\n-\t\t\t\tt.Errorf(\"coder not deterministic: encoding %d not the same as the first encoding: %v != %v \", i, d, results[0])\n+\t\t\tfor i, d := range results {\n+\t\t\t\tif d != results[0] {\n+\t\t\t\t\tt.Errorf(\"coder not deterministic: encoding %d not the same as the first encoding: %v != %v \", i, d, results[0])\n+\t\t\t\t}\n \t\t\t}\n-\t\t}\n \n-\t\tdec := NewElementDecoder(rt)\n-\t\tbuf := bytes.NewBuffer([]byte(results[0]))\n-\t\tdecoded, err := dec.Decode(buf)\n-\t\tif err != nil {\n-\t\t\tt.Fatalf(\"Failed to decode: %v\", err)\n-\t\t}\n+\t\t\tdec := NewElementDecoder(rt)\n+\t\t\tbuf := bytes.NewBuffer([]byte(results[0]))\n+\t\t\tdecoded, err := dec.Decode(buf)\n+\t\t\tif err != nil {\n+\t\t\t\tt.Fatalf(\"Failed to decode: %q, into %v\", results[0], err)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71a7459ce4eec30bcfad726a45e85f5b9b82b686"}, "originalPosition": 150}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUwOTYzMg==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/13209#discussion_r514509632", "createdAt": "2020-10-29T19:23:40Z", "author": {"login": "lostluck"}, "path": "sdks/go/pkg/beam/coder_test.go", "diffHunk": "@@ -75,46 +134,51 @@ func TestCoders(t *testing.T) {\n \t\t1,\n \t\ttrue,\n \t\t\"a string\",\n-\t\tmap[int64]string{1: \"one\", 11: \"oneone\", 21: \"twoone\", 1211: \"onetwooneone\"},\n+\t\tmap[int64]string{1: \"one\", 11: \"oneone\", 21: \"twoone\", 1211: \"onetwooneone\"}, // (not supported by custom type registration)\n \t\tstruct {\n \t\t\tA int\n \t\t\tB *string\n \t\t\tC bool\n \t\t}{4, &ptrString, false},\n-\t\t[...]int64{1, 2, 3, 4, 5}, // array\n+\t\t[...]int64{1, 2, 3, 4, 5}, // array (not supported by custom type registration)\n \t\t[]int64{1, 2, 3, 4, 5},    // slice\n \t\tstruct {\n \t\t\tA []int\n \t\t\tB [3]int\n \t\t}{A: []int{1, 2, 3}, B: [...]int{4, 5, 6}},\n+\t\t[...]struct{ A int }{{1}, {2}, {3}, {4}, {5}},\n+\t\t[]struct{ B int }{{1}, {2}, {3}, {4}, {5}},\n+\t\tregTestType{[4]int{4, 2, 4, 2}},\n \t}\n \n \tfor _, test := range tests {\n-\t\tvar results []string\n-\t\trt := reflect.TypeOf(test)\n-\t\tenc := NewElementEncoder(rt)\n-\t\tfor i := 0; i < 10; i++ {\n-\t\t\tvar buf bytes.Buffer\n-\t\t\tif err := enc.Encode(test, &buf); err != nil {\n-\t\t\t\tt.Fatalf(\"Failed to encode %v: %v\", tests, err)\n+\t\tt.Run(fmt.Sprintf(\"%T\", test), func(t *testing.T) {\n+\t\t\tvar results []string\n+\t\t\trt := reflect.TypeOf(test)\n+\t\t\tenc := NewElementEncoder(rt)\n+\t\t\tfor i := 0; i < 10; i++ {\n+\t\t\t\tvar buf bytes.Buffer\n+\t\t\t\tif err := enc.Encode(test, &buf); err != nil {\n+\t\t\t\t\tt.Fatalf(\"Failed to encode %v: %v\", test, err)\n+\t\t\t\t}\n+\t\t\t\tresults = append(results, string(buf.Bytes()))\n \t\t\t}\n-\t\t\tresults = append(results, string(buf.Bytes()))\n-\t\t}\n-\t\tfor i, d := range results {\n-\t\t\tif d != results[0] {\n-\t\t\t\tt.Errorf(\"coder not deterministic: encoding %d not the same as the first encoding: %v != %v \", i, d, results[0])\n+\t\t\tfor i, d := range results {\n+\t\t\t\tif d != results[0] {\n+\t\t\t\t\tt.Errorf(\"coder not deterministic: encoding %d not the same as the first encoding: %v != %v \", i, d, results[0])\n+\t\t\t\t}\n \t\t\t}\n-\t\t}\n \n-\t\tdec := NewElementDecoder(rt)\n-\t\tbuf := bytes.NewBuffer([]byte(results[0]))\n-\t\tdecoded, err := dec.Decode(buf)\n-\t\tif err != nil {\n-\t\t\tt.Fatalf(\"Failed to decode: %v\", err)\n-\t\t}\n+\t\t\tdec := NewElementDecoder(rt)\n+\t\t\tbuf := bytes.NewBuffer([]byte(results[0]))\n+\t\t\tdecoded, err := dec.Decode(buf)\n+\t\t\tif err != nil {\n+\t\t\t\tt.Fatalf(\"Failed to decode: %q, into %v\", results[0], err)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDAxMDExNQ=="}, "originalCommit": {"oid": "71a7459ce4eec30bcfad726a45e85f5b9b82b686"}, "originalPosition": 150}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2864, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}