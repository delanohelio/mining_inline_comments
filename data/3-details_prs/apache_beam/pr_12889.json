{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNDM4Mzk5", "number": 12889, "title": "Dataframe wordcount example.", "bodyText": "Also add reference in release notes.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-09-21T17:03:53Z", "url": "https://github.com/apache/beam/pull/12889", "merged": true, "mergeCommit": {"oid": "096f695f8054bb9d99f618ed50bed1dd66b0c7c5"}, "closed": true, "closedAt": "2020-09-22T00:43:52Z", "author": {"login": "robertwb"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLGhZvgBqjM3ODk3MDY5MDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLMZhCABqjM3OTEwMDYxNjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56979663ab47b5d607121b0ad537114aa9d17854", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/56979663ab47b5d607121b0ad537114aa9d17854", "committedDate": "2020-09-21T17:03:04Z", "message": "Update changes file."}, "afterCommit": {"oid": "0bd0e4481c7484b8994524bc83a671eee2e05f56", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/0bd0e4481c7484b8994524bc83a671eee2e05f56", "committedDate": "2020-09-21T17:06:12Z", "message": "Update changes file."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODQ1NTc2", "url": "https://github.com/apache/beam/pull/12889#pullrequestreview-492845576", "createdAt": "2020-09-21T17:46:45Z", "commit": {"oid": "0bd0e4481c7484b8994524bc83a671eee2e05f56"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzo0Njo0NVrOHVb6BA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzo0Njo0NVrOHVb6BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIzOTM2NA==", "bodyText": "Maybe use Select here?", "url": "https://github.com/apache/beam/pull/12889#discussion_r492239364", "createdAt": "2020-09-21T17:46:45Z", "author": {"login": "TheNeuralBit"}, "path": "sdks/python/apache_beam/examples/wordcount_dataframe.py", "diffHunk": "@@ -0,0 +1,73 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+\"\"\"A word-counting workflow using dataframes.\"\"\"\n+\n+# pytype: skip-file\n+\n+from __future__ import absolute_import\n+\n+import argparse\n+import logging\n+\n+import apache_beam as beam\n+from apache_beam.dataframe import io\n+from apache_beam.dataframe.convert import to_dataframe\n+from apache_beam.io import ReadFromText\n+from apache_beam.options.pipeline_options import PipelineOptions\n+\n+\n+def run(argv=None):\n+  \"\"\"Main entry point; defines and runs the wordcount pipeline.\"\"\"\n+  parser = argparse.ArgumentParser()\n+  parser.add_argument(\n+      '--input',\n+      dest='input',\n+      default='gs://dataflow-samples/shakespeare/kinglear.txt',\n+      help='Input file to process.')\n+  parser.add_argument(\n+      '--output',\n+      dest='output',\n+      required=True,\n+      help='Output file to write results to.')\n+  known_args, pipeline_args = parser.parse_known_args(argv)\n+\n+  # Import this here to avoid pickling the main session.\n+  import re\n+\n+  # The pipeline will be run on exiting the with block.\n+  with beam.Pipeline(options=PipelineOptions(pipeline_args)) as p:\n+\n+    # Read the text file[pattern] into a PCollection.\n+    lines = p | 'Read' >> ReadFromText(known_args.input)\n+\n+    words = (\n+        lines\n+        | 'Split' >> beam.FlatMap(\n+            lambda line: re.findall(r'[\\w]+', line)).with_output_types(str)\n+        # Map to Row objects to generate a schema suitable for conversion to a dataframe.\n+        | 'ToRows' >> beam.Map(lambda word: beam.Row(word=word)))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bd0e4481c7484b8994524bc83a671eee2e05f56"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyODQ3NzE5", "url": "https://github.com/apache/beam/pull/12889#pullrequestreview-492847719", "createdAt": "2020-09-21T17:49:44Z", "commit": {"oid": "0bd0e4481c7484b8994524bc83a671eee2e05f56"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzo0OTo0NVrOHVcAnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzo1MTowNVrOHVcDlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI0MTA1Mw==", "bodyText": "It could be nice to tee the counted back to a PCollection and print it as an example of to_pcollection. That's easier to do once unbatching is the default, I can add it as part of #12882 WDYT?", "url": "https://github.com/apache/beam/pull/12889#discussion_r492241053", "createdAt": "2020-09-21T17:49:45Z", "author": {"login": "TheNeuralBit"}, "path": "sdks/python/apache_beam/examples/wordcount_dataframe.py", "diffHunk": "@@ -0,0 +1,73 @@\n+#\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#    http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+#\n+\n+\"\"\"A word-counting workflow using dataframes.\"\"\"\n+\n+# pytype: skip-file\n+\n+from __future__ import absolute_import\n+\n+import argparse\n+import logging\n+\n+import apache_beam as beam\n+from apache_beam.dataframe import io\n+from apache_beam.dataframe.convert import to_dataframe\n+from apache_beam.io import ReadFromText\n+from apache_beam.options.pipeline_options import PipelineOptions\n+\n+\n+def run(argv=None):\n+  \"\"\"Main entry point; defines and runs the wordcount pipeline.\"\"\"\n+  parser = argparse.ArgumentParser()\n+  parser.add_argument(\n+      '--input',\n+      dest='input',\n+      default='gs://dataflow-samples/shakespeare/kinglear.txt',\n+      help='Input file to process.')\n+  parser.add_argument(\n+      '--output',\n+      dest='output',\n+      required=True,\n+      help='Output file to write results to.')\n+  known_args, pipeline_args = parser.parse_known_args(argv)\n+\n+  # Import this here to avoid pickling the main session.\n+  import re\n+\n+  # The pipeline will be run on exiting the with block.\n+  with beam.Pipeline(options=PipelineOptions(pipeline_args)) as p:\n+\n+    # Read the text file[pattern] into a PCollection.\n+    lines = p | 'Read' >> ReadFromText(known_args.input)\n+\n+    words = (\n+        lines\n+        | 'Split' >> beam.FlatMap(\n+            lambda line: re.findall(r'[\\w]+', line)).with_output_types(str)\n+        # Map to Row objects to generate a schema suitable for conversion to a dataframe.\n+        | 'ToRows' >> beam.Map(lambda word: beam.Row(word=word)))\n+\n+    df = to_dataframe(words)\n+    df['count'] = 1\n+    counted = df.groupby('word').sum()\n+    counted.to_csv(known_args.output)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bd0e4481c7484b8994524bc83a671eee2e05f56"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI0MTgxNQ==", "bodyText": "Should this comment be part of the Dataframes note above? I don't think pandas 1.x support has any broader implications", "url": "https://github.com/apache/beam/pull/12889#discussion_r492241815", "createdAt": "2020-09-21T17:51:05Z", "author": {"login": "TheNeuralBit"}, "path": "CHANGES.md", "diffHunk": "@@ -71,11 +71,14 @@\n     More details will be in an upcoming [blog post](https://beam.apache.org/blog/python-improved-annotations/index.html).\n * Improved the Interactive Beam API where recording streaming jobs now start a long running background recording job. Running ib.show() or ib.collect() samples from the recording ([BEAM-10603](https://issues.apache.org/jira/browse/BEAM-10603)).\n * In Interactive Beam, ib.show() and ib.collect() now have \"n\" and \"duration\" as parameters. These mean read only up to \"n\" elements and up to \"duration\" seconds of data read from the recording ([BEAM-10603](https://issues.apache.org/jira/browse/BEAM-10603)).\n+* Initial preview of [Dataframes](https://s.apache.org/simpler-python-pipelines-2020#slide=id.g905ac9257b_1_21) support.\n+    See also example at apache_beam/examples/wordcount_dataframe.py\n * X feature added (Java/Python) ([BEAM-X](https://issues.apache.org/jira/browse/BEAM-X)).\n \n ## Breaking Changes\n \n-* X behavior was changed ([BEAM-X](https://issues.apache.org/jira/browse/BEAM-X)).\n+* Python 2 and Python 3.5 support dropped.\n+* Pandas 1.x allowed.  Older version of Pandas may still be used, but may not be as well tested.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bd0e4481c7484b8994524bc83a671eee2e05f56"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0bd0e4481c7484b8994524bc83a671eee2e05f56", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/0bd0e4481c7484b8994524bc83a671eee2e05f56", "committedDate": "2020-09-21T17:06:12Z", "message": "Update changes file."}, "afterCommit": {"oid": "895f222435c233ea05f83d58d56112f276b11280", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/895f222435c233ea05f83d58d56112f276b11280", "committedDate": "2020-09-21T19:13:37Z", "message": "Update changes file."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd69312120d7a68d899f6cedacf18991dfddf2fb", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/cd69312120d7a68d899f6cedacf18991dfddf2fb", "committedDate": "2020-09-21T23:55:54Z", "message": "Dataframe wordcount example."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4146e55fd49bd3240135f7675121a21cb071f78a", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/4146e55fd49bd3240135f7675121a21cb071f78a", "committedDate": "2020-09-21T23:56:56Z", "message": "Update changes file."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "895f222435c233ea05f83d58d56112f276b11280", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/895f222435c233ea05f83d58d56112f276b11280", "committedDate": "2020-09-21T19:13:37Z", "message": "Update changes file."}, "afterCommit": {"oid": "4146e55fd49bd3240135f7675121a21cb071f78a", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/4146e55fd49bd3240135f7675121a21cb071f78a", "committedDate": "2020-09-21T23:56:56Z", "message": "Update changes file."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2425, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}