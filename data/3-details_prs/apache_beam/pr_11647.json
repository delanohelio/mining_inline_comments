{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NDc4MDc0", "number": 11647, "title": "[BEAM-9884] Add options to SqlTransform for specifying planner", "bodyText": "Adds SqlTransform#withQueryPlannerClass(Class<? extends QueryPlanner> clazz) For overriding the query planner specified in PipelineOptions.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-05-08T23:50:39Z", "url": "https://github.com/apache/beam/pull/11647", "merged": true, "mergeCommit": {"oid": "d908a756b56a32150b171ca3316307e9d6d25b3b"}, "closed": true, "closedAt": "2020-05-11T21:41:44Z", "author": {"login": "TheNeuralBit"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfap1xAH2gAyNDE1NDc4MDc0OjcxOTg3MjNmOTRlYjA1ODc5YTQ1OTY5ZGRiY2I5OWRjYjA2ZDg5N2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgVUbtgFqTQwOTQ4NzkwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7198723f94eb05879a45969ddbcb99dcb06d897a", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/7198723f94eb05879a45969ddbcb99dcb06d897a", "committedDate": "2020-05-08T23:40:58Z", "message": "Add options to SqlTransform for specifying planner"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MzY4Mjky", "url": "https://github.com/apache/beam/pull/11647#pullrequestreview-409368292", "createdAt": "2020-05-11T17:13:35Z", "commit": {"oid": "7198723f94eb05879a45969ddbcb99dcb06d897a"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzoxMzozNVrOGTlnXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQxNzoxNjozOVrOGTlvPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5MjQxNQ==", "bodyText": "Can you add some comments here or in class comment so clarify the ordering of getting planner names? E.g. get the class name set in SqlTransform first and the try pipeline options.", "url": "https://github.com/apache/beam/pull/11647#discussion_r423192415", "createdAt": "2020-05-11T17:13:35Z", "author": {"login": "amaliujia"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -103,6 +105,8 @@\n \n   abstract @Nullable String defaultTableProvider();\n \n+  abstract @Nullable String queryPlannerClassName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7198723f94eb05879a45969ddbcb99dcb06d897a"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5MzU2Ng==", "bodyText": "Can you add a test to show when withQueryPlannerClass(ZetaSQLQueryPlanner.class) is not used and BeamSqlPipelineOptions is set (to test that the ordering of finding the planner name is working).", "url": "https://github.com/apache/beam/pull/11647#discussion_r423193566", "createdAt": "2020-05-11T17:15:23Z", "author": {"login": "amaliujia"}, "path": "sdks/java/extensions/sql/zetasql/src/test/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSQLDialectSpecTest.java", "diffHunk": "@@ -144,6 +145,34 @@ public void testSimpleSelect() {\n     pipeline.run().waitUntilFinish(Duration.standardMinutes(PIPELINE_EXECUTION_WAITTIME_MINUTES));\n   }\n \n+  @Test\n+  public void testSimpleSelectWithPlannerName() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7198723f94eb05879a45969ddbcb99dcb06d897a"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE5NDQyOQ==", "bodyText": "Do you think if it is helpful to find a \"working\" class name, rather than a \"non null\" parameter? (meaning that try first class name even if it is non-null, if there is an exception, try the next one.)", "url": "https://github.com/apache/beam/pull/11647#discussion_r423194429", "createdAt": "2020-05-11T17:16:39Z", "author": {"login": "amaliujia"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -123,7 +127,9 @@\n     }\n \n     sqlEnvBuilder.setQueryPlannerClassName(\n-        input.getPipeline().getOptions().as(BeamSqlPipelineOptions.class).getPlannerName());\n+        MoreObjects.firstNonNull(\n+            queryPlannerClassName(),\n+            input.getPipeline().getOptions().as(BeamSqlPipelineOptions.class).getPlannerName()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7198723f94eb05879a45969ddbcb99dcb06d897a"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f09e325f47b395652526c44c36ba9e11a0c9a19d", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/f09e325f47b395652526c44c36ba9e11a0c9a19d", "committedDate": "2020-05-11T19:42:19Z", "message": "Add doc about setting query planner"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16aef378e14e19e144930cedd6775d8b28900b1c", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/16aef378e14e19e144930cedd6775d8b28900b1c", "committedDate": "2020-05-11T19:43:18Z", "message": "Add test verifying plannerName pipeline option"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NDg3OTA2", "url": "https://github.com/apache/beam/pull/11647#pullrequestreview-409487906", "createdAt": "2020-05-11T20:01:59Z", "commit": {"oid": "16aef378e14e19e144930cedd6775d8b28900b1c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4910, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}