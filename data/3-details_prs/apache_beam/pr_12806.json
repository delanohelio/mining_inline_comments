{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzMzQ3OTE0", "number": 12806, "title": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2", "bodyText": "Please add a meaningful description for your change here\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-09-10T04:05:44Z", "url": "https://github.com/apache/beam/pull/12806", "merged": true, "mergeCommit": {"oid": "c9e2580d91fe8aa0abfa1de26af8e66cf2739efc"}, "closed": true, "closedAt": "2020-10-29T19:12:12Z", "author": {"login": "boyuanzz"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHlKVkgFqTQ4NjIwNDA2NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXXCQ7gFqTUxOTk4OTE0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MjA0MDY1", "url": "https://github.com/apache/beam/pull/12806#pullrequestreview-486204065", "createdAt": "2020-09-10T18:26:59Z", "commit": {"oid": "c9490a614bbe4a5418a23b65025bb27e043501a6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxODoyNjo1OVrOHQAoNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQxODoyNjo1OVrOHQAoNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjU0OTU1OQ==", "bodyText": "Won't this break pipeline update?\nAlso, the implementation only uses the payload so I don't think we need the TODO since we don't use any of the other attributes from the message so we can leave a comment here stating instead that the unbounded sink only uses the payload of the pubsub message.", "url": "https://github.com/apache/beam/pull/12806#discussion_r486549559", "createdAt": "2020-09-10T18:26:59Z", "author": {"login": "lukecwik"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/PubsubIO.java", "diffHunk": "@@ -1012,6 +1012,8 @@ public PDone expand(PCollection<T> input) {\n         case UNBOUNDED:\n           return input\n               .apply(MapElements.into(new TypeDescriptor<PubsubMessage>() {}).via(getFormatFn()))\n+              // TODO(BEAM-10869): Also plump through PubsubMessageWithAttributesCoder if needed.\n+              .setCoder(PubsubMessagePayloadOnlyCoder.of())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9490a614bbe4a5418a23b65025bb27e043501a6"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56bd01364a2511032a3deeaa0b5f398f81ae3954", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/56bd01364a2511032a3deeaa0b5f398f81ae3954", "committedDate": "2020-09-10T20:39:12Z", "message": "Only set coder when with runner_v2"}, "afterCommit": {"oid": "89f4beb36bd8b01747cdefbee1ceb7315f0a7bd9", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/89f4beb36bd8b01747cdefbee1ceb7315f0a7bd9", "committedDate": "2020-09-10T20:48:46Z", "message": "Only set coder when with runner_v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MTM2ODk3", "url": "https://github.com/apache/beam/pull/12806#pullrequestreview-488136897", "createdAt": "2020-09-14T20:59:35Z", "commit": {"oid": "89f4beb36bd8b01747cdefbee1ceb7315f0a7bd9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQyMDo1OTozNVrOHRmX1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQyMDo1OTozNVrOHRmX1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIxNjUzNQ==", "bodyText": "I think this should be \"beam_fn_api\" || \"use_runner_v2\" || \"use_unified_worker\"\nAlso, can we use the full pubsub with message attributes coder, this will allow for future changes to the PubsubUnboundedSink without needing to break update compatibility", "url": "https://github.com/apache/beam/pull/12806#discussion_r488216535", "createdAt": "2020-09-14T20:59:35Z", "author": {"login": "lukecwik"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/PubsubIO.java", "diffHunk": "@@ -1010,20 +1011,27 @@ public PDone expand(PCollection<T> input) {\n                           getMaxBatchBytesSize(), MAX_PUBLISH_BATCH_BYTE_SIZE_DEFAULT))));\n           return PDone.in(input.getPipeline());\n         case UNBOUNDED:\n-          return input\n-              .apply(MapElements.into(new TypeDescriptor<PubsubMessage>() {}).via(getFormatFn()))\n-              .apply(\n-                  new PubsubUnboundedSink(\n-                      getPubsubClientFactory(),\n-                      NestedValueProvider.of(getTopicProvider(), new TopicPathTranslator()),\n-                      getTimestampAttribute(),\n-                      getIdAttribute(),\n-                      100 /* numShards */,\n-                      MoreObjects.firstNonNull(\n-                          getMaxBatchSize(), PubsubUnboundedSink.DEFAULT_PUBLISH_BATCH_SIZE),\n-                      MoreObjects.firstNonNull(\n-                          getMaxBatchBytesSize(),\n-                          PubsubUnboundedSink.DEFAULT_PUBLISH_BATCH_BYTES)));\n+          PCollection<PubsubMessage> output =\n+              input.apply(\n+                  MapElements.into(new TypeDescriptor<PubsubMessage>() {}).via(getFormatFn()));\n+          if (ExperimentalOptions.hasExperiment(input.getPipeline().getOptions(), \"beam_fn_api\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f4beb36bd8b01747cdefbee1ceb7315f0a7bd9"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89f4beb36bd8b01747cdefbee1ceb7315f0a7bd9", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/89f4beb36bd8b01747cdefbee1ceb7315f0a7bd9", "committedDate": "2020-09-10T20:48:46Z", "message": "Only set coder when with runner_v2"}, "afterCommit": {"oid": "60b0229666a32b2af9face06f48e38676003322a", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/60b0229666a32b2af9face06f48e38676003322a", "committedDate": "2020-09-15T17:34:04Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MzE3ODQ3", "url": "https://github.com/apache/beam/pull/12806#pullrequestreview-489317847", "createdAt": "2020-09-16T06:42:58Z", "commit": {"oid": "d01ad96340e193dd9eec38785e7502e4ab5c61ab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNjo0Mjo1OFrOHSiV5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwNjo0Mjo1OFrOHSiV5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE5OTA3Ng==", "bodyText": "Update the pydoc for 'with_attributes' property above ?", "url": "https://github.com/apache/beam/pull/12806#discussion_r489199076", "createdAt": "2020-09-16T06:42:58Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/io/gcp/pubsub.py", "diffHunk": "@@ -299,12 +299,7 @@ def to_proto_str(element):\n     return element._to_proto_str()\n \n   def expand(self, pcoll):\n-    if self.with_attributes:\n-      pcoll = pcoll | 'ToProtobuf' >> Map(self.to_proto_str)\n-\n-    # Without attributes, message data is written as-is. With attributes,\n-    # message data + attributes are passed as a serialized protobuf string (see\n-    # ``PubsubMessage._to_proto_str`` for exact protobuf message type).\n+    pcoll = pcoll | 'ToProtobuf' >> Map(self.to_proto_str)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d01ad96340e193dd9eec38785e7502e4ab5c61ab"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMDkwNzA4", "url": "https://github.com/apache/beam/pull/12806#pullrequestreview-490090708", "createdAt": "2020-09-16T23:46:47Z", "commit": {"oid": "1d7cf1cf1c31a8af379020714f345ec315df3f1c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMzo0Njo0OFrOHTH3rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMzo0Njo0OFrOHTH3rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTgxMzkzNA==", "bodyText": "This is fine but probably means that we'll have to keep the with_attributes property in PubSubWritePayload to properly reconstruct the transforms from the proto.", "url": "https://github.com/apache/beam/pull/12806#discussion_r489813934", "createdAt": "2020-09-16T23:46:48Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/io/gcp/pubsub.py", "diffHunk": "@@ -290,21 +290,26 @@ def __init__(self,\n         topic, id_label, with_attributes, timestamp_attribute)\n \n   @staticmethod\n-  def to_proto_str(element):\n+  def message_to_proto_str(element):\n     # type: (PubsubMessage) -> bytes\n     if not isinstance(element, PubsubMessage):\n       raise TypeError(\n           'Unexpected element. Type: %s (expected: PubsubMessage), '\n           'value: %r' % (type(element), element))\n     return element._to_proto_str()\n \n+  @staticmethod\n+  def bytes_to_proto_str(element):\n+    # type: (bytes) -> bytes\n+    msg = pubsub.types.pubsub_pb2.PubsubMessage()\n+    msg.data = element\n+    return msg.SerializeToString()\n+\n   def expand(self, pcoll):\n     if self.with_attributes:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d7cf1cf1c31a8af379020714f345ec315df3f1c"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1d7cf1cf1c31a8af379020714f345ec315df3f1c", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/1d7cf1cf1c31a8af379020714f345ec315df3f1c", "committedDate": "2020-09-16T17:51:14Z", "message": "Update python pubsub write regarding to with_attributes."}, "afterCommit": {"oid": "bcdc93239aefab09d5b2f544882205f501ba38cc", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/bcdc93239aefab09d5b2f544882205f501ba38cc", "committedDate": "2020-09-17T20:38:54Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzYyNzM4", "url": "https://github.com/apache/beam/pull/12806#pullrequestreview-491762738", "createdAt": "2020-09-18T20:30:26Z", "commit": {"oid": "bcdc93239aefab09d5b2f544882205f501ba38cc"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozMDoyNlrOHUa_pQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozNTo1OVrOHUbI_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3NTg0NQ==", "bodyText": "Using the Write transform that consumes the Pubsub proto after formatting should be the well known transform represented by the PubSubWritePayload and not the WriteToPubSub transform as it contains an ambiguous input type.", "url": "https://github.com/apache/beam/pull/12806#discussion_r491175845", "createdAt": "2020-09-18T20:30:26Z", "author": {"login": "lukecwik"}, "path": "sdks/python/apache_beam/io/gcp/pubsub.py", "diffHunk": "@@ -290,21 +290,26 @@ def __init__(self,\n         topic, id_label, with_attributes, timestamp_attribute)\n \n   @staticmethod\n-  def to_proto_str(element):\n+  def message_to_proto_str(element):\n     # type: (PubsubMessage) -> bytes\n     if not isinstance(element, PubsubMessage):\n       raise TypeError(\n           'Unexpected element. Type: %s (expected: PubsubMessage), '\n           'value: %r' % (type(element), element))\n     return element._to_proto_str()\n \n+  @staticmethod\n+  def bytes_to_proto_str(element):\n+    # type: (bytes) -> bytes\n+    msg = pubsub.types.pubsub_pb2.PubsubMessage()\n+    msg.data = element\n+    return msg.SerializeToString()\n+\n   def expand(self, pcoll):\n     if self.with_attributes:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTgxMzkzNA=="}, "originalCommit": {"oid": "1d7cf1cf1c31a8af379020714f345ec315df3f1c"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3ODIzNw==", "bodyText": "nit: rename classes to PubsubMessages", "url": "https://github.com/apache/beam/pull/12806#discussion_r491178237", "createdAt": "2020-09-18T20:35:59Z", "author": {"login": "lukecwik"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/PubsubMessageUtils.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.pubsub;\n+\n+import com.google.protobuf.ByteString;\n+import com.google.protobuf.InvalidProtocolBufferException;\n+import java.util.Map;\n+import org.apache.beam.sdk.transforms.SerializableFunction;\n+\n+/** Common util functions for converting between PubsubMessage proto and {@link PubsubMessage}. */\n+public class PubsubMessageUtils {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcdc93239aefab09d5b2f544882205f501ba38cc"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bcdc93239aefab09d5b2f544882205f501ba38cc", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/bcdc93239aefab09d5b2f544882205f501ba38cc", "committedDate": "2020-09-17T20:38:54Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}, "afterCommit": {"oid": "b13bb7f2f1e90d6c2afa2cd706371762a800d10c", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/b13bb7f2f1e90d6c2afa2cd706371762a800d10c", "committedDate": "2020-09-21T19:16:47Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65fe47a4d987cdf3fbb20bef0df3970300afd12f", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/65fe47a4d987cdf3fbb20bef0df3970300afd12f", "committedDate": "2020-09-21T19:22:21Z", "message": "Rename PubsubMessageUtils to PubsubMessages."}, "afterCommit": {"oid": "69051607a47ef510611fc990f56a5616cc26268a", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/69051607a47ef510611fc990f56a5616cc26268a", "committedDate": "2020-09-22T17:15:30Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0Nzg4ODk3", "url": "https://github.com/apache/beam/pull/12806#pullrequestreview-494788897", "createdAt": "2020-09-23T15:31:53Z", "commit": {"oid": "cb1927f805c738f9d37bd0450f771e9f066714a8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94b98ed066ed06e6095cd855549dc77a770f453b", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/94b98ed066ed06e6095cd855549dc77a770f453b", "committedDate": "2020-09-25T03:28:14Z", "message": "Move display_data to WriteToPubSub transform."}, "afterCommit": {"oid": "7bf06d36abd59aaabafb53f834e9512d6589427f", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/7bf06d36abd59aaabafb53f834e9512d6589427f", "committedDate": "2020-10-28T20:24:38Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7bf06d36abd59aaabafb53f834e9512d6589427f", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/7bf06d36abd59aaabafb53f834e9512d6589427f", "committedDate": "2020-10-28T20:24:38Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}, "afterCommit": {"oid": "e4095ad13b9ef99a059322311d6f24e6d23752eb", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/e4095ad13b9ef99a059322311d6f24e6d23752eb", "committedDate": "2020-10-28T21:20:16Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4095ad13b9ef99a059322311d6f24e6d23752eb", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/e4095ad13b9ef99a059322311d6f24e6d23752eb", "committedDate": "2020-10-28T21:20:16Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}, "afterCommit": {"oid": "fe0915503fa11b7b08aad395cda01a96698a2eb8", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/fe0915503fa11b7b08aad395cda01a96698a2eb8", "committedDate": "2020-10-29T00:16:24Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fe0915503fa11b7b08aad395cda01a96698a2eb8", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/fe0915503fa11b7b08aad395cda01a96698a2eb8", "committedDate": "2020-10-29T00:16:24Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}, "afterCommit": {"oid": "2d38a8b873cca34ca47f523035f35b0003445bd0", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/2d38a8b873cca34ca47f523035f35b0003445bd0", "committedDate": "2020-10-29T00:27:35Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a309c2ce602fba67351f36067f9c65b150b86a8", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/7a309c2ce602fba67351f36067f9c65b150b86a8", "committedDate": "2020-10-29T00:49:09Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d38a8b873cca34ca47f523035f35b0003445bd0", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/2d38a8b873cca34ca47f523035f35b0003445bd0", "committedDate": "2020-10-29T00:27:35Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}, "afterCommit": {"oid": "7a309c2ce602fba67351f36067f9c65b150b86a8", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/7a309c2ce602fba67351f36067f9c65b150b86a8", "committedDate": "2020-10-29T00:49:09Z", "message": "[BEAM-10869] Make WriteToPubsub output serialized PubsubMessage proto bytes when using runner v2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MjkxODA5", "url": "https://github.com/apache/beam/pull/12806#pullrequestreview-519291809", "createdAt": "2020-10-29T02:43:33Z", "commit": {"oid": "7a309c2ce602fba67351f36067f9c65b150b86a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMjo0MzozNFrOHqFrHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQwMjo0MzozNFrOHqFrHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg5NTE5Ng==", "bodyText": "We can remove with_attributes from PubSubSink in the cleanup PR. @chamikaramj", "url": "https://github.com/apache/beam/pull/12806#discussion_r513895196", "createdAt": "2020-10-29T02:43:34Z", "author": {"login": "boyuanzz"}, "path": "sdks/python/apache_beam/io/gcp/pubsub.py", "diffHunk": "@@ -418,10 +439,11 @@ def __init__(self,\n                id_label,  # type: Optional[str]\n                with_attributes,  # type: bool\n                timestamp_attribute  # type: Optional[str]\n-              ):\n+               ):\n     self.coder = coders.BytesCoder()\n     self.full_topic = topic\n     self.id_label = id_label\n+    #TODO(BEAM-10869): Remove with_attributes since we will never look at it.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a309c2ce602fba67351f36067f9c65b150b86a8"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NzE1MDY5", "url": "https://github.com/apache/beam/pull/12806#pullrequestreview-519715069", "createdAt": "2020-10-29T14:19:45Z", "commit": {"oid": "7a309c2ce602fba67351f36067f9c65b150b86a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNDoxOTo0NlrOHqeFHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNDoxOTo0NlrOHqeFHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI5NTA3MA==", "bodyText": "BTW doesn't Java work (for runner v2) when we just set PropertyNames.PUBSUB_SERIALIZED_ATTRIBUTES_FN to empty string ?", "url": "https://github.com/apache/beam/pull/12806#discussion_r514295070", "createdAt": "2020-10-29T14:19:46Z", "author": {"login": "chamikaramj"}, "path": "runners/google-cloud-dataflow-java/src/main/java/org/apache/beam/runners/dataflow/DataflowRunner.java", "diffHunk": "@@ -1508,7 +1578,7 @@ public void translate(StreamingPubsubIOWrite transform, TranslationContext conte\n       // Using a GlobalWindowCoder as a place holder because GlobalWindowCoder is known coder.\n       stepContext.addEncodingInput(\n           WindowedValue.getFullCoder(VoidCoder.of(), GlobalWindow.Coder.INSTANCE));\n-      stepContext.addInput(PropertyNames.PARALLEL_INPUT, context.getInput(transform));\n+      stepContext.addInput(PropertyNames.PARALLEL_INPUT, input);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a309c2ce602fba67351f36067f9c65b150b86a8"}, "originalPosition": 165}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5OTg5MTQ2", "url": "https://github.com/apache/beam/pull/12806#pullrequestreview-519989146", "createdAt": "2020-10-29T19:07:47Z", "commit": {"oid": "7a309c2ce602fba67351f36067f9c65b150b86a8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2633, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}