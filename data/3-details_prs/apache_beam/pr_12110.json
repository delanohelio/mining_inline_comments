{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwODI5NDky", "number": 12110, "title": "[BEAM-9890] Try fixing BIT_AND(NULL) issue", "bodyText": "R: @amaliujia\nModified the original implementation of BitAnd class by adding a boolean value \"isEmpty\" to indicate if inputs don't contain any valid numerical values. Also added some tests to test NULL values. The current situation is:\n\n\nWhen table is empty, the result is empty, correct.\n\n\nWhen table contains only null values, the result is null, correct.\n\n\nWhen table contains only valid numerical values, the result is as expected, correct.\n\n\nWhen table contains both valid numerical values and null values, the result should be null, but it seems all null values have been directly ignored before doing the bit_and operation. Only numerical values are taken into operation, so the result is incorrect.\n\n\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-06-26T23:58:03Z", "url": "https://github.com/apache/beam/pull/12110", "merged": true, "mergeCommit": {"oid": "354b97a96c62a15d4198005355cab64e948d7709"}, "closed": true, "closedAt": "2020-06-30T06:10:34Z", "author": {"login": "Imfuyuwei"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvMM6KgH2gAyNDQwODI5NDkyOjQxNTBkNWU3MjU0MzNjNTliOTA4Yzk0MjNmNDdiMjNhOTVlMjJlZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwPYtqgFqTQzOTY5NjIyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4150d5e725433c59b908c9423f47b23a95e22efd", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/4150d5e725433c59b908c9423f47b23a95e22efd", "committedDate": "2020-06-26T23:53:29Z", "message": "[BEAM-9890] Try fixing BIT_AND(NULL) issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f968ec484b7bd227fb9c327e11d80becc4e9a47", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/6f968ec484b7bd227fb9c327e11d80becc4e9a47", "committedDate": "2020-06-27T01:56:49Z", "message": "[BEAM-9890] Try fixing BIT_AND(NULL) issue with spotless problem solved"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bff50282bdfe261df8b136f156d1841b5d8acec", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/5bff50282bdfe261df8b136f156d1841b5d8acec", "committedDate": "2020-06-27T06:09:13Z", "message": "Merge remote-tracking branch 'upstream/master'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4ODAyMDEx", "url": "https://github.com/apache/beam/pull/12110#pullrequestreview-438802011", "createdAt": "2020-06-28T18:16:04Z", "commit": {"oid": "6f968ec484b7bd227fb9c327e11d80becc4e9a47"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxODoxNjowNFrOGp_Q4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOFQxODoxNjowNFrOGp_Q4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4MTMxMg==", "bodyText": "why not still use Long, why change to Accum class?", "url": "https://github.com/apache/beam/pull/12110#discussion_r446681312", "createdAt": "2020-06-28T18:16:04Z", "author": {"login": "amaliujia"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/transform/BeamBuiltinAggregations.java", "diffHunk": "@@ -393,29 +393,52 @@ public Long extractOutput(Long accum) {\n     }\n   }\n \n-  static class BitAnd<T extends Number> extends CombineFn<T, Long, Long> {\n+  static class BitAnd<T extends Number> extends CombineFn<T, BitAnd.Accum, Long> {\n+    public static class Accum {\n+      long val = -1L;\n+      boolean isEmpty = true;\n+      boolean seenNull = false;\n+    }\n+\n     @Override\n-    public Long createAccumulator() {\n-      return -1L;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f968ec484b7bd227fb9c327e11d80becc4e9a47"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a960772cde0a5e1d31f4de7c9349ad23f97954ce", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/a960772cde0a5e1d31f4de7c9349ad23f97954ce", "committedDate": "2020-06-29T19:45:18Z", "message": "[BEAM-9890] Try fixing BIT_AND(NULL) issue, modified implementation and added some NULL value tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24e5d3a27dfb89a8571e169022a090b3fba0f795", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/24e5d3a27dfb89a8571e169022a090b3fba0f795", "committedDate": "2020-06-29T22:41:22Z", "message": "[BEAM-9890] Temporarily ignored BitAnd ZetaSql test. NULL issue need to be solved for BitAnd operation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd451c2638585588443c8448b68fe7645f7c8415", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/fd451c2638585588443c8448b68fe7645f7c8415", "committedDate": "2020-06-29T23:39:59Z", "message": "Revert \"[BEAM-9890] Support BIT_AND aggregation function in Beam SQL\" temporarily, NULL values need to be handled"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5Njk2MjI5", "url": "https://github.com/apache/beam/pull/12110#pullrequestreview-439696229", "createdAt": "2020-06-30T06:10:01Z", "commit": {"oid": "fd451c2638585588443c8448b68fe7645f7c8415"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3186, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}