{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNTk5Njk3", "number": 10554, "title": "[BEAM-8676] sdks/java: gax and grpc upgrades", "bodyText": "https://issues.apache.org/jira/browse/BEAM-8676. This PR is a revival of #10438.\nGax and gRPC work together. Upgrading their dependencies to higher versions.\n\nThe latest gax-grpc:1.52.0 depends on gRPC 1.25.0. (So not setting grpc 1.26.0)\nAlthough grpc 1.25 declares Guava 28.1 dependency, grpc 1.25 does not have linkage errors with Guava 25.1-jre (which current master has).\n\nWhich modules use gax and grpc?\nfind . -name 'build.gradle' |xargs grep -ir library.java.gax (and grpc) gave\n\n./sdks/java/io/google-cloud-platform/build.gradle\n./sdks/java/extensions/sql/datacatalog/build.gradle\n./sdks/java/extensions/sql/zetasql/build.gradle\n\nLinkage Check\nbeam-sdks-java-io-google-cloud-platform\n\nbefore: https://gist.github.com/suztomo/d0446fb63aea142db1a8086da702a04d (master ba4dc72)\nafter: https://gist.github.com/suztomo/5c0cd8699f019d03ae8bc0a58e3c7116 (this PR b4bd0bc)\n\nThis PR removes the following linkage errors:\nsuztomo@suxtomo24:~/beam6$ diff /tmp/linkagecheck-beam-sdks-java-io-google-cloud-platform-ba4dc72c /tmp/linkagecheck-beam-sdks-java-io-google-cloud-platform-b4bd0bc5 \n22,36d21\n< Class io.opencensus.trace.Tracestate is not found;\n<   referenced by 1 class file\n<     io.opencensus.contrib.http.util.CloudTraceFormat (opencensus-contrib-http-util-0.18.0.jar)\n< Class io.opencensus.trace.Tracestate$Builder is not found;\n<   referenced by 1 class file\n<     io.opencensus.contrib.http.util.CloudTraceFormat (opencensus-contrib-http-util-0.18.0.jar)\n< Class com.google.common.truth.Truth is not found;\n<   referenced by 1 class file\n<     io.grpc.internal.testing.AbstractTransportTest (grpc-testing-1.17.1.jar)\n< Class com.google.common.truth.StringSubject is not found;\n<   referenced by 1 class file\n<     io.grpc.internal.testing.AbstractTransportTest (grpc-testing-1.17.1.jar)\n< Class com.google.common.truth.LongSubject is not found;\n<   referenced by 1 class file\n<     io.grpc.internal.testing.AbstractTransportTest (grpc-testing-1.17.1.jar)\n44,55d28\n< Class org.apache.tools.ant.Task is not found;\n<   referenced by 1 class file\n<     org.mockito.cglib.transform.AbstractProcessTask (mockito-core-1.9.5.jar)\n< Class org.apache.tools.ant.types.FileSet is not found;\n<   referenced by 1 class file\n<     org.mockito.cglib.transform.AbstractProcessTask (mockito-core-1.9.5.jar)\n< Class org.apache.tools.ant.DirectoryScanner is not found;\n<   referenced by 1 class file\n<     org.mockito.cglib.transform.AbstractProcessTask (mockito-core-1.9.5.jar)\n< Class org.apache.tools.ant.BuildException is not found;\n<   referenced by 1 class file\n<     org.mockito.cglib.transform.AbstractProcessTask (mockito-core-1.9.5.jar)\n870,872d842\n< (opencensus-api-0.15.0.jar) io.opencensus.trace.SpanContext's method create(io.opencensus.trace.TraceId arg1, io.opencensus.trace.SpanId arg2, io.opencensus.trace.TraceOptions arg3, io.opencensus.trace.Tracestate arg4) is not found;\n<   referenced by 1 class file\n<     io.opencensus.contrib.http.util.CloudTraceFormat (opencensus-contrib-http-util-0.18.0.jar)\n883c853\n< BUILD SUCCESSFUL in 31s\n---\n> BUILD SUCCESSFUL in 30s\n\n\nbeam-sdks-java-extensions-sql-zetasql\nLinkage Checker does not work for beam-sdks-java-extensions-sql-zetasql. (Bug: GoogleCloudPlatform/cloud-opensource-java#1087)\nbeam-sdks-java-extensions-sql-datacatalog\nLinkage Checker does not work for beam-sdks-java-extensions-sql-datacatalog https://gist.github.com/suztomo/9c7723a2d126459bebfa2f52b5573757  (the same reason as above)\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-01-10T19:56:39Z", "url": "https://github.com/apache/beam/pull/10554", "merged": true, "mergeCommit": {"oid": "a37e5c56c042a257717c9d2b266956b8476fc3bb"}, "closed": true, "closedAt": "2020-01-15T21:05:57Z", "author": {"login": "suztomo"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5EYfbgH2gAyMzYxNTk5Njk3OjJjNDgyYzI2Y2UxZjA0MjYwZmRmZTVhNDRhNzM2MmZjZWYwMGJkNmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb5EpLygFqTM0MTQwNTE4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2c482c26ce1f04260fdfe5a44a7362fcef00bd6a", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/apache/beam/commit/2c482c26ce1f04260fdfe5a44a7362fcef00bd6a", "committedDate": "2020-01-10T20:14:59Z", "message": "Gax and grpc version upgrades"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4bd0bc56ba83c34626d882b200aae5978d580eb", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/apache/beam/commit/b4bd0bc56ba83c34626d882b200aae5978d580eb", "committedDate": "2020-01-10T20:14:59Z", "message": "io/google-cloud-platform to have grpc-context"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a47935e624981517068881d401ecaa9b364269fc", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/apache/beam/commit/a47935e624981517068881d401ecaa9b364269fc", "committedDate": "2020-01-10T18:44:15Z", "message": "io/google-cloud-platform to have grpc-context"}, "afterCommit": {"oid": "b4bd0bc56ba83c34626d882b200aae5978d580eb", "author": {"user": {"login": "suztomo", "name": "Tomo Suzuki"}}, "url": "https://github.com/apache/beam/commit/b4bd0bc56ba83c34626d882b200aae5978d580eb", "committedDate": "2020-01-10T20:14:59Z", "message": "io/google-cloud-platform to have grpc-context"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNDA1MTg3", "url": "https://github.com/apache/beam/pull/10554#pullrequestreview-341405187", "createdAt": "2020-01-10T20:28:42Z", "commit": {"oid": "b4bd0bc56ba83c34626d882b200aae5978d580eb"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQyMDoyODo0M1rOFcfUlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQyMDoyOToyMVrOFcfVcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQxNzYyMg==", "bodyText": "Unless this declares grpc-context dependency, grpc-context\u2019s old version sneaks in the class path. Here is an error from linkage checker before adding this grpc-context dependency:\n(grpc-context-1.16.1.jar) io.grpc.Deadline's method getSystemTicker() is not found;\n  referenced by 1 class file\n    io.grpc.internal.AbstractServerImplBuilder (grpc-core-1.25.0.jar)\n\nhttps://gist.github.com/suztomo/9af333b78b157d6a829d59ac5353e01d#file-gistfile1-txt-L856", "url": "https://github.com/apache/beam/pull/10554#discussion_r365417622", "createdAt": "2020-01-10T20:28:43Z", "author": {"login": "suztomo"}, "path": "sdks/java/io/google-cloud-platform/build.gradle", "diffHunk": "@@ -50,6 +51,7 @@ dependencies {\n   compile library.java.grpc_all\n   compile library.java.grpc_auth\n   compile library.java.grpc_core\n+  compile library.java.grpc_context", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4bd0bc56ba83c34626d882b200aae5978d580eb"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQxNzc0OQ==", "bodyText": "The latest version of gRPC is 1.26.0, but setting 1.25.0 as gax-grpc:1.52.0 depends on 1.25.0.", "url": "https://github.com/apache/beam/pull/10554#discussion_r365417749", "createdAt": "2020-01-10T20:29:03Z", "author": {"login": "suztomo"}, "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy", "diffHunk": "@@ -372,7 +373,7 @@ class BeamModulePlugin implements Plugin<Project> {\n     def google_cloud_bigdataoss_version = \"1.9.16\"\n     def google_cloud_core_version = \"1.61.0\"\n     def google_cloud_spanner_version = \"1.6.0\"\n-    def grpc_version = \"1.17.1\"\n+    def grpc_version = \"1.25.0\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4bd0bc56ba83c34626d882b200aae5978d580eb"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQxNzg0Mg==", "bodyText": "As BigQueryServicesImpl uses gax's com.google.api.gax.core.FixedCredentialsProvider (undeclared-but-used dependency), declaring it explicitly.", "url": "https://github.com/apache/beam/pull/10554#discussion_r365417842", "createdAt": "2020-01-10T20:29:21Z", "author": {"login": "suztomo"}, "path": "sdks/java/io/google-cloud-platform/build.gradle", "diffHunk": "@@ -33,6 +33,7 @@ dependencies {\n   compile project(\":sdks:java:extensions:protobuf\")\n   compile library.java.avro\n   compile library.java.bigdataoss_util\n+  compile library.java.gax", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4bd0bc56ba83c34626d882b200aae5978d580eb"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3722, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}