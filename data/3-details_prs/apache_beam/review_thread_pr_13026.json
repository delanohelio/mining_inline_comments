{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5MTMxMjc5", "number": 13026, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNToxNTo1NVrOE4tI8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNToyMjozMlrOE4tUEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3ODk1MjgyOnYy", "diffSide": "RIGHT", "path": "sdks/java/io/kafka/build.gradle", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNToxNTo1NVrOHyyUNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNTo1NDo0MVrOH08KDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxNTIyMw==", "bodyText": "Will it require to include all these different Kafka client version jars into regular build as deps?", "url": "https://github.com/apache/beam/pull/13026#discussion_r523015223", "createdAt": "2020-11-13T15:15:55Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE2MzA0OA==", "bodyText": "It should do the same what kafkaVersion210 did. I've imported KafkaIO 2.25 jar and I can't see kafka-clients 2.1.0 in the dependencies. So I don't think so.\nI'm not sure how to import a jar to Gradle locally, I will try it out on Monday.", "url": "https://github.com/apache/beam/pull/13026#discussion_r523163048", "createdAt": "2020-11-13T18:59:39Z", "author": {"login": "piotr-szuberski"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxNTIyMw=="}, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDIyNjg4Mw==", "bodyText": "Could you try to build and publish KafkaIO jar with this command:\n./gradlew -Ppublishing -PdistMgmtSnapshotsUrl=/path/to/.m2/repository/ -p sdks/java/io/kafka publishToMavenLocal\n\nand check out which Kafka clients deps it comtains?", "url": "https://github.com/apache/beam/pull/13026#discussion_r524226883", "createdAt": "2020-11-16T12:36:10Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxNTIyMw=="}, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI0ODQ2MA==", "bodyText": "That's super useful! Thank you!\nI can't see any Kafka clients in the created jar.  I created a new project that uses the local repo:\nrepositories {\n    mavenLocal()\n}\n\ndependencies {\n    compile group: 'org.apache.beam', name: 'beam-sdks-java-io-kafka', version: '2.27.0-SNAPSHOT'\n    testCompile group: 'org.apache.beam', name: 'beam-sdks-java-io-kafka', version: '2.27.0-SNAPSHOT'\n}\n\n\nHere is the output of dependencies task\ncompileClasspath - Compile classpath for source set 'main'.\n\\--- org.apache.beam:beam-sdks-java-io-kafka:2.27.0-SNAPSHOT\n     +--- org.checkerframework:checker-qual:3.7.0 FAILED\n     +--- org.apache.beam:beam-vendor-guava-26_0-jre:0.1\n     +--- org.apache.beam:beam-sdks-java-core:2.27.0-SNAPSHOT FAILED\n     +--- org.apache.beam:beam-sdks-java-expansion-service:2.27.0-SNAPSHOT FAILED\n     +--- org.slf4j:slf4j-api:1.7.30\n     +--- joda-time:joda-time:2.10.5\n     +--- com.fasterxml.jackson.core:jackson-annotations:2.10.2\n     +--- com.fasterxml.jackson.core:jackson-databind:2.10.2\n     |    +--- com.fasterxml.jackson.core:jackson-annotations:2.10.2\n     |    \\--- com.fasterxml.jackson.core:jackson-core:2.10.2\n     +--- org.springframework:spring-expression:4.3.18.RELEASE FAILED\n     \\--- io.confluent:kafka-avro-serializer:5.3.2\n          +--- org.apache.avro:avro:1.8.1\n          |    +--- org.codehaus.jackson:jackson-core-asl:1.9.13\n          |    +--- org.codehaus.jackson:jackson-mapper-asl:1.9.13\n          |    |    \\--- org.codehaus.jackson:jackson-core-asl:1.9.13\n          |    +--- com.thoughtworks.paranamer:paranamer:2.7\n          |    +--- org.xerial.snappy:snappy-java:1.1.1.3\n          |    +--- org.apache.commons:commons-compress:1.8.1\n          |    +--- org.tukaani:xz:1.5\n          |    \\--- org.slf4j:slf4j-api:1.7.7 -> 1.7.30\n          +--- io.confluent:kafka-schema-registry-client:5.3.2\n          |    +--- io.confluent:common-config:5.3.2\n          |    |    +--- io.confluent:common-utils:5.3.2\n          |    |    |    +--- org.slf4j:slf4j-api:1.7.26 -> 1.7.30\n          |    |    |    \\--- com.101tec:zkclient:0.10\n          |    |    |         \\--- org.slf4j:slf4j-api:1.6.1 -> 1.7.30\n          |    |    \\--- org.slf4j:slf4j-api:1.7.26 -> 1.7.30\n          |    +--- org.apache.avro:avro:1.8.1 (*)\n          |    +--- com.fasterxml.jackson.core:jackson-databind:2.9.10.1 -> 2.10.2 (*)\n          |    \\--- io.confluent:common-utils:5.3.2 (*)\n          +--- io.confluent:common-config:5.3.2 (*)\n          \\--- io.confluent:common-utils:5.3.2 (*)\n\ncompileOnly - Compile only dependencies for source set 'main'. (n)\nNo dependencies\n\ndefault - Configuration for default artifacts. (n)\nNo dependencies\n\nimplementation - Implementation only dependencies for source set 'main'. (n)\nNo dependencies\n\nruntimeClasspath - Runtime classpath of source set 'main'.\n\\--- org.apache.beam:beam-sdks-java-io-kafka:2.27.0-SNAPSHOT\n     +--- org.checkerframework:checker-qual:3.7.0 FAILED\n     +--- org.apache.beam:beam-vendor-guava-26_0-jre:0.1\n     +--- org.apache.beam:beam-sdks-java-core:2.27.0-SNAPSHOT FAILED\n     +--- org.apache.beam:beam-sdks-java-expansion-service:2.27.0-SNAPSHOT FAILED\n     +--- org.slf4j:slf4j-api:1.7.30\n     +--- joda-time:joda-time:2.10.5\n     +--- com.fasterxml.jackson.core:jackson-annotations:2.10.2\n     +--- com.fasterxml.jackson.core:jackson-databind:2.10.2\n     |    +--- com.fasterxml.jackson.core:jackson-annotations:2.10.2\n     |    \\--- com.fasterxml.jackson.core:jackson-core:2.10.2\n     +--- org.springframework:spring-expression:4.3.18.RELEASE FAILED\n     \\--- io.confluent:kafka-avro-serializer:5.3.2\n          +--- org.apache.avro:avro:1.8.1\n          |    +--- org.codehaus.jackson:jackson-core-asl:1.9.13\n          |    +--- org.codehaus.jackson:jackson-mapper-asl:1.9.13\n          |    |    \\--- org.codehaus.jackson:jackson-core-asl:1.9.13\n          |    +--- com.thoughtworks.paranamer:paranamer:2.7\n          |    +--- org.xerial.snappy:snappy-java:1.1.1.3\n          |    +--- org.apache.commons:commons-compress:1.8.1\n          |    +--- org.tukaani:xz:1.5\n          |    \\--- org.slf4j:slf4j-api:1.7.7 -> 1.7.30\n          +--- io.confluent:kafka-schema-registry-client:5.3.2\n          |    +--- io.confluent:common-config:5.3.2\n          |    |    +--- io.confluent:common-utils:5.3.2\n          |    |    |    +--- org.slf4j:slf4j-api:1.7.26 -> 1.7.30\n          |    |    |    \\--- com.101tec:zkclient:0.10\n          |    |    |         \\--- org.slf4j:slf4j-api:1.6.1 -> 1.7.30\n          |    |    \\--- org.slf4j:slf4j-api:1.7.26 -> 1.7.30\n          |    +--- org.apache.avro:avro:1.8.1 (*)\n          |    +--- com.fasterxml.jackson.core:jackson-databind:2.9.10.1 -> 2.10.2 (*)\n          |    \\--- io.confluent:common-utils:5.3.2 (*)\n          +--- io.confluent:common-config:5.3.2 (*)\n          \\--- io.confluent:common-utils:5.3.2 (*)\n\nruntimeElements - Elements of runtime for main. (n)\nNo dependencies\n\nruntimeOnly - Runtime only dependencies for source set 'main'. (n)\nNo dependencies\n\ntestAnnotationProcessor - Annotation processors and their dependencies for source set 'test'.\nNo dependencies\n\ntestCompileClasspath - Compile classpath for source set 'test'.\n\\--- org.apache.beam:beam-sdks-java-io-kafka:2.27.0-SNAPSHOT\n     +--- org.checkerframework:checker-qual:3.7.0 FAILED\n     +--- org.apache.beam:beam-vendor-guava-26_0-jre:0.1\n     +--- org.apache.beam:beam-sdks-java-core:2.27.0-SNAPSHOT FAILED\n     +--- org.apache.beam:beam-sdks-java-expansion-service:2.27.0-SNAPSHOT FAILED\n     +--- org.slf4j:slf4j-api:1.7.30\n     +--- joda-time:joda-time:2.10.5\n     +--- com.fasterxml.jackson.core:jackson-annotations:2.10.2\n     +--- com.fasterxml.jackson.core:jackson-databind:2.10.2\n     |    +--- com.fasterxml.jackson.core:jackson-annotations:2.10.2\n     |    \\--- com.fasterxml.jackson.core:jackson-core:2.10.2\n     +--- org.springframework:spring-expression:4.3.18.RELEASE FAILED\n     \\--- io.confluent:kafka-avro-serializer:5.3.2\n          +--- org.apache.avro:avro:1.8.1\n          |    +--- org.codehaus.jackson:jackson-core-asl:1.9.13\n          |    +--- org.codehaus.jackson:jackson-mapper-asl:1.9.13\n          |    |    \\--- org.codehaus.jackson:jackson-core-asl:1.9.13\n          |    +--- com.thoughtworks.paranamer:paranamer:2.7\n          |    +--- org.xerial.snappy:snappy-java:1.1.1.3\n          |    +--- org.apache.commons:commons-compress:1.8.1\n          |    +--- org.tukaani:xz:1.5\n          |    \\--- org.slf4j:slf4j-api:1.7.7 -> 1.7.30\n          +--- io.confluent:kafka-schema-registry-client:5.3.2\n          |    +--- io.confluent:common-config:5.3.2\n          |    |    +--- io.confluent:common-utils:5.3.2\n          |    |    |    +--- org.slf4j:slf4j-api:1.7.26 -> 1.7.30\n          |    |    |    \\--- com.101tec:zkclient:0.10\n          |    |    |         \\--- org.slf4j:slf4j-api:1.6.1 -> 1.7.30\n          |    |    \\--- org.slf4j:slf4j-api:1.7.26 -> 1.7.30\n          |    +--- org.apache.avro:avro:1.8.1 (*)\n          |    +--- com.fasterxml.jackson.core:jackson-databind:2.9.10.1 -> 2.10.2 (*)\n          |    \\--- io.confluent:common-utils:5.3.2 (*)\n          +--- io.confluent:common-config:5.3.2 (*)\n          \\--- io.confluent:common-utils:5.3.2 (*)", "url": "https://github.com/apache/beam/pull/13026#discussion_r524248460", "createdAt": "2020-11-16T12:57:22Z", "author": {"login": "piotr-szuberski"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxNTIyMw=="}, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI2MzA3MA==", "bodyText": "Sorry, I missed the request for logging the Kafka version. I'm working on it now.", "url": "https://github.com/apache/beam/pull/13026#discussion_r525263070", "createdAt": "2020-11-17T15:42:00Z", "author": {"login": "piotr-szuberski"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxNTIyMw=="}, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI3MzYxNA==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/13026#discussion_r525273614", "createdAt": "2020-11-17T15:54:41Z", "author": {"login": "piotr-szuberski"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxNTIyMw=="}, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI3ODk4MTI5OnYy", "diffSide": "LEFT", "path": "sdks/java/io/kafka/build.gradle", "isResolved": false, "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNToyMjozMlrOHyylRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMzoxMDozMFrOH00DrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxOTU4OA==", "bodyText": "I think this task was used to run KafkaIO unit tests against specific client version. It's not a case now?", "url": "https://github.com/apache/beam/pull/13026#discussion_r523019588", "createdAt": "2020-11-13T15:22:32Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}\n }\n \n-configurations.kafkaVersion210 {\n-  resolutionStrategy {\n-    force \"org.apache.kafka:kafka-clients:2.1.0\"\n+kafkaVersions.each { kv ->\n+  configurations.\"kafkaVersion$kv.key\" {\n+    resolutionStrategy {\n+      force \"org.apache.kafka:kafka-clients:$kv.value\"\n+    }\n   }\n }\n \n-task kafkaVersion210Test(type: Test) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzE0MTA0Ng==", "bodyText": "This task is still there at\nkafkaVersions.each {kv ->\n  task \"kafkaVersion${kv.key}Test\"(type: Test)\n  [...]\n\nThough I used 2.1.1 version - is 2.1.0 special for some reason?", "url": "https://github.com/apache/beam/pull/13026#discussion_r523141046", "createdAt": "2020-11-13T18:20:20Z", "author": {"login": "piotr-szuberski"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}\n }\n \n-configurations.kafkaVersion210 {\n-  resolutionStrategy {\n-    force \"org.apache.kafka:kafka-clients:2.1.0\"\n+kafkaVersions.each { kv ->\n+  configurations.\"kafkaVersion$kv.key\" {\n+    resolutionStrategy {\n+      force \"org.apache.kafka:kafka-clients:$kv.value\"\n+    }\n   }\n }\n \n-task kafkaVersion210Test(type: Test) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxOTU4OA=="}, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDIyODU0Nw==", "bodyText": "I think it should fine since 2.1.0 was used as a minimum version where headers were added (if I'm not mistaken).", "url": "https://github.com/apache/beam/pull/13026#discussion_r524228547", "createdAt": "2020-11-16T12:37:47Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}\n }\n \n-configurations.kafkaVersion210 {\n-  resolutionStrategy {\n-    force \"org.apache.kafka:kafka-clients:2.1.0\"\n+kafkaVersions.each { kv ->\n+  configurations.\"kafkaVersion$kv.key\" {\n+    resolutionStrategy {\n+      force \"org.apache.kafka:kafka-clients:$kv.value\"\n+    }\n   }\n }\n \n-task kafkaVersion210Test(type: Test) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxOTU4OA=="}, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI2NzYzNw==", "bodyText": "I'm not sure as well but I guess so. I'm having a difficulty with the recently added Kafka streaming performance tests so  I'm changing this PR to WIP.\nIf I understand correctly these streaming tests can't be run on DirectRunner? They never stop on both direct and flink even with readTimeout set to 1min", "url": "https://github.com/apache/beam/pull/13026#discussion_r524267637", "createdAt": "2020-11-16T13:29:54Z", "author": {"login": "piotr-szuberski"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}\n }\n \n-configurations.kafkaVersion210 {\n-  resolutionStrategy {\n-    force \"org.apache.kafka:kafka-clients:2.1.0\"\n+kafkaVersions.each { kv ->\n+  configurations.\"kafkaVersion$kv.key\" {\n+    resolutionStrategy {\n+      force \"org.apache.kafka:kafka-clients:$kv.value\"\n+    }\n   }\n }\n \n-task kafkaVersion210Test(type: Test) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxOTU4OA=="}, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2NDM1Mg==", "bodyText": "Kafka performance tests have been failing (timeout) since #13282 merge.\nI guess this PR should wait until it's fixed?\nhttps://ci-beam.apache.org/job/beam_PerformanceTests_Kafka_IO/", "url": "https://github.com/apache/beam/pull/13026#discussion_r524364352", "createdAt": "2020-11-16T15:43:25Z", "author": {"login": "piotr-szuberski"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}\n }\n \n-configurations.kafkaVersion210 {\n-  resolutionStrategy {\n-    force \"org.apache.kafka:kafka-clients:2.1.0\"\n+kafkaVersions.each { kv ->\n+  configurations.\"kafkaVersion$kv.key\" {\n+    resolutionStrategy {\n+      force \"org.apache.kafka:kafka-clients:$kv.value\"\n+    }\n   }\n }\n \n-task kafkaVersion210Test(type: Test) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxOTU4OA=="}, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQxNjI3OQ==", "bodyText": "@boyuanzz Could you take a look on https://ci-beam.apache.org/job/beam_PerformanceTests_Kafka_IO/1563/ ? After rebase with latest KafkaIOIT changes, It fails because of timeout.", "url": "https://github.com/apache/beam/pull/13026#discussion_r524416279", "createdAt": "2020-11-16T16:50:37Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}\n }\n \n-configurations.kafkaVersion210 {\n-  resolutionStrategy {\n-    force \"org.apache.kafka:kafka-clients:2.1.0\"\n+kafkaVersions.each { kv ->\n+  configurations.\"kafkaVersion$kv.key\" {\n+    resolutionStrategy {\n+      force \"org.apache.kafka:kafka-clients:$kv.value\"\n+    }\n   }\n }\n \n-task kafkaVersion210Test(type: Test) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxOTU4OA=="}, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ4NDM3MA==", "bodyText": "Looking.", "url": "https://github.com/apache/beam/pull/13026#discussion_r524484370", "createdAt": "2020-11-16T18:29:52Z", "author": {"login": "boyuanzz"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}\n }\n \n-configurations.kafkaVersion210 {\n-  resolutionStrategy {\n-    force \"org.apache.kafka:kafka-clients:2.1.0\"\n+kafkaVersions.each { kv ->\n+  configurations.\"kafkaVersion$kv.key\" {\n+    resolutionStrategy {\n+      force \"org.apache.kafka:kafka-clients:$kv.value\"\n+    }\n   }\n }\n \n-task kafkaVersion210Test(type: Test) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxOTU4OA=="}, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ5MTc3Nw==", "bodyText": "It seems like the sdk docker image is cleaned up incorrectly before test finishes. I can have a quick fix for that.", "url": "https://github.com/apache/beam/pull/13026#discussion_r524491777", "createdAt": "2020-11-16T18:42:02Z", "author": {"login": "boyuanzz"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}\n }\n \n-configurations.kafkaVersion210 {\n-  resolutionStrategy {\n-    force \"org.apache.kafka:kafka-clients:2.1.0\"\n+kafkaVersions.each { kv ->\n+  configurations.\"kafkaVersion$kv.key\" {\n+    resolutionStrategy {\n+      force \"org.apache.kafka:kafka-clients:$kv.value\"\n+    }\n   }\n }\n \n-task kafkaVersion210Test(type: Test) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxOTU4OA=="}, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUxNzYyNQ==", "bodyText": "So the problem is introduced by https://github.com/apache/beam/pull/13283/files", "url": "https://github.com/apache/beam/pull/13026#discussion_r524517625", "createdAt": "2020-11-16T19:25:59Z", "author": {"login": "boyuanzz"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}\n }\n \n-configurations.kafkaVersion210 {\n-  resolutionStrategy {\n-    force \"org.apache.kafka:kafka-clients:2.1.0\"\n+kafkaVersions.each { kv ->\n+  configurations.\"kafkaVersion$kv.key\" {\n+    resolutionStrategy {\n+      force \"org.apache.kafka:kafka-clients:$kv.value\"\n+    }\n   }\n }\n \n-task kafkaVersion210Test(type: Test) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxOTU4OA=="}, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTE0MDkwOQ==", "bodyText": "@boyuanzz Thanks! I guess it's should fixed now (#13356 ), right?", "url": "https://github.com/apache/beam/pull/13026#discussion_r525140909", "createdAt": "2020-11-17T13:10:30Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/kafka/build.gradle", "diffHunk": "@@ -65,26 +76,68 @@ dependencies {\n   testCompile library.java.junit\n   testCompile library.java.powermock\n   testCompile library.java.powermock_mockito\n+  testCompile library.java.testcontainers_kafka\n   testRuntimeOnly library.java.slf4j_jdk14\n   testRuntimeOnly project(path: \":runners:direct-java\", configuration: \"shadow\")\n-  kafkaVersion210 \"org.apache.kafka:kafka-clients:2.1.0\"\n+  kafkaVersions.each {\"kafkaVersion$it.key\" \"org.apache.kafka:kafka-clients:$it.value\"}\n }\n \n-configurations.kafkaVersion210 {\n-  resolutionStrategy {\n-    force \"org.apache.kafka:kafka-clients:2.1.0\"\n+kafkaVersions.each { kv ->\n+  configurations.\"kafkaVersion$kv.key\" {\n+    resolutionStrategy {\n+      force \"org.apache.kafka:kafka-clients:$kv.value\"\n+    }\n   }\n }\n \n-task kafkaVersion210Test(type: Test) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzAxOTU4OA=="}, "originalCommit": {"oid": "321315cea9c4e7f06bc3e02bb3bae2e1cab97b17"}, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3129, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}