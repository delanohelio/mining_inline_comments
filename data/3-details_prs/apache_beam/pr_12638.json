{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwNDgxNzky", "number": 12638, "title": "[BEAM-10769] Clarify Avro IO documentation. ", "bodyText": "Our Avro IO documentation instructs the user to pass the schema parsed by avro.schema.Parse. On Python 3, we use FastAvro module, which does not accept avro-python3 schema classes. This PR corrects this instruction.\nTo make Py2->3 transition easier for the users, we try to catch if users continue to feed avro-python3 schemas into Avro IO and error-out with a better message.\nAlso, fastavro does not require a parsed schema, since the schema is re-parsed anyway, see: [1], [2], it would be simpler to ask users to pass raw schema.\n[1] \n  \n    \n      beam/sdks/python/apache_beam/io/avroio.py\n    \n    \n         Line 634\n      in\n      1b6b60e\n    \n    \n    \n    \n\n        \n          \n           return Writer(file_handle, self._schema, self._codec) \n        \n    \n  \n\n\n[2] https://github.com/fastavro/fastavro/blob/9b0cb9154df13e7bcf1b3eaf88c8ae7d6065666a/fastavro/_write_py.py#L381\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n \n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-19T22:02:10Z", "url": "https://github.com/apache/beam/pull/12638", "merged": true, "mergeCommit": {"oid": "89bcf7209ebf9c4bb39714226ec8a4618ed12257"}, "closed": true, "closedAt": "2020-09-23T03:17:47Z", "author": {"login": "tvalentyn"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAjiLvgBqjM2NzI4NTI0Njc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHV_jsAFqTQ4NTQ5MzUxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a590f0eccc6c9f37b6ed264813b6e3cfcef680f6", "author": {"user": {"login": "tvalentyn", "name": null}}, "url": "https://github.com/apache/beam/commit/a590f0eccc6c9f37b6ed264813b6e3cfcef680f6", "committedDate": "2020-08-19T19:10:43Z", "message": "Add an error message when incorrect schema is passed to AvroIO with fastavro."}, "afterCommit": {"oid": "367a82ef832d442d5ee269cd0c44edae5e29903b", "author": {"user": {"login": "tvalentyn", "name": null}}, "url": "https://github.com/apache/beam/commit/367a82ef832d442d5ee269cd0c44edae5e29903b", "committedDate": "2020-08-19T22:40:59Z", "message": "Correct the documentation for the  parameter."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "367a82ef832d442d5ee269cd0c44edae5e29903b", "author": {"user": {"login": "tvalentyn", "name": null}}, "url": "https://github.com/apache/beam/commit/367a82ef832d442d5ee269cd0c44edae5e29903b", "committedDate": "2020-08-19T22:40:59Z", "message": "Correct the documentation for the  parameter."}, "afterCommit": {"oid": "40a706867b4a8d3a065236608edcd4ecb5246f40", "author": {"user": {"login": "tvalentyn", "name": null}}, "url": "https://github.com/apache/beam/commit/40a706867b4a8d3a065236608edcd4ecb5246f40", "committedDate": "2020-08-19T22:53:13Z", "message": "Correct the documentation for the  parameter."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9e5142e2290f777e2d60050e9b47680e6704e61", "author": {"user": {"login": "tvalentyn", "name": null}}, "url": "https://github.com/apache/beam/commit/f9e5142e2290f777e2d60050e9b47680e6704e61", "committedDate": "2020-08-19T23:05:21Z", "message": "Correct the documentation for the  parameter."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "40a706867b4a8d3a065236608edcd4ecb5246f40", "author": {"user": {"login": "tvalentyn", "name": null}}, "url": "https://github.com/apache/beam/commit/40a706867b4a8d3a065236608edcd4ecb5246f40", "committedDate": "2020-08-19T22:53:13Z", "message": "Correct the documentation for the  parameter."}, "afterCommit": {"oid": "f9e5142e2290f777e2d60050e9b47680e6704e61", "author": {"user": {"login": "tvalentyn", "name": null}}, "url": "https://github.com/apache/beam/commit/f9e5142e2290f777e2d60050e9b47680e6704e61", "committedDate": "2020-08-19T23:05:21Z", "message": "Correct the documentation for the  parameter."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1NDkzNTE2", "url": "https://github.com/apache/beam/pull/12638#pullrequestreview-485493516", "createdAt": "2020-09-10T00:48:15Z", "commit": {"oid": "f9e5142e2290f777e2d60050e9b47680e6704e61"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMDo0ODoxNlrOHPe_2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQwMDo1MToyNlrOHPfDOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk5ODU1Mg==", "bodyText": "So, to clarify, does both Avro and fastavro work for Python even though we set fastavro to default ?", "url": "https://github.com/apache/beam/pull/12638#discussion_r485998552", "createdAt": "2020-09-10T00:48:16Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/io/avroio.py", "diffHunk": "@@ -90,7 +78,7 @@ def __init__(\n       file_pattern=None,\n       min_bundle_size=0,\n       validate=True,\n-      use_fastavro=_use_fastavro()):\n+      use_fastavro=True):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e5142e2290f777e2d60050e9b47680e6704e61"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk5OTQxOQ==", "bodyText": "Does fastavro support a more structured definition for schemas or does is have to be a dict ?", "url": "https://github.com/apache/beam/pull/12638#discussion_r485999419", "createdAt": "2020-09-10T00:51:26Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/io/avroio.py", "diffHunk": "@@ -511,7 +488,9 @@ def __init__(\n         end in a common extension, if given by file_name_suffix. In most cases,\n         only this argument is specified and num_shards, shard_name_template, and\n         file_name_suffix use default values.\n-      schema: The schema to use, as returned by avro.schema.Parse\n+      schema: The schema to use (dict).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e5142e2290f777e2d60050e9b47680e6704e61"}, "originalPosition": 130}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4821, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}