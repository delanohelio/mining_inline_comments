{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5MDMwMDc1", "number": 12605, "title": "Copy subtransforms to output of translations.pipeline_from_stages()", "bodyText": "translations.pipeline_from_stages() takes in a pipeline proto and a list of stages, and outputs a pipeline proto in which the transforms specified in the stages have been copied form the input pipeline proto. This change recursively finds all subtransforms that these transforms depend on, and copies them from the input pipeline proto to the output pipeline proto.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n \n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-17T19:36:13Z", "url": "https://github.com/apache/beam/pull/12605", "merged": true, "mergeCommit": {"oid": "6be59b6487b1f44fd93c66666166fa7ef06bdefd"}, "closed": true, "closedAt": "2020-09-01T20:28:37Z", "author": {"login": "yifanmai"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_2SP5gH2gAyNDY5MDMwMDc1OmYzZDAyOThjYmE1MDEzZGMxMTcwMzhjOGFmYzQ0NGQ3Mzc3OTMzNDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDXX50AH2gAyNDY5MDMwMDc1OmQ0ZTgwYjZjMzMzYjA1MzFjMDM4ZDk1N2E2MGZmNmNiMWUwYzY2Yjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f3d0298cba5013dc117038c8afc444d737793343", "author": {"user": {"login": "yifanmai", "name": "Yifan Mai"}}, "url": "https://github.com/apache/beam/commit/f3d0298cba5013dc117038c8afc444d737793343", "committedDate": "2020-08-17T17:58:07Z", "message": "Copy subtransforms to output of translations.pipeline_from_stages()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNjgxOTkw", "url": "https://github.com/apache/beam/pull/12605#pullrequestreview-470681990", "createdAt": "2020-08-19T17:19:01Z", "commit": {"oid": "f3d0298cba5013dc117038c8afc444d737793343"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNzoxOTowMVrOHDRukQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNzoyODoyOVrOHDSErA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzE5ODIyNQ==", "bodyText": "Given that the set of subtransformation is a tree (no cycles) we can get rid of this.", "url": "https://github.com/apache/beam/pull/12605#discussion_r473198225", "createdAt": "2020-08-19T17:19:01Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/runners/portability/fn_api_runner/translations.py", "diffHunk": "@@ -524,6 +524,22 @@ def add_parent(child, parent):\n         add_parent(parent, parents.get(parent))\n       components.transforms[parent].subtransforms.append(child)\n \n+  copied_subtransform_ids = set()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3d0298cba5013dc117038c8afc444d737793343"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIwMzg4NA==", "bodyText": "I think we only want to copy sub-transforms of the transforms from line 552 above, perhaps move this logic up there? (Just a thought, maybe having the method be called (copy_subtransforms and having it copy (recursively) just the subtransforms could make this even easier to follow).", "url": "https://github.com/apache/beam/pull/12605#discussion_r473203884", "createdAt": "2020-08-19T17:28:29Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/runners/portability/fn_api_runner/translations.py", "diffHunk": "@@ -541,6 +557,14 @@ def add_parent(child, parent):\n     components.transforms[transform_id].CopyFrom(transform)\n     add_parent(transform_id, stage.parent)\n \n+  if partial:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3d0298cba5013dc117038c8afc444d737793343"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4598d6f5ee40a6f856b0b881886bd6ef1876bdc3", "author": {"user": {"login": "yifanmai", "name": "Yifan Mai"}}, "url": "https://github.com/apache/beam/commit/4598d6f5ee40a6f856b0b881886bd6ef1876bdc3", "committedDate": "2020-08-20T21:09:15Z", "message": "Clean up copy_subtransforms"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "578d08b631a107a7e1526beeed9e25ece7be5715", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/578d08b631a107a7e1526beeed9e25ece7be5715", "committedDate": "2020-08-25T19:47:05Z", "message": "lint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0Nzk3NjQ3", "url": "https://github.com/apache/beam/pull/12605#pullrequestreview-474797647", "createdAt": "2020-08-25T19:43:53Z", "commit": {"oid": "4598d6f5ee40a6f856b0b881886bd6ef1876bdc3"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxOTo0Mzo1M1rOHGnITQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxOTo0NjoxM1rOHGnNfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY5NDYwNQ==", "bodyText": "Nit: You can move this up into the if partial block above.", "url": "https://github.com/apache/beam/pull/12605#discussion_r476694605", "createdAt": "2020-08-25T19:43:53Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/runners/portability/fn_api_runner/translations.py", "diffHunk": "@@ -540,6 +549,8 @@ def add_parent(child, parent):\n     transform_id = unique_name(components.transforms, stage.name)\n     components.transforms[transform_id].CopyFrom(transform)\n     add_parent(transform_id, stage.parent)\n+    if partial:\n+      copy_subtransforms(transform)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4598d6f5ee40a6f856b0b881886bd6ef1876bdc3"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY5NTkzMw==", "bodyText": "14:14:31 apache_beam/runners/portability/fn_api_runner/translations.py:1485: error: syntax error in type comment 'Stage -> beam_runner_api_pb2.PTransform'  [syntax]\n14:14:31 apache_beam/runners/portability/fn_api_runner/translations.py:1485: note: Suggestion: wrap argument types in parentheses\n14:14:31 Found 1 error in 1 file (checked 719 source files)\n14:14:31 error: mypy exited with status 2\n14:14:32 ERROR: InvocationError for command /home/jenkins/jenkins-slave/workspace/beam_PreCommit_PythonLint_Commit/src/sdks/python/test-suites/tox/py37/build/srcs/sdks/python/target/.tox-py37-mypy/py37-mypy/bin/python setup.py mypy (exited with code 1)\n14:14:32 py37-mypy run-test-post: commands[0] | bash /home/jenkins/jenkins-slave/workspace/beam_PreCommit_PythonLint_Commit/src/sdks/python/test-suites/tox/py37/build/srcs/sdks/python/scripts/run_tox_cleanup.sh\n14:14:32 ___________________________________ summary ____________________________________\n14:14:32 ERROR:   py37-mypy: commands failed", "url": "https://github.com/apache/beam/pull/12605#discussion_r476695933", "createdAt": "2020-08-25T19:46:13Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/runners/portability/fn_api_runner/translations.py", "diffHunk": "@@ -1475,6 +1482,12 @@ def only_element(iterable):\n   return element\n \n \n+def only_transform(stage):\n+  # type: Stage -> beam_runner_api_pb2.PTransform", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4598d6f5ee40a6f856b0b881886bd6ef1876bdc3"}, "originalPosition": 73}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad51e78ba38d4fae0784cb5103adb677d6b85490", "author": {"user": {"login": "yifanmai", "name": "Yifan Mai"}}, "url": "https://github.com/apache/beam/commit/ad51e78ba38d4fae0784cb5103adb677d6b85490", "committedDate": "2020-08-26T18:40:34Z", "message": "Fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04096c6ae767a394220430493fe463dc51ae9743", "author": {"user": {"login": "yifanmai", "name": "Yifan Mai"}}, "url": "https://github.com/apache/beam/commit/04096c6ae767a394220430493fe463dc51ae9743", "committedDate": "2020-08-26T18:40:47Z", "message": "Merge branch 'yifanmai/subtransforms' of https://github.com/yifanmai/beam into yifanmai/subtransforms"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "233a6633db941f37972343d880486b041057627d", "author": {"user": {"login": "yifanmai", "name": "Yifan Mai"}}, "url": "https://github.com/apache/beam/commit/233a6633db941f37972343d880486b041057627d", "committedDate": "2020-08-26T18:45:36Z", "message": "Ran yapf"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4e80b6c333b0531c038d957a60ff6cb1e0c66b9", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/d4e80b6c333b0531c038d957a60ff6cb1e0c66b9", "committedDate": "2020-08-28T16:12:56Z", "message": "Merge branch 'master' into yifanmai/subtransforms"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4725, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}