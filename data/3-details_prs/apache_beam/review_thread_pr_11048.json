{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzOTUzMTg4", "number": 11048, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwMzo1MjoxNVrODlSGIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1MzoyM1rODleliQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNDIwMzg0OnYy", "diffSide": "RIGHT", "path": "sdks/java/expansion-service/src/main/java/org/apache/beam/sdk/expansion/service/ExpansionService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwMzo1MjoxNVrOFyFqIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwODowMTowMVrOFyv9gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA2NTgyNA==", "bodyText": "Prob. change to a log statement if you wish to keep this.", "url": "https://github.com/apache/beam/pull/11048#discussion_r388065824", "createdAt": "2020-03-05T03:52:15Z", "author": {"login": "chamikaramj"}, "path": "sdks/java/expansion-service/src/main/java/org/apache/beam/sdk/expansion/service/ExpansionService.java", "diffHunk": "@@ -404,7 +408,11 @@ public void close() throws Exception {\n   public static void main(String[] args) throws Exception {\n     int port = Integer.parseInt(args[0]);\n     System.out.println(\"Starting expansion service at localhost:\" + port);\n-    Server server = ServerBuilder.forPort(port).addService(new ExpansionService()).build();\n+    ExpansionService service = new ExpansionService();\n+    for (Map.Entry<String, TransformProvider> entry : service.registeredTransforms.entrySet()) {\n+      System.out.println(\"\\t\" + entry.getKey() + \": \" + entry.getValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b0766e6cf64499cf62a43b5b4a2c8e2115e673b"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc1ODkxMg==", "bodyText": "I used stdout as this is the main entry point (similar to the statement above).", "url": "https://github.com/apache/beam/pull/11048#discussion_r388758912", "createdAt": "2020-03-06T08:01:01Z", "author": {"login": "robertwb"}, "path": "sdks/java/expansion-service/src/main/java/org/apache/beam/sdk/expansion/service/ExpansionService.java", "diffHunk": "@@ -404,7 +408,11 @@ public void close() throws Exception {\n   public static void main(String[] args) throws Exception {\n     int port = Integer.parseInt(args[0]);\n     System.out.println(\"Starting expansion service at localhost:\" + port);\n-    Server server = ServerBuilder.forPort(port).addService(new ExpansionService()).build();\n+    ExpansionService service = new ExpansionService();\n+    for (Map.Entry<String, TransformProvider> entry : service.registeredTransforms.entrySet()) {\n+      System.out.println(\"\\t\" + entry.getKey() + \": \" + entry.getValue());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA2NTgyNA=="}, "originalCommit": {"oid": "4b0766e6cf64499cf62a43b5b4a2c8e2115e673b"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNDIxNzU2OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/io/external/kafka.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwNDowMjo1NVrOFyFyOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNzo1OTo0MlrOFyv7wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA2Nzg5OA==", "bodyText": "Probably add a comment here or in  BeamJarExpansionService to clarify how this works.\nIIUC,\n(1) For Beam version 2.x.y, we'll download the released kafka Jar for version 2.x.y\n(2) For Beam HEAD at version 2.(x+1).y.dev, we'll download the Beam Kafka Java jar for version 2.(x+1).y-SNAHSHOT\n(3) We'll always cache downloaded jars (in a sub-directory of the current directory ?). Please make sure that caching work for both released and non-released Beam.", "url": "https://github.com/apache/beam/pull/11048#discussion_r388067898", "createdAt": "2020-03-05T04:02:55Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/io/external/kafka.py", "diffHunk": "@@ -57,6 +58,10 @@\n     ])\n \n \n+def default_io_expansion_service():\n+  return BeamJarExpansionService('sdks:java:io:expansion-service:shadowJar')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b0766e6cf64499cf62a43b5b4a2c8e2115e673b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc1ODQ2NQ==", "bodyText": "This is documented in BeamJarExpansionService, though I've expanded it. We don't download SNAPSHOTs (yet)?", "url": "https://github.com/apache/beam/pull/11048#discussion_r388758465", "createdAt": "2020-03-06T07:59:42Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/io/external/kafka.py", "diffHunk": "@@ -57,6 +58,10 @@\n     ])\n \n \n+def default_io_expansion_service():\n+  return BeamJarExpansionService('sdks:java:io:expansion-service:shadowJar')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA2Nzg5OA=="}, "originalCommit": {"oid": "4b0766e6cf64499cf62a43b5b4a2c8e2115e673b"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjIzMDY4OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/io/external/kafka.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo0ODo1OVrOFyY9iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNzo0NToyNFrOFyvo6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4MjA4OA==", "bodyText": "Prob. we don't need this since we default to default_io_expansion_service() below ?", "url": "https://github.com/apache/beam/pull/11048#discussion_r388382088", "createdAt": "2020-03-05T15:48:59Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/io/external/kafka.py", "diffHunk": "@@ -166,6 +171,8 @@ def __init__(\n                                serialization.ByteArraySerializer'.\n     :param expansion_service: The address (host:port) of the ExpansionService.\n     \"\"\"\n+    if expansion_service is None:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b0766e6cf64499cf62a43b5b4a2c8e2115e673b"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc1MzY0Mw==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/11048#discussion_r388753643", "createdAt": "2020-03-06T07:45:24Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/io/external/kafka.py", "diffHunk": "@@ -166,6 +171,8 @@ def __init__(\n                                serialization.ByteArraySerializer'.\n     :param expansion_service: The address (host:port) of the ExpansionService.\n     \"\"\"\n+    if expansion_service is None:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4MjA4OA=="}, "originalCommit": {"oid": "4b0766e6cf64499cf62a43b5b4a2c8e2115e673b"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjIzNTY0OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/io/external/kafka.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1MDowM1rOFyZApQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQxNzo1Mjo1NFrOFzB5Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4Mjg4NQ==", "bodyText": "Can we add some unit tests for BeamJarExpansionService and JavaJarExpansionService ?", "url": "https://github.com/apache/beam/pull/11048#discussion_r388382885", "createdAt": "2020-03-05T15:50:03Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/io/external/kafka.py", "diffHunk": "@@ -57,6 +58,10 @@\n     ])\n \n \n+def default_io_expansion_service():\n+  return BeamJarExpansionService('sdks:java:io:expansion-service:shadowJar')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b0766e6cf64499cf62a43b5b4a2c8e2115e673b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA1MjczNA==", "bodyText": "Sure, added some unit tests. This is also tested end-to-end in the cross language tests.", "url": "https://github.com/apache/beam/pull/11048#discussion_r389052734", "createdAt": "2020-03-06T17:52:54Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/io/external/kafka.py", "diffHunk": "@@ -57,6 +58,10 @@\n     ])\n \n \n+def default_io_expansion_service():\n+  return BeamJarExpansionService('sdks:java:io:expansion-service:shadowJar')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4Mjg4NQ=="}, "originalCommit": {"oid": "4b0766e6cf64499cf62a43b5b4a2c8e2115e673b"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjI0NTg3OnYy", "diffSide": "LEFT", "path": "sdks/python/apache_beam/runners/portability/job_server.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1MjoyMFrOFyZG4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNlQwNzo1MzoxMlrOFyvy3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NDQ4MA==", "bodyText": "Seems like this is used here ?\n\n  \n    \n      beam/sdks/python/apache_beam/utils/subprocess_server.py\n    \n    \n         Line 198\n      in\n      b91560c\n    \n    \n    \n    \n\n        \n          \n           cached_jar = os.path.join(cls.JAR_CACHE, os.path.basename(url))", "url": "https://github.com/apache/beam/pull/11048#discussion_r388384480", "createdAt": "2020-03-05T15:52:20Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/runners/portability/job_server.py", "diffHunk": "@@ -125,10 +124,6 @@ def local_temp_dir(self, **kwargs):\n \n \n class JavaJarJobServer(SubprocessJobServer):\n-\n-  MAVEN_REPOSITORY = 'https://repo.maven.apache.org/maven2/org/apache/beam'\n-  JAR_CACHE = os.path.expanduser(\"~/.apache_beam/cache\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b0766e6cf64499cf62a43b5b4a2c8e2115e673b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODc1NjE4OQ==", "bodyText": "These are vestigial. That cls is never JavaJarJobServer.", "url": "https://github.com/apache/beam/pull/11048#discussion_r388756189", "createdAt": "2020-03-06T07:53:12Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/runners/portability/job_server.py", "diffHunk": "@@ -125,10 +124,6 @@ def local_temp_dir(self, **kwargs):\n \n \n class JavaJarJobServer(SubprocessJobServer):\n-\n-  MAVEN_REPOSITORY = 'https://repo.maven.apache.org/maven2/org/apache/beam'\n-  JAR_CACHE = os.path.expanduser(\"~/.apache_beam/cache\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NDQ4MA=="}, "originalCommit": {"oid": "4b0766e6cf64499cf62a43b5b4a2c8e2115e673b"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQwNjI1MDMzOnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/utils/subprocess_server.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1MzoyM1rOFyZJoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1MzoyM1rOFyZJoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NTE4NA==", "bodyText": "Please add a comment about this logging fix.", "url": "https://github.com/apache/beam/pull/11048#discussion_r388385184", "createdAt": "2020-03-05T15:53:23Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/utils/subprocess_server.py", "diffHunk": "@@ -82,9 +82,18 @@ def start(self):\n         port, = pick_port(None)\n         cmd = [arg.replace('{{PORT}}', str(port)) for arg in self._cmd]\n       endpoint = 'localhost:%s' % port\n-      _LOGGER.warning(\"Starting service with %s\", str(cmd).replace(\"',\", \"'\"))\n+      _LOGGER.info(\"Starting service with %s\", str(cmd).replace(\"',\", \"'\"))\n       try:\n-        self._process = subprocess.Popen(cmd)\n+        self._process = subprocess.Popen(\n+            cmd, stdout=subprocess.PIPE, stderr=subprocess.STDOUT)\n+\n+        def log_stdout():", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b0766e6cf64499cf62a43b5b4a2c8e2115e673b"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1787, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}