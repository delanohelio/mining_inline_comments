{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzMzAyNTMy", "number": 12163, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzo0MjowOFrOELyJRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoyMDozOFrOEM90wQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzkxMzY1OnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/BeamSqlPipelineOptions.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzo0MjowOFrOGthE_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQyMDo0NzowOFrOGtmkyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM4MTA1Mg==", "bodyText": "Can you add a note about which values are allowed here?", "url": "https://github.com/apache/beam/pull/12163#discussion_r450381052", "createdAt": "2020-07-06T17:42:08Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/BeamSqlPipelineOptions.java", "diffHunk": "@@ -30,6 +30,12 @@\n \n   void setPlannerName(String className);\n \n+  @Description(\"Default timezone for ZetaSQL analyzer; currently has no effect on CalciteSQL.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe8baaa0bb1a1f8d81dccc20d1d0c37875b1ba92"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3MTExNQ==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/12163#discussion_r450471115", "createdAt": "2020-07-06T20:47:08Z", "author": {"login": "robinyqiu"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/BeamSqlPipelineOptions.java", "diffHunk": "@@ -30,6 +30,12 @@\n \n   void setPlannerName(String className);\n \n+  @Description(\"Default timezone for ZetaSQL analyzer; currently has no effect on CalciteSQL.\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM4MTA1Mg=="}, "originalCommit": {"oid": "fe8baaa0bb1a1f8d81dccc20d1d0c37875b1ba92"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzkxNjk5OnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/CalciteQueryPlanner.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzo0MzoxMVrOGthG-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxOTo1NjozMVrOGtlJFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM4MTU2Mg==", "bodyText": "If defaultTimezone is set here, we should warn the user it will have no effect.", "url": "https://github.com/apache/beam/pull/12163#discussion_r450381562", "createdAt": "2020-07-06T17:43:11Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/CalciteQueryPlanner.java", "diffHunk": "@@ -75,7 +75,9 @@\n   private final Planner planner;\n   private final JdbcConnection connection;\n \n-  public CalciteQueryPlanner(JdbcConnection connection, RuleSet[] ruleSets) {\n+  public CalciteQueryPlanner(\n+      JdbcConnection connection, RuleSet[] ruleSets, String defaultTimezone) {\n+    // TODO: support setting default timezone?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe8baaa0bb1a1f8d81dccc20d1d0c37875b1ba92"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ0NzYzOQ==", "bodyText": "See comment below.", "url": "https://github.com/apache/beam/pull/12163#discussion_r450447639", "createdAt": "2020-07-06T19:56:31Z", "author": {"login": "robinyqiu"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/CalciteQueryPlanner.java", "diffHunk": "@@ -75,7 +75,9 @@\n   private final Planner planner;\n   private final JdbcConnection connection;\n \n-  public CalciteQueryPlanner(JdbcConnection connection, RuleSet[] ruleSets) {\n+  public CalciteQueryPlanner(\n+      JdbcConnection connection, RuleSet[] ruleSets, String defaultTimezone) {\n+    // TODO: support setting default timezone?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM4MTU2Mg=="}, "originalCommit": {"oid": "fe8baaa0bb1a1f8d81dccc20d1d0c37875b1ba92"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzkxNzc1OnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/CalciteQueryPlanner.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzo0MzoyNlrOGthHdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQyMzowMzoxNFrOGtpt_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM4MTY4Nw==", "bodyText": "Can you create and link a JIRA?", "url": "https://github.com/apache/beam/pull/12163#discussion_r450381687", "createdAt": "2020-07-06T17:43:26Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/CalciteQueryPlanner.java", "diffHunk": "@@ -75,7 +75,9 @@\n   private final Planner planner;\n   private final JdbcConnection connection;\n \n-  public CalciteQueryPlanner(JdbcConnection connection, RuleSet[] ruleSets) {\n+  public CalciteQueryPlanner(\n+      JdbcConnection connection, RuleSet[] ruleSets, String defaultTimezone) {\n+    // TODO: support setting default timezone?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe8baaa0bb1a1f8d81dccc20d1d0c37875b1ba92"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ0NzQ1Nw==", "bodyText": "Actually this config does not seem to apply to CalciteSQL, so I have reverted this change.", "url": "https://github.com/apache/beam/pull/12163#discussion_r450447457", "createdAt": "2020-07-06T19:56:05Z", "author": {"login": "robinyqiu"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/CalciteQueryPlanner.java", "diffHunk": "@@ -75,7 +75,9 @@\n   private final Planner planner;\n   private final JdbcConnection connection;\n \n-  public CalciteQueryPlanner(JdbcConnection connection, RuleSet[] ruleSets) {\n+  public CalciteQueryPlanner(\n+      JdbcConnection connection, RuleSet[] ruleSets, String defaultTimezone) {\n+    // TODO: support setting default timezone?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM4MTY4Nw=="}, "originalCommit": {"oid": "fe8baaa0bb1a1f8d81dccc20d1d0c37875b1ba92"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ1MjE2MQ==", "bodyText": "Actually this config does not seem to apply to CalciteSQL\n\nWhy not?", "url": "https://github.com/apache/beam/pull/12163#discussion_r450452161", "createdAt": "2020-07-06T20:06:45Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/CalciteQueryPlanner.java", "diffHunk": "@@ -75,7 +75,9 @@\n   private final Planner planner;\n   private final JdbcConnection connection;\n \n-  public CalciteQueryPlanner(JdbcConnection connection, RuleSet[] ruleSets) {\n+  public CalciteQueryPlanner(\n+      JdbcConnection connection, RuleSet[] ruleSets, String defaultTimezone) {\n+    // TODO: support setting default timezone?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM4MTY4Nw=="}, "originalCommit": {"oid": "fe8baaa0bb1a1f8d81dccc20d1d0c37875b1ba92"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUyMjYyMw==", "bodyText": "Default timezone affects the result of many time-related functions in ZetaSQL. In CalciteSQL language spec, I did not find any mention of default timezone. I guess this concept may not apply to CalciteSQL, or it does not affect CalciteSQL in the same way. So I am leaving the CalciteSQL part unchanged and make it clear the new option only applies to ZetaSQL dialect.", "url": "https://github.com/apache/beam/pull/12163#discussion_r450522623", "createdAt": "2020-07-06T23:03:14Z", "author": {"login": "robinyqiu"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/CalciteQueryPlanner.java", "diffHunk": "@@ -75,7 +75,9 @@\n   private final Planner planner;\n   private final JdbcConnection connection;\n \n-  public CalciteQueryPlanner(JdbcConnection connection, RuleSet[] ruleSets) {\n+  public CalciteQueryPlanner(\n+      JdbcConnection connection, RuleSet[] ruleSets, String defaultTimezone) {\n+    // TODO: support setting default timezone?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM4MTY4Nw=="}, "originalCommit": {"oid": "fe8baaa0bb1a1f8d81dccc20d1d0c37875b1ba92"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzkyNzIyOnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/SqlAnalyzer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzo0NjozNFrOGthNgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxOTo1Mzo1NlrOGtlElQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM4MzIzMw==", "bodyText": "While we're at it, maybe we should rename this getAnalyzerOptions. To me, init implies a one-time setup operation, which this is not.", "url": "https://github.com/apache/beam/pull/12163#discussion_r450383233", "createdAt": "2020-07-06T17:46:34Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/SqlAnalyzer.java", "diffHunk": "@@ -187,8 +167,10 @@ static AnalyzerOptions initAnalyzerOptions() {\n     return options;\n   }\n \n-  static AnalyzerOptions initAnalyzerOptions(QueryParameters queryParams) {\n-    AnalyzerOptions options = initAnalyzerOptions();\n+  static AnalyzerOptions initAnalyzerOptions(QueryParameters queryParams, String defaultTimezone) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe8baaa0bb1a1f8d81dccc20d1d0c37875b1ba92"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ0NjQ4NQ==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/12163#discussion_r450446485", "createdAt": "2020-07-06T19:53:56Z", "author": {"login": "robinyqiu"}, "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/SqlAnalyzer.java", "diffHunk": "@@ -187,8 +167,10 @@ static AnalyzerOptions initAnalyzerOptions() {\n     return options;\n   }\n \n-  static AnalyzerOptions initAnalyzerOptions(QueryParameters queryParams) {\n-    AnalyzerOptions options = initAnalyzerOptions();\n+  static AnalyzerOptions initAnalyzerOptions(QueryParameters queryParams, String defaultTimezone) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM4MzIzMw=="}, "originalCommit": {"oid": "fe8baaa0bb1a1f8d81dccc20d1d0c37875b1ba92"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzkzMjQyOnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSQLQueryPlanner.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzo0ODowOVrOGthQ3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxOTo1Mzo0OFrOGtlEUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM4NDA5NQ==", "bodyText": "Consider making this a javadoc comment so we can add a link.", "url": "https://github.com/apache/beam/pull/12163#discussion_r450384095", "createdAt": "2020-07-06T17:48:09Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSQLQueryPlanner.java", "diffHunk": "@@ -65,9 +65,12 @@ public ZetaSQLQueryPlanner(FrameworkConfig config) {\n     plannerImpl = new ZetaSQLPlannerImpl(config);\n   }\n \n-  public ZetaSQLQueryPlanner(JdbcConnection jdbcConnection, RuleSet[] ruleSets) {\n+  // Called by BeamSqlEnv.instantiatePlanner() reflectively", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe8baaa0bb1a1f8d81dccc20d1d0c37875b1ba92"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ0NjQxNw==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/12163#discussion_r450446417", "createdAt": "2020-07-06T19:53:48Z", "author": {"login": "robinyqiu"}, "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSQLQueryPlanner.java", "diffHunk": "@@ -65,9 +65,12 @@ public ZetaSQLQueryPlanner(FrameworkConfig config) {\n     plannerImpl = new ZetaSQLPlannerImpl(config);\n   }\n \n-  public ZetaSQLQueryPlanner(JdbcConnection jdbcConnection, RuleSet[] ruleSets) {\n+  // Called by BeamSqlEnv.instantiatePlanner() reflectively", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM4NDA5NQ=="}, "originalCommit": {"oid": "fe8baaa0bb1a1f8d81dccc20d1d0c37875b1ba92"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMDMxMjk3OnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/SqlAnalyzer.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNjoyMDozOFrOGvYf4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxODoyMTozNlrOGvctYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNzYzMw==", "bodyText": "nit: I'd prefer if you didn't rename this method, there are a bunch of references to it inside google. (Alternatively please rename the method of the same name in the C++ validator to match.)", "url": "https://github.com/apache/beam/pull/12163#discussion_r452337633", "createdAt": "2020-07-09T16:20:38Z", "author": {"login": "apilloud"}, "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/SqlAnalyzer.java", "diffHunk": "@@ -182,11 +164,10 @@ ResolvedStatement analyzeNextStatement(\n     return resolvedStatement;\n   }\n \n-  static AnalyzerOptions initAnalyzerOptions() {\n+  static AnalyzerOptions baseAnalyzerOptions() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93fb84254155582b54d06d482f44ba179edfab16"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQwNTU2MA==", "bodyText": "Thanks for the reminder! I will remember to rename them.\nReminder to @ibzib as well. I found you are also changing this file frequently these days. Any change made here should also be made to the internal validator code written in C++. I will sync the validator code later today to include the changes so far. In the future if you make changes again, please make sure you do that as well.", "url": "https://github.com/apache/beam/pull/12163#discussion_r452405560", "createdAt": "2020-07-09T18:19:50Z", "author": {"login": "robinyqiu"}, "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/SqlAnalyzer.java", "diffHunk": "@@ -182,11 +164,10 @@ ResolvedStatement analyzeNextStatement(\n     return resolvedStatement;\n   }\n \n-  static AnalyzerOptions initAnalyzerOptions() {\n+  static AnalyzerOptions baseAnalyzerOptions() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNzYzMw=="}, "originalCommit": {"oid": "93fb84254155582b54d06d482f44ba179edfab16"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQwNjYyNg==", "bodyText": "Any change made here should also be made to the internal validator code written in C++.\n\nAcknowledged.\n\nI will sync the validator code later today to include the changes so far.\n\nSounds good, please cc me on those changes.", "url": "https://github.com/apache/beam/pull/12163#discussion_r452406626", "createdAt": "2020-07-09T18:21:36Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/SqlAnalyzer.java", "diffHunk": "@@ -182,11 +164,10 @@ ResolvedStatement analyzeNextStatement(\n     return resolvedStatement;\n   }\n \n-  static AnalyzerOptions initAnalyzerOptions() {\n+  static AnalyzerOptions baseAnalyzerOptions() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNzYzMw=="}, "originalCommit": {"oid": "93fb84254155582b54d06d482f44ba179edfab16"}, "originalPosition": 59}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3462, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}