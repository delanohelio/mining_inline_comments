{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExMzMyMDA1", "number": 11578, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMDowNzowNlrOD4VSFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMDoxMTo0M1rOD4VU-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMzk1NTQwOnYy", "diffSide": "RIGHT", "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMDowNzowNlrOGPGbXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMDowNzowNlrOGPGbXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4NzEzMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                int tried = 0;\n          \n          \n            \n                Exception exception = null;\n          \n          \n            \n                int tried = 0;", "url": "https://github.com/apache/beam/pull/11578#discussion_r418487133", "createdAt": "2020-05-01T10:07:06Z", "author": {"login": "mxm"}, "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "diffHunk": "@@ -153,18 +153,22 @@ public static void beforeClass() throws Exception {\n \n   private static Cluster buildCluster(CassandraEmbeddedServerBuilder builder) {\n     int tried = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "561b3688cd963c5c4bd6fb139f5bcf94bd2a43e7"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMzk1NzE3OnYy", "diffSide": "RIGHT", "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMDowODoxOFrOGPGcag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwOTowODowMFrOGP4Mkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4NzQwMg==", "bodyText": "I couldn't find that this exception of type RuntimeException is thrown during cluster startup. We may want to catch all Exception here.", "url": "https://github.com/apache/beam/pull/11578#discussion_r418487402", "createdAt": "2020-05-01T10:08:18Z", "author": {"login": "mxm"}, "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "diffHunk": "@@ -153,18 +153,22 @@ public static void beforeClass() throws Exception {\n \n   private static Cluster buildCluster(CassandraEmbeddedServerBuilder builder) {\n     int tried = 0;\n-    while (tried < 3) {\n+    int delay = 5000;\n+    while (tried < 5) {\n       try {\n         return builder.buildNativeCluster();\n       } catch (NoHostAvailableException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "561b3688cd963c5c4bd6fb139f5bcf94bd2a43e7"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3MjA5Mg==", "bodyText": "The Exception is thrown by ControlConnection.reconnectInternal() in the datastax driver component. It is thrown when the client has tried to connect to all newly created cassandra nodes. I'm not sure that all types of exceptions are suited for retrial upon load hence this single catch. WDYT ?", "url": "https://github.com/apache/beam/pull/11578#discussion_r419272092", "createdAt": "2020-05-04T08:08:08Z", "author": {"login": "echauchot"}, "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "diffHunk": "@@ -153,18 +153,22 @@ public static void beforeClass() throws Exception {\n \n   private static Cluster buildCluster(CassandraEmbeddedServerBuilder builder) {\n     int tried = 0;\n-    while (tried < 3) {\n+    int delay = 5000;\n+    while (tried < 5) {\n       try {\n         return builder.buildNativeCluster();\n       } catch (NoHostAvailableException e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4NzQwMg=="}, "originalCommit": {"oid": "561b3688cd963c5c4bd6fb139f5bcf94bd2a43e7"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMwMjU0Ng==", "bodyText": "Seems fair.", "url": "https://github.com/apache/beam/pull/11578#discussion_r419302546", "createdAt": "2020-05-04T09:08:00Z", "author": {"login": "mxm"}, "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "diffHunk": "@@ -153,18 +153,22 @@ public static void beforeClass() throws Exception {\n \n   private static Cluster buildCluster(CassandraEmbeddedServerBuilder builder) {\n     int tried = 0;\n-    while (tried < 3) {\n+    int delay = 5000;\n+    while (tried < 5) {\n       try {\n         return builder.buildNativeCluster();\n       } catch (NoHostAvailableException e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4NzQwMg=="}, "originalCommit": {"oid": "561b3688cd963c5c4bd6fb139f5bcf94bd2a43e7"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMzk1ODY0OnYy", "diffSide": "RIGHT", "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMDowODo1N1rOGPGdPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODoxMTozMFrOGP2bnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4NzYxMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    tried++;\n          \n          \n            \n                    if (exception == null) {\n          \n          \n            \n                      exception = e;\n          \n          \n            \n                    } else {\n          \n          \n            \n                      exception.addSuppressed(e);\n          \n          \n            \n                    }\n          \n          \n            \n                    tried++;", "url": "https://github.com/apache/beam/pull/11578#discussion_r418487612", "createdAt": "2020-05-01T10:08:57Z", "author": {"login": "mxm"}, "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "diffHunk": "@@ -153,18 +153,22 @@ public static void beforeClass() throws Exception {\n \n   private static Cluster buildCluster(CassandraEmbeddedServerBuilder builder) {\n     int tried = 0;\n-    while (tried < 3) {\n+    int delay = 5000;\n+    while (tried < 5) {\n       try {\n         return builder.buildNativeCluster();\n       } catch (NoHostAvailableException e) {\n         tried++;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "561b3688cd963c5c4bd6fb139f5bcf94bd2a43e7"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3MzYyOQ==", "bodyText": "+1 thanks for the suggestion !", "url": "https://github.com/apache/beam/pull/11578#discussion_r419273629", "createdAt": "2020-05-04T08:11:30Z", "author": {"login": "echauchot"}, "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "diffHunk": "@@ -153,18 +153,22 @@ public static void beforeClass() throws Exception {\n \n   private static Cluster buildCluster(CassandraEmbeddedServerBuilder builder) {\n     int tried = 0;\n-    while (tried < 3) {\n+    int delay = 5000;\n+    while (tried < 5) {\n       try {\n         return builder.buildNativeCluster();\n       } catch (NoHostAvailableException e) {\n         tried++;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4NzYxMg=="}, "originalCommit": {"oid": "561b3688cd963c5c4bd6fb139f5bcf94bd2a43e7"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMzk2MDI2OnYy", "diffSide": "RIGHT", "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMDoxMDowM1rOGPGePw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODoxMTo0MlrOGP2cJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4Nzg3MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                throw new RuntimeException(\n          \n          \n            \n                    String.format(\n          \n          \n            \n                        \"Unable to create embedded Cassandra cluster: tried %d times with %d delay\",\n          \n          \n            \n                        tried, delay));\n          \n          \n            \n                throw new RuntimeException(\n          \n          \n            \n                    String.format(\n          \n          \n            \n                        \"Unable to create embedded Cassandra cluster: tried %d times with %d delay\",\n          \n          \n            \n                            tried, delay), \n          \n          \n            \n                        exception);", "url": "https://github.com/apache/beam/pull/11578#discussion_r418487871", "createdAt": "2020-05-01T10:10:03Z", "author": {"login": "mxm"}, "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "diffHunk": "@@ -153,18 +153,22 @@ public static void beforeClass() throws Exception {\n \n   private static Cluster buildCluster(CassandraEmbeddedServerBuilder builder) {\n     int tried = 0;\n-    while (tried < 3) {\n+    int delay = 5000;\n+    while (tried < 5) {\n       try {\n         return builder.buildNativeCluster();\n       } catch (NoHostAvailableException e) {\n         tried++;\n         try {\n-          Thread.sleep(1000L);\n+          Thread.sleep(delay);\n         } catch (InterruptedException e1) {\n         }\n       }\n     }\n-    throw new RuntimeException(\"Unable to create embedded Cassandra cluster\");\n+    throw new RuntimeException(\n+        String.format(\n+            \"Unable to create embedded Cassandra cluster: tried %d times with %d delay\",\n+            tried, delay));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "561b3688cd963c5c4bd6fb139f5bcf94bd2a43e7"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3Mzc2Nw==", "bodyText": "+1 thanks for the suggestion !", "url": "https://github.com/apache/beam/pull/11578#discussion_r419273767", "createdAt": "2020-05-04T08:11:42Z", "author": {"login": "echauchot"}, "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "diffHunk": "@@ -153,18 +153,22 @@ public static void beforeClass() throws Exception {\n \n   private static Cluster buildCluster(CassandraEmbeddedServerBuilder builder) {\n     int tried = 0;\n-    while (tried < 3) {\n+    int delay = 5000;\n+    while (tried < 5) {\n       try {\n         return builder.buildNativeCluster();\n       } catch (NoHostAvailableException e) {\n         tried++;\n         try {\n-          Thread.sleep(1000L);\n+          Thread.sleep(delay);\n         } catch (InterruptedException e1) {\n         }\n       }\n     }\n-    throw new RuntimeException(\"Unable to create embedded Cassandra cluster\");\n+    throw new RuntimeException(\n+        String.format(\n+            \"Unable to create embedded Cassandra cluster: tried %d times with %d delay\",\n+            tried, delay));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4Nzg3MQ=="}, "originalCommit": {"oid": "561b3688cd963c5c4bd6fb139f5bcf94bd2a43e7"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMzk2MjgyOnYy", "diffSide": "RIGHT", "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMDoxMTo0M1rOGPGf5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODoxMjo0M1rOGP2eEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4ODI5NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } catch (InterruptedException e1) {\n          \n          \n            \n                    } catch (InterruptedException e1) {\n          \n          \n            \n                      Thread.currentThread().interrupt();\n          \n          \n            \n                      throw new RuntimeException(\"interrupted\");\n          \n          \n            \n                    }", "url": "https://github.com/apache/beam/pull/11578#discussion_r418488295", "createdAt": "2020-05-01T10:11:43Z", "author": {"login": "mxm"}, "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "diffHunk": "@@ -153,18 +153,22 @@ public static void beforeClass() throws Exception {\n \n   private static Cluster buildCluster(CassandraEmbeddedServerBuilder builder) {\n     int tried = 0;\n-    while (tried < 3) {\n+    int delay = 5000;\n+    while (tried < 5) {\n       try {\n         return builder.buildNativeCluster();\n       } catch (NoHostAvailableException e) {\n         tried++;\n         try {\n-          Thread.sleep(1000L);\n+          Thread.sleep(delay);\n         } catch (InterruptedException e1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "561b3688cd963c5c4bd6fb139f5bcf94bd2a43e7"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3NDI1OQ==", "bodyText": "Yeah, that was too quick of me to ignore the interrupted exception :)", "url": "https://github.com/apache/beam/pull/11578#discussion_r419274259", "createdAt": "2020-05-04T08:12:43Z", "author": {"login": "echauchot"}, "path": "sdks/java/io/cassandra/src/test/java/org/apache/beam/sdk/io/cassandra/CassandraIOTest.java", "diffHunk": "@@ -153,18 +153,22 @@ public static void beforeClass() throws Exception {\n \n   private static Cluster buildCluster(CassandraEmbeddedServerBuilder builder) {\n     int tried = 0;\n-    while (tried < 3) {\n+    int delay = 5000;\n+    while (tried < 5) {\n       try {\n         return builder.buildNativeCluster();\n       } catch (NoHostAvailableException e) {\n         tried++;\n         try {\n-          Thread.sleep(1000L);\n+          Thread.sleep(delay);\n         } catch (InterruptedException e1) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ4ODI5NQ=="}, "originalCommit": {"oid": "561b3688cd963c5c4bd6fb139f5bcf94bd2a43e7"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1217, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}