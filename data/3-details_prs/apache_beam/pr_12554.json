{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2OTU1NTI4", "number": 12554, "title": "[BEAM-9615] Map user types to Schema reps.", "bodyText": "Add a schema.RegisterType method to preconvert user types to schema generated synthetic types, and be able to map them back to user types.\nAdd an schema option to indicate that the top level schema should be interpreted as a proto.\nAdd a field option to indicate whether a given int64 should actually be a go int.\n\nSame for maps, arrays, and slice types.\n\n\n\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-12T19:11:43Z", "url": "https://github.com/apache/beam/pull/12554", "merged": true, "mergeCommit": {"oid": "bc0ba7e3e7f907db74de807844d71e817d6a5359"}, "closed": true, "closedAt": "2020-08-14T17:03:47Z", "author": {"login": "lostluck"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-QSS1gH2gAyNDY2OTU1NTI4OmE4OTNkYjlhNWM1NWE1NTQ2MmI0NTljMWY2MWJlNDcwM2E2N2E0NTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-3W_wgH2gAyNDY2OTU1NTI4OmRmZDYzNTY1NjZlZmFjZTczN2JiMmQ5ZGY0MzNhMjRkNTkzMzFhOGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a893db9a5c55a55462b459c1f61be4703a67a456", "author": {"user": {"login": "lostluck", "name": "Robert Burke"}}, "url": "https://github.com/apache/beam/commit/a893db9a5c55a55462b459c1f61be4703a67a456", "committedDate": "2020-08-12T19:07:51Z", "message": "[BEAM-9615] Map user types to Schema reps."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5563550d4bab05b642f18aec0f848c62e7a6b2a3", "author": {"user": {"login": "lostluck", "name": "Robert Burke"}}, "url": "https://github.com/apache/beam/commit/5563550d4bab05b642f18aec0f848c62e7a6b2a3", "committedDate": "2020-08-12T21:12:42Z", "message": "Attempt to update gogradle.lock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d541a53c650ec3efb1d3771a8d7407b4cc9eb5f2", "author": {"user": {"login": "lostluck", "name": "Robert Burke"}}, "url": "https://github.com/apache/beam/commit/d541a53c650ec3efb1d3771a8d7407b4cc9eb5f2", "committedDate": "2020-08-12T22:35:26Z", "message": "!fixup gogradle.lock take two"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3Mjg3NjI5", "url": "https://github.com/apache/beam/pull/12554#pullrequestreview-467287629", "createdAt": "2020-08-14T03:41:25Z", "commit": {"oid": "d541a53c650ec3efb1d3771a8d7407b4cc9eb5f2"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMzo0MToyNVrOHAme9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMzo0MToyNVrOHAme9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5MjU2Nw==", "bodyText": "I get why this is ignoring the \"id\" field for the proto, but why \"options\"? This test seems to already be testing options in the other direction (options are respected when converting from schemas to reflect types). I figure it would also want to test that options are included as expected when converting to schemas.", "url": "https://github.com/apache/beam/pull/12554#discussion_r470392567", "createdAt": "2020-08-14T03:41:25Z", "author": {"login": "youngoli"}, "path": "sdks/go/pkg/beam/core/runtime/graphx/schema/schema_test.go", "diffHunk": "@@ -161,18 +354,22 @@ func TestSchemaConversion(t *testing.T) {\n \t\t\t\tif err != nil {\n \t\t\t\t\tt.Fatalf(\"error ToType(%v) = %v\", test.st, err)\n \t\t\t\t}\n-\n-\t\t\t\tif d := cmp.Diff(reflect.New(test.rt).Elem().Interface(), reflect.New(got).Elem().Interface()); d != \"\" {\n-\t\t\t\t\tt.Errorf(\"diff (-want, +got): %v\", d)\n+\t\t\t\tif !test.rt.AssignableTo(got) {\n+\t\t\t\t\tt.Errorf(\"%v not assignable to %v\", test.rt, got)\n+\t\t\t\t\tif d := cmp.Diff(reflect.New(test.rt).Elem().Interface(), reflect.New(got).Elem().Interface()); d != \"\" {\n+\t\t\t\t\t\tt.Errorf(\"diff (-want, +got): %v\", d)\n+\t\t\t\t\t}\n \t\t\t\t}\n \t\t\t}\n \t\t\t{\n \t\t\t\tgot, err := FromType(test.rt)\n \t\t\t\tif err != nil {\n \t\t\t\t\tt.Fatalf(\"error FromType(%v) = %v\", test.rt, err)\n \t\t\t\t}\n-\n-\t\t\t\tif d := cmp.Diff(test.st, got); d != \"\" {\n+\t\t\t\tif d := cmp.Diff(test.st, got,\n+\t\t\t\t\tprotocmp.Transform(),\n+\t\t\t\t\tprotocmp.IgnoreFields(proto.MessageV2(&pipepb.Schema{}), \"id\", \"options\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d541a53c650ec3efb1d3771a8d7407b4cc9eb5f2"}, "originalPosition": 234}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfd6356566eface737bb2d9df433a24d59331a8b", "author": {"user": {"login": "lostluck", "name": "Robert Burke"}}, "url": "https://github.com/apache/beam/commit/dfd6356566eface737bb2d9df433a24d59331a8b", "committedDate": "2020-08-14T16:39:17Z", "message": "Don't ignore options in comparison."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3482, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}