{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1ODYwMDQ1", "number": 12731, "title": "[BEAM-10830] Twister2 quickstarts and the runner maven archetypes", "bodyText": "Adding changes to complete quickstart for Twister2 runner and adding runner maven archetypes\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-30T04:12:20Z", "url": "https://github.com/apache/beam/pull/12731", "merged": true, "mergeCommit": {"oid": "f2dcbbed57dbc8a63447d36f9c8c48122d66f696"}, "closed": true, "closedAt": "2020-09-14T13:58:55Z", "author": {"login": "pulasthi"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdD0hMuAH2gAyNDc1ODYwMDQ1OjgzMzkwNTU4NTdhZDk5MTgzMDc3MDY4YTBjZTNmOGYyYWY5NDA2NDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIzpEpgFqTQ4NzQ3MTYyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8339055857ad99183077068a0ce3f8f2af940646", "author": {"user": {"login": "pulasthi", "name": "Pulasthi Supun "}}, "url": "https://github.com/apache/beam/commit/8339055857ad99183077068a0ce3f8f2af940646", "committedDate": "2020-08-30T02:10:20Z", "message": "adding twister2 quickstart"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NDcxNjI0", "url": "https://github.com/apache/beam/pull/12731#pullrequestreview-487471624", "createdAt": "2020-09-14T07:11:43Z", "commit": {"oid": "8339055857ad99183077068a0ce3f8f2af940646"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwNzoxMTo0NFrOHRGm7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxMzo1NzoyMVrOHRVm_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY5NjExMA==", "bodyText": "Is there any particular reason to use a different logger kind here?\nWe use slf4j in most of the Beam code base for logging so maybe good to follow this on the Twister2 runner. Notice that this can be done in a separate PR.", "url": "https://github.com/apache/beam/pull/12731#discussion_r487696110", "createdAt": "2020-09-14T07:11:44Z", "author": {"login": "iemejia"}, "path": "runners/twister2/src/main/java/org/apache/beam/runners/twister2/Twister2PipelineResult.java", "diffHunk": "@@ -17,15 +17,21 @@\n  */\n package org.apache.beam.runners.twister2;\n \n+import edu.iu.dsc.tws.api.scheduler.Twister2JobState;\n import java.io.IOException;\n import org.apache.beam.sdk.PipelineResult;\n import org.apache.beam.sdk.metrics.MetricResults;\n import org.joda.time.Duration;\n+import org.mortbay.log.Log;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8339055857ad99183077068a0ce3f8f2af940646"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkxODg2OA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/apache/beam/pull/12731#discussion_r487918868", "createdAt": "2020-09-14T13:35:23Z", "author": {"login": "iemejia"}, "path": "sdks/java/maven-archetypes/examples/src/main/resources/archetype-resources/pom.xml", "diffHunk": "@@ -281,6 +281,17 @@\n         </dependency>\n       </dependencies>\n     </profile>\n+    <profile>\n+      <id>twister2-runner</id>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8339055857ad99183077068a0ce3f8f2af940646"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk0MTg4Nw==", "bodyText": "with guava (use vendor if so) this can be simpler, but that's not blocking at all for this PR\nreturn Strings.isNullOrEmpty(options.getTwister2Home());", "url": "https://github.com/apache/beam/pull/12731#discussion_r487941887", "createdAt": "2020-09-14T13:57:21Z", "author": {"login": "iemejia"}, "path": "runners/twister2/src/main/java/org/apache/beam/runners/twister2/Twister2Runner.java", "diffHunk": "@@ -119,19 +129,27 @@ public PipelineResult run(Pipeline pipeline) {\n             .addComputeResource(options.getWorkerCPUs(), options.getRamMegaBytes(), workers)\n             .setConfig(jobConfig)\n             .build();\n-    Twister2JobState jobState = Twister2Submitter.submitJob(twister2Job, config);\n \n-    Twister2PipelineResult result = new Twister2PipelineResult();\n-    // TODO: Need to fix the check for \"RUNNING\" once fix for this is done on Twister2 end.\n-    if (jobState.getJobstate() == DriverJobState.FAILED\n-        || jobState.getJobstate() == DriverJobState.RUNNING) {\n-      throw new RuntimeException(\"Pipeline execution failed\", jobState.getCause());\n+    Twister2JobState jobState;\n+    if (isLocalMode(options)) {\n+      jobState = LocalSubmitter.submitJob(twister2Job, config);\n     } else {\n-      result.setState(PipelineResult.State.DONE);\n+      jobState = Twister2Submitter.submitJob(twister2Job, config);\n     }\n+\n+    Twister2PipelineResult result = new Twister2PipelineResult(jobState);\n     return result;\n   }\n \n+  /** Check if the Runner is set to use Twister local mode or pointing to a deployment. */\n+  private boolean isLocalMode(Twister2PipelineOptions options) {\n+    if (options.getTwister2Home() == null || \"\".equals(options.getTwister2Home())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8339055857ad99183077068a0ce3f8f2af940646"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4569, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}