{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5MTUyMjg3", "number": 13180, "title": " BEAM-9094 Configure S3 client for IO to s3 compatible object stores", "bodyText": "I would like to be able to configure s3 compatible IO in order to be able to use alternative endpoints. #10560 began moving in this direction but has been stalled for a while. The main comment there was that pipeline options should be used for configuration.\nSome open questions that I have are:\n\nIs there a reason that a separate S3IO instance was created for every operation in the s3filesystem? If so I can save a reference to the pipeline options in the constructor and pass that in instead of saving the single S3IO.\nAre there any naming considerations for the S3Options? Should they begin with a naming prefix to differentiate from other options provided on the command line?\nDoes it make sense to pass in tokens/keys through pipeline options? Should they instead be pulled from the environment?\n\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-10-23T18:47:00Z", "url": "https://github.com/apache/beam/pull/13180", "merged": true, "mergeCommit": {"oid": "b35d4cc3d5ef536df7e2013770a347bfbbf794e1"}, "closed": true, "closedAt": "2020-10-27T17:56:19Z", "author": {"login": "dandy10"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVbX6YAH2gAyNTA5MTUyMjg3OjkzM2E4YzU3YzFhMzcwOTAyNzFjMmQ3NTQwZjMyNGRjODgyYzY5M2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWn67fAH2gAyNTA5MTUyMjg3OjI1ZDdkYWY5MWE4MGRhNmNmNTY4YjgwM2QxY2MwYTgyODRjMTMzOGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "933a8c57c1a37090271c2d7540f324dc882c693e", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/933a8c57c1a37090271c2d7540f324dc882c693e", "committedDate": "2020-10-23T19:03:12Z", "message": "add s3 options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21e4763ac4f5818790ed05374dc090ee79156504", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/21e4763ac4f5818790ed05374dc090ee79156504", "committedDate": "2020-10-23T19:03:20Z", "message": "pass s3 options through to boto3_client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27a856f189d58dba5e20913941ca96787a81d959", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/27a856f189d58dba5e20913941ca96787a81d959", "committedDate": "2020-10-23T19:03:23Z", "message": "pass pipeline options through S3IO"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbc6dd638cddf61677dd4dcf1f21a35fb767eda4", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/fbc6dd638cddf61677dd4dcf1f21a35fb767eda4", "committedDate": "2020-10-23T19:03:31Z", "message": "consolidate naming convention without prefix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4e86acf07510538250225ec9437201676b1fe59b", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/4e86acf07510538250225ec9437201676b1fe59b", "committedDate": "2020-10-23T18:46:33Z", "message": "add line to changes"}, "afterCommit": {"oid": "fbc6dd638cddf61677dd4dcf1f21a35fb767eda4", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/fbc6dd638cddf61677dd4dcf1f21a35fb767eda4", "committedDate": "2020-10-23T19:03:31Z", "message": "consolidate naming convention without prefix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "584db8ba8813917747feb967ba039d503870b1bb", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/584db8ba8813917747feb967ba039d503870b1bb", "committedDate": "2020-10-23T19:06:48Z", "message": "document change in CHANGES.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1OTgwOTM5", "url": "https://github.com/apache/beam/pull/13180#pullrequestreview-515980939", "createdAt": "2020-10-23T20:10:24Z", "commit": {"oid": "584db8ba8813917747feb967ba039d503870b1bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMDoxMDoyNVrOHndFNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QyMDoxMDoyNVrOHndFNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTEzMjk4Mw==", "bodyText": "You are correct that it's desirable to use a sort of namespace prefix. Perhaps --aws_ or --aws_s3_. What do you think?\nYou must know more than me about s3 and AWS - I wonder if aws_session_token, aws_secret_access_key, aws_access_key_id  in this context are specific for s3, or if they provide some sort of AWS-wide authentication?\nIf they're s3-specific, then maybe we should namespace them as aws_s3? Let me know what you think.", "url": "https://github.com/apache/beam/pull/13180#discussion_r511132983", "createdAt": "2020-10-23T20:10:25Z", "author": {"login": "pabloem"}, "path": "sdks/python/apache_beam/options/pipeline_options.py", "diffHunk": "@@ -1321,3 +1320,39 @@ def augment_options(cls, options):\n       for name, value in override.items():\n         setattr(options, name, value)\n     return options\n+\n+\n+class S3Options(PipelineOptions):\n+  @classmethod\n+  def _add_argparse_args(cls, parser):\n+    # These options are passed to the S3 IO Client\n+    parser.add_argument(\n+        '--aws_access_key_id',\n+        default=None,\n+        help='The secret key to use when creating the s3 client.')\n+    parser.add_argument(\n+        '--aws_secret_access_key',\n+        default=None,\n+        help='The secret key to use when creating the s3 client.')\n+    parser.add_argument(\n+        '--aws_session_token',\n+        default=None,\n+        help='The session token to use when creating the s3 client.')\n+    parser.add_argument(\n+        '--endpoint_url',\n+        default=None,\n+        help='The complete URL to use for the constructed s3 client.')\n+    parser.add_argument(\n+        '--region_name',\n+        default=None,\n+        help='The name of the region associated with the client.')\n+    parser.add_argument(\n+        '--api_version', default=None, help='The API version to use.')\n+    parser.add_argument(\n+        '--verify',\n+        default=None,\n+        help='Whether or not to verify SSL certificates.')\n+    parser.add_argument(\n+        '--use_ssl',\n+        default=True,\n+        help='Whether or not to use SSL. By default, SSL is used.')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "584db8ba8813917747feb967ba039d503870b1bb"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "594379abbc1e7beb66d8001f68a43edd5a50379e", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/594379abbc1e7beb66d8001f68a43edd5a50379e", "committedDate": "2020-10-23T20:53:27Z", "message": "consolidate on s3 prefix for pipeline options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f07e5d073e8589111e24900ec710cc1242ba828", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/3f07e5d073e8589111e24900ec710cc1242ba828", "committedDate": "2020-10-24T09:12:34Z", "message": "do not shadow imported module name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3e991adf4619c253121c1ebc5aa1ecea6b5d4fd", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/c3e991adf4619c253121c1ebc5aa1ecea6b5d4fd", "committedDate": "2020-10-24T09:12:56Z", "message": "reinstantiate S3IO for each operation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef99f9e858b0504b0cd887fc3346480f40ca6efa", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/ef99f9e858b0504b0cd887fc3346480f40ca6efa", "committedDate": "2020-10-24T09:18:03Z", "message": "undo unintentional format changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8544d068095fb03abe6477b2c093c5643d805f0", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/b8544d068095fb03abe6477b2c093c5643d805f0", "committedDate": "2020-10-24T11:27:00Z", "message": "update tests with new constructor args"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4786646dd778bb39a0096c86a90ca1352dabacbf", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/4786646dd778bb39a0096c86a90ca1352dabacbf", "committedDate": "2020-10-24T11:39:32Z", "message": "format fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fc8ffdb1b182c6e30064e2cbcb4f551637d8c6a", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/6fc8ffdb1b182c6e30064e2cbcb4f551637d8c6a", "committedDate": "2020-10-25T14:02:03Z", "message": "fix naming error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f88b2aa60752556bea862955e2bf52f4ec8c64e", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/7f88b2aa60752556bea862955e2bf52f4ec8c64e", "committedDate": "2020-10-25T21:03:08Z", "message": "remove duplicated property access"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25d7daf91a80da6cf568b803d1cc0a8284c1338f", "author": {"user": {"login": "johndoe12312", "name": null}}, "url": "https://github.com/apache/beam/commit/25d7daf91a80da6cf568b803d1cc0a8284c1338f", "committedDate": "2020-10-27T12:14:14Z", "message": "use action for boolean flag"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4958, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}