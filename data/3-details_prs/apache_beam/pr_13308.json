{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NDc5ODcy", "number": 13308, "title": "[BEAM-10891] Standardized developer build environment using Docker", "bodyText": "This adds a docker based build environment intended for developers to have a predictable working environment with all needed tools present.\nOn a Linux machine (I ONLY tested this on my Ubuntu 20.04 laptop) just run the start-build-env.sh script to build and start a Docker based build setup that wraps around the current source tree beam copy.\nThis is based upon the initiative started by @omarismail94 #12837 and copies large parts from https://github.com/apache/hadoop\nAs suggested by @TheNeuralBit in #12837 I was able to run ./gradlew :sdks:python:container:py37:docker inside this docker setup which actually created a 2.39GB docker image apache/beam_python3.7_sdk:2.27.0.dev\nTODO:\n\n Check if the entire build works in this.\n Write the documentation.\n\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-11-11T22:13:00Z", "url": "https://github.com/apache/beam/pull/13308", "merged": true, "mergeCommit": {"oid": "60fe232a75117fb8981b608e11be3d14a34bd83b"}, "closed": true, "closedAt": "2020-12-05T00:00:56Z", "author": {"login": "nielsbasjes"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbvW-AgBqjM5ODc3NDE2MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdjAjsHAFqTU0NTM2NjUzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "623a9b2e120af9a3de1c2a6933fce090701631a5", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/623a9b2e120af9a3de1c2a6933fce090701631a5", "committedDate": "2020-11-11T21:49:41Z", "message": "[BEAM-10891] Standardized build environment using Docker"}, "afterCommit": {"oid": "3a8def06ab69e4187bae453e6b2f1b5a6a612c4d", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/3a8def06ab69e4187bae453e6b2f1b5a6a612c4d", "committedDate": "2020-11-12T09:43:33Z", "message": "[BEAM-10891] Standardized build environment using Docker"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a8def06ab69e4187bae453e6b2f1b5a6a612c4d", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/3a8def06ab69e4187bae453e6b2f1b5a6a612c4d", "committedDate": "2020-11-12T09:43:33Z", "message": "[BEAM-10891] Standardized build environment using Docker"}, "afterCommit": {"oid": "99e7d3d5b172397df6a5bb541c0d48d1acaa3c8f", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/99e7d3d5b172397df6a5bb541c0d48d1acaa3c8f", "committedDate": "2020-11-12T09:46:00Z", "message": "[BEAM-10891] Standardized build environment using Docker"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "99e7d3d5b172397df6a5bb541c0d48d1acaa3c8f", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/99e7d3d5b172397df6a5bb541c0d48d1acaa3c8f", "committedDate": "2020-11-12T09:46:00Z", "message": "[BEAM-10891] Standardized build environment using Docker"}, "afterCommit": {"oid": "f66285dcdf90b004eef20d5d21e83084155e2fd3", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/f66285dcdf90b004eef20d5d21e83084155e2fd3", "committedDate": "2020-11-12T13:43:54Z", "message": "[BEAM-10891] Standardized build environment using Docker"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f66285dcdf90b004eef20d5d21e83084155e2fd3", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/f66285dcdf90b004eef20d5d21e83084155e2fd3", "committedDate": "2020-11-12T13:43:54Z", "message": "[BEAM-10891] Standardized build environment using Docker"}, "afterCommit": {"oid": "5814f96f7b4bd844ca47f377856402627f1e418c", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/5814f96f7b4bd844ca47f377856402627f1e418c", "committedDate": "2020-11-12T13:48:09Z", "message": "[BEAM-10891] Standardized build environment using Docker"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5814f96f7b4bd844ca47f377856402627f1e418c", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/5814f96f7b4bd844ca47f377856402627f1e418c", "committedDate": "2020-11-12T13:48:09Z", "message": "[BEAM-10891] Standardized build environment using Docker"}, "afterCommit": {"oid": "50ced866a9f984c1e901c0a0ba2125f34f2e6c4b", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/50ced866a9f984c1e901c0a0ba2125f34f2e6c4b", "committedDate": "2020-11-23T14:25:54Z", "message": "[BEAM-10891] Standardized build environment using Docker"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MTM4ODMy", "url": "https://github.com/apache/beam/pull/13308#pullrequestreview-536138832", "createdAt": "2020-11-23T01:07:32Z", "commit": {"oid": "5814f96f7b4bd844ca47f377856402627f1e418c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwMTowNzozMlrOH39FnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwMTowNzozMlrOH39FnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQzNDU4OA==", "bodyText": "I think you can add time to the package installation and will remove the need for this. I did that on my end and it worked!", "url": "https://github.com/apache/beam/pull/13308#discussion_r528434588", "createdAt": "2020-11-23T01:07:32Z", "author": {"login": "omarismail94"}, "path": "dev-support/docker/Dockerfile", "diffHunk": "@@ -0,0 +1,141 @@\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Dockerfile for installing the necessary dependencies for building Hadoop.\n+# See BUILDING.txt.\n+\n+FROM ubuntu:20.04\n+\n+ARG DEBIAN_FRONTEND=noninteractive\n+\n+WORKDIR /root\n+\n+SHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n+\n+#####\n+# Disable suggests/recommends\n+#####\n+RUN echo APT::Install-Recommends \"0\"\\; > /etc/apt/apt.conf.d/10disableextras\n+RUN echo APT::Install-Suggests \"0\"\\; >>  /etc/apt/apt.conf.d/10disableextras\n+\n+ENV DEBIAN_FRONTEND noninteractive\n+ENV DEBCONF_TERSE true\n+\n+\n+# hadolint ignore=DL3008\n+RUN apt -q update \\\n+    && apt install -y software-properties-common apt-utils apt-transport-https \\\n+    # Repo for different Python versions\n+    && add-apt-repository -y ppa:deadsnakes/ppa \\\n+    && apt-get -q install -y --no-install-recommends \\\n+        ant \\\n+        bats \\\n+        bash-completion \\\n+        build-essential \\\n+        bzip2 \\\n+        ca-certificates \\\n+        clang \\\n+        cmake \\\n+        curl \\\n+        docker.io \\\n+        doxygen \\\n+        findbugs \\\n+        fuse \\\n+        g++ \\\n+        gcc \\\n+        git \\\n+        gnupg-agent \\\n+        libbcprov-java \\\n+        libbz2-dev \\\n+        libcurl4-openssl-dev \\\n+        libfuse-dev \\\n+        libprotobuf-dev \\\n+        libprotoc-dev \\\n+        libsasl2-dev \\\n+        libsnappy-dev \\\n+        libssl-dev \\\n+        libtool \\\n+        libzstd-dev \\\n+        locales \\\n+        make \\\n+        maven \\\n+#        openjdk-11-jdk \\\n+        openjdk-8-jdk \\\n+        pinentry-curses \\\n+        pkg-config \\\n+        python \\\n+        python2.7 \\\n+#        python-pip \\\n+        python-pkg-resources \\\n+        python-setuptools \\\n+#        python-wheel \\\n+        python3-setuptools \\\n+        python3-pip \\\n+        python3.5 \\\n+        python3.6 \\\n+        python3.7 \\\n+        python2.7 \\\n+        virtualenv \\\n+        tox \\\n+        rsync \\\n+        shellcheck \\\n+        software-properties-common \\\n+        sudo \\\n+        valgrind \\\n+        vim \\\n+        wget \\\n+        zlib1g-dev \\\n+    && apt-get clean \\\n+    && rm -rf /var/lib/apt/lists/*\n+\n+###\n+# Install grpcio-tools mypy-protobuf for `python3 sdks/python/setup.py sdist` to work\n+###\n+RUN pip3 install grpcio-tools mypy-protobuf\n+\n+###\n+# Install Go\n+###\n+RUN mkdir -p /goroot \\\n+    && curl https://dl.google.com/go/go1.15.2.linux-amd64.tar.gz | tar xvzf - -C /goroot --strip-components=1 \\\n+    && chmod a+rwX -R /goroot\n+\n+# Set environment variables for Go\n+ENV GOROOT /goroot\n+ENV GOPATH /gopath\n+ENV PATH $GOROOT/bin:$GOPATH/bin:$PATH\n+CMD go get github.com/linkedin/goavro\n+\n+###\n+# Miscelaneous fixes...\n+###\n+# Turns out some build tools use 'time' and in this docker image this is no longer\n+# an executable but ONLY an internal command of bash\n+COPY time /usr/bin/time", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5814f96f7b4bd844ca47f377856402627f1e418c"}, "originalPosition": 128}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "661605a44e0f9f5616764e7afb4945f631a7fc94", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/661605a44e0f9f5616764e7afb4945f631a7fc94", "committedDate": "2020-11-24T15:09:16Z", "message": "Downgrade to Go 1.12 to see if the build works better now"}, "afterCommit": {"oid": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/5e6296fb61b6675bc37ed5d87ff6c3482dd90896", "committedDate": "2020-11-30T20:39:40Z", "message": "[BEAM-10891] Standardized build environment using Docker"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxMjg1NjYx", "url": "https://github.com/apache/beam/pull/13308#pullrequestreview-541285661", "createdAt": "2020-11-30T20:53:32Z", "commit": {"oid": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDo1MzozMlrOH8NanQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMzo0MDozN1rOH8W-MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg5NjQxMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    python3.5 \\\n          \n          \n            \n                    python3.6 \\\n          \n          \n            \n                    python3.7 \\\n          \n          \n            \n                    python2.7 \\\n          \n          \n            \n                    python3.6 \\\n          \n          \n            \n                    python3.7 \\\n          \n          \n            \n                    python3.8 \\\n          \n      \n    \n    \n  \n\nWe no longer support python 2.7 or 3.5, and we do support 3.8 (looks like this is actually still incorrect in https://beam.apache.org/contribute/#prerequisites, I'll send a PR to fix)", "url": "https://github.com/apache/beam/pull/13308#discussion_r532896413", "createdAt": "2020-11-30T20:53:32Z", "author": {"login": "TheNeuralBit"}, "path": "dev-support/docker/Dockerfile", "diffHunk": "@@ -0,0 +1,110 @@\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Dockerfile for installing the necessary dependencies for building Hadoop.\n+# See BUILDING.txt.\n+\n+FROM ubuntu:20.04\n+\n+ARG DEBIAN_FRONTEND=noninteractive\n+\n+WORKDIR /root\n+\n+SHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n+\n+#####\n+# Disable suggests/recommends\n+#####\n+RUN echo APT::Install-Recommends \"0\"\\; > /etc/apt/apt.conf.d/10disableextras\n+RUN echo APT::Install-Suggests \"0\"\\; >>  /etc/apt/apt.conf.d/10disableextras\n+\n+ENV DEBIAN_FRONTEND noninteractive\n+ENV DEBCONF_TERSE true\n+\n+\n+# hadolint ignore=DL3008\n+###\n+# Update and install common packages\n+###\n+RUN apt -q update \\\n+   && apt install -y software-properties-common apt-utils apt-transport-https ca-certificates \\\n+   && add-apt-repository -y ppa:deadsnakes/ppa \\\n+   && apt-get -q install -y --no-install-recommends \\\n+        bash-completion \\\n+        build-essential \\\n+        bzip2 \\\n+        curl \\\n+        docker.io \\\n+        g++ \\\n+        gcc \\\n+        git \\\n+        gnupg-agent \\\n+        rsync \\\n+        sudo \\\n+        vim \\\n+        locales \\\n+        wget \\\n+        time \\\n+        openjdk-8-jdk \\\n+        python3-setuptools \\\n+        python3-pip \\\n+        python3.5 \\\n+        python3.6 \\\n+        python3.7 \\\n+        python2.7 \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg5ODMwMg==", "bodyText": "can this be removed?", "url": "https://github.com/apache/beam/pull/13308#discussion_r532898302", "createdAt": "2020-11-30T20:56:55Z", "author": {"login": "TheNeuralBit"}, "path": "start-build-env.sh", "diffHunk": "@@ -0,0 +1,131 @@\n+#!/usr/bin/env bash\n+\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+set -e               # exit on error\n+\n+cd \"$(dirname \"$0\")\" # connect to root\n+\n+DOCKER_DIR=dev-support/docker\n+DOCKER_FILE=\"${DOCKER_DIR}/Dockerfile\"\n+\n+CONTAINER_NAME=beam-dev-${USER}-$$\n+\n+#CPU_ARCH=$(echo \"$MACHTYPE\" | cut -d- -f1)\n+#if [ \"$CPU_ARCH\" = \"aarch64\" ]; then\n+#  DOCKER_FILE=\"${DOCKER_DIR}/Dockerfile_aarch64\"\n+#fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkxMzYyOA==", "bodyText": "Could you add a check that prints a helpful message if docker does not exist?", "url": "https://github.com/apache/beam/pull/13308#discussion_r532913628", "createdAt": "2020-11-30T21:25:32Z", "author": {"login": "TheNeuralBit"}, "path": "start-build-env.sh", "diffHunk": "@@ -0,0 +1,131 @@\n+#!/usr/bin/env bash\n+\n+# Licensed to the Apache Software Foundation (ASF) under one or more\n+# contributor license agreements.  See the NOTICE file distributed with\n+# this work for additional information regarding copyright ownership.\n+# The ASF licenses this file to You under the Apache License, Version 2.0\n+# (the \"License\"); you may not use this file except in compliance with\n+# the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+set -e               # exit on error\n+\n+cd \"$(dirname \"$0\")\" # connect to root\n+\n+DOCKER_DIR=dev-support/docker\n+DOCKER_FILE=\"${DOCKER_DIR}/Dockerfile\"\n+\n+CONTAINER_NAME=beam-dev-${USER}-$$\n+\n+#CPU_ARCH=$(echo \"$MACHTYPE\" | cut -d- -f1)\n+#if [ \"$CPU_ARCH\" = \"aarch64\" ]; then\n+#  DOCKER_FILE=\"${DOCKER_DIR}/Dockerfile_aarch64\"\n+#fi\n+\n+docker build -t beam-build -f $DOCKER_FILE $DOCKER_DIR\n+\n+USER_NAME=${SUDO_USER:=$USER}\n+USER_ID=$(id -u \"${USER_NAME}\")\n+\n+if [ \"$(uname -s)\" = \"Darwin\" ]; then\n+  GROUP_ID=100\n+fi\n+\n+if [ \"$(uname -s)\" = \"Linux\" ]; then\n+  GROUP_ID=$(id -g \"${USER_NAME}\")\n+  # man docker-run\n+  # When using SELinux, mounted directories may not be accessible\n+  # to the container. To work around this, with Docker prior to 1.7\n+  # one needs to run the \"chcon -Rt svirt_sandbox_file_t\" command on\n+  # the directories. With Docker 1.7 and later the z mount option\n+  # does this automatically.\n+  if command -v selinuxenabled >/dev/null && selinuxenabled; then\n+    DCKR_VER=$(docker -v|\n+    awk '$1 == \"Docker\" && $2 == \"version\" {split($3,ver,\".\");print ver[1]\".\"ver[2]}')\n+    DCKR_MAJ=${DCKR_VER%.*}\n+    DCKR_MIN=${DCKR_VER#*.}\n+    if [ \"${DCKR_MAJ}\" -eq 1 ] && [ \"${DCKR_MIN}\" -ge 7 ] ||\n+        [ \"${DCKR_MAJ}\" -gt 1 ]; then\n+      V_OPTS=:z\n+    else\n+      for d in \"${PWD}\" \"${HOME}/.m2\"; do\n+        ctx=$(stat --printf='%C' \"$d\"|cut -d':' -f3)\n+        if [ \"$ctx\" != svirt_sandbox_file_t ] && [ \"$ctx\" != container_file_t ]; then\n+          printf 'INFO: SELinux is enabled.\\n'\n+          printf '\\tMounted %s may not be accessible to the container.\\n' \"$d\"\n+          printf 'INFO: If so, on the host, run the following command:\\n'\n+          printf '\\t# chcon -Rt svirt_sandbox_file_t %s\\n' \"$d\"\n+        fi\n+      done\n+    fi\n+  fi\n+fi\n+\n+# Set the home directory in the Docker container.\n+DOCKER_HOME_DIR=${DOCKER_HOME_DIR:-/home/${USER_NAME}}\n+\n+DOCKER_GROUP_ID=$(getent group docker | cut -d':' -f3)\n+\n+docker build -t \"beam-build-${USER_ID}\" - <<UserSpecificDocker\n+FROM beam-build\n+RUN rm -f /var/log/faillog /var/log/lastlog\n+RUN groupadd --non-unique -g ${GROUP_ID} ${USER_NAME}\n+RUN groupmod -g ${DOCKER_GROUP_ID} docker\n+RUN useradd -g ${GROUP_ID} -G docker -u ${USER_ID} -k /root -m ${USER_NAME} -d \"${DOCKER_HOME_DIR}\"\n+RUN echo \"${USER_NAME} ALL=NOPASSWD: ALL\" > \"/etc/sudoers.d/beam-build-${USER_ID}\"\n+ENV HOME \"${DOCKER_HOME_DIR}\"\n+ENV GOPATH ${HOME}/beam/sdks/go/examples/.gogradle/project_gopath\n+\n+# This next command still runs as root causing the ~/.cache/go-build to be owned by root\n+RUN go get github.com/linkedin/goavro\n+RUN chown -R ${USER_NAME}:${GROUP_ID} ${HOME}/.cache\n+UserSpecificDocker\n+\n+echo \"\"\n+echo \"Docker image build completed.\"\n+echo \"==============================================================================================\"\n+echo \"\"\n+\n+# If this env variable is empty, docker will be started\n+# in non interactive mode\n+DOCKER_INTERACTIVE_RUN=${DOCKER_INTERACTIVE_RUN-\"-i -t\"}\n+\n+DOCKER_SOCKET_MOUNT=\"\"\n+if [ -S /var/run/docker.sock ];\n+then\n+  DOCKER_SOCKET_MOUNT=\"-v /var/run/docker.sock:/var/run/docker.sock${V_OPTS:-}\"\n+  echo \"Enabling Docker support with the docker build environment.\"\n+else\n+  echo \"There is NO Docker support with the docker build environment.\"\n+fi\n+\n+COMMAND=( \"$@\" )\n+if [ $# -eq 0 ];\n+then\n+  COMMAND=( \"bash\" )\n+fi\n+\n+[ -d \"${HOME}/.beam_docker_build_env/.gradle\" ] || mkdir -p \"${HOME}/.beam_docker_build_env/.gradle\"\n+\n+# By mapping the .m2 directory you can do an mvn install from\n+# within the container and use the result on your normal\n+# system.  And this also is a significant speedup in subsequent\n+# builds because the dependencies are downloaded only once.\n+docker run --rm=true ${DOCKER_INTERACTIVE_RUN}                         \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkxNTQ5MQ==", "bodyText": "Let's make this more helpful - maybe it could point people to a page like this: https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user", "url": "https://github.com/apache/beam/pull/13308#discussion_r532915491", "createdAt": "2020-11-30T21:29:14Z", "author": {"login": "TheNeuralBit"}, "path": "dev-support/docker/beam_env_checks.sh", "diffHunk": "@@ -0,0 +1,120 @@\n+#!/usr/bin/env bash\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# SHELLDOC-IGNORE\n+\n+# -------------------------------------------------------\n+function showWelcome {\n+# http://patorjk.com/software/taag/#p=display&f=Doom&t=Beam%20Build%20Env.\n+cat << \"Welcome-message\"\n+\n+______                       ______       _ _     _   _____\n+| ___ \\                      | ___ \\     (_) |   | | |  ___|\n+| |_/ / ___  __ _ _ __ ___   | |_/ /_   _ _| | __| | | |__ _ ____   __\n+| ___ \\/ _ \\/ _` | '_ ` _ \\  | ___ \\ | | | | |/ _` | |  __| '_ \\ \\ / /\n+| |_/ /  __/ (_| | | | | | | | |_/ / |_| | | | (_| | | |__| | | \\ V /\n+\\____/ \\___|\\__,_|_| |_| |_| \\____/ \\__,_|_|_|\\__,_| \\____/_| |_|\\_(_)\n+\n+This is the standard Beam Developer build environment.\n+This has all the right tools installed required to build\n+Apache Beam from source.\n+\n+Welcome-message\n+}\n+\n+# -------------------------------------------------------\n+\n+function showAbort {\n+  cat << \"Abort-message\"\n+\n+  ___  _                _   _\n+ / _ \\| |              | | (_)\n+/ /_\\ \\ |__   ___  _ __| |_ _ _ __   __ _\n+|  _  | '_ \\ / _ \\| '__| __| | '_ \\ / _\\` |\n+| | | | |_) | (_) | |  | |_| | | | | (_| |\n+\\_| |_/_.__/ \\___/|_|   \\__|_|_| |_|\\__, |\n+                                     __/ |\n+                                    |___/\n+\n+Abort-message\n+}\n+\n+# -------------------------------------------------------\n+\n+function failIfUserIsRoot {\n+    if [ \"$(id -u)\" -eq \"0\" ]; # If you are root then something went wrong.\n+    then\n+        cat <<End-of-message\n+\n+Apparently you are inside this docker container as the user root.\n+Putting it simply:\n+\n+   This should not occur.\n+\n+Known possible causes of this are:\n+1) Running this script as the root user ( Just don't )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkyMjIxNw==", "bodyText": "nit: The ASCII art is nice for the welcome message but I'd drop it for this and the low memory message", "url": "https://github.com/apache/beam/pull/13308#discussion_r532922217", "createdAt": "2020-11-30T21:42:40Z", "author": {"login": "TheNeuralBit"}, "path": "dev-support/docker/beam_env_checks.sh", "diffHunk": "@@ -0,0 +1,120 @@\n+#!/usr/bin/env bash\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# SHELLDOC-IGNORE\n+\n+# -------------------------------------------------------\n+function showWelcome {\n+# http://patorjk.com/software/taag/#p=display&f=Doom&t=Beam%20Build%20Env.\n+cat << \"Welcome-message\"\n+\n+______                       ______       _ _     _   _____\n+| ___ \\                      | ___ \\     (_) |   | | |  ___|\n+| |_/ / ___  __ _ _ __ ___   | |_/ /_   _ _| | __| | | |__ _ ____   __\n+| ___ \\/ _ \\/ _` | '_ ` _ \\  | ___ \\ | | | | |/ _` | |  __| '_ \\ \\ / /\n+| |_/ /  __/ (_| | | | | | | | |_/ / |_| | | | (_| | | |__| | | \\ V /\n+\\____/ \\___|\\__,_|_| |_| |_| \\____/ \\__,_|_|_|\\__,_| \\____/_| |_|\\_(_)\n+\n+This is the standard Beam Developer build environment.\n+This has all the right tools installed required to build\n+Apache Beam from source.\n+\n+Welcome-message\n+}\n+\n+# -------------------------------------------------------\n+\n+function showAbort {\n+  cat << \"Abort-message\"\n+\n+  ___  _                _   _\n+ / _ \\| |              | | (_)\n+/ /_\\ \\ |__   ___  _ __| |_ _ _ __   __ _\n+|  _  | '_ \\ / _ \\| '__| __| | '_ \\ / _\\` |\n+| | | | |_) | (_) | |  | |_| | | | | (_| |\n+\\_| |_/_.__/ \\___/|_|   \\__|_|_| |_|\\__, |\n+                                     __/ |\n+                                    |___/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkyMjUwOQ==", "bodyText": "I wonder if we could generate an ASCII firefly to put here :) https://beam.apache.org/community/mascot/", "url": "https://github.com/apache/beam/pull/13308#discussion_r532922509", "createdAt": "2020-11-30T21:43:15Z", "author": {"login": "TheNeuralBit"}, "path": "dev-support/docker/beam_env_checks.sh", "diffHunk": "@@ -0,0 +1,120 @@\n+#!/usr/bin/env bash\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# SHELLDOC-IGNORE\n+\n+# -------------------------------------------------------\n+function showWelcome {\n+# http://patorjk.com/software/taag/#p=display&f=Doom&t=Beam%20Build%20Env.\n+cat << \"Welcome-message\"\n+\n+______                       ______       _ _     _   _____\n+| ___ \\                      | ___ \\     (_) |   | | |  ___|\n+| |_/ / ___  __ _ _ __ ___   | |_/ /_   _ _| | __| | | |__ _ ____   __\n+| ___ \\/ _ \\/ _` | '_ ` _ \\  | ___ \\ | | | | |/ _` | |  __| '_ \\ \\ / /\n+| |_/ /  __/ (_| | | | | | | | |_/ / |_| | | | (_| | | |__| | | \\ V /\n+\\____/ \\___|\\__,_|_| |_| |_| \\____/ \\__,_|_|_|\\__,_| \\____/_| |_|\\_(_)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkyNDIxMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            ###\n          \n          \n            \n            # Set the locale ( see https://stackoverflow.com/a/28406007/114196 )\n          \n          \n            \n            ###\n          \n          \n            \n            ###\n          \n          \n            \n            # Set the locale ( see https://stackoverflow.com/a/28406007/114196 )\n          \n          \n            \n            ###\n          \n          \n            \n            # TODO(BEAM-11327): Remove the need to run tests with UTF-8 encoding", "url": "https://github.com/apache/beam/pull/13308#discussion_r532924212", "createdAt": "2020-11-30T21:46:33Z", "author": {"login": "TheNeuralBit"}, "path": "dev-support/docker/Dockerfile", "diffHunk": "@@ -0,0 +1,110 @@\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Dockerfile for installing the necessary dependencies for building Hadoop.\n+# See BUILDING.txt.\n+\n+FROM ubuntu:20.04\n+\n+ARG DEBIAN_FRONTEND=noninteractive\n+\n+WORKDIR /root\n+\n+SHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n+\n+#####\n+# Disable suggests/recommends\n+#####\n+RUN echo APT::Install-Recommends \"0\"\\; > /etc/apt/apt.conf.d/10disableextras\n+RUN echo APT::Install-Suggests \"0\"\\; >>  /etc/apt/apt.conf.d/10disableextras\n+\n+ENV DEBIAN_FRONTEND noninteractive\n+ENV DEBCONF_TERSE true\n+\n+\n+# hadolint ignore=DL3008\n+###\n+# Update and install common packages\n+###\n+RUN apt -q update \\\n+   && apt install -y software-properties-common apt-utils apt-transport-https ca-certificates \\\n+   && add-apt-repository -y ppa:deadsnakes/ppa \\\n+   && apt-get -q install -y --no-install-recommends \\\n+        bash-completion \\\n+        build-essential \\\n+        bzip2 \\\n+        curl \\\n+        docker.io \\\n+        g++ \\\n+        gcc \\\n+        git \\\n+        gnupg-agent \\\n+        rsync \\\n+        sudo \\\n+        vim \\\n+        locales \\\n+        wget \\\n+        time \\\n+        openjdk-8-jdk \\\n+        python3-setuptools \\\n+        python3-pip \\\n+        python3.5 \\\n+        python3.6 \\\n+        python3.7 \\\n+        python2.7 \\\n+        virtualenv \\\n+        tox\n+\n+###\n+# Set the locale ( see https://stackoverflow.com/a/28406007/114196 )\n+###", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA1MjM3Mg==", "bodyText": "What happens without these? If they are necessary for a build environment we should add them to https://beam.apache.org/contribute/#prerequisites as well", "url": "https://github.com/apache/beam/pull/13308#discussion_r533052372", "createdAt": "2020-12-01T03:38:18Z", "author": {"login": "TheNeuralBit"}, "path": "dev-support/docker/Dockerfile", "diffHunk": "@@ -0,0 +1,110 @@\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Dockerfile for installing the necessary dependencies for building Hadoop.\n+# See BUILDING.txt.\n+\n+FROM ubuntu:20.04\n+\n+ARG DEBIAN_FRONTEND=noninteractive\n+\n+WORKDIR /root\n+\n+SHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n+\n+#####\n+# Disable suggests/recommends\n+#####\n+RUN echo APT::Install-Recommends \"0\"\\; > /etc/apt/apt.conf.d/10disableextras\n+RUN echo APT::Install-Suggests \"0\"\\; >>  /etc/apt/apt.conf.d/10disableextras\n+\n+ENV DEBIAN_FRONTEND noninteractive\n+ENV DEBCONF_TERSE true\n+\n+\n+# hadolint ignore=DL3008\n+###\n+# Update and install common packages\n+###\n+RUN apt -q update \\\n+   && apt install -y software-properties-common apt-utils apt-transport-https ca-certificates \\\n+   && add-apt-repository -y ppa:deadsnakes/ppa \\\n+   && apt-get -q install -y --no-install-recommends \\\n+        bash-completion \\\n+        build-essential \\\n+        bzip2 \\\n+        curl \\\n+        docker.io \\\n+        g++ \\\n+        gcc \\\n+        git \\\n+        gnupg-agent \\\n+        rsync \\\n+        sudo \\\n+        vim \\\n+        locales \\\n+        wget \\\n+        time \\\n+        openjdk-8-jdk \\\n+        python3-setuptools \\\n+        python3-pip \\\n+        python3.5 \\\n+        python3.6 \\\n+        python3.7 \\\n+        python2.7 \\\n+        virtualenv \\\n+        tox\n+\n+###\n+# Set the locale ( see https://stackoverflow.com/a/28406007/114196 )\n+###\n+RUN sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen && \\\n+    locale-gen\n+ENV LANG en_US.UTF-8\n+ENV LANGUAGE en_US:en\n+ENV LC_ALL en_US.UTF-8\n+\n+###\n+# Set Python3.6 as default\n+###\n+RUN alias python=python3.6\n+\n+###\n+# Install grpcio-tools mypy-protobuf for `python3 sdks/python/setup.py sdist` to work\n+###\n+RUN pip3 install grpcio-tools mypy-protobuf", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA1Mjk3Nw==", "bodyText": "I don't think this belongs in CHANGES.md, it is intended to communicate changes in the Beam release to users, but this change is just for developers.", "url": "https://github.com/apache/beam/pull/13308#discussion_r533052977", "createdAt": "2020-12-01T03:40:37Z", "author": {"login": "TheNeuralBit"}, "path": "CHANGES.md", "diffHunk": "@@ -97,6 +97,7 @@\n * Added support for avro payload format in Beam SQL Pubsub Table ([BEAM-5504](https://issues.apache.org/jira/browse/BEAM-5504))\n * Added option to disable unnecessary copying between operators in Flink Runner (Java) ([BEAM-11146](https://issues.apache.org/jira/browse/BEAM-11146))\n * Added CombineFn.setup and CombineFn.teardown to Python SDK. These methods let you initialize the CombineFn's state before any of the other methods of the CombineFn is executed and clean that state up later on. If you are using Dataflow, you need to enable Dataflow Runner V2 by passing `--experiments=use_runner_v2` before using this feature. ([BEAM-3736](https://issues.apache.org/jira/browse/BEAM-3736))\n+* Added Docker based developer build environment. ([BEAM-10891](https://issues.apache.org/jira/browse/BEAM-10891))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e6296fb61b6675bc37ed5d87ff6c3482dd90896"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3c10f1d62fba2c04f5de347a899f7bd6161ada0", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/e3c10f1d62fba2c04f5de347a899f7bd6161ada0", "committedDate": "2020-12-01T08:57:18Z", "message": "[BEAM-10891] Standardized build environment using Docker"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "127cf5cfc119256529b97d7583c8312b92868923", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/127cf5cfc119256529b97d7583c8312b92868923", "committedDate": "2020-12-01T08:55:09Z", "message": "Update dev-support/docker/Dockerfile\n\nCo-authored-by: Brian Hulette <hulettbh@gmail.com>"}, "afterCommit": {"oid": "e3c10f1d62fba2c04f5de347a899f7bd6161ada0", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/e3c10f1d62fba2c04f5de347a899f7bd6161ada0", "committedDate": "2020-12-01T08:57:18Z", "message": "[BEAM-10891] Standardized build environment using Docker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b93131be8876e6d3577a94af09a00da498029135", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/b93131be8876e6d3577a94af09a00da498029135", "committedDate": "2020-12-02T12:16:37Z", "message": "Document additional python tools needed to build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5b45b856523943a27daf5ac726025cfaaf1c887", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/e5b45b856523943a27daf5ac726025cfaaf1c887", "committedDate": "2020-12-02T13:00:34Z", "message": "Add pyenv and pyenv-virtualenv to the docker image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c715c64d3f169f44c5aab3bb0dcb13b926f7396", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/3c715c64d3f169f44c5aab3bb0dcb13b926f7396", "committedDate": "2020-12-04T15:02:59Z", "message": "Attempt workaround wrong python distlib version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "74c9a6d25deb21358025ad35656cf9dd6ec80959", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/74c9a6d25deb21358025ad35656cf9dd6ec80959", "committedDate": "2020-12-02T15:24:42Z", "message": "Attempt workaround wrong python distlib version"}, "afterCommit": {"oid": "3c715c64d3f169f44c5aab3bb0dcb13b926f7396", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/3c715c64d3f169f44c5aab3bb0dcb13b926f7396", "committedDate": "2020-12-04T15:02:59Z", "message": "Attempt workaround wrong python distlib version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MDc0MDI5", "url": "https://github.com/apache/beam/pull/13308#pullrequestreview-545074029", "createdAt": "2020-12-04T15:46:48Z", "commit": {"oid": "3c715c64d3f169f44c5aab3bb0dcb13b926f7396"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNTo0Njo0OFrOH_WpKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNTo0Njo0OFrOH_WpKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5MzMyMA==", "bodyText": "@nielsbasjes Here should work!\nRUN pip3 install distlib==0.3.1 yapf==0.29.0 pytest", "url": "https://github.com/apache/beam/pull/13308#discussion_r536193320", "createdAt": "2020-12-04T15:46:48Z", "author": {"login": "omarismail94"}, "path": "dev-support/docker/Dockerfile", "diffHunk": "@@ -0,0 +1,154 @@\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Dockerfile for installing the necessary dependencies for building Hadoop.\n+# See BUILDING.txt.\n+\n+FROM ubuntu:20.04\n+\n+ARG DEBIAN_FRONTEND=noninteractive\n+\n+WORKDIR /root\n+\n+SHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n+\n+#####\n+# Disable suggests/recommends\n+#####\n+RUN echo APT::Install-Recommends \"0\"\\; > /etc/apt/apt.conf.d/10disableextras\n+RUN echo APT::Install-Suggests \"0\"\\; >>  /etc/apt/apt.conf.d/10disableextras\n+\n+ENV DEBIAN_FRONTEND noninteractive\n+ENV DEBCONF_TERSE true\n+\n+\n+# hadolint ignore=DL3008\n+###\n+# Update and install common packages\n+###\n+RUN apt -q update \\\n+   && apt install -y software-properties-common apt-utils apt-transport-https ca-certificates \\\n+   && add-apt-repository -y ppa:deadsnakes/ppa \\\n+   && apt-get -q install -y --no-install-recommends \\\n+        bash-completion \\\n+        build-essential \\\n+        bzip2 \\\n+        wget \\\n+        curl \\\n+        docker.io \\\n+        g++ \\\n+        gcc \\\n+        git \\\n+        gnupg-agent \\\n+        rsync \\\n+        sudo \\\n+        vim \\\n+        locales \\\n+        wget \\\n+        time \\\n+        openjdk-8-jdk \\\n+        python3-setuptools \\\n+        python3-pip \\\n+        python3.6 \\\n+        python3.7 \\\n+        python3.8 \\\n+        virtualenv \\\n+        tox \\\n+        # Needed for pyenv:\n+        make \\\n+        libssl-dev \\\n+        zlib1g-dev \\\n+        libbz2-dev \\\n+        libreadline-dev \\\n+        libsqlite3-dev \\\n+        llvm \\\n+        libncurses5-dev \\\n+        libncursesw5-dev \\\n+        xz-utils \\\n+        tk-dev \\\n+        libffi-dev \\\n+        liblzma-dev \\\n+        python-openssl\n+\n+###\n+# Set the locale ( see https://stackoverflow.com/a/28406007/114196 )\n+###\n+# TODO(BEAM-11327): Remove the need to run tests with UTF-8 encoding\n+RUN sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen && \\\n+    locale-gen\n+ENV LANG en_US.UTF-8\n+ENV LANGUAGE en_US:en\n+ENV LC_ALL en_US.UTF-8\n+\n+###\n+# Set Python3.6 as default\n+###\n+RUN alias python=python3.6\n+\n+###\n+# Install grpcio-tools mypy-protobuf for `python3 sdks/python/setup.py sdist` to work\n+###\n+RUN pip3 install grpcio-tools mypy-protobuf\n+\n+###\n+# Avoid https://github.com/pypa/virtualenv/issues/2006\n+RUN pip3 install distlib==0.3.1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c715c64d3f169f44c5aab3bb0dcb13b926f7396"}, "originalPosition": 109}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb46a1423120b2c0ee6ea18b75834fad2c60c63d", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/fb46a1423120b2c0ee6ea18b75834fad2c60c63d", "committedDate": "2020-12-04T15:51:48Z", "message": "Install extra tools"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MTMyNTM2", "url": "https://github.com/apache/beam/pull/13308#pullrequestreview-545132536", "createdAt": "2020-12-04T16:55:47Z", "commit": {"oid": "fb46a1423120b2c0ee6ea18b75834fad2c60c63d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNjo1NTo0N1rOH_ZhIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNjo1NTo0N1rOH_ZhIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI0MDQxOA==", "bodyText": "Can we drop the changes for pyenv? I think we should encourage python developers to use the container's system python instead. If that proves burdensome in the future we can add this back.", "url": "https://github.com/apache/beam/pull/13308#discussion_r536240418", "createdAt": "2020-12-04T16:55:47Z", "author": {"login": "TheNeuralBit"}, "path": "dev-support/docker/Dockerfile", "diffHunk": "@@ -0,0 +1,155 @@\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# Dockerfile for installing the necessary dependencies for building Hadoop.\n+# See BUILDING.txt.\n+\n+FROM ubuntu:20.04\n+\n+ARG DEBIAN_FRONTEND=noninteractive\n+\n+WORKDIR /root\n+\n+SHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n+\n+#####\n+# Disable suggests/recommends\n+#####\n+RUN echo APT::Install-Recommends \"0\"\\; > /etc/apt/apt.conf.d/10disableextras\n+RUN echo APT::Install-Suggests \"0\"\\; >>  /etc/apt/apt.conf.d/10disableextras\n+\n+ENV DEBIAN_FRONTEND noninteractive\n+ENV DEBCONF_TERSE true\n+\n+\n+# hadolint ignore=DL3008\n+###\n+# Update and install common packages\n+###\n+RUN apt -q update \\\n+   && apt install -y software-properties-common apt-utils apt-transport-https ca-certificates \\\n+   && add-apt-repository -y ppa:deadsnakes/ppa \\\n+   && apt-get -q install -y --no-install-recommends \\\n+        bash-completion \\\n+        build-essential \\\n+        bzip2 \\\n+        wget \\\n+        curl \\\n+        docker.io \\\n+        g++ \\\n+        gcc \\\n+        git \\\n+        gnupg-agent \\\n+        rsync \\\n+        sudo \\\n+        vim \\\n+        locales \\\n+        wget \\\n+        time \\\n+        openjdk-8-jdk \\\n+        python3-setuptools \\\n+        python3-pip \\\n+        python3.6 \\\n+        python3.7 \\\n+        python3.8 \\\n+        virtualenv \\\n+        tox \\\n+        # Needed for pyenv:\n+        make \\\n+        libssl-dev \\\n+        zlib1g-dev \\\n+        libbz2-dev \\\n+        libreadline-dev \\\n+        libsqlite3-dev \\\n+        llvm \\\n+        libncurses5-dev \\\n+        libncursesw5-dev \\\n+        xz-utils \\\n+        tk-dev \\\n+        libffi-dev \\\n+        liblzma-dev \\\n+        python-openssl", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb46a1423120b2c0ee6ea18b75834fad2c60c63d"}, "originalPosition": 85}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "503d140fee4a397aba74e41328ff1239dbfa16e1", "author": {"user": {"login": "nielsbasjes", "name": "Niels Basjes"}}, "url": "https://github.com/apache/beam/commit/503d140fee4a397aba74e41328ff1239dbfa16e1", "committedDate": "2020-12-04T21:52:03Z", "message": "Drop pyenv from the image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MzY2NTM4", "url": "https://github.com/apache/beam/pull/13308#pullrequestreview-545366538", "createdAt": "2020-12-04T23:43:34Z", "commit": {"oid": "503d140fee4a397aba74e41328ff1239dbfa16e1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4790, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}