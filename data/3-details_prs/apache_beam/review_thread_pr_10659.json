{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1OTgzNjYz", "number": 10659, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODo1Mzo1NFrODZ8HcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNzoyMTo0OVrODaQCmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NTI1OTM3OnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/QueryPlanner.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxODo1Mzo1NFrOFgnM_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxOTowMTowOFrOFgnbUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc0MTA1NA==", "bodyText": "Does a query allows having both named and positional parameters?", "url": "https://github.com/apache/beam/pull/10659#discussion_r369741054", "createdAt": "2020-01-22T18:53:54Z", "author": {"login": "amaliujia"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/QueryPlanner.java", "diffHunk": "@@ -26,8 +26,29 @@\n  */\n public interface QueryPlanner {\n   /** It parses and validate the input query, then convert into a {@link BeamRelNode} tree. */\n-  BeamRelNode convertToBeamRel(String sqlStatement) throws ParseException, SqlConversionException;\n+  BeamRelNode convertToBeamRel(\n+      String sqlStatement, Object queryParameters, QueryParameterMode queryParameterMode)\n+      throws ParseException, SqlConversionException;\n \n   /** Parse input SQL query, and return a {@link SqlNode} as grammar tree. */\n   SqlNode parse(String sqlStatement) throws ParseException;\n+\n+  /**\n+   * Parameters have different usage semantics depending on the parameter mode specified. Note that\n+   * some parameter modes might not be supported by all backends.\n+   */\n+  enum QueryParameterMode {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc3e891852606b732fbfa5b5c95e7bba936953f6"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc0NDcyMQ==", "bodyText": "No. I updated the javadoc to clarify this.", "url": "https://github.com/apache/beam/pull/10659#discussion_r369744721", "createdAt": "2020-01-22T19:01:08Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/impl/QueryPlanner.java", "diffHunk": "@@ -26,8 +26,29 @@\n  */\n public interface QueryPlanner {\n   /** It parses and validate the input query, then convert into a {@link BeamRelNode} tree. */\n-  BeamRelNode convertToBeamRel(String sqlStatement) throws ParseException, SqlConversionException;\n+  BeamRelNode convertToBeamRel(\n+      String sqlStatement, Object queryParameters, QueryParameterMode queryParameterMode)\n+      throws ParseException, SqlConversionException;\n \n   /** Parse input SQL query, and return a {@link SqlNode} as grammar tree. */\n   SqlNode parse(String sqlStatement) throws ParseException;\n+\n+  /**\n+   * Parameters have different usage semantics depending on the parameter mode specified. Note that\n+   * some parameter modes might not be supported by all backends.\n+   */\n+  enum QueryParameterMode {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc0MTA1NA=="}, "originalCommit": {"oid": "fc3e891852606b732fbfa5b5c95e7bba936953f6"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NTM3NzIzOnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxOTozMjowM1rOFgoXeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQyMToyNDo1NFrOFgrgBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc2MDEyMA==", "bodyText": "My preference would be to have slightly more typed positionalParameters and namedParameters. If you like, you can do it robustly with @AutoOneOf, which would subsume also queryParameterMode.\nhttps://github.com/google/auto/blob/master/value/userguide/howto.md#-make-a-class-where-only-one-of-its-properties-is-ever-set", "url": "https://github.com/apache/beam/pull/10659#discussion_r369760120", "createdAt": "2020-01-22T19:32:03Z", "author": {"login": "kennknowles"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -87,6 +88,10 @@\n \n   abstract String queryString();\n \n+  abstract Object queryParameters();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0842785404570a3b1f6f8de0d19b3a5d3c289161"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc5OTI2OA==", "bodyText": "Will do, thanks for the tip.", "url": "https://github.com/apache/beam/pull/10659#discussion_r369799268", "createdAt": "2020-01-22T20:58:31Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -87,6 +88,10 @@\n \n   abstract String queryString();\n \n+  abstract Object queryParameters();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc2MDEyMA=="}, "originalCommit": {"oid": "0842785404570a3b1f6f8de0d19b3a5d3c289161"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTgxMTQ2MQ==", "bodyText": "Looks like we will have to update to AutoValue 1.7 to be able to do none (void is not allowed in version 1.6.3 that we are using)", "url": "https://github.com/apache/beam/pull/10659#discussion_r369811461", "createdAt": "2020-01-22T21:24:54Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -87,6 +88,10 @@\n \n   abstract String queryString();\n \n+  abstract Object queryParameters();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc2MDEyMA=="}, "originalCommit": {"oid": "0842785404570a3b1f6f8de0d19b3a5d3c289161"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NTM4NTg5OnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxOTozNTowMVrOFgoc6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQyMTowNTozMFrOFgq9kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc2MTUxNQ==", "bodyText": "This is a bit strange to me. Isn't the point of a builder that you only specify some of the args? I recognize that the oddness was pre-existing in this code.", "url": "https://github.com/apache/beam/pull/10659#discussion_r369761515", "createdAt": "2020-01-22T19:35:01Z", "author": {"login": "kennknowles"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -151,6 +158,19 @@ private void registerFunctions(BeamSqlEnvBuilder sqlEnvBuilder) {\n     udafDefinitions().forEach(udaf -> sqlEnvBuilder.addUdaf(udaf.udafName(), udaf.combineFn()));\n   }\n \n+  private static SqlTransform query(\n+      String queryString, Object queryParameters, QueryParameterMode queryParameterMode) {\n+    return builder()\n+        .setQueryString(queryString)\n+        .setQueryParameters(queryParameters)\n+        .setQueryParameterMode(queryParameterMode)\n+        .setUdafDefinitions(Collections.emptyList())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0842785404570a3b1f6f8de0d19b3a5d3c289161"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTgwMjY0MQ==", "bodyText": "It looks like it was set up this way because some of the public methods (e.g. registerUdaf) themselves include some boilerplate building, which is hidden from the user.", "url": "https://github.com/apache/beam/pull/10659#discussion_r369802641", "createdAt": "2020-01-22T21:05:30Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -151,6 +158,19 @@ private void registerFunctions(BeamSqlEnvBuilder sqlEnvBuilder) {\n     udafDefinitions().forEach(udaf -> sqlEnvBuilder.addUdaf(udaf.udafName(), udaf.combineFn()));\n   }\n \n+  private static SqlTransform query(\n+      String queryString, Object queryParameters, QueryParameterMode queryParameterMode) {\n+    return builder()\n+        .setQueryString(queryString)\n+        .setQueryParameters(queryParameters)\n+        .setQueryParameterMode(queryParameterMode)\n+        .setUdafDefinitions(Collections.emptyList())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc2MTUxNQ=="}, "originalCommit": {"oid": "0842785404570a3b1f6f8de0d19b3a5d3c289161"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NTM5MDEzOnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxOTozNjozNlrOFgofsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQyMTowOToxMFrOFgrEVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc2MjIyNA==", "bodyText": "Stylistically, SqlTransform would do better to have public builder methods. Is there a technical barrier? In other words, an API like SqlTransform.query(...).withParameters(...) or even .withNamedParameters separate from withPositionalParameters.", "url": "https://github.com/apache/beam/pull/10659#discussion_r369762224", "createdAt": "2020-01-22T19:36:36Z", "author": {"login": "kennknowles"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -175,13 +195,32 @@ private void registerFunctions(BeamSqlEnvBuilder sqlEnvBuilder) {\n    * </ul>\n    */\n   public static SqlTransform query(String queryString) {\n-    return builder()\n-        .setQueryString(queryString)\n-        .setUdafDefinitions(Collections.emptyList())\n-        .setUdfDefinitions(Collections.emptyList())\n-        .setTableProviderMap(Collections.emptyMap())\n-        .setAutoUdfUdafLoad(false)\n-        .build();\n+    return query(queryString, Collections.emptyMap(), QueryParameterMode.NONE);\n+  }\n+\n+  /**\n+   * Same as {@link #query(String)} but with named query parameters. Currently only supported by the\n+   * ZetaSQL dialect.\n+   *\n+   * @param queryParameters type depends on the SQL dialect. For ZetaSQL, a {@code Map<String,\n+   *     com.google.zetasql.Value>} keyed by the parameter name.\n+   */\n+  @Experimental\n+  public static SqlTransform queryWithNamedParameters(String queryString, Map queryParameters) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0842785404570a3b1f6f8de0d19b3a5d3c289161"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc2MjkxMQ==", "bodyText": "(this is https://beam.apache.org/contribute/ptransform-style-guide/#fluent-builder-methods-for-setting-parameters)", "url": "https://github.com/apache/beam/pull/10659#discussion_r369762911", "createdAt": "2020-01-22T19:38:08Z", "author": {"login": "kennknowles"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -175,13 +195,32 @@ private void registerFunctions(BeamSqlEnvBuilder sqlEnvBuilder) {\n    * </ul>\n    */\n   public static SqlTransform query(String queryString) {\n-    return builder()\n-        .setQueryString(queryString)\n-        .setUdafDefinitions(Collections.emptyList())\n-        .setUdfDefinitions(Collections.emptyList())\n-        .setTableProviderMap(Collections.emptyMap())\n-        .setAutoUdfUdafLoad(false)\n-        .build();\n+    return query(queryString, Collections.emptyMap(), QueryParameterMode.NONE);\n+  }\n+\n+  /**\n+   * Same as {@link #query(String)} but with named query parameters. Currently only supported by the\n+   * ZetaSQL dialect.\n+   *\n+   * @param queryParameters type depends on the SQL dialect. For ZetaSQL, a {@code Map<String,\n+   *     com.google.zetasql.Value>} keyed by the parameter name.\n+   */\n+  @Experimental\n+  public static SqlTransform queryWithNamedParameters(String queryString, Map queryParameters) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc2MjIyNA=="}, "originalCommit": {"oid": "0842785404570a3b1f6f8de0d19b3a5d3c289161"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTgwNDM3Mg==", "bodyText": "Stylistically, SqlTransform would do better to have public builder methods.\n\nDo you mean just for parameters, or overall?", "url": "https://github.com/apache/beam/pull/10659#discussion_r369804372", "createdAt": "2020-01-22T21:09:10Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -175,13 +195,32 @@ private void registerFunctions(BeamSqlEnvBuilder sqlEnvBuilder) {\n    * </ul>\n    */\n   public static SqlTransform query(String queryString) {\n-    return builder()\n-        .setQueryString(queryString)\n-        .setUdafDefinitions(Collections.emptyList())\n-        .setUdfDefinitions(Collections.emptyList())\n-        .setTableProviderMap(Collections.emptyMap())\n-        .setAutoUdfUdafLoad(false)\n-        .build();\n+    return query(queryString, Collections.emptyMap(), QueryParameterMode.NONE);\n+  }\n+\n+  /**\n+   * Same as {@link #query(String)} but with named query parameters. Currently only supported by the\n+   * ZetaSQL dialect.\n+   *\n+   * @param queryParameters type depends on the SQL dialect. For ZetaSQL, a {@code Map<String,\n+   *     com.google.zetasql.Value>} keyed by the parameter name.\n+   */\n+  @Experimental\n+  public static SqlTransform queryWithNamedParameters(String queryString, Map queryParameters) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTc2MjIyNA=="}, "originalCommit": {"oid": "0842785404570a3b1f6f8de0d19b3a5d3c289161"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4ODUxMzA3OnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNzoxODoyMVrOFhGQ0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNzo0MToyNVrOFhG8mA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI0OTkzNw==", "bodyText": "When we do merge, I think it is helpful to have the dependency upgrade in an isolated commit. I notice you have some spotless commits to squash, but I would keep the dep upgrade separate.", "url": "https://github.com/apache/beam/pull/10659#discussion_r370249937", "createdAt": "2020-01-23T17:18:21Z", "author": {"login": "kennknowles"}, "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy", "diffHunk": "@@ -731,7 +731,7 @@ class BeamModulePlugin implements Plugin<Project> {\n       // configurations because they are never required to be shaded or become a\n       // dependency of the output.\n       def compileOnlyAnnotationDeps = [\n-        \"com.google.auto.value:auto-value-annotations:1.6.3\",\n+        \"com.google.auto.value:auto-value-annotations:1.7\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82d34e4680e0657b187d02a2e05abc8549e9946a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI2MTE0NA==", "bodyText": "ack", "url": "https://github.com/apache/beam/pull/10659#discussion_r370261144", "createdAt": "2020-01-23T17:41:25Z", "author": {"login": "ibzib"}, "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy", "diffHunk": "@@ -731,7 +731,7 @@ class BeamModulePlugin implements Plugin<Project> {\n       // configurations because they are never required to be shaded or become a\n       // dependency of the output.\n       def compileOnlyAnnotationDeps = [\n-        \"com.google.auto.value:auto-value-annotations:1.6.3\",\n+        \"com.google.auto.value:auto-value-annotations:1.7\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI0OTkzNw=="}, "originalCommit": {"oid": "82d34e4680e0657b187d02a2e05abc8549e9946a"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4ODUxNTY5OnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNzoxOTowNVrOFhGSZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNzoxOTowNVrOFhGSZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI1MDM0MA==", "bodyText": "Perfect", "url": "https://github.com/apache/beam/pull/10659#discussion_r370250340", "createdAt": "2020-01-23T17:19:05Z", "author": {"login": "kennknowles"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/SqlTransform.java", "diffHunk": "@@ -194,6 +199,14 @@ public SqlTransform withDefaultTableProvider(String name, TableProvider tablePro\n     return withTableProvider(name, tableProvider).toBuilder().setDefaultTableProvider(name).build();\n   }\n \n+  public SqlTransform withNamedParameters(Map parameters) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82d34e4680e0657b187d02a2e05abc8549e9946a"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4ODUyMzc3OnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/translation/ExpressionConverter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNzoyMTo0OVrOFhGXmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QxNzo0MTo0MlrOFhG9GQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI1MTY3Mw==", "bodyText": "If I understand correctly, this might be best as a checkState. That way you can attach a good error message and indicate that the internal state has gotten messed up.", "url": "https://github.com/apache/beam/pull/10659#discussion_r370251673", "createdAt": "2020-01-23T17:21:49Z", "author": {"login": "kennknowles"}, "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/translation/ExpressionConverter.java", "diffHunk": "@@ -1000,9 +1002,19 @@ private static boolean isZetaSQLCast(TypeKind fromType, TypeKind toType) {\n   }\n \n   private RexNode convertResolvedParameter(ResolvedParameter parameter) {\n-    assert parameter.getType().equals(queryParams.get(parameter.getName()).getType());\n-    return convertValueToRexNode(\n-        queryParams.get(parameter.getName()).getType(), queryParams.get(parameter.getName()));\n+    if (queryParams.getKind() == Kind.NAMED) {\n+      Map<String, Value> queryParameterMap = (Map<String, Value>) queryParams.named();\n+      Value value = queryParameterMap.get(parameter.getName());\n+      assert parameter.getType().equals(value.getType());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82d34e4680e0657b187d02a2e05abc8549e9946a"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI2MTI3Mw==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/10659#discussion_r370261273", "createdAt": "2020-01-23T17:41:42Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/translation/ExpressionConverter.java", "diffHunk": "@@ -1000,9 +1002,19 @@ private static boolean isZetaSQLCast(TypeKind fromType, TypeKind toType) {\n   }\n \n   private RexNode convertResolvedParameter(ResolvedParameter parameter) {\n-    assert parameter.getType().equals(queryParams.get(parameter.getName()).getType());\n-    return convertValueToRexNode(\n-        queryParams.get(parameter.getName()).getType(), queryParams.get(parameter.getName()));\n+    if (queryParams.getKind() == Kind.NAMED) {\n+      Map<String, Value> queryParameterMap = (Map<String, Value>) queryParams.named();\n+      Value value = queryParameterMap.get(parameter.getName());\n+      assert parameter.getType().equals(value.getType());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI1MTY3Mw=="}, "originalCommit": {"oid": "82d34e4680e0657b187d02a2e05abc8549e9946a"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2246, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}