{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NjM3NzM4", "number": 11701, "title": "[BEAM-9989] Fix some issues around storing schema `id` on user types", "bodyText": "Updates sql_test to require generating user types with an id field, which yields a name collision with the id added to generated NamedTuple types.\nModifies row_coder to extract values from NamedTuple instances as plain tuples, rather than using getattr. This fixes the above name collision. Dropped this change since it's not strictly necessary\nAlso, store schema id in an attribute called _beam_schema_id rather than id to avoid future name collisions.\nAdds logic to set _beam_schema_id for provided (non-generated) user types as well as a test of this logic. This allows us to retrieve the same schema for the type in the future, rather than re-generating it.\n\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-05-13T22:05:15Z", "url": "https://github.com/apache/beam/pull/11701", "merged": true, "mergeCommit": {"oid": "cf0375689181528d55d5a611d6c6789beced9291"}, "closed": true, "closedAt": "2020-05-20T23:15:27Z", "author": {"login": "TheNeuralBit"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchAFNCAH2gAyNDE3NjM3NzM4OmE1MzgzYzJkNjU3ZGM2MjkxNjNmYjFhYWUxMGRkMmIxZmVmZWQ0NTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjNZ9SgH2gAyNDE3NjM3NzM4OmM4YTc1NTgxMzZhYzNlYTc3MjIzOWZiNTY5ZmZhZDUyMzkzYzE1YjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a5383c2d657dc629163fb1aae10dd2b1fefed456", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/a5383c2d657dc629163fb1aae10dd2b1fefed456", "committedDate": "2020-05-13T21:51:16Z", "message": "Change column name to 'id' to expose row_coder error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3198086a33ba44da92719bc80d989a2ca7b49d38", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/3198086a33ba44da92719bc80d989a2ca7b49d38", "committedDate": "2020-05-13T21:51:17Z", "message": "Pull out fields as a tuple rather than attribute access\n\nFixes bug where we read the incorrect value for a field named 'id'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ae3bb68f008bfaf6e4c546c29e233e9b802580c", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/7ae3bb68f008bfaf6e4c546c29e233e9b802580c", "committedDate": "2020-05-13T21:51:17Z", "message": "Tag types with '_beam_schema_id' rather than 'id' to avoid collisions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed0ce0963d2f5b11e180e58b18c0c00dd5cb46a4", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/ed0ce0963d2f5b11e180e58b18c0c00dd5cb46a4", "committedDate": "2020-05-13T21:51:17Z", "message": "Ensure user types have a _beam_schema_id set"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dafb03854696c8d189da4f1ad16345931e6d09dc", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/dafb03854696c8d189da4f1ad16345931e6d09dc", "committedDate": "2020-05-14T00:36:56Z", "message": "lint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0ODgxOTE2", "url": "https://github.com/apache/beam/pull/11701#pullrequestreview-414881916", "createdAt": "2020-05-19T23:02:31Z", "commit": {"oid": "dafb03854696c8d189da4f1ad16345931e6d09dc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMzowMjozMVrOGX1ktA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMzowMjozMVrOGX1ktA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzY0ODE4MA==", "bodyText": "This forces the value to be an iterable, rather than just having the right fields, right? Are we sure we want to do that?", "url": "https://github.com/apache/beam/pull/11701#discussion_r427648180", "createdAt": "2020-05-19T23:02:31Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/coders/row_coder.py", "diffHunk": "@@ -134,19 +134,18 @@ def __init__(self, schema, components):\n   def encode_to_stream(self, value, out, nested):\n     nvals = len(self.schema.fields)\n     self.SIZE_CODER.encode_to_stream(nvals, out, True)\n-    attrs = [getattr(value, f.name) for f in self.schema.fields]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dafb03854696c8d189da4f1ad16345931e6d09dc"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8a7558136ac3ea772239fb569ffad52393c15b4", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/c8a7558136ac3ea772239fb569ffad52393c15b4", "committedDate": "2020-05-20T18:30:33Z", "message": "Revert \"Pull out fields as a tuple rather than attribute access\"\n\nThis reverts commit 3198086a33ba44da92719bc80d989a2ca7b49d38."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4534, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}