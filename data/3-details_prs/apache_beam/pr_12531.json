{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2MTk3OTQy", "number": 12531, "title": "[BEAM-10676] Use the fire timestamp as the output timestamp for timers", "bodyText": "By default, the Python SDK adds a timer output timestamp equal to the current\ntimestamp of an element. This is problematic because:\n\nWe hold back the output watermark on the current element's timestamp for\nevery timer\nIt doesn't match the behavior in the Java SDK which defaults to using the\nfire timestamp as the timer output timestamp (and adds a hold on it)\nThere is no way for the user to influence this behavior because there is no\nuser-facing API\n\nWe should use the fire timestamp as the default output timestamp.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-11T15:55:32Z", "url": "https://github.com/apache/beam/pull/12531", "merged": true, "mergeCommit": {"oid": "c97aeb45d4d489ea01f63ddbe88bed2a3078db38"}, "closed": true, "closedAt": "2020-08-12T23:19:47Z", "author": {"login": "mxm"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9404_gH2gAyNDY2MTk3OTQyOmIyNGEyZGNlZjI1NTIzMjAxMmI3YmZiMjlkY2VlNzBkMzY2N2U4OWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-T3NOgFqTQ2NjMzOTE2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b24a2dcef255232012b7bfb29dcee70d3667e89b", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/b24a2dcef255232012b7bfb29dcee70d3667e89b", "committedDate": "2020-08-11T15:47:55Z", "message": "[BEAM-10676] Use the fire timestamp as the output timestamp for timers\n\nBy default, the Python SDK adds a timer output timestamp equal to the current\ntimestamp of an element. This is problematic because:\n\n1. We hold back the output watermark on the current element's timestamp for\n   every timer\n2. It doesn't match the behavior in the Java SDK which defaults to using the\n   fire timestamp as the timer output timestamp (and adds a hold on it)\n3. There is no way for the user to influence this behavior because there is no\n   user-facing API\n\nWe should use the fire timestamp as the default output timestamp."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1MzcwMTAx", "url": "https://github.com/apache/beam/pull/12531#pullrequestreview-465370101", "createdAt": "2020-08-11T19:36:04Z", "commit": {"oid": "b24a2dcef255232012b7bfb29dcee70d3667e89b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1Mzc0NDc2", "url": "https://github.com/apache/beam/pull/12531#pullrequestreview-465374476", "createdAt": "2020-08-11T19:43:09Z", "commit": {"oid": "b24a2dcef255232012b7bfb29dcee70d3667e89b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxOTo0MzowOVrOG_GoxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxOTo0MzowOVrOG_GoxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgyMjIxMw==", "bodyText": "Can we only use fire_timestamp as hold_timestamp when in event time domain?", "url": "https://github.com/apache/beam/pull/12531#discussion_r468822213", "createdAt": "2020-08-11T19:43:09Z", "author": {"login": "boyuanzz"}, "path": "sdks/python/apache_beam/runners/worker/bundle_processor.py", "diffHunk": "@@ -647,7 +647,7 @@ def set(self, ts):\n         windows=(self._window, ),\n         clear_bit=False,\n         fire_timestamp=ts,\n-        hold_timestamp=self._input_timestamp,\n+        hold_timestamp=ts,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b24a2dcef255232012b7bfb29dcee70d3667e89b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62bf4f3376766ccccea738c7e6a9f162796d14f8", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/62bf4f3376766ccccea738c7e6a9f162796d14f8", "committedDate": "2020-08-12T09:13:29Z", "message": "Use input timestamp as the output timestamp for processing timers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b589047a1dac8251b260d4c380333b88abb724b0", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/b589047a1dac8251b260d4c380333b88abb724b0", "committedDate": "2020-08-12T09:13:56Z", "message": "Add test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2ce7cfacfc868dce98f05ee16943bf26ad2f0e1", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/f2ce7cfacfc868dce98f05ee16943bf26ad2f0e1", "committedDate": "2020-08-12T09:38:16Z", "message": "lint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MzM5MTY5", "url": "https://github.com/apache/beam/pull/12531#pullrequestreview-466339169", "createdAt": "2020-08-12T23:17:53Z", "commit": {"oid": "f2ce7cfacfc868dce98f05ee16943bf26ad2f0e1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3454, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}