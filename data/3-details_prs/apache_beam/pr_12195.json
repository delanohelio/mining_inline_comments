{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MjgxOTMw", "number": 12195, "title": "[BEAM-10422] Chicago Taxi example: set number of Dataflow workers to 5", "bodyText": "Thank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n---\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-07-08T14:29:21Z", "url": "https://github.com/apache/beam/pull/12195", "merged": true, "mergeCommit": {"oid": "cdac78687da2dc2bc1fbc74e07cb6f4637c33162"}, "closed": true, "closedAt": "2020-07-21T11:09:24Z", "author": {"login": "kamilwu"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcy7uzcgBqjM1MjU2NTA2NjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc23pnzAFqTQ1MTkzNTA2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb006374408e8491552d3d5d728aa6aa9f4926f6", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/fb006374408e8491552d3d5d728aa6aa9f4926f6", "committedDate": "2020-07-08T14:28:42Z", "message": "Chicago Taxi example: set number of Dataflow workers to 5"}, "afterCommit": {"oid": "ec14eab756e1bc9de90f5aebaf8b0e11e5bbc1dc", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/ec14eab756e1bc9de90f5aebaf8b0e11e5bbc1dc", "committedDate": "2020-07-08T14:57:37Z", "message": "Chicago Taxi example: set number of Dataflow workers to 5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a6057153e761bb8808c6203b8df3cc012b559bb", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/8a6057153e761bb8808c6203b8df3cc012b559bb", "committedDate": "2020-07-09T14:09:58Z", "message": "[BEAM-10422] Chicago Taxi example: set number of Dataflow workers to 5; remove shuffle_mode experiment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec14eab756e1bc9de90f5aebaf8b0e11e5bbc1dc", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/ec14eab756e1bc9de90f5aebaf8b0e11e5bbc1dc", "committedDate": "2020-07-08T14:57:37Z", "message": "Chicago Taxi example: set number of Dataflow workers to 5"}, "afterCommit": {"oid": "8a6057153e761bb8808c6203b8df3cc012b559bb", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/8a6057153e761bb8808c6203b8df3cc012b559bb", "committedDate": "2020-07-09T14:09:58Z", "message": "[BEAM-10422] Chicago Taxi example: set number of Dataflow workers to 5; remove shuffle_mode experiment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMzY1MTg5", "url": "https://github.com/apache/beam/pull/12195#pullrequestreview-450365189", "createdAt": "2020-07-17T04:30:19Z", "commit": {"oid": "8a6057153e761bb8808c6203b8df3cc012b559bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNDozMDoxOVrOGzE91Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNDozMDoxOVrOGzE91Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIxMTkyNQ==", "bodyText": "It's nice to include trigger command in the message (easy to rerun if needed). How about:\nChicago Taxi Example on Dataflow (\"Run Chicago Taxi on Dataflow\")", "url": "https://github.com/apache/beam/pull/12195#discussion_r456211925", "createdAt": "2020-07-17T04:30:19Z", "author": {"login": "tvalentyn"}, "path": ".test-infra/jenkins/job_PostCommit_Python_Chicago_Taxi_Example_Dataflow.groovy", "diffHunk": "@@ -19,46 +19,44 @@\n import CommonJobProperties as commonJobProperties\n import PostcommitJobBuilder\n import CronJobBuilder\n+import LoadTestsBuilder\n \n-\n-// This job runs the Chicago Taxi Example script on Dataflow\n-PostcommitJobBuilder.postCommitJob(\n-    'beam_PostCommit_Python_Chicago_Taxi_Dataflow',\n-    'Run Chicago Taxi on Dataflow',\n-    'Google Cloud Dataflow Runner Chicago Taxi Example',\n-    this\n-) {\n-    description('Runs the Chicago Taxi Example on the Dataflow runner.')\n+def chicagoTaxiJob = { scope ->\n+    scope.description('Runs the Chicago Taxi Example on the Dataflow runner.')\n \n     // Set common parameters.\n-    commonJobProperties.setTopLevelMainJobProperties(delegate)\n+    commonJobProperties.setTopLevelMainJobProperties(scope)\n+\n+    def pipelineOptions = [\n+        num_workers          : 5,\n+        autoscaling_algorithm: 'NONE',\n+    ]\n \n     // Gradle goals for this job.\n-    steps {\n+    scope.steps {\n         gradle {\n             rootBuildScriptDir(commonJobProperties.checkoutDir)\n+            commonJobProperties.setGradleSwitches(delegate)\n             tasks(':sdks:python:test-suites:dataflow:py2:chicagoTaxiExample')\n             switches('-PgcsRoot=gs://temp-storage-for-perf-tests/chicago-taxi')\n+            switches(\"-PpipelineOptions=\\\"${LoadTestsBuilder.parseOptions(pipelineOptions)}\\\"\")\n         }\n     }\n }\n \n+PostcommitJobBuilder.postCommitJob(\n+    'beam_PostCommit_Python_Chicago_Taxi_Dataflow',\n+    'Run Chicago Taxi on Dataflow',\n+    'Google Cloud Dataflow Runner Chicago Taxi Example',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6057153e761bb8808c6203b8df3cc012b559bb"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMzY4Mjc5", "url": "https://github.com/apache/beam/pull/12195#pullrequestreview-450368279", "createdAt": "2020-07-17T04:42:01Z", "commit": {"oid": "8a6057153e761bb8808c6203b8df3cc012b559bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNDo0MjowMVrOGzFIsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNDo0MjowMVrOGzFIsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIxNDcwNw==", "bodyText": "Can we switch this to Py3?", "url": "https://github.com/apache/beam/pull/12195#discussion_r456214707", "createdAt": "2020-07-17T04:42:01Z", "author": {"login": "tvalentyn"}, "path": ".test-infra/jenkins/job_PostCommit_Python_Chicago_Taxi_Example_Dataflow.groovy", "diffHunk": "@@ -19,46 +19,44 @@\n import CommonJobProperties as commonJobProperties\n import PostcommitJobBuilder\n import CronJobBuilder\n+import LoadTestsBuilder\n \n-\n-// This job runs the Chicago Taxi Example script on Dataflow\n-PostcommitJobBuilder.postCommitJob(\n-    'beam_PostCommit_Python_Chicago_Taxi_Dataflow',\n-    'Run Chicago Taxi on Dataflow',\n-    'Google Cloud Dataflow Runner Chicago Taxi Example',\n-    this\n-) {\n-    description('Runs the Chicago Taxi Example on the Dataflow runner.')\n+def chicagoTaxiJob = { scope ->\n+    scope.description('Runs the Chicago Taxi Example on the Dataflow runner.')\n \n     // Set common parameters.\n-    commonJobProperties.setTopLevelMainJobProperties(delegate)\n+    commonJobProperties.setTopLevelMainJobProperties(scope)\n+\n+    def pipelineOptions = [\n+        num_workers          : 5,\n+        autoscaling_algorithm: 'NONE',\n+    ]\n \n     // Gradle goals for this job.\n-    steps {\n+    scope.steps {\n         gradle {\n             rootBuildScriptDir(commonJobProperties.checkoutDir)\n+            commonJobProperties.setGradleSwitches(delegate)\n             tasks(':sdks:python:test-suites:dataflow:py2:chicagoTaxiExample')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6057153e761bb8808c6203b8df3cc012b559bb"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMzY4Mjky", "url": "https://github.com/apache/beam/pull/12195#pullrequestreview-450368292", "createdAt": "2020-07-17T04:42:06Z", "commit": {"oid": "8a6057153e761bb8808c6203b8df3cc012b559bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNDo0MjowNlrOGzFIwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwNDo0MjowNlrOGzFIwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjIxNDcyMA==", "bodyText": "With CronJobBuilder and PostcommitJobBuilder, do we run these test as frequent as specified by Cron config or more frequently (as often as new commits come in) ?", "url": "https://github.com/apache/beam/pull/12195#discussion_r456214720", "createdAt": "2020-07-17T04:42:06Z", "author": {"login": "tvalentyn"}, "path": ".test-infra/jenkins/job_PostCommit_Python_Chicago_Taxi_Example_Dataflow.groovy", "diffHunk": "@@ -19,46 +19,44 @@\n import CommonJobProperties as commonJobProperties\n import PostcommitJobBuilder\n import CronJobBuilder\n+import LoadTestsBuilder\n \n-\n-// This job runs the Chicago Taxi Example script on Dataflow\n-PostcommitJobBuilder.postCommitJob(\n-    'beam_PostCommit_Python_Chicago_Taxi_Dataflow',\n-    'Run Chicago Taxi on Dataflow',\n-    'Google Cloud Dataflow Runner Chicago Taxi Example',\n-    this\n-) {\n-    description('Runs the Chicago Taxi Example on the Dataflow runner.')\n+def chicagoTaxiJob = { scope ->\n+    scope.description('Runs the Chicago Taxi Example on the Dataflow runner.')\n \n     // Set common parameters.\n-    commonJobProperties.setTopLevelMainJobProperties(delegate)\n+    commonJobProperties.setTopLevelMainJobProperties(scope)\n+\n+    def pipelineOptions = [\n+        num_workers          : 5,\n+        autoscaling_algorithm: 'NONE',\n+    ]\n \n     // Gradle goals for this job.\n-    steps {\n+    scope.steps {\n         gradle {\n             rootBuildScriptDir(commonJobProperties.checkoutDir)\n+            commonJobProperties.setGradleSwitches(delegate)\n             tasks(':sdks:python:test-suites:dataflow:py2:chicagoTaxiExample')\n             switches('-PgcsRoot=gs://temp-storage-for-perf-tests/chicago-taxi')\n+            switches(\"-PpipelineOptions=\\\"${LoadTestsBuilder.parseOptions(pipelineOptions)}\\\"\")\n         }\n     }\n }\n \n+PostcommitJobBuilder.postCommitJob(\n+    'beam_PostCommit_Python_Chicago_Taxi_Dataflow',\n+    'Run Chicago Taxi on Dataflow',\n+    'Google Cloud Dataflow Runner Chicago Taxi Example',\n+    this\n+) {\n+    chicagoTaxiJob(delegate)\n+}\n+\n CronJobBuilder.cronJob(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a6057153e761bb8808c6203b8df3cc012b559bb"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1784bea047f39b512dce8719506e656865c9baf8", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/1784bea047f39b512dce8719506e656865c9baf8", "committedDate": "2020-07-20T16:20:57Z", "message": "fix: include trigger command in the message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxOTM1MDYx", "url": "https://github.com/apache/beam/pull/12195#pullrequestreview-451935061", "createdAt": "2020-07-20T20:28:14Z", "commit": {"oid": "1784bea047f39b512dce8719506e656865c9baf8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4174, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}