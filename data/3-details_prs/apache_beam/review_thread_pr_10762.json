{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwNjE0NDYx", "number": 10762, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMjo0NTowMVrODc135w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMjo0OToxNlrODc16VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNTY5MzgzOnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/runners/direct/transform_evaluator.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMjo0NTowMVrOFlGltw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwMTowOToyMFrOFlo3BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ0OTU5MQ==", "bodyText": "Beam has this pipeline option, project which is generally used to specify project explicitly. Asking user explicitly for resource avoid surprises. Shall we use it. \n  \n    \n      beam/sdks/python/apache_beam/options/pipeline_options.py\n    \n    \n         Line 473\n      in\n      40c2be0\n    \n    \n    \n    \n\n        \n          \n           parser.add_argument('--project',", "url": "https://github.com/apache/beam/pull/10762#discussion_r374449591", "createdAt": "2020-02-04T02:45:01Z", "author": {"login": "angoenka"}, "path": "sdks/python/apache_beam/runners/direct/transform_evaluator.py", "diffHunk": "@@ -499,13 +499,21 @@ def __init__(self, evaluation_context, applied_ptransform,\n     if self.source.id_label:\n       raise NotImplementedError(\n           'DirectRunner: id_label is not supported for PubSub reads')\n+\n+    import google.auth\n+\n+    _, sub_project = google.auth.default()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e51c971397040564e6ff66e7f1e95c7ee1f02d5"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAxMTA3Ng==", "bodyText": "Done. I'm defaulting to the default project from auth if the project is not specified. Thanks!", "url": "https://github.com/apache/beam/pull/10762#discussion_r375011076", "createdAt": "2020-02-05T01:09:20Z", "author": {"login": "davidyan74"}, "path": "sdks/python/apache_beam/runners/direct/transform_evaluator.py", "diffHunk": "@@ -499,13 +499,21 @@ def __init__(self, evaluation_context, applied_ptransform,\n     if self.source.id_label:\n       raise NotImplementedError(\n           'DirectRunner: id_label is not supported for PubSub reads')\n+\n+    import google.auth\n+\n+    _, sub_project = google.auth.default()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ0OTU5MQ=="}, "originalCommit": {"oid": "9e51c971397040564e6ff66e7f1e95c7ee1f02d5"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNTcwMDA0OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/runners/direct/transform_evaluator.py", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwMjo0OToxNlrOFlGpVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMDoxMTozNFrOFmLhgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ1MDUxOA==", "bodyText": "We can fall back to topic's project if this fails. This also maintains the current functionality.", "url": "https://github.com/apache/beam/pull/10762#discussion_r374450518", "createdAt": "2020-02-04T02:49:16Z", "author": {"login": "angoenka"}, "path": "sdks/python/apache_beam/runners/direct/transform_evaluator.py", "diffHunk": "@@ -516,7 +524,7 @@ def get_subscription(cls, transform, project, short_topic_name,\n \n     sub_client = pubsub.SubscriberClient()\n     sub_name = sub_client.subscription_path(\n-        project, 'beam_%d_%x' % (int(time.time()), random.randrange(1 << 32)))\n+        sub_project, 'beam_%d_%x' % (int(time.time()), random.randrange(1 << 32)))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e51c971397040564e6ff66e7f1e95c7ee1f02d5"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTAwMzI2MQ==", "bodyText": "Falling back to topic's project may make things less predictable, and failure to create the subscription could be transient and could be because of many reasons. The user should be sure which project it will create the subscription under. My take is that using the topic's project was a mistake from the beginning and it should be fixed. But let me know if you have other thoughts.", "url": "https://github.com/apache/beam/pull/10762#discussion_r375003261", "createdAt": "2020-02-05T00:40:16Z", "author": {"login": "davidyan74"}, "path": "sdks/python/apache_beam/runners/direct/transform_evaluator.py", "diffHunk": "@@ -516,7 +524,7 @@ def get_subscription(cls, transform, project, short_topic_name,\n \n     sub_client = pubsub.SubscriberClient()\n     sub_name = sub_client.subscription_path(\n-        project, 'beam_%d_%x' % (int(time.time()), random.randrange(1 << 32)))\n+        sub_project, 'beam_%d_%x' % (int(time.time()), random.randrange(1 << 32)))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ1MDUxOA=="}, "originalCommit": {"oid": "9e51c971397040564e6ff66e7f1e95c7ee1f02d5"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA1NzE5Mg==", "bodyText": "I think changing that would be a backward incompatible change and might break users. We can keep the existing behavior in place, and add a warning along the lines of this is wrong/deprecated/would change in the future.", "url": "https://github.com/apache/beam/pull/10762#discussion_r375057192", "createdAt": "2020-02-05T04:46:05Z", "author": {"login": "aaltay"}, "path": "sdks/python/apache_beam/runners/direct/transform_evaluator.py", "diffHunk": "@@ -516,7 +524,7 @@ def get_subscription(cls, transform, project, short_topic_name,\n \n     sub_client = pubsub.SubscriberClient()\n     sub_name = sub_client.subscription_path(\n-        project, 'beam_%d_%x' % (int(time.time()), random.randrange(1 << 32)))\n+        sub_project, 'beam_%d_%x' % (int(time.time()), random.randrange(1 << 32)))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ1MDUxOA=="}, "originalCommit": {"oid": "9e51c971397040564e6ff66e7f1e95c7ee1f02d5"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3OTAxMA==", "bodyText": "According to our offline discussion, I've removed the code that gets the project from google.auth and we now only rely on the project specified in pipeline_options. PTAL again. Thanks!", "url": "https://github.com/apache/beam/pull/10762#discussion_r375579010", "createdAt": "2020-02-06T00:11:34Z", "author": {"login": "davidyan74"}, "path": "sdks/python/apache_beam/runners/direct/transform_evaluator.py", "diffHunk": "@@ -516,7 +524,7 @@ def get_subscription(cls, transform, project, short_topic_name,\n \n     sub_client = pubsub.SubscriberClient()\n     sub_name = sub_client.subscription_path(\n-        project, 'beam_%d_%x' % (int(time.time()), random.randrange(1 << 32)))\n+        sub_project, 'beam_%d_%x' % (int(time.time()), random.randrange(1 << 32)))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ1MDUxOA=="}, "originalCommit": {"oid": "9e51c971397040564e6ff66e7f1e95c7ee1f02d5"}, "originalPosition": 29}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2149, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}