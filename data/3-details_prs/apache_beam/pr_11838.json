{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MTI4OTE2", "number": 11838, "title": "[BEAM-9322] Modify the TestStream to output a dict when no output_tags are specified", "bodyText": "Change-Id: I6a8eba4e323bf0fff318a56e44e512916c06266f\n#11765 removes the ability to set the output id on TestStreams with single outputs. This PR allows for setting the tags on single outputs by returning a dict in the expand when output_tags is not specified, i.e. when output_tags = {NONE}.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-05-27T21:42:39Z", "url": "https://github.com/apache/beam/pull/11838", "merged": true, "mergeCommit": {"oid": "2edb02f53aa13b8221b07c3cadd3cfd64b5e6d72"}, "closed": true, "closedAt": "2020-06-16T18:44:24Z", "author": {"login": "rohdesamuel"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclgNexAH2gAyNDI0MTI4OTE2Ojg0Njc0ODA3NmIzM2RjZjIzOGViNzFjMzBhNGRjOTYyZjY2YjY5ODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpuK2uAFqTQyNzYyNTU4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "846748076b33dcf238eb71c30a4dc962f66b6985", "author": {"user": {"login": "rohdesamuel", "name": "Sam sam"}}, "url": "https://github.com/apache/beam/commit/846748076b33dcf238eb71c30a4dc962f66b6985", "committedDate": "2020-05-27T21:32:58Z", "message": "Modify the streaming cache to always have multiple outputs\n\nChange-Id: I6a8eba4e323bf0fff318a56e44e512916c06266f"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NjM4MDM4", "url": "https://github.com/apache/beam/pull/11838#pullrequestreview-419638038", "createdAt": "2020-05-27T21:56:47Z", "commit": {"oid": "846748076b33dcf238eb71c30a4dc962f66b6985"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMTo1Njo0N1rOGbel8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMTo1Njo0N1rOGbel8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ2NTk2OA==", "bodyText": "Rather than introduce a sentinel label, how about returning a dict from expand iff output_tags was manually specified (or, alternatively, something other than {None})?", "url": "https://github.com/apache/beam/pull/11838#discussion_r431465968", "createdAt": "2020-05-27T21:56:47Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/runners/interactive/caching/streaming_cache.py", "diffHunk": "@@ -304,6 +304,18 @@ def read(self, *labels):\n       return iter([]), -1\n     return StreamingCache.Reader([header], [reader]).read(), 1\n \n+  @staticmethod\n+  def sentinel_label():", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "846748076b33dcf238eb71c30a4dc962f66b6985"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b6c737ce21fce1ab1a377ddd5452e13b916df17", "author": {"user": {"login": "rohdesamuel", "name": "Sam sam"}}, "url": "https://github.com/apache/beam/commit/9b6c737ce21fce1ab1a377ddd5452e13b916df17", "committedDate": "2020-05-27T22:11:14Z", "message": "Change TestStream to output a dict if the output_tags are {None}\n\nChange-Id: I0f755a3d39adfbb83b4056a6cfa857fa78aa230a"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d644a973f9f7d747518c646637e4a1bcaae9dbe1", "author": {"user": {"login": "rohdesamuel", "name": "Sam sam"}}, "url": "https://github.com/apache/beam/commit/d644a973f9f7d747518c646637e4a1bcaae9dbe1", "committedDate": "2020-05-27T22:12:24Z", "message": "tox\n\nChange-Id: Icd1a740eab640c66a7cc3c4a5725c26e7e592a09"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NjQyNDM4", "url": "https://github.com/apache/beam/pull/11838#pullrequestreview-419642438", "createdAt": "2020-05-27T22:05:12Z", "commit": {"oid": "846748076b33dcf238eb71c30a4dc962f66b6985"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMjowNToxMlrOGbeztw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMjowNToxMlrOGbeztw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ2OTQ5NQ==", "bodyText": "This is a little hard to read.\nIsn't a label l a str, so a sub_l is a character of that str?\nI suppose if not [sub_l for ...] evaluates to True when the [sub_l for ...] is empty.\nAnd the emptiness of [sub_l for ...] is based on whether the sentinel_label exists in the sub_l? This is where I get confused.", "url": "https://github.com/apache/beam/pull/11838#discussion_r431469495", "createdAt": "2020-05-27T22:05:12Z", "author": {"login": "KevinGG"}, "path": "sdks/python/apache_beam/runners/interactive/caching/streaming_cache.py", "diffHunk": "@@ -315,6 +327,7 @@ def read_multiple(self, labels):\n         StreamingCacheSource(self._cache_dir, l,\n                              self._is_cache_complete).read(tail=True)\n         for l in labels\n+        if not [sub_l for sub_l in l if self.sentinel_label() in sub_l]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "846748076b33dcf238eb71c30a4dc962f66b6985"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNDg4OTY3", "url": "https://github.com/apache/beam/pull/11838#pullrequestreview-420488967", "createdAt": "2020-05-28T21:01:29Z", "commit": {"oid": "d644a973f9f7d747518c646637e4a1bcaae9dbe1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NTIxMTg1", "url": "https://github.com/apache/beam/pull/11838#pullrequestreview-427521185", "createdAt": "2020-06-09T20:36:41Z", "commit": {"oid": "d644a973f9f7d747518c646637e4a1bcaae9dbe1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMDozNjo0MVrOGhbPew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMDozNjo0MVrOGhbPew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcwMjUyMw==", "bodyText": "If the user explicitly sets the output tags to {None}, they might be expecting a dict. (Specifically, they might get a set from elsewhere, and set the output tags from that set, and it would be awkward to have to check that set to determine how to interpret the result. So in this case I would do\nif not self.output_tags:\n  return pvalue.PCollection(self.pipeline, is_bounded=False)\nelse:\n  return { ... for tag in self.output_tags}", "url": "https://github.com/apache/beam/pull/11838#discussion_r437702523", "createdAt": "2020-06-09T20:36:41Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/testing/test_stream.py", "diffHunk": "@@ -291,10 +291,10 @@ def expand(self, pbegin):\n     assert isinstance(pbegin, pvalue.PBegin)\n     self.pipeline = pbegin.pipeline\n     if not self.output_tags:\n-      self.output_tags = set([None])\n+      self.output_tags = {None}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d644a973f9f7d747518c646637e4a1bcaae9dbe1"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NjI1NTgw", "url": "https://github.com/apache/beam/pull/11838#pullrequestreview-427625580", "createdAt": "2020-06-10T00:04:28Z", "commit": {"oid": "d644a973f9f7d747518c646637e4a1bcaae9dbe1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4401, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}