{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5ODkzNzA0", "number": 11553, "title": "[BEAM-9799] Automated validation for RTrackers.", "bodyText": "Adds automated validation for RTrackers to the DoFn invokers. I ran the\nParDo benchmark with and without my change and got similar results, so\nthis doesn't seem to have an obvious performance impact.\nNote that the currently documented benchmark number doesn't seem accurate before (or it's just my desktop that's different).\nBenchmark before change:\nBenchmarkParDo_EmitSumFn-6   \t  948087\t      1918 ns/op\t     484 B/op\t       4 allocs/op\nBenchmark after change:\nBenchmarkParDo_EmitSumFn-6   \t  681343\t      1919 ns/op\t     521 B/op\t       4 allocs/op\nNote that exact numbers wavered a bunch. It seemed to average around 1900 ns/op, going as low as 1850 and up to 1950. I chose two examples that had similar runtimes.\nThe error message emitted looks like this to the end-user:\n...\nCaused by: java.lang.RuntimeException: Error received from SDK harness for instruction 2: process bundle failed for instruction 2 using plan 5-6 : <emitted error>\n...\n\nI was toying with making it a bit more descriptive, but it matches the structure you get when the user emits an error from ProcessElement, so I kept it as is for consistency.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-04-28T05:35:47Z", "url": "https://github.com/apache/beam/pull/11553", "merged": true, "mergeCommit": {"oid": "0b96845eca2e6083e8367ea220f57aecfc796e3d"}, "closed": true, "closedAt": "2020-05-04T21:48:06Z", "author": {"login": "youngoli"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceDbu4gFqTQwNTIyMDA2MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABceGkeigBqjMzMDE4MzEzOTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MjIwMDYw", "url": "https://github.com/apache/beam/pull/11553#pullrequestreview-405220060", "createdAt": "2020-05-04T18:01:22Z", "commit": {"oid": "6668f0ac64923a54a572be1b503d1123a40af7ef"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxODowMToyMlrOGQLxDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxODowMzoyOFrOGQL1sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYyMzE4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t} else {\n          \n          \n            \n            \t\treturn errors.New(\"RTracker IsDone failed for unspecified reason\")\n          \n          \n            \n            \t}\n          \n          \n            \n            \t}\n          \n          \n            \n            \treturn errors.New(\"RTracker.IsDone() failed for unspecified reason\")", "url": "https://github.com/apache/beam/pull/11553#discussion_r419623182", "createdAt": "2020-05-04T18:01:22Z", "author": {"login": "lostluck"}, "path": "sdks/go/pkg/beam/core/runtime/exec/pardo.go", "diffHunk": "@@ -162,6 +168,14 @@ func (n *ParDo) processMainInput(mainIn *MainInput) error {\n \treturn nil\n }\n \n+func rtErrHelper(err error) error {\n+\tif err != nil {\n+\t\treturn err\n+\t} else {\n+\t\treturn errors.New(\"RTracker IsDone failed for unspecified reason\")\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6668f0ac64923a54a572be1b503d1123a40af7ef"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYyNDM3MA==", "bodyText": "Also, in both places this is called, error or no, we don't know IsDone failed(), we know that the DoFn terminated without fully processing the restriction (If I understand IsDone's semantics correctly). Perhaps the message should indicate that?", "url": "https://github.com/apache/beam/pull/11553#discussion_r419624370", "createdAt": "2020-05-04T18:03:28Z", "author": {"login": "lostluck"}, "path": "sdks/go/pkg/beam/core/runtime/exec/pardo.go", "diffHunk": "@@ -162,6 +168,14 @@ func (n *ParDo) processMainInput(mainIn *MainInput) error {\n \treturn nil\n }\n \n+func rtErrHelper(err error) error {\n+\tif err != nil {\n+\t\treturn err\n+\t} else {\n+\t\treturn errors.New(\"RTracker IsDone failed for unspecified reason\")\n+\t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYyMzE4Mg=="}, "originalCommit": {"oid": "6668f0ac64923a54a572be1b503d1123a40af7ef"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95f9a15ef1ca979f792c384d9d955675a47cd11b", "author": {"user": {"login": "youngoli", "name": "Daniel Oliveira"}}, "url": "https://github.com/apache/beam/commit/95f9a15ef1ca979f792c384d9d955675a47cd11b", "committedDate": "2020-05-04T21:42:20Z", "message": "[BEAM-9799] Automated validation for RTrackers.\n\nAdds automated validation for RTrackers to the DoFn invokers. I ran the\nParDo benchmark with and without my change and got similar results, so\nthis doesn't seem to have an obvious performance impact."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6668f0ac64923a54a572be1b503d1123a40af7ef", "author": {"user": {"login": "youngoli", "name": "Daniel Oliveira"}}, "url": "https://github.com/apache/beam/commit/6668f0ac64923a54a572be1b503d1123a40af7ef", "committedDate": "2020-04-28T05:27:39Z", "message": "[BEAM-9799] Automated validation for RTrackers.\n\nAdds automated validation for RTrackers to the DoFn invokers. I ran the\nParDo benchmark with and without my change and got similar results, so\nthis doesn't seem to have an obvious performance impact."}, "afterCommit": {"oid": "95f9a15ef1ca979f792c384d9d955675a47cd11b", "author": {"user": {"login": "youngoli", "name": "Daniel Oliveira"}}, "url": "https://github.com/apache/beam/commit/95f9a15ef1ca979f792c384d9d955675a47cd11b", "committedDate": "2020-05-04T21:42:20Z", "message": "[BEAM-9799] Automated validation for RTrackers.\n\nAdds automated validation for RTrackers to the DoFn invokers. I ran the\nParDo benchmark with and without my change and got similar results, so\nthis doesn't seem to have an obvious performance impact."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4035, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}