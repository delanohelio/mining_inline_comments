{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0OTg3NDI2", "number": 13399, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDozMDozOFrOE-5hSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxOTo1Njo1MlrOFA9OHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0Mzg5NTc2OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/runners/portability/sdk_container_builder.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDozMDozOFrOH8TWZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDozNTowMVrOH8Tb-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk5MzYzNw==", "bodyText": "I'm curious - why list_builds vs get_build using the operation build ID here?", "url": "https://github.com/apache/beam/pull/13399#discussion_r532993637", "createdAt": "2020-12-01T00:30:38Z", "author": {"login": "emilymye"}, "path": "sdks/python/apache_beam/runners/portability/sdk_container_builder.py", "diffHunk": "@@ -236,10 +235,21 @@ def invoke_docker_build_and_push(self, container_image_name):\n     build.timeout = Duration().FromSeconds(seconds=1800)\n \n     now = time.time()\n-    _LOGGER.info('Building sdk container, this may take a few minutes...')\n+    _LOGGER.info(\n+        'Building sdk container with google cloud build, this may '\n+        'take a few minutes...')\n     operation = client.create_build(project_id=project_id, build=build)\n     # if build fails exception will be raised and stops the job submission.\n-    result = operation.result()\n+    try:\n+      result = operation.result()\n+    except Exception as e:\n+      build_lists = client.list_builds(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ec00e43ad9ae8989ad0a6a1f25862ada7808be3"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk5NTA2NQ==", "bodyText": "get_build requires a build id that is not returned from calling client.create_build(), this may be a usability issue from the python client but I didn't find any thing simpler", "url": "https://github.com/apache/beam/pull/13399#discussion_r532995065", "createdAt": "2020-12-01T00:35:01Z", "author": {"login": "y1chi"}, "path": "sdks/python/apache_beam/runners/portability/sdk_container_builder.py", "diffHunk": "@@ -236,10 +235,21 @@ def invoke_docker_build_and_push(self, container_image_name):\n     build.timeout = Duration().FromSeconds(seconds=1800)\n \n     now = time.time()\n-    _LOGGER.info('Building sdk container, this may take a few minutes...')\n+    _LOGGER.info(\n+        'Building sdk container with google cloud build, this may '\n+        'take a few minutes...')\n     operation = client.create_build(project_id=project_id, build=build)\n     # if build fails exception will be raised and stops the job submission.\n-    result = operation.result()\n+    try:\n+      result = operation.result()\n+    except Exception as e:\n+      build_lists = client.list_builds(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk5MzYzNw=="}, "originalCommit": {"oid": "9ec00e43ad9ae8989ad0a6a1f25862ada7808be3"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2NTQ2MDQyOnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/runners/portability/sdk_container_builder.py", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxOTo1MzowNlrOH_fzlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxOTo1MzowNlrOH_fzlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM0MzQ0Ng==", "bodyText": "Consider filing a feature request for the owner of this library.", "url": "https://github.com/apache/beam/pull/13399#discussion_r536343446", "createdAt": "2020-12-04T19:53:06Z", "author": {"login": "tvalentyn"}, "path": "sdks/python/apache_beam/runners/portability/sdk_container_builder.py", "diffHunk": "@@ -235,24 +235,26 @@ def invoke_docker_build_and_push(self, container_image_name):\n     build.timeout = Duration().FromSeconds(seconds=1800)\n \n     now = time.time()\n-    _LOGGER.info(\n-        'Building sdk container with google cloud build, this may '\n-        'take a few minutes...')\n     operation = client.create_build(project_id=project_id, build=build)\n-    # if build fails exception will be raised and stops the job submission.\n-    try:\n-      result = operation.result()\n-    except Exception as e:\n-      build_lists = client.list_builds(\n-          project_id=project_id,\n-          filter=\"source.storage_source.bucket=\\\"%s\\\" AND source\"\n-          \".storage_source.object=\\\"%s\\\"\" % (gcs_bucket, gcs_object))\n-      for build in build_lists:\n-        _LOGGER.error(\"Build failed, check log at %s\" % build.log_url)\n-      raise e\n     _LOGGER.info(\n-        \"Python SDK container pre-build finished in %.2f seconds, \"\n-        \"check build log at %s\" % (time.time() - now, result.log_url))\n+      'Building sdk container with google cloud build, this may '\n+      'take a few minutes...')\n+    # TODO: we shouldn't need to query build log url with list_builds if log", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cda6ddaacd9257e6695e30d8635992ed211a6b89"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2NTQ3MzU2OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/runners/portability/sdk_container_builder.py", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxOTo1Njo1MlrOH_f7OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxOTo1Njo1MlrOH_f7OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM0NTQwMA==", "bodyText": "nit: s/google cloud build/Google Cloud Build here and below.", "url": "https://github.com/apache/beam/pull/13399#discussion_r536345400", "createdAt": "2020-12-04T19:56:52Z", "author": {"login": "tvalentyn"}, "path": "sdks/python/apache_beam/runners/portability/sdk_container_builder.py", "diffHunk": "@@ -235,24 +235,26 @@ def invoke_docker_build_and_push(self, container_image_name):\n     build.timeout = Duration().FromSeconds(seconds=1800)\n \n     now = time.time()\n-    _LOGGER.info(\n-        'Building sdk container with google cloud build, this may '\n-        'take a few minutes...')\n     operation = client.create_build(project_id=project_id, build=build)\n-    # if build fails exception will be raised and stops the job submission.\n-    try:\n-      result = operation.result()\n-    except Exception as e:\n-      build_lists = client.list_builds(\n-          project_id=project_id,\n-          filter=\"source.storage_source.bucket=\\\"%s\\\" AND source\"\n-          \".storage_source.object=\\\"%s\\\"\" % (gcs_bucket, gcs_object))\n-      for build in build_lists:\n-        _LOGGER.error(\"Build failed, check log at %s\" % build.log_url)\n-      raise e\n     _LOGGER.info(\n-        \"Python SDK container pre-build finished in %.2f seconds, \"\n-        \"check build log at %s\" % (time.time() - now, result.log_url))\n+      'Building sdk container with google cloud build, this may '", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cda6ddaacd9257e6695e30d8635992ed211a6b89"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2626, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}