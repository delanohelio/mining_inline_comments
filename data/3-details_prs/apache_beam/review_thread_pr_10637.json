{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0NTQzMTQ0", "number": 10637, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwMTozMTo1NVrODaXSBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxOTozNjo0NFrODaly5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4OTcxMDEyOnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/testing/util.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwMTozMTo1NVrOFhR1MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwMjoxMjoxN1rOFhSVww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQzOTQ3Mw==", "bodyText": "This creates a side-effect, making equal_to not thread-safe. Can we access equals_fn from the outer scope as we do with expected ?", "url": "https://github.com/apache/beam/pull/10637#discussion_r370439473", "createdAt": "2020-01-24T01:31:55Z", "author": {"login": "tvalentyn"}, "path": "sdks/python/apache_beam/testing/util.py", "diffHunk": "@@ -154,41 +154,50 @@ def equal_to_per_window(expected_window_to_elements):\n # Note that equal_to checks if expected and actual are permutations of each\n # other. However, only permutations of the top level are checked. Therefore\n # [1,2] and [2,1] are considered equal and [[1,2]] and [[2,1]] are not.\n-def equal_to(expected):\n+def equal_to(expected, equals_fn=None):\n+  equal_to.equals_fn=equals_fn", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b8368c4022d652724fda35375a45df6b64e9152"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ0NzgxMQ==", "bodyText": "Yes, I tried that but it indeed does not work. PTAL and the alternative I just committed.", "url": "https://github.com/apache/beam/pull/10637#discussion_r370447811", "createdAt": "2020-01-24T02:12:17Z", "author": {"login": "sorensenjs"}, "path": "sdks/python/apache_beam/testing/util.py", "diffHunk": "@@ -154,41 +154,50 @@ def equal_to_per_window(expected_window_to_elements):\n # Note that equal_to checks if expected and actual are permutations of each\n # other. However, only permutations of the top level are checked. Therefore\n # [1,2] and [2,1] are considered equal and [[1,2]] and [[2,1]] are not.\n-def equal_to(expected):\n+def equal_to(expected, equals_fn=None):\n+  equal_to.equals_fn=equals_fn", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQzOTQ3Mw=="}, "originalCommit": {"oid": "3b8368c4022d652724fda35375a45df6b64e9152"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5MjA4ODA2OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/testing/util.py", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxOTozNjo0NFrOFhoT7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxOTozNjo0NFrOFhoT7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNzc5MQ==", "bodyText": "We can remove BeamAssertException from here. The remaining code in the block would not raise that exception.", "url": "https://github.com/apache/beam/pull/10637#discussion_r370807791", "createdAt": "2020-01-24T19:36:44Z", "author": {"login": "aaltay"}, "path": "sdks/python/apache_beam/testing/util.py", "diffHunk": "@@ -154,41 +154,48 @@ def equal_to_per_window(expected_window_to_elements):\n # Note that equal_to checks if expected and actual are permutations of each\n # other. However, only permutations of the top level are checked. Therefore\n # [1,2] and [2,1] are considered equal and [[1,2]] and [[2,1]] are not.\n-def equal_to(expected):\n+def equal_to(expected, equals_fn=None):\n \n-  def _equal(actual):\n+  def _equal(actual, equals_fn=equals_fn):\n     expected_list = list(expected)\n \n     # Try to compare actual and expected by sorting. This fails with a\n     # TypeError in Python 3 if different types are present in the same\n     # collection. It can also raise false negatives for types that don't have\n     # a deterministic sort order, like pyarrow Tables as of 0.14.1\n-    try:\n-      sorted_expected = sorted(expected)\n-      sorted_actual = sorted(actual)\n-      if sorted_expected != sorted_actual:\n-        raise BeamAssertException(\n-            'Failed assert: %r == %r' % (sorted_expected, sorted_actual))\n+    if not equals_fn:\n+      try:\n+        sorted_expected = sorted(expected)\n+        sorted_actual = sorted(actual)\n+        if sorted_expected == sorted_actual:\n+          return\n+      except (BeamAssertException, TypeError):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a861a312db777051d76bc8a977dfd437ad53ceed"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2220, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}