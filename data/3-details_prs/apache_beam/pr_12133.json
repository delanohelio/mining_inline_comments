{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMTA5NzI1", "number": 12133, "title": "[BEAM-10385] Integrate SQL expansion into Flink job server ", "bodyText": "The expansion server is started with the job server to allow for an expansion of external transforms during pipeline submission. At the moment, an extra expansion server has to be started to expand SqlTransform. It would be desirable to include the SQL expansion into the expansion server that is started with the job server.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-06-30T15:27:53Z", "url": "https://github.com/apache/beam/pull/12133", "merged": true, "mergeCommit": {"oid": "1b01fb16535a29bfd8b59fd828515528eae8b78e"}, "closed": true, "closedAt": "2020-07-07T15:30:16Z", "author": {"login": "mxm"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwsASXgBqjM1MDMwMjI5MDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyj5F8AH2gAyNDQyMTA5NzI1Ojg4YjZmZTg0MjY1OThiZjVlNjRmYzU3Y2YxYTlkMmYxNzA4OWIyYjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e720b7666b7418cbc69eae7e052c597b6babbbbc", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/e720b7666b7418cbc69eae7e052c597b6babbbbc", "committedDate": "2020-06-30T17:17:24Z", "message": "fixup! Python2 compatibility"}, "afterCommit": {"oid": "28f4bfd3d356dd698cdd4e220ce24952b737f3cc", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/28f4bfd3d356dd698cdd4e220ce24952b737f3cc", "committedDate": "2020-07-01T15:29:36Z", "message": "[BEAM-10385] Integrate SQL expansion into Flink job server\n\nUltimately, these dependencies should be moved to the base job server but this\nis a larger refactor which will potentially get rid of the runner-specific job\nserver projects completely."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9472231b9260abbb91b7d71536b9f213c0c6523a", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/9472231b9260abbb91b7d71536b9f213c0c6523a", "committedDate": "2020-07-01T15:38:20Z", "message": "fixup! Python linting"}, "afterCommit": {"oid": "10d3b6aab3f13d7f11fc50e7d72f6f6520c05bd6", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/10d3b6aab3f13d7f11fc50e7d72f6f6520c05bd6", "committedDate": "2020-07-01T15:57:27Z", "message": "[BEAM-10385] Integrate SQL expansion into Flink job server\n\nUltimately, these dependencies should be moved to the base job server but this\nis a larger refactor which will potentially get rid of the runner-specific job\nserver projects completely."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMDgxNDg2", "url": "https://github.com/apache/beam/pull/12133#pullrequestreview-441081486", "createdAt": "2020-07-01T17:52:39Z", "commit": {"oid": "10d3b6aab3f13d7f11fc50e7d72f6f6520c05bd6"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNzo1MjozOVrOGrv0Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNzo1NzoxOVrOGrv-Og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyNTQwNg==", "bodyText": "We definitely want to accept an expansion service as an argument, but the default should remain BeamJarExpansionService(':sdks:java:extensions:sql:expansion-service:shadowJar').", "url": "https://github.com/apache/beam/pull/12133#discussion_r448525406", "createdAt": "2020-07-01T17:52:39Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/transforms/sql.py", "diffHunk": "@@ -67,10 +66,9 @@ class SqlTransform(ExternalTransform):\n   \"\"\"\n   URN = 'beam:external:java:sql:v1'\n \n-  def __init__(self, query, dialect=None):\n+  def __init__(self, query, dialect=None, expansion_service=None):\n     super(SqlTransform, self).__init__(\n         self.URN,\n         NamedTupleBasedPayloadBuilder(\n             SqlTransformSchema(query=query, dialect=dialect)),\n-        BeamJarExpansionService(\n-            ':sdks:java:extensions:sql:expansion-service:shadowJar'))\n+        expansion_service=expansion_service)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10d3b6aab3f13d7f11fc50e7d72f6f6520c05bd6"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyNzkzMA==", "bodyText": "Note that you can use JavaJarServer.beam_services() (automatically populated by the --beam_services flag) to specify an alternative jar or live expansion service for any beam target.", "url": "https://github.com/apache/beam/pull/12133#discussion_r448527930", "createdAt": "2020-07-01T17:57:19Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/transforms/sql.py", "diffHunk": "@@ -67,10 +66,9 @@ class SqlTransform(ExternalTransform):\n   \"\"\"\n   URN = 'beam:external:java:sql:v1'\n \n-  def __init__(self, query, dialect=None):\n+  def __init__(self, query, dialect=None, expansion_service=None):\n     super(SqlTransform, self).__init__(\n         self.URN,\n         NamedTupleBasedPayloadBuilder(\n             SqlTransformSchema(query=query, dialect=dialect)),\n-        BeamJarExpansionService(\n-            ':sdks:java:extensions:sql:expansion-service:shadowJar'))\n+        expansion_service=expansion_service)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyNTQwNg=="}, "originalCommit": {"oid": "10d3b6aab3f13d7f11fc50e7d72f6f6520c05bd6"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "10d3b6aab3f13d7f11fc50e7d72f6f6520c05bd6", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/10d3b6aab3f13d7f11fc50e7d72f6f6520c05bd6", "committedDate": "2020-07-01T15:57:27Z", "message": "[BEAM-10385] Integrate SQL expansion into Flink job server\n\nUltimately, these dependencies should be moved to the base job server but this\nis a larger refactor which will potentially get rid of the runner-specific job\nserver projects completely."}, "afterCommit": {"oid": "e9fa78a752837bdfd8106b8d9c58f1708fc2422f", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/e9fa78a752837bdfd8106b8d9c58f1708fc2422f", "committedDate": "2020-07-06T11:46:09Z", "message": "[BEAM-10385] Integrate SQL expansion into Flink job server\n\nUltimately, these dependencies should be moved to the base job server but this\nis a larger refactor which will potentially get rid of the runner-specific job\nserver projects completely."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMjkzMTE2", "url": "https://github.com/apache/beam/pull/12133#pullrequestreview-443293116", "createdAt": "2020-07-06T17:56:24Z", "commit": {"oid": "e9fa78a752837bdfd8106b8d9c58f1708fc2422f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50c63e70e2bfcf65cfbce9fb74901ac0495f8796", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/50c63e70e2bfcf65cfbce9fb74901ac0495f8796", "committedDate": "2020-07-06T18:57:59Z", "message": "[BEAM-10387] Allow customizing expansion server for SqlTransform\n\nThis removes the hardcoded dependency on SQL expansion jar server."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00a756c9476546e62cb34bbef3d8c3dfa4e57d88", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/00a756c9476546e62cb34bbef3d8c3dfa4e57d88", "committedDate": "2020-07-06T18:57:59Z", "message": "[BEAM-10385] Integrate SQL expansion into Flink job server\n\nUltimately, these dependencies should be moved to the base job server but this\nis a larger refactor which will potentially get rid of the runner-specific job\nserver projects completely."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9fa78a752837bdfd8106b8d9c58f1708fc2422f", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/e9fa78a752837bdfd8106b8d9c58f1708fc2422f", "committedDate": "2020-07-06T11:46:09Z", "message": "[BEAM-10385] Integrate SQL expansion into Flink job server\n\nUltimately, these dependencies should be moved to the base job server but this\nis a larger refactor which will potentially get rid of the runner-specific job\nserver projects completely."}, "afterCommit": {"oid": "00a756c9476546e62cb34bbef3d8c3dfa4e57d88", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/00a756c9476546e62cb34bbef3d8c3dfa4e57d88", "committedDate": "2020-07-06T18:57:59Z", "message": "[BEAM-10385] Integrate SQL expansion into Flink job server\n\nUltimately, these dependencies should be moved to the base job server but this\nis a larger refactor which will potentially get rid of the runner-specific job\nserver projects completely."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNDA1OTA0", "url": "https://github.com/apache/beam/pull/12133#pullrequestreview-443405904", "createdAt": "2020-07-06T21:03:15Z", "commit": {"oid": "00a756c9476546e62cb34bbef3d8c3dfa4e57d88"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQyMTowMzoxNVrOGtnCKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQyMTowMzoxNVrOGtnCKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ3ODYzMg==", "bodyText": "+1, a wider discussion about expansion service discovery and bundling would be very good to have on the mailing list.", "url": "https://github.com/apache/beam/pull/12133#discussion_r450478632", "createdAt": "2020-07-06T21:03:15Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/transforms/sql.py", "diffHunk": "@@ -67,10 +66,9 @@ class SqlTransform(ExternalTransform):\n   \"\"\"\n   URN = 'beam:external:java:sql:v1'\n \n-  def __init__(self, query, dialect=None):\n+  def __init__(self, query, dialect=None, expansion_service=None):\n     super(SqlTransform, self).__init__(\n         self.URN,\n         NamedTupleBasedPayloadBuilder(\n             SqlTransformSchema(query=query, dialect=dialect)),\n-        BeamJarExpansionService(\n-            ':sdks:java:extensions:sql:expansion-service:shadowJar'))\n+        expansion_service=expansion_service)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyNTQwNg=="}, "originalCommit": {"oid": "10d3b6aab3f13d7f11fc50e7d72f6f6520c05bd6"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88b6fe8426598bf5e64fc57cf1a9d2f17089b2b2", "author": {"user": {"login": "mxm", "name": "Maximilian Michels"}}, "url": "https://github.com/apache/beam/commit/88b6fe8426598bf5e64fc57cf1a9d2f17089b2b2", "committedDate": "2020-07-07T11:11:20Z", "message": "[BEAM-7252] Exclude SQL test from FlinkRunnerOptimized\n\nExternal transforms are not supported by the optimizer."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3245, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}