{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMTQ4MDA5", "number": 11357, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjoxMDoyOFrOD_pSsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDo1Njo1M1rOEAIsJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4MDYzNDEwOnYy", "diffSide": "RIGHT", "path": "sdks/java/io/solr/src/main/java/org/apache/beam/sdk/io/solr/SolrIO.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjoxMDoyOFrOGabVoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjoyMDo0M1rOGabrHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM2NDA2NQ==", "bodyText": "Is withReplicaInfo() required here? If yes, please, add a check.", "url": "https://github.com/apache/beam/pull/11357#discussion_r430364065", "createdAt": "2020-05-26T12:10:28Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/solr/src/main/java/org/apache/beam/sdk/io/solr/SolrIO.java", "diffHunk": "@@ -364,36 +372,41 @@ Read withBatchSize(int batchSize) {\n       // by tuning batchSize when pipelines run.\n       checkArgument(\n           batchSize > 0 && batchSize < MAX_BATCH_SIZE,\n-          \"Valid values for batchSize are 1 (inclusize) to %s (exclusive), but was: %s \",\n+          \"Valid values for batchSize are 1 (inclusive) to %s (exclusive), but was: %s \",\n           MAX_BATCH_SIZE,\n           batchSize);\n       return builder().setBatchSize(batchSize).build();\n     }\n \n+    /** Read from a specific Replica (partition). */\n+    public Read withReplicaInfo(ReplicaInfo replicaInfo) {\n+      checkArgument(replicaInfo != null, \"replicaInfo can not be null\");\n+      return builder().setReplicaInfo(replicaInfo).build();\n+    }\n+\n     @Override\n     public PCollection<SolrDocument> expand(PBegin input) {\n       checkArgument(\n           getConnectionConfiguration() != null, \"withConnectionConfiguration() is required\");\n       checkArgument(getCollection() != null, \"from() is required\");\n-\n-      return input\n-          .apply(\"Create\", Create.of(this))\n-          .apply(\"Split\", ParDo.of(new SplitFn()))\n-          .apply(\"Reshuffle\", Reshuffle.viaRandomKey())\n-          .apply(\"Read\", ParDo.of(new ReadFn()));\n+      return input.apply(\"Create\", Create.of(this)).apply(\"ReadAll\", readAll());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a621c5d3335baebcfa98cb645c2a57f0597d8147"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM2OTU2NQ==", "bodyText": "My bad, I think we don't need it here since anyway it will pass through SplitFn downstream", "url": "https://github.com/apache/beam/pull/11357#discussion_r430369565", "createdAt": "2020-05-26T12:20:43Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/solr/src/main/java/org/apache/beam/sdk/io/solr/SolrIO.java", "diffHunk": "@@ -364,36 +372,41 @@ Read withBatchSize(int batchSize) {\n       // by tuning batchSize when pipelines run.\n       checkArgument(\n           batchSize > 0 && batchSize < MAX_BATCH_SIZE,\n-          \"Valid values for batchSize are 1 (inclusize) to %s (exclusive), but was: %s \",\n+          \"Valid values for batchSize are 1 (inclusive) to %s (exclusive), but was: %s \",\n           MAX_BATCH_SIZE,\n           batchSize);\n       return builder().setBatchSize(batchSize).build();\n     }\n \n+    /** Read from a specific Replica (partition). */\n+    public Read withReplicaInfo(ReplicaInfo replicaInfo) {\n+      checkArgument(replicaInfo != null, \"replicaInfo can not be null\");\n+      return builder().setReplicaInfo(replicaInfo).build();\n+    }\n+\n     @Override\n     public PCollection<SolrDocument> expand(PBegin input) {\n       checkArgument(\n           getConnectionConfiguration() != null, \"withConnectionConfiguration() is required\");\n       checkArgument(getCollection() != null, \"from() is required\");\n-\n-      return input\n-          .apply(\"Create\", Create.of(this))\n-          .apply(\"Split\", ParDo.of(new SplitFn()))\n-          .apply(\"Reshuffle\", Reshuffle.viaRandomKey())\n-          .apply(\"Read\", ParDo.of(new ReadFn()));\n+      return input.apply(\"Create\", Create.of(this)).apply(\"ReadAll\", readAll());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM2NDA2NQ=="}, "originalCommit": {"oid": "a621c5d3335baebcfa98cb645c2a57f0597d8147"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NTc3ODI5OnYy", "diffSide": "RIGHT", "path": "sdks/java/io/solr/src/test/java/org/apache/beam/sdk/io/solr/SolrIOTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDo1Njo1M1rOGbOlvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxNDo1Njo1M1rOGbOlvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIwMzc3NA==", "bodyText": "I believe we can improve this test in the future by reading with multiple Reads (the goal of adding readAll()) and check the content of read messages (not only count).", "url": "https://github.com/apache/beam/pull/11357#discussion_r431203774", "createdAt": "2020-05-27T14:56:53Z", "author": {"login": "aromanenko-dev"}, "path": "sdks/java/io/solr/src/test/java/org/apache/beam/sdk/io/solr/SolrIOTest.java", "diffHunk": "@@ -155,6 +155,23 @@ public void testRead() throws Exception {\n     pipeline.run();\n   }\n \n+  @Test\n+  public void testReadAll() throws Exception {\n+    SolrIOTestUtils.insertTestDocuments(SOLR_COLLECTION, NUM_DOCS, solrClient);\n+\n+    PCollection<SolrDocument> output =\n+        pipeline\n+            .apply(\n+                Create.of(\n+                    SolrIO.read()\n+                        .withConnectionConfiguration(connectionConfiguration)\n+                        .from(SOLR_COLLECTION)\n+                        .withBatchSize(101)))\n+            .apply(SolrIO.readAll());\n+    PAssert.thatSingleton(output.apply(\"Count\", Count.globally())).isEqualTo(NUM_DOCS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61eebf0e4623e67ef9f5430052ea5d26c7b69d0a"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1443, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}