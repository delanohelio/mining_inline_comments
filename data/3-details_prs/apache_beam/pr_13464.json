{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMTkzNzg3", "number": 13464, "title": "[BEAM-11383] Add runtime normalization for file timestamps", "bodyText": "This normalizes the sdk.properties file which has a build timestamp in it as well as the version and sdk version. For the purposes of the runtime classpath, these can be ignored so that tasks are not rerun if only the build timestamp is changed.\nThis should result in significantly higher cache hits as well as more up-to-date checks.\nThis also preserves timestamps for certain tasks for the same reason.\nBEAM-11383\nRead the Gradle release notes for an explanation of runtime classpath normalization. Read the header \"Improved cache hits with normalized runtime classpaths\".\nBelow is an example of a task that would be avoided when the sdk.properties file does not change:\n\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-12-02T18:03:40Z", "url": "https://github.com/apache/beam/pull/13464", "merged": true, "mergeCommit": {"oid": "30f9a607509940f78459e4fba847617399780246"}, "closed": true, "closedAt": "2020-12-05T00:08:44Z", "author": {"login": "runningcode"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdisM3QAFqTU0NDU1ODUwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdi-lxhAFqTU0NTMwNjUyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0NTU4NTA0", "url": "https://github.com/apache/beam/pull/13464#pullrequestreview-544558504", "createdAt": "2020-12-03T23:56:30Z", "commit": {"oid": "7228b898dc88c78eac9d7bb23d225e530a2f8e75"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMzo1NjozMFrOH-6mLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMzo1OTowNVrOH-6qUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTczMzgwNw==", "bodyText": "Could/should we do this in applyJavaNature and/or applyPortabilityNature to get the benefit for all built jars?", "url": "https://github.com/apache/beam/pull/13464#discussion_r535733807", "createdAt": "2020-12-03T23:56:30Z", "author": {"login": "TheNeuralBit"}, "path": "sdks/java/core/build.gradle", "diffHunk": "@@ -66,6 +66,10 @@ test {\n   }\n }\n \n+tasks.withType(Jar).configureEach {\n+  preserveFileTimestamps(false)\n+}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7228b898dc88c78eac9d7bb23d225e530a2f8e75"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTczNDg2Ng==", "bodyText": "nit:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            allprojects {\n          \n          \n            \n            # Ignore sdk.properties so it doesn't spoil the build cache unnecessarily (see https://docs.gradle.org/6.6/userguide/more_about_tasks.html#sec:configure_input_normalization)\n          \n          \n            \n            allprojects {\n          \n      \n    \n    \n  \n\n(or something)", "url": "https://github.com/apache/beam/pull/13464#discussion_r535734866", "createdAt": "2020-12-03T23:59:05Z", "author": {"login": "TheNeuralBit"}, "path": "build.gradle", "diffHunk": "@@ -375,8 +375,16 @@ if (project.hasProperty('compileAndRunTestsWithJava11')) {\n   project.sqlPreCommit.dependsOn ':sdks:java:testing:test-utils:verifyJavaVersion'\n } else {\n   allprojects {\n-    tasks.withType(Test) {\n+    tasks.withType(Test).configureEach {\n       exclude '**/JvmVerification.class'\n     }\n   }\n }\n+\n+allprojects {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7228b898dc88c78eac9d7bb23d225e530a2f8e75"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8be8adc03d0353fa4c38c61c6683c9637afd605", "author": {"user": {"login": "runningcode", "name": "Nelson Osacky"}}, "url": "https://github.com/apache/beam/commit/f8be8adc03d0353fa4c38c61c6683c9637afd605", "committedDate": "2020-12-04T09:33:36Z", "message": "[BEAM-11383] Add runtime normalization for sdk.properties.\n\nThis normalizes the sdk.properties file which has a build timestamp in it as well as the version and sdk version. For the purposes of the runtime classpath, these can be ignored so that tasks are not rerun if only the build timestamp is changed.\nThis should result in significantly higher cache hits as well as more up-to-date checks.\n\nThis also preserves timestamps for certain tasks for the same reason.\n\nBEAM-11383"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7228b898dc88c78eac9d7bb23d225e530a2f8e75", "author": {"user": {"login": "runningcode", "name": "Nelson Osacky"}}, "url": "https://github.com/apache/beam/commit/7228b898dc88c78eac9d7bb23d225e530a2f8e75", "committedDate": "2020-12-02T18:03:14Z", "message": "[BEAM-11383] Add runtime normalization for sdk.properties.\n\nThis normalizes the sdk.properties file which has a build timestamp in it as well as the version and sdk version. For the purposes of the runtime classpath, these can be ignored so that tasks are not rerun if only the build timestamp is changed.\nThis should result in significantly higher cache hits as well as more up-to-date checks.\n\nThis also preserves timestamps for certain tasks for the same reason.\n\nBEAM-11383"}, "afterCommit": {"oid": "f8be8adc03d0353fa4c38c61c6683c9637afd605", "author": {"user": {"login": "runningcode", "name": "Nelson Osacky"}}, "url": "https://github.com/apache/beam/commit/f8be8adc03d0353fa4c38c61c6683c9637afd605", "committedDate": "2020-12-04T09:33:36Z", "message": "[BEAM-11383] Add runtime normalization for sdk.properties.\n\nThis normalizes the sdk.properties file which has a build timestamp in it as well as the version and sdk version. For the purposes of the runtime classpath, these can be ignored so that tasks are not rerun if only the build timestamp is changed.\nThis should result in significantly higher cache hits as well as more up-to-date checks.\n\nThis also preserves timestamps for certain tasks for the same reason.\n\nBEAM-11383"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MzA2NTIz", "url": "https://github.com/apache/beam/pull/13464#pullrequestreview-545306523", "createdAt": "2020-12-04T21:25:44Z", "commit": {"oid": "f8be8adc03d0353fa4c38c61c6683c9637afd605"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQyMToyNTo0NFrOH_ikKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQyMToyNTo0NFrOH_ikKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM4ODY0OQ==", "bodyText": "Ah yes I guess applyJavaNature is called in applyPortabilityNature already so this caputres both \ud83d\udc4d", "url": "https://github.com/apache/beam/pull/13464#discussion_r536388649", "createdAt": "2020-12-04T21:25:44Z", "author": {"login": "TheNeuralBit"}, "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy", "diffHunk": "@@ -770,6 +770,10 @@ class BeamModulePlugin implements Plugin<Project> {\n         + (defaultLintSuppressions + configuration.disableLintWarnings).collect { \"-Xlint:-${it}\" })\n       }\n \n+      project.tasks.withType(Jar).configureEach {\n+        preserveFileTimestamps(false)\n+      }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f8be8adc03d0353fa4c38c61c6683c9637afd605"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4689, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}