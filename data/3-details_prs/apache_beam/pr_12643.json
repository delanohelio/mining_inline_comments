{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwNTIyMjUy", "number": 12643, "title": "[BEAM-10438] Update SupportedZetaSqlBuiltinFunctions and support math functions", "bodyText": "Sync with builtin_function.proto in ZetaSQL 2020.08.1 release\nTurn on all scalar math functions supported by ZetaSQL evaluator and add unit tests for them\nMove all existing unit tests for math functions to ZetaSqlMathFunctionsTest\nSome minor style change\n\nr: @apilloud\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n \n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-20T00:05:45Z", "url": "https://github.com/apache/beam/pull/12643", "merged": true, "mergeCommit": {"oid": "e9dcd541116098057c23d7132376e60a338adc44"}, "closed": true, "closedAt": "2020-10-27T17:09:29Z", "author": {"login": "robinyqiu"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCbbP6gBqjM2OTEzODI3NTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWqGcMgBqjM5MjYzNDc3NzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "301ee1e89ef436139ff6ef325740ff87af2f7b25", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/301ee1e89ef436139ff6ef325740ff87af2f7b25", "committedDate": "2020-08-19T23:54:34Z", "message": "Enable math scalar functions and add unit tests"}, "afterCommit": {"oid": "ae0a10ac1941a21e22ff105735e239538679ff44", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/ae0a10ac1941a21e22ff105735e239538679ff44", "committedDate": "2020-08-25T18:22:03Z", "message": "Enable math scalar functions and add unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTg2Mjkx", "url": "https://github.com/apache/beam/pull/12643#pullrequestreview-489186291", "createdAt": "2020-09-16T00:03:20Z", "commit": {"oid": "ae0a10ac1941a21e22ff105735e239538679ff44"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMDowMzoyMVrOHSbVpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMDoxNDoxNVrOHSbhvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA4NDMyNw==", "bodyText": "nit: Renames like this are probably a net negative when you take into account the total cost of a change (time authoring and reviewing, increased diffs when debugging future issues, potential upgrade friction for customers). It is hard to know exactly where the line is so feel free to push forward with these as much of the work is already done. In the future I would suggest avoiding non-functional changes, particularly if they are something that would be at most a nit on a code review. (These went in recently and didn't even get a nit comment.)", "url": "https://github.com/apache/beam/pull/12643#discussion_r489084327", "createdAt": "2020-09-16T00:03:21Z", "author": {"login": "apilloud"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigquery/BeamBigQuerySqlDialect.java", "diffHunk": "@@ -87,16 +87,17 @@\n           .put(\"$extract_time\", \"TIME\")\n           .put(\"$extract_datetime\", \"DATETIME\")\n           .build();\n-  public static final String DOUBLE_POSITIVE_INF_FUNCTION = \"double_positive_inf\";\n-  public static final String DOUBLE_NEGATIVE_INF_FUNCTION = \"double_negative_inf\";\n-  public static final String DOUBLE_NAN_FUNCTION = \"double_nan\";\n-  private static final Map<String, String> DOUBLE_FUNCTIONS =\n+  public static final String DOUBLE_POSITIVE_INF_WRAPPER = \"double_positive_inf\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae0a10ac1941a21e22ff105735e239538679ff44"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA4NDc4Mw==", "bodyText": "nit: This PR has a interesting mix of minor refactors and addition of new functionality. These should probably be separate changes.", "url": "https://github.com/apache/beam/pull/12643#discussion_r489084783", "createdAt": "2020-09-16T00:04:54Z", "author": {"login": "apilloud"}, "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/SupportedZetaSqlBuiltinFunctions.java", "diffHunk": "@@ -277,29 +293,31 @@\n           FunctionSignatureId.FN_PARSE_DATETIME, // parse_datetime\n           FunctionSignatureId.FN_PARSE_TIME, // parse_time\n           FunctionSignatureId.FN_PARSE_TIMESTAMP, // parse_timestamp\n+          // FunctionSignatureId.FN_LAST_DAY_DATE, // last_day date\n+          // FunctionSignatureId.FN_LAST_DAY_DATETIME, // last_day datetime\n \n           // Math functions\n-          // FunctionSignatureId.FN_ABS_INT64, // abs\n-          // FunctionSignatureId.FN_ABS_DOUBLE, // abs\n-          // FunctionSignatureId.FN_ABS_NUMERIC, // abs\n+          FunctionSignatureId.FN_ABS_INT64, // abs", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae0a10ac1941a21e22ff105735e239538679ff44"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA4NTMzNA==", "bodyText": "This one scares me just a little. In particular, I'm worried that we might accidentally optimize such that we end up with a constant. Is that something we need to test? https://xkcd.com/221/", "url": "https://github.com/apache/beam/pull/12643#discussion_r489085334", "createdAt": "2020-09-16T00:06:49Z", "author": {"login": "apilloud"}, "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/SupportedZetaSqlBuiltinFunctions.java", "diffHunk": "@@ -475,17 +512,22 @@\n \n           // FunctionSignatureId.FN_RANGE_BUCKET, //  range_bucket(T, array<T>) -> int64\n \n-          // FunctionSignatureId.FN_RAND, // rand() -> double\n+          FunctionSignatureId.FN_RAND // rand() -> double", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae0a10ac1941a21e22ff105735e239538679ff44"}, "originalPosition": 267}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA4NzQyMQ==", "bodyText": "nit: these constants are only used in ZetaSqlMathFunctionsTest.java, do they belong there?", "url": "https://github.com/apache/beam/pull/12643#discussion_r489087421", "createdAt": "2020-09-16T00:14:15Z", "author": {"login": "apilloud"}, "path": "sdks/java/extensions/sql/zetasql/src/test/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSqlTypesUtils.java", "diffHunk": "@@ -24,6 +24,11 @@\n @Internal\n public class ZetaSqlTypesUtils {\n \n+  public static final BigDecimal NUMERIC_MAX_VALUE =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae0a10ac1941a21e22ff105735e239538679ff44"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "287067eeed7b7f48ef25ff5ddcd408ee572861c0", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/287067eeed7b7f48ef25ff5ddcd408ee572861c0", "committedDate": "2020-10-27T07:49:18Z", "message": "Update SupportedZetaSqlBuiltinFunctions and support math functions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae0a10ac1941a21e22ff105735e239538679ff44", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/ae0a10ac1941a21e22ff105735e239538679ff44", "committedDate": "2020-08-25T18:22:03Z", "message": "Enable math scalar functions and add unit tests"}, "afterCommit": {"oid": "287067eeed7b7f48ef25ff5ddcd408ee572861c0", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/287067eeed7b7f48ef25ff5ddcd408ee572861c0", "committedDate": "2020-10-27T07:49:18Z", "message": "Update SupportedZetaSqlBuiltinFunctions and support math functions"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4837, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}