{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNTYwNTkz", "number": 12102, "title": "[BEAM-8133] Update influx db publisher", "bodyText": "runtimeMs and numResults are now published as integer not float type\nAdditional logic for error logging added\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\n\n\n\n\nGo\n\n---\n\n---\n\n\n\nJava\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n\n\nXLang\n---\n---\n\n---\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nH", "createdAt": "2020-06-26T12:35:11Z", "url": "https://github.com/apache/beam/pull/12102", "merged": true, "mergeCommit": {"oid": "385f2d5cb42216da7257dfd8b1a9e3a2d9fe5ba8"}, "closed": true, "closedAt": "2020-06-29T14:13:41Z", "author": {"login": "pawelpasterz"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvC2v8AFqTQzODI3NDA3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcv5k6nABqjM0OTEyMjEyMzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Mjc0MDc1", "url": "https://github.com/apache/beam/pull/12102#pullrequestreview-438274075", "createdAt": "2020-06-26T13:00:07Z", "commit": {"oid": "7075133afa152ff0d1609e77a4dd94784ae799f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMzowMDowOFrOGpf-TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMzowMDowOFrOGpf-TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE2ODY1Mg==", "bodyText": "What about something like this?\nBy default, InfluxDB treats all values as floats. We need to add 'i' suffix to interpret the value as an integer.", "url": "https://github.com/apache/beam/pull/12102#discussion_r446168652", "createdAt": "2020-06-26T13:00:08Z", "author": {"login": "kamilwu"}, "path": "sdks/java/testing/nexmark/src/main/java/org/apache/beam/sdk/nexmark/Main.java", "diffHunk": "@@ -255,7 +255,9 @@ private static String produceMeasurement(\n     schemaResults.put(\"timestamp\", timestamp);\n     schemaResults.put(\"runner\", runner);\n     schemaResults.put(\"measurement\", measurement);\n-    schemaResults.put(\"runtimeMs\", runtimeMs);\n+    schemaResults.put(\n+        \"runtimeMs\",\n+        runtimeMs + \"i\"); // we need to add 'i' suffix since influx default type is float", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7075133afa152ff0d1609e77a4dd94784ae799f5"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7075133afa152ff0d1609e77a4dd94784ae799f5", "author": {"user": {"login": "pawelpasterz", "name": null}}, "url": "https://github.com/apache/beam/commit/7075133afa152ff0d1609e77a4dd94784ae799f5", "committedDate": "2020-06-26T12:33:34Z", "message": "[BEAM-8133] Update influx db publisher"}, "afterCommit": {"oid": "faa50b2efe0ed8fcdce55d54c8a362c8d5b3533d", "author": {"user": {"login": "pawelpasterz", "name": null}}, "url": "https://github.com/apache/beam/commit/faa50b2efe0ed8fcdce55d54c8a362c8d5b3533d", "committedDate": "2020-06-26T13:09:00Z", "message": "[BEAM-8133] Update influx db publisher"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MjgxMjc0", "url": "https://github.com/apache/beam/pull/12102#pullrequestreview-438281274", "createdAt": "2020-06-26T13:10:21Z", "commit": {"oid": "7075133afa152ff0d1609e77a4dd94784ae799f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMzoxMDo0MVrOGpgS9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxMzoxMDo0MVrOGpgS9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjE3Mzk0MA==", "bodyText": "If you want to make it even more secure and resilient, you can check what's the value of Content-Type header. For JSON, it must be application/json. Some HTTP libraries has convenient methods for doing that.", "url": "https://github.com/apache/beam/pull/12102#discussion_r446173940", "createdAt": "2020-06-26T13:10:41Z", "author": {"login": "kamilwu"}, "path": "sdks/java/testing/test-utils/src/main/java/org/apache/beam/sdk/testutils/publishing/InfluxDBPublisher.java", "diffHunk": "@@ -146,16 +157,29 @@ private static HttpPost providePOSTRequest(final InfluxDBSettings settings) {\n   private static void executeWithVerification(\n       final HttpPost postRequest, final HttpClientBuilder builder) throws IOException {\n     try (final CloseableHttpResponse response = builder.build().execute(postRequest)) {\n-      is2xx(response.getStatusLine().getStatusCode());\n+      is2xx(response);\n     }\n   }\n \n-  private static void is2xx(final int code) throws IOException {\n+  private static void is2xx(final HttpResponse response) throws IOException {\n+    final int code = response.getStatusLine().getStatusCode();\n     if (code < 200 || code >= 300) {\n-      throw new IOException(\"Response code: \" + code);\n+      throw new IOException(\n+          \"Response code: \" + code + \". Reason: \" + getErrorMessage(response.getEntity()));\n     }\n   }\n \n+  private static String getErrorMessage(final HttpEntity entity) throws IOException {\n+    final Header encodingHeader = entity.getContentEncoding();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faa50b2efe0ed8fcdce55d54c8a362c8d5b3533d"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MzU3NTE5", "url": "https://github.com/apache/beam/pull/12102#pullrequestreview-438357519", "createdAt": "2020-06-26T14:46:50Z", "commit": {"oid": "faa50b2efe0ed8fcdce55d54c8a362c8d5b3533d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNDo0Njo1MFrOGpjr1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNDo0Njo1MFrOGpjr1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIyOTQ2Mg==", "bodyText": "We should do the same for numResults. Now the schema that is being created is:\nfieldKey   fieldType\n--------   ---------\nnumResults float\nruntimeMs  integer\n\nAnd we need numResults as an integer too. I'm sorry I didn't notice that earlier.", "url": "https://github.com/apache/beam/pull/12102#discussion_r446229462", "createdAt": "2020-06-26T14:46:50Z", "author": {"login": "kamilwu"}, "path": "sdks/java/testing/nexmark/src/main/java/org/apache/beam/sdk/nexmark/Main.java", "diffHunk": "@@ -255,7 +255,11 @@ private static String produceMeasurement(\n     schemaResults.put(\"timestamp\", timestamp);\n     schemaResults.put(\"runner\", runner);\n     schemaResults.put(\"measurement\", measurement);\n-    schemaResults.put(\"runtimeMs\", runtimeMs);\n+    schemaResults.put(\n+        \"runtimeMs\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "faa50b2efe0ed8fcdce55d54c8a362c8d5b3533d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4453d3189bb7e834a6405d3a1fe70118dfd3f32d", "author": {"user": {"login": "pawelpasterz", "name": null}}, "url": "https://github.com/apache/beam/commit/4453d3189bb7e834a6405d3a1fe70118dfd3f32d", "committedDate": "2020-06-29T04:45:11Z", "message": "[BEAM-8133] Update influx db publisher"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "faa50b2efe0ed8fcdce55d54c8a362c8d5b3533d", "author": {"user": {"login": "pawelpasterz", "name": null}}, "url": "https://github.com/apache/beam/commit/faa50b2efe0ed8fcdce55d54c8a362c8d5b3533d", "committedDate": "2020-06-26T13:09:00Z", "message": "[BEAM-8133] Update influx db publisher"}, "afterCommit": {"oid": "4453d3189bb7e834a6405d3a1fe70118dfd3f32d", "author": {"user": {"login": "pawelpasterz", "name": null}}, "url": "https://github.com/apache/beam/commit/4453d3189bb7e834a6405d3a1fe70118dfd3f32d", "committedDate": "2020-06-29T04:45:11Z", "message": "[BEAM-8133] Update influx db publisher"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3160, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}