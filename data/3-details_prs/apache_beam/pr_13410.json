{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MTExMjE4", "number": 13410, "title": "[BEAM-11327] Replace Charset.defaultCharset() with StandardCharsets.UTF_8", "bodyText": "Please add a meaningful description for your change here\nReplace Charset.defaultCharset() with StandardCharsets.UTF_8 so that reliance on encoding set in locale is not used.\nThe defaultCharset() method relies on underlying OS system default.\nFiles that are NOT test files that are being changed:\n\nrunners/flink/src/main/java/org/apache/beam/runners/flink/FlinkPortableClientEntryPoint.java\nrunners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java\nsdks/java/core/src/main/java/org/apache/beam/sdk/schemas/utils/AvroUtils.java\nsdks/java/extensions/google-cloud-platform-core/src/main/java/org/apache/beam/sdk/extensions/gcp/util/GceMetadataUtil.java\nsdks/java/io/snowflake/src/main/java/org/apache/beam/sdk/io/snowflake/KeyPairUtils.java\nsdks/java/io/snowflake/src/main/java/org/apache/beam/sdk/io/snowflake/crosslanguage/ReadBuilder.java\nsdks/java/io/snowflake/src/main/java/org/apache/beam/sdk/io/snowflake/services/SnowflakeBatchServiceImpl.java\n\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-11-24T01:23:34Z", "url": "https://github.com/apache/beam/pull/13410", "merged": true, "mergeCommit": {"oid": "d2f76f9ad78f2d54f6aa78649a7aee8717ea9944"}, "closed": true, "closedAt": "2021-01-08T10:48:58Z", "author": {"login": "omarismail94"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdffVrCgH2gAyNTI2MTExMjE4OjMyZDE1ZWM1MWRjOGY4ODEzMTRiMjVhNzQwMjA4OGYyMzQ5ODdlODk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABduGcpGAFqTU2NDE2Nzk0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89", "author": {"user": {"login": "omarismail94", "name": "Omar Ismail"}}, "url": "https://github.com/apache/beam/commit/32d15ec51dc8f881314b25a7402088f234987e89", "committedDate": "2020-11-24T01:19:37Z", "message": "[BEAM-11327] Replace Charset.defaultCharset() with StandardCharsets.UTF_8"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3MDI5MTE2", "url": "https://github.com/apache/beam/pull/13410#pullrequestreview-537029116", "createdAt": "2020-11-24T02:26:53Z", "commit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMjoyNjo1NFrOH4o78w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwMjoyNjo1NFrOH4o78w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE1MzAxMQ==", "bodyText": "@scwhittle I was wondering if you could comment on this since you added this line in #11096. Do you know if this change is safe? Is there a reason this needs to use defaultCharset?\nAs it is, testLogRawBytes below can fail if the system encoding isn't UTF-8", "url": "https://github.com/apache/beam/pull/13410#discussion_r529153011", "createdAt": "2020-11-24T02:26:54Z", "author": {"login": "TheNeuralBit"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -86,7 +86,7 @@ public void write(int i) throws IOException {\n       this.logger = Logger.getLogger(loggerName);\n       this.buffer = new StringBuilder();\n       this.decoder =\n-          Charset.defaultCharset()\n+          StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32d15ec51dc8f881314b25a7402088f234987e89"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a14bd548bb647a87921f7ee87f72bfddeffbce33", "author": {"user": {"login": "omarismail94", "name": "Omar Ismail"}}, "url": "https://github.com/apache/beam/commit/a14bd548bb647a87921f7ee87f72bfddeffbce33", "committedDate": "2021-01-03T00:35:49Z", "message": "[BEAM-11327] Replace Charset.defaultCharset() with StandardCharsets.UTF_8"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49bb55b80476ae4d0e7dc2442d4bc0e6e67309d0", "author": {"user": {"login": "omarismail94", "name": "Omar Ismail"}}, "url": "https://github.com/apache/beam/commit/49bb55b80476ae4d0e7dc2442d4bc0e6e67309d0", "committedDate": "2021-01-03T00:37:36Z", "message": "[BEAM-11327] Replace Charset.defaultCharset() with StandardCharsets.UTF_8"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f19467a8007d6f5817c89cf175a66e07aa4bdd8d", "author": {"user": {"login": "omarismail94", "name": "Omar Ismail"}}, "url": "https://github.com/apache/beam/commit/f19467a8007d6f5817c89cf175a66e07aa4bdd8d", "committedDate": "2021-01-03T00:40:55Z", "message": "[BEAM-11327] Replace Charset.defaultCharset() with StandardCharsets.UTF_8"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwODgwMzQx", "url": "https://github.com/apache/beam/pull/13410#pullrequestreview-560880341", "createdAt": "2021-01-04T09:23:40Z", "commit": {"oid": "f19467a8007d6f5817c89cf175a66e07aa4bdd8d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwOToyMzo0MFrOINqe8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQwOToyMzo0MFrOINqe8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTE5ODQ1MA==", "bodyText": "nit: ultra minor (you can ignore me but good if changed) s/ForbidCharset/ForbidDefaultCharset", "url": "https://github.com/apache/beam/pull/13410#discussion_r551198450", "createdAt": "2021-01-04T09:23:40Z", "author": {"login": "iemejia"}, "path": "sdks/java/build-tools/src/main/resources/beam/checkstyle.xml", "diffHunk": "@@ -119,6 +119,14 @@ page at http://checkstyle.sourceforge.net/config.html -->\n       <property name=\"message\" value=\"You are using raw guava, please use vendored guava classes.\"/>\n     </module>\n \n+    <!-- Forbid use of Charset.defaultCharset()-->\n+    <module name=\"RegexpSinglelineJava\">\n+      <property name=\"id\" value=\"ForbidCharset\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f19467a8007d6f5817c89cf175a66e07aa4bdd8d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a7823fe84b32a25193c8b47373a2452e2b5fe2c", "author": {"user": {"login": "omarismail94", "name": "Omar Ismail"}}, "url": "https://github.com/apache/beam/commit/4a7823fe84b32a25193c8b47373a2452e2b5fe2c", "committedDate": "2021-01-04T18:13:22Z", "message": "[BEAM-11327] Replace Charset.defaultCharset() with StandardCharsets.UTF_8"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyMDEyNTI2", "url": "https://github.com/apache/beam/pull/13410#pullrequestreview-562012526", "createdAt": "2021-01-05T18:03:55Z", "commit": {"oid": "4a7823fe84b32a25193c8b47373a2452e2b5fe2c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxODowMzo1NVrOIOhkyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxODowMzo1NVrOIOhkyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjEwMTA2NA==", "bodyText": "Shouldn't this be ForbidDefaultCharset?", "url": "https://github.com/apache/beam/pull/13410#discussion_r552101064", "createdAt": "2021-01-05T18:03:55Z", "author": {"login": "TheNeuralBit"}, "path": "runners/google-cloud-dataflow-java/worker/src/main/java/org/apache/beam/runners/dataflow/worker/logging/JulHandlerPrintStreamAdapterFactory.java", "diffHunk": "@@ -69,6 +69,9 @@\n     private int carryOverBytes;\n     private byte[] carryOverByteArray;\n \n+    @SuppressWarnings({\n+      \"unchecked\" // [BEAM-11327] Replace Charset.defaultCharset() with StandardCharsets.UTF_8", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a7823fe84b32a25193c8b47373a2452e2b5fe2c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c934920ab307174e9f6778b46a72634e9079a06", "author": {"user": {"login": "omarismail94", "name": "Omar Ismail"}}, "url": "https://github.com/apache/beam/commit/2c934920ab307174e9f6778b46a72634e9079a06", "committedDate": "2021-01-05T18:16:05Z", "message": "[BEAM-11327] Replace Charset.defaultCharset() with StandardCharsets.UTF_8"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32aba3e6616e5cbcfe0434ac404492338094a09b", "author": {"user": {"login": "omarismail94", "name": "Omar Ismail"}}, "url": "https://github.com/apache/beam/commit/32aba3e6616e5cbcfe0434ac404492338094a09b", "committedDate": "2021-01-06T05:18:01Z", "message": "[BEAM-11327] Replace Charset.defaultCharset() with StandardCharsets.UTF_8"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e3ef68bfa050f12bf13734b028edad5ce1b3f87", "author": {"user": {"login": "omarismail94", "name": "Omar Ismail"}}, "url": "https://github.com/apache/beam/commit/3e3ef68bfa050f12bf13734b028edad5ce1b3f87", "committedDate": "2021-01-06T05:22:06Z", "message": "[BEAM-11327] Replace Charset.defaultCharset() with StandardCharsets.UTF_8"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0MTY3OTQ2", "url": "https://github.com/apache/beam/pull/13410#pullrequestreview-564167946", "createdAt": "2021-01-08T10:48:28Z", "commit": {"oid": "3e3ef68bfa050f12bf13734b028edad5ce1b3f87"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4534, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}