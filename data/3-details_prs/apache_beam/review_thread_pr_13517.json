{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1NTY4NDM0", "number": 13517, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxOTo1ODozM1rOFEKKpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMzowNzozMFrOFF2Y6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5OTA1MTg4OnYy", "diffSide": "RIGHT", "path": ".test-infra/jenkins/job_Publish_SDK_Image_Snapshots.groovy", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxOTo1ODozM1rOIEJtyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxOTo1ODozM1rOIEJtyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIyNDM5Mg==", "bodyText": "awesome, I didn't know this existed! thanks", "url": "https://github.com/apache/beam/pull/13517#discussion_r541224392", "createdAt": "2020-12-11T19:58:33Z", "author": {"login": "emilymye"}, "path": ".test-infra/jenkins/job_Publish_SDK_Image_Snapshots.groovy", "diffHunk": "@@ -41,12 +41,12 @@ job('beam_Publish_Beam_SDK_Snapshots') {\n     gradle {\n       rootBuildScriptDir(commonJobProperties.checkoutDir)\n       commonJobProperties.setGradleSwitches(delegate)\n-      tasks(':sdks:go:container:dockerPush')\n+      tasks(':sdks:go:container:dockerTagPush')\n       SUPPORTED_JAVA_CONTAINER_TASKS.each { taskVer ->\n-        tasks(\":sdks:java:container:${taskVer}:dockerPush\")\n+        tasks(\":sdks:java:container:${taskVer}:dockerTagPush\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b92966ff6159b713b6548778f457cd1b1c43400d"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5OTA3MTc3OnYy", "diffSide": "RIGHT", "path": "sdks/go/container/build.gradle", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMDowMjowOVrOIEJ6iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMDozODo1NVrOIFnRSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIyNzY1Nw==", "bodyText": "By default this will always push latest tag, which I'm not sure we actually want to force. Would it be better to make docker-tag a comma-separated string list parameter and use split? That way we can also allow people to push more than one tag that isn't just latest.", "url": "https://github.com/apache/beam/pull/13517#discussion_r541227657", "createdAt": "2020-12-11T20:02:09Z", "author": {"login": "emilymye"}, "path": "sdks/go/container/build.gradle", "diffHunk": "@@ -47,12 +47,14 @@ golang {\n   }\n }\n \n+def defaultTag = project.rootProject.hasProperty([\"docker-tag\"]) ? [project.rootProject[\"docker-tag\"], 'latest'] : ['latest']", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b92966ff6159b713b6548778f457cd1b1c43400d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM0MjM3NQ==", "bodyText": "Thanks for the comment.\n\nBy default this will always push latest tag, which I'm not sure we actually want to force.\n\nFYI, 'latest' tag is only attached when we use dockerTagPush command (not dockerPush).\nIf we allow a comma-separated string in docker-tag, it will break docker task. docker and dockerTag are different commands where docker command only works with the tag specified by docker-tag property but dockerTag command respects the list of tags in tags.\nWe should define a separate property something like docker-aux-tag (or docker-secondary-tag) and set docker-tag + docker-aux-tag for tags to let users append their own tags. Do you want to go with this option?", "url": "https://github.com/apache/beam/pull/13517#discussion_r541342375", "createdAt": "2020-12-11T22:02:58Z", "author": {"login": "ihji"}, "path": "sdks/go/container/build.gradle", "diffHunk": "@@ -47,12 +47,14 @@ golang {\n   }\n }\n \n+def defaultTag = project.rootProject.hasProperty([\"docker-tag\"]) ? [project.rootProject[\"docker-tag\"], 'latest'] : ['latest']", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIyNzY1Nw=="}, "originalCommit": {"oid": "b92966ff6159b713b6548778f457cd1b1c43400d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM0NjI5Mg==", "bodyText": "ah, I see. Would it work to just ignore docker-tag for dockerTagPush and just use one flag like docker-tags or docker-tag-list? Mostly I don't quite like the idea of splitting the tag flag - if docker-tags isn't given, we can just construct a list from docker-tag, or use [\"latest\"]?", "url": "https://github.com/apache/beam/pull/13517#discussion_r541346292", "createdAt": "2020-12-11T22:07:25Z", "author": {"login": "emilymye"}, "path": "sdks/go/container/build.gradle", "diffHunk": "@@ -47,12 +47,14 @@ golang {\n   }\n }\n \n+def defaultTag = project.rootProject.hasProperty([\"docker-tag\"]) ? [project.rootProject[\"docker-tag\"], 'latest'] : ['latest']", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIyNzY1Nw=="}, "originalCommit": {"oid": "b92966ff6159b713b6548778f457cd1b1c43400d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc1NzE5NA==", "bodyText": "Changed to getting from 'docker-tag-list' and generating the default value from 'docker-tag' if the first option is not available.", "url": "https://github.com/apache/beam/pull/13517#discussion_r542757194", "createdAt": "2020-12-14T20:38:55Z", "author": {"login": "ihji"}, "path": "sdks/go/container/build.gradle", "diffHunk": "@@ -47,12 +47,14 @@ golang {\n   }\n }\n \n+def defaultTag = project.rootProject.hasProperty([\"docker-tag\"]) ? [project.rootProject[\"docker-tag\"], 'latest'] : ['latest']", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTIyNzY1Nw=="}, "originalCommit": {"oid": "b92966ff6159b713b6548778f457cd1b1c43400d"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNjc2NjgxOnYy", "diffSide": "RIGHT", "path": "sdks/go/container/build.gradle", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMzowMjozOVrOIGj6Qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDo1ODo1MVrOIGm0aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MDcyMw==", "bodyText": "Can you add comments that say this property only gets used by dockerTagPush? I think it will be confusing otherwise.", "url": "https://github.com/apache/beam/pull/13517#discussion_r543750723", "createdAt": "2020-12-15T23:02:39Z", "author": {"login": "emilymye"}, "path": "sdks/go/container/build.gradle", "diffHunk": "@@ -53,6 +53,7 @@ docker {\n           root: project.rootProject.hasProperty([\"docker-repository-root\"]) ?\n                   project.rootProject[\"docker-repository-root\"] :\n                   project.docker_image_default_repo_root)\n+  tags containerImageTags()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfdd2ce8b735a5df94a68488c2b44d0e3646c038"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc5ODM3Nw==", "bodyText": "Done", "url": "https://github.com/apache/beam/pull/13517#discussion_r543798377", "createdAt": "2020-12-16T00:58:51Z", "author": {"login": "ihji"}, "path": "sdks/go/container/build.gradle", "diffHunk": "@@ -53,6 +53,7 @@ docker {\n           root: project.rootProject.hasProperty([\"docker-repository-root\"]) ?\n                   project.rootProject[\"docker-repository-root\"] :\n                   project.docker_image_default_repo_root)\n+  tags containerImageTags()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MDcyMw=="}, "originalCommit": {"oid": "cfdd2ce8b735a5df94a68488c2b44d0e3646c038"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNjc3MzQzOnYy", "diffSide": "RIGHT", "path": ".test-infra/jenkins/job_Publish_SDK_Image_Snapshots.groovy", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMzowNDo0NVrOIGj-DQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDo1OTowMlrOIGm0pQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MTY5Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  switches(\"-Pdocker-tag=${imageTag}\")\n          \n          \n            \n                  switches(\"-Pdocker-tag-list=${imageTag},latest\")", "url": "https://github.com/apache/beam/pull/13517#discussion_r543751693", "createdAt": "2020-12-15T23:04:45Z", "author": {"login": "emilymye"}, "path": ".test-infra/jenkins/job_Publish_SDK_Image_Snapshots.groovy", "diffHunk": "@@ -41,12 +41,12 @@ job('beam_Publish_Beam_SDK_Snapshots') {\n     gradle {\n       rootBuildScriptDir(commonJobProperties.checkoutDir)\n       commonJobProperties.setGradleSwitches(delegate)\n-      tasks(':sdks:go:container:dockerPush')\n+      tasks(':sdks:go:container:dockerTagPush')\n       SUPPORTED_JAVA_CONTAINER_TASKS.each { taskVer ->\n-        tasks(\":sdks:java:container:${taskVer}:dockerPush\")\n+        tasks(\":sdks:java:container:${taskVer}:dockerTagPush\")\n       }\n       SUPPORTED_PYTHON_CONTAINER_TASKS.each { taskVer ->\n-        tasks(\":sdks:python:container:${taskVer}:dockerPush\")\n+        tasks(\":sdks:python:container:${taskVer}:dockerTagPush\")\n       }\n       switches(\"-Pdocker-repository-root=${imageRepo}\")\n       switches(\"-Pdocker-tag=${imageTag}\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfdd2ce8b735a5df94a68488c2b44d0e3646c038"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc5ODQzNw==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/13517#discussion_r543798437", "createdAt": "2020-12-16T00:59:02Z", "author": {"login": "ihji"}, "path": ".test-infra/jenkins/job_Publish_SDK_Image_Snapshots.groovy", "diffHunk": "@@ -41,12 +41,12 @@ job('beam_Publish_Beam_SDK_Snapshots') {\n     gradle {\n       rootBuildScriptDir(commonJobProperties.checkoutDir)\n       commonJobProperties.setGradleSwitches(delegate)\n-      tasks(':sdks:go:container:dockerPush')\n+      tasks(':sdks:go:container:dockerTagPush')\n       SUPPORTED_JAVA_CONTAINER_TASKS.each { taskVer ->\n-        tasks(\":sdks:java:container:${taskVer}:dockerPush\")\n+        tasks(\":sdks:java:container:${taskVer}:dockerTagPush\")\n       }\n       SUPPORTED_PYTHON_CONTAINER_TASKS.each { taskVer ->\n-        tasks(\":sdks:python:container:${taskVer}:dockerPush\")\n+        tasks(\":sdks:python:container:${taskVer}:dockerTagPush\")\n       }\n       switches(\"-Pdocker-repository-root=${imageRepo}\")\n       switches(\"-Pdocker-tag=${imageTag}\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MTY5Mw=="}, "originalCommit": {"oid": "cfdd2ce8b735a5df94a68488c2b44d0e3646c038"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNjc4MzEzOnYy", "diffSide": "RIGHT", "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMzowNzozMFrOIGkDTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMDo1OToxOVrOIGm1Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MzAzNw==", "bodyText": "I'm not a huge fan of adding this default vs using tags = [project.rootProject[\"docker-tag\"]] and having a caller provide docker-tag-list=${sdk_version},latest. Is this specific to work you are planning?", "url": "https://github.com/apache/beam/pull/13517#discussion_r543753037", "createdAt": "2020-12-15T23:07:30Z", "author": {"login": "emilymye"}, "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy", "diffHunk": "@@ -1704,6 +1704,20 @@ class BeamModulePlugin implements Plugin<Project> {\n       return \"${configuration.root}/${configuration.name}:${configuration.tag}\"\n     }\n \n+    project.ext.containerImageTags = {\n+      String[] tags\n+      if (project.rootProject.hasProperty([\"docker-tag-list\"])) {\n+        tags = project.rootProject[\"docker-tag-list\"].split(',')\n+      } else {\n+        tags = [\n+          project.rootProject.hasProperty([\"docker-tag\"]) ?\n+          project.rootProject[\"docker-tag\"] : project.sdk_version,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfdd2ce8b735a5df94a68488c2b44d0e3646c038"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1Njk2Ng==", "bodyText": "We need to add some default anyway in case that docker-tag property is not given. Since we already use  project.sdk_version as a default for docker command, I choose the same default for dockerTag.", "url": "https://github.com/apache/beam/pull/13517#discussion_r543756966", "createdAt": "2020-12-15T23:16:22Z", "author": {"login": "ihji"}, "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy", "diffHunk": "@@ -1704,6 +1704,20 @@ class BeamModulePlugin implements Plugin<Project> {\n       return \"${configuration.root}/${configuration.name}:${configuration.tag}\"\n     }\n \n+    project.ext.containerImageTags = {\n+      String[] tags\n+      if (project.rootProject.hasProperty([\"docker-tag-list\"])) {\n+        tags = project.rootProject[\"docker-tag-list\"].split(',')\n+      } else {\n+        tags = [\n+          project.rootProject.hasProperty([\"docker-tag\"]) ?\n+          project.rootProject[\"docker-tag\"] : project.sdk_version,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MzAzNw=="}, "originalCommit": {"oid": "cfdd2ce8b735a5df94a68488c2b44d0e3646c038"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc4MTcwMw==", "bodyText": "oh, I see - I thought I hadn't seen it in the existing files but I only looked at the golang task. Can we do just the sdk_version tag then?", "url": "https://github.com/apache/beam/pull/13517#discussion_r543781703", "createdAt": "2020-12-16T00:15:43Z", "author": {"login": "emilymye"}, "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy", "diffHunk": "@@ -1704,6 +1704,20 @@ class BeamModulePlugin implements Plugin<Project> {\n       return \"${configuration.root}/${configuration.name}:${configuration.tag}\"\n     }\n \n+    project.ext.containerImageTags = {\n+      String[] tags\n+      if (project.rootProject.hasProperty([\"docker-tag-list\"])) {\n+        tags = project.rootProject[\"docker-tag-list\"].split(',')\n+      } else {\n+        tags = [\n+          project.rootProject.hasProperty([\"docker-tag\"]) ?\n+          project.rootProject[\"docker-tag\"] : project.sdk_version,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MzAzNw=="}, "originalCommit": {"oid": "cfdd2ce8b735a5df94a68488c2b44d0e3646c038"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc5ODU1OA==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/13517#discussion_r543798558", "createdAt": "2020-12-16T00:59:19Z", "author": {"login": "ihji"}, "path": "buildSrc/src/main/groovy/org/apache/beam/gradle/BeamModulePlugin.groovy", "diffHunk": "@@ -1704,6 +1704,20 @@ class BeamModulePlugin implements Plugin<Project> {\n       return \"${configuration.root}/${configuration.name}:${configuration.tag}\"\n     }\n \n+    project.ext.containerImageTags = {\n+      String[] tags\n+      if (project.rootProject.hasProperty([\"docker-tag-list\"])) {\n+        tags = project.rootProject[\"docker-tag-list\"].split(',')\n+      } else {\n+        tags = [\n+          project.rootProject.hasProperty([\"docker-tag\"]) ?\n+          project.rootProject[\"docker-tag\"] : project.sdk_version,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MzAzNw=="}, "originalCommit": {"oid": "cfdd2ce8b735a5df94a68488c2b44d0e3646c038"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2549, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}