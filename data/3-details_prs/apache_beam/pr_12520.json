{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY1NzY2NTM3", "number": 12520, "title": "[BEAM-10677] Fix @SchemaFieldName in AutoValueSchema", "bodyText": "Post-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-08-10T22:39:36Z", "url": "https://github.com/apache/beam/pull/12520", "merged": true, "mergeCommit": {"oid": "db4e126d6d4a38f5cfe57345c2178d893a7baae6"}, "closed": true, "closedAt": "2020-09-30T00:17:14Z", "author": {"login": "TheNeuralBit"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9qFymAH2gAyNDY1NzY2NTM3OjAzMmM2YzhjODdiYmI2MGM0YjI3YmVjMjhjNjBiNTM5MGMzNTNlM2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNcWQRAFqTQ5Nzk2ODc0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "032c6c8c87bbb60c4b27bec28c60b5390c353e3b", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/032c6c8c87bbb60c4b27bec28c60b5390c353e3b", "committedDate": "2020-08-10T22:37:48Z", "message": "Add test for SchemaFieldName in AutoValue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "690f0643ee58d35d572e56069ec230f7db085d90", "author": {"user": {"login": "TheNeuralBit", "name": "Brian Hulette"}}, "url": "https://github.com/apache/beam/commit/690f0643ee58d35d572e56069ec230f7db085d90", "committedDate": "2020-08-10T22:37:48Z", "message": "Fix bugs with SchemaFieldName"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NjM1NTI4", "url": "https://github.com/apache/beam/pull/12520#pullrequestreview-464635528", "createdAt": "2020-08-10T22:40:34Z", "commit": {"oid": "690f0643ee58d35d572e56069ec230f7db085d90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMjo0MDozNFrOG-iMGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQyMjo0MDozNFrOG-iMGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODIyNTA0OA==", "bodyText": "I'm not quite sure what the old logic was trying to verify. Now this verifies that every constructor parameter corresponds to a schema field.", "url": "https://github.com/apache/beam/pull/12520#discussion_r468225048", "createdAt": "2020-08-10T22:40:34Z", "author": {"login": "TheNeuralBit"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/schemas/utils/AutoValueUtils.java", "diffHunk": "@@ -139,11 +139,15 @@ private static boolean matchConstructor(\n                 Collectors.toMap(\n                     f -> ReflectUtils.stripGetterPrefix(f.getMethod().getName()),\n                     Function.identity()));\n-    for (FieldValueTypeInformation type : getterTypes) {\n-      if (typeMap.get(type.getName()) == null) {\n+\n+    // Verify that constructor parameters match (name and type) the inferred schema.\n+    for (Parameter parameter : constructor.getParameters()) {\n+      FieldValueTypeInformation type = typeMap.getOrDefault(parameter.getName(), null);\n+      if (type == null || type.getRawType() != parameter.getType()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "690f0643ee58d35d572e56069ec230f7db085d90"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTY4NzQ4", "url": "https://github.com/apache/beam/pull/12520#pullrequestreview-497968748", "createdAt": "2020-09-28T23:39:54Z", "commit": {"oid": "690f0643ee58d35d572e56069ec230f7db085d90"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3439, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}