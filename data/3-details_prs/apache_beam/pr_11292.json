{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3Njk4NDU4", "number": 11292, "title": "[BEAM-9674] Don't specify selected fields when fetching BigQuery table size", "bodyText": "Don't specify the list of selected fields when making a tables.get call to fetch the table size in the BigQueryStorageTableSource in order to avoid \"selected fields too long\" errors from the server. The selected field list is not used by the tables.get API to compute the table size.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-04-02T16:55:19Z", "url": "https://github.com/apache/beam/pull/11292", "merged": true, "mergeCommit": {"oid": "a1b79fdc995c869d1f32fab2e2004621b2d53988"}, "closed": true, "closedAt": "2020-04-17T14:37:23Z", "author": {"login": "kmjung"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTeNGLAH2gAyMzk3Njk4NDU4OjRmMTVkN2U1MjIxMWNmMWRjMDhiZDM2YjdmY2Y2YmQxMDAzZmYzZWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX-D6uAFqTM5NDEwMTkxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4f15d7e52211cf1dc08bd36b7fcf6bd1003ff3ef", "author": {"user": null}, "url": "https://github.com/apache/beam/commit/4f15d7e52211cf1dc08bd36b7fcf6bd1003ff3ef", "committedDate": "2020-04-01T21:02:06Z", "message": "Don't specify selected fields when fetching BigQuery table size"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NzA5NjQy", "url": "https://github.com/apache/beam/pull/11292#pullrequestreview-388709642", "createdAt": "2020-04-07T00:33:26Z", "commit": {"oid": "4f15d7e52211cf1dc08bd36b7fcf6bd1003ff3ef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMDozMzoyNlrOGBuzeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwMDozMzoyNlrOGBuzeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ2ODYwMA==", "bodyText": "Is this removing a public API?", "url": "https://github.com/apache/beam/pull/11292#discussion_r404468600", "createdAt": "2020-04-07T00:33:26Z", "author": {"login": "aaltay"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryServices.java", "diffHunk": "@@ -101,10 +101,6 @@ JobStatistics dryRunQuery(String projectId, JobConfigurationQuery queryConfig, S\n     @Nullable\n     Table getTable(TableReference tableRef) throws InterruptedException, IOException;\n \n-    @Nullable", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f15d7e52211cf1dc08bd36b7fcf6bd1003ff3ef"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69810b4ad50a5d2abdd98b0b0b28cb800cc5759b", "author": {"user": {"login": "kmjung", "name": "Kenneth Jung"}}, "url": "https://github.com/apache/beam/commit/69810b4ad50a5d2abdd98b0b0b28cb800cc5759b", "committedDate": "2020-04-07T17:48:25Z", "message": "Revert \"Don't specify selected fields when fetching BigQuery table size\"\n\nThis reverts commit 4f15d7e52211cf1dc08bd36b7fcf6bd1003ff3ef."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20aee714aa9a51319ec39c10f4404c5d0994648b", "author": {"user": {"login": "kmjung", "name": "Kenneth Jung"}}, "url": "https://github.com/apache/beam/commit/20aee714aa9a51319ec39c10f4404c5d0994648b", "committedDate": "2020-04-08T19:03:12Z", "message": "Add Avro utils functionality to trim BigQuery schemas"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MTAxOTEw", "url": "https://github.com/apache/beam/pull/11292#pullrequestreview-394101910", "createdAt": "2020-04-15T20:14:53Z", "commit": {"oid": "20aee714aa9a51319ec39c10f4404c5d0994648b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMDoxNDo1M1rOGGJ6Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMDoyNDoyOVrOGGKNTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEwNzAyNg==", "bodyText": "Not sure how this trims the schema ? Does readSession.getAvroSchema() somehow has a smaller number of fields than targetTable.getSchema() ?", "url": "https://github.com/apache/beam/pull/11292#discussion_r409107026", "createdAt": "2020-04-15T20:14:53Z", "author": {"login": "chamikaramj"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryStorageSourceBase.java", "diffHunk": "@@ -149,11 +151,14 @@\n       return ImmutableList.of();\n     }\n \n+    Schema sessionSchema = new Schema.Parser().parse(readSession.getAvroSchema().getSchema());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20aee714aa9a51319ec39c10f4404c5d0994648b"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTExMTg4Ng==", "bodyText": "Is this a feature regression for the storage API based read path ?", "url": "https://github.com/apache/beam/pull/11292#discussion_r409111886", "createdAt": "2020-04-15T20:24:29Z", "author": {"login": "chamikaramj"}, "path": "sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryIOStorageReadTest.java", "diffHunk": "@@ -1368,19 +1368,14 @@ public void testStreamSourceSplitAtFractionFailsWhenParentIsPastSplitPoint() thr\n   public void testReadFromBigQueryIO() throws Exception {\n     fakeDatasetService.createDataset(\"foo.com:project\", \"dataset\", \"\", \"\", null);\n     TableReference tableRef = BigQueryHelpers.parseTableSpec(\"foo.com:project:dataset.table\");\n-\n-    Table table =\n-        new Table().setTableReference(tableRef).setNumBytes(10L).setSchema(new TableSchema());\n-\n+    Table table = new Table().setTableReference(tableRef).setNumBytes(10L).setSchema(TABLE_SCHEMA);\n     fakeDatasetService.createTable(table);\n \n     CreateReadSessionRequest expectedCreateReadSessionRequest =\n         CreateReadSessionRequest.newBuilder()\n             .setParent(\"projects/project-id\")\n             .setTableReference(BigQueryHelpers.toTableRefProto(tableRef))\n             .setRequestedStreams(10)\n-            .setReadOptions(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20aee714aa9a51319ec39c10f4404c5d0994648b"}, "originalPosition": 209}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4879, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}