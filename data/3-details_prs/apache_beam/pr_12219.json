{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3NTgzNzY1", "number": 12219, "title": "Refactor time functions test out of giant ZetaSqlDialectSpecTest", "bodyText": "Refactor test code for DATE/TIME/DATETIME/TIMESTAMP functions out of ZetaSqlDialectSpecTest since it has grown too big. We can also do this for other categories of functions (e.g String/Bytes functions) in the future.\nAlso cleaned up the code a bit. No functional change, other than turning on previously ignored test testTimeAddWithParameters which is now working.\nr: @apilloud @ibzib (Consider factoring out UDF tests as well? I think technically they are an extension to ZetaSQL dialect, similar to StreamingSqlTest)\ncc: @ZijieSong946\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n---\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-07-10T18:27:22Z", "url": "https://github.com/apache/beam/pull/12219", "merged": true, "mergeCommit": {"oid": "fb21fe22746982bcf5f87b88b5ef8931d3bb5462"}, "closed": true, "closedAt": "2020-07-10T22:04:24Z", "author": {"login": "robinyqiu"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcznxf7gH2gAyNDQ3NTgzNzY1OmUwMGJhNDQyN2QwY2JlODFhYzgyMjk1M2I0MzMwODljZjE4MTQwZDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczqUdngFqTQ0NjcwNDU5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e00ba4427d0cbe81ac822953b433089cf18140d3", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/e00ba4427d0cbe81ac822953b433089cf18140d3", "committedDate": "2020-07-10T18:16:35Z", "message": "Refactor time functions test out of giant ZetaSqlDialectSpecTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NjgyOTYw", "url": "https://github.com/apache/beam/pull/12219#pullrequestreview-446682960", "createdAt": "2020-07-10T20:29:22Z", "commit": {"oid": "e00ba4427d0cbe81ac822953b433089cf18140d3"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMDoyOToyMlrOGwEw_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMDozOToxNVrOGwE_Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA2MjkxMA==", "bodyText": "It looks like there are several other classes named ZetaSQL.... I filed BEAM-10457 for cleanup.", "url": "https://github.com/apache/beam/pull/12219#discussion_r453062910", "createdAt": "2020-07-10T20:29:22Z", "author": {"login": "ibzib"}, "path": "sdks/java/build-tools/src/main/resources/beam/suppressions.xml", "diffHunk": "@@ -99,7 +99,8 @@\n   <suppress id=\"ForbidNonVendoredGrpcProtobuf\" files=\".*extensions.*sql.*datastore.*\" />\n   <suppress id=\"ForbidNonVendoredGrpcProtobuf\" files=\".*zetasql.*DateTimeUtils\\.java\" />\n   <suppress id=\"ForbidNonVendoredGrpcProtobuf\" files=\".*zetasql.*ZetaSqlBeamTranslationUtils\\.java\" />\n-  <suppress id=\"ForbidNonVendoredGrpcProtobuf\" files=\".*zetasql.*ZetaSQLDialectSpecTest\\.java\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e00ba4427d0cbe81ac822953b433089cf18140d3"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA2NDU2NA==", "bodyText": "Can you explain the scope of this test class in the Javadoc comment? i.e. list the types covered (DATE, TIME, ...)", "url": "https://github.com/apache/beam/pull/12219#discussion_r453064564", "createdAt": "2020-07-10T20:33:50Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/zetasql/src/test/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSqlTimeFunctionsTest.java", "diffHunk": "@@ -0,0 +1,1214 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.extensions.sql.zetasql;\n+\n+import static org.apache.beam.sdk.extensions.sql.zetasql.DateTimeUtils.parseDateToValue;\n+import static org.apache.beam.sdk.extensions.sql.zetasql.DateTimeUtils.parseTimeToValue;\n+import static org.apache.beam.sdk.extensions.sql.zetasql.DateTimeUtils.parseTimestampWithTZToValue;\n+import static org.apache.beam.sdk.extensions.sql.zetasql.DateTimeUtils.parseTimestampWithTimeZone;\n+import static org.apache.beam.sdk.extensions.sql.zetasql.DateTimeUtils.parseTimestampWithUTCTimeZone;\n+\n+import com.google.zetasql.SqlException;\n+import com.google.zetasql.Value;\n+import com.google.zetasql.ZetaSQLType.TypeKind;\n+import java.time.LocalDate;\n+import java.time.LocalTime;\n+import org.apache.beam.sdk.extensions.sql.impl.BeamSqlPipelineOptions;\n+import org.apache.beam.sdk.extensions.sql.impl.rel.BeamRelNode;\n+import org.apache.beam.sdk.extensions.sql.impl.rel.BeamSqlRelUtils;\n+import org.apache.beam.sdk.schemas.Schema;\n+import org.apache.beam.sdk.schemas.Schema.FieldType;\n+import org.apache.beam.sdk.schemas.logicaltypes.SqlTypes;\n+import org.apache.beam.sdk.testing.PAssert;\n+import org.apache.beam.sdk.testing.TestPipeline;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.Row;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+import org.joda.time.Duration;\n+import org.junit.Before;\n+import org.junit.Ignore;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.ExpectedException;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.JUnit4;\n+\n+/** ZetaSqlTimeFunctionsTest. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e00ba4427d0cbe81ac822953b433089cf18140d3"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA2NjU3OQ==", "bodyText": "I know it isn't new, but this comment should be more descriptive. (Maybe Tests for ZetaSQL windowing functions (TUMBLE, HOP, and SESSION).)", "url": "https://github.com/apache/beam/pull/12219#discussion_r453066579", "createdAt": "2020-07-10T20:39:15Z", "author": {"login": "ibzib"}, "path": "sdks/java/extensions/sql/zetasql/src/test/java/org/apache/beam/sdk/extensions/sql/zetasql/StreamingSqlTest.java", "diffHunk": "@@ -39,16 +39,15 @@\n import org.junit.runner.RunWith;\n import org.junit.runners.JUnit4;\n \n-/** StreamingSQLTest. */\n+/** StreamingSqlTest. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e00ba4427d0cbe81ac822953b433089cf18140d3"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3cd4736160a4619c7a7b860e2f6c52e192a245c", "author": {"user": {"login": "robinyqiu", "name": "Yueyang Qiu"}}, "url": "https://github.com/apache/beam/commit/a3cd4736160a4619c7a7b860e2f6c52e192a245c", "committedDate": "2020-07-10T21:12:34Z", "message": "Update javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NzA0NTkz", "url": "https://github.com/apache/beam/pull/12219#pullrequestreview-446704593", "createdAt": "2020-07-10T21:14:35Z", "commit": {"oid": "a3cd4736160a4619c7a7b860e2f6c52e192a245c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4038, "cost": 1, "resetAt": "2021-10-28T18:00:02Z"}}}