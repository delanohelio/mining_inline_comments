{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3OTk2MTI3", "number": 11126, "title": "[BEAM-9430, BEAM-2939] Migrate from ProcessContext#updateWatermark to WatermarkEstimators", "bodyText": "This removes the ProcessContext#updateWatermark and updates all existing usages to use the WatermarkEstimators and also updates all the backing code that supplied the functionality to use the WatermarkEstimators as their source of truth.\nThe watermark estimator state has become a part of the \"restriction\". In non-portable pipelines this only appears during processing and hence is stored in state while in portable pipelines we get the watermark estimator state when we get the initial restriction and plumb it through the the split restriction to be used as the initial watermark estimator state within the various process element and restriction methods.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-03-13T21:24:38Z", "url": "https://github.com/apache/beam/pull/11126", "merged": true, "mergeCommit": {"oid": "4743e131edadad42555e605be803e26cb37b7ce6"}, "closed": true, "closedAt": "2020-03-19T16:58:32Z", "author": {"login": "lukecwik"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOoroggBqjMxMzg5MzAzMTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPOWjVgFqTM3Nzg3MzY2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "792ee838c84822439c4e3e857a6c494c627e582c", "author": {"user": {"login": "lukecwik", "name": "Lukasz Cwik"}}, "url": "https://github.com/apache/beam/commit/792ee838c84822439c4e3e857a6c494c627e582c", "committedDate": "2020-03-17T20:10:59Z", "message": "fixup! Fix type parameters specified for ProcessFn and update FnApiDoFnRunner to populate watermarks"}, "afterCommit": {"oid": "dc9eb5aac2b0c7a9619663af13cc8d79037a842f", "author": {"user": {"login": "lukecwik", "name": "Lukasz Cwik"}}, "url": "https://github.com/apache/beam/commit/dc9eb5aac2b0c7a9619663af13cc8d79037a842f", "committedDate": "2020-03-17T20:24:41Z", "message": "[BEAM-9430] Migrate from ProcessContext#updateWatermark to WatermarkEstimators"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc9eb5aac2b0c7a9619663af13cc8d79037a842f", "author": {"user": {"login": "lukecwik", "name": "Lukasz Cwik"}}, "url": "https://github.com/apache/beam/commit/dc9eb5aac2b0c7a9619663af13cc8d79037a842f", "committedDate": "2020-03-17T20:24:41Z", "message": "[BEAM-9430] Migrate from ProcessContext#updateWatermark to WatermarkEstimators"}, "afterCommit": {"oid": "f327684122abf475160e1ed275e7e3d9e99774f9", "author": {"user": {"login": "lukecwik", "name": "Lukasz Cwik"}}, "url": "https://github.com/apache/beam/commit/f327684122abf475160e1ed275e7e3d9e99774f9", "committedDate": "2020-03-17T22:47:48Z", "message": "[BEAM-9430] Migrate from ProcessContext#updateWatermark to WatermarkEstimators"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f327684122abf475160e1ed275e7e3d9e99774f9", "author": {"user": {"login": "lukecwik", "name": "Lukasz Cwik"}}, "url": "https://github.com/apache/beam/commit/f327684122abf475160e1ed275e7e3d9e99774f9", "committedDate": "2020-03-17T22:47:48Z", "message": "[BEAM-9430] Migrate from ProcessContext#updateWatermark to WatermarkEstimators"}, "afterCommit": {"oid": "8ac1bbb8d960619318dda1b35230da5b8ea8f3a4", "author": {"user": {"login": "lukecwik", "name": "Lukasz Cwik"}}, "url": "https://github.com/apache/beam/commit/8ac1bbb8d960619318dda1b35230da5b8ea8f3a4", "committedDate": "2020-03-17T23:38:41Z", "message": "[BEAM-9430] Migrate from ProcessContext#updateWatermark to WatermarkEstimators"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bde44e977a27e94acda9a9a46692d9f9fc924379", "author": {"user": {"login": "lukecwik", "name": "Lukasz Cwik"}}, "url": "https://github.com/apache/beam/commit/bde44e977a27e94acda9a9a46692d9f9fc924379", "committedDate": "2020-03-17T23:53:42Z", "message": "[BEAM-9430] Migrate from ProcessContext#updateWatermark to WatermarkEstimators"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ac1bbb8d960619318dda1b35230da5b8ea8f3a4", "author": {"user": {"login": "lukecwik", "name": "Lukasz Cwik"}}, "url": "https://github.com/apache/beam/commit/8ac1bbb8d960619318dda1b35230da5b8ea8f3a4", "committedDate": "2020-03-17T23:38:41Z", "message": "[BEAM-9430] Migrate from ProcessContext#updateWatermark to WatermarkEstimators"}, "afterCommit": {"oid": "bde44e977a27e94acda9a9a46692d9f9fc924379", "author": {"user": {"login": "lukecwik", "name": "Lukasz Cwik"}}, "url": "https://github.com/apache/beam/commit/bde44e977a27e94acda9a9a46692d9f9fc924379", "committedDate": "2020-03-17T23:53:42Z", "message": "[BEAM-9430] Migrate from ProcessContext#updateWatermark to WatermarkEstimators"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3ODczNjY5", "url": "https://github.com/apache/beam/pull/11126#pullrequestreview-377873669", "createdAt": "2020-03-19T16:12:10Z", "commit": {"oid": "bde44e977a27e94acda9a9a46692d9f9fc924379"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNjoxMjoxMFrOF41yag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNjoxMjoxMFrOF41yag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE0NTgzNA==", "bodyText": "This is a backwards-incompatible change. It probably does not affect many users but we should make sure to announce it, e.g. via the release notes.", "url": "https://github.com/apache/beam/pull/11126#discussion_r395145834", "createdAt": "2020-03-19T16:12:10Z", "author": {"login": "mxm"}, "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/DoFn.java", "diffHunk": "@@ -265,18 +265,6 @@\n      * data has been explicitly requested. See {@link Window} for more information.\n      */\n     public abstract PaneInfo pane();\n-\n-    /**\n-     * Gives the runner a (best-effort) lower bound about the timestamps of future output associated\n-     * with the current element.\n-     *\n-     * <p>If the {@link DoFn} has multiple outputs, the watermark applies to all of them.\n-     *\n-     * <p>Only splittable {@link DoFn DoFns} are allowed to call this method. It is safe to call\n-     * this method from a different thread than the one running {@link ProcessElement}, but all\n-     * calls must finish before {@link ProcessElement} returns.\n-     */\n-    public abstract void updateWatermark(Instant watermark);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bde44e977a27e94acda9a9a46692d9f9fc924379"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4942, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}