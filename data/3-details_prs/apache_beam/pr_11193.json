{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNDYwMjU3", "number": 11193, "title": "[BEAM-9550] Increase JVM Metaspace size for the TaskExecutors.", "bodyText": "Additionally, replace deprecated taskmanager.heap.mb config key to taskmanager.memory.process.mb, as suggested in Apache Flink 1.10 Migration Guide.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-03-23T15:35:06Z", "url": "https://github.com/apache/beam/pull/11193", "merged": true, "mergeCommit": {"oid": "237a99f91f1e75e181c7e73e7ab1cef3a4addcc9"}, "closed": true, "closedAt": "2020-04-09T09:16:28Z", "author": {"login": "kamilwu"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ5BcPAFqTM4MDY3NDcwMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVpCaVAFqTM5MDA0MzcxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjc0NzAw", "url": "https://github.com/apache/beam/pull/11193#pullrequestreview-380674700", "createdAt": "2020-03-24T20:33:46Z", "commit": {"oid": "7f11ef3ccd806e69c17e4788ebf37b8a50889d2e"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDozMzo0NlrOF7B_uQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDozNDo0OFrOF7CByQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ0MzAwMQ==", "bodyText": "The correct option name is: taskmanager.memory.jvm-metaspace.size: https://ci.apache.org/projects/flink/flink-docs-release-1.10/ops/config.html#taskmanager-memory-jvm-metaspace-size", "url": "https://github.com/apache/beam/pull/11193#discussion_r397443001", "createdAt": "2020-03-24T20:33:46Z", "author": {"login": "mxm"}, "path": ".test-infra/dataproc/init-actions/flink.sh", "diffHunk": "@@ -155,7 +155,8 @@ function configure_flink() {\n # Settings applied by Cloud Dataproc initialization action\n jobmanager.rpc.address: ${master_hostname}\n jobmanager.heap.mb: ${flink_jobmanager_memory}\n-taskmanager.heap.mb: ${flink_taskmanager_memory}\n+taskmanager.memory.process.mb: ${flink_taskmanager_memory}\n+taskmanager.memory.jvm-metaspace.mb: 512", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f11ef3ccd806e69c17e4788ebf37b8a50889d2e"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ0MzMyNw==", "bodyText": "Also this one is taskmanager.memory.process.size: https://ci.apache.org/projects/flink/flink-docs-release-1.10/ops/config.html#taskmanager-memory-process-size", "url": "https://github.com/apache/beam/pull/11193#discussion_r397443327", "createdAt": "2020-03-24T20:34:23Z", "author": {"login": "mxm"}, "path": ".test-infra/dataproc/init-actions/flink.sh", "diffHunk": "@@ -155,7 +155,8 @@ function configure_flink() {\n # Settings applied by Cloud Dataproc initialization action\n jobmanager.rpc.address: ${master_hostname}\n jobmanager.heap.mb: ${flink_jobmanager_memory}\n-taskmanager.heap.mb: ${flink_taskmanager_memory}\n+taskmanager.memory.process.mb: ${flink_taskmanager_memory}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f11ef3ccd806e69c17e4788ebf37b8a50889d2e"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ0MzUyOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            # Flink config entry: taskmanager.memory.process.mb.\n          \n          \n            \n            # Flink config entry: taskmanager.memory.process.size", "url": "https://github.com/apache/beam/pull/11193#discussion_r397443529", "createdAt": "2020-03-24T20:34:48Z", "author": {"login": "mxm"}, "path": ".test-infra/dataproc/init-actions/flink.sh", "diffHunk": "@@ -46,7 +46,7 @@ readonly FLINK_NETWORK_NUM_BUFFERS=2048\n readonly FLINK_JOBMANAGER_MEMORY_FRACTION='1.0'\n \n # Heap memory used by the task managers (slaves) determined by the physical (free) memory of the servers.\n-# Flink config entry: taskmanager.heap.mb.\n+# Flink config entry: taskmanager.memory.process.mb.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f11ef3ccd806e69c17e4788ebf37b8a50889d2e"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f11ef3ccd806e69c17e4788ebf37b8a50889d2e", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/7f11ef3ccd806e69c17e4788ebf37b8a50889d2e", "committedDate": "2020-03-23T15:33:55Z", "message": "[BEAM-9550] Increase JVM Metaspace size for the TaskExecutors.\n\nAdditionally, replace deprecated `taskmanager.heap.mb` config key to `taskmanager.memory.process.mb`, as suggested in Apache Flink 1.10 Migration Guide."}, "afterCommit": {"oid": "ced772a6e33f7d116cc112bfd89e02284ea48a0f", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/ced772a6e33f7d116cc112bfd89e02284ea48a0f", "committedDate": "2020-03-25T12:19:13Z", "message": "fix: correct config keys"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7fe4eebdfbe00bce21a3a0e377619ecd674b2fd4", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/7fe4eebdfbe00bce21a3a0e377619ecd674b2fd4", "committedDate": "2020-03-26T16:39:08Z", "message": "fix: execute tests in `BATCH_FORCED` mode"}, "afterCommit": {"oid": "adbf1d4ee21b2a6a1bb79d852fb8d37f52cf48eb", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/adbf1d4ee21b2a6a1bb79d852fb8d37f52cf48eb", "committedDate": "2020-03-26T16:45:11Z", "message": "fix: execute tests in `BATCH_FORCED` mode"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "adbf1d4ee21b2a6a1bb79d852fb8d37f52cf48eb", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/adbf1d4ee21b2a6a1bb79d852fb8d37f52cf48eb", "committedDate": "2020-03-26T16:45:11Z", "message": "fix: execute tests in `BATCH_FORCED` mode"}, "afterCommit": {"oid": "56a631a363db829d301c4b95c876ca958de78466", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/56a631a363db829d301c4b95c876ca958de78466", "committedDate": "2020-03-30T10:48:33Z", "message": "fix: increase the fraction of total Flink memory to be used as managed memory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "189c6529cd83cb22bd4f1c92dd9dc52a24b75a39", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/189c6529cd83cb22bd4f1c92dd9dc52a24b75a39", "committedDate": "2020-04-03T11:12:11Z", "message": "[BEAM-9550] Increase JVM Metaspace size for the TaskExecutors.\n\nAdditionally:\n * replace deprecated `taskmanager.heap.mb` config key to `taskmanager.memory.process.mb`, as suggested in Apache Flink 1.10 Migration Guide.\n * remove unused variable in `flink_cluster.sh` script."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8246adb83f855a7f5feb846e92e730954af0a2b5", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/8246adb83f855a7f5feb846e92e730954af0a2b5", "committedDate": "2020-04-03T11:12:11Z", "message": "fix: correct config keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a068c430e73ed52c7f415caf9679a4b47e30154f", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/a068c430e73ed52c7f415caf9679a4b47e30154f", "committedDate": "2020-04-03T11:12:11Z", "message": "fix: increase the fraction of total Flink memory to be used as managed memory"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "56a631a363db829d301c4b95c876ca958de78466", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/56a631a363db829d301c4b95c876ca958de78466", "committedDate": "2020-03-30T10:48:33Z", "message": "fix: increase the fraction of total Flink memory to be used as managed memory"}, "afterCommit": {"oid": "c02d64f437ac2754dc01f31c8e6048f183128fa4", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/c02d64f437ac2754dc01f31c8e6048f183128fa4", "committedDate": "2020-04-03T11:12:11Z", "message": "fix: change machine type to n1-highmem-4"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c02d64f437ac2754dc01f31c8e6048f183128fa4", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/c02d64f437ac2754dc01f31c8e6048f183128fa4", "committedDate": "2020-04-03T11:12:11Z", "message": "fix: change machine type to n1-highmem-4"}, "afterCommit": {"oid": "a068c430e73ed52c7f415caf9679a4b47e30154f", "author": {"user": {"login": "kamilwu", "name": "Kamil Wasilewski"}}, "url": "https://github.com/apache/beam/commit/a068c430e73ed52c7f415caf9679a4b47e30154f", "committedDate": "2020-04-03T11:12:11Z", "message": "fix: increase the fraction of total Flink memory to be used as managed memory"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMDQzNzEy", "url": "https://github.com/apache/beam/pull/11193#pullrequestreview-390043712", "createdAt": "2020-04-08T14:44:43Z", "commit": {"oid": "a068c430e73ed52c7f415caf9679a4b47e30154f"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNDo0NDo0M1rOGCyoHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxNDo0NzowNVrOGCyvAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU3OTgwNw==", "bodyText": "Should we set a fixed amount of memory here? 0.5 could be a lot.", "url": "https://github.com/apache/beam/pull/11193#discussion_r405579807", "createdAt": "2020-04-08T14:44:43Z", "author": {"login": "mxm"}, "path": ".test-infra/dataproc/init-actions/flink.sh", "diffHunk": "@@ -155,7 +155,9 @@ function configure_flink() {\n # Settings applied by Cloud Dataproc initialization action\n jobmanager.rpc.address: ${master_hostname}\n jobmanager.heap.mb: ${flink_jobmanager_memory}\n-taskmanager.heap.mb: ${flink_taskmanager_memory}\n+taskmanager.memory.process.size: \"${flink_taskmanager_memory} mb\"\n+taskmanager.memory.jvm-metaspace.size: 512 mb\n+taskmanager.memory.managed.fraction: 0.5", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a068c430e73ed52c7f415caf9679a4b47e30154f"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU4MTU2OQ==", "bodyText": "If you needed 0.5, then that's fine.", "url": "https://github.com/apache/beam/pull/11193#discussion_r405581569", "createdAt": "2020-04-08T14:47:05Z", "author": {"login": "mxm"}, "path": ".test-infra/dataproc/init-actions/flink.sh", "diffHunk": "@@ -155,7 +155,9 @@ function configure_flink() {\n # Settings applied by Cloud Dataproc initialization action\n jobmanager.rpc.address: ${master_hostname}\n jobmanager.heap.mb: ${flink_jobmanager_memory}\n-taskmanager.heap.mb: ${flink_taskmanager_memory}\n+taskmanager.memory.process.size: \"${flink_taskmanager_memory} mb\"\n+taskmanager.memory.jvm-metaspace.size: 512 mb\n+taskmanager.memory.managed.fraction: 0.5", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU3OTgwNw=="}, "originalCommit": {"oid": "a068c430e73ed52c7f415caf9679a4b47e30154f"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2920, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}