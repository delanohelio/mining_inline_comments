{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5NTMyOTY0", "number": 12082, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNDo0NVrOEQALiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMDoyNToxN1rOETDHpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MjE1NjI3OnYy", "diffSide": "RIGHT", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryResourceNaming.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNDo0NVrOGz8Dkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMDowODo0NlrOG2ZzUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExNDUxNA==", "bodyText": "\"Resources can be any type of BigQuery job started by BigQueryIO and temporary BigQuery resources created by BigQueryIO.\" ?", "url": "https://github.com/apache/beam/pull/12082#discussion_r457114514", "createdAt": "2020-07-20T07:04:45Z", "author": {"login": "chamikaramj"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryResourceNaming.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.bigquery;\n+\n+import com.google.api.services.bigquery.model.TableReference;\n+import java.util.Optional;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.hash.Hashing;\n+\n+/**\n+ * This class contains utilities to standardize how resources are named by BigQueryIO.\n+ *\n+ * <p>Resources can be: - BigQuery jobs - Export jobs - Query jobs - Load jobs - Copy jobs -", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60b854c2dbc7f7726ce8224066d607e4f5c22e94"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY5OTAyNg==", "bodyText": "done.", "url": "https://github.com/apache/beam/pull/12082#discussion_r459699026", "createdAt": "2020-07-23T20:08:46Z", "author": {"login": "pabloem"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryResourceNaming.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.bigquery;\n+\n+import com.google.api.services.bigquery.model.TableReference;\n+import java.util.Optional;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.hash.Hashing;\n+\n+/**\n+ * This class contains utilities to standardize how resources are named by BigQueryIO.\n+ *\n+ * <p>Resources can be: - BigQuery jobs - Export jobs - Query jobs - Load jobs - Copy jobs -", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExNDUxNA=="}, "originalCommit": {"oid": "60b854c2dbc7f7726ce8224066d607e4f5c22e94"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MjE2ODE4OnYy", "diffSide": "RIGHT", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryResourceNaming.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzowNzoxM1rOGz8JtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMDoxMTowM1rOG2Z3tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExNjA4NA==", "bodyText": "Probably cleaner to just use String.format() to do the replacement ?\nAlso, mention the standard format in the top level Java doc for easy reference.", "url": "https://github.com/apache/beam/pull/12082#discussion_r457116084", "createdAt": "2020-07-20T07:07:13Z", "author": {"login": "chamikaramj"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryResourceNaming.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.bigquery;\n+\n+import com.google.api.services.bigquery.model.TableReference;\n+import java.util.Optional;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.hash.Hashing;\n+\n+/**\n+ * This class contains utilities to standardize how resources are named by BigQueryIO.\n+ *\n+ * <p>Resources can be: - BigQuery jobs - Export jobs - Query jobs - Load jobs - Copy jobs -\n+ * Temporary datasets - Temporary tables\n+ *\n+ * <p>This class has no backwards compatibility guaantees. It is considered internal.\n+ */\n+class BigQueryResourceNaming {\n+\n+  /**\n+   * Generate a BigQuery job ID based on a prefix from {@link\n+   * BigQueryResourceNaming::createJobIdPrefix}, with destination information added to it.\n+   *\n+   * @param prefix A prefix generated in {@link BigQueryResourceNaming::createJobIdPrefix}.\n+   * @param tableDestination A descriptor of the destination table.\n+   * @param partition A partition number in the destination table.\n+   * @param index\n+   * @return\n+   */\n+  static String createJobIdWithDestination(\n+      String prefix, TableDestination tableDestination, int partition, long index) {\n+    // Job ID must be different for each partition of each table.\n+    String destinationHash =\n+        Hashing.murmur3_128().hashUnencodedChars(tableDestination.toString()).toString();\n+    String jobId = String.format(\"%s_%s\", prefix, destinationHash);\n+    if (partition >= 0) {\n+      jobId += String.format(\"_%05d\", partition);\n+    }\n+    if (index >= 0) {\n+      jobId += String.format(\"_%05d\", index);\n+    }\n+    return jobId;\n+  }\n+\n+  public enum JobType {\n+    LOAD,\n+    COPY,\n+    EXPORT,\n+    QUERY,\n+  }\n+\n+  static final String BIGQUERY_JOB_TEMPLATE = \"beam_bq_job_{TYPE}_{JOB_ID}_{STEP}_{RANDOM}\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60b854c2dbc7f7726ce8224066d607e4f5c22e94"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcwMDE0OQ==", "bodyText": "I used this because I'd like to have named slots for replacement. String.format only supports replacement based on position. Is it okay if I keep this?", "url": "https://github.com/apache/beam/pull/12082#discussion_r459700149", "createdAt": "2020-07-23T20:11:03Z", "author": {"login": "pabloem"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryResourceNaming.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.bigquery;\n+\n+import com.google.api.services.bigquery.model.TableReference;\n+import java.util.Optional;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.hash.Hashing;\n+\n+/**\n+ * This class contains utilities to standardize how resources are named by BigQueryIO.\n+ *\n+ * <p>Resources can be: - BigQuery jobs - Export jobs - Query jobs - Load jobs - Copy jobs -\n+ * Temporary datasets - Temporary tables\n+ *\n+ * <p>This class has no backwards compatibility guaantees. It is considered internal.\n+ */\n+class BigQueryResourceNaming {\n+\n+  /**\n+   * Generate a BigQuery job ID based on a prefix from {@link\n+   * BigQueryResourceNaming::createJobIdPrefix}, with destination information added to it.\n+   *\n+   * @param prefix A prefix generated in {@link BigQueryResourceNaming::createJobIdPrefix}.\n+   * @param tableDestination A descriptor of the destination table.\n+   * @param partition A partition number in the destination table.\n+   * @param index\n+   * @return\n+   */\n+  static String createJobIdWithDestination(\n+      String prefix, TableDestination tableDestination, int partition, long index) {\n+    // Job ID must be different for each partition of each table.\n+    String destinationHash =\n+        Hashing.murmur3_128().hashUnencodedChars(tableDestination.toString()).toString();\n+    String jobId = String.format(\"%s_%s\", prefix, destinationHash);\n+    if (partition >= 0) {\n+      jobId += String.format(\"_%05d\", partition);\n+    }\n+    if (index >= 0) {\n+      jobId += String.format(\"_%05d\", index);\n+    }\n+    return jobId;\n+  }\n+\n+  public enum JobType {\n+    LOAD,\n+    COPY,\n+    EXPORT,\n+    QUERY,\n+  }\n+\n+  static final String BIGQUERY_JOB_TEMPLATE = \"beam_bq_job_{TYPE}_{JOB_ID}_{STEP}_{RANDOM}\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzExNjA4NA=="}, "originalCommit": {"oid": "60b854c2dbc7f7726ce8224066d607e4f5c22e94"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MjIxNTA4OnYy", "diffSide": "RIGHT", "path": "sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryResourceNamingTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxNzoyMFrOGz8i2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMjoxMTozOVrOG2dVPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEyMjUyMQ==", "bodyText": "Can we add tests to make sure that generated names are consistent with BIGQUERY_JOB_TEMPLATE ?", "url": "https://github.com/apache/beam/pull/12082#discussion_r457122521", "createdAt": "2020-07-20T07:17:20Z", "author": {"login": "chamikaramj"}, "path": "sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryResourceNamingTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.bigquery;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import org.apache.beam.sdk.io.gcp.bigquery.BigQueryResourceNaming.JobType;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.JUnit4;\n+\n+@RunWith(JUnit4.class)\n+public class BigQueryResourceNamingTest {\n+\n+  @Test\n+  public void testJobTypesInNames() {\n+    assertEquals(\n+        \"beam_bq_job_EXPORT_beamappjobtest_abcd\",\n+        BigQueryResourceNaming.createJobIdPrefix(\"beamapp-job-test\", \"abcd\", JobType.EXPORT));\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60b854c2dbc7f7726ce8224066d607e4f5c22e94"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc1Njg2Mw==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/12082#discussion_r459756863", "createdAt": "2020-07-23T22:11:39Z", "author": {"login": "pabloem"}, "path": "sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryResourceNamingTest.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.bigquery;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import org.apache.beam.sdk.io.gcp.bigquery.BigQueryResourceNaming.JobType;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.JUnit4;\n+\n+@RunWith(JUnit4.class)\n+public class BigQueryResourceNamingTest {\n+\n+  @Test\n+  public void testJobTypesInNames() {\n+    assertEquals(\n+        \"beam_bq_job_EXPORT_beamappjobtest_abcd\",\n+        BigQueryResourceNaming.createJobIdPrefix(\"beamapp-job-test\", \"abcd\", JobType.EXPORT));\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEyMjUyMQ=="}, "originalCommit": {"oid": "60b854c2dbc7f7726ce8224066d607e4f5c22e94"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MjIyNjQ4OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/io/gcp/bigquery_tools.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoxOTo0NVrOGz8pGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMjoxMTozNVrOG2dVKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEyNDEyMg==", "bodyText": "Please add unit tests for Python as well.", "url": "https://github.com/apache/beam/pull/12082#discussion_r457124122", "createdAt": "2020-07-20T07:19:45Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/io/gcp/bigquery_tools.py", "diffHunk": "@@ -1465,3 +1465,23 @@ def get_avro_schema_from_table_schema(schema):\n   dict_table_schema = get_dict_table_schema(schema)\n   return bigquery_avro_tools.get_record_schema_from_dict_table_schema(\n       \"root\", dict_table_schema)\n+\n+\n+class BigQueryJobTypes:\n+  EXPORT = 'EXPORT'\n+  COPY = 'COPY'\n+  LOAD = 'LOAD'\n+  QUERY = 'QUERY'\n+\n+\n+_BQ_JOB_NAME_TEMPLATE = \"beam_bq_job_{job_type}_{job_id}_{step_id}_{random}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60b854c2dbc7f7726ce8224066d607e4f5c22e94"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc1Njg0MQ==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/12082#discussion_r459756841", "createdAt": "2020-07-23T22:11:35Z", "author": {"login": "pabloem"}, "path": "sdks/python/apache_beam/io/gcp/bigquery_tools.py", "diffHunk": "@@ -1465,3 +1465,23 @@ def get_avro_schema_from_table_schema(schema):\n   dict_table_schema = get_dict_table_schema(schema)\n   return bigquery_avro_tools.get_record_schema_from_dict_table_schema(\n       \"root\", dict_table_schema)\n+\n+\n+class BigQueryJobTypes:\n+  EXPORT = 'EXPORT'\n+  COPY = 'COPY'\n+  LOAD = 'LOAD'\n+  QUERY = 'QUERY'\n+\n+\n+_BQ_JOB_NAME_TEMPLATE = \"beam_bq_job_{job_type}_{job_id}_{step_id}_{random}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEyNDEyMg=="}, "originalCommit": {"oid": "60b854c2dbc7f7726ce8224066d607e4f5c22e94"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MjIzMjI1OnYy", "diffSide": "RIGHT", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryResourceNaming.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoyMToxM1rOGz8sqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMDozNzozN1rOG2as3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEyNTAzMg==", "bodyText": "Can we standardize and define this format in BigQueryIO (probably with a backwards compatibility warning) so that users can rely on it ?", "url": "https://github.com/apache/beam/pull/12082#discussion_r457125032", "createdAt": "2020-07-20T07:21:13Z", "author": {"login": "chamikaramj"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryResourceNaming.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.bigquery;\n+\n+import com.google.api.services.bigquery.model.TableReference;\n+import java.util.Optional;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.hash.Hashing;\n+\n+/**\n+ * This class contains utilities to standardize how resources are named by BigQueryIO.\n+ *\n+ * <p>Resources can be: - BigQuery jobs - Export jobs - Query jobs - Load jobs - Copy jobs -\n+ * Temporary datasets - Temporary tables\n+ *\n+ * <p>This class has no backwards compatibility guaantees. It is considered internal.\n+ */\n+class BigQueryResourceNaming {\n+\n+  /**\n+   * Generate a BigQuery job ID based on a prefix from {@link\n+   * BigQueryResourceNaming::createJobIdPrefix}, with destination information added to it.\n+   *\n+   * @param prefix A prefix generated in {@link BigQueryResourceNaming::createJobIdPrefix}.\n+   * @param tableDestination A descriptor of the destination table.\n+   * @param partition A partition number in the destination table.\n+   * @param index\n+   * @return\n+   */\n+  static String createJobIdWithDestination(\n+      String prefix, TableDestination tableDestination, int partition, long index) {\n+    // Job ID must be different for each partition of each table.\n+    String destinationHash =\n+        Hashing.murmur3_128().hashUnencodedChars(tableDestination.toString()).toString();\n+    String jobId = String.format(\"%s_%s\", prefix, destinationHash);\n+    if (partition >= 0) {\n+      jobId += String.format(\"_%05d\", partition);\n+    }\n+    if (index >= 0) {\n+      jobId += String.format(\"_%05d\", index);\n+    }\n+    return jobId;\n+  }\n+\n+  public enum JobType {\n+    LOAD,\n+    COPY,\n+    EXPORT,\n+    QUERY,\n+  }\n+\n+  static final String BIGQUERY_JOB_TEMPLATE = \"beam_bq_job_{TYPE}_{JOB_ID}_{STEP}_{RANDOM}\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60b854c2dbc7f7726ce8224066d607e4f5c22e94"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcxMzc1OA==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/12082#discussion_r459713758", "createdAt": "2020-07-23T20:37:37Z", "author": {"login": "pabloem"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryResourceNaming.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.bigquery;\n+\n+import com.google.api.services.bigquery.model.TableReference;\n+import java.util.Optional;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.hash.Hashing;\n+\n+/**\n+ * This class contains utilities to standardize how resources are named by BigQueryIO.\n+ *\n+ * <p>Resources can be: - BigQuery jobs - Export jobs - Query jobs - Load jobs - Copy jobs -\n+ * Temporary datasets - Temporary tables\n+ *\n+ * <p>This class has no backwards compatibility guaantees. It is considered internal.\n+ */\n+class BigQueryResourceNaming {\n+\n+  /**\n+   * Generate a BigQuery job ID based on a prefix from {@link\n+   * BigQueryResourceNaming::createJobIdPrefix}, with destination information added to it.\n+   *\n+   * @param prefix A prefix generated in {@link BigQueryResourceNaming::createJobIdPrefix}.\n+   * @param tableDestination A descriptor of the destination table.\n+   * @param partition A partition number in the destination table.\n+   * @param index\n+   * @return\n+   */\n+  static String createJobIdWithDestination(\n+      String prefix, TableDestination tableDestination, int partition, long index) {\n+    // Job ID must be different for each partition of each table.\n+    String destinationHash =\n+        Hashing.murmur3_128().hashUnencodedChars(tableDestination.toString()).toString();\n+    String jobId = String.format(\"%s_%s\", prefix, destinationHash);\n+    if (partition >= 0) {\n+      jobId += String.format(\"_%05d\", partition);\n+    }\n+    if (index >= 0) {\n+      jobId += String.format(\"_%05d\", index);\n+    }\n+    return jobId;\n+  }\n+\n+  public enum JobType {\n+    LOAD,\n+    COPY,\n+    EXPORT,\n+    QUERY,\n+  }\n+\n+  static final String BIGQUERY_JOB_TEMPLATE = \"beam_bq_job_{TYPE}_{JOB_ID}_{STEP}_{RANDOM}\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEyNTAzMg=="}, "originalCommit": {"oid": "60b854c2dbc7f7726ce8224066d607e4f5c22e94"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1MjIzMzcxOnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/io/gcp/bigquery_tools.py", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzoyMTozM1rOGz8tfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMDo0NTo0OFrOG2a9OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEyNTI0NQ==", "bodyText": "Can we standardize and define this format in bigquery.py (probably with a backwards compatibility warning) so that users can rely on it ?", "url": "https://github.com/apache/beam/pull/12082#discussion_r457125245", "createdAt": "2020-07-20T07:21:33Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/io/gcp/bigquery_tools.py", "diffHunk": "@@ -1465,3 +1465,23 @@ def get_avro_schema_from_table_schema(schema):\n   dict_table_schema = get_dict_table_schema(schema)\n   return bigquery_avro_tools.get_record_schema_from_dict_table_schema(\n       \"root\", dict_table_schema)\n+\n+\n+class BigQueryJobTypes:\n+  EXPORT = 'EXPORT'\n+  COPY = 'COPY'\n+  LOAD = 'LOAD'\n+  QUERY = 'QUERY'\n+\n+\n+_BQ_JOB_NAME_TEMPLATE = \"beam_bq_job_{job_type}_{job_id}_{step_id}_{random}\"\n+\n+\n+def generate_bq_job_name(job_name, step_id, job_type, random=None):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "60b854c2dbc7f7726ce8224066d607e4f5c22e94"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcxNzk0NA==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/12082#discussion_r459717944", "createdAt": "2020-07-23T20:45:48Z", "author": {"login": "pabloem"}, "path": "sdks/python/apache_beam/io/gcp/bigquery_tools.py", "diffHunk": "@@ -1465,3 +1465,23 @@ def get_avro_schema_from_table_schema(schema):\n   dict_table_schema = get_dict_table_schema(schema)\n   return bigquery_avro_tools.get_record_schema_from_dict_table_schema(\n       \"root\", dict_table_schema)\n+\n+\n+class BigQueryJobTypes:\n+  EXPORT = 'EXPORT'\n+  COPY = 'COPY'\n+  LOAD = 'LOAD'\n+  QUERY = 'QUERY'\n+\n+\n+_BQ_JOB_NAME_TEMPLATE = \"beam_bq_job_{job_type}_{job_id}_{step_id}_{random}\"\n+\n+\n+def generate_bq_job_name(job_name, step_id, job_type, random=None):", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzEyNTI0NQ=="}, "originalCommit": {"oid": "60b854c2dbc7f7726ce8224066d607e4f5c22e94"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDA5MzE5OnYy", "diffSide": "RIGHT", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryIO.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMDoyNDozMFrOG4kSOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQyMjowMDowNVrOG51UYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk2NzkyOA==", "bodyText": "Nit: what if the runner is not Dataflow ?", "url": "https://github.com/apache/beam/pull/12082#discussion_r461967928", "createdAt": "2020-07-29T00:24:30Z", "author": {"login": "chamikaramj"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryIO.java", "diffHunk": "@@ -457,6 +456,22 @@\n  * </a> for security and permission related information specific to BigQuery.\n  */\n public class BigQueryIO {\n+\n+  /**\n+   * Template for BigQuery jobs created by BigQueryIO. This template is: {@code\n+   * \"beam_bq_job_{TYPE}_{JOB_ID}_{STEP}_{RANDOM}\"}, where:\n+   *\n+   * <ul>\n+   *   <li>{@code TYPE} represents the BigQuery job type (e.g. extract / copy / load / query)\n+   *   <li>{@code JOB_ID} is the Dataflow job name.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7ef0baedbe0b06cbafe6413f044bdae26567b2b"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI5NTU4Nw==", "bodyText": "ah the job name comes from Beam, and is autogenerated if one is not provided. Changed the documentation to express that.", "url": "https://github.com/apache/beam/pull/12082#discussion_r463295587", "createdAt": "2020-07-30T22:00:05Z", "author": {"login": "pabloem"}, "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryIO.java", "diffHunk": "@@ -457,6 +456,22 @@\n  * </a> for security and permission related information specific to BigQuery.\n  */\n public class BigQueryIO {\n+\n+  /**\n+   * Template for BigQuery jobs created by BigQueryIO. This template is: {@code\n+   * \"beam_bq_job_{TYPE}_{JOB_ID}_{STEP}_{RANDOM}\"}, where:\n+   *\n+   * <ul>\n+   *   <li>{@code TYPE} represents the BigQuery job type (e.g. extract / copy / load / query)\n+   *   <li>{@code JOB_ID} is the Dataflow job name.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk2NzkyOA=="}, "originalCommit": {"oid": "a7ef0baedbe0b06cbafe6413f044bdae26567b2b"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NDA5NTA4OnYy", "diffSide": "RIGHT", "path": "sdks/python/apache_beam/io/gcp/bigquery.py", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMDoyNToxN1rOG4kTWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQwMDoyNToxN1rOG4kTWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk2ODIxNg==", "bodyText": "Ditto.", "url": "https://github.com/apache/beam/pull/12082#discussion_r461968216", "createdAt": "2020-07-29T00:25:17Z", "author": {"login": "chamikaramj"}, "path": "sdks/python/apache_beam/io/gcp/bigquery.py", "diffHunk": "@@ -290,6 +290,20 @@ def compute_table_name(row):\n ]\n \n _LOGGER = logging.getLogger(__name__)\n+\"\"\"\n+Template for BigQuery jobs created by BigQueryIO. This template is:\n+`\"beam_bq_job_{job_type}_{job_id}_{step_id}_{random}\"`, where:\n+\n+- `job_type` represents the BigQuery job type (e.g. extract / copy / load /\n+    query).\n+- `job_id` is the Dataflow job name.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7ef0baedbe0b06cbafe6413f044bdae26567b2b"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3578, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}