{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5OTEwMzQx", "number": 10746, "title": "[BEAM-9241] Fix inconsistent proto nullability", "bodyText": "Fix the nullability issues with protobuf to schema mapping\n\nProto3 primitive types should be not nullable.\nProto2 required types should be not nullable.\nProto2 optional should also be not nullable as having an optional value\ndoesn't mean it has not value. The spec states it has the optional\nvalue.\nArrays should be not nullable, as proto arrays always have an empty\narray when no value is set.\nMaps should be not nullable, as proto maps always have an empty map when\nno value is set.\nElements in an array should be not nullable, as nulls are not allowed in\nan array.\nNames and Values should be not nullable, as nulls are not allowed.\nRows are nullable, as messages are nullable.\n\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-02-01T15:40:38Z", "url": "https://github.com/apache/beam/pull/10746", "merged": true, "mergeCommit": {"oid": "7fc5fb599cf62c4ad6b342b8175df8d76b1e1861"}, "closed": true, "closedAt": "2020-02-10T18:15:14Z", "author": {"login": "alexvanboxel"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcALi1OgFqTM1MTkwODEwNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcC8EfCABqjMwMjI0NjE5NDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxOTA4MTA3", "url": "https://github.com/apache/beam/pull/10746#pullrequestreview-351908107", "createdAt": "2020-02-01T22:32:20Z", "commit": {"oid": "f7722a0bc4aa0305b3d27cfd8dcf5c82c7eb3f25"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQyMjozMjoyMFrOFkfUMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQyMjozMjoyMFrOFkfUMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgwNjEzMQ==", "bodyText": "Are they? I didn't think that was true. What happens if you declare a submessage required in proto2?", "url": "https://github.com/apache/beam/pull/10746#discussion_r373806131", "createdAt": "2020-02-01T22:32:20Z", "author": {"login": "reuvenlax"}, "path": "sdks/java/extensions/protobuf/src/main/java/org/apache/beam/sdk/extensions/protobuf/ProtoSchemaTranslator.java", "diffHunk": "@@ -268,13 +287,12 @@ private static FieldType beamFieldTypeFromSingularProtoField(\n           default:\n             fieldType = FieldType.row(getSchema(protoFieldDescriptor.getMessageType()));\n         }\n+        // all messages are nullable in Proto", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7722a0bc4aa0305b3d27cfd8dcf5c82c7eb3f25"}, "originalPosition": 64}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62ececa4152f73d494af53d87a825f4e03d75d45", "author": {"user": {"login": "alexvanboxel", "name": "Alex Van Boxel"}}, "url": "https://github.com/apache/beam/commit/62ececa4152f73d494af53d87a825f4e03d75d45", "committedDate": "2020-02-02T09:36:34Z", "message": "Fixed message nullability on proto2"}, "afterCommit": {"oid": "95bfaa6650cb627e8c3b5f65981a484e0261b4ae", "author": {"user": {"login": "alexvanboxel", "name": "Alex Van Boxel"}}, "url": "https://github.com/apache/beam/commit/95bfaa6650cb627e8c3b5f65981a484e0261b4ae", "committedDate": "2020-02-10T07:52:09Z", "message": "[BEAM-9241] Fix inconsistent proto nullability\n\nFix the nullability issues with protobuf to schema mapping\n\n* Proto3 primitive types should be not nullable.\n* Proto2 required types should be not nullable.\n* Proto2 optional should also be not nullable as having an optional value\n  doesn't mean it has not value. The spec states it has the optional\n  value.\n* Arrays should be not nullable, as proto arrays always have an empty\n  array when no value is set.\n* Maps should be not nullable, as proto maps always have an empty map when\n  no value is set.\n* Elements in an array should be not nullable, as nulls are not allowed in\n  an array.\n* Names and Values should be not nullable, as nulls are not allowed.\n* Messages, as well as Well Known Types are nullable, unless using\n  proto2 and the required label is specified."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aab5ae5fa8d8521a3d3e9273765a26a2c3632cb0", "author": {"user": {"login": "alexvanboxel", "name": "Alex Van Boxel"}}, "url": "https://github.com/apache/beam/commit/aab5ae5fa8d8521a3d3e9273765a26a2c3632cb0", "committedDate": "2020-02-10T12:11:02Z", "message": "[BEAM-9241] Fix inconsistent proto nullability\n\nFix the nullability issues with protobuf to schema mapping\n\n* Proto3 primitive types should be not nullable.\n* Proto2 required types should be not nullable.\n* Proto2 optional should also be not nullable as having an optional value\n  doesn't mean it has not value. The spec states it has the optional\n  value.\n* Arrays should be not nullable, as proto arrays always have an empty\n  array when no value is set.\n* Maps should be not nullable, as proto maps always have an empty map when\n  no value is set.\n* Elements in an array should be not nullable, as nulls are not allowed in\n  an array.\n* Names and Values should be not nullable, as nulls are not allowed.\n* Messages, as well as Well Known Types are nullable, unless using\n  proto2 and the required label is specified."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "95bfaa6650cb627e8c3b5f65981a484e0261b4ae", "author": {"user": {"login": "alexvanboxel", "name": "Alex Van Boxel"}}, "url": "https://github.com/apache/beam/commit/95bfaa6650cb627e8c3b5f65981a484e0261b4ae", "committedDate": "2020-02-10T07:52:09Z", "message": "[BEAM-9241] Fix inconsistent proto nullability\n\nFix the nullability issues with protobuf to schema mapping\n\n* Proto3 primitive types should be not nullable.\n* Proto2 required types should be not nullable.\n* Proto2 optional should also be not nullable as having an optional value\n  doesn't mean it has not value. The spec states it has the optional\n  value.\n* Arrays should be not nullable, as proto arrays always have an empty\n  array when no value is set.\n* Maps should be not nullable, as proto maps always have an empty map when\n  no value is set.\n* Elements in an array should be not nullable, as nulls are not allowed in\n  an array.\n* Names and Values should be not nullable, as nulls are not allowed.\n* Messages, as well as Well Known Types are nullable, unless using\n  proto2 and the required label is specified."}, "afterCommit": {"oid": "aab5ae5fa8d8521a3d3e9273765a26a2c3632cb0", "author": {"user": {"login": "alexvanboxel", "name": "Alex Van Boxel"}}, "url": "https://github.com/apache/beam/commit/aab5ae5fa8d8521a3d3e9273765a26a2c3632cb0", "committedDate": "2020-02-10T12:11:02Z", "message": "[BEAM-9241] Fix inconsistent proto nullability\n\nFix the nullability issues with protobuf to schema mapping\n\n* Proto3 primitive types should be not nullable.\n* Proto2 required types should be not nullable.\n* Proto2 optional should also be not nullable as having an optional value\n  doesn't mean it has not value. The spec states it has the optional\n  value.\n* Arrays should be not nullable, as proto arrays always have an empty\n  array when no value is set.\n* Maps should be not nullable, as proto maps always have an empty map when\n  no value is set.\n* Elements in an array should be not nullable, as nulls are not allowed in\n  an array.\n* Names and Values should be not nullable, as nulls are not allowed.\n* Messages, as well as Well Known Types are nullable, unless using\n  proto2 and the required label is specified."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3346, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}