{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyODQ5NTE2", "number": 11811, "title": "[BEAM-10075] Add a flag to tune the size of the grouping tables used by the dataflow workers", "bodyText": "This change simply adds a flag to allow users to set the size of grouping tables, rather than hard coding them to 100 MB.  The flag defaults to 100 MB, so users who don't set the flag will see no difference in behavior.\nR: @lukecwik\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-05-25T17:57:59Z", "url": "https://github.com/apache/beam/pull/11811", "merged": true, "mergeCommit": {"oid": "5b6e84fa380f1586bdd7ec1e8200e43ecc827f6e"}, "closed": true, "closedAt": "2020-05-27T15:52:53Z", "author": {"login": "steveniemitz"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclQU-IAFqTQxODgyNTI5OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABclRXqrgBqjMzNzYzMTI3Njc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4ODI1Mjk5", "url": "https://github.com/apache/beam/pull/11811#pullrequestreview-418825299", "createdAt": "2020-05-27T03:01:24Z", "commit": {"oid": "6021085dc859485b80574d35fddcef6f02aa5481"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwMzowMToyNFrOGa31uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwMzowMToyNFrOGa31uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDgzMTAzNQ==", "bodyText": "Please add this option to \n  \n    \n      beam/sdks/java/core/src/main/java/org/apache/beam/sdk/options/SdkHarnessOptions.java\n    \n    \n         Line 32\n      in\n      32c6579\n    \n    \n    \n    \n\n        \n          \n           public interface SdkHarnessOptions extends PipelineOptions { \n        \n    \n  \n\n instead of here.\nPlease also plumb the value to \n  \n    \n      beam/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/PrecombineGroupingTable.java\n    \n    \n         Line 44\n      in\n      32c6579\n    \n    \n    \n    \n\n        \n          \n           public static <K, InputT, AccumT> GroupingTable<WindowedValue<K>, InputT, AccumT> combining( \n        \n    \n  \n\n\nWe should be able to use a primitive type (also long seems really large for specifying amount of MBs):\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              Long getGroupingTableMaxSizeMb();\n          \n          \n            \n            \n          \n          \n            \n              void setGroupingTableMaxSizeMb(Long value);\n          \n          \n            \n              int getGroupingTableMaxSizeMb();\n          \n          \n            \n            \n          \n          \n            \n              void setGroupingTableMaxSizeMb(int value);", "url": "https://github.com/apache/beam/pull/11811#discussion_r430831035", "createdAt": "2020-05-27T03:01:24Z", "author": {"login": "lukecwik"}, "path": "runners/google-cloud-dataflow-java/src/main/java/org/apache/beam/runners/dataflow/options/DataflowPipelineDebugOptions.java", "diffHunk": "@@ -177,6 +177,20 @@ public Dataflow create(PipelineOptions options) {\n \n   void setNumberOfWorkerHarnessThreads(int value);\n \n+  /**\n+   * Size (in MB) of each grouping table used to pre-combine elements. If unset, defaults to 100 MB.\n+   *\n+   * <p>CAUTION: If set too large, workers may run into OOM conditions more easily, each worker may\n+   * have many grouping tables in-memory concurrently.\n+   */\n+  @Description(\n+      \"The size (in MB) of the grouping tables used to pre-combine elements before \"\n+          + \"shuffling.  Larger values may reduce the amount of data shuffled.\")\n+  @Default.Long(100)\n+  Long getGroupingTableMaxSizeMb();\n+\n+  void setGroupingTableMaxSizeMb(Long value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6021085dc859485b80574d35fddcef6f02aa5481"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6021085dc859485b80574d35fddcef6f02aa5481", "author": {"user": {"login": "steveniemitz", "name": "Steven Niemitz"}}, "url": "https://github.com/apache/beam/commit/6021085dc859485b80574d35fddcef6f02aa5481", "committedDate": "2020-05-25T17:55:08Z", "message": "Add a flag to tune the size of the grouping tables used by the dataflow workers"}, "afterCommit": {"oid": "d9c9617c600d92605e40027670467928ca63368c", "author": {"user": {"login": "steveniemitz", "name": "Steven Niemitz"}}, "url": "https://github.com/apache/beam/commit/d9c9617c600d92605e40027670467928ca63368c", "committedDate": "2020-05-27T03:14:47Z", "message": "Add a flag to tune the size of the grouping tables used by the dataflow workers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4ODMyOTI2", "url": "https://github.com/apache/beam/pull/11811#pullrequestreview-418832926", "createdAt": "2020-05-27T03:28:53Z", "commit": {"oid": "d9c9617c600d92605e40027670467928ca63368c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "634344d575e379e910baaed0ce07f4e850655dd7", "author": {"user": {"login": "steveniemitz", "name": "Steven Niemitz"}}, "url": "https://github.com/apache/beam/commit/634344d575e379e910baaed0ce07f4e850655dd7", "committedDate": "2020-05-27T04:15:14Z", "message": "Add a flag to tune the size of the grouping tables used by the dataflow workers"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d9c9617c600d92605e40027670467928ca63368c", "author": {"user": {"login": "steveniemitz", "name": "Steven Niemitz"}}, "url": "https://github.com/apache/beam/commit/d9c9617c600d92605e40027670467928ca63368c", "committedDate": "2020-05-27T03:14:47Z", "message": "Add a flag to tune the size of the grouping tables used by the dataflow workers"}, "afterCommit": {"oid": "634344d575e379e910baaed0ce07f4e850655dd7", "author": {"user": {"login": "steveniemitz", "name": "Steven Niemitz"}}, "url": "https://github.com/apache/beam/commit/634344d575e379e910baaed0ce07f4e850655dd7", "committedDate": "2020-05-27T04:15:14Z", "message": "Add a flag to tune the size of the grouping tables used by the dataflow workers"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4336, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}