{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwMDY1MjI5", "number": 13319, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMTo0MTowM1rOE42EjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMToyMjowMVrOE8Zryg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4MDQxNjEyOnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigtable/BigtableRowToBeamRow.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMTo0MTowM1rOHzAdSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwOTo1ODozMlrOH0tFiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI0NjkyMQ==", "bodyText": "Nit: it might be better to list the BigTable reference: https://cloud.google.com/bigtable/docs/reference/data/rpc/google.bigtable.v2", "url": "https://github.com/apache/beam/pull/13319#discussion_r523246921", "createdAt": "2020-11-13T21:41:03Z", "author": {"login": "amaliujia"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigtable/BigtableRowToBeamRow.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.extensions.sql.meta.provider.bigtable;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.KEY;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.LABELS;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.TIMESTAMP_MICROS;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.VALUE;\n+import static org.apache.beam.vendor.guava.v26_0_jre.com.google.common.base.Preconditions.checkArgument;\n+\n+import com.google.bigtable.v2.Cell;\n+import com.google.bigtable.v2.Column;\n+import com.google.bigtable.v2.Family;\n+import java.io.Serializable;\n+import java.util.Comparator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import org.apache.beam.sdk.schemas.Schema;\n+import org.apache.beam.sdk.transforms.MapElements;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.SimpleFunction;\n+import org.apache.beam.sdk.values.KV;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.Row;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.primitives.Longs;\n+\n+@SuppressWarnings({\n+  \"nullness\" // TODO(https://issues.apache.org/jira/browse/BEAM-10402)\n+})\n+public class BigtableRowToBeamRow", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e33eaa5bfb67d5add4a7948cdecfe63e7c6a219"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTAyNjY5Ng==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/13319#discussion_r525026696", "createdAt": "2020-11-17T09:58:32Z", "author": {"login": "piotr-szuberski"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigtable/BigtableRowToBeamRow.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.extensions.sql.meta.provider.bigtable;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.KEY;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.LABELS;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.TIMESTAMP_MICROS;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.VALUE;\n+import static org.apache.beam.vendor.guava.v26_0_jre.com.google.common.base.Preconditions.checkArgument;\n+\n+import com.google.bigtable.v2.Cell;\n+import com.google.bigtable.v2.Column;\n+import com.google.bigtable.v2.Family;\n+import java.io.Serializable;\n+import java.util.Comparator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import org.apache.beam.sdk.schemas.Schema;\n+import org.apache.beam.sdk.transforms.MapElements;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.SimpleFunction;\n+import org.apache.beam.sdk.values.KV;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.Row;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.primitives.Longs;\n+\n+@SuppressWarnings({\n+  \"nullness\" // TODO(https://issues.apache.org/jira/browse/BEAM-10402)\n+})\n+public class BigtableRowToBeamRow", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI0NjkyMQ=="}, "originalCommit": {"oid": "2e33eaa5bfb67d5add4a7948cdecfe63e7c6a219"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4MDQyMzMxOnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigtable/BigtableRowToBeamRow.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMTo0Mzo0MVrOHzAhYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxMDowNTo1NVrOH0tYeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI0Nzk2OQ==", "bodyText": "Can you add java doc here to give briefly design decision for mapping from bigtable row to Beam row.\nI see that bigtable row contains\nRow: Key, Family[]\nFamily: ... Column[]\nColumn: ... Cell[]\nCell:  ...Value\ndocument current mapping seems will be straightforward?", "url": "https://github.com/apache/beam/pull/13319#discussion_r523247969", "createdAt": "2020-11-13T21:43:41Z", "author": {"login": "amaliujia"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigtable/BigtableRowToBeamRow.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.extensions.sql.meta.provider.bigtable;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.KEY;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.LABELS;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.TIMESTAMP_MICROS;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.VALUE;\n+import static org.apache.beam.vendor.guava.v26_0_jre.com.google.common.base.Preconditions.checkArgument;\n+\n+import com.google.bigtable.v2.Cell;\n+import com.google.bigtable.v2.Column;\n+import com.google.bigtable.v2.Family;\n+import java.io.Serializable;\n+import java.util.Comparator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import org.apache.beam.sdk.schemas.Schema;\n+import org.apache.beam.sdk.transforms.MapElements;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.SimpleFunction;\n+import org.apache.beam.sdk.values.KV;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.Row;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.primitives.Longs;\n+\n+@SuppressWarnings({\n+  \"nullness\" // TODO(https://issues.apache.org/jira/browse/BEAM-10402)\n+})\n+public class BigtableRowToBeamRow", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e33eaa5bfb67d5add4a7948cdecfe63e7c6a219"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTAzMTU0NA==", "bodyText": "I've written some javadoc, but I'm not sure whether it's understable", "url": "https://github.com/apache/beam/pull/13319#discussion_r525031544", "createdAt": "2020-11-17T10:05:55Z", "author": {"login": "piotr-szuberski"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigtable/BigtableRowToBeamRow.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.extensions.sql.meta.provider.bigtable;\n+\n+import static java.util.stream.Collectors.toList;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.KEY;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.LABELS;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.TIMESTAMP_MICROS;\n+import static org.apache.beam.sdk.extensions.sql.meta.provider.bigtable.BigtableTable.VALUE;\n+import static org.apache.beam.vendor.guava.v26_0_jre.com.google.common.base.Preconditions.checkArgument;\n+\n+import com.google.bigtable.v2.Cell;\n+import com.google.bigtable.v2.Column;\n+import com.google.bigtable.v2.Family;\n+import java.io.Serializable;\n+import java.util.Comparator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import org.apache.beam.sdk.schemas.Schema;\n+import org.apache.beam.sdk.transforms.MapElements;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.SimpleFunction;\n+import org.apache.beam.sdk.values.KV;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.Row;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.primitives.Longs;\n+\n+@SuppressWarnings({\n+  \"nullness\" // TODO(https://issues.apache.org/jira/browse/BEAM-10402)\n+})\n+public class BigtableRowToBeamRow", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI0Nzk2OQ=="}, "originalCommit": {"oid": "2e33eaa5bfb67d5add4a7948cdecfe63e7c6a219"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNzQ3ODE5OnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigtable/BigtableTable.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMDoxMzo1OFrOH4dtjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMDoyMzozNlrOH44z8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2OTEwMg==", "bodyText": "for this functions and other functions below, as they are already private functions, maybe should remove the static?", "url": "https://github.com/apache/beam/pull/13319#discussion_r528969102", "createdAt": "2020-11-23T20:13:58Z", "author": {"login": "amaliujia"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigtable/BigtableTable.java", "diffHunk": "@@ -0,0 +1,200 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.extensions.sql.meta.provider.bigtable;\n+\n+import static java.util.stream.Collectors.toSet;\n+import static org.apache.beam.sdk.io.gcp.bigtable.RowUtils.COLUMNS_MAPPING;\n+import static org.apache.beam.sdk.io.gcp.bigtable.RowUtils.KEY;\n+import static org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.Lists.newArrayList;\n+\n+import com.alibaba.fastjson.JSONObject;\n+import java.io.Serializable;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import org.apache.beam.sdk.annotations.Experimental;\n+import org.apache.beam.sdk.extensions.sql.impl.BeamTableStatistics;\n+import org.apache.beam.sdk.extensions.sql.meta.SchemaBaseBeamTable;\n+import org.apache.beam.sdk.extensions.sql.meta.Table;\n+import org.apache.beam.sdk.extensions.sql.meta.provider.InvalidTableException;\n+import org.apache.beam.sdk.io.gcp.bigtable.BigtableIO;\n+import org.apache.beam.sdk.io.gcp.bigtable.BigtableRowToBeamRow;\n+import org.apache.beam.sdk.io.gcp.bigtable.BigtableRowToBeamRowFlat;\n+import org.apache.beam.sdk.options.PipelineOptions;\n+import org.apache.beam.sdk.schemas.Schema;\n+import org.apache.beam.sdk.values.PBegin;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.Row;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.base.Splitter;\n+\n+@Experimental\n+public class BigtableTable extends SchemaBaseBeamTable implements Serializable {\n+  // Should match:\n+  // googleapis.com/bigtable/projects/projectId/instances/instanceId/tables/tableId\"\n+  private static final Pattern locationPattern =\n+      Pattern.compile(\n+          \"(?<host>.+)/bigtable/projects/(?<projectId>.+)/instances/(?<instanceId>.+)/tables/(?<tableId>.+)\");\n+\n+  private final String projectId;\n+  private final String instanceId;\n+  private final String tableId;\n+  private String emulatorHost = \"\";\n+\n+  private boolean useFlatSchema = false;\n+\n+  private Map<String, List<String>> columnsMapping = new HashMap<>();\n+\n+  BigtableTable(Table table) {\n+    super(table.getSchema());\n+    validateSchema(schema);\n+\n+    String location = table.getLocation();\n+    if (location == null) {\n+      throw new IllegalStateException(\"LOCATION is required\");\n+    }\n+    Matcher matcher = locationPattern.matcher(location);\n+    validateMatcher(matcher, location);\n+\n+    this.projectId = getMatcherValue(matcher, \"projectId\");\n+    this.instanceId = getMatcherValue(matcher, \"instanceId\");\n+    this.tableId = getMatcherValue(matcher, \"tableId\");\n+    String host = getMatcherValue(matcher, \"host\"); // googleapis.com or localhost:<PORT>\n+    if (!\"googleapis.com\".equals(host)) {\n+      this.emulatorHost = host;\n+    }\n+\n+    JSONObject properties = table.getProperties();\n+    if (properties.containsKey(COLUMNS_MAPPING)) {\n+      columnsMapping = parseColumnsMapping(properties.getString(COLUMNS_MAPPING));\n+      validateColumnsMapping(columnsMapping, schema);\n+      useFlatSchema = true;\n+    }\n+  }\n+\n+  @Override\n+  public PCollection<Row> buildIOReader(PBegin begin) {\n+    BigtableIO.Read readTransform =\n+        BigtableIO.read().withProjectId(projectId).withInstanceId(instanceId).withTableId(tableId);\n+    if (!emulatorHost.isEmpty()) {\n+      readTransform = readTransform.withEmulator(emulatorHost);\n+    }\n+    return readTransform\n+        .expand(begin)\n+        .apply(\n+            \"BigtableRowToBeamRow\",\n+            useFlatSchema\n+                ? new BigtableRowToBeamRowFlat(schema, columnsMapping)\n+                : new BigtableRowToBeamRow(schema))\n+        .setRowSchema(schema);\n+  }\n+\n+  @Override\n+  public POutput buildIOWriter(PCollection<Row> input) {\n+    throw new UnsupportedOperationException(\"Write to Cloud Bigtable is not yet supported\");\n+  }\n+\n+  @Override\n+  public PCollection.IsBounded isBounded() {\n+    return PCollection.IsBounded.BOUNDED;\n+  }\n+\n+  @Override\n+  public BeamTableStatistics getTableStatistics(PipelineOptions options) {\n+    return BeamTableStatistics.BOUNDED_UNKNOWN;\n+  }\n+\n+  private static Map<String, List<String>> parseColumnsMapping(String commaSeparatedMapping) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff234c6cea73577ec63b867faecd2671dc649610"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQxMzEwNg==", "bodyText": "I've remembered why they were static. That's because of null checker - it refuses to use non-static functions in the constructor (got required Initialized andNonNull BigtableTable error)", "url": "https://github.com/apache/beam/pull/13319#discussion_r529413106", "createdAt": "2020-11-24T10:23:36Z", "author": {"login": "piotr-szuberski"}, "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigtable/BigtableTable.java", "diffHunk": "@@ -0,0 +1,200 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.extensions.sql.meta.provider.bigtable;\n+\n+import static java.util.stream.Collectors.toSet;\n+import static org.apache.beam.sdk.io.gcp.bigtable.RowUtils.COLUMNS_MAPPING;\n+import static org.apache.beam.sdk.io.gcp.bigtable.RowUtils.KEY;\n+import static org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.Lists.newArrayList;\n+\n+import com.alibaba.fastjson.JSONObject;\n+import java.io.Serializable;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import org.apache.beam.sdk.annotations.Experimental;\n+import org.apache.beam.sdk.extensions.sql.impl.BeamTableStatistics;\n+import org.apache.beam.sdk.extensions.sql.meta.SchemaBaseBeamTable;\n+import org.apache.beam.sdk.extensions.sql.meta.Table;\n+import org.apache.beam.sdk.extensions.sql.meta.provider.InvalidTableException;\n+import org.apache.beam.sdk.io.gcp.bigtable.BigtableIO;\n+import org.apache.beam.sdk.io.gcp.bigtable.BigtableRowToBeamRow;\n+import org.apache.beam.sdk.io.gcp.bigtable.BigtableRowToBeamRowFlat;\n+import org.apache.beam.sdk.options.PipelineOptions;\n+import org.apache.beam.sdk.schemas.Schema;\n+import org.apache.beam.sdk.values.PBegin;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.Row;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.base.Splitter;\n+\n+@Experimental\n+public class BigtableTable extends SchemaBaseBeamTable implements Serializable {\n+  // Should match:\n+  // googleapis.com/bigtable/projects/projectId/instances/instanceId/tables/tableId\"\n+  private static final Pattern locationPattern =\n+      Pattern.compile(\n+          \"(?<host>.+)/bigtable/projects/(?<projectId>.+)/instances/(?<instanceId>.+)/tables/(?<tableId>.+)\");\n+\n+  private final String projectId;\n+  private final String instanceId;\n+  private final String tableId;\n+  private String emulatorHost = \"\";\n+\n+  private boolean useFlatSchema = false;\n+\n+  private Map<String, List<String>> columnsMapping = new HashMap<>();\n+\n+  BigtableTable(Table table) {\n+    super(table.getSchema());\n+    validateSchema(schema);\n+\n+    String location = table.getLocation();\n+    if (location == null) {\n+      throw new IllegalStateException(\"LOCATION is required\");\n+    }\n+    Matcher matcher = locationPattern.matcher(location);\n+    validateMatcher(matcher, location);\n+\n+    this.projectId = getMatcherValue(matcher, \"projectId\");\n+    this.instanceId = getMatcherValue(matcher, \"instanceId\");\n+    this.tableId = getMatcherValue(matcher, \"tableId\");\n+    String host = getMatcherValue(matcher, \"host\"); // googleapis.com or localhost:<PORT>\n+    if (!\"googleapis.com\".equals(host)) {\n+      this.emulatorHost = host;\n+    }\n+\n+    JSONObject properties = table.getProperties();\n+    if (properties.containsKey(COLUMNS_MAPPING)) {\n+      columnsMapping = parseColumnsMapping(properties.getString(COLUMNS_MAPPING));\n+      validateColumnsMapping(columnsMapping, schema);\n+      useFlatSchema = true;\n+    }\n+  }\n+\n+  @Override\n+  public PCollection<Row> buildIOReader(PBegin begin) {\n+    BigtableIO.Read readTransform =\n+        BigtableIO.read().withProjectId(projectId).withInstanceId(instanceId).withTableId(tableId);\n+    if (!emulatorHost.isEmpty()) {\n+      readTransform = readTransform.withEmulator(emulatorHost);\n+    }\n+    return readTransform\n+        .expand(begin)\n+        .apply(\n+            \"BigtableRowToBeamRow\",\n+            useFlatSchema\n+                ? new BigtableRowToBeamRowFlat(schema, columnsMapping)\n+                : new BigtableRowToBeamRow(schema))\n+        .setRowSchema(schema);\n+  }\n+\n+  @Override\n+  public POutput buildIOWriter(PCollection<Row> input) {\n+    throw new UnsupportedOperationException(\"Write to Cloud Bigtable is not yet supported\");\n+  }\n+\n+  @Override\n+  public PCollection.IsBounded isBounded() {\n+    return PCollection.IsBounded.BOUNDED;\n+  }\n+\n+  @Override\n+  public BeamTableStatistics getTableStatistics(PipelineOptions options) {\n+    return BeamTableStatistics.BOUNDED_UNKNOWN;\n+  }\n+\n+  private static Map<String, List<String>> parseColumnsMapping(String commaSeparatedMapping) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODk2OTEwMg=="}, "originalCommit": {"oid": "ff234c6cea73577ec63b867faecd2671dc649610"}, "originalPosition": 126}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNzY4NDYzOnYy", "diffSide": "RIGHT", "path": "sdks/java/extensions/sql/src/test/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigtable/BigtableTableCreationFailuresTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMToxNjozN1rOH4fprA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMDowMzo0M1rOH43VEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAwMDg3Ng==", "bodyText": "Add a test to hit\n  private static void validateMatcher(Matcher matcher, String location) {\n    if (!matcher.matches()) {\n      throw new InvalidTableException(\n          \"Bigtable location must be in the following format:\"\n              + \" 'googleapis.com/bigtable/projects/projectId/instances/instanceId/tables/tableId'\"\n              + \" but was: \"\n              + location);\n    }\n  }\n\n?", "url": "https://github.com/apache/beam/pull/13319#discussion_r529000876", "createdAt": "2020-11-23T21:16:37Z", "author": {"login": "amaliujia"}, "path": "sdks/java/extensions/sql/src/test/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigtable/BigtableTableCreationFailuresTest.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.extensions.sql.meta.provider.bigtable;\n+\n+import static org.apache.beam.sdk.io.gcp.testing.BigtableTestUtils.checkMessage;\n+import static org.junit.Assert.assertThrows;\n+\n+import org.apache.beam.sdk.extensions.sql.BeamSqlCli;\n+import org.apache.beam.sdk.extensions.sql.impl.ParseException;\n+import org.apache.beam.sdk.extensions.sql.meta.Table;\n+import org.apache.beam.sdk.extensions.sql.meta.provider.TableProvider;\n+import org.apache.beam.sdk.extensions.sql.meta.store.InMemoryMetaStore;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+@SuppressWarnings({\n+  \"nullness\" // TODO(https://issues.apache.org/jira/browse/BEAM-10402)\n+})\n+public class BigtableTableCreationFailuresTest {\n+\n+  private final InMemoryMetaStore metaStore = new InMemoryMetaStore();\n+  private final TableProvider tableProvider = new BigtableTableProvider();\n+  private BeamSqlCli cli;\n+\n+  @Before\n+  public void setUp() {\n+    metaStore.registerProvider(tableProvider);\n+    cli = new BeamSqlCli().metaStore(metaStore);\n+  }\n+\n+  @Test\n+  public void testCreateWithoutTypeFails() {\n+    String createTable = \"CREATE EXTERNAL TABLE failure(something VARCHAR)\";\n+    ParseException e = assertThrows(ParseException.class, () -> cli.execute(createTable));\n+    checkMessage(e.getMessage(), \"Unable to parse query\");\n+  }\n+\n+  @Test\n+  public void testCreateWithoutLocationFails() {\n+    String createTable =\n+        \"CREATE EXTERNAL TABLE fail(key VARCHAR, something VARCHAR) \\n\" + \"TYPE bigtable \\n\";\n+    cli.execute(createTable);\n+    Table table = metaStore.getTables().get(\"fail\");\n+\n+    IllegalStateException e =\n+        assertThrows(IllegalStateException.class, () -> tableProvider.buildBeamSqlTable(table));\n+    checkMessage(e.getMessage(), \"LOCATION\");\n+  }\n+\n+  @Test\n+  public void testCreateWithoutKeyFails() {\n+    String createTable =\n+        \"CREATE EXTERNAL TABLE fail(something VARCHAR) \\n\"\n+            + \"TYPE bigtable \\n\"\n+            + \"LOCATION '\"\n+            + location()\n+            + \"'\";\n+    cli.execute(createTable);\n+    Table table = metaStore.getTables().get(\"fail\");\n+    IllegalStateException e =\n+        assertThrows(IllegalStateException.class, () -> tableProvider.buildBeamSqlTable(table));\n+    checkMessage(e.getMessage(), \"Schema has to contain 'key' field\");\n+  }\n+\n+  @Test\n+  public void testCreateWrongKeyTypeFails() {\n+    String createTable =\n+        \"CREATE EXTERNAL TABLE fail(key FLOAT) \\n\"\n+            + \"TYPE bigtable \\n\"\n+            + \"LOCATION '\"\n+            + location()\n+            + \"'\";\n+    cli.execute(createTable);\n+    Table table = metaStore.getTables().get(\"fail\");\n+    IllegalArgumentException e =\n+        assertThrows(IllegalArgumentException.class, () -> tableProvider.buildBeamSqlTable(table));\n+    checkMessage(e.getMessage(), \"key field type should be STRING but was FLOAT\");\n+  }\n+\n+  @Test\n+  public void testCreatePropertiesDontMatchSchema() {\n+    String createTable =\n+        \"CREATE EXTERNAL TABLE fail(key VARCHAR, q BIGINT, qq BINARY) \\n\"\n+            + \"TYPE bigtable \\n\"\n+            + \"LOCATION '\"\n+            + location()\n+            + \"' \\n\"\n+            + \"TBLPROPERTIES '{\\\"columnsMapping\\\": \\\"f:b,f:c\\\"}'\";\n+    cli.execute(createTable);\n+    Table table = metaStore.getTables().get(\"fail\");\n+    IllegalStateException e =\n+        assertThrows(IllegalStateException.class, () -> tableProvider.buildBeamSqlTable(table));\n+    checkMessage(e.getMessage(), \"does not fit to schema field names\");\n+  }\n+\n+  @Test\n+  public void testCreatePropertiesCountNotEqualSchemaFields() {\n+    String createTable =\n+        \"CREATE EXTERNAL TABLE fail(key VARCHAR, q BIGINT, qq BINARY) \\n\"\n+            + \"TYPE bigtable \\n\"\n+            + \"LOCATION '\"\n+            + location()\n+            + \"' \\n\"\n+            + \"TBLPROPERTIES '{\\\"columnsMapping\\\": \\\"f:q\\\"}'\";\n+    cli.execute(createTable);\n+    Table table = metaStore.getTables().get(\"fail\");\n+    IllegalStateException e =\n+        assertThrows(IllegalStateException.class, () -> tableProvider.buildBeamSqlTable(table));\n+    checkMessage(e.getMessage(), \"Schema fields count: '2' does not fit columnsMapping count: '1'\");\n+  }\n+\n+  private static String location() {\n+    return \"googleapis.com/bigtable/projects/fakeProject/instances/fakeInstance/tables/beamTable\";\n+  }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff234c6cea73577ec63b867faecd2671dc649610"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTM4ODgxOA==", "bodyText": "Done.", "url": "https://github.com/apache/beam/pull/13319#discussion_r529388818", "createdAt": "2020-11-24T10:03:43Z", "author": {"login": "piotr-szuberski"}, "path": "sdks/java/extensions/sql/src/test/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigtable/BigtableTableCreationFailuresTest.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.extensions.sql.meta.provider.bigtable;\n+\n+import static org.apache.beam.sdk.io.gcp.testing.BigtableTestUtils.checkMessage;\n+import static org.junit.Assert.assertThrows;\n+\n+import org.apache.beam.sdk.extensions.sql.BeamSqlCli;\n+import org.apache.beam.sdk.extensions.sql.impl.ParseException;\n+import org.apache.beam.sdk.extensions.sql.meta.Table;\n+import org.apache.beam.sdk.extensions.sql.meta.provider.TableProvider;\n+import org.apache.beam.sdk.extensions.sql.meta.store.InMemoryMetaStore;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+@SuppressWarnings({\n+  \"nullness\" // TODO(https://issues.apache.org/jira/browse/BEAM-10402)\n+})\n+public class BigtableTableCreationFailuresTest {\n+\n+  private final InMemoryMetaStore metaStore = new InMemoryMetaStore();\n+  private final TableProvider tableProvider = new BigtableTableProvider();\n+  private BeamSqlCli cli;\n+\n+  @Before\n+  public void setUp() {\n+    metaStore.registerProvider(tableProvider);\n+    cli = new BeamSqlCli().metaStore(metaStore);\n+  }\n+\n+  @Test\n+  public void testCreateWithoutTypeFails() {\n+    String createTable = \"CREATE EXTERNAL TABLE failure(something VARCHAR)\";\n+    ParseException e = assertThrows(ParseException.class, () -> cli.execute(createTable));\n+    checkMessage(e.getMessage(), \"Unable to parse query\");\n+  }\n+\n+  @Test\n+  public void testCreateWithoutLocationFails() {\n+    String createTable =\n+        \"CREATE EXTERNAL TABLE fail(key VARCHAR, something VARCHAR) \\n\" + \"TYPE bigtable \\n\";\n+    cli.execute(createTable);\n+    Table table = metaStore.getTables().get(\"fail\");\n+\n+    IllegalStateException e =\n+        assertThrows(IllegalStateException.class, () -> tableProvider.buildBeamSqlTable(table));\n+    checkMessage(e.getMessage(), \"LOCATION\");\n+  }\n+\n+  @Test\n+  public void testCreateWithoutKeyFails() {\n+    String createTable =\n+        \"CREATE EXTERNAL TABLE fail(something VARCHAR) \\n\"\n+            + \"TYPE bigtable \\n\"\n+            + \"LOCATION '\"\n+            + location()\n+            + \"'\";\n+    cli.execute(createTable);\n+    Table table = metaStore.getTables().get(\"fail\");\n+    IllegalStateException e =\n+        assertThrows(IllegalStateException.class, () -> tableProvider.buildBeamSqlTable(table));\n+    checkMessage(e.getMessage(), \"Schema has to contain 'key' field\");\n+  }\n+\n+  @Test\n+  public void testCreateWrongKeyTypeFails() {\n+    String createTable =\n+        \"CREATE EXTERNAL TABLE fail(key FLOAT) \\n\"\n+            + \"TYPE bigtable \\n\"\n+            + \"LOCATION '\"\n+            + location()\n+            + \"'\";\n+    cli.execute(createTable);\n+    Table table = metaStore.getTables().get(\"fail\");\n+    IllegalArgumentException e =\n+        assertThrows(IllegalArgumentException.class, () -> tableProvider.buildBeamSqlTable(table));\n+    checkMessage(e.getMessage(), \"key field type should be STRING but was FLOAT\");\n+  }\n+\n+  @Test\n+  public void testCreatePropertiesDontMatchSchema() {\n+    String createTable =\n+        \"CREATE EXTERNAL TABLE fail(key VARCHAR, q BIGINT, qq BINARY) \\n\"\n+            + \"TYPE bigtable \\n\"\n+            + \"LOCATION '\"\n+            + location()\n+            + \"' \\n\"\n+            + \"TBLPROPERTIES '{\\\"columnsMapping\\\": \\\"f:b,f:c\\\"}'\";\n+    cli.execute(createTable);\n+    Table table = metaStore.getTables().get(\"fail\");\n+    IllegalStateException e =\n+        assertThrows(IllegalStateException.class, () -> tableProvider.buildBeamSqlTable(table));\n+    checkMessage(e.getMessage(), \"does not fit to schema field names\");\n+  }\n+\n+  @Test\n+  public void testCreatePropertiesCountNotEqualSchemaFields() {\n+    String createTable =\n+        \"CREATE EXTERNAL TABLE fail(key VARCHAR, q BIGINT, qq BINARY) \\n\"\n+            + \"TYPE bigtable \\n\"\n+            + \"LOCATION '\"\n+            + location()\n+            + \"' \\n\"\n+            + \"TBLPROPERTIES '{\\\"columnsMapping\\\": \\\"f:q\\\"}'\";\n+    cli.execute(createTable);\n+    Table table = metaStore.getTables().get(\"fail\");\n+    IllegalStateException e =\n+        assertThrows(IllegalStateException.class, () -> tableProvider.buildBeamSqlTable(table));\n+    checkMessage(e.getMessage(), \"Schema fields count: '2' does not fit columnsMapping count: '1'\");\n+  }\n+\n+  private static String location() {\n+    return \"googleapis.com/bigtable/projects/fakeProject/instances/fakeInstance/tables/beamTable\";\n+  }\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAwMDg3Ng=="}, "originalCommit": {"oid": "ff234c6cea73577ec63b867faecd2671dc649610"}, "originalPosition": 130}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNzcwODI2OnYy", "diffSide": "RIGHT", "path": "website/www/site/content/en/documentation/dsls/sql/extensions/create-external-table.md", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QyMToyMjowMVrOH4f38A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwOToxMTozM1rOH5ppSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAwNDUyOA==", "bodyText": "So what is the reason that single type only supports these 5 types (i.e. not include other SQL types like TIMESTAMP)?", "url": "https://github.com/apache/beam/pull/13319#discussion_r529004528", "createdAt": "2020-11-23T21:22:01Z", "author": {"login": "amaliujia"}, "path": "website/www/site/content/en/documentation/dsls/sql/extensions/create-external-table.md", "diffHunk": "@@ -204,6 +205,131 @@ TYPE bigquery\n LOCATION 'testing-integration:apache.users'\n ```\n \n+## Cloud Bigtable\n+\n+### Syntax\n+\n+```\n+CREATE EXTERNAL TABLE [ IF NOT EXISTS ] tableName (\n+    key VARCHAR NOT NULL,\n+    family ROW<qualifier cells [, qualifier cells ]* >\n+    [, family ROW< qualifier cells [, qualifier cells ]* > ]*\n+)\n+TYPE bigtable\n+LOCATION 'googleapis.com/bigtable/projects/[PROJECT_ID]/instances/[INSTANCE_ID]/tables/[TABLE]'\n+```\n+\n+*   `key`: key of the Bigtable row\n+*   `family`: name of the column family\n+*   `qualifier`: the column qualifier\n+*   `cells`: Either of each value:\n+    *   `TYPE`\n+    *   `ARRAY<SIMPLE_TYPE>`\n+*   `LOCATION`:\n+    *   `PROJECT_ID`: ID of the Google Cloud Project.\n+    *   `INSTANCE_ID`: Bigtable instance ID.\n+    *   `TABLE`: Bigtable Table ID.\n+*   `TYPE`: `SIMPLE_TYPE` or `CELL_ROW`\n+*   `CELL_ROW`: `ROW<val SIMPLE_TYPE [, timestampMicros BIGINT [NOT NULL]] [, labels ARRAY<VARCHAR> [NOT NULL]]`\n+*   `SIMPLE_TYPE`: on of the following:\n+    *   `BINARY`\n+    *   `VARCHAR`\n+    *   `BIGINT`\n+    *   `DOUBLE`\n+    *   `BOOLEAN`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff234c6cea73577ec63b867faecd2671dc649610"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQyMTM2Nw==", "bodyText": "BigQuery supports only those 5 types. But I agree that there is no reason why not to support others as well. Should I do that in this PR or in the next one?", "url": "https://github.com/apache/beam/pull/13319#discussion_r529421367", "createdAt": "2020-11-24T10:30:10Z", "author": {"login": "piotr-szuberski"}, "path": "website/www/site/content/en/documentation/dsls/sql/extensions/create-external-table.md", "diffHunk": "@@ -204,6 +205,131 @@ TYPE bigquery\n LOCATION 'testing-integration:apache.users'\n ```\n \n+## Cloud Bigtable\n+\n+### Syntax\n+\n+```\n+CREATE EXTERNAL TABLE [ IF NOT EXISTS ] tableName (\n+    key VARCHAR NOT NULL,\n+    family ROW<qualifier cells [, qualifier cells ]* >\n+    [, family ROW< qualifier cells [, qualifier cells ]* > ]*\n+)\n+TYPE bigtable\n+LOCATION 'googleapis.com/bigtable/projects/[PROJECT_ID]/instances/[INSTANCE_ID]/tables/[TABLE]'\n+```\n+\n+*   `key`: key of the Bigtable row\n+*   `family`: name of the column family\n+*   `qualifier`: the column qualifier\n+*   `cells`: Either of each value:\n+    *   `TYPE`\n+    *   `ARRAY<SIMPLE_TYPE>`\n+*   `LOCATION`:\n+    *   `PROJECT_ID`: ID of the Google Cloud Project.\n+    *   `INSTANCE_ID`: Bigtable instance ID.\n+    *   `TABLE`: Bigtable Table ID.\n+*   `TYPE`: `SIMPLE_TYPE` or `CELL_ROW`\n+*   `CELL_ROW`: `ROW<val SIMPLE_TYPE [, timestampMicros BIGINT [NOT NULL]] [, labels ARRAY<VARCHAR> [NOT NULL]]`\n+*   `SIMPLE_TYPE`: on of the following:\n+    *   `BINARY`\n+    *   `VARCHAR`\n+    *   `BIGINT`\n+    *   `DOUBLE`\n+    *   `BOOLEAN`", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAwNDUyOA=="}, "originalCommit": {"oid": "ff234c6cea73577ec63b867faecd2671dc649610"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDEwMDQzNQ==", "bodyText": "Maybe just do that in this PR to make this feature complete?", "url": "https://github.com/apache/beam/pull/13319#discussion_r530100435", "createdAt": "2020-11-25T04:27:09Z", "author": {"login": "amaliujia"}, "path": "website/www/site/content/en/documentation/dsls/sql/extensions/create-external-table.md", "diffHunk": "@@ -204,6 +205,131 @@ TYPE bigquery\n LOCATION 'testing-integration:apache.users'\n ```\n \n+## Cloud Bigtable\n+\n+### Syntax\n+\n+```\n+CREATE EXTERNAL TABLE [ IF NOT EXISTS ] tableName (\n+    key VARCHAR NOT NULL,\n+    family ROW<qualifier cells [, qualifier cells ]* >\n+    [, family ROW< qualifier cells [, qualifier cells ]* > ]*\n+)\n+TYPE bigtable\n+LOCATION 'googleapis.com/bigtable/projects/[PROJECT_ID]/instances/[INSTANCE_ID]/tables/[TABLE]'\n+```\n+\n+*   `key`: key of the Bigtable row\n+*   `family`: name of the column family\n+*   `qualifier`: the column qualifier\n+*   `cells`: Either of each value:\n+    *   `TYPE`\n+    *   `ARRAY<SIMPLE_TYPE>`\n+*   `LOCATION`:\n+    *   `PROJECT_ID`: ID of the Google Cloud Project.\n+    *   `INSTANCE_ID`: Bigtable instance ID.\n+    *   `TABLE`: Bigtable Table ID.\n+*   `TYPE`: `SIMPLE_TYPE` or `CELL_ROW`\n+*   `CELL_ROW`: `ROW<val SIMPLE_TYPE [, timestampMicros BIGINT [NOT NULL]] [, labels ARRAY<VARCHAR> [NOT NULL]]`\n+*   `SIMPLE_TYPE`: on of the following:\n+    *   `BINARY`\n+    *   `VARCHAR`\n+    *   `BIGINT`\n+    *   `DOUBLE`\n+    *   `BOOLEAN`", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAwNDUyOA=="}, "originalCommit": {"oid": "ff234c6cea73577ec63b867faecd2671dc649610"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDIxMzE5Mg==", "bodyText": "Ok, will do!", "url": "https://github.com/apache/beam/pull/13319#discussion_r530213192", "createdAt": "2020-11-25T09:11:33Z", "author": {"login": "piotr-szuberski"}, "path": "website/www/site/content/en/documentation/dsls/sql/extensions/create-external-table.md", "diffHunk": "@@ -204,6 +205,131 @@ TYPE bigquery\n LOCATION 'testing-integration:apache.users'\n ```\n \n+## Cloud Bigtable\n+\n+### Syntax\n+\n+```\n+CREATE EXTERNAL TABLE [ IF NOT EXISTS ] tableName (\n+    key VARCHAR NOT NULL,\n+    family ROW<qualifier cells [, qualifier cells ]* >\n+    [, family ROW< qualifier cells [, qualifier cells ]* > ]*\n+)\n+TYPE bigtable\n+LOCATION 'googleapis.com/bigtable/projects/[PROJECT_ID]/instances/[INSTANCE_ID]/tables/[TABLE]'\n+```\n+\n+*   `key`: key of the Bigtable row\n+*   `family`: name of the column family\n+*   `qualifier`: the column qualifier\n+*   `cells`: Either of each value:\n+    *   `TYPE`\n+    *   `ARRAY<SIMPLE_TYPE>`\n+*   `LOCATION`:\n+    *   `PROJECT_ID`: ID of the Google Cloud Project.\n+    *   `INSTANCE_ID`: Bigtable instance ID.\n+    *   `TABLE`: Bigtable Table ID.\n+*   `TYPE`: `SIMPLE_TYPE` or `CELL_ROW`\n+*   `CELL_ROW`: `ROW<val SIMPLE_TYPE [, timestampMicros BIGINT [NOT NULL]] [, labels ARRAY<VARCHAR> [NOT NULL]]`\n+*   `SIMPLE_TYPE`: on of the following:\n+    *   `BINARY`\n+    *   `VARCHAR`\n+    *   `BIGINT`\n+    *   `DOUBLE`\n+    *   `BOOLEAN`", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAwNDUyOA=="}, "originalCommit": {"oid": "ff234c6cea73577ec63b867faecd2671dc649610"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2781, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}