{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3NjA5Njk0", "number": 11918, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNToyNjoyMlrOECnTSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTo0OToxNlrOECn_Zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMTc2NTIyOnYy", "diffSide": "RIGHT", "path": "website/www/site/content/en/contribute/release-guide.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNToyNjoyMlrOGfLbAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNToyNjoyMlrOGfLbAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM0NjE3OA==", "bodyText": "This should be apache/beam :)", "url": "https://github.com/apache/beam/pull/11918#discussion_r435346178", "createdAt": "2020-06-04T15:26:22Z", "author": {"login": "TheNeuralBit"}, "path": "website/www/site/content/en/contribute/release-guide.md", "diffHunk": "@@ -1134,12 +1134,29 @@ Create and push a new signed tag for the released version by copying the tag for\n     git tag -s \"$VERSION_TAG\" \"$RC_TAG\"\n     git push upstream \"$VERSION_TAG\"\n \n-After the tag is uploaded, publish the release in the Github UI.\n-1. Navigate to `https://github.com/apache/beam/releases/tag/$VERSION_TAG`.\n-1. Click the \"Edit tag\" button.\n-1. Give the release a title, such as `Beam 2.21.0`.\n-1. For the release description, copy the current version's changes from `CHANGES.md`. (You may want to touch up the formatting a bit.)\n-1. Click the \"Publish release\" button.\n+After the tag is uploaded, publish the release by calling the Github API (Make sure that the `GITHUB_TOKEN` variable is set):\n+\n+    json_escape () {\n+        printf '%s' \"$1\" | python -c 'import json,sys; print(json.dumps(sys.stdin.read()))'\n+    }\n+    \n+    RELEASE_NOTES=$(sed -n '/^We are happy/,$p' website/www/site/content/en/blog/beam-${RELEASE}.md)\n+    ESCAPED_NOTES=$(json_escape ${RELEASE_NOTES})\n+    \n+    RELEASE_JSON=\"$(cat <<-EOF\n+    {\n+      \"tag_name\": \"${VERSION_TAG}\",\n+      \"name\": \"Beam ${RELEASE} release\",\n+      \"body\": ${ESCAPED_NOTES}\n+    }\n+    EOF\n+    )\"\n+    \n+    curl https://api.github.com/repos/jphalip/beam/releases \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59b87d87c3cedf89fda11f5cf31c066c852064d6"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMTc5NjAyOnYy", "diffSide": "RIGHT", "path": "website/www/site/content/en/contribute/release-guide.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTozMzowOVrOGfLuHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTozMzowOVrOGfLuHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1MTA3MA==", "bodyText": "There's an earlier step in the release guide that has us create a github token and write it to script.config. It would be nice if this were a script in release/src/main/scripts/ and could read the same token from script.config.", "url": "https://github.com/apache/beam/pull/11918#discussion_r435351070", "createdAt": "2020-06-04T15:33:09Z", "author": {"login": "TheNeuralBit"}, "path": "website/www/site/content/en/contribute/release-guide.md", "diffHunk": "@@ -1134,12 +1134,29 @@ Create and push a new signed tag for the released version by copying the tag for\n     git tag -s \"$VERSION_TAG\" \"$RC_TAG\"\n     git push upstream \"$VERSION_TAG\"\n \n-After the tag is uploaded, publish the release in the Github UI.\n-1. Navigate to `https://github.com/apache/beam/releases/tag/$VERSION_TAG`.\n-1. Click the \"Edit tag\" button.\n-1. Give the release a title, such as `Beam 2.21.0`.\n-1. For the release description, copy the current version's changes from `CHANGES.md`. (You may want to touch up the formatting a bit.)\n-1. Click the \"Publish release\" button.\n+After the tag is uploaded, publish the release by calling the Github API (Make sure that the `GITHUB_TOKEN` variable is set):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59b87d87c3cedf89fda11f5cf31c066c852064d6"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMTgzMTY3OnYy", "diffSide": "RIGHT", "path": "website/www/site/content/en/contribute/release-guide.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTozODo1NFrOGfMEUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTozODo1NFrOGfMEUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1Njc1NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                curl https://api.github.com/repos/jphalip/beam/releases \\\n          \n          \n            \n                curl https://api.github.com/repos/apache/beam/releases \\", "url": "https://github.com/apache/beam/pull/11918#discussion_r435356754", "createdAt": "2020-06-04T15:38:54Z", "author": {"login": "ibzib"}, "path": "website/www/site/content/en/contribute/release-guide.md", "diffHunk": "@@ -1134,12 +1134,29 @@ Create and push a new signed tag for the released version by copying the tag for\n     git tag -s \"$VERSION_TAG\" \"$RC_TAG\"\n     git push upstream \"$VERSION_TAG\"\n \n-After the tag is uploaded, publish the release in the Github UI.\n-1. Navigate to `https://github.com/apache/beam/releases/tag/$VERSION_TAG`.\n-1. Click the \"Edit tag\" button.\n-1. Give the release a title, such as `Beam 2.21.0`.\n-1. For the release description, copy the current version's changes from `CHANGES.md`. (You may want to touch up the formatting a bit.)\n-1. Click the \"Publish release\" button.\n+After the tag is uploaded, publish the release by calling the Github API (Make sure that the `GITHUB_TOKEN` variable is set):\n+\n+    json_escape () {\n+        printf '%s' \"$1\" | python -c 'import json,sys; print(json.dumps(sys.stdin.read()))'\n+    }\n+    \n+    RELEASE_NOTES=$(sed -n '/^We are happy/,$p' website/www/site/content/en/blog/beam-${RELEASE}.md)\n+    ESCAPED_NOTES=$(json_escape ${RELEASE_NOTES})\n+    \n+    RELEASE_JSON=\"$(cat <<-EOF\n+    {\n+      \"tag_name\": \"${VERSION_TAG}\",\n+      \"name\": \"Beam ${RELEASE} release\",\n+      \"body\": ${ESCAPED_NOTES}\n+    }\n+    EOF\n+    )\"\n+    \n+    curl https://api.github.com/repos/jphalip/beam/releases \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59b87d87c3cedf89fda11f5cf31c066c852064d6"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMTg2NDMzOnYy", "diffSide": "RIGHT", "path": "website/www/site/content/en/contribute/release-guide.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTo0NTozOFrOGfMY4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTo0NTozOFrOGfMY4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM2MjAxOA==", "bodyText": "It could be more robust to look for the license comment, I'm not quite sure how this sed command works but if you can make it retrieve everything after a multiline match something like this could work: <!--.*Apache License, Version 2\\.0.*-->.\nI'd be fine leaving it as-is, but if we do there should be some kind of trap for when \"We are happy\" isn't matched so we don't unintentionally publish empty release notes.", "url": "https://github.com/apache/beam/pull/11918#discussion_r435362018", "createdAt": "2020-06-04T15:45:38Z", "author": {"login": "TheNeuralBit"}, "path": "website/www/site/content/en/contribute/release-guide.md", "diffHunk": "@@ -1134,12 +1134,29 @@ Create and push a new signed tag for the released version by copying the tag for\n     git tag -s \"$VERSION_TAG\" \"$RC_TAG\"\n     git push upstream \"$VERSION_TAG\"\n \n-After the tag is uploaded, publish the release in the Github UI.\n-1. Navigate to `https://github.com/apache/beam/releases/tag/$VERSION_TAG`.\n-1. Click the \"Edit tag\" button.\n-1. Give the release a title, such as `Beam 2.21.0`.\n-1. For the release description, copy the current version's changes from `CHANGES.md`. (You may want to touch up the formatting a bit.)\n-1. Click the \"Publish release\" button.\n+After the tag is uploaded, publish the release by calling the Github API (Make sure that the `GITHUB_TOKEN` variable is set):\n+\n+    json_escape () {\n+        printf '%s' \"$1\" | python -c 'import json,sys; print(json.dumps(sys.stdin.read()))'\n+    }\n+    \n+    RELEASE_NOTES=$(sed -n '/^We are happy/,$p' website/www/site/content/en/blog/beam-${RELEASE}.md)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59b87d87c3cedf89fda11f5cf31c066c852064d6"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMTg3MzczOnYy", "diffSide": "RIGHT", "path": "website/www/site/content/en/contribute/release-guide.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTo0ODowNVrOGfMfMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTo0ODowNVrOGfMfMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM2MzYzMw==", "bodyText": "Maybe instead we could just remove the webpage header. (We could probably keep the license, since it's in a comment.)", "url": "https://github.com/apache/beam/pull/11918#discussion_r435363633", "createdAt": "2020-06-04T15:48:05Z", "author": {"login": "ibzib"}, "path": "website/www/site/content/en/contribute/release-guide.md", "diffHunk": "@@ -1134,12 +1134,29 @@ Create and push a new signed tag for the released version by copying the tag for\n     git tag -s \"$VERSION_TAG\" \"$RC_TAG\"\n     git push upstream \"$VERSION_TAG\"\n \n-After the tag is uploaded, publish the release in the Github UI.\n-1. Navigate to `https://github.com/apache/beam/releases/tag/$VERSION_TAG`.\n-1. Click the \"Edit tag\" button.\n-1. Give the release a title, such as `Beam 2.21.0`.\n-1. For the release description, copy the current version's changes from `CHANGES.md`. (You may want to touch up the formatting a bit.)\n-1. Click the \"Publish release\" button.\n+After the tag is uploaded, publish the release by calling the Github API (Make sure that the `GITHUB_TOKEN` variable is set):\n+\n+    json_escape () {\n+        printf '%s' \"$1\" | python -c 'import json,sys; print(json.dumps(sys.stdin.read()))'\n+    }\n+    \n+    RELEASE_NOTES=$(sed -n '/^We are happy/,$p' website/www/site/content/en/blog/beam-${RELEASE}.md)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59b87d87c3cedf89fda11f5cf31c066c852064d6"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMTg3ODE1OnYy", "diffSide": "RIGHT", "path": "website/www/site/content/en/contribute/release-guide.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTo0OToxNlrOGfMiLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNTo0OToxNlrOGfMiLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM2NDM5Nw==", "bodyText": "Perhaps we should print the body and ask for user confirmation before uploading.", "url": "https://github.com/apache/beam/pull/11918#discussion_r435364397", "createdAt": "2020-06-04T15:49:16Z", "author": {"login": "ibzib"}, "path": "website/www/site/content/en/contribute/release-guide.md", "diffHunk": "@@ -1134,12 +1134,29 @@ Create and push a new signed tag for the released version by copying the tag for\n     git tag -s \"$VERSION_TAG\" \"$RC_TAG\"\n     git push upstream \"$VERSION_TAG\"\n \n-After the tag is uploaded, publish the release in the Github UI.\n-1. Navigate to `https://github.com/apache/beam/releases/tag/$VERSION_TAG`.\n-1. Click the \"Edit tag\" button.\n-1. Give the release a title, such as `Beam 2.21.0`.\n-1. For the release description, copy the current version's changes from `CHANGES.md`. (You may want to touch up the formatting a bit.)\n-1. Click the \"Publish release\" button.\n+After the tag is uploaded, publish the release by calling the Github API (Make sure that the `GITHUB_TOKEN` variable is set):\n+\n+    json_escape () {\n+        printf '%s' \"$1\" | python -c 'import json,sys; print(json.dumps(sys.stdin.read()))'\n+    }\n+    \n+    RELEASE_NOTES=$(sed -n '/^We are happy/,$p' website/www/site/content/en/blog/beam-${RELEASE}.md)\n+    ESCAPED_NOTES=$(json_escape ${RELEASE_NOTES})\n+    \n+    RELEASE_JSON=\"$(cat <<-EOF\n+    {\n+      \"tag_name\": \"${VERSION_TAG}\",\n+      \"name\": \"Beam ${RELEASE} release\",\n+      \"body\": ${ESCAPED_NOTES}\n+    }\n+    EOF\n+    )\"\n+    \n+    curl https://api.github.com/repos/jphalip/beam/releases \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59b87d87c3cedf89fda11f5cf31c066c852064d6"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3608, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}