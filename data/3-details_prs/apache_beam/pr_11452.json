{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MzA2Mjgx", "number": 11452, "title": "[BEAM-9692] Move apply_Read to PTransformOverride", "bodyText": "This moves the DataflowRunner apply_Read to a PTransformOverride implementation. In order for Dataflow to pick the correct coder for the generated ParallelRead step, we set the output PCollection element_type to the coder's type hint. The BigQuerySource by default uses the RowAsDictJsonCoder. This PR also implements the to_type_hint for that coder.\n\nThank you for your contribution! Follow this checklist to help us incorporate your contribution quickly and easily:\n\n Choose reviewer(s) and mention them in a comment (R: @username).\n Format the pull request title like [BEAM-XXX] Fixes bug in ApproximateQuantiles, where you replace BEAM-XXX with the appropriate JIRA issue, if applicable. This will automatically link the pull request to the issue.\n Update CHANGES.md with noteworthy changes.\n If this contribution is large, please file an Apache Individual Contributor License Agreement.\n\nSee the Contributor Guide for more tips on how to make review process smoother.\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nApex\nDataflow\nFlink\nGearpump\nSamza\nSpark\n\n\n\n\nGo\n\n---\n---\n\n---\n---\n\n\n\nJava\n\n\n\n\n\n\n\n\n\nPython\n\n---\n\n\n---\n---\n\n\n\nXLang\n---\n---\n---\n\n---\n---\n\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\n\n\n\n\nNon-portable\n\n\n\n\n\n\nPortable\n---\n\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.", "createdAt": "2020-04-17T19:37:45Z", "url": "https://github.com/apache/beam/pull/11452", "merged": true, "mergeCommit": {"oid": "93181e792f648122d3b4a5080d683f21c6338132"}, "closed": true, "closedAt": "2020-05-01T19:32:38Z", "author": {"login": "rohdesamuel"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYmn_KABqjMyNDU3Mzg2NDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcdG5T_gFqTQwNDM1NTgxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fb1d3737e6868ad7d6939d941ec2e9e2df34b18c", "author": {"user": {"login": "rohdesamuel", "name": "Sam sam"}}, "url": "https://github.com/apache/beam/commit/fb1d3737e6868ad7d6939d941ec2e9e2df34b18c", "committedDate": "2020-04-17T19:37:07Z", "message": "replace read\n\nChange-Id: I3f922f955883f02e8d9d6f34c0f4e1e2188da09c"}, "afterCommit": {"oid": "311ee71fd91f8349a985932e3bf58a220880682d", "author": {"user": {"login": "rohdesamuel", "name": "Sam sam"}}, "url": "https://github.com/apache/beam/commit/311ee71fd91f8349a985932e3bf58a220880682d", "committedDate": "2020-04-17T19:40:02Z", "message": "replace read\n\nChange-Id: I3f922f955883f02e8d9d6f34c0f4e1e2188da09c"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "311ee71fd91f8349a985932e3bf58a220880682d", "author": {"user": {"login": "rohdesamuel", "name": "Sam sam"}}, "url": "https://github.com/apache/beam/commit/311ee71fd91f8349a985932e3bf58a220880682d", "committedDate": "2020-04-17T19:40:02Z", "message": "replace read\n\nChange-Id: I3f922f955883f02e8d9d6f34c0f4e1e2188da09c"}, "afterCommit": {"oid": "666326487beb7950412ae353528b4fb1d000e945", "author": {"user": {"login": "rohdesamuel", "name": "Sam sam"}}, "url": "https://github.com/apache/beam/commit/666326487beb7950412ae353528b4fb1d000e945", "committedDate": "2020-04-22T00:11:17Z", "message": "[BEAM-9692] Replace the apply_read with a PTransformOverride\n\nChange-Id: Ie61304cb1ccd4e1f8d1c93ad547968cd36ff4910"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44cd1175f128074a2fec85c69409a341ccc8ac37", "author": {"user": {"login": "rohdesamuel", "name": "Sam sam"}}, "url": "https://github.com/apache/beam/commit/44cd1175f128074a2fec85c69409a341ccc8ac37", "committedDate": "2020-04-22T00:14:00Z", "message": "[BEAM-9692] Replace the apply_read with a PTransformOverride\n\nChange-Id: Ie61304cb1ccd4e1f8d1c93ad547968cd36ff4910"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "666326487beb7950412ae353528b4fb1d000e945", "author": {"user": {"login": "rohdesamuel", "name": "Sam sam"}}, "url": "https://github.com/apache/beam/commit/666326487beb7950412ae353528b4fb1d000e945", "committedDate": "2020-04-22T00:11:17Z", "message": "[BEAM-9692] Replace the apply_read with a PTransformOverride\n\nChange-Id: Ie61304cb1ccd4e1f8d1c93ad547968cd36ff4910"}, "afterCommit": {"oid": "44cd1175f128074a2fec85c69409a341ccc8ac37", "author": {"user": {"login": "rohdesamuel", "name": "Sam sam"}}, "url": "https://github.com/apache/beam/commit/44cd1175f128074a2fec85c69409a341ccc8ac37", "committedDate": "2020-04-22T00:14:00Z", "message": "[BEAM-9692] Replace the apply_read with a PTransformOverride\n\nChange-Id: Ie61304cb1ccd4e1f8d1c93ad547968cd36ff4910"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyODY0ODA0", "url": "https://github.com/apache/beam/pull/11452#pullrequestreview-402864804", "createdAt": "2020-04-29T17:03:00Z", "commit": {"oid": "44cd1175f128074a2fec85c69409a341ccc8ac37"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMzowMFrOGOIbvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowNjowOVrOGOIjnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ3MTQyMw==", "bodyText": "@ananvay we should look at how these interact with auto-opt-in at the service.", "url": "https://github.com/apache/beam/pull/11452#discussion_r417471423", "createdAt": "2020-04-29T17:03:00Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner.py", "diffHunk": "@@ -117,13 +117,15 @@ class DataflowRunner(PipelineRunner):\n   # TODO: Remove the apache_beam.pipeline dependency in CreatePTransformOverride\n   from apache_beam.runners.dataflow.ptransform_overrides import CombineValuesPTransformOverride\n   from apache_beam.runners.dataflow.ptransform_overrides import CreatePTransformOverride\n-  from apache_beam.runners.dataflow.ptransform_overrides import ReadPTransformOverride\n   from apache_beam.runners.dataflow.ptransform_overrides import JrhReadPTransformOverride\n+  from apache_beam.runners.dataflow.ptransform_overrides import ReadPTransformOverride\n+  from apache_beam.runners.dataflow.ptransform_overrides import NativeReadPTransformOverride\n \n-  # Thesse overrides should be applied before the proto representation of the\n+  # These overrides should be applied before the proto representation of the\n   # graph is created.\n   _PTRANSFORM_OVERRIDES = [\n-      CombineValuesPTransformOverride()\n+      CombineValuesPTransformOverride(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44cd1175f128074a2fec85c69409a341ccc8ac37"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ3MzQzNg==", "bodyText": "These three feel very redundant; can a common helper method be used here?", "url": "https://github.com/apache/beam/pull/11452#discussion_r417473436", "createdAt": "2020-04-29T17:06:09Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/runners/dataflow/dataflow_runner_test.py", "diffHunk": "@@ -594,6 +594,121 @@ def test_combine_values_translation(self):\n     self.assertIn(\n         u'CombineValues', set(step[u'kind'] for step in job_dict[u'steps']))\n \n+  def test_read_create_translation(self):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44cd1175f128074a2fec85c69409a341ccc8ac37"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73088bfcd42d9b8b3c08958d6086d7df3ac8a8da", "author": {"user": {"login": "rohdesamuel", "name": "Sam sam"}}, "url": "https://github.com/apache/beam/commit/73088bfcd42d9b8b3c08958d6086d7df3ac8a8da", "committedDate": "2020-04-29T22:51:21Z", "message": "move redundant testing pieces to function\n\nChange-Id: Ia8feb7885729ee3cb52d5197899170d549dd5930"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c78c795e4015f5a2b968f270c5c0a840651a85c", "author": {"user": {"login": "robertwb", "name": "Robert Bradshaw"}}, "url": "https://github.com/apache/beam/commit/6c78c795e4015f5a2b968f270c5c0a840651a85c", "committedDate": "2020-05-01T19:25:32Z", "message": "Test simplification."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzU1ODEy", "url": "https://github.com/apache/beam/pull/11452#pullrequestreview-404355812", "createdAt": "2020-05-01T19:31:55Z", "commit": {"oid": "6c78c795e4015f5a2b968f270c5c0a840651a85c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4292, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}