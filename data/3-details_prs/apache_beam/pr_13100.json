{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyOTM1NjYy", "number": 13100, "title": "Delete unneeded PCollections in pipeline_from_stages()", "bodyText": "In pipeline_from_stages(), only the transforms and their subtransforms that are included in the given stages are copied over to the output pipeline proto. This change similarly only copies over only PCollections that are produced by those transforms to the output pipeline proto. This prevents PCollections whose producers have been eliminated by optimization phases from being copied to the output pipeline proto, which would later cause an error in Pipeline.from_runner_api().\nThis is similar to the reverted pull request #13014 which broke FlinkRunnerTestOptimized tests. The tests have been fixed by passing executable_stage_transform() the components from the original proto, rather than the modified proto.\n\nPost-Commit Tests Status (on master branch)\n\n\n\nLang\nSDK\nDataflow\nFlink\nSamza\nSpark\nTwister2\n\n\n\n\nGo\n\n---\n\n---\n\n---\n\n\nJava\n\n\n\n\n\n\n\n\nPython\n\n\n\n---\n\n---\n\n\nXLang\n\n---\n\n---\n\n---\n\n\n\nPre-Commit Tests Status (on master branch)\n\n\n\n---\nJava\nPython\nGo\nWebsite\nWhitespace\nTypescript\n\n\n\n\nNon-portable\n\n \n\n\n\n\n\n\nPortable\n---\n\n---\n---\n---\n---\n\n\n\nSee .test-infra/jenkins/README for trigger phrase, status and link of all Jenkins jobs.\nGitHub Actions Tests Status (on master branch)\n\n\n\nSee CI.md for more information about GitHub Actions CI.", "createdAt": "2020-10-13T22:42:18Z", "url": "https://github.com/apache/beam/pull/13100", "merged": true, "mergeCommit": {"oid": "c185adb7652034b5d044aae65a1a972d9ceb4377"}, "closed": true, "closedAt": "2020-10-22T00:12:16Z", "author": {"login": "yifanmai"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSLJ_AAH2gAyNTAyOTM1NjYyOjI0ZGUyZWE4NjIxN2EwMjdjOGVlZDZhMTVmZDZjNGE0ZWI4YzBlZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTOEcJgFqTUxMDgyOTUxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "24de2ea86217a027c8eed6a15fd6c4a4eb8c0edf", "author": {"user": {"login": "yifanmai", "name": "Yifan Mai"}}, "url": "https://github.com/apache/beam/commit/24de2ea86217a027c8eed6a15fd6c4a4eb8c0edf", "committedDate": "2020-10-13T16:27:44Z", "message": "Delete unneeded PCollections in pipeline_from_stages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e4fa4812ea76c0641a06f7e3cbc27f20aabdeff", "author": {"user": {"login": "yifanmai", "name": "Yifan Mai"}}, "url": "https://github.com/apache/beam/commit/4e4fa4812ea76c0641a06f7e3cbc27f20aabdeff", "committedDate": "2020-10-13T16:27:45Z", "message": "Lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4ce88276bd766691093041b8419b11190baeb75", "author": {"user": {"login": "yifanmai", "name": "Yifan Mai"}}, "url": "https://github.com/apache/beam/commit/b4ce88276bd766691093041b8419b11190baeb75", "committedDate": "2020-10-13T22:41:36Z", "message": "Lint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "149463db509ccd26f6ff150261b5f80431001246", "author": {"user": {"login": "yifanmai", "name": "Yifan Mai"}}, "url": "https://github.com/apache/beam/commit/149463db509ccd26f6ff150261b5f80431001246", "committedDate": "2020-10-15T22:35:46Z", "message": "Lint (again)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwODI5NTEz", "url": "https://github.com/apache/beam/pull/13100#pullrequestreview-510829513", "createdAt": "2020-10-16T22:25:18Z", "commit": {"oid": "149463db509ccd26f6ff150261b5f80431001246"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMjoyNToxOFrOHjRXcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQyMjoyNToxOFrOHjRXcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc0NjczOQ==", "bodyText": "Is it possible that components has additional components that pipeline_proto.components does not?", "url": "https://github.com/apache/beam/pull/13100#discussion_r506746739", "createdAt": "2020-10-16T22:25:18Z", "author": {"login": "robertwb"}, "path": "sdks/python/apache_beam/runners/portability/fn_api_runner/translations.py", "diffHunk": "@@ -562,9 +569,10 @@ def copy_subtransforms(transform):\n       copy_subtransforms(transform)\n     else:\n       transform = stage.executable_stage_transform(\n-          known_runner_urns, all_consumers, components)\n+          known_runner_urns, all_consumers, pipeline_proto.components)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "149463db509ccd26f6ff150261b5f80431001246"}, "originalPosition": 59}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2006, "cost": 1, "resetAt": "2021-10-28T17:48:14Z"}}}