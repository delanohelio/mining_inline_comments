{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0OTg0OTUy", "number": 5871, "title": "Fix Fullscreen (No Answer Buttons) Reviewer Gestures", "bodyText": "Purpose / Description\nThis fixes two issues, both when Fullscreen (No Buttons) is active.\nFirstly: A swipe down from the status bar first triggered the Anki UI, and then was registered as a fling. This fling assumes \"I'm a fling when the Anki UI is active, I should close the Anki UI and process a gesture\".\nSecondly: When drawing from the top and the whiteboard, the Anki UI is shown. The Reviewer logic assumes \"I'm handling a touch event when the Anki UI is shown\", this stops the draw event, and starts a fling from wherever the cursor is at the current moment, which closes the Anki UI and performs a gesture.\nFixes\nFixes #5741\nApproach\n\nWe define a margin, and assume it's not a gesture if it's within the margin of the edge of the screen.\nA whiteboard draw event continues after it shows the Anki UI.\n\nHow Has This Been Tested?\nOn my Android\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code\n\nReview Goals\n\nGrill me on the hardcoded 24dip for the status bar, I felt it was fine given that we previously used a hardcoded value of 20dip.\nShould the whiteboard also have a margin? If the user draws from the top of the screen, do they want to draw, or get the navigation bar?", "createdAt": "2020-03-27T21:52:58Z", "url": "https://github.com/ankidroid/Anki-Android/pull/5871", "merged": true, "mergeCommit": {"oid": "5aca79273b4df934e30cd59ae1a6418d0de13ac9"}, "closed": true, "closedAt": "2020-06-01T22:28:11Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcR3QJygH2gAyMzk0OTg0OTUyOjg5YmYwN2U5ZWYzODE1NjZlN2IxNjlhMjMzZmYxZmEwNjFhMzUyMzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSM-5mgBqjMxNzUzODMxNzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "89bf07e9ef381566e7b169a233ff1fa061a35239", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/89bf07e9ef381566e7b169a233ff1fa061a35239", "committedDate": "2020-03-27T21:05:13Z", "message": "NF: Added UI visibility logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "988d2e06ab6ab597a811e9daf8c0ae2f976269cc", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/988d2e06ab6ab597a811e9daf8c0ae2f976269cc", "committedDate": "2020-03-27T21:08:27Z", "message": "Added Margin on Fling Gesture\n\nFixes #5741\n\nA user has reported that they can no longer access the status bar as it\nwas treated as a gesture and quickly hid the menu.\n\nWe fix this by defining a margin, and not processing gestures within the\nmargin."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cc6bcc9451fe62baa34e88bbd965380aafdb946a", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/cc6bcc9451fe62baa34e88bbd965380aafdb946a", "committedDate": "2020-03-27T21:52:33Z", "message": "Whiteboard: Continue Drawing if UI is shown\n\nWhen testing a fix for #5741, it was discovered that showing the\nsystem UI in the whiteboard via a swipe down triggered a gesture.\n\nThis was because the whiteboard took focus of the touch events\nuntil the system UI was shown.\n\nWhen the system UI was shown, drawing was cancelled, and an event where\nthe system UI was visible started. This caused the gesture listener to\nfire.\n\nAs the gesture listener is started when the System UI is shown, it\ndoesn't have context on the true start position of the fling event\n, so we can't say that it was from the status bar.\n\nTo fix this, we block all gestures in fullscreen when the whiteboard is\nshown until the whiteboard has stopped drawing."}, "afterCommit": {"oid": "741627fd370b43e506314c9563c36bff6cf57e67", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/741627fd370b43e506314c9563c36bff6cf57e67", "committedDate": "2020-03-28T07:44:15Z", "message": "Whiteboard: Continue Drawing if UI is shown\n\nWhen testing a fix for #5741, it was discovered that showing the\nsystem UI in the whiteboard via a swipe down triggered a gesture.\n\nThis was because the whiteboard took focus of the touch events\nuntil the system UI was shown.\n\nWhen the system UI was shown, drawing was cancelled, and an event where\nthe system UI was visible started. This caused the gesture listener to\nfire.\n\nAs the gesture listener is started when the System UI is shown, it\ndoesn't have context on the true start position of the fling event\n, so we can't say that it was from the status bar.\n\nTo fix this, we block all gestures in fullscreen when the whiteboard is\nshown until the whiteboard has stopped drawing."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzI3NDc2", "url": "https://github.com/ankidroid/Anki-Android/pull/5871#pullrequestreview-383327476", "createdAt": "2020-03-28T16:29:47Z", "commit": {"oid": "741627fd370b43e506314c9563c36bff6cf57e67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxNjoyOTo0N1rOF9Km7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOFQxNjoyOTo0N1rOF9Km7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY4MTI2Mw==", "bodyText": "just noting the import move is gratuitous", "url": "https://github.com/ankidroid/Anki-Android/pull/5871#discussion_r399681263", "createdAt": "2020-03-28T16:29:47Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -36,6 +35,8 @@\n import java.lang.ref.WeakReference;\n import java.util.Stack;\n \n+import androidx.core.content.ContextCompat;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "741627fd370b43e506314c9563c36bff6cf57e67"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzI3NjI3", "url": "https://github.com/ankidroid/Anki-Android/pull/5871#pullrequestreview-383327627", "createdAt": "2020-03-28T16:31:38Z", "commit": {"oid": "741627fd370b43e506314c9563c36bff6cf57e67"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "193dbccb5b8df372be066b6ea98e6b25ee4a418f", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/193dbccb5b8df372be066b6ea98e6b25ee4a418f", "committedDate": "2020-03-28T22:23:58Z", "message": "Whiteboard: Continue Drawing if UI is shown\n\nWhen testing a fix for #5741, it was discovered that showing the\nsystem UI in the whiteboard via a swipe down triggered a gesture.\n\nThis was because the whiteboard took focus of the touch events\nuntil the system UI was shown.\n\nWhen the system UI was shown, drawing was cancelled, and an event where\nthe system UI was visible started. This caused the gesture listener to\nfire.\n\nAs the gesture listener is started when the System UI is shown, it\ndoesn't have context on the true start position of the fling event\n, so we can't say that it was from the status bar.\n\nTo fix this, we block all gestures in fullscreen when the whiteboard is\nshown until the whiteboard has stopped drawing."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "741627fd370b43e506314c9563c36bff6cf57e67", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/741627fd370b43e506314c9563c36bff6cf57e67", "committedDate": "2020-03-28T07:44:15Z", "message": "Whiteboard: Continue Drawing if UI is shown\n\nWhen testing a fix for #5741, it was discovered that showing the\nsystem UI in the whiteboard via a swipe down triggered a gesture.\n\nThis was because the whiteboard took focus of the touch events\nuntil the system UI was shown.\n\nWhen the system UI was shown, drawing was cancelled, and an event where\nthe system UI was visible started. This caused the gesture listener to\nfire.\n\nAs the gesture listener is started when the System UI is shown, it\ndoesn't have context on the true start position of the fling event\n, so we can't say that it was from the status bar.\n\nTo fix this, we block all gestures in fullscreen when the whiteboard is\nshown until the whiteboard has stopped drawing."}, "afterCommit": {"oid": "193dbccb5b8df372be066b6ea98e6b25ee4a418f", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/193dbccb5b8df372be066b6ea98e6b25ee4a418f", "committedDate": "2020-03-28T22:23:58Z", "message": "Whiteboard: Continue Drawing if UI is shown\n\nWhen testing a fix for #5741, it was discovered that showing the\nsystem UI in the whiteboard via a swipe down triggered a gesture.\n\nThis was because the whiteboard took focus of the touch events\nuntil the system UI was shown.\n\nWhen the system UI was shown, drawing was cancelled, and an event where\nthe system UI was visible started. This caused the gesture listener to\nfire.\n\nAs the gesture listener is started when the System UI is shown, it\ndoesn't have context on the true start position of the fling event\n, so we can't say that it was from the status bar.\n\nTo fix this, we block all gestures in fullscreen when the whiteboard is\nshown until the whiteboard has stopped drawing."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3562, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}