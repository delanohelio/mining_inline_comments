{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0ODcxMTA3", "number": 6125, "reviewThreads": {"totalCount": 53, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyNTowMlrOD6Y0_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMjo1Njo1NVrOD66Tcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTUwNzgxOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/res/xml/preferences_appearance.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyNTowMlrOGSM8vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyNTowMlrOGSM8vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczOTcxMA==", "bodyText": "Should be extracted to resource", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421739710", "createdAt": "2020-05-07T19:25:02Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/xml/preferences_appearance.xml", "diffHunk": "@@ -39,6 +39,14 @@\n             android:entryValues=\"@array/night_theme_values\"\n             android:key=\"nightTheme\"\n             android:title=\"@string/night_theme\" />\n+    </PreferenceCategory>\n+    <PreferenceCategory android:title=\"Background\">\n+        <CheckBoxPreference\n+            android:checked=\"false\"\n+            android:defaultValue=\"0\"\n+            android:key=\"deckPickerBackground\"\n+            android:shouldDisableView=\"true\"\n+            android:title=\"Choose an Image\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTUwODU1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyNToxNlrOGSM9NQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyNToxNlrOGSM9NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczOTgyOQ==", "bodyText": "extract resource", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421739829", "createdAt": "2020-05-07T19:25:16Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();\n+            }\n+        } catch (Exception e) {\n+            Toast.makeText(this, \"Something went wrong\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTUwODgzOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyNToyNVrOGSM9dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTo1NToxM1rOGSN-Wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczOTg5Mw==", "bodyText": "ditto - extract resource", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421739893", "createdAt": "2020-05-07T19:25:25Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1NjUwNg==", "bodyText": "I have extracted file path.\nI will make it extract resources then put it Ankidroid directory.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421756506", "createdAt": "2020-05-07T19:55:13Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczOTg5Mw=="}, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTUxMTAwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyNjowNlrOGSM-4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyNjowNlrOGSM-4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MDI1OA==", "bodyText": "At the very least, needs Timber.e logging", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421740258", "createdAt": "2020-05-07T19:26:06Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();\n+            }\n+        } catch (Exception e) {\n+            Toast.makeText(this, \"Something went wrong\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTUxMzAyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyNjozMVrOGSNADQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyNjozMVrOGSNADQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MDU1Nw==", "bodyText": "Would be ideal to include the localised exception in the toast string", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421740557", "createdAt": "2020-05-07T19:26:31Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();\n+            }\n+        } catch (Exception e) {\n+            Toast.makeText(this, \"Something went wrong\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTUxNTI2OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyNzoxMVrOGSNBfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyNzoxMVrOGSNBfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MDkyNA==", "bodyText": "Would be best to remove commented code", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421740924", "createdAt": "2020-05-07T19:27:11Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTUxODcyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyODoxMlrOGSNDlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyODoxMlrOGSNDlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MTQ2Mg==", "bodyText": "PERF: Use string formatting in Timber rather than concatenation", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421741462", "createdAt": "2020-05-07T19:28:12Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +246,21 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if ( backgroundImage.isChecked()) {\n+                        preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n+                        backgroundImage.setChecked(false);\n+                    } else {\n+                        Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                        startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                        backgroundImage.setChecked(true);\n+                        Timber.i(\"Image added!\" + imgPathString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTUyMTc5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyOTowMFrOGSNFcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyOTowMFrOGSNFcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MTkzOQ==", "bodyText": "Need to handle the case where this throws as the activity isn't found", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421741939", "createdAt": "2020-05-07T19:29:00Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +246,21 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if ( backgroundImage.isChecked()) {\n+                        preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n+                        backgroundImage.setChecked(false);\n+                    } else {\n+                        Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                        startActivityForResult(galleryIntent, RESULT_LOAD_IMG);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTUyMjcyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyOToxNVrOGSNGBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTo1MjoxNFrOGSN3hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MjA4NA==", "bodyText": "Nit: bracket placement", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421742084", "createdAt": "2020-05-07T19:29:15Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +246,21 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if ( backgroundImage.isChecked()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1NDc1OA==", "bodyText": "Okay", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421754758", "createdAt": "2020-05-07T19:52:14Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +246,21 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if ( backgroundImage.isChecked()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MjA4NA=="}, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTUyNzAyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTozMDozN1rOGSNIsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTo1Mzo0OVrOGSN7Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mjc2OA==", "bodyText": "What's the purpose of this? Mostly the static declaration and the default value? Feels like it'd be better as an instance variable", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421742768", "createdAt": "2020-05-07T19:30:37Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -108,7 +112,8 @@\n     private static final String [] sCollectionPreferences = {\"showEstimates\", \"showProgress\",\n             \"learnCutoff\", \"timeLimit\", \"useCurrent\", \"newSpread\", \"dayOffset\", \"schedVer\"};\n \n-\n+    private static int RESULT_LOAD_IMG = 111;\n+    private static String imgPathString = \"default\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1NTY5MA==", "bodyText": "To be updated.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421755690", "createdAt": "2020-05-07T19:53:49Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -108,7 +112,8 @@\n     private static final String [] sCollectionPreferences = {\"showEstimates\", \"showProgress\",\n             \"learnCutoff\", \"timeLimit\", \"useCurrent\", \"newSpread\", \"dayOffset\", \"schedVer\"};\n \n-\n+    private static int RESULT_LOAD_IMG = 111;\n+    private static String imgPathString = \"default\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mjc2OA=="}, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTUzMTgwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTozMjowN1rOGSNLxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTozMjowN1rOGSNLxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MzU1Nw==", "bodyText": "Nit (arguable): Would be useful to extract this to a method", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421743557", "createdAt": "2020-05-07T19:32:07Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTUzMzUwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTozMjozOVrOGSNM5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTo1ODo0MFrOGSOGAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mzg0NA==", "bodyText": "Is there a constant which can be used here?", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421743844", "createdAt": "2020-05-07T19:32:39Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {\n+            view.setBackgroundResource(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1NDEyOQ==", "bodyText": "If user remove image then file path string assigned \"default\".\nSo i used 0 or null to remove background.\n(Stackoverflow approach).", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421754129", "createdAt": "2020-05-07T19:51:04Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {\n+            view.setBackgroundResource(0);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mzg0NA=="}, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1ODQ2NA==", "bodyText": "Agreed, https://developer.android.com/reference/android/content/res/Resources#ID_NULL was introduced in API 29... we have a long wait before we can use it.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421758464", "createdAt": "2020-05-07T19:58:40Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {\n+            view.setBackgroundResource(0);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mzg0NA=="}, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTUzNDUxOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTozMjo1M1rOGSNNbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTo1MTo0NFrOGSN2Zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mzk4Mg==", "bodyText": "This needs to gracefully handle exceptions. Ideally wrap in an exception handler", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421743982", "createdAt": "2020-05-07T19:32:53Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1NDQ3MA==", "bodyText": "I will update it.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421754470", "createdAt": "2020-05-07T19:51:44Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mzk4Mg=="}, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTUzODE1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTozMzo1N1rOGSNPsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTo0NTowMlrOGSNnjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NDU2MQ==", "bodyText": "I /think/ we already target version 15, so this is unnecessary. Happy to be proven wrong.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421744561", "createdAt": "2020-05-07T19:33:57Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);\n+            BitmapDrawable bd = new BitmapDrawable(res, bitmap);\n+            view = findViewById(R.id.root_layout);\n+            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1MDY3MQ==", "bodyText": "Yes, minSdkVersion is 15 right now - for Android apps this is set in the build.gradle you can see it there for reference", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421750671", "createdAt": "2020-05-07T19:45:02Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);\n+            BitmapDrawable bd = new BitmapDrawable(res, bitmap);\n+            view = findViewById(R.id.root_layout);\n+            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NDU2MQ=="}, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTU0MDg5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTozNDozOFrOGSNRSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTozNDozOFrOGSNRSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NDk3MA==", "bodyText": "or null", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421744970", "createdAt": "2020-05-07T19:34:38Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNTU0Mzg1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTozNToyOFrOGSNTCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTozNToyOFrOGSNTCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NTQxOQ==", "bodyText": "\"You haven't picked an image\"", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421745419", "createdAt": "2020-05-07T19:35:28Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzI3MTYxOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODowNjo0NlrOGSdQrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODowNjo0NlrOGSdQrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwNjk1OQ==", "bodyText": "Wrap this in a try...catch", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422006959", "createdAt": "2020-05-08T08:06:46Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -466,6 +472,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         }\n     }\n \n+    private void applyDeckPickerBackground(SharedPreferences preferences) {\n+        String pathName = preferences.getString(\"deck_background_path\",\"default\");\n+        View view = findViewById(R.id.root_layout);\n+        if (\"default\".equals(pathName)) {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);\n+            BitmapDrawable bd = new BitmapDrawable(res, bitmap);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzI3MTg1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODowNjo1NVrOGSdQ4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMzoxMjoxNVrOGSlCRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwNzAxMA==", "bodyText": "Fairly sure this is dead code", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422007010", "createdAt": "2020-05-08T08:06:55Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -466,6 +472,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         }\n     }\n \n+    private void applyDeckPickerBackground(SharedPreferences preferences) {\n+        String pathName = preferences.getString(\"deck_background_path\",\"default\");\n+        View view = findViewById(R.id.root_layout);\n+        if (\"default\".equals(pathName)) {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);\n+            BitmapDrawable bd = new BitmapDrawable(res, bitmap);\n+            view = findViewById(R.id.root_layout);\n+            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEzNDM0Mg==", "bodyText": "I have updated it. with\nDrawable drawable = Drawable.createFromPath(imgFile.getAbsolutePath());\nif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {\n     view.setBackground(drawable);\n}\nif not using if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) \nandroid studio showing error.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422134342", "createdAt": "2020-05-08T13:12:15Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -466,6 +472,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         }\n     }\n \n+    private void applyDeckPickerBackground(SharedPreferences preferences) {\n+        String pathName = preferences.getString(\"deck_background_path\",\"default\");\n+        View view = findViewById(R.id.root_layout);\n+        if (\"default\".equals(pathName)) {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);\n+            BitmapDrawable bd = new BitmapDrawable(res, bitmap);\n+            view = findViewById(R.id.root_layout);\n+            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwNzAxMA=="}, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzI3MjY0OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODowNzoxMlrOGSdRVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODowNzoxMlrOGSdRVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwNzEyNA==", "bodyText": "private static final", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422007124", "createdAt": "2020-05-08T08:07:12Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -108,7 +114,9 @@\n     private static final String [] sCollectionPreferences = {\"showEstimates\", \"showProgress\",\n             \"learnCutoff\", \"timeLimit\", \"useCurrent\", \"newSpread\", \"dayOffset\", \"schedVer\"};\n \n-\n+    private static int RESULT_LOAD_IMG = 111;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzI3NDkwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODowODoxNFrOGSdSyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODowODoxNFrOGSdSyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwNzQ5Nw==", "bodyText": "Use a method for path concat (I think Java uses new File(a, b))", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422007497", "createdAt": "2020-05-08T08:08:14Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzI4NDI5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoxMTozNlrOGSdYhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMzoxMDoyOVrOGSk-yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwODk2NA==", "bodyText": "(for discussion): We risk polluting the Anki Directory with dead images.\nIdeally pick a static filename and place it there to overwrite.\nThis could also mean that we get rid of the preference if the path is known", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422008964", "createdAt": "2020-05-08T08:11:36Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEzMzQ1MA==", "bodyText": "yes, Now file name is fixed. DeckPickerBackground.png. If it exist in directory then the image will set as background.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422133450", "createdAt": "2020-05-08T13:10:29Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwODk2NA=="}, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzI4NjA5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoxMjoxNFrOGSdZrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoxMjoxNFrOGSdZrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwOTI2Mw==", "bodyText": "Best to let it throw if the directory isn't found", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422009263", "createdAt": "2020-05-08T08:12:14Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzI5NDc1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoxNTowOFrOGSde3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMzoyMzoyN1rOGSlX0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMDU4OQ==", "bodyText": "Just confirming there's no compiler warnings around here from Android API levels, this looks suspect.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422010589", "createdAt": "2020-05-08T08:15:08Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEzOTg1OA==", "bodyText": "Not showing any compiler error.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422139858", "createdAt": "2020-05-08T13:23:27Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMDU4OQ=="}, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzI5NTg1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoxNTozMlrOGSdfkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoxNTozMlrOGSdfkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMDc3MQ==", "bodyText": "You'll need to catch OutOfMemoryError here, I believe.\nErrors in java don't inherit from Exception", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422010771", "createdAt": "2020-05-08T08:15:32Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzI5ODI1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoxNjoyNFrOGSdhJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoxNjoyNFrOGSdhJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMTE3Mw==", "bodyText": "UIUtils.showThemedToast is a little more standard", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422011173", "createdAt": "2020-05-08T08:16:24Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                } finally {\n+                    if (sourceChannel != null) {\n+                        sourceChannel.close();\n+                    }\n+                    if (destChannel != null) {\n+                        destChannel.close();\n+                    }\n+                }\n+                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzMwMDQyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoxNzowM1rOGSdiaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoxNzowM1rOGSdiaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMTQ5Ng==", "bodyText": "Ideally show this to the user, e.getLocalisedMessage()", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422011496", "createdAt": "2020-05-08T08:17:03Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                } finally {\n+                    if (sourceChannel != null) {\n+                        sourceChannel.close();\n+                    }\n+                    if (destChannel != null) {\n+                        destChannel.close();\n+                    }\n+                }\n+                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();\n+            } else {\n+                preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n+                Toast.makeText(this, \"You haven't picked any image\", Toast.LENGTH_LONG).show();\n+            }\n+        } catch (Exception e) {\n+            Timber.e(\"Error copying file %s\",e.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 116}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzMwMjAxOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoxNzo0NVrOGSdjgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoxNzo0NVrOGSdjgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMTc3Ng==", "bodyText": "You should be able to extract this to a resource via \"Alt+Enter\" in Android Studio, move it to \"03-dialogs.xml\"", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422011776", "createdAt": "2020-05-08T08:17:45Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                } finally {\n+                    if (sourceChannel != null) {\n+                        sourceChannel.close();\n+                    }\n+                    if (destChannel != null) {\n+                        destChannel.close();\n+                    }\n+                }\n+                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();\n+            } else {\n+                preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n+                Toast.makeText(this, \"You haven't picked any image\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 113}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzMwOTQ5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyMDoxM1rOGSdnvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyMDoxM1rOGSdnvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMjg2Mw==", "bodyText": "\u26a0\ufe0f Security: You need to confirm that the path is rooted on currentAnkiDroidDirectory, otherwise this will let a user who has access to an image picker escalate to having write access on the user's external storage.\nFor example: ../../filename.apk would be malicious input\nThis would be best fixed by writing to a static well-known location, as suggested above.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422012863", "createdAt": "2020-05-08T08:20:13Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzMxMjMzOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyMToxNVrOGSdpfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyMToxNVrOGSdpfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMzMxMA==", "bodyText": "Again, best to extract to a resource so this can be translated, see below for instructions", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422013310", "createdAt": "2020-05-08T08:21:15Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                } finally {\n+                    if (sourceChannel != null) {\n+                        sourceChannel.close();\n+                    }\n+                    if (destChannel != null) {\n+                        destChannel.close();\n+                    }\n+                }\n+                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzMxNTYwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyMjoyMlrOGSdraw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyMjoyMlrOGSdraw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMzgwMw==", "bodyText": "Probably best for Timber.v with a little context here", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422013803", "createdAt": "2020-05-08T08:22:22Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzMxNjcxOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyMjo0NlrOGSdsIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyMjo0NlrOGSdsIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMzk4NA==", "bodyText": "You can use try with resources here", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422013984", "createdAt": "2020-05-08T08:22:46Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzMyMDU5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyNDowOVrOGSdupQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyNDowOVrOGSdupQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNDYyOQ==", "bodyText": "(nit): You can just use ex here, Timber will perform .toString() internally, which can reduce execution time.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422014629", "createdAt": "2020-05-08T08:24:09Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +249,25 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzMyMTczOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyNDozNVrOGSdvXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyNDozNVrOGSdvXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNDgxNQ==", "bodyText": "Best to display failure to the user, ideally with the exception message.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422014815", "createdAt": "2020-05-08T08:24:35Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +249,25 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzMyMzM5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyNToxMFrOGSdwYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyNToxMFrOGSdwYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNTA3Mw==", "bodyText": "Can be converted to a local variable", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422015073", "createdAt": "2020-05-08T08:25:10Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -108,7 +114,9 @@\n     private static final String [] sCollectionPreferences = {\"showEstimates\", \"showProgress\",\n             \"learnCutoff\", \"timeLimit\", \"useCurrent\", \"newSpread\", \"dayOffset\", \"schedVer\"};\n \n-\n+    private static int RESULT_LOAD_IMG = 111;\n+    private String imgPathString = \"default\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzMyNjQzOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyNjoxNVrOGSdyOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyNjoxNVrOGSdyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNTU0NQ==", "bodyText": "Can also be converted to 2 local variables", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422015545", "createdAt": "2020-05-08T08:26:15Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -108,7 +114,9 @@\n     private static final String [] sCollectionPreferences = {\"showEstimates\", \"showProgress\",\n             \"learnCutoff\", \"timeLimit\", \"useCurrent\", \"newSpread\", \"dayOffset\", \"schedVer\"};\n \n-\n+    private static int RESULT_LOAD_IMG = 111;\n+    private String imgPathString = \"default\";\n+    private String copyImagePathString = \"default\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzMyNjg1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyNjoyNVrOGSdyfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODoyNjoyNVrOGSdyfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNTYxMg==", "bodyText": "copyImagePathString can be inline here.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422015612", "createdAt": "2020-05-08T08:26:25Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +249,25 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.toString());\n+                        }\n+                    } else {\n+                        copyImagePathString = \"default\";\n+                        preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzM0NDM4OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODozMjozNlrOGSd9Mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMjo0Mjo0OFrOGSkOCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxODM1NA==", "bodyText": "This won't handle external images (from Google Drive). You'll want to use openInputStream. Feel free to copy: https://github.com/ankidroid/Anki-Android/pull/5982/files#diff-f57ce86b452ff02ca83e914fd192964dR19", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422018354", "createdAt": "2020-05-08T08:32:36Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMDk3MQ==", "bodyText": "I didn't understand this.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422120971", "createdAt": "2020-05-08T12:42:48Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxODM1NA=="}, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzM0OTY3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODozNDoyM1rOGSeAZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODozNDoyM1rOGSeAZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxOTE3NA==", "bodyText": "needs to be translatable via a resource", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422019174", "createdAt": "2020-05-08T08:34:23Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +249,25 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.toString());\n+                        }\n+                    } else {\n+                        copyImagePathString = \"default\";\n+                        preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                        backgroundImage.setChecked(false);\n+                        Toast.makeText(this, \"Background image removed\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzQ0MjYzOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwOTowNjo0M1rOGSe5dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwOTowNjo0M1rOGSe5dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAzMzc4Mw==", "bodyText": "Can be condensed to:\ntry (FileChannel sourceChannel = new FileInputStream(sourceFile).getChannel(); \n     FileChannel destChannel = new FileOutputStream(destFile).getChannel()) {\n    destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n}", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422033783", "createdAt": "2020-05-08T09:06:43Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 98}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyODAxNDE3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMjo0MzowNlrOGSkOgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMjo0MzowNlrOGSkOgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTA4OA==", "bodyText": "(nit): Move to finally block to ensure disposal:\nif (cursor != null) { \n    cursor.close(); \n}", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422121088", "createdAt": "2020-05-08T12:43:06Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -402,52 +409,36 @@ private void initSubscreen(String action, PreferenceContext listener) {\n     @Override\n     protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n         super.onActivityResult(requestCode, resultCode, data);\n-        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        String imgPathString = \"\";\n         try {\n             if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n-                Uri selectedImage = data.getData();\n-                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n-                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n-                cursor.moveToFirst();\n-                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n-                imgPathString = cursor.getString(columnIndex);\n-                cursor.close();\n-                Timber.e(imgPathString);\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    imgPathString = cursor.getString(columnIndex);\n+                    cursor.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyODAxNjA1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMjo0Mzo0OVrOGSkPsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNDoxMTowMVrOGSm8IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTM5Mw==", "bodyText": "You probably want a return; + Toast here", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422121393", "createdAt": "2020-05-08T12:43:49Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -402,52 +409,36 @@ private void initSubscreen(String action, PreferenceContext listener) {\n     @Override\n     protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n         super.onActivityResult(requestCode, resultCode, data);\n-        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        String imgPathString = \"\";\n         try {\n             if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n-                Uri selectedImage = data.getData();\n-                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n-                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n-                cursor.moveToFirst();\n-                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n-                imgPathString = cursor.getString(columnIndex);\n-                cursor.close();\n-                Timber.e(imgPathString);\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    imgPathString = cursor.getString(columnIndex);\n+                    cursor.close();\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEzMDUyNw==", "bodyText": "No, I put ; mistakenly.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422130527", "createdAt": "2020-05-08T13:04:08Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -402,52 +409,36 @@ private void initSubscreen(String action, PreferenceContext listener) {\n     @Override\n     protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n         super.onActivityResult(requestCode, resultCode, data);\n-        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        String imgPathString = \"\";\n         try {\n             if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n-                Uri selectedImage = data.getData();\n-                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n-                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n-                cursor.moveToFirst();\n-                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n-                imgPathString = cursor.getString(columnIndex);\n-                cursor.close();\n-                Timber.e(imgPathString);\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    imgPathString = cursor.getString(columnIndex);\n+                    cursor.close();\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTM5Mw=="}, "originalCommit": {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEzOTYwNA==", "bodyText": "I'm under the impression that new File(imgPathString) would fail if this throws an exception, is there a reason to continue?", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422139604", "createdAt": "2020-05-08T13:22:56Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -402,52 +409,36 @@ private void initSubscreen(String action, PreferenceContext listener) {\n     @Override\n     protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n         super.onActivityResult(requestCode, resultCode, data);\n-        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        String imgPathString = \"\";\n         try {\n             if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n-                Uri selectedImage = data.getData();\n-                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n-                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n-                cursor.moveToFirst();\n-                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n-                imgPathString = cursor.getString(columnIndex);\n-                cursor.close();\n-                Timber.e(imgPathString);\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    imgPathString = cursor.getString(columnIndex);\n+                    cursor.close();\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTM5Mw=="}, "originalCommit": {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE0MzIwMA==", "bodyText": "Oh, I understood it.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422143200", "createdAt": "2020-05-08T13:29:24Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -402,52 +409,36 @@ private void initSubscreen(String action, PreferenceContext listener) {\n     @Override\n     protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n         super.onActivityResult(requestCode, resultCode, data);\n-        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        String imgPathString = \"\";\n         try {\n             if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n-                Uri selectedImage = data.getData();\n-                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n-                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n-                cursor.moveToFirst();\n-                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n-                imgPathString = cursor.getString(columnIndex);\n-                cursor.close();\n-                Timber.e(imgPathString);\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    imgPathString = cursor.getString(columnIndex);\n+                    cursor.close();\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTM5Mw=="}, "originalCommit": {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE2NTUzNw==", "bodyText": "I tried this.\nUri selectedImage = data.getData();\nString imgPath = selectedImage.getPath();\nBut not getting correct path.\nSo I am using this\nString imgPathString = cursor.getString(columnIndex);\nFile sourceFile = new File(imgPathString);\nand copying it Ankidroid Directory.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422165537", "createdAt": "2020-05-08T14:11:01Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -402,52 +409,36 @@ private void initSubscreen(String action, PreferenceContext listener) {\n     @Override\n     protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n         super.onActivityResult(requestCode, resultCode, data);\n-        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        String imgPathString = \"\";\n         try {\n             if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n-                Uri selectedImage = data.getData();\n-                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n-                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n-                cursor.moveToFirst();\n-                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n-                imgPathString = cursor.getString(columnIndex);\n-                cursor.close();\n-                Timber.e(imgPathString);\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    imgPathString = cursor.getString(columnIndex);\n+                    cursor.close();\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTM5Mw=="}, "originalCommit": {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyODAxNzY1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMjo0NDoyN1rOGSkQkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMjo0NDoyN1rOGSkQkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTYxOQ==", "bodyText": "| Exception, gotta catch 'em all ;)", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422121619", "createdAt": "2020-05-08T12:44:27Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -402,52 +409,36 @@ private void initSubscreen(String action, PreferenceContext listener) {\n     @Override\n     protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n         super.onActivityResult(requestCode, resultCode, data);\n-        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        String imgPathString = \"\";\n         try {\n             if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n-                Uri selectedImage = data.getData();\n-                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n-                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n-                cursor.moveToFirst();\n-                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n-                imgPathString = cursor.getString(columnIndex);\n-                cursor.close();\n-                Timber.e(imgPathString);\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    imgPathString = cursor.getString(columnIndex);\n+                    cursor.close();\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());\n+                };\n+                Timber.v(imgPathString);\n                 File sourceFile = new File(imgPathString);\n-\n-                String imgName = sourceFile.getName();\n                 String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n-                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+                String imageName = \"DeckPickerBackground.png\";\n+                File destFile = new File(currentAnkiDroidDirectory, imageName);\n \n-                File destFile = new File(copyImagePathString);\n-                if (!destFile.getParentFile().exists())\n-                    destFile.getParentFile().mkdirs();\n-                if (!destFile.exists()) {\n-                    destFile.createNewFile();\n-                }\n-\n-                FileChannel sourceChannel = null;\n-                FileChannel destChannel = null;\n-                try {\n-                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n-                   destChannel  = new FileOutputStream(destFile).getChannel();\n-                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n-                } finally {\n-                    if (sourceChannel != null) {\n-                        sourceChannel.close();\n-                    }\n-                    if (destChannel != null) {\n-                        destChannel.close();\n-                    }\n+                try (FileChannel sourceChannel = new FileInputStream(sourceFile).getChannel();\n+                     FileChannel destChannel = new FileOutputStream(destFile).getChannel()) {\n+                    destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                    UIUtils.showThemedToast(this, getString(R.string.background_image_applied), false);\n                 }\n-                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n-                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();\n             } else {\n-                preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n-                Toast.makeText(this, \"You haven't picked any image\", Toast.LENGTH_LONG).show();\n+                UIUtils.showThemedToast(this, getString(R.string.no_image_selected), false);\n             }\n-        } catch (Exception e) {\n-            Timber.e(\"Error copying file %s\",e.toString());\n+        } catch (OutOfMemoryError | IOException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e"}, "originalPosition": 124}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyODAxOTk2OnYy", "diffSide": "LEFT", "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMjo0NToxNVrOGSkR7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMjo0NToxNVrOGSkR7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTk2NQ==", "bodyText": "I don't believe this is required.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422121965", "createdAt": "2020-05-08T12:45:15Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -17,7 +17,7 @@\n ~\n ~ You should have received a copy of the GNU General Public License along with\n ~ this program.  If not, see <http://www.gnu.org/licenses/>.\n---><resources>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDczODQ3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/res/xml/preferences_appearance.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxNzo1Mzo1NVrOGS87hA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxNzo1Mzo1NVrOGS87hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNTgyOA==", "bodyText": "Could you extract this into a resource for localisation (there's a preferences.xml file)", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422525828", "createdAt": "2020-05-09T17:53:55Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/xml/preferences_appearance.xml", "diffHunk": "@@ -39,6 +39,14 @@\n             android:entryValues=\"@array/night_theme_values\"\n             android:key=\"nightTheme\"\n             android:title=\"@string/night_theme\" />\n+    </PreferenceCategory>\n+    <PreferenceCategory android:title=\"Background\">\n+        <CheckBoxPreference\n+            android:checked=\"false\"\n+            android:defaultValue=\"0\"\n+            android:key=\"deckPickerBackground\"\n+            android:shouldDisableView=\"true\"\n+            android:title=\"Choose an Image\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDczOTE0OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxNzo1NDo0N1rOGS872Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxNzo1NDo0N1rOGS872Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNTkxMw==", "bodyText": "Could you wrap the content of applyDeckPickerBackground in a try...catch so we don't kill the app if it fails", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422525913", "createdAt": "2020-05-09T17:54:47Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -466,6 +475,19 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         }\n     }\n \n+    private void applyDeckPickerBackground(View view) {\n+        String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDczOTUwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxNzo1NTowNlrOGS88Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxNzo1NTowNlrOGS88Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNTk1NA==", "bodyText": "nit: spacing of the ifs", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422525954", "createdAt": "2020-05-09T17:55:06Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +248,32 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.getLocalizedMessage());\n+                        }\n+                    } else {\n+                        backgroundImage.setChecked(false);\n+                        String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                        File imgFile = new File(currentAnkiDroidDirectory, \"DeckPickerBackground.png\" );\n+                        if(imgFile.exists()) {\n+                            if(imgFile.delete()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDc0MTU2OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxNzo1NzozMlrOGS888Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxNzo1NzozMlrOGS888Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNjE5Mw==", "bodyText": "Nit: moving these two lines up (so cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null); is the first line after the brace will allow Android Studio to convert this to try with resources and reduce code size", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422526193", "createdAt": "2020-05-09T17:57:32Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +405,44 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Cursor cursor = null;\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDc0NDc5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxODowMDozNlrOGS8-Yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxODowMDozNlrOGS8-Yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNjU2Mw==", "bodyText": "This exception will be better handled in the outer exception handler, best to remove this catch block", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422526563", "createdAt": "2020-05-09T18:00:36Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +405,44 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Cursor cursor = null;\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    String imgPathString = cursor.getString(columnIndex);\n+                    File sourceFile = new File(imgPathString);\n+\n+                    String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                    String imageName = \"DeckPickerBackground.png\";\n+                    File destFile = new File(currentAnkiDroidDirectory, imageName);\n+\n+                    try (FileChannel sourceChannel = new FileInputStream(sourceFile).getChannel();\n+                         FileChannel destChannel = new FileOutputStream(destFile).getChannel()) {\n+                        destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                        UIUtils.showThemedToast(this, getString(R.string.background_image_applied), false);\n+                    }\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDc0NTYwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxODowMTozMFrOGS8-yQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxODowMTozMFrOGS8-yQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNjY2NQ==", "bodyText": "Exception strings can be formatted:\nUIUtils.showThemedToast(this, getString(R.string.error_selecting_image, e.getLocalizedMessage()), false);\nThen add a %s into the resource", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422526665", "createdAt": "2020-05-09T18:01:30Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +405,44 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Cursor cursor = null;\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    String imgPathString = cursor.getString(columnIndex);\n+                    File sourceFile = new File(imgPathString);\n+\n+                    String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                    String imageName = \"DeckPickerBackground.png\";\n+                    File destFile = new File(currentAnkiDroidDirectory, imageName);\n+\n+                    try (FileChannel sourceChannel = new FileInputStream(sourceFile).getChannel();\n+                         FileChannel destChannel = new FileOutputStream(destFile).getChannel()) {\n+                        destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                        UIUtils.showThemedToast(this, getString(R.string.background_image_applied), false);\n+                    }\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());\n+                } finally {\n+                    if (cursor != null) {\n+                        cursor.close();\n+                    }\n+                }\n+            } else {\n+                UIUtils.showThemedToast(this, getString(R.string.no_image_selected), false);\n+            }\n+        } catch (OutOfMemoryError | Exception e) {\n+            UIUtils.showThemedToast(this, getString(R.string.error_selecting_image), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDc0NjI0OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxODowMjoyN1rOGS8_Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxODowMjoyN1rOGS8_Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNjc1OA==", "bodyText": "Error selecting image. Please see manual. %s -  we can then explain to the user how to copy the file in.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422526758", "createdAt": "2020-05-09T18:02:27Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -176,4 +176,11 @@\n     <!-- Database Errors-->\n     <string name=\"database_locked_title\">Database Locked</string>\n     <string name=\"database_locked_summary\">The AnkiDroid database is in use by another application. Please close the other application then reopen AnkiDroid.</string>\n+\n+    <!-- Deck Picker Background-->\n+    <string name=\"background_image_applied\">Background image applied</string>\n+    <string name=\"background_image_removed\">Background image removed</string>\n+    <string name=\"no_image_selected\">No image selected</string>\n+    <string name=\"error_selecting_image\">Error selecting image</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDc0NzE3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxODowMzoxOFrOGS8_jA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxODowMzoxOFrOGS8_jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNjg2MA==", "bodyText": "Could you leave a comment here:\nDEFECT #5973: Does not handle Google Drive downloads", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422526860", "createdAt": "2020-05-09T18:03:18Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +405,44 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Cursor cursor = null;\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDk3OTE4OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMjozOToxM1rOGS-tlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMjozOToxM1rOGS-tlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU1NTAyOA==", "bodyText": "nit: Might want a Toast here", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422555028", "createdAt": "2020-05-09T22:39:13Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -438,6 +438,14 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n \n         mReviewSummaryTextView = (TextView) findViewById(R.id.today_stats_text_view);\n \n+        //Add background to Deckpicker activity\n+        View view = mFragmented ? findViewById(R.id.deckpicker_view) : findViewById(R.id.root_layout);\n+        try {\n+            applyDeckPickerBackground(view);\n+        } catch (Exception e) {\n+            Timber.e(e,\"Background image apply failed\" );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e60944353d6b9fc10ea86360db4ca4c9dbc6b7f7"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMDk5MjUwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMjo1Njo1NVrOGS-z3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMjo1Njo1NVrOGS-z3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU1NjYzNg==", "bodyText": "Failed to apply background image (sorry!). All done after this.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422556636", "createdAt": "2020-05-09T22:56:55Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -183,4 +183,5 @@\n     <string name=\"no_image_selected\">No image selected</string>\n     <string name=\"error_selecting_image\">Error selecting image. Please see manual. %s</string>\n     <string name=\"error_deleting_image\">Error deleting image</string>\n+    <string name=\"background_image_apply_failed\">Background image apply failed %s</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3dc19a5c833b782c107e408aa239b13ab71d995a"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 403, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}