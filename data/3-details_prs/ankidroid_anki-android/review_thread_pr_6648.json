{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1NDkyNTk4", "number": 6648, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjowMzo0NlrOEMJNMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMTo0ODozOFrOEMQUQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMTY5MjAyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/test/java/com/ichi2/libanki/DecksTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjowMzo0NlrOGuFcCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNjowMzo0NlrOGuFcCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3Njc3Nw==", "bodyText": "I was referring to a test to ensure that a deck with a trailing newline in the parent won't break the system from a higher level\nSomething along the lines of:\nBuild:\n\nA::B\\n\nA::B\\n::C\nA::B\\n::D\\n\nEnsure that deckDueTree works\n\nAnd ensure that the deck list can be built.", "url": "https://github.com/ankidroid/Anki-Android/pull/6648#discussion_r450976777", "createdAt": "2020-07-07T16:03:46Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/libanki/DecksTest.java", "diffHunk": "@@ -56,4 +56,11 @@ public void ensureDeckList() {\n             }\n         }\n     }\n+\n+    @Test\n+    public void trim() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c792fe16bdebd531529c779674cf26d87f4dd86"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMjg1MTI3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMTo0Njo0MVrOGuQxcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMTo0Njo0MVrOGuQxcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE2MjQ4MA==", "bodyText": "Comment to explain that this will handle decks that do not contain ::", "url": "https://github.com/ankidroid/Anki-Android/pull/6648#discussion_r451162480", "createdAt": "2020-07-07T21:46:41Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "diffHunk": "@@ -846,24 +847,12 @@ private void maybeAddToActive() {\n     }\n \n \n-    private static final Pattern spaceAroundSeparator = Pattern.compile(\" *:: *\");\n-    private static String strip(String deckName) {\n-        return spaceAroundSeparator.matcher(deckName.trim()).replaceAll( \"::\");\n-    }\n-\n-    /** With 2.1.28, anki started strips whitespace of deck name.\n-     * This method is here for compatibility while we wait for rust.\n-     * It should be executed before other methods, because both \"FOO \" and \"FOO\" will be renamed to the same name,\n-     * and so this will need to be renamed by _checkDeckTree.*/\n-    private void _removeSpaces () {\n-        for (JSONObject deck: all()) {\n-            String currentName = deck.getString(\"name\");\n-            String newName = strip(currentName);\n-            if (!currentName.equals(newName)) {\n-                deck.put(\"name\", newName);\n-                save(deck);\n-            }\n-        }\n+    private static final Pattern spaceAroundSeparator = Pattern.compile(\"\\\\s*::\\\\s*\");\n+    @VisibleForTesting\n+    public static String strip(String deckName) {\n+        deckName = spaceAroundSeparator.matcher(deckName).replaceAll(\"::\");\n+        deckName = deckName.trim();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a653f26093bf9b6ecdfb66c88b52d35f49e93035"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxMjg1Njk4OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMTo0ODozOFrOGuQ0-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QyMjozMDo0NlrOGuR3ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE2MzM4NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static String strip(String deckName) {\n          \n          \n            \n                static String strip(String deckName) {", "url": "https://github.com/ankidroid/Anki-Android/pull/6648#discussion_r451163384", "createdAt": "2020-07-07T21:48:38Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "diffHunk": "@@ -846,24 +847,12 @@ private void maybeAddToActive() {\n     }\n \n \n-    private static final Pattern spaceAroundSeparator = Pattern.compile(\" *:: *\");\n-    private static String strip(String deckName) {\n-        return spaceAroundSeparator.matcher(deckName.trim()).replaceAll( \"::\");\n-    }\n-\n-    /** With 2.1.28, anki started strips whitespace of deck name.\n-     * This method is here for compatibility while we wait for rust.\n-     * It should be executed before other methods, because both \"FOO \" and \"FOO\" will be renamed to the same name,\n-     * and so this will need to be renamed by _checkDeckTree.*/\n-    private void _removeSpaces () {\n-        for (JSONObject deck: all()) {\n-            String currentName = deck.getString(\"name\");\n-            String newName = strip(currentName);\n-            if (!currentName.equals(newName)) {\n-                deck.put(\"name\", newName);\n-                save(deck);\n-            }\n-        }\n+    private static final Pattern spaceAroundSeparator = Pattern.compile(\"\\\\s*::\\\\s*\");\n+    @VisibleForTesting\n+    public static String strip(String deckName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a653f26093bf9b6ecdfb66c88b52d35f49e93035"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE3NjI1MQ==", "bodyText": "Done. Even if I don't understand why public should be removed", "url": "https://github.com/ankidroid/Anki-Android/pull/6648#discussion_r451176251", "createdAt": "2020-07-07T22:20:03Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "diffHunk": "@@ -846,24 +847,12 @@ private void maybeAddToActive() {\n     }\n \n \n-    private static final Pattern spaceAroundSeparator = Pattern.compile(\" *:: *\");\n-    private static String strip(String deckName) {\n-        return spaceAroundSeparator.matcher(deckName.trim()).replaceAll( \"::\");\n-    }\n-\n-    /** With 2.1.28, anki started strips whitespace of deck name.\n-     * This method is here for compatibility while we wait for rust.\n-     * It should be executed before other methods, because both \"FOO \" and \"FOO\" will be renamed to the same name,\n-     * and so this will need to be renamed by _checkDeckTree.*/\n-    private void _removeSpaces () {\n-        for (JSONObject deck: all()) {\n-            String currentName = deck.getString(\"name\");\n-            String newName = strip(currentName);\n-            if (!currentName.equals(newName)) {\n-                deck.put(\"name\", newName);\n-                save(deck);\n-            }\n-        }\n+    private static final Pattern spaceAroundSeparator = Pattern.compile(\"\\\\s*::\\\\s*\");\n+    @VisibleForTesting\n+    public static String strip(String deckName) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE2MzM4NA=="}, "originalCommit": {"oid": "a653f26093bf9b6ecdfb66c88b52d35f49e93035"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE4MDQ4Mw==", "bodyText": "The test is in the same package - so we can use package-protected visibility, rather than public visibility.", "url": "https://github.com/ankidroid/Anki-Android/pull/6648#discussion_r451180483", "createdAt": "2020-07-07T22:30:46Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "diffHunk": "@@ -846,24 +847,12 @@ private void maybeAddToActive() {\n     }\n \n \n-    private static final Pattern spaceAroundSeparator = Pattern.compile(\" *:: *\");\n-    private static String strip(String deckName) {\n-        return spaceAroundSeparator.matcher(deckName.trim()).replaceAll( \"::\");\n-    }\n-\n-    /** With 2.1.28, anki started strips whitespace of deck name.\n-     * This method is here for compatibility while we wait for rust.\n-     * It should be executed before other methods, because both \"FOO \" and \"FOO\" will be renamed to the same name,\n-     * and so this will need to be renamed by _checkDeckTree.*/\n-    private void _removeSpaces () {\n-        for (JSONObject deck: all()) {\n-            String currentName = deck.getString(\"name\");\n-            String newName = strip(currentName);\n-            if (!currentName.equals(newName)) {\n-                deck.put(\"name\", newName);\n-                save(deck);\n-            }\n-        }\n+    private static final Pattern spaceAroundSeparator = Pattern.compile(\"\\\\s*::\\\\s*\");\n+    @VisibleForTesting\n+    public static String strip(String deckName) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE2MzM4NA=="}, "originalCommit": {"oid": "a653f26093bf9b6ecdfb66c88b52d35f49e93035"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 112, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}