{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3Nzg3NTIz", "number": 6662, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQwNDowNjo0OVrOENjong==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxMjo0NTozM1rOEOPgCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNjUwNzgyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/fields/BasicImageFieldController.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQwNDowNjo0OVrOGwRDUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMTo0ODo1OFrOGw7LPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI2NDIwOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Timber.w(\"getUriForFile failed on %s - attempting fallback\", file);\n          \n          \n            \n                        Timber.w(e, \"getUriForFile failed on %s - attempting fallback\", file);", "url": "https://github.com/ankidroid/Anki-Android/pull/6662#discussion_r453264208", "createdAt": "2020-07-12T04:06:49Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/fields/BasicImageFieldController.java", "diffHunk": "@@ -654,13 +654,15 @@ private void handleCropResult() {\n      */\n     private Uri getUriForFile(File file) {\n         Timber.d(\"getUriForFile() %s\", file);\n-        Uri uri;\n-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n-            uri = FileProvider.getUriForFile(mActivity, mActivity.getApplicationContext().getPackageName() + \".apkgfileprovider\", file);\n-        } else {\n-            uri = Uri.fromFile(file);\n+        try {\n+            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n+                return FileProvider.getUriForFile(mActivity, mActivity.getApplicationContext().getPackageName() + \".apkgfileprovider\", file);\n+            }\n+        } catch (Exception e) {\n+            Timber.w(\"getUriForFile failed on %s - attempting fallback\", file);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a5210731873ca37cc20cea3f01b37fcd1c1eae0"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMyNDIwNw==", "bodyText": "@david-allison-1 are you thinking sendExceptionReport with some info if it happens? That's what I infer by \"telemetry\", and it might help", "url": "https://github.com/ankidroid/Anki-Android/pull/6662#discussion_r453324207", "createdAt": "2020-07-12T14:35:01Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/fields/BasicImageFieldController.java", "diffHunk": "@@ -654,13 +654,15 @@ private void handleCropResult() {\n      */\n     private Uri getUriForFile(File file) {\n         Timber.d(\"getUriForFile() %s\", file);\n-        Uri uri;\n-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n-            uri = FileProvider.getUriForFile(mActivity, mActivity.getApplicationContext().getPackageName() + \".apkgfileprovider\", file);\n-        } else {\n-            uri = Uri.fromFile(file);\n+        try {\n+            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n+                return FileProvider.getUriForFile(mActivity, mActivity.getApplicationContext().getPackageName() + \".apkgfileprovider\", file);\n+            }\n+        } catch (Exception e) {\n+            Timber.w(\"getUriForFile failed on %s - attempting fallback\", file);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI2NDIwOA=="}, "originalCommit": {"oid": "2a5210731873ca37cc20cea3f01b37fcd1c1eae0"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMyNDgzMg==", "bodyText": "I added one semi-speculatively as a second commit along with the forgotten root exception to Timber, in a second commit", "url": "https://github.com/ankidroid/Anki-Android/pull/6662#discussion_r453324832", "createdAt": "2020-07-12T14:40:50Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/fields/BasicImageFieldController.java", "diffHunk": "@@ -654,13 +654,15 @@ private void handleCropResult() {\n      */\n     private Uri getUriForFile(File file) {\n         Timber.d(\"getUriForFile() %s\", file);\n-        Uri uri;\n-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n-            uri = FileProvider.getUriForFile(mActivity, mActivity.getApplicationContext().getPackageName() + \".apkgfileprovider\", file);\n-        } else {\n-            uri = Uri.fromFile(file);\n+        try {\n+            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n+                return FileProvider.getUriForFile(mActivity, mActivity.getApplicationContext().getPackageName() + \".apkgfileprovider\", file);\n+            }\n+        } catch (Exception e) {\n+            Timber.w(\"getUriForFile failed on %s - attempting fallback\", file);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI2NDIwOA=="}, "originalCommit": {"oid": "2a5210731873ca37cc20cea3f01b37fcd1c1eae0"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMzMDg4NA==", "bodyText": "and an exception report doesn't seem appropriate here if there's a valid fallback\n\nI don't think an exception report is the right mode of reporting here unless we can specify a \"only send if always send is checked\" - maybe that's the solution\nWe don't want to send an exception report if the operation succeeds due to corrective action as that's bad UX", "url": "https://github.com/ankidroid/Anki-Android/pull/6662#discussion_r453330884", "createdAt": "2020-07-12T15:31:16Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/fields/BasicImageFieldController.java", "diffHunk": "@@ -654,13 +654,15 @@ private void handleCropResult() {\n      */\n     private Uri getUriForFile(File file) {\n         Timber.d(\"getUriForFile() %s\", file);\n-        Uri uri;\n-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n-            uri = FileProvider.getUriForFile(mActivity, mActivity.getApplicationContext().getPackageName() + \".apkgfileprovider\", file);\n-        } else {\n-            uri = Uri.fromFile(file);\n+        try {\n+            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n+                return FileProvider.getUriForFile(mActivity, mActivity.getApplicationContext().getPackageName() + \".apkgfileprovider\", file);\n+            }\n+        } catch (Exception e) {\n+            Timber.w(\"getUriForFile failed on %s - attempting fallback\", file);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI2NDIwOA=="}, "originalCommit": {"oid": "2a5210731873ca37cc20cea3f01b37fcd1c1eae0"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMzMDkzOA==", "bodyText": "But, I don't think this should block the review regardless.", "url": "https://github.com/ankidroid/Anki-Android/pull/6662#discussion_r453330938", "createdAt": "2020-07-12T15:31:48Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/fields/BasicImageFieldController.java", "diffHunk": "@@ -654,13 +654,15 @@ private void handleCropResult() {\n      */\n     private Uri getUriForFile(File file) {\n         Timber.d(\"getUriForFile() %s\", file);\n-        Uri uri;\n-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n-            uri = FileProvider.getUriForFile(mActivity, mActivity.getApplicationContext().getPackageName() + \".apkgfileprovider\", file);\n-        } else {\n-            uri = Uri.fromFile(file);\n+        try {\n+            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n+                return FileProvider.getUriForFile(mActivity, mActivity.getApplicationContext().getPackageName() + \".apkgfileprovider\", file);\n+            }\n+        } catch (Exception e) {\n+            Timber.w(\"getUriForFile failed on %s - attempting fallback\", file);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI2NDIwOA=="}, "originalCommit": {"oid": "2a5210731873ca37cc20cea3f01b37fcd1c1eae0"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk1NDM2Nw==", "bodyText": "Good thinking, I re-pushed the second commit with a new \"only send the report if the user is set to autoaccept\" style, what do you think?", "url": "https://github.com/ankidroid/Anki-Android/pull/6662#discussion_r453954367", "createdAt": "2020-07-13T21:48:58Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/fields/BasicImageFieldController.java", "diffHunk": "@@ -654,13 +654,15 @@ private void handleCropResult() {\n      */\n     private Uri getUriForFile(File file) {\n         Timber.d(\"getUriForFile() %s\", file);\n-        Uri uri;\n-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n-            uri = FileProvider.getUriForFile(mActivity, mActivity.getApplicationContext().getPackageName() + \".apkgfileprovider\", file);\n-        } else {\n-            uri = Uri.fromFile(file);\n+        try {\n+            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n+                return FileProvider.getUriForFile(mActivity, mActivity.getApplicationContext().getPackageName() + \".apkgfileprovider\", file);\n+            }\n+        } catch (Exception e) {\n+            Timber.w(\"getUriForFile failed on %s - attempting fallback\", file);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI2NDIwOA=="}, "originalCommit": {"oid": "2a5210731873ca37cc20cea3f01b37fcd1c1eae0"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMzY5NDgzOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AnkiDroidApp.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxMjo0NTozM1rOGxSDQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNDoyODoyOFrOGxWQ3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDMyOTE1Mg==", "bodyText": "nit: onlyAlwaysOn doesn't seem necessary. There's no reason to pass false.\nMaybe send[Silent/Unintrusive]ExceptionReport?", "url": "https://github.com/ankidroid/Anki-Android/pull/6662#discussion_r454329152", "createdAt": "2020-07-14T12:45:33Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AnkiDroidApp.java", "diffHunk": "@@ -342,6 +342,15 @@ public static void sendExceptionReport(Throwable e, String origin, String additi\n     }\n \n \n+    public static void sendExceptionReportConditionally(Throwable e, String origin, String additionalInfo, boolean onlyAlwaysOn) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "330038b3fd72ad1c8e632a989dbf95005ae86690"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDM5ODE3Mw==", "bodyText": "I like that - when I began the API addition I was thinking I'd do the typical extra-optional-argument / chain others to it type deal then I as I thought about it since it touched Preferences and the others didn't, this one might be heavier so it should probably chain back to the existing API. Basically I waffled on it so it's chaining back and got a crap name. I'm going to reshape it to be the more standard pattern of API chaining into the one with more arguments and the new argument will be onlyIfSilent and get a good javadoc", "url": "https://github.com/ankidroid/Anki-Android/pull/6662#discussion_r454398173", "createdAt": "2020-07-14T14:28:28Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AnkiDroidApp.java", "diffHunk": "@@ -342,6 +342,15 @@ public static void sendExceptionReport(Throwable e, String origin, String additi\n     }\n \n \n+    public static void sendExceptionReportConditionally(Throwable e, String origin, String additionalInfo, boolean onlyAlwaysOn) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDMyOTE1Mg=="}, "originalCommit": {"oid": "330038b3fd72ad1c8e632a989dbf95005ae86690"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 117, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}