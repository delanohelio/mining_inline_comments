{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2ODc2Nzcw", "number": 6503, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNjo1MDowNlrOEIDXgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMjoyNTowM1rOEIMhhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2ODc5MjM1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNjo1MDowN1rOGnyA3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxODoyNzo1M1rOGn1eeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM2NzA2OA==", "bodyText": "This is a bit subtle for me.\nFirst can you do a test for ACTION_DOWN first and just return fast, that will clear that part out of the logic\nSecond, and you do a switch on keyCode for up, down, and default, that should cleanly separate the three cases of mGestureVolumeUp / mGestureVolumeDown / COMMAND_NOTHING without having ternary operators that might overwrite a value with itself (a concept that is a bit hard to follow)", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#discussion_r444367068", "createdAt": "2020-06-23T16:50:07Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1338,6 +1340,28 @@ protected void answerCard(int ease) {\n     }\n \n \n+    @Override\n+    public boolean dispatchKeyEvent(KeyEvent event) {\n+        int keyCode = event.getKeyCode();\n+\n+        if (event.getAction() == KeyEvent.ACTION_DOWN &&\n+                (keyCode == KeyEvent.KEYCODE_VOLUME_UP || keyCode == KeyEvent.KEYCODE_VOLUME_DOWN)) {\n+            int gesture = (keyCode == KeyEvent.KEYCODE_VOLUME_UP) ? mGestureVolumeUp : COMMAND_NOTHING;\n+            gesture = (keyCode == KeyEvent.KEYCODE_VOLUME_DOWN) ? mGestureVolumeDown : gesture;\n+\n+            // Execute command, but only consume event if action took place. We want the volume buttons to work normally otherwise.\n+            if (gesture != COMMAND_NOTHING) {\n+                executeCommand(gesture);\n+                return true;\n+            }\n+\n+            return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27b2db09d62786eaf0cdd2d023cfe88b9c6e4b82"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQyMzgwMA==", "bodyText": "Okay, I've changed it to be a bit more explicit. An early return would have left me with two calls to the super method, hence the large if. The switch doesn't have a default case, because gesture is initialized before and thus only declared once. Feel free to change it though, only my opinion.", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#discussion_r444423800", "createdAt": "2020-06-23T18:27:53Z", "author": {"login": "tobrie"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1338,6 +1340,28 @@ protected void answerCard(int ease) {\n     }\n \n \n+    @Override\n+    public boolean dispatchKeyEvent(KeyEvent event) {\n+        int keyCode = event.getKeyCode();\n+\n+        if (event.getAction() == KeyEvent.ACTION_DOWN &&\n+                (keyCode == KeyEvent.KEYCODE_VOLUME_UP || keyCode == KeyEvent.KEYCODE_VOLUME_DOWN)) {\n+            int gesture = (keyCode == KeyEvent.KEYCODE_VOLUME_UP) ? mGestureVolumeUp : COMMAND_NOTHING;\n+            gesture = (keyCode == KeyEvent.KEYCODE_VOLUME_DOWN) ? mGestureVolumeDown : gesture;\n+\n+            // Execute command, but only consume event if action took place. We want the volume buttons to work normally otherwise.\n+            if (gesture != COMMAND_NOTHING) {\n+                executeCommand(gesture);\n+                return true;\n+            }\n+\n+            return false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM2NzA2OA=="}, "originalCommit": {"oid": "27b2db09d62786eaf0cdd2d023cfe88b9c6e4b82"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MDI4MDk1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMjoxODozMlrOGoAqBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMjoxODozMlrOGoAqBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYwNjk4Mw==", "bodyText": "We should refactor this to take a ViewerCommandDef (not necessarily in this PR, but the meaning of the strings isn't clear)\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        mGestureVolumeUp = Integer.parseInt(preferences.getString(\"gestureVolumeUp\", \"11\"));\n          \n          \n            \n                        mGestureVolumeUp = Integer.parseInt(preferences.getString(\"gestureVolumeUp\", \"0\"));", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#discussion_r444606983", "createdAt": "2020-06-24T02:18:32Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1677,6 +1705,8 @@ protected SharedPreferences restorePreferences() {\n             mGestureTapTop = Integer.parseInt(preferences.getString(\"gestureTapTop\", \"12\"));\n             mGestureTapBottom = Integer.parseInt(preferences.getString(\"gestureTapBottom\", \"2\"));\n             mGestureLongclick = Integer.parseInt(preferences.getString(\"gestureLongclick\", \"11\"));\n+            mGestureVolumeUp = Integer.parseInt(preferences.getString(\"gestureVolumeUp\", \"11\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ea7aaffcf02f1fd78f9a207b5fe11c8444cfec"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MDI4MTUyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMjoxODo1MVrOGoAqXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjo1MjozMFrOGpDajg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYwNzA2OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        mGestureVolumeDown = Integer.parseInt(preferences.getString(\"gestureVolumeDown\", \"11\"));\n          \n          \n            \n                        mGestureVolumeDown = Integer.parseInt(preferences.getString(\"gestureVolumeDown\", \"0\"));", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#discussion_r444607068", "createdAt": "2020-06-24T02:18:51Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1677,6 +1705,8 @@ protected SharedPreferences restorePreferences() {\n             mGestureTapTop = Integer.parseInt(preferences.getString(\"gestureTapTop\", \"12\"));\n             mGestureTapBottom = Integer.parseInt(preferences.getString(\"gestureTapBottom\", \"2\"));\n             mGestureLongclick = Integer.parseInt(preferences.getString(\"gestureLongclick\", \"11\"));\n+            mGestureVolumeUp = Integer.parseInt(preferences.getString(\"gestureVolumeUp\", \"11\"));\n+            mGestureVolumeDown = Integer.parseInt(preferences.getString(\"gestureVolumeDown\", \"11\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ea7aaffcf02f1fd78f9a207b5fe11c8444cfec"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcwMDc1MA==", "bodyText": "makes sense", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#discussion_r445700750", "createdAt": "2020-06-25T16:52:30Z", "author": {"login": "tobrie"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1677,6 +1705,8 @@ protected SharedPreferences restorePreferences() {\n             mGestureTapTop = Integer.parseInt(preferences.getString(\"gestureTapTop\", \"12\"));\n             mGestureTapBottom = Integer.parseInt(preferences.getString(\"gestureTapBottom\", \"2\"));\n             mGestureLongclick = Integer.parseInt(preferences.getString(\"gestureLongclick\", \"11\"));\n+            mGestureVolumeUp = Integer.parseInt(preferences.getString(\"gestureVolumeUp\", \"11\"));\n+            mGestureVolumeDown = Integer.parseInt(preferences.getString(\"gestureVolumeDown\", \"11\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYwNzA2OA=="}, "originalCommit": {"oid": "41ea7aaffcf02f1fd78f9a207b5fe11c8444cfec"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MDI5MjU0OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMjoyNTowM1rOGoAw7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNjo1Mjo0OVrOGpDbQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYwODc1MQ==", "bodyText": "nit: invert if to reduce nesting", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#discussion_r444608751", "createdAt": "2020-06-24T02:25:03Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1338,6 +1340,32 @@ protected void answerCard(int ease) {\n     }\n \n \n+    @Override\n+    public boolean dispatchKeyEvent(KeyEvent event) {\n+        if (event.getAction() == KeyEvent.ACTION_DOWN) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ea7aaffcf02f1fd78f9a207b5fe11c8444cfec"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcwMDQ2NQ==", "bodyText": "That would require 2 returns with calls to super. If you prefer I can still change it.", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#discussion_r445700465", "createdAt": "2020-06-25T16:52:00Z", "author": {"login": "tobrie"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1338,6 +1340,32 @@ protected void answerCard(int ease) {\n     }\n \n \n+    @Override\n+    public boolean dispatchKeyEvent(KeyEvent event) {\n+        if (event.getAction() == KeyEvent.ACTION_DOWN) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYwODc1MQ=="}, "originalCommit": {"oid": "41ea7aaffcf02f1fd78f9a207b5fe11c8444cfec"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTcwMDkzMQ==", "bodyText": "Implementer's choice", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#discussion_r445700931", "createdAt": "2020-06-25T16:52:49Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1338,6 +1340,32 @@ protected void answerCard(int ease) {\n     }\n \n \n+    @Override\n+    public boolean dispatchKeyEvent(KeyEvent event) {\n+        if (event.getAction() == KeyEvent.ACTION_DOWN) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYwODc1MQ=="}, "originalCommit": {"oid": "41ea7aaffcf02f1fd78f9a207b5fe11c8444cfec"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 212, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}