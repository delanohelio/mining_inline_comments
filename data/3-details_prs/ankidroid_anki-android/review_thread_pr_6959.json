{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyMjA1ODgx", "number": 6959, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwOToyNTozNFrOEbevYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwOToyNTozNFrOEbevYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MjUwNjU3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwOToyNTozNFrOHFbx9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMDo0NTozMFrOHFfBrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ2MDA4Nw==", "bodyText": "Could you modify the ported tests to run twice, once using this undo, one one using the regular col.undo()", "url": "https://github.com/ankidroid/Anki-Android/pull/6959#discussion_r475460087", "createdAt": "2020-08-24T09:25:34Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1125,6 +1126,33 @@ private TaskData doInBackgroundDismissNotes(TaskData param) {\n         return copies;\n     }\n \n+    @VisibleForTesting\n+    public static Card nonTaskUndo(Collection col) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecd110d879d5c2c7e9861a8593b66dbd2d78b72b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUxMDcwMQ==", "bodyText": "I can. But in my opinion, if there is a change to do, it would be col.undo() to actually do the entire part of the background task, dealing with the consequence of undoing such as telling the scheduler that queues and counts are not correct anymore.\nBecause, even if col.undo() is called from the content provider, that does not mean the scheduler has correct value, and currently the scheduler is not reset.\nI didn't change it because I was asked to avoid refactor that moves code and anyway I don't have a good intuition of who uses the content provider and whether they already deal with this fact themselves (assuming anyone actually undo from the content provider)", "url": "https://github.com/ankidroid/Anki-Android/pull/6959#discussion_r475510701", "createdAt": "2020-08-24T10:39:55Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1125,6 +1126,33 @@ private TaskData doInBackgroundDismissNotes(TaskData param) {\n         return copies;\n     }\n \n+    @VisibleForTesting\n+    public static Card nonTaskUndo(Collection col) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ2MDA4Nw=="}, "originalCommit": {"oid": "ecd110d879d5c2c7e9861a8593b66dbd2d78b72b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUxMzI2MQ==", "bodyText": "That would be a natural fit for #6959 by the way.\nI really believe that it's uselessly complex that \"undo\" deal with a method in background task, a method in collection before finally reaching the Undoable object. Especially since the job of the collection method is only to remove the Undo element from the queue, and the actual undoing is split between the CollectionTask method and the Undoable method for no reason I can imagine (it's not like we actually need a part of the undo to occur before the stack is changed and another part of undo to occur after the stack is changed)", "url": "https://github.com/ankidroid/Anki-Android/pull/6959#discussion_r475513261", "createdAt": "2020-08-24T10:45:30Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1125,6 +1126,33 @@ private TaskData doInBackgroundDismissNotes(TaskData param) {\n         return copies;\n     }\n \n+    @VisibleForTesting\n+    public static Card nonTaskUndo(Collection col) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ2MDA4Nw=="}, "originalCommit": {"oid": "ecd110d879d5c2c7e9861a8593b66dbd2d78b72b"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4890, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}