{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMTQxOTkz", "number": 6577, "title": "NF: _groupChildrenMain deal with unchecked deck collection (performance)", "bodyText": "One of the reason loading a lot of deck takes time at startup is long is that we must do a lot of operations to check the deck collection. This is less computationally expensive than computing numbers, but still takes seconds. So this PR allows the method to take a parameter warning it that the deck is not yet checked, and that it should Timber in case of problem and just ignore the faulty deck.\nRight now, this feature si never used. It is of course a part of my bigger PR for improving starting time. I expect to use this new feature to make starting faster. And the few cases where the collection start with duplicate name or missing parents, the faulty deck will take a few seconds to appear while everything else will appear correctly immediately", "createdAt": "2020-06-29T00:49:21Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6577", "merged": true, "mergeCommit": {"oid": "18f98b521b03c4b1564eb628f88206d865a2133e"}, "closed": true, "closedAt": "2020-06-29T23:13:27Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcv9QzSgFqTQzOTAxNDgzMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwGgXpABqjM0OTQyNjE3MzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MDE0ODMy", "url": "https://github.com/ankidroid/Anki-Android/pull/6577#pullrequestreview-439014832", "createdAt": "2020-06-29T09:03:05Z", "commit": {"oid": "567a1630f19464aa8565b0d4819df466c93064f0"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MTQyNjM0", "url": "https://github.com/ankidroid/Anki-Android/pull/6577#pullrequestreview-439142634", "createdAt": "2020-06-29T13:28:30Z", "commit": {"oid": "567a1630f19464aa8565b0d4819df466c93064f0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMzoyODozMFrOGqQ88w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMzozNjo0MVrOGqRSrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3MTEyMw==", "bodyText": "Would be useful to extract into a method/input to the function, given that it's duplicated 3 times.", "url": "https://github.com/ankidroid/Anki-Android/pull/6577#discussion_r446971123", "createdAt": "2020-06-29T13:28:30Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java", "diffHunk": "@@ -454,10 +454,20 @@ protected int _walkingCount(LimitMethod limFn, CountMethod cntFn) {\n              * current one itself.  I.e., they are subdecks that stem\n              * from this node.  This is our version of python's\n              * itertools.groupby. */\n+            if (!checkDone && node.getDepth() != depth) {\n+                JSONObject deck = mCol.getDecks().get(node.getDid());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "567a1630f19464aa8565b0d4819df466c93064f0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk3NjY4NQ==", "bodyText": "I don't know what checkDone means, a comment would be useful.", "url": "https://github.com/ankidroid/Anki-Android/pull/6577#discussion_r446976685", "createdAt": "2020-06-29T13:36:41Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/Sched.java", "diffHunk": "@@ -245,7 +245,7 @@ private void unburyCardsForDeck(List<Long> allDecks) {\n \n \n     @Override\n-    protected List<DeckDueTreeNode> _groupChildrenMain(List<DeckDueTreeNode> grps, int depth) {\n+    protected List<DeckDueTreeNode> _groupChildrenMain(List<DeckDueTreeNode> grps, int depth, boolean checkDone) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "567a1630f19464aa8565b0d4819df466c93064f0"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "567a1630f19464aa8565b0d4819df466c93064f0", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/567a1630f19464aa8565b0d4819df466c93064f0", "committedDate": "2020-06-29T00:43:48Z", "message": "NF: _groupChildrenMain deal with unchecked deck\n\nIn order to display the deck picker quickly, we accept to deal with\ndeck list which may have trouble. In order to do it, we simply decide\nto ignore decks if there is a problem. I.e. duplicate name or no parent."}, "afterCommit": {"oid": "3b5154918e20cbec8adb9399fd8bcb957450312a", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3b5154918e20cbec8adb9399fd8bcb957450312a", "committedDate": "2020-06-29T14:51:53Z", "message": "NF: _groupChildrenMain deal with unchecked deck\n\nIn order to display the deck picker quickly, we accept to deal with\ndeck list which may have trouble. In order to do it, we simply decide\nto ignore decks if there is a problem. I.e. duplicate name or no parent."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NDI1MzMy", "url": "https://github.com/ankidroid/Anki-Android/pull/6577#pullrequestreview-439425332", "createdAt": "2020-06-29T19:10:05Z", "commit": {"oid": "3b5154918e20cbec8adb9399fd8bcb957450312a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NDI3Mzc1", "url": "https://github.com/ankidroid/Anki-Android/pull/6577#pullrequestreview-439427375", "createdAt": "2020-06-29T19:13:24Z", "commit": {"oid": "3b5154918e20cbec8adb9399fd8bcb957450312a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09b073e9cc81c45deb05b8908d144a58d0923366", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/09b073e9cc81c45deb05b8908d144a58d0923366", "committedDate": "2020-06-29T19:47:16Z", "message": "NF: _groupChildrenMain deal with unchecked deck\n\nIn order to display the deck picker quickly, we accept to deal with\ndeck list which may have trouble. In order to do it, we simply decide\nto ignore decks if there is a problem. I.e. duplicate name or no parent."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b5154918e20cbec8adb9399fd8bcb957450312a", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3b5154918e20cbec8adb9399fd8bcb957450312a", "committedDate": "2020-06-29T14:51:53Z", "message": "NF: _groupChildrenMain deal with unchecked deck\n\nIn order to display the deck picker quickly, we accept to deal with\ndeck list which may have trouble. In order to do it, we simply decide\nto ignore decks if there is a problem. I.e. duplicate name or no parent."}, "afterCommit": {"oid": "09b073e9cc81c45deb05b8908d144a58d0923366", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/09b073e9cc81c45deb05b8908d144a58d0923366", "committedDate": "2020-06-29T19:47:16Z", "message": "NF: _groupChildrenMain deal with unchecked deck\n\nIn order to display the deck picker quickly, we accept to deal with\ndeck list which may have trouble. In order to do it, we simply decide\nto ignore decks if there is a problem. I.e. duplicate name or no parent."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3031, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}