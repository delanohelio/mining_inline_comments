{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5NDQxNjU1", "number": 7472, "title": "NF: _tmplsFromOrds quicker", "bodyText": "Currently, avail traverse the list uselessly. This ensure that we get the speed of random access\nOn my collection, it reduces the time spent in _tmplsFromOrds from 30 seconds to 11\u00a0seconds", "createdAt": "2020-10-24T14:41:08Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7472", "merged": true, "mergeCommit": {"oid": "8b752ec4e7fdfbf9ac2102b5af3d0dd2d4f9d15f"}, "closed": true, "closedAt": "2020-10-24T17:38:33Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVssjgAFqTUxNjI4NDc3NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVuB1ggBqjM5MTY5MjA0NTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mjg0Nzc1", "url": "https://github.com/ankidroid/Anki-Android/pull/7472#pullrequestreview-516284775", "createdAt": "2020-10-24T15:14:07Z", "commit": {"oid": "0139c0ee1015beac03a8685f02e2ccbe3deac78d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxNToxNDowOFrOHnyZbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxNToxNDowOFrOHnyZbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ4MjIyMw==", "bodyText": "here we are iterating through the set of available templates as our source for determining to include or not, which implicitly constrains the search to only existing templates, even if avail somehow contains a template ordinal that does not exist", "url": "https://github.com/ankidroid/Anki-Android/pull/7472#discussion_r511482223", "createdAt": "2020-10-24T15:14:08Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -700,10 +700,8 @@ public void _remNotes(java.util.Collection<Long> ids) {\n         JSONArray tmpls;\n         if (model.getInt(\"type\") == Consts.MODEL_STD) {\n             tmpls = model.getJSONArray(\"tmpls\");\n-            for (JSONObject t : tmpls.jsonObjectIterable()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0139c0ee1015beac03a8685f02e2ccbe3deac78d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mjg0ODk4", "url": "https://github.com/ankidroid/Anki-Android/pull/7472#pullrequestreview-516284898", "createdAt": "2020-10-24T15:16:05Z", "commit": {"oid": "0139c0ee1015beac03a8685f02e2ccbe3deac78d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxNToxNjowNVrOHnybLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxNToxNjowNVrOHnybLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ4MjY2OA==", "bodyText": "...in the proposed version we are now getting a template via ordinal directly from the avail array without checking first to make sure that the ordinal actually exists in the set of templates on the model\nI don't think this is a big risk but is not NF, it is possible now to request an array of ordinals from the model that don't exist, and different behavior will happen.\nIf there was a check first to make sure that the ordinal existed / the return value of tmpls.getJSONObject(ord) was valid before attempting to add it to to the return collection, then this would truly be NF I think", "url": "https://github.com/ankidroid/Anki-Android/pull/7472#discussion_r511482668", "createdAt": "2020-10-24T15:16:05Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -700,10 +700,8 @@ public void _remNotes(java.util.Collection<Long> ids) {\n         JSONArray tmpls;\n         if (model.getInt(\"type\") == Consts.MODEL_STD) {\n             tmpls = model.getJSONArray(\"tmpls\");\n-            for (JSONObject t : tmpls.jsonObjectIterable()) {\n-                if (avail.contains(t.getInt(\"ord\"))) {\n-                    ok.add(t);\n-                }\n+            for (Integer ord : avail) {\n+                ok.add(tmpls.getJSONObject(ord));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0139c0ee1015beac03a8685f02e2ccbe3deac78d"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0139c0ee1015beac03a8685f02e2ccbe3deac78d", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0139c0ee1015beac03a8685f02e2ccbe3deac78d", "committedDate": "2020-10-24T13:49:29Z", "message": "NF: _tmplsFromOrds quicker\n\nCurrently, avail traverse the list uselessly. This ensure that we get random access"}, "afterCommit": {"oid": "4574b37bcc4a24212f0839dd32acb54feda8c134", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4574b37bcc4a24212f0839dd32acb54feda8c134", "committedDate": "2020-10-24T16:14:42Z", "message": "NF: _tmplsFromOrds quicker\n\nCurrently, avail traverse the list uselessly. This ensure that we get random access"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mjg5NDM4", "url": "https://github.com/ankidroid/Anki-Android/pull/7472#pullrequestreview-516289438", "createdAt": "2020-10-24T16:24:43Z", "commit": {"oid": "4574b37bcc4a24212f0839dd32acb54feda8c134"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bbf4b7008ef03020578351d714539a09e01b7b3", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3bbf4b7008ef03020578351d714539a09e01b7b3", "committedDate": "2020-10-24T16:47:10Z", "message": "NF: add comment for card generation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa136d3fe3324bb33d84fe3afe587938fdfbe9fd", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/aa136d3fe3324bb33d84fe3afe587938fdfbe9fd", "committedDate": "2020-10-24T16:47:10Z", "message": "NF: _tmplsFromOrds quicker\n\nCurrently, avail traverse the list uselessly. This ensure that we get random access"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4574b37bcc4a24212f0839dd32acb54feda8c134", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4574b37bcc4a24212f0839dd32acb54feda8c134", "committedDate": "2020-10-24T16:14:42Z", "message": "NF: _tmplsFromOrds quicker\n\nCurrently, avail traverse the list uselessly. This ensure that we get random access"}, "afterCommit": {"oid": "aa136d3fe3324bb33d84fe3afe587938fdfbe9fd", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/aa136d3fe3324bb33d84fe3afe587938fdfbe9fd", "committedDate": "2020-10-24T16:47:10Z", "message": "NF: _tmplsFromOrds quicker\n\nCurrently, avail traverse the list uselessly. This ensure that we get random access"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3875, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}