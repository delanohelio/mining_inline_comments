{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2NzI0MTQ3", "number": 6497, "title": "Note editor cloze more available", "bodyText": "Pull Request template\nPurpose / Description\nWe have been getting terrible reviews, all focused on cloze deletion, from Vietnam.\nI just couldn't figure it out.\nFinally it turns out it's Xiaomi devices! They apparently just don't do action mode callbacks well.\nAlso we didn't set action mode callbacks for lower APIs so anything below API23 was out of luck too.\nThis PR adds cloze as an option on the paperclip menu so it's usable everywhere now.\nFixes\nFixes #6494\nApproach\nIf it's a cloze type card, make a cloze menu item visible on the paperclip menu, and hook that to all the existing cloze insertion code\nHow Has This Been Tested?\nFor both cloze and non-cloze card types, on an API29 and API22 emulator, verify that cloze deletion is visible when it should be on the paperclip menu, and that it works.\nI will note there is some crap behavior on API22 where your text selection goes away when any other activity on the screen happens, but that also happened when I tried context menus, so we just can't win there. At least users can actually get a properly formatted set of cloze brackets automatically now.\nLearning (optional, can help others)\nXiaomi is a terrible Android vendor. Seriously, they implement multiple Android APIs incorrectly, over years, with no fixes.\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-06-18T19:38:12Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6497", "merged": true, "mergeCommit": {"oid": "4b5dc3fa7e484a86cc67bd04176bc23b2a0269f4"}, "closed": true, "closedAt": "2020-06-18T22:46:12Z", "author": {"login": "mikehardy"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsi5TpgH2gAyNDM2NzI0MTQ3OjUxYzhhYTk3NjM2Njk2ODZlZDY4MGI2MTk1YmZhYTBkZTkzZTc2OGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcskTxsAFqTQzMzYxNTk5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "51c8aa9763669686ed680b6195bfaa0de93e768c", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/51c8aa9763669686ed680b6195bfaa0de93e768c", "committedDate": "2020-06-18T18:38:07Z", "message": "NF: extract method NoteEditor.convertSelectedTextToCloze"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae19bbad1da7c4cc03809cbc1ae1cf3f1958bff8", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ae19bbad1da7c4cc03809cbc1ae1cf3f1958bff8", "committedDate": "2020-06-18T18:42:10Z", "message": "NF: convert note editor cloze insertion to String.format()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fa2c98d53afc292e35dcc931477564fca56c4a6", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/1fa2c98d53afc292e35dcc931477564fca56c4a6", "committedDate": "2020-06-18T19:30:49Z", "message": "Add cloze deletion to paperclip menu in note edit\n\nThis should make cloze deletion a bit more discoverable in general,\nplus it fixes #6494 where it was not available at all on Xiami devices"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNTkzMTcy", "url": "https://github.com/ankidroid/Anki-Android/pull/6497#pullrequestreview-433593172", "createdAt": "2020-06-18T19:42:04Z", "commit": {"oid": "ae19bbad1da7c4cc03809cbc1ae1cf3f1958bff8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxOTo0MjowNFrOGl9scw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxOTo0MjowNFrOGl9scw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ2MTI5OQ==", "bodyText": "This is mostly pointless but it killed an i18n lint warning without disabling the warning \ud83e\udd37", "url": "https://github.com/ankidroid/Anki-Android/pull/6497#discussion_r442461299", "createdAt": "2020-06-18T19:42:04Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/NoteEditor.java", "diffHunk": "@@ -1816,7 +1816,7 @@ private void convertSelectedTextToCloze(FieldEditText textBox) {\n         String clozeOpenBracket = \"{{c\" + (nextClozeIndex) + \"::\";\n \n         // Update text field with updated text and selection\n-        textBox.setText(beforeText + clozeOpenBracket + selectedText + \"}}\" + afterText);\n+        textBox.setText(String.format(\"%s%s%s}}%s\", beforeText, clozeOpenBracket, selectedText, afterText));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae19bbad1da7c4cc03809cbc1ae1cf3f1958bff8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNjE1OTk2", "url": "https://github.com/ankidroid/Anki-Android/pull/6497#pullrequestreview-433615996", "createdAt": "2020-06-18T20:16:56Z", "commit": {"oid": "1fa2c98d53afc292e35dcc931477564fca56c4a6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3231, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}