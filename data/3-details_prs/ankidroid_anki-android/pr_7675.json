{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwOTU5MjE3", "number": 7675, "title": "Card Browser: Fix \"Undo\" not appearing and stale data", "bodyText": "Purpose / Description\n\nPressing \"Reschedule/Reposition/Reset Cards\" did not bring up the \"undo\" item\nThese items and Undo did not update the data in the grid\n\nFixes\nFixes #7674\nApproach\nObtain the cards, reset them and make the grid refresh\nHow Has This Been Tested?\nAndroid 9, and some unit tests - some were flaky\nLearning (optional, can help others)\nWe need more tests\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code\n UI changes: include screenshots of all affected screens (in particular showing any new or changed strings)\n Strings resources: All strings added as resources are unique or contain a comment for seemingly duplicate strings to explain the difference between both resources", "createdAt": "2020-11-14T04:39:12Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7675", "merged": true, "mergeCommit": {"oid": "ebba0a01b1f2a8b0e6996539f1d0daac0470c201"}, "closed": true, "closedAt": "2020-11-15T12:36:03Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcXzAxgFqTUzMDU2NDQ3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcvno8gFqTUzMDc5NDYwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNTY0NDc2", "url": "https://github.com/ankidroid/Anki-Android/pull/7675#pullrequestreview-530564476", "createdAt": "2020-11-14T08:50:39Z", "commit": {"oid": "26b21e1ad23d48faa3ca0b54c62f2e5d66d2e69a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNTY0NTg5", "url": "https://github.com/ankidroid/Anki-Android/pull/7675#pullrequestreview-530564589", "createdAt": "2020-11-14T08:52:27Z", "commit": {"oid": "43dc158f43983b7988e63c8567c1cdf2acbf8b87"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQwODo1MjoyN1rOHzJjXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQwOTowMDozN1rOHzJmEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzM5NTkzNQ==", "bodyText": "Why did days became position?", "url": "https://github.com/ankidroid/Anki-Android/pull/7675#discussion_r523395935", "createdAt": "2020-11-14T08:52:27Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "diffHunk": "@@ -1169,10 +1169,7 @@ public boolean onOptionsItemSelected(MenuItem item) {\n                     getString(R.string.reposition_card_dialog_title),\n                     getString(R.string.reposition_card_dialog_message),\n                     5);\n-            repositionDialog.setCallbackRunnable(days ->\n-                    CollectionTask.launchCollectionTask(DISMISS_MULTI, repositionCardHandler(),\n-                            new TaskData(new Object[] {cardIds, Collection.DismissType.REPOSITION_CARDS, days}))\n-            );\n+            repositionDialog.setCallbackRunnable(position -> repositionCardsNoValidation(cardIds, position));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43dc158f43983b7988e63c8567c1cdf2acbf8b87"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzM5NjYyNw==", "bodyText": "Nice.\nMay I suggest to move it in its own commit, and update the four tests where it's used to remove the array and make code smaller", "url": "https://github.com/ankidroid/Anki-Android/pull/7675#discussion_r523396627", "createdAt": "2020-11-14T09:00:37Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "diffHunk": "@@ -2745,7 +2770,7 @@ void rerenderAllCards() {\n     }\n \n     @VisibleForTesting(otherwise = VisibleForTesting.NONE)\n-    void checkCardsAtPositions(int[] positions) {\n+    void checkCardsAtPositions(int... positions) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e755714d9c5cb5339f910b4a27e252b9854d6b08"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d20f8fd85d9fe58d5fedf12a9a1a7bd22968297", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5d20f8fd85d9fe58d5fedf12a9a1a7bd22968297", "committedDate": "2020-11-14T16:49:45Z", "message": "NF: Rename checkedCardsAtPositions\n\ncheckCardsAtPositions makes more sense as we perform the \"check\" action"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27c3b0a39ea7b5584e05ce852fda0aef4a686bd2", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/27c3b0a39ea7b5584e05ce852fda0aef4a686bd2", "committedDate": "2020-11-14T16:49:46Z", "message": "NF: extract repositionCardsNoValidation\n\nUseful for testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77731f8786a5761de2bd6e770dd44f18bb3cb96e", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/77731f8786a5761de2bd6e770dd44f18bb3cb96e", "committedDate": "2020-11-14T16:49:47Z", "message": "NF: Extract rescheduleWithoutValidation\n\nuseful for testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db364b559e8d611c91d640184fcb633d1a98163a", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/db364b559e8d611c91d640184fcb633d1a98163a", "committedDate": "2020-11-14T16:49:48Z", "message": "NF: Extract onResetProgress\n\nuseful for testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdadc7920b4572b813e9ffec8443f37ded16e845", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/cdadc7920b4572b813e9ffec8443f37ded16e845", "committedDate": "2020-11-14T16:49:49Z", "message": "NF: Extract resetProgressNoConfirm\n\nuseful for testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b063ff4b2998dd4f2b25a0d546d35c776d42e1f", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8b063ff4b2998dd4f2b25a0d546d35c776d42e1f", "committedDate": "2020-11-14T16:53:23Z", "message": "NF: checkCardsAtPositions - accept varargs\n\nSlightly cleans up the code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "408ef4c4cfa411e1db2036c531f4cd755422b6fa", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/408ef4c4cfa411e1db2036c531f4cd755422b6fa", "committedDate": "2020-11-14T16:53:24Z", "message": "Refresh Card Browser data on reposition\n\nData was stale\n\nReposition, reset and reschedule\n\nFixes 7674"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e0821a04fc48664333d61ce02af17971db350e5", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0e0821a04fc48664333d61ce02af17971db350e5", "committedDate": "2020-11-14T16:53:25Z", "message": "Show undo menu on reset, reposition and resched\n\nTests are sadly wonky under Robolectric\n\nFixes 7674"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f373ccac6587d861ddf3c81ab63bccea119efc2d", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f373ccac6587d861ddf3c81ab63bccea119efc2d", "committedDate": "2020-11-14T16:53:25Z", "message": "BugFix: Undo - Ensure data in grid is updated\n\nCause: 23f9d804f22cb87af322c279db7804b943f8d503 (7535)\n\nDouble searches were cancelled\n\nFixes 7674"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26b21e1ad23d48faa3ca0b54c62f2e5d66d2e69a", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/26b21e1ad23d48faa3ca0b54c62f2e5d66d2e69a", "committedDate": "2020-11-14T04:36:37Z", "message": "BugFix: Undo - Ensure data in grid is updated\n\nCause: 23f9d804f22cb87af322c279db7804b943f8d503 (7535)\n\nDouble searches were cancelled\n\nFixes 7674"}, "afterCommit": {"oid": "f373ccac6587d861ddf3c81ab63bccea119efc2d", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f373ccac6587d861ddf3c81ab63bccea119efc2d", "committedDate": "2020-11-14T16:53:25Z", "message": "BugFix: Undo - Ensure data in grid is updated\n\nCause: 23f9d804f22cb87af322c279db7804b943f8d503 (7535)\n\nDouble searches were cancelled\n\nFixes 7674"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNzkxNzY1", "url": "https://github.com/ankidroid/Anki-Android/pull/7675#pullrequestreview-530791765", "createdAt": "2020-11-15T11:57:37Z", "commit": {"oid": "f373ccac6587d861ddf3c81ab63bccea119efc2d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNzk0NjA1", "url": "https://github.com/ankidroid/Anki-Android/pull/7675#pullrequestreview-530794605", "createdAt": "2020-11-15T12:35:57Z", "commit": {"oid": "f373ccac6587d861ddf3c81ab63bccea119efc2d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3754, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}