{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMDI0MzU5", "number": 6421, "title": "Add Missing Statistics Data to Overview ", "bodyText": "Goals\n\nCompare the two images and ensure data is consistent\n\nPurpose / Description\nThis brings us in line with the data that is shown by vanilla Anki Desktop on the stats page.\nThe months don't completely line up, so my screenshots display years.\nFixes\nFixes #5266\nFixes #4326\nApproach\n\n\nBit 'o SQL, bit o' comparison. Then output to HTML\n\n\nThe translation strings here are a nightmare\n\n\nHow Has This Been Tested?\nComparison with Anki Desktop. See comment\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-06-09T19:41:08Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6421", "merged": true, "mergeCommit": {"oid": "bbf259153036ff32c18169369ee933ab24c95778"}, "closed": true, "closedAt": "2020-06-10T14:50:38Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcprAnXAFqTQyNzUwODA2NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp62CvAFqTQyODEzNTcwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NTA4MDY1", "url": "https://github.com/ankidroid/Anki-Android/pull/6421#pullrequestreview-427508065", "createdAt": "2020-06-09T20:17:03Z", "commit": {"oid": "0739ebe710da8f375c7dff3165dde3ec1a97cb68"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMDoxNzowM1rOGhaoag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMDoxOTowNlrOGhasVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5MjUyMg==", "bodyText": "magic number 2?", "url": "https://github.com/ankidroid/Anki-Android/pull/6421#discussion_r437692522", "createdAt": "2020-06-09T20:17:03Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/stats/Stats.java", "diffHunk": "@@ -1053,6 +1075,47 @@ public boolean calculateAnswerButtons(AxisType type) {\n         mValueLabels = new int[] { R.string.statistics_learn, R.string.statistics_young, R.string.statistics_mature};\n         mColors = new int[] { R.attr.stats_learn, R.attr.stats_young, R.attr.stats_mature};\n         mType = type;\n+        ArrayList<double[]> list = eases(type);\n+\n+        //TODO adjust for AnswerButton, for now only copied from intervals\n+        // small adjustment for a proper chartbuilding with achartengine\n+        if (list.size() == 0) {\n+            list.add(0, new double[]{0, 1, 0});\n+        }\n+\n+        mSeriesList = new double[4][list.size()+1];\n+\n+        for (int i = 0; i < list.size(); i++) {\n+            double[] data = list.get(i);\n+            int currentType = (int)data[0];\n+            double ease = data[1];\n+            double cnt = data[2];\n+\n+            if (currentType == Consts.CARD_TYPE_LRN) {\n+                ease += 5;\n+            } else if (currentType == 2) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0739ebe710da8f375c7dff3165dde3ec1a97cb68"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5Mjk1MQ==", "bodyText": "magic number 1? (I think that 1 should be a Const)", "url": "https://github.com/ankidroid/Anki-Android/pull/6421#discussion_r437692951", "createdAt": "2020-06-09T20:17:54Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/stats/Stats.java", "diffHunk": "@@ -302,8 +302,30 @@ public void calculateOverviewStatistics(AxisType timespan, OverviewStatsBuilder.\n \n         oStats.totalNewCards = getNewCards(timespan);\n         oStats.newCardsPerDay = (double) oStats.totalNewCards / (double) oStats.allDays;\n+\n+        ArrayList<double[]> list = eases(timespan);\n+        oStats.newCardsOverview = toOverview(0, list);\n+        oStats.youngCardsOverview = toOverview(1, list);\n+        oStats.matureCardsOverview = toOverview(2, list);\n     }\n \n+\n+    private OverviewStatsBuilder.OverviewStats.AnswerButtonsOverview toOverview(int type, ArrayList<double[]> list) {\n+        OverviewStatsBuilder.OverviewStats.AnswerButtonsOverview answerButtonsOverview = new OverviewStatsBuilder.OverviewStats.AnswerButtonsOverview();\n+\n+        //type, ease, count\n+        for (double[] elements : list) {\n+            if (elements[0] != type) {\n+                continue;\n+            }\n+            answerButtonsOverview.total += elements[2];\n+            answerButtonsOverview.correct += elements[1] == 1 ? 0 : elements[2];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0739ebe710da8f375c7dff3165dde3ec1a97cb68"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY5MzUyNw==", "bodyText": "I think this default empty thing is also a 0, 1, 0 of magic instead of const?", "url": "https://github.com/ankidroid/Anki-Android/pull/6421#discussion_r437693527", "createdAt": "2020-06-09T20:19:06Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/stats/Stats.java", "diffHunk": "@@ -1053,6 +1075,47 @@ public boolean calculateAnswerButtons(AxisType type) {\n         mValueLabels = new int[] { R.string.statistics_learn, R.string.statistics_young, R.string.statistics_mature};\n         mColors = new int[] { R.attr.stats_learn, R.attr.stats_young, R.attr.stats_mature};\n         mType = type;\n+        ArrayList<double[]> list = eases(type);\n+\n+        //TODO adjust for AnswerButton, for now only copied from intervals\n+        // small adjustment for a proper chartbuilding with achartengine\n+        if (list.size() == 0) {\n+            list.add(0, new double[]{0, 1, 0});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0739ebe710da8f375c7dff3165dde3ec1a97cb68"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3286ad3d2d373e0002156174ee00cf3ab184220a", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3286ad3d2d373e0002156174ee00cf3ab184220a", "committedDate": "2020-06-09T21:25:43Z", "message": "Statistics: Add \"Answer Buttons\" to Overview\n\nFixes 4326\nImproves 5266"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b06de61dd04e0e43714cfb6f64744789df079d2f", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/b06de61dd04e0e43714cfb6f64744789df079d2f", "committedDate": "2020-06-09T21:25:53Z", "message": "Statistics: Add \"Total Time\" to Overview\n\nImproves 5266"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "429afec7d97ad2f55644c6d08d29e129c3bf59d5", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/429afec7d97ad2f55644c6d08d29e129c3bf59d5", "committedDate": "2020-06-09T21:25:53Z", "message": "Statistics: Add \"Average Answer Time\" to Overview\n\nImproves 5266"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eacea4fb9b48fa8457e7d686b7280c473e746b42", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/eacea4fb9b48fa8457e7d686b7280c473e746b42", "committedDate": "2020-06-09T21:25:54Z", "message": "Statistics: Add \"Total Card/Notes\" to Overview\n\nImproves 5266"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bae815ed7e09f308b18929ea30359b50da7277d7", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/bae815ed7e09f308b18929ea30359b50da7277d7", "committedDate": "2020-06-09T21:25:54Z", "message": "Statistics: Add \"Low/Avg/Hi Ease\" to Overview\n\nFinishes 5266"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c5605b9b1ebff20668b641ad84c3363ef419439d", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c5605b9b1ebff20668b641ad84c3363ef419439d", "committedDate": "2020-06-09T19:14:43Z", "message": "Statistics: Add \"Low/Avg/Hi Ease\" to Overview\n\nFinishes 5266"}, "afterCommit": {"oid": "bae815ed7e09f308b18929ea30359b50da7277d7", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/bae815ed7e09f308b18929ea30359b50da7277d7", "committedDate": "2020-06-09T21:25:54Z", "message": "Statistics: Add \"Low/Avg/Hi Ease\" to Overview\n\nFinishes 5266"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MTM1NzA0", "url": "https://github.com/ankidroid/Anki-Android/pull/6421#pullrequestreview-428135704", "createdAt": "2020-06-10T14:50:30Z", "commit": {"oid": "bae815ed7e09f308b18929ea30359b50da7277d7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3170, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}