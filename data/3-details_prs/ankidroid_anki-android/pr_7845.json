{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0Nzc3NTQy", "number": 7845, "title": "Bump minSdkVersion to 21, purge related lower-API workarounds", "bodyText": "Pull Request template\nPurpose / Description\nBumping our minimum to 21 after consideration of current analytics-indicated usage <21 (<0.5% of users and dropping) vs benefit (modern javascript support, dropping multidex, etc)\nFixes\nFixes #7843\nThis unblocks #5223 which should be done as a follow on\nApproach\nRe-arrange the Compat infrastructure and grep through for all uses of SDK_INT and VERSION_CODES to adjust everything\nDid my best to remove unused imports as well but Codacy is still flaked out so not 100% on that\nHow Has This Been Tested?\nLots and lots of full-API emulator runs on my laptop with ./gradlew clean jacocoTestReport lintRelease\nLearning (optional, can help others)\n\nreact-native has moved to 21 (facebook) as well as lots of other\nour analytics supports it\n\nChecklist\nPlease, go through these checks before submitting the PR.\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code\n UI changes: include screenshots of all affected screens (in particular showing any new or changed strings)", "createdAt": "2020-12-08T22:51:19Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7845", "merged": true, "mergeCommit": {"oid": "24443a327ed060dc31f4c16c88a3553d50d7ad05"}, "closed": true, "closedAt": "2020-12-09T18:40:59Z", "author": {"login": "mikehardy"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkXf8agFqTU0NzgyODYyNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkjNWVABqjQwOTE0MjI4OTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3ODI4NjI3", "url": "https://github.com/ankidroid/Anki-Android/pull/7845#pullrequestreview-547828627", "createdAt": "2020-12-09T04:35:30Z", "commit": {"oid": "4517b492a18152c58fc6e91203824c75b9d93a12"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwNDozNTozMFrOICB5yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQwNDo0NToxNFrOICCFqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk5OTI0MA==", "bodyText": "If you move the number to a constant, you may want to move the comment, to mention that 29 is Q (assuming it's the case)", "url": "https://github.com/ankidroid/Anki-Android/pull/7845#discussion_r538999240", "createdAt": "2020-12-09T04:35:30Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/libanki/ModelTest.java", "diffHunk": "@@ -36,7 +36,7 @@ public void tearDown() {\n \n     @Test\n     public void bigQuery() {\n-        assumeTrue(\"This test is flaky on API29, ignoring\", Build.VERSION.SDK_INT != 29);\n+        assumeTrue(\"This test is flaky on API29, ignoring\", Build.VERSION.SDK_INT != Build.VERSION_CODES.Q);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4517b492a18152c58fc6e91203824c75b9d93a12"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk5OTY4NA==", "bodyText": "Please remove the variable mIsDestroyed, it become unused", "url": "https://github.com/ankidroid/Anki-Android/pull/7845#discussion_r538999684", "createdAt": "2020-12-09T04:37:02Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AnkiActivity.java", "diffHunk": "@@ -282,15 +281,6 @@ protected void disableViewAnimation(View view) {\n         view.clearAnimation();\n     }\n \n-    /** Compat shim for API 16 */\n-    public boolean wasDestroyed() {\n-        if (Build.VERSION.SDK_INT > Build.VERSION_CODES.JELLY_BEAN) {\n-            return super.isDestroyed();\n-        }\n-        return mIsDestroyed;\n-    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4517b492a18152c58fc6e91203824c75b9d93a12"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAwMjI4MQ==", "bodyText": "How come this lead to adding more code? I don't understand the relation with this commit", "url": "https://github.com/ankidroid/Anki-Android/pull/7845#discussion_r539002281", "createdAt": "2020-12-09T04:45:14Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -1079,6 +1075,78 @@ private void setWhiteboardEnabledState(boolean state) {\n         }\n     }\n \n+    private static final int FULLSCREEN_ALL_GONE = 2;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4517b492a18152c58fc6e91203824c75b9d93a12"}, "originalPosition": 79}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MTk0MjUw", "url": "https://github.com/ankidroid/Anki-Android/pull/7845#pullrequestreview-548194250", "createdAt": "2020-12-09T13:44:08Z", "commit": {"oid": "4517b492a18152c58fc6e91203824c75b9d93a12"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMzo0NDowOFrOICVRKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxMzo1NDowMFrOICVuMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMxNjUyMA==", "bodyText": "Do we need this since we're running on x86 emulators now (and multidex is presumably implicitly enabled)?\nHappy to link as follow-on issue or ignore, no action required.", "url": "https://github.com/ankidroid/Anki-Android/pull/7845#discussion_r539316520", "createdAt": "2020-12-09T13:44:08Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/build.gradle", "diffHunk": "@@ -43,20 +43,18 @@ android {\n         // needed for upgrades to be offered correctly.\n         versionCode=21500111\n         versionName=\"2.15alpha11\"\n-        minSdkVersion 16\n+        minSdkVersion 21\n         //noinspection OldTargetApi - also performed in api/build.fradle\n         targetSdkVersion 29 // change .travis.yml platform download at same time\n-        multiDexEnabled true\n         testApplicationId \"com.ichi2.anki.tests\"\n         vectorDrawables.useSupportLibrary = true\n-        // This is a custom class, in androidx to override package-level functions\n-        testInstrumentationRunner 'androidx.test.runner.MultiDexJUnitRunner'\n+        testInstrumentationRunner 'androidx.test.runner.AndroidJUnitRunner'\n \n         // This enables long timeouts required on slow ARM emulators, e.g. Travis\n         adbOptions {\n             //logLevel verbose // let's try to see what is happening\n             timeOutInMs 20 * 60 * 1000  // 20 minutes\n-            DdmPreferences.setTimeOut(120000) // apparently if not multidex you do this\n+            DdmPreferences.setTimeOut(120000)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4517b492a18152c58fc6e91203824c75b9d93a12"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMxNjc1NA==", "bodyText": "Thank goodness for that", "url": "https://github.com/ankidroid/Anki-Android/pull/7845#discussion_r539316754", "createdAt": "2020-12-09T13:44:25Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/androidTest/java/androidx/test/internal/runner/MultiDexClassPathScanner.java", "diffHunk": "@@ -1,157 +0,0 @@\n-/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4517b492a18152c58fc6e91203824c75b9d93a12"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMxNzcyNQ==", "bodyText": "Optional:\nCan we keep a dummy user-defined class, inheriting the default Android implementation - I'm going to want to use it in a while, and having the infrastructure set up (rather than figuring it out again, or going through the git history) will be useful\nDoesn't have to be in the androidx namespace", "url": "https://github.com/ankidroid/Anki-Android/pull/7845#discussion_r539317725", "createdAt": "2020-12-09T13:45:40Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/build.gradle", "diffHunk": "@@ -43,20 +43,18 @@ android {\n         // needed for upgrades to be offered correctly.\n         versionCode=21500111\n         versionName=\"2.15alpha11\"\n-        minSdkVersion 16\n+        minSdkVersion 21\n         //noinspection OldTargetApi - also performed in api/build.fradle\n         targetSdkVersion 29 // change .travis.yml platform download at same time\n-        multiDexEnabled true\n         testApplicationId \"com.ichi2.anki.tests\"\n         vectorDrawables.useSupportLibrary = true\n-        // This is a custom class, in androidx to override package-level functions\n-        testInstrumentationRunner 'androidx.test.runner.MultiDexJUnitRunner'\n+        testInstrumentationRunner 'androidx.test.runner.AndroidJUnitRunner'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4517b492a18152c58fc6e91203824c75b9d93a12"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMyMTk5Ng==", "bodyText": "Optional: Might want to keep under compat - changes here for API 30", "url": "https://github.com/ankidroid/Anki-Android/pull/7845#discussion_r539321996", "createdAt": "2020-12-09T13:51:23Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -294,7 +292,7 @@ protected void onCollectionLoaded(Collection col) {\n \n         // Set full screen/immersive mode if needed\n         if (mPrefFullscreenReview) {\n-            CompatHelper.getCompat().setFullScreen(this);\n+            setFullScreen(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4517b492a18152c58fc6e91203824c75b9d93a12"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMyMzI0NQ==", "bodyText": "Could we temporarily move this to a new class with the responsibility (a lazy choice, rather than re-architecting),", "url": "https://github.com/ankidroid/Anki-Android/pull/7845#discussion_r539323245", "createdAt": "2020-12-09T13:52:58Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -1079,6 +1075,78 @@ private void setWhiteboardEnabledState(boolean state) {\n         }\n     }\n \n+    private static final int FULLSCREEN_ALL_GONE = 2;\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAwMjI4MQ=="}, "originalCommit": {"oid": "4517b492a18152c58fc6e91203824c75b9d93a12"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTMyMzk1Mg==", "bodyText": "Yep - let's add a low priority issue for it,", "url": "https://github.com/ankidroid/Anki-Android/pull/7845#discussion_r539323952", "createdAt": "2020-12-09T13:54:00Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/noteeditor/Toolbar.java", "diffHunk": "@@ -153,16 +152,13 @@ private int dpToPixels(int value) {\n \n \n     public View getClozeIcon() {\n-        // HACK until API 21\n+        // HACK until API 21 FIXME can this be altered now?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4517b492a18152c58fc6e91203824c75b9d93a12"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4NDU4NTQ0", "url": "https://github.com/ankidroid/Anki-Android/pull/7845#pullrequestreview-548458544", "createdAt": "2020-12-09T18:07:30Z", "commit": {"oid": "4517b492a18152c58fc6e91203824c75b9d93a12"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4662321414cc4ba9892efe0226a8aa53240a5d3", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f4662321414cc4ba9892efe0226a8aa53240a5d3", "committedDate": "2020-12-09T18:39:28Z", "message": "Bump minSdkVersion to 21, purge related lower-API workarounds\n\nFixes #7843"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4517b492a18152c58fc6e91203824c75b9d93a12", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4517b492a18152c58fc6e91203824c75b9d93a12", "committedDate": "2020-12-08T22:47:14Z", "message": "Bump minSdkVersion to 21, purge related lower-API workarounds\n\nFixes #7843"}, "afterCommit": {"oid": "f4662321414cc4ba9892efe0226a8aa53240a5d3", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f4662321414cc4ba9892efe0226a8aa53240a5d3", "committedDate": "2020-12-09T18:39:28Z", "message": "Bump minSdkVersion to 21, purge related lower-API workarounds\n\nFixes #7843"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3720, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}