{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MzMzMDA5", "number": 6617, "title": "Parents uses array", "bodyText": "While looking at the method parents, I found it more ugly than required and hope this rewriting will be accepted.\nSince size is known, array seems more appropriate than list, so I did this change in last commit. I may remove it if you don't like it", "createdAt": "2020-07-04T22:10:03Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6617", "merged": true, "mergeCommit": {"oid": "2faca8019f03d537d8d5865b3ba24bd72609b5f2"}, "closed": true, "closedAt": "2020-07-06T04:24:06Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxwltOAFqTQ0MjYzNTkzMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyJdyxgFqTQ0Mjc2NjI3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjM1OTMy", "url": "https://github.com/ankidroid/Anki-Android/pull/6617#pullrequestreview-442635932", "createdAt": "2020-07-04T23:24:56Z", "commit": {"oid": "d8a4089b09a57ff271c241a95d6aea55a189b0ad"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQyMzoyNDo1NlrOGs-bfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQyMzoyNDo1NlrOGs-bfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgxMzM3NA==", "bodyText": "Have you tested this?\nI believe that Arrays.asList crashes when .add is called.", "url": "https://github.com/ankidroid/Anki-Android/pull/6617#discussion_r449813374", "createdAt": "2020-07-04T23:24:56Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/Sched.java", "diffHunk": "@@ -306,7 +307,7 @@ protected int _deckNewLimit(long did, LimitMethod fn) {\n         if (fn == null) {\n             fn = (g -> _deckNewLimitSingle(g));\n         }\n-        List<JSONObject> decks = mCol.getDecks().parents(did);\n+        List<JSONObject> decks = Arrays.asList(mCol.getDecks().parents(did));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8a4089b09a57ff271c241a95d6aea55a189b0ad"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d8a4089b09a57ff271c241a95d6aea55a189b0ad", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d8a4089b09a57ff271c241a95d6aea55a189b0ad", "committedDate": "2020-07-04T22:08:03Z", "message": "NF: simplifies parents\n\nThere is no reason to uses lists since we know the time at\nconstruction time."}, "afterCommit": {"oid": "f4b129a48c323b26b3c155294faeb3071dc8bc21", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f4b129a48c323b26b3c155294faeb3071dc8bc21", "committedDate": "2020-07-04T23:59:13Z", "message": "NF: remove useless asList"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjM2OTY5", "url": "https://github.com/ankidroid/Anki-Android/pull/6617#pullrequestreview-442636969", "createdAt": "2020-07-05T00:04:24Z", "commit": {"oid": "f4b129a48c323b26b3c155294faeb3071dc8bc21"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQwMDowNDoyNFrOGs-j8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQwMDowNDoyNFrOGs-j8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgxNTUzNw==", "bodyText": "This is more clear using parts.length", "url": "https://github.com/ankidroid/Anki-Android/pull/6617#discussion_r449815537", "createdAt": "2020-07-05T00:04:24Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "diffHunk": "@@ -1038,19 +1038,17 @@ private void gather(HashMap<Long, HashMap> node, List<Long> arr) {\n      */\n     public List<JSONObject> parents(long did) {\n         // get parent and grandparent names\n+        String[] parts = path(get(did).getString(\"name\"));\n+        int nbParts = parts.length;\n         List<String> parents = new ArrayList<>();\n-        List<String> parts = Arrays.asList(path(get(did).getString(\"name\")));\n-        for (int i = 0; i < parts.size() - 1; i++) {\n-            String part = parts.get(i);\n-            if (parents.size() == 0) {\n-                parents.add(part);\n-            } else {\n-                parents.add(parents.get(parents.size() - 1) + \"::\" + part);\n-            }\n+        parents.add(parts[0]);\n+        for (int i = 1; i < nbParts - 1; i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4b129a48c323b26b3c155294faeb3071dc8bc21"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f4b129a48c323b26b3c155294faeb3071dc8bc21", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f4b129a48c323b26b3c155294faeb3071dc8bc21", "committedDate": "2020-07-04T23:59:13Z", "message": "NF: remove useless asList"}, "afterCommit": {"oid": "c9e8dac327f3f2c426db79096ad1fa0193b15ba5", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c9e8dac327f3f2c426db79096ad1fa0193b15ba5", "committedDate": "2020-07-05T00:41:31Z", "message": "NF: initialize list with size"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9e8dac327f3f2c426db79096ad1fa0193b15ba5", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c9e8dac327f3f2c426db79096ad1fa0193b15ba5", "committedDate": "2020-07-05T00:41:31Z", "message": "NF: initialize list with size"}, "afterCommit": {"oid": "c0d7f3c284953132b504aea52e79871c131c49ee", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c0d7f3c284953132b504aea52e79871c131c49ee", "committedDate": "2020-07-05T02:28:20Z", "message": "NF: avoid a if in a loop"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjQwOTE0", "url": "https://github.com/ankidroid/Anki-Android/pull/6617#pullrequestreview-442640914", "createdAt": "2020-07-05T02:33:48Z", "commit": {"oid": "c0d7f3c284953132b504aea52e79871c131c49ee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQwMjozMzo0OVrOGs_C4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQwMjozMzo0OVrOGs_C4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgyMzQ1OA==", "bodyText": "Shouldn't these be parents?", "url": "https://github.com/ankidroid/Anki-Android/pull/6617#discussion_r449823458", "createdAt": "2020-07-05T02:33:49Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "diffHunk": "@@ -1038,19 +1038,16 @@ private void gather(HashMap<Long, HashMap> node, List<Long> arr) {\n      */\n     public List<JSONObject> parents(long did) {\n         // get parent and grandparent names\n-        List<String> parents = new ArrayList<>();\n-        List<String> parts = Arrays.asList(path(get(did).getString(\"name\")));\n-        for (int i = 0; i < parts.size() - 1; i++) {\n-            String part = parts.get(i);\n-            if (parents.size() == 0) {\n-                parents.add(part);\n-            } else {\n-                parents.add(parents.get(parents.size() - 1) + \"::\" + part);\n-            }\n+        String[] parts = path(get(did).getString(\"name\"));\n+        List<String> parents = new ArrayList<>(parts.length - 1);\n+        parents.add(parts[0]);\n+        for (int i = 1; i < parts.length - 1; i++) {\n+            String part = parts[i];\n+            parents.add(parents.get(parents.size() - 1) + \"::\" + part);\n         }\n         // convert to objects\n-        List<JSONObject> oParents = new ArrayList<>();\n-        for (int i = 0; i < parents.size(); i++) {\n+        List<JSONObject> oParents = new ArrayList<>(parts.length - 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0d7f3c284953132b504aea52e79871c131c49ee"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjQwOTI4", "url": "https://github.com/ankidroid/Anki-Android/pull/6617#pullrequestreview-442640928", "createdAt": "2020-07-05T02:34:10Z", "commit": {"oid": "c0d7f3c284953132b504aea52e79871c131c49ee"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c0d7f3c284953132b504aea52e79871c131c49ee", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c0d7f3c284953132b504aea52e79871c131c49ee", "committedDate": "2020-07-05T02:28:20Z", "message": "NF: avoid a if in a loop"}, "afterCommit": {"oid": "90a3331f0b5f7a22a86a2b80948c1fd25d3c7b1a", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/90a3331f0b5f7a22a86a2b80948c1fd25d3c7b1a", "committedDate": "2020-07-05T02:52:57Z", "message": "NF: parentsNames"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjY0NjQy", "url": "https://github.com/ankidroid/Anki-Android/pull/6617#pullrequestreview-442664642", "createdAt": "2020-07-05T10:20:21Z", "commit": {"oid": "90a3331f0b5f7a22a86a2b80948c1fd25d3c7b1a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxMDoyMDoyMVrOGtBS7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxMDoyMDoyMVrOGtBS7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg2MDMzNA==", "bodyText": "This doesn't set parentsNames[0]. This seems to differ from the previous logic", "url": "https://github.com/ankidroid/Anki-Android/pull/6617#discussion_r449860334", "createdAt": "2020-07-05T10:20:21Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "diffHunk": "@@ -1032,26 +1032,32 @@ private void gather(HashMap<Long, HashMap> node, List<Long> arr) {\n         return childMap;\n     }\n \n+    /**\n+     * @return Names of ancestors of parents of name.\n+     */\n+    private String[] parentsNames(String name) {\n+        String[] parts = path(name);\n+        String[] parentsNames = new String[parts.length - 1];\n+        if (parts.length == 1) {\n+            return parentsNames;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90a3331f0b5f7a22a86a2b80948c1fd25d3c7b1a"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "90a3331f0b5f7a22a86a2b80948c1fd25d3c7b1a", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/90a3331f0b5f7a22a86a2b80948c1fd25d3c7b1a", "committedDate": "2020-07-05T02:52:57Z", "message": "NF: parentsNames"}, "afterCommit": {"oid": "60841a235d820556a8acb3f7f15737e749360b27", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/60841a235d820556a8acb3f7f15737e749360b27", "committedDate": "2020-07-05T19:44:58Z", "message": "NF: parentsNames"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60841a235d820556a8acb3f7f15737e749360b27", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/60841a235d820556a8acb3f7f15737e749360b27", "committedDate": "2020-07-05T19:44:58Z", "message": "NF: parentsNames"}, "afterCommit": {"oid": "060255dd80e53b5ef39179b80caa5fbcbcc4d276", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/060255dd80e53b5ef39179b80caa5fbcbcc4d276", "committedDate": "2020-07-05T23:01:22Z", "message": "NF: parentsNames"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNzEzMzcz", "url": "https://github.com/ankidroid/Anki-Android/pull/6617#pullrequestreview-442713373", "createdAt": "2020-07-05T23:07:40Z", "commit": {"oid": "060255dd80e53b5ef39179b80caa5fbcbcc4d276"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQyMzowNzo0MFrOGtFd7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQyMzowNzo0MFrOGtFd7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTkyODY4NA==", "bodyText": "Method documentation would be useful in this case", "url": "https://github.com/ankidroid/Anki-Android/pull/6617#discussion_r449928684", "createdAt": "2020-07-05T23:07:40Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "diffHunk": "@@ -1032,26 +1032,32 @@ private void gather(HashMap<Long, HashMap> node, List<Long> arr) {\n         return childMap;\n     }\n \n+    /**\n+     * @return Names of ancestors of parents of name.\n+     */\n+    private String[] parentsNames(String name) {\n+        String[] parts = path(name);\n+        String[] parentsNames = new String[parts.length - 1];\n+        if (parts.length == 1) {\n+            return parentsNames;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg2MDMzNA=="}, "originalCommit": {"oid": "90a3331f0b5f7a22a86a2b80948c1fd25d3c7b1a"}, "originalPosition": 11}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "060255dd80e53b5ef39179b80caa5fbcbcc4d276", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/060255dd80e53b5ef39179b80caa5fbcbcc4d276", "committedDate": "2020-07-05T23:01:22Z", "message": "NF: parentsNames"}, "afterCommit": {"oid": "f3d5891eb2c34cc19596bca488af39ba7d6e78df", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f3d5891eb2c34cc19596bca488af39ba7d6e78df", "committedDate": "2020-07-05T23:14:04Z", "message": "NF: parentsNames"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f3d5891eb2c34cc19596bca488af39ba7d6e78df", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f3d5891eb2c34cc19596bca488af39ba7d6e78df", "committedDate": "2020-07-05T23:14:04Z", "message": "NF: parentsNames"}, "afterCommit": {"oid": "3d197ecc94c6200bb2e000eb1943cb06e11d6b31", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3d197ecc94c6200bb2e000eb1943cb06e11d6b31", "committedDate": "2020-07-05T23:16:43Z", "message": "NF: parentsNames"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNzE0MDcz", "url": "https://github.com/ankidroid/Anki-Android/pull/6617#pullrequestreview-442714073", "createdAt": "2020-07-05T23:17:07Z", "commit": {"oid": "f3d5891eb2c34cc19596bca488af39ba7d6e78df"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "273fa0f2aa0fb80773761c55a9769894b0567087", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/273fa0f2aa0fb80773761c55a9769894b0567087", "committedDate": "2020-07-05T23:29:51Z", "message": "NF: parentsNames"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d197ecc94c6200bb2e000eb1943cb06e11d6b31", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3d197ecc94c6200bb2e000eb1943cb06e11d6b31", "committedDate": "2020-07-05T23:16:43Z", "message": "NF: parentsNames"}, "afterCommit": {"oid": "273fa0f2aa0fb80773761c55a9769894b0567087", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/273fa0f2aa0fb80773761c55a9769894b0567087", "committedDate": "2020-07-05T23:29:51Z", "message": "NF: parentsNames"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNzE4NTU5", "url": "https://github.com/ankidroid/Anki-Android/pull/6617#pullrequestreview-442718559", "createdAt": "2020-07-06T00:06:07Z", "commit": {"oid": "273fa0f2aa0fb80773761c55a9769894b0567087"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNzY2Mjc1", "url": "https://github.com/ankidroid/Anki-Android/pull/6617#pullrequestreview-442766275", "createdAt": "2020-07-06T04:23:59Z", "commit": {"oid": "273fa0f2aa0fb80773761c55a9769894b0567087"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3074, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}