{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyNDQ3Mjgx", "number": 6279, "title": "Correct Device \"Back\" Button in Restore From Backup", "bodyText": "Purpose / Description\nNow, AnkiDroid can return to deck browser successfully when visit \"Restore From Backup\" Dialog while the previous version will return to the confirmation dialog.\nFixes\nFixes #5833\nApproach\nFor MaterialDialog, adding a Listener by setOnKeyListener() can moniter system's back key. Rewrite system back key operation by method dismissAllDialogFragments() which make its function same as button \"Cancel\".\nHow Has This Been Tested?\n\nOpen Deck Browser\nSelect \"Restore From Backup\"\nAccept the confirmation\nPress the physical \"Back\" button on the device.\n\nChecklist\nPlease, go through these checks before submitting the PR.\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-05-24T17:55:26Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6279", "merged": true, "mergeCommit": {"oid": "f73b1a6a1ea26925b909e4cd58aec38e2440acc4"}, "closed": true, "closedAt": "2020-06-01T16:53:39Z", "author": {"login": "Sc-Weng"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckfRBGAH2gAyNDIyNDQ3MjgxOmZlMDJlMDRhNzVjNjljYjQxMDcxMWZhZGFjNmE4YTM5NjdiZDRhYjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnDNaxAFqTQyMjAxNDA0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fe02e04a75c69cb410711fadac6a8a3967bd4ab3", "author": {"user": {"login": "Sc-Weng", "name": "Scweng"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/fe02e04a75c69cb410711fadac6a8a3967bd4ab3", "committedDate": "2020-05-24T17:53:00Z", "message": "Add a system back key listener for restore backup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3Mzc5MzU4", "url": "https://github.com/ankidroid/Anki-Android/pull/6279#pullrequestreview-417379358", "createdAt": "2020-05-24T18:07:29Z", "commit": {"oid": "fe02e04a75c69cb410711fadac6a8a3967bd4ab3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxODowNzoyOVrOGZwarw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxODowODo0N1rOGZwbFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY2MDg0Nw==", "bodyText": "Without a bit more specifics on where the log came from, it will be hard to trace, suggest \ud83d\udc47\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    Timber.i(\"catch\");\n          \n          \n            \n                                    Timber.i(\"DIALOG_RESTORE_BACKUP caught hardware back button\");", "url": "https://github.com/ankidroid/Anki-Android/pull/6279#discussion_r429660847", "createdAt": "2020-05-24T18:07:29Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/dialogs/DatabaseErrorDialog.java", "diffHunk": "@@ -223,7 +223,16 @@ public MaterialDialog onCreateDialog(Bundle savedInstanceState) {\n                                         return true;\n                                     });\n                 }\n-                return builder.show();\n+                MaterialDialog materialDialog = builder.build();\n+                materialDialog.setOnKeyListener((dialog, keyCode, event) -> {\n+                    if (keyCode == KeyEvent.KEYCODE_BACK) {\n+                        Timber.i(\"catch\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe02e04a75c69cb410711fadac6a8a3967bd4ab3"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY2MDk1MQ==", "bodyText": "It is the responsibility of each of the dialogs to actually show the dialog as well I think? I think you have to do that call? I'm not sure how this would have tested correctly without it but maybe I am missing something so this suggestion may not be correct\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            });\n          \n          \n            \n                            return materialDialog;\n          \n          \n            \n                            });\n          \n          \n            \n                            materialDialog.show();\n          \n          \n            \n                            return materialDialog;", "url": "https://github.com/ankidroid/Anki-Android/pull/6279#discussion_r429660951", "createdAt": "2020-05-24T18:08:47Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/dialogs/DatabaseErrorDialog.java", "diffHunk": "@@ -223,7 +223,16 @@ public MaterialDialog onCreateDialog(Bundle savedInstanceState) {\n                                         return true;\n                                     });\n                 }\n-                return builder.show();\n+                MaterialDialog materialDialog = builder.build();\n+                materialDialog.setOnKeyListener((dialog, keyCode, event) -> {\n+                    if (keyCode == KeyEvent.KEYCODE_BACK) {\n+                        Timber.i(\"catch\");\n+                        dismissAllDialogFragments();\n+                        return true;\n+                    }\n+                    return false;\n+                });\n+                return materialDialog;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe02e04a75c69cb410711fadac6a8a3967bd4ab3"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3Mzc5NTI0", "url": "https://github.com/ankidroid/Anki-Android/pull/6279#pullrequestreview-417379524", "createdAt": "2020-05-24T18:09:53Z", "commit": {"oid": "fe02e04a75c69cb410711fadac6a8a3967bd4ab3"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxODowOTo1M1rOGZwbYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQxODowOTo1M1rOGZwbYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY2MTAyNA==", "bodyText": "Nice to have: Make the log a little more expressive\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    Timber.i(\"catch\");\n          \n          \n            \n                                    Timber.i(\"Back Pressed - Closing 'Restore From Backup'\");", "url": "https://github.com/ankidroid/Anki-Android/pull/6279#discussion_r429661024", "createdAt": "2020-05-24T18:09:53Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/dialogs/DatabaseErrorDialog.java", "diffHunk": "@@ -223,7 +223,16 @@ public MaterialDialog onCreateDialog(Bundle savedInstanceState) {\n                                         return true;\n                                     });\n                 }\n-                return builder.show();\n+                MaterialDialog materialDialog = builder.build();\n+                materialDialog.setOnKeyListener((dialog, keyCode, event) -> {\n+                    if (keyCode == KeyEvent.KEYCODE_BACK) {\n+                        Timber.i(\"catch\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe02e04a75c69cb410711fadac6a8a3967bd4ab3"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3Mzg4ODY1", "url": "https://github.com/ankidroid/Anki-Android/pull/6279#pullrequestreview-417388865", "createdAt": "2020-05-24T20:30:28Z", "commit": {"oid": "fe02e04a75c69cb410711fadac6a8a3967bd4ab3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "881b8d65089a2a4fe2603867f12fd7dc563b9b6e", "author": {"user": {"login": "Sc-Weng", "name": "Scweng"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/881b8d65089a2a4fe2603867f12fd7dc563b9b6e", "committedDate": "2020-05-31T14:28:24Z", "message": "Update AnkiDroid/src/main/java/com/ichi2/anki/dialogs/DatabaseErrorDialog.java\n\nCo-authored-by: Mike Hardy <github@mikehardy.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "707a356529d9e535d7aedeed93da2b6f2b15c2db", "author": {"user": {"login": "Sc-Weng", "name": "Scweng"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/707a356529d9e535d7aedeed93da2b6f2b15c2db", "committedDate": "2020-05-31T14:41:41Z", "message": "Add necessary import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNTAxMjI1", "url": "https://github.com/ankidroid/Anki-Android/pull/6279#pullrequestreview-421501225", "createdAt": "2020-05-31T14:43:49Z", "commit": {"oid": "707a356529d9e535d7aedeed93da2b6f2b15c2db"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMDE0MDQ1", "url": "https://github.com/ankidroid/Anki-Android/pull/6279#pullrequestreview-422014045", "createdAt": "2020-06-01T16:53:30Z", "commit": {"oid": "707a356529d9e535d7aedeed93da2b6f2b15c2db"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3347, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}