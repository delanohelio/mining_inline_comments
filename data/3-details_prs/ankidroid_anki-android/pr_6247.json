{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxODIxOTI0", "number": 6247, "title": "Tex instead of error", "bodyText": "Pull Request template\nPurpose / Description\nIf you add some LaTeX code to ankidroid and the image is not yet compiled, you just see an error because image is not loaded.\nInstead of a broken image, showing the original LaTeX seems to be a good solution.\n\nFixes\nFIxes #4597\nApproach\nBy keeping the LaTeX\nHow Has This Been Tested?\nOpening ankidroid, creating a card with some LaTeX code [$]3[/3] (on a collection which does not already have it, and ensuring that I see \"$3$\" (which is indeed correct LaTeX) instead of a broken image.\nLearning (optional, can help others)\nThis idea seems straightforward. It would have helped me a lot. But for some reason, I never thought of it before seeing @dreamflasher's idea while I was looking for another bug report.\nChecklist\nPlease, go through these checks before submitting the PR.\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-05-22T09:41:35Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6247", "merged": true, "mergeCommit": {"oid": "d915f0813612b6a54942253796a04468a7301adc"}, "closed": true, "closedAt": "2020-05-22T22:21:45Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjvCwlgBqjMzNjQwMTkzNDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcj3PldAFqTQxNzEzNjI2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "326ce641a46548cebf6e8a0ffd10f7b10fb39708", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/326ce641a46548cebf6e8a0ffd10f7b10fb39708", "committedDate": "2020-05-22T09:36:39Z", "message": "LaTeX: show code instead of missing image\n\nThis was requested in\nhttps://github.com/ankidroid/Anki-Android/issues/4597 and I find out\nit's a good idea and easy to code."}, "afterCommit": {"oid": "f563c089000c6a8528af9ec4dfd35b969f091359", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f563c089000c6a8528af9ec4dfd35b969f091359", "committedDate": "2020-05-22T09:41:52Z", "message": "LaTeX: show code instead of missing image\n\nThis was requested in\nhttps://github.com/ankidroid/Anki-Android/issues/4597 and I find out\nit's a good idea and easy to code."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f563c089000c6a8528af9ec4dfd35b969f091359", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f563c089000c6a8528af9ec4dfd35b969f091359", "committedDate": "2020-05-22T09:41:52Z", "message": "LaTeX: show code instead of missing image\n\nThis was requested in\nhttps://github.com/ankidroid/Anki-Android/issues/4597 and I find out\nit's a good idea and easy to code."}, "afterCommit": {"oid": "d68a685fd058afc98591d94caf91c49ae3af26b1", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d68a685fd058afc98591d94caf91c49ae3af26b1", "committedDate": "2020-05-22T09:42:51Z", "message": "LaTeX: show code instead of missing image\n\nThis was requested in\nhttps://github.com/ankidroid/Anki-Android/issues/4597 and I find out\nit's a good idea and easy to code."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2ODA4NzA3", "url": "https://github.com/ankidroid/Anki-Android/pull/6247#pullrequestreview-416808707", "createdAt": "2020-05-22T10:28:16Z", "commit": {"oid": "d68a685fd058afc98591d94caf91c49ae3af26b1"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxMDoyODoxNlrOGZSXXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxMDoyOTo1MlrOGZSaHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE2ODQ3Nw==", "bodyText": "Maybe: \n  \n    \n      Anki-Android/AnkiDroid/src/main/java/com/ichi2/libanki/Media.java\n    \n    \n        Lines 531 to 533\n      in\n      4740941\n    \n    \n    \n    \n\n        \n          \n           public boolean have(String fname) { \n        \n\n        \n          \n               return new File(dir(), fname).exists(); \n        \n\n        \n          \n           }", "url": "https://github.com/ankidroid/Anki-Android/pull/6247#discussion_r429168477", "createdAt": "2020-05-22T10:28:16Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/LaTeX.java", "diffHunk": "@@ -96,7 +97,11 @@ private static String _imgLink(String latex, JSONObject model) {\n         }\n \n         String fname = \"latex-\" + Utils.checksum(txt) + \".\" + ext;\n-        return \"<img class=latex src=\\\"\" + fname + \"\\\">\";\n+        if (new File(col.getMedia().dir(), fname).exists()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d68a685fd058afc98591d94caf91c49ae3af26b1"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE2OTE4Mg==", "bodyText": "Nit: Could you pass in Media here to reduce the API surface area", "url": "https://github.com/ankidroid/Anki-Android/pull/6247#discussion_r429169182", "createdAt": "2020-05-22T10:29:52Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/LaTeX.java", "diffHunk": "@@ -87,7 +88,7 @@ public static String mungeQA(String html, Collection col, JSONObject model) {\n     /**\n      * Return an img link for LATEX.\n      */\n-    private static String _imgLink(String latex, JSONObject model) {\n+    private static String _imgLink(String latex, JSONObject model, Collection col) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d68a685fd058afc98591d94caf91c49ae3af26b1"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb0e2ba70de670e80d87cbb6bd90b29dd9e87d20", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/cb0e2ba70de670e80d87cbb6bd90b29dd9e87d20", "committedDate": "2020-05-22T19:05:33Z", "message": "LaTeX: show code instead of missing image\n\nThis was requested in\nhttps://github.com/ankidroid/Anki-Android/issues/4597 and I find out\nit's a good idea and easy to code."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d68a685fd058afc98591d94caf91c49ae3af26b1", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d68a685fd058afc98591d94caf91c49ae3af26b1", "committedDate": "2020-05-22T09:42:51Z", "message": "LaTeX: show code instead of missing image\n\nThis was requested in\nhttps://github.com/ankidroid/Anki-Android/issues/4597 and I find out\nit's a good idea and easy to code."}, "afterCommit": {"oid": "cb0e2ba70de670e80d87cbb6bd90b29dd9e87d20", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/cb0e2ba70de670e80d87cbb6bd90b29dd9e87d20", "committedDate": "2020-05-22T19:05:33Z", "message": "LaTeX: show code instead of missing image\n\nThis was requested in\nhttps://github.com/ankidroid/Anki-Android/issues/4597 and I find out\nit's a good idea and easy to code."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MTMzNDkx", "url": "https://github.com/ankidroid/Anki-Android/pull/6247#pullrequestreview-417133491", "createdAt": "2020-05-22T19:09:29Z", "commit": {"oid": "cb0e2ba70de670e80d87cbb6bd90b29dd9e87d20"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MTM2MjY0", "url": "https://github.com/ankidroid/Anki-Android/pull/6247#pullrequestreview-417136264", "createdAt": "2020-05-22T19:15:14Z", "commit": {"oid": "cb0e2ba70de670e80d87cbb6bd90b29dd9e87d20"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3305, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}