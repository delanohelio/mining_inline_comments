{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NDE3NTkw", "number": 5897, "title": "Reviewer: Action Bar buttons disabled while DeckTask working", "bodyText": "Pull Request template\nPurpose / Description\nSome actions can take more than 15 seconds on my phone. This is mostly\ndue to a huge number of deck (and a bad way of dealing with a lot of\ndeck in scheduler)\nButtons are still activated. That can be shown because if you click on\n\"bury\" the list will open once the new card is loaded. The problem is\nthat it's not clear at all to me (even when I look at the code) on\nwhich card the action are taken. If I press twice on bury, will it\nalso bury the next card ? is the action ignored ? Does the scheduler\ntries to bury/review/suspend... multiple time the same card ?\nThis is even more worrysome when I click on the undo button, where\nI've no clue whether the click is registered or not, and whether\nmultiple undo will be done...\nFixes\nI remove buttons while they can't be used because the card is not fixed, and put them back when the new card is loaded.\nApproach\nI ensure that less confusion arrive by setting the card to null while waiting for the new card to load, and then removing the buttons until the cards are loaded. I call the link to\nI created a method which should be called when card will be changed. It sets mCurrentCard to null and call the method to draw the bars. This method then state not to put any buttons if mCurrentCard is null.\nHow Has This Been Tested?\nI put it on my phone. Used my big collection (where each bury/suspend takes 15\u00a0seconds), I review (and everything works as before), and I suspend/bury, and now button disappear, and reappear when the new card arrive\nChecklist\nPlease, go through these checks before submitting the PR.\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-04-02T08:00:41Z", "url": "https://github.com/ankidroid/Anki-Android/pull/5897", "merged": true, "mergeCommit": {"oid": "029afff75fbcf85fa0e324fdca925d3212c34ce2"}, "closed": true, "closedAt": "2020-04-12T16:19:30Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcV70e8gBqjMyMTgxMjUyNzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcW8v0WgFqTM5MTg3MzA1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aace7d5345ffd17c2209c6bba19d5efc9f7993af", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/aace7d5345ffd17c2209c6bba19d5efc9f7993af", "committedDate": "2020-04-02T08:00:12Z", "message": "Reviewer: button disappear when no action can occur\n\nSome actions can take more than 15 seconds on my phone. This is mostly\ndue to a huge number of deck (and a bad way of dealing with a lot of\ndeck in scheduler)\n\nButtons are still activated. That can be shown because if you click on\n\"bury\" the list will open once the new card is loaded. The problem is\nthat it's not clear at all to me (even when I look at the code) on\nwhich card the action are taken. If I press twice on bury, will it\nalso bury the next card ? is the action ignored ? Does the scheduler\ntries to bury/review/suspend... multiple time the same card ?\n\nThis is even more worrysome when I click on the undo button, where\nI've no clue whether the click is registered or not, and whether\nmultiple undo will be done...\n\nI ensure that less confusion arrive by setting the card to `null`\nwhile waiting for the new card to load, and then removing the buttons\nuntil the cards are loaded."}, "afterCommit": {"oid": "449172f9c379724b886950c41509a92d49a619da", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/449172f9c379724b886950c41509a92d49a619da", "committedDate": "2020-04-09T12:40:05Z", "message": "Reviewer: button disappear when no action can occur\n\nSome actions can take more than 15 seconds on my phone. This is mostly\ndue to a huge number of deck (and a bad way of dealing with a lot of\ndeck in scheduler)\n\nButtons are still activated. That can be shown because if you click on\n\"bury\" the list will open once the new card is loaded. The problem is\nthat it's not clear at all to me (even when I look at the code) on\nwhich card the action are taken. If I press twice on bury, will it\nalso bury the next card ? is the action ignored ? Does the scheduler\ntries to bury/review/suspend... multiple time the same card ?\n\nThis is even more worrysome when I click on the undo button, where\nI've no clue whether the click is registered or not, and whether\nmultiple undo will be done...\n\nI ensure that less confusion arrive by setting the card to `null`\nwhile waiting for the new card to load, and then removing the buttons\nuntil the cards are loaded."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "449172f9c379724b886950c41509a92d49a619da", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/449172f9c379724b886950c41509a92d49a619da", "committedDate": "2020-04-09T12:40:05Z", "message": "Reviewer: button disappear when no action can occur\n\nSome actions can take more than 15 seconds on my phone. This is mostly\ndue to a huge number of deck (and a bad way of dealing with a lot of\ndeck in scheduler)\n\nButtons are still activated. That can be shown because if you click on\n\"bury\" the list will open once the new card is loaded. The problem is\nthat it's not clear at all to me (even when I look at the code) on\nwhich card the action are taken. If I press twice on bury, will it\nalso bury the next card ? is the action ignored ? Does the scheduler\ntries to bury/review/suspend... multiple time the same card ?\n\nThis is even more worrysome when I click on the undo button, where\nI've no clue whether the click is registered or not, and whether\nmultiple undo will be done...\n\nI ensure that less confusion arrive by setting the card to `null`\nwhile waiting for the new card to load, and then removing the buttons\nuntil the cards are loaded."}, "afterCommit": {"oid": "0b7ca56e1f6ff54d13e55750734a270efea5275d", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0b7ca56e1f6ff54d13e55750734a270efea5275d", "committedDate": "2020-04-09T14:08:33Z", "message": "Reviewer: button disappear when no action can occur\n\nSome actions can take more than 15 seconds on my phone. This is mostly\ndue to a huge number of deck (and a bad way of dealing with a lot of\ndeck in scheduler)\n\nButtons are still activated. That can be shown because if you click on\n\"bury\" the list will open once the new card is loaded. The problem is\nthat it's not clear at all to me (even when I look at the code) on\nwhich card the action are taken. If I press twice on bury, will it\nalso bury the next card ? is the action ignored ? Does the scheduler\ntries to bury/review/suspend... multiple time the same card ?\n\nThis is even more worrysome when I click on the undo button, where\nI've no clue whether the click is registered or not, and whether\nmultiple undo will be done...\n\nI ensure that less confusion arrive by setting the card to `null`\nwhile waiting for the new card to load, and then removing the buttons\nuntil the cards are loaded."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c05af88f5caa6eaf0402784011a4f549e51fc43", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4c05af88f5caa6eaf0402784011a4f549e51fc43", "committedDate": "2020-04-11T17:57:04Z", "message": "Undo and Dismiss block controls too"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "531a28dbe23387ddbca19e4770328b5769425cc6", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/531a28dbe23387ddbca19e4770328b5769425cc6", "committedDate": "2020-04-11T17:57:04Z", "message": "Knowing whether controls are currently blocked"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db37168c6502191db87e30749a52823990710aec", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/db37168c6502191db87e30749a52823990710aec", "committedDate": "2020-04-11T17:57:41Z", "message": "don't bury/suspend note when blocked\n\nThis commit may seems useles. But it allows to avoid accessing the\ndatabase and save time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c158e2fb83e7bd77bf23ecb91b94f27221547b25", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c158e2fb83e7bd77bf23ecb91b94f27221547b25", "committedDate": "2020-04-11T17:57:41Z", "message": "Blocking/unblocking change top menu buttons too"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58ec2523777845955f3f7bfbb375c44c4339e818", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/58ec2523777845955f3f7bfbb375c44c4339e818", "committedDate": "2020-04-11T17:57:41Z", "message": "top menu items are deactivated when buttons are blocked"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c51c3547c9ef271fea65a9240638c6da945a4b88", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c51c3547c9ef271fea65a9240638c6da945a4b88", "committedDate": "2020-04-11T17:57:41Z", "message": "don't put \"undo\" to color enabled\n\nEnabled is the default, so it's useless and actually put back the\ncolor uselessly"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b7ca56e1f6ff54d13e55750734a270efea5275d", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0b7ca56e1f6ff54d13e55750734a270efea5275d", "committedDate": "2020-04-09T14:08:33Z", "message": "Reviewer: button disappear when no action can occur\n\nSome actions can take more than 15 seconds on my phone. This is mostly\ndue to a huge number of deck (and a bad way of dealing with a lot of\ndeck in scheduler)\n\nButtons are still activated. That can be shown because if you click on\n\"bury\" the list will open once the new card is loaded. The problem is\nthat it's not clear at all to me (even when I look at the code) on\nwhich card the action are taken. If I press twice on bury, will it\nalso bury the next card ? is the action ignored ? Does the scheduler\ntries to bury/review/suspend... multiple time the same card ?\n\nThis is even more worrysome when I click on the undo button, where\nI've no clue whether the click is registered or not, and whether\nmultiple undo will be done...\n\nI ensure that less confusion arrive by setting the card to `null`\nwhile waiting for the new card to load, and then removing the buttons\nuntil the cards are loaded."}, "afterCommit": {"oid": "c51c3547c9ef271fea65a9240638c6da945a4b88", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c51c3547c9ef271fea65a9240638c6da945a4b88", "committedDate": "2020-04-11T17:57:41Z", "message": "don't put \"undo\" to color enabled\n\nEnabled is the default, so it's useless and actually put back the\ncolor uselessly"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODcxMzI1", "url": "https://github.com/ankidroid/Anki-Android/pull/5897#pullrequestreview-391871325", "createdAt": "2020-04-12T15:59:57Z", "commit": {"oid": "58ec2523777845955f3f7bfbb375c44c4339e818"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxNTo1OTo1N1rOGEWlsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxNTo1OTo1N1rOGEWlsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIxNzU4NQ==", "bodyText": "Interesting - this is definitely following the pattern we have established, but (not in this PR, just as an idea) this might need investigation with regard to night mode", "url": "https://github.com/ankidroid/Anki-Android/pull/5897#discussion_r407217585", "createdAt": "2020-04-12T15:59:57Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -367,7 +367,20 @@ private void addNote() {\n     private void setCustomButtons(Menu menu) {\n         for(int itemId : mCustomButtons.keySet()) {\n             if(mCustomButtons.get(itemId) != MENU_DISABLED) {\n-                menu.findItem(itemId).setShowAsAction(mCustomButtons.get(itemId));\n+                MenuItem item = menu.findItem(itemId);\n+                item.setShowAsAction(mCustomButtons.get(itemId));\n+                Drawable icon = item.getIcon();\n+                if (getControlBlocked()) {\n+                    item.setEnabled(false);\n+                    if (icon != null) {\n+                        icon.setAlpha(Themes.ALPHA_ICON_DISABLED_LIGHT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58ec2523777845955f3f7bfbb375c44c4339e818"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODczMDUx", "url": "https://github.com/ankidroid/Anki-Android/pull/5897#pullrequestreview-391873051", "createdAt": "2020-04-12T16:18:57Z", "commit": {"oid": "c51c3547c9ef271fea65a9240638c6da945a4b88"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3571, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}