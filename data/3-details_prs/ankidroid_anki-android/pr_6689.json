{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUxMTg0MTY4", "number": 6689, "title": "JSON class simple", "bodyText": "I do strongly believe that having type indication is helpful. While creating real types for Deck and Note Types is not something that is going to be considered now, at least, having a type which simply inherits JSONObjects seems a nice step. The code becomes more clear (at least according to me), there is almost no computation cost.\nFurthermore, when porting unit test from upstream, I do believe that it's far easier to directly uses clear type instead of using the generic JSONObject. Because porting those tests is going to be a lot of work, and anything that can simplify the porting is really welcome", "createdAt": "2020-07-17T14:59:37Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6689", "merged": true, "mergeCommit": {"oid": "59822264e6481a2fae8e620de6f94aa230f6c052"}, "closed": true, "closedAt": "2020-07-21T20:50:02Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3IUTYAFqTQ1MjU5NTM1NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3Mj2SAFqTQ1MjgxODM3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNTk1MzU0", "url": "https://github.com/ankidroid/Anki-Android/pull/6689#pullrequestreview-452595354", "createdAt": "2020-07-21T15:49:08Z", "commit": {"oid": "8eebe544524d91bd3fbf88be894b4846638ce526"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNTo0OTowOFrOG0-eMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNTo1MjowM1rOG0-mpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIwMjY3NA==", "bodyText": "Note: comment removed", "url": "https://github.com/ankidroid/Anki-Android/pull/6689#discussion_r458202674", "createdAt": "2020-07-21T15:49:08Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/AbstractSched.java", "diffHunk": "@@ -137,10 +137,7 @@\n     public abstract void sortCards(long[] cids, int start, int step, boolean shuffle, boolean shift);\n     public abstract void randomizeCards(long did);\n     public abstract void orderCards(long did);\n-    public abstract void resortConf(JSONObject conf);\n-    /**\n-     * for post-import\n-     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eebe544524d91bd3fbf88be894b4846638ce526"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIwMzk0Mg==", "bodyText": "Wasn't this in another PR?", "url": "https://github.com/ankidroid/Anki-Android/pull/6689#discussion_r458203942", "createdAt": "2020-07-21T15:50:49Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/utils/JSONObject.java", "diffHunk": "@@ -136,7 +136,7 @@ public JSONObject(String source) {\n \n     public JSONObject(JSONObject copyFrom) {\n         this();\n-        for (String key: this) {\n+        for (String key: copyFrom) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eebe544524d91bd3fbf88be894b4846638ce526"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIwNDgzOQ==", "bodyText": "Needs a better explanation that this clones into the provided object, and not the other way around. Maybe with the method name as well", "url": "https://github.com/ankidroid/Anki-Android/pull/6689#discussion_r458204839", "createdAt": "2020-07-21T15:52:03Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/utils/JSONObject.java", "diffHunk": "@@ -328,6 +328,12 @@ public JSONObject optJSONObject(String name) {\n \n     public JSONObject deepClone() {\n         JSONObject clone = new JSONObject();\n+        deepClone(clone);\n+        return clone;\n+    }\n+\n+    /** deep clone in clone. This allow to have a copy in a subtype of JSONObject. */\n+    protected void deepClone(JSONObject clone) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8eebe544524d91bd3fbf88be894b4846638ce526"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8eebe544524d91bd3fbf88be894b4846638ce526", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8eebe544524d91bd3fbf88be894b4846638ce526", "committedDate": "2020-07-17T14:52:12Z", "message": "NF: Model type"}, "afterCommit": {"oid": "8062562bba3fe23e2ff909d862b7ecc7a956769f", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8062562bba3fe23e2ff909d862b7ecc7a956769f", "committedDate": "2020-07-21T16:00:59Z", "message": "NF: Model type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8062562bba3fe23e2ff909d862b7ecc7a956769f", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8062562bba3fe23e2ff909d862b7ecc7a956769f", "committedDate": "2020-07-21T16:00:59Z", "message": "NF: Model type"}, "afterCommit": {"oid": "8178cf35d73b3d132c532c9c45f5435c9c9383cc", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8178cf35d73b3d132c532c9c45f5435c9c9383cc", "committedDate": "2020-07-21T16:10:26Z", "message": "NF: Model type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8178cf35d73b3d132c532c9c45f5435c9c9383cc", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8178cf35d73b3d132c532c9c45f5435c9c9383cc", "committedDate": "2020-07-21T16:10:26Z", "message": "NF: Model type"}, "afterCommit": {"oid": "7d1c4308aa0f9ad89c5e4728e8b857568fc29a50", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7d1c4308aa0f9ad89c5e4728e8b857568fc29a50", "committedDate": "2020-07-21T16:22:48Z", "message": "NF: Model type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04de5a8a755a651b9d6fbaf7bcfbfa2a0d3c46ea", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/04de5a8a755a651b9d6fbaf7bcfbfa2a0d3c46ea", "committedDate": "2020-07-21T16:23:20Z", "message": "NF: add deepCloneIn in JSONObject"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d1c4308aa0f9ad89c5e4728e8b857568fc29a50", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7d1c4308aa0f9ad89c5e4728e8b857568fc29a50", "committedDate": "2020-07-21T16:22:48Z", "message": "NF: Model type"}, "afterCommit": {"oid": "079e6a0d5a96de1d3d7af34b9673e7089f28b15e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/079e6a0d5a96de1d3d7af34b9673e7089f28b15e", "committedDate": "2020-07-21T16:23:20Z", "message": "NF: Model type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNjU3MTEx", "url": "https://github.com/ankidroid/Anki-Android/pull/6689#pullrequestreview-452657111", "createdAt": "2020-07-21T17:01:06Z", "commit": {"oid": "079e6a0d5a96de1d3d7af34b9673e7089f28b15e"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzowMTowNlrOG1BatA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzoyMDo1MFrOG1CJjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1MDkzMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    JSONObject deck = (Deck) data[0];\n          \n          \n            \n                    Deck deck = (Deck) data[0];", "url": "https://github.com/ankidroid/Anki-Android/pull/6689#discussion_r458250932", "createdAt": "2020-07-21T17:01:06Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1398,12 +1401,12 @@ private TaskData doInBackgroundConfSetSubdecks(TaskData... params) {\n         Timber.d(\"doInBackgroundConfSetSubdecks\");\n         Collection col = CollectionHelper.getInstance().getCol(mContext);\n         Object[] data = params[0].getObjArray();\n-        JSONObject deck = (JSONObject) data[0];\n-        JSONObject conf = (JSONObject) data[1];\n+        JSONObject deck = (Deck) data[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "079e6a0d5a96de1d3d7af34b9673e7089f28b15e"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1MzE0Ng==", "bodyText": "Not a change in this PR - but this line looks suspect (possibly an attempted fix for the corrupt dynamic decks)?", "url": "https://github.com/ankidroid/Anki-Android/pull/6689#discussion_r458253146", "createdAt": "2020-07-21T17:04:50Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "diffHunk": "@@ -679,30 +677,30 @@ public String _ensureParents(String name) {\n     /**\n      * A list of all deck config.\n      */\n-    public ArrayList<JSONObject> allConf() {\n+    public ArrayList<DeckConfig> allConf() {\n         return new ArrayList<>(mDconf.values());\n     }\n \n \n-    public JSONObject confForDid(long did) {\n-        JSONObject deck = get(did, false);\n+    public DeckConfig confForDid(long did) {\n+        Deck deck = get(did, false);\n         assert deck != null;\n         if (deck.has(\"conf\")) {\n-            JSONObject conf = getConf(deck.getLong(\"conf\"));\n+            DeckConfig conf = getConf(deck.getLong(\"conf\"));\n             conf.put(\"dyn\", 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "079e6a0d5a96de1d3d7af34b9673e7089f28b15e"}, "originalPosition": 246}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1NzgxOA==", "bodyText": "This looks good - flagging for second review that new JSONObject and new Model both perform a copy, and don't refer to the same object", "url": "https://github.com/ankidroid/Anki-Android/pull/6689#discussion_r458257818", "createdAt": "2020-07-21T17:12:15Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Models.java", "diffHunk": "@@ -300,10 +300,10 @@ public JSONObject byName(String name) {\n     /** Create a new model, save it in the registry, and return it. */\n \t// Called `new` in Anki's code. New is a reserved word in java,\n \t// not in python. Thus the method has to be renamed.\n-    public JSONObject newModel(String name) {\n+    public Model newModel(String name) {\n         // caller should call save() after modifying\n-        JSONObject m;\n-        m = new JSONObject(defaultModel);\n+        Model m;\n+        m = new Model(defaultModel);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "079e6a0d5a96de1d3d7af34b9673e7089f28b15e"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI2MTU0OQ==", "bodyText": "This is actually different functionality - wrap vs deepClone. This looks OK, but flagging as you wrote the deepClone code", "url": "https://github.com/ankidroid/Anki-Android/pull/6689#discussion_r458261549", "createdAt": "2020-07-21T17:18:34Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Models.java", "diffHunk": "@@ -412,9 +412,8 @@ public int tmplUseCount(JSONObject m, int ord) {\n      */\n \n     /** Copy, save and return. */\n-    public JSONObject copy(JSONObject m) {\n-        JSONObject m2 = null;\n-        m2 = m.deepClone();\n+    public Model copy(Model m) {\n+        Model m2 = new Model(m);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "079e6a0d5a96de1d3d7af34b9673e7089f28b15e"}, "originalPosition": 203}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI2MjkyNg==", "bodyText": "It got moved to the wrong method I feel?", "url": "https://github.com/ankidroid/Anki-Android/pull/6689#discussion_r458262926", "createdAt": "2020-07-21T17:20:50Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/AbstractSched.java", "diffHunk": "@@ -137,10 +137,7 @@\n     public abstract void sortCards(long[] cids, int start, int step, boolean shuffle, boolean shift);\n     public abstract void randomizeCards(long did);\n     public abstract void orderCards(long did);\n-    public abstract void resortConf(JSONObject conf);\n-    /**\n-     * for post-import\n-     */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIwMjY3NA=="}, "originalCommit": {"oid": "8eebe544524d91bd3fbf88be894b4846638ce526"}, "originalPosition": 44}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "079e6a0d5a96de1d3d7af34b9673e7089f28b15e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/079e6a0d5a96de1d3d7af34b9673e7089f28b15e", "committedDate": "2020-07-21T16:23:20Z", "message": "NF: Model type"}, "afterCommit": {"oid": "ac638295a36ce67301daaea0c8e7a18d229476c3", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ac638295a36ce67301daaea0c8e7a18d229476c3", "committedDate": "2020-07-21T18:25:27Z", "message": "NF: Model type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86dcebc0ceb8b8d266694d864f64dc028f50b82d", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/86dcebc0ceb8b8d266694d864f64dc028f50b82d", "committedDate": "2020-07-21T19:14:55Z", "message": "NF: DConf type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50f5c4c358d1980a5adb0e3103b7fb535773429f", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/50f5c4c358d1980a5adb0e3103b7fb535773429f", "committedDate": "2020-07-21T19:14:56Z", "message": "NF: Deck type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a9b92b43af634f6ddc0c766e47042ba2d9325d4", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3a9b92b43af634f6ddc0c766e47042ba2d9325d4", "committedDate": "2020-07-21T19:14:56Z", "message": "NF: Model type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac638295a36ce67301daaea0c8e7a18d229476c3", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ac638295a36ce67301daaea0c8e7a18d229476c3", "committedDate": "2020-07-21T18:25:27Z", "message": "NF: Model type"}, "afterCommit": {"oid": "3a9b92b43af634f6ddc0c766e47042ba2d9325d4", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3a9b92b43af634f6ddc0c766e47042ba2d9325d4", "committedDate": "2020-07-21T19:14:56Z", "message": "NF: Model type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyNzYzOTcz", "url": "https://github.com/ankidroid/Anki-Android/pull/6689#pullrequestreview-452763973", "createdAt": "2020-07-21T19:27:34Z", "commit": {"oid": "3a9b92b43af634f6ddc0c766e47042ba2d9325d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODE4Mzc1", "url": "https://github.com/ankidroid/Anki-Android/pull/6689#pullrequestreview-452818375", "createdAt": "2020-07-21T20:49:56Z", "commit": {"oid": "3a9b92b43af634f6ddc0c766e47042ba2d9325d4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3124, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}