{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzOTkwOTQx", "number": 6451, "title": "Save whiteboard while reviewing ", "bodyText": "Pull Request template\nPurpose / Description\nSome time while reviewing need to save drawn notes, mnemonics or solutions etc. There is option to take screenshot for that. But this implementation add a options to save current drawn whiteboard to internal storage of AnkiDroid.\nFixes\nFixes Link to the issues.\nApproach\n\nCheck whiteboard for null\nSave current whiteboard as bitmap\nAlso check for nightmode is on/off\n\nHow Has This Been Tested?\nTested on emulator,\n\nSelect deck to review\nMake notes, draw etc,\nOption Menu -> Save Whiteboard\nImage will be saved in AnkiDroid folder\n\n\nLearning (optional, can help others)\nhttps://stackoverflow.com/questions/7488559/current-timestamp-as-filename-in-java\nhttps://stackoverflow.com/questions/5536066/convert-view-to-bitmap-on-android\nLinks to blog posts, patterns, libraries or addons used to solve this problem\nChecklist\nPlease, go through these checks before submitting the PR.\n\n[ x ] You have not changed whitespace unnecessarily (it makes diffs hard to read)\n[ x ] You have a descriptive commit message with a short title (first line, max 50 chars).\n[ x ] Your code follows the style of the project (e.g. never omit braces in if statements)\n[ x ] You have commented your code, particularly in hard-to-understand areas\n[ x ] You have performed a self-review of your own code", "createdAt": "2020-06-13T10:49:43Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6451", "merged": true, "mergeCommit": {"oid": "747d16ec6aaad628616dc017b33bd8e6ba8e0706"}, "closed": true, "closedAt": "2020-06-26T01:31:39Z", "author": {"login": "infinyte7"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcq1X--AFqTQzMDEzMTM5OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcu1SkdgH2gAyNDMzOTkwOTQxOmM1YmVlMTA0ODUyYWU4NWZjMDQ2ZDg0NmFiNDI4NWFjNDIyYzU5Mjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTMxMzk4", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#pullrequestreview-430131398", "createdAt": "2020-06-13T10:58:10Z", "commit": {"oid": "34b372df4eb840374f04728e4808057e430e4379"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxMDo1ODoxMFrOGjXAMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxMDo1OTozMFrOGjXAZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczMDIyNA==", "bodyText": "Pass in the exception first and Timber will nicely format it.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Timber.e(\"Whiteboard image saving failed %s\", e.toString());\n          \n          \n            \n                        Timber.e(e, \"Whiteboard image saving failed\");", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439730224", "createdAt": "2020-06-13T10:58:10Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +391,31 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void saveWhiteboard() {\n+        Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n+        Canvas canvas = new Canvas(bitmap);\n+\n+        String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+        String baseFileName = \"Whiteboard\";\n+        String newName = new SimpleDateFormat(\"yyyyMMddHHmmss'.png'\").format(new Date());\n+        String finalFileName = baseFileName + newName;\n+        File saveImgFile = new File(currentAnkiDroidDirectory, finalFileName);\n+\n+        if (isInNightMode()) {\n+            canvas.drawColor(Color.BLACK);\n+        } else {\n+            canvas.drawColor(Color.WHITE);\n+        }\n+\n+        try {\n+            mWhiteboard.draw(canvas);\n+            bitmap.compress(Bitmap.CompressFormat.JPEG, 95, new FileOutputStream(saveImgFile));\n+        } catch (FileNotFoundException e) {\n+            Timber.e(\"Whiteboard image saving failed %s\", e.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34b372df4eb840374f04728e4808057e430e4379"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczMDI3Ng==", "bodyText": "Could you rename this to saveWhiteboardInternal, and have saveWhiteboard call it inside a try..catch. Remove the catch IOException from saveWhiteboardInternal\nWe need to show a toast to users if this fails.", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439730276", "createdAt": "2020-06-13T10:59:30Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +391,31 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void saveWhiteboard() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34b372df4eb840374f04728e4808057e430e4379"}, "originalPosition": 42}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fa5aa7d84c50ed9bd43dacb68cc625e88f3c7854", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/fa5aa7d84c50ed9bd43dacb68cc625e88f3c7854", "committedDate": "2020-06-13T11:01:33Z", "message": "Merge branch 'master' into save-add-whiteboard"}, "afterCommit": {"oid": "34b372df4eb840374f04728e4808057e430e4379", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/34b372df4eb840374f04728e4808057e430e4379", "committedDate": "2020-06-13T10:34:33Z", "message": "\tSave whiteboard"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTM3OTIy", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#pullrequestreview-430137922", "createdAt": "2020-06-13T12:59:45Z", "commit": {"oid": "d7bef753fba14127b4ba5912720049f6b65b1d88"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxMjo1OTo0NlrOGjXcyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxMzowMTowMVrOGjXdNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczNzU0NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_save_failed, e.getLocalizedMessage()),true);\n          \n          \n            \n                                    UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_save_failed, e.getLocalizedMessage()), true);", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439737544", "createdAt": "2020-06-13T12:59:46Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -316,7 +318,11 @@ public boolean onOptionsItemSelected(MenuItem item) {\n             case R.id.action_save_whiteboard:\n                 Timber.i(\"Reviewer:: Save whiteboard button pressed\");\n                 if (mWhiteboard != null) {\n-                    saveWhiteboard();\n+                    try {\n+                        saveWhiteboardInternal();\n+                    } catch (Exception e) {\n+                        UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_save_failed, e.getLocalizedMessage()),true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7bef753fba14127b4ba5912720049f6b65b1d88"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczNzU3Mg==", "bodyText": "Remove this catch, and let the wrapper handle it", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439737572", "createdAt": "2020-06-13T13:00:07Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -412,7 +425,7 @@ private void saveWhiteboard() {\n             mWhiteboard.draw(canvas);\n             bitmap.compress(Bitmap.CompressFormat.JPEG, 95, new FileOutputStream(saveImgFile));\n         } catch (FileNotFoundException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7bef753fba14127b4ba5912720049f6b65b1d88"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczNzYwMQ==", "bodyText": "Can we Timber the exception here?", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439737601", "createdAt": "2020-06-13T13:00:22Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -316,7 +318,11 @@ public boolean onOptionsItemSelected(MenuItem item) {\n             case R.id.action_save_whiteboard:\n                 Timber.i(\"Reviewer:: Save whiteboard button pressed\");\n                 if (mWhiteboard != null) {\n-                    saveWhiteboard();\n+                    try {\n+                        saveWhiteboardInternal();\n+                    } catch (Exception e) {\n+                        UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_save_failed, e.getLocalizedMessage()),true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7bef753fba14127b4ba5912720049f6b65b1d88"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczNzYxNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(!ankiDroidFolder.exists()) {\n          \n          \n            \n                    if (!ankiDroidFolder.exists()) {", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439737617", "createdAt": "2020-06-13T13:00:35Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -392,15 +398,22 @@ public boolean onOptionsItemSelected(MenuItem item) {\n     }\n \n \n-    private void saveWhiteboard() {\n+    private void saveWhiteboardInternal() {\n         Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n         Canvas canvas = new Canvas(bitmap);\n \n-        String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+        File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+\n+        if(!ankiDroidFolder.exists()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7bef753fba14127b4ba5912720049f6b65b1d88"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczNzY1NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <string name=\"white_board_image_save_failed\">White board image saving failed. %s</string>\n          \n          \n            \n                <string name=\"white_board_image_save_failed\">Failed to save whiteboard image. %s</string>", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r439737654", "createdAt": "2020-06-13T13:01:01Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/values/02-strings.xml", "diffHunk": "@@ -262,4 +262,6 @@\n     <string name=\"restore_default\">Restore Default</string>\n \n     <string name=\"reviewer_tts_cloze_spoken_replacement\">Blank</string>\n+    <!-- Whiteboard save image message in Reviewer -->\n+    <string name=\"white_board_image_save_failed\">White board image saving failed. %s</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7bef753fba14127b4ba5912720049f6b65b1d88"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMTQxMjIw", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#pullrequestreview-430141220", "createdAt": "2020-06-13T13:57:28Z", "commit": {"oid": "917b4d589c65ab0a93d51a41fa07c4bed81a26cb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e26cd3c32a60a610e0dd13751d3dedfde72f6dc1", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e26cd3c32a60a610e0dd13751d3dedfde72f6dc1", "committedDate": "2020-06-21T06:43:39Z", "message": "Save whiteboard\n\n\tUpdated Reviewer.java\n\n\tUpadted Reviewer.java, 02-strings.xml\n\n\tUpdated ActionButtonStatus.java, preferences_custom_buttons.xml"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c049ae82c138912c43016b26b5056eb6a5fe6768", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c049ae82c138912c43016b26b5056eb6a5fe6768", "committedDate": "2020-06-21T06:45:57Z", "message": "Merge branch 'save-add-whiteboard' of https://github.com/infinyte7/Anki-Android into save-add-whiteboard"}, "afterCommit": {"oid": "571280e5aff69b0613553285b4c6e3d3c201617d", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/571280e5aff69b0613553285b4c6e3d3c201617d", "committedDate": "2020-06-21T06:50:35Z", "message": "Save whiteboard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e5a9a2a3b751230d6eb1996c09ca096c9cbf8bc", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2e5a9a2a3b751230d6eb1996c09ca096c9cbf8bc", "committedDate": "2020-06-21T07:15:48Z", "message": "Save whiteboard"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a21a0fb455bd5ee72462c415fec175c98fa7c6f4", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a21a0fb455bd5ee72462c415fec175c98fa7c6f4", "committedDate": "2020-06-21T07:04:38Z", "message": "\tUpdate Reviewer.java"}, "afterCommit": {"oid": "2e5a9a2a3b751230d6eb1996c09ca096c9cbf8bc", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2e5a9a2a3b751230d6eb1996c09ca096c9cbf8bc", "committedDate": "2020-06-21T07:15:48Z", "message": "Save whiteboard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce737e2786f55568e7cd53804c02fdf6de5fc37f", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ce737e2786f55568e7cd53804c02fdf6de5fc37f", "committedDate": "2020-06-21T07:21:28Z", "message": "\tUpdated Reviewer.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cecb368ffe34bd9b15a48e9170259a18467fbaa", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6cecb368ffe34bd9b15a48e9170259a18467fbaa", "committedDate": "2020-06-21T07:23:37Z", "message": "  Update Reviewer.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78d221c46e976b697deec9db08deb3be23ca95ee", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/78d221c46e976b697deec9db08deb3be23ca95ee", "committedDate": "2020-06-21T07:25:36Z", "message": "\tUpdate Reviewer.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6031ebad77f20e5ee03f0153411e1d84a9bf08d4", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6031ebad77f20e5ee03f0153411e1d84a9bf08d4", "committedDate": "2020-06-21T07:42:13Z", "message": "    Show taost when image saved"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDg4OTU2", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#pullrequestreview-434488956", "createdAt": "2020-06-21T10:25:34Z", "commit": {"oid": "6031ebad77f20e5ee03f0153411e1d84a9bf08d4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxMDoyNTozNFrOGmrF3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxMDoyNTo1MVrOGmrF9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNTA4NQ==", "bodyText": "Could you extract this functionality into Whiteboard class: use AnkiDroidFolder as the default folder, and allow an override which will accept the folder.\nso something along the lines of:\npublic void saveWhiteBoaard() {\n    File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n    File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n   saveWhiteBoard(ankiDroidFolder );\n}\n\npublic void saveWhiteboard(File folder) {\n   ...\n}", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443205085", "createdAt": "2020-06-21T10:25:34Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -400,8 +420,37 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         }\n         return true;\n     }\n+    private void saveWhiteboardInternal() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6031ebad77f20e5ee03f0153411e1d84a9bf08d4"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNTEwOA==", "bodyText": "Can you remove this try, and add a throws to the method", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443205108", "createdAt": "2020-06-21T10:25:51Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -400,8 +420,37 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         }\n         return true;\n     }\n+    private void saveWhiteboardInternal() {\n+        Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n+        Canvas canvas = new Canvas(bitmap);\n+\n+        File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+\n+        if(!ankiDroidFolder.exists()) {\n+            ankiDroidFolder.mkdirs();\n+        }\n+\n+        String baseFileName = \"Whiteboard\";\n+        String newName = new SimpleDateFormat(\"yyyyMMddHHmmss'.png'\").format(new Date());\n+        String finalFileName = baseFileName + newName;\n \n+        File saveImgFile = new File(ankiDroidFolder, finalFileName);\n \n+        if (isInNightMode()) {\n+            canvas.drawColor(Color.BLACK);\n+        } else {\n+            canvas.drawColor(Color.WHITE);\n+        }\n+\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6031ebad77f20e5ee03f0153411e1d84a9bf08d4"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25f4649a785fc6b7f1b827e35f2b84dba12153ed", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/25f4649a785fc6b7f1b827e35f2b84dba12153ed", "committedDate": "2020-06-21T14:20:12Z", "message": "\tUpdated Reviewer.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTA2MTQ1", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#pullrequestreview-434506145", "createdAt": "2020-06-21T14:28:26Z", "commit": {"oid": "25f4649a785fc6b7f1b827e35f2b84dba12153ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxNDoyODoyNlrOGmsT1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxNDoyODoyNlrOGmsT1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyNTA0Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    File ankiDroidFolder = new File(pictures, \"AnkiDroidFolder\");\n          \n          \n            \n                    File ankiDroidFolder = new File(pictures, \"AnkiDroid\");", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443225046", "createdAt": "2020-06-21T14:28:26Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -420,12 +420,13 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         }\n         return true;\n     }\n-    private void saveWhiteboardInternal() {\n+\n+    private void saveWhiteboardInternal() throws FileNotFoundException{\n         Bitmap bitmap = Bitmap.createBitmap(mWhiteboard.getWidth(), mWhiteboard.getHeight(), Bitmap.Config.ARGB_8888);\n         Canvas canvas = new Canvas(bitmap);\n \n         File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n-        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroidFolder\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25f4649a785fc6b7f1b827e35f2b84dba12153ed"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/1737e1019e38799b3a45a4e2ecfaafb5cf9df997", "committedDate": "2020-06-21T14:56:51Z", "message": "\tFunction extracted to Whiteboard.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTA5NzI3", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#pullrequestreview-434509727", "createdAt": "2020-06-21T15:12:38Z", "commit": {"oid": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxNToxMjozOFrOGmsj5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxNToxMzo1MFrOGmskSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTE1OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(!ankiDroidFolder.exists()) {\n          \n          \n            \n                    if (!ankiDroidFolder.exists()) {", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443229159", "createdAt": "2020-06-21T15:12:38Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -416,4 +425,36 @@ public boolean empty() {\n     public boolean isCurrentlyDrawing() {\n         return mCurrentlyDrawing;\n     }\n+\n+    protected void saveWhiteboard() throws FileNotFoundException {\n+\n+        Bitmap bitmap = Bitmap.createBitmap(this.getWidth(), this.getHeight(), Bitmap.Config.ARGB_8888);\n+        Canvas canvas = new Canvas(bitmap);\n+\n+        File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+\n+        if(!ankiDroidFolder.exists()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTE2Mw==", "bodyText": "Would be better to return the string from the method, then you can remove the member variable.", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443229163", "createdAt": "2020-06-21T15:12:43Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -416,4 +425,36 @@ public boolean empty() {\n     public boolean isCurrentlyDrawing() {\n         return mCurrentlyDrawing;\n     }\n+\n+    protected void saveWhiteboard() throws FileNotFoundException {\n+\n+        Bitmap bitmap = Bitmap.createBitmap(this.getWidth(), this.getHeight(), Bitmap.Config.ARGB_8888);\n+        Canvas canvas = new Canvas(bitmap);\n+\n+        File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+\n+        if(!ankiDroidFolder.exists()) {\n+            ankiDroidFolder.mkdirs();\n+        }\n+\n+        String baseFileName = \"Whiteboard\";\n+        String newName = new SimpleDateFormat(\"yyyyMMddHHmmss'.png'\").format(new Date());\n+        String finalFileName = baseFileName + newName;\n+\n+        saveWhiteboardImagFile = new File(ankiDroidFolder, finalFileName);\n+\n+        if (foregroundColor != Color.BLACK) {\n+            canvas.drawColor(Color.BLACK);\n+        } else {\n+            canvas.drawColor(Color.WHITE);\n+        }\n+\n+        this.draw(canvas);\n+        bitmap.compress(Bitmap.CompressFormat.JPEG, 95, new FileOutputStream(saveWhiteboardImagFile));\n+    }\n+\n+    protected String getSaveImagePath() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTIxNw==", "bodyText": "I think this was accidentally removed", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443229217", "createdAt": "2020-06-21T15:13:23Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -65,15 +72,17 @@\n     private boolean mInvertedColors;\n     private boolean mMonochrome;\n     private boolean mUndoModeActive = false;\n+    private int foregroundColor;\n \n+    File saveWhiteboardImagFile;\n \n     public Whiteboard(AbstractFlashcardViewer cardViewer, boolean inverted, boolean monochrome) {\n         super(cardViewer, null);\n         mCardViewer = new WeakReference<>(cardViewer);\n         mInvertedColors = inverted;\n         mMonochrome = monochrome;\n \n-        int foregroundColor;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTI1Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_saved, mWhiteboard.getSaveImagePath()),true);\n          \n          \n            \n                                    UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_saved, mWhiteboard.getSaveImagePath()), true);", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443229257", "createdAt": "2020-06-21T15:13:50Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -343,7 +335,8 @@ public boolean onOptionsItemSelected(MenuItem item) {\n                 Timber.i(\"Reviewer:: Save whiteboard button pressed\");\n                 if (mWhiteboard != null) {\n                     try {\n-                        saveWhiteboardInternal();\n+                        mWhiteboard.saveWhiteboard();\n+                        UIUtils.showThemedToast(Reviewer.this, getString(R.string.white_board_image_saved, mWhiteboard.getSaveImagePath()),true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9c327e57c707a97a5449fa7d90e835dba37cb7f", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/b9c327e57c707a97a5449fa7d90e835dba37cb7f", "committedDate": "2020-06-21T15:14:42Z", "message": "\tMenu updated reviewer.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTEwMTc1", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#pullrequestreview-434510175", "createdAt": "2020-06-21T15:18:34Z", "commit": {"oid": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxNToxODozNFrOGmsl9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxNToxODozNFrOGmsl9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIyOTY4Ng==", "bodyText": "Here is\nprivate int foregroundColor;", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443229686", "createdAt": "2020-06-21T15:18:34Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -65,15 +72,17 @@\n     private boolean mInvertedColors;\n     private boolean mMonochrome;\n     private boolean mUndoModeActive = false;\n+    private int foregroundColor;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1737e1019e38799b3a45a4e2ecfaafb5cf9df997"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f9f9d533feb51a87eedad53d060d3fa64300bc2", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0f9f9d533feb51a87eedad53d060d3fa64300bc2", "committedDate": "2020-06-21T15:34:31Z", "message": "\tUpdated Reviewer.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df7f3c87f13f03fd768a65397f9d1a2e8bb929a6", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/df7f3c87f13f03fd768a65397f9d1a2e8bb929a6", "committedDate": "2020-06-21T15:35:47Z", "message": "\tUpdate Whiteboard.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf711e2347b4de33905b233acbec8afaf931d2af", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/cf711e2347b4de33905b233acbec8afaf931d2af", "committedDate": "2020-06-21T15:58:04Z", "message": "\tUpdated Reviewer.java Whiteboard.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTEzMjg0", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#pullrequestreview-434513284", "createdAt": "2020-06-21T16:02:10Z", "commit": {"oid": "cf711e2347b4de33905b233acbec8afaf931d2af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTIyNjUy", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#pullrequestreview-434522652", "createdAt": "2020-06-21T18:29:50Z", "commit": {"oid": "cf711e2347b4de33905b233acbec8afaf931d2af"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxODoyOTo1MVrOGmtgQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMVQxODoyOTo1MVrOGmtgQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NDYwOQ==", "bodyText": "Hey @david-allison-1 - should this use TimeUtils ? I'm working through something else with regard to temporary image files (the crop PR) so it is top of mind.\nimport com.ichi2.libanki.utils.SystemTime;\nimport com.ichi2.libanki.utils.TimeUtils;\n\n    // Put this where class variables are instantiated right at the top\n    private SystemTime mTime = new SystemTime();\n\n        // Use them like this:\n        String timeStamp = TimeUtils.getTimestamp(mTime);\n        String newName = timeStamp + \".png\";", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#discussion_r443244609", "createdAt": "2020-06-21T18:29:51Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Whiteboard.java", "diffHunk": "@@ -416,4 +423,33 @@ public boolean empty() {\n     public boolean isCurrentlyDrawing() {\n         return mCurrentlyDrawing;\n     }\n+\n+    protected String saveWhiteboard() throws FileNotFoundException {\n+\n+        Bitmap bitmap = Bitmap.createBitmap(this.getWidth(), this.getHeight(), Bitmap.Config.ARGB_8888);\n+        Canvas canvas = new Canvas(bitmap);\n+\n+        File pictures = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES);\n+        File ankiDroidFolder = new File(pictures, \"AnkiDroid\");\n+\n+        if (!ankiDroidFolder.exists()) {\n+            ankiDroidFolder.mkdirs();\n+        }\n+\n+        String baseFileName = \"Whiteboard\";\n+        String newName = new SimpleDateFormat(\"yyyyMMddHHmmss'.png'\").format(new Date());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf711e2347b4de33905b233acbec8afaf931d2af"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTIyNzU5", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#pullrequestreview-434522759", "createdAt": "2020-06-21T18:31:19Z", "commit": {"oid": "cf711e2347b4de33905b233acbec8afaf931d2af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d15abb514dc96db3cb3e659097f47bb1c5612c84", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d15abb514dc96db3cb3e659097f47bb1c5612c84", "committedDate": "2020-06-24T04:15:20Z", "message": "\tUpdated Whiteboard.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MzE2NTcz", "url": "https://github.com/ankidroid/Anki-Android/pull/6451#pullrequestreview-436316573", "createdAt": "2020-06-24T04:31:46Z", "commit": {"oid": "d15abb514dc96db3cb3e659097f47bb1c5612c84"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5bee104852ae85fc046d846ab4285ac422c5929", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c5bee104852ae85fc046d846ab4285ac422c5929", "committedDate": "2020-06-25T21:11:51Z", "message": "Merge branch 'master' into save-add-whiteboard"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3198, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}