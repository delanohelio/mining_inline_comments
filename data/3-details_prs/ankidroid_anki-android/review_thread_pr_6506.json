{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3MDc4Njkx", "number": 6506, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNzoxNDozNVrOEHL4PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNzoxNDozNVrOEHL4PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1OTcwMTA5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/utils/ImportUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNzoxNDozNVrOGmb9xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNzoxNDozNVrOGmb9xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk1NzI1NA==", "bodyText": "Pretty much a nit but 'e' is for \"application has unknown state and we're basically a contained explosion at this point\", 'w' is for, input was unexpected and it definitely messes with what the user was trying to do, but internal state is fine, we know what's going on, we're good'\nThis is 'w' I think", "url": "https://github.com/ankidroid/Anki-Android/pull/6506#discussion_r442957254", "createdAt": "2020-06-19T17:14:35Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/utils/ImportUtils.java", "diffHunk": "@@ -173,12 +174,32 @@ private String handleContentProviderFile(Context context, Intent intent, Uri dat\n                     AnkiDroidApp.sendExceptionReport(new RuntimeException(\"Error importing apkg file\"), \"IntentHandler.java\", \"apkg import failed\");\n                     return errorMessage;\n                 }\n+\n+                errorMessage = validateZipFile(context, tempOutDir);\n+                if (errorMessage != null) {\n+                    //noinspection ResultOfMethodCallIgnored\n+                    new File(tempOutDir).delete();\n+                    return errorMessage;\n+                }\n+\n                 sendShowImportFileDialogMsg(tempOutDir);\n                 return null;\n             }\n         }\n \n \n+        protected String validateZipFile(Context context, String filePath) {\n+            File file = new File(filePath);\n+            try {\n+                new ZipFile(file);\n+            } catch (Exception e) {\n+                Timber.e(e, \"Failed to validate zip\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "922ec108822cc1d5210961b8dcb89c6137e44ddc"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 217, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}