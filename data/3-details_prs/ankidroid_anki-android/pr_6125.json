{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0ODcxMTA3", "number": 6125, "title": "Background Image to Deck Picker Activity from Gallery", "bodyText": "Pull Request template\nPurpose / Description\nMaking Ankidroid add background to deck picker activity.\n\n(Image from Freepik)\nApproach\n\nAdding an option to preference_appearance.xml to add/remove background Image\nAdding code in Preferences.java to add image path in Shared Preferences\nAccessing Image Path from Shared Preferences and setting Background Image\n\nHow Has This Been Tested?\nTested on Android Emulator.\n\nClick Setting -> Appearance -> Choose an Image\nSelect image to be add as background\nGo to deck picker activity\n\nLearning (optional, can help others)\nhttps://stackoverflow.com/questions/36466483/how-the-codes-work-for-loading-image-from-gallery-android\nhttps://stackoverflow.com/questions/22603153/how-to-programmatically-change-the-background-image-of-an-android-activity\nhttps://stackoverflow.com/questions/29867121/how-to-copy-programmatically-a-file-to-another-directory\nChecklist\nPlease, go through these checks before submitting the PR.\n\n[ x ] You have not changed whitespace unnecessarily (it makes diffs hard to read)\n[ x ] You have a descriptive commit message with a short title (first line, max 50 chars).\n[ x ]  Your code follows the style of the project (e.g. never omit braces in if statements)\n[ x ] You have commented your code, particularly in hard-to-understand areas\n[ x ] You have performed a self-review of your own code", "createdAt": "2020-05-07T19:15:59Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6125", "merged": true, "mergeCommit": {"oid": "86f267f47b2d529da33c9d832dae523963067562"}, "closed": true, "closedAt": "2020-05-10T02:47:00Z", "author": {"login": "infinyte7"}, "timelineItems": {"totalCount": 40, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNhzaJgH2gAyNDE0ODcxMTA3OjNhNGEzMDFkYTNkY2E0ZjZhNDRlZGVmMjE5Mzk4OGJlZDE1MzE2YWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfu1pjAH2gAyNDE0ODcxMTA3OmUyY2ViNjRiY2MwYWI2YTZkYmM0YzIwMDI5NzZlNzMyMDg0NWEyYWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3a4a301da3dca4f6a44edef2193988bed15316ad", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3a4a301da3dca4f6a44edef2193988bed15316ad", "committedDate": "2020-03-14T09:50:07Z", "message": "Add files via upload"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e57c4ceca25bb1fec92ca743eaa98700966108f", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3e57c4ceca25bb1fec92ca743eaa98700966108f", "committedDate": "2020-03-15T09:39:50Z", "message": "Update card.js"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7e91bc09a085ffc129535442af8456f97f6dc80", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e7e91bc09a085ffc129535442af8456f97f6dc80", "committedDate": "2020-03-15T09:41:29Z", "message": "Update AbstractFlashcardViewer.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "366610142dc2b93fd4a54958878b9205a9d59f52", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/366610142dc2b93fd4a54958878b9205a9d59f52", "committedDate": "2020-03-15T15:52:38Z", "message": "Update AbstractFlashcardViewer.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c5ec74a43504d5357e66dfec9b329a64c88c04f", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7c5ec74a43504d5357e66dfec9b329a64c88c04f", "committedDate": "2020-03-15T15:55:06Z", "message": "Update card.js"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8041a93bb3249736811d14659250d93a9c76ca4", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f8041a93bb3249736811d14659250d93a9c76ca4", "committedDate": "2020-03-15T18:25:09Z", "message": "Update AbstractFlashcardViewer.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0f9331b5e8d518d7cbad7ac48cb0443c9384559", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f0f9331b5e8d518d7cbad7ac48cb0443c9384559", "committedDate": "2020-03-15T18:36:30Z", "message": "Update AbstractFlashcardViewer.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f4df32f4fe9551691ebe4117059d301c55fd9b4", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2f4df32f4fe9551691ebe4117059d301c55fd9b4", "committedDate": "2020-03-15T18:36:57Z", "message": "Merge branch 'master' of https://github.com/infinyte7/Anki-Android"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bd146c9a8a58c5b01b73bae5400734b4e940f5b", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7bd146c9a8a58c5b01b73bae5400734b4e940f5b", "committedDate": "2020-03-17T12:05:33Z", "message": "Merge pull request #1 from ankidroid/master\n\nUpdate Ankidroid forked repo - DONE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38ccf485e82e8413146a979176eed3819481439d", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/38ccf485e82e8413146a979176eed3819481439d", "committedDate": "2020-04-01T06:36:27Z", "message": "Added localhost domain-config"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b6bcf3dc2e58fa384cc9a55c701c7f942e115ca", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2b6bcf3dc2e58fa384cc9a55c701c7f942e115ca", "committedDate": "2020-05-07T11:39:18Z", "message": "Merge pull request #2 from ankidroid/master\n\nUpdating Fork"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "465b0a20c6a12b8cae48c4825dcad000aba38688", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/465b0a20c6a12b8cae48c4825dcad000aba38688", "committedDate": "2020-05-07T18:41:31Z", "message": "Anki"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30863ff6ccd14c27375a786629d48a0175b991b6", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/30863ff6ccd14c27375a786629d48a0175b991b6", "committedDate": "2020-05-07T18:41:47Z", "message": "Merge branch 'master' of https://github.com/infinyte7/Anki-Android"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7df6d450273f46b457b846f3a7daf7a19f61b52c", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7df6d450273f46b457b846f3a7daf7a19f61b52c", "committedDate": "2020-05-07T18:45:03Z", "message": "Merge pull request #3 from ankidroid/master\n\nRevert \"don't put \"undo\" to color enabled\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3045d9c618e2f3dc0cfe4f322b9b64d6de3498c", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e3045d9c618e2f3dc0cfe4f322b9b64d6de3498c", "committedDate": "2020-05-07T18:57:46Z", "message": "Update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "955285abd863193bf0c70ab1436ba7d9ec70c770", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/955285abd863193bf0c70ab1436ba7d9ec70c770", "committedDate": "2020-05-07T19:00:37Z", "message": "Update Preferences.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9ef4310bd195d21efbc9be8dd419cc4122a682a", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a9ef4310bd195d21efbc9be8dd419cc4122a682a", "committedDate": "2020-05-07T19:01:55Z", "message": "Merge branch 'master' of https://github.com/infinyte7/Anki-Android"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/91574092619fc3adc061e147930a4d565638d8ec", "committedDate": "2020-05-07T19:03:35Z", "message": "Update preferences_appearance.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46d7fc5616561e625e72ee3164edfd27a7c19669", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/46d7fc5616561e625e72ee3164edfd27a7c19669", "committedDate": "2020-05-07T19:36:11Z", "message": "update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3NzY5MjY0", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#pullrequestreview-407769264", "createdAt": "2020-05-07T19:25:02Z", "commit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOToyNTowMlrOGSM8vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTozNToyOFrOGSNTCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczOTcxMA==", "bodyText": "Should be extracted to resource", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421739710", "createdAt": "2020-05-07T19:25:02Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/xml/preferences_appearance.xml", "diffHunk": "@@ -39,6 +39,14 @@\n             android:entryValues=\"@array/night_theme_values\"\n             android:key=\"nightTheme\"\n             android:title=\"@string/night_theme\" />\n+    </PreferenceCategory>\n+    <PreferenceCategory android:title=\"Background\">\n+        <CheckBoxPreference\n+            android:checked=\"false\"\n+            android:defaultValue=\"0\"\n+            android:key=\"deckPickerBackground\"\n+            android:shouldDisableView=\"true\"\n+            android:title=\"Choose an Image\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczOTgyOQ==", "bodyText": "extract resource", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421739829", "createdAt": "2020-05-07T19:25:16Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();\n+            }\n+        } catch (Exception e) {\n+            Toast.makeText(this, \"Something went wrong\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczOTg5Mw==", "bodyText": "ditto - extract resource", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421739893", "createdAt": "2020-05-07T19:25:25Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MDI1OA==", "bodyText": "At the very least, needs Timber.e logging", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421740258", "createdAt": "2020-05-07T19:26:06Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();\n+            }\n+        } catch (Exception e) {\n+            Toast.makeText(this, \"Something went wrong\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MDU1Nw==", "bodyText": "Would be ideal to include the localised exception in the toast string", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421740557", "createdAt": "2020-05-07T19:26:31Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();\n+            }\n+        } catch (Exception e) {\n+            Toast.makeText(this, \"Something went wrong\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MDkyNA==", "bodyText": "Would be best to remove commented code", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421740924", "createdAt": "2020-05-07T19:27:11Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MTQ2Mg==", "bodyText": "PERF: Use string formatting in Timber rather than concatenation", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421741462", "createdAt": "2020-05-07T19:28:12Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +246,21 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if ( backgroundImage.isChecked()) {\n+                        preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n+                        backgroundImage.setChecked(false);\n+                    } else {\n+                        Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                        startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                        backgroundImage.setChecked(true);\n+                        Timber.i(\"Image added!\" + imgPathString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MTkzOQ==", "bodyText": "Need to handle the case where this throws as the activity isn't found", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421741939", "createdAt": "2020-05-07T19:29:00Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +246,21 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if ( backgroundImage.isChecked()) {\n+                        preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n+                        backgroundImage.setChecked(false);\n+                    } else {\n+                        Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                        startActivityForResult(galleryIntent, RESULT_LOAD_IMG);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MjA4NA==", "bodyText": "Nit: bracket placement", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421742084", "createdAt": "2020-05-07T19:29:15Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +246,21 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if ( backgroundImage.isChecked()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mjc2OA==", "bodyText": "What's the purpose of this? Mostly the static declaration and the default value? Feels like it'd be better as an instance variable", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421742768", "createdAt": "2020-05-07T19:30:37Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -108,7 +112,8 @@\n     private static final String [] sCollectionPreferences = {\"showEstimates\", \"showProgress\",\n             \"learnCutoff\", \"timeLimit\", \"useCurrent\", \"newSpread\", \"dayOffset\", \"schedVer\"};\n \n-\n+    private static int RESULT_LOAD_IMG = 111;\n+    private static String imgPathString = \"default\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MzU1Nw==", "bodyText": "Nit (arguable): Would be useful to extract this to a method", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421743557", "createdAt": "2020-05-07T19:32:07Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mzg0NA==", "bodyText": "Is there a constant which can be used here?", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421743844", "createdAt": "2020-05-07T19:32:39Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {\n+            view.setBackgroundResource(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mzk4Mg==", "bodyText": "This needs to gracefully handle exceptions. Ideally wrap in an exception handler", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421743982", "createdAt": "2020-05-07T19:32:53Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NDU2MQ==", "bodyText": "I /think/ we already target version 15, so this is unnecessary. Happy to be proven wrong.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421744561", "createdAt": "2020-05-07T19:33:57Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);\n+            BitmapDrawable bd = new BitmapDrawable(res, bitmap);\n+            view = findViewById(R.id.root_layout);\n+            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NDk3MA==", "bodyText": "or null", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421744970", "createdAt": "2020-05-07T19:34:38Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NTQxOQ==", "bodyText": "\"You haven't picked an image\"", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421745419", "createdAt": "2020-05-07T19:35:28Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91574092619fc3adc061e147930a4d565638d8ec"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae832792d6acce358da70329161103ba215cc98f", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ae832792d6acce358da70329161103ba215cc98f", "committedDate": "2020-05-08T05:52:44Z", "message": "update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/25aac571d064bb849f01cfd59e895c2d8b13ce2c", "committedDate": "2020-05-08T06:02:46Z", "message": "Update DeckPicker.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MDc0MTIw", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#pullrequestreview-408074120", "createdAt": "2020-05-08T08:06:46Z", "commit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwODowNjo0NlrOGSdQrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwOTowNjo0M1rOGSe5dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwNjk1OQ==", "bodyText": "Wrap this in a try...catch", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422006959", "createdAt": "2020-05-08T08:06:46Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -466,6 +472,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         }\n     }\n \n+    private void applyDeckPickerBackground(SharedPreferences preferences) {\n+        String pathName = preferences.getString(\"deck_background_path\",\"default\");\n+        View view = findViewById(R.id.root_layout);\n+        if (\"default\".equals(pathName)) {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);\n+            BitmapDrawable bd = new BitmapDrawable(res, bitmap);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwNzAxMA==", "bodyText": "Fairly sure this is dead code", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422007010", "createdAt": "2020-05-08T08:06:55Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -466,6 +472,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         }\n     }\n \n+    private void applyDeckPickerBackground(SharedPreferences preferences) {\n+        String pathName = preferences.getString(\"deck_background_path\",\"default\");\n+        View view = findViewById(R.id.root_layout);\n+        if (\"default\".equals(pathName)) {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);\n+            BitmapDrawable bd = new BitmapDrawable(res, bitmap);\n+            view = findViewById(R.id.root_layout);\n+            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwNzEyNA==", "bodyText": "private static final", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422007124", "createdAt": "2020-05-08T08:07:12Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -108,7 +114,9 @@\n     private static final String [] sCollectionPreferences = {\"showEstimates\", \"showProgress\",\n             \"learnCutoff\", \"timeLimit\", \"useCurrent\", \"newSpread\", \"dayOffset\", \"schedVer\"};\n \n-\n+    private static int RESULT_LOAD_IMG = 111;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwNzQ5Nw==", "bodyText": "Use a method for path concat (I think Java uses new File(a, b))", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422007497", "createdAt": "2020-05-08T08:08:14Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwODk2NA==", "bodyText": "(for discussion): We risk polluting the Anki Directory with dead images.\nIdeally pick a static filename and place it there to overwrite.\nThis could also mean that we get rid of the preference if the path is known", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422008964", "createdAt": "2020-05-08T08:11:36Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwOTI2Mw==", "bodyText": "Best to let it throw if the directory isn't found", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422009263", "createdAt": "2020-05-08T08:12:14Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMDU4OQ==", "bodyText": "Just confirming there's no compiler warnings around here from Android API levels, this looks suspect.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422010589", "createdAt": "2020-05-08T08:15:08Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMDc3MQ==", "bodyText": "You'll need to catch OutOfMemoryError here, I believe.\nErrors in java don't inherit from Exception", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422010771", "createdAt": "2020-05-08T08:15:32Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMTE3Mw==", "bodyText": "UIUtils.showThemedToast is a little more standard", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422011173", "createdAt": "2020-05-08T08:16:24Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                } finally {\n+                    if (sourceChannel != null) {\n+                        sourceChannel.close();\n+                    }\n+                    if (destChannel != null) {\n+                        destChannel.close();\n+                    }\n+                }\n+                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMTQ5Ng==", "bodyText": "Ideally show this to the user, e.getLocalisedMessage()", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422011496", "createdAt": "2020-05-08T08:17:03Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                } finally {\n+                    if (sourceChannel != null) {\n+                        sourceChannel.close();\n+                    }\n+                    if (destChannel != null) {\n+                        destChannel.close();\n+                    }\n+                }\n+                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();\n+            } else {\n+                preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n+                Toast.makeText(this, \"You haven't picked any image\", Toast.LENGTH_LONG).show();\n+            }\n+        } catch (Exception e) {\n+            Timber.e(\"Error copying file %s\",e.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMTc3Ng==", "bodyText": "You should be able to extract this to a resource via \"Alt+Enter\" in Android Studio, move it to \"03-dialogs.xml\"", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422011776", "createdAt": "2020-05-08T08:17:45Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                } finally {\n+                    if (sourceChannel != null) {\n+                        sourceChannel.close();\n+                    }\n+                    if (destChannel != null) {\n+                        destChannel.close();\n+                    }\n+                }\n+                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();\n+            } else {\n+                preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n+                Toast.makeText(this, \"You haven't picked any image\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 113}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMjg2Mw==", "bodyText": "\u26a0\ufe0f Security: You need to confirm that the path is rooted on currentAnkiDroidDirectory, otherwise this will let a user who has access to an image picker escalate to having write access on the user's external storage.\nFor example: ../../filename.apk would be malicious input\nThis would be best fixed by writing to a static well-known location, as suggested above.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422012863", "createdAt": "2020-05-08T08:20:13Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMzMxMA==", "bodyText": "Again, best to extract to a resource so this can be translated, see below for instructions", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422013310", "createdAt": "2020-05-08T08:21:15Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                } finally {\n+                    if (sourceChannel != null) {\n+                        sourceChannel.close();\n+                    }\n+                    if (destChannel != null) {\n+                        destChannel.close();\n+                    }\n+                }\n+                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMzgwMw==", "bodyText": "Probably best for Timber.v with a little context here", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422013803", "createdAt": "2020-05-08T08:22:22Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMzk4NA==", "bodyText": "You can use try with resources here", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422013984", "createdAt": "2020-05-08T08:22:46Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNDYyOQ==", "bodyText": "(nit): You can just use ex here, Timber will perform .toString() internally, which can reduce execution time.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422014629", "createdAt": "2020-05-08T08:24:09Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +249,25 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNDgxNQ==", "bodyText": "Best to display failure to the user, ideally with the exception message.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422014815", "createdAt": "2020-05-08T08:24:35Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +249,25 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNTA3Mw==", "bodyText": "Can be converted to a local variable", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422015073", "createdAt": "2020-05-08T08:25:10Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -108,7 +114,9 @@\n     private static final String [] sCollectionPreferences = {\"showEstimates\", \"showProgress\",\n             \"learnCutoff\", \"timeLimit\", \"useCurrent\", \"newSpread\", \"dayOffset\", \"schedVer\"};\n \n-\n+    private static int RESULT_LOAD_IMG = 111;\n+    private String imgPathString = \"default\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNTU0NQ==", "bodyText": "Can also be converted to 2 local variables", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422015545", "createdAt": "2020-05-08T08:26:15Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -108,7 +114,9 @@\n     private static final String [] sCollectionPreferences = {\"showEstimates\", \"showProgress\",\n             \"learnCutoff\", \"timeLimit\", \"useCurrent\", \"newSpread\", \"dayOffset\", \"schedVer\"};\n \n-\n+    private static int RESULT_LOAD_IMG = 111;\n+    private String imgPathString = \"default\";\n+    private String copyImagePathString = \"default\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNTYxMg==", "bodyText": "copyImagePathString can be inline here.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422015612", "createdAt": "2020-05-08T08:26:25Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +249,25 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.toString());\n+                        }\n+                    } else {\n+                        copyImagePathString = \"default\";\n+                        preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxODM1NA==", "bodyText": "This won't handle external images (from Google Drive). You'll want to use openInputStream. Feel free to copy: https://github.com/ankidroid/Anki-Android/pull/5982/files#diff-f57ce86b452ff02ca83e914fd192964dR19", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422018354", "createdAt": "2020-05-08T08:32:36Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxOTE3NA==", "bodyText": "needs to be translatable via a resource", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422019174", "createdAt": "2020-05-08T08:34:23Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +249,25 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.toString());\n+                        }\n+                    } else {\n+                        copyImagePathString = \"default\";\n+                        preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                        backgroundImage.setChecked(false);\n+                        Toast.makeText(this, \"Background image removed\", Toast.LENGTH_LONG).show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAzMzc4Mw==", "bodyText": "Can be condensed to:\ntry (FileChannel sourceChannel = new FileInputStream(sourceFile).getChannel(); \n     FileChannel destChannel = new FileOutputStream(destFile).getChannel()) {\n    destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n}", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422033783", "createdAt": "2020-05-08T09:06:43Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c"}, "originalPosition": 98}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/333008cf0e4b7eaa73c02d013f12e24e096e835e", "committedDate": "2020-05-08T12:35:00Z", "message": "Background Image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5871b34b2f930a78e7146bdd4915eb5d2231e037", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5871b34b2f930a78e7146bdd4915eb5d2231e037", "committedDate": "2020-05-08T12:38:11Z", "message": "Update DeckPicker.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47a1c6f60e968142e6365f8438da3b7855d0234c", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/47a1c6f60e968142e6365f8438da3b7855d0234c", "committedDate": "2020-05-08T12:44:09Z", "message": "Update Preferences.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MjEwNTkx", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#pullrequestreview-408210591", "createdAt": "2020-05-08T12:43:06Z", "commit": {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMjo0MzowNlrOGSkOgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMjo0NToxNVrOGSkR7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTA4OA==", "bodyText": "(nit): Move to finally block to ensure disposal:\nif (cursor != null) { \n    cursor.close(); \n}", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422121088", "createdAt": "2020-05-08T12:43:06Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -402,52 +409,36 @@ private void initSubscreen(String action, PreferenceContext listener) {\n     @Override\n     protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n         super.onActivityResult(requestCode, resultCode, data);\n-        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        String imgPathString = \"\";\n         try {\n             if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n-                Uri selectedImage = data.getData();\n-                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n-                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n-                cursor.moveToFirst();\n-                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n-                imgPathString = cursor.getString(columnIndex);\n-                cursor.close();\n-                Timber.e(imgPathString);\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    imgPathString = cursor.getString(columnIndex);\n+                    cursor.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTM5Mw==", "bodyText": "You probably want a return; + Toast here", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422121393", "createdAt": "2020-05-08T12:43:49Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -402,52 +409,36 @@ private void initSubscreen(String action, PreferenceContext listener) {\n     @Override\n     protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n         super.onActivityResult(requestCode, resultCode, data);\n-        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        String imgPathString = \"\";\n         try {\n             if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n-                Uri selectedImage = data.getData();\n-                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n-                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n-                cursor.moveToFirst();\n-                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n-                imgPathString = cursor.getString(columnIndex);\n-                cursor.close();\n-                Timber.e(imgPathString);\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    imgPathString = cursor.getString(columnIndex);\n+                    cursor.close();\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTYxOQ==", "bodyText": "| Exception, gotta catch 'em all ;)", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422121619", "createdAt": "2020-05-08T12:44:27Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -402,52 +409,36 @@ private void initSubscreen(String action, PreferenceContext listener) {\n     @Override\n     protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n         super.onActivityResult(requestCode, resultCode, data);\n-        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        String imgPathString = \"\";\n         try {\n             if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n-                Uri selectedImage = data.getData();\n-                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n-                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n-                cursor.moveToFirst();\n-                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n-                imgPathString = cursor.getString(columnIndex);\n-                cursor.close();\n-                Timber.e(imgPathString);\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    imgPathString = cursor.getString(columnIndex);\n+                    cursor.close();\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());\n+                };\n+                Timber.v(imgPathString);\n                 File sourceFile = new File(imgPathString);\n-\n-                String imgName = sourceFile.getName();\n                 String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n-                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+                String imageName = \"DeckPickerBackground.png\";\n+                File destFile = new File(currentAnkiDroidDirectory, imageName);\n \n-                File destFile = new File(copyImagePathString);\n-                if (!destFile.getParentFile().exists())\n-                    destFile.getParentFile().mkdirs();\n-                if (!destFile.exists()) {\n-                    destFile.createNewFile();\n-                }\n-\n-                FileChannel sourceChannel = null;\n-                FileChannel destChannel = null;\n-                try {\n-                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n-                   destChannel  = new FileOutputStream(destFile).getChannel();\n-                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n-                } finally {\n-                    if (sourceChannel != null) {\n-                        sourceChannel.close();\n-                    }\n-                    if (destChannel != null) {\n-                        destChannel.close();\n-                    }\n+                try (FileChannel sourceChannel = new FileInputStream(sourceFile).getChannel();\n+                     FileChannel destChannel = new FileOutputStream(destFile).getChannel()) {\n+                    destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                    UIUtils.showThemedToast(this, getString(R.string.background_image_applied), false);\n                 }\n-                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n-                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();\n             } else {\n-                preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n-                Toast.makeText(this, \"You haven't picked any image\", Toast.LENGTH_LONG).show();\n+                UIUtils.showThemedToast(this, getString(R.string.no_image_selected), false);\n             }\n-        } catch (Exception e) {\n-            Timber.e(\"Error copying file %s\",e.toString());\n+        } catch (OutOfMemoryError | IOException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTk2NQ==", "bodyText": "I don't believe this is required.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422121965", "createdAt": "2020-05-08T12:45:15Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -17,7 +17,7 @@\n ~\n ~ You should have received a copy of the GNU General Public License along with\n ~ this program.  If not, see <http://www.gnu.org/licenses/>.\n---><resources>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "829d14f4ae422a1a45a04980735caf75147a153a", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/829d14f4ae422a1a45a04980735caf75147a153a", "committedDate": "2020-05-08T12:48:30Z", "message": "Update DeckPicker.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e7d40de9633ad992bdc271f68857515ec934d2b", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5e7d40de9633ad992bdc271f68857515ec934d2b", "committedDate": "2020-05-08T13:00:59Z", "message": "Update 03-dialogs.xml\n\nPrefrences.java\n03-dialogs.xml\nUpdated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5a04d4e6144e98ebbae8fa816752aa0f0231ac4", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f5a04d4e6144e98ebbae8fa816752aa0f0231ac4", "committedDate": "2020-05-08T13:07:57Z", "message": "Update Preferences.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60a4ff0790aff50a34b21fb2ea498854e55574c3", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/60a4ff0790aff50a34b21fb2ea498854e55574c3", "committedDate": "2020-05-08T13:58:32Z", "message": "Update Preferences.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f1d46028367f813c99febe0d3c13b4e87dad030b", "committedDate": "2020-05-09T14:54:08Z", "message": "Update DeckPicker.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NjcwMTc3", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#pullrequestreview-408670177", "createdAt": "2020-05-09T17:40:35Z", "commit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NjcxMTM2", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#pullrequestreview-408671136", "createdAt": "2020-05-09T17:53:55Z", "commit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxNzo1Mzo1NVrOGS87hA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQxODowMzoxOFrOGS8_jA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNTgyOA==", "bodyText": "Could you extract this into a resource for localisation (there's a preferences.xml file)", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422525828", "createdAt": "2020-05-09T17:53:55Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/xml/preferences_appearance.xml", "diffHunk": "@@ -39,6 +39,14 @@\n             android:entryValues=\"@array/night_theme_values\"\n             android:key=\"nightTheme\"\n             android:title=\"@string/night_theme\" />\n+    </PreferenceCategory>\n+    <PreferenceCategory android:title=\"Background\">\n+        <CheckBoxPreference\n+            android:checked=\"false\"\n+            android:defaultValue=\"0\"\n+            android:key=\"deckPickerBackground\"\n+            android:shouldDisableView=\"true\"\n+            android:title=\"Choose an Image\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNTkxMw==", "bodyText": "Could you wrap the content of applyDeckPickerBackground in a try...catch so we don't kill the app if it fails", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422525913", "createdAt": "2020-05-09T17:54:47Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -466,6 +475,19 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         }\n     }\n \n+    private void applyDeckPickerBackground(View view) {\n+        String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNTk1NA==", "bodyText": "nit: spacing of the ifs", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422525954", "createdAt": "2020-05-09T17:55:06Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +248,32 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.getLocalizedMessage());\n+                        }\n+                    } else {\n+                        backgroundImage.setChecked(false);\n+                        String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                        File imgFile = new File(currentAnkiDroidDirectory, \"DeckPickerBackground.png\" );\n+                        if(imgFile.exists()) {\n+                            if(imgFile.delete()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNjE5Mw==", "bodyText": "Nit: moving these two lines up (so cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null); is the first line after the brace will allow Android Studio to convert this to try with resources and reduce code size", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422526193", "createdAt": "2020-05-09T17:57:32Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +405,44 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Cursor cursor = null;\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNjU2Mw==", "bodyText": "This exception will be better handled in the outer exception handler, best to remove this catch block", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422526563", "createdAt": "2020-05-09T18:00:36Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +405,44 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Cursor cursor = null;\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    String imgPathString = cursor.getString(columnIndex);\n+                    File sourceFile = new File(imgPathString);\n+\n+                    String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                    String imageName = \"DeckPickerBackground.png\";\n+                    File destFile = new File(currentAnkiDroidDirectory, imageName);\n+\n+                    try (FileChannel sourceChannel = new FileInputStream(sourceFile).getChannel();\n+                         FileChannel destChannel = new FileOutputStream(destFile).getChannel()) {\n+                        destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                        UIUtils.showThemedToast(this, getString(R.string.background_image_applied), false);\n+                    }\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNjY2NQ==", "bodyText": "Exception strings can be formatted:\nUIUtils.showThemedToast(this, getString(R.string.error_selecting_image, e.getLocalizedMessage()), false);\nThen add a %s into the resource", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422526665", "createdAt": "2020-05-09T18:01:30Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +405,44 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Cursor cursor = null;\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    String imgPathString = cursor.getString(columnIndex);\n+                    File sourceFile = new File(imgPathString);\n+\n+                    String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                    String imageName = \"DeckPickerBackground.png\";\n+                    File destFile = new File(currentAnkiDroidDirectory, imageName);\n+\n+                    try (FileChannel sourceChannel = new FileInputStream(sourceFile).getChannel();\n+                         FileChannel destChannel = new FileOutputStream(destFile).getChannel()) {\n+                        destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                        UIUtils.showThemedToast(this, getString(R.string.background_image_applied), false);\n+                    }\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());\n+                } finally {\n+                    if (cursor != null) {\n+                        cursor.close();\n+                    }\n+                }\n+            } else {\n+                UIUtils.showThemedToast(this, getString(R.string.no_image_selected), false);\n+            }\n+        } catch (OutOfMemoryError | Exception e) {\n+            UIUtils.showThemedToast(this, getString(R.string.error_selecting_image), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNjc1OA==", "bodyText": "Error selecting image. Please see manual. %s -  we can then explain to the user how to copy the file in.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422526758", "createdAt": "2020-05-09T18:02:27Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -176,4 +176,11 @@\n     <!-- Database Errors-->\n     <string name=\"database_locked_title\">Database Locked</string>\n     <string name=\"database_locked_summary\">The AnkiDroid database is in use by another application. Please close the other application then reopen AnkiDroid.</string>\n+\n+    <!-- Deck Picker Background-->\n+    <string name=\"background_image_applied\">Background image applied</string>\n+    <string name=\"background_image_removed\">Background image removed</string>\n+    <string name=\"no_image_selected\">No image selected</string>\n+    <string name=\"error_selecting_image\">Error selecting image</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNjg2MA==", "bodyText": "Could you leave a comment here:\nDEFECT #5973: Does not handle Google Drive downloads", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422526860", "createdAt": "2020-05-09T18:03:18Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +405,44 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Cursor cursor = null;\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b"}, "originalPosition": 81}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e60944353d6b9fc10ea86360db4ca4c9dbc6b7f7", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e60944353d6b9fc10ea86360db4ca4c9dbc6b7f7", "committedDate": "2020-05-09T22:05:49Z", "message": "deckpicker background image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4Njg3OTYy", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#pullrequestreview-408687962", "createdAt": "2020-05-09T22:12:09Z", "commit": {"oid": "e60944353d6b9fc10ea86360db4ca4c9dbc6b7f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4Njg5MzM4", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#pullrequestreview-408689338", "createdAt": "2020-05-09T22:39:13Z", "commit": {"oid": "e60944353d6b9fc10ea86360db4ca4c9dbc6b7f7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMjozOToxM1rOGS-tlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMjozOToxM1rOGS-tlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU1NTAyOA==", "bodyText": "nit: Might want a Toast here", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422555028", "createdAt": "2020-05-09T22:39:13Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -438,6 +438,14 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n \n         mReviewSummaryTextView = (TextView) findViewById(R.id.today_stats_text_view);\n \n+        //Add background to Deckpicker activity\n+        View view = mFragmented ? findViewById(R.id.deckpicker_view) : findViewById(R.id.root_layout);\n+        try {\n+            applyDeckPickerBackground(view);\n+        } catch (Exception e) {\n+            Timber.e(e,\"Background image apply failed\" );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e60944353d6b9fc10ea86360db4ca4c9dbc6b7f7"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dc19a5c833b782c107e408aa239b13ab71d995a", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3dc19a5c833b782c107e408aa239b13ab71d995a", "committedDate": "2020-05-09T22:52:51Z", "message": "update Deckpicker.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NjkwMTk0", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#pullrequestreview-408690194", "createdAt": "2020-05-09T22:56:54Z", "commit": {"oid": "3dc19a5c833b782c107e408aa239b13ab71d995a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMjo1Njo1NVrOGS-z3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMjo1Njo1NVrOGS-z3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU1NjYzNg==", "bodyText": "Failed to apply background image (sorry!). All done after this.", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422556636", "createdAt": "2020-05-09T22:56:55Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -183,4 +183,5 @@\n     <string name=\"no_image_selected\">No image selected</string>\n     <string name=\"error_selecting_image\">Error selecting image. Please see manual. %s</string>\n     <string name=\"error_deleting_image\">Error deleting image</string>\n+    <string name=\"background_image_apply_failed\">Background image apply failed %s</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3dc19a5c833b782c107e408aa239b13ab71d995a"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2ceb64bcc0ab6a6dbc4c2002976e7320845a2ae", "author": {"user": {"login": "infinyte7", "name": "Mani"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e2ceb64bcc0ab6a6dbc4c2002976e7320845a2ae", "committedDate": "2020-05-09T23:11:58Z", "message": "update 03-dialogs.xml"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3486, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}