{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxNzEyMzgz", "number": 5841, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMDo1MzowOVrODqHrBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxMToyNDo1MlrODqJhhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDkyNDg0OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMDo1MzowOVrOF5sjYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMDo1MzowOVrOF5sjYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzEwNg==", "bodyText": "There's a conflict here now because #5848 beat it to merge - the perils of moving fast :-)", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396043106", "createdAt": "2020-03-22T00:53:09Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -139,4 +139,11 @@\n     <string name=\"empty_cards_none\">No empty cards</string>\n     <string name=\"empty_cards_count\">Cards to delete: %d</string>\n     <string name=\"empty_cards_deleted\">Cards deleted: %d</string>\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDkyNTM1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMDo1NDo0OFrOF5sjoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMDo1NDo0OFrOF5sjoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzE2OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <string name=\"multimedia_editor_camera_permission_refused\"> Could not obtain permissions for camera. Functionality has been disabled.</string>\n          \n          \n            \n                <string name=\"multimedia_editor_camera_permission_refused\">Could not obtain camera permission. Functionality has been disabled.</string>", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396043168", "createdAt": "2020-03-22T00:54:48Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -139,4 +139,11 @@\n     <string name=\"empty_cards_none\">No empty cards</string>\n     <string name=\"empty_cards_count\">Cards to delete: %d</string>\n     <string name=\"empty_cards_deleted\">Cards deleted: %d</string>\n+\n+    <!-- Multimedia - Edit Field Activity -->\n+    <string name=\"multimedia_editor_audio_permission_refused\">Could not obtain permission to record audio.</string>\n+    <string name=\"multimedia_editor_camera_permission_refused\"> Could not obtain permissions for camera. Functionality has been disabled.</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDkyNTU4OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMDo1NTozNVrOF5sjvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMDo1NTozNVrOF5sjvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzE5OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <string name=\"multimedia_editor_audio_permission_refused\">Could not obtain permission to record audio.</string>\n          \n          \n            \n                <string name=\"multimedia_editor_audio_permission_refused\">Could not obtain microphone permission.</string>", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396043198", "createdAt": "2020-03-22T00:55:35Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -139,4 +139,11 @@\n     <string name=\"empty_cards_none\">No empty cards</string>\n     <string name=\"empty_cards_count\">Cards to delete: %d</string>\n     <string name=\"empty_cards_deleted\">Cards deleted: %d</string>\n+\n+    <!-- Multimedia - Edit Field Activity -->\n+    <string name=\"multimedia_editor_audio_permission_refused\">Could not obtain permission to record audio.</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDkyNjYyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/utils/Permissions.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMDo1ODowNlrOF5skTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwNDowMjoyMVrOF5tGOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzM0MQ==", "bodyText": "Not strictly necessary, but I suppose you could refactor the storage permission check to this style?", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396043341", "createdAt": "2020-03-22T00:58:06Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/utils/Permissions.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package com.ichi2.anki.multimediacard.utils;\n+\n+import android.Manifest;\n+import android.content.Context;\n+import android.content.pm.PackageManager;\n+\n+import androidx.annotation.NonNull;\n+import androidx.core.content.ContextCompat;\n+\n+public class Permissions {\n+    private Permissions() { }\n+\n+    public static boolean canUseCamera(@NonNull Context context) {\n+        return hasPermission(context, Manifest.permission.CAMERA);\n+    }\n+\n+    public static boolean canRecordAudio(@NonNull Context context) {\n+        return hasPermission(context, Manifest.permission.RECORD_AUDIO);\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA1MjAyNw==", "bodyText": "Can do, but will also want to move to a more general package rather than one under the multimedia editor.\nI've been burned before by tacking mostly unrelated refactorings into a change as they get much less (if any) testing effort. Breaking storage permissioning would be fatal.\nWill get this one done though. Extract method barely breaks.", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396052027", "createdAt": "2020-03-22T04:02:21Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/utils/Permissions.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package com.ichi2.anki.multimediacard.utils;\n+\n+import android.Manifest;\n+import android.content.Context;\n+import android.content.pm.PackageManager;\n+\n+import androidx.annotation.NonNull;\n+import androidx.core.content.ContextCompat;\n+\n+public class Permissions {\n+    private Permissions() { }\n+\n+    public static boolean canUseCamera(@NonNull Context context) {\n+        return hasPermission(context, Manifest.permission.CAMERA);\n+    }\n+\n+    public static boolean canRecordAudio(@NonNull Context context) {\n+        return hasPermission(context, Manifest.permission.RECORD_AUDIO);\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzM0MQ=="}, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDkyNzYyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMTowMDozOVrOF5sk1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxMzoxNjoxMFrOF5vkJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzQ3Ng==", "bodyText": "If we're going to have a Permissions object, could we encapsulate the requests in there too?", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396043476", "createdAt": "2020-03-22T01:00:39Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -96,55 +101,80 @@ protected void onCreate(Bundle savedInstanceState) {\n \n         mFieldIndex = this.getIntent().getIntExtra(EXTRA_FIELD_INDEX, 0);\n \n-        recreateEditingUi();\n+        recreateEditingUi(ChangeUIRequest.init(mField));\n     }\n \n \n     private void finishCancel() {\n+        Timber.d(\"Completing activity via finishCancel()\");\n         Intent resultData = new Intent();\n         setResult(RESULT_CANCELED, resultData);\n         finishWithoutAnimation();\n     }\n \n+    private boolean performPermissionRequest(IField field) {\n+        // Request permission to record if audio field\n+        if (field instanceof AudioRecordingField && !Permissions.canRecordAudio(this)) {\n+            ActivityCompat.requestPermissions(this, new String[] {Manifest.permission.RECORD_AUDIO},\n+                    REQUEST_AUDIO_PERMISSION);\n+            return true;\n+        }\n+\n+        // Request permission to use the camera if image field\n+        if (field instanceof ImageField && !Permissions.canUseCamera(this)) {\n+            ActivityCompat.requestPermissions(this, new String[] {Manifest.permission.CAMERA},\n+                    REQUEST_CAMERA_PERMISSION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA1MTAwMg==", "bodyText": "I thought about it, but each screen has an associated tag with permission, and it felt like we shouldn't mix local and global data.\nIit makes it much harder if for instance we want to request microphone and audio at once later on for a more advanced editor", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396051002", "createdAt": "2020-03-22T03:40:07Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -96,55 +101,80 @@ protected void onCreate(Bundle savedInstanceState) {\n \n         mFieldIndex = this.getIntent().getIntExtra(EXTRA_FIELD_INDEX, 0);\n \n-        recreateEditingUi();\n+        recreateEditingUi(ChangeUIRequest.init(mField));\n     }\n \n \n     private void finishCancel() {\n+        Timber.d(\"Completing activity via finishCancel()\");\n         Intent resultData = new Intent();\n         setResult(RESULT_CANCELED, resultData);\n         finishWithoutAnimation();\n     }\n \n+    private boolean performPermissionRequest(IField field) {\n+        // Request permission to record if audio field\n+        if (field instanceof AudioRecordingField && !Permissions.canRecordAudio(this)) {\n+            ActivityCompat.requestPermissions(this, new String[] {Manifest.permission.RECORD_AUDIO},\n+                    REQUEST_AUDIO_PERMISSION);\n+            return true;\n+        }\n+\n+        // Request permission to use the camera if image field\n+        if (field instanceof ImageField && !Permissions.canUseCamera(this)) {\n+            ActivityCompat.requestPermissions(this, new String[] {Manifest.permission.CAMERA},\n+                    REQUEST_CAMERA_PERMISSION);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzQ3Ng=="}, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA1MzI5Ng==", "bodyText": "that one in particular is the first that will show up with ./gradlew clean uninstallDebug installDebug and a test click-around, which is the first thing I do for stable releases, so no worries", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396053296", "createdAt": "2020-03-22T04:29:14Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -96,55 +101,80 @@ protected void onCreate(Bundle savedInstanceState) {\n \n         mFieldIndex = this.getIntent().getIntExtra(EXTRA_FIELD_INDEX, 0);\n \n-        recreateEditingUi();\n+        recreateEditingUi(ChangeUIRequest.init(mField));\n     }\n \n \n     private void finishCancel() {\n+        Timber.d(\"Completing activity via finishCancel()\");\n         Intent resultData = new Intent();\n         setResult(RESULT_CANCELED, resultData);\n         finishWithoutAnimation();\n     }\n \n+    private boolean performPermissionRequest(IField field) {\n+        // Request permission to record if audio field\n+        if (field instanceof AudioRecordingField && !Permissions.canRecordAudio(this)) {\n+            ActivityCompat.requestPermissions(this, new String[] {Manifest.permission.RECORD_AUDIO},\n+                    REQUEST_AUDIO_PERMISSION);\n+            return true;\n+        }\n+\n+        // Request permission to use the camera if image field\n+        if (field instanceof ImageField && !Permissions.canUseCamera(this)) {\n+            ActivityCompat.requestPermissions(this, new String[] {Manifest.permission.CAMERA},\n+                    REQUEST_CAMERA_PERMISSION);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzQ3Ng=="}, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA3NTY4Mw==", "bodyText": "I assume the above was desired for the above comment. I'll do that, but will leave this unresolved, will get it done if you still feel it's an issue on review 2", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396075683", "createdAt": "2020-03-22T10:09:02Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -96,55 +101,80 @@ protected void onCreate(Bundle savedInstanceState) {\n \n         mFieldIndex = this.getIntent().getIntExtra(EXTRA_FIELD_INDEX, 0);\n \n-        recreateEditingUi();\n+        recreateEditingUi(ChangeUIRequest.init(mField));\n     }\n \n \n     private void finishCancel() {\n+        Timber.d(\"Completing activity via finishCancel()\");\n         Intent resultData = new Intent();\n         setResult(RESULT_CANCELED, resultData);\n         finishWithoutAnimation();\n     }\n \n+    private boolean performPermissionRequest(IField field) {\n+        // Request permission to record if audio field\n+        if (field instanceof AudioRecordingField && !Permissions.canRecordAudio(this)) {\n+            ActivityCompat.requestPermissions(this, new String[] {Manifest.permission.RECORD_AUDIO},\n+                    REQUEST_AUDIO_PERMISSION);\n+            return true;\n+        }\n+\n+        // Request permission to use the camera if image field\n+        if (field instanceof ImageField && !Permissions.canUseCamera(this)) {\n+            ActivityCompat.requestPermissions(this, new String[] {Manifest.permission.CAMERA},\n+                    REQUEST_CAMERA_PERMISSION);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzQ3Ng=="}, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA5MjQ1Mw==", "bodyText": "I assume the above was desired for the above comment. I'll do that, but will leave this unresolved, will get it done if you still feel it's an issue on review 2\n\nYes that was intended for the storage permission refactor - not sure how github flubbed the comment attribution but you got it", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396092453", "createdAt": "2020-03-22T13:16:10Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -96,55 +101,80 @@ protected void onCreate(Bundle savedInstanceState) {\n \n         mFieldIndex = this.getIntent().getIntExtra(EXTRA_FIELD_INDEX, 0);\n \n-        recreateEditingUi();\n+        recreateEditingUi(ChangeUIRequest.init(mField));\n     }\n \n \n     private void finishCancel() {\n+        Timber.d(\"Completing activity via finishCancel()\");\n         Intent resultData = new Intent();\n         setResult(RESULT_CANCELED, resultData);\n         finishWithoutAnimation();\n     }\n \n+    private boolean performPermissionRequest(IField field) {\n+        // Request permission to record if audio field\n+        if (field instanceof AudioRecordingField && !Permissions.canRecordAudio(this)) {\n+            ActivityCompat.requestPermissions(this, new String[] {Manifest.permission.RECORD_AUDIO},\n+                    REQUEST_AUDIO_PERMISSION);\n+            return true;\n+        }\n+\n+        // Request permission to use the camera if image field\n+        if (field instanceof ImageField && !Permissions.canUseCamera(this)) {\n+            ActivityCompat.requestPermissions(this, new String[] {Manifest.permission.CAMERA},\n+                    REQUEST_CAMERA_PERMISSION);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzQ3Ng=="}, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDkzNjYxOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMToyMzozMFrOF5spQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMToyMzozMFrOF5spQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0NDYwOA==", "bodyText": "This is basically a guaranteed crash right? To be avoided at all costs, it's just making future work. A toast and a fall back to the note editor or anything is better than throwing a RuntimeException if we can avoid it", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396044608", "createdAt": "2020-03-22T01:23:30Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -305,19 +318,21 @@ protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n \n \n     public void onRequestPermissionsResult (int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {\n+        if (mCurrentChangeRequest == null) {\n+            throw new IllegalStateException(\"mCurrentChangeRequest should be set before using cached request\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b885022d2b3d5baec090872d93ea0ec322aaca32"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDk0MDE1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMTozMTozNlrOF5sq4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMTozMTozNlrOF5sq4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0NTAyNQ==", "bodyText": "I have to admit I'm a fan of Timber.d's for things like this, dumping all pertinent internal state to the logs if it's possible", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396045025", "createdAt": "2020-03-22T01:31:36Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -390,4 +414,29 @@ int getState() {\n             return state;\n         }\n     }\n-}\n+\n+    /**\n+     * Class to contain logic relating to decisions made when recreating a UI.\n+     * Can later be converted to a non-static class to allow testing of the logic.\n+     * */\n+    private static final class UIRecreationLogic {\n+\n+        static void onRequiredPermissionDenied(ChangeUIRequest request, MultimediaEditFieldActivity activity) {\n+            switch (request.state)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "057488d2583d29d924a6fa7822a8243145651032"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDk0MTI3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMTozNDo0NlrOF5srag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxMzoxNDozNFrOF5vjhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0NTE2Mg==", "bodyText": "The property accessors are non-standard, can we just do get/set?", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396045162", "createdAt": "2020-03-22T01:34:46Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -410,6 +414,14 @@ static ChangeUIRequest fieldChange(IField field) {\n             return new ChangeUIRequest(field, EXTERNAL_FIELD_CHANGE);\n         }\n \n+        boolean doesRequirePermissionCheck() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e591dd5340d54c4345b194fec6ff708c77d7d2be"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA3MzU1OQ==", "bodyText": "I'm not familiar with Java naming conventions. Is it \"always use get\", or are \"is/has/does\" ever acceptable for booleans?\nWill fix", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396073559", "createdAt": "2020-03-22T09:45:09Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -410,6 +414,14 @@ static ChangeUIRequest fieldChange(IField field) {\n             return new ChangeUIRequest(field, EXTERNAL_FIELD_CHANGE);\n         }\n \n+        boolean doesRequirePermissionCheck() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0NTE2Mg=="}, "originalCommit": {"oid": "e591dd5340d54c4345b194fec6ff708c77d7d2be"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA5MjI5Mg==", "bodyText": "get/set is the gold standard, for booleans you may alter to isXXX but get/set is easiest. Lots of Java things use inspection and the JavaBeans spec specified this so that you easily take an unknown object and inspect it and (likely) know how to operate it", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396092292", "createdAt": "2020-03-22T13:14:34Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -410,6 +414,14 @@ static ChangeUIRequest fieldChange(IField field) {\n             return new ChangeUIRequest(field, EXTERNAL_FIELD_CHANGE);\n         }\n \n+        boolean doesRequirePermissionCheck() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0NTE2Mg=="}, "originalCommit": {"oid": "e591dd5340d54c4345b194fec6ff708c77d7d2be"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NDk0MzAzOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMTozODoyMlrOF5ssRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMTozODoyMlrOF5ssRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0NTM4MQ==", "bodyText": "similarly Timber.d's here and in the other onXXXFailed methods would be nice", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396045381", "createdAt": "2020-03-22T01:38:22Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -433,6 +427,50 @@ int getState() {\n      * */\n     private static final class UIRecreationLogic {\n \n+        /** Raised just before the field controller is replaced */\n+        static void onPreFieldControllerReplacement(IFieldController previousFieldController) {\n+            //on init, we don't need to do anything", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47bf7fe4d83f78a7ee36ca4cb49370c0b17aab46"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ1NTIyODIxOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/utils/Permissions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxMToyNDo1MlrOF5u8Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxMToyNDo1MlrOF5u8Rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA4MjI0Nw==", "bodyText": "Issue found: The utility class name 'Permissions' doesn't match '[A-Z][a-zA-Z0-9]+(Utils?|Helper)'", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396082247", "createdAt": "2020-03-22T11:24:52Z", "author": {"login": "timrae"}, "path": "AnkiDroid/src/main/java/com/ichi2/utils/Permissions.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.ichi2.utils;\n+\n+import android.Manifest;\n+import android.content.Context;\n+import android.content.pm.PackageManager;\n+\n+import androidx.annotation.NonNull;\n+import androidx.core.content.ContextCompat;\n+\n+public class Permissions {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc6615bf01479b65f2b96967c192e0d08844c442"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 448, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}