{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwNDQxNDQx", "number": 6682, "title": "Dependency updates 20200716", "bodyText": "Pull Request template\nPurpose / Description\nKeep track of upstream dependencies, slowly pulling in external change as we can vs as we have to\nThis is kind of a big one:\n\nThe jetbrains-annotations one was blocked by an external transitive dependency, which I use gradle to force (tested, working)\nMockito 3.4.0 has static mocking capabilities (yay!) so I converted away from PowerMock for everything\nA gradle plugin update always sort of implies we all should upgrade Android Studio, so yeah get on that\n\nFixes\nFixes #6672\nApproach\n\nI used a gradle resolutionStrategy to force our jetbrains-annotations version after an upstream PR looks like it's going nowhere\nI used Mockito.mockStatic()to re-implement our unit tests that mocked static things\n\nHow Has This Been Tested?\nIt's literally all tests and lint, so I was testing and linting all the time to do it :-)\nLearning (optional, can help others)\n\nUpstream jetbrains-annotations PR: JakeWharton/timber#398 / resolution strategy https://docs.gradle.org/current/dsl/org.gradle.api.artifacts.ResolutionStrategy.html\nMockito.mockStatic PR: mockito/mockito#1955\n\nChecklist\nPlease, go through these checks before submitting the PR.\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-07-16T19:15:11Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6682", "merged": true, "mergeCommit": {"oid": "4efa2a5d4c058a1511b0c4414c691eb84471f1e3"}, "closed": true, "closedAt": "2020-07-16T22:07:36Z", "author": {"login": "mikehardy"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1RRc7gH2gAyNDUwNDQxNDQxOjM4Yzk0NWNlZGY2NmU4ZDE5NmZhODk0ZWYwYjAwNjZmZDA5MTE5OTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1lVOEABqjM1NTUwNDYzNTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "38c945cedf66e8d196fa894ef0b0066fd0911990", "author": {"user": {"login": "dependabot-preview[bot]", "name": null}}, "url": "https://github.com/ankidroid/Anki-Android/commit/38c945cedf66e8d196fa894ef0b0066fd0911990", "committedDate": "2020-07-15T21:11:31Z", "message": "Bump sqlite-android from 3.31.0 to 3.32.2\n\nBumps [sqlite-android](https://github.com/requery/sqlite-android) from 3.31.0 to 3.32.2.\n- [Release notes](https://github.com/requery/sqlite-android/releases)\n- [Changelog](https://github.com/requery/sqlite-android/blob/master/CHANGELOG.md)\n- [Commits](https://github.com/requery/sqlite-android/commits)\n\nSigned-off-by: dependabot-preview[bot] <support@dependabot.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1d55bb5c0f374219db46ef45bdb36eb77f911d1", "author": {"user": {"login": "dependabot-preview[bot]", "name": null}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d1d55bb5c0f374219db46ef45bdb36eb77f911d1", "committedDate": "2020-07-15T21:11:31Z", "message": "Bump gradle from 4.0.0 to 4.0.1\n\nBumps gradle from 4.0.0 to 4.0.1.\n\nSigned-off-by: dependabot-preview[bot] <support@dependabot.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8548a78dfc88cf0af55d868b998d2ef129d5d27", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f8548a78dfc88cf0af55d868b998d2ef129d5d27", "committedDate": "2020-07-15T22:19:36Z", "message": "Ignore jetbrains-annotations transitive dep from timber\n\nhttps://github.com/JakeWharton/timber/pull/398\n\nhttps://docs.gradle.org/current/dsl/org.gradle.api.artifacts.ResolutionStrategy.html"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ac3c320935934757a99d2377a80b18f76f2e300", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9ac3c320935934757a99d2377a80b18f76f2e300", "committedDate": "2020-07-16T19:07:40Z", "message": "Mockito.mockStatic can take over from PowerMock now\n\nThe mockito dependency upgrade is actually a big feature switch, so\nthe previous usage of PowerMock can be removed and mockito can do all\nof our static mocking"}, "afterCommit": {"oid": "bb742f2cc32143aa2c5972d97e2d22f1b9a828a1", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/bb742f2cc32143aa2c5972d97e2d22f1b9a828a1", "committedDate": "2020-07-16T19:28:51Z", "message": "Mockito.mockStatic can take over from PowerMock now\n\nThe mockito dependency upgrade is actually a big feature switch, so\nthe previous usage of PowerMock can be removed and mockito can do all\nof our static mocking"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMTc1NjEw", "url": "https://github.com/ankidroid/Anki-Android/pull/6682#pullrequestreview-450175610", "createdAt": "2020-07-16T20:03:39Z", "commit": {"oid": "bb742f2cc32143aa2c5972d97e2d22f1b9a828a1"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMDowMzozOVrOGy6y-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMDowNDowMVrOGy6zvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA0NTMwNg==", "bodyText": "Optional: AnkiAssert.doesNotThrow", "url": "https://github.com/ankidroid/Anki-Android/pull/6682#discussion_r456045306", "createdAt": "2020-07-16T20:03:39Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/anki/ProductionCrashReportingTreeTest.java", "diffHunk": "@@ -55,20 +54,30 @@ public void setUp() {\n     @Test\n     public void testProductionDebugVerboseIgnored() {\n \n-        // set up the platform log so that if anyone calls these 2 methods at all, it throws\n-        Mockito.when(Log.v(anyString(), anyString(), any()))\n-                .thenThrow(new RuntimeException(\"Verbose logging should have been ignored\"));\n-        Mockito.when(Log.d(anyString(), anyString(), any()))\n-                .thenThrow(new RuntimeException(\"Debug logging should be ignored\"));\n-\n-        // now call our wrapper - if it hits the platform logger it will throw\n-        try {\n-            Timber.v(\"verbose\");\n-            Timber.d(\"debug\");\n-        } catch (Exception e) {\n-            Assert.fail(\"we were unable to log without exception?\");\n+        try (MockedStatic<Log> ignored = mockStatic(Log.class)) {\n+            // set up the platform log so that if anyone calls these 2 methods at all, it throws\n+            when(Log.v(anyString(), anyString(), any()))\n+                    .thenThrow(new RuntimeException(\"Verbose logging should have been ignored\"));\n+            when(Log.d(anyString(), anyString(), any()))\n+                    .thenThrow(new RuntimeException(\"Debug logging should be ignored\"));\n+            when(Log.i(anyString(), anyString(), any()))\n+                    .thenThrow(new RuntimeException(\"Info logging should throw!\"));\n+\n+            // now call our wrapper - if it hits the platform logger it will throw\n+            try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb742f2cc32143aa2c5972d97e2d22f1b9a828a1"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA0NTUwMg==", "bodyText": "Optional: Consider moving to AnkiAssert", "url": "https://github.com/ankidroid/Anki-Android/pull/6682#discussion_r456045502", "createdAt": "2020-07-16T20:04:01Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/anki/ProductionCrashReportingTreeTest.java", "diffHunk": "@@ -55,20 +54,30 @@ public void setUp() {\n     @Test\n     public void testProductionDebugVerboseIgnored() {\n \n-        // set up the platform log so that if anyone calls these 2 methods at all, it throws\n-        Mockito.when(Log.v(anyString(), anyString(), any()))\n-                .thenThrow(new RuntimeException(\"Verbose logging should have been ignored\"));\n-        Mockito.when(Log.d(anyString(), anyString(), any()))\n-                .thenThrow(new RuntimeException(\"Debug logging should be ignored\"));\n-\n-        // now call our wrapper - if it hits the platform logger it will throw\n-        try {\n-            Timber.v(\"verbose\");\n-            Timber.d(\"debug\");\n-        } catch (Exception e) {\n-            Assert.fail(\"we were unable to log without exception?\");\n+        try (MockedStatic<Log> ignored = mockStatic(Log.class)) {\n+            // set up the platform log so that if anyone calls these 2 methods at all, it throws\n+            when(Log.v(anyString(), anyString(), any()))\n+                    .thenThrow(new RuntimeException(\"Verbose logging should have been ignored\"));\n+            when(Log.d(anyString(), anyString(), any()))\n+                    .thenThrow(new RuntimeException(\"Debug logging should be ignored\"));\n+            when(Log.i(anyString(), anyString(), any()))\n+                    .thenThrow(new RuntimeException(\"Info logging should throw!\"));\n+\n+            // now call our wrapper - if it hits the platform logger it will throw\n+            try {\n+                Timber.v(\"verbose\");\n+                Timber.d(\"debug\");\n+            } catch (Exception e) {\n+                Assert.fail(\"we were unable to log without exception?\");\n+            }\n+\n+            try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb742f2cc32143aa2c5972d97e2d22f1b9a828a1"}, "originalPosition": 78}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61106bacfbd061f15564d9ca7340010007213f48", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/61106bacfbd061f15564d9ca7340010007213f48", "committedDate": "2020-07-16T20:33:29Z", "message": "Mockito.mockStatic can take over from PowerMock now\n\nThe mockito dependency upgrade is actually a big feature switch, so\nthe previous usage of PowerMock can be removed and mockito can do all\nof our static mocking"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb742f2cc32143aa2c5972d97e2d22f1b9a828a1", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/bb742f2cc32143aa2c5972d97e2d22f1b9a828a1", "committedDate": "2020-07-16T19:28:51Z", "message": "Mockito.mockStatic can take over from PowerMock now\n\nThe mockito dependency upgrade is actually a big feature switch, so\nthe previous usage of PowerMock can be removed and mockito can do all\nof our static mocking"}, "afterCommit": {"oid": "61106bacfbd061f15564d9ca7340010007213f48", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/61106bacfbd061f15564d9ca7340010007213f48", "committedDate": "2020-07-16T20:33:29Z", "message": "Mockito.mockStatic can take over from PowerMock now\n\nThe mockito dependency upgrade is actually a big feature switch, so\nthe previous usage of PowerMock can be removed and mockito can do all\nof our static mocking"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3117, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}