{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0MjA2NDM2", "number": 6117, "title": "Only restricted devices require system browser", "bodyText": "Pull Request template\nPurpose / Description\n#5913 implements a system-app-only requirement for the web browser on restricted learning devices, but implements it in a way that imposes that restriction even for non-restricted browsers\nFixes\nFixes #6109 - non-restricted device could not load web content\nApproach\nThis makes the \"is the browser a system app?\" check only apply on restricted devices\nI also added copyright header, fixed whitespace, and changed the variable + method names to contain the feature's intent in the name\nHow Has This Been Tested?\n\nLocal ./gradlew jacocoTestReport on this one after visual inspection a few times\nAPI28 emulator get shared decks with Chrome installed: worked (correct)\nAPI28 emulator w/Chrome disabled: got a toast saying no browser (correct)\nAPI28 emulator w/Chrome disabled, Firefox installed as user: worked (correct)\n\nLearning (optional, can help others)\nNothing special, just that code review is both valuable and still very faulty. Missed this when it went through the first time\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-05-06T16:36:11Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6117", "merged": true, "mergeCommit": {"oid": "27f90024aba6900e7c4ed4c54bd33d754cdbcb00"}, "closed": true, "closedAt": "2020-05-06T17:01:11Z", "author": {"login": "mikehardy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcerZq5AFqTQwNjc5MTkzNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcesOirgFqTQwNjgzNzY0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NzkxOTM3", "url": "https://github.com/ankidroid/Anki-Android/pull/6117#pullrequestreview-406791937", "createdAt": "2020-05-06T16:37:46Z", "commit": {"oid": "e8f02fbb62257a0fdb6b187517792fd1e284cba0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNjozNzo0NlrOGRbq0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNjozNzo0NlrOGRbq0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkzMjMwNQ==", "bodyText": "@david-allison-1 with apologies for the noisiness of the diff, this is the actual logic change - does it look right to you now? (only applying the \"is it a system web browser?\" check if we are restricted\nIt did pass local testing but I'm going to pick this to 2.10-release immediately after merge so a second set of eyes is \ud83e\udd47", "url": "https://github.com/ankidroid/Anki-Android/pull/6117#discussion_r420932305", "createdAt": "2020-05-06T16:37:46Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/utils/AdaptionUtil.java", "diffHunk": "@@ -23,23 +41,16 @@ public static boolean hasWebBrowser(Context context) {\n         Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(\"http://www.google.com\"));\n         PackageManager pm = context.getPackageManager();\n         List<ResolveInfo> list = pm.queryIntentActivities(intent, PackageManager.MATCH_DEFAULT_ONLY);\n-        if (list.size() == 0) {\n-            sHasWebBrowser = false;\n-        } else {\n-            sHasWebBrowser = false;\n-            for (ResolveInfo ri:list) {\n-                String pacagename = ri.activityInfo.packageName;\n-                if (isSystemApp(pacagename, pm)) {\n-                    sHasWebBrowser = true;\n-                    break;\n-                }\n-            }\n+        sHasWebBrowser = false;\n+        for (ResolveInfo ri : list) {\n+            sHasWebBrowser = !isRestrictedLearningDevice() || isSystemApp(ri.activityInfo.packageName, pm);\n+            break;\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8f02fbb62257a0fdb6b187517792fd1e284cba0"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5a845510e333c9c3a79490ab5b4f22e9ef9d52d", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a5a845510e333c9c3a79490ab5b4f22e9ef9d52d", "committedDate": "2020-05-06T16:47:21Z", "message": "Only restricted devices require system browser"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8f02fbb62257a0fdb6b187517792fd1e284cba0", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e8f02fbb62257a0fdb6b187517792fd1e284cba0", "committedDate": "2020-05-06T16:25:28Z", "message": "Only restricted devices require system browser"}, "afterCommit": {"oid": "a5a845510e333c9c3a79490ab5b4f22e9ef9d52d", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a5a845510e333c9c3a79490ab5b4f22e9ef9d52d", "committedDate": "2020-05-06T16:47:21Z", "message": "Only restricted devices require system browser"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2ODM3NjQx", "url": "https://github.com/ankidroid/Anki-Android/pull/6117#pullrequestreview-406837641", "createdAt": "2020-05-06T17:34:47Z", "commit": {"oid": "a5a845510e333c9c3a79490ab5b4f22e9ef9d52d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzozNDo0N1rOGRd64Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNlQxNzozNToyMFrOGRd8LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk2OTE4NQ==", "bodyText": "(optional): Could be extracted out of the loop for clarity.", "url": "https://github.com/ankidroid/Anki-Android/pull/6117#discussion_r420969185", "createdAt": "2020-05-06T17:34:47Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/utils/AdaptionUtil.java", "diffHunk": "@@ -23,23 +41,24 @@ public static boolean hasWebBrowser(Context context) {\n         Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(\"http://www.google.com\"));\n         PackageManager pm = context.getPackageManager();\n         List<ResolveInfo> list = pm.queryIntentActivities(intent, PackageManager.MATCH_DEFAULT_ONLY);\n-        if (list.size() == 0) {\n-            sHasWebBrowser = false;\n-        } else {\n-            sHasWebBrowser = false;\n-            for (ResolveInfo ri:list) {\n-                String pacagename = ri.activityInfo.packageName;\n-                if (isSystemApp(pacagename, pm)) {\n-                    sHasWebBrowser = true;\n-                    break;\n-                }\n+        sHasWebBrowser = false;\n+        for (ResolveInfo ri : list) {\n+            // If we aren't a restricted device, any browser will do\n+            if (!isRestrictedLearningDevice()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5a845510e333c9c3a79490ab5b4f22e9ef9d52d"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk2OTUxNg==", "bodyText": "spacing on the {", "url": "https://github.com/ankidroid/Anki-Android/pull/6117#discussion_r420969516", "createdAt": "2020-05-06T17:35:20Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -133,7 +133,7 @@ public void onBuildHeaders(List<Header> target) {\n         Iterator iterator = target.iterator();\n         while (iterator.hasNext()) {\n             Header header = (Header)iterator.next();\n-            if ((header.titleRes == R.string.pref_cat_advanced) && AdaptionUtil.hasReducedPreferences()){\n+            if ((header.titleRes == R.string.pref_cat_advanced) && AdaptionUtil.isRestrictedLearningDevice()){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5a845510e333c9c3a79490ab5b4f22e9ef9d52d"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3482, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}