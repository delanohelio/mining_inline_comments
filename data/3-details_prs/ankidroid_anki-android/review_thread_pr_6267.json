{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMzQ0Mzcz", "number": 6267, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwMDozNDozNVrOD_Kc6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwMDozOTowN1rOD_KdfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NTU4MTIxOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwMDozNDozNVrOGZsAfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwMDozNDozNVrOGZsAfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU4ODYwNw==", "bodyText": "Beware of Arrays.asList. It returns an implementation of List where calling add will crash. This is fine, but for future reference.", "url": "https://github.com/ankidroid/Anki-Android/pull/6267#discussion_r429588607", "createdAt": "2020-05-24T00:34:35Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -810,22 +810,25 @@ private String replaceStringIfNumeric(String str, String value) {\n \n     private void initializeLanguageDialog(PreferenceScreen screen) {\n         ListPreference languageSelection = (ListPreference) screen.findPreference(LANGUAGE);\n-        Locale currentAppLocale = LanguageUtil.getLocale(AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance())\n-                .getString(Preferences.LANGUAGE, \"\"));\n         if (languageSelection != null) {\n-            Map<String, String> items = new TreeMap<>();\n+            Map<String, List<String>> items = new TreeMap<>();\n             for (String localeCode : LanguageUtil.APP_LANGUAGES) {\n                 Locale loc = LanguageUtil.getLocale(localeCode);\n-                items.put(loc.getDisplayName(currentAppLocale), loc.toString());\n+                //TreeMap always sorted by key.\n+                //      Key is a String: all display names converted to lower case for correct display order.\n+                //      Value is list of 2 strings:\n+                //          1st element is display name with unmodified case\n+                //          2nd element is locale code\n+                items.put(loc.getDisplayName(loc).toLowerCase(), Arrays.asList(loc.getDisplayName(loc), loc.toString()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "785e30855054108a53fb2e539d93e4a2360d0ec8"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NTU4MjY5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwMDozOTowN1rOGZsBMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwMToyMzoxMlrOGZsHng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU4ODc4Nw==", "bodyText": "I think this will work, and will allow you to reduce complexity further down (as you'd be able to use the key as-is):\nnew TreeMap(String.CASE_INSENSITIVE_ORDER);", "url": "https://github.com/ankidroid/Anki-Android/pull/6267#discussion_r429588787", "createdAt": "2020-05-24T00:39:07Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -810,22 +810,25 @@ private String replaceStringIfNumeric(String str, String value) {\n \n     private void initializeLanguageDialog(PreferenceScreen screen) {\n         ListPreference languageSelection = (ListPreference) screen.findPreference(LANGUAGE);\n-        Locale currentAppLocale = LanguageUtil.getLocale(AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance())\n-                .getString(Preferences.LANGUAGE, \"\"));\n         if (languageSelection != null) {\n-            Map<String, String> items = new TreeMap<>();\n+            Map<String, List<String>> items = new TreeMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "785e30855054108a53fb2e539d93e4a2360d0ec8"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU5MDQzMA==", "bodyText": "Well, this is oviously the even simpler solution and also makes the List part unnecessary, so implemented.", "url": "https://github.com/ankidroid/Anki-Android/pull/6267#discussion_r429590430", "createdAt": "2020-05-24T01:23:12Z", "author": {"login": "Arthus"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -810,22 +810,25 @@ private String replaceStringIfNumeric(String str, String value) {\n \n     private void initializeLanguageDialog(PreferenceScreen screen) {\n         ListPreference languageSelection = (ListPreference) screen.findPreference(LANGUAGE);\n-        Locale currentAppLocale = LanguageUtil.getLocale(AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance())\n-                .getString(Preferences.LANGUAGE, \"\"));\n         if (languageSelection != null) {\n-            Map<String, String> items = new TreeMap<>();\n+            Map<String, List<String>> items = new TreeMap<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU4ODc4Nw=="}, "originalCommit": {"oid": "785e30855054108a53fb2e539d93e4a2360d0ec8"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 290, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}