{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2MjA0NDUz", "number": 5881, "title": "Various Renderer Crash Improvements", "bodyText": "Purpose / Description\n\nFixes Gestures being disabled after renderer is regenerated\nFixes various race conditions when the render ends\nFixes a dialog box for a renderer error being cancelable, not ending the activity as expected.\n\nFixes\nFixes #5879\nApproach\n\nGestures: Insert the view at position 0, rather than position 3 (touches appear to be from lowest to highest).\nFixes race condition accessing mCardFrame via atomic variable replacement\nFixes race condition accessing mCardFrameParent inside onRenderProcessGone via extracting the constant reference\nFixes race condition accessing mCard via reader-writer lock\nMade error dialog for render process failure non-cancelable\n\nHow Has This Been Tested?\nOn my device. I can no longer cause a crash due to mashing the answer buttons/gestures due to a race condition.\nThere is still an unsolved crash on the first instance of generating the renderer. This previously existed in the branch\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code\n\nReview Notes\n\nHappy to split this into two PRs (one handling mCard, one for the remainder of the fixes)", "createdAt": "2020-03-31T09:41:51Z", "url": "https://github.com/ankidroid/Anki-Android/pull/5881", "merged": true, "mergeCommit": {"oid": "1d2e055bd476688ae71e6bc2444e1cc9cc13fe9d"}, "closed": true, "closedAt": "2020-03-31T17:21:21Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSpntaAH2gAyMzk2MjA0NDUzOjg0MGIxMTMyZjcwOTYwYmFkYTRjMDAwZDNmYjA4NTRkOWNjZjk4MjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTDhk7AFqTM4NDc1OTI0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "840b1132f70960bada4c000d3fb0854d9ccf9824", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/840b1132f70960bada4c000d3fb0854d9ccf9824", "committedDate": "2020-03-30T07:46:12Z", "message": "Fix Race condition on mCardFrame\n\nThere was a period of time where mCardFrame as null, this caused a NPE\nwhen the AnswerCardHandler called blockControls()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84996bcaafe75f581340ff127d7b3229a3b06fa8", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/84996bcaafe75f581340ff127d7b3229a3b06fa8", "committedDate": "2020-03-30T07:54:07Z", "message": "Added solid reference to mCardFrameParent\n\nTo fix any race conditions by obtaining mCardFrame.getParent()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8dca0637b01c267cf5f36db03dc79e61ceac336", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e8dca0637b01c267cf5f36db03dc79e61ceac336", "committedDate": "2020-03-30T08:03:00Z", "message": "NF: Extract handleHardwareScrollButtons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdb28f917b1c762cb8ae40553db8187ed0019a2f", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/cdb28f917b1c762cb8ae40553db8187ed0019a2f", "committedDate": "2020-03-30T08:06:08Z", "message": "NF: Extract webView Parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa3b843af577dcc040d563760676e4e37279d20d", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/aa3b843af577dcc040d563760676e4e37279d20d", "committedDate": "2020-03-30T09:29:55Z", "message": "WebView Render Crash: Preemptively remove views\n\nAdditional hardening against a crash by removing references to the\nWebView"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00f19645757c9314fe8ec3ed63076a0e93f6c94e", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/00f19645757c9314fe8ec3ed63076a0e93f6c94e", "committedDate": "2020-03-30T09:33:09Z", "message": "WebView Render Dialog: Disable \"Cancel\"\n\nA user could cancel the dialog, leaving the reviewer in an inconsistent\nstate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e876d5f9067000f78183cd1d8eb903635c0f4ddc", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e876d5f9067000f78183cd1d8eb903635c0f4ddc", "committedDate": "2020-03-30T09:36:07Z", "message": "Allow failure in destroyWebView\n\nWe won't lock on the variable on dispose (in case of secondary failure)\nso allow for an exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11967bbd05471105359166eb9cf0221fd6c90d1c", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/11967bbd05471105359166eb9cf0221fd6c90d1c", "committedDate": "2020-03-30T09:39:13Z", "message": "NF: Extract loadContentIntoCard"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d46eb58708c4902e31202ccf0432b0106ca68316", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d46eb58708c4902e31202ccf0432b0106ca68316", "committedDate": "2020-03-30T09:41:39Z", "message": "NF: Extract loadUrlInViewer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75c58ac42eb130b24f85f1bc6c3efd50a7f660e1", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/75c58ac42eb130b24f85f1bc6c3efd50a7f660e1", "committedDate": "2020-03-30T10:52:04Z", "message": "Reorder disposal operations to avoid warning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dab29a1128e8473fdce7998f99c15b95e3ca4b42", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/dab29a1128e8473fdce7998f99c15b95e3ca4b42", "committedDate": "2020-03-30T10:53:00Z", "message": "Restore gestures after WebView crash"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8890c196afc8459452d3425d3d0f925294115afe", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8890c196afc8459452d3425d3d0f925294115afe", "committedDate": "2020-03-31T09:40:52Z", "message": "Added lock on mCard to disallow null\n\nPreviously, mCard could temporarily be null when the render process was\nbeing reset. We use a lock to guard against this.\n\nSince we're a reader/writer lock, heavy on the read side, we only block\nthe UI thread in an exceptional circumstance (when the render process\ncrashes)."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NTY4ODYz", "url": "https://github.com/ankidroid/Anki-Android/pull/5881#pullrequestreview-384568863", "createdAt": "2020-03-31T09:44:36Z", "commit": {"oid": "8890c196afc8459452d3425d3d0f925294115afe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwOTo0NDozN1rOF-Npag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwOTo0NDozN1rOF-Npag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc3OTYyNg==", "bodyText": "Issue found: The method 'updateCard(String)' has an NPath complexity of 7680", "url": "https://github.com/ankidroid/Anki-Android/pull/5881#discussion_r400779626", "createdAt": "2020-03-31T09:44:37Z", "author": {"login": "timrae"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -2242,30 +2303,30 @@ private void addAnswerSounds(String answer) {\n     }\n \n \n-    private void updateCard(String content) {\n+    private void updateCard(final String newContent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8890c196afc8459452d3425d3d0f925294115afe"}, "originalPosition": 353}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NzU5MjQ0", "url": "https://github.com/ankidroid/Anki-Android/pull/5881#pullrequestreview-384759244", "createdAt": "2020-03-31T13:57:02Z", "commit": {"oid": "8890c196afc8459452d3425d3d0f925294115afe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3568, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}