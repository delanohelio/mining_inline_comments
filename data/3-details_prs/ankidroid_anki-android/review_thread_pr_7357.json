{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NDU5NzU2", "number": 7357, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMjoxODowMVrOEqsz1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwMDo1OToxNlrOEq-PRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMjA5ODE1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMjoxODowMVrOHdDgbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMjoxODowMVrOHdDgbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIyODIwNA==", "bodyText": "This is causing a lot of test failures", "url": "https://github.com/ankidroid/Anki-Android/pull/7357#discussion_r500228204", "createdAt": "2020-10-06T12:18:01Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "diffHunk": "@@ -951,8 +950,8 @@ public void checkIntegrity() {\n     public LinkedList<Long> active() {\n         JSONArray activeDecks = mCol.getConf().getJSONArray(\"activeDecks\");\n         LinkedList<Long> result = new LinkedList<>();\n-        for (int i = 0; i < activeDecks.length(); i++) {\n-            result.add(activeDecks.getLong(i));\n+        for (Long l: activeDecks.<Long>iterable()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94e0f8579ea4bfa788b92741523f786e94f1debb"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzNDk1MzY1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Storage.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QwMDo1OToxNlrOHde75g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMjowMzozNFrOHdv61A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY3NzYwNg==", "bodyText": "This moves from i = 1 to i = 0.", "url": "https://github.com/ankidroid/Anki-Android/pull/7357#discussion_r500677606", "createdAt": "2020-10-07T00:59:16Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Storage.java", "diffHunk": "@@ -257,8 +255,7 @@ private static void _upgradeClozeModel(Collection col, Model m) throws ConfirmMo\n         // delete non-cloze cards for the model\n         JSONArray tmpls = m.getJSONArray(\"tmpls\");\n         ArrayList<JSONObject> rem = new ArrayList<>();\n-        for (int i = 1; i < tmpls.length(); i++) {\n-            JSONObject ta = tmpls.getJSONObject(i);\n+        for (JSONObject ta: tmpls.jsonObjectIterable()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfcde149bb63d1310f92d6de2f6a117575904780"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDkxMTUzMg==", "bodyText": "This seems to be multiple issues together.\nI had to go back look at older code to see what is done upstream, and there is a mistake in the first place. Upstream uses \"qfmt\" while we use \"afmt\". This means that this whole method has been broken since 2012. 0326c38\nSince this method update the collection from version 3 to 4, I suspect it rarely runs anymore. I'd be okay with writting regression test, but I honestly don't know what is the expected outcome, because it seems that the outcome produced by this method is not even valid anymore according to today's data structure", "url": "https://github.com/ankidroid/Anki-Android/pull/7357#discussion_r500911532", "createdAt": "2020-10-07T10:40:06Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Storage.java", "diffHunk": "@@ -257,8 +255,7 @@ private static void _upgradeClozeModel(Collection col, Model m) throws ConfirmMo\n         // delete non-cloze cards for the model\n         JSONArray tmpls = m.getJSONArray(\"tmpls\");\n         ArrayList<JSONObject> rem = new ArrayList<>();\n-        for (int i = 1; i < tmpls.length(); i++) {\n-            JSONObject ta = tmpls.getJSONObject(i);\n+        for (JSONObject ta: tmpls.jsonObjectIterable()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY3NzYwNg=="}, "originalCommit": {"oid": "bfcde149bb63d1310f92d6de2f6a117575904780"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk1NTg2MA==", "bodyText": "No point in testing - let's fix it/flag it and move on", "url": "https://github.com/ankidroid/Anki-Android/pull/7357#discussion_r500955860", "createdAt": "2020-10-07T12:03:34Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Storage.java", "diffHunk": "@@ -257,8 +255,7 @@ private static void _upgradeClozeModel(Collection col, Model m) throws ConfirmMo\n         // delete non-cloze cards for the model\n         JSONArray tmpls = m.getJSONArray(\"tmpls\");\n         ArrayList<JSONObject> rem = new ArrayList<>();\n-        for (int i = 1; i < tmpls.length(); i++) {\n-            JSONObject ta = tmpls.getJSONObject(i);\n+        for (JSONObject ta: tmpls.jsonObjectIterable()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY3NzYwNg=="}, "originalCommit": {"oid": "bfcde149bb63d1310f92d6de2f6a117575904780"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 820, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}