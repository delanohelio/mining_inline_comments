{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0NjM2Nzkz", "number": 7306, "title": "NF: Reviewer check whether a card is empty more quickly", "bodyText": "Cards with a lot of siblings takes time to be displayed. I never noticed because those cards also have a lot of fields, so I assumed it was the cause of the problem. Indeed, it used to be, but card generation was improved enough that it is not the bottleneck anymore. The bottle neck is very silly: to know whether a card is empty, we compute the list of non-empty cards of the note, and then check whether the card belongs to this set... That is entirely useless, since it consider all siblings in a process where siblings data is immediately discarded.\nThis PR change that, by splitting the method availOrds in three. One part deal with clozed note (this part is already efficient), one part deal with with standard note, and from this part I exctracted the part which deals with each card individually. I added a method which, given a single card, state whether it is empty without considering its neighbors.", "createdAt": "2020-09-29T07:52:52Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7306", "merged": true, "mergeCommit": {"oid": "9e98cdd953459b740822d37e84ba1be18576cef2"}, "closed": true, "closedAt": "2020-10-24T16:08:29Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNoL2mAFqTQ5ODQ2NjUyMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVteLSAFqTUxNjI4ODM1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDY2NTIx", "url": "https://github.com/ankidroid/Anki-Android/pull/7306#pullrequestreview-498466521", "createdAt": "2020-09-29T13:27:19Z", "commit": {"oid": "0a5e474d8e32122ad3c31ba3159a656bf208e5fb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyNzoxOVrOHZtF7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxMzoyNzoxOVrOHZtF7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxNTI0NA==", "bodyText": "could be a constant, also is there any chance of getting at least a basic test of the area altered to make sure it actually didn't break (and to give you something to build on when you learn why it broke in something completely unexpected way later...)", "url": "https://github.com/ankidroid/Anki-Android/pull/7306#discussion_r496715244", "createdAt": "2020-09-29T13:27:19Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Models.java", "diffHunk": "@@ -1062,9 +1062,45 @@ private void _updateRequired(Model m) {\n     }\n \n \n+    /**\n+     * @param type Whether the rules to generate this card is is any, all, none\n+     * @param req The fields that must be fill (all), or that suffices (any) to generate the card\n+     * @param trimmedFields the field of a note. Fields are assumed to be trimmed\n+     * @return Whether the card is empty\n+     */\n+    public static boolean emptyStandardCard(String type, JSONArray req, String[] trimmedFields) {\n+        if (\"none\".equals(type)) {\n+            // unsatisfiable template\n+            return true;\n+        }\n+        if (\"all\".equals(type)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a5e474d8e32122ad3c31ba3159a656bf208e5fb"}, "originalPosition": 15}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "66eb0e3b47db20187302266f604651ca04a3219d", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/66eb0e3b47db20187302266f604651ca04a3219d", "committedDate": "2020-09-29T07:45:41Z", "message": "NF: Card.isEmpty consider a single card"}, "afterCommit": {"oid": "db505818846281cf4c8ac77cf035f1cecd788618", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/db505818846281cf4c8ac77cf035f1cecd788618", "committedDate": "2020-09-29T22:02:14Z", "message": "NF: Card.isEmpty consider a single card"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db505818846281cf4c8ac77cf035f1cecd788618", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/db505818846281cf4c8ac77cf035f1cecd788618", "committedDate": "2020-09-29T22:02:14Z", "message": "NF: Card.isEmpty consider a single card"}, "afterCommit": {"oid": "4e4d376e01f1ae9388590e58aee9cb6be6b9d1a5", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4e4d376e01f1ae9388590e58aee9cb6be6b9d1a5", "committedDate": "2020-10-23T11:26:31Z", "message": "NF: Card.isEmpty consider a single card"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74ae7f4824fa6c864a7a37e2b71507b836639ccf", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/74ae7f4824fa6c864a7a37e2b71507b836639ccf", "committedDate": "2020-10-23T20:21:07Z", "message": "NF: availords is static\n\nWhether a card is generated or not does not depends on the manager nor on the call at all"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e3ebedf4221ae92e4ac721ff8f14a5b19f8283f", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5e3ebedf4221ae92e4ac721ff8f14a5b19f8283f", "committedDate": "2020-10-23T20:21:15Z", "message": "NF: trim array in an external method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97d8567f2d49e24e8e54aa874adac3949fec0d01", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/97d8567f2d49e24e8e54aa874adac3949fec0d01", "committedDate": "2020-10-23T20:21:15Z", "message": "NF: split _availStandardOrds from availOrds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "812574439fc62f331b39743393fa1c5d9fb94cd9", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/812574439fc62f331b39743393fa1c5d9fb94cd9", "committedDate": "2020-10-23T20:21:36Z", "message": "NF: split availOrds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fd738d3a1b05502a5f3c2590f2a9ff57e2cb9fd", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8fd738d3a1b05502a5f3c2590f2a9ff57e2cb9fd", "committedDate": "2020-10-23T20:21:48Z", "message": "NF: Card.isEmpty consider a single card"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4e4d376e01f1ae9388590e58aee9cb6be6b9d1a5", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4e4d376e01f1ae9388590e58aee9cb6be6b9d1a5", "committedDate": "2020-10-23T11:26:31Z", "message": "NF: Card.isEmpty consider a single card"}, "afterCommit": {"oid": "8fd738d3a1b05502a5f3c2590f2a9ff57e2cb9fd", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8fd738d3a1b05502a5f3c2590f2a9ff57e2cb9fd", "committedDate": "2020-10-23T20:21:48Z", "message": "NF: Card.isEmpty consider a single card"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mjg4MzU5", "url": "https://github.com/ankidroid/Anki-Android/pull/7306#pullrequestreview-516288359", "createdAt": "2020-10-24T16:08:21Z", "commit": {"oid": "8fd738d3a1b05502a5f3c2590f2a9ff57e2cb9fd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3932, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}