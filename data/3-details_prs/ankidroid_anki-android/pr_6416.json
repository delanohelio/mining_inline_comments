{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMxNzg0NDk0", "number": 6416, "title": "Allow user to set Language Hints for Note Editor fields", "bodyText": "Draft\nI've removed the draft flag - I'd like to get this in and refactor if it gets traction and then refactor (if feasible)\n\nThis needs investigation as to whether this can be simplified via\nInputMethodSubtype ims = InputMethodManager.getCurrentInputMethodSubtype().getLocale();\nIf this works (50/50 - Android IME options are flaky), then the field editor fragment and locale selection screen can be removed and this feature is much smaller.\nTo Review\n\nThis does not handle an \"unset\" - I don't feel this is necessary, but that's borderline.\nWe use Locale.getAvailableLocales() for the locale list, we currently use the system language. Do we want to use the AnkiDroid language here?\nDoes this need to be split up further to make it reviewable? Where are the pain points currently?\n\nPurpose / Description\nFeature request: allow the keyboard to remember the last input language on a field.\nSadly, this didn't seem possible, but it is possible to select and keep a \"language hint\"\nFixes\nFixes #3496\nApproach\nAdd a field into the \"field\" JSON specifying the language. Add a context menu on the note editor, and menu in the fields screen to set\nHow Has This Been Tested?\nManually tested - including with Don't Keep Activities.\nThis works after syncing.\nThis does not work with SwiftKey, which is disappointing.\nScreenshots and video incoming\nLearning\nInitial StackOverflow research said this wasn't possible, they were mistaken\nhttps://developer.android.com/reference/android/widget/TextView#setImeHintLocales(android.os.LocaleList)\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-06-09T13:13:30Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6416", "merged": true, "mergeCommit": {"oid": "8c51f74dbbe138e3c2f2d0e7cda08262035739ba"}, "closed": true, "closedAt": "2020-08-18T20:02:29Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcpk_i1AFqTQyNzEzNTgzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdALmaigBqjM2Njc2NzE1OTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MTM1ODM2", "url": "https://github.com/ankidroid/Anki-Android/pull/6416#pullrequestreview-427135836", "createdAt": "2020-06-09T13:20:16Z", "commit": {"oid": "87e8477c5919545865dbec79cbffa7f275702a14"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMzoyMDoxNlrOGhJbjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMzoyMDoxNlrOGhJbjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQxMDcwMQ==", "bodyText": "Flagging in case there's a better way here", "url": "https://github.com/ankidroid/Anki-Android/pull/6416#discussion_r437410701", "createdAt": "2020-06-09T13:20:16Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/ModelFieldEditor.java", "diffHunk": "@@ -537,6 +545,54 @@ public void onBackPressed() {\n             case ModelEditorContextMenu.FIELD_TOGGLE_STICKY:\n                 toggleStickyField();\n                 break;\n+            default: {\n+                //need this as we can't switch on a @RequiresApi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87e8477c5919545865dbec79cbffa7f275702a14"}, "originalPosition": 37}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "87e8477c5919545865dbec79cbffa7f275702a14", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/87e8477c5919545865dbec79cbffa7f275702a14", "committedDate": "2020-06-09T12:43:28Z", "message": "NoteEditor: ActionItem to change field language\n\nThis adds a \"Set field language\" context menu item on the Note Editor\nThis will set and save the keyboard hint locale to the model.\n\nDesigned to enable discoverability of the field language functionality"}, "afterCommit": {"oid": "08669c60f732d814ef785452e87163f932d78a4d", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/08669c60f732d814ef785452e87163f932d78a4d", "committedDate": "2020-06-09T13:35:01Z", "message": "NoteEditor: ActionItem to change field language\n\nThis adds a \"Set field language\" context menu item on the Note Editor\nThis will set and save the keyboard hint locale to the model.\n\nDesigned to enable discoverability of the field language functionality"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "08669c60f732d814ef785452e87163f932d78a4d", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/08669c60f732d814ef785452e87163f932d78a4d", "committedDate": "2020-06-09T13:35:01Z", "message": "NoteEditor: ActionItem to change field language\n\nThis adds a \"Set field language\" context menu item on the Note Editor\nThis will set and save the keyboard hint locale to the model.\n\nDesigned to enable discoverability of the field language functionality"}, "afterCommit": {"oid": "694d9843ad72fa5d6f95059210331cba34ebe9de", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/694d9843ad72fa5d6f95059210331cba34ebe9de", "committedDate": "2020-08-07T01:23:25Z", "message": "NoteEditor: ActionItem to change field language\n\nThis adds a \"Set field language\" context menu item on the Note Editor\nThis will set and save the keyboard hint locale to the model.\n\nDesigned to enable discoverability of the field language functionality"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NTg1NTIx", "url": "https://github.com/ankidroid/Anki-Android/pull/6416#pullrequestreview-469585521", "createdAt": "2020-08-18T15:44:10Z", "commit": {"oid": "694d9843ad72fa5d6f95059210331cba34ebe9de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b8e3c4145e584bf749656d97252f2567cd59e0e", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5b8e3c4145e584bf749656d97252f2567cd59e0e", "committedDate": "2020-08-18T18:39:48Z", "message": "NF: Extract getEntryCount\n\nTo be used in a later refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7d04589b7a96b7ea634dad79f9ec2507b1f922c", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e7d04589b7a96b7ea634dad79f9ec2507b1f922c", "committedDate": "2020-08-18T18:39:48Z", "message": "Extract setNoteTypePosition\n\nTo be used in a later refactoring - moves this before populateEditFields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c389ea419f8fcd0ddc921a41c65c334e5be7e7b", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4c389ea419f8fcd0ddc921a41c65c334e5be7e7b", "committedDate": "2020-08-18T18:45:33Z", "message": "NF/PERF: Make Models.fieldMap static\n\nAlso planned to be used in a later commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ff0179e2f07797b27100ce12c13e0d6b0812512", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0ff0179e2f07797b27100ce12c13e0d6b0812512", "committedDate": "2020-08-18T18:47:48Z", "message": "Add \"set keyboard language hint\" to fields\n\nAndroid >= N (24). TextViews can have `setImeHintLocales` called\nwhich will change a multilingual keyboard to the provided locale if\navailable.\n\nThis does not currently work for SwiftKey, but does work with GBoard.\n\nFixes #3496"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "120d74eadef7eee5e05a9c8681684dde4488da17", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/120d74eadef7eee5e05a9c8681684dde4488da17", "committedDate": "2020-08-18T18:47:51Z", "message": "NF: Refactor onPrepareActionMode\n\nIn preparation for adding in another menu item"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7875a948a31c7d11331658693a11bb3a072dca08", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7875a948a31c7d11331658693a11bb3a072dca08", "committedDate": "2020-08-18T18:47:52Z", "message": "NoteEditor: ActionItem to change field language\n\nThis adds a \"Set field language\" context menu item on the Note Editor\nThis will set and save the keyboard hint locale to the model.\n\nDesigned to enable discoverability of the field language functionality"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "694d9843ad72fa5d6f95059210331cba34ebe9de", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/694d9843ad72fa5d6f95059210331cba34ebe9de", "committedDate": "2020-08-07T01:23:25Z", "message": "NoteEditor: ActionItem to change field language\n\nThis adds a \"Set field language\" context menu item on the Note Editor\nThis will set and save the keyboard hint locale to the model.\n\nDesigned to enable discoverability of the field language functionality"}, "afterCommit": {"oid": "7875a948a31c7d11331658693a11bb3a072dca08", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7875a948a31c7d11331658693a11bb3a072dca08", "committedDate": "2020-08-18T18:47:52Z", "message": "NoteEditor: ActionItem to change field language\n\nThis adds a \"Set field language\" context menu item on the Note Editor\nThis will set and save the keyboard hint locale to the model.\n\nDesigned to enable discoverability of the field language functionality"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3167, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}