{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNTkxMzA3", "number": 5993, "title": "In-Memory Multimedia Editor", "bodyText": "Purpose / Description\nPreviously, we were using the field values from the existing model in the database when editing fields.\nNow, we use the values shown in the UI.\nAutomated lint fixes were also executed.\nFixes\nFixes #5992\nApproach\nPass the field values and the model ID into NoteService, rather than using the model from the card.\nHow Has This Been Tested?\nUnit Tests\nTested on my device, works as expected.\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-04-13T10:53:06Z", "url": "https://github.com/ankidroid/Anki-Android/pull/5993", "merged": true, "mergeCommit": {"oid": "595fb0bb4e0d8b8a114dba7a1af594e92b4a4079"}, "closed": true, "closedAt": "2020-04-13T16:19:21Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXMkPRgH2gAyNDAyNTkxMzA3OjVlMzMxYmM3ODNkOTAzNzg3ODdlOThjOTliMzM1ZjhiZThiYTMzMjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXRWWGAFqTM5MjI1MTkyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5e331bc783d90378787e98c99b335f8be8ba3326", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5e331bc783d90378787e98c99b335f8be8ba3326", "committedDate": "2020-04-13T10:44:47Z", "message": "LINT: NoteEditor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "362c21a5a86c05fc92b8731262777d824ac71abb", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/362c21a5a86c05fc92b8731262777d824ac71abb", "committedDate": "2020-04-13T10:44:58Z", "message": "Multimedia Editor - Use Current Field Values\n\nFixes #5992\n\nPreviously, we were using the field values from the existing model in\nthe database when editing fields.\n\nNow, we use the values shown in the UI."}, "afterCommit": {"oid": "c73658c9c00e42e688f4c37c811e11628206420e", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c73658c9c00e42e688f4c37c811e11628206420e", "committedDate": "2020-04-13T12:08:44Z", "message": "Multimedia Editor - Use Current Field Values\n\nFixes #5992\n\nPreviously, we were using the field values from the existing model in\nthe database when editing fields.\n\nNow, we use the values shown in the UI."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMTUwNjI2", "url": "https://github.com/ankidroid/Anki-Android/pull/5993#pullrequestreview-392150626", "createdAt": "2020-04-13T13:41:55Z", "commit": {"oid": "cc63b7965f4e869ba2389a2c4bb3dc11e5642895"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxMzo0MTo1NVrOGEm06A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxMzo1NDoyNlrOGEnMSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ4MzYyNA==", "bodyText": "This is not the proper use of the Compat infrastructure\nIf you can't put a comment on top of every single API that you add to Compat that explains the difference in behavior across Android versions, and in which exact version you can remove the Compat API with old workaround-implementation and inline the \"modern\" implementation, then it does not belong in Compat", "url": "https://github.com/ankidroid/Anki-Android/pull/5993#discussion_r407483624", "createdAt": "2020-04-13T13:41:55Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/FieldEditText.java", "diffHunk": "@@ -18,7 +19,7 @@\n \n public class FieldEditText extends AppCompatEditText {\n \n-    public static final String NEW_LINE = System.getProperty(\"line.separator\");\n+    public static final String NEW_LINE = CompatHelper.getCompat().getLineSeparator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc63b7965f4e869ba2389a2c4bb3dc11e5642895"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ4NzYxNw==", "bodyText": "https://developer.android.com/reference/android/content/Intent#getExtras()\n\"the map of all extras previously added with putExtra(), or null if none have been added.\"\n...you never know", "url": "https://github.com/ankidroid/Anki-Android/pull/5993#discussion_r407487617", "createdAt": "2020-04-13T13:50:10Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -96,15 +96,21 @@ protected void onCreate(Bundle savedInstanceState) {\n             setSupportActionBar(toolbar);\n         }\n \n-        mField = (IField) this.getIntent().getExtras().getSerializable(EXTRA_FIELD);\n+        Intent intent = this.getIntent();\n+        mField = getFieldFromIntent(intent);\n \n-        mNote = (IMultimediaEditableNote) this.getIntent().getSerializableExtra(EXTRA_WHOLE_NOTE);\n+        mNote = (IMultimediaEditableNote) intent.getSerializableExtra(EXTRA_WHOLE_NOTE);\n \n-        mFieldIndex = this.getIntent().getIntExtra(EXTRA_FIELD_INDEX, 0);\n+        mFieldIndex = intent.getIntExtra(EXTRA_FIELD_INDEX, 0);\n \n         recreateEditingUi(ChangeUIRequest.init(mField));\n     }\n \n+    @VisibleForTesting\n+    public static IField getFieldFromIntent(Intent intent) {\n+        return (IField) intent.getExtras().getSerializable(EXTRA_FIELD);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c73658c9c00e42e688f4c37c811e11628206420e"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ4ODU5NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                protected Note addBasicNote(String front, String back) {\n          \n          \n            \n                protected Note getNoteUsingBasicModel(String front, String back) {\n          \n      \n    \n    \n  \n\n...or similar, just a bit more unambiguous that the note itself isn't basic (maybe means a simple note?) but that it is attached to the basic model", "url": "https://github.com/ankidroid/Anki-Android/pull/5993#discussion_r407488595", "createdAt": "2020-04-13T13:52:16Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/test/java/com/ichi2/anki/RobolectricTest.java", "diffHunk": "@@ -91,4 +95,23 @@ protected JSONObject getCurrentDatabaseModelCopy(String modelName) throws JSONEx\n         Models collectionModels = getCol().getModels();\n         return new JSONObject(collectionModels.byName(modelName).toString().trim());\n     }\n+\n+    protected <T extends AnkiActivity> T startActivityNormallyOpenCollectionWithIntent(Class<T> clazz, Intent i) {\n+        ActivityController multimediaController = Robolectric.buildActivity(clazz, i)\n+                .create().start().resume().visible();\n+        //noinspection unchecked\n+        return (T) multimediaController.get();\n+    }\n+\n+    protected Note addBasicNote(String front, String back) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c73658c9c00e42e688f4c37c811e11628206420e"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ4OTYxMQ==", "bodyText": "On first read I thought this was bound to the multimedia work but it looks like you've made a fully general purpose activity starter?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                protected <T extends AnkiActivity> T startActivityNormallyOpenCollectionWithIntent(Class<T> clazz, Intent i) {\n          \n          \n            \n                    ActivityController multimediaController = Robolectric.buildActivity(clazz, i)\n          \n          \n            \n                            .create().start().resume().visible();\n          \n          \n            \n                    //noinspection unchecked\n          \n          \n            \n                    return (T) multimediaController.get();\n          \n          \n            \n                }\n          \n          \n            \n                protected <T extends AnkiActivity> T startActivityNormallyOpenCollectionWithIntent(Class<T> clazz, Intent i) {\n          \n          \n            \n                    ActivityController controller = Robolectric.buildActivity(clazz, i)\n          \n          \n            \n                            .create().start().resume().visible();\n          \n          \n            \n                    //noinspection unchecked\n          \n          \n            \n                    return (T) controller.get();\n          \n          \n            \n                }", "url": "https://github.com/ankidroid/Anki-Android/pull/5993#discussion_r407489611", "createdAt": "2020-04-13T13:54:26Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/test/java/com/ichi2/anki/RobolectricTest.java", "diffHunk": "@@ -91,4 +95,23 @@ protected JSONObject getCurrentDatabaseModelCopy(String modelName) throws JSONEx\n         Models collectionModels = getCol().getModels();\n         return new JSONObject(collectionModels.byName(modelName).toString().trim());\n     }\n+\n+    protected <T extends AnkiActivity> T startActivityNormallyOpenCollectionWithIntent(Class<T> clazz, Intent i) {\n+        ActivityController multimediaController = Robolectric.buildActivity(clazz, i)\n+                .create().start().resume().visible();\n+        //noinspection unchecked\n+        return (T) multimediaController.get();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c73658c9c00e42e688f4c37c811e11628206420e"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30d9d21a8c1dece3af63e76bf08719d80975e59b", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/30d9d21a8c1dece3af63e76bf08719d80975e59b", "committedDate": "2020-04-13T14:10:32Z", "message": "NF: Extract updateMultimediaNoteFromFields()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f3114283035dd43deb72fc4efab630f9ee48c4f", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/1f3114283035dd43deb72fc4efab630f9ee48c4f", "committedDate": "2020-04-13T14:10:32Z", "message": "NF: Extract startMultimediaFieldEditorForField()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0115496da18f63e9f69ca1c0ca758fa08d01d851", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0115496da18f63e9f69ca1c0ca758fa08d01d851", "committedDate": "2020-04-13T14:10:32Z", "message": "NF: Added Desires"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffb60f7e86886864375ed88da580f413c1738873", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ffb60f7e86886864375ed88da580f413c1738873", "committedDate": "2020-04-13T14:10:33Z", "message": "NF: Extract: getFieldsAsBundle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7457a19a8e0c42f396cf784ba28830080efe2ac", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e7457a19a8e0c42f396cf784ba28830080efe2ac", "committedDate": "2020-04-13T14:10:33Z", "message": "NF: Simplify startMultimediaFieldEditor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec9b5848d34929cb1c37f0b2044af262fcf3b79d", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ec9b5848d34929cb1c37f0b2044af262fcf3b79d", "committedDate": "2020-04-13T14:32:04Z", "message": "Multimedia Editor - Use Current Field Values\n\nFixes #5992\n\nPreviously, we were using the field values from the existing model in\nthe database when editing fields.\n\nNow, we use the values shown in the UI."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c73658c9c00e42e688f4c37c811e11628206420e", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c73658c9c00e42e688f4c37c811e11628206420e", "committedDate": "2020-04-13T12:08:44Z", "message": "Multimedia Editor - Use Current Field Values\n\nFixes #5992\n\nPreviously, we were using the field values from the existing model in\nthe database when editing fields.\n\nNow, we use the values shown in the UI."}, "afterCommit": {"oid": "ec9b5848d34929cb1c37f0b2044af262fcf3b79d", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ec9b5848d34929cb1c37f0b2044af262fcf3b79d", "committedDate": "2020-04-13T14:32:04Z", "message": "Multimedia Editor - Use Current Field Values\n\nFixes #5992\n\nPreviously, we were using the field values from the existing model in\nthe database when editing fields.\n\nNow, we use the values shown in the UI."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMjUxOTIw", "url": "https://github.com/ankidroid/Anki-Android/pull/5993#pullrequestreview-392251920", "createdAt": "2020-04-13T16:19:08Z", "commit": {"oid": "ec9b5848d34929cb1c37f0b2044af262fcf3b79d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3658, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}