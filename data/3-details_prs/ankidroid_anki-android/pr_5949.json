{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNDcwNzgy", "number": 5949, "title": "Add integrity check: ensureCardsHaveHomeDeck", "bodyText": "Purpose / Description\nThis fixes any occurrences of #5932 which have already occurred.\nAnd leaves a variable free to perform a notification with\nFixes\nFixes  #5932\nApproach\nFixIntegrity check\nHow Has This Been Tested?\nTested on my personal collection.\nAlso tested on a corrupt collection, which it fixes.\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-04-07T19:54:50Z", "url": "https://github.com/ankidroid/Anki-Android/pull/5949", "merged": true, "mergeCommit": {"oid": "58f9dc33e46ab41421842971c632e0188714008c"}, "closed": true, "closedAt": "2020-04-20T18:31:40Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVaPxXgFqTM4OTUwMjQ1OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZiX-ggFqTM5NjY1NTEwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5NTAyNDU4", "url": "https://github.com/ankidroid/Anki-Android/pull/5949#pullrequestreview-389502458", "createdAt": "2020-04-07T21:25:57Z", "commit": {"oid": "9c232d775250a6a1869d429da3c8eee06fffd1b5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMToyNTo1N1rOGCWvmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMTozMDo0MFrOGCW4nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyMjk2OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Timber.i(\"Found %d decks with no home deck\", cardIds.size());\n          \n          \n            \n                    Timber.i(\"Found %d cards with no home deck\", cardIds.size());", "url": "https://github.com/ankidroid/Anki-Android/pull/5949#discussion_r405122968", "createdAt": "2020-04-07T21:25:57Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1604,11 +1604,66 @@ public long fixIntegrity(DeckTask.ProgressCallback progressCallback) {\n         file = new File(mPath);\n         long newSize = file.length();\n         // if any problems were found, force a full sync\n-        if (problems.size() > 0) {\n+        if (result.hasProblems()) {\n             modSchemaNoCheck();\n         }\n-        logProblems(problems);\n-        return (oldSize - newSize) / 1024;\n+        logProblems(result.getProblems());\n+        return (result.getOldSize() - newSize) / 1024;\n+    }\n+\n+\n+    private List<String> ensureCardsHaveHomeDeck(Runnable notifyProgress, CheckDatabaseResult result) {\n+        // #5932 - a card may not have a home deck if:\n+        // * It is in a dynamic deck, and has odid = 0.\n+        // * It is in a dynamic deck, and the odid refers to a dynamic deck.\n+        notifyProgress.run();\n+        //Both of these cases can be fixed by setting the odid to 1.\n+\n+        //get the deck Ids to query\n+        Long[] dynDeckIds = getDecks().allDynamicDeckIds();\n+        //make it mutable\n+        List<Long> dynIdsAndZero = new ArrayList<>(Arrays.asList(dynDeckIds));\n+        dynIdsAndZero.add(0L);\n+\n+        ArrayList<Long> cardIds = mDb.queryColumn(Long.class, \"select id from cards where did in \" +\n+                Utils.ids2str(dynDeckIds) +\n+                \"and odid in \" +\n+                Utils.ids2str(dynIdsAndZero)\n+                , 0);\n+\n+        notifyProgress.run();\n+\n+        if (cardIds.isEmpty()) {\n+            return Collections.emptyList();\n+        }\n+\n+        //PERF: in debug, 3 seconds for 87 cards.\n+        //So, roughly 30 for 1000 cards\n+        Timber.i(\"Found %d decks with no home deck\", cardIds.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c232d775250a6a1869d429da3c8eee06fffd1b5"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyNDI5Mw==", "bodyText": "By that PERF comment do you mean it took 3 seconds to execute the query above, where you attempt to get the list of the cards? If that is true, I wonder if you ordered the query opposite so it reduced by odid in dynIdsAndZero it would be smaller - thinking being that in the intersection of the two sets the odid clause should be a smaller initial set thus making for faster execution of the did clause. Pure speculation without numbers, and I may be misattributing the PERf comment. I don't want fixIntegrity to take 30s for each 1000 cards though, it would be orders of magnitude slower than it is now if I understand that correctly?", "url": "https://github.com/ankidroid/Anki-Android/pull/5949#discussion_r405124293", "createdAt": "2020-04-07T21:28:37Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1604,11 +1604,66 @@ public long fixIntegrity(DeckTask.ProgressCallback progressCallback) {\n         file = new File(mPath);\n         long newSize = file.length();\n         // if any problems were found, force a full sync\n-        if (problems.size() > 0) {\n+        if (result.hasProblems()) {\n             modSchemaNoCheck();\n         }\n-        logProblems(problems);\n-        return (oldSize - newSize) / 1024;\n+        logProblems(result.getProblems());\n+        return (result.getOldSize() - newSize) / 1024;\n+    }\n+\n+\n+    private List<String> ensureCardsHaveHomeDeck(Runnable notifyProgress, CheckDatabaseResult result) {\n+        // #5932 - a card may not have a home deck if:\n+        // * It is in a dynamic deck, and has odid = 0.\n+        // * It is in a dynamic deck, and the odid refers to a dynamic deck.\n+        notifyProgress.run();\n+        //Both of these cases can be fixed by setting the odid to 1.\n+\n+        //get the deck Ids to query\n+        Long[] dynDeckIds = getDecks().allDynamicDeckIds();\n+        //make it mutable\n+        List<Long> dynIdsAndZero = new ArrayList<>(Arrays.asList(dynDeckIds));\n+        dynIdsAndZero.add(0L);\n+\n+        ArrayList<Long> cardIds = mDb.queryColumn(Long.class, \"select id from cards where did in \" +\n+                Utils.ids2str(dynDeckIds) +\n+                \"and odid in \" +\n+                Utils.ids2str(dynIdsAndZero)\n+                , 0);\n+\n+        notifyProgress.run();\n+\n+        if (cardIds.isEmpty()) {\n+            return Collections.emptyList();\n+        }\n+\n+        //PERF: in debug, 3 seconds for 87 cards.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c232d775250a6a1869d429da3c8eee06fffd1b5"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyNDYyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String message = String.format(Locale.US, \"Fixed %d decks with no home deck\", fixed);\n          \n          \n            \n                    String message = String.format(Locale.US, \"Fixed %d cards with no home deck\", fixed);", "url": "https://github.com/ankidroid/Anki-Android/pull/5949#discussion_r405124622", "createdAt": "2020-04-07T21:29:12Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1604,11 +1604,66 @@ public long fixIntegrity(DeckTask.ProgressCallback progressCallback) {\n         file = new File(mPath);\n         long newSize = file.length();\n         // if any problems were found, force a full sync\n-        if (problems.size() > 0) {\n+        if (result.hasProblems()) {\n             modSchemaNoCheck();\n         }\n-        logProblems(problems);\n-        return (oldSize - newSize) / 1024;\n+        logProblems(result.getProblems());\n+        return (result.getOldSize() - newSize) / 1024;\n+    }\n+\n+\n+    private List<String> ensureCardsHaveHomeDeck(Runnable notifyProgress, CheckDatabaseResult result) {\n+        // #5932 - a card may not have a home deck if:\n+        // * It is in a dynamic deck, and has odid = 0.\n+        // * It is in a dynamic deck, and the odid refers to a dynamic deck.\n+        notifyProgress.run();\n+        //Both of these cases can be fixed by setting the odid to 1.\n+\n+        //get the deck Ids to query\n+        Long[] dynDeckIds = getDecks().allDynamicDeckIds();\n+        //make it mutable\n+        List<Long> dynIdsAndZero = new ArrayList<>(Arrays.asList(dynDeckIds));\n+        dynIdsAndZero.add(0L);\n+\n+        ArrayList<Long> cardIds = mDb.queryColumn(Long.class, \"select id from cards where did in \" +\n+                Utils.ids2str(dynDeckIds) +\n+                \"and odid in \" +\n+                Utils.ids2str(dynIdsAndZero)\n+                , 0);\n+\n+        notifyProgress.run();\n+\n+        if (cardIds.isEmpty()) {\n+            return Collections.emptyList();\n+        }\n+\n+        //PERF: in debug, 3 seconds for 87 cards.\n+        //So, roughly 30 for 1000 cards\n+        Timber.i(\"Found %d decks with no home deck\", cardIds.size());\n+        int fixed = 0;\n+        for (long cardId : cardIds) {\n+            try {\n+                Card c = getCard(cardId);\n+                c.setDid(Consts.DEFAULT_DECK_ID);\n+                c.setODid(0L);\n+                c.note().addTag(mContext.getString(R.string.missing_home_deck_tag));\n+\n+                c.note().flush();\n+                c.flush();\n+                fixed++;\n+            } catch (Exception e) {\n+                Timber.e(e, \"Failed to fix card '%d'\", cardId);\n+            }\n+        }\n+\n+        result.setCardsWithFixedHomeDeckCount(fixed);\n+\n+        if (fixed == 0) {\n+            return Collections.emptyList();\n+        }\n+        Timber.d(\"Completed\");\n+        String message = String.format(Locale.US, \"Fixed %d decks with no home deck\", fixed);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c232d775250a6a1869d429da3c8eee06fffd1b5"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyNTI3Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <string name=\"integrity_check_fixed_no_home_deck\" >%d cards have been moved to the default deck. Please see the manual to locate them.</string>\n          \n          \n            \n                <string name=\"integrity_check_fixed_no_home_deck\">%d cards with incorrect home decks were moved to the default deck. Please see the manual to locate them.</string>", "url": "https://github.com/ankidroid/Anki-Android/pull/5949#discussion_r405125277", "createdAt": "2020-04-07T21:30:40Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -159,6 +159,8 @@\n     <string name=\"integrity_check_continue_anyway\">Continue Anyway</string>\n     <string name=\"integrity_check_insufficient_space\">Check Database uses a large amount of temporary storage.\\n\\nIt is strongly recommended that you have at least %s free space on your device before continuing.</string>>\n     <string name=\"integrity_check_insufficient_space_extra_content\">\\n\\nYou currently have %s free.</string>\n+    <string name=\"integrity_check_fixed_no_home_deck\" >%d cards have been moved to the default deck. Please see the manual to locate them.</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c232d775250a6a1869d429da3c8eee06fffd1b5"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzg1MDk5", "url": "https://github.com/ankidroid/Anki-Android/pull/5949#pullrequestreview-390385099", "createdAt": "2020-04-08T22:53:35Z", "commit": {"oid": "ab42db81fd471627980d7e9688391a1df6db0265"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMjo1MzozNVrOGDDv6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMjo1MzozNVrOGDDv6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg2MDMzMA==", "bodyText": "this (int) worries me, but I hope it's not a realistic problem.", "url": "https://github.com/ankidroid/Anki-Android/pull/5949#discussion_r405860330", "createdAt": "2020-04-08T22:53:35Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -2386,4 +2352,49 @@ public void onPostExecute(TaskData result) {\n             }\n         });\n     }\n+\n+\n+    private class CheckDatabaseListener extends DeckTask.TaskListener {\n+        @Override\n+        public void onPreExecute() {\n+            mProgressDialog = StyledProgressDialog.show(DeckPicker.this, AnkiDroidApp.getAppResources().getString(R.string.app_name),\n+                    getResources().getString(R.string.check_db_message), false);\n+        }\n+\n+\n+        @Override\n+        public void onPostExecute(TaskData result) {\n+            if (mProgressDialog != null && mProgressDialog.isShowing()) {\n+                mProgressDialog.dismiss();\n+            }\n+            if (result != null && result.getBoolean() && result.getObjArray() != null && result.getObjArray().length > 0) {\n+                String msg;\n+                Collection.CheckDatabaseResult databaseResult = (Collection.CheckDatabaseResult) result.getObjArray()[0];\n+\n+                int count = databaseResult.getCardsWithFixedHomeDeckCount();\n+                if (count != 0) {\n+                    String message = getResources().getString(R.string.integrity_check_fixed_no_home_deck, count);\n+                    UIUtils.showThemedToast(DeckPicker.this,  message, false);\n+                }\n+\n+                long shrunkInMb = Math.round(databaseResult.getSizeChangeInKb() / 1024.0);\n+                if (shrunkInMb > 0.0) {\n+                    msg = String.format(Locale.getDefault(),\n+                    getResources().getString(R.string.check_db_acknowledge_shrunk), (int) shrunkInMb);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab42db81fd471627980d7e9688391a1df6db0265"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzg2MjAz", "url": "https://github.com/ankidroid/Anki-Android/pull/5949#pullrequestreview-390386203", "createdAt": "2020-04-08T22:56:26Z", "commit": {"oid": "ab42db81fd471627980d7e9688391a1df6db0265"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMjo1NjoyNlrOGDDz7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMjo1NjoyNlrOGDDz7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg2MTM1OQ==", "bodyText": "No longer used, but nice to have", "url": "https://github.com/ankidroid/Anki-Android/pull/5949#discussion_r405861359", "createdAt": "2020-04-08T22:56:26Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Consts.java", "diffHunk": "@@ -102,4 +102,6 @@\n     public static final int REVLOG_CRAM = 3;\n \n     // The labels defined in consts.py are in AnkiDroid's resources files.\n+\n+    public static final long DEFAULT_DECK_ID = 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab42db81fd471627980d7e9688391a1df6db0265"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODY4ODAw", "url": "https://github.com/ankidroid/Anki-Android/pull/5949#pullrequestreview-391868800", "createdAt": "2020-04-12T15:31:17Z", "commit": {"oid": "16ec68078b15b8a594dc00fe21dc21557f5166c5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxNTozMToxN1rOGEWY4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxNTo0MDoxNFrOGEWc5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIxNDMwNg==", "bodyText": "This seems like exactly what we discussed - can you add a quick chunk to the manual? A little blurb right around here should be perfect I think: https://github.com/ankidroid/ankidroiddocs/blob/master/manual.asc#L111", "url": "https://github.com/ankidroid/Anki-Android/pull/5949#discussion_r407214306", "createdAt": "2020-04-12T15:31:17Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -159,6 +159,8 @@\n     <string name=\"integrity_check_continue_anyway\">Continue Anyway</string>\n     <string name=\"integrity_check_insufficient_space\">Check Database uses a large amount of temporary storage.\\n\\nIt is strongly recommended that you have at least %s free space on your device before continuing.</string>>\n     <string name=\"integrity_check_insufficient_space_extra_content\">\\n\\nYou currently have %s free.</string>\n+    <string name=\"integrity_check_fixed_no_home_deck\">%d cards with incorrect home decks were recovered. Please see the manual for more information.</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16ec68078b15b8a594dc00fe21dc21557f5166c5"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIxNTMzMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    //Both of these cases can be fixed by setting the odid to 1.\n          \n          \n            \n                    // Both of these cases can be fixed by moving the decks to a known-good deck\n          \n          \n            \n                    // This fix will create a 'Recovered Cards' deck at top of deck list and move\n          \n          \n            \n                    // all cards in dynamic decks with no original deck id to this new deck\n          \n      \n    \n    \n  \n\nThat's a suggestion, but really it would be better as a javadoc at the top of the method", "url": "https://github.com/ankidroid/Anki-Android/pull/5949#discussion_r407215332", "createdAt": "2020-04-12T15:40:14Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1603,12 +1603,67 @@ public long fixIntegrity(DeckTask.ProgressCallback progressCallback) {\n         }\n         file = new File(mPath);\n         long newSize = file.length();\n+        result.setNewSize(newSize);\n         // if any problems were found, force a full sync\n-        if (problems.size() > 0) {\n+        if (result.hasProblems()) {\n             modSchemaNoCheck();\n         }\n-        logProblems(problems);\n-        return (oldSize - newSize) / 1024;\n+        logProblems(result.getProblems());\n+        return result;\n+    }\n+\n+\n+    private List<String> ensureCardsHaveHomeDeck(Runnable notifyProgress, CheckDatabaseResult result) {\n+        Timber.d(\"ensureCardsHaveHomeDeck()\");\n+        // #5932 - a card may not have a home deck if:\n+        // * It is in a dynamic deck, and has odid = 0.\n+        // * It is in a dynamic deck, and the odid refers to a dynamic deck.\n+        notifyProgress.run();\n+        //Both of these cases can be fixed by setting the odid to 1.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "16ec68078b15b8a594dc00fe21dc21557f5166c5"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTU2OTMx", "url": "https://github.com/ankidroid/Anki-Android/pull/5949#pullrequestreview-396556931", "createdAt": "2020-04-20T15:21:24Z", "commit": {"oid": "2b07e0ad315e90362310a67e356e655b76035e46"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e89d721a255d770bd6b74c448006e62e1ba7a62", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0e89d721a255d770bd6b74c448006e62e1ba7a62", "committedDate": "2020-04-20T15:27:03Z", "message": "Add integrity check: ensureCardsHaveHomeDeck\n\nThis fixes any occurrences of #5932 which have already occurred.\n\nAnd leaves a variable free to perform a notification with"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b81f633ca727b483d4ee6f2c389076d9d59b31a", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3b81f633ca727b483d4ee6f2c389076d9d59b31a", "committedDate": "2020-04-20T15:27:04Z", "message": "Update AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java\n\nCo-Authored-By: Mike Hardy <github@mikehardy.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc5154043a9d7bff068d8415ac7c4b223afda417", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/fc5154043a9d7bff068d8415ac7c4b223afda417", "committedDate": "2020-04-20T15:27:04Z", "message": "Update AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java\n\nCo-Authored-By: Mike Hardy <github@mikehardy.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "457e19770b279aaec77b1884d92e46da691b9bd0", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/457e19770b279aaec77b1884d92e46da691b9bd0", "committedDate": "2020-04-20T15:27:04Z", "message": "Update AnkiDroid/src/main/res/values/03-dialogs.xml\n\nCo-Authored-By: Mike Hardy <github@mikehardy.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3446536bc44fd189e3f0eb48bfab05220ada824", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f3446536bc44fd189e3f0eb48bfab05220ada824", "committedDate": "2020-04-20T15:27:05Z", "message": "Modified check to be database - only\n\nIt was too slow to perform the work individually, use the database to\nbatch it.\n\nWe move from tagging to creating a new deck and moving the cards there."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7e11b8ff2d038387763cd0b4cd022ca909aee69", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c7e11b8ff2d038387763cd0b4cd022ca909aee69", "committedDate": "2020-04-20T15:27:05Z", "message": "Add broken UI code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56020ceabc0f720e4e5653e95547cdd40f00259b", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/56020ceabc0f720e4e5653e95547cdd40f00259b", "committedDate": "2020-04-20T15:27:06Z", "message": "NF: Remove unused constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c48d63ff3b26f0cdfc5ba4ba1a2e9a77c72f9b6b", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c48d63ff3b26f0cdfc5ba4ba1a2e9a77c72f9b6b", "committedDate": "2020-04-20T15:27:06Z", "message": "Ensure changes are marked as syncable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c097f834bfcaaf9bc460e21813557b082ac9a98f", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c097f834bfcaaf9bc460e21813557b082ac9a98f", "committedDate": "2020-04-20T15:36:26Z", "message": "NF: Extract CheckDatabaseListener"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86a4a23d8b80457367ca4ada59f44797d2278db5", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/86a4a23d8b80457367ca4ada59f44797d2278db5", "committedDate": "2020-04-20T15:36:33Z", "message": "NF: Improve text for \"fixed home deck\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c12b596d4d05383270578d1ffac40a9a377e1029", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c12b596d4d05383270578d1ffac40a9a377e1029", "committedDate": "2020-04-20T15:43:18Z", "message": "Added Toast from fixIntegrity\n\nWe needed to display this on the UI thread, which meant feeding back the\nresult to the caller"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b61ac83a12c7efaa0689c0911cf4ece31bbef26", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/1b61ac83a12c7efaa0689c0911cf4ece31bbef26", "committedDate": "2020-04-20T15:43:23Z", "message": "Improve accuracy of getSizeChangeInKb\n\nWe no longer need to return -1 to signify failure, so we can improve the\nprecision of the variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42230175a4c52cead06edd48d0a1073453ca57bd", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/42230175a4c52cead06edd48d0a1073453ca57bd", "committedDate": "2020-04-20T15:43:23Z", "message": "Fix bug in representation of size reduction.\n\nWe were showing kB when we do bytes / 1024 / 1024"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4ef50ec5d4cd69fa1e5166ceebc68a6e3fd8610", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/b4ef50ec5d4cd69fa1e5166ceebc68a6e3fd8610", "committedDate": "2020-04-20T15:43:24Z", "message": "NF: Remove excess logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7128e0f1b7eb0921c10bb3b8ed8e8c62bdf7ac3b", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7128e0f1b7eb0921c10bb3b8ed8e8c62bdf7ac3b", "committedDate": "2020-04-20T15:43:24Z", "message": "NF: Improve string resource name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce508698ac58d7f8decaff6cd0d5620e41e1d02f", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ce508698ac58d7f8decaff6cd0d5620e41e1d02f", "committedDate": "2020-04-20T15:43:24Z", "message": "NF: Improve Comment & move to JavaDoc"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2b07e0ad315e90362310a67e356e655b76035e46", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2b07e0ad315e90362310a67e356e655b76035e46", "committedDate": "2020-04-19T17:34:09Z", "message": "NF: Improve Comment & move to JavaDoc"}, "afterCommit": {"oid": "ce508698ac58d7f8decaff6cd0d5620e41e1d02f", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ce508698ac58d7f8decaff6cd0d5620e41e1d02f", "committedDate": "2020-04-20T15:43:24Z", "message": "NF: Improve Comment & move to JavaDoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NjU1MTA2", "url": "https://github.com/ankidroid/Anki-Android/pull/5949#pullrequestreview-396655106", "createdAt": "2020-04-20T17:17:09Z", "commit": {"oid": "ce508698ac58d7f8decaff6cd0d5620e41e1d02f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3604, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}