{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzNTI0NTI0", "number": 7592, "title": "Import simplified", "bodyText": "Importing my main deck takes 6'24''. This PR' reduces it to 6'01''. Not exactly game changing, but still some noticeable progress.\nIt saves time by:\n\nAvoiding to query from the database some values that are never used\nAvoiding to convert multiple time between int/long and Int/Long (One last conversion is needed, because sql always takes Object[] which is actually a huge loss of time)\n\nAs a benefits, it becomes more clear, since instead of an array of Object, each variable has a readable name.\nIt was tested by importing back my deck in a fresk ankidroid collection and seeing that everythnig seems to be alright", "createdAt": "2020-11-01T01:35:16Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7592", "merged": true, "mergeCommit": {"oid": "a62b05daf51443dfc4c7f1fef02db65770bc79f9"}, "closed": true, "closedAt": "2020-11-09T19:37:37Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYUY8jAFqTUyMTI0ODI1OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABda6DYNgFqTUyNjU5MTczMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMjQ4MjU5", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#pullrequestreview-521248259", "createdAt": "2020-11-01T18:22:10Z", "commit": {"oid": "ef146fae50fca42eed94ce8dd0187d954c770dcc"}, "state": "COMMENTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQxODoyMjoxMFrOHrxC6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMVQxODozNDozNVrOHrxIQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1NDM3OQ==", "bodyText": "You don't need n. here", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515654379", "createdAt": "2020-11-01T18:22:10Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -217,7 +229,7 @@ private void _importNotes() {\n         int dupes = 0;\n         ArrayList<String> dupesIgnored = new ArrayList<>();\n         mDst.getDb().getDatabase().beginTransaction();\n-        try (Cursor cur = mSrc.getDb().getDatabase().query(\"select * from notes\", null)) {\n+        try (Cursor cur = mSrc.getDb().getDatabase().query(\"select n.id, n.guid, n.mid, n.mod, n.tags, n.flds, n.sfld, n.csum, n.flags, n.data  from notes n\", null)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef146fae50fca42eed94ce8dd0187d954c770dcc"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1NDQ3NQ==", "bodyText": "is private static final int GUID = 1; still used?", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515654475", "createdAt": "2020-11-01T18:23:30Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -71,7 +73,17 @@\n     private final boolean mAllowUpdate;\n     private boolean mDupeOnSchemaChange;\n \n-    private Map<String, Object[]> mNotes;\n+    private static class NoteTriple {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef146fae50fca42eed94ce8dd0187d954c770dcc"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1NDkzMg==", "bodyText": "Use a char here - should be much faster (needs testing)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                                    flds.replace(\"\\u001f\", \",\")));\n          \n          \n            \n                                                    flds.replace('\\u001f', ',')));", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515654932", "createdAt": "2020-11-01T18:27:19Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -226,48 +238,55 @@ private void _importNotes() {\n \n             while (cur.moveToNext()) {\n                 // turn the db result into a mutable list\n-                Object[] note = new Object[]{cur.getLong(0), cur.getString(1), cur.getLong(2),\n-                        cur.getLong(3), cur.getInt(4), cur.getString(5), cur.getString(6),\n-                        cur.getString(7), cur.getLong(8), cur.getInt(9), cur.getString(10)};\n-                boolean shouldAdd = _uniquifyNote(note);\n+                long id = cur.getLong(0);\n+                String guid = cur.getString(1);\n+                long mid = cur.getLong(2);\n+                long mod = cur.getLong(3);\n+                String tags = cur.getString(4);\n+                String flds = cur.getString(5);\n+                String sfld = cur.getString(6);\n+                long csum = cur.getLong(7);\n+                int flag = cur.getInt(8);\n+                String data = cur.getString(9);\n+\n+                Pair<Boolean, Long> shouldAddAndNewMid = _uniquifyNote(guid, mid);\n+                boolean shouldAdd = shouldAddAndNewMid.first;\n+                mid = shouldAddAndNewMid.second;\n                 if (shouldAdd) {\n                     // ensure id is unique\n-                    while (existing.contains(note[0])) {\n-                        note[0] = ((Long) note[0]) + 999;\n+                    while (existing.contains(id)) {\n+                        id += 999;\n                     }\n-                    existing.add((Long) note[0]);\n+                    existing.add(id);\n                     // bump usn\n-                    note[4] = usn;\n                     // update media references in case of dupes\n-                    note[6] = _mungeMedia((Long) note[MID], (String) note[6]);\n-                    add.add(note);\n-                    dirty.add((Long) note[0]);\n+                    flds = _mungeMedia(mid, flds);\n+                    add.add(new Object[]{id, guid, mid, mod, usn, tags, flds, sfld, csum, flag, data});\n+                    dirty.add(id);\n                     // note we have the added guid\n-                    mNotes.put((String) note[GUID], new Object[]{note[0], note[3], note[MID]});\n+                    mNotes.put(guid, new NoteTriple(id, mod, mid));\n                 } else {\n                     // a duplicate or changed schema - safe to update?\n                     dupes += 1;\n                     if (mAllowUpdate) {\n-                        Object[] n = mNotes.get(note[GUID]);\n-                        //todo: oldNid could be Long instead of long.\n-                        long oldNid = (Long) n[0];\n-                        long oldMod = (Long) n[1];\n-                        @NonNull Long oldMid = (Long) n[2];\n+                        NoteTriple n = mNotes.get(guid);\n+                        long oldNid = n.mNid;\n+                        long oldMod = n.mMod;\n+                        long oldMid = n.mMid;\n                         // will update if incoming note more recent\n-                        if (oldMod < (Long) note[MOD]) {\n+                        if (oldMod < mod) {\n                             // safe if note types identical\n-                            if (Utils.equals(oldMid, note[MID])) {\n+                            if (Utils.equals(oldMid, mid)) {\n                                 // incoming note should use existing id\n-                                note[0] = oldNid;\n-                                note[4] = usn;\n-                                note[6] = _mungeMedia((Long) note[MID], (String) note[6]);\n-                                update.add(note);\n-                                dirty.add((Long) note[0]);\n+                                id = oldNid;\n+                                flds = _mungeMedia(mid, flds);\n+                                update.add(new Object[]{id, guid, mid, mod, usn, tags, flds, sfld, csum, flag, data});\n+                                dirty.add(id);\n                             } else {\n                                 dupesIgnored.add(String.format(\"%s: %s\",\n                                         mCol.getModels().get(oldMid).getString(\"name\"),\n-                                        ((String) note[6]).replace(\"\\u001f\", \",\")));\n-                                mIgnoredGuids.put((String) note[GUID], true);\n+                                        flds.replace(\"\\u001f\", \",\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef146fae50fca42eed94ce8dd0187d954c770dcc"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1NDk4Mw==", "bodyText": "I'd prefer nid here, but implementer's choice", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515654983", "createdAt": "2020-11-01T18:27:49Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -226,48 +238,55 @@ private void _importNotes() {\n \n             while (cur.moveToNext()) {\n                 // turn the db result into a mutable list\n-                Object[] note = new Object[]{cur.getLong(0), cur.getString(1), cur.getLong(2),\n-                        cur.getLong(3), cur.getInt(4), cur.getString(5), cur.getString(6),\n-                        cur.getString(7), cur.getLong(8), cur.getInt(9), cur.getString(10)};\n-                boolean shouldAdd = _uniquifyNote(note);\n+                long id = cur.getLong(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef146fae50fca42eed94ce8dd0187d954c770dcc"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1NTE1Ng==", "bodyText": "Reviewer note: note[4] = usn; is missing, but this is OK as we use the correct value", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515655156", "createdAt": "2020-11-01T18:29:31Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -226,48 +238,55 @@ private void _importNotes() {\n \n             while (cur.moveToNext()) {\n                 // turn the db result into a mutable list\n-                Object[] note = new Object[]{cur.getLong(0), cur.getString(1), cur.getLong(2),\n-                        cur.getLong(3), cur.getInt(4), cur.getString(5), cur.getString(6),\n-                        cur.getString(7), cur.getLong(8), cur.getInt(9), cur.getString(10)};\n-                boolean shouldAdd = _uniquifyNote(note);\n+                long id = cur.getLong(0);\n+                String guid = cur.getString(1);\n+                long mid = cur.getLong(2);\n+                long mod = cur.getLong(3);\n+                String tags = cur.getString(4);\n+                String flds = cur.getString(5);\n+                String sfld = cur.getString(6);\n+                long csum = cur.getLong(7);\n+                int flag = cur.getInt(8);\n+                String data = cur.getString(9);\n+\n+                Pair<Boolean, Long> shouldAddAndNewMid = _uniquifyNote(guid, mid);\n+                boolean shouldAdd = shouldAddAndNewMid.first;\n+                mid = shouldAddAndNewMid.second;\n                 if (shouldAdd) {\n                     // ensure id is unique\n-                    while (existing.contains(note[0])) {\n-                        note[0] = ((Long) note[0]) + 999;\n+                    while (existing.contains(id)) {\n+                        id += 999;\n                     }\n-                    existing.add((Long) note[0]);\n+                    existing.add(id);\n                     // bump usn\n-                    note[4] = usn;\n                     // update media references in case of dupes\n-                    note[6] = _mungeMedia((Long) note[MID], (String) note[6]);\n-                    add.add(note);\n-                    dirty.add((Long) note[0]);\n+                    flds = _mungeMedia(mid, flds);\n+                    add.add(new Object[]{id, guid, mid, mod, usn, tags, flds, sfld, csum, flag, data});\n+                    dirty.add(id);\n                     // note we have the added guid\n-                    mNotes.put((String) note[GUID], new Object[]{note[0], note[3], note[MID]});\n+                    mNotes.put(guid, new NoteTriple(id, mod, mid));\n                 } else {\n                     // a duplicate or changed schema - safe to update?\n                     dupes += 1;\n                     if (mAllowUpdate) {\n-                        Object[] n = mNotes.get(note[GUID]);\n-                        //todo: oldNid could be Long instead of long.\n-                        long oldNid = (Long) n[0];\n-                        long oldMod = (Long) n[1];\n-                        @NonNull Long oldMid = (Long) n[2];\n+                        NoteTriple n = mNotes.get(guid);\n+                        long oldNid = n.mNid;\n+                        long oldMod = n.mMod;\n+                        long oldMid = n.mMid;\n                         // will update if incoming note more recent\n-                        if (oldMod < (Long) note[MOD]) {\n+                        if (oldMod < mod) {\n                             // safe if note types identical\n-                            if (Utils.equals(oldMid, note[MID])) {\n+                            if (Utils.equals(oldMid, mid)) {\n                                 // incoming note should use existing id\n-                                note[0] = oldNid;\n-                                note[4] = usn;\n-                                note[6] = _mungeMedia((Long) note[MID], (String) note[6]);\n-                                update.add(note);\n-                                dirty.add((Long) note[0]);\n+                                id = oldNid;\n+                                flds = _mungeMedia(mid, flds);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef146fae50fca42eed94ce8dd0187d954c770dcc"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1NTQ3MQ==", "bodyText": "much nicer!", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515655471", "createdAt": "2020-11-01T18:32:01Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -532,7 +548,7 @@ private void _importCards() {\n         try {\n             mDst.getDb().getDatabase().beginTransaction();\n             cur = mSrc.getDb().getDatabase().query(\n-                    \"select f.guid, f.mid, c.* from cards c, notes f \" +\n+                    \"select f.guid, c.id, c.did, c.ord, c.type, c.queue, c.due, c.ivl, c.factor, c.reps, c.lapses, c.left, c.odue, c.odid, c.flags, c.data from cards c, notes f \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef146fae50fca42eed94ce8dd0187d954c770dcc"}, "originalPosition": 169}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1NTUyMA==", "bodyText": "What's a scid?", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515655520", "createdAt": "2020-11-01T18:32:24Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -542,74 +558,78 @@ private void _importCards() {\n             int i = 0;\n \n             while (cur.moveToNext()) {\n-                Object[] card = new Object[] { cur.getString(0), cur.getLong(1), cur.getLong(2),\n-                        cur.getLong(3), cur.getLong(4), cur.getInt(5), cur.getLong(6), cur.getInt(7),\n-                        cur.getInt(8), cur.getInt(9), cur.getLong(10), cur.getLong(11), cur.getLong(12),\n-                        cur.getInt(13), cur.getInt(14), cur.getInt(15), cur.getLong(16),\n-                        cur.getLong(17), cur.getInt(18), cur.getString(19) };\n-                String guid = (String) card[0];\n+                String guid = cur.getString(0);\n+                long scid = cur.getLong(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef146fae50fca42eed94ce8dd0187d954c770dcc"}, "originalPosition": 184}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1NTU2MQ==", "bodyText": "Use the constants", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515655561", "createdAt": "2020-11-01T18:32:56Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -542,74 +558,78 @@ private void _importCards() {\n             int i = 0;\n \n             while (cur.moveToNext()) {\n-                Object[] card = new Object[] { cur.getString(0), cur.getLong(1), cur.getLong(2),\n-                        cur.getLong(3), cur.getLong(4), cur.getInt(5), cur.getLong(6), cur.getInt(7),\n-                        cur.getInt(8), cur.getInt(9), cur.getLong(10), cur.getLong(11), cur.getLong(12),\n-                        cur.getInt(13), cur.getInt(14), cur.getInt(15), cur.getLong(16),\n-                        cur.getLong(17), cur.getInt(18), cur.getString(19) };\n-                String guid = (String) card[0];\n+                String guid = cur.getString(0);\n+                long scid = cur.getLong(1);\n+                long did = cur.getLong(2);\n+                int ord = cur.getInt(3);\n+                @Consts.CARD_TYPE int type = cur.getInt(4);\n+                @Consts.CARD_QUEUE int queue = cur.getInt(5);\n+                long due = cur.getLong(6);\n+                long ivl = cur.getLong(7);\n+                long factor = cur.getLong(8);\n+                int reps = cur.getInt(9);\n+                int lapses = cur.getInt(10);\n+                int left = cur.getInt(11);\n+                long odue = cur.getLong(12);\n+                long odid = cur.getLong(13);\n+                int flags = cur.getInt(14);\n+                String data = cur.getString(15);\n+\n                 if (mIgnoredGuids.containsKey(guid)) {\n                     continue;\n                 }\n                 // does the card's note exist in dst col?\n                 if (!mNotes.containsKey(guid)) {\n                     continue;\n                 }\n-                Object[] dnid = mNotes.get(guid);\n+                NoteTriple dnid = mNotes.get(guid);\n                 // does the card already exist in the dst col?\n-                int ord = (Integer) card[5];\n                 if (mCards.containsKey(guid) && mCards.get(guid).containsKey(ord)) {\n                     // fixme: in future, could update if newer mod time\n                     continue;\n                 }\n-                // doesn't exist. strip off note info, and save src id for later\n-                Object[] oc = card;\n-                card = new Object[oc.length - 2];\n-                System.arraycopy(oc, 2, card, 0, card.length);\n-                long scid = (Long) card[0];\n                 // ensure the card id is unique\n-                while (existing.containsKey(card[0])) {\n-                    card[0] = (Long) card[0] + 999;\n+                while (existing.containsKey(scid)) {\n+                    scid += 999;\n                 }\n-                existing.put((Long) card[0], true);\n+                existing.put(scid, true);\n                 // update cid, nid, etc\n-                card[1] = mNotes.get(guid)[0];\n-                card[2] = _did((Long) card[2]);\n-                card[4] = mCol.getTime().intTime();\n-                card[5] = usn;\n+                long nid = mNotes.get(guid).mNid;\n+                did = _did(did);\n+                long mod = mCol.getTime().intTime();\n                 // review cards have a due date relative to collection\n-                if ((Integer) card[7] == 2 || (Integer) card[7] == 3 || (Integer) card[6] == 2) {\n-                    card[8] = (Long) card[8] - aheadBy;\n+                if (queue == 2 || queue == 3 || type == 2) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef146fae50fca42eed94ce8dd0187d954c770dcc"}, "originalPosition": 239}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1NTU3Mw==", "bodyText": "ditto", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515655573", "createdAt": "2020-11-01T18:33:09Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -542,74 +558,78 @@ private void _importCards() {\n             int i = 0;\n \n             while (cur.moveToNext()) {\n-                Object[] card = new Object[] { cur.getString(0), cur.getLong(1), cur.getLong(2),\n-                        cur.getLong(3), cur.getLong(4), cur.getInt(5), cur.getLong(6), cur.getInt(7),\n-                        cur.getInt(8), cur.getInt(9), cur.getLong(10), cur.getLong(11), cur.getLong(12),\n-                        cur.getInt(13), cur.getInt(14), cur.getInt(15), cur.getLong(16),\n-                        cur.getLong(17), cur.getInt(18), cur.getString(19) };\n-                String guid = (String) card[0];\n+                String guid = cur.getString(0);\n+                long scid = cur.getLong(1);\n+                long did = cur.getLong(2);\n+                int ord = cur.getInt(3);\n+                @Consts.CARD_TYPE int type = cur.getInt(4);\n+                @Consts.CARD_QUEUE int queue = cur.getInt(5);\n+                long due = cur.getLong(6);\n+                long ivl = cur.getLong(7);\n+                long factor = cur.getLong(8);\n+                int reps = cur.getInt(9);\n+                int lapses = cur.getInt(10);\n+                int left = cur.getInt(11);\n+                long odue = cur.getLong(12);\n+                long odid = cur.getLong(13);\n+                int flags = cur.getInt(14);\n+                String data = cur.getString(15);\n+\n                 if (mIgnoredGuids.containsKey(guid)) {\n                     continue;\n                 }\n                 // does the card's note exist in dst col?\n                 if (!mNotes.containsKey(guid)) {\n                     continue;\n                 }\n-                Object[] dnid = mNotes.get(guid);\n+                NoteTriple dnid = mNotes.get(guid);\n                 // does the card already exist in the dst col?\n-                int ord = (Integer) card[5];\n                 if (mCards.containsKey(guid) && mCards.get(guid).containsKey(ord)) {\n                     // fixme: in future, could update if newer mod time\n                     continue;\n                 }\n-                // doesn't exist. strip off note info, and save src id for later\n-                Object[] oc = card;\n-                card = new Object[oc.length - 2];\n-                System.arraycopy(oc, 2, card, 0, card.length);\n-                long scid = (Long) card[0];\n                 // ensure the card id is unique\n-                while (existing.containsKey(card[0])) {\n-                    card[0] = (Long) card[0] + 999;\n+                while (existing.containsKey(scid)) {\n+                    scid += 999;\n                 }\n-                existing.put((Long) card[0], true);\n+                existing.put(scid, true);\n                 // update cid, nid, etc\n-                card[1] = mNotes.get(guid)[0];\n-                card[2] = _did((Long) card[2]);\n-                card[4] = mCol.getTime().intTime();\n-                card[5] = usn;\n+                long nid = mNotes.get(guid).mNid;\n+                did = _did(did);\n+                long mod = mCol.getTime().intTime();\n                 // review cards have a due date relative to collection\n-                if ((Integer) card[7] == 2 || (Integer) card[7] == 3 || (Integer) card[6] == 2) {\n-                    card[8] = (Long) card[8] - aheadBy;\n+                if (queue == 2 || queue == 3 || type == 2) {\n+                    due -= aheadBy;\n                 }\n                 // odue needs updating too\n-                if ((Long) card[14] != 0) {\n-                    card[14] = (Long) card[14] - aheadBy;\n+                if (odue != 0) {\n+                    odue -= aheadBy;\n                 }\n                 // if odid true, convert card from filtered to normal\n-                if ((Long) card[15] != 0) {\n+                if (odid != 0) {\n                     // odid\n-                    card[15] = 0;\n+                    odid = 0;\n                     // odue\n-                    card[8] = card[14];\n-                    card[14] = 0;\n+                    due = odue;\n+                    odue = 0;\n                     // queue\n-                    if ((Integer) card[6] == 1) { // type\n-                        card[7] = 0;\n+                    if (type == 1) { // type", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef146fae50fca42eed94ce8dd0187d954c770dcc"}, "originalPosition": 262}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1NTU4NA==", "bodyText": "ditto", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515655584", "createdAt": "2020-11-01T18:33:15Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -542,74 +558,78 @@ private void _importCards() {\n             int i = 0;\n \n             while (cur.moveToNext()) {\n-                Object[] card = new Object[] { cur.getString(0), cur.getLong(1), cur.getLong(2),\n-                        cur.getLong(3), cur.getLong(4), cur.getInt(5), cur.getLong(6), cur.getInt(7),\n-                        cur.getInt(8), cur.getInt(9), cur.getLong(10), cur.getLong(11), cur.getLong(12),\n-                        cur.getInt(13), cur.getInt(14), cur.getInt(15), cur.getLong(16),\n-                        cur.getLong(17), cur.getInt(18), cur.getString(19) };\n-                String guid = (String) card[0];\n+                String guid = cur.getString(0);\n+                long scid = cur.getLong(1);\n+                long did = cur.getLong(2);\n+                int ord = cur.getInt(3);\n+                @Consts.CARD_TYPE int type = cur.getInt(4);\n+                @Consts.CARD_QUEUE int queue = cur.getInt(5);\n+                long due = cur.getLong(6);\n+                long ivl = cur.getLong(7);\n+                long factor = cur.getLong(8);\n+                int reps = cur.getInt(9);\n+                int lapses = cur.getInt(10);\n+                int left = cur.getInt(11);\n+                long odue = cur.getLong(12);\n+                long odid = cur.getLong(13);\n+                int flags = cur.getInt(14);\n+                String data = cur.getString(15);\n+\n                 if (mIgnoredGuids.containsKey(guid)) {\n                     continue;\n                 }\n                 // does the card's note exist in dst col?\n                 if (!mNotes.containsKey(guid)) {\n                     continue;\n                 }\n-                Object[] dnid = mNotes.get(guid);\n+                NoteTriple dnid = mNotes.get(guid);\n                 // does the card already exist in the dst col?\n-                int ord = (Integer) card[5];\n                 if (mCards.containsKey(guid) && mCards.get(guid).containsKey(ord)) {\n                     // fixme: in future, could update if newer mod time\n                     continue;\n                 }\n-                // doesn't exist. strip off note info, and save src id for later\n-                Object[] oc = card;\n-                card = new Object[oc.length - 2];\n-                System.arraycopy(oc, 2, card, 0, card.length);\n-                long scid = (Long) card[0];\n                 // ensure the card id is unique\n-                while (existing.containsKey(card[0])) {\n-                    card[0] = (Long) card[0] + 999;\n+                while (existing.containsKey(scid)) {\n+                    scid += 999;\n                 }\n-                existing.put((Long) card[0], true);\n+                existing.put(scid, true);\n                 // update cid, nid, etc\n-                card[1] = mNotes.get(guid)[0];\n-                card[2] = _did((Long) card[2]);\n-                card[4] = mCol.getTime().intTime();\n-                card[5] = usn;\n+                long nid = mNotes.get(guid).mNid;\n+                did = _did(did);\n+                long mod = mCol.getTime().intTime();\n                 // review cards have a due date relative to collection\n-                if ((Integer) card[7] == 2 || (Integer) card[7] == 3 || (Integer) card[6] == 2) {\n-                    card[8] = (Long) card[8] - aheadBy;\n+                if (queue == 2 || queue == 3 || type == 2) {\n+                    due -= aheadBy;\n                 }\n                 // odue needs updating too\n-                if ((Long) card[14] != 0) {\n-                    card[14] = (Long) card[14] - aheadBy;\n+                if (odue != 0) {\n+                    odue -= aheadBy;\n                 }\n                 // if odid true, convert card from filtered to normal\n-                if ((Long) card[15] != 0) {\n+                if (odid != 0) {\n                     // odid\n-                    card[15] = 0;\n+                    odid = 0;\n                     // odue\n-                    card[8] = card[14];\n-                    card[14] = 0;\n+                    due = odue;\n+                    odue = 0;\n                     // queue\n-                    if ((Integer) card[6] == 1) { // type\n-                        card[7] = 0;\n+                    if (type == 1) { // type\n+                        queue = 0;\n                     } else {\n-                        card[7] = card[6];\n+                        queue = type;\n                     }\n                     // type\n-                    if ((Integer) card[6] == 1) {\n-                        card[6] = 0;\n+                    if (type == 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef146fae50fca42eed94ce8dd0187d954c770dcc"}, "originalPosition": 271}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1NTc0Nw==", "bodyText": "Needs second review - looks correct, but there's a lot going on here.", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515655747", "createdAt": "2020-11-01T18:34:35Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -542,74 +558,78 @@ private void _importCards() {\n             int i = 0;\n \n             while (cur.moveToNext()) {\n-                Object[] card = new Object[] { cur.getString(0), cur.getLong(1), cur.getLong(2),\n-                        cur.getLong(3), cur.getLong(4), cur.getInt(5), cur.getLong(6), cur.getInt(7),\n-                        cur.getInt(8), cur.getInt(9), cur.getLong(10), cur.getLong(11), cur.getLong(12),\n-                        cur.getInt(13), cur.getInt(14), cur.getInt(15), cur.getLong(16),\n-                        cur.getLong(17), cur.getInt(18), cur.getString(19) };\n-                String guid = (String) card[0];\n+                String guid = cur.getString(0);\n+                long scid = cur.getLong(1);\n+                long did = cur.getLong(2);\n+                int ord = cur.getInt(3);\n+                @Consts.CARD_TYPE int type = cur.getInt(4);\n+                @Consts.CARD_QUEUE int queue = cur.getInt(5);\n+                long due = cur.getLong(6);\n+                long ivl = cur.getLong(7);\n+                long factor = cur.getLong(8);\n+                int reps = cur.getInt(9);\n+                int lapses = cur.getInt(10);\n+                int left = cur.getInt(11);\n+                long odue = cur.getLong(12);\n+                long odid = cur.getLong(13);\n+                int flags = cur.getInt(14);\n+                String data = cur.getString(15);\n+\n                 if (mIgnoredGuids.containsKey(guid)) {\n                     continue;\n                 }\n                 // does the card's note exist in dst col?\n                 if (!mNotes.containsKey(guid)) {\n                     continue;\n                 }\n-                Object[] dnid = mNotes.get(guid);\n+                NoteTriple dnid = mNotes.get(guid);\n                 // does the card already exist in the dst col?\n-                int ord = (Integer) card[5];\n                 if (mCards.containsKey(guid) && mCards.get(guid).containsKey(ord)) {\n                     // fixme: in future, could update if newer mod time\n                     continue;\n                 }\n-                // doesn't exist. strip off note info, and save src id for later\n-                Object[] oc = card;\n-                card = new Object[oc.length - 2];\n-                System.arraycopy(oc, 2, card, 0, card.length);\n-                long scid = (Long) card[0];\n                 // ensure the card id is unique\n-                while (existing.containsKey(card[0])) {\n-                    card[0] = (Long) card[0] + 999;\n+                while (existing.containsKey(scid)) {\n+                    scid += 999;\n                 }\n-                existing.put((Long) card[0], true);\n+                existing.put(scid, true);\n                 // update cid, nid, etc\n-                card[1] = mNotes.get(guid)[0];\n-                card[2] = _did((Long) card[2]);\n-                card[4] = mCol.getTime().intTime();\n-                card[5] = usn;\n+                long nid = mNotes.get(guid).mNid;\n+                did = _did(did);\n+                long mod = mCol.getTime().intTime();\n                 // review cards have a due date relative to collection\n-                if ((Integer) card[7] == 2 || (Integer) card[7] == 3 || (Integer) card[6] == 2) {\n-                    card[8] = (Long) card[8] - aheadBy;\n+                if (queue == 2 || queue == 3 || type == 2) {\n+                    due -= aheadBy;\n                 }\n                 // odue needs updating too\n-                if ((Long) card[14] != 0) {\n-                    card[14] = (Long) card[14] - aheadBy;\n+                if (odue != 0) {\n+                    odue -= aheadBy;\n                 }\n                 // if odid true, convert card from filtered to normal\n-                if ((Long) card[15] != 0) {\n+                if (odid != 0) {\n                     // odid\n-                    card[15] = 0;\n+                    odid = 0;\n                     // odue\n-                    card[8] = card[14];\n-                    card[14] = 0;\n+                    due = odue;\n+                    odue = 0;\n                     // queue\n-                    if ((Integer) card[6] == 1) { // type\n-                        card[7] = 0;\n+                    if (type == 1) { // type\n+                        queue = 0;\n                     } else {\n-                        card[7] = card[6];\n+                        queue = type;\n                     }\n                     // type\n-                    if ((Integer) card[6] == 1) {\n-                        card[6] = 0;\n+                    if (type == 1) {\n+                        type = 0;\n                     }\n                 }\n-                cards.add(card);\n+                cards.add(new Object[]{scid, nid, did, ord, mod, usn, type, queue, due, ivl, factor, reps, lapses, left, odue, odid, flags, data});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef146fae50fca42eed94ce8dd0187d954c770dcc"}, "originalPosition": 276}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef146fae50fca42eed94ce8dd0187d954c770dcc", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ef146fae50fca42eed94ce8dd0187d954c770dcc", "committedDate": "2020-11-01T01:23:20Z", "message": "NF: object to save note data"}, "afterCommit": {"oid": "27c70cd85eb7e289f319607b3ddda376f422739c", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/27c70cd85eb7e289f319607b3ddda376f422739c", "committedDate": "2020-11-02T00:38:57Z", "message": "NF: object to save note data"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "27c70cd85eb7e289f319607b3ddda376f422739c", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/27c70cd85eb7e289f319607b3ddda376f422739c", "committedDate": "2020-11-02T00:38:57Z", "message": "NF: object to save note data"}, "afterCommit": {"oid": "3374077c1da1e06edd372cb1c8ccc0f2df96fa1e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3374077c1da1e06edd372cb1c8ccc0f2df96fa1e", "committedDate": "2020-11-02T00:39:35Z", "message": "NF: object to save note data"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMjk3MDAx", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#pullrequestreview-521297001", "createdAt": "2020-11-02T02:17:10Z", "commit": {"oid": "3374077c1da1e06edd372cb1c8ccc0f2df96fa1e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwMjoxNzoxMFrOHr0dpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwMjoxNzoxMFrOHr0dpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTcxMDM3Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            g                    mNotes.put(guid, new NoteTriple(nid, mod, mid));\n          \n          \n            \n                                 mNotes.put(guid, new NoteTriple(nid, mod, mid));", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515710373", "createdAt": "2020-11-02T02:17:10Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -233,48 +244,55 @@ private void _importNotes() {\n \n             while (cur.moveToNext()) {\n                 // turn the db result into a mutable list\n-                Object[] note = new Object[]{cur.getLong(0), cur.getString(1), cur.getLong(2),\n-                        cur.getLong(3), cur.getInt(4), cur.getString(5), cur.getString(6),\n-                        cur.getString(7), cur.getLong(8), cur.getInt(9), cur.getString(10)};\n-                boolean shouldAdd = _uniquifyNote(note);\n+                long nid = cur.getLong(0);\n+                String guid = cur.getString(1);\n+                long mid = cur.getLong(2);\n+                long mod = cur.getLong(3);\n+                String tags = cur.getString(4);\n+                String flds = cur.getString(5);\n+                String sfld = cur.getString(6);\n+                long csum = cur.getLong(7);\n+                int flag = cur.getInt(8);\n+                String data = cur.getString(9);\n+\n+                Pair<Boolean, Long> shouldAddAndNewMid = _uniquifyNote(guid, mid);\n+                boolean shouldAdd = shouldAddAndNewMid.first;\n+                mid = shouldAddAndNewMid.second;\n                 if (shouldAdd) {\n-                    // ensure id is unique\n-                    while (existing.contains(note[0])) {\n-                        note[0] = ((Long) note[0]) + 999;\n+                    // ensure nid is unique\n+                    while (existing.contains(nid)) {\n+                        nid += 999;\n                     }\n-                    existing.add((Long) note[0]);\n+                    existing.add(nid);\n                     // bump usn\n-                    note[4] = usn;\n                     // update media references in case of dupes\n-                    note[6] = _mungeMedia((Long) note[MID], (String) note[6]);\n-                    add.add(note);\n-                    dirty.add((Long) note[0]);\n+                    flds = _mungeMedia(mid, flds);\n+                    add.add(new Object[]{nid, guid, mid, mod, usn, tags, flds, sfld, csum, flag, data});\n+                    dirty.add(nid);\n                     // note we have the added guid\n-                    mNotes.put((String) note[GUID], new Object[]{note[0], note[3], note[MID]});\n+g                    mNotes.put(guid, new NoteTriple(nid, mod, mid));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3374077c1da1e06edd372cb1c8ccc0f2df96fa1e"}, "originalPosition": 104}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3374077c1da1e06edd372cb1c8ccc0f2df96fa1e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3374077c1da1e06edd372cb1c8ccc0f2df96fa1e", "committedDate": "2020-11-02T00:39:35Z", "message": "NF: object to save note data"}, "afterCommit": {"oid": "264763ca0659a2b7b04dee352af9f0f35d2c0c5e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/264763ca0659a2b7b04dee352af9f0f35d2c0c5e", "committedDate": "2020-11-02T03:23:32Z", "message": "NF: object to save note data"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "264763ca0659a2b7b04dee352af9f0f35d2c0c5e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/264763ca0659a2b7b04dee352af9f0f35d2c0c5e", "committedDate": "2020-11-02T03:23:32Z", "message": "NF: object to save note data"}, "afterCommit": {"oid": "25276abc73022a0968211e55eec9e91f6155c3e5", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/25276abc73022a0968211e55eec9e91f6155c3e5", "committedDate": "2020-11-02T05:28:45Z", "message": "NF: object to save note data"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "25276abc73022a0968211e55eec9e91f6155c3e5", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/25276abc73022a0968211e55eec9e91f6155c3e5", "committedDate": "2020-11-02T05:28:45Z", "message": "NF: object to save note data"}, "afterCommit": {"oid": "47624e718804198f11318052b2e24bacfdb027be", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/47624e718804198f11318052b2e24bacfdb027be", "committedDate": "2020-11-02T09:27:04Z", "message": "NF: Long -> long"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNDY5MDk0", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#pullrequestreview-521469094", "createdAt": "2020-11-02T09:42:22Z", "commit": {"oid": "47624e718804198f11318052b2e24bacfdb027be"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOTo0MjoyMlrOHr83JQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwOTo0MjoyMlrOHr83JQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTg0Nzk3Mw==", "bodyText": "Are these two used?", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515847973", "createdAt": "2020-11-02T09:42:22Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -68,7 +70,6 @@\n         \"PMD.SwitchStmtsShouldHaveDefault\",\"PMD.CollapsibleIfStatements\",\"PMD.EmptyIfStmt\"})\n public class Anki2Importer extends Importer {\n \n-    private static final int GUID = 1;\n     private static final int MID = 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47624e718804198f11318052b2e24bacfdb027be"}, "originalPosition": 21}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "47624e718804198f11318052b2e24bacfdb027be", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/47624e718804198f11318052b2e24bacfdb027be", "committedDate": "2020-11-02T09:27:04Z", "message": "NF: Long -> long"}, "afterCommit": {"oid": "a414ae9914b734a8c03216b67a401f93388c57da", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a414ae9914b734a8c03216b67a401f93388c57da", "committedDate": "2020-11-02T11:16:20Z", "message": "NF: Long -> long"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNTUzNzA1", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#pullrequestreview-521553705", "createdAt": "2020-11-02T11:38:54Z", "commit": {"oid": "a414ae9914b734a8c03216b67a401f93388c57da"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMTozODo1NFrOHsA6Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMTozODo1NFrOHsA6Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTkxNDI3OA==", "bodyText": "?", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515914278", "createdAt": "2020-11-02T11:38:54Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Utils.java", "diffHunk": "@@ -435,7 +435,7 @@ public static String ids2str(JSONArray ids) {\n                         str.append(ids.getLong(i)).append(\",\");\n                     }\n                 } catch (JSONException e) {\n-                    Timber.e(e, \"ids2str :: JSONException\");\n+                    Timber.e(e, \"MIids2str :: JSONException\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a414ae9914b734a8c03216b67a401f93388c57da"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNTU0MDMx", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#pullrequestreview-521554031", "createdAt": "2020-11-02T11:39:22Z", "commit": {"oid": "a414ae9914b734a8c03216b67a401f93388c57da"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMTozOToyMlrOHsA7FA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxMTozOToyMlrOHsA7FA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTkxNDUxNg==", "bodyText": "a comment might be useful", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r515914516", "createdAt": "2020-11-02T11:39:22Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -542,74 +558,78 @@ private void _importCards() {\n             int i = 0;\n \n             while (cur.moveToNext()) {\n-                Object[] card = new Object[] { cur.getString(0), cur.getLong(1), cur.getLong(2),\n-                        cur.getLong(3), cur.getLong(4), cur.getInt(5), cur.getLong(6), cur.getInt(7),\n-                        cur.getInt(8), cur.getInt(9), cur.getLong(10), cur.getLong(11), cur.getLong(12),\n-                        cur.getInt(13), cur.getInt(14), cur.getInt(15), cur.getLong(16),\n-                        cur.getLong(17), cur.getInt(18), cur.getString(19) };\n-                String guid = (String) card[0];\n+                String guid = cur.getString(0);\n+                long scid = cur.getLong(1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY1NTUyMA=="}, "originalCommit": {"oid": "ef146fae50fca42eed94ce8dd0187d954c770dcc"}, "originalPosition": 184}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a414ae9914b734a8c03216b67a401f93388c57da", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a414ae9914b734a8c03216b67a401f93388c57da", "committedDate": "2020-11-02T11:16:20Z", "message": "NF: Long -> long"}, "afterCommit": {"oid": "7f03c669f4a732abe75c4bbe2400dd392b5c7354", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7f03c669f4a732abe75c4bbe2400dd392b5c7354", "committedDate": "2020-11-02T11:54:02Z", "message": "NF: Long -> long"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNzQxNDA4", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#pullrequestreview-522741408", "createdAt": "2020-11-03T17:49:18Z", "commit": {"oid": "7f03c669f4a732abe75c4bbe2400dd392b5c7354"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f03c669f4a732abe75c4bbe2400dd392b5c7354", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7f03c669f4a732abe75c4bbe2400dd392b5c7354", "committedDate": "2020-11-02T11:54:02Z", "message": "NF: Long -> long"}, "afterCommit": {"oid": "0d85154ba8ac29c7fd5ee9da8051c11ae6d11124", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0d85154ba8ac29c7fd5ee9da8051c11ae6d11124", "committedDate": "2020-11-03T18:07:00Z", "message": "NF: Long -> long"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d85154ba8ac29c7fd5ee9da8051c11ae6d11124", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0d85154ba8ac29c7fd5ee9da8051c11ae6d11124", "committedDate": "2020-11-03T18:07:00Z", "message": "NF: Long -> long"}, "afterCommit": {"oid": "250693315826fd22f4326a8afe97e675d4d91390", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/250693315826fd22f4326a8afe97e675d4d91390", "committedDate": "2020-11-07T03:44:39Z", "message": "NF: Long -> long"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NjIzOTE1", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#pullrequestreview-525623915", "createdAt": "2020-11-07T05:02:30Z", "commit": {"oid": "250693315826fd22f4326a8afe97e675d4d91390"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNTowMjozMFrOHvDYfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wN1QwNTowMjozMFrOHvDYfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTEwMDU0MQ==", "bodyText": "This is limited to API 24", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#discussion_r519100541", "createdAt": "2020-11-07T05:02:30Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Utils.java", "diffHunk": "@@ -706,21 +706,26 @@ public static void unzipAllFiles(ZipFile zipFile, String targetDirectory) throws\n \n     }\n \n+\n+    /**\n+     * @param zipFile A zip file\n+     * @param targetDirectory Directory in which to unzip some of the zipped field\n+     * @param zipEntries files of the zip folder to unzip\n+     * @param zipEntryToFilenameMap Renaming rules from name in zip file to name in the device\n+     * @throws IOException if the directory can't be created\n+     */\n     public static void unzipFiles(ZipFile zipFile, String targetDirectory, @NonNull String[] zipEntries,\n                                   @Nullable Map<String, String> zipEntryToFilenameMap) throws IOException {\n         File dir = new File(targetDirectory);\n         if (!dir.exists() && !dir.mkdirs()) {\n             throw new IOException(\"Failed to create target directory: \" + targetDirectory);\n         }\n-        if (zipEntryToFilenameMap == null) {\n-            zipEntryToFilenameMap = new HashMap<>();\n-        }\n         for (String requestedEntry : zipEntries) {\n             ZipArchiveEntry ze = zipFile.getEntry(requestedEntry);\n             if (ze != null) {\n                 String name = ze.getName();\n-                if (zipEntryToFilenameMap.containsKey(name)) {\n-                    name = zipEntryToFilenameMap.get(name);\n+                if (zipEntryToFilenameMap != null) {\n+                    name = zipEntryToFilenameMap.getOrDefault(name, name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "250693315826fd22f4326a8afe97e675d4d91390"}, "originalPosition": 28}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "250693315826fd22f4326a8afe97e675d4d91390", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/250693315826fd22f4326a8afe97e675d4d91390", "committedDate": "2020-11-07T03:44:39Z", "message": "NF: Long -> long"}, "afterCommit": {"oid": "4ba8c42c44edda1ac1d39993f4fc6ea522a13a58", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4ba8c42c44edda1ac1d39993f4fc6ea522a13a58", "committedDate": "2020-11-07T05:09:37Z", "message": "NF: Long -> long"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce1841c6ef44d0b69b20971cdb35fd4845c09297", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ce1841c6ef44d0b69b20971cdb35fd4845c09297", "committedDate": "2020-11-09T17:01:48Z", "message": "NF: _uniquifyNote more specific"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3808142218b14d3272d7fcdba6badd4e3f5252a5", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3808142218b14d3272d7fcdba6badd4e3f5252a5", "committedDate": "2020-11-09T17:01:56Z", "message": "NF: import with named variable and correct type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78ede2cbaa61b227e6cb686b20027d87940f9744", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/78ede2cbaa61b227e6cb686b20027d87940f9744", "committedDate": "2020-11-09T17:01:56Z", "message": "NF: query only needed values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f4cea1c4ae5c1183e4e3a324a233a13fac709c3", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6f4cea1c4ae5c1183e4e3a324a233a13fac709c3", "committedDate": "2020-11-09T17:01:56Z", "message": "NF: object to save note data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01c296e5f5f18f78b4e8335220c747469c2e71d9", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/01c296e5f5f18f78b4e8335220c747469c2e71d9", "committedDate": "2020-11-09T17:01:56Z", "message": "NF: unzipFiles commented"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71f74a25f62f785f55c684983a7b77716835def6", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/71f74a25f62f785f55c684983a7b77716835def6", "committedDate": "2020-11-09T17:01:56Z", "message": "NF: Long -> long"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ba8c42c44edda1ac1d39993f4fc6ea522a13a58", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4ba8c42c44edda1ac1d39993f4fc6ea522a13a58", "committedDate": "2020-11-07T05:09:37Z", "message": "NF: Long -> long"}, "afterCommit": {"oid": "71f74a25f62f785f55c684983a7b77716835def6", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/71f74a25f62f785f55c684983a7b77716835def6", "committedDate": "2020-11-09T17:01:56Z", "message": "NF: Long -> long"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NDc5MTg0", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#pullrequestreview-526479184", "createdAt": "2020-11-09T17:18:09Z", "commit": {"oid": "71f74a25f62f785f55c684983a7b77716835def6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NTkxNzMx", "url": "https://github.com/ankidroid/Anki-Android/pull/7592#pullrequestreview-526591731", "createdAt": "2020-11-09T19:37:27Z", "commit": {"oid": "71f74a25f62f785f55c684983a7b77716835def6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3808, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}