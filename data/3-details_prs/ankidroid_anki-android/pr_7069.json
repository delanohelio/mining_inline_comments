{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1OTM4Mzc5", "number": 7069, "title": "Correction of 7066", "bodyText": "Fixes #7066", "createdAt": "2020-09-12T15:34:00Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7069", "merged": true, "mergeCommit": {"oid": "9718dbc8b1b9f14b2ad44328678dbc66e4c46f76"}, "closed": true, "closedAt": "2020-09-12T18:47:34Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIL1AegFqTQ4NzIzNzE5MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIOVOYgFqTQ4NzI0Nzc1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjM3MTkw", "url": "https://github.com/ankidroid/Anki-Android/pull/7069#pullrequestreview-487237190", "createdAt": "2020-09-12T15:35:28Z", "commit": {"oid": "221617876aa2b484a864deb62ffcb1d41c98ee61"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQxNTozNToyOFrOHQ10ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQxNTozNToyOFrOHQ10ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQyMTA2Ng==", "bodyText": "AnkiAssert.assertDoesNotThrow(() -> sched.preloadNextCard());", "url": "https://github.com/ankidroid/Anki-Android/pull/7069#discussion_r487421066", "createdAt": "2020-09-12T15:35:28Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/libanki/sched/AbstractSchedTest.java", "diffHunk": "@@ -377,4 +377,25 @@ private void addDeckWithExactName(String name) {\n         boolean hasMatch = decks.all().stream().anyMatch(x -> name.equals(x.getString(\"name\")));\n         assertThat(String.format(\"Deck %s should exist\", name), hasMatch, is(true));\n     }\n+\n+\n+\n+    @Test\n+    public void regression_7066() {\n+        Collection col = getCol();\n+        DeckConfig dconf = col.getDecks().getConf(1);\n+        dconf.getJSONObject(\"new\").put(\"bury\", true);\n+        AbstractSched sched = col.getSched();\n+        addNoteUsingBasicAndReversedModel(\"foo\", \"bar\");\n+        addNoteUsingBasicModel(\"plop\", \"foo\");\n+        col.reset();\n+        Card card = sched.getCard();\n+        sched.setCurrentCard(card);\n+        sched.preloadNextCard();\n+        sched.answerCard(card, Consts.BUTTON_THREE);\n+        card = sched.getCard();\n+        sched.setCurrentCard(card);\n+        // Next line was an infinite recursion in 7066. We just want to assert the run halts\n+        sched.preloadNextCard();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "221617876aa2b484a864deb62ffcb1d41c98ee61"}, "originalPosition": 23}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "221617876aa2b484a864deb62ffcb1d41c98ee61", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/221617876aa2b484a864deb62ffcb1d41c98ee61", "committedDate": "2020-09-12T15:30:36Z", "message": "Pre load card deal correctly with end of queue\n\nSome commits ago, I ensured that the counts takes current card into account. It seems I forgot to stop decrementing\ncurrent card when resetting the counts.\nI used to search for use to mCurrentCard and did not find directly obvious that it should not have been an argument to _resetNew."}, "afterCommit": {"oid": "661b8369f9f369eb0beee22e1358edc5538b6485", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/661b8369f9f369eb0beee22e1358edc5538b6485", "committedDate": "2020-09-12T15:45:20Z", "message": "Pre load card deal correctly with end of queue\n\nSome commits ago, I ensured that the counts takes current card into account. It seems I forgot to stop decrementing\ncurrent card when resetting the counts.\nI used to search for use to mCurrentCard and did not find directly obvious that it should not have been an argument to _resetNew."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e8fa3cc3b3cd756aa67b2525790161afaf16c3e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9e8fa3cc3b3cd756aa67b2525790161afaf16c3e", "committedDate": "2020-09-12T15:46:58Z", "message": "NF: regression test for 7066"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d9383cfb0cbe2237464ef87562029a9adef1ec6", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7d9383cfb0cbe2237464ef87562029a9adef1ec6", "committedDate": "2020-09-12T15:46:58Z", "message": "Pre load card deal correctly with end of queue\n\nSome commits ago, I ensured that the counts takes current card into account. It seems I forgot to stop decrementing\ncurrent card when resetting the counts.\nI used to search for use to mCurrentCard and did not find directly obvious that it should not have been an argument to _resetNew."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "661b8369f9f369eb0beee22e1358edc5538b6485", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/661b8369f9f369eb0beee22e1358edc5538b6485", "committedDate": "2020-09-12T15:45:20Z", "message": "Pre load card deal correctly with end of queue\n\nSome commits ago, I ensured that the counts takes current card into account. It seems I forgot to stop decrementing\ncurrent card when resetting the counts.\nI used to search for use to mCurrentCard and did not find directly obvious that it should not have been an argument to _resetNew."}, "afterCommit": {"oid": "7d9383cfb0cbe2237464ef87562029a9adef1ec6", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7d9383cfb0cbe2237464ef87562029a9adef1ec6", "committedDate": "2020-09-12T15:46:58Z", "message": "Pre load card deal correctly with end of queue\n\nSome commits ago, I ensured that the counts takes current card into account. It seems I forgot to stop decrementing\ncurrent card when resetting the counts.\nI used to search for use to mCurrentCard and did not find directly obvious that it should not have been an argument to _resetNew."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjM4Njk3", "url": "https://github.com/ankidroid/Anki-Android/pull/7069#pullrequestreview-487238697", "createdAt": "2020-09-12T16:03:57Z", "commit": {"oid": "7d9383cfb0cbe2237464ef87562029a9adef1ec6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjQ3NzUz", "url": "https://github.com/ankidroid/Anki-Android/pull/7069#pullrequestreview-487247753", "createdAt": "2020-09-12T18:30:29Z", "commit": {"oid": "7d9383cfb0cbe2237464ef87562029a9adef1ec6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4082, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}