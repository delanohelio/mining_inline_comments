{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMzU4MjY3", "number": 6004, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxOTowMToyNFrODxyBcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxOTo1OTozNVrODyORCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTI2Mzg3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/PreferenceBackedHostNum.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxOTowMToyNFrOGFcu3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMzoyMzoxOVrOGFkYsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM2NjgxNQ==", "bodyText": "Worth discussing whether we should skip the cache and hit preferences on each get()", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r408366815", "createdAt": "2020-04-14T19:01:24Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/PreferenceBackedHostNum.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.ichi2.anki.web;\n+\n+import android.content.SharedPreferences;\n+\n+import com.ichi2.libanki.Consts;\n+import com.ichi2.libanki.sync.HostNum;\n+\n+import timber.log.Timber;\n+\n+public class PreferenceBackedHostNum extends HostNum {\n+\n+    private final SharedPreferences mPreferences;\n+    private String mHostNum;\n+\n+    public PreferenceBackedHostNum(String hostNum, SharedPreferences preferences) {\n+        super();\n+        this.mHostNum = hostNum;\n+        this.mPreferences = preferences;\n+    }\n+\n+\n+    public static PreferenceBackedHostNum fromPreferences(SharedPreferences preferences) {\n+        String hostNum = preferences.getString(\"hostNum\", null);\n+        if (hostNum == null) {\n+            return new PreferenceBackedHostNum(Consts.DEFAULT_HOST_NUM, preferences);\n+        }\n+        return new PreferenceBackedHostNum(hostNum, preferences);\n+    }\n+\n+    @Override\n+    public String getHostNum() {\n+        return mHostNum;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f661460a79085e6b1b2b8ade3dc3f67627ff36ab"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ3NzE2NQ==", "bodyText": "SharedPreferences is a cache if I understand correctly?", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r408477165", "createdAt": "2020-04-14T22:39:18Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/PreferenceBackedHostNum.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.ichi2.anki.web;\n+\n+import android.content.SharedPreferences;\n+\n+import com.ichi2.libanki.Consts;\n+import com.ichi2.libanki.sync.HostNum;\n+\n+import timber.log.Timber;\n+\n+public class PreferenceBackedHostNum extends HostNum {\n+\n+    private final SharedPreferences mPreferences;\n+    private String mHostNum;\n+\n+    public PreferenceBackedHostNum(String hostNum, SharedPreferences preferences) {\n+        super();\n+        this.mHostNum = hostNum;\n+        this.mPreferences = preferences;\n+    }\n+\n+\n+    public static PreferenceBackedHostNum fromPreferences(SharedPreferences preferences) {\n+        String hostNum = preferences.getString(\"hostNum\", null);\n+        if (hostNum == null) {\n+            return new PreferenceBackedHostNum(Consts.DEFAULT_HOST_NUM, preferences);\n+        }\n+        return new PreferenceBackedHostNum(hostNum, preferences);\n+    }\n+\n+    @Override\n+    public String getHostNum() {\n+        return mHostNum;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM2NjgxNQ=="}, "originalCommit": {"oid": "f661460a79085e6b1b2b8ade3dc3f67627ff36ab"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ5MjIxMQ==", "bodyText": "Wasn't aware of SharedPreferences being a cache, but that's just a lack of Android knowledge, Thanks!", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r408492211", "createdAt": "2020-04-14T23:23:19Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/PreferenceBackedHostNum.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.ichi2.anki.web;\n+\n+import android.content.SharedPreferences;\n+\n+import com.ichi2.libanki.Consts;\n+import com.ichi2.libanki.sync.HostNum;\n+\n+import timber.log.Timber;\n+\n+public class PreferenceBackedHostNum extends HostNum {\n+\n+    private final SharedPreferences mPreferences;\n+    private String mHostNum;\n+\n+    public PreferenceBackedHostNum(String hostNum, SharedPreferences preferences) {\n+        super();\n+        this.mHostNum = hostNum;\n+        this.mPreferences = preferences;\n+    }\n+\n+\n+    public static PreferenceBackedHostNum fromPreferences(SharedPreferences preferences) {\n+        String hostNum = preferences.getString(\"hostNum\", null);\n+        if (hostNum == null) {\n+            return new PreferenceBackedHostNum(Consts.DEFAULT_HOST_NUM, preferences);\n+        }\n+        return new PreferenceBackedHostNum(hostNum, preferences);\n+    }\n+\n+    @Override\n+    public String getHostNum() {\n+        return mHostNum;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM2NjgxNQ=="}, "originalCommit": {"oid": "f661460a79085e6b1b2b8ade3dc3f67627ff36ab"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTgzNTYyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/HostNum.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo1MTowNFrOGFiRlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMzoyNjowOFrOGFkcew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1NzYyMg==", "bodyText": "In the context of this commit at least (I'm reviewing commit by commit) having an abstract class here just to wrap a String, when it's used as a String everywhere else, doesn't seem to add value. Perhaps I will be enlightened in the rest of the commits though...", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r408457622", "createdAt": "2020-04-14T21:51:04Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/HostNum.java", "diffHunk": "@@ -0,0 +1,7 @@\n+package com.ichi2.libanki.sync;\n+\n+/** Not part of libAnki directly, but abstracts out Preferences to a libAnki context */\n+public abstract class HostNum {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e308055c9500de5a13f599c7a4b3378f92afc5c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ5MzE3OQ==", "bodyText": "Just works as a mutable reference to a string. Directly using the string means that we'd need to re-instantiate our class hierarchy after Syncer executes.", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r408493179", "createdAt": "2020-04-14T23:26:08Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/HostNum.java", "diffHunk": "@@ -0,0 +1,7 @@\n+package com.ichi2.libanki.sync;\n+\n+/** Not part of libAnki directly, but abstracts out Preferences to a libAnki context */\n+public abstract class HostNum {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1NzYyMg=="}, "originalCommit": {"oid": "1e308055c9500de5a13f599c7a4b3378f92afc5c"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTk1NzkwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/PreferenceBackedHostNum.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjozODowMlrOGFjb9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNjoyODo1MVrOGGB20Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ3NjY2Mw==", "bodyText": "Ah, now I'm enlightened. Here's an idea though - instead of an abstract and two concretes, why not one concrete, then the Test one just extends the concrete and overrides what you need? I did that a lot in my CardTemplateEditor odyssey and it worked fine while keeping the \"main code line\" (non test code) easier to understand with a flat (entity count == 1) hierarchy for simple objects", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r408476663", "createdAt": "2020-04-14T22:38:02Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/PreferenceBackedHostNum.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.ichi2.anki.web;\n+\n+import android.content.SharedPreferences;\n+\n+import com.ichi2.libanki.Consts;\n+import com.ichi2.libanki.sync.HostNum;\n+\n+import timber.log.Timber;\n+\n+public class PreferenceBackedHostNum extends HostNum {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f661460a79085e6b1b2b8ade3dc3f67627ff36ab"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4OTk1MQ==", "bodyText": "I'd rather avoid polluting libAnki with Android-specific concerns (and as a plus, makes testing a lot faster as you don't need Robolectric \ud83d\ude09).\nDefinitely your call on this one, but how about concrete POJO, no test implementations, and a simpler PreferenceBackedHostNum deferring state to the base class?", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r408489951", "createdAt": "2020-04-14T23:16:26Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/PreferenceBackedHostNum.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.ichi2.anki.web;\n+\n+import android.content.SharedPreferences;\n+\n+import com.ichi2.libanki.Consts;\n+import com.ichi2.libanki.sync.HostNum;\n+\n+import timber.log.Timber;\n+\n+public class PreferenceBackedHostNum extends HostNum {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ3NjY2Mw=="}, "originalCommit": {"oid": "f661460a79085e6b1b2b8ade3dc3f67627ff36ab"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ5MzEyOA==", "bodyText": "I guess I'm showing my relative insensitivity to test speed, I'd lean towards a simpler hierarchy and just eat the robolectric dependency but I recognize my test rig is reasonably quick and these things do add up. I think I worked around this by essentially having a static factory that called getNewXXX on the concrete one in mainline and then in the test code I override that and had it return a super simple one. Maybe that structure could work to keep mainline squeaky but still have fast + simple tests?", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r408493128", "createdAt": "2020-04-14T23:26:00Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/PreferenceBackedHostNum.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.ichi2.anki.web;\n+\n+import android.content.SharedPreferences;\n+\n+import com.ichi2.libanki.Consts;\n+import com.ichi2.libanki.sync.HostNum;\n+\n+import timber.log.Timber;\n+\n+public class PreferenceBackedHostNum extends HostNum {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ3NjY2Mw=="}, "originalCommit": {"oid": "f661460a79085e6b1b2b8ade3dc3f67627ff36ab"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODUwMjk5Nw==", "bodyText": "Static factories are far too Java for my liking. I'll go for the original suggestion before this is up for re-review.", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r408502997", "createdAt": "2020-04-14T23:57:51Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/PreferenceBackedHostNum.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.ichi2.anki.web;\n+\n+import android.content.SharedPreferences;\n+\n+import com.ichi2.libanki.Consts;\n+import com.ichi2.libanki.sync.HostNum;\n+\n+import timber.log.Timber;\n+\n+public class PreferenceBackedHostNum extends HostNum {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ3NjY2Mw=="}, "originalCommit": {"oid": "f661460a79085e6b1b2b8ade3dc3f67627ff36ab"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk3NTA1Nw==", "bodyText": "I swapped this around (POJO, and Preference-based concrete) to ensure we don't require a reference to Android in the base class, but repented on the factory.", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r408975057", "createdAt": "2020-04-15T16:28:51Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/PreferenceBackedHostNum.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package com.ichi2.anki.web;\n+\n+import android.content.SharedPreferences;\n+\n+import com.ichi2.libanki.Consts;\n+import com.ichi2.libanki.sync.HostNum;\n+\n+import timber.log.Timber;\n+\n+public class PreferenceBackedHostNum extends HostNum {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ3NjY2Mw=="}, "originalCommit": {"oid": "f661460a79085e6b1b2b8ade3dc3f67627ff36ab"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTk2NzYwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/Syncer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjo0MjoxNFrOGFjiBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMzoxODoxN1rOGFkSHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ3ODIxMg==", "bodyText": "if it's mildly unexpected but fine to continue without, should be Timber.w I think. Unimportant in the grand scheme, but just want to either have a good debate on or harmonize on log levels. I consider 'e' to be things where you need to bomb out of an activity entirely, almost completely unrecoverable but not quite a crash.", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r408478212", "createdAt": "2020-04-14T22:42:14Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/Syncer.java", "diffHunk": "@@ -249,6 +250,18 @@ public Syncer(Collection col, HttpSyncer server) {\n         return new Object[] { \"success\" };\n     }\n \n+\n+    private void trySetHostNum(JSONObject rMeta) {\n+        //We perform this as old version of the sync server may not provide the hostNum\n+        //And it's fine to continue without one.\n+        try {\n+            mHostNum.setHostNum(rMeta.getString(\"hostNum\"));\n+        } catch (Exception e) {\n+            Timber.e(e, \"Failed to set hostNum\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f661460a79085e6b1b2b8ade3dc3f67627ff36ab"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ5MDUyNA==", "bodyText": "Noted.", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r408490524", "createdAt": "2020-04-14T23:18:17Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/Syncer.java", "diffHunk": "@@ -249,6 +250,18 @@ public Syncer(Collection col, HttpSyncer server) {\n         return new Object[] { \"success\" };\n     }\n \n+\n+    private void trySetHostNum(JSONObject rMeta) {\n+        //We perform this as old version of the sync server may not provide the hostNum\n+        //And it's fine to continue without one.\n+        try {\n+            mHostNum.setHostNum(rMeta.getString(\"hostNum\"));\n+        } catch (Exception e) {\n+            Timber.e(e, \"Failed to set hostNum\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ3ODIxMg=="}, "originalCommit": {"oid": "f661460a79085e6b1b2b8ade3dc3f67627ff36ab"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTU5MDYwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/CustomSyncServer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODozMzozNFrOGGGdIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxOTo1MzoxMFrOGGJMsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1MDQwMQ==", "bodyText": "For all your new classes you're missing the copyright header, can you copy/splat one in, change it to your preferred ankidroid email, then copy/splat that in to the rest of the new files?", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r409050401", "createdAt": "2020-04-15T18:33:34Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/CustomSyncServer.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.ichi2.anki.web;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9ef22b685de2acb6ddd82b831447e80801f5629"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA5MTU4Mw==", "bodyText": "Any standard that you're looking for? Is the following OK?\n\n/*\nCopyright (c) 2020 David Allison <[redactedForWeb]>                     \n                                                                                    \nThis program is free software; you can redistribute it and/or modify it under       \nthe terms of the GNU General Public License as published by the Free Software       \nFoundation; either version 3 of the License, or (at your option) any later          \nversion.                                                                            \n                                                                                    \nThis program is distributed in the hope that it will be useful, but WITHOUT ANY     \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A     \nPARTICULAR PURPOSE. See the GNU General Public License for more details.            \n                                                                                    \nYou should have received a copy of the GNU General Public License along with        \nthis program.  If not, see <http://www.gnu.org/licenses/>. \n*/                         \n\n\nEDIT; I'll be bold to save time. Throw it back if it needs work.", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r409091583", "createdAt": "2020-04-15T19:45:51Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/CustomSyncServer.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.ichi2.anki.web;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1MDQwMQ=="}, "originalCommit": {"oid": "a9ef22b685de2acb6ddd82b831447e80801f5629"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA5NTM0NQ==", "bodyText": "Whatever is all over in the code now, e.g.\n\n  \n    \n      Anki-Android/AnkiDroid/src/main/java/com/ichi2/anki/AnkiDroidApp.java\n    \n    \n        Lines 1 to 17\n      in\n      03a6772\n    \n    \n    \n    \n\n        \n          \n           /**************************************************************************************** \n        \n\n        \n          \n            * Copyright (c) 2009 Edu Zamora <edu.zasu@gmail.com>                                   * \n        \n\n        \n          \n            * Copyright (c) 2009 Casey Link <unnamedrambler@gmail.com>                             * \n        \n\n        \n          \n            * Copyright (c) 2014 Timothy Rae <perceptualchaos2@gmail.com>                          * \n        \n\n        \n          \n            *                                                                                      * \n        \n\n        \n          \n            * This program is free software; you can redistribute it and/or modify it under        * \n        \n\n        \n          \n            * the terms of the GNU General Public License as published by the Free Software        * \n        \n\n        \n          \n            * Foundation; either version 3 of the License, or (at your option) any later           * \n        \n\n        \n          \n            * version.                                                                             * \n        \n\n        \n          \n            *                                                                                      * \n        \n\n        \n          \n            * This program is distributed in the hope that it will be useful, but WITHOUT ANY      * \n        \n\n        \n          \n            * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A      * \n        \n\n        \n          \n            * PARTICULAR PURPOSE. See the GNU General Public License for more details.             * \n        \n\n        \n          \n            *                                                                                      * \n        \n\n        \n          \n            * You should have received a copy of the GNU General Public License along with         * \n        \n\n        \n          \n            * this program.  If not, see <http://www.gnu.org/licenses/>.                           * \n        \n\n        \n          \n            ****************************************************************************************/", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r409095345", "createdAt": "2020-04-15T19:53:10Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/CustomSyncServer.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.ichi2.anki.web;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1MDQwMQ=="}, "originalCommit": {"oid": "a9ef22b685de2acb6ddd82b831447e80801f5629"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTYxMDk3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/HostNum.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODozODo0MFrOGGGpbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODozODo0MFrOGGGpbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1MzU0OA==", "bodyText": "Can you add all the rules here? It is always an integer, it should be reset wiped under xyz conditions? It's not documented anywhere else and this seems like the place to set out the full set of biz reqs", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r409053548", "createdAt": "2020-04-15T18:38:40Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/HostNum.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package com.ichi2.libanki.sync;\n+\n+import com.ichi2.libanki.Consts;\n+\n+/**\n+ * The server provides hostNum in the /sync/meta call. All requests after that (including future meta requests)\n+ * should use that hostNum to construct the sync URL, until a future /sync/meta call advises otherwise.\n+ *", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9ef22b685de2acb6ddd82b831447e80801f5629"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTYzMzQ0OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/test/java/com/ichi2/libanki/sync/HttpSyncerTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0NDo1NVrOGGG3zQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxOTo0MTowNVrOGGI0jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1NzIyOQ==", "bodyText": "Just out of curiosity since you just up on SharedPreferences, why commit here vs apply? I scanned back and saw you used apply (correctly, I believe) in PreferenceBackedHostNum, and I think apply would be fine here as well. For the same reasons commit is typically unnecessary and may slow things down, I think it may be unnecessary and just slow testing down here, but perhaps I'm about to learn something about SharedPreferences, or I read it wrong", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r409057229", "createdAt": "2020-04-15T18:44:55Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/test/java/com/ichi2/libanki/sync/HttpSyncerTest.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package com.ichi2.libanki.sync;\n+\n+import android.content.SharedPreferences;\n+\n+import com.ichi2.anki.AnkiDroidApp;\n+\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import androidx.annotation.NonNull;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class HttpSyncerTest {\n+    private static String sCustomServerWithNoFormatting = \"https://sync.example.com/\";\n+    private static String sCustomServerWithFormatting   = \"https://sync%s.example.com/\";\n+    private static final String sDefaultUrlNoHostNum    = \"https://sync.ankiweb.net/sync/\";\n+    private static final String sDefaultUrlWithHostNum  = \"https://sync1.ankiweb.net/sync/\";\n+\n+\n+    @Test\n+    public void getDefaultMediaUrlWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlNoHostNum));\n+    }\n+\n+\n+    @Test\n+    public void getDefaultMediaUrlWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlWithHostNum));\n+    }\n+\n+\n+    @Test\n+    @Ignore(\"Not yet supported\")\n+    public void getCustomMediaUrlWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+        setCustomServer(sCustomServerWithFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync.example.com/sync/\"));\n+    }\n+\n+\n+    @Test\n+    @Ignore(\"Not yet supported\")\n+    public void getCustomMediaUrlWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+        setCustomServer(sCustomServerWithFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync1.example.com/sync/\"));\n+    }\n+\n+    @Test\n+    public void getUnformattedCustomMediaUrlWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+        setCustomServer(sCustomServerWithNoFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync.example.com/sync/\"));\n+    }\n+\n+    @Test\n+    public void getUnformattedCustomMediaUrlWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+        setCustomServer(sCustomServerWithNoFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync.example.com/sync/\"));\n+    }\n+\n+    @Test\n+    public void invalidSettingReturnsCorrectResultWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+        setCustomServerWithNoUrl();\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlNoHostNum));\n+    }\n+\n+    @Test\n+    public void invalidSettingReturnsCorrectResultWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+        setCustomServerWithNoUrl();\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlWithHostNum));\n+    }\n+\n+    private void setCustomServerWithNoUrl() {\n+        SharedPreferences userPreferences = AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance());\n+        userPreferences.edit().putBoolean(\"useCustomSyncServer\", true).commit();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9ef22b685de2acb6ddd82b831447e80801f5629"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA3MzQ5Mg==", "bodyText": "Hmm... that's a mistake (and linting should have picked it up). Thanks!", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r409073492", "createdAt": "2020-04-15T19:12:27Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/libanki/sync/HttpSyncerTest.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package com.ichi2.libanki.sync;\n+\n+import android.content.SharedPreferences;\n+\n+import com.ichi2.anki.AnkiDroidApp;\n+\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import androidx.annotation.NonNull;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class HttpSyncerTest {\n+    private static String sCustomServerWithNoFormatting = \"https://sync.example.com/\";\n+    private static String sCustomServerWithFormatting   = \"https://sync%s.example.com/\";\n+    private static final String sDefaultUrlNoHostNum    = \"https://sync.ankiweb.net/sync/\";\n+    private static final String sDefaultUrlWithHostNum  = \"https://sync1.ankiweb.net/sync/\";\n+\n+\n+    @Test\n+    public void getDefaultMediaUrlWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlNoHostNum));\n+    }\n+\n+\n+    @Test\n+    public void getDefaultMediaUrlWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlWithHostNum));\n+    }\n+\n+\n+    @Test\n+    @Ignore(\"Not yet supported\")\n+    public void getCustomMediaUrlWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+        setCustomServer(sCustomServerWithFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync.example.com/sync/\"));\n+    }\n+\n+\n+    @Test\n+    @Ignore(\"Not yet supported\")\n+    public void getCustomMediaUrlWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+        setCustomServer(sCustomServerWithFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync1.example.com/sync/\"));\n+    }\n+\n+    @Test\n+    public void getUnformattedCustomMediaUrlWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+        setCustomServer(sCustomServerWithNoFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync.example.com/sync/\"));\n+    }\n+\n+    @Test\n+    public void getUnformattedCustomMediaUrlWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+        setCustomServer(sCustomServerWithNoFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync.example.com/sync/\"));\n+    }\n+\n+    @Test\n+    public void invalidSettingReturnsCorrectResultWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+        setCustomServerWithNoUrl();\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlNoHostNum));\n+    }\n+\n+    @Test\n+    public void invalidSettingReturnsCorrectResultWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+        setCustomServerWithNoUrl();\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlWithHostNum));\n+    }\n+\n+    private void setCustomServerWithNoUrl() {\n+        SharedPreferences userPreferences = AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance());\n+        userPreferences.edit().putBoolean(\"useCustomSyncServer\", true).commit();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1NzIyOQ=="}, "originalCommit": {"oid": "a9ef22b685de2acb6ddd82b831447e80801f5629"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA4OTE2NQ==", "bodyText": "Oh... it's in test code, maybe different linting rules?", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r409089165", "createdAt": "2020-04-15T19:41:05Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/libanki/sync/HttpSyncerTest.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package com.ichi2.libanki.sync;\n+\n+import android.content.SharedPreferences;\n+\n+import com.ichi2.anki.AnkiDroidApp;\n+\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import androidx.annotation.NonNull;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class HttpSyncerTest {\n+    private static String sCustomServerWithNoFormatting = \"https://sync.example.com/\";\n+    private static String sCustomServerWithFormatting   = \"https://sync%s.example.com/\";\n+    private static final String sDefaultUrlNoHostNum    = \"https://sync.ankiweb.net/sync/\";\n+    private static final String sDefaultUrlWithHostNum  = \"https://sync1.ankiweb.net/sync/\";\n+\n+\n+    @Test\n+    public void getDefaultMediaUrlWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlNoHostNum));\n+    }\n+\n+\n+    @Test\n+    public void getDefaultMediaUrlWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlWithHostNum));\n+    }\n+\n+\n+    @Test\n+    @Ignore(\"Not yet supported\")\n+    public void getCustomMediaUrlWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+        setCustomServer(sCustomServerWithFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync.example.com/sync/\"));\n+    }\n+\n+\n+    @Test\n+    @Ignore(\"Not yet supported\")\n+    public void getCustomMediaUrlWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+        setCustomServer(sCustomServerWithFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync1.example.com/sync/\"));\n+    }\n+\n+    @Test\n+    public void getUnformattedCustomMediaUrlWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+        setCustomServer(sCustomServerWithNoFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync.example.com/sync/\"));\n+    }\n+\n+    @Test\n+    public void getUnformattedCustomMediaUrlWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+        setCustomServer(sCustomServerWithNoFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync.example.com/sync/\"));\n+    }\n+\n+    @Test\n+    public void invalidSettingReturnsCorrectResultWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+        setCustomServerWithNoUrl();\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlNoHostNum));\n+    }\n+\n+    @Test\n+    public void invalidSettingReturnsCorrectResultWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+        setCustomServerWithNoUrl();\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlWithHostNum));\n+    }\n+\n+    private void setCustomServerWithNoUrl() {\n+        SharedPreferences userPreferences = AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance());\n+        userPreferences.edit().putBoolean(\"useCustomSyncServer\", true).commit();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1NzIyOQ=="}, "originalCommit": {"oid": "a9ef22b685de2acb6ddd82b831447e80801f5629"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTYzNDM5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/test/java/com/ichi2/libanki/sync/HttpSyncerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0NTowOVrOGGG4YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0NTowOVrOGGG4YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1NzM3Ng==", "bodyText": "same commit vs apply question here, one answer answers both", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r409057376", "createdAt": "2020-04-15T18:45:09Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/test/java/com/ichi2/libanki/sync/HttpSyncerTest.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package com.ichi2.libanki.sync;\n+\n+import android.content.SharedPreferences;\n+\n+import com.ichi2.anki.AnkiDroidApp;\n+\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import androidx.annotation.NonNull;\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class HttpSyncerTest {\n+    private static String sCustomServerWithNoFormatting = \"https://sync.example.com/\";\n+    private static String sCustomServerWithFormatting   = \"https://sync%s.example.com/\";\n+    private static final String sDefaultUrlNoHostNum    = \"https://sync.ankiweb.net/sync/\";\n+    private static final String sDefaultUrlWithHostNum  = \"https://sync1.ankiweb.net/sync/\";\n+\n+\n+    @Test\n+    public void getDefaultMediaUrlWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlNoHostNum));\n+    }\n+\n+\n+    @Test\n+    public void getDefaultMediaUrlWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlWithHostNum));\n+    }\n+\n+\n+    @Test\n+    @Ignore(\"Not yet supported\")\n+    public void getCustomMediaUrlWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+        setCustomServer(sCustomServerWithFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync.example.com/sync/\"));\n+    }\n+\n+\n+    @Test\n+    @Ignore(\"Not yet supported\")\n+    public void getCustomMediaUrlWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+        setCustomServer(sCustomServerWithFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync1.example.com/sync/\"));\n+    }\n+\n+    @Test\n+    public void getUnformattedCustomMediaUrlWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+        setCustomServer(sCustomServerWithNoFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync.example.com/sync/\"));\n+    }\n+\n+    @Test\n+    public void getUnformattedCustomMediaUrlWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+        setCustomServer(sCustomServerWithNoFormatting);\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(\"https://sync.example.com/sync/\"));\n+    }\n+\n+    @Test\n+    public void invalidSettingReturnsCorrectResultWithNoHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(null);\n+        setCustomServerWithNoUrl();\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlNoHostNum));\n+    }\n+\n+    @Test\n+    public void invalidSettingReturnsCorrectResultWithHostNum() {\n+        HttpSyncer underTest = getServerWithHostNum(1);\n+        setCustomServerWithNoUrl();\n+\n+        String syncUrl = underTest.syncURL();\n+\n+        assertThat(syncUrl, is(sDefaultUrlWithHostNum));\n+    }\n+\n+    private void setCustomServerWithNoUrl() {\n+        SharedPreferences userPreferences = AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance());\n+        userPreferences.edit().putBoolean(\"useCustomSyncServer\", true).commit();\n+    }\n+\n+    private void setCustomServer(String s) {\n+\n+        SharedPreferences userPreferences = AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance());\n+        SharedPreferences.Editor e = userPreferences.edit();\n+        e.putBoolean(\"useCustomSyncServer\", true);\n+        e.putString(\"syncBaseUrl\", s);\n+        e.commit();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9ef22b685de2acb6ddd82b831447e80801f5629"}, "originalPosition": 119}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTY0OTg1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/HttpSyncer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0OToyOFrOGGHCFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxOTozODoxOVrOGGIuOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1OTg2MQ==", "bodyText": "You did this another way in a different check, and it is because of the nullability/non-nullability of preferences. Could you eat the null check consistently in CustomSyncServer then everyone can just do a simple call to CustomSyncServer.isEnabled(prefs)? (whether prefs is null or not). Less code in the end, fewer mental gotos", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r409059861", "createdAt": "2020-04-15T18:49:28Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/HttpSyncer.java", "diffHunk": "@@ -454,12 +450,36 @@ public static ByteArrayInputStream getInputStream(String string) {\n     public String syncURL() {\n         // Allow user to specify custom sync server\n         SharedPreferences userPreferences = AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance());\n-        if (userPreferences != null && userPreferences.getBoolean(\"useCustomSyncServer\", false)) {\n-            Uri syncBase = Uri.parse(userPreferences.getString(\"syncBaseUrl\", Consts.SYNC_BASE));\n-            return syncBase.buildUpon().appendPath(\"sync\").toString() + \"/\";\n+        if (isUsingCustomSyncServer(userPreferences)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9ef22b685de2acb6ddd82b831447e80801f5629"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA3NTc3NQ==", "bodyText": "Null handling is unexpected functionality and you typically want to define the default, I'm happy swap for implicit code if it's a member of the class, but not for the global call.\nI can add a default as a compromise", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r409075775", "createdAt": "2020-04-15T19:16:42Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/HttpSyncer.java", "diffHunk": "@@ -454,12 +450,36 @@ public static ByteArrayInputStream getInputStream(String string) {\n     public String syncURL() {\n         // Allow user to specify custom sync server\n         SharedPreferences userPreferences = AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance());\n-        if (userPreferences != null && userPreferences.getBoolean(\"useCustomSyncServer\", false)) {\n-            Uri syncBase = Uri.parse(userPreferences.getString(\"syncBaseUrl\", Consts.SYNC_BASE));\n-            return syncBase.buildUpon().appendPath(\"sync\").toString() + \"/\";\n+        if (isUsingCustomSyncServer(userPreferences)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1OTg2MQ=="}, "originalCommit": {"oid": "a9ef22b685de2acb6ddd82b831447e80801f5629"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA4NzU0NA==", "bodyText": "meh, I just see it as a contract. Especially with annotations, but if you feel strongly \"implementor's choice\"", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r409087544", "createdAt": "2020-04-15T19:38:19Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/HttpSyncer.java", "diffHunk": "@@ -454,12 +450,36 @@ public static ByteArrayInputStream getInputStream(String string) {\n     public String syncURL() {\n         // Allow user to specify custom sync server\n         SharedPreferences userPreferences = AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance());\n-        if (userPreferences != null && userPreferences.getBoolean(\"useCustomSyncServer\", false)) {\n-            Uri syncBase = Uri.parse(userPreferences.getString(\"syncBaseUrl\", Consts.SYNC_BASE));\n-            return syncBase.buildUpon().appendPath(\"sync\").toString() + \"/\";\n+        if (isUsingCustomSyncServer(userPreferences)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1OTg2MQ=="}, "originalCommit": {"oid": "a9ef22b685de2acb6ddd82b831447e80801f5629"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTg5MTI0OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/HostNumFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxOTo1OTozNFrOGGJaPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxOTo1OTozNFrOGGJaPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA5ODgxNA==", "bodyText": "Issue found: The utility class name 'HostNumFactory' doesn't match '[A-Z][a-zA-Z0-9]+(Utils?|Helper)'", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r409098814", "createdAt": "2020-04-15T19:59:34Z", "author": {"login": "timrae"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/HostNumFactory.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ Copyright (c) 2020 David Allison <davidallisongithub@gmail.com>\n+\n+ This program is free software; you can redistribute it and/or modify it under\n+ the terms of the GNU General Public License as published by the Free Software\n+ Foundation; either version 3 of the License, or (at your option) any later\n+ version.\n+\n+ This program is distributed in the hope that it will be useful, but WITHOUT ANY\n+ WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A\n+ PARTICULAR PURPOSE. See the GNU General Public License for more details.\n+\n+ You should have received a copy of the GNU General Public License along with\n+ this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package com.ichi2.anki.web;\n+\n+import android.content.Context;\n+\n+import com.ichi2.anki.AnkiDroidApp;\n+import com.ichi2.libanki.sync.HostNum;\n+\n+public class HostNumFactory {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a9aeac237bc4f53451408f6fd428dfb7d6c114a"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzOTg5MTMwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/CustomSyncServer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxOTo1OTozNVrOGGJaRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxOTo1OTozNVrOGGJaRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA5ODgyMQ==", "bodyText": "Issue found: The utility class name 'CustomSyncServer' doesn't match '[A-Z][a-zA-Z0-9]+(Utils?|Helper)'", "url": "https://github.com/ankidroid/Anki-Android/pull/6004#discussion_r409098821", "createdAt": "2020-04-15T19:59:35Z", "author": {"login": "timrae"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/web/CustomSyncServer.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ Copyright (c) 2020 David Allison <davidallisongithub@gmail.com>\n+\n+ This program is free software; you can redistribute it and/or modify it under\n+ the terms of the GNU General Public License as published by the Free Software\n+ Foundation; either version 3 of the License, or (at your option) any later\n+ version.\n+\n+ This program is distributed in the hope that it will be useful, but WITHOUT ANY\n+ WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A\n+ PARTICULAR PURPOSE. See the GNU General Public License for more details.\n+\n+ You should have received a copy of the GNU General Public License along with\n+ this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package com.ichi2.anki.web;\n+\n+import android.content.Context;\n+import android.content.SharedPreferences;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import timber.log.Timber;\n+\n+public class CustomSyncServer {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a9aeac237bc4f53451408f6fd428dfb7d6c114a"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 337, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}