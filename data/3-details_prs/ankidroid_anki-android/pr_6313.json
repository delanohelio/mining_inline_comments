{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1NTYwMzUz", "number": 6313, "title": "Handle 3-letter language roots correctly", "bodyText": "Pull Request template\nPurpose / Description\nPreviously there was an expectation in the importer script that all\nlanguage codes had a 2-letter root, but many valid codes that Android\naccepts have 3-letter codes and collide with the 2-letter codes (fi vs fil)\nAdditionally, the 'yu' (Cantonese) custom code needed to map to 'yue' for Android to recognize it\nFixes\nFixes #6254\nFixes #6256\nApproach\n\nInstead of a 2-character hard split, I split on the hyphen while importing languages\nI was unable to map the custom language code 'yu' created by earlier AnkiDroid maintainers in Crowdin, so on import we special case that one and move it to 'yue' to match it's IATA tag\n\nLanguageUtil also needed quite a bit of work for the same reason, splitting now on hyphen and underscore (because Android uses both at different times - hyphen for display in our language picker, underscore during system resource fetch) where it used to split hard on character index 2\nThis also cleans up the import done earlier while adding Sorani that produced\ntruncated (3-letter to 2-letter) languages (ckb->ck, got->go) while also adding all updated translations from a crowdin export\nThe only interesting changes are to tools/update-localizations.py and LanguageUtil.java - the rest is localization change\nHow Has This Been Tested?\nThanks to the rejuvenated ability to test languages easily and see them in their own locale codes this was easily verified by visual inspection on an API16 and API28 emulator\nI was able to see 'yu', then see the working (Cantonese) code when it was moved to 'yue', and I saw 'fi' but no Filiipino, with 'fi' messed up, then after moving 'fil' to it's own directory 'fi' was Finnish and Filipino was Filipino.\nI also added unit tests that covered every case that was wrong and discovered during the manual inspection\nLearning (optional, can help others)\nAndroid consumes IANA tags (thanks for the tip @david-allison-1) just fine, we just need to put our language files in the right spot\nhttps://www.iana.org/assignments/language-subtag-registry/language-subtag-registry\nOur language display list expects regional variants to be like 'pt-BR', while the resource fetch code expects 'pt-br'\nChecklist\nPlease, go through these checks before submitting the PR.\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-05-31T04:43:39Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6313", "merged": true, "mergeCommit": {"oid": "33317beebb485dadd17edeb3fddaf446f86a2ed5"}, "closed": true, "closedAt": "2020-06-01T19:00:40Z", "author": {"login": "mikehardy"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcmkRHggBqjMzOTAyODc5OTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnEgRgAFqTQyMjA3NzMxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f6699a30c6225d3727b982eb0abf6c661bda8b3a", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f6699a30c6225d3727b982eb0abf6c661bda8b3a", "committedDate": "2020-05-31T04:40:15Z", "message": "Handle 3-letter language roots correctly\n\nPreviously there was an expectation in the importer script that all\nlanguage codes had a 2-letter root, but many valid codes that Android\naccepts have 3-letter codes *and* collide with the 2-letter codes (fi vs fil)\n\nAdditionally, the 'yu' (Cantonese) custom code needed to map to 'yue'\n\nThis cleans up the import done earlier while adding Sorani that produced\ntruncated (3-letter to 2-letter) languages while adding all updated translations\nfrom crowdin"}, "afterCommit": {"oid": "04b0b61a1714a2c7180a99000c93af55b6e390a4", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/04b0b61a1714a2c7180a99000c93af55b6e390a4", "committedDate": "2020-05-31T04:49:14Z", "message": "Handle 3-letter language roots correctly\n\nPreviously there was an expectation in the importer script that all\nlanguage codes had a 2-letter root, but many valid codes that Android\naccepts have 3-letter codes *and* collide with the 2-letter codes (fi vs fil)\n\nAdditionally, the 'yu' (Cantonese) custom code needed to map to 'yue'\n\nThis cleans up the import done earlier while adding Sorani that produced\ntruncated (3-letter to 2-letter) languages while adding all updated translations\nfrom crowdin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDc1Mjg4", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#pullrequestreview-421475288", "createdAt": "2020-05-31T09:05:15Z", "commit": {"oid": "04b0b61a1714a2c7180a99000c93af55b6e390a4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "04b0b61a1714a2c7180a99000c93af55b6e390a4", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/04b0b61a1714a2c7180a99000c93af55b6e390a4", "committedDate": "2020-05-31T04:49:14Z", "message": "Handle 3-letter language roots correctly\n\nPreviously there was an expectation in the importer script that all\nlanguage codes had a 2-letter root, but many valid codes that Android\naccepts have 3-letter codes *and* collide with the 2-letter codes (fi vs fil)\n\nAdditionally, the 'yu' (Cantonese) custom code needed to map to 'yue'\n\nThis cleans up the import done earlier while adding Sorani that produced\ntruncated (3-letter to 2-letter) languages while adding all updated translations\nfrom crowdin"}, "afterCommit": {"oid": "a57ebe5312afa7c0d4950604e4f5f9a43be3a8cc", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a57ebe5312afa7c0d4950604e4f5f9a43be3a8cc", "committedDate": "2020-05-31T19:08:43Z", "message": "Updated strings from Crowdin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/aeb0686f713cb0139d8975cf0519b51a49029b62", "committedDate": "2020-05-31T19:48:42Z", "message": "Handle 3-letter language roots correctly\n\nThere was an expectation in the importer script that all\nlanguage codes had a 2-letter root, but many valid codes that Android\naccepts have 3-letter codes *and* collide with the 2-letter codes (fi vs fil)\n\nThere was the expectation in the LanguageUtil object that languages\nall had 2-letter roots as well, it was altered to split on '-' instead\nof on specific character indices, with associated unit testing to verify\n\nAdditionally, the 'yu' (Cantonese) custom code needed to map to 'yue'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a1d914dd665bd0adecd2aadf13bd7e4c90a2b0e", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2a1d914dd665bd0adecd2aadf13bd7e4c90a2b0e", "committedDate": "2020-05-31T19:51:10Z", "message": "Updated strings from Crowdin"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a57ebe5312afa7c0d4950604e4f5f9a43be3a8cc", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a57ebe5312afa7c0d4950604e4f5f9a43be3a8cc", "committedDate": "2020-05-31T19:08:43Z", "message": "Updated strings from Crowdin"}, "afterCommit": {"oid": "2a1d914dd665bd0adecd2aadf13bd7e4c90a2b0e", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2a1d914dd665bd0adecd2aadf13bd7e4c90a2b0e", "committedDate": "2020-05-31T19:51:10Z", "message": "Updated strings from Crowdin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNTI0MDg4", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#pullrequestreview-421524088", "createdAt": "2020-05-31T20:11:34Z", "commit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoxMTozNFrOGc6_rA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoyNzo1NlrOGc7E2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk3OTg4NA==", "bodyText": "Nit: No need to call .toString(), let the logging framework do it for efficiency.", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432979884", "createdAt": "2020-05-31T20:11:34Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AnkiDroidApp.java", "diffHunk": "@@ -398,6 +398,7 @@ public static Context updateContextWithLanguage(@NonNull Context remoteContext)\n     private static Configuration getLanguageConfig(@NonNull Configuration remoteConfig, @NonNull SharedPreferences prefs) {\n         Configuration newConfig = new Configuration(remoteConfig);\n         Locale newLocale = LanguageUtil.getLocale(prefs.getString(Preferences.LANGUAGE, \"\"), prefs);\n+        Timber.d(\"AnkiDroidApp::getLanguageConfig - setting locale to %s\", newLocale.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk3OTkyOQ==", "bodyText": "Best to log the input", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432979929", "createdAt": "2020-05-31T20:12:07Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/utils/LanguageUtil.java", "diffHunk": "@@ -81,10 +83,13 @@ public static Locale getLocale(@Nullable String localeCode, @NonNull SharedPrefe\n             // Fall back to (system) default only if that fails.\n             localeCode = Locale.getDefault().toString();\n         }\n-        if (localeCode.length() > 2) {\n+        // Language separators are '_' or '-' at different times in display/resource fetch\n+        if (localeCode != null && (localeCode.contains(\"_\") || localeCode.contains(\"-\"))) {\n             try {\n-                locale = new Locale(localeCode.substring(0, 2), localeCode.substring(3, 5));\n-            } catch (StringIndexOutOfBoundsException e) {\n+                String[] localeParts = localeCode.split(\"[_-]\", 2);\n+                locale = new Locale(localeParts[0], localeParts[1]);\n+            } catch (ArrayIndexOutOfBoundsException e) {\n+                Timber.w(e, \"LanguageUtil::getLocale regional variant split failed. Using code raw.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDA1NA==", "bodyText": "Do we need/intend to handle ISO 639 here? zh-Hant-TW for example?\nhttps://android.googlesource.com/platform/external/icu4c.git/+/master/data/locales/ - not sure if this is relevant", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432980054", "createdAt": "2020-05-31T20:13:42Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "diffHunk": "@@ -71,4 +76,32 @@ public void testCurrentLanguagesHaveNotChanged() {\n         assertThat(\"Languages have been updated, please modify test variables: \" +\n                 \"PREVIOUS_LANGUAGES and CURRENT_LANGUAGES\", actual, contains(CURRENT_LANGUAGES));\n     }\n+\n+    @Test\n+    public void localeTwoLetterCodeResolves() {\n+        assertThat(\"A locale with a 2-letter code resolves correctly\",\n+                LanguageUtil.getLocale(\"af\").getDisplayLanguage().equals(\"Afrikaans\"));\n+    }\n+\n+    @Test\n+    public void localeThreeLetterCodeResolves() {\n+        assertThat(\"A locale with a 3-letter code resolves correctly\",\n+                LanguageUtil.getLocale(\"fil\").getDisplayLanguage().equals(\"Filipino\"));\n+    }\n+\n+    @Test\n+    public void localeTwoLetterRegionalVariantResolves() {\n+        assertThat(\"A locale with a 2-letter code and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"pt-BR\").getDisplayName().equals(\"Portuguese (Brazil)\"));\n+        assertThat(\"A locale with a 2-letter code and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"pt_BR\").getDisplayName().equals(\"Portuguese (Brazil)\"));\n+    }\n+\n+    @Test\n+    public void localeThreeLetterRegionalVariantResolves() {\n+        assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"yue_TW\").getDisplayName().equals(\"yue (Taiwan)\"));\n+        assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"yue-TW\").getDisplayName().equals(\"yue (Taiwan)\"));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDA3Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",\n          \n          \n            \n                    assertThat(\"A locale with a 3-letter code and regional variant resolves correctly\",", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432980073", "createdAt": "2020-05-31T20:14:06Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "diffHunk": "@@ -71,4 +76,32 @@ public void testCurrentLanguagesHaveNotChanged() {\n         assertThat(\"Languages have been updated, please modify test variables: \" +\n                 \"PREVIOUS_LANGUAGES and CURRENT_LANGUAGES\", actual, contains(CURRENT_LANGUAGES));\n     }\n+\n+    @Test\n+    public void localeTwoLetterCodeResolves() {\n+        assertThat(\"A locale with a 2-letter code resolves correctly\",\n+                LanguageUtil.getLocale(\"af\").getDisplayLanguage().equals(\"Afrikaans\"));\n+    }\n+\n+    @Test\n+    public void localeThreeLetterCodeResolves() {\n+        assertThat(\"A locale with a 3-letter code resolves correctly\",\n+                LanguageUtil.getLocale(\"fil\").getDisplayLanguage().equals(\"Filipino\"));\n+    }\n+\n+    @Test\n+    public void localeTwoLetterRegionalVariantResolves() {\n+        assertThat(\"A locale with a 2-letter code and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"pt-BR\").getDisplayName().equals(\"Portuguese (Brazil)\"));\n+        assertThat(\"A locale with a 2-letter code and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"pt_BR\").getDisplayName().equals(\"Portuguese (Brazil)\"));\n+    }\n+\n+    @Test\n+    public void localeThreeLetterRegionalVariantResolves() {\n+        assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"yue_TW\").getDisplayName().equals(\"yue (Taiwan)\"));\n+        assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDA4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",\n          \n          \n            \n                    assertThat(\"A locale with a 3-letter code and regional variant resolves correctly\",", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432980081", "createdAt": "2020-05-31T20:14:12Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "diffHunk": "@@ -71,4 +76,32 @@ public void testCurrentLanguagesHaveNotChanged() {\n         assertThat(\"Languages have been updated, please modify test variables: \" +\n                 \"PREVIOUS_LANGUAGES and CURRENT_LANGUAGES\", actual, contains(CURRENT_LANGUAGES));\n     }\n+\n+    @Test\n+    public void localeTwoLetterCodeResolves() {\n+        assertThat(\"A locale with a 2-letter code resolves correctly\",\n+                LanguageUtil.getLocale(\"af\").getDisplayLanguage().equals(\"Afrikaans\"));\n+    }\n+\n+    @Test\n+    public void localeThreeLetterCodeResolves() {\n+        assertThat(\"A locale with a 3-letter code resolves correctly\",\n+                LanguageUtil.getLocale(\"fil\").getDisplayLanguage().equals(\"Filipino\"));\n+    }\n+\n+    @Test\n+    public void localeTwoLetterRegionalVariantResolves() {\n+        assertThat(\"A locale with a 2-letter code and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"pt-BR\").getDisplayName().equals(\"Portuguese (Brazil)\"));\n+        assertThat(\"A locale with a 2-letter code and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"pt_BR\").getDisplayName().equals(\"Portuguese (Brazil)\"));\n+    }\n+\n+    @Test\n+    public void localeThreeLetterRegionalVariantResolves() {\n+        assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDE1Mw==", "bodyText": "Will these tests pass if the users locale is non-English? I think all of our non-instrumented test runs are still in English.", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432980153", "createdAt": "2020-05-31T20:15:04Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "diffHunk": "@@ -71,4 +76,32 @@ public void testCurrentLanguagesHaveNotChanged() {\n         assertThat(\"Languages have been updated, please modify test variables: \" +\n                 \"PREVIOUS_LANGUAGES and CURRENT_LANGUAGES\", actual, contains(CURRENT_LANGUAGES));\n     }\n+\n+    @Test\n+    public void localeTwoLetterCodeResolves() {\n+        assertThat(\"A locale with a 2-letter code resolves correctly\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDcyNw==", "bodyText": "Could you link some docs here. I assume this is correct, but I really can't know.", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432980727", "createdAt": "2020-05-31T20:22:30Z", "author": {"login": "david-allison-1"}, "path": "tools/update-localizations.py", "diffHunk": "@@ -178,12 +178,16 @@ def build():\n t.close()\n \n for language in languages:\n-    if language[:2] in localizedRegions:\n-        androidLanguage = string.replace(language, '-', '-r')\n+    # Regional files need a marker in Android\n+    if language.split('-', 1)[0] in localizedRegions:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDgwNQ==", "bodyText": "This is python2?", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432980805", "createdAt": "2020-05-31T20:23:31Z", "author": {"login": "david-allison-1"}, "path": "tools/update-localizations.py", "diffHunk": "@@ -178,12 +178,16 @@ def build():\n t.close()\n \n for language in languages:\n-    if language[:2] in localizedRegions:\n-        androidLanguage = string.replace(language, '-', '-r')\n+    # Regional files need a marker in Android\n+    if language.split('-', 1)[0] in localizedRegions:\n+        androidLanguage = string.replace(language, '-', '-r') # zh-CW becomes zh-rCW\n     else:\n-        androidLanguage = language[:2] # Example: es-ES becomes es\n+        androidLanguage = language.split('-', 1)[0] # Example: es-ES becomes es\n \n-    print \"\\nCopying language files for: \" + androidLanguage\n+    if language == 'yu':\n+        androidLanguage = 'yue'\n+\n+    print \"\\nCopying language files from \" + language + \" to \" + androidLanguage", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MTIxMQ==", "bodyText": "This feels subject to change. Would it be possible to make a HashSet of the prefixes and see if there are unhandled collisions.\nSomething like af_NA and af_ZA Afrikaans (South Africa/Namibia) probably wouldn't be caught here, and it'd be useful to flag this new conflict to a maintainer.", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432981211", "createdAt": "2020-05-31T20:27:56Z", "author": {"login": "david-allison-1"}, "path": "tools/update-localizations.py", "diffHunk": "@@ -178,12 +178,16 @@ def build():\n t.close()\n \n for language in languages:\n-    if language[:2] in localizedRegions:\n-        androidLanguage = string.replace(language, '-', '-r')\n+    # Regional files need a marker in Android\n+    if language.split('-', 1)[0] in localizedRegions:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ccd47781c0d3465be89ed19c6e016cd6b20fbf5d", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ccd47781c0d3465be89ed19c6e016cd6b20fbf5d", "committedDate": "2020-06-01T15:46:57Z", "message": "NF: Improve logging, Improve test, Document I18N variant add"}, "afterCommit": {"oid": "a326db144648052c4ab67e0c5f6ffb984bc3f039", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a326db144648052c4ab67e0c5f6ffb984bc3f039", "committedDate": "2020-06-01T15:54:05Z", "message": "NF: Improve logging, Improve test, Document I18N variant add"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxOTcyNTI0", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#pullrequestreview-421972524", "createdAt": "2020-06-01T15:58:11Z", "commit": {"oid": "a326db144648052c4ab67e0c5f6ffb984bc3f039"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89620aad36e3445af3cff3917e6fca7db07646a2", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/89620aad36e3445af3cff3917e6fca7db07646a2", "committedDate": "2020-06-01T16:04:39Z", "message": "NF: Improve logging, Improve test, Document I18N variant add"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7517e550609ddc6fe8e299493dcb2ddc419b67c", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e7517e550609ddc6fe8e299493dcb2ddc419b67c", "committedDate": "2020-06-01T16:22:28Z", "message": "Improve error attribution in broken I18N finder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ffab75a3f07327cc944bc6991367696deeb851d", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3ffab75a3f07327cc944bc6991367696deeb851d", "committedDate": "2020-06-01T16:22:51Z", "message": "Updated strings from crowdin\n\nThis includes one manual/local fix to values-nl/02-strings.xml but\nI also fixed it in crowdin for next export and informed the translator"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a326db144648052c4ab67e0c5f6ffb984bc3f039", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a326db144648052c4ab67e0c5f6ffb984bc3f039", "committedDate": "2020-06-01T15:54:05Z", "message": "NF: Improve logging, Improve test, Document I18N variant add"}, "afterCommit": {"oid": "3ffab75a3f07327cc944bc6991367696deeb851d", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3ffab75a3f07327cc944bc6991367696deeb851d", "committedDate": "2020-06-01T16:22:51Z", "message": "Updated strings from crowdin\n\nThis includes one manual/local fix to values-nl/02-strings.xml but\nI also fixed it in crowdin for next export and informed the translator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMDc3MzE1", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#pullrequestreview-422077315", "createdAt": "2020-06-01T18:24:00Z", "commit": {"oid": "3ffab75a3f07327cc944bc6991367696deeb851d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3375, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}