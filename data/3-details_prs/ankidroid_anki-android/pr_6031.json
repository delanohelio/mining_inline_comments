{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0NTAxMjcw", "number": 6031, "title": "handleDeckSelection uses a function for cards in learning instead of reset", "bodyText": "When there are no card to review immediately in a deck, a full reset was done (uselessly) just to check whether there are cards in learning due later today. I introduce a method which simply check whether there are cards in learning due the same day. This means that it gets quicker to decide what to do in this case.\nNote that this method is not in upstream. Mostly because upstream always open the reviewer, and just close it if there is nothing to review. Since we do thing very differently anyway, at least, let's do them quickly.", "createdAt": "2020-04-16T16:04:50Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6031", "merged": true, "mergeCommit": {"oid": "10c2be16778230a8850d0af065a0fd532987fd2a"}, "closed": true, "closedAt": "2020-06-08T13:20:09Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYPQB8gBqjMyNDA3NTgwNjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpQWcDAFqTQyNjIyNTIwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d511edd3d8a4990fa252fe4053c745dcbb0e623f", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d511edd3d8a4990fa252fe4053c745dcbb0e623f", "committedDate": "2020-04-16T16:23:16Z", "message": "remove useless collectionTask.getCard(AbstractScheduler)"}, "afterCommit": {"oid": "9dbd1b6b09b17ac53c0699182ebc3e4142a774c7", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9dbd1b6b09b17ac53c0699182ebc3e4142a774c7", "committedDate": "2020-04-16T15:50:28Z", "message": "Uses lrnDueFromToday istead of counts\n\nAt this point in the code, we already know that there are no due cards\nnew/in review/or in learning and already due. So in\n```java\nstudyOptionsCounts[0] + studyOptionsCounts[1] + studyOptionsCounts[2] > 0\n```\nwe know that `studyOptionsCounts[0]` and `studyOptionsCounts[1]` are\n0, and so `studyOptionsCounts[2]>0`. This number contains the number\nof cards in learning. We also know there are no cards in learning,\nalready due, from previous days. So this number simply represents the\nnumber of cards in learning, reviewed the same day, and not yet\ndue. This is why `lrnDueFromToday` is acceptable.\n\nFurthermore, `.counts` was the only method in which used the state set\nby `reset`, so this method can now be removed (anyway, another call to\n`reset` will occur if required before a card is taken or when the\nstudy option change the cards to study."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9dbd1b6b09b17ac53c0699182ebc3e4142a774c7", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9dbd1b6b09b17ac53c0699182ebc3e4142a774c7", "committedDate": "2020-04-16T15:50:28Z", "message": "Uses lrnDueFromToday istead of counts\n\nAt this point in the code, we already know that there are no due cards\nnew/in review/or in learning and already due. So in\n```java\nstudyOptionsCounts[0] + studyOptionsCounts[1] + studyOptionsCounts[2] > 0\n```\nwe know that `studyOptionsCounts[0]` and `studyOptionsCounts[1]` are\n0, and so `studyOptionsCounts[2]>0`. This number contains the number\nof cards in learning. We also know there are no cards in learning,\nalready due, from previous days. So this number simply represents the\nnumber of cards in learning, reviewed the same day, and not yet\ndue. This is why `lrnDueFromToday` is acceptable.\n\nFurthermore, `.counts` was the only method in which used the state set\nby `reset`, so this method can now be removed (anyway, another call to\n`reset` will occur if required before a card is taken or when the\nstudy option change the cards to study."}, "afterCommit": {"oid": "2010c19a13c1630bfaf2cff66ad054ace3210a35", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2010c19a13c1630bfaf2cff66ad054ace3210a35", "committedDate": "2020-04-17T17:56:14Z", "message": "Prepare next card for reviewer in background"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2010c19a13c1630bfaf2cff66ad054ace3210a35", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2010c19a13c1630bfaf2cff66ad054ace3210a35", "committedDate": "2020-04-17T17:56:14Z", "message": "Prepare next card for reviewer in background"}, "afterCommit": {"oid": "9272fa57ee8db4a8ff33bdc6f495ec28a6f38588", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9272fa57ee8db4a8ff33bdc6f495ec28a6f38588", "committedDate": "2020-04-17T18:05:23Z", "message": "Uses lrnDueFromToday istead of counts\n\nAt this point in the code, we already know that there are no due cards\nnew/in review/or in learning and already due. So in\n```java\nstudyOptionsCounts[0] + studyOptionsCounts[1] + studyOptionsCounts[2] > 0\n```\nwe know that `studyOptionsCounts[0]` and `studyOptionsCounts[1]` are\n0, and so `studyOptionsCounts[2]>0`. This number contains the number\nof cards in learning. We also know there are no cards in learning,\nalready due, from previous days. So this number simply represents the\nnumber of cards in learning, reviewed the same day, and not yet\ndue. This is why `lrnDueFromToday` is acceptable.\n\nFurthermore, `.counts` was the only method in which used the state set\nby `reset`, so this method can now be removed (anyway, another call to\n`reset` will occur if required before a card is taken or when the\nstudy option change the cards to study."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MDI1MTQx", "url": "https://github.com/ankidroid/Anki-Android/pull/6031#pullrequestreview-426025141", "createdAt": "2020-06-08T08:44:48Z", "commit": {"oid": "9272fa57ee8db4a8ff33bdc6f495ec28a6f38588"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwODo0NDo0OFrOGgUaRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwODo0NDo0OFrOGgUaRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU0MjAyMg==", "bodyText": "Maybe: hasCardsTodayAfterStudyAheadLimit", "url": "https://github.com/ankidroid/Anki-Android/pull/6031#discussion_r436542022", "createdAt": "2020-06-08T08:44:48Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -2009,9 +2009,7 @@ private void handleDeckSelection(long did, boolean dontSkipStudyOptions) {\n             }\n             return;\n         }\n-        getCol().getSched().reset();\n-        int[] studyOptionsCounts = getCol().getSched().counts();\n-        if (studyOptionsCounts[0] + studyOptionsCounts[1] + studyOptionsCounts[2] > 0) {\n+        if (getCol().getSched().lrnDueFromToday()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9272fa57ee8db4a8ff33bdc6f495ec28a6f38588"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f522f80ed448dba22c4979ea1ad2b0ca578ff45b", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f522f80ed448dba22c4979ea1ad2b0ca578ff45b", "committedDate": "2020-06-08T11:49:55Z", "message": "lrnDueFromToday\n\nThis method allows to check whether a card in learning will be due\ntoday; it avoids to reset entirely the deck, and so allows to decide\nquickly what action should be done when a deck is selected and no\ncards can be seen immediatly."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e058c53524dc2e5b1dba889284412d918249f93", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4e058c53524dc2e5b1dba889284412d918249f93", "committedDate": "2020-06-08T11:50:07Z", "message": "Uses lrnDueFromToday istead of counts\n\nAt this point in the code, we already know that there are no due cards\nnew/in review/or in learning and already due. So in\n```java\nstudyOptionsCounts[0] + studyOptionsCounts[1] + studyOptionsCounts[2] > 0\n```\nwe know that `studyOptionsCounts[0]` and `studyOptionsCounts[1]` are\n0, and so `studyOptionsCounts[2]>0`. This number contains the number\nof cards in learning. We also know there are no cards in learning,\nalready due, from previous days. So this number simply represents the\nnumber of cards in learning, reviewed the same day, and not yet\ndue. This is why `lrnDueFromToday` is acceptable.\n\nFurthermore, `.counts` was the only method in which used the state set\nby `reset`, so this method can now be removed (anyway, another call to\n`reset` will occur if required before a card is taken or when the\nstudy option change the cards to study."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9272fa57ee8db4a8ff33bdc6f495ec28a6f38588", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9272fa57ee8db4a8ff33bdc6f495ec28a6f38588", "committedDate": "2020-04-17T18:05:23Z", "message": "Uses lrnDueFromToday istead of counts\n\nAt this point in the code, we already know that there are no due cards\nnew/in review/or in learning and already due. So in\n```java\nstudyOptionsCounts[0] + studyOptionsCounts[1] + studyOptionsCounts[2] > 0\n```\nwe know that `studyOptionsCounts[0]` and `studyOptionsCounts[1]` are\n0, and so `studyOptionsCounts[2]>0`. This number contains the number\nof cards in learning. We also know there are no cards in learning,\nalready due, from previous days. So this number simply represents the\nnumber of cards in learning, reviewed the same day, and not yet\ndue. This is why `lrnDueFromToday` is acceptable.\n\nFurthermore, `.counts` was the only method in which used the state set\nby `reset`, so this method can now be removed (anyway, another call to\n`reset` will occur if required before a card is taken or when the\nstudy option change the cards to study."}, "afterCommit": {"oid": "4e058c53524dc2e5b1dba889284412d918249f93", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4e058c53524dc2e5b1dba889284412d918249f93", "committedDate": "2020-06-08T11:50:07Z", "message": "Uses lrnDueFromToday istead of counts\n\nAt this point in the code, we already know that there are no due cards\nnew/in review/or in learning and already due. So in\n```java\nstudyOptionsCounts[0] + studyOptionsCounts[1] + studyOptionsCounts[2] > 0\n```\nwe know that `studyOptionsCounts[0]` and `studyOptionsCounts[1]` are\n0, and so `studyOptionsCounts[2]>0`. This number contains the number\nof cards in learning. We also know there are no cards in learning,\nalready due, from previous days. So this number simply represents the\nnumber of cards in learning, reviewed the same day, and not yet\ndue. This is why `lrnDueFromToday` is acceptable.\n\nFurthermore, `.counts` was the only method in which used the state set\nby `reset`, so this method can now be removed (anyway, another call to\n`reset` will occur if required before a card is taken or when the\nstudy option change the cards to study."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MTgyMDIx", "url": "https://github.com/ankidroid/Anki-Android/pull/6031#pullrequestreview-426182021", "createdAt": "2020-06-08T12:37:52Z", "commit": {"oid": "4e058c53524dc2e5b1dba889284412d918249f93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MjI1MjAx", "url": "https://github.com/ankidroid/Anki-Android/pull/6031#pullrequestreview-426225201", "createdAt": "2020-06-08T13:19:58Z", "commit": {"oid": "4e058c53524dc2e5b1dba889284412d918249f93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3418, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}