{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3NTMzNjM4", "number": 7631, "title": "Handle Backup restoration-related crashes", "bodyText": "Purpose\nIf the app is restored from a backup, then Application.onCreate is not called. This lead to a lot of crashes as onCreate was assumed to always happen.\nFixes\nFixes #7630\nApproach\n\nOn each activity onCreate\nDetect if the failure occurred\nShow a message\nKill the app so it starts normally.\n\nHow Has This Been Tested?\nMy Android 9\nTest via: .\\adb shell bmgr restore com.ichi2.anki\n\nLearning\nhttps://stackoverflow.com/questions/57211036/why-backup-related-process-might-cause-applications-oncreate-is-not-executed\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code\n UI changes: include screenshots of all affected screens (in particular showing any new or changed strings)\n Strings resources: All strings added as resources are unique or contain a comment for seemingly duplicate strings to explain the difference between both resources", "createdAt": "2020-11-09T07:07:24Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7631", "merged": true, "mergeCommit": {"oid": "9c8182dde2ed45a0c0de69214097ac10c85bd14a"}, "closed": true, "closedAt": "2020-11-09T18:08:38Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdavXY0gFqTUyNTk2OTY1OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABda3LkigBqjM5NzQ1OTIwMTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1OTY5NjU5", "url": "https://github.com/ankidroid/Anki-Android/pull/7631#pullrequestreview-525969659", "createdAt": "2020-11-09T07:10:20Z", "commit": {"oid": "7d0a6da6dda18a9b2008fe3f13e46d146245e481"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwNzoxMDoyMVrOHvhMrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwNzoxMDoyMVrOHvhMrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTU4OTAzOQ==", "bodyText": "There may be a better way to do this (check if Application is an instance of another class), this is the main line that worries me, as if this returns false, it means the process will be killed, and there may be other reasons that this happens", "url": "https://github.com/ankidroid/Anki-Android/pull/7631#discussion_r519589039", "createdAt": "2020-11-09T07:10:21Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AnkiDroidApp.java", "diffHunk": "@@ -190,6 +191,17 @@ public static InputStream getResourceAsStream(@NonNull String name) {\n     }\n \n \n+    public static boolean wasStartedAfterBackupRestoration() {\n+        return sInstance == null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d0a6da6dda18a9b2008fe3f13e46d146245e481"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MjY5NjUx", "url": "https://github.com/ankidroid/Anki-Android/pull/7631#pullrequestreview-526269651", "createdAt": "2020-11-09T13:45:10Z", "commit": {"oid": "7d0a6da6dda18a9b2008fe3f13e46d146245e481"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b623214493e2a0dffb65682a7c4568a9441450b9", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/b623214493e2a0dffb65682a7c4568a9441450b9", "committedDate": "2020-11-09T16:16:27Z", "message": "Handle App.onCreate not executing after restore\n\nWhen opened after a backup restore, Application.onCreate is not called.\nWe can't do much here, so send a toast, and exit.\n\nWe need to kill the app process, as finish() does not do this, and will\nlead to the message constantly being shown.\n\nFixes 7630 (just DeckPicker)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2af35207dbce68794f3dac9d0fa44abc810823b0", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2af35207dbce68794f3dac9d0fa44abc810823b0", "committedDate": "2020-11-09T16:16:29Z", "message": "Speed up ActivityStartupUnderBackupTest\n\nDon't use an Application class - no need"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52296021362f381d5f1dd3726e67ef5f28c4144e", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/52296021362f381d5f1dd3726e67ef5f28c4144e", "committedDate": "2020-11-09T16:16:29Z", "message": "Handle App.onCreate not executing after restore\n\nPart 2: Implement all other classes\n\nWhen opened after a backup restore, Application.onCreate is not called.\nWe can't do much here, so send a toast, and exit.\n\nWe need to kill the app process, as finish() does not do this, and will\nlead to the message constantly being shown.\n\nFixes 7630"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d0a6da6dda18a9b2008fe3f13e46d146245e481", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7d0a6da6dda18a9b2008fe3f13e46d146245e481", "committedDate": "2020-11-09T07:06:26Z", "message": "Handle App.onCreate not executing after restore\n\nPart 2: Implement all other classes\n\nWhen opened after a backup restore, Application.onCreate is not called.\nWe can't do much here, so send a toast, and exit.\n\nWe need to kill the app process, as finish() does not do this, and will\nlead to the message constantly being shown.\n\nFixes 7630"}, "afterCommit": {"oid": "52296021362f381d5f1dd3726e67ef5f28c4144e", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/52296021362f381d5f1dd3726e67ef5f28c4144e", "committedDate": "2020-11-09T16:16:29Z", "message": "Handle App.onCreate not executing after restore\n\nPart 2: Implement all other classes\n\nWhen opened after a backup restore, Application.onCreate is not called.\nWe can't do much here, so send a toast, and exit.\n\nWe need to kill the app process, as finish() does not do this, and will\nlead to the message constantly being shown.\n\nFixes 7630"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3821, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}