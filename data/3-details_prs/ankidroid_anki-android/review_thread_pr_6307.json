{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1NDUyMjgy", "number": 6307, "reviewThreads": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMTowOTowMVrOEBI3Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxOTozMTozMlrOEBfLxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjI5MjAzOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMTowOTowMVrOGc1XKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMTowOTowMVrOGc1XKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4NzU5Mw==", "bodyText": "Can these be changed to JavascriptInterface methods: https://developer.android.com/reference/android/webkit/JavascriptInterface\nWe're currently open to accidental XSS which will break cards JS", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432887593", "createdAt": "2020-05-30T21:09:01Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -3135,6 +3181,13 @@ public void onPageFinished(WebView view, String url) {\n             drawFlag();\n             drawMark();\n             view.loadUrl(\"javascript:onPageFinished();\");\n+\n+            // cards count, deckname, estimated time, mark, flag to be accessible in AnkiDroid WebView\n+            view.loadUrl(\"javascript:ankiGetCardCount(\" + newCount.toString() +  \",\" + lrnCount.toString() + \",\" + revCount.toString()  + \")\" );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49e6567434e211ba45c1b0db1be5116be995684b"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjI5MjM5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMTowOTozMVrOGc1XVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMTowOTozMVrOGc1XVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4NzYzOQ==", "bodyText": "This needed to happen for a long time.", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432887639", "createdAt": "2020-05-30T21:09:31Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -176,6 +176,22 @@\n \n     protected static final int MENU_DISABLED = 3;\n \n+    // Deckname\n+    private String title;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49e6567434e211ba45c1b0db1be5116be995684b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjI5MjYzOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMToxMDowMFrOGc1XeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMToxMDowMFrOGc1XeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4NzY3Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n                // TODO: Consider extracting to ViewModel", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432887672", "createdAt": "2020-05-30T21:10:00Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -176,6 +176,22 @@\n \n     protected static final int MENU_DISABLED = 3;\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49e6567434e211ba45c1b0db1be5116be995684b"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjI5MzI5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/assets/scripts/card.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMToxMDo1NFrOGc1Xzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMToxMDo1NFrOGc1Xzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4Nzc1OA==", "bodyText": "ankiOnCardFlag", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432887758", "createdAt": "2020-05-30T21:10:54Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,62 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+// Get new card, learn card, review card counts in ankidroid webview. It will be accessible via javascript\n+function ankiGetCardCount(ankiNewCount, ankiLrnCount, ankiRevCount) {\n+    window.ankiNewCount = ankiNewCount;\n+    window.ankiLrnCount = ankiLrnCount;\n+    window.ankiRevCount = ankiRevCount;\n+}\n+\n+// Get Current Deck Name\n+function ankiGetDeckName(ankiDeckName) {\n+   window.ankiDeckName = ankiDeckName;\n+}\n+\n+// Get estimated time\n+function ankiGetETA(ankiETA) {\n+   window.ankiETA = ankiETA;\n+}\n+\n+// Card Mark\n+function ankiGetCardMark(ankiMark) {\n+   window.ankiMark = ankiMark;\n+}\n+\n+/**\n+* card flagged or not\n+* (none = 0, red = 1, orange = 2, green = 3 blue = 4)\n+**/\n+function ankiGetCardFlag(ankiFlagStatus) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49e6567434e211ba45c1b0db1be5116be995684b"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjI5MzMzOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/assets/scripts/card.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMToxMTowMlrOGc1X0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMToxMTowMlrOGc1X0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4Nzc2Mw==", "bodyText": "ankiOnCardMark", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432887763", "createdAt": "2020-05-30T21:11:02Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,62 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+// Get new card, learn card, review card counts in ankidroid webview. It will be accessible via javascript\n+function ankiGetCardCount(ankiNewCount, ankiLrnCount, ankiRevCount) {\n+    window.ankiNewCount = ankiNewCount;\n+    window.ankiLrnCount = ankiLrnCount;\n+    window.ankiRevCount = ankiRevCount;\n+}\n+\n+// Get Current Deck Name\n+function ankiGetDeckName(ankiDeckName) {\n+   window.ankiDeckName = ankiDeckName;\n+}\n+\n+// Get estimated time\n+function ankiGetETA(ankiETA) {\n+   window.ankiETA = ankiETA;\n+}\n+\n+// Card Mark\n+function ankiGetCardMark(ankiMark) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49e6567434e211ba45c1b0db1be5116be995684b"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjI5MzU2OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/assets/scripts/card.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMToxMTozNVrOGc1X8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMToxMTozNVrOGc1X8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4Nzc5NQ==", "bodyText": "Move to a field substitution if possible", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432887795", "createdAt": "2020-05-30T21:11:35Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,62 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+// Get new card, learn card, review card counts in ankidroid webview. It will be accessible via javascript\n+function ankiGetCardCount(ankiNewCount, ankiLrnCount, ankiRevCount) {\n+    window.ankiNewCount = ankiNewCount;\n+    window.ankiLrnCount = ankiLrnCount;\n+    window.ankiRevCount = ankiRevCount;\n+}\n+\n+// Get Current Deck Name\n+function ankiGetDeckName(ankiDeckName) {\n+   window.ankiDeckName = ankiDeckName;\n+}\n+\n+// Get estimated time\n+function ankiGetETA(ankiETA) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49e6567434e211ba45c1b0db1be5116be995684b"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjI5NTkyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/assets/scripts/card.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMToxNjo1N1rOGc1ZLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwNjoxNjo0OFrOGc2-Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4ODEwOA==", "bodyText": "This has semantic differences between SchedV1 and SchedV2. We also want to include relearn count.\nThis would be better as an object so we can add more properties without breaking the API contract.\nThere's a few Anki addons that do thing similar to this already (and probably the same thing), we should follow their naming scheme.", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432888108", "createdAt": "2020-05-30T21:16:57Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,62 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+// Get new card, learn card, review card counts in ankidroid webview. It will be accessible via javascript\n+function ankiGetCardCount(ankiNewCount, ankiLrnCount, ankiRevCount) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49e6567434e211ba45c1b0db1be5116be995684b"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxMzkyNg==", "bodyText": "For relearn card one function may be added in Javascript Interface", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432913926", "createdAt": "2020-05-31T06:16:48Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,62 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+// Get new card, learn card, review card counts in ankidroid webview. It will be accessible via javascript\n+function ankiGetCardCount(ankiNewCount, ankiLrnCount, ankiRevCount) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4ODEwOA=="}, "originalCommit": {"oid": "49e6567434e211ba45c1b0db1be5116be995684b"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjI5NjM4OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/assets/scripts/card.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMToxNzo0NVrOGc1ZaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwNjoxNjoxMlrOGc294g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4ODE2OA==", "bodyText": "Should be in {{Deck}}", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432888168", "createdAt": "2020-05-30T21:17:45Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,62 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+// Get new card, learn card, review card counts in ankidroid webview. It will be accessible via javascript\n+function ankiGetCardCount(ankiNewCount, ankiLrnCount, ankiRevCount) {\n+    window.ankiNewCount = ankiNewCount;\n+    window.ankiLrnCount = ankiLrnCount;\n+    window.ankiRevCount = ankiRevCount;\n+}\n+\n+// Get Current Deck Name\n+function ankiGetDeckName(ankiDeckName) {\n+   window.ankiDeckName = ankiDeckName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49e6567434e211ba45c1b0db1be5116be995684b"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkxMzg5MA==", "bodyText": "yes, {{Deck}} return the deckname", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432913890", "createdAt": "2020-05-31T06:16:12Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,62 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+// Get new card, learn card, review card counts in ankidroid webview. It will be accessible via javascript\n+function ankiGetCardCount(ankiNewCount, ankiLrnCount, ankiRevCount) {\n+    window.ankiNewCount = ankiNewCount;\n+    window.ankiLrnCount = ankiLrnCount;\n+    window.ankiRevCount = ankiRevCount;\n+}\n+\n+// Get Current Deck Name\n+function ankiGetDeckName(ankiDeckName) {\n+   window.ankiDeckName = ankiDeckName;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4ODE2OA=="}, "originalCommit": {"oid": "49e6567434e211ba45c1b0db1be5116be995684b"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjI5Njg2OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/assets/scripts/card.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMToxODo0MFrOGc1Zog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMToxODo0MFrOGc1Zog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4ODIyNg==", "bodyText": "Merge all the flag signals into one, similar to signal:typeblurtext:xxx", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432888226", "createdAt": "2020-05-30T21:18:40Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,62 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+// Get new card, learn card, review card counts in ankidroid webview. It will be accessible via javascript\n+function ankiGetCardCount(ankiNewCount, ankiLrnCount, ankiRevCount) {\n+    window.ankiNewCount = ankiNewCount;\n+    window.ankiLrnCount = ankiLrnCount;\n+    window.ankiRevCount = ankiRevCount;\n+}\n+\n+// Get Current Deck Name\n+function ankiGetDeckName(ankiDeckName) {\n+   window.ankiDeckName = ankiDeckName;\n+}\n+\n+// Get estimated time\n+function ankiGetETA(ankiETA) {\n+   window.ankiETA = ankiETA;\n+}\n+\n+// Card Mark\n+function ankiGetCardMark(ankiMark) {\n+   window.ankiMark = ankiMark;\n+}\n+\n+/**\n+* card flagged or not\n+* (none = 0, red = 1, orange = 2, green = 3 blue = 4)\n+**/\n+function ankiGetCardFlag(ankiFlagStatus) {\n+    window.ankiFlagStatus = ankiFlagStatus;\n+}\n+\n+// Flag the card from AnkiDroid Webview using JavaScript\n+function ankiToggleFlagRed() {\n+    window.location.href = \"signal:card_toggle_flag_red\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49e6567434e211ba45c1b0db1be5116be995684b"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjI5NzA3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMToxOToxMlrOGc1ZvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQyMToxOToxMlrOGc1ZvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4ODI1Mg==", "bodyText": "use executeCommand here, as this provides protection for when the card is null/controls are disabled", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432888252", "createdAt": "2020-05-30T21:19:12Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -3022,6 +3040,34 @@ private boolean filterUrl(String url) {\n                 redrawCard();\n                 return true;\n             }\n+            // mark card using javascript\n+            if (url.startsWith(\"signal:mark_current_card\")) {\n+                onMark(mCurrentCard);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49e6567434e211ba45c1b0db1be5116be995684b"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjU5NjkwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/assets/scripts/card.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwOToxOToxOVrOGc3w6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwOToxOToxOVrOGc3w6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkyNjk1Mg==", "bodyText": "Add a signal: prefix to maintain consistency", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432926952", "createdAt": "2020-05-31T09:19:19Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,16 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+// Toggle flag on card from AnkiDroid Webview using JavaScript\n+function ankiToggleFlag(flag) {\n+    window.location.href = \"flag:\" + flag;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eeb4702b226fe615f3647e95412fb9282eae4b06"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjU5Nzk2OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/assets/scripts/card.js", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQwOToyMToxNlrOGc3xcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQxMDozMDo1MVrOGc4GTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkyNzA5MQ==", "bodyText": "This needs to document what the flag command accepts. I would have assumed that it accepts 0..4\nIt would be better to accept both the numeric constants, and the string values.", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432927091", "createdAt": "2020-05-31T09:21:16Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,16 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+// Toggle flag on card from AnkiDroid Webview using JavaScript\n+function ankiToggleFlag(flag) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eeb4702b226fe615f3647e95412fb9282eae4b06"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzMTkzOQ==", "bodyText": "It can be done using this and adding case for mFlagInt.\nint mFlagInt = Integer.parseInt(mFlag);\n   switch(mFlagInt) {\n  }\nBut how to check user have passed string or int?\nIt will add more code to AbstractFlashcardViewer.java\nBut passing the color name is looking good to me.", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432931939", "createdAt": "2020-05-31T10:24:34Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,16 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+// Toggle flag on card from AnkiDroid Webview using JavaScript\n+function ankiToggleFlag(flag) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkyNzA5MQ=="}, "originalCommit": {"oid": "eeb4702b226fe615f3647e95412fb9282eae4b06"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzMjQzMQ==", "bodyText": "Keep the input code in AbstractFlashCardViewer consistent (either as strings, or ints - I prefer the strings that you're using), and coerce the data in Javascript.\nI'm not a JS dev, but there should be an easy way to determine if an input is a string or a number.", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432932431", "createdAt": "2020-05-31T10:30:51Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,16 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+// Toggle flag on card from AnkiDroid Webview using JavaScript\n+function ankiToggleFlag(flag) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkyNzA5MQ=="}, "originalCommit": {"oid": "eeb4702b226fe615f3647e95412fb9282eae4b06"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjYzNzEyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQxMDozMjoxN1rOGc4GtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQxMDozMjoxN1rOGc4GtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzMjUzMg==", "bodyText": "Could you log: Timber.d that this was ignored", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432932532", "createdAt": "2020-05-31T10:32:17Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -3022,6 +3034,30 @@ private boolean filterUrl(String url) {\n                 redrawCard();\n                 return true;\n             }\n+            // mark card using javascript\n+            if (url.startsWith(\"signal:mark_current_card\")) {\n+                executeCommand(COMMAND_MARK);\n+                return true;\n+            }\n+            // flag card (blue, green, orange, red) using javascript from AnkiDroid webview\n+            if (url.startsWith(\"signal:\")) {\n+                String mFlag = url.replaceFirst(\"signal:\",\"\");\n+                switch (mFlag) {\n+                    case \"none\": executeCommand(COMMAND_UNSET_FLAG);\n+                        return true;\n+                    case \"red\": executeCommand(COMMAND_TOGGLE_FLAG_RED);\n+                        return true;\n+                    case \"orange\": executeCommand(COMMAND_TOGGLE_FLAG_ORANGE);\n+                        return true;\n+                    case \"green\": executeCommand(COMMAND_TOGGLE_FLAG_GREEN);\n+                        return true;\n+                    case \"blue\": executeCommand(COMMAND_TOGGLE_FLAG_BLUE);\n+                        return true;\n+                    default:\n+                        return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ad189eebcc38a6250b64cf3604397918c41b2083"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NjY4MDkwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/assets/scripts/card.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQxMTo0NToyOVrOGc4eQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQxMTo1OToxMVrOGc4icw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzODU2Mw==", "bodyText": "I'm not in my comfort zone, but I don't feel this is correct (ref: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/isNaN - Confusing special-case behavior), as it's checking for the IEEE-754 NaN, rather than performing a type coercion.\nNumber.isInteger() seems like a better option, but I'll defer to @mikehardy 's javascript knowledge", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432938563", "createdAt": "2020-05-31T11:45:29Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -109,7 +109,21 @@ function ankiMarkCard() {\n     See AnkiDroid Manual for Usage\n */\n function ankiToggleFlag(flag) {\n-    window.location.href = \"signal:\" + flag;\n+    var flagVal = isNaN(flag);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "089a20e91679fe3e7e08ec4dff634bd58079018f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzOTYzNQ==", "bodyText": "May be there will be better implementation for this.\nI have updated card.js", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432939635", "createdAt": "2020-05-31T11:59:11Z", "author": {"login": "infinyte7"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -109,7 +109,21 @@ function ankiMarkCard() {\n     See AnkiDroid Manual for Usage\n */\n function ankiToggleFlag(flag) {\n-    window.location.href = \"signal:\" + flag;\n+    var flagVal = isNaN(flag);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzODU2Mw=="}, "originalCommit": {"oid": "089a20e91679fe3e7e08ec4dff634bd58079018f"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5NzkxMzU1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/assets/scripts/card.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwODo1Njo0M1rOGdDePQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwODo1Njo0M1rOGdDePQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzExODc4MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                none, red, orange, green, blue\n          \n          \n            \n                possible values: \"none\", \"red\", \"orange\", \"green\", \"blue\"", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r433118781", "createdAt": "2020-06-01T08:56:43Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,32 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+/* Toggle flag on card from AnkiDroid Webview using JavaScript\n+    none, red, orange, green, blue", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3f035e5a1b3fc679c030adc2317451aa42faa95"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5OTk0OTQ0OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/assets/scripts/card.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxOTozMTozMVrOGdXThw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxOTozMTozMVrOGdXThw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQ0MzcxOQ==", "bodyText": "Issue found: Strings must use doublequote.", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r433443719", "createdAt": "2020-06-01T19:31:31Z", "author": {"login": "timrae"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,32 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+/* Toggle flag on card from AnkiDroid Webview using JavaScript\n+    Possible values: \"none\", \"red\", \"orange\", \"green\", \"blue\"\n+    See AnkiDroid Manual for Usage\n+*/\n+function ankiToggleFlag(flag) {\n+    var flagVal = Number.isInteger(flag);\n+\n+    if (flagVal) {\n+        switch (flag) {\n+            case 0: window.location.href = \"signal:flag_none\"; break;\n+            case 1: window.location.href = \"signal:flag_red\"; break;\n+            case 2: window.location.href = \"signal:flag_orange\"; break;\n+            case 3: window.location.href = \"signal:flag_green\"; break;\n+            case 4: window.location.href = \"signal:flag_blue\"; break;\n+            default: console.log('No Flag Found'); break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dddbccbdfa6dcbdda928f57b123448939fa4d870"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5OTk0OTQ4OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/assets/scripts/card.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxOTozMTozMlrOGdXTjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxOTozMTozMlrOGdXTjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzQ0MzcyNg==", "bodyText": "Issue found: Unexpected console statement.", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r433443726", "createdAt": "2020-06-01T19:31:32Z", "author": {"login": "timrae"}, "path": "AnkiDroid/src/main/assets/scripts/card.js", "diffHunk": "@@ -99,6 +99,32 @@ function reloadPage() {\n     window.location.href = \"signal:reload_card_html\";\n }\n \n+// Mark current card\n+function ankiMarkCard() {\n+    window.location.href = \"signal:mark_current_card\";\n+}\n+\n+/* Toggle flag on card from AnkiDroid Webview using JavaScript\n+    Possible values: \"none\", \"red\", \"orange\", \"green\", \"blue\"\n+    See AnkiDroid Manual for Usage\n+*/\n+function ankiToggleFlag(flag) {\n+    var flagVal = Number.isInteger(flag);\n+\n+    if (flagVal) {\n+        switch (flag) {\n+            case 0: window.location.href = \"signal:flag_none\"; break;\n+            case 1: window.location.href = \"signal:flag_red\"; break;\n+            case 2: window.location.href = \"signal:flag_orange\"; break;\n+            case 3: window.location.href = \"signal:flag_green\"; break;\n+            case 4: window.location.href = \"signal:flag_blue\"; break;\n+            default: console.log('No Flag Found'); break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dddbccbdfa6dcbdda928f57b123448939fa4d870"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 310, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}