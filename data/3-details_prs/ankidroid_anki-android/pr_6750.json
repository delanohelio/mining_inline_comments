{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU2NjM4MjM1", "number": 6750, "title": "Better undo", "bodyText": "Thinking again about recent change, I realized I didn't really like it. I still believe that 1b3d8f5 is an improvement, however, it is not enough. The code should not be in a single class, neither CollectionTask nor Undoable.\u00a0It should be where it makes sens, where its variables already exists, where the action to undone is done. This allow to read and compare the doing and the undoing far more easily.\nFurthermore, it seems that all Undoable class but one are used a single time. So really, there is no problem in moving the class definition where it is used.", "createdAt": "2020-07-25T16:49:38Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6750", "merged": true, "mergeCommit": {"oid": "91896546f732c68d601004882bdcc6878bf6329c"}, "closed": true, "closedAt": "2020-07-29T15:56:58Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc4ceUdAFqTQ1NTI5OTk0OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5tKSmAFqTQ1NzY2MzgwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Mjk5OTQ5", "url": "https://github.com/ankidroid/Anki-Android/pull/6750#pullrequestreview-455299949", "createdAt": "2020-07-25T17:56:18Z", "commit": {"oid": "4ab156e68089881a960864f9e132927f22f8d3f6"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Mzc0MTc2", "url": "https://github.com/ankidroid/Anki-Android/pull/6750#pullrequestreview-455374176", "createdAt": "2020-07-26T15:33:22Z", "commit": {"oid": "4ab156e68089881a960864f9e132927f22f8d3f6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQxNTozMzoyMlrOG3NNNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQxNTozMzoyMlrOG3NNNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDU0MTIzOA==", "bodyText": "I think this would be more readable as: Undoable.revertToProvidedState(card, BURY_CARD)", "url": "https://github.com/ankidroid/Anki-Android/pull/6750#discussion_r460541238", "createdAt": "2020-07-26T15:33:22Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -643,19 +653,29 @@ private TaskData doInBackgroundDismissNote(TaskData... params) {\n                 switch (type) {\n                     case BURY_CARD:\n                         // collect undo information\n-                        col.markUndo(new UndoableBuryCard(note.cards(), card.getId()));\n+                        Undoable buryCard = new UndoableFlushAll(BURY_CARD, note.cards(), card.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ab156e68089881a960864f9e132927f22f8d3f6"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Mzc0MjE0", "url": "https://github.com/ankidroid/Anki-Android/pull/6750#pullrequestreview-455374214", "createdAt": "2020-07-26T15:33:52Z", "commit": {"oid": "4ab156e68089881a960864f9e132927f22f8d3f6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1Mzg3NDMy", "url": "https://github.com/ankidroid/Anki-Android/pull/6750#pullrequestreview-455387432", "createdAt": "2020-07-26T18:58:30Z", "commit": {"oid": "63bdf388b2f7c5415579cd0e43b90c0f0d6ec150"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQxODo1ODozMFrOG3Ob-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNlQxODo1ODozMFrOG3Ob-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDU2MTQwMw==", "bodyText": "nit: I feel a static method accepting a card and enum value, returning a class (name doesn't matter) would be better than a constructor here\n\nAccepting a card makes the intent clear - it's the card that we care about, and getting the siblings is an implementation detail\nThe intent of the method (revertToProvidedState) won't change, and that provides more meaning than the name of the class", "url": "https://github.com/ankidroid/Anki-Android/pull/6750#discussion_r460561403", "createdAt": "2020-07-26T18:58:30Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -643,19 +653,29 @@ private TaskData doInBackgroundDismissNote(TaskData... params) {\n                 switch (type) {\n                     case BURY_CARD:\n                         // collect undo information\n-                        col.markUndo(new UndoableBuryCard(note.cards(), card.getId()));\n+                        Undoable buryCard = new RevertToProvidedState(BURY_CARD, note.cards(), card.getId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63bdf388b2f7c5415579cd0e43b90c0f0d6ec150"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63bdf388b2f7c5415579cd0e43b90c0f0d6ec150", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/63bdf388b2f7c5415579cd0e43b90c0f0d6ec150", "committedDate": "2020-07-26T18:53:09Z", "message": "NF: UndoableFlushAll -> RevertToProvidedState"}, "afterCommit": {"oid": "a9399e19b4095c20d3fb7198e3c730dc7fa1b5b2", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a9399e19b4095c20d3fb7198e3c730dc7fa1b5b2", "committedDate": "2020-07-26T20:34:22Z", "message": "NF: UndoableFlushAll -> revertToProvidedState"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1MzkzNzY0", "url": "https://github.com/ankidroid/Anki-Android/pull/6750#pullrequestreview-455393764", "createdAt": "2020-07-26T20:40:01Z", "commit": {"oid": "a9399e19b4095c20d3fb7198e3c730dc7fa1b5b2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "154f6902df948cd95b86729be22d02ffac92f00c", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/154f6902df948cd95b86729be22d02ffac92f00c", "committedDate": "2020-07-27T02:12:32Z", "message": "NF: UndoableReview as anonymous class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d4365d3b005b39ce8088371169dfee976d30022", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6d4365d3b005b39ce8088371169dfee976d30022", "committedDate": "2020-07-27T02:12:32Z", "message": "NF: BuryCard simplified"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a831ba08a4c0edf50d9933c99c0c45626d87a15", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5a831ba08a4c0edf50d9933c99c0c45626d87a15", "committedDate": "2020-07-27T02:12:32Z", "message": "NF: UndoableBuryNote simplified"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a9399e19b4095c20d3fb7198e3c730dc7fa1b5b2", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a9399e19b4095c20d3fb7198e3c730dc7fa1b5b2", "committedDate": "2020-07-26T20:34:22Z", "message": "NF: UndoableFlushAll -> revertToProvidedState"}, "afterCommit": {"oid": "231c219e4d10ec7c19e05bad82291c505ffb193e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/231c219e4d10ec7c19e05bad82291c505ffb193e", "committedDate": "2020-07-27T02:16:26Z", "message": "NF: simplifies revertToProvidedState"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fc760eaf9d95be578431d3ebd71fe9382d6f290", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5fc760eaf9d95be578431d3ebd71fe9382d6f290", "committedDate": "2020-07-29T11:03:47Z", "message": "NF: suspend Card undo simpler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a940a41010dedee9df402924363e9bfc868c23b", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7a940a41010dedee9df402924363e9bfc868c23b", "committedDate": "2020-07-29T11:05:08Z", "message": "NF: simplify suspendCardMulti undo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d34d4fd55be86c2af0fa9fd25ef469fec3a09732", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d34d4fd55be86c2af0fa9fd25ef469fec3a09732", "committedDate": "2020-07-29T11:06:40Z", "message": "NF: UndoableDeleteNote simplified"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e038000d83e950cb4c49ff8c52738a8a5f34094f", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e038000d83e950cb4c49ff8c52738a8a5f34094f", "committedDate": "2020-07-29T11:07:47Z", "message": "NF: UndoableDeleteNoteMulti simplified"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8aa86242625d36e705c806169a70135ee369a91", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/b8aa86242625d36e705c806169a70135ee369a91", "committedDate": "2020-07-29T11:08:17Z", "message": "NF: simplifies UndoableSuspendNote"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a037b670af22f5069107381a36f4f13837353bc", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6a037b670af22f5069107381a36f4f13837353bc", "committedDate": "2020-07-29T11:09:15Z", "message": "NF: UndoableChangeDeckMulti simplified"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9c7cc7a361e0cdac77a9b340b825a98d3dc7e87", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c9c7cc7a361e0cdac77a9b340b825a98d3dc7e87", "committedDate": "2020-07-29T11:10:24Z", "message": "NF: simplifies undoable mark note multi"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "891e3ea67fe18a5b5f57a59f59423ee2259b00e4", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/891e3ea67fe18a5b5f57a59f59423ee2259b00e4", "committedDate": "2020-07-29T11:11:07Z", "message": "NF: simplifies undo Reposition rescheduler reset cards"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40f9e58baa858005812ce7e8430189532d9d8503", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/40f9e58baa858005812ce7e8430189532d9d8503", "committedDate": "2020-07-29T11:11:07Z", "message": "NF: remove unused undoable flag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "688d57e90521fe05bbeded7aae06558b7a7fa331", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/688d57e90521fe05bbeded7aae06558b7a7fa331", "committedDate": "2020-07-29T11:11:16Z", "message": "NF: Removing spaces"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "577d61cf512bb86768c9dea12741cfc1de520c02", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/577d61cf512bb86768c9dea12741cfc1de520c02", "committedDate": "2020-07-29T11:11:26Z", "message": "NF: UndoableFlushAll -> revertToProvidedState"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ab67d8eee16d8288c9300b3c07300d243159611", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0ab67d8eee16d8288c9300b3c07300d243159611", "committedDate": "2020-07-29T11:11:34Z", "message": "NF: simplifies revertToProvidedState"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf14dc2363436adf64adfa5cdc196d4942e8fd4d", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/bf14dc2363436adf64adfa5cdc196d4942e8fd4d", "committedDate": "2020-07-29T11:15:05Z", "message": "Correct undo name for revertToProvidedState"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "231c219e4d10ec7c19e05bad82291c505ffb193e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/231c219e4d10ec7c19e05bad82291c505ffb193e", "committedDate": "2020-07-27T02:16:26Z", "message": "NF: simplifies revertToProvidedState"}, "afterCommit": {"oid": "bf14dc2363436adf64adfa5cdc196d4942e8fd4d", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/bf14dc2363436adf64adfa5cdc196d4942e8fd4d", "committedDate": "2020-07-29T11:15:05Z", "message": "Correct undo name for revertToProvidedState"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NjYzODA1", "url": "https://github.com/ankidroid/Anki-Android/pull/6750#pullrequestreview-457663805", "createdAt": "2020-07-29T15:56:44Z", "commit": {"oid": "bf14dc2363436adf64adfa5cdc196d4942e8fd4d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3056, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}