{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4MzcyODIz", "number": 5918, "title": "Move Flag/Mark icons to TopBar and reorder Flag", "bodyText": "Purpose / Description\n\nChanges requested in #5806\n\nRemove HTML/SVG, and place mark/flag in top bar\nSet Default for \"Flag\" to \"Always\", and \"Mark\" for \"If Room\"\nSwitch the places of Mark and Flag\n\n\n\nEDIT:\n\nAdd logic to remove duplicate icons if visible in the Action Bar.\n\nFixes\nFixes #5806\nApproach\nWe switch the HTML/SVG for an icon in the top bar. This icon is invisible if no flag/mark is selected.\nHow Has This Been Tested?\nOn my Android:\n\nVertical\nHorizontal\nWith Menu\n\nResearch\nhttps://developer.android.com/reference/android/widget/TextView#attr_android:minEms\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-04-03T20:32:20Z", "url": "https://github.com/ankidroid/Anki-Android/pull/5918", "merged": true, "mergeCommit": {"oid": "3f1db7dfade418a42a8d8c9dcdf24ada4977da78"}, "closed": true, "closedAt": "2020-04-19T16:49:18Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUHEMYgFqTM4NzU2NTI1NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZMP2rAFqTM5NjAzMTA3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NTY1MjU0", "url": "https://github.com/ankidroid/Anki-Android/pull/5918#pullrequestreview-387565254", "createdAt": "2020-04-03T20:38:28Z", "commit": {"oid": "67a2087765a098e92786ab0211b16275d4966e10"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDozODoyOFrOGAoghQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QyMDozODoyOFrOGAoghQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMxNjg2OQ==", "bodyText": "Name might do with work. CardIcons?", "url": "https://github.com/ankidroid/Anki-Android/pull/5918#discussion_r403316869", "createdAt": "2020-04-03T20:38:28Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/reviewer/CardMarker.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package com.ichi2.anki.reviewer;\n+\n+import android.view.View;\n+import android.widget.ImageView;\n+\n+import com.ichi2.anki.R;\n+\n+import androidx.annotation.DrawableRes;\n+import androidx.annotation.NonNull;\n+\n+/** Handles the star and flag marker for the card viewer */\n+public class CardMarker {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67a2087765a098e92786ab0211b16275d4966e10"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NjA2NDYw", "url": "https://github.com/ankidroid/Anki-Android/pull/5918#pullrequestreview-387606460", "createdAt": "2020-04-03T22:04:02Z", "commit": {"oid": "67a2087765a098e92786ab0211b16275d4966e10"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c54d3ba9aaca899539fd60fd1682a1756781f41e", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c54d3ba9aaca899539fd60fd1682a1756781f41e", "committedDate": "2020-04-05T13:29:08Z", "message": "Move \"Mark\" icon to right of card"}, "afterCommit": {"oid": "1698375a3be0bb6076143d7c6e9d75169a6f4c48", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/1698375a3be0bb6076143d7c6e9d75169a6f4c48", "committedDate": "2020-04-07T10:21:40Z", "message": "Hide Flag/Mark if shown in action bar\n\nWe use reflection as a best effort, and fall back to a heuristic if this\nfails.\n\nThis stops duplication of the flag/mark icon in the UI."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5OTY3NjMy", "url": "https://github.com/ankidroid/Anki-Android/pull/5918#pullrequestreview-389967632", "createdAt": "2020-04-08T13:21:58Z", "commit": {"oid": "d7d3f749fddfaa7dc9d764d934ca1fafd1b224d5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMzoyMTo1OFrOGCu-BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMzoyMTo1OFrOGCu-BQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUxOTg3Nw==", "bodyText": "This is on the API grey list for Android 9 and 10 (at least) https://android.googlesource.com/platform/frameworks/base/+/pie-release/config/hiddenapi-light-greylist.txt#8509\nHasn't moved to blacklist but it's a warning for the future. Error handling during access needs to be different: https://developer.android.com/distribute/best-practices/develop/restrictions-non-sdk-interfaces#results-of-keeping-non-sdk\nAnd we should have some sort of a test that serves as a canary for this in CI as I expect it will start throwing on higher APIs at some point\nI am unsure how the support libraries are handling graylisting but I expect it may be the same\nPerhaps since the only difference in the 3 blocks are the class name they could be somehow generalized as well, since the error handling will be semi-special having it coded once only would be a plus", "url": "https://github.com/ankidroid/Anki-Android/pull/5918#discussion_r405519877", "createdAt": "2020-04-08T13:21:58Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/ui/ActionBarOverflow.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package com.ichi2.ui;\n+\n+import android.annotation.SuppressLint;\n+import android.view.MenuItem;\n+\n+import java.lang.reflect.Method;\n+\n+import androidx.annotation.Nullable;\n+import timber.log.Timber;\n+\n+/**\n+ * Detection of whether an item is in the ActionBar overflow\n+ * WARN: When making changes to this code, also test with Proguard\n+ * */\n+public class ActionBarOverflow {\n+    //Idea from: https://stackoverflow.com/a/29208483\n+\n+    protected static final String SUPPORT_CLASS = \"android.support.v7.internal.view.menu.MenuItemImpl\";\n+\n+    protected static final String NATIVE_CLASS = \"com.android.internal.view.menu.MenuItemImpl\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7d3f749fddfaa7dc9d764d934ca1fafd1b224d5"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMTEyMDYw", "url": "https://github.com/ankidroid/Anki-Android/pull/5918#pullrequestreview-390112060", "createdAt": "2020-04-08T15:58:14Z", "commit": {"oid": "e20062026753539910045c249bcc26cba3ea2d77"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTkzNjM3", "url": "https://github.com/ankidroid/Anki-Android/pull/5918#pullrequestreview-390993637", "createdAt": "2020-04-09T17:32:05Z", "commit": {"oid": "be386e0a62d44242589074a5bc5ef4fc4b93c3a1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNzozMjowNVrOGDifew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNzozMjowNVrOGDifew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM2NDAyNw==", "bodyText": "Yeah - I don't like this structure really either, feels convoluted and fluffy at the same time\nDefinitely not a fall through, and might somehow throw an Error here as well?\nHow is it we will potentially have all 3 of these classes actually? Isn't it the case we will only have one of these classes? I would be curious to see which one of these is actually hit on API16 and API30 emulators as a quick check on the hypothesis that really only one class is ever in play", "url": "https://github.com/ankidroid/Anki-Android/pull/5918#discussion_r406364027", "createdAt": "2020-04-09T17:32:05Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/ui/ActionBarOverflow.java", "diffHunk": "@@ -0,0 +1,127 @@\n+package com.ichi2.ui;\n+\n+import android.annotation.SuppressLint;\n+import android.view.MenuItem;\n+\n+import java.lang.reflect.Method;\n+\n+import androidx.annotation.CheckResult;\n+import androidx.annotation.Nullable;\n+import androidx.annotation.VisibleForTesting;\n+import timber.log.Timber;\n+\n+/**\n+ * Detection of whether an item is in the ActionBar overflow\n+ * WARN: When making changes to this code, also test with Proguard\n+ * */\n+public class ActionBarOverflow {\n+    //Idea from: https://stackoverflow.com/a/29208483\n+\n+    protected static final String SUPPORT_CLASS = \"android.support.v7.internal.view.menu.MenuItemImpl\";\n+\n+    protected static final String NATIVE_CLASS = \"com.android.internal.view.menu.MenuItemImpl\";\n+\n+    protected static final String ANDROIDX_CLASS = \"androidx.appcompat.view.menu.MenuItemImpl\";\n+\n+    protected static Method sSupportIsActionButton;\n+\n+    protected static Method sNativeIsActionButton;\n+\n+    protected static Method sAndroidXIsActionButton;\n+\n+    static {\n+        setupMethods(ActionBarOverflow::getPrivateMethodHandleSystemErrors);\n+    }\n+\n+    @VisibleForTesting\n+    static void setupMethods(PrivateMethodAccessor accessor) {\n+        //Note: Multiple of these can succeed.\n+        sNativeIsActionButton = accessor.getPrivateMethod(NATIVE_CLASS, \"isActionButton\");\n+        sSupportIsActionButton = accessor.getPrivateMethod(SUPPORT_CLASS, \"isActionButton\");\n+        sAndroidXIsActionButton = accessor.getPrivateMethod(ANDROIDX_CLASS, \"isActionButton\");\n+    }\n+\n+\n+    @CheckResult\n+    private static Method getPrivateMethodHandleSystemErrors(String className, String methodName) {\n+        Method action = null;\n+        try {\n+            //We know this won't always work, we'll log if this isn't the case.\n+            @SuppressLint(\"PrivateApi\") Class<?> MenuItemImpl = Class.forName(className);\n+            action = MenuItemImpl.getDeclaredMethod(methodName);\n+            action.setAccessible(true);\n+            Timber.d(\"Setup ActionBarOverflow: %s\", className);\n+        } catch (Exception | NoSuchFieldError | NoSuchMethodError ignoreAndLogEx) {\n+            //See: #5806. MenuItemImpl;->isActionButton is on the light greylist\n+            //https://developer.android.com/distribute/best-practices/develop/restrictions-non-sdk-interfaces#results-of-keeping-non-sdk\n+            Timber.d(ignoreAndLogEx, \"Failed to handle: %s\", className);\n+        }\n+\n+        return action;\n+    }\n+\n+    /**\n+     * Check if an item is showing (not in the overflow menu).\n+     *\n+     * @param item\n+     *            the MenuItem.\n+     * @return {@code true} if the MenuItem is visible on the ActionBar. {@code false} if not. {@code null if unknown}\n+     */\n+    public static @Nullable Boolean isActionButton(MenuItem item) {\n+        //I don't think falling through is the right action here.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be386e0a62d44242589074a5bc5ef4fc4b93c3a1"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "753d293f1f95e4349441d6bcf8810598428b1f67", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/753d293f1f95e4349441d6bcf8810598428b1f67", "committedDate": "2020-04-18T22:11:23Z", "message": "Move Flag and Mark to top bar\n\nFixes #5806\n\nFlag and mark were previously defined as SVGs in the HTML, this was not\nideal as it changed the layout of he cards when they were shown. Instead\nwe define these in the top bar."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4b707817165a08fa401f728dc7e31a99d2ad55c", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d4b707817165a08fa401f728dc7e31a99d2ad55c", "committedDate": "2020-04-18T22:11:31Z", "message": "Display \"Flag\" instead of \"Mark\" by Default\n\nThis default change only affects new users\n\nMenuItem.SHOW_AS_ACTION_IF_ROOM = 1\nMenuItem.SHOW_AS_ACTION_ALWAYS\u00a0 = 2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0dc1516ddce62813d5bfbccc0dd38cec4e7b523", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f0dc1516ddce62813d5bfbccc0dd38cec4e7b523", "committedDate": "2020-04-18T22:11:32Z", "message": "Keep \"Edit Note\" as first item in menu\n\nEdit Note should have priority as the first item in the\n\"additional items\" menu."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e5e2efcbf26098b5401e0813ffd8b4dc500a458", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9e5e2efcbf26098b5401e0813ffd8b4dc500a458", "committedDate": "2020-04-18T22:11:32Z", "message": "Move \"Mark\" icon to right of card"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf1fabbc372d3f2b6e7d9427a1b0998352247571", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/bf1fabbc372d3f2b6e7d9427a1b0998352247571", "committedDate": "2020-04-19T08:44:20Z", "message": "NF: Extract class: ActionButtonStatus\n\nIt's going to be a useful abstraction in the logic to check whether an\nitem is \"always/ifRoom\" for the top-bar icons, so might as well make the\nlogic more clear."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65580ecb0289f29c50a3368aca59261cbb4864bd", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/65580ecb0289f29c50a3368aca59261cbb4864bd", "committedDate": "2020-04-19T08:44:24Z", "message": "NF: Move mActionButtonStatus to subclass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21cd6b7a3daef5d4e427fc829d53050da9447452", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/21cd6b7a3daef5d4e427fc829d53050da9447452", "committedDate": "2020-04-19T08:44:24Z", "message": "NF: Clean up ActionBarStatus.setup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80dcc394d6bed0aaa1b60b07c3aa300900ed7880", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/80dcc394d6bed0aaa1b60b07c3aa300900ed7880", "committedDate": "2020-04-19T08:44:25Z", "message": "Made flag the default actionItem"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17612d1ca513c8d384b32bf4bf1cfad300098921", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/17612d1ca513c8d384b32bf4bf1cfad300098921", "committedDate": "2020-04-19T08:44:25Z", "message": "NF CardViewer: Extract flag/mark data\n\nThis is to be overridden in Reviewer in a later commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb06a2548abf5c7b97defb14e5a01558539f241a", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/eb06a2548abf5c7b97defb14e5a01558539f241a", "committedDate": "2020-04-19T08:44:25Z", "message": "NF: Move mActionButtonStatus to subclass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d98da4a4de10554945009268203a3e5e97beccb3", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d98da4a4de10554945009268203a3e5e97beccb3", "committedDate": "2020-04-19T08:44:25Z", "message": "Hide Flag/Mark if shown in action bar\n\nWe use reflection as a best effort, and fall back to a heuristic if this\nfails.\n\nThis stops duplication of the flag/mark icon in the UI."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0442955c92eb83443a703b20d119ae6c3aa5ac2c", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0442955c92eb83443a703b20d119ae6c3aa5ac2c", "committedDate": "2020-04-19T08:44:26Z", "message": "Switch Flag and Mark Positions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d37b5f6f5b950e23c6b563aef3d3814d133a3d0f", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d37b5f6f5b950e23c6b563aef3d3814d133a3d0f", "committedDate": "2020-04-19T08:44:26Z", "message": "NF: ActionBarOverflow - Add debug logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfb3b234b85774022143e6c1213fd44802e16d9f", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/dfb3b234b85774022143e6c1213fd44802e16d9f", "committedDate": "2020-04-19T08:44:26Z", "message": "Handled Error and added regression check\n\nWe use a graylisted method, and errors will eventually be thrown"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b36d395c60c657e9d2e3ca3adbec0d79b624fd1", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9b36d395c60c657e9d2e3ca3adbec0d79b624fd1", "committedDate": "2020-04-19T08:44:26Z", "message": "NF: ActionBarOverflow Fix PrettyPrinting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5e1dfdd72c2367dd89fb17b300b7fbe5b2607e1", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e5e1dfdd72c2367dd89fb17b300b7fbe5b2607e1", "committedDate": "2020-04-19T08:44:26Z", "message": "Remove Mark/Flag from CSS\n\nNow in topbar."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd4b57a4fe821c523c983a59164a556370fe4844", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/fd4b57a4fe821c523c983a59164a556370fe4844", "committedDate": "2020-04-19T08:44:27Z", "message": "Add additional tests to ActionBarOverflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0aaf345bfb5aafb64a35af746b7edcf90d3e0b5e", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0aaf345bfb5aafb64a35af746b7edcf90d3e0b5e", "committedDate": "2020-04-19T08:44:27Z", "message": "ActionBarOverflow: Remove support class\nAdd Error handlers for reflection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62bcc85d2e1932987225c0d0f2eb9b0eb776270b", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/62bcc85d2e1932987225c0d0f2eb9b0eb776270b", "committedDate": "2020-04-19T09:27:30Z", "message": "Convert isActionButton to accept subclasses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dd089d7c5fd99bd153f18490a4e6b802d1841c43", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/dd089d7c5fd99bd153f18490a4e6b802d1841c43", "committedDate": "2020-04-18T19:17:26Z", "message": "ActionBarOverflow: Remove support class\nAdd Error handlers for reflection"}, "afterCommit": {"oid": "62bcc85d2e1932987225c0d0f2eb9b0eb776270b", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/62bcc85d2e1932987225c0d0f2eb9b0eb776270b", "committedDate": "2020-04-19T09:27:30Z", "message": "Convert isActionButton to accept subclasses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MDI2Nzkx", "url": "https://github.com/ankidroid/Anki-Android/pull/5918#pullrequestreview-396026791", "createdAt": "2020-04-19T14:47:17Z", "commit": {"oid": "62bcc85d2e1932987225c0d0f2eb9b0eb776270b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQxNDo0NzoxOFrOGH4pjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQxNDo0NzoxOFrOGH4pjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkyMTM1OA==", "bodyText": "So the way to get rid of the codacy issue is to put this in a try/catch, and instead of having comments that take you out of the code, you put those in the fail message inside the catch", "url": "https://github.com/ankidroid/Anki-Android/pull/5918#discussion_r410921358", "createdAt": "2020-04-19T14:47:18Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/ui/ActionBarOverflowTest.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package com.ichi2.ui;\n+\n+import android.content.Context;\n+import android.view.MenuItem;\n+\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import java.lang.reflect.Constructor;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+\n+import androidx.appcompat.view.menu.MenuBuilder;\n+import androidx.test.platform.app.InstrumentationRegistry;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.notNullValue;\n+\n+@RunWith(androidx.test.ext.junit.runners.AndroidJUnit4.class)\n+public class ActionBarOverflowTest {\n+\n+    @Test\n+    public void hasValidActionBarReflectionMethod() {\n+        assertThat(\"Ensures that there is a valid way to obtain a listener\",\n+                ActionBarOverflow.hasUsableMethod(), is(true));\n+    }\n+\n+    @Test\n+    public void errorsAreBeingThrownCanary() {\n+        //See discussion on #5806\n+        //https://developer.android.com/distribute/best-practices/develop/restrictions-non-sdk-interfaces\n+        //Once this throws, errors are being thrown on a currently graylisted method\n+        ActionBarOverflow.setupMethods(ActionBarOverflow::getPrivateMethodOnlyHandleExceptions);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62bcc85d2e1932987225c0d0f2eb9b0eb776270b"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "823cb8faf577c554f64f06a1cd72feaabc9d0f22", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/823cb8faf577c554f64f06a1cd72feaabc9d0f22", "committedDate": "2020-04-19T14:54:40Z", "message": "NF: Codacy Fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MDI3ODA2", "url": "https://github.com/ankidroid/Anki-Android/pull/5918#pullrequestreview-396027806", "createdAt": "2020-04-19T14:57:09Z", "commit": {"oid": "823cb8faf577c554f64f06a1cd72feaabc9d0f22"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQxNDo1NzowOVrOGH4wdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQxNDo1NzowOVrOGH4wdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkyMzEyNQ==", "bodyText": "Issue found: The utility class name 'ActionBarOverflow' doesn't match '[A-Z][a-zA-Z0-9]+(Utils?|Helper)'", "url": "https://github.com/ankidroid/Anki-Android/pull/5918#discussion_r410923125", "createdAt": "2020-04-19T14:57:09Z", "author": {"login": "timrae"}, "path": "AnkiDroid/src/main/java/com/ichi2/ui/ActionBarOverflow.java", "diffHunk": "@@ -0,0 +1,130 @@\n+package com.ichi2.ui;\n+\n+import android.util.Pair;\n+import android.view.MenuItem;\n+\n+import java.lang.reflect.Method;\n+\n+import androidx.annotation.CheckResult;\n+import androidx.annotation.Nullable;\n+import androidx.annotation.VisibleForTesting;\n+import timber.log.Timber;\n+\n+/**\n+ * Detection of whether an item is in the ActionBar overflow\n+ * WARN: When making changes to this code, also test with Proguard\n+ * */\n+public class ActionBarOverflow {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "823cb8faf577c554f64f06a1cd72feaabc9d0f22"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MDMxMDc3", "url": "https://github.com/ankidroid/Anki-Android/pull/5918#pullrequestreview-396031077", "createdAt": "2020-04-19T15:30:22Z", "commit": {"oid": "823cb8faf577c554f64f06a1cd72feaabc9d0f22"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3582, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}