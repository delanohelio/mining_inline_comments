{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxODA0Mjc5", "number": 5964, "title": "only call Sched.reset() once on scheduler opening", "bodyText": "Pull Request template\nPurpose / Description\nLoading my top level deck is long on my phone. Ten seconds. I want to improve that. On my collection and my phone, scheduler's reset take 4 seconds, so I want to avoid doing it in a case where it's absolutely not necessary.\nFixes\nReset is done twice when reviewer is opened from deck picker. This is because:\n\nto check whether the deck can be reviewer, reset is done to see the\ncorrect number of card\nwhen reviewer starts, it calls reset to check whether there are\nactually cards to review/create the queue\n\nBoth actions are useful, but in this case it's a duplicate. Since\nstarting to review a deck from the list of deck is actually an action\nperformed often, it's important that it gets optimized, and thus I add\na notion of \"reset done\" to the intent, to state that reset does not\nhave to be done immediately by reviewer. I also ensure that future\nresets are actually done.\nApproach\nAdding an extra value to intent when reset was done, so that reviewer know it does not have to do it.\nI'm surprised, because on https://developer.android.com/reference/android/content/Intent#putExtra(java.lang.String,%20android.os.Bundle) it states that extra name:\n\nmust include a package prefix, for example the app com.android.contacts would use names like \"com.android.contacts.ShowAll\".\n\nAnd it seems this has not be done in other putExtra in the code\nHow Has This Been Tested?\nAdding this to my \"merge\" branch, running the profiler, and ensuring that \"reset\" was run only once when I clicked on a deck.\nLearning (optional, can help others)\nProfilers are wonderful things.\nChecklist\nPlease, go through these checks before submitting the PR.\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-04-10T08:01:26Z", "url": "https://github.com/ankidroid/Anki-Android/pull/5964", "merged": true, "mergeCommit": {"oid": "231aae7ddd1ee513126892c794504d37303f78e5"}, "closed": true, "closedAt": "2020-04-10T20:32:42Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWM9h4gBqjMyMjEyMTExMTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWWGCFgFqTM5MTYxNDkxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c8d10bf73678add2990d5ce49cd1ab3f93b2ba46", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c8d10bf73678add2990d5ce49cd1ab3f93b2ba46", "committedDate": "2020-04-09T22:56:47Z", "message": "Reset done a single time on scheduler openinig\n\nOn my collection and my phone, scheduler's reset take 4 seconds. It's\ndone twice when reviewer is opened from deck picker. This is because:\n* to check whether the deck can be reviewer, reset is done to see the\n  correct number of card\n* when reviewer starts, it calls reset to check whether there are\n  actually cards to review/create the queue\n\nBoth actions are useful, but in this case it's a duplicate. Since\nstarting to review a deck from the list of deck is actually an action\nperformed often, it's important that it gets optimized, and thus I add\na notion of \"reset done\" to the intent, to state that reset does not\nhave to be done immediately by reviewer. I also ensure that future\nresets are actually done."}, "afterCommit": {"oid": "e14315c6cecab8c3799f1be9492aaef0fb132e4c", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e14315c6cecab8c3799f1be9492aaef0fb132e4c", "committedDate": "2020-04-10T08:38:17Z", "message": "Reset done a single time on scheduler openinig\n\nOn my collection and my phone, scheduler's reset take 4 seconds. It's\ndone twice when reviewer is opened from deck picker. This is because:\n* to check whether the deck can be reviewer, reset is done to see the\n  correct number of card\n* when reviewer starts, it calls reset to check whether there are\n  actually cards to review/create the queue\n\nBoth actions are useful, but in this case it's a duplicate. Since\nstarting to review a deck from the list of deck is actually an action\nperformed often, it's important that it gets optimized, and thus I add\na notion of \"reset done\" to the intent, to state that reset does not\nhave to be done immediately by reviewer. I also ensure that future\nresets are actually done."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNTgyNDk3", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#pullrequestreview-391582497", "createdAt": "2020-04-10T18:07:04Z", "commit": {"oid": "e14315c6cecab8c3799f1be9492aaef0fb132e4c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxODowNzowNFrOGEBuzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxODowNzo0N1rOGEBwFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NTg1NQ==", "bodyText": "If we do this, it's a member variable so it should be mSomething\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private boolean reset_done = false;\n          \n          \n            \n                private boolean mSchedResetDone = false;", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#discussion_r406875855", "createdAt": "2020-04-10T18:07:04Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -61,6 +61,9 @@\n     private boolean mBlackWhiteboard = true;\n     private boolean mPrefFullscreenReview = false;\n     private static final int ADD_NOTE = 12;\n+    // Deck picker reset scheduler before opening the reviewer. So\n+    // first reset is useless.\n+    private boolean reset_done = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e14315c6cecab8c3799f1be9492aaef0fb132e4c"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NTk4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        reset_done = true;\n          \n          \n            \n                        mSchedResetDone = true;", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#discussion_r406875982", "createdAt": "2020-04-10T18:07:26Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -96,6 +99,10 @@ protected void onCreate(Bundle savedInstanceState) {\n         Timber.d(\"onCreate()\");\n         super.onCreate(savedInstanceState);\n \n+        if (getIntent().hasExtra(\"com.ichi2.anki.reset_done\")) {\n+            Timber.d(\"reset done\");\n+            reset_done = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e14315c6cecab8c3799f1be9492aaef0fb132e4c"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NjE4Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!reset_done) {\n          \n          \n            \n                        col.getSched().reset();     // Reset schedule in case card had previous been loaded\n          \n          \n            \n                        reset_done = false;\n          \n          \n            \n                    }\n          \n          \n            \n                    if (!mSchedResetDone) {\n          \n          \n            \n                        col.getSched().reset();     // Reset schedule in case card was previously loaded\n          \n          \n            \n                        mSchedReset = false;\n          \n          \n            \n                    }", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#discussion_r406876183", "createdAt": "2020-04-10T18:07:47Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -171,7 +178,10 @@ protected void onCollectionLoaded(Collection col) {\n             setWhiteboardVisibility(whiteboardVisibility);\n         }\n \n-        col.getSched().reset();     // Reset schedule incase card had previous been loaded\n+        if (!reset_done) {\n+            col.getSched().reset();     // Reset schedule in case card had previous been loaded\n+            reset_done = false;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e14315c6cecab8c3799f1be9492aaef0fb132e4c"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9de9db89da4164924fdcfb50da4df1cd620d1f6a", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9de9db89da4164924fdcfb50da4df1cd620d1f6a", "committedDate": "2020-04-10T19:05:45Z", "message": "Reset done a single time on scheduler openinig\n\nOn my collection and my phone, scheduler's reset take 4 seconds. It's\ndone twice when reviewer is opened from deck picker. This is because:\n* to check whether the deck can be reviewer, reset is done to see the\n  correct number of card\n* when reviewer starts, it calls reset to check whether there are\n  actually cards to review/create the queue\n\nBoth actions are useful, but in this case it's a duplicate. Since\nstarting to review a deck from the list of deck is actually an action\nperformed often, it's important that it gets optimized, and thus I add\na notion of \"reset done\" to the intent, to state that reset does not\nhave to be done immediately by reviewer. I also ensure that future\nresets are actually done."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e14315c6cecab8c3799f1be9492aaef0fb132e4c", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e14315c6cecab8c3799f1be9492aaef0fb132e4c", "committedDate": "2020-04-10T08:38:17Z", "message": "Reset done a single time on scheduler openinig\n\nOn my collection and my phone, scheduler's reset take 4 seconds. It's\ndone twice when reviewer is opened from deck picker. This is because:\n* to check whether the deck can be reviewer, reset is done to see the\n  correct number of card\n* when reviewer starts, it calls reset to check whether there are\n  actually cards to review/create the queue\n\nBoth actions are useful, but in this case it's a duplicate. Since\nstarting to review a deck from the list of deck is actually an action\nperformed often, it's important that it gets optimized, and thus I add\na notion of \"reset done\" to the intent, to state that reset does not\nhave to be done immediately by reviewer. I also ensure that future\nresets are actually done."}, "afterCommit": {"oid": "9de9db89da4164924fdcfb50da4df1cd620d1f6a", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9de9db89da4164924fdcfb50da4df1cd620d1f6a", "committedDate": "2020-04-10T19:05:45Z", "message": "Reset done a single time on scheduler openinig\n\nOn my collection and my phone, scheduler's reset take 4 seconds. It's\ndone twice when reviewer is opened from deck picker. This is because:\n* to check whether the deck can be reviewer, reset is done to see the\n  correct number of card\n* when reviewer starts, it calls reset to check whether there are\n  actually cards to review/create the queue\n\nBoth actions are useful, but in this case it's a duplicate. Since\nstarting to review a deck from the list of deck is actually an action\nperformed often, it's important that it gets optimized, and thus I add\na notion of \"reset done\" to the intent, to state that reset does not\nhave to be done immediately by reviewer. I also ensure that future\nresets are actually done."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxNjE0OTEz", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#pullrequestreview-391614913", "createdAt": "2020-04-10T19:16:55Z", "commit": {"oid": "9de9db89da4164924fdcfb50da4df1cd620d1f6a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3621, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}