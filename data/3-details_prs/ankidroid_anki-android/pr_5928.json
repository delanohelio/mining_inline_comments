{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4Nzk5OTgx", "number": 5928, "title": "Cache name normalization", "bodyText": "Pull Request template\nPurpose / Description\nProfiling Ankidroid, I realized that ankidroid spent 12 seconds on\nstartup in the method normalize. That's far too much. I actually have\ntrouble believing the profiler here. (More precisely it mostly spent\ntime in \"toLowerCase\")\nAnyway, I added this simple caching method, so that it becomes far\nquicker. After all, caching is not context dependant, it always give\nthe same output to the same input, so we never have any need to empty\nthe cache, so that's perfect here\nFixes\nAnki startup still takes more than half a minute\nApproach\nProfiling and checking where time is spent\nHow Has This Been Tested?\nInstalling on the phone and using it. Looking at profiler and realizing that the time decreased in this method.\nLearning (optional, can help others)\nProfilers are hard to use\nChecklist\nPlease, go through these checks before submitting the PR.\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-04-04T22:47:21Z", "url": "https://github.com/ankidroid/Anki-Android/pull/5928", "merged": true, "mergeCommit": {"oid": "ad10b0360b65bdb968fc2017b63277e7d10af94a"}, "closed": true, "closedAt": "2020-04-09T17:07:44Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUdxuwAFqTM4Nzc2NTk0NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcV767DgFqTM5MDc1OTIwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NzY1OTQ1", "url": "https://github.com/ankidroid/Anki-Android/pull/5928#pullrequestreview-387765945", "createdAt": "2020-04-04T23:06:08Z", "commit": {"oid": "97d7451bf21a76f7e33b03f3d94333e47964fa5b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "97d7451bf21a76f7e33b03f3d94333e47964fa5b", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/97d7451bf21a76f7e33b03f3d94333e47964fa5b", "committedDate": "2020-04-04T22:42:18Z", "message": "Cache name normalization\n\nProfiling Ankidroid, I realized that ankidroid spent 12 seconds on\nstartup in the method normalize. That's far too much. I actually have\ntrouble believing the profiler here. (More precisely it mostly spent\ntime in \"toLowerCase\")\n\nAnyway, I added this simple caching method, so that it becomes far\nquicker. After all, caching is not context dependant, it always give\nthe same output to the same input, so we never have any need to empty\nthe cache, so that's perfect here"}, "afterCommit": {"oid": "2acb1388299e69de2069d60d3d40f75b5ee883bb", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2acb1388299e69de2069d60d3d40f75b5ee883bb", "committedDate": "2020-04-07T00:04:54Z", "message": "Cache name normalization\n\nProfiling Ankidroid, I realized that ankidroid spent 12 seconds on\nstartup in the method normalize. That's far too much. I actually have\ntrouble believing the profiler here. (More precisely it mostly spent\ntime in \"toLowerCase\")\n\nAnyway, I added this simple caching method, so that it becomes far\nquicker. After all, caching is not context dependant, it always give\nthe same output to the same input, so we never have any need to empty\nthe cache, so that's perfect here"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6254b0235910593d33e40780e56e75fb73056047", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6254b0235910593d33e40780e56e75fb73056047", "committedDate": "2020-04-09T12:39:22Z", "message": "Cache name normalization\n\nProfiling Ankidroid, I realized that ankidroid spent 12 seconds on\nstartup in the method normalize. That's far too much. I actually have\ntrouble believing the profiler here. (More precisely it mostly spent\ntime in \"toLowerCase\")\n\nAnyway, I added this simple caching method, so that it becomes far\nquicker. After all, caching is not context dependant, it always give\nthe same output to the same input, so we never have any need to empty\nthe cache, so that's perfect here"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2acb1388299e69de2069d60d3d40f75b5ee883bb", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2acb1388299e69de2069d60d3d40f75b5ee883bb", "committedDate": "2020-04-07T00:04:54Z", "message": "Cache name normalization\n\nProfiling Ankidroid, I realized that ankidroid spent 12 seconds on\nstartup in the method normalize. That's far too much. I actually have\ntrouble believing the profiler here. (More precisely it mostly spent\ntime in \"toLowerCase\")\n\nAnyway, I added this simple caching method, so that it becomes far\nquicker. After all, caching is not context dependant, it always give\nthe same output to the same input, so we never have any need to empty\nthe cache, so that's perfect here"}, "afterCommit": {"oid": "6254b0235910593d33e40780e56e75fb73056047", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6254b0235910593d33e40780e56e75fb73056047", "committedDate": "2020-04-09T12:39:22Z", "message": "Cache name normalization\n\nProfiling Ankidroid, I realized that ankidroid spent 12 seconds on\nstartup in the method normalize. That's far too much. I actually have\ntrouble believing the profiler here. (More precisely it mostly spent\ntime in \"toLowerCase\")\n\nAnyway, I added this simple caching method, so that it becomes far\nquicker. After all, caching is not context dependant, it always give\nthe same output to the same input, so we never have any need to empty\nthe cache, so that's perfect here"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzU5MjAz", "url": "https://github.com/ankidroid/Anki-Android/pull/5928#pullrequestreview-390759203", "createdAt": "2020-04-09T12:47:15Z", "commit": {"oid": "6254b0235910593d33e40780e56e75fb73056047"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo0NzoxNVrOGDXK2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMjo0NzoxNVrOGDXK2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE3ODUyMA==", "bodyText": "Issue found: Fields should be declared at the top of the class, before any method declarations, constructors, initializers or inner classes.", "url": "https://github.com/ankidroid/Anki-Android/pull/5928#discussion_r406178520", "createdAt": "2020-04-09T12:47:15Z", "author": {"login": "timrae"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "diffHunk": "@@ -1007,10 +1007,12 @@ public boolean isDyn(long did) {\n      * utils methods\n      * **************************************\n      */\n+    private static HashMap<String, String> normalized = new HashMap<String, String>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6254b0235910593d33e40780e56e75fb73056047"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3585, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}