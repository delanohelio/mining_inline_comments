{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5Mzk5MTE4", "number": 7468, "title": "Fix Build failures:  testAnki2Updates and testTabOrder", "bodyText": "IDE-based lint warning on comparing using == rather than .equals()\nPlease check 9674085 when reviewing - it appeared incorrect, but maybe I missed the context of the code.\nFixes\nFixes #7467\nFixes #7470", "createdAt": "2020-10-24T08:56:56Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7468", "merged": true, "mergeCommit": {"oid": "9d915b6cc98105acdf5e2d560b88117ac27d7ae8"}, "closed": true, "closedAt": "2020-10-24T15:22:04Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVp6yjAFqTUxNjI3MjMwMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVszqlAFqTUxNjI4NTMxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MjcyMzAz", "url": "https://github.com/ankidroid/Anki-Android/pull/7468#pullrequestreview-516272303", "createdAt": "2020-10-24T11:59:49Z", "commit": {"oid": "967408551a9524e80dc0f4dc4d8058022555ab28"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxMTo1OTo1MFrOHnuhzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxMTo1OTo1MFrOHnuhzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQxODgzMQ==", "bodyText": "Utils.equals seems to be what you are looking for here", "url": "https://github.com/ankidroid/Anki-Android/pull/7468#discussion_r511418831", "createdAt": "2020-10-24T11:59:50Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/utils/ObjectUtils.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ *  Copyright (c) 2020 David Allison <davidallisongithub@gmail.com>\n+ *\n+ *  This program is free software; you can redistribute it and/or modify it under\n+ *  the terms of the GNU General Public License as published by the Free Software\n+ *  Foundation; either version 3 of the License, or (at your option) any later\n+ *  version.\n+ *\n+ *  This program is distributed in the hope that it will be useful, but WITHOUT ANY\n+ *  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A\n+ *  PARTICULAR PURPOSE. See the GNU General Public License for more details.\n+ *\n+ *  You should have received a copy of the GNU General Public License along with\n+ *  this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package com.ichi2.libanki.utils;\n+\n+public class ObjectUtils {\n+    private ObjectUtils() {\n+\n+    }\n+\n+    public static boolean equals(Object a, Object b) {\n+        // Normally we'd use compat - but we're optimising for perf.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "967408551a9524e80dc0f4dc4d8058022555ab28"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "796afea7f8ee5044ac984076565907b97a6cf72f", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/796afea7f8ee5044ac984076565907b97a6cf72f", "committedDate": "2020-10-24T12:06:34Z", "message": "Fix test failure\n\ncom.ichi2.anki.tests.libanki.ImportTest > testAnki2Updates[test(AVD) - 4.1.2] FAILED\n\tjava.lang.AssertionError: expected:<1> but was:<0>\n\tat org.junit.Assert.fail(Assert.java:88)\n\nFixes 7467"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa46be757cb3b6c69171f3b7be6c19e78a1ae8ca", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/aa46be757cb3b6c69171f3b7be6c19e78a1ae8ca", "committedDate": "2020-10-24T12:06:34Z", "message": "Fix inconsistent use of mid"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "967408551a9524e80dc0f4dc4d8058022555ab28", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/967408551a9524e80dc0f4dc4d8058022555ab28", "committedDate": "2020-10-24T08:55:12Z", "message": "Fix inconsistent use of mid"}, "afterCommit": {"oid": "aa46be757cb3b6c69171f3b7be6c19e78a1ae8ca", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/aa46be757cb3b6c69171f3b7be6c19e78a1ae8ca", "committedDate": "2020-10-24T12:06:34Z", "message": "Fix inconsistent use of mid"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MjczNjI0", "url": "https://github.com/ankidroid/Anki-Android/pull/7468#pullrequestreview-516273624", "createdAt": "2020-10-24T12:21:38Z", "commit": {"oid": "aa46be757cb3b6c69171f3b7be6c19e78a1ae8ca"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd39a634329a857504150d5025830dbd618051cc", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/bd39a634329a857504150d5025830dbd618051cc", "committedDate": "2020-10-24T14:02:28Z", "message": "Fix Test: Ignore testTabOrder on API 25 and 30\n\nFixes 7470"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "581078bd446885fd179bbed9857bb96bf2746d1b", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/581078bd446885fd179bbed9857bb96bf2746d1b", "committedDate": "2020-10-24T13:23:32Z", "message": "Fix Test: Ignore testTabOrder on API 25 and 30\n\nFixes 7470"}, "afterCommit": {"oid": "bd39a634329a857504150d5025830dbd618051cc", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/bd39a634329a857504150d5025830dbd618051cc", "committedDate": "2020-10-24T14:02:28Z", "message": "Fix Test: Ignore testTabOrder on API 25 and 30\n\nFixes 7470"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mjg1MTcy", "url": "https://github.com/ankidroid/Anki-Android/pull/7468#pullrequestreview-516285172", "createdAt": "2020-10-24T15:19:52Z", "commit": {"oid": "bd39a634329a857504150d5025830dbd618051cc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxNToxOTo1MlrOHnycyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxNToxOTo1MlrOHnycyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ4MzA4MA==", "bodyText": "Wellll....that's unexpected. Wow.", "url": "https://github.com/ankidroid/Anki-Android/pull/7468#discussion_r511483080", "createdAt": "2020-10-24T15:19:52Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/NoteEditorTabOrderTest.java", "diffHunk": "@@ -44,21 +45,22 @@\n import static org.junit.Assume.assumeThat;\n \n @RunWith(androidx.test.ext.junit.runners.AndroidJUnit4.class)\n-public class NoteEditorTest {\n-\n-    @Rule public ActivityScenarioRule<NoteEditor> activityRule = new ActivityScenarioRule<>(getStartActivityIntent());\n-    @Rule public GrantPermissionRule mRuntimePermissionRule = GrantPermissionRule.grant(WRITE_EXTERNAL_STORAGE);\n-\n-    @NonNull\n-    private Intent getStartActivityIntent() {\n-        Intent intent = new Intent(getTargetContext(), NoteEditor.class);\n-        intent.setComponent(new ComponentName(getTargetContext(), NoteEditor.class));\n-        intent.putExtra(NoteEditor.EXTRA_CALLER, NoteEditor.CALLER_DECKPICKER);\n-        return intent;\n+public class NoteEditorTabOrderTest {\n+\n+    public NoteEditorTabOrderTest() {\n+        // Rules mean that we get a failure on API 25.\n+        // Even if we ignore the tests, the rules cause a failure.\n+        // We can't ignore the test in @BeforeClass (\"Test run failed to complete. Expected 150 tests, received 149\")\n+        // and @Before executes after the rule.\n+        // So, disable the rules in the constructor, and ignore in before.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd39a634329a857504150d5025830dbd618051cc"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mjg1MjA0", "url": "https://github.com/ankidroid/Anki-Android/pull/7468#pullrequestreview-516285204", "createdAt": "2020-10-24T15:20:17Z", "commit": {"oid": "aa46be757cb3b6c69171f3b7be6c19e78a1ae8ca"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxNToyMDoxOFrOHnyc_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxNToyMDoxOFrOHnyc_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ4MzEzMw==", "bodyText": "interesting! I guess that was a confluence of your change at the same time as the \"less long\" PR", "url": "https://github.com/ankidroid/Anki-Android/pull/7468#discussion_r511483133", "createdAt": "2020-10-24T15:20:18Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/importer/Anki2Importer.java", "diffHunk": "@@ -408,7 +408,7 @@ private void _prepareModels() {\n             if (srcScm.equals(dstScm)) {\n                 // they do; we can reuse this mid\n                 Model model = srcModel.deepClone();\n-                model.put(\"id\", mid);\n+                model.put(\"id\", (long) mid);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa46be757cb3b6c69171f3b7be6c19e78a1ae8ca"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mjg1MzE3", "url": "https://github.com/ankidroid/Anki-Android/pull/7468#pullrequestreview-516285317", "createdAt": "2020-10-24T15:21:54Z", "commit": {"oid": "bd39a634329a857504150d5025830dbd618051cc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3873, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}