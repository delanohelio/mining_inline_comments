{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MTU1MzQ0", "number": 6547, "title": "NF: _groupChildrenMain simplification", "bodyText": "What differs from last PR:\nI added a test which should have detected this bug (by having multiple children of a deck at the same depth)\nPreviously, tail contained both \"A\" and all of its descendants. Then tail was used to compute children which contains all descendants of \"A\" but not \"A\" itself. I've changed it so that we directly compute \"children\". What I forgot to cherry pick in the previous PR is : stop adding elements to \"children\" when it is already constructed. Now, it is done, I removed the line which iterated over children and added its elements to children.\nI\u00a0would like to note that this bug did not occur in the big PR, because this line was removed in another commit. My main problem here was simply that my PR could not be as easily cut in multiple independant sub PR as what I thought.\nCopy of the last explanation, as in #6539\nThis use the fact that _groupChildrenMain is called only after the\ndeck collection is checked, so there is no duplicate and each nested\ndeck has a parent.\nCurrently what occurs is that, if you have the list of deck [\"A\",\n\"A::B\", \"A::C\", \"A::C::D\", \"E\"], the function will first process the\nsublist [\"A\", \"A::B\", \"A::C\", \"A::C::D\"] and then the sublist\n[\"E\"] (this is because it looks only as the first component of the\nname)\nThen, in the first sublist, it will look for the parent \"A\" and the\nchildren [\"A::B\", \"A::C\", \"A::C::D\"], by looking at which deck has\ndepth 0... that is useles, because, thanks to the sorting, we know the\nparent exists and is the first element of the list. Therefore, I\nremoving the condition dealing with the first element of the list and\nuse the fact that I know that it is the first element.\nBy itself it should be a really really small improvement. However, it\nallows to simplify the code and eventually to add great improvement\ninto it.", "createdAt": "2020-06-24T11:49:07Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6547", "merged": true, "mergeCommit": {"oid": "9c1a1faac4cc606be8c1b0087fa2b7b4f1a5314d"}, "closed": true, "closedAt": "2020-06-24T20:04:04Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuYjLwgH2gAyNDM5MTU1MzQ0OjViZmI5MzRjNWY1MjA5OWRmOGUyMzcyMTE0MTliMzNhYzE1ZTNmMmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcufsw6gFqTQzNjk2NTE2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5bfb934c5f52099df8e237211419b33ac15e3f2a", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5bfb934c5f52099df8e237211419b33ac15e3f2a", "committedDate": "2020-06-24T11:42:45Z", "message": "NF: _groupChildrenMain simplificitation\n\nThis use the fact that _groupChildrenMain is called only after the\ndeck collection is checked, so there is no duplicate and each nested\ndeck has a parent.\n\nCurrently what occurs is that, if you have the list of deck [\"A\",\n\"A::B\", \"A::C\", \"A::C::D\", \"E\"], the function will first process the\nsublist [\"A\", \"A::B\", \"A::C\", \"A::C::D\"] and then the sublist\n[\"E\"] (this is because it looks only as the first component of the\nname)\n\nThen, in the first sublist, it will look for the parent \"A\" and the\nchildren [\"A::B\", \"A::C\", \"A::C::D\"], by looking at which deck has\ndepth 0... that is useles, because, thanks to the sorting, we know the\nparent exists and is the first element of the list. Therefore, I\nremoving the condition dealing with the first element of the list and\nuse the fact that I know that it is the first element.\n\nBy itself it should be a really really small improvement. However, it\nallows to simplify the code and eventually to add great improvement\ninto it."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdb7f416c674ca2ec7703ab6082f414cbd1c6b82", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/cdb7f416c674ca2ec7703ab6082f414cbd1c6b82", "committedDate": "2020-06-24T11:44:55Z", "message": "Regression Test: multiple children at same level\n\nadding two decks with multiple children has at the same level. This\nshould have detected https://github.com/ankidroid/Anki-Android/issues/6544"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NTc0ODY5", "url": "https://github.com/ankidroid/Anki-Android/pull/6547#pullrequestreview-436574869", "createdAt": "2020-06-24T11:55:05Z", "commit": {"oid": "cdb7f416c674ca2ec7703ab6082f414cbd1c6b82"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMTo1NTowNVrOGoO46Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxMTo1NTowNVrOGoO46Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg0MDE2OQ==", "bodyText": "Confirming: does this break the test when used in association with the previous pull request?", "url": "https://github.com/ankidroid/Anki-Android/pull/6547#discussion_r444840169", "createdAt": "2020-06-24T11:55:05Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/ContentProviderTest.java", "diffHunk": "@@ -88,6 +88,7 @@\n             \"pdsqoelhmemmmbwjunnu\",\n             \"scxipjiyozczaaczoawo\",\n             \"cmxieunwoogyxsctnjmv::abcdefgh::ZYXW\",\n+            \"cmxieunwoogyxsctnjmv::INSBGDS\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdb7f416c674ca2ec7703ab6082f414cbd1c6b82"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NzE1NTI1", "url": "https://github.com/ankidroid/Anki-Android/pull/6547#pullrequestreview-436715525", "createdAt": "2020-06-24T14:41:15Z", "commit": {"oid": "cdb7f416c674ca2ec7703ab6082f414cbd1c6b82"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2OTY1MTYz", "url": "https://github.com/ankidroid/Anki-Android/pull/6547#pullrequestreview-436965163", "createdAt": "2020-06-24T20:02:33Z", "commit": {"oid": "cdb7f416c674ca2ec7703ab6082f414cbd1c6b82"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3009, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}