{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0Mzk4MDMy", "number": 7392, "title": "Fix for cards not showing up inside card browser if deck contains wildcard characters in its name.", "bodyText": "Pull Request template\nPurpose / Description\nDescribe the problem or feature and motivation\nFixes\nFixes #6288\nApproach\nPreviously, if there was a * character in the deck name, then exact matching of deck name was skipped over and regex search was applied. So, to fix that, an exact name search is done first, if it doesn't match any deck then we proceed to applying regex searching.\nHow Has This Been Tested?\nI tested it both with and without the modification on a physical API 29 device. I was able to reproduce the bug and with the modification the card is showing up now.\nChecklist\nPlease, go through these checks before submitting the PR.\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code\n UI changes: include screenshots of all affected screens (in particular showing any new or changed strings)", "createdAt": "2020-10-15T21:28:28Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7392", "merged": true, "mergeCommit": {"oid": "829122c12a1a1c7ab8b46551d436775381b1ba6e"}, "closed": true, "closedAt": "2020-10-23T14:06:06Z", "author": {"login": "anadi198"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdS4WvuAH2gAyNTA0Mzk4MDMyOmIzOTkxOTMxYzlhYjI1NTNmMzNmZmY1Y2RlOTA1ZTgwYWQzY2JkZDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdS9ywLgH2gAyNTA0Mzk4MDMyOjk3MTJjZDg3MjJlOTg1OWI3ZTAwMGI5MjE3NjdmMzcwMGQ5NWRhNmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b3991931c9ab2553f33fff5cde905e80ad3cbdd8", "author": {"user": {"login": "anadi198", "name": "Anadi Kashyap"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/b3991931c9ab2553f33fff5cde905e80ad3cbdd8", "committedDate": "2020-10-15T21:07:24Z", "message": "added logic to return exact match for a deck if it exists before a wildcard leads to a regex search in Finder.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68dbbc25b4825b067276c286eeff2da589735018", "author": {"user": {"login": "anadi198", "name": "Anadi Kashyap"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/68dbbc25b4825b067276c286eeff2da589735018", "committedDate": "2020-10-15T21:33:35Z", "message": "fixed some automatic changes made  by android studio"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5ODU5NTgy", "url": "https://github.com/ankidroid/Anki-Android/pull/7392#pullrequestreview-509859582", "createdAt": "2020-10-15T22:45:34Z", "commit": {"oid": "68dbbc25b4825b067276c286eeff2da589735018"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5ODU5MTE5", "url": "https://github.com/ankidroid/Anki-Android/pull/7392#pullrequestreview-509859119", "createdAt": "2020-10-15T22:44:34Z", "commit": {"oid": "68dbbc25b4825b067276c286eeff2da589735018"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQyMjo0NDozNFrOHieBSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQyMjo0NDozNFrOHieBSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkwNTQ4MQ==", "bodyText": "This was changed, but I don't think there was a reason for it\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            for (JSONObject d : mCol.getDecks().all()) {\n          \n          \n            \n                            for (Deck d : mCol.getDecks().all()) {", "url": "https://github.com/ankidroid/Anki-Android/pull/7392#discussion_r505905481", "createdAt": "2020-10-15T22:44:34Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Finder.java", "diffHunk": "@@ -659,16 +659,20 @@ public String _findDeck(String val) {\n             ids = dids(mCol.getDecks().id(val, false));\n         } else {\n             // wildcard\n-            ids = new ArrayList<>();\n-            val = val.replace(\"*\", \".*\");\n-            val = val.replace(\"+\", \"\\\\+\");\n-            for (Deck d : mCol.getDecks().all()) {\n-                String deckName = d.getString(\"name\");\n-                deckName = Normalizer.normalize(deckName, Normalizer.Form.NFC);\n-                if (deckName.matches(\"(?i)\" + val)) {\n-                    for (long id : dids(d.getLong(\"id\"))) {\n-                        if (!ids.contains(id)) {\n-                            ids.add(id);\n+            ids = dids(mCol.getDecks().id(val, false));\n+            if (ids == null) {\n+                ids = new ArrayList<>();\n+                val = val.replace(\"*\", \".*\");\n+                val = val.replace(\"+\", \"\\\\+\");\n+\n+                for (JSONObject d : mCol.getDecks().all()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68dbbc25b4825b067276c286eeff2da589735018"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9712cd8722e9859b7e000b921767f3700d95da6b", "author": {"user": {"login": "anadi198", "name": "Anadi Kashyap"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9712cd8722e9859b7e000b921767f3700d95da6b", "committedDate": "2020-10-16T03:27:31Z", "message": "Update AnkiDroid/src/main/java/com/ichi2/libanki/Finder.java\r\n\r\nApplying @david-allison-1's suggestion\n\nCo-authored-by: David Allison <62114487+david-allison-1@users.noreply.github.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3837, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}