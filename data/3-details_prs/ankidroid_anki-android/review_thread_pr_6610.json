{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0Mjk5NTI3", "number": 6610, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQxOTo0Mzo1MVrOELZ0HQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNjozNToxOVrOELekWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMzkyNzMzOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/ModelBrowser.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQxOTo0Mzo1MVrOGs9n6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQxOTo1MTozMVrOGs9p_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMDE2OQ==", "bodyText": "When would this be called on restore?", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449800169", "createdAt": "2020-07-04T19:43:51Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/ModelBrowser.java", "diffHunk": "@@ -207,6 +207,7 @@ public boolean onOptionsItemSelected(MenuItem item) {\n \n     @Override\n     public void onStop() {\n+        CollectionTask.cancelTask(COUNT_MODELS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48fdfe435b015fb0dd8bfb5721149e82b0ebf78d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMDcwMQ==", "bodyText": "Right. Should have been onDestroy", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449800701", "createdAt": "2020-07-04T19:51:31Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/ModelBrowser.java", "diffHunk": "@@ -207,6 +207,7 @@ public boolean onOptionsItemSelected(MenuItem item) {\n \n     @Override\n     public void onStop() {\n+        CollectionTask.cancelTask(COUNT_MODELS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMDE2OQ=="}, "originalCommit": {"oid": "48fdfe435b015fb0dd8bfb5721149e82b0ebf78d"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDA0NTEzOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQyMzozNTo0MlrOGs-d4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxMDoxODoyMlrOGtBSEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgxMzk4Ng==", "bodyText": "Have you tested this?\n\n  \n    \n      Anki-Android/AnkiDroid/src/main/java/com/ichi2/anki/ModelBrowser.java\n    \n    \n        Lines 108 to 113\n      in\n      e4543a4\n    \n    \n    \n    \n\n        \n          \n           @Override \n        \n\n        \n          \n           public void onPostExecute(TaskData result) { \n        \n\n        \n          \n            \n        \n\n        \n          \n               if (!result.getBoolean()) { \n        \n\n        \n          \n                   throw new RuntimeException(); \n        \n\n        \n          \n               }", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449813986", "createdAt": "2020-07-04T23:35:42Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1505,8 +1505,11 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    return new TaskData(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fabb154f2563c54c6743d039429c8d5d7c00cc0b"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgxNTQ4Ng==", "bodyText": "Quite hard to say, because even if I can still open and close the list of note type, I can't be sure that the request was actually cancelled.\nI've not check cat to ensure that cancellation was done.\nAccording to https://developer.android.com/reference/android/os/AsyncTask#cancel(boolean)\nonPostExecute is not run when the task is cancelled. I guess that I could as well have returned null", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449815486", "createdAt": "2020-07-05T00:03:13Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1505,8 +1505,11 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    return new TaskData(false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgxMzk4Ng=="}, "originalCommit": {"oid": "fabb154f2563c54c6743d039429c8d5d7c00cc0b"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg2MDExMg==", "bodyText": "Okay - let's add a comment that the choice is explicit, then we're good to go", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449860112", "createdAt": "2020-07-05T10:18:22Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1505,8 +1505,11 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    return new TaskData(false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgxMzk4Ng=="}, "originalCommit": {"oid": "fabb154f2563c54c6743d039429c8d5d7c00cc0b"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDY3NzQ1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNTo1NTowNFrOGtDO5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNTo1NzoyNlrOGtDP1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5MjA2OQ==", "bodyText": "@Arthur-Milchior I think this just needs a comment here and it can merge\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                return new TaskData(false);\n          \n          \n            \n                                // onPostExecute should not be called if canceled, return should not matter. Using false.\n          \n          \n            \n                                return new TaskData(false);", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449892069", "createdAt": "2020-07-05T15:55:04Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1546,8 +1546,11 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    return new TaskData(false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a3f4c4e9d6a56a6bdc560729131865c567bc04e"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5MjMxMQ==", "bodyText": "Comment added. Returning null since we do not actually care about the value", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449892311", "createdAt": "2020-07-05T15:57:26Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1546,8 +1546,11 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    return new TaskData(false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5MjA2OQ=="}, "originalCommit": {"oid": "6a3f4c4e9d6a56a6bdc560729131865c567bc04e"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNDcwNjE4OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "isResolved": false, "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNjozNToxOVrOGtDc8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNzoyMzo0MFrOGtDtag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NTY2Ng==", "bodyText": "onPostExecute also crashes on null, could we handle this case if we're going to imply it's fine.", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449895666", "createdAt": "2020-07-05T16:35:19Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1546,8 +1546,12 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    // onPostExecute not executed if cancelled. Return value not used.\n+                    return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9010e5b5c2eb70c7d938108076e14d3ab569f860"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NTk3Ng==", "bodyText": "I do not understand your request. Do you want onPostExecute to check for non-null value ?\nI guess we could, and behave the same way as when it gets a False value, i.e. throw an exception.\nI fail to see the point, since this method return null only if task is cancelled, and in this case onPostExecute is not executed. So there should be no way for onPostExecute to obtain the null", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449895976", "createdAt": "2020-07-05T16:38:48Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1546,8 +1546,12 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    // onPostExecute not executed if cancelled. Return value not used.\n+                    return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NTY2Ng=="}, "originalCommit": {"oid": "9010e5b5c2eb70c7d938108076e14d3ab569f860"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NzA2MA==", "bodyText": "perhaps even stronger is a change to BaseAsyncTask::onPostExecute that strongly verifies BaseAsyncTask::isCancelled == false, and otherwise does a Timber.w / sendExceptionReport and returns\nBasically we have a fear that there will be unpredictable onPostExecute behavior and the risk is the system does not follow it's guidance that onPostExecute won't happen if cancelled, so let's manage the risk directly instead of in client code?\nI verified BaseAyncTask::onPostExecute is called first in the delegate objects.", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449897060", "createdAt": "2020-07-05T16:50:33Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1546,8 +1546,12 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    // onPostExecute not executed if cancelled. Return value not used.\n+                    return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NTY2Ng=="}, "originalCommit": {"oid": "9010e5b5c2eb70c7d938108076e14d3ab569f860"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NzQwMA==", "bodyText": "I guess to be fully safe until that proposed change to BaseAsyncTask::onPostExecute proves to our satisfaction we are safe, then the client code would also need to null check and say via Timber effectively \"this is never supposed to happen, we were called after a cancel\"", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449897400", "createdAt": "2020-07-05T16:54:34Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1546,8 +1546,12 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    // onPostExecute not executed if cancelled. Return value not used.\n+                    return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NTY2Ng=="}, "originalCommit": {"oid": "9010e5b5c2eb70c7d938108076e14d3ab569f860"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5ODE2Nw==", "bodyText": "This is just from a maintenance point of view - people are likely to copy/paste and return null in the future on an edge case, as it looks safe, and we should protect against this.", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449898167", "createdAt": "2020-07-05T17:02:53Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1546,8 +1546,12 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    // onPostExecute not executed if cancelled. Return value not used.\n+                    return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NTY2Ng=="}, "originalCommit": {"oid": "9010e5b5c2eb70c7d938108076e14d3ab569f860"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5ODM5Mw==", "bodyText": "#6629", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449898393", "createdAt": "2020-07-05T17:05:44Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1546,8 +1546,12 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    // onPostExecute not executed if cancelled. Return value not used.\n+                    return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NTY2Ng=="}, "originalCommit": {"oid": "9010e5b5c2eb70c7d938108076e14d3ab569f860"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5ODg4NQ==", "bodyText": "To restate. I'm happy that onPostExecute won't run.\nI'm concerned that we've introduced the logic: \"It's OK to return null, as long as we're in an isCanceled() block\", as that breaks the principle of least astonishment", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449898885", "createdAt": "2020-07-05T17:12:14Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1546,8 +1546,12 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    // onPostExecute not executed if cancelled. Return value not used.\n+                    return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NTY2Ng=="}, "originalCommit": {"oid": "9010e5b5c2eb70c7d938108076e14d3ab569f860"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5OTA0OQ==", "bodyText": "Then stated most explicitly: to approve you require either null handling, or the return false again? And to be least-surprising returning false might be most consistent?", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449899049", "createdAt": "2020-07-05T17:14:27Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1546,8 +1546,12 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    // onPostExecute not executed if cancelled. Return value not used.\n+                    return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NTY2Ng=="}, "originalCommit": {"oid": "9010e5b5c2eb70c7d938108076e14d3ab569f860"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5OTUwMQ==", "bodyText": "I added back \"False\" then. I have no strong opinion here. My weak opinion is that the least astonishing thing would be to return \"null\" in both cases, since there is nothing \"false\" here.\nActually, I believe there is little reason to catch the potential exception only to throw a new one (with less details) in onPostExecute, so I believe the try/catch should be removed", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449899501", "createdAt": "2020-07-05T17:19:19Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1546,8 +1546,12 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    // onPostExecute not executed if cancelled. Return value not used.\n+                    return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NTY2Ng=="}, "originalCommit": {"oid": "9010e5b5c2eb70c7d938108076e14d3ab569f860"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5OTg4Mg==", "bodyText": "Returning null and handling it seems like the best option, but yes, would be happy with both options", "url": "https://github.com/ankidroid/Anki-Android/pull/6610#discussion_r449899882", "createdAt": "2020-07-05T17:23:40Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -1546,8 +1546,12 @@ public int compare(JSONObject a, JSONObject b) {\n \n         try{\n             for (JSONObject n : models) {\n-                long modID = n.getLong(\"id\");\n-                cardCount.add(col.getModels().nids(col.getModels().get(modID)).size());\n+                if (isCancelled()) {\n+                    Timber.e(\"doInBackgroundLoadModels :: Cancelled\");\n+                    // onPostExecute not executed if cancelled. Return value not used.\n+                    return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg5NTY2Ng=="}, "originalCommit": {"oid": "9010e5b5c2eb70c7d938108076e14d3ab569f860"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 79, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}