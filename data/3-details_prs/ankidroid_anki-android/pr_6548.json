{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5NDA1Mjgz", "number": 6548, "title": "Test detecting #6544", "bodyText": "This test fails with the PR that was wrong. It is correct currently.\nI fear that it is not proper unit test style, but I really don't\nunderstand what is going on here, so I'd be happy to get\ncorrection. In particular, how to have the same set of decks in both\nkind of test.", "createdAt": "2020-06-24T19:07:51Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6548", "merged": true, "mergeCommit": {"oid": "a16a795805914c33ab7a0988b762d4d97e2e200b"}, "closed": true, "closedAt": "2020-07-04T21:06:14Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcufX59AFqTQzNjk0OTA0Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxsruMgFqTQ0MjYyNTgyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2OTQ5MDQy", "url": "https://github.com/ankidroid/Anki-Android/pull/6548#pullrequestreview-436949042", "createdAt": "2020-06-24T19:37:54Z", "commit": {"oid": "a849661b5bc957d2e7c7484dcc15307e20754fb7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTozNzo1NFrOGogW6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOTozNzo1NFrOGogW6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyNjM3OQ==", "bodyText": "The only thing missing (in what looks like a good test sequence otherwise) is an assertion that the results match your expectations. So you might have a second test structure next to the TEST_DECKS definition that is TEST_DECKS_DUE_TREE, and then you would have some assertions that what you got from calling getCol().getSched().deckDueTree() matches your expected results. There examples of matchers being used in the src/main/test code all over and the API we're using mostly is http://hamcrest.org/JavaHamcrest/ so maybe since I don't see a reflective deep-object-comparator there you would make a few assertions about the shape of the deck due tree when it came back, like how many entries, at what level etc, or you could write a quick 'DeckDueTree' comparator and ask Hamcrest to use it", "url": "https://github.com/ankidroid/Anki-Android/pull/6548#discussion_r445126379", "createdAt": "2020-06-24T19:37:54Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/test/java/com/ichi2/libanki/sched/SchedTest.java", "diffHunk": "@@ -124,6 +125,15 @@ private void selectNewDeck() {\n         getCol().getDecks().select(did);\n     }\n \n+    @Test\n+    public void ensureDeckTree() {\n+        for (String deckName: TEST_DECKS) {\n+            addDeck(deckName);\n+        }\n+        getCol().getSched().deckDueTree();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a849661b5bc957d2e7c7484dcc15307e20754fb7"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a757f3a7bcbc1f78dbc70975c49a0463ddaf935f", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a757f3a7bcbc1f78dbc70975c49a0463ddaf935f", "committedDate": "2020-07-03T18:15:58Z", "message": "Test detecting #6544\n\nThis test fails with the PR that was wrong. It is correct currently.\n\nI fear that it is not proper unit test style, but I really don't\nunderstand what is going on here, so I'd be happy to get\ncorrection. In particular, how to have the same set of decks in both\nkind of test."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a849661b5bc957d2e7c7484dcc15307e20754fb7", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a849661b5bc957d2e7c7484dcc15307e20754fb7", "committedDate": "2020-06-24T19:06:01Z", "message": "Test detecting #6544\n\nThis test fails with the PR that was wrong. It is correct currently.\n\nI fear that it is not proper unit test style, but I really don't\nunderstand what is going on here, so I'd be happy to get\ncorrection. In particular, how to have the same set of decks in both\nkind of test."}, "afterCommit": {"oid": "a757f3a7bcbc1f78dbc70975c49a0463ddaf935f", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a757f3a7bcbc1f78dbc70975c49a0463ddaf935f", "committedDate": "2020-07-03T18:15:58Z", "message": "Test detecting #6544\n\nThis test fails with the PR that was wrong. It is correct currently.\n\nI fear that it is not proper unit test style, but I really don't\nunderstand what is going on here, so I'd be happy to get\ncorrection. In particular, how to have the same set of decks in both\nkind of test."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjIxNTYz", "url": "https://github.com/ankidroid/Anki-Android/pull/6548#pullrequestreview-442621563", "createdAt": "2020-07-04T17:18:28Z", "commit": {"oid": "a757f3a7bcbc1f78dbc70975c49a0463ddaf935f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQxNzoxODoyOFrOGs9AIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQxNzoxODoyOFrOGs9AIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc4OTk4Ng==", "bodyText": "The only thing I can see now is that it is very dangerous in Java to override equals without overriding hashCode - they have conjoined invariants that they need to meet:\nhttps://docs.oracle.com/javase/6/docs/api/java/lang/Object.html#hashCode()\n\nNote that it is generally necessary to override the hashCode method whenever this method is overridden, so as to maintain the general contract for the hashCode method, which states that equal objects must have equal hash codes.\n\nA possible implementation for hashCode here might be (in pseudocode):\nif object not instanceof DeckDueTreeNode return object.hashCode\nreturn getFullDeckName.hashCode() + mRevCount + mLrnCount + mNewCount + (int) (mChildren.hashCode ^ (mChildren.hashCode >>> 32))\nThe last bit, how to merge in a hashCode from a sub-object is from this table of reasonable ways to combine hashCodes: https://stackoverflow.com/a/14608883/9910298", "url": "https://github.com/ankidroid/Anki-Android/pull/6548#discussion_r449789986", "createdAt": "2020-07-04T17:18:28Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/AbstractSched.java", "diffHunk": "@@ -325,6 +340,27 @@ public void setChildren(@NonNull List<DeckDueTreeNode> children, boolean addRev)\n                 }\n             }\n         }\n+\n+\n+        /**\n+         * Whether both elements have the same structure and numbers.\n+         * @param object\n+         * @return\n+         */\n+        @Override\n+        public boolean equals(Object object) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a757f3a7bcbc1f78dbc70975c49a0463ddaf935f"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5df07fb10b163e21d097dde7262a64ca2006edc", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f5df07fb10b163e21d097dde7262a64ca2006edc", "committedDate": "2020-07-04T17:35:41Z", "message": "NF: Adding hashCode to DeckDueTreeNode\n\nCode by Mike Hardy"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7fe1cb05ca1a634810acfe57cd466f659a66bc8e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7fe1cb05ca1a634810acfe57cd466f659a66bc8e", "committedDate": "2020-07-04T17:34:36Z", "message": "NF: Adding hashCode to DeckDueTreeNode\n\nCode by Mike Hardy"}, "afterCommit": {"oid": "f5df07fb10b163e21d097dde7262a64ca2006edc", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f5df07fb10b163e21d097dde7262a64ca2006edc", "committedDate": "2020-07-04T17:35:41Z", "message": "NF: Adding hashCode to DeckDueTreeNode\n\nCode by Mike Hardy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjI1ODI2", "url": "https://github.com/ankidroid/Anki-Android/pull/6548#pullrequestreview-442625826", "createdAt": "2020-07-04T18:51:57Z", "commit": {"oid": "f5df07fb10b163e21d097dde7262a64ca2006edc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3012, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}