{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NjM4NDM0", "number": 6140, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMjo0Mjo1MFrOD67Qzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMjo0Mzo0M1rOD67RAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMTE0OTU5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/utils/ImportUtils.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMjo0Mjo1MFrOGS_61w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMjo1NDo0OVrOGS_-YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NDgwNw==", "bodyText": "nit: Timber.d(\"\") ?", "url": "https://github.com/ankidroid/Anki-Android/pull/6140#discussion_r422574807", "createdAt": "2020-05-10T02:42:50Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/utils/ImportUtils.java", "diffHunk": "@@ -150,6 +158,36 @@ private String handleContentProviderFile(Context context, Intent intent, Uri dat\n             return errorMessage;\n         }\n \n+\n+        private String ensureValidLength(String fileName) {\n+            //#6137 - filenames can be too long when URLEncoded\n+            try {\n+                String encoded = URLEncoder.encode(fileName, \"UTF-8\");\n+\n+                if (encoded.length() <= fileNameShorteningThreshold) {\n+                    Timber.d(\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb94bcd8fd576375dc28c675af2aa3ab8993ccf1"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NTQ3NA==", "bodyText": "\ud83e\udd26, I guess it's still a unique string", "url": "https://github.com/ankidroid/Anki-Android/pull/6140#discussion_r422575474", "createdAt": "2020-05-10T02:51:32Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/utils/ImportUtils.java", "diffHunk": "@@ -150,6 +158,36 @@ private String handleContentProviderFile(Context context, Intent intent, Uri dat\n             return errorMessage;\n         }\n \n+\n+        private String ensureValidLength(String fileName) {\n+            //#6137 - filenames can be too long when URLEncoded\n+            try {\n+                String encoded = URLEncoder.encode(fileName, \"UTF-8\");\n+\n+                if (encoded.length() <= fileNameShorteningThreshold) {\n+                    Timber.d(\"\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NDgwNw=="}, "originalCommit": {"oid": "eb94bcd8fd576375dc28c675af2aa3ab8993ccf1"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NTcxMg==", "bodyText": "Nah I think the JVM will optimize it to the same static memory chunk every time since it is unchanged. Haha...ahem.", "url": "https://github.com/ankidroid/Anki-Android/pull/6140#discussion_r422575712", "createdAt": "2020-05-10T02:54:49Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/utils/ImportUtils.java", "diffHunk": "@@ -150,6 +158,36 @@ private String handleContentProviderFile(Context context, Intent intent, Uri dat\n             return errorMessage;\n         }\n \n+\n+        private String ensureValidLength(String fileName) {\n+            //#6137 - filenames can be too long when URLEncoded\n+            try {\n+                String encoded = URLEncoder.encode(fileName, \"UTF-8\");\n+\n+                if (encoded.length() <= fileNameShorteningThreshold) {\n+                    Timber.d(\"\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NDgwNw=="}, "originalCommit": {"oid": "eb94bcd8fd576375dc28c675af2aa3ab8993ccf1"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMTE1MDA5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/utils/ImportUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMjo0Mzo0M1rOGS_7Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMjo1MToxMFrOGS_9UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NDg2Mw==", "bodyText": "I think 90 should be fileNameShorteningThreshold - 10 otherwise the numbers are very magic, the 10 for extension adjustment is still a little magic but at least it would be an adjustment off the constant", "url": "https://github.com/ankidroid/Anki-Android/pull/6140#discussion_r422574863", "createdAt": "2020-05-10T02:43:43Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/utils/ImportUtils.java", "diffHunk": "@@ -150,6 +158,36 @@ private String handleContentProviderFile(Context context, Intent intent, Uri dat\n             return errorMessage;\n         }\n \n+\n+        private String ensureValidLength(String fileName) {\n+            //#6137 - filenames can be too long when URLEncoded\n+            try {\n+                String encoded = URLEncoder.encode(fileName, \"UTF-8\");\n+\n+                if (encoded.length() <= fileNameShorteningThreshold) {\n+                    Timber.d(\"\");\n+                    return fileName;\n+                } else {\n+                    Timber.d(\"Filename was longer than %d, shortening\", fileNameShorteningThreshold);\n+                    //take 90 instead of 100 so we don't get the extension\n+                    String shortenedFileName = encoded.substring(0, 90) + \"...\" + getExtension(fileName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb94bcd8fd576375dc28c675af2aa3ab8993ccf1"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NTQ0MQ==", "bodyText": "Agreed", "url": "https://github.com/ankidroid/Anki-Android/pull/6140#discussion_r422575441", "createdAt": "2020-05-10T02:51:10Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/utils/ImportUtils.java", "diffHunk": "@@ -150,6 +158,36 @@ private String handleContentProviderFile(Context context, Intent intent, Uri dat\n             return errorMessage;\n         }\n \n+\n+        private String ensureValidLength(String fileName) {\n+            //#6137 - filenames can be too long when URLEncoded\n+            try {\n+                String encoded = URLEncoder.encode(fileName, \"UTF-8\");\n+\n+                if (encoded.length() <= fileNameShorteningThreshold) {\n+                    Timber.d(\"\");\n+                    return fileName;\n+                } else {\n+                    Timber.d(\"Filename was longer than %d, shortening\", fileNameShorteningThreshold);\n+                    //take 90 instead of 100 so we don't get the extension\n+                    String shortenedFileName = encoded.substring(0, 90) + \"...\" + getExtension(fileName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NDg2Mw=="}, "originalCommit": {"oid": "eb94bcd8fd576375dc28c675af2aa3ab8993ccf1"}, "originalPosition": 53}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 422, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}