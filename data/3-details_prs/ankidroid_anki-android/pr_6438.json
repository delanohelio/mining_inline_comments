{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzMzUwMTk0", "number": 6438, "title": "Convert import/export zip file usage to library: commons-compress - Allows >2GB imports", "bodyText": "Query\nSince this is a library change, I wouldn't feel totally comfortable in putting this in a point release. Not sure how this works with semver.\nGoals\n\nCheck the constructor to ensure that there's no nastiness in the change.\n\nPurpose / Description\nAllows import of apkg >2GB.\nnew java.util.zip.ZipFile() failed with:\njava.util.zip.ZipException: error in opening zip file\nThis was also performed in the export side to keep library use consistent\nSadly, syncing uses ZipFile.OPEN_READ | ZipFile.OPEN_DELETE, and there does not seem to be a direct replacement in the library so I've kept this as using java.util.zip for now.\nFixes\nFixes #6419\nApproach\nSwitch to commons-compress for import/export of apkg/colpkg files.\nHow Has This Been Tested?\nTested on an API 27 emulator, which failed, and now handles a 2.4GB file\nTested on my device (Android 9) via in import/export cycle of a known good profile\nCurrently testing on an API 16 emulator\n\nTBC - timing details\n\nLearning\nApparently reported in 2007... https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6599383\nhttps://stackoverflow.com/questions/53186835/error-in-opening-zip-file-opening-of-big-zip-files-2gb\nhttps://commons.apache.org/proper/commons-compress/\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-06-11T21:47:31Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6438", "merged": true, "mergeCommit": {"oid": "44c7b798a13abc71a6ccf9e92acb00143b6dc018"}, "closed": true, "closedAt": "2020-06-13T04:28:58Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqV9zmgBqjM0MzYxODg0OTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqsUCwgBqjM0NDAyNzIzMTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed99af6d8d978205bdc3a4fa32fb67126ad34cd9", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ed99af6d8d978205bdc3a4fa32fb67126ad34cd9", "committedDate": "2020-06-11T21:38:52Z", "message": "Convert import/export to commons-compress\n\nAllows import of apkg >2GB.\n\nnew java.util.zip.ZipFile() failed with:\n\njava.util.zip.ZipException: error in opening zip file\n\nThis was done in the export side to keep library use consistent\n\nSadly, syncing uses `ZipFile.OPEN_READ | ZipFile.OPEN_DELETE`,\nand there does not seem to be a direct replacement in the library\nso I've kept this as using java.util.zip for now.\n\nFixes 6419"}, "afterCommit": {"oid": "d11c22fda6eae689d745a690e3b91ae9568becc8", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d11c22fda6eae689d745a690e3b91ae9568becc8", "committedDate": "2020-06-11T22:25:50Z", "message": "Convert import/export to commons-compress\n\nAllows import of apkg >2GB.\n\nnew java.util.zip.ZipFile() failed with:\n\njava.util.zip.ZipException: error in opening zip file\n\nThis was done in the export side to keep library use consistent\n\nSadly, syncing uses `ZipFile.OPEN_READ | ZipFile.OPEN_DELETE`,\nand there does not seem to be a direct replacement in the library\nso I've kept this as using java.util.zip for now.\n\nFixes 6419"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d11c22fda6eae689d745a690e3b91ae9568becc8", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d11c22fda6eae689d745a690e3b91ae9568becc8", "committedDate": "2020-06-11T22:25:50Z", "message": "Convert import/export to commons-compress\n\nAllows import of apkg >2GB.\n\nnew java.util.zip.ZipFile() failed with:\n\njava.util.zip.ZipException: error in opening zip file\n\nThis was done in the export side to keep library use consistent\n\nSadly, syncing uses `ZipFile.OPEN_READ | ZipFile.OPEN_DELETE`,\nand there does not seem to be a direct replacement in the library\nso I've kept this as using java.util.zip for now.\n\nFixes 6419"}, "afterCommit": {"oid": "cdaa30aefe91ae28e9cc59c040b672802b06a064", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/cdaa30aefe91ae28e9cc59c040b672802b06a064", "committedDate": "2020-06-11T23:48:59Z", "message": "Convert import/export to commons-compress\n\nAllows import of apkg >2GB.\n\nnew java.util.zip.ZipFile() failed with:\n\njava.util.zip.ZipException: error in opening zip file\n\nThis was done in the export side to keep library use consistent\n\nSadly, syncing uses `ZipFile.OPEN_READ | ZipFile.OPEN_DELETE`,\nand there does not seem to be a direct replacement in the library\nso I've kept this as using java.util.zip for now.\n\nFixes 6419"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDYxOTMw", "url": "https://github.com/ankidroid/Anki-Android/pull/6438#pullrequestreview-430061930", "createdAt": "2020-06-12T22:08:37Z", "commit": {"oid": "cdaa30aefe91ae28e9cc59c040b672802b06a064"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMjowODozN1rOGjSzRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMjowODozN1rOGjSzRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2MTM4MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // noinspection GradleDependency - needs 1.12 as later versions use `File.toPath`\n          \n          \n            \n                // noinspection GradleDependency - pinned at 1.12 until API21 minSdkVersion (File.toPath usage)\n          \n      \n    \n    \n  \n\nThis makes it so it will be searched during minSdkVersion bumps, we (I?) always search for 'APINN' usage", "url": "https://github.com/ankidroid/Anki-Android/pull/6438#discussion_r439661380", "createdAt": "2020-06-12T22:08:37Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/build.gradle", "diffHunk": "@@ -144,6 +144,10 @@ dependencies {\n     implementation 'com.getbase:floatingactionbutton:1.10.1'\n     implementation 'org.bitbucket.cowwoc:diff-match-patch:1.2'\n     implementation \"androidx.multidex:multidex:2.0.1\"\n+    // #6419  - API 27 (& maybe others) could not perform new ZipFile() on a 2GB+ apkg\n+    // noinspection GradleDependency - needs 1.12 as later versions use `File.toPath`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cdaa30aefe91ae28e9cc59c040b672802b06a064"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDYyMjYx", "url": "https://github.com/ankidroid/Anki-Android/pull/6438#pullrequestreview-430062261", "createdAt": "2020-06-12T22:09:37Z", "commit": {"oid": "cdaa30aefe91ae28e9cc59c040b672802b06a064"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cdaa30aefe91ae28e9cc59c040b672802b06a064", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/cdaa30aefe91ae28e9cc59c040b672802b06a064", "committedDate": "2020-06-11T23:48:59Z", "message": "Convert import/export to commons-compress\n\nAllows import of apkg >2GB.\n\nnew java.util.zip.ZipFile() failed with:\n\njava.util.zip.ZipException: error in opening zip file\n\nThis was done in the export side to keep library use consistent\n\nSadly, syncing uses `ZipFile.OPEN_READ | ZipFile.OPEN_DELETE`,\nand there does not seem to be a direct replacement in the library\nso I've kept this as using java.util.zip for now.\n\nFixes 6419"}, "afterCommit": {"oid": "4d585a67b8b010d7b2834af4b26d343418612044", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4d585a67b8b010d7b2834af4b26d343418612044", "committedDate": "2020-06-12T22:15:35Z", "message": "Convert import/export to commons-compress\n\nAllows import of apkg >2GB.\n\nnew java.util.zip.ZipFile() failed with:\n\njava.util.zip.ZipException: error in opening zip file\n\nThis was done in the export side to keep library use consistent\n\nSadly, syncing uses `ZipFile.OPEN_READ | ZipFile.OPEN_DELETE`,\nand there does not seem to be a direct replacement in the library\nso I've kept this as using java.util.zip for now.\n\nFixes 6419"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27748cbdb5da16f36bf6730767125e48088882c2", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/27748cbdb5da16f36bf6730767125e48088882c2", "committedDate": "2020-06-13T00:22:20Z", "message": "Convert import/export to commons-compress\n\nAllows import of apkg >2GB.\n\nnew java.util.zip.ZipFile() failed with:\n\njava.util.zip.ZipException: error in opening zip file\n\nThis was done in the export side to keep library use consistent\n\nSadly, syncing uses `ZipFile.OPEN_READ | ZipFile.OPEN_DELETE`,\nand there does not seem to be a direct replacement in the library\nso I've kept this as using java.util.zip for now.\n\nFixes 6419"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4d585a67b8b010d7b2834af4b26d343418612044", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4d585a67b8b010d7b2834af4b26d343418612044", "committedDate": "2020-06-12T22:15:35Z", "message": "Convert import/export to commons-compress\n\nAllows import of apkg >2GB.\n\nnew java.util.zip.ZipFile() failed with:\n\njava.util.zip.ZipException: error in opening zip file\n\nThis was done in the export side to keep library use consistent\n\nSadly, syncing uses `ZipFile.OPEN_READ | ZipFile.OPEN_DELETE`,\nand there does not seem to be a direct replacement in the library\nso I've kept this as using java.util.zip for now.\n\nFixes 6419"}, "afterCommit": {"oid": "27748cbdb5da16f36bf6730767125e48088882c2", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/27748cbdb5da16f36bf6730767125e48088882c2", "committedDate": "2020-06-13T00:22:20Z", "message": "Convert import/export to commons-compress\n\nAllows import of apkg >2GB.\n\nnew java.util.zip.ZipFile() failed with:\n\njava.util.zip.ZipException: error in opening zip file\n\nThis was done in the export side to keep library use consistent\n\nSadly, syncing uses `ZipFile.OPEN_READ | ZipFile.OPEN_DELETE`,\nand there does not seem to be a direct replacement in the library\nso I've kept this as using java.util.zip for now.\n\nFixes 6419"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3186, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}