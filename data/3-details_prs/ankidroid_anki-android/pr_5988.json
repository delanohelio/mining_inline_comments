{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMzgyMDY1", "number": 5988, "title": "Extract BrowserAppearance and delete abstractions", "bodyText": "Purpose / Description\nI want to keep the visual editor mostly consistent with the card browser. This involves extracting the CSS which was currently applied inside AbstractFlashCardViewer\nApproach\nExtracted a few methods into a class\nDeleted ReviewerExtRegistry and implementations - only contained one class\nHow Has This Been Tested?\nTested on my Android with the options, all seem to work.\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-04-12T18:48:17Z", "url": "https://github.com/ankidroid/Anki-Android/pull/5988", "merged": true, "mergeCommit": {"oid": "578b2a4c524b313ed3147d7bcfdc5afefc1c7bf4"}, "closed": true, "closedAt": "2020-04-13T18:38:27Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcW-_dtgFqTM5MTg4NTk3MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXSKWOAFqTM5MjI4OTE3Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODg1OTcx", "url": "https://github.com/ankidroid/Anki-Android/pull/5988#pullrequestreview-391885971", "createdAt": "2020-04-12T18:55:50Z", "commit": {"oid": "a9007eb3a00a3ce03165474e4f499075cf5340e1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxODo1NTo1MVrOGEX3kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxODo1NTo1MVrOGEX3kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIzODU0Ng==", "bodyText": "This is concerning, I didn't consider the fact that SMP chars would be problematic and the exact problem isn't specified.\nI might need to perform a 2-way mapping, but it'd be good to get a concrete example of the issue.", "url": "https://github.com/ankidroid/Anki-Android/pull/5988#discussion_r407238546", "createdAt": "2020-04-12T18:55:51Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/CardAppearance.java", "diffHunk": "@@ -0,0 +1,176 @@\n+package com.ichi2.anki.cardviewer;\n+\n+import android.content.SharedPreferences;\n+\n+import com.ichi2.anki.reviewer.ReviewerCustomFonts;\n+import com.ichi2.themes.Themes;\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import androidx.annotation.CheckResult;\n+\n+/** Responsible for calculating CSS and element styles and modifying content on a flashcard */\n+public class CardAppearance {\n+\n+    /** Max size of the font for dynamic calculation of font size */\n+    private static final int DYNAMIC_FONT_MAX_SIZE = 14;\n+\n+    /** Min size of the font for dynamic calculation of font size */\n+    private static final int DYNAMIC_FONT_MIN_SIZE = 3;\n+    private static final int DYNAMIC_FONT_FACTOR = 5;\n+\n+    /** Constant for class attribute signaling answer */\n+    public static final String ANSWER_CLASS = \"\\\"answer\\\"\";\n+\n+    /** Constant for class attribute signaling question */\n+    public static final String QUESTION_CLASS = \"\\\"question\\\"\";\n+\n+    private final int mCardZoom;\n+    private final int mImageZoom;\n+    private final boolean mNightMode;\n+    private final boolean mCenterVertically;\n+    private final ReviewerCustomFonts mCustomFonts;\n+\n+    public CardAppearance(ReviewerCustomFonts customFonts, int cardZoom, int imageZoom, boolean nightMode, boolean centerVertically) {\n+        this.mCustomFonts = customFonts;\n+        this.mCardZoom = cardZoom;\n+        this.mImageZoom = imageZoom;\n+        this.mNightMode = nightMode;\n+        this.mCenterVertically = centerVertically;\n+    }\n+\n+    public boolean isNightMode() {\n+        return mNightMode;\n+    }\n+\n+    public static CardAppearance create(ReviewerCustomFonts customFonts, SharedPreferences preferences) {\n+        int cardZoom = preferences.getInt(\"cardZoom\", 100);\n+        int imageZoom = preferences.getInt(\"imageZoom\", 100);\n+        boolean nightMode = preferences.getBoolean(\"invertedColors\", false);\n+        boolean centerVertically = preferences.getBoolean(\"centerVertically\", false);\n+        return new CardAppearance(customFonts, cardZoom, imageZoom, nightMode, centerVertically);\n+    }\n+\n+\n+    public static String fixBoldStyle(String content) {\n+        // In order to display the bold style correctly, we have to change\n+        // font-weight to 700\n+        return content.replace(\"font-weight:600;\", \"font-weight:700;\");\n+    }\n+\n+    /**\n+     * Converts characters in Unicode Supplementary Multilingual Plane (SMP) to their equivalent Html Entities. This is\n+     * done because webview has difficulty displaying these characters.\n+     *\n+     * @param text the text co convert to HTML Entities\n+     * @return The resultant text with SMP characters converted to entities\n+     */\n+    public static String convertSmpToHtmlEntity(String text) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9007eb3a00a3ce03165474e4f499075cf5340e1"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODg2MDE0", "url": "https://github.com/ankidroid/Anki-Android/pull/5988#pullrequestreview-391886014", "createdAt": "2020-04-12T18:56:23Z", "commit": {"oid": "a9007eb3a00a3ce03165474e4f499075cf5340e1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxODo1NjoyNFrOGEX3xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxODo1NjoyNFrOGEX3xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIzODU5Ng==", "bodyText": "Mind if I extract this pattern into a local variable?", "url": "https://github.com/ankidroid/Anki-Android/pull/5988#discussion_r407238596", "createdAt": "2020-04-12T18:56:24Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/CardAppearance.java", "diffHunk": "@@ -0,0 +1,176 @@\n+package com.ichi2.anki.cardviewer;\n+\n+import android.content.SharedPreferences;\n+\n+import com.ichi2.anki.reviewer.ReviewerCustomFonts;\n+import com.ichi2.themes.Themes;\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import androidx.annotation.CheckResult;\n+\n+/** Responsible for calculating CSS and element styles and modifying content on a flashcard */\n+public class CardAppearance {\n+\n+    /** Max size of the font for dynamic calculation of font size */\n+    private static final int DYNAMIC_FONT_MAX_SIZE = 14;\n+\n+    /** Min size of the font for dynamic calculation of font size */\n+    private static final int DYNAMIC_FONT_MIN_SIZE = 3;\n+    private static final int DYNAMIC_FONT_FACTOR = 5;\n+\n+    /** Constant for class attribute signaling answer */\n+    public static final String ANSWER_CLASS = \"\\\"answer\\\"\";\n+\n+    /** Constant for class attribute signaling question */\n+    public static final String QUESTION_CLASS = \"\\\"question\\\"\";\n+\n+    private final int mCardZoom;\n+    private final int mImageZoom;\n+    private final boolean mNightMode;\n+    private final boolean mCenterVertically;\n+    private final ReviewerCustomFonts mCustomFonts;\n+\n+    public CardAppearance(ReviewerCustomFonts customFonts, int cardZoom, int imageZoom, boolean nightMode, boolean centerVertically) {\n+        this.mCustomFonts = customFonts;\n+        this.mCardZoom = cardZoom;\n+        this.mImageZoom = imageZoom;\n+        this.mNightMode = nightMode;\n+        this.mCenterVertically = centerVertically;\n+    }\n+\n+    public boolean isNightMode() {\n+        return mNightMode;\n+    }\n+\n+    public static CardAppearance create(ReviewerCustomFonts customFonts, SharedPreferences preferences) {\n+        int cardZoom = preferences.getInt(\"cardZoom\", 100);\n+        int imageZoom = preferences.getInt(\"imageZoom\", 100);\n+        boolean nightMode = preferences.getBoolean(\"invertedColors\", false);\n+        boolean centerVertically = preferences.getBoolean(\"centerVertically\", false);\n+        return new CardAppearance(customFonts, cardZoom, imageZoom, nightMode, centerVertically);\n+    }\n+\n+\n+    public static String fixBoldStyle(String content) {\n+        // In order to display the bold style correctly, we have to change\n+        // font-weight to 700\n+        return content.replace(\"font-weight:600;\", \"font-weight:700;\");\n+    }\n+\n+    /**\n+     * Converts characters in Unicode Supplementary Multilingual Plane (SMP) to their equivalent Html Entities. This is\n+     * done because webview has difficulty displaying these characters.\n+     *\n+     * @param text the text co convert to HTML Entities\n+     * @return The resultant text with SMP characters converted to entities\n+     */\n+    public static String convertSmpToHtmlEntity(String text) {\n+        StringBuffer sb = new StringBuffer();\n+        Matcher m = Pattern.compile(\"([^\\u0000-\\uFFFF])\").matcher(text);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a9007eb3a00a3ce03165474e4f499075cf5340e1"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODkzOTY5", "url": "https://github.com/ankidroid/Anki-Android/pull/5988#pullrequestreview-391893969", "createdAt": "2020-04-12T20:50:27Z", "commit": {"oid": "a9007eb3a00a3ce03165474e4f499075cf5340e1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db8a7ed79665e1e992ee19cd0f7a26c923b4791a", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/db8a7ed79665e1e992ee19cd0f7a26c923b4791a", "committedDate": "2020-04-13T16:49:19Z", "message": "Extract BrowserAppearance and delete abstractions\n\nMostly for use in the Visual Editor\n\nDelete ReviewerExtRegistry and implementations - only contained one\nclass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13424dd1f6255d5c6a4e96e67f7badb56c5294c1", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/13424dd1f6255d5c6a4e96e67f7badb56c5294c1", "committedDate": "2020-04-13T16:49:36Z", "message": "REVIEW: Deprecate convertSmpToHtmlEntity\n\nThis code existed before auto-updating WebViews, and appears\nunnecessary.\n\nWe gate the feature to < API 21 to determine if it's still required."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a9007eb3a00a3ce03165474e4f499075cf5340e1", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a9007eb3a00a3ce03165474e4f499075cf5340e1", "committedDate": "2020-04-12T18:41:54Z", "message": "Extract BrowserAppearance and delete abstractions\n\nMostly for use in the Visual Editor\n\nDelete ReviewerExtRegistry and implementations - only contained one\nclass"}, "afterCommit": {"oid": "13424dd1f6255d5c6a4e96e67f7badb56c5294c1", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/13424dd1f6255d5c6a4e96e67f7badb56c5294c1", "committedDate": "2020-04-13T16:49:36Z", "message": "REVIEW: Deprecate convertSmpToHtmlEntity\n\nThis code existed before auto-updating WebViews, and appears\nunnecessary.\n\nWe gate the feature to < API 21 to determine if it's still required."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMjg5MTcy", "url": "https://github.com/ankidroid/Anki-Android/pull/5988#pullrequestreview-392289172", "createdAt": "2020-04-13T17:15:56Z", "commit": {"oid": "13424dd1f6255d5c6a4e96e67f7badb56c5294c1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3652, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}