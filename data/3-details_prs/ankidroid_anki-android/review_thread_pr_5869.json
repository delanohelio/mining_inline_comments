{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0NDM4OTc4", "number": 5869, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMTo1MTowOVrODr2PnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOVQyMTo0Mzo0NVrODsds5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MzA0MDkyOnYy", "diffSide": "LEFT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMTo1MTowOVrOF8bz-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMTo1MTowOVrOF8bz-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkxNDU1NQ==", "bodyText": "performed in onSelectionChanged", "url": "https://github.com/ankidroid/Anki-Android/pull/5869#discussion_r398914555", "createdAt": "2020-03-26T21:51:09Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "diffHunk": "@@ -717,7 +721,6 @@ public void onClick(View v) {\n             // multi-select mode\n             getMenuInflater().inflate(R.menu.card_browser_multiselect, menu);\n             showBackIcon();\n-            updateMultiselectMenu();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7470546741628e215c1f75072996a8260a3e06a5"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MzA0MzU5OnYy", "diffSide": "LEFT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMTo1MTo1OFrOF8b1gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMTo1MTo1OFrOF8b1gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkxNDk0Ng==", "bodyText": "updateCardsInList -> updateList -> onSelectionChanged", "url": "https://github.com/ankidroid/Anki-Android/pull/5869#discussion_r398914946", "createdAt": "2020-03-26T21:51:58Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "diffHunk": "@@ -1438,7 +1463,6 @@ private void removeNotesView(Card[] cards) {\n         protected void actualPostExecute(DeckTask.TaskData result) {\n             Card[] cards = (Card[]) result.getObjArray();\n             updateCardsInList(Arrays.asList(cards), null);\n-            updateMultiselectMenu();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7470546741628e215c1f75072996a8260a3e06a5"}, "originalPosition": 118}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3MzA0NTYzOnYy", "diffSide": "LEFT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMTo1Mjo0NlrOF8b2vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMTo1Mjo0NlrOF8b2vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkxNTI2Mw==", "bodyText": "This button had two purposes, we split it into onSelectAll and onSelectNone", "url": "https://github.com/ankidroid/Anki-Android/pull/5869#discussion_r398915263", "createdAt": "2020-03-26T21:52:46Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "diffHunk": "@@ -1798,28 +1821,47 @@ private void onCheck(int position, View cell) {\n             mCheckedCardPositions.remove(position);\n         }\n \n-        updateMultiselectMenu();\n+       onSelectionChanged();\n+    }\n \n-        if (mCheckedCardPositions.isEmpty()) {\n-            // when 0 are selected: end selection mode\n-            endMultiSelectMode();\n-        } else {\n-            mActionBarTitle.setText(Integer.toString(mCheckedCardPositions.size()));\n+    private void onSelectAll() {\n+        for (int i = 0; i < mCards.size(); i++) {\n+            mCheckedCardPositions.add(i);\n         }\n+        onSelectionChanged();\n     }\n \n-    private void onCheckAll() {\n-        boolean all = mCheckedCardPositions.size() < getCards().size();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7470546741628e215c1f75072996a8260a3e06a5"}, "originalPosition": 151}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ3OTUwNTY3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOVQyMTo0Mzo0NVrOF9VZnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQwMTo0NjoxOVrOF9XT3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1ODA3Nw==", "bodyText": "I've seen in one other place that async tasks are sometimes working on CardBrowser member variables, and a clear causes NPEs and ConcurrentModExceptions - how would you feel about changing this from .clear() to creating a new empty object? Feels like a defensive programming improvement to me", "url": "https://github.com/ankidroid/Anki-Android/pull/5869#discussion_r399858077", "createdAt": "2020-03-29T21:43:45Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "diffHunk": "@@ -1825,20 +1830,25 @@ private void onCheck(int position, View cell) {\n         }\n     }\n \n-    private void onCheckAll() {\n-        boolean all = mCheckedCardPositions.size() < getCards().size();\n-        if (all) {\n-            for (int i = 0; i < mCards.size(); i++) {\n-                mCheckedCardPositions.add(i);\n-            }\n-        } else {\n-            mCheckedCardPositions.clear();\n+    private void onSelectAll() {\n+        for (int i = 0; i < mCards.size(); i++) {\n+            mCheckedCardPositions.add(i);\n         }\n+        onSelectionChanged();\n+    }\n+\n+    private void onSelectNone() {\n+        mCheckedCardPositions.clear();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dbc08919bd4c64f1c2948ad43cec38ccf6f8aa44"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1OTI2MQ==", "bodyText": "It's an improvement, but it hides the problem. Is there a reason we're not using a concurrent structure for this instead?", "url": "https://github.com/ankidroid/Anki-Android/pull/5869#discussion_r399859261", "createdAt": "2020-03-29T21:54:31Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "diffHunk": "@@ -1825,20 +1830,25 @@ private void onCheck(int position, View cell) {\n         }\n     }\n \n-    private void onCheckAll() {\n-        boolean all = mCheckedCardPositions.size() < getCards().size();\n-        if (all) {\n-            for (int i = 0; i < mCards.size(); i++) {\n-                mCheckedCardPositions.add(i);\n-            }\n-        } else {\n-            mCheckedCardPositions.clear();\n+    private void onSelectAll() {\n+        for (int i = 0; i < mCards.size(); i++) {\n+            mCheckedCardPositions.add(i);\n         }\n+        onSelectionChanged();\n+    }\n+\n+    private void onSelectNone() {\n+        mCheckedCardPositions.clear();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1ODA3Nw=="}, "originalCommit": {"oid": "dbc08919bd4c64f1c2948ad43cec38ccf6f8aa44"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg2MDEzOQ==", "bodyText": "no reason in particular :-), in general because concurrency is hard - and simply throwing the old object on the GC (either now, or when async task is finished) seems so easy...", "url": "https://github.com/ankidroid/Anki-Android/pull/5869#discussion_r399860139", "createdAt": "2020-03-29T22:02:25Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "diffHunk": "@@ -1825,20 +1830,25 @@ private void onCheck(int position, View cell) {\n         }\n     }\n \n-    private void onCheckAll() {\n-        boolean all = mCheckedCardPositions.size() < getCards().size();\n-        if (all) {\n-            for (int i = 0; i < mCards.size(); i++) {\n-                mCheckedCardPositions.add(i);\n-            }\n-        } else {\n-            mCheckedCardPositions.clear();\n+    private void onSelectAll() {\n+        for (int i = 0; i < mCards.size(); i++) {\n+            mCheckedCardPositions.add(i);\n         }\n+        onSelectionChanged();\n+    }\n+\n+    private void onSelectNone() {\n+        mCheckedCardPositions.clear();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1ODA3Nw=="}, "originalCommit": {"oid": "dbc08919bd4c64f1c2948ad43cec38ccf6f8aa44"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg4OTM3Mg==", "bodyText": "Flipped to a concurrent structure. Doesn't look too painful in this instance", "url": "https://github.com/ankidroid/Anki-Android/pull/5869#discussion_r399889372", "createdAt": "2020-03-30T01:46:19Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "diffHunk": "@@ -1825,20 +1830,25 @@ private void onCheck(int position, View cell) {\n         }\n     }\n \n-    private void onCheckAll() {\n-        boolean all = mCheckedCardPositions.size() < getCards().size();\n-        if (all) {\n-            for (int i = 0; i < mCards.size(); i++) {\n-                mCheckedCardPositions.add(i);\n-            }\n-        } else {\n-            mCheckedCardPositions.clear();\n+    private void onSelectAll() {\n+        for (int i = 0; i < mCards.size(); i++) {\n+            mCheckedCardPositions.add(i);\n         }\n+        onSelectionChanged();\n+    }\n+\n+    private void onSelectNone() {\n+        mCheckedCardPositions.clear();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1ODA3Nw=="}, "originalCommit": {"oid": "dbc08919bd4c64f1c2948ad43cec38ccf6f8aa44"}, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 477, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}