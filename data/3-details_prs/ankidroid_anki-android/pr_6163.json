{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NDQ5Mjcz", "number": 6163, "title": "Block file import if no storage permissions ", "bodyText": "Purpose / Description\nA bug occurred where we displayed a import dialog before we requested permissions, which overlapped the dialog. Clicking \"Add\" crashes, as we had no storage permissions.\nFixes\nFixes #6157\nApproach\nBlock the input, show a toast, and load the DeckPicker, which shows the storage dialog, followed by the permissions request.\nWe could do this better in the DeckPicker handler and persist the operation, but we're somewhat constrained for time, it's a complex operation, and asking the user to perform the operation again isn't a huge ask\nHow Has This Been Tested?\nOn my device:\n\nLaunching with permissions shows nothing\nLaunching from launcher with no permissions shows no toast, followed by permissions dialog\nLaunching from file browser with no permissions shows toast, followed by permissions dialog\nLaunching from file browser with permissions shows import dialog\n\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-05-13T15:42:37Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6163", "merged": true, "mergeCommit": {"oid": "678f4496bc30b10138f8cc1c88bf5adc030939b3"}, "closed": true, "closedAt": "2020-05-13T19:23:13Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcg6VTIgH2gAyNDE3NDQ5MjczOmE1MDM0YzE1OGM1NDYyYjViM2YzZmI1ZGY4YTU1NjM3ZmM3NDVlNGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcg89b4AFqTQxMTE3OTA1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a5034c158c5462b5b3f3fb5df8a55637fc745e4f", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a5034c158c5462b5b3f3fb5df8a55637fc745e4f", "committedDate": "2020-05-13T15:09:25Z", "message": "NF: Extract launchDeckPickerIfNoOtherTasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2dedc65fe38c0f0f3c902e2e7dbe966a1a54df2", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c2dedc65fe38c0f0f3c902e2e7dbe966a1a54df2", "committedDate": "2020-05-13T15:22:46Z", "message": "NF: Extract handleFileImport"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a48f36c7be84f4d7e4b06394ccc043a251cf3f66", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a48f36c7be84f4d7e4b06394ccc043a251cf3f66", "committedDate": "2020-05-13T15:23:08Z", "message": "NF: Extract handleSyncIntent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26b292df05e7b2b0747e75fa1141ffc5f0d44983", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/26b292df05e7b2b0747e75fa1141ffc5f0d44983", "committedDate": "2020-05-13T15:23:35Z", "message": "NF: Extract handleReviewIntent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMDczMjg4", "url": "https://github.com/ankidroid/Anki-Android/pull/6163#pullrequestreview-411073288", "createdAt": "2020-05-13T16:00:05Z", "commit": {"oid": "1eab9abaad752a0ca39421993deda27abb147d49"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjowMDowNVrOGU4pgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjowMDowNVrOGU4pgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU1MjgzNQ==", "bodyText": "Altered to be more of a status report (as opposed to something that sounds like they actively did it) and pairing with the specific actions we want them to take - should take users through it with less cognitive load, what do you think?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <string name=\"intent_handler_failed_no_storage_permission\">Storage permission denied. Unable to perform action.</string>\n          \n          \n            \n                <string name=\"intent_handler_failed_no_storage_permission\">Missing required storage permission. Please grant storage permission then retry your action.</string>", "url": "https://github.com/ankidroid/Anki-Android/pull/6163#discussion_r424552835", "createdAt": "2020-05-13T16:00:05Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -184,4 +184,7 @@\n     <string name=\"error_selecting_image\">Error selecting image. Please see manual. %s</string>\n     <string name=\"error_deleting_image\">Error deleting image</string>\n     <string name=\"failed_to_apply_background_image\">Failed to apply background image %s</string>\n+\n+    <!-- Global Intent handler -->\n+    <string name=\"intent_handler_failed_no_storage_permission\">Storage permission denied. Unable to perform action.</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1eab9abaad752a0ca39421993deda27abb147d49"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c573280228701a21ff117276a6cfb605312d01ec", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c573280228701a21ff117276a6cfb605312d01ec", "committedDate": "2020-05-13T16:19:41Z", "message": "Block file import if no storage permissions\n\nThis displayed a dialog before we requested permissions, clicking \"Add\"\ncrashes, as we had no storage permissions.\n\nWe could do it better in the DeckPicker handler and persist the\noperation, but we're somewhat constrained for time, and asking the user\nto perform the operation again isn't a huge ask\n\nFixes #6157"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1eab9abaad752a0ca39421993deda27abb147d49", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/1eab9abaad752a0ca39421993deda27abb147d49", "committedDate": "2020-05-13T15:38:07Z", "message": "Block file import if no storage permissions\n\nThis displayed a dialog before we requested permissions, clicking \"Add\"\ncrashes, as we had no storage permissions.\n\nWe could do it better in the DeckPicker handler and persist the\noperation, but we're somewhat constrained for time, and asking the user\nto perform the operation again isn't a huge ask\n\nFixes #6157"}, "afterCommit": {"oid": "c573280228701a21ff117276a6cfb605312d01ec", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c573280228701a21ff117276a6cfb605312d01ec", "committedDate": "2020-05-13T16:19:41Z", "message": "Block file import if no storage permissions\n\nThis displayed a dialog before we requested permissions, clicking \"Add\"\ncrashes, as we had no storage permissions.\n\nWe could do it better in the DeckPicker handler and persist the\noperation, but we're somewhat constrained for time, and asking the user\nto perform the operation again isn't a huge ask\n\nFixes #6157"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMTc5MDU1", "url": "https://github.com/ankidroid/Anki-Android/pull/6163#pullrequestreview-411179055", "createdAt": "2020-05-13T18:13:04Z", "commit": {"oid": "c573280228701a21ff117276a6cfb605312d01ec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3506, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}