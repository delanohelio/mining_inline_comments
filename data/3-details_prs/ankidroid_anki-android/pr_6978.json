{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0OTEzODYy", "number": 6978, "title": "Regression 6898 2", "bodyText": "When doing undo and then reviewing again, the lrn queue was emptied and elements were not added back until the queue was empty (i.e. all elements added in the queue after undo left the queue)\nThis means that if we add card 1 to learning queue and then undo later, card 1 won't be seen again until the end of the review. This test show it's corrected.", "createdAt": "2020-08-27T19:49:16Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6978", "merged": true, "mergeCommit": {"oid": "9510980e46c47f9cd38aaa19ea1d307a4b5016ae"}, "closed": true, "closedAt": "2020-10-24T16:42:02Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdECDeIAFqTQ3ODIyMjQ0OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVt75oAFqTUxNjI5MDU0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4MjIyNDQ5", "url": "https://github.com/ankidroid/Anki-Android/pull/6978#pullrequestreview-478222449", "createdAt": "2020-08-30T17:54:50Z", "commit": {"oid": "44c97b37332bfc5ef06d35f36571e65698aa92ed"}, "state": "DISMISSED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQxNzo1NDo1MVrOHJkhmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMFQxNzo1NToyOFrOHJkh_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc5NzY1Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public synchronized void testLrnQueueAfterUndo() throws ConfirmModSchemaException, InterruptedException {\n          \n          \n            \n                public void testLrnQueueAfterUndo() throws ConfirmModSchemaException, InterruptedException {", "url": "https://github.com/ankidroid/Anki-Android/pull/6978#discussion_r479797657", "createdAt": "2020-08-30T17:54:51Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/anki/ReviewerTest.java", "diffHunk": "@@ -215,6 +215,47 @@ public synchronized void testMultipleCards() throws ConfirmModSchemaException, I\n         assertCurrentOrdIsNot(reviewer, 3); // Anki Desktop shows \"1\"\n     }\n \n+    @Test\n+    public synchronized void testLrnQueueAfterUndo() throws ConfirmModSchemaException, InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44c97b37332bfc5ef06d35f36571e65698aa92ed"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc5Nzc1Nw==", "bodyText": "Extract these two lines to answerCard for readability", "url": "https://github.com/ankidroid/Anki-Android/pull/6978#discussion_r479797757", "createdAt": "2020-08-30T17:55:28Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/anki/ReviewerTest.java", "diffHunk": "@@ -215,6 +215,47 @@ public synchronized void testMultipleCards() throws ConfirmModSchemaException, I\n         assertCurrentOrdIsNot(reviewer, 3); // Anki Desktop shows \"1\"\n     }\n \n+    @Test\n+    public synchronized void testLrnQueueAfterUndo() throws ConfirmModSchemaException, InterruptedException {\n+        Collection<MockTime> col = getCol();\n+        JSONObject nw = col.getDecks().confForDid(1).getJSONObject(\"new\");\n+        MockTime time = col.getTime();\n+        nw.put(\"delays\", new JSONArray(new int[] {1, 10, 60, 120}));\n+\n+        Card cards[] = new Card[4];\n+        cards[0] = addRevNoteUsingBasicModelDueToday(\"1\", \"bar\").firstCard();\n+        cards[1] = addNoteUsingBasicModel(\"2\", \"bar\").firstCard();\n+        cards[2] = addNoteUsingBasicModel(\"3\", \"bar\").firstCard();\n+\n+        waitForAsyncTasksToComplete();\n+\n+        Reviewer reviewer = startReviewer();\n+\n+        waitForAsyncTasksToComplete();\n+\n+\n+        equalFirstField(cards[0], reviewer.mCurrentCard);\n+        reviewer.answerCard(Consts.BUTTON_ONE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "44c97b37332bfc5ef06d35f36571e65698aa92ed"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ab56982623444c0d028fc98db16756a0d0d4561", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2ab56982623444c0d028fc98db16756a0d0d4561", "committedDate": "2020-10-24T15:11:08Z", "message": "NF: equal first field\n\nAllow to make meaningful error assuming each card has a distinct first field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3eb71c6ced70cb38321f5bd513e2883f07c7cb1f", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3eb71c6ced70cb38321f5bd513e2883f07c7cb1f", "committedDate": "2020-10-24T15:11:08Z", "message": "NF: add a note in rev mode"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "44c97b37332bfc5ef06d35f36571e65698aa92ed", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/44c97b37332bfc5ef06d35f36571e65698aa92ed", "committedDate": "2020-08-27T19:45:36Z", "message": "Regression for #6898\n\nThis ensure that all cards in the learning queue get fetched at some point and not postponed until the end of the review"}, "afterCommit": {"oid": "0a81a6fef352b62363744c4e0a63a212de43acd0", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0a81a6fef352b62363744c4e0a63a212de43acd0", "committedDate": "2020-10-24T15:13:19Z", "message": "Regression for #6898\n\nThis ensure that all cards in the learning queue get fetched at some point and not postponed until the end of the review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b7eb2fcb80d67cbe7e6839058d44b5d989edd60", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4b7eb2fcb80d67cbe7e6839058d44b5d989edd60", "committedDate": "2020-10-24T15:14:14Z", "message": "Regression for #6898\n\nThis ensure that all cards in the learning queue get fetched at some point and not postponed until the end of the review"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a81a6fef352b62363744c4e0a63a212de43acd0", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0a81a6fef352b62363744c4e0a63a212de43acd0", "committedDate": "2020-10-24T15:13:19Z", "message": "Regression for #6898\n\nThis ensure that all cards in the learning queue get fetched at some point and not postponed until the end of the review"}, "afterCommit": {"oid": "4b7eb2fcb80d67cbe7e6839058d44b5d989edd60", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4b7eb2fcb80d67cbe7e6839058d44b5d989edd60", "committedDate": "2020-10-24T15:14:14Z", "message": "Regression for #6898\n\nThis ensure that all cards in the learning queue get fetched at some point and not postponed until the end of the review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b003537f0edf796fc7f1a178f56b571c0110e282", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/b003537f0edf796fc7f1a178f56b571c0110e282", "committedDate": "2020-10-24T16:40:34Z", "message": "Update AnkiDroid/src/test/java/com/ichi2/anki/ReviewerTest.java\r\n\r\nI will squash merge this when merging\n\nCo-authored-by: David Allison <62114487+david-allison-1@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MjkwNTQw", "url": "https://github.com/ankidroid/Anki-Android/pull/6978#pullrequestreview-516290540", "createdAt": "2020-10-24T16:40:48Z", "commit": {"oid": "b003537f0edf796fc7f1a178f56b571c0110e282"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2988, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}