{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NjE5MDc4", "number": 5774, "reviewThreads": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxMTo0OTo0NVrOEDKakg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMTo1NjowNlrOED1oQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNzUxODI2OnYy", "diffSide": "RIGHT", "path": ".idea/codeStyles/Project.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxMTo0OTo0NVrOGgDV4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNjowNjo1OFrOGgEbKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjM3MQ==", "bodyText": "Could you revert changes to Project.xml", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436262371", "createdAt": "2020-06-06T11:49:45Z", "author": {"login": "david-allison-1"}, "path": ".idea/codeStyles/Project.xml", "diffHunk": "@@ -24,6 +24,9 @@\n         <package name=\"\" withSubpackages=\"true\" static=\"true\" />\n       </value>\n     </option>\n+    <AndroidXmlCodeStyleSettings>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MDEwNw==", "bodyText": "Yes, done sorry for the mistake.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436280107", "createdAt": "2020-06-06T16:06:58Z", "author": {"login": "dgeranton"}, "path": ".idea/codeStyles/Project.xml", "diffHunk": "@@ -24,6 +24,9 @@\n         <package name=\"\" withSubpackages=\"true\" static=\"true\" />\n       </value>\n     </option>\n+    <AndroidXmlCodeStyleSettings>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjM3MQ=="}, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNzUxODY3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/dialogs/DeckPickerExportCompleteDialog.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxMTo1MDoyOFrOGgDWFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNjowNzoyNVrOGgEbQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjQyMg==", "bodyText": "Could you revert changes to additional files", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436262422", "createdAt": "2020-06-06T11:50:28Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/dialogs/DeckPickerExportCompleteDialog.java", "diffHunk": "@@ -5,10 +5,8 @@\n import android.os.Message;\n \n import com.afollestad.materialdialogs.MaterialDialog;\n-import com.ichi2.anki.CollectionHelper;\n import com.ichi2.anki.DeckPicker;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MDEyOQ==", "bodyText": "Yes, done, merge issue from my side.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436280129", "createdAt": "2020-06-06T16:07:25Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/dialogs/DeckPickerExportCompleteDialog.java", "diffHunk": "@@ -5,10 +5,8 @@\n import android.os.Message;\n \n import com.afollestad.materialdialogs.MaterialDialog;\n-import com.ichi2.anki.CollectionHelper;\n import com.ichi2.anki.DeckPicker;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjQyMg=="}, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNzUxOTk1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/AudioView.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxMTo1MjozMFrOGgDWtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNjowODoxNFrOGgEbhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjU4MQ==", "bodyText": "I understand that this is copy/pasted, but we'll want to confirm that the media directory is better than the cache for these files. I think the cache directory (context.getCacheDir()) would be better", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436262581", "createdAt": "2020-06-06T11:52:30Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/AudioView.java", "diffHunk": "@@ -72,6 +76,19 @@ public static AudioView createRecorderInstance(Context context, int resPlay, int\n         return new AudioView(context, resPlay, resPause, resStop, resRecord, resRecordStop, audioPath);\n     }\n \n+    public static String generateTempAudioFile(Context context) {\n+        String tempAudioPath;\n+        try {\n+            Collection col = CollectionHelper.getInstance().getCol(context);\n+            File storingDirectory = new File(col.getMedia().dir());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MDE5OA==", "bodyText": "Yes, this is to avoid copy/pasted code. You right cache dir is better that media directory. I have changed it.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436280198", "createdAt": "2020-06-06T16:08:14Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/AudioView.java", "diffHunk": "@@ -72,6 +76,19 @@ public static AudioView createRecorderInstance(Context context, int resPlay, int\n         return new AudioView(context, resPlay, resPause, resStop, resRecord, resRecordStop, audioPath);\n     }\n \n+    public static String generateTempAudioFile(Context context) {\n+        String tempAudioPath;\n+        try {\n+            Collection col = CollectionHelper.getInstance().getCol(context);\n+            File storingDirectory = new File(col.getMedia().dir());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjU4MQ=="}, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNzUyMDc5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxMTo1Mzo1MVrOGgDXGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNjowODo0NlrOGgEbog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjY4MA==", "bodyText": "Could you prefix this variable with an m\nCode conventions for ref: https://github.com/ankidroid/Anki-Android/tree/master/docs/code_conventions", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436262680", "createdAt": "2020-06-06T11:53:51Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -320,6 +321,10 @@\n \n     private long mUseTimerDynamicMS;\n \n+    /** File of the temporary mic record **/\n+    protected AudioView mMicToolBar;\n+    protected String tempAudioPath;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MDIyNg==", "bodyText": "Yes, done, I stupidly used the initial local variable name.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436280226", "createdAt": "2020-06-06T16:08:46Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -320,6 +321,10 @@\n \n     private long mUseTimerDynamicMS;\n \n+    /** File of the temporary mic record **/\n+    protected AudioView mMicToolBar;\n+    protected String tempAudioPath;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjY4MA=="}, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNzUyMDk4OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxMTo1NDoxMlrOGgDXLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNjowOToxMFrOGgEbsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjcwMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if( mMicToolBar != null ) {\n          \n          \n            \n                    if (mMicToolBar != null) {", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436262701", "createdAt": "2020-06-06T11:54:12Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -2577,6 +2582,16 @@ public boolean onJsAlert(WebView view, String url, String message, JsResult resu\n \n \n     protected void closeReviewer(int result, boolean saveDeck) {\n+        // Stop the mic recording if still pending\n+        if( mMicToolBar != null ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MDI0Mg==", "bodyText": "Yes, done, catch the pattern.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436280242", "createdAt": "2020-06-06T16:09:10Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -2577,6 +2582,16 @@ public boolean onJsAlert(WebView view, String url, String message, JsResult resu\n \n \n     protected void closeReviewer(int result, boolean saveDeck) {\n+        // Stop the mic recording if still pending\n+        if( mMicToolBar != null ) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjcwMQ=="}, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNzUyMTE3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxMTo1NDoyOFrOGgDXQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNjowOToxNlrOGgEbtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjcyMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if( tempAudioPath != null ) {\n          \n          \n            \n                    if (tempAudioPath != null) {", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436262722", "createdAt": "2020-06-06T11:54:28Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -2577,6 +2582,16 @@ public boolean onJsAlert(WebView view, String url, String message, JsResult resu\n \n \n     protected void closeReviewer(int result, boolean saveDeck) {\n+        // Stop the mic recording if still pending\n+        if( mMicToolBar != null ) {\n+            mMicToolBar.notifyStopRecord();\n+        }\n+        // Remove the temporary audio file\n+        if( tempAudioPath != null ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MDI0NQ==", "bodyText": "Yes, done, catch the pattern.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436280245", "createdAt": "2020-06-06T16:09:16Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -2577,6 +2582,16 @@ public boolean onJsAlert(WebView view, String url, String message, JsResult resu\n \n \n     protected void closeReviewer(int result, boolean saveDeck) {\n+        // Stop the mic recording if still pending\n+        if( mMicToolBar != null ) {\n+            mMicToolBar.notifyStopRecord();\n+        }\n+        // Remove the temporary audio file\n+        if( tempAudioPath != null ) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjcyMg=="}, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNzUyMTg1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxMTo1NToyOVrOGgDXlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNjoxMzowN1rOGgEcww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjgwNw==", "bodyText": "nit: could you add braces around the if in One-True Brace style", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436262807", "createdAt": "2020-06-06T11:55:29Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -2577,6 +2582,16 @@ public boolean onJsAlert(WebView view, String url, String message, JsResult resu\n \n \n     protected void closeReviewer(int result, boolean saveDeck) {\n+        // Stop the mic recording if still pending\n+        if( mMicToolBar != null ) {\n+            mMicToolBar.notifyStopRecord();\n+        }\n+        // Remove the temporary audio file\n+        if( tempAudioPath != null ) {\n+            File tempAudioPathToDelete = new File(tempAudioPath);\n+            if (tempAudioPathToDelete.exists()) tempAudioPathToDelete.delete();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MDUxNQ==", "bodyText": "Yes, done.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436280515", "createdAt": "2020-06-06T16:13:07Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -2577,6 +2582,16 @@ public boolean onJsAlert(WebView view, String url, String message, JsResult resu\n \n \n     protected void closeReviewer(int result, boolean saveDeck) {\n+        // Stop the mic recording if still pending\n+        if( mMicToolBar != null ) {\n+            mMicToolBar.notifyStopRecord();\n+        }\n+        // Remove the temporary audio file\n+        if( tempAudioPath != null ) {\n+            File tempAudioPathToDelete = new File(tempAudioPath);\n+            if (tempAudioPathToDelete.exists()) tempAudioPathToDelete.delete();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjgwNw=="}, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNzUyMjQyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxMTo1NjowOVrOGgDX1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNjoxMjo1NlrOGgEctQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2Mjg2OQ==", "bodyText": "!Permissions.canRecordAudio(this)", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436262869", "createdAt": "2020-06-06T11:56:09Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -280,6 +286,18 @@ public boolean onOptionsItemSelected(MenuItem item) {\n                 playSounds(true);\n                 break;\n \n+            case R.id.action_toggle_mic_tool_bar:\n+                Timber.i(\"Reviewer:: Record mic\");\n+                // Check permission to record and request if not granted\n+                if (ContextCompat.checkSelfPermission(this, android.Manifest.permission.RECORD_AUDIO) !=", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MDUwMQ==", "bodyText": "Yes, done, I did not know that useful function, thx.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436280501", "createdAt": "2020-06-06T16:12:56Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -280,6 +286,18 @@ public boolean onOptionsItemSelected(MenuItem item) {\n                 playSounds(true);\n                 break;\n \n+            case R.id.action_toggle_mic_tool_bar:\n+                Timber.i(\"Reviewer:: Record mic\");\n+                // Check permission to record and request if not granted\n+                if (ContextCompat.checkSelfPermission(this, android.Manifest.permission.RECORD_AUDIO) !=", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2Mjg2OQ=="}, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNzUyMjc0OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxMTo1Njo1OFrOGgDYAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNjowOToyNFrOGgEbuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjkxMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if ( mMicToolBar == null ) {\n          \n          \n            \n                    if (mMicToolBar == null) {", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436262913", "createdAt": "2020-06-06T11:56:58Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +394,36 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void toggleMicToolBar() {\n+        if ( mMicToolBar == null ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MDI1MQ==", "bodyText": "Yes, done, catch the pattern.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436280251", "createdAt": "2020-06-06T16:09:24Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +394,36 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void toggleMicToolBar() {\n+        if ( mMicToolBar == null ) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2MjkxMw=="}, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNzUyMzA3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxMTo1Nzo0MFrOGgDYKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNjoxMjoyM1rOGgEcjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2Mjk1Mw==", "bodyText": "Could you wrap this in a try..catch and display a toast and send an exception report on failure, we don't want to crash the app if the toolbar fails to init.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436262953", "createdAt": "2020-06-06T11:57:40Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +394,36 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void toggleMicToolBar() {\n+        if ( mMicToolBar == null ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MDQ2Mw==", "bodyText": "I have put a try ... catch into the AudioView.createRecorderInstance tool that is used some where else to mutualize the error management.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436280463", "createdAt": "2020-06-06T16:12:23Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +394,36 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void toggleMicToolBar() {\n+        if ( mMicToolBar == null ) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2Mjk1Mw=="}, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNzUyMzI0OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxMTo1Nzo1OFrOGgDYQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQxNjowOTozMlrOGgEbxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2Mjk3OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if( mMicToolBar.getVisibility() != View.VISIBLE) {\n          \n          \n            \n                        if (mMicToolBar.getVisibility() != View.VISIBLE) {", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436262978", "createdAt": "2020-06-06T11:57:58Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +394,36 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void toggleMicToolBar() {\n+        if ( mMicToolBar == null ) {\n+            // Record mic tool bar does not exist yet\n+            tempAudioPath = AudioView.generateTempAudioFile(this);\n+            mMicToolBar = AudioView.createRecorderInstance(this, R.drawable.av_play, R.drawable.av_pause,\n+                    R.drawable.av_stop, R.drawable.av_rec, R.drawable.av_rec_stop, tempAudioPath);\n+            FrameLayout.LayoutParams lp2 = new FrameLayout.LayoutParams(\n+                    ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);\n+            mMicToolBar.setLayoutParams(lp2);\n+            LinearLayout micToolBarLayer = findViewById(R.id.mic_tool_bar_layer);\n+            micToolBarLayer.addView(mMicToolBar);\n+        } else {\n+            // It exists swap visibility status\n+            if( mMicToolBar.getVisibility() != View.VISIBLE) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MDI2MA==", "bodyText": "Yes, done, catch the pattern.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436280260", "createdAt": "2020-06-06T16:09:32Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +394,36 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void toggleMicToolBar() {\n+        if ( mMicToolBar == null ) {\n+            // Record mic tool bar does not exist yet\n+            tempAudioPath = AudioView.generateTempAudioFile(this);\n+            mMicToolBar = AudioView.createRecorderInstance(this, R.drawable.av_play, R.drawable.av_pause,\n+                    R.drawable.av_stop, R.drawable.av_rec, R.drawable.av_rec_stop, tempAudioPath);\n+            FrameLayout.LayoutParams lp2 = new FrameLayout.LayoutParams(\n+                    ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);\n+            mMicToolBar.setLayoutParams(lp2);\n+            LinearLayout micToolBarLayer = findViewById(R.id.mic_tool_bar_layer);\n+            micToolBarLayer.addView(mMicToolBar);\n+        } else {\n+            // It exists swap visibility status\n+            if( mMicToolBar.getVisibility() != View.VISIBLE) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI2Mjk3OA=="}, "originalCommit": {"oid": "a2b5e7bcc45ae7b7b7372ba2affcc0e8674e88e0"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxODEyMjk5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/res/values-af/02-strings.xml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QwODo0OTozOFrOGgIG7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxMzoxNzoxNVrOGgJcjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDQ2MQ==", "bodyText": "Could you revert this change? Our translation scripts will handle it.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436340461", "createdAt": "2020-06-07T08:49:38Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/values-af/02-strings.xml", "diffHunk": "@@ -64,6 +64,7 @@\n     <string name=\"hide_whiteboard\">Hide whiteboard</string>\n     <string name=\"clear_whiteboard\">Clear whiteboard</string>\n     <string name=\"replay_audio\">Replay audio</string>\n+    <string name=\"toggle_mic_tool_bar\">Toggle mic tool bar</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b9a9598553232398e3b42817c83c5072e94b377"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM1ODQzOQ==", "bodyText": "Oh, ok, done.\nInteresting, how does it works ?", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436358439", "createdAt": "2020-06-07T12:31:14Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/res/values-af/02-strings.xml", "diffHunk": "@@ -64,6 +64,7 @@\n     <string name=\"hide_whiteboard\">Hide whiteboard</string>\n     <string name=\"clear_whiteboard\">Clear whiteboard</string>\n     <string name=\"replay_audio\">Replay audio</string>\n+    <string name=\"toggle_mic_tool_bar\">Toggle mic tool bar</string>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDQ2MQ=="}, "originalCommit": {"oid": "8b9a9598553232398e3b42817c83c5072e94b377"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM2MjM4Mw==", "bodyText": "https://github.com/ankidroid/Anki-Android/wiki/Development-Guide#handling-translations\nAlong with some scripts to pull from crowdin:\nhttps://github.com/ankidroid/Anki-Android/blob/master/tools/manage-crowdin.py\nhttps://github.com/ankidroid/Anki-Android/blob/master/tools/update-localizations.py", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436362383", "createdAt": "2020-06-07T13:17:15Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/values-af/02-strings.xml", "diffHunk": "@@ -64,6 +64,7 @@\n     <string name=\"hide_whiteboard\">Hide whiteboard</string>\n     <string name=\"clear_whiteboard\">Clear whiteboard</string>\n     <string name=\"replay_audio\">Replay audio</string>\n+    <string name=\"toggle_mic_tool_bar\">Toggle mic tool bar</string>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDQ2MQ=="}, "originalCommit": {"oid": "8b9a9598553232398e3b42817c83c5072e94b377"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxODEyNDEzOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/AudioView.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QwODo1MTozMVrOGgIHfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QwODo1MTozMVrOGgIHfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDYwNQ==", "bodyText": "Could you mark this with\n\n@Nullable (place the string above public),\nMark context as @NonNull - place before the word Context", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436340605", "createdAt": "2020-06-07T08:51:31Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/AudioView.java", "diffHunk": "@@ -69,7 +75,27 @@\n \n     public static AudioView createRecorderInstance(Context context, int resPlay, int resPause, int resStop,\n             int resRecord, int resRecordStop, String audioPath) {\n+        try {\n         return new AudioView(context, resPlay, resPause, resStop, resRecord, resRecordStop, audioPath);\n+        } catch(Exception e) {\n+            Timber.e(e);\n+            AnkiDroidApp.sendExceptionReport(e, \"Unable to create recorder tool bar\");\n+            UIUtils.showThemedToast(context,\n+                    context.getText(R.string.multimedia_editor_audio_view_create_failed).toString(), true);\n+            return null;\n+        }\n+    }\n+\n+    public static String generateTempAudioFile(Context context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b9a9598553232398e3b42817c83c5072e94b377"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxODEyNDg3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QwODo1Mjo0NVrOGgIH2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxMzoxMjo1M1rOGgJa6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDY5OQ==", "bodyText": "Consider inverting this if (this can be done by placing your cursor over the if and pressing Alt+Enter", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436340699", "createdAt": "2020-06-07T08:52:45Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +394,43 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void toggleMicToolBar() {\n+        if (mMicToolBar == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b9a9598553232398e3b42817c83c5072e94b377"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM1OTgwNg==", "bodyText": "Ok, done. But why ? Is it not allowed to have a == null statement ?", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436359806", "createdAt": "2020-06-07T12:46:56Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +394,43 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void toggleMicToolBar() {\n+        if (mMicToolBar == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDY5OQ=="}, "originalCommit": {"oid": "8b9a9598553232398e3b42817c83c5072e94b377"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM2MTk2MQ==", "bodyText": "It's a minor case of the Pyramid of Doom: https://en.wikipedia.org/wiki/Pyramid_of_doom_(programming). Having an early return should increase readability for the main operation of the function.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436361961", "createdAt": "2020-06-07T13:12:53Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +394,43 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void toggleMicToolBar() {\n+        if (mMicToolBar == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDY5OQ=="}, "originalCommit": {"oid": "8b9a9598553232398e3b42817c83c5072e94b377"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxODEyNTI0OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QwODo1MzozOVrOGgIIDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxMzozMDoxNFrOGgJhKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDc0OA==", "bodyText": "I believe this can fail if the activity is in the process of being destroyed.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436340748", "createdAt": "2020-06-07T08:53:39Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +394,43 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void toggleMicToolBar() {\n+        if (mMicToolBar == null) {\n+            // Record mic tool bar does not exist yet\n+            mTempAudioPath = AudioView.generateTempAudioFile(this);\n+            if (mTempAudioPath == null) {\n+                return;\n+            }\n+            mMicToolBar = AudioView.createRecorderInstance(this, R.drawable.av_play, R.drawable.av_pause,\n+                        R.drawable.av_stop, R.drawable.av_rec, R.drawable.av_rec_stop, mTempAudioPath);\n+            if (mMicToolBar == null) {\n+                mTempAudioPath = null;\n+                return;\n+            }\n+            FrameLayout.LayoutParams lp2 = new FrameLayout.LayoutParams(\n+                    ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);\n+            mMicToolBar.setLayoutParams(lp2);\n+            LinearLayout micToolBarLayer = findViewById(R.id.mic_tool_bar_layer);\n+            micToolBarLayer.addView(mMicToolBar);\n+        } else {\n+            // It exists swap visibility status\n+            if (mMicToolBar.getVisibility() != View.VISIBLE) {\n+                mMicToolBar.setVisibility(View.VISIBLE);\n+            } else {\n+                mMicToolBar.setVisibility(View.GONE);\n+            }\n+        }\n+    }\n+\n+    public void onRequestPermissionsResult (int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {\n+        if ( (requestCode == REQUEST_AUDIO_PERMISSION) &&\n+                (permissions.length >= 1) && (grantResults[0] == PackageManager.PERMISSION_GRANTED)) {\n+            // Get get audio record permission, so we can create the record tool bar\n+            toggleMicToolBar();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b9a9598553232398e3b42817c83c5072e94b377"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM2MDExMQ==", "bodyText": "Hum, I am not sure to understand.\nDo you mean that some condition must be added ?\nIf the process us being destroyed, it is not an issue if the permission is not granted, no ?", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436360111", "createdAt": "2020-06-07T12:50:49Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +394,43 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void toggleMicToolBar() {\n+        if (mMicToolBar == null) {\n+            // Record mic tool bar does not exist yet\n+            mTempAudioPath = AudioView.generateTempAudioFile(this);\n+            if (mTempAudioPath == null) {\n+                return;\n+            }\n+            mMicToolBar = AudioView.createRecorderInstance(this, R.drawable.av_play, R.drawable.av_pause,\n+                        R.drawable.av_stop, R.drawable.av_rec, R.drawable.av_rec_stop, mTempAudioPath);\n+            if (mMicToolBar == null) {\n+                mTempAudioPath = null;\n+                return;\n+            }\n+            FrameLayout.LayoutParams lp2 = new FrameLayout.LayoutParams(\n+                    ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);\n+            mMicToolBar.setLayoutParams(lp2);\n+            LinearLayout micToolBarLayer = findViewById(R.id.mic_tool_bar_layer);\n+            micToolBarLayer.addView(mMicToolBar);\n+        } else {\n+            // It exists swap visibility status\n+            if (mMicToolBar.getVisibility() != View.VISIBLE) {\n+                mMicToolBar.setVisibility(View.VISIBLE);\n+            } else {\n+                mMicToolBar.setVisibility(View.GONE);\n+            }\n+        }\n+    }\n+\n+    public void onRequestPermissionsResult (int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {\n+        if ( (requestCode == REQUEST_AUDIO_PERMISSION) &&\n+                (permissions.length >= 1) && (grantResults[0] == PackageManager.PERMISSION_GRANTED)) {\n+            // Get get audio record permission, so we can create the record tool bar\n+            toggleMicToolBar();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDc0OA=="}, "originalCommit": {"oid": "8b9a9598553232398e3b42817c83c5072e94b377"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM2MzU2MA==", "bodyText": "I believe I'm mistaken. I've had a look through the docs, and it seems that View.addView won't throw under these circumstances.\nAndroid has the concept of Activities. In AnkiDroid, each activity represents a screen. and an activity has a lifecycle outside of the process.\nhttps://developer.android.com/reference/android/app/Activity\nIn some cases (mostly fragments), performing UI-based actions after Activity.onDestroy() will throw an exception. Our default exception handler is set to log and kill the process, so we want to avoid and recover from exceptions whenever possible.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436363560", "createdAt": "2020-06-07T13:30:14Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -376,6 +394,43 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return true;\n     }\n \n+\n+    private void toggleMicToolBar() {\n+        if (mMicToolBar == null) {\n+            // Record mic tool bar does not exist yet\n+            mTempAudioPath = AudioView.generateTempAudioFile(this);\n+            if (mTempAudioPath == null) {\n+                return;\n+            }\n+            mMicToolBar = AudioView.createRecorderInstance(this, R.drawable.av_play, R.drawable.av_pause,\n+                        R.drawable.av_stop, R.drawable.av_rec, R.drawable.av_rec_stop, mTempAudioPath);\n+            if (mMicToolBar == null) {\n+                mTempAudioPath = null;\n+                return;\n+            }\n+            FrameLayout.LayoutParams lp2 = new FrameLayout.LayoutParams(\n+                    ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);\n+            mMicToolBar.setLayoutParams(lp2);\n+            LinearLayout micToolBarLayer = findViewById(R.id.mic_tool_bar_layer);\n+            micToolBarLayer.addView(mMicToolBar);\n+        } else {\n+            // It exists swap visibility status\n+            if (mMicToolBar.getVisibility() != View.VISIBLE) {\n+                mMicToolBar.setVisibility(View.VISIBLE);\n+            } else {\n+                mMicToolBar.setVisibility(View.GONE);\n+            }\n+        }\n+    }\n+\n+    public void onRequestPermissionsResult (int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {\n+        if ( (requestCode == REQUEST_AUDIO_PERMISSION) &&\n+                (permissions.length >= 1) && (grantResults[0] == PackageManager.PERMISSION_GRANTED)) {\n+            // Get get audio record permission, so we can create the record tool bar\n+            toggleMicToolBar();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDc0OA=="}, "originalCommit": {"oid": "8b9a9598553232398e3b42817c83c5072e94b377"}, "originalPosition": 99}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxODM2MTA1OnYy", "diffSide": "LEFT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/dialogs/ImportDialog.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxNTowOToxOVrOGgKF3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxNzo0OToyNlrOGgK6AQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM3Mjk1Nw==", "bodyText": "I think once these additional files are removed from the commit, we're good to go. This looks awesome!!", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436372957", "createdAt": "2020-06-07T15:09:19Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/dialogs/ImportDialog.java", "diffHunk": "@@ -8,7 +8,6 @@\n import com.ichi2.anki.CollectionHelper;\n import com.ichi2.anki.R;\n import com.ichi2.anki.UIUtils;\n-import com.ichi2.anki.analytics.AnalyticsDialogFragment;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99f716cbf63dc1ba44a8400cc9f6a1055ce2d28c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM4NjMwNQ==", "bodyText": "I am not sure, but do you mean that I must revert the remove of that unused import ?", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436386305", "createdAt": "2020-06-07T17:49:26Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/dialogs/ImportDialog.java", "diffHunk": "@@ -8,7 +8,6 @@\n import com.ichi2.anki.CollectionHelper;\n import com.ichi2.anki.R;\n import com.ichi2.anki.UIUtils;\n-import com.ichi2.anki.analytics.AnalyticsDialogFragment;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM3Mjk1Nw=="}, "originalCommit": {"oid": "99f716cbf63dc1ba44a8400cc9f6a1055ce2d28c"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxODM2Mjg4OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/test/java/com/ichi2/libanki/ClozeTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxNToxMTo0N1rOGgKGzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxNToxMTo0N1rOGgKGzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM3MzE5Nw==", "bodyText": "Nitpick - Same", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436373197", "createdAt": "2020-06-07T15:11:47Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/libanki/ClozeTest.java", "diffHunk": "@@ -3,19 +3,15 @@\n import android.content.Context;\n \n import com.ichi2.anki.RobolectricTest;\n-import com.ichi2.libanki.template.Template;\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99f716cbf63dc1ba44a8400cc9f6a1055ce2d28c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxODM2MzAyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/test/java/com/ichi2/libanki/MathJaxClozeTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxNToxMTo1OVrOGgKG4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxNToxMTo1OVrOGgKG4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM3MzIxNw==", "bodyText": "Nitpick - same", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436373217", "createdAt": "2020-06-07T15:11:59Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/libanki/MathJaxClozeTest.java", "diffHunk": "@@ -5,18 +5,14 @@\n import com.ichi2.anki.RobolectricTest;\n import com.ichi2.libanki.Card;\n import com.ichi2.libanki.Collection;\n-import com.ichi2.libanki.Models;\n import com.ichi2.libanki.Note;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99f716cbf63dc1ba44a8400cc9f6a1055ce2d28c"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxODM2OTQ5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/test/java/com/ichi2/libanki/MathJaxClozeTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxNToyMToyNlrOGgKKMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxNToyMToyNlrOGgKKMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM3NDA2Ng==", "bodyText": "nit - same", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436374066", "createdAt": "2020-06-07T15:21:26Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/libanki/MathJaxClozeTest.java", "diffHunk": "@@ -5,18 +5,14 @@\n import com.ichi2.anki.RobolectricTest;\n import com.ichi2.libanki.Card;\n import com.ichi2.libanki.Collection;\n-import com.ichi2.libanki.Models;\n import com.ichi2.libanki.Note;\n import com.ichi2.libanki.template.Template;\n \n import org.junit.Test;\n import org.junit.runner.RunWith;\n \n import java.util.ArrayList;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99f716cbf63dc1ba44a8400cc9f6a1055ce2d28c"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxODM3MzAxOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/reviewer/ActionButtonStatus.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxNToyNjoyM1rOGgKMAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wN1QxNzo0ODo0NFrOGgK50Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM3NDUyOA==", "bodyText": "We need to be consistent with this.\n\nPreferences show \"ifRoom\", here shows \"never\".\n\nI'd be tempted to use \"never\" and change the preferences/layout.xml. Users can increase the priority if they desire.\n@mikehardy - does this seem sensible?", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436374528", "createdAt": "2020-06-07T15:26:23Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/reviewer/ActionButtonStatus.java", "diffHunk": "@@ -59,6 +59,7 @@ public void setup(SharedPreferences preferences) {\n         setupButton(preferences, R.id.action_suspend, \"customButtonSuspend\", SHOW_AS_ACTION_NEVER);\n         setupButton(preferences, R.id.action_mark_card, \"customButtonMarkCard\", SHOW_AS_ACTION_IF_ROOM);\n         setupButton(preferences, R.id.action_delete, \"customButtonDelete\", SHOW_AS_ACTION_NEVER);\n+        setupButton(preferences, R.id.action_toggle_mic_tool_bar, \"customButtonToggleMicToolBar\", SHOW_AS_ACTION_NEVER);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99f716cbf63dc1ba44a8400cc9f6a1055ce2d28c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM3Njg1Mw==", "bodyText": "Good catch - they definitely need to match, 'never' for new features is the correct default on the app bar buttons - it makes the new feature opt-in. That reminds me - can you propose an edit here https://github.com/ankidroid/ankidroiddocs/blob/master/manual.asc#action-bar-2 to match? We don't do a great job of keeping the manual up to date because we forget mostly \ud83d\ude05  - this is a cool feature though and this might be the only way people find out about it", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436376853", "createdAt": "2020-06-07T15:54:22Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/reviewer/ActionButtonStatus.java", "diffHunk": "@@ -59,6 +59,7 @@ public void setup(SharedPreferences preferences) {\n         setupButton(preferences, R.id.action_suspend, \"customButtonSuspend\", SHOW_AS_ACTION_NEVER);\n         setupButton(preferences, R.id.action_mark_card, \"customButtonMarkCard\", SHOW_AS_ACTION_IF_ROOM);\n         setupButton(preferences, R.id.action_delete, \"customButtonDelete\", SHOW_AS_ACTION_NEVER);\n+        setupButton(preferences, R.id.action_toggle_mic_tool_bar, \"customButtonToggleMicToolBar\", SHOW_AS_ACTION_NEVER);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM3NDUyOA=="}, "originalCommit": {"oid": "99f716cbf63dc1ba44a8400cc9f6a1055ce2d28c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM4NjI1Nw==", "bodyText": "Ok, so if I understand well, I keep SHOW_AS_ACTION_NEVER.\nHere is a text proposition for the manual:\nCheck Pronunciation\nThis action enables or disables the temporary audio recorder tool bar at the top of the card. This feature allows you to record your voice and replay it. It is useful to self checks your own pronunciation. This tool bar is composed of three buttons to : play, stop playing and record audio from microphone. This tool can be used at any time either during question side or than answer side.", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r436386257", "createdAt": "2020-06-07T17:48:44Z", "author": {"login": "dgeranton"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/reviewer/ActionButtonStatus.java", "diffHunk": "@@ -59,6 +59,7 @@ public void setup(SharedPreferences preferences) {\n         setupButton(preferences, R.id.action_suspend, \"customButtonSuspend\", SHOW_AS_ACTION_NEVER);\n         setupButton(preferences, R.id.action_mark_card, \"customButtonMarkCard\", SHOW_AS_ACTION_IF_ROOM);\n         setupButton(preferences, R.id.action_delete, \"customButtonDelete\", SHOW_AS_ACTION_NEVER);\n+        setupButton(preferences, R.id.action_toggle_mic_tool_bar, \"customButtonToggleMicToolBar\", SHOW_AS_ACTION_NEVER);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM3NDUyOA=="}, "originalCommit": {"oid": "99f716cbf63dc1ba44a8400cc9f6a1055ce2d28c"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNDU5MjIxOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/res/xml/preferences_custom_buttons.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMTo1NDozM1rOGhFtyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMTo1NDozM1rOGhFtyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0OTgzNQ==", "bodyText": "SHOW_AS_ACTION_NEVER to be consistent\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        android:defaultValue=\"1\"\n          \n          \n            \n                        android:defaultValue=\"0\"", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r437349835", "createdAt": "2020-06-09T11:54:33Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/xml/preferences_custom_buttons.xml", "diffHunk": "@@ -81,6 +81,12 @@ MENU_DISABLED = 3\n             android:entryValues=\"@array/custom_button_values\"\n             android:key=\"customButtonMarkCard\"\n             android:title=\"@string/menu_mark_note\" />\n+        <ListPreference\n+            android:defaultValue=\"1\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfb7b8e4436af3f84f7d5bda807a7aaa18936143"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNDU5ODQyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/res/menu/reviewer.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMTo1NjowNlrOGhFxYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxMTo1NjowNlrOGhFxYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM1MDc1NA==", "bodyText": "Consistency with other preferences\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    ankidroid:showAsAction=\"ifRoom\"/>\n          \n          \n            \n                    ankidroid:showAsAction=\"never\"/>", "url": "https://github.com/ankidroid/Anki-Android/pull/5774#discussion_r437350754", "createdAt": "2020-06-09T11:56:06Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/res/menu/reviewer.xml", "diffHunk": "@@ -61,6 +61,11 @@\n         android:title=\"@string/replay_audio\"\n         android:icon=\"@drawable/ic_play_circle_white\"\n         ankidroid:showAsAction=\"ifRoom\"/>\n+    <item\n+        android:id=\"@+id/action_toggle_mic_tool_bar\"\n+        android:title=\"@string/toggle_mic_tool_bar\"\n+        android:icon=\"@drawable/ic_action_mic\"\n+        ankidroid:showAsAction=\"ifRoom\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfb7b8e4436af3f84f7d5bda807a7aaa18936143"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 591, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}