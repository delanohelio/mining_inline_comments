{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4NDEwODk4", "number": 6901, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNlQxMTo0MTozNVrOEYy8qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwOTowODo0N1rOEY9kLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NDM2MDEwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/libanki/ModelTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNlQxMTo0MTozNVrOHBRz1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNlQyMzozNzozNFrOHBWKpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEwMjQyMw==", "bodyText": "I don't get this. Shouldn't it be 400_000 * 12 (4_800_000)?\nI think this would be more clear if you extracted both str and numberOfIterations variable, and used these in the calculation to obtain the final string length.", "url": "https://github.com/ankidroid/Anki-Android/pull/6901#discussion_r471102423", "createdAt": "2020-08-16T11:41:35Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/libanki/ModelTest.java", "diffHunk": "@@ -37,8 +37,8 @@ public void tearDown() {\n     public void bigQuery() throws IOException {\n         Models models = testCol.getModels();\n         Model model = models.all().get(0);\n-        StringBuffer buf = new StringBuffer();\n-        for (long i = 0L; i < 400_000L; ++i ) {\n+        StringBuilder buf = new StringBuilder(4_000_010);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63f331a30808b0758b0898fa1cac03b54ebf7a34"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEyNzA1MA==", "bodyText": "Agreed, str.length can be used as the multipler for the numberOfIterations variable", "url": "https://github.com/ankidroid/Anki-Android/pull/6901#discussion_r471127050", "createdAt": "2020-08-16T15:40:21Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/libanki/ModelTest.java", "diffHunk": "@@ -37,8 +37,8 @@ public void tearDown() {\n     public void bigQuery() throws IOException {\n         Models models = testCol.getModels();\n         Model model = models.all().get(0);\n-        StringBuffer buf = new StringBuffer();\n-        for (long i = 0L; i < 400_000L; ++i ) {\n+        StringBuilder buf = new StringBuilder(4_000_010);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEwMjQyMw=="}, "originalCommit": {"oid": "63f331a30808b0758b0898fa1cac03b54ebf7a34"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE3Mzc5OA==", "bodyText": "I thought my string had 10 letters. Added a little padding on top of it. I don't know how to count", "url": "https://github.com/ankidroid/Anki-Android/pull/6901#discussion_r471173798", "createdAt": "2020-08-16T23:37:34Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/libanki/ModelTest.java", "diffHunk": "@@ -37,8 +37,8 @@ public void tearDown() {\n     public void bigQuery() throws IOException {\n         Models models = testCol.getModels();\n         Model model = models.all().get(0);\n-        StringBuffer buf = new StringBuffer();\n-        for (long i = 0L; i < 400_000L; ++i ) {\n+        StringBuilder buf = new StringBuilder(4_000_010);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEwMjQyMw=="}, "originalCommit": {"oid": "63f331a30808b0758b0898fa1cac03b54ebf7a34"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NDk3NDgwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/libanki/ModelTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwMDoxMjowOVrOHBWbhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwMDoxMjowOVrOHBWbhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE3ODExOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    final int size = 4 * 1024 * 1024;\n          \n          \n            \n                    String testString = \"test\";\n          \n          \n            \n                    final int size = test.length() * 1024 * 1024;", "url": "https://github.com/ankidroid/Anki-Android/pull/6901#discussion_r471178118", "createdAt": "2020-08-17T00:12:09Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/libanki/ModelTest.java", "diffHunk": "@@ -37,9 +37,11 @@ public void tearDown() {\n     public void bigQuery() throws IOException {\n         Models models = testCol.getModels();\n         Model model = models.all().get(0);\n-        StringBuffer buf = new StringBuffer();\n-        for (long i = 0L; i < 400_000L; ++i ) {\n-            buf.append(\"abcdefghijkl\");\n+        final int size = 4 * 1024 * 1024;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84f01d5de4bb5c843b64693ea320d4730f839587"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NDk3NTUzOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/libanki/ModelTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwMDoxMjo1NFrOHBWb6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwOTo0NjoyOFrOHBh1PA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE3ODIxNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    model.put(\"test\", buf.toString());\n          \n          \n            \n                    model.put(testString, buf.toString());\n          \n      \n    \n    \n  \n\nI think this is what David and I meant - make it so that no one has to count anything", "url": "https://github.com/ankidroid/Anki-Android/pull/6901#discussion_r471178216", "createdAt": "2020-08-17T00:12:54Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/libanki/ModelTest.java", "diffHunk": "@@ -37,9 +37,11 @@ public void tearDown() {\n     public void bigQuery() throws IOException {\n         Models models = testCol.getModels();\n         Model model = models.all().get(0);\n-        StringBuffer buf = new StringBuffer();\n-        for (long i = 0L; i < 400_000L; ++i ) {\n-            buf.append(\"abcdefghijkl\");\n+        final int size = 4 * 1024 * 1024;\n+        StringBuilder buf = new StringBuilder(size * 1.01);\n+        // * 1.01 for padding\n+        for (int i = 0; i < size; ++i ) {\n+            buf.append(\"a\");\n         }\n         model.put(\"test\", buf.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "84f01d5de4bb5c843b64693ea320d4730f839587"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTM2NDkyNA==", "bodyText": "I was referring to the line: buf.append( );, the key shouldn't matter as it's only set once, but there's not a problem with using the same variable", "url": "https://github.com/ankidroid/Anki-Android/pull/6901#discussion_r471364924", "createdAt": "2020-08-17T09:46:28Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/libanki/ModelTest.java", "diffHunk": "@@ -37,9 +37,11 @@ public void tearDown() {\n     public void bigQuery() throws IOException {\n         Models models = testCol.getModels();\n         Model model = models.all().get(0);\n-        StringBuffer buf = new StringBuffer();\n-        for (long i = 0L; i < 400_000L; ++i ) {\n-            buf.append(\"abcdefghijkl\");\n+        final int size = 4 * 1024 * 1024;\n+        StringBuilder buf = new StringBuilder(size * 1.01);\n+        // * 1.01 for padding\n+        for (int i = 0; i < size; ++i ) {\n+            buf.append(\"a\");\n         }\n         model.put(\"test\", buf.toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE3ODIxNg=="}, "originalCommit": {"oid": "84f01d5de4bb5c843b64693ea320d4730f839587"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NjA5OTY1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/libanki/ModelTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwOTowODo0N1rOHBglyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QwOToyOTowN1rOHBhQXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTM0NDU4Nw==", "bodyText": "This works, but it's decreased from 4.8MM to 4.1MM. Just confirming it's intentional", "url": "https://github.com/ankidroid/Anki-Android/pull/6901#discussion_r471344587", "createdAt": "2020-08-17T09:08:47Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/libanki/ModelTest.java", "diffHunk": "@@ -37,16 +37,19 @@ public void tearDown() {\n     public void bigQuery() throws IOException {\n         Models models = testCol.getModels();\n         Model model = models.all().get(0);\n-        StringBuffer buf = new StringBuffer();\n-        for (long i = 0L; i < 400_000L; ++i ) {\n-            buf.append(\"abcdefghijkl\");\n+        final String testString = \"test\";\n+        final int size = testString.length() * 1024 * 1024;\n+        StringBuilder buf = new StringBuilder((int) (size * 1.01));\n+        // * 1.01 for padding\n+        for (int i = 0; i < 1024 * 1024 ; ++i ) {\n+            buf.append(testString);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "514edd6286b4497c634423910eb95ae5e1a480a5"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTM1NTQ4NQ==", "bodyText": "Not intentional. Mostly because I thought there were 10 and not 12 letter previously. So that used to be unintentional too... What I care about is that it's more than 2MB, which is current requery's windows limit. Any number above it is fine to test what I want to test.", "url": "https://github.com/ankidroid/Anki-Android/pull/6901#discussion_r471355485", "createdAt": "2020-08-17T09:29:07Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/libanki/ModelTest.java", "diffHunk": "@@ -37,16 +37,19 @@ public void tearDown() {\n     public void bigQuery() throws IOException {\n         Models models = testCol.getModels();\n         Model model = models.all().get(0);\n-        StringBuffer buf = new StringBuffer();\n-        for (long i = 0L; i < 400_000L; ++i ) {\n-            buf.append(\"abcdefghijkl\");\n+        final String testString = \"test\";\n+        final int size = testString.length() * 1024 * 1024;\n+        StringBuilder buf = new StringBuilder((int) (size * 1.01));\n+        // * 1.01 for padding\n+        for (int i = 0; i < 1024 * 1024 ; ++i ) {\n+            buf.append(testString);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTM0NDU4Nw=="}, "originalCommit": {"oid": "514edd6286b4497c634423910eb95ae5e1a480a5"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4855, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}