{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MTM2OTk1", "number": 5823, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDozMTozM1rODoRRww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODowNjowMlrODpOSBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTUyNzA3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDozMTozM1rOF2tzCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDozMTozM1rOF2tzCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkxNzc3MA==", "bodyText": "Note: This is just used for logging, so it's fine to not internationalise.", "url": "https://github.com/ankidroid/Anki-Android/pull/5823#discussion_r392917770", "createdAt": "2020-03-16T10:31:33Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1714,6 +1715,25 @@ public long fixIntegrity(DeckTask.ProgressCallback progressCallback) {\n                     problems.add(\"Fixed \" + ids.size() + \" card(s) with invalid properties.\");\n                     mDb.execute(\"update cards set odid=0, odue=0 where id in \" + Utils.ids2str(ids));\n                 }\n+                {\n+                    //#5708 - a dynamic deck should not have \"Deck Options\"\n+                    fixIntegrityProgress(progressCallback, currentTask++, totalTasks);\n+                    int fixCount = 0;\n+                    for (long id : mDecks.allDynamicDeckIds()) {\n+                        try {\n+                            if (mDecks.hasDeckOptions(id)) {\n+                                mDecks.removeDeckOptions(id);\n+                                fixCount++;\n+                            }\n+                        } catch (NoSuchDeckException e) {\n+                            Timber.e(\"Unable to find dynamic deck %d\", id);\n+                        }\n+                    }\n+                    if (fixCount > 0) {\n+                        mDecks.save();\n+                        problems.add(String.format(Locale.US, \"%d dynamic deck(s) had deck options.\", fixCount));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2198209fe3257ebe922f89faf699cf8b27c4767f"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTUyOTcwOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDozMjowNlrOF2t0tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDozMjowNlrOF2t0tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkxODE5Nw==", "bodyText": "This is fine to log and ignore", "url": "https://github.com/ankidroid/Anki-Android/pull/5823#discussion_r392918197", "createdAt": "2020-03-16T10:32:06Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1714,6 +1715,25 @@ public long fixIntegrity(DeckTask.ProgressCallback progressCallback) {\n                     problems.add(\"Fixed \" + ids.size() + \" card(s) with invalid properties.\");\n                     mDb.execute(\"update cards set odid=0, odue=0 where id in \" + Utils.ids2str(ids));\n                 }\n+                {\n+                    //#5708 - a dynamic deck should not have \"Deck Options\"\n+                    fixIntegrityProgress(progressCallback, currentTask++, totalTasks);\n+                    int fixCount = 0;\n+                    for (long id : mDecks.allDynamicDeckIds()) {\n+                        try {\n+                            if (mDecks.hasDeckOptions(id)) {\n+                                mDecks.removeDeckOptions(id);\n+                                fixCount++;\n+                            }\n+                        } catch (NoSuchDeckException e) {\n+                            Timber.e(\"Unable to find dynamic deck %d\", id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2198209fe3257ebe922f89faf699cf8b27c4767f"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTcwOTU1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMToyMjozMVrOF2vnLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMToyMjozMVrOF2vnLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk0NzUwMg==", "bodyText": "This doesn't touch the database, jut marks it as dirty.", "url": "https://github.com/ankidroid/Anki-Android/pull/5823#discussion_r392947502", "createdAt": "2020-03-16T11:22:31Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1714,6 +1715,25 @@ public long fixIntegrity(DeckTask.ProgressCallback progressCallback) {\n                     problems.add(\"Fixed \" + ids.size() + \" card(s) with invalid properties.\");\n                     mDb.execute(\"update cards set odid=0, odue=0 where id in \" + Utils.ids2str(ids));\n                 }\n+                {\n+                    //#5708 - a dynamic deck should not have \"Deck Options\"\n+                    fixIntegrityProgress(progressCallback, currentTask++, totalTasks);\n+                    int fixCount = 0;\n+                    for (long id : mDecks.allDynamicDeckIds()) {\n+                        try {\n+                            if (mDecks.hasDeckOptions(id)) {\n+                                mDecks.removeDeckOptions(id);\n+                                fixCount++;\n+                            }\n+                        } catch (NoSuchDeckException e) {\n+                            Timber.e(\"Unable to find dynamic deck %d\", id);\n+                        }\n+                    }\n+                    if (fixCount > 0) {\n+                        mDecks.save();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2198209fe3257ebe922f89faf699cf8b27c4767f"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NTUwNTkzOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODowMTozMlrOF4Q1xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODowMTozMlrOF4Q1xQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0MDQ4NQ==", "bodyText": "nit: should remove the counts from the comment as they will skew as they have now\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    int totalTasks = (mModels.all().size() * 4) + 21; // 4 things are in all-models loops, 20 things are one-offs\n          \n          \n            \n                    int totalTasks = (mModels.all().size() * 4) + 21; // a few fixes are in all-models loops, the rest are one-offs", "url": "https://github.com/ankidroid/Anki-Android/pull/5823#discussion_r394540485", "createdAt": "2020-03-18T18:01:32Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1606,7 +1607,7 @@ public long fixIntegrity(DeckTask.ProgressCallback progressCallback) {\n         ArrayList<String> problems = new ArrayList<>();\n         long oldSize = file.length();\n         int currentTask = 1;\n-        int totalTasks = (mModels.all().size() * 4) + 20; // 4 things are in all-models loops, 20 things are one-offs\n+        int totalTasks = (mModels.all().size() * 4) + 21; // 4 things are in all-models loops, 20 things are one-offs", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2633c445be7b99eff4e757ed91851f6e26b03e72"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NTUwOTcxOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AnkiDroidApp.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODowMjozOFrOF4Q4Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODowMjozOFrOF4Q4Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0MTEzOA==", "bodyText": "\ud83e\udd26\u200d\u2642\ufe0f just did 50, next is 51 sorry\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static final int CHECK_DB_AT_VERSION = 21000150;\n          \n          \n            \n                public static final int CHECK_DB_AT_VERSION = 21000151;", "url": "https://github.com/ankidroid/Anki-Android/pull/5823#discussion_r394541138", "createdAt": "2020-03-18T18:02:38Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AnkiDroidApp.java", "diffHunk": "@@ -157,7 +157,7 @@\n      * collections being upgraded to (or after) this version must run an integrity check as it will contain fixes that\n      * all collections should have.\n      */\n-    public static final int CHECK_DB_AT_VERSION = 20900148;\n+    public static final int CHECK_DB_AT_VERSION = 21000150;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2633c445be7b99eff4e757ed91851f6e26b03e72"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NTUxODE1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODowNDo1OVrOF4Q96A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOToxNzozOFrOF4Tc4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0MjU2OA==", "bodyText": "none of the other ones have their own block scope - they could maybe use a newline between each fix, but they don't have independent scopes", "url": "https://github.com/ankidroid/Anki-Android/pull/5823#discussion_r394542568", "createdAt": "2020-03-18T18:04:59Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1714,6 +1715,25 @@ public long fixIntegrity(DeckTask.ProgressCallback progressCallback) {\n                     problems.add(\"Fixed \" + ids.size() + \" card(s) with invalid properties.\");\n                     mDb.execute(\"update cards set odid=0, odue=0 where id in \" + Utils.ids2str(ids));\n                 }\n+                {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2633c445be7b99eff4e757ed91851f6e26b03e72"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU2MDA0OQ==", "bodyText": "Block scope gives you the ability to define more concise names (fixCount). I like it in this situation, as they are independent operations which ideally shouldn't be in a large function.\nWould you prefer I removed it?", "url": "https://github.com/ankidroid/Anki-Android/pull/5823#discussion_r394560049", "createdAt": "2020-03-18T18:35:13Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1714,6 +1715,25 @@ public long fixIntegrity(DeckTask.ProgressCallback progressCallback) {\n                     problems.add(\"Fixed \" + ids.size() + \" card(s) with invalid properties.\");\n                     mDb.execute(\"update cards set odid=0, odue=0 where id in \" + Utils.ids2str(ids));\n                 }\n+                {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0MjU2OA=="}, "originalCommit": {"oid": "2633c445be7b99eff4e757ed91851f6e26b03e72"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU4MzI2Ng==", "bodyText": "ok - I'll go with implementor's choice ;-)", "url": "https://github.com/ankidroid/Anki-Android/pull/5823#discussion_r394583266", "createdAt": "2020-03-18T19:17:38Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1714,6 +1715,25 @@ public long fixIntegrity(DeckTask.ProgressCallback progressCallback) {\n                     problems.add(\"Fixed \" + ids.size() + \" card(s) with invalid properties.\");\n                     mDb.execute(\"update cards set odid=0, odue=0 where id in \" + Utils.ids2str(ids));\n                 }\n+                {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0MjU2OA=="}, "originalCommit": {"oid": "2633c445be7b99eff4e757ed91851f6e26b03e72"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0NTUyMTk3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODowNjowMlrOF4RATA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxODowNjowMlrOF4RATA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0MzE4MA==", "bodyText": "maybe dynDeckFixCount? - just a more specific name so I don't think of this as global fixes", "url": "https://github.com/ankidroid/Anki-Android/pull/5823#discussion_r394543180", "createdAt": "2020-03-18T18:06:02Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1714,6 +1715,25 @@ public long fixIntegrity(DeckTask.ProgressCallback progressCallback) {\n                     problems.add(\"Fixed \" + ids.size() + \" card(s) with invalid properties.\");\n                     mDb.execute(\"update cards set odid=0, odue=0 where id in \" + Utils.ids2str(ids));\n                 }\n+                {\n+                    //#5708 - a dynamic deck should not have \"Deck Options\"\n+                    fixIntegrityProgress(progressCallback, currentTask++, totalTasks);\n+                    int fixCount = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2633c445be7b99eff4e757ed91851f6e26b03e72"}, "originalPosition": 24}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 432, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}