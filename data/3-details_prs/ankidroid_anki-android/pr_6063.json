{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2OTgwNTQ1", "number": 6063, "title": "Allow preview of note edits", "bodyText": "Pull Request template\nPurpose / Description\nThe Note Editor did not allow preview, a heavily requested feature\nFixes\nFixes #5644 / Obsoletes #5705\nFixes #3819\nApproach\nI re-use the CardTemplatePreviewer which is good for ephemeral data, with extensions to it's functionality where it can take a bundle from NoteEditor and use that to populate the card it shows with the unsaved note editor contents\nHow Has This Been Tested?\nAPI28 emulator, editing a note and hitting the new preview button to see that my edits are now shown in a preview screen. When you cancel the note edit session the edits go away. Seems to work\nCardTemplateEditor preview still works as well on same API28 emulator\nChecklist\nPlease, go through these checks before submitting the PR.\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-04-22T00:47:27Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6063", "merged": true, "mergeCommit": {"oid": "e43759a50c526921800ccd24306c2f6be5eb9670"}, "closed": true, "closedAt": "2020-06-14T22:39:23Z", "author": {"login": "mikehardy"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcb79tDABqjMyNzg0OTg3NzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrQl1fAH2gAyNDA2OTgwNTQ1OmQ0NDNjZjM2ZmZlN2U1NjFiYjdkOTE5YjEwOTMyMGYwZmZiMGJiZjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "28f7156e7395e4687940b5d0ee5063351569d77d", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/28f7156e7395e4687940b5d0ee5063351569d77d", "committedDate": "2020-04-22T00:40:42Z", "message": "Allow preview of note edits\n\nFixes #5644 / Obsoletes #5705"}, "afterCommit": {"oid": "753da7c27129477f5737f71d2c0fe8f92f21a126", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/753da7c27129477f5737f71d2c0fe8f92f21a126", "committedDate": "2020-04-28T04:12:37Z", "message": "Send NoteEditor edits through CardTemplateEditor to CardTemplatePreviewer\n\nThis allows the preview of the combination of note and template changes,\nwhile everything is still unsaved"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "753da7c27129477f5737f71d2c0fe8f92f21a126", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/753da7c27129477f5737f71d2c0fe8f92f21a126", "committedDate": "2020-04-28T04:12:37Z", "message": "Send NoteEditor edits through CardTemplateEditor to CardTemplatePreviewer\n\nThis allows the preview of the combination of note and template changes,\nwhile everything is still unsaved"}, "afterCommit": {"oid": "98a922c887456ed9c4d31bb06a0b4207129b89f1", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/98a922c887456ed9c4d31bb06a0b4207129b89f1", "committedDate": "2020-06-12T22:36:01Z", "message": "Allow preview of note edits\n\nFixes #5644 / Obsoletes #5705"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDgwOTk5", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#pullrequestreview-430080999", "createdAt": "2020-06-12T23:20:18Z", "commit": {"oid": "98a922c887456ed9c4d31bb06a0b4207129b89f1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMzoyMDoxOFrOGjTyFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMzozMTowNVrOGjT5hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NzQ2MQ==", "bodyText": "Could you extract mCurrentCard.note(), it's fine from a performance standpoint, but makes me double-take.", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#discussion_r439677461", "createdAt": "2020-06-12T23:20:18Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardTemplatePreviewer.java", "diffHunk": "@@ -132,6 +135,30 @@ protected void onCollectionLoaded(Collection col) {\n         if (mCurrentCard == null) {\n             mCurrentCard = new PreviewerCard(col, mCardList[mOrdinal]);\n         }\n+\n+        if (mNoteEditorBundle != null) {\n+            mCurrentCard.setDid(mNoteEditorBundle.getLong(\"did\"));\n+\n+            // Clear out old tags, add current tags as that can affect render\n+            for (String tag : mCurrentCard.note().getTags()) {\n+                mCurrentCard.note().delTag(tag);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98a922c887456ed9c4d31bb06a0b4207129b89f1"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3OTM2NA==", "bodyText": "This feels like it'll cause a ConcurrentModificationException. Could you do a defensive copy to ensure this won't happen.", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#discussion_r439679364", "createdAt": "2020-06-12T23:31:05Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardTemplatePreviewer.java", "diffHunk": "@@ -132,6 +135,30 @@ protected void onCollectionLoaded(Collection col) {\n         if (mCurrentCard == null) {\n             mCurrentCard = new PreviewerCard(col, mCardList[mOrdinal]);\n         }\n+\n+        if (mNoteEditorBundle != null) {\n+            mCurrentCard.setDid(mNoteEditorBundle.getLong(\"did\"));\n+\n+            // Clear out old tags, add current tags as that can affect render\n+            for (String tag : mCurrentCard.note().getTags()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98a922c887456ed9c4d31bb06a0b4207129b89f1"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDkyNTUy", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#pullrequestreview-430092552", "createdAt": "2020-06-13T00:23:27Z", "commit": {"oid": "98a922c887456ed9c4d31bb06a0b4207129b89f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwMDoyMzoyN1rOGjUZKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QwMDoyMzoyN1rOGjUZKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY4NzQ2NQ==", "bodyText": "Optional: Could extract to a method on note", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#discussion_r439687465", "createdAt": "2020-06-13T00:23:27Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardTemplatePreviewer.java", "diffHunk": "@@ -132,6 +135,30 @@ protected void onCollectionLoaded(Collection col) {\n         if (mCurrentCard == null) {\n             mCurrentCard = new PreviewerCard(col, mCardList[mOrdinal]);\n         }\n+\n+        if (mNoteEditorBundle != null) {\n+            mCurrentCard.setDid(mNoteEditorBundle.getLong(\"did\"));\n+\n+            // Clear out old tags, add current tags as that can affect render\n+            for (String tag : mCurrentCard.note().getTags()) {\n+                mCurrentCard.note().delTag(tag);\n+            }\n+            ArrayList<String> tags = mNoteEditorBundle.getStringArrayList(\"tags\");\n+            if (tags != null) {\n+                for (String tag : tags) {\n+                    if (!mCurrentCard.note().hasTag(tag)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98a922c887456ed9c4d31bb06a0b4207129b89f1"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "117b86ea6f6d4998bd7adec13a99d8472ab1a477", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/117b86ea6f6d4998bd7adec13a99d8472ab1a477", "committedDate": "2020-06-13T20:26:01Z", "message": "NF: de-lint NoteEditor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cc3d499353737e7a3f67e631e82b58426729004", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8cc3d499353737e7a3f67e631e82b58426729004", "committedDate": "2020-06-13T20:39:18Z", "message": "NF: de-lint CardTemplatePreviewer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17ead7a528a4bb022073a9a6db959b795d51f1e0", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/17ead7a528a4bb022073a9a6db959b795d51f1e0", "committedDate": "2020-06-13T21:53:22Z", "message": "NF: Use concrete ArrayList for tags so Bundle put/get works"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c813b2a4854a5c2e1a6937f22a2eda8989949c9", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2c813b2a4854a5c2e1a6937f22a2eda8989949c9", "committedDate": "2020-06-13T21:53:26Z", "message": "Add Preview to NoteEditor, re-uses CardTtemplatePreviewer for display\n\nFixes #6544"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36604cf8081589aa134322416af4ff9125da99b3", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/36604cf8081589aa134322416af4ff9125da99b3", "committedDate": "2020-06-13T22:01:29Z", "message": "Stay in NoteEditor after template edit if in add note mode\n\nPreviously it would detect the \"current card\" as missing and close\nafter a template edit because you don't want to edit a card that goes\naway, but in add note mode there are no cards yet, and it's fine to\ncontinue editing"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "98a922c887456ed9c4d31bb06a0b4207129b89f1", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/98a922c887456ed9c4d31bb06a0b4207129b89f1", "committedDate": "2020-06-12T22:36:01Z", "message": "Allow preview of note edits\n\nFixes #5644 / Obsoletes #5705"}, "afterCommit": {"oid": "36604cf8081589aa134322416af4ff9125da99b3", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/36604cf8081589aa134322416af4ff9125da99b3", "committedDate": "2020-06-13T22:01:29Z", "message": "Stay in NoteEditor after template edit if in add note mode\n\nPreviously it would detect the \"current card\" as missing and close\nafter a template edit because you don't want to edit a card that goes\naway, but in add note mode there are no cards yet, and it's fine to\ncontinue editing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e584096a87dd6c15fd4ab5e3c4525d49cbcc199", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2e584096a87dd6c15fd4ab5e3c4525d49cbcc199", "committedDate": "2020-06-13T22:56:59Z", "message": "NF: add test for preview of edit on existing note"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjI3ODg5", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#pullrequestreview-430227889", "createdAt": "2020-06-14T15:15:30Z", "commit": {"oid": "2e584096a87dd6c15fd4ab5e3c4525d49cbcc199"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNToxNTozMFrOGjdr8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNToxNTozMFrOGjdr8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgzOTcyOQ==", "bodyText": "the old name seems better (but it's not good).", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#discussion_r439839729", "createdAt": "2020-06-14T15:15:30Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/NoteEditor.java", "diffHunk": "@@ -1351,7 +1373,7 @@ private void initFieldEditText(FieldEditText editText, final int index, String[]\n             public void afterTextChanged(Editable arg0) {\n                 mFieldEdited = true;\n                 if (index == 0) {\n-                    duplicateCheck();\n+                    setDuplicateFieldStyles();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e584096a87dd6c15fd4ab5e3c4525d49cbcc199"}, "originalPosition": 312}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjM1NjY0", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#pullrequestreview-430235664", "createdAt": "2020-06-14T17:03:24Z", "commit": {"oid": "2e584096a87dd6c15fd4ab5e3c4525d49cbcc199"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjM5MjQy", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#pullrequestreview-430239242", "createdAt": "2020-06-14T17:57:40Z", "commit": {"oid": "17ead7a528a4bb022073a9a6db959b795d51f1e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNzo1Nzo0MVrOGjehrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxNzo1Nzo0MVrOGjehrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg1MzQ4Ng==", "bodyText": "Is there any particular reason to indicate which kinds of list is used everywhere ? Are we using any feature that is not available to standard list ?\nI'd assume that it would be better to leave types as generic as possible, in order to have the freedom to change implementation as easily as possible if we ever want it.", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#discussion_r439853486", "createdAt": "2020-06-14T17:57:41Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/NoteEditor.java", "diffHunk": "@@ -176,7 +176,7 @@\n \n     private Note mEditorNote;\n     public static Card mCurrentEditedCard;\n-    private List<String> mSelectedTags;\n+    private ArrayList<String> mSelectedTags;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ead7a528a4bb022073a9a6db959b795d51f1e0"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjM5ODYx", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#pullrequestreview-430239861", "createdAt": "2020-06-14T18:06:43Z", "commit": {"oid": "2c813b2a4854a5c2e1a6937f22a2eda8989949c9"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxODowNjo0M1rOGjekfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxODoxNTowOFrOGjenFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg1NDIwNA==", "bodyText": "Any reason to transform it into an array before iterating ?\nI would expect it to be easier to iterate on the list directly. In particular it would avoid to create an array just to discard it after", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#discussion_r439854204", "createdAt": "2020-06-14T18:06:43Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardTemplatePreviewer.java", "diffHunk": "@@ -135,6 +138,32 @@ protected void onCollectionLoaded(Collection col) {\n         if (mCurrentCard == null) {\n             mCurrentCard = new PreviewerCard(col, mCardList[mOrdinal]);\n         }\n+\n+        if (mNoteEditorBundle != null) {\n+            mCurrentCard.setDid(mNoteEditorBundle.getLong(\"did\"));\n+\n+            // Clear out old tags, add current tags as that can affect render\n+            Note currentNote = mCurrentCard.note();\n+            String[] currentTags = currentNote.getTags().toArray(new String[0]);\n+            for (String tag : currentTags) {\n+                currentNote.delTag(tag);\n+            }\n+            ArrayList<String> tagsList = mNoteEditorBundle.getStringArrayList(\"tags\");\n+            if (tagsList != null) {\n+                for (String tag : tagsList.toArray(new String[0])) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c813b2a4854a5c2e1a6937f22a2eda8989949c9"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg1NDI5NA==", "bodyText": "I may assume that you fear the list gets modified during execution, leading to an error, maybe a comment would make it more clear", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#discussion_r439854294", "createdAt": "2020-06-14T18:07:53Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardTemplatePreviewer.java", "diffHunk": "@@ -135,6 +138,32 @@ protected void onCollectionLoaded(Collection col) {\n         if (mCurrentCard == null) {\n             mCurrentCard = new PreviewerCard(col, mCardList[mOrdinal]);\n         }\n+\n+        if (mNoteEditorBundle != null) {\n+            mCurrentCard.setDid(mNoteEditorBundle.getLong(\"did\"));\n+\n+            // Clear out old tags, add current tags as that can affect render\n+            Note currentNote = mCurrentCard.note();\n+            String[] currentTags = currentNote.getTags().toArray(new String[0]);\n+            for (String tag : currentTags) {\n+                currentNote.delTag(tag);\n+            }\n+            ArrayList<String> tagsList = mNoteEditorBundle.getStringArrayList(\"tags\");\n+            if (tagsList != null) {\n+                for (String tag : tagsList.toArray(new String[0])) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg1NDIwNA=="}, "originalCommit": {"oid": "2c813b2a4854a5c2e1a6937f22a2eda8989949c9"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg1NDg3MQ==", "bodyText": "Usually, you add a tag without checking whether it is already in the list of tag, so this is quite strange to read.\nI don't expect it to be a problem in any way, since there is not enough tag for the inefficiency to matter. I still would feel like that it would be clearer to put in Note.java a method setTags(List<String>); and leave this background task to Note.", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#discussion_r439854871", "createdAt": "2020-06-14T18:15:08Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardTemplatePreviewer.java", "diffHunk": "@@ -135,6 +138,32 @@ protected void onCollectionLoaded(Collection col) {\n         if (mCurrentCard == null) {\n             mCurrentCard = new PreviewerCard(col, mCardList[mOrdinal]);\n         }\n+\n+        if (mNoteEditorBundle != null) {\n+            mCurrentCard.setDid(mNoteEditorBundle.getLong(\"did\"));\n+\n+            // Clear out old tags, add current tags as that can affect render\n+            Note currentNote = mCurrentCard.note();\n+            String[] currentTags = currentNote.getTags().toArray(new String[0]);\n+            for (String tag : currentTags) {\n+                currentNote.delTag(tag);\n+            }\n+            ArrayList<String> tagsList = mNoteEditorBundle.getStringArrayList(\"tags\");\n+            if (tagsList != null) {\n+                for (String tag : tagsList.toArray(new String[0])) {\n+                    if (!currentNote.hasTag(tag)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c813b2a4854a5c2e1a6937f22a2eda8989949c9"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMjQwODIy", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#pullrequestreview-430240822", "createdAt": "2020-06-14T18:22:25Z", "commit": {"oid": "36604cf8081589aa134322416af4ff9125da99b3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxODoyMjoyNVrOGjepQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNFQxODoyMjoyNVrOGjepQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg1NTQyNw==", "bodyText": "I had trouble thinking how it could be true. mCurrentEditedCard was a card already existing, and card usually don't disappear unless you check for empty card. You are not supposed to be able to do it while you're reviewing.\nI then realized that it can be true if you change a note type. If I'm right, I believe a comment here would be nice to explain it. If I'm wrong, it shows explanation may help here.\nAs a side note, I don't really get the point. Even if the card did disappear, editing the note still makes sens. Either there are other cards and we may want to edit them. Or they are no other card, and in this case the fields won't be recoverable, and it's even more important to give a strong warning to user that they'll lose data.\nActually, I had to create an add-on for anki to warn when note would be deleted because it would generate no more card. It occured multiple time to me and was always an accident, a template I did badly edit. In all cases, I would have wanted anki to warn me instead of just deleting the note", "url": "https://github.com/ankidroid/Anki-Android/pull/6063#discussion_r439855427", "createdAt": "2020-06-14T18:22:25Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/NoteEditor.java", "diffHunk": "@@ -1136,9 +1136,13 @@ else if (fieldEditText.getText() != null) {\n                     mReloadRequired = true;\n                     mEditorNote.reloadModel();\n                     if (!mEditorNote.cards().contains(mCurrentEditedCard)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "36604cf8081589aa134322416af4ff9125da99b3"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d443cf36ffe7e561bb7d919b109320f0ffb0bbf8", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d443cf36ffe7e561bb7d919b109320f0ffb0bbf8", "committedDate": "2020-06-14T18:44:38Z", "message": "NF: comment clarification for tag copy in CardTemplatePreviewer"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3457, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}