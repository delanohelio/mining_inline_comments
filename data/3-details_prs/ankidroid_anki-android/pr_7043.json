{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxNTI1NzUx", "number": 7043, "title": "Access correct cursor window size when configuring collection chunk size", "bodyText": "Pull Request template\nPurpose / Description\nWe attempt to dynamically set the database cursor window chunk size we use for large text loading from sqlite, for performance reasons, but we were accessing the wrong field when attempting to do so\nFixes\nFixes #7031\nApproach\nI use the correct field name when reflecting, exactly as @david-allison-1 pointed out with no change really, but with actual testing to make 100% sure :-)\nHow Has This Been Tested?\nThe emulator was able to reproduce the problem, and now reproduces correct behavior:\n\n2020-09-07 11:17:13.819 5569-5569/com.ichi2.anki D/Collection: Reflectively discovered database default cursor window size 2097152\n\nLearning (optional, can help others)\nEven the simplest things can be screwed up! Haha - seriously though, I swear I tested this and saw it work, but here we are. Even Android Studio highlighted that it was a problem. An easy fix at least.\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-09-07T16:22:10Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7043", "merged": true, "mergeCommit": {"oid": "9633f00a12d92da8cccdbecdfbf03f5b77bf84ef"}, "closed": true, "closedAt": "2020-09-07T18:43:52Z", "author": {"login": "mikehardy"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGlhO3AFqTQ4MzY1NjU0NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdGln2sAFqTQ4MzY1OTA0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNjU2NTQ0", "url": "https://github.com/ankidroid/Anki-Android/pull/7043#pullrequestreview-483656544", "createdAt": "2020-09-07T16:23:34Z", "commit": {"oid": "21717492f630fa24454c78c4b3fd6a13a3e00624"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxNjoyMzozNFrOHOEVxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxNjoyMzozNFrOHOEVxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxMzIyMQ==", "bodyText": "Can you also verify that this is non-negative, it's guaranteed not to be currently, but future refactorings introduce this risk as it can occur with the Android System class", "url": "https://github.com/ankidroid/Anki-Android/pull/7043#discussion_r484513221", "createdAt": "2020-09-07T16:23:34Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -310,9 +310,10 @@ private int getChunk() {\n         String db_name = ((DatabaseChangeDecorator) db).getWrapped().getClass().getName();\n         if (\"io.requery.android.database.sqlite.SQLiteDatabase\".equals(db_name)) {\n             try {\n-                Field cursorWindowSize = io.requery.android.database.CursorWindow.class.getDeclaredField(\"sCursorWindowSize\");\n+                Field cursorWindowSize = io.requery.android.database.CursorWindow.class.getDeclaredField(\"sDefaultCursorWindowSize\");\n                 cursorWindowSize.setAccessible(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21717492f630fa24454c78c4b3fd6a13a3e00624"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNjU2NjMy", "url": "https://github.com/ankidroid/Anki-Android/pull/7043#pullrequestreview-483656632", "createdAt": "2020-09-07T16:23:50Z", "commit": {"oid": "21717492f630fa24454c78c4b3fd6a13a3e00624"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e018f0fd1b509917c3d73f00fbf50c7d4cfea053", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e018f0fd1b509917c3d73f00fbf50c7d4cfea053", "committedDate": "2020-09-07T16:29:38Z", "message": "Access correct cursor window size when configuring collection chunk size\n\nMoreover, guard against non-sensical values"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21717492f630fa24454c78c4b3fd6a13a3e00624", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/21717492f630fa24454c78c4b3fd6a13a3e00624", "committedDate": "2020-09-07T16:18:11Z", "message": "Access correct cursor window size when configuring collection chunk size"}, "afterCommit": {"oid": "e018f0fd1b509917c3d73f00fbf50c7d4cfea053", "author": {"user": {"login": "mikehardy", "name": "Mike Hardy"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e018f0fd1b509917c3d73f00fbf50c7d4cfea053", "committedDate": "2020-09-07T16:29:38Z", "message": "Access correct cursor window size when configuring collection chunk size\n\nMoreover, guard against non-sensical values"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNjU5MDQ4", "url": "https://github.com/ankidroid/Anki-Android/pull/7043#pullrequestreview-483659048", "createdAt": "2020-09-07T16:30:48Z", "commit": {"oid": "e018f0fd1b509917c3d73f00fbf50c7d4cfea053"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4064, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}