{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMTYzOTg3", "number": 6257, "title": "string consisting only of whitespace does not generate card (Previously NF: clean _renderQA)", "bodyText": "In order to deal with LaTeX in browser, having a cleaner _renderQA seems nice.\nThis should be NF, with simple to follow commits", "createdAt": "2020-05-22T22:46:55Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6257", "merged": true, "mergeCommit": {"oid": "0f152133ceed0fa7eaab0a2e1b8902fdc080b928"}, "closed": true, "closedAt": "2020-06-17T17:56:59Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnl7hnABqjM0MDEyNDc0MTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsNmMZAFqTQzMjYzNTc3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a095eb2565da09bf70e5463ec8013ad41adc2e8b", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a095eb2565da09bf70e5463ec8013ad41adc2e8b", "committedDate": "2020-05-22T22:46:43Z", "message": "NF: _renderQA takes explicit argument"}, "afterCommit": {"oid": "378024856e7bb75a12fa09049c1c6cf78de79e28", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/378024856e7bb75a12fa09049c1c6cf78de79e28", "committedDate": "2020-06-03T09:20:29Z", "message": "NF: remove unused variable nid"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMzczODgz", "url": "https://github.com/ankidroid/Anki-Android/pull/6257#pullrequestreview-423373883", "createdAt": "2020-06-03T09:23:45Z", "commit": {"oid": "378024856e7bb75a12fa09049c1c6cf78de79e28"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwOToyMzo0NVrOGeThkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwOToyMzo0NVrOGeThkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQzMDM1NQ==", "bodyText": "Issue found: Avoid long parameter lists.", "url": "https://github.com/ankidroid/Anki-Android/pull/6257#discussion_r434430355", "createdAt": "2020-06-03T09:23:45Z", "author": {"login": "timrae"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1007,38 +1007,39 @@ public void updateFieldCache(long[] nids) {\n     /**\n      * Returns hash of id, question, answer.\n      */\n-    public HashMap<String, String> _renderQA(Object[] data) {\n-        return _renderQA(data, false, null, null);\n+    public HashMap<String, String> _renderQA(long cid, long mid, long did, int ord, String tags, String packedFields, int flags) {\n+        return _renderQA(cid, mid, did, ord, tags, packedFields, flags, false, null, null);\n     }\n \n-    public HashMap<String, String> _renderQA(Object[] data, boolean browser, String qfmt, String afmt) {\n+\n+    public HashMap<String, String> _renderQA(long cid, long mid, long did, int ord, String tags, String packedFields, int flags, boolean browser, String qfmt, String afmt) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "378024856e7bb75a12fa09049c1c6cf78de79e28"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4OTkzMDEy", "url": "https://github.com/ankidroid/Anki-Android/pull/6257#pullrequestreview-428993012", "createdAt": "2020-06-11T14:54:06Z", "commit": {"oid": "378024856e7bb75a12fa09049c1c6cf78de79e28"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4OTk4MTM0", "url": "https://github.com/ankidroid/Anki-Android/pull/6257#pullrequestreview-428998134", "createdAt": "2020-06-11T14:59:21Z", "commit": {"oid": "2b43e8effe2a279133fc07373a4b81b1d044e98b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNDo1OToyMVrOGihSZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNjoyNzo1M1rOGilU9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg1MDE1MQ==", "bodyText": "String.class should be faster than new String[a.size()] as it removes the array allocation", "url": "https://github.com/ankidroid/Anki-Android/pull/6257#discussion_r438850151", "createdAt": "2020-06-11T14:59:21Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Models.java", "diffHunk": "@@ -987,11 +987,13 @@ private void _updateRequired(JSONObject m) {\n             b.add(\"\");\n         }\n         Object[] data;\n-        data = new Object[] {1L, 1L, m.getLong(\"id\"), 1L, t.getInt(\"ord\"), \"\",\n-                             Utils.joinFields(a.toArray(new String[a.size()])), 0};\n+        Long mid = m.getLong(\"id\");\n+        int ord = t.getInt(\"ord\");\n+        String packedFields = Utils.joinFields(a.toArray(new String[a.size()]));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b43e8effe2a279133fc07373a4b81b1d044e98b"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODkxNjM0Mg==", "bodyText": "Architecturally better as a class, probably bad for performance though.", "url": "https://github.com/ankidroid/Anki-Android/pull/6257#discussion_r438916342", "createdAt": "2020-06-11T16:27:53Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1007,21 +1007,14 @@ public void updateFieldCache(long[] nids) {\n     /**\n      * Returns hash of id, question, answer.\n      */\n-    public HashMap<String, String> _renderQA(Object[] data) {\n-        return _renderQA(data, false, null, null);\n+    public HashMap<String, String> _renderQA(long cid, long nid, long mid, long did, int ord, String tags, String packedFields, int flags) {\n+        return _renderQA(cid, nid, mid, did, ord, tags, packedFields, flags, false, null, null);\n     }\n \n-    public HashMap<String, String> _renderQA(Object[] data, boolean browser, String qfmt, String afmt) {\n+\n+    public HashMap<String, String> _renderQA(long cid, long nid, long mid, long did, int ord, String tags, String packedFields, int flags, boolean browser, String qfmt, String afmt) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91fdeb6bcd634fa0c11c18dcc87c4dc32641985b"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "378024856e7bb75a12fa09049c1c6cf78de79e28", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/378024856e7bb75a12fa09049c1c6cf78de79e28", "committedDate": "2020-06-03T09:20:29Z", "message": "NF: remove unused variable nid"}, "afterCommit": {"oid": "7ce763dd8fda99d212f7ff234f6061b5df2e4585", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7ce763dd8fda99d212f7ff234f6061b5df2e4585", "committedDate": "2020-06-11T20:18:15Z", "message": "NF: _renderQA took an array of string"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7ce763dd8fda99d212f7ff234f6061b5df2e4585", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7ce763dd8fda99d212f7ff234f6061b5df2e4585", "committedDate": "2020-06-11T20:18:15Z", "message": "NF: _renderQA took an array of string"}, "afterCommit": {"oid": "5d5b0433669cf1e9b938f7f9bea49ef91bdcf75e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5d5b0433669cf1e9b938f7f9bea49ef91bdcf75e", "committedDate": "2020-06-11T22:15:00Z", "message": "NF: _renderQA took an array of string"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d5b0433669cf1e9b938f7f9bea49ef91bdcf75e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5d5b0433669cf1e9b938f7f9bea49ef91bdcf75e", "committedDate": "2020-06-11T22:15:00Z", "message": "NF: _renderQA took an array of string"}, "afterCommit": {"oid": "6e69a83cf22acbe01e9c4eaa0a8c417c73936f4c", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6e69a83cf22acbe01e9c4eaa0a8c417c73936f4c", "committedDate": "2020-06-13T20:54:39Z", "message": "NF: _renderQA took an array of string"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNTE5NDgx", "url": "https://github.com/ankidroid/Anki-Android/pull/6257#pullrequestreview-432519481", "createdAt": "2020-06-17T15:26:12Z", "commit": {"oid": "6e69a83cf22acbe01e9c4eaa0a8c417c73936f4c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNToyNjoxMlrOGlLLOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNToyNjoxMlrOGlLLOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYzMzU5Mg==", "bodyText": "The previous code did nothing, which was likely a bug. This performs a mutation.", "url": "https://github.com/ankidroid/Anki-Android/pull/6257#discussion_r441633592", "createdAt": "2020-06-17T15:26:12Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Models.java", "diffHunk": "@@ -1060,27 +1052,26 @@ private void _updateRequired(JSONObject m) {\n         type = \"any\";\n         req = new JSONArray();\n         for (int i = 0; i < flds.size(); i++) {\n-            tmp.clear();\n-            tmp.addAll(b);\n-            tmp.set(i, \"1\");\n-            data[6] = Utils.joinFields(tmp.toArray(new String[tmp.size()]));\n+            b[i] = \"1\";\n             // if not the same as empty, this field can make the card non-blank\n-            if (!mCol._renderQA(data).get(\"q\").equals(empty)) {\n+            if (!mCol._renderQA(1L, m, 1L, ord, \"\", b, 0).get(\"q\").equals(empty)) {\n                 req.put(i);\n             }\n+            b[i] = \"\";\n         }\n         return new Object[] { type, req };\n     }\n \n \n     /** Given a joined field string, return available template ordinals */\n-    public ArrayList<Integer> availOrds(JSONObject m, String flds) {\n+    public ArrayList<Integer> availOrds(JSONObject m, String[] sfld) {\n         if (m.getInt(\"type\") == Consts.MODEL_CLOZE) {\n-            return _availClozeOrds(m, flds);\n+            return _availClozeOrds(m, sfld);\n         }\n-        String[] fields = Utils.splitFields(flds);\n-        for (String f : fields) {\n-            f = f.trim();\n+        int nbField = sfld.length;\n+        String[] fields = new String[nbField];\n+        for (int i = 0; i < nbField; i++) {\n+            fields[i] = sfld[i].trim();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e69a83cf22acbe01e9c4eaa0a8c417c73936f4c"}, "originalPosition": 80}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNTg5NjE4", "url": "https://github.com/ankidroid/Anki-Android/pull/6257#pullrequestreview-432589618", "createdAt": "2020-06-17T16:50:02Z", "commit": {"oid": "6e69a83cf22acbe01e9c4eaa0a8c417c73936f4c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5accbabab1cd6ace54048d0ec4743593b681ef3", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f5accbabab1cd6ace54048d0ec4743593b681ef3", "committedDate": "2020-06-17T16:52:10Z", "message": "NF: remove a line"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08f1fb909e971e9d75aee5773833fcaa86d28a62", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/08f1fb909e971e9d75aee5773833fcaa86d28a62", "committedDate": "2020-06-17T16:52:10Z", "message": "NF: introducing a variable did"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d50227e99faed50b6975035c9a5a25c3c55d30a", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6d50227e99faed50b6975035c9a5a25c3c55d30a", "committedDate": "2020-06-17T16:52:10Z", "message": "NF: in Models: use variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70f7d541720b156717a69c770b01581c6d2bf017", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/70f7d541720b156717a69c770b01581c6d2bf017", "committedDate": "2020-06-17T16:52:10Z", "message": "NF: _renderQA: uses explicit variable name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0ed0d6aaec811c0ef49fe034b31e6bb6ba2698b", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d0ed0d6aaec811c0ef49fe034b31e6bb6ba2698b", "committedDate": "2020-06-17T16:52:10Z", "message": "NF: _renderQA takes explicit argument"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9871399c7b2fa65ddba26f4f3abf694637a51da7", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9871399c7b2fa65ddba26f4f3abf694637a51da7", "committedDate": "2020-06-17T16:52:10Z", "message": "NF: remove unused variable nid"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bb03a904b06a68b9f628bf3769ca9a698eb00a2", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5bb03a904b06a68b9f628bf3769ca9a698eb00a2", "committedDate": "2020-06-17T16:52:10Z", "message": "NF: Avoid recreating tmp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6501b95c8471f9fc2bcd67cf96cc793a7f98951", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e6501b95c8471f9fc2bcd67cf96cc793a7f98951", "committedDate": "2020-06-17T16:52:10Z", "message": "NF: remove variable tmp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "913f06b5cf85dc1610ebf020c926192aecbbe259", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/913f06b5cf85dc1610ebf020c926192aecbbe259", "committedDate": "2020-06-17T16:52:10Z", "message": "NF: uses array directly\n\nI do not know why, in f40a71d1244c09f14145baf112b2bb8c60c109f0, array\nlists were used and were always transformed into array.\n\nI have no reason to believe it is an actual performance trouble,\nespecially since this is executed only when note type are changed,\nbut to please\nhttps://github.com/ankidroid/Anki-Android/pull/6257/files/456cf7b42132a70c0e346c6bd996f2b3960ea1c4..2b43e8effe2a279133fc07373a4b81b1d044e98b#r438850151\nhere I make it more efficient by using arrays directly."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31a59290c6c252470f68d74a2d0501d357e9237e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/31a59290c6c252470f68d74a2d0501d357e9237e", "committedDate": "2020-06-17T16:52:10Z", "message": "NF: _availClozeOrds takes an array of string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6da049e52ecd3e3d1b43f1d8700193fa4abac2fd", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6da049e52ecd3e3d1b43f1d8700193fa4abac2fd", "committedDate": "2020-06-17T16:57:41Z", "message": "Bug correction: save trimming result\n\nCurrently, we differ from upstream, by trimming field content but not\nsaving the result. This is corrected.\n\nThis mean that if some field contains only whitespace, it used to be\nusable to generate a card, and no it won't be usable anymore. Doing\nthis, we follow upstream, and there is a risk we break some user card\nif they relayed on this specific feature."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d69222c9203a895e071aa68f4cedfa4a503c8e92", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d69222c9203a895e071aa68f4cedfa4a503c8e92", "committedDate": "2020-06-17T17:00:29Z", "message": "NF: _availClozeOrds takes an array of string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "053c3878daaaf35c65c10a46a5842a0a592afd32", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/053c3878daaaf35c65c10a46a5842a0a592afd32", "committedDate": "2020-06-17T17:01:03Z", "message": "NF: availOrds take an array of string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "859551de98a6ee19dcdad5b09772eb50788ea78d", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/859551de98a6ee19dcdad5b09772eb50788ea78d", "committedDate": "2020-06-17T17:01:03Z", "message": "NF: _renderQA took an array of string"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e69a83cf22acbe01e9c4eaa0a8c417c73936f4c", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6e69a83cf22acbe01e9c4eaa0a8c417c73936f4c", "committedDate": "2020-06-13T20:54:39Z", "message": "NF: _renderQA took an array of string"}, "afterCommit": {"oid": "859551de98a6ee19dcdad5b09772eb50788ea78d", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/859551de98a6ee19dcdad5b09772eb50788ea78d", "committedDate": "2020-06-17T17:01:03Z", "message": "NF: _renderQA took an array of string"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNjM1Nzc3", "url": "https://github.com/ankidroid/Anki-Android/pull/6257#pullrequestreview-432635777", "createdAt": "2020-06-17T17:49:14Z", "commit": {"oid": "859551de98a6ee19dcdad5b09772eb50788ea78d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3318, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}