{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyNDAyNzU0", "number": 6271, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNDoyOTowM1rOEBxZWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNDozMzowNFrOEBxgKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMjkzMzM3OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/AbstractSched.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNDoyOTowM1rOGd0c7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNDo0Njo0OVrOGd1PBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkyMTI2Mw==", "bodyText": "Ideally leave in a separate commit as it's a functionality change - has been an issue for some time.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Timber.e(\"LeechHook :: could not show leech toast as activity was null\");\n          \n          \n            \n                        Timber.w(\"LeechHook :: could not show leech toast as activity was null\");", "url": "https://github.com/ankidroid/Anki-Android/pull/6271#discussion_r433921263", "createdAt": "2020-06-02T14:29:03Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/AbstractSched.java", "diffHunk": "@@ -234,4 +239,25 @@ public String toString() {\n     public interface CountMethod {\n         int operation(long did, int lim);\n     }\n+\n+    protected static void leech(Card card, Activity activity) {\n+        if (activity != null) {\n+            Resources res = activity.getResources();\n+            final String leechMessage;\n+            if (card.getQueue() < 0) {\n+                leechMessage = res.getString(R.string.leech_suspend_notification);\n+            } else {\n+                leechMessage = res.getString(R.string.leech_notification);\n+            }\n+            activity.runOnUiThread(new Runnable() {\n+                @Override\n+                public void run() {\n+                    Toast.makeText(activity, leechMessage, Toast.LENGTH_SHORT).show();\n+                }\n+            });\n+\n+        } else {\n+            Timber.e(\"LeechHook :: could not show leech toast as activity was null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4064d91efa0cf9136883d8e1c9ce53a4bea01046"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkzMDM1Nw==", "bodyText": "I'm okay with adding this change if it please you. I've no idea what commit message to write. I do not know the reason of this change. Can you write the message please ?", "url": "https://github.com/ankidroid/Anki-Android/pull/6271#discussion_r433930357", "createdAt": "2020-06-02T14:41:54Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/AbstractSched.java", "diffHunk": "@@ -234,4 +239,25 @@ public String toString() {\n     public interface CountMethod {\n         int operation(long did, int lim);\n     }\n+\n+    protected static void leech(Card card, Activity activity) {\n+        if (activity != null) {\n+            Resources res = activity.getResources();\n+            final String leechMessage;\n+            if (card.getQueue() < 0) {\n+                leechMessage = res.getString(R.string.leech_suspend_notification);\n+            } else {\n+                leechMessage = res.getString(R.string.leech_notification);\n+            }\n+            activity.runOnUiThread(new Runnable() {\n+                @Override\n+                public void run() {\n+                    Toast.makeText(activity, leechMessage, Toast.LENGTH_SHORT).show();\n+                }\n+            });\n+\n+        } else {\n+            Timber.e(\"LeechHook :: could not show leech toast as activity was null\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkyMTI2Mw=="}, "originalCommit": {"oid": "4064d91efa0cf9136883d8e1c9ce53a4bea01046"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkzNDA4Ng==", "bodyText": "LOG or NF prefix:\nNF: Leech - Reduced Log Level", "url": "https://github.com/ankidroid/Anki-Android/pull/6271#discussion_r433934086", "createdAt": "2020-06-02T14:46:49Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/AbstractSched.java", "diffHunk": "@@ -234,4 +239,25 @@ public String toString() {\n     public interface CountMethod {\n         int operation(long did, int lim);\n     }\n+\n+    protected static void leech(Card card, Activity activity) {\n+        if (activity != null) {\n+            Resources res = activity.getResources();\n+            final String leechMessage;\n+            if (card.getQueue() < 0) {\n+                leechMessage = res.getString(R.string.leech_suspend_notification);\n+            } else {\n+                leechMessage = res.getString(R.string.leech_notification);\n+            }\n+            activity.runOnUiThread(new Runnable() {\n+                @Override\n+                public void run() {\n+                    Toast.makeText(activity, leechMessage, Toast.LENGTH_SHORT).show();\n+                }\n+            });\n+\n+        } else {\n+            Timber.e(\"LeechHook :: could not show leech toast as activity was null\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkyMTI2Mw=="}, "originalCommit": {"oid": "4064d91efa0cf9136883d8e1c9ce53a4bea01046"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMjk1MDgyOnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/AbstractSched.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNDozMzowNFrOGd0oYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNDo0MDo1NlrOGd09rA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkyNDE5NQ==", "bodyText": "Do you think this would make more sense as a static in the Leech class? You know the scope of Sched better than anyone here.", "url": "https://github.com/ankidroid/Anki-Android/pull/6271#discussion_r433924195", "createdAt": "2020-06-02T14:33:04Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/AbstractSched.java", "diffHunk": "@@ -234,4 +239,25 @@ public String toString() {\n     public interface CountMethod {\n         int operation(long did, int lim);\n     }\n+\n+    protected static void leech(Card card, Activity activity) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4064d91efa0cf9136883d8e1c9ce53a4bea01046"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkyOTY0NA==", "bodyText": "Dealing with leech is really an action only done while scheduling. I believe that this is the place where it makes the most sens.\nThe only reason I can see for a hook in leech, upstream, is that showing the tooltip is a front-end action and not a back-end one. So the code is in the reviewer and not in the scheduler.\nI could also put this in the Reviewer as a static method, and call it from Scheduler. I really don't see the point of a whole class just to show a toast", "url": "https://github.com/ankidroid/Anki-Android/pull/6271#discussion_r433929644", "createdAt": "2020-06-02T14:40:56Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/AbstractSched.java", "diffHunk": "@@ -234,4 +239,25 @@ public String toString() {\n     public interface CountMethod {\n         int operation(long did, int lim);\n     }\n+\n+    protected static void leech(Card card, Activity activity) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzkyNDE5NQ=="}, "originalCommit": {"oid": "4064d91efa0cf9136883d8e1c9ce53a4bea01046"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 300, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}