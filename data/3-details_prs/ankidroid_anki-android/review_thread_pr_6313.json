{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1NTYwMzUz", "number": 6313, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoxMTozNFrOEBNFIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoyNzo1NlrOEBNJIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5Njk4MzM5OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AnkiDroidApp.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoxMTozNFrOGc6_rA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoxMTozNFrOGc6_rA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk3OTg4NA==", "bodyText": "Nit: No need to call .toString(), let the logging framework do it for efficiency.", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432979884", "createdAt": "2020-05-31T20:11:34Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AnkiDroidApp.java", "diffHunk": "@@ -398,6 +398,7 @@ public static Context updateContextWithLanguage(@NonNull Context remoteContext)\n     private static Configuration getLanguageConfig(@NonNull Configuration remoteConfig, @NonNull SharedPreferences prefs) {\n         Configuration newConfig = new Configuration(remoteConfig);\n         Locale newLocale = LanguageUtil.getLocale(prefs.getString(Preferences.LANGUAGE, \"\"), prefs);\n+        Timber.d(\"AnkiDroidApp::getLanguageConfig - setting locale to %s\", newLocale.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5Njk4Mzc0OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/main/java/com/ichi2/utils/LanguageUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoxMjowN1rOGc6_2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoxMjowN1rOGc6_2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk3OTkyOQ==", "bodyText": "Best to log the input", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432979929", "createdAt": "2020-05-31T20:12:07Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/utils/LanguageUtil.java", "diffHunk": "@@ -81,10 +83,13 @@ public static Locale getLocale(@Nullable String localeCode, @NonNull SharedPrefe\n             // Fall back to (system) default only if that fails.\n             localeCode = Locale.getDefault().toString();\n         }\n-        if (localeCode.length() > 2) {\n+        // Language separators are '_' or '-' at different times in display/resource fetch\n+        if (localeCode != null && (localeCode.contains(\"_\") || localeCode.contains(\"-\"))) {\n             try {\n-                locale = new Locale(localeCode.substring(0, 2), localeCode.substring(3, 5));\n-            } catch (StringIndexOutOfBoundsException e) {\n+                String[] localeParts = localeCode.split(\"[_-]\", 2);\n+                locale = new Locale(localeParts[0], localeParts[1]);\n+            } catch (ArrayIndexOutOfBoundsException e) {\n+                Timber.w(e, \"LanguageUtil::getLocale regional variant split failed. Using code raw.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5Njk4NDY0OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoxMzo0MlrOGc7AVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDo0MToxMlrOGc7JIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDA1NA==", "bodyText": "Do we need/intend to handle ISO 639 here? zh-Hant-TW for example?\nhttps://android.googlesource.com/platform/external/icu4c.git/+/master/data/locales/ - not sure if this is relevant", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432980054", "createdAt": "2020-05-31T20:13:42Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "diffHunk": "@@ -71,4 +76,32 @@ public void testCurrentLanguagesHaveNotChanged() {\n         assertThat(\"Languages have been updated, please modify test variables: \" +\n                 \"PREVIOUS_LANGUAGES and CURRENT_LANGUAGES\", actual, contains(CURRENT_LANGUAGES));\n     }\n+\n+    @Test\n+    public void localeTwoLetterCodeResolves() {\n+        assertThat(\"A locale with a 2-letter code resolves correctly\",\n+                LanguageUtil.getLocale(\"af\").getDisplayLanguage().equals(\"Afrikaans\"));\n+    }\n+\n+    @Test\n+    public void localeThreeLetterCodeResolves() {\n+        assertThat(\"A locale with a 3-letter code resolves correctly\",\n+                LanguageUtil.getLocale(\"fil\").getDisplayLanguage().equals(\"Filipino\"));\n+    }\n+\n+    @Test\n+    public void localeTwoLetterRegionalVariantResolves() {\n+        assertThat(\"A locale with a 2-letter code and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"pt-BR\").getDisplayName().equals(\"Portuguese (Brazil)\"));\n+        assertThat(\"A locale with a 2-letter code and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"pt_BR\").getDisplayName().equals(\"Portuguese (Brazil)\"));\n+    }\n+\n+    @Test\n+    public void localeThreeLetterRegionalVariantResolves() {\n+        assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"yue_TW\").getDisplayName().equals(\"yue (Taiwan)\"));\n+        assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"yue-TW\").getDisplayName().equals(\"yue (Taiwan)\"));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MjMwNQ==", "bodyText": "I have no intention of going farther than supported functionality at this point which is two part codes only", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432982305", "createdAt": "2020-05-31T20:41:12Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "diffHunk": "@@ -71,4 +76,32 @@ public void testCurrentLanguagesHaveNotChanged() {\n         assertThat(\"Languages have been updated, please modify test variables: \" +\n                 \"PREVIOUS_LANGUAGES and CURRENT_LANGUAGES\", actual, contains(CURRENT_LANGUAGES));\n     }\n+\n+    @Test\n+    public void localeTwoLetterCodeResolves() {\n+        assertThat(\"A locale with a 2-letter code resolves correctly\",\n+                LanguageUtil.getLocale(\"af\").getDisplayLanguage().equals(\"Afrikaans\"));\n+    }\n+\n+    @Test\n+    public void localeThreeLetterCodeResolves() {\n+        assertThat(\"A locale with a 3-letter code resolves correctly\",\n+                LanguageUtil.getLocale(\"fil\").getDisplayLanguage().equals(\"Filipino\"));\n+    }\n+\n+    @Test\n+    public void localeTwoLetterRegionalVariantResolves() {\n+        assertThat(\"A locale with a 2-letter code and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"pt-BR\").getDisplayName().equals(\"Portuguese (Brazil)\"));\n+        assertThat(\"A locale with a 2-letter code and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"pt_BR\").getDisplayName().equals(\"Portuguese (Brazil)\"));\n+    }\n+\n+    @Test\n+    public void localeThreeLetterRegionalVariantResolves() {\n+        assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"yue_TW\").getDisplayName().equals(\"yue (Taiwan)\"));\n+        assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"yue-TW\").getDisplayName().equals(\"yue (Taiwan)\"));\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDA1NA=="}, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5Njk4NDc4OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoxNDowNlrOGc7AaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoxNDowNlrOGc7AaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDA3Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",\n          \n          \n            \n                    assertThat(\"A locale with a 3-letter code and regional variant resolves correctly\",", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432980073", "createdAt": "2020-05-31T20:14:06Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "diffHunk": "@@ -71,4 +76,32 @@ public void testCurrentLanguagesHaveNotChanged() {\n         assertThat(\"Languages have been updated, please modify test variables: \" +\n                 \"PREVIOUS_LANGUAGES and CURRENT_LANGUAGES\", actual, contains(CURRENT_LANGUAGES));\n     }\n+\n+    @Test\n+    public void localeTwoLetterCodeResolves() {\n+        assertThat(\"A locale with a 2-letter code resolves correctly\",\n+                LanguageUtil.getLocale(\"af\").getDisplayLanguage().equals(\"Afrikaans\"));\n+    }\n+\n+    @Test\n+    public void localeThreeLetterCodeResolves() {\n+        assertThat(\"A locale with a 3-letter code resolves correctly\",\n+                LanguageUtil.getLocale(\"fil\").getDisplayLanguage().equals(\"Filipino\"));\n+    }\n+\n+    @Test\n+    public void localeTwoLetterRegionalVariantResolves() {\n+        assertThat(\"A locale with a 2-letter code and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"pt-BR\").getDisplayName().equals(\"Portuguese (Brazil)\"));\n+        assertThat(\"A locale with a 2-letter code and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"pt_BR\").getDisplayName().equals(\"Portuguese (Brazil)\"));\n+    }\n+\n+    @Test\n+    public void localeThreeLetterRegionalVariantResolves() {\n+        assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"yue_TW\").getDisplayName().equals(\"yue (Taiwan)\"));\n+        assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5Njk4NDg2OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoxNDoxMlrOGc7AcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoxNDoxMlrOGc7AcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDA4MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",\n          \n          \n            \n                    assertThat(\"A locale with a 3-letter code and regional variant resolves correctly\",", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432980081", "createdAt": "2020-05-31T20:14:12Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "diffHunk": "@@ -71,4 +76,32 @@ public void testCurrentLanguagesHaveNotChanged() {\n         assertThat(\"Languages have been updated, please modify test variables: \" +\n                 \"PREVIOUS_LANGUAGES and CURRENT_LANGUAGES\", actual, contains(CURRENT_LANGUAGES));\n     }\n+\n+    @Test\n+    public void localeTwoLetterCodeResolves() {\n+        assertThat(\"A locale with a 2-letter code resolves correctly\",\n+                LanguageUtil.getLocale(\"af\").getDisplayLanguage().equals(\"Afrikaans\"));\n+    }\n+\n+    @Test\n+    public void localeThreeLetterCodeResolves() {\n+        assertThat(\"A locale with a 3-letter code resolves correctly\",\n+                LanguageUtil.getLocale(\"fil\").getDisplayLanguage().equals(\"Filipino\"));\n+    }\n+\n+    @Test\n+    public void localeTwoLetterRegionalVariantResolves() {\n+        assertThat(\"A locale with a 2-letter code and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"pt-BR\").getDisplayName().equals(\"Portuguese (Brazil)\"));\n+        assertThat(\"A locale with a 2-letter code and regional variant resolves correctly\",\n+                LanguageUtil.getLocale(\"pt_BR\").getDisplayName().equals(\"Portuguese (Brazil)\"));\n+    }\n+\n+    @Test\n+    public void localeThreeLetterRegionalVariantResolves() {\n+        assertThat(\"A locale with a 3-letter coe and regional variant resolves correctly\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5Njk4NTQ1OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoxNTowNFrOGc7AuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNTo1Njo0NFrOGdQYTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDE1Mw==", "bodyText": "Will these tests pass if the users locale is non-English? I think all of our non-instrumented test runs are still in English.", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432980153", "createdAt": "2020-05-31T20:15:04Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "diffHunk": "@@ -71,4 +76,32 @@ public void testCurrentLanguagesHaveNotChanged() {\n         assertThat(\"Languages have been updated, please modify test variables: \" +\n                 \"PREVIOUS_LANGUAGES and CURRENT_LANGUAGES\", actual, contains(CURRENT_LANGUAGES));\n     }\n+\n+    @Test\n+    public void localeTwoLetterCodeResolves() {\n+        assertThat(\"A locale with a 2-letter code resolves correctly\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MjI2MQ==", "bodyText": "Robolectric has locale-changing power but I've not used it, an extension to the tests to do so could be a separate PR if you want to investigate. I have used Robolectric API switching so I know it's effective, it's just an annotation IIRC", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432982261", "createdAt": "2020-05-31T20:40:33Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "diffHunk": "@@ -71,4 +76,32 @@ public void testCurrentLanguagesHaveNotChanged() {\n         assertThat(\"Languages have been updated, please modify test variables: \" +\n                 \"PREVIOUS_LANGUAGES and CURRENT_LANGUAGES\", actual, contains(CURRENT_LANGUAGES));\n     }\n+\n+    @Test\n+    public void localeTwoLetterCodeResolves() {\n+        assertThat(\"A locale with a 2-letter code resolves correctly\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDE1Mw=="}, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4NDkwNQ==", "bodyText": "My concern is ensuring that new contributors coming into the project won't have broken tests. In a normal circumstance, this should change, but we should ensure this doesn't happen for foreign developers.\ngetDisplayLanguage Comments\n/**\n     * Returns a name for the locale's language that is appropriate for display to the\n     * user.\n     * If possible, the name returned will be localized for the default\n     * {@link Locale.Category#DISPLAY DISPLAY} locale.\n     * For example, if the locale is fr_FR and the default\n     * {@link Locale.Category#DISPLAY DISPLAY} locale\n     * is en_US, getDisplayLanguage() will return \"French\"; if the locale is en_US and\n     * the default {@link Locale.Category#DISPLAY DISPLAY} locale is fr_FR,\n     * getDisplayLanguage() will return \"anglais\".\n     * If the name returned cannot be localized for the default\n     * {@link Locale.Category#DISPLAY DISPLAY} locale,\n     * (say, we don't have a Japanese name for Croatian),\n     * this function falls back on the English name, and uses the ISO code as a last-resort\n     * value.  If the locale doesn't specify a language, this function returns the empty string.\n     *\n     * @return The name of the display language.\n     */", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432984905", "createdAt": "2020-05-31T21:14:31Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "diffHunk": "@@ -71,4 +76,32 @@ public void testCurrentLanguagesHaveNotChanged() {\n         assertThat(\"Languages have been updated, please modify test variables: \" +\n                 \"PREVIOUS_LANGUAGES and CURRENT_LANGUAGES\", actual, contains(CURRENT_LANGUAGES));\n     }\n+\n+    @Test\n+    public void localeTwoLetterCodeResolves() {\n+        assertThat(\"A locale with a 2-letter code resolves correctly\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDE1Mw=="}, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5MTM4MA==", "bodyText": "I now have a strong dislike for the Hamcrest matchers. On failure between expected/actual they don't spit out the actual or expected so you can't visually inspect immediately. You have to instrument, waste of time. Switching to junit Assert. I'm adding resource loading configs on robolectric and SDK skew though, as this would have tripped new developers with non-'en' system langauge", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r433291380", "createdAt": "2020-06-01T15:08:01Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "diffHunk": "@@ -71,4 +76,32 @@ public void testCurrentLanguagesHaveNotChanged() {\n         assertThat(\"Languages have been updated, please modify test variables: \" +\n                 \"PREVIOUS_LANGUAGES and CURRENT_LANGUAGES\", actual, contains(CURRENT_LANGUAGES));\n     }\n+\n+    @Test\n+    public void localeTwoLetterCodeResolves() {\n+        assertThat(\"A locale with a 2-letter code resolves correctly\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDE1Mw=="}, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzMzMDI1Mw==", "bodyText": "Hamcrest definitely outputs the failures, that's the point of a fluent library.\nYou shouldn't be using assertThat(message, bool)\nYou should use assertThat(message, \"string\", is(\"string\"))\nSorry I missed this in the initial review.", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r433330253", "createdAt": "2020-06-01T15:56:44Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/test/java/com/ichi2/utils/LanguageUtilsTest.java", "diffHunk": "@@ -71,4 +76,32 @@ public void testCurrentLanguagesHaveNotChanged() {\n         assertThat(\"Languages have been updated, please modify test variables: \" +\n                 \"PREVIOUS_LANGUAGES and CURRENT_LANGUAGES\", actual, contains(CURRENT_LANGUAGES));\n     }\n+\n+    @Test\n+    public void localeTwoLetterCodeResolves() {\n+        assertThat(\"A locale with a 2-letter code resolves correctly\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDE1Mw=="}, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5Njk4OTkwOnYy", "diffSide": "RIGHT", "path": "tools/update-localizations.py", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoyMjozMFrOGc7C9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNTo1NzozNVrOGdQaZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDcyNw==", "bodyText": "Could you link some docs here. I assume this is correct, but I really can't know.", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432980727", "createdAt": "2020-05-31T20:22:30Z", "author": {"login": "david-allison-1"}, "path": "tools/update-localizations.py", "diffHunk": "@@ -178,12 +178,16 @@ def build():\n t.close()\n \n for language in languages:\n-    if language[:2] in localizedRegions:\n-        androidLanguage = string.replace(language, '-', '-r')\n+    # Regional files need a marker in Android\n+    if language.split('-', 1)[0] in localizedRegions:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MjM2Nw==", "bodyText": "I have no docs, just direct experience while testing, sorry. Definitely needs to split on underscore or the language switch isn't recognized for 2-part codes, definitely needs to split on the hyphen or the language list doesn't work for 2-part codes", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432982367", "createdAt": "2020-05-31T20:42:15Z", "author": {"login": "mikehardy"}, "path": "tools/update-localizations.py", "diffHunk": "@@ -178,12 +178,16 @@ def build():\n t.close()\n \n for language in languages:\n-    if language[:2] in localizedRegions:\n-        androidLanguage = string.replace(language, '-', '-r')\n+    # Regional files need a marker in Android\n+    if language.split('-', 1)[0] in localizedRegions:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDcyNw=="}, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4NTA0Mw==", "bodyText": "OK, could we mark with a TODO to get this a little better documented.", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432985043", "createdAt": "2020-05-31T21:16:03Z", "author": {"login": "david-allison-1"}, "path": "tools/update-localizations.py", "diffHunk": "@@ -178,12 +178,16 @@ def build():\n t.close()\n \n for language in languages:\n-    if language[:2] in localizedRegions:\n-        androidLanguage = string.replace(language, '-', '-r')\n+    # Regional files need a marker in Android\n+    if language.split('-', 1)[0] in localizedRegions:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDcyNw=="}, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzMyODM3OA==", "bodyText": "Added https://developer.android.com/guide/topics/resources/providing-resources#AlternativeResources", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r433328378", "createdAt": "2020-06-01T15:54:40Z", "author": {"login": "mikehardy"}, "path": "tools/update-localizations.py", "diffHunk": "@@ -178,12 +178,16 @@ def build():\n t.close()\n \n for language in languages:\n-    if language[:2] in localizedRegions:\n-        androidLanguage = string.replace(language, '-', '-r')\n+    # Regional files need a marker in Android\n+    if language.split('-', 1)[0] in localizedRegions:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDcyNw=="}, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzMzMDc5MQ==", "bodyText": "Just a TODO in the code will do", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r433330791", "createdAt": "2020-06-01T15:57:35Z", "author": {"login": "david-allison-1"}, "path": "tools/update-localizations.py", "diffHunk": "@@ -178,12 +178,16 @@ def build():\n t.close()\n \n for language in languages:\n-    if language[:2] in localizedRegions:\n-        androidLanguage = string.replace(language, '-', '-r')\n+    # Regional files need a marker in Android\n+    if language.split('-', 1)[0] in localizedRegions:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDcyNw=="}, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5Njk5MDU4OnYy", "diffSide": "RIGHT", "path": "tools/update-localizations.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoyMzozMVrOGc7DRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDo0MjoyNlrOGc7Jcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDgwNQ==", "bodyText": "This is python2?", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432980805", "createdAt": "2020-05-31T20:23:31Z", "author": {"login": "david-allison-1"}, "path": "tools/update-localizations.py", "diffHunk": "@@ -178,12 +178,16 @@ def build():\n t.close()\n \n for language in languages:\n-    if language[:2] in localizedRegions:\n-        androidLanguage = string.replace(language, '-', '-r')\n+    # Regional files need a marker in Android\n+    if language.split('-', 1)[0] in localizedRegions:\n+        androidLanguage = string.replace(language, '-', '-r') # zh-CW becomes zh-rCW\n     else:\n-        androidLanguage = language[:2] # Example: es-ES becomes es\n+        androidLanguage = language.split('-', 1)[0] # Example: es-ES becomes es\n \n-    print \"\\nCopying language files for: \" + androidLanguage\n+    if language == 'yu':\n+        androidLanguage = 'yue'\n+\n+    print \"\\nCopying language files from \" + language + \" to \" + androidLanguage", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MjM4Nw==", "bodyText": "It's all just python to me ;-)", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432982387", "createdAt": "2020-05-31T20:42:26Z", "author": {"login": "mikehardy"}, "path": "tools/update-localizations.py", "diffHunk": "@@ -178,12 +178,16 @@ def build():\n t.close()\n \n for language in languages:\n-    if language[:2] in localizedRegions:\n-        androidLanguage = string.replace(language, '-', '-r')\n+    # Regional files need a marker in Android\n+    if language.split('-', 1)[0] in localizedRegions:\n+        androidLanguage = string.replace(language, '-', '-r') # zh-CW becomes zh-rCW\n     else:\n-        androidLanguage = language[:2] # Example: es-ES becomes es\n+        androidLanguage = language.split('-', 1)[0] # Example: es-ES becomes es\n \n-    print \"\\nCopying language files for: \" + androidLanguage\n+    if language == 'yu':\n+        androidLanguage = 'yue'\n+\n+    print \"\\nCopying language files from \" + language + \" to \" + androidLanguage", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MDgwNQ=="}, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5Njk5MzYwOnYy", "diffSide": "RIGHT", "path": "tools/update-localizations.py", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQyMDoyNzo1NlrOGc7E2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNTo0ODoyMlrOGdP6iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MTIxMQ==", "bodyText": "This feels subject to change. Would it be possible to make a HashSet of the prefixes and see if there are unhandled collisions.\nSomething like af_NA and af_ZA Afrikaans (South Africa/Namibia) probably wouldn't be caught here, and it'd be useful to flag this new conflict to a maintainer.", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432981211", "createdAt": "2020-05-31T20:27:56Z", "author": {"login": "david-allison-1"}, "path": "tools/update-localizations.py", "diffHunk": "@@ -178,12 +178,16 @@ def build():\n t.close()\n \n for language in languages:\n-    if language[:2] in localizedRegions:\n-        androidLanguage = string.replace(language, '-', '-r')\n+    # Regional files need a marker in Android\n+    if language.split('-', 1)[0] in localizedRegions:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MjQ3NQ==", "bodyText": "good point on that one - the more guard rails we can put in there the better, but I'm out of time for polishing on the release and publish and locale scripts. There are problems still in there but in the last release cycle I already fixed about 10 and de-linted and they'll have to wait their turn again. I can leave a note though", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432982475", "createdAt": "2020-05-31T20:43:45Z", "author": {"login": "mikehardy"}, "path": "tools/update-localizations.py", "diffHunk": "@@ -178,12 +178,16 @@ def build():\n t.close()\n \n for language in languages:\n-    if language[:2] in localizedRegions:\n-        androidLanguage = string.replace(language, '-', '-r')\n+    # Regional files need a marker in Android\n+    if language.split('-', 1)[0] in localizedRegions:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MTIxMQ=="}, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4NDk4Ng==", "bodyText": "Happy with a TODO", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r432984986", "createdAt": "2020-05-31T21:15:16Z", "author": {"login": "david-allison-1"}, "path": "tools/update-localizations.py", "diffHunk": "@@ -178,12 +178,16 @@ def build():\n t.close()\n \n for language in languages:\n-    if language[:2] in localizedRegions:\n-        androidLanguage = string.replace(language, '-', '-r')\n+    # Regional files need a marker in Android\n+    if language.split('-', 1)[0] in localizedRegions:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MTIxMQ=="}, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzMyMjYzNQ==", "bodyText": "I expanded the docs for variant addition a great deal, very prescriptive for maintainers now in the \"add new regional variant\" case", "url": "https://github.com/ankidroid/Anki-Android/pull/6313#discussion_r433322635", "createdAt": "2020-06-01T15:48:22Z", "author": {"login": "mikehardy"}, "path": "tools/update-localizations.py", "diffHunk": "@@ -178,12 +178,16 @@ def build():\n t.close()\n \n for language in languages:\n-    if language[:2] in localizedRegions:\n-        androidLanguage = string.replace(language, '-', '-r')\n+    # Regional files need a marker in Android\n+    if language.split('-', 1)[0] in localizedRegions:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk4MTIxMQ=="}, "originalCommit": {"oid": "aeb0686f713cb0139d8975cf0519b51a49029b62"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 320, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}