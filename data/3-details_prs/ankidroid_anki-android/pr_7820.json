{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxNjEwODE1", "number": 7820, "title": "BugFix - Previewer: Display same card after edit", "bodyText": "Editing a note would call UPDATE_NOTE with parameter isReviewer:true.\nIf the card was not in the same deck as the 'currently active' deck, then\nthe next card was obtained from the scheduler\nThe UPDATE_NOTE callback gets this card and renders it, even though it's not being previewed, showing the wrong card\nFixes\nFixes #7801\nApproach\nNow, we pass a new boolean, which skips the scheduler when not reviewing\nThis means we still update the content, but without getting another CardId\nHow Has This Been Tested?\nAndroid 9 device, and unit tests\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code\n UI changes: include screenshots of all affected screens (in particular showing any new or changed strings)", "createdAt": "2020-12-03T08:47:49Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7820", "merged": true, "mergeCommit": {"oid": "cce056d89cb1cc4176faf3a4b4be5f9bd8c31283"}, "closed": true, "closedAt": "2020-12-08T14:27:52Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdid2msgH2gAyNTMxNjEwODE1OjA4OTEwY2NlNDkzYTE0M2E5NmUzOGVmOTE0NzNmNGVjNmU2NGEwNjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdilh0MgFqTU0NDEyODU3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "08910cce493a143a96e38ef91473f4ec6e64a064", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/08910cce493a143a96e38ef91473f4ec6e64a064", "committedDate": "2020-12-03T07:17:33Z", "message": "NF: Extract method: getPreviewIntent\n\nUseful for testing to keep a consistent method to create the intent\n\nFor testing 7801"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzODYyNjc1", "url": "https://github.com/ankidroid/Anki-Android/pull/7820#pullrequestreview-543862675", "createdAt": "2020-12-03T11:32:45Z", "commit": {"oid": "0da228540989180497cc6e8e9bbcaa027773ab00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMTozMjo0NlrOH-WNDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMTozMjo0NlrOH-WNDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTEzNzU1MA==", "bodyText": "@Nullable maybe?", "url": "https://github.com/ankidroid/Anki-Android/pull/7820#discussion_r535137550", "createdAt": "2020-12-03T11:32:46Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1013,6 +1013,15 @@ public boolean onKeyDown(int keyCode, KeyEvent event) {\n     }\n \n \n+    @Override\n+    protected Long getCurrentCardId() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0da228540989180497cc6e8e9bbcaa027773ab00"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzODYzNzYw", "url": "https://github.com/ankidroid/Anki-Android/pull/7820#pullrequestreview-543863760", "createdAt": "2020-12-03T11:34:18Z", "commit": {"oid": "d5dcb0b53703ddf8eb95e8a82201c21c7da87049"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMTozNDoxOFrOH-WTDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMTozNDoxOFrOH-WTDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTEzOTA4NA==", "bodyText": "perhaps a quick note on the intent of this, what it controls, for future explorers?", "url": "https://github.com/ankidroid/Anki-Android/pull/7820#discussion_r535139084", "createdAt": "2020-12-03T11:34:18Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1150,6 +1150,11 @@ protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n     }\n \n \n+    protected boolean canAccessScheduler() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5dcb0b53703ddf8eb95e8a82201c21c7da87049"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzODY0ODM3", "url": "https://github.com/ankidroid/Anki-Android/pull/7820#pullrequestreview-543864837", "createdAt": "2020-12-03T11:35:45Z", "commit": {"oid": "d5dcb0b53703ddf8eb95e8a82201c21c7da87049"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a7f0f215fd060cac70493a50491793f6017d1df", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2a7f0f215fd060cac70493a50491793f6017d1df", "committedDate": "2020-12-03T15:58:10Z", "message": "CardViewer: Implement getCurrentCardId\n\nMethod in the base class - useful for testing\n\nRelated for testing 7801"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82c47dce4b6206f0dcd5a19bc43f1f50c212f9e8", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/82c47dce4b6206f0dcd5a19bc43f1f50c212f9e8", "committedDate": "2020-12-03T15:58:12Z", "message": "LOG: UPDATE_NOTE - Log if card changes\n\nThis was an unexpected behaviour as the reviewer flag was accidentally set\nin a non-reviewer class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e36f6d1f0b058fd699cc0804eae63bbc18d34ca3", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e36f6d1f0b058fd699cc0804eae63bbc18d34ca3", "committedDate": "2020-12-03T16:11:50Z", "message": "BugFix - Previewer: Display same card after edit\n\nEditing a note would call UPDATE_NOTE with parameter `isReviewer:true`.\n\nIf the card was not in the same deck as the 'currently active' deck, then\nthe next card was obtained from the scheduler\n\nThe UPDATE_NOTE callback gets this card and renders it, even though it's\nnot being previewed, showing the wrong card\n\nFix: Now, we pass a new boolean, which skips the scheduler when not reviewing\n\nThis means we still update the content, but without getting another CardId\n\nFixes 7801"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d5dcb0b53703ddf8eb95e8a82201c21c7da87049", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d5dcb0b53703ddf8eb95e8a82201c21c7da87049", "committedDate": "2020-12-03T08:38:20Z", "message": "BugFix - Previewer: Display same card after edit\n\nEditing a note would call UPDATE_NOTE with parameter `isReviewer:true`.\n\nIf the card was not in the same deck as the 'currently active' deck, then\nthe next card was obtained from the scheduler\n\nThe UPDATE_NOTE callback gets this card and renders it, even though it's\nnot being previewed, showing the wrong card\n\nFix: Now, we pass a new boolean, which skips the scheduler when not reviewing\n\nThis means we still update the content, but without getting another CardId\n\nFixes 7801"}, "afterCommit": {"oid": "e36f6d1f0b058fd699cc0804eae63bbc18d34ca3", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e36f6d1f0b058fd699cc0804eae63bbc18d34ca3", "committedDate": "2020-12-03T16:11:50Z", "message": "BugFix - Previewer: Display same card after edit\n\nEditing a note would call UPDATE_NOTE with parameter `isReviewer:true`.\n\nIf the card was not in the same deck as the 'currently active' deck, then\nthe next card was obtained from the scheduler\n\nThe UPDATE_NOTE callback gets this card and renders it, even though it's\nnot being previewed, showing the wrong card\n\nFix: Now, we pass a new boolean, which skips the scheduler when not reviewing\n\nThis means we still update the content, but without getting another CardId\n\nFixes 7801"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MTI4NTc0", "url": "https://github.com/ankidroid/Anki-Android/pull/7820#pullrequestreview-544128574", "createdAt": "2020-12-03T16:14:05Z", "commit": {"oid": "e36f6d1f0b058fd699cc0804eae63bbc18d34ca3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3779, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}