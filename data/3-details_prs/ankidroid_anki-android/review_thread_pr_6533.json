{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NjMxNTkw", "number": 6533, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwMjo0OTozMlrOEHabAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwMjo0OTozMlrOEHabAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MjA4Mzg2OnYy", "diffSide": "RIGHT", "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/ContentProviderTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwMjo0OTozMlrOGmwgbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQwOTowMzoxOFrOGm4BCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5MzgwNA==", "bodyText": "Why is this necessary? Shouldn't id() call _ensureParents? Is this because decks are created, but not added to the list?", "url": "https://github.com/ankidroid/Anki-Android/pull/6533#discussion_r443293804", "createdAt": "2020-06-22T02:49:32Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/ContentProviderTest.java", "diffHunk": "@@ -118,9 +125,21 @@ public void setUp() throws Exception {\n         // create test decks and add one note for every deck\n         mNumDecksBeforeTest = col.getDecks().count();\n         for(int i = 0; i < TEST_DECKS.length; i++) {\n-            long did = col.getDecks().id(TEST_DECKS[i]);\n-            mTestDeckIds[i] = did;\n-            mCreatedNotes.add(setupNewNote(col, mModelId, did, mDummyFields, TEST_TAG));\n+            String fullName = TEST_DECKS[i];\n+            String[] path = col.getDecks().path(fullName);\n+            String partialName = \"\";\n+            // Dealing with each parents of fullName\n+            for (int j = 0; j < path.length; j++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67c597d8c942fd488b2b226459dff62cee4154c8"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3MzkzOQ==", "bodyText": "id ensure parents, indeed. But if you want mTestDeckIds to contains all ids, then you need to put ids of parents too, even if they are not explicitly in the list of parents.\nFurthermore, during tear-down, you want to remove all added deck; and you have no method \"_ensureRemoveParent\". So you need to actually list all decks you create.\nIn this case, it may work to avoid adding parent decks, because the top level parent of \"cmxieunwoogyxsctnjmv::abcdefgh::ZYXW\" is a deck we also added manually explicitly, and I changed another part of the code to ensure that we remove subdecks of added deck.\nBut if at some point we want to add \"\"iersantenfgh\u00e9e::abcdefgh::ZYXW\" instead, without this loop, we would never remove \"iersantenfgh\u00e9e\". I wanted to ensure that we were not constrained in adding more deck examples.\nFurthermore, I don't want to just remove top level parents of each added deck. Because if I add a deck \"A::B::C\" (that was my first idea actually) but the user already have a deck \"A\" on the smartphone they use for testing, then we would delete \"A\"... this conditional  ensure that in this case \"A\" is deleted iff it was added by us. (I actually used to have a top level deck called A, so I\u00a0was going to accidentally delete my own cards here....)", "url": "https://github.com/ankidroid/Anki-Android/pull/6533#discussion_r443373939", "createdAt": "2020-06-22T07:46:17Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/ContentProviderTest.java", "diffHunk": "@@ -118,9 +125,21 @@ public void setUp() throws Exception {\n         // create test decks and add one note for every deck\n         mNumDecksBeforeTest = col.getDecks().count();\n         for(int i = 0; i < TEST_DECKS.length; i++) {\n-            long did = col.getDecks().id(TEST_DECKS[i]);\n-            mTestDeckIds[i] = did;\n-            mCreatedNotes.add(setupNewNote(col, mModelId, did, mDummyFields, TEST_TAG));\n+            String fullName = TEST_DECKS[i];\n+            String[] path = col.getDecks().path(fullName);\n+            String partialName = \"\";\n+            // Dealing with each parents of fullName\n+            for (int j = 0; j < path.length; j++) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5MzgwNA=="}, "originalCommit": {"oid": "67c597d8c942fd488b2b226459dff62cee4154c8"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQxNjg0MA==", "bodyText": "That makes sense. Could you add a quick comment", "url": "https://github.com/ankidroid/Anki-Android/pull/6533#discussion_r443416840", "createdAt": "2020-06-22T09:03:18Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/androidTest/java/com/ichi2/anki/tests/ContentProviderTest.java", "diffHunk": "@@ -118,9 +125,21 @@ public void setUp() throws Exception {\n         // create test decks and add one note for every deck\n         mNumDecksBeforeTest = col.getDecks().count();\n         for(int i = 0; i < TEST_DECKS.length; i++) {\n-            long did = col.getDecks().id(TEST_DECKS[i]);\n-            mTestDeckIds[i] = did;\n-            mCreatedNotes.add(setupNewNote(col, mModelId, did, mDummyFields, TEST_TAG));\n+            String fullName = TEST_DECKS[i];\n+            String[] path = col.getDecks().path(fullName);\n+            String partialName = \"\";\n+            // Dealing with each parents of fullName\n+            for (int j = 0; j < path.length; j++) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5MzgwNA=="}, "originalCommit": {"oid": "67c597d8c942fd488b2b226459dff62cee4154c8"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 13, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}