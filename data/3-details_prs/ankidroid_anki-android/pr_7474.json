{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5NDUzNTM0", "number": 7474, "title": "Remove useless conversions", "bodyText": "There are quite a few conversion that are useless. long to long[] to array joined by comma. List<long> to long[] to array joined by comma... In all of those cases, the end result is always longs joined by comma. I removed useless conversions to save time", "createdAt": "2020-10-24T16:04:34Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7474", "merged": true, "mergeCommit": {"oid": "64c3e75eb02cefa057ec2ad5cd242f9bd362910b"}, "closed": true, "closedAt": "2020-10-26T16:05:33Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVtm8zgFqTUxNjI4ODk4OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVx488ABqjM5MTcyMTM4MjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mjg4OTg4", "url": "https://github.com/ankidroid/Anki-Android/pull/7474#pullrequestreview-516288988", "createdAt": "2020-10-24T16:17:55Z", "commit": {"oid": "2eaeaaefea2103ffc542b64e24823f76a6f451e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxNjoxNzo1NVrOHnyxmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxNjoxNzo1NVrOHnyxmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ4ODQxMQ==", "bodyText": "is this correct? the SQL is asking for an id and you're feeding it a Long array, seems like it should just be the nid here?\nAny time I see SQL changing my first thought is: is this exercised by a test anywhere? I'd check the results of coverage output to see if this is indeed exercised to make sure the result is semantically the same. If it doesn't already have coverage I am nervous changing it without adding coverage first", "url": "https://github.com/ankidroid/Anki-Android/pull/7474#discussion_r511488411", "createdAt": "2020-10-24T16:17:55Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Models.java", "diffHunk": "@@ -921,7 +918,7 @@ private void _changeCards(long[] nids, Model oldModel, Model newModel, Map<Integ\n         int nflds = newModel.getJSONArray(\"tmpls\").length();\n         try {\n             cur = mCol.getDb().getDatabase().query(\n-                    \"select id, ord from cards where nid in \" + Utils.ids2str(nids), null);\n+                    \"select id, ord from cards where nid = ?\", new Long[]{nid});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eaeaaefea2103ffc542b64e24823f76a6f451e3"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mjg5MDAz", "url": "https://github.com/ankidroid/Anki-Android/pull/7474#pullrequestreview-516289003", "createdAt": "2020-10-24T16:18:08Z", "commit": {"oid": "2eaeaaefea2103ffc542b64e24823f76a6f451e3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxNjoxODowOFrOHnyxsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxNjoxODowOFrOHnyxsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ4ODQzMw==", "bodyText": "I suppose this should be \"_changeNote\" now?", "url": "https://github.com/ankidroid/Anki-Android/pull/7474#discussion_r511488433", "createdAt": "2020-10-24T16:18:08Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Models.java", "diffHunk": "@@ -871,48 +871,45 @@ private void _syncTemplates(Model m) {\n      */\n     public void change(Model m, long nid, Model newModel, Map<Integer, Integer> fmap, Map<Integer, Integer> cmap) throws ConfirmModSchemaException {\n         mCol.modSchema();\n-        long[] nids = new long[] {nid};\n         assert (newModel.getLong(\"id\") == m.getLong(\"id\")) || (fmap != null && cmap != null);\n         if (fmap != null) {\n-            _changeNotes(nids, newModel, fmap);\n+            _changeNotes(nid, newModel, fmap);\n         }\n         if (cmap != null) {\n-            _changeCards(nids, m, newModel, cmap);\n+            _changeCards(nid, m, newModel, cmap);\n         }\n+        long[] nids = new long[] {nid};\n         mCol.genCards(nids);\n     }\n \n-    private void _changeNotes(long[] nids, Model newModel, Map<Integer, Integer> map) {\n+    private void _changeNotes(long nid, Model newModel, Map<Integer, Integer> map) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eaeaaefea2103ffc542b64e24823f76a6f451e3"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Mjg5MTQ2", "url": "https://github.com/ankidroid/Anki-Android/pull/7474#pullrequestreview-516289146", "createdAt": "2020-10-24T16:20:02Z", "commit": {"oid": "b9bb304480d6a62633421892c5b7d16b12e96529"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxNjoyMDowM1rOHnyyeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNFQxNjoyMToyMlrOHnyy6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ4ODYzMw==", "bodyText": "Does this work? Shouldn't it just be nid?", "url": "https://github.com/ankidroid/Anki-Android/pull/7474#discussion_r511488633", "createdAt": "2020-10-24T16:20:03Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Models.java", "diffHunk": "@@ -920,7 +917,7 @@ private void _changeCards(long[] nids, Model oldModel, Model newModel, Map<Integ\n         int nflds = newModel.getJSONArray(\"tmpls\").length();\n         try {\n             cur = mCol.getDb().getDatabase().query(\n-                    \"select id, ord from cards where nid in \" + Utils.ids2str(nids), null);\n+                    \"select id, ord from cards where nid = ?\", new Long[]{nid});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9bb304480d6a62633421892c5b7d16b12e96529"}, "originalPosition": 111}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ4ODc0NA==", "bodyText": "Not any more", "url": "https://github.com/ankidroid/Anki-Android/pull/7474#discussion_r511488744", "createdAt": "2020-10-24T16:21:22Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -720,26 +720,39 @@ public void _remNotes(java.util.Collection<Long> ids) {\n     /**\n      * Generate cards for non-empty templates, return ids to remove.\n      */\n-\tpublic ArrayList<Long> genCards(List<Long> nids) {\n-\t    return genCards(Utils.collection2Array(nids));\n+\tpublic ArrayList<Long> genCards(java.util.Collection<Long> nids) {\n+        String snids = Utils.ids2str(nids);\n+\t    return genCards(snids);\n \t}\n \n     public <T extends ProgressSender<TaskData> & CancelListener> ArrayList<Long> genCards(List<Long> nids, @Nullable T task) {\n-       return genCards(Utils.collection2Array(nids), task);\n+        String snids = Utils.ids2str(nids);\n+        return genCards(snids, task);\n     }\n \n-    public ArrayList<Long> genCards(long[] nids) {\n-       return genCards(nids, null);\n+    public ArrayList<Long> genCards(long nid) {\n+       return genCards(nid, null);\n     }\n \n     /**\n-     * @param nids All ids of nodes of a note type\n+     * @param nid All ids of nodes of a note type", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9bb304480d6a62633421892c5b7d16b12e96529"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b9bb304480d6a62633421892c5b7d16b12e96529", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/b9bb304480d6a62633421892c5b7d16b12e96529", "committedDate": "2020-10-24T16:02:32Z", "message": "NF: Avoid useless conversion when possible"}, "afterCommit": {"oid": "585670e6c5237057f29bd514f58127a49c05aec3", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/585670e6c5237057f29bd514f58127a49c05aec3", "committedDate": "2020-10-24T16:52:14Z", "message": "NF: Avoid useless conversion when possible"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "585670e6c5237057f29bd514f58127a49c05aec3", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/585670e6c5237057f29bd514f58127a49c05aec3", "committedDate": "2020-10-24T16:52:14Z", "message": "NF: Avoid useless conversion when possible"}, "afterCommit": {"oid": "39b97947e30a32f7d5d23d148fa65967ab7a4d78", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/39b97947e30a32f7d5d23d148fa65967ab7a4d78", "committedDate": "2020-10-24T16:55:15Z", "message": "NF: Avoid useless conversion when possible"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MjkxOTE0", "url": "https://github.com/ankidroid/Anki-Android/pull/7474#pullrequestreview-516291914", "createdAt": "2020-10-24T17:02:07Z", "commit": {"oid": "39b97947e30a32f7d5d23d148fa65967ab7a4d78"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39b97947e30a32f7d5d23d148fa65967ab7a4d78", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/39b97947e30a32f7d5d23d148fa65967ab7a4d78", "committedDate": "2020-10-24T16:55:15Z", "message": "NF: Avoid useless conversion when possible"}, "afterCommit": {"oid": "494cf790499374b1f74e21af7801d5c27bf3b12d", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/494cf790499374b1f74e21af7801d5c27bf3b12d", "committedDate": "2020-10-24T17:05:51Z", "message": "NF: Avoid useless conversion when possible"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MjkyNDU1", "url": "https://github.com/ankidroid/Anki-Android/pull/7474#pullrequestreview-516292455", "createdAt": "2020-10-24T17:09:32Z", "commit": {"oid": "494cf790499374b1f74e21af7801d5c27bf3b12d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "494cf790499374b1f74e21af7801d5c27bf3b12d", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/494cf790499374b1f74e21af7801d5c27bf3b12d", "committedDate": "2020-10-24T17:05:51Z", "message": "NF: Avoid useless conversion when possible"}, "afterCommit": {"oid": "4f03037f6a762a4545425f02efca346d0674c9d9", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4f03037f6a762a4545425f02efca346d0674c9d9", "committedDate": "2020-10-24T17:34:27Z", "message": "NF: Avoid useless conversion when possible"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f03037f6a762a4545425f02efca346d0674c9d9", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4f03037f6a762a4545425f02efca346d0674c9d9", "committedDate": "2020-10-24T17:34:27Z", "message": "NF: Avoid useless conversion when possible"}, "afterCommit": {"oid": "c236f523518b8d2a2d4d7934231b3e7532c014c0", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c236f523518b8d2a2d4d7934231b3e7532c014c0", "committedDate": "2020-10-24T18:38:35Z", "message": "NF: Avoid useless conversion when possible"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c236f523518b8d2a2d4d7934231b3e7532c014c0", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c236f523518b8d2a2d4d7934231b3e7532c014c0", "committedDate": "2020-10-24T18:38:35Z", "message": "NF: Avoid useless conversion when possible"}, "afterCommit": {"oid": "edd090f1c9bffb33f6a7c8c78e3f1882ea2dce93", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/edd090f1c9bffb33f6a7c8c78e3f1882ea2dce93", "committedDate": "2020-10-24T18:41:29Z", "message": "NF: Avoid useless conversion when possible"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "edd090f1c9bffb33f6a7c8c78e3f1882ea2dce93", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/edd090f1c9bffb33f6a7c8c78e3f1882ea2dce93", "committedDate": "2020-10-24T18:41:29Z", "message": "NF: Avoid useless conversion when possible"}, "afterCommit": {"oid": "f991ec32dcd79bd8e38e3f9a39bf6840d7c6f252", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f991ec32dcd79bd8e38e3f9a39bf6840d7c6f252", "committedDate": "2020-10-24T18:54:01Z", "message": "NF: Avoid useless conversion when possible"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f991ec32dcd79bd8e38e3f9a39bf6840d7c6f252", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f991ec32dcd79bd8e38e3f9a39bf6840d7c6f252", "committedDate": "2020-10-24T18:54:01Z", "message": "NF: Avoid useless conversion when possible"}, "afterCommit": {"oid": "445b9ef554b803f9771cc72acf205df76752b876", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/445b9ef554b803f9771cc72acf205df76752b876", "committedDate": "2020-10-24T18:56:51Z", "message": "NF: Avoid useless conversion when possible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db63db24acbec3e4dfc591773c9fea7fee3ad174", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/db63db24acbec3e4dfc591773c9fea7fee3ad174", "committedDate": "2020-10-24T21:13:45Z", "message": "correct error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4847e1e5b4f0871555fffe3f0dd446076d88e7e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/b4847e1e5b4f0871555fffe3f0dd446076d88e7e", "committedDate": "2020-10-24T21:14:00Z", "message": "NF: remove array with a single element"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a8c3d5b87b9bf22609d2b5f3c09113dfa8b218d", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6a8c3d5b87b9bf22609d2b5f3c09113dfa8b218d", "committedDate": "2020-10-24T21:14:00Z", "message": "NF: _changeCard takes a single nid"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32f4d238697679abd441ee0df63de6f8905287ae", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/32f4d238697679abd441ee0df63de6f8905287ae", "committedDate": "2020-10-24T21:14:00Z", "message": "NF: _changeNotes takes a single nid"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96f7f773e26467682b3abdc85b60b0f6f0c31c22", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/96f7f773e26467682b3abdc85b60b0f6f0c31c22", "committedDate": "2020-10-24T21:14:00Z", "message": "NF: remove a loop executed exactly once"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff337da7e377816baf54ed4d2f113e94edd10807", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ff337da7e377816baf54ed4d2f113e94edd10807", "committedDate": "2020-10-24T21:14:00Z", "message": "NF: genCards takes joined fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cca8c0fd1219ef091e75a469ba0d60b0937c0a9", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6cca8c0fd1219ef091e75a469ba0d60b0937c0a9", "committedDate": "2020-10-24T21:14:19Z", "message": "NF: split updateFieldCache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9586ffdfd7bf4af73ea4db2c7700ba61b4d98e9", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e9586ffdfd7bf4af73ea4db2c7700ba61b4d98e9", "committedDate": "2020-10-24T21:14:20Z", "message": "NF: genCard accept singleton"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c043b44183541fa44a3811372b6b61d77e5485b", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9c043b44183541fa44a3811372b6b61d77e5485b", "committedDate": "2020-10-24T21:14:39Z", "message": "NF: genCard avoid an array"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "815ae9f5dd65ec93c4031c009719ac49416fb302", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/815ae9f5dd65ec93c4031c009719ac49416fb302", "committedDate": "2020-10-24T21:14:40Z", "message": "NF: registerNotes takes Collection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f82381dbd2f6d94993f980d74dd8d22720f2b269", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f82381dbd2f6d94993f980d74dd8d22720f2b269", "committedDate": "2020-10-24T21:14:40Z", "message": "NF: array to scalar when array is never used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9899a221ed997e15fb7c996eaec339f744f2e739", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9899a221ed997e15fb7c996eaec339f744f2e739", "committedDate": "2020-10-24T21:15:49Z", "message": "NF: _syncTemplates avoid"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "445b9ef554b803f9771cc72acf205df76752b876", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/445b9ef554b803f9771cc72acf205df76752b876", "committedDate": "2020-10-24T18:56:51Z", "message": "NF: Avoid useless conversion when possible"}, "afterCommit": {"oid": "9899a221ed997e15fb7c996eaec339f744f2e739", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9899a221ed997e15fb7c996eaec339f744f2e739", "committedDate": "2020-10-24T21:15:49Z", "message": "NF: _syncTemplates avoid"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3878, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}