{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NDU4NDA4", "number": 6635, "title": "Split reset", "bodyText": "This is a first part of #6035\nIt splits reset in two: counts and queues. In cases where it is obvious, the counts only is used.\nThis is mostly going to be useful in future PR, where we get the first card without doing the costly operation of computing counts", "createdAt": "2020-07-05T20:45:50Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6635", "merged": true, "mergeCommit": {"oid": "3ae67895c4667b6c83acef6b3b27945553354963"}, "closed": true, "closedAt": "2020-08-07T17:25:14Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyFRtjABqjM1MTM3Njc3NjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8mu6HAFqTQ2MzQzMzEyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4e95db2788b840b269ca432f1bb08e13ac5b4c8e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4e95db2788b840b269ca432f1bb08e13ac5b4c8e", "committedDate": "2020-07-05T20:43:07Z", "message": "NF: replace reset by resetCounts\n\nCounts being the only required value here"}, "afterCommit": {"oid": "69cb920908d4f6eff278d4a85c839239f65ef9c6", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/69cb920908d4f6eff278d4a85c839239f65ef9c6", "committedDate": "2020-07-05T23:31:04Z", "message": "NF: replace reset by resetCounts\n\nCounts being the only required value here"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "69cb920908d4f6eff278d4a85c839239f65ef9c6", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/69cb920908d4f6eff278d4a85c839239f65ef9c6", "committedDate": "2020-07-05T23:31:04Z", "message": "NF: replace reset by resetCounts\n\nCounts being the only required value here"}, "afterCommit": {"oid": "eb6db1c092ffaaaaa9fcccbf6f36ad52b657c942", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/eb6db1c092ffaaaaa9fcccbf6f36ad52b657c942", "committedDate": "2020-07-05T23:34:45Z", "message": "NF: replace reset by resetCounts\n\nCounts being the only required value here"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MzU5MjAz", "url": "https://github.com/ankidroid/Anki-Android/pull/6635#pullrequestreview-444359203", "createdAt": "2020-07-08T01:50:09Z", "commit": {"oid": "eb6db1c092ffaaaaa9fcccbf6f36ad52b657c942"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMTo1MDowOVrOGuVSZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMTo1MDowOVrOGuVSZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIzNjQ1NA==", "bodyText": "Question: do we need a updateCutoff here, as the counts methods use mToday", "url": "https://github.com/ankidroid/Anki-Android/pull/6635#discussion_r451236454", "createdAt": "2020-07-08T01:50:09Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java", "diffHunk": "@@ -199,17 +205,31 @@ public void deferReset(){\n \n     public void reset() {\n         _updateCutoff();\n-        _resetLrn();\n-        _resetRev();\n-        _resetNew();\n-        mHaveQueues = true;\n+        resetCounts();\n+        resetQueues();\n+    }\n+\n+    @Override\n+    public void resetCounts() {\n+        _resetLrnCount();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb6db1c092ffaaaaa9fcccbf6f36ad52b657c942"}, "originalPosition": 51}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eb6db1c092ffaaaaa9fcccbf6f36ad52b657c942", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/eb6db1c092ffaaaaa9fcccbf6f36ad52b657c942", "committedDate": "2020-07-05T23:34:45Z", "message": "NF: replace reset by resetCounts\n\nCounts being the only required value here"}, "afterCommit": {"oid": "e966805b0445f5fe9215999534b4bfad25aa6c17", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e966805b0445f5fe9215999534b4bfad25aa6c17", "committedDate": "2020-07-08T02:23:16Z", "message": "NF: replace reset by resetCounts\n\nCounts being the only required value here"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MzcwNjQx", "url": "https://github.com/ankidroid/Anki-Android/pull/6635#pullrequestreview-444370641", "createdAt": "2020-07-08T02:28:54Z", "commit": {"oid": "e966805b0445f5fe9215999534b4bfad25aa6c17"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e744bd2c733ab8f35fc426843a95a22ebbbb5d7", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9e744bd2c733ab8f35fc426843a95a22ebbbb5d7", "committedDate": "2020-08-07T15:41:21Z", "message": "NF: split resets in queue and counts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28f703f6cbef4c60011bcd5b0021fa7b96e833ea", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/28f703f6cbef4c60011bcd5b0021fa7b96e833ea", "committedDate": "2020-08-07T15:41:21Z", "message": "NF. move _updateLrnCutoff(true) to _resetLrnCount"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d40e7b1b940a0d0ad1d22dfa6194235e632c89e5", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d40e7b1b940a0d0ad1d22dfa6194235e632c89e5", "committedDate": "2020-08-07T15:41:21Z", "message": "NF: remove duplicate method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ba96fb4f3dec5321d9b39c8fd7a7a11f90269da", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9ba96fb4f3dec5321d9b39c8fd7a7a11f90269da", "committedDate": "2020-08-07T15:41:21Z", "message": "NF: add mHaveCounts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03762ba1e6fb8ea0fb3430f8d5e9203174620592", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/03762ba1e6fb8ea0fb3430f8d5e9203174620592", "committedDate": "2020-08-07T15:41:21Z", "message": "NF: replace resetFoo by their definition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "927416b9e77d9886954c708507693884762339b3", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/927416b9e77d9886954c708507693884762339b3", "committedDate": "2020-08-07T15:41:21Z", "message": "NF: reorder reset\n\nCounts never depends on queue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "700ee3364ce3991a61891d035fdeedee838ae418", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/700ee3364ce3991a61891d035fdeedee838ae418", "committedDate": "2020-08-07T15:41:32Z", "message": "NF: split reset in counts and queue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e9a2529b69f43a406801820e15514cfcbc9c3ee", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5e9a2529b69f43a406801820e15514cfcbc9c3ee", "committedDate": "2020-08-07T15:41:33Z", "message": "NF: getCard reset only the required part\n\n_checkDay already deal with day, so no immediate need fo _updateCutoff."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5615e90626758904e60f9ced760dcb042fc4e6b", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a5615e90626758904e60f9ced760dcb042fc4e6b", "committedDate": "2020-08-07T15:41:33Z", "message": "NF: replace reset by resetCounts\n\nCounts being the only required value here"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e966805b0445f5fe9215999534b4bfad25aa6c17", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e966805b0445f5fe9215999534b4bfad25aa6c17", "committedDate": "2020-07-08T02:23:16Z", "message": "NF: replace reset by resetCounts\n\nCounts being the only required value here"}, "afterCommit": {"oid": "a5615e90626758904e60f9ced760dcb042fc4e6b", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a5615e90626758904e60f9ced760dcb042fc4e6b", "committedDate": "2020-08-07T15:41:33Z", "message": "NF: replace reset by resetCounts\n\nCounts being the only required value here"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNDMzMTIy", "url": "https://github.com/ankidroid/Anki-Android/pull/6635#pullrequestreview-463433122", "createdAt": "2020-08-07T16:09:10Z", "commit": {"oid": "a5615e90626758904e60f9ced760dcb042fc4e6b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3088, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}