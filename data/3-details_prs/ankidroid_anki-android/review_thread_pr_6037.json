{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MTE4NjUz", "number": 6037, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNToxNzoxOVrODy8Q4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNToxNzoxOVrODy8Q4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0NzQyNzUzOnYy", "diffSide": "LEFT", "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNToxNzoxOVrOGHSN6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOFQxNzowMTo1NVrOGHsi7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI5MTY4OA==", "bodyText": "I'm not sure about this one. It seems like a semantic difference unless I'm reading it wrong?\nIt used to be:\nCASE1 - if (cid != 0 && cid != -1) -> a review was undone\nCASE2 - else if (cid != -1) -> reset and get new card\nThat combination means \"reset and get new card\" will happen for all cid where cid is anything but 0 or -1\nNow it is\nCASE1 if (cid == 0) -> reset and get new card\nCASE2 if (cid != 1) -> a review was undone\nNow it is only doing a reset and get new card if cid == 0. That's a much smaller set of cid's that will reset and get new card. Is that valid?\nAm I missing something?", "url": "https://github.com/ankidroid/Anki-Android/pull/6037#discussion_r410291688", "createdAt": "2020-04-17T15:17:19Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -865,16 +865,16 @@ private TaskData doInBackgroundUndo(TaskData... params) {\n             Card newCard = null;\n             try {\n                 long cid = col.undo();\n-                if (cid != 0 && cid != -1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b8fdab38f3e6674f4c9c4502c22b6fb2d083c58"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMyNTUwOA==", "bodyText": "In the new case 2, you probably meant \"cid != -1\". instead of \"cid != 1\". You forgot a minus sign.\nEssentially, if you used to go to case 2, it means that cid == 0, since you know that it is not different from both 0 and -1.\nMathematically, the proof is long but easy.\n, \"reset and get a new card\" only occurred iff\n\"(not (cid != 0 && cid != -1)) and (cid !=-1)\" the first of the conjunction because it's in the \"else\" part.\niff\n\"(not cid !=0 || not cid !=-1) and (cid!= -1)\"\niff\n\"(cid ==0 || cid ==-1) && (cid !=-1)\"\niff\n\"(cid ==0 && cid !=-1) || (cid ==-1&&cid!=-1)\"\niff\n\"(cid ==0)|| false\"\niff\n\"cid ==0\", which means that it currently execute \"reset and get new card\"\nNow \"a review was undone\" occurs iff\n\"(not (cid ==0)) && cid !=-1)\"\niff\n\"cid !=0 && cid !=-1\"\niff \"a review was undone\" in the previous case\nSo both codes are equivalent, but the second one is quite more clear I believe", "url": "https://github.com/ankidroid/Anki-Android/pull/6037#discussion_r410325508", "createdAt": "2020-04-17T16:12:33Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -865,16 +865,16 @@ private TaskData doInBackgroundUndo(TaskData... params) {\n             Card newCard = null;\n             try {\n                 long cid = col.undo();\n-                if (cid != 0 && cid != -1) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI5MTY4OA=="}, "originalCommit": {"oid": "0b8fdab38f3e6674f4c9c4502c22b6fb2d083c58"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcwNzQ0NA==", "bodyText": "@Arthur-Milchior you haven't responded to my comment here, so this is still waiting for feedback I think", "url": "https://github.com/ankidroid/Anki-Android/pull/6037#discussion_r410707444", "createdAt": "2020-04-18T14:49:34Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -865,16 +865,16 @@ private TaskData doInBackgroundUndo(TaskData... params) {\n             Card newCard = null;\n             try {\n                 long cid = col.undo();\n-                if (cid != 0 && cid != -1) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI5MTY4OA=="}, "originalCommit": {"oid": "0b8fdab38f3e6674f4c9c4502c22b6fb2d083c58"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcxMjY3Mg==", "bodyText": "Okay - I also went over and verified Collection.undo()\nif it returns > 0 it is a card id,  that means get that card, reset, start timer etc.\nif it returns -1 that is the specific value that says \"do not fetch a new card\" (it's commented in there)\nif it returns 0 that is either the default or there was a single card reset/reposition/bury\nTo me this is still confusing to read (why is '-1' important, and why are we only testing if it is not '-1'?) compared with how important it is. We shouldn't require mathematical proofs to know what we're doing\nCould you restructure it to explicitly handle the three possible cases with a little comment even though I think one of them ('-1') is a no-op?\nSomething like this terribly formatted java\nif (cid == 0) { /* card schedule change undone, reset and get new card */ Timber.d(\"Single card non-review change undo succeeded\"); }\nif (cid > 0) { /* card review undone, set up to review that card again */ Timber.d(\"Single card review undo succeeded\"); }\nif (cid < 0) { /* multi-card action undone, no action to take here */ Timber.d(\"Multi-select undo succeeded\"); }\nOr anything similar that explained clearly what a return value in each range in the full set of integers means. I recognize I'm asking for something different than was there originally but I think it's an improvement for future explorers in the area, my future self will appreciate it at least", "url": "https://github.com/ankidroid/Anki-Android/pull/6037#discussion_r410712672", "createdAt": "2020-04-18T15:31:56Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -865,16 +865,16 @@ private TaskData doInBackgroundUndo(TaskData... params) {\n             Card newCard = null;\n             try {\n                 long cid = col.undo();\n-                if (cid != 0 && cid != -1) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI5MTY4OA=="}, "originalCommit": {"oid": "0b8fdab38f3e6674f4c9c4502c22b6fb2d083c58"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcxMzYwMg==", "bodyText": "the proof is here to show that I do not change the code semantic. I do not intend to add it in the code. Because it was not clear to you in the previous code that the \"case 2\" was simply \"if cid=0\"\nIf it was needed in the actual code, it would be a great problem", "url": "https://github.com/ankidroid/Anki-Android/pull/6037#discussion_r410713602", "createdAt": "2020-04-18T15:39:59Z", "author": {"login": "Arthur-Milchior"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -865,16 +865,16 @@ private TaskData doInBackgroundUndo(TaskData... params) {\n             Card newCard = null;\n             try {\n                 long cid = col.undo();\n-                if (cid != 0 && cid != -1) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI5MTY4OA=="}, "originalCommit": {"oid": "0b8fdab38f3e6674f4c9c4502c22b6fb2d083c58"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDcyMzA1Mw==", "bodyText": "The current state / your most recent change works for me, the comments+timbers now let me know right here all integer ranges are handled so as a developer coming in here I wouldn't be lost anymore. Thanks! Let me re-read it then I think yes it will be good to go", "url": "https://github.com/ankidroid/Anki-Android/pull/6037#discussion_r410723053", "createdAt": "2020-04-18T17:01:55Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/async/CollectionTask.java", "diffHunk": "@@ -865,16 +865,16 @@ private TaskData doInBackgroundUndo(TaskData... params) {\n             Card newCard = null;\n             try {\n                 long cid = col.undo();\n-                if (cid != 0 && cid != -1) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI5MTY4OA=="}, "originalCommit": {"oid": "0b8fdab38f3e6674f4c9c4502c22b6fb2d083c58"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 356, "cost": 1, "resetAt": "2021-11-11T21:28:48Z"}}}