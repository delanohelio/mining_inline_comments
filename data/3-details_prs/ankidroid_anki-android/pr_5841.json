{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxNzEyMzgz", "number": 5841, "title": "Fix permission handling in Multimedia editor", "bodyText": "Purpose / Description\nEditing a note, selecting \"Record Audio\", with denied & remembered permissions would soft crash the app.\nFixes\nFixes #5407\nApproach\nExplained in #5407\n\nDefine 3 transitions (between Multimedia UIs):\n\nInit - initial load\nUI - Menu Item is clicked, (changing from \"Record Audio\" to \"Insert Image\").\n\nTreat this as cancellable\n\n\nActivity - Pronunciation calls \"Record Audio\" with a known clip to allow for preview and pronunciation recreation.\n\nThis is invoked by the caller, so there's no way to know whether the previous UI is in a valid state. Treat this is non-cancellable.\n\n\n\n\n\nAllow \"Record Audio\" to fail a transition\n\nUI - Failing will keep the application on the previous multimedia UI.\n\nRequires changes to avoid destroying the previous context until the new context validates.\n\n\nInit - Cancel the Activity\nActivity - Allow access to \"Record Audio\" without permissions\n\n\nSave the state of a transition to allow the async onRequestPermissionsResult to reapply the context.\nMark the state as having \"permissions requested\", so they're not re-requested when calling recreateEditingUi\nShow a toast notification on \"Permission Denied\"\nEnsure \"Record Audio\" can be used without permissions.\n\n\nHow Has This Been Tested?\n\nDeny permissions:\nSelecting from the attachment fails and takes you back to the main screen/\nA preview from pronunciation succeeds\n\nToasts are displayed on permissions issues.\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-03-20T19:47:41Z", "url": "https://github.com/ankidroid/Anki-Android/pull/5841", "merged": true, "mergeCommit": {"oid": "eb89b5b9e64c945e5c4a53494f45cf3b1629f625"}, "closed": true, "closedAt": "2020-03-22T16:46:56Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcP-6sPAFqTM3ODk2MzI5NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQL91dAFqTM3OTAyMDAwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4OTYzMjk0", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#pullrequestreview-378963294", "createdAt": "2020-03-22T00:53:09Z", "commit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMDo1MzowOVrOF5sjYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMDo1MzowOVrOF5sjYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzEwNg==", "bodyText": "There's a conflict here now because #5848 beat it to merge - the perils of moving fast :-)", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396043106", "createdAt": "2020-03-22T00:53:09Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -139,4 +139,11 @@\n     <string name=\"empty_cards_none\">No empty cards</string>\n     <string name=\"empty_cards_count\">Cards to delete: %d</string>\n     <string name=\"empty_cards_deleted\">Cards deleted: %d</string>\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4OTYzMzU2", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#pullrequestreview-378963356", "createdAt": "2020-03-22T00:54:47Z", "commit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMDo1NDo0OFrOF5sjoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQwMTozODoyMlrOF5ssRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzE2OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <string name=\"multimedia_editor_camera_permission_refused\"> Could not obtain permissions for camera. Functionality has been disabled.</string>\n          \n          \n            \n                <string name=\"multimedia_editor_camera_permission_refused\">Could not obtain camera permission. Functionality has been disabled.</string>", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396043168", "createdAt": "2020-03-22T00:54:48Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -139,4 +139,11 @@\n     <string name=\"empty_cards_none\">No empty cards</string>\n     <string name=\"empty_cards_count\">Cards to delete: %d</string>\n     <string name=\"empty_cards_deleted\">Cards deleted: %d</string>\n+\n+    <!-- Multimedia - Edit Field Activity -->\n+    <string name=\"multimedia_editor_audio_permission_refused\">Could not obtain permission to record audio.</string>\n+    <string name=\"multimedia_editor_camera_permission_refused\"> Could not obtain permissions for camera. Functionality has been disabled.</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzE5OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <string name=\"multimedia_editor_audio_permission_refused\">Could not obtain permission to record audio.</string>\n          \n          \n            \n                <string name=\"multimedia_editor_audio_permission_refused\">Could not obtain microphone permission.</string>", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396043198", "createdAt": "2020-03-22T00:55:35Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/res/values/03-dialogs.xml", "diffHunk": "@@ -139,4 +139,11 @@\n     <string name=\"empty_cards_none\">No empty cards</string>\n     <string name=\"empty_cards_count\">Cards to delete: %d</string>\n     <string name=\"empty_cards_deleted\">Cards deleted: %d</string>\n+\n+    <!-- Multimedia - Edit Field Activity -->\n+    <string name=\"multimedia_editor_audio_permission_refused\">Could not obtain permission to record audio.</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzM0MQ==", "bodyText": "Not strictly necessary, but I suppose you could refactor the storage permission check to this style?", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396043341", "createdAt": "2020-03-22T00:58:06Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/utils/Permissions.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package com.ichi2.anki.multimediacard.utils;\n+\n+import android.Manifest;\n+import android.content.Context;\n+import android.content.pm.PackageManager;\n+\n+import androidx.annotation.NonNull;\n+import androidx.core.content.ContextCompat;\n+\n+public class Permissions {\n+    private Permissions() { }\n+\n+    public static boolean canUseCamera(@NonNull Context context) {\n+        return hasPermission(context, Manifest.permission.CAMERA);\n+    }\n+\n+    public static boolean canRecordAudio(@NonNull Context context) {\n+        return hasPermission(context, Manifest.permission.RECORD_AUDIO);\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0MzQ3Ng==", "bodyText": "If we're going to have a Permissions object, could we encapsulate the requests in there too?", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396043476", "createdAt": "2020-03-22T01:00:39Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -96,55 +101,80 @@ protected void onCreate(Bundle savedInstanceState) {\n \n         mFieldIndex = this.getIntent().getIntExtra(EXTRA_FIELD_INDEX, 0);\n \n-        recreateEditingUi();\n+        recreateEditingUi(ChangeUIRequest.init(mField));\n     }\n \n \n     private void finishCancel() {\n+        Timber.d(\"Completing activity via finishCancel()\");\n         Intent resultData = new Intent();\n         setResult(RESULT_CANCELED, resultData);\n         finishWithoutAnimation();\n     }\n \n+    private boolean performPermissionRequest(IField field) {\n+        // Request permission to record if audio field\n+        if (field instanceof AudioRecordingField && !Permissions.canRecordAudio(this)) {\n+            ActivityCompat.requestPermissions(this, new String[] {Manifest.permission.RECORD_AUDIO},\n+                    REQUEST_AUDIO_PERMISSION);\n+            return true;\n+        }\n+\n+        // Request permission to use the camera if image field\n+        if (field instanceof ImageField && !Permissions.canUseCamera(this)) {\n+            ActivityCompat.requestPermissions(this, new String[] {Manifest.permission.CAMERA},\n+                    REQUEST_CAMERA_PERMISSION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f0b7a54d28c1c8b11b0ea79431dc15a2435c9dd"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0NDYwOA==", "bodyText": "This is basically a guaranteed crash right? To be avoided at all costs, it's just making future work. A toast and a fall back to the note editor or anything is better than throwing a RuntimeException if we can avoid it", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396044608", "createdAt": "2020-03-22T01:23:30Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -305,19 +318,21 @@ protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n \n \n     public void onRequestPermissionsResult (int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {\n+        if (mCurrentChangeRequest == null) {\n+            throw new IllegalStateException(\"mCurrentChangeRequest should be set before using cached request\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b885022d2b3d5baec090872d93ea0ec322aaca32"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0NTAyNQ==", "bodyText": "I have to admit I'm a fan of Timber.d's for things like this, dumping all pertinent internal state to the logs if it's possible", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396045025", "createdAt": "2020-03-22T01:31:36Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -390,4 +414,29 @@ int getState() {\n             return state;\n         }\n     }\n-}\n+\n+    /**\n+     * Class to contain logic relating to decisions made when recreating a UI.\n+     * Can later be converted to a non-static class to allow testing of the logic.\n+     * */\n+    private static final class UIRecreationLogic {\n+\n+        static void onRequiredPermissionDenied(ChangeUIRequest request, MultimediaEditFieldActivity activity) {\n+            switch (request.state)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "057488d2583d29d924a6fa7822a8243145651032"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0NTE2Mg==", "bodyText": "The property accessors are non-standard, can we just do get/set?", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396045162", "createdAt": "2020-03-22T01:34:46Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -410,6 +414,14 @@ static ChangeUIRequest fieldChange(IField field) {\n             return new ChangeUIRequest(field, EXTERNAL_FIELD_CHANGE);\n         }\n \n+        boolean doesRequirePermissionCheck() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e591dd5340d54c4345b194fec6ff708c77d7d2be"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0NTM4MQ==", "bodyText": "similarly Timber.d's here and in the other onXXXFailed methods would be nice", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396045381", "createdAt": "2020-03-22T01:38:22Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/multimediacard/activity/MultimediaEditFieldActivity.java", "diffHunk": "@@ -433,6 +427,50 @@ int getState() {\n      * */\n     private static final class UIRecreationLogic {\n \n+        /** Raised just before the field controller is replaced */\n+        static void onPreFieldControllerReplacement(IFieldController previousFieldController) {\n+            //on init, we don't need to do anything", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47bf7fe4d83f78a7ee36ca4cb49370c0b17aab46"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "614eff0f64daacdd097e4b1740777ccb059246cc", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/614eff0f64daacdd097e4b1740777ccb059246cc", "committedDate": "2020-03-22T10:32:59Z", "message": "NF: Extract Permissions to Class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0682a4b3466fe956107b8ffc3dd7ef7c8c7b578", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f0682a4b3466fe956107b8ffc3dd7ef7c8c7b578", "committedDate": "2020-03-22T10:33:19Z", "message": "Ensure we have permissions before audio recording\n\nWe can get to the AudioView screen from the pronunciation screen,\nthis is a one-way transition, and should succeed, even if we can't\nuse the screen to record audio."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7860f4ff824ad2ff10f781f09fd76700c7e4bad5", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7860f4ff824ad2ff10f781f09fd76700c7e4bad5", "committedDate": "2020-03-22T10:33:26Z", "message": "NF: Extract method: performPermissionRequest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f35b3d1cd0dfe49568f78e659453ee397b02af4a", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/f35b3d1cd0dfe49568f78e659453ee397b02af4a", "committedDate": "2020-03-22T10:33:26Z", "message": "NF: Extract method: setupUIController"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28b1dd0a832416e07a101a989629be9f950ab15c", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/28b1dd0a832416e07a101a989629be9f950ab15c", "committedDate": "2020-03-22T10:33:26Z", "message": "MultimediaEditor: Delay changing field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de4ec31a873ff15ebcebf119dfda29d5034b13d2", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/de4ec31a873ff15ebcebf119dfda29d5034b13d2", "committedDate": "2020-03-22T10:33:27Z", "message": "Multimedia: Only rerender on permission success\n\nPreviously, we would get into a loop of asking for permissions if\nthe user ticked \"deny & remember\".\n\nNow we close the dialog and cancel the activity.\n\nWe now only try and redraw if we were successful.\n\nFixes #5407"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a49bfab0cdc2d3a7e6a27cf7a62d7a9c6bb3ddff", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a49bfab0cdc2d3a7e6a27cf7a62d7a9c6bb3ddff", "committedDate": "2020-03-22T10:33:28Z", "message": "Multimedia: Stop second permission check\n\nIf we went through the permission check once, we don't need to go\nthrough it again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1b604dd07fbe1142b740b6e619d700d6f84a85c", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e1b604dd07fbe1142b740b6e619d700d6f84a85c", "committedDate": "2020-03-22T10:33:28Z", "message": "Multimedia: Only kill previous UI if successful\n\nPreviously, onLostFocus would kill the previous activity. If we fail\nnavigation due to permissions, then we had nowhere to go\n\nNow, we only perform this if we have permission and can create a\nfield controller"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dacbc44290808023ac298898a15155b32537c58e", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/dacbc44290808023ac298898a15155b32537c58e", "committedDate": "2020-03-22T10:33:29Z", "message": "Review: Made access modifiers explicit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00f08007e0efd1a65c4774bf4bc22257cb9c1755", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/00f08007e0efd1a65c4774bf4bc22257cb9c1755", "committedDate": "2020-03-22T10:33:29Z", "message": "Review: Rename Class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c675c3df2b5bd28b99510921672abce2f877a19", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4c675c3df2b5bd28b99510921672abce2f877a19", "committedDate": "2020-03-22T10:33:30Z", "message": "NF: Fix spacing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42f042de3bb72ab405578c698431dd15cd343067", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/42f042de3bb72ab405578c698431dd15cd343067", "committedDate": "2020-03-22T10:33:30Z", "message": "Review: Fix Advanced Editor Strings\n\nCo-Authored-By: Mike Hardy <github@mikehardy.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbdd22fbf6d262758a1d6fc2a8a1dce39e7ba0b1", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/fbdd22fbf6d262758a1d6fc2a8a1dce39e7ba0b1", "committedDate": "2020-03-22T10:33:31Z", "message": "Review: Improve Advanced Editor strings\n\nCo-Authored-By: Mike Hardy <github@mikehardy.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3357de5b464e57f843fa213ccf42499b5fb102c", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c3357de5b464e57f843fa213ccf42499b5fb102c", "committedDate": "2020-03-22T10:46:18Z", "message": "Review change: Rename method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "484bda71ecddd84c900d534086be96a58ee95dcd", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/484bda71ecddd84c900d534086be96a58ee95dcd", "committedDate": "2020-03-22T10:52:31Z", "message": "Review change: Added Logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "670107ff7c2a1636d6822c2d846523f9876f9fd0", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/670107ff7c2a1636d6822c2d846523f9876f9fd0", "committedDate": "2020-03-22T11:05:55Z", "message": "Review change: Assertion Failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d089cd285a9fb26e186751a91a2dbe4f23f4e927", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d089cd285a9fb26e186751a91a2dbe4f23f4e927", "committedDate": "2020-03-22T11:13:02Z", "message": "Review change: Moved Permissions file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c22db4f6b55c17c01f22b3ee06e6b12b1504b7ac", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c22db4f6b55c17c01f22b3ee06e6b12b1504b7ac", "committedDate": "2020-03-22T11:14:51Z", "message": "Review change: Extract hasStorageAccessPermission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93da7f53c3c4246b88871d793cc1affdc4dcaaca", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/93da7f53c3c4246b88871d793cc1affdc4dcaaca", "committedDate": "2020-03-22T11:16:28Z", "message": "Refactor: use canUseCamera"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3315addc51b594ed59f55859a3d48f1c355a06e", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d3315addc51b594ed59f55859a3d48f1c355a06e", "committedDate": "2020-03-22T11:18:41Z", "message": "Refactor: extract canUseWakeLock"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc6615bf01479b65f2b96967c192e0d08844c442", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/dc6615bf01479b65f2b96967c192e0d08844c442", "committedDate": "2020-03-22T11:19:37Z", "message": "Refactor: Improve permissions check"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f748763a0226c1020f13e594f4149c7fc562111", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4f748763a0226c1020f13e594f4149c7fc562111", "committedDate": "2020-03-22T09:43:02Z", "message": "Review: Improve Advanced Editor strings\n\nCo-Authored-By: Mike Hardy <github@mikehardy.net>"}, "afterCommit": {"oid": "dc6615bf01479b65f2b96967c192e0d08844c442", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/dc6615bf01479b65f2b96967c192e0d08844c442", "committedDate": "2020-03-22T11:19:37Z", "message": "Refactor: Improve permissions check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4OTk1MDY0", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#pullrequestreview-378995064", "createdAt": "2020-03-22T11:24:52Z", "commit": {"oid": "dc6615bf01479b65f2b96967c192e0d08844c442"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxMToyNDo1MlrOF5u8Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMlQxMToyNDo1MlrOF5u8Rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA4MjI0Nw==", "bodyText": "Issue found: The utility class name 'Permissions' doesn't match '[A-Z][a-zA-Z0-9]+(Utils?|Helper)'", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#discussion_r396082247", "createdAt": "2020-03-22T11:24:52Z", "author": {"login": "timrae"}, "path": "AnkiDroid/src/main/java/com/ichi2/utils/Permissions.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package com.ichi2.utils;\n+\n+import android.Manifest;\n+import android.content.Context;\n+import android.content.pm.PackageManager;\n+\n+import androidx.annotation.NonNull;\n+import androidx.core.content.ContextCompat;\n+\n+public class Permissions {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dc6615bf01479b65f2b96967c192e0d08844c442"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MDIwMDAy", "url": "https://github.com/ankidroid/Anki-Android/pull/5841#pullrequestreview-379020002", "createdAt": "2020-03-22T16:05:22Z", "commit": {"oid": "dc6615bf01479b65f2b96967c192e0d08844c442"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3533, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}