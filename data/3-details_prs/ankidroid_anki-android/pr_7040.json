{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxMzA2NDMz", "number": 7040, "title": "No counts in abstract flash card viewer", "bodyText": "Purpose / Description\nCurrently, previewer does not display counts, but still compute it. The trouble is that counts takes current card into consideration, assuming it's a card sent to the reviewer, so in one of the three queue.\nThis ensure that the counts (and ETA) are only computed when we actually need them. This save computation time and avoid the problem #7039.\nIf you accept this design, I'd also suggest to move all members related to the four buttons to Reviewer, since they are never shown in the previewer\nNote that this lead to a question: what should we send to JS in the previewer. After all, there is no count, no eta, no list of new card to see... So it's not easy to know what we should send if we ask it. Currently, I return \"\" and 0, but this may easily be changed\nFixes\nFixes #7039\nApproach\nEnsuring that counts is not called unless we actually want its values\nHow Has This Been Tested?\nOn my phone, using preview of suspended card and reviewing\nChecklist\nPlease, go through these checks before submitting the PR.\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-09-07T11:28:05Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7040", "merged": true, "mergeCommit": {"oid": "08bb0597601de2995c81e16ee6b187b68a60a49a"}, "closed": true, "closedAt": "2020-09-07T16:23:24Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGgOxugH2gAyNDgxMzA2NDMzOjIzODY0NTUxMTVhOTRiMjI3YTJhZjgwYTA2Mzc1NDBjNTY1NTVmMGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdGke03AFqTQ4MzYyMjgzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2386455115a94b227a2af80a0637540c56555f0a", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/2386455115a94b227a2af80a0637540c56555f0a", "committedDate": "2020-09-07T10:13:53Z", "message": "NF: restorePreferences: get preferences from super"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6cc4ff7eae3d5762c9012ddec030e67880ec7e9", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d6cc4ff7eae3d5762c9012ddec030e67880ec7e9", "committedDate": "2020-09-07T11:13:14Z", "message": "Counts moved from AbstractFlashcardViewer to Reviewer\n\nFirst, because counts in previewer makes no sens. Eta makes no sens either. And also because it leads to trouble when\npreviewing a card which is not in one of the three standard queues. See https://github.com/ankidroid/Anki-Android/issues/7039"}, "afterCommit": {"oid": "acb66cf8ace6c20fdc24870331e81bff6a6e9c7c", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/acb66cf8ace6c20fdc24870331e81bff6a6e9c7c", "committedDate": "2020-09-07T13:22:13Z", "message": "Counts moved from AbstractFlashcardViewer to Reviewer\n\nFirst, because counts in previewer makes no sens. Eta makes no sens either. And also because it leads to trouble when\npreviewing a card which is not in one of the three standard queues. See https://github.com/ankidroid/Anki-Android/issues/7039"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNTUxMTA2", "url": "https://github.com/ankidroid/Anki-Android/pull/7040#pullrequestreview-483551106", "createdAt": "2020-09-07T13:21:33Z", "commit": {"oid": "d6cc4ff7eae3d5762c9012ddec030e67880ec7e9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMzoyMTozM1rOHN_LXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMzoyMjoyNVrOHN_M5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQyODYzOQ==", "bodyText": "As mentioned elsewhere I want default values that are obviously \"wrong\" for the type but nevertheless workable in the javascript type system in case math operations are attempted on the result. Please return -1 for all \"number\" types", "url": "https://github.com/ankidroid/Anki-Android/pull/7040#discussion_r484428639", "createdAt": "2020-09-07T13:21:33Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -3783,22 +3718,25 @@ public String init(String jsonData) {\n \n         @JavascriptInterface\n         public String ankiGetNewCardCount() {\n-            return newCount.toString();\n+            return \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6cc4ff7eae3d5762c9012ddec030e67880ec7e9"}, "originalPosition": 181}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQyOTAzMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public class JavasScriptFunction extends AbstractFlashcardViewer.JavaScriptFunction {\n          \n          \n            \n            \n          \n          \n            \n                public class JavasScriptFunction extends AbstractFlashcardViewer.JavaScriptFunction {", "url": "https://github.com/ankidroid/Anki-Android/pull/7040#discussion_r484429030", "createdAt": "2020-09-07T13:22:25Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -1058,4 +1162,33 @@ public boolean onMenuItemClick(MenuItem item) {\n             }\n         }\n     }\n+\n+    public JavasScriptFunction javaScriptFunction() {\n+        return new JavasScriptFunction();\n+    }\n+    public class JavasScriptFunction extends AbstractFlashcardViewer.JavaScriptFunction {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6cc4ff7eae3d5762c9012ddec030e67880ec7e9"}, "originalPosition": 173}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "acb66cf8ace6c20fdc24870331e81bff6a6e9c7c", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/acb66cf8ace6c20fdc24870331e81bff6a6e9c7c", "committedDate": "2020-09-07T13:22:13Z", "message": "Counts moved from AbstractFlashcardViewer to Reviewer\n\nFirst, because counts in previewer makes no sens. Eta makes no sens either. And also because it leads to trouble when\npreviewing a card which is not in one of the three standard queues. See https://github.com/ankidroid/Anki-Android/issues/7039"}, "afterCommit": {"oid": "60378dcd16ec632311c10291cdf3a34480693669", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/60378dcd16ec632311c10291cdf3a34480693669", "committedDate": "2020-09-07T13:28:23Z", "message": "Counts moved from AbstractFlashcardViewer to Reviewer\n\nFirst, because counts in previewer makes no sens. Eta makes no sens either. And also because it leads to trouble when\npreviewing a card which is not in one of the three standard queues. See https://github.com/ankidroid/Anki-Android/issues/7039"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60378dcd16ec632311c10291cdf3a34480693669", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/60378dcd16ec632311c10291cdf3a34480693669", "committedDate": "2020-09-07T13:28:23Z", "message": "Counts moved from AbstractFlashcardViewer to Reviewer\n\nFirst, because counts in previewer makes no sens. Eta makes no sens either. And also because it leads to trouble when\npreviewing a card which is not in one of the three standard queues. See https://github.com/ankidroid/Anki-Android/issues/7039"}, "afterCommit": {"oid": "a5831b27c89e0548c283fbdcb5d1fd4e4a1a14a8", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a5831b27c89e0548c283fbdcb5d1fd4e4a1a14a8", "committedDate": "2020-09-07T13:28:58Z", "message": "Counts moved from AbstractFlashcardViewer to Reviewer\n\nFirst, because counts in previewer makes no sens. Eta makes no sens either. And also because it leads to trouble when\npreviewing a card which is not in one of the three standard queues. See https://github.com/ankidroid/Anki-Android/issues/7039"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNTYwODI0", "url": "https://github.com/ankidroid/Anki-Android/pull/7040#pullrequestreview-483560824", "createdAt": "2020-09-07T13:36:25Z", "commit": {"oid": "a5831b27c89e0548c283fbdcb5d1fd4e4a1a14a8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMzozNjoyNVrOHN_pIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMzozNzowMFrOHN_qQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQzNjI1OA==", "bodyText": "Could you leave a comment explaining why, and that this is overridden in a subclass", "url": "https://github.com/ankidroid/Anki-Android/pull/7040#discussion_r484436258", "createdAt": "2020-09-07T13:36:25Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -3783,22 +3718,25 @@ public String init(String jsonData) {\n \n         @JavascriptInterface\n         public String ankiGetNewCardCount() {\n-            return newCount.toString();\n+            return \"-1\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5831b27c89e0548c283fbdcb5d1fd4e4a1a14a8"}, "originalPosition": 181}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQzNjU0Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return new JavasScriptFunction();\n          \n          \n            \n                    return new ReviewerJavaScriptFunction();", "url": "https://github.com/ankidroid/Anki-Android/pull/7040#discussion_r484436547", "createdAt": "2020-09-07T13:37:00Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -1060,4 +1162,34 @@ public boolean onMenuItemClick(MenuItem item) {\n             }\n         }\n     }\n+\n+    public JavasScriptFunction javaScriptFunction() {\n+        return new JavasScriptFunction();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5831b27c89e0548c283fbdcb5d1fd4e4a1a14a8"}, "originalPosition": 175}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a5831b27c89e0548c283fbdcb5d1fd4e4a1a14a8", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a5831b27c89e0548c283fbdcb5d1fd4e4a1a14a8", "committedDate": "2020-09-07T13:28:58Z", "message": "Counts moved from AbstractFlashcardViewer to Reviewer\n\nFirst, because counts in previewer makes no sens. Eta makes no sens either. And also because it leads to trouble when\npreviewing a card which is not in one of the three standard queues. See https://github.com/ankidroid/Anki-Android/issues/7039"}, "afterCommit": {"oid": "13e16207700d853de6ea7ebfaaefb9f70548fee0", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/13e16207700d853de6ea7ebfaaefb9f70548fee0", "committedDate": "2020-09-07T14:06:41Z", "message": "Counts moved from AbstractFlashcardViewer to Reviewer\n\nFirst, because counts in previewer makes no sens. Eta makes no sens either. And also because it leads to trouble when\npreviewing a card which is not in one of the three standard queues. See https://github.com/ankidroid/Anki-Android/issues/7039"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNTg5OTA0", "url": "https://github.com/ankidroid/Anki-Android/pull/7040#pullrequestreview-483589904", "createdAt": "2020-09-07T14:18:07Z", "commit": {"oid": "13e16207700d853de6ea7ebfaaefb9f70548fee0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxNDoxODowN1rOHOBEdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxNDoxODowN1rOHOBEdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ1OTYzOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public class ReviewerJavasScriptFunction extends JavaScriptFunction {\n          \n          \n            \n                public class ReviewerJavaScriptFunction extends JavaScriptFunction {", "url": "https://github.com/ankidroid/Anki-Android/pull/7040#discussion_r484459639", "createdAt": "2020-09-07T14:18:07Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -1060,4 +1162,34 @@ public boolean onMenuItemClick(MenuItem item) {\n             }\n         }\n     }\n+\n+    public ReviewerJavasScriptFunction javaScriptFunction() {\n+        return new ReviewerJavasScriptFunction();\n+    }\n+\n+    public class ReviewerJavasScriptFunction extends JavaScriptFunction {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13e16207700d853de6ea7ebfaaefb9f70548fee0"}, "originalPosition": 178}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47149af4cfb4690bed20084ad24f653c8369b88e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/47149af4cfb4690bed20084ad24f653c8369b88e", "committedDate": "2020-09-07T14:36:42Z", "message": "Counts moved from AbstractFlashcardViewer to Reviewer\n\nFirst, because counts in previewer makes no sens. Eta makes no sens either. And also because it leads to trouble when\npreviewing a card which is not in one of the three standard queues. See https://github.com/ankidroid/Anki-Android/issues/7039"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "13e16207700d853de6ea7ebfaaefb9f70548fee0", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/13e16207700d853de6ea7ebfaaefb9f70548fee0", "committedDate": "2020-09-07T14:06:41Z", "message": "Counts moved from AbstractFlashcardViewer to Reviewer\n\nFirst, because counts in previewer makes no sens. Eta makes no sens either. And also because it leads to trouble when\npreviewing a card which is not in one of the three standard queues. See https://github.com/ankidroid/Anki-Android/issues/7039"}, "afterCommit": {"oid": "47149af4cfb4690bed20084ad24f653c8369b88e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/47149af4cfb4690bed20084ad24f653c8369b88e", "committedDate": "2020-09-07T14:36:42Z", "message": "Counts moved from AbstractFlashcardViewer to Reviewer\n\nFirst, because counts in previewer makes no sens. Eta makes no sens either. And also because it leads to trouble when\npreviewing a card which is not in one of the three standard queues. See https://github.com/ankidroid/Anki-Android/issues/7039"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNjE5ODQ1", "url": "https://github.com/ankidroid/Anki-Android/pull/7040#pullrequestreview-483619845", "createdAt": "2020-09-07T15:05:37Z", "commit": {"oid": "47149af4cfb4690bed20084ad24f653c8369b88e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNjIyODMw", "url": "https://github.com/ankidroid/Anki-Android/pull/7040#pullrequestreview-483622830", "createdAt": "2020-09-07T15:11:02Z", "commit": {"oid": "47149af4cfb4690bed20084ad24f653c8369b88e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4057, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}