{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMzc4ODEw", "number": 6597, "title": "Save current card", "bodyText": "#6026\nIt let the scheduler knows which card is in the reviewer.\nBy itself, it is useless, but it should let #6026 become smaller\nIt is a prerequisite to #6594 too", "createdAt": "2020-07-01T01:00:08Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6597", "merged": true, "mergeCommit": {"oid": "a8f3fef8a118288347f09ac484ccaebe49249577"}, "closed": true, "closedAt": "2020-07-05T19:22:39Z", "author": {"login": "Arthur-Milchior"}, "timelineItems": {"totalCount": 36, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwgZkMABqjM1MDAzMjM0NzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcx-T0cABqjM1MTM0MTg1ODY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "42cc29892dac5107c9fafe94f80a00130c8ffdf5", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/42cc29892dac5107c9fafe94f80a00130c8ffdf5", "committedDate": "2020-07-01T00:58:28Z", "message": "Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "7dbc2f9bf22dcbc3957d0323ce86a130206916ff", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7dbc2f9bf22dcbc3957d0323ce86a130206916ff", "committedDate": "2020-07-01T01:59:14Z", "message": "Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7dbc2f9bf22dcbc3957d0323ce86a130206916ff", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7dbc2f9bf22dcbc3957d0323ce86a130206916ff", "committedDate": "2020-07-01T01:59:14Z", "message": "Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "39264d1d240d1ba14590b954369eae550207420e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/39264d1d240d1ba14590b954369eae550207420e", "committedDate": "2020-07-01T03:37:05Z", "message": "Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39264d1d240d1ba14590b954369eae550207420e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/39264d1d240d1ba14590b954369eae550207420e", "committedDate": "2020-07-01T03:37:05Z", "message": "Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "12c98099eca2598bed4faf523fe787e11d51d1c1", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/12c98099eca2598bed4faf523fe787e11d51d1c1", "committedDate": "2020-07-01T16:00:53Z", "message": "Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12c98099eca2598bed4faf523fe787e11d51d1c1", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/12c98099eca2598bed4faf523fe787e11d51d1c1", "committedDate": "2020-07-01T16:00:53Z", "message": "Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "5483f5078b9bd6fa24bd41013a5224e36917bc79", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5483f5078b9bd6fa24bd41013a5224e36917bc79", "committedDate": "2020-07-01T16:13:52Z", "message": "Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5483f5078b9bd6fa24bd41013a5224e36917bc79", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/5483f5078b9bd6fa24bd41013a5224e36917bc79", "committedDate": "2020-07-01T16:13:52Z", "message": "Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "7b12724558f40787cbf90e3c96e448f3ba76ed59", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7b12724558f40787cbf90e3c96e448f3ba76ed59", "committedDate": "2020-07-01T16:20:41Z", "message": "Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b12724558f40787cbf90e3c96e448f3ba76ed59", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/7b12724558f40787cbf90e3c96e448f3ba76ed59", "committedDate": "2020-07-01T16:20:41Z", "message": "Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "e8bc745448d60a91256d95038a768f97aa8658ad", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e8bc745448d60a91256d95038a768f97aa8658ad", "committedDate": "2020-07-01T17:49:59Z", "message": "Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMDgwNDk2", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#pullrequestreview-441080496", "createdAt": "2020-07-01T17:51:05Z", "commit": {"oid": "7b12724558f40787cbf90e3c96e448f3ba76ed59"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNzo1MToyN1rOGrvyDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxNzo1Mzo0M1rOGrv2ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyNDgxMw==", "bodyText": "can this be moved inside the scheduler?", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#discussion_r448524813", "createdAt": "2020-07-01T17:51:27Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -3057,6 +3063,7 @@ protected void onFlag(Card card, @FlagDef int flag) {\n \n     protected void dismiss(Collection.DismissType type) {\n         blockControls(false);\n+        mSched.discardCurrentCard();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8bc745448d60a91256d95038a768f97aa8658ad"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyNDg1NQ==", "bodyText": "Isn't this in the scheduler already?", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#discussion_r448524855", "createdAt": "2020-07-01T17:51:32Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1344,6 +1349,7 @@ protected void answerCard(int ease) {\n         mSoundPlayer.stopSounds();\n         mCurrentEase = ease;\n \n+        mSched.discardCurrentCard();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8bc745448d60a91256d95038a768f97aa8658ad"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyNTMwMw==", "bodyText": "nit: spacing change", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#discussion_r448525303", "createdAt": "2020-07-01T17:52:27Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/Sched.java", "diffHunk": "@@ -367,7 +368,7 @@ protected boolean _fillLrn() {\n                     .getDatabase()\n                     .query(\n                             \"SELECT due, id FROM cards WHERE did IN \" + _deckLimit() + \" AND queue = \" + Consts.QUEUE_TYPE_LRN + \" AND due < ? LIMIT ?\",\n-                                    new Object[]{mDayCutoff, mReportLimit});\n+                            new Object[]{mDayCutoff, mReportLimit});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8bc745448d60a91256d95038a768f97aa8658ad"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUyNTk2Mg==", "bodyText": "I think this conditional and setup would be best extracted to a method (accepting a QueueType and did) as it's used in 3 places\nSomething along the lines of\ncurrentCardIsInQueueWithDeck(Consts.QUEUE_TYPE_REV, did);\nBonus points for defining the Queue types in Consts via an IntDef", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#discussion_r448525962", "createdAt": "2020-07-01T17:53:43Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/Sched.java", "diffHunk": "@@ -660,7 +661,14 @@ protected int _deckRevLimitSingle(JSONObject d) {\n         }\n         long did = d.getLong(\"id\");\n         JSONObject c = mCol.getDecks().confForDid(did);\n-        return Math.max(0, c.getJSONObject(\"rev\").getInt(\"perDay\") - d.getJSONArray(\"revToday\").getInt(1));\n+        int lim = Math.max(0, c.getJSONObject(\"rev\").getInt(\"perDay\") - d.getJSONArray(\"revToday\").getInt(1));\n+        // mCurrentCard may be set to null when the reviewer gets closed. So we copy it to be sure to avoid NullPointerException\n+        Card currentCard = mCurrentCard;\n+        List<Long> currentCardParentsDid = mCurrentCardParentsDid;\n+        if (currentCard != null && currentCard.getQueue() == Consts.QUEUE_TYPE_REV && currentCardParentsDid != null && currentCardParentsDid.contains(did)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8bc745448d60a91256d95038a768f97aa8658ad"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8bc745448d60a91256d95038a768f97aa8658ad", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/e8bc745448d60a91256d95038a768f97aa8658ad", "committedDate": "2020-07-01T17:49:59Z", "message": "Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "0457b2f3991a3dfbdef25c3cb43cf55d14350a20", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0457b2f3991a3dfbdef25c3cb43cf55d14350a20", "committedDate": "2020-07-01T18:31:04Z", "message": "Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d1389852b05875c7c981ebbee691fb7e5942d2c1", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d1389852b05875c7c981ebbee691fb7e5942d2c1", "committedDate": "2020-07-01T18:41:08Z", "message": "NF: Factorize currentCardIsInQueueWithDeck"}, "afterCommit": {"oid": "13b0da8b9ad94619c4cb928cdfb74150eaa736a7", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/13b0da8b9ad94619c4cb928cdfb74150eaa736a7", "committedDate": "2020-07-01T20:32:46Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "13b0da8b9ad94619c4cb928cdfb74150eaa736a7", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/13b0da8b9ad94619c4cb928cdfb74150eaa736a7", "committedDate": "2020-07-01T20:32:46Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "25f7902e02a8548d4e4e6e081f3ce5fad79374fd", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/25f7902e02a8548d4e4e6e081f3ce5fad79374fd", "committedDate": "2020-07-01T21:41:45Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "25f7902e02a8548d4e4e6e081f3ce5fad79374fd", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/25f7902e02a8548d4e4e6e081f3ce5fad79374fd", "committedDate": "2020-07-01T21:41:45Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "45eab54ed1a9644ab4124373af9ada907a8af909", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/45eab54ed1a9644ab4124373af9ada907a8af909", "committedDate": "2020-07-01T21:42:47Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxMjUzOTEw", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#pullrequestreview-441253910", "createdAt": "2020-07-01T23:19:47Z", "commit": {"oid": "45eab54ed1a9644ab4124373af9ada907a8af909"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMzoxOTo0OFrOGr4TNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQyMzozOTowOFrOGr4ppA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NDM3Mw==", "bodyText": "This isn't called yet.", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#discussion_r448664373", "createdAt": "2020-07-01T23:19:48Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java", "diffHunk": "@@ -760,6 +821,17 @@ private void _maybeResetLrn(boolean force) {\n         }\n     }\n \n+    /** Same as _resetRev, but assume discardCard is currently in the reviewer and so don't conunt it.*/\n+    protected void _resetLrn(@Nullable Card discardCard) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45eab54ed1a9644ab4124373af9ada907a8af909"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NDkzOA==", "bodyText": "Nit: might want to rename card to something more descriptive", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#discussion_r448664938", "createdAt": "2020-07-01T23:21:45Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java", "diffHunk": "@@ -2667,8 +2759,12 @@ public int eta(int[] counts, boolean reload) {\n         return (int) Math.round((newTotal + relrnTotal + revTotal + futureRelrnTotal) / 60000);\n     }\n \n-\n-    public void decrementCounts(Card card) {\n+    /**\n+     * This is used when card is currently in the reviewer, to adapt the counts by removing this card from it.*/\n+    public void decrementCounts(@Nullable Card card) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45eab54ed1a9644ab4124373af9ada907a8af909"}, "originalPosition": 236}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2ODEyOA==", "bodyText": "Just flagging this line for second review - I feel it's OK, but a second pair of eyes would be useful.", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#discussion_r448668128", "createdAt": "2020-07-01T23:32:20Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java", "diffHunk": "@@ -161,7 +180,10 @@ public Card getCard() {\n             // decrement the counts here, when the card is returned to\n             // the reviewer.\n             decrementCounts(card);\n+            setCurrentCard(card);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45eab54ed1a9644ab4124373af9ada907a8af909"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3MDExNg==", "bodyText": "Don't we need to handle duplicates as well as maintaining the counts here?", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#discussion_r448670116", "createdAt": "2020-07-01T23:39:08Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java", "diffHunk": "@@ -760,6 +821,17 @@ private void _maybeResetLrn(boolean force) {\n         }\n     }\n \n+    /** Same as _resetRev, but assume discardCard is currently in the reviewer and so don't conunt it.*/\n+    protected void _resetLrn(@Nullable Card discardCard) {\n+        _resetLrn();\n+        if (discardCard != null && (\n+                discardCard.getQueue() == Consts.QUEUE_TYPE_LRN ||\n+                discardCard.getQueue() == Consts.QUEUE_TYPE_PREVIEW ||\n+                discardCard.getQueue() == Consts.QUEUE_TYPE_DAY_LEARN_RELEARN", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45eab54ed1a9644ab4124373af9ada907a8af909"}, "originalPosition": 160}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "45eab54ed1a9644ab4124373af9ada907a8af909", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/45eab54ed1a9644ab4124373af9ada907a8af909", "committedDate": "2020-07-01T21:42:47Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "8e76fdbb01539198437c20d3d5307bd7fb926a26", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8e76fdbb01539198437c20d3d5307bd7fb926a26", "committedDate": "2020-07-02T13:20:26Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8e76fdbb01539198437c20d3d5307bd7fb926a26", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8e76fdbb01539198437c20d3d5307bd7fb926a26", "committedDate": "2020-07-02T13:20:26Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "89be0e44c2dc6c166d5706501a94a850f982d7fb", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/89be0e44c2dc6c166d5706501a94a850f982d7fb", "committedDate": "2020-07-02T14:09:12Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89be0e44c2dc6c166d5706501a94a850f982d7fb", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/89be0e44c2dc6c166d5706501a94a850f982d7fb", "committedDate": "2020-07-02T14:09:12Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "c50567fffa73128811f84142248a83f9017ff520", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c50567fffa73128811f84142248a83f9017ff520", "committedDate": "2020-07-02T14:30:17Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c50567fffa73128811f84142248a83f9017ff520", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c50567fffa73128811f84142248a83f9017ff520", "committedDate": "2020-07-02T14:30:17Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "ec96edea1e2e6efcd994cfbbae46ad702312db57", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ec96edea1e2e6efcd994cfbbae46ad702312db57", "committedDate": "2020-07-02T14:41:01Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ec96edea1e2e6efcd994cfbbae46ad702312db57", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/ec96edea1e2e6efcd994cfbbae46ad702312db57", "committedDate": "2020-07-02T14:41:01Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "6db123ec1c3608697f5f09a1c2288e51e2b8dc9f", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6db123ec1c3608697f5f09a1c2288e51e2b8dc9f", "committedDate": "2020-07-03T15:32:32Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6db123ec1c3608697f5f09a1c2288e51e2b8dc9f", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6db123ec1c3608697f5f09a1c2288e51e2b8dc9f", "committedDate": "2020-07-03T15:32:32Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "dbfb9c55515be7e35db7c0723d538315c9dfeab7", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/dbfb9c55515be7e35db7c0723d538315c9dfeab7", "committedDate": "2020-07-04T17:17:36Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dbfb9c55515be7e35db7c0723d538315c9dfeab7", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/dbfb9c55515be7e35db7c0723d538315c9dfeab7", "committedDate": "2020-07-04T17:17:36Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "708b8cdb3c005362b89ac3b9a4c89a1187aa9608", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/708b8cdb3c005362b89ac3b9a4c89a1187aa9608", "committedDate": "2020-07-04T20:23:32Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjgxNjM3", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#pullrequestreview-442681637", "createdAt": "2020-07-05T14:25:04Z", "commit": {"oid": "5022b234879db9f9faf0dca1ee5d945c80a6ea21"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNDoyNTowNFrOGtCsWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNDoyNTowNFrOGtCsWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg4MzIyNA==", "bodyText": "You have very strict line length limits set up I think. I think breaking these lines decreases readability and if the editor did that because of limits, you should bump the limits. 80 chars isn't a hard limit anywhere anymore I don't think, 100 or 120 when really needed is okay by me\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * This is used when card is currently in the reviewer, to adapt\n          \n          \n            \n                 * the counts by removing this card from it.\n          \n          \n            \n                 *\n          \n          \n            \n                 * @param discardCard A card sent to reviewer that should not be\n          \n          \n            \n                 * counted.\n          \n          \n            \n                 * Used when card is currently in the reviewer, adapts the counts by removing this card from it.\n          \n          \n            \n                 *\n          \n          \n            \n                 * @param discardCard A card sent to reviewer that should not be counted.\n          \n      \n    \n    \n  \n\nThat can be taken as a general comment, I've noticed it before in your patches, but this one was the most glaring because I'm not sure javadoc @param annotations even work when broken like that, so your editor limit I think actually broke javadoc", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#discussion_r449883224", "createdAt": "2020-07-05T14:25:04Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/Sched.java", "diffHunk": "@@ -1608,19 +1608,24 @@ public int eta(int[] counts, boolean reload) {\n \n \n     /**\n-     * This is used when card is currently in the reviewer, to adapt the counts by removing this card from it.*/\n+     * This is used when card is currently in the reviewer, to adapt\n+     * the counts by removing this card from it.\n+     *\n+     * @param discardCard A card sent to reviewer that should not be\n+     * counted.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5022b234879db9f9faf0dca1ee5d945c80a6ea21"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjgxNzkx", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#pullrequestreview-442681791", "createdAt": "2020-07-05T14:26:47Z", "commit": {"oid": "ace81f3547f9c4b0955231cde57a9bb342482f54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNDoyNjo0OFrOGtCtIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNDoyNjo0OFrOGtCtIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg4MzQyNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // Tells the scheduler there is no more current cards. 0 is\n          \n          \n            \n                    // not a valid id.\n          \n          \n            \n                    // Tells the scheduler there are no more current cards. 0 is not a valid id.", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#discussion_r449883425", "createdAt": "2020-07-05T14:26:48Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -945,6 +945,11 @@ protected void onResume() {\n     @Override\n     protected void onDestroy() {\n         super.onDestroy();\n+        // Tells the scheduler there is no more current cards. 0 is\n+        // not a valid id.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ace81f3547f9c4b0955231cde57a9bb342482f54"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjgyNDA3", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#pullrequestreview-442682407", "createdAt": "2020-07-05T14:31:58Z", "commit": {"oid": "ace81f3547f9c4b0955231cde57a9bb342482f54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNDozMTo1OFrOGtCwCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNDozMTo1OFrOGtCwCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg4NDE3MA==", "bodyText": "maybe a naive question, but should it be and id != ? for currentCardId() if the goal is \"we don't want to get the same card a second time\"? this seems like it would only get the same card, every time?", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#discussion_r449884170", "createdAt": "2020-07-05T14:31:58Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/Sched.java", "diffHunk": "@@ -366,9 +367,20 @@ protected boolean _fillLrn() {\n         mLrnQueue.clear();\n         SupportSQLiteDatabase db = mCol.getDb().getDatabase();\n         try {\n+            /* Difference with upstream:\n+             * Current card can't come in the queue.\n+             *\n+             * In standard usage, a card is not requested before the\n+             * previous card is marked as reviewed. However, if we\n+             * decide to query a second card sooner, we don't want to\n+             * get the same card a second time. This simulate\n+             * _getLrnCard which did remove the card from the\n+             * queue. _sortIntoLrn will add the card back to the queue\n+             * if required when the card is reviewed.\n+             */\n             cur = db.query(\n-                            \"SELECT due, id FROM cards WHERE did IN \" + _deckLimit() + \" AND queue = \" + Consts.QUEUE_TYPE_LRN + \" AND due < ? LIMIT ?\",\n-                                    new Object[]{mDayCutoff, mReportLimit});\n+                           \"SELECT due, id FROM cards WHERE did IN \" + _deckLimit() + \" AND queue = \" + Consts.QUEUE_TYPE_LRN + \" AND due < ? AND id = ? LIMIT ?\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ace81f3547f9c4b0955231cde57a9bb342482f54"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjgyNjA0", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#pullrequestreview-442682604", "createdAt": "2020-07-05T14:34:20Z", "commit": {"oid": "ace81f3547f9c4b0955231cde57a9bb342482f54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNDozNDoyMFrOGtCw_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNDozNDoyMFrOGtCw_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg4NDQxNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Must not be returned during prefetching (as it is currently\n          \n          \n            \n                 * shown)\n          \n          \n            \n                 * Must not be returned during prefetching (as it is currently shown)", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#discussion_r449884414", "createdAt": "2020-07-05T14:34:20Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java", "diffHunk": "@@ -109,6 +109,24 @@\n     // Not in libanki\n     protected WeakReference<Activity> mContextReference;\n \n+    /**\n+     * The card currently being reviewed.\n+     *\n+     * Must not be returned during prefetching (as it is currently\n+     * shown)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ace81f3547f9c4b0955231cde57a9bb342482f54"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34803aab579de4aa9d815c1806794e24c28e921b", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/34803aab579de4aa9d815c1806794e24c28e921b", "committedDate": "2020-07-05T14:36:12Z", "message": "NF: decrementCounts accepts null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27ab7bb12c4cf2892fe13669c07f2d998cbe9096", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/27ab7bb12c4cf2892fe13669c07f2d998cbe9096", "committedDate": "2020-07-05T14:36:12Z", "message": "NF: factorize getDatabase in queue filler"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjgyODQx", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#pullrequestreview-442682841", "createdAt": "2020-07-05T14:37:07Z", "commit": {"oid": "ace81f3547f9c4b0955231cde57a9bb342482f54"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNDozNzowN1rOGtCyGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNDozNzowN1rOGtCyGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg4NDY5OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 */\n          \n          \n            \n                protected Card mCurrentCard;\n          \n          \n            \n                /** The list of parent decks of the current card.\n          \n          \n            \n                 * Cached for performance .\n          \n          \n            \n            \n          \n          \n            \n                    Null iff mNextCard is null.*/\n          \n          \n            \n                @Nullable\n          \n          \n            \n                protected List<Long> mCurrentCardParentsDid;\n          \n          \n            \n                /* The next card that will be sent to the reviewer. I.e. the\n          \n          \n            \n                 * result of a second call to getCard, which is not the current\n          \n          \n            \n                 * card nor a sibling.\n          \n          \n            \n                 */\n          \n          \n            \n                 */\n          \n          \n            \n                protected Card mCurrentCard;\n          \n          \n            \n                \n          \n          \n            \n                /**\n          \n          \n            \n                 * Cached list of parent decks of the current card for performance\n          \n          \n            \n                 *\n          \n          \n            \n                 *  Null iff mNextCard is null.\n          \n          \n            \n                 */\n          \n          \n            \n                @Nullable\n          \n          \n            \n                protected List<Long> mCurrentCardParentsDid;\n          \n          \n            \n                \n          \n          \n            \n                /**\n          \n          \n            \n                 * The next card that will be sent to the reviewer. \n          \n          \n            \n                 * I.e. the result of a second call to getCard, which is not the current card nor a sibling.\n          \n          \n            \n                 */", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#discussion_r449884698", "createdAt": "2020-07-05T14:37:07Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java", "diffHunk": "@@ -109,6 +109,24 @@\n     // Not in libanki\n     protected WeakReference<Activity> mContextReference;\n \n+    /**\n+     * The card currently being reviewed.\n+     *\n+     * Must not be returned during prefetching (as it is currently\n+     * shown)\n+     */\n+    protected Card mCurrentCard;\n+    /** The list of parent decks of the current card.\n+     * Cached for performance .\n+\n+        Null iff mNextCard is null.*/\n+    @Nullable\n+    protected List<Long> mCurrentCardParentsDid;\n+    /* The next card that will be sent to the reviewer. I.e. the\n+     * result of a second call to getCard, which is not the current\n+     * card nor a sibling.\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ace81f3547f9c4b0955231cde57a9bb342482f54"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8bad44e9e88b237463d86339bcba326cf2d4756e", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8bad44e9e88b237463d86339bcba326cf2d4756e", "committedDate": "2020-07-05T14:27:26Z", "message": "Update AnkiDroid/src/main/java/com/ichi2/libanki/sched/Sched.java\n\nCo-authored-by: Mike Hardy <github@mikehardy.net>"}, "afterCommit": {"oid": "a2e28b884166d53783cd401b160be680300fc0cb", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a2e28b884166d53783cd401b160be680300fc0cb", "committedDate": "2020-07-05T14:37:24Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjgyOTkx", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#pullrequestreview-442682991", "createdAt": "2020-07-05T14:39:15Z", "commit": {"oid": "ace81f3547f9c4b0955231cde57a9bb342482f54"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a47c0cbc7459ec024fb7b5c6820ca25331c4fa28", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a47c0cbc7459ec024fb7b5c6820ca25331c4fa28", "committedDate": "2020-07-05T14:42:14Z", "message": "NF: rename decrementCounts argument"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f7568461a190b3b588b9e0b3cb11a0c179bee09", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6f7568461a190b3b588b9e0b3cb11a0c179bee09", "committedDate": "2020-07-05T14:42:15Z", "message": "NF: reset of specific queue takes a card to discard as parameter\n\nThis simulate reset(Card) but applied to a specific queue.\n\nNote that, I believe that ideally, \"count\" should ignore the card\ncurrently in the reviewer; instead the number should be the number of\ncard to review today, and the reviewer should be in charge of knowing\nit currently it has a card so it should decrease the number"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjgzNjkx", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#pullrequestreview-442683691", "createdAt": "2020-07-05T14:49:26Z", "commit": {"oid": "a2e28b884166d53783cd401b160be680300fc0cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjg1Njk4", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#pullrequestreview-442685698", "createdAt": "2020-07-05T15:17:53Z", "commit": {"oid": "a2e28b884166d53783cd401b160be680300fc0cb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNToxNzo1NFrOGtDB8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNVQxNToxNzo1NFrOGtDB8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg4ODc1NQ==", "bodyText": "chastate?", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#discussion_r449888755", "createdAt": "2020-07-05T15:17:54Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sched/SchedV2.java", "diffHunk": "@@ -2725,4 +2872,43 @@ public void setReportLimit(int reportLimit) {\n     }\n \n     /** End #5666 */\n+    public void discardCurrentCard() {\n+        mCurrentCard = null;\n+        mCurrentCardParentsDid = null;\n+    }\n+\n+    /**\n+     * This imitate the action of the method answerCard, except that\n+     * it does not chastate of any card.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2e28b884166d53783cd401b160be680300fc0cb"}, "originalPosition": 373}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjg1NzE1", "url": "https://github.com/ankidroid/Anki-Android/pull/6597#pullrequestreview-442685715", "createdAt": "2020-07-05T15:18:13Z", "commit": {"oid": "a2e28b884166d53783cd401b160be680300fc0cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3aa4c4cf17652766d3ce78056730f4b1d0342b2f", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/3aa4c4cf17652766d3ce78056730f4b1d0342b2f", "committedDate": "2020-07-05T15:23:58Z", "message": "NF: mCurrentCard\n\nIf we want to preload the next card (and fill the queues if required)\nwe need to consider the card currently being reviewed in order to be\nsure not to enqueue it.\n\nThis used to be done automatically simply because, if \"undo\" or\n\"dismiss\" (i.e. bury, suspend) did a reset, it was not actually\ncomputed before the next call to getCard. So it was first marking the\ncurrent card as reviewed and then filling the queues.\n\nNow, we need to take into consideration the fact that the current card\nshould not be added in the queue nor found as the next card. Similarly\nthe sibling of the current card can't be in the queue. And the current\ncard should be considered in the computation of the limit.\n\nSo the AbstractFlashcardViewer warns the scheduler when it gets a\ncard, and also when it closes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15e1a970e35f39b2eb0868647292e9b77f5ee869", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/15e1a970e35f39b2eb0868647292e9b77f5ee869", "committedDate": "2020-07-05T15:23:59Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a2e28b884166d53783cd401b160be680300fc0cb", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/a2e28b884166d53783cd401b160be680300fc0cb", "committedDate": "2020-07-05T14:37:24Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}, "afterCommit": {"oid": "15e1a970e35f39b2eb0868647292e9b77f5ee869", "author": {"user": {"login": "Arthur-Milchior", "name": "Arthur Milchior"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/15e1a970e35f39b2eb0868647292e9b77f5ee869", "committedDate": "2020-07-05T15:23:59Z", "message": "NF: Copy variables before checking for null\n\nSince those variables may be set to null, there is a run of a\nNullPointerException due to concurrent access. This commit should\navoid it."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3057, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}