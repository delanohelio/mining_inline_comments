{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMzQ0Mzcz", "number": 6267, "title": "display languages in preferences using their own language", "bodyText": "sort languages alphabetically, ignoring upper/lower case\nadd comment on exception handler\nPurpose / Description\nMake each language show up in the preference's list in their own language, sorted alphabetically. Also adds a comment for PR #6138 that was merged a little bit quick. :)\nFixes\nFixes #6251\nAlso supersedes/closes #6252\nApproach\nGets the display name of each locale, localized with itself.\nChanges TreeMap <String, String> to TreeMap <String, List> and change the way the data is stored, so it automatically gets sorted correctly.\nHow Has This Been Tested?\nCompiled and tested in emulators, APIs 28 and 16. Works\nChecklist\nPlease, go through these checks before submitting the PR.\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-05-24T00:22:24Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6267", "merged": true, "mergeCommit": {"oid": "6ecdf4366e02c3c0ebed04f9707d6fd9b8a4d0d0"}, "closed": true, "closedAt": "2020-05-24T17:18:53Z", "author": {"login": "Arthus"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckQEEigH2gAyNDIyMzQ0MzczOjc4NWUzMDg1NTA1NDEwOGE1M2ZiMmU1MzlkOTNlNGEyMzYwZDBlYzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABckaH2sAFqTQxNzM1MTMzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "785e30855054108a53fb2e539d93e4a2360d0ec8", "author": {"user": {"login": "Arthus", "name": null}}, "url": "https://github.com/ankidroid/Anki-Android/commit/785e30855054108a53fb2e539d93e4a2360d0ec8", "committedDate": "2020-05-24T00:10:17Z", "message": "show all available languages in preferences using their own language\nsort languages alphabetically, ignoring upper/lower case\n\nadd comment on exception handler"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzE4MTY2", "url": "https://github.com/ankidroid/Anki-Android/pull/6267#pullrequestreview-417318166", "createdAt": "2020-05-24T00:34:35Z", "commit": {"oid": "785e30855054108a53fb2e539d93e4a2360d0ec8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwMDozNDozNVrOGZsAfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwMDozOTowN1rOGZsBMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU4ODYwNw==", "bodyText": "Beware of Arrays.asList. It returns an implementation of List where calling add will crash. This is fine, but for future reference.", "url": "https://github.com/ankidroid/Anki-Android/pull/6267#discussion_r429588607", "createdAt": "2020-05-24T00:34:35Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -810,22 +810,25 @@ private String replaceStringIfNumeric(String str, String value) {\n \n     private void initializeLanguageDialog(PreferenceScreen screen) {\n         ListPreference languageSelection = (ListPreference) screen.findPreference(LANGUAGE);\n-        Locale currentAppLocale = LanguageUtil.getLocale(AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance())\n-                .getString(Preferences.LANGUAGE, \"\"));\n         if (languageSelection != null) {\n-            Map<String, String> items = new TreeMap<>();\n+            Map<String, List<String>> items = new TreeMap<>();\n             for (String localeCode : LanguageUtil.APP_LANGUAGES) {\n                 Locale loc = LanguageUtil.getLocale(localeCode);\n-                items.put(loc.getDisplayName(currentAppLocale), loc.toString());\n+                //TreeMap always sorted by key.\n+                //      Key is a String: all display names converted to lower case for correct display order.\n+                //      Value is list of 2 strings:\n+                //          1st element is display name with unmodified case\n+                //          2nd element is locale code\n+                items.put(loc.getDisplayName(loc).toLowerCase(), Arrays.asList(loc.getDisplayName(loc), loc.toString()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "785e30855054108a53fb2e539d93e4a2360d0ec8"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU4ODc4Nw==", "bodyText": "I think this will work, and will allow you to reduce complexity further down (as you'd be able to use the key as-is):\nnew TreeMap(String.CASE_INSENSITIVE_ORDER);", "url": "https://github.com/ankidroid/Anki-Android/pull/6267#discussion_r429588787", "createdAt": "2020-05-24T00:39:07Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -810,22 +810,25 @@ private String replaceStringIfNumeric(String str, String value) {\n \n     private void initializeLanguageDialog(PreferenceScreen screen) {\n         ListPreference languageSelection = (ListPreference) screen.findPreference(LANGUAGE);\n-        Locale currentAppLocale = LanguageUtil.getLocale(AnkiDroidApp.getSharedPrefs(AnkiDroidApp.getInstance())\n-                .getString(Preferences.LANGUAGE, \"\"));\n         if (languageSelection != null) {\n-            Map<String, String> items = new TreeMap<>();\n+            Map<String, List<String>> items = new TreeMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "785e30855054108a53fb2e539d93e4a2360d0ec8"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c06dcd3bb79c827c4874a92da449ae2b3c2b54bc", "author": {"user": {"login": "Arthus", "name": null}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c06dcd3bb79c827c4874a92da449ae2b3c2b54bc", "committedDate": "2020-05-24T01:21:16Z", "message": "even simpler solution for case insensitive sorting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzIyNDQ4", "url": "https://github.com/ankidroid/Anki-Android/pull/6267#pullrequestreview-417322448", "createdAt": "2020-05-24T02:36:29Z", "commit": {"oid": "c06dcd3bb79c827c4874a92da449ae2b3c2b54bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzUxMzM0", "url": "https://github.com/ankidroid/Anki-Android/pull/6267#pullrequestreview-417351334", "createdAt": "2020-05-24T11:53:28Z", "commit": {"oid": "c06dcd3bb79c827c4874a92da449ae2b3c2b54bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3329, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}