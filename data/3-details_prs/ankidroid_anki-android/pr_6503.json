{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2ODc2Nzcw", "number": 6503, "title": "Add volume buttons to gestures", "bodyText": "Purpose / Description\nThis commit adds the volume buttons to the gestures as discussed in #3021. Since this is unexpected behavior for most users, it's turned off by default. I realize buttons are not gestures, but it seemed like the most sensible place to put this, mainly because you can configure them for any action.\nPerhaps it makes sense to add more gestures using the volume buttons and maybe even the wakup/standby button. Things like double press and press and hold could allow for more actions to be used with hardware buttons.\nAn interesting continuation of this would also be to make the Reviewer work with the screen turned off and TTS as output. Useful on the go and for blind people. Maybe I'll look into that.\nApproach\nSimply added volume buttons to existing gestures. AbstractFlashcardViewer.dispatchKeyEvent then executes the assigned actions.\nHow Has This Been Tested?\n\nAdjust the settings (Settings > Gestures > Volume Up/Down)\nOpen deck\npress volume button\n\n(Only tested on an emulator)\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-06-19T04:08:06Z", "url": "https://github.com/ankidroid/Anki-Android/pull/6503", "merged": true, "mergeCommit": {"oid": "321ccd2a0f8771bc3bac42492776ee3534ba08af"}, "closed": true, "closedAt": "2020-06-25T21:05:01Z", "author": {"login": "tobrie"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuIXCSAFqTQzNTk3MDUxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuxmaNAFqTQzNzY4MjI4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1OTcwNTE3", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#pullrequestreview-435970517", "createdAt": "2020-06-23T16:50:06Z", "commit": {"oid": "27b2db09d62786eaf0cdd2d023cfe88b9c6e4b82"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNjo1MDowN1rOGnyA3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxNjo1MDowN1rOGnyA3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM2NzA2OA==", "bodyText": "This is a bit subtle for me.\nFirst can you do a test for ACTION_DOWN first and just return fast, that will clear that part out of the logic\nSecond, and you do a switch on keyCode for up, down, and default, that should cleanly separate the three cases of mGestureVolumeUp / mGestureVolumeDown / COMMAND_NOTHING without having ternary operators that might overwrite a value with itself (a concept that is a bit hard to follow)", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#discussion_r444367068", "createdAt": "2020-06-23T16:50:07Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1338,6 +1340,28 @@ protected void answerCard(int ease) {\n     }\n \n \n+    @Override\n+    public boolean dispatchKeyEvent(KeyEvent event) {\n+        int keyCode = event.getKeyCode();\n+\n+        if (event.getAction() == KeyEvent.ACTION_DOWN &&\n+                (keyCode == KeyEvent.KEYCODE_VOLUME_UP || keyCode == KeyEvent.KEYCODE_VOLUME_DOWN)) {\n+            int gesture = (keyCode == KeyEvent.KEYCODE_VOLUME_UP) ? mGestureVolumeUp : COMMAND_NOTHING;\n+            gesture = (keyCode == KeyEvent.KEYCODE_VOLUME_DOWN) ? mGestureVolumeDown : gesture;\n+\n+            // Execute command, but only consume event if action took place. We want the volume buttons to work normally otherwise.\n+            if (gesture != COMMAND_NOTHING) {\n+                executeCommand(gesture);\n+                return true;\n+            }\n+\n+            return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27b2db09d62786eaf0cdd2d023cfe88b9c6e4b82"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MDYwMzc4", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#pullrequestreview-436060378", "createdAt": "2020-06-23T18:46:26Z", "commit": {"oid": "d373ebdcea3a1ed06c0f8687ea850bdd62cfb892"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2Mjc5MzE5", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#pullrequestreview-436279319", "createdAt": "2020-06-24T02:18:32Z", "commit": {"oid": "41ea7aaffcf02f1fd78f9a207b5fe11c8444cfec"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMjoxODozMlrOGoAqBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQwMjoyNTowM1rOGoAw7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYwNjk4Mw==", "bodyText": "We should refactor this to take a ViewerCommandDef (not necessarily in this PR, but the meaning of the strings isn't clear)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        mGestureVolumeUp = Integer.parseInt(preferences.getString(\"gestureVolumeUp\", \"11\"));\n          \n          \n            \n                        mGestureVolumeUp = Integer.parseInt(preferences.getString(\"gestureVolumeUp\", \"0\"));", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#discussion_r444606983", "createdAt": "2020-06-24T02:18:32Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1677,6 +1705,8 @@ protected SharedPreferences restorePreferences() {\n             mGestureTapTop = Integer.parseInt(preferences.getString(\"gestureTapTop\", \"12\"));\n             mGestureTapBottom = Integer.parseInt(preferences.getString(\"gestureTapBottom\", \"2\"));\n             mGestureLongclick = Integer.parseInt(preferences.getString(\"gestureLongclick\", \"11\"));\n+            mGestureVolumeUp = Integer.parseInt(preferences.getString(\"gestureVolumeUp\", \"11\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ea7aaffcf02f1fd78f9a207b5fe11c8444cfec"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYwNzA2OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        mGestureVolumeDown = Integer.parseInt(preferences.getString(\"gestureVolumeDown\", \"11\"));\n          \n          \n            \n                        mGestureVolumeDown = Integer.parseInt(preferences.getString(\"gestureVolumeDown\", \"0\"));", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#discussion_r444607068", "createdAt": "2020-06-24T02:18:51Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1677,6 +1705,8 @@ protected SharedPreferences restorePreferences() {\n             mGestureTapTop = Integer.parseInt(preferences.getString(\"gestureTapTop\", \"12\"));\n             mGestureTapBottom = Integer.parseInt(preferences.getString(\"gestureTapBottom\", \"2\"));\n             mGestureLongclick = Integer.parseInt(preferences.getString(\"gestureLongclick\", \"11\"));\n+            mGestureVolumeUp = Integer.parseInt(preferences.getString(\"gestureVolumeUp\", \"11\"));\n+            mGestureVolumeDown = Integer.parseInt(preferences.getString(\"gestureVolumeDown\", \"11\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ea7aaffcf02f1fd78f9a207b5fe11c8444cfec"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDYwODc1MQ==", "bodyText": "nit: invert if to reduce nesting", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#discussion_r444608751", "createdAt": "2020-06-24T02:25:03Z", "author": {"login": "david-allison-1"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -1338,6 +1340,32 @@ protected void answerCard(int ease) {\n     }\n \n \n+    @Override\n+    public boolean dispatchKeyEvent(KeyEvent event) {\n+        if (event.getAction() == KeyEvent.ACTION_DOWN) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41ea7aaffcf02f1fd78f9a207b5fe11c8444cfec"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64e5e0e4bc6bb69338a23fb0cd27cc7a87c99038", "author": {"user": {"login": "tobrie", "name": null}}, "url": "https://github.com/ankidroid/Anki-Android/commit/64e5e0e4bc6bb69338a23fb0cd27cc7a87c99038", "committedDate": "2020-06-25T16:49:41Z", "message": "Add volume buttons to gestures\n\ncloses #3021"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NjgyMjg2", "url": "https://github.com/ankidroid/Anki-Android/pull/6503#pullrequestreview-437682286", "createdAt": "2020-06-25T16:53:54Z", "commit": {"oid": "64e5e0e4bc6bb69338a23fb0cd27cc7a87c99038"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3237, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}