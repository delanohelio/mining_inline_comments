{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1ODkxMjQw", "number": 7764, "title": "Add experimental support for dynamic import in Reviewer JS", "bodyText": "Purpose / Description\nThis PR should be seen with a grain of salt: I never worked with Android before, and my last Java experience is ten years back. So see this as a starting point :)\nThis PR addresses the issue, where the WebView in the reviewer can not load dynamic JavaScript modules via import(\"<nameofmodule>\"). This is a really useful pattern in modern JavaScript, because it allows for asynchronous execution.\nThis is currently not possible on AnkiDroid, because you cannot request modules via the file scheme.\nWith this PR, the user can use import('https://appassets.androidplatform.net/<nameofmodule>.js') to import modules from collection.media; and in fact even use fetch('https://appassets.androidplatform.net/<nameoffile>') to dynamically get files from the collection.media directory.\nThe prefix \"https://appassets.androidplatform.net\" comes from the custom implementation of WebViewAssetLoader. It seems like android reserves this URL particularly for this purpose. Having to use it is not really beautiful, but it's an OK compromise as I see it.\nFixes\n#7760\nApproach\nThis uses the WebViewAssetLoader class to enable special handling of the url \"https://appassets.androidplatform.net\"\nHow Has This Been Tested?\nNo test yet.\nLearning (optional, can help others)\nDocs for WebViewAssetLoader\nThis is how I came up with overriding PathLoader\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n[~] You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code\n UI changes: include screenshots of all affected screens (in particular showing any new or changed strings)", "createdAt": "2020-11-23T17:38:05Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7764", "merged": true, "mergeCommit": {"oid": "205322b15ce453b5b68382e051670ddf66da9b4f"}, "closed": true, "closedAt": "2020-12-20T18:49:47Z", "author": {"login": "hgiesel"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgxtQ4ABqjQwNDc1NDY4NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdoF8B7ABqjQxMzM1NzE2NTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "67d4bb24e1c72ac6a3030b102547ab438d002fef", "author": {"user": {"login": "hgiesel", "name": "Henrik Giesel"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/67d4bb24e1c72ac6a3030b102547ab438d002fef", "committedDate": "2020-11-23T17:14:21Z", "message": "Add experimental support for dynamic import in Reviewer JS"}, "afterCommit": {"oid": "6bc1bdee9a74c78092feb2c30a017cf7e892348f", "author": {"user": {"login": "hgiesel", "name": "Henrik Giesel"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6bc1bdee9a74c78092feb2c30a017cf7e892348f", "committedDate": "2020-11-28T01:17:14Z", "message": "Add experimental support for dynamic import in Reviewer JS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6bc1bdee9a74c78092feb2c30a017cf7e892348f", "author": {"user": {"login": "hgiesel", "name": "Henrik Giesel"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/6bc1bdee9a74c78092feb2c30a017cf7e892348f", "committedDate": "2020-11-28T01:17:14Z", "message": "Add experimental support for dynamic import in Reviewer JS"}, "afterCommit": {"oid": "d475376ac51d1b5213767fc5993295adc699bb1d", "author": {"user": {"login": "hgiesel", "name": "Henrik Giesel"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d475376ac51d1b5213767fc5993295adc699bb1d", "committedDate": "2020-12-01T14:05:04Z", "message": "Add experimental support for dynamic import in Reviewer JS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d475376ac51d1b5213767fc5993295adc699bb1d", "author": {"user": {"login": "hgiesel", "name": "Henrik Giesel"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/d475376ac51d1b5213767fc5993295adc699bb1d", "committedDate": "2020-12-01T14:05:04Z", "message": "Add experimental support for dynamic import in Reviewer JS"}, "afterCommit": {"oid": "079e40e56f770214929662d8dffca668979e6890", "author": {"user": {"login": "hgiesel", "name": "Henrik Giesel"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/079e40e56f770214929662d8dffca668979e6890", "committedDate": "2020-12-09T20:39:16Z", "message": "Add experimental support for dynamic import in Reviewer JS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "079e40e56f770214929662d8dffca668979e6890", "author": {"user": {"login": "hgiesel", "name": "Henrik Giesel"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/079e40e56f770214929662d8dffca668979e6890", "committedDate": "2020-12-09T20:39:16Z", "message": "Add experimental support for dynamic import in Reviewer JS"}, "afterCommit": {"oid": "8c79eef8edf9282cb4ba7a63b2b00c5a3b57f1f9", "author": {"user": {"login": "hgiesel", "name": "Henrik Giesel"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8c79eef8edf9282cb4ba7a63b2b00c5a3b57f1f9", "committedDate": "2020-12-13T14:54:45Z", "message": "Add experimental support for dynamic import in Reviewer JS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8c79eef8edf9282cb4ba7a63b2b00c5a3b57f1f9", "author": {"user": {"login": "hgiesel", "name": "Henrik Giesel"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/8c79eef8edf9282cb4ba7a63b2b00c5a3b57f1f9", "committedDate": "2020-12-13T14:54:45Z", "message": "Add experimental support for dynamic import in Reviewer JS"}, "afterCommit": {"oid": "4497213c3533bd443785838e19f7fa5545a36c6a", "author": {"user": {"login": "hgiesel", "name": "Henrik Giesel"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4497213c3533bd443785838e19f7fa5545a36c6a", "committedDate": "2020-12-20T00:57:52Z", "message": "Add experimental support for dynamic import in Reviewer JS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTgwMzA1", "url": "https://github.com/ankidroid/Anki-Android/pull/7764#pullrequestreview-555980305", "createdAt": "2020-12-20T01:58:37Z", "commit": {"oid": "4497213c3533bd443785838e19f7fa5545a36c6a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMFQwMTo1ODozN1rOII__-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMFQwMTo1ODozN1rOII__-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjMwODA4OA==", "bodyText": "https://developer.android.com/jetpack/androidx/releases/webkit\nindicates current stable is 1.4.0, why not use current stable?", "url": "https://github.com/ankidroid/Anki-Android/pull/7764#discussion_r546308088", "createdAt": "2020-12-20T01:58:37Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/build.gradle", "diffHunk": "@@ -235,6 +235,7 @@ dependencies {\n     // noinspection GradleDependency - pinned at 1.12 until API26 minSdkVersion (File.toPath usage)\n     implementation 'org.apache.commons:commons-compress:1.12' // #6419 - handle >2GB apkg files\n     implementation 'androidx.constraintlayout:constraintlayout:2.0.4'\n+    implementation 'androidx.webkit:webkit:1.2.0'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4497213c3533bd443785838e19f7fa5545a36c6a"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTgyMDk2", "url": "https://github.com/ankidroid/Anki-Android/pull/7764#pullrequestreview-555982096", "createdAt": "2020-12-20T02:56:27Z", "commit": {"oid": "4c5aa72a810293dc78709744c8f9963ef6b7f4ec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9345a5b16e9cdd4a77a8f8fe911a8c3e1ae291f5", "author": {"user": {"login": "hgiesel", "name": "Henrik Giesel"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/9345a5b16e9cdd4a77a8f8fe911a8c3e1ae291f5", "committedDate": "2020-12-20T18:39:24Z", "message": "Add experimental support for dynamic import in Reviewer JS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bd842fc1d8b78ad68ea8a4663ca1b4d4041bf6f", "author": {"user": {"login": "hgiesel", "name": "Henrik Giesel"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4bd842fc1d8b78ad68ea8a4663ca1b4d4041bf6f", "committedDate": "2020-12-20T18:39:24Z", "message": "Bump androidx.webkit to 1.4.0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c5aa72a810293dc78709744c8f9963ef6b7f4ec", "author": {"user": {"login": "hgiesel", "name": "Henrik Giesel"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4c5aa72a810293dc78709744c8f9963ef6b7f4ec", "committedDate": "2020-12-20T02:48:49Z", "message": "Bump androidx.webkit to 1.4.0"}, "afterCommit": {"oid": "4bd842fc1d8b78ad68ea8a4663ca1b4d4041bf6f", "author": {"user": {"login": "hgiesel", "name": "Henrik Giesel"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/4bd842fc1d8b78ad68ea8a4663ca1b4d4041bf6f", "committedDate": "2020-12-20T18:39:24Z", "message": "Bump androidx.webkit to 1.4.0"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3765, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}