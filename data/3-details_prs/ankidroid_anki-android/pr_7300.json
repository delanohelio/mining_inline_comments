{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0MjAwMTQ2", "number": 7300, "title": "Add Analytics event for failing Sanity Check", "bodyText": "Purpose / Description\nWe've had an uptick in users mentioning syncing errors, this is potentially one of the causes (where our scheduler does not match with the AnkiWeb scheduler)\nRelated\n#6207\nHow Has This Been Tested?\n\u26a0\ufe0f  On my device - I'm not sure if this \"Category\"/\"Action\" setup is correct, but it's similar to how we do other analytic events.\nChecklist\n\n You have not changed whitespace unnecessarily (it makes diffs hard to read)\n You have a descriptive commit message with a short title (first line, max 50 chars).\n Your code follows the style of the project (e.g. never omit braces in if statements)\n You have commented your code, particularly in hard-to-understand areas\n You have performed a self-review of your own code", "createdAt": "2020-09-28T14:43:24Z", "url": "https://github.com/ankidroid/Anki-Android/pull/7300", "merged": true, "mergeCommit": {"oid": "9cfd0803d5857fc54f3afd14d988bb7272f6fc89"}, "closed": true, "closedAt": "2020-09-29T13:13:31Z", "author": {"login": "david-allison-1"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNTJnagH2gAyNDk0MjAwMTQ2OjQ3ZTA2ODg2MmNhMjFiMzk4NTRjNmJlYjQ4YjlkZmU1N2Q4MThmOWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNn_CSAFqTQ5ODQ1Mjk3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "47e068862ca21b39854c6beb48b9dfe57d818f9e", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/47e068862ca21b39854c6beb48b9dfe57d818f9e", "committedDate": "2020-09-28T12:56:57Z", "message": "NF: Extract sanityCheckError\n\nTo be used in a later commit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NjI0MjQw", "url": "https://github.com/ankidroid/Anki-Android/pull/7300#pullrequestreview-497624240", "createdAt": "2020-09-28T15:03:59Z", "commit": {"oid": "b094e7f15dfa30bdd87c7aba8ea09f6c466e536f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTowMzo1OVrOHZCT9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNTowMzo1OVrOHZCT9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAxNDMyNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    UsageAnalytics.sendAnalyticsEvent(\"sanityCheckError\", \"Syncer\");\n          \n          \n            \n                    UsageAnalytics.sendAnalyticsEvent(UsageAnalytics.Categories.SYNCER, \"sanityCheckError\");\n          \n      \n    \n    \n  \n\n\n  \n    \n      Anki-Android/AnkiDroid/src/main/java/com/ichi2/anki/analytics/UsageAnalytics.java\n    \n    \n        Lines 230 to 240\n      in\n      d6de360\n    \n    \n    \n    \n\n        \n          \n               /** \n        \n\n        \n          \n                * Send a detailed arbitrary analytics event, with noun/verb pairs and extra data if needed \n        \n\n        \n          \n                * \n        \n\n        \n          \n                * @param category the category of event, make your own but use a constant so reporting is good \n        \n\n        \n          \n                * @param action   the action the user performed \n        \n\n        \n          \n                * @param value    A value for the event, Integer.MIN_VALUE signifies caller shouldn't send the value \n        \n\n        \n          \n                * @param label    A label for the event, may be null \n        \n\n        \n          \n                */ \n        \n\n        \n          \n               @SuppressWarnings(\"WeakerAccess\") \n        \n\n        \n          \n               public static void sendAnalyticsEvent(@NonNull String category, @NonNull String action, int value, String label) { \n        \n\n        \n          \n                   Timber.d(\"sendAnalyticsEvent() category/action/value/label: %s/%s/%s/%s\", category, action, value, label); \n        \n    \n  \n\n\nI'm referencing a \"dangling\" constant as nothing like that exists yet but I think the arguments are reversed (Syncer would/should be the category?) and constants will help make sure reports line up later by enforcing that the same strings are sent always", "url": "https://github.com/ankidroid/Anki-Android/pull/7300#discussion_r496014324", "createdAt": "2020-09-28T15:03:59Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/Syncer.java", "diffHunk": "@@ -265,12 +266,18 @@ private void trySetHostNum(JSONObject rMeta) {\n         }\n     }\n \n+    @NonNull\n+    protected Object[] sanityCheckError(JSONObject c, JSONObject sanity) {\n+        mCol.log(\"sanity check failed\", c, sanity);\n+        UsageAnalytics.sendAnalyticsEvent(\"sanityCheckError\", \"Syncer\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b094e7f15dfa30bdd87c7aba8ea09f6c466e536f"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b094e7f15dfa30bdd87c7aba8ea09f6c466e536f", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/b094e7f15dfa30bdd87c7aba8ea09f6c466e536f", "committedDate": "2020-09-28T14:40:52Z", "message": "DEV: Visual Feedback when dev analytics enabled\n\nI spent a bit of time figuring out:\n* Whether the button did anything\n* Why analytics weren't being sent\n\nThis will stop future me from making the same mistakes"}, "afterCommit": {"oid": "c435797620876be727b013f235de60644a21abca", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c435797620876be727b013f235de60644a21abca", "committedDate": "2020-09-28T16:47:40Z", "message": "DEV: Visual Feedback when dev analytics enabled\n\nI spent a bit of time figuring out:\n* Whether the button did anything\n* Why analytics weren't being sent\n\nThis will stop future me from making the same mistakes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c435797620876be727b013f235de60644a21abca", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/c435797620876be727b013f235de60644a21abca", "committedDate": "2020-09-28T16:47:40Z", "message": "DEV: Visual Feedback when dev analytics enabled\n\nI spent a bit of time figuring out:\n* Whether the button did anything\n* Why analytics weren't being sent\n\nThis will stop future me from making the same mistakes"}, "afterCommit": {"oid": "0556bfb32554b8b0c47fed548a2ce166aa053272", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0556bfb32554b8b0c47fed548a2ce166aa053272", "committedDate": "2020-09-28T16:53:29Z", "message": "DEV: Visual Feedback when dev analytics enabled\n\nI spent a bit of time figuring out:\n* Whether the button did anything\n* Why analytics weren't being sent\n\nThis will stop future me from making the same mistakes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NzQ1OTY2", "url": "https://github.com/ankidroid/Anki-Android/pull/7300#pullrequestreview-497745966", "createdAt": "2020-09-28T17:25:12Z", "commit": {"oid": "30d2588cd54de9074e5744a77b0765491e1ec6c3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNzoyNToxM1rOHZIe6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNzoyNToxM1rOHZIe6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjExNTQzMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    UsageAnalytics.sendAnalyticsEvent( UsageAnalytics.Category.SYNC, \"sanityCheckError\");\n          \n          \n            \n                    UsageAnalytics.sendAnalyticsEvent(UsageAnalytics.Category.SYNC, \"sanityCheckError\");", "url": "https://github.com/ankidroid/Anki-Android/pull/7300#discussion_r496115433", "createdAt": "2020-09-28T17:25:13Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/Syncer.java", "diffHunk": "@@ -268,6 +269,7 @@ private void trySetHostNum(JSONObject rMeta) {\n     @NonNull\n     protected Object[] sanityCheckError(JSONObject c, JSONObject sanity) {\n         mCol.log(\"sanity check failed\", c, sanity);\n+        UsageAnalytics.sendAnalyticsEvent( UsageAnalytics.Category.SYNC, \"sanityCheckError\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30d2588cd54de9074e5744a77b0765491e1ec6c3"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NzQ2Mjg0", "url": "https://github.com/ankidroid/Anki-Android/pull/7300#pullrequestreview-497746284", "createdAt": "2020-09-28T17:25:37Z", "commit": {"oid": "30d2588cd54de9074e5744a77b0765491e1ec6c3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNzoyNTozN1rOHZIfyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNzoyNTozN1rOHZIfyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjExNTY1Ng==", "bodyText": "Suggested change", "url": "https://github.com/ankidroid/Anki-Android/pull/7300#discussion_r496115656", "createdAt": "2020-09-28T17:25:37Z", "author": {"login": "mikehardy"}, "path": "AnkiDroid/src/main/java/com/ichi2/anki/analytics/UsageAnalytics.java", "diffHunk": "@@ -349,4 +349,10 @@ private DefaultRequest setAndroidRequestParameters(Context context) {\n             return this;\n         }\n     }\n+\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30d2588cd54de9074e5744a77b0765491e1ec6c3"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97afa02c9571deebc77f61d08dc6ebfa81649f2d", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/97afa02c9571deebc77f61d08dc6ebfa81649f2d", "committedDate": "2020-09-29T10:45:50Z", "message": "Add Sanity Check Failed Analytic Event\n\nThis should theoretically be 0, but it's useful to track regressions\n\nRelated: 6207"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78780999dbf62a3c986752a76502979ef7646c25", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/78780999dbf62a3c986752a76502979ef7646c25", "committedDate": "2020-09-29T10:46:04Z", "message": "DEV: Visual Feedback when dev analytics enabled\n\nI spent a bit of time figuring out:\n* Whether the button did anything\n* Why analytics weren't being sent\n\nThis will stop future me from making the same mistakes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0556bfb32554b8b0c47fed548a2ce166aa053272", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/0556bfb32554b8b0c47fed548a2ce166aa053272", "committedDate": "2020-09-28T16:53:29Z", "message": "DEV: Visual Feedback when dev analytics enabled\n\nI spent a bit of time figuring out:\n* Whether the button did anything\n* Why analytics weren't being sent\n\nThis will stop future me from making the same mistakes"}, "afterCommit": {"oid": "78780999dbf62a3c986752a76502979ef7646c25", "author": {"user": {"login": "david-allison-1", "name": "David Allison"}}, "url": "https://github.com/ankidroid/Anki-Android/commit/78780999dbf62a3c986752a76502979ef7646c25", "committedDate": "2020-09-29T10:46:04Z", "message": "DEV: Visual Feedback when dev analytics enabled\n\nI spent a bit of time figuring out:\n* Whether the button did anything\n* Why analytics weren't being sent\n\nThis will stop future me from making the same mistakes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NDUyOTcz", "url": "https://github.com/ankidroid/Anki-Android/pull/7300#pullrequestreview-498452973", "createdAt": "2020-09-29T13:13:24Z", "commit": {"oid": "78780999dbf62a3c986752a76502979ef7646c25"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3930, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}