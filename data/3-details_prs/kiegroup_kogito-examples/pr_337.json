{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NDEyOTk3", "number": 337, "title": "[KOGITO-2893] Update tests with new API changes", "bodyText": "Fix https://issues.redhat.com/browse/KOGITO-2893\nFollow up on kiegroup/kogito-runtimes#656", "createdAt": "2020-08-13T14:12:37Z", "url": "https://github.com/kiegroup/kogito-examples/pull/337", "merged": true, "mergeCommit": {"oid": "c7254e8c6555086acd6876bcd60d499f81a7ecf4"}, "closed": true, "closedAt": "2020-08-27T11:34:44Z", "author": {"login": "ruromero"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-hfH9gBqjM2NTI1Mzc3ODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC-v6iAFqTQ3NjYyNzk2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "14e41d38e5c7b08d76072f9b64bd545c6e14f04c", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/14e41d38e5c7b08d76072f9b64bd545c6e14f04c", "committedDate": "2020-08-13T14:12:10Z", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}, "afterCommit": {"oid": "a8a6020e7d5682b1927464fd303fe1e0796dfd63", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/a8a6020e7d5682b1927464fd303fe1e0796dfd63", "committedDate": "2020-08-13T15:10:02Z", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTc3MDkz", "url": "https://github.com/kiegroup/kogito-examples/pull/337#pullrequestreview-466977093", "createdAt": "2020-08-13T17:19:54Z", "commit": {"oid": "a8a6020e7d5682b1927464fd303fe1e0796dfd63"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNzoxOTo1NVrOHAVWIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNzozNjoxNlrOHAWRhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDExMTc3Ng==", "bodyText": "why it was expecting and error 500 before and now success?", "url": "https://github.com/kiegroup/kogito-examples/pull/337#discussion_r470111776", "createdAt": "2020-08-13T17:19:55Z", "author": {"login": "tiagodolphine"}, "path": "process-quarkus-example/src/test/java/org/kie/kogito/examples/OrdersRestIT.java", "diffHunk": "@@ -98,8 +138,16 @@ public void testOrdersWithErrorRest() {\n \n         // test adding new order\n         String addOrderPayload = \"{\\\"order\\\" : {\\\"orderNumber\\\" : \\\"12345\\\", \\\"shipped\\\" : false}}\";\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(addOrderPayload).when()\n-                .post(\"/orders\").then().statusCode(500).body(\"id\", notNullValue()).extract().path(\"id\");\n+        String firstCreatedId = given()\n+                .contentType(ContentType.JSON)\n+                .accept(ContentType.JSON)\n+                .body(addOrderPayload).when()\n+                .post(\"/orders\")\n+            .then()\n+                .statusCode(201)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8a6020e7d5682b1927464fd303fe1e0796dfd63"}, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEyNDYwNw==", "bodyText": "minor, since there is no way to check but shouldn't we keep the business key on the query param since it remains in this way?", "url": "https://github.com/kiegroup/kogito-examples/pull/337#discussion_r470124607", "createdAt": "2020-08-13T17:33:45Z", "author": {"login": "tiagodolphine"}, "path": "process-quarkus-example/src/test/java/org/kie/kogito/examples/OrdersRestIT.java", "diffHunk": "@@ -212,60 +264,41 @@ public void testOrdersWithOrderItemsAbortedRest() {\n         given().accept(ContentType.JSON).when().get(\"/orderItems\").then().statusCode(200)\n                 .body(\"$.size()\", is(0));\n     }\n-    \n-\n-    @Test\n-    public void testCreateAndGetOrderByBusinessKey() {\n-        String orderPayload = \"{\\\"approver\\\" : \\\"john\\\", \\\"order\\\" : {\\\"orderNumber\\\" : \\\"12345\\\", \\\"shipped\\\" : false}}\";\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders?businessKey=ORD-0001\").then().statusCode(200).body(\"id\",\n-                                                             notNullValue()).extract().path(\"id\");\n \n-        assertNotNull(firstCreatedId);\n-\n-        // get order by its business key and test\n-        given().accept(ContentType.JSON).body(orderPayload).when().get(\"/orders/ORD-0001\").then()\n-                .statusCode(200).body(\"id\",\n-                                      is(firstCreatedId));\n-        \n-        // test deleting order items by business key\n-        given().accept(ContentType.JSON).when().delete(\"/orders/ORD-0001\").then().statusCode(200);\n-        \n-        // get all orders make sure there is zero\n-        given().accept(ContentType.JSON).when().get(\"/orders\").then().statusCode(200)\n-                .body(\"$.size()\", is(0));\n-    }\n-    \n     @Test\n-    public void testCreateDuplicateOrders() {\n+    public void testCreateAndUpdateOrders() {\n         String orderPayload = \"{\\\"approver\\\" : \\\"john\\\", \\\"order\\\" : {\\\"orderNumber\\\" : \\\"12345\\\", \\\"shipped\\\" : false}}\";\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders?businessKey=ORD-0001\").then().statusCode(200).body(\"id\",\n+        String id = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n+                .post(\"/orders\").then().statusCode(201).body(\"id\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8a6020e7d5682b1927464fd303fe1e0796dfd63"}, "originalPosition": 207}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEyNjk4Mg==", "bodyText": "is it necessary to set the body on the get request?", "url": "https://github.com/kiegroup/kogito-examples/pull/337#discussion_r470126982", "createdAt": "2020-08-13T17:36:16Z", "author": {"login": "tiagodolphine"}, "path": "process-springboot-example/src/test/java/org/kie/kogito/examples/demo/OrdersRestIT.java", "diffHunk": "@@ -71,120 +71,131 @@ public void setUp() {\n     }\n \n     @Test\n-    public void testCreateNewOrder() {\n-        // create order\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders\").then().statusCode(200).body(\"id\",\n-                                                             notNullValue()).extract().path(\"id\");\n-\n-        assertNotNull(firstCreatedId);\n-    }\n-\n-    @Test\n-    public void testGetOrders() {\n-        // create two orders\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders\").then().statusCode(200).body(\"id\",\n-                                                             notNullValue()).extract().path(\"id\");\n+    public void testOrdersRest() {\n+        assertNotNull(orderProcess);\n \n-        assertNotNull(firstCreatedId);\n-\n-        String secondCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders\").then().statusCode(200).body(\"id\",\n-                                                             notNullValue()).extract().path(\"id\");\n-\n-        assertNotNull(secondCreatedId);\n+        // test adding new order\n+        String addOrderPayload = \"{\\\"approver\\\" : \\\"john\\\", \\\"order\\\" : {\\\"orderNumber\\\" : \\\"12345\\\", \\\"shipped\\\" : false}}\";\n+        String firstCreatedId = given()\n+                    .contentType(ContentType.JSON)\n+                    .accept(ContentType.JSON)\n+                    .body(addOrderPayload).when()\n+                    .post(\"/orders\")\n+                .then()\n+                    .statusCode(201)\n+                    .header(\"Location\", notNullValue())\n+                .extract().path(\"id\");\n \n-        // get all orders\n+        // test getting the created order\n         given().accept(ContentType.JSON).when().get(\"/orders\").then().statusCode(200)\n-                .body(\"$.size()\",\n-                      is(2));\n-    }\n-\n-    @Test\n-    public void testGetOrderById() {\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders\").then().statusCode(200).body(\"id\",\n-                                                             notNullValue()).extract().path(\"id\");\n-\n-        assertNotNull(firstCreatedId);\n-\n-        // get order by its id and test\n-        given().accept(ContentType.JSON).body(orderPayload).when().get(\"/orders/\" + firstCreatedId).then()\n-                .statusCode(200).body(\"id\",\n-                                      is(firstCreatedId));\n-    }\n-\n-    @Test\n-    public void testDeleteOrder() {\n-        // create two orders\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders\").then().statusCode(200).body(\"id\",\n-                                                             notNullValue()).extract().path(\"id\");\n-\n-        assertNotNull(firstCreatedId);\n-\n-        String secondCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders\").then().statusCode(200).body(\"id\",\n-                                                             notNullValue()).extract().path(\"id\");\n-\n-        assertNotNull(secondCreatedId);\n-\n-        // delete first order\n-        given().accept(ContentType.JSON).when().delete(\"/orders/\" + firstCreatedId).then().statusCode(200);\n+                .body(\"$.size()\", is(1), \"[0].id\", is(firstCreatedId));\n \n+        // test getting order by id\n+        given()\n+                .accept(ContentType.JSON)\n+            .when()\n+                .get(\"/orders/{id}\", firstCreatedId)\n+            .then()\n+                .statusCode(200)\n+                .body(\"id\", is(firstCreatedId));\n+\n+        // test delete order\n+        // first add second order...\n+        String secondCreatedId =\n+                given()\n+                    .contentType(ContentType.JSON)\n+                    .accept(ContentType.JSON)\n+                    .body(addOrderPayload)\n+                .when()\n+                    .post(\"/orders\")\n+                .then()\n+                    .statusCode(201)\n+                .extract()\n+                    .path(\"id\");\n+        // now delete the first order created\n+        given()\n+                .accept(ContentType.JSON)\n+            .when()\n+                .delete(\"/orders/{id}\", firstCreatedId)\n+            .then()\n+                .statusCode(200);\n         // get all orders make sure there is only one\n-        given().accept(ContentType.JSON).when().get(\"/orders\").then().statusCode(200)\n-                .body(\"$.size()\",\n-                      is(1),\n-                      \"[0].id\",\n-                      is(secondCreatedId));\n+        given()\n+                .accept(ContentType.JSON)\n+            .when()\n+                .get(\"/orders\")\n+            .then()\n+                .statusCode(200)\n+                .body(\"$.size()\", is(1), \"[0].id\", is(secondCreatedId));\n \n         // delete second before finishing\n-        given().accept(ContentType.JSON).when().delete(\"/orders/\" + secondCreatedId).then().statusCode(200);\n+        given()\n+                .accept(ContentType.JSON)\n+            .when()\n+                .delete(\"/orders/{id}\", secondCreatedId)\n+            .then()\n+                .statusCode(200);\n         // get all orders make sure there is zero\n-        given().accept(ContentType.JSON).when().get(\"/orders\").then().statusCode(200)\n-                .body(\"$.size()\",\n-                      is(0));\n+        given()\n+                .accept(ContentType.JSON)\n+            .when()\n+                .get(\"/orders\")\n+            .then()\n+                .statusCode(200)\n+                .body(\"$.size()\", is(0));\n     }\n \n     @Test\n     public void testOrdersWithErrorRest() {\n+        assertNotNull(orderProcess);\n \n         // test adding new order\n         String addOrderPayload = \"{\\\"order\\\" : {\\\"orderNumber\\\" : \\\"12345\\\", \\\"shipped\\\" : false}}\";\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(addOrderPayload).when()\n-                .post(\"/orders\").then().statusCode(500).body(\"id\", notNullValue()).extract().path(\"id\");\n+        String firstCreatedId = given()\n+                .contentType(ContentType.JSON)\n+                .accept(ContentType.JSON)\n+                .body(addOrderPayload).when()\n+                .post(\"/orders\")\n+            .then()\n+                .statusCode(201)\n+                .body(\"id\", notNullValue())\n+            .extract()\n+                .path(\"id\");\n \n         // test getting the created order\n         given().accept(ContentType.JSON).when().get(\"/orders\").then().statusCode(200)\n                 .body(\"$.size()\", is(1), \"[0].id\", is(firstCreatedId));\n \n         // test retrieving error info using process management addon\n         given().accept(ContentType.JSON).when().get(\"/management/processes/demo.orders/instances/\" + firstCreatedId + \"/error\").then()\n-                .statusCode(200).body(\"id\", is(firstCreatedId));\n+        .statusCode(200).body(\"id\", is(firstCreatedId));\n \n         String fixedOrderPayload = \"{\\\"approver\\\" : \\\"john\\\", \\\"order\\\" : {\\\"orderNumber\\\" : \\\"12345\\\", \\\"shipped\\\" : false}}\";\n-        given().contentType(ContentType.JSON).accept(ContentType.JSON).body(fixedOrderPayload).when().post(\"/orders/\" + firstCreatedId).then()\n-                .statusCode(200).body(\"id\", is(firstCreatedId));\n+        given().contentType(ContentType.JSON).accept(ContentType.JSON).body(fixedOrderPayload).when().put(\"/orders/\" + firstCreatedId).then()\n+        .statusCode(200)\n+                .body(\"id\", is(firstCreatedId))\n+                .body(\"approver\", equalTo(\"john\"))\n+                .body(\"order.orderNumber\", equalTo(\"12345\"))\n+                .body(\"order.shipped\", equalTo(false));\n \n         given().accept(ContentType.JSON).when().post(\"/management/processes/demo.orders/instances/\" + firstCreatedId + \"/retrigger\").then()\n-                .statusCode(200);\n+        .statusCode(200);\n \n         // delete second before finishing\n         given().accept(ContentType.JSON).when().delete(\"/orders/\" + firstCreatedId).then().statusCode(200);\n         // get all orders make sure there is zero\n-        given().accept(ContentType.JSON).when().get(\"/orders\").then().statusCode(200)\n+        given().accept(ContentType.JSON).body(addOrderPayload).when().get(\"/orders\").then().statusCode(200)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8a6020e7d5682b1927464fd303fe1e0796dfd63"}, "originalPosition": 207}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f4ad69f93633ff867203c1afbcbf3a71b55774dd", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/f4ad69f93633ff867203c1afbcbf3a71b55774dd", "committedDate": "2020-08-19T09:06:00Z", "message": "[KOGITO-2893] Remove body from get request\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}, "afterCommit": {"oid": "3dbe1399b89d3ff9b98d9cab775b88aa1bb4271b", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/3dbe1399b89d3ff9b98d9cab775b88aa1bb4271b", "committedDate": "2020-08-19T09:11:00Z", "message": "[KOGITO-2893] Remove body from get request\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3dbe1399b89d3ff9b98d9cab775b88aa1bb4271b", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/3dbe1399b89d3ff9b98d9cab775b88aa1bb4271b", "committedDate": "2020-08-19T09:11:00Z", "message": "[KOGITO-2893] Remove body from get request\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}, "afterCommit": {"oid": "7b71e56482cb732f6de3d6846a9d9b42f484a202", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/7b71e56482cb732f6de3d6846a9d9b42f484a202", "committedDate": "2020-08-19T09:23:01Z", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b71e56482cb732f6de3d6846a9d9b42f484a202", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/7b71e56482cb732f6de3d6846a9d9b42f484a202", "committedDate": "2020-08-19T09:23:01Z", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}, "afterCommit": {"oid": "d2f29e90ededcdbb2474f541b9d0abadc502a255", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/d2f29e90ededcdbb2474f541b9d0abadc502a255", "committedDate": "2020-08-24T10:50:43Z", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d2f29e90ededcdbb2474f541b9d0abadc502a255", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/d2f29e90ededcdbb2474f541b9d0abadc502a255", "committedDate": "2020-08-24T10:50:43Z", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}, "afterCommit": {"oid": "ed89a338ed7660bdb0d2ab8d0001c146dcb140e8", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/ed89a338ed7660bdb0d2ab8d0001c146dcb140e8", "committedDate": "2020-08-24T16:51:25Z", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2f77143e76e665d29e47715ff65a63496a19603", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/f2f77143e76e665d29e47715ff65a63496a19603", "committedDate": "2020-08-25T09:44:20Z", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed89a338ed7660bdb0d2ab8d0001c146dcb140e8", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/ed89a338ed7660bdb0d2ab8d0001c146dcb140e8", "committedDate": "2020-08-24T16:51:25Z", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}, "afterCommit": {"oid": "f2f77143e76e665d29e47715ff65a63496a19603", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/f2f77143e76e665d29e47715ff65a63496a19603", "committedDate": "2020-08-25T09:44:20Z", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbf8e1ba0bd8e7f60d33b4931c625799184be938", "author": {"user": {"login": "ruromero", "name": "Ruben Romero Montes"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/fbf8e1ba0bd8e7f60d33b4931c625799184be938", "committedDate": "2020-08-25T14:50:24Z", "message": "[KOGITO-2893] Update missing references in the README\n\nSigned-off-by: ruromero <rromerom@redhat.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2Mjg3Nzcw", "url": "https://github.com/kiegroup/kogito-examples/pull/337#pullrequestreview-476287770", "createdAt": "2020-08-27T01:13:14Z", "commit": {"oid": "fbf8e1ba0bd8e7f60d33b4931c625799184be938"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NjI3OTYx", "url": "https://github.com/kiegroup/kogito-examples/pull/337#pullrequestreview-476627961", "createdAt": "2020-08-27T11:31:32Z", "commit": {"oid": "fbf8e1ba0bd8e7f60d33b4931c625799184be938"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4337, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}