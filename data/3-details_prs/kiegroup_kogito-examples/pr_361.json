{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MTU0NzU3", "number": 361, "title": "KOGITO-3217 - trusty demonstration project", "bodyText": "https://issues.redhat.com/browse/KOGITO-3217\nThis PR\n\ngenerates an uber jar for the dmn-tracing-quarkus artifact\nadds the trusty demontration project that shows how to deploy the trusty infrastructure with the kogito operator\n\nMany thanks for submitting your Pull Request \u2764\ufe0f!\nPlease make sure that your PR meets the following requirements:\nWARNING! Please make sure you are opening your PR against master branch!\n\n You have read the contributors guide\n Pull Request title is properly formatted: KOGITO-XYZ Subject\n Pull Request title contains the target branch if not targeting master: [0.9.x] KOGITO-XYZ Subject\n Pull Request contains link to the JIRA issue\n Pull Request contains link to any dependent or related Pull Request\n Pull Request contains description of the issue\n Pull Request does not include fixes for issues other than the main ticket", "createdAt": "2020-09-15T09:14:06Z", "url": "https://github.com/kiegroup/kogito-examples/pull/361", "merged": true, "mergeCommit": {"oid": "079906b16520e17e0d79a6c5b28ce2976a70e2aa"}, "closed": true, "closedAt": "2020-09-30T12:50:42Z", "author": {"login": "r00ta"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJEHxoAH2gAyNDg3MTU0NzU3OmQ0N2M5NDhmY2QwNjBkZGRhOTViN2M0NDQwYjc5NDk4YjU4ZjFhMTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdN8E1TAFqTQ5OTM4MjU1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d47c948fcd060ddda95b7c4440b79498b58f1a17", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/d47c948fcd060ddda95b7c4440b79498b58f1a17", "committedDate": "2020-09-15T09:10:40Z", "message": "dmn-tracing-quarkus uber jar, add trusty demontration project"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c753678ac502db8c1aa792b8e232aa69024bb132", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/c753678ac502db8c1aa792b8e232aa69024bb132", "committedDate": "2020-09-15T09:31:43Z", "message": "add requirements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4OTc4MTgy", "url": "https://github.com/kiegroup/kogito-examples/pull/361#pullrequestreview-488978182", "createdAt": "2020-09-15T18:57:53Z", "commit": {"oid": "c753678ac502db8c1aa792b8e232aa69024bb132"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxODo1Nzo1M1rOHSP5LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOToxMzoyN1rOHSQcvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg5NjgxMw==", "bodyText": "What about add this COPY layer too?\nhttps://github.com/kiegroup/kogito-examples/blob/stable/dmn-drools-quarkus-metrics/Dockerfile#L25\nIt should make uberJar flag optional", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r488896813", "createdAt": "2020-09-15T18:57:53Z", "author": {"login": "danielezonca"}, "path": "dmn-tracing-quarkus/Dockerfile", "diffHunk": "@@ -0,0 +1,3 @@\n+FROM quay.io/kiegroup/kogito-quarkus-jvm-ubi8:latest\n+\n+COPY target/*-runner.jar $KOGITO_HOME/bin    ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c753678ac502db8c1aa792b8e232aa69024bb132"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg5NzA1Mg==", "bodyText": "See comment above", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r488897052", "createdAt": "2020-09-15T18:58:08Z", "author": {"login": "danielezonca"}, "path": "dmn-tracing-quarkus/pom.xml", "diffHunk": "@@ -76,9 +76,12 @@\n   <build>\n     <finalName>${project.artifactId}</finalName>\n     <plugins>\n-      <plugin>\n+     <plugin>\n         <groupId>io.quarkus</groupId>\n         <artifactId>quarkus-maven-plugin</artifactId>\n+        <configuration>\n+          <uberJar>true</uberJar>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c753678ac502db8c1aa792b8e232aa69024bb132"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg5Nzc1Ng==", "bodyText": "Awesome? xD", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r488897756", "createdAt": "2020-09-15T18:58:48Z", "author": {"login": "danielezonca"}, "path": "trusty-demonstration/README.md", "diffHunk": "@@ -0,0 +1,212 @@\n+# Awesome Trusty", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c753678ac502db8c1aa792b8e232aa69024bb132"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwMDM5MA==", "bodyText": "Please change hardcoded version with a placeholder and refer to https://kogito.kie.org or similar to get the latest version.", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r488900390", "createdAt": "2020-09-15T19:03:15Z", "author": {"login": "danielezonca"}, "path": "trusty-demonstration/README.md", "diffHunk": "@@ -0,0 +1,212 @@\n+# Awesome Trusty\n+\n+This is a demonstration of the trusty AI tracing capabilities. \n+\n+## Requirements\n+\n+- docker version > 19.03.12\n+- minikube version  > 1.11.0\n+- java version > 1.9\n+- maven version > 3.6.3\n+- kubernetes version > 1.18\n+\n+Note: also previous versions of `docker`, `minikube` and `kubernetes`  might work, but they were not tested. \n+\n+## Build your kogito runtime application\n+\n+In this example, we will use the `dmn-tracing-quarkus` application that you can find in the root of this repository. This kogito application is using the `tracing-addon` so to export the tracing information that will be used by the trusty and explainability services for further analysis.\n+\n+Navigate under the folder `kogito-examples/dmn-tracing-quarkus` and run \n+```bash\n+mvn clean package -DskipTests\n+```\n+\n+Now you need to have an account on a remote hub like `quay` or `dockerhub` for example. Assuming that you have an account on `quay` and you are using `docker`, build the image with \n+```bash\n+docker build --tag quay.io/<your_namespace>/dmn-tracing-quarkus:1.0.0 .\n+```\n+replacing the string `<your_namespace>` with your namespace (i.e. your username).\n+\n+Push the image\n+```bash\n+docker push quay.io/<your_namespace>/dmn-tracing-quarkus:1.0.0\n+```\n+\n+## Deploy the infrastructure with minishift/kubernetes\n+\n+Navigate back to the current directory where this `README.md` file is stored. \n+\n+The first step is to start your `minikube` cluster: \n+\n+```bash\n+minikube start\n+minikube addons enable ingress\n+minikube addons enable olm\n+```\n+\n+and then download/unpack the kogito operator\n+\n+```bash\n+wget https://github.com/kiegroup/kogito-cloud-operator/releases/download/v0.15.0/kogito-cli-0.15.0-linux-amd64.tar.gz\n+tar zxf kogito-cli-0.14.0-linux-amd64.tar.gz", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c753678ac502db8c1aa792b8e232aa69024bb132"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwMDk4NQ==", "bodyText": "Replace 0.17.0 hardcoded version", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r488900985", "createdAt": "2020-09-15T19:04:22Z", "author": {"login": "danielezonca"}, "path": "trusty-demonstration/README.md", "diffHunk": "@@ -0,0 +1,212 @@\n+# Awesome Trusty\n+\n+This is a demonstration of the trusty AI tracing capabilities. \n+\n+## Requirements\n+\n+- docker version > 19.03.12\n+- minikube version  > 1.11.0\n+- java version > 1.9\n+- maven version > 3.6.3\n+- kubernetes version > 1.18\n+\n+Note: also previous versions of `docker`, `minikube` and `kubernetes`  might work, but they were not tested. \n+\n+## Build your kogito runtime application\n+\n+In this example, we will use the `dmn-tracing-quarkus` application that you can find in the root of this repository. This kogito application is using the `tracing-addon` so to export the tracing information that will be used by the trusty and explainability services for further analysis.\n+\n+Navigate under the folder `kogito-examples/dmn-tracing-quarkus` and run \n+```bash\n+mvn clean package -DskipTests\n+```\n+\n+Now you need to have an account on a remote hub like `quay` or `dockerhub` for example. Assuming that you have an account on `quay` and you are using `docker`, build the image with \n+```bash\n+docker build --tag quay.io/<your_namespace>/dmn-tracing-quarkus:1.0.0 .\n+```\n+replacing the string `<your_namespace>` with your namespace (i.e. your username).\n+\n+Push the image\n+```bash\n+docker push quay.io/<your_namespace>/dmn-tracing-quarkus:1.0.0\n+```\n+\n+## Deploy the infrastructure with minishift/kubernetes\n+\n+Navigate back to the current directory where this `README.md` file is stored. \n+\n+The first step is to start your `minikube` cluster: \n+\n+```bash\n+minikube start\n+minikube addons enable ingress\n+minikube addons enable olm\n+```\n+\n+and then download/unpack the kogito operator\n+\n+```bash\n+wget https://github.com/kiegroup/kogito-cloud-operator/releases/download/v0.15.0/kogito-cli-0.15.0-linux-amd64.tar.gz\n+tar zxf kogito-cli-0.14.0-linux-amd64.tar.gz\n+```\n+\n+Create a new project called (for example) `trusty-demo` \n+\n+```bash \n+PROJECT_NAME=trusty-demo\n+kubectl create namespace \"$PROJECT_NAME\"\n+```\n+\n+Deploy the kogito operator\n+```bash\n+./kogito use-project \"$PROJECT_NAME\"\n+```\n+\n+You should see that the `kogito-operator` has one pod running within some minutes: the command `kubectl get pods -n \"trusty-demo\"` should return something like \n+\n+```bash\n+NAME                             READY   STATUS    RESTARTS   AGE\n+kogito-operator-9f575f64-zp56t   1/1     Running   0          98s\n+```\n+\n+Install the `kafka` and the `infinispan` operators with \n+\n+```bash\n+TARGET_DIR=\".\"\n+STRIMZI_VERSION=0.17.0\n+INFINISPAN_VERSION=1.1.1.Final\n+\n+echo \"Installing Infinispan Operator\"\n+kubectl apply -f \"https://raw.githubusercontent.com/infinispan/infinispan-operator/${INFINISPAN_VERSION}/deploy/crd.yaml\" -n ${PROJECT_NAME}\n+kubectl apply -f \"https://raw.githubusercontent.com/infinispan/infinispan-operator/${INFINISPAN_VERSION}/deploy/rbac.yaml\" -n ${PROJECT_NAME}\n+kubectl apply -f \"https://raw.githubusercontent.com/infinispan/infinispan-operator/${INFINISPAN_VERSION}/deploy/operator.yaml\" -n ${PROJECT_NAME}\n+\n+wget \"https://github.com/strimzi/strimzi-kafka-operator/releases/download/${STRIMZI_VERSION}/strimzi-${STRIMZI_VERSION}.tar.gz\" -P \"$TARGET_DIR/\"\n+tar zxf \"${TARGET_DIR}/strimzi-${STRIMZI_VERSION}.tar.gz\" -C \"$TARGET_DIR\"\n+find strimzi-0.17.0/install/cluster-operator -name '*RoleBinding*.yaml' -type f -exec sed -i \"s/namespace: .*/namespace: ${PROJECT_NAME}/\" {} \\;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c753678ac502db8c1aa792b8e232aa69024bb132"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwNTkxOA==", "bodyText": "Which IP? My local env IP? Why don't suggest localhost if user is going to run everything locally specifying to change it if needed?\nAre both envs variables equivalent? Is it possible to have them differently?", "url": "https://github.com/kiegroup/kogito-examples/pull/361#discussion_r488905918", "createdAt": "2020-09-15T19:13:27Z", "author": {"login": "danielezonca"}, "path": "trusty-demonstration/README.md", "diffHunk": "@@ -0,0 +1,212 @@\n+# Awesome Trusty\n+\n+This is a demonstration of the trusty AI tracing capabilities. \n+\n+## Requirements\n+\n+- docker version > 19.03.12\n+- minikube version  > 1.11.0\n+- java version > 1.9\n+- maven version > 3.6.3\n+- kubernetes version > 1.18\n+\n+Note: also previous versions of `docker`, `minikube` and `kubernetes`  might work, but they were not tested. \n+\n+## Build your kogito runtime application\n+\n+In this example, we will use the `dmn-tracing-quarkus` application that you can find in the root of this repository. This kogito application is using the `tracing-addon` so to export the tracing information that will be used by the trusty and explainability services for further analysis.\n+\n+Navigate under the folder `kogito-examples/dmn-tracing-quarkus` and run \n+```bash\n+mvn clean package -DskipTests\n+```\n+\n+Now you need to have an account on a remote hub like `quay` or `dockerhub` for example. Assuming that you have an account on `quay` and you are using `docker`, build the image with \n+```bash\n+docker build --tag quay.io/<your_namespace>/dmn-tracing-quarkus:1.0.0 .\n+```\n+replacing the string `<your_namespace>` with your namespace (i.e. your username).\n+\n+Push the image\n+```bash\n+docker push quay.io/<your_namespace>/dmn-tracing-quarkus:1.0.0\n+```\n+\n+## Deploy the infrastructure with minishift/kubernetes\n+\n+Navigate back to the current directory where this `README.md` file is stored. \n+\n+The first step is to start your `minikube` cluster: \n+\n+```bash\n+minikube start\n+minikube addons enable ingress\n+minikube addons enable olm\n+```\n+\n+and then download/unpack the kogito operator\n+\n+```bash\n+wget https://github.com/kiegroup/kogito-cloud-operator/releases/download/v0.15.0/kogito-cli-0.15.0-linux-amd64.tar.gz\n+tar zxf kogito-cli-0.14.0-linux-amd64.tar.gz\n+```\n+\n+Create a new project called (for example) `trusty-demo` \n+\n+```bash \n+PROJECT_NAME=trusty-demo\n+kubectl create namespace \"$PROJECT_NAME\"\n+```\n+\n+Deploy the kogito operator\n+```bash\n+./kogito use-project \"$PROJECT_NAME\"\n+```\n+\n+You should see that the `kogito-operator` has one pod running within some minutes: the command `kubectl get pods -n \"trusty-demo\"` should return something like \n+\n+```bash\n+NAME                             READY   STATUS    RESTARTS   AGE\n+kogito-operator-9f575f64-zp56t   1/1     Running   0          98s\n+```\n+\n+Install the `kafka` and the `infinispan` operators with \n+\n+```bash\n+TARGET_DIR=\".\"\n+STRIMZI_VERSION=0.17.0\n+INFINISPAN_VERSION=1.1.1.Final\n+\n+echo \"Installing Infinispan Operator\"\n+kubectl apply -f \"https://raw.githubusercontent.com/infinispan/infinispan-operator/${INFINISPAN_VERSION}/deploy/crd.yaml\" -n ${PROJECT_NAME}\n+kubectl apply -f \"https://raw.githubusercontent.com/infinispan/infinispan-operator/${INFINISPAN_VERSION}/deploy/rbac.yaml\" -n ${PROJECT_NAME}\n+kubectl apply -f \"https://raw.githubusercontent.com/infinispan/infinispan-operator/${INFINISPAN_VERSION}/deploy/operator.yaml\" -n ${PROJECT_NAME}\n+\n+wget \"https://github.com/strimzi/strimzi-kafka-operator/releases/download/${STRIMZI_VERSION}/strimzi-${STRIMZI_VERSION}.tar.gz\" -P \"$TARGET_DIR/\"\n+tar zxf \"${TARGET_DIR}/strimzi-${STRIMZI_VERSION}.tar.gz\" -C \"$TARGET_DIR\"\n+find strimzi-0.17.0/install/cluster-operator -name '*RoleBinding*.yaml' -type f -exec sed -i \"s/namespace: .*/namespace: ${PROJECT_NAME}/\" {} \\;\n+kubectl apply -f strimzi-${STRIMZI_VERSION}/install/cluster-operator/ -n ${PROJECT_NAME}\n+```\n+\n+Deploy a kafka instance and wait for it\n+```bash\n+kubectl apply -f resources/kafka.yaml -n ${PROJECT_NAME}\n+kubectl wait kafka/my-cluster --for=condition=Ready --timeout=300s -n ${PROJECT_NAME} \n+```\n+\n+Create the kafka topics\n+```bash\n+kubectl apply -f resources/kafka-topics.yaml -n ${PROJECT_NAME}\n+```\n+\n+and the infinispan resource\n+```bash\n+kubectl apply -f resources/infinispan-minimal.yaml -n ${PROJECT_NAME}\n+```\n+\n+Now extract the infinispan secrets with \n+```bash\n+kubectl get secret example-infinispan-generated-secret -o jsonpath=\"{.data.identities\\.yaml}\" -n ${PROJECT_NAME} | base64 --decode\n+```\n+\n+Take the `operator` name and password and calculate the `base64` encoding, and replace the keys `user` and `pass` in `resources/trusty-secrets.yaml` with the encoding. For example, if `operator` is the username and `mysecretpassword` is the password, then \n+```bash\n+$ printf \"operator\" | base64\n+b3BlcmF0b3I=\n+printf \"mysecretpassword\" | base64\n+bXlzZWNyZXRwYXNzd29yZA==\n+```\n+\n+and the content of `resources/trusty-secrets.yaml` should look like the following\n+```yaml\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  name: kogito-external-infinispan-secret\n+type: Opaque\n+data:\n+  user: b3BlcmF0b3I= \n+  pass: bXlzZWNyZXRwYXNzd29yZA==\n+```\n+\n+Deploy the secret with \n+\n+```bash\n+kubectl apply -f resources/trusty-secrets.yaml -n ${PROJECT_NAME}\n+```\n+\n+Get the ip address of the cluster with \n+```bash\n+minikube ip\n+```\n+\n+and replace the env variables `KOGITO_TRUSTY_ENDPOINT` and `KOGITO_TRUSTY_WS_URL` in the file `resources/trusty-ui.yaml`. For example, if the ip is `172.17.0.2`, then the content of the file should be ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c753678ac502db8c1aa792b8e232aa69024bb132"}, "originalPosition": 143}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fe6c52240ed25f40bcd3493aef631727c3c49e9", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/7fe6c52240ed25f40bcd3493aef631727c3c49e9", "committedDate": "2020-09-16T15:46:10Z", "message": "fix comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf8273fdc6ef4d9430195de261cd8f0f8610d958", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/cf8273fdc6ef4d9430195de261cd8f0f8610d958", "committedDate": "2020-09-18T14:00:48Z", "message": "update images"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a01cce57ea8f66ca3df490c9dce6b8cb0a101a6a", "author": {"user": {"login": "r00ta", "name": "Jacopo Rota"}}, "url": "https://github.com/kiegroup/kogito-examples/commit/a01cce57ea8f66ca3df490c9dce6b8cb0a101a6a", "committedDate": "2020-09-18T14:22:38Z", "message": "add images"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNzc5ODIy", "url": "https://github.com/kiegroup/kogito-examples/pull/361#pullrequestreview-491779822", "createdAt": "2020-09-18T21:03:30Z", "commit": {"oid": "a01cce57ea8f66ca3df490c9dce6b8cb0a101a6a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyMzQzOTI4", "url": "https://github.com/kiegroup/kogito-examples/pull/361#pullrequestreview-492343928", "createdAt": "2020-09-21T07:42:50Z", "commit": {"oid": "a01cce57ea8f66ca3df490c9dce6b8cb0a101a6a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MzgyNTU5", "url": "https://github.com/kiegroup/kogito-examples/pull/361#pullrequestreview-499382559", "createdAt": "2020-09-30T12:37:51Z", "commit": {"oid": "a01cce57ea8f66ca3df490c9dce6b8cb0a101a6a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4356, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}