{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MDI1MjY3", "number": 215, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOToxNTo0MVrOEGe9bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOToyMDozMVrOEGfC_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjM0MTU5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOToxNTo0MVrOGlT5ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMTowNDowMVrOGnQ72A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NjUyMg==", "bodyText": "@paulodamaso I would move null checks to check method to make it more readable or add another method validParams that would check against null. wdyt?", "url": "https://github.com/artipie/artipie/pull/215#discussion_r441776522", "createdAt": "2020-06-17T19:15:41Z", "author": {"login": "Vatavuk"}, "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -66,7 +59,8 @@ public AuthFromYaml(final YamlMapping cred) {\n         Optional<String> res = Optional.empty();\n         if (users != null && users.yamlMapping(user) != null) {\n             final String stored = users.yamlMapping(user).string(\"pass\");\n-            if (stored != null && check(stored, pass)) {\n+            final String type = users.yamlMapping(user).string(\"type\");\n+            if (stored != null && type != null && check(stored, type, pass)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc3NjgyMA==", "bodyText": "@Vatavuk I don't think it's a good idea, here's why:\n\nvalidParams wouldn't mean nothing here, since stored and type are not login parameters, they are data stored into Yaml file instead: if they are null, means that we don't have these field for the current user;\ncheck method just checks if the two values match plainly or digested, so I don't think that we should move these tests inside this method", "url": "https://github.com/artipie/artipie/pull/215#discussion_r443776820", "createdAt": "2020-06-22T19:25:41Z", "author": {"login": "paulodamaso"}, "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -66,7 +59,8 @@ public AuthFromYaml(final YamlMapping cred) {\n         Optional<String> res = Optional.empty();\n         if (users != null && users.yamlMapping(user) != null) {\n             final String stored = users.yamlMapping(user).string(\"pass\");\n-            if (stored != null && check(stored, pass)) {\n+            final String type = users.yamlMapping(user).string(\"type\");\n+            if (stored != null && type != null && check(stored, type, pass)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NjUyMg=="}, "originalCommit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgyNTExMg==", "bodyText": "@paulodamaso ok", "url": "https://github.com/artipie/artipie/pull/215#discussion_r443825112", "createdAt": "2020-06-22T21:04:01Z", "author": {"login": "Vatavuk"}, "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -66,7 +59,8 @@ public AuthFromYaml(final YamlMapping cred) {\n         Optional<String> res = Optional.empty();\n         if (users != null && users.yamlMapping(user) != null) {\n             final String stored = users.yamlMapping(user).string(\"pass\");\n-            if (stored != null && check(stored, pass)) {\n+            final String type = users.yamlMapping(user).string(\"type\");\n+            if (stored != null && type != null && check(stored, type, pass)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NjUyMg=="}, "originalCommit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjM0NzcxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOToxNzo0NFrOGlT9rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxOToyMDoxN1rOGnN1Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NzU4Mg==", "bodyText": "@paulodamaso I believe variable name pass instead of stored would be more appropriate.", "url": "https://github.com/artipie/artipie/pull/215#discussion_r441777582", "createdAt": "2020-06-17T19:17:44Z", "author": {"login": "Vatavuk"}, "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -66,7 +59,8 @@ public AuthFromYaml(final YamlMapping cred) {\n         Optional<String> res = Optional.empty();\n         if (users != null && users.yamlMapping(user) != null) {\n             final String stored = users.yamlMapping(user).string(\"pass\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc3NDI1NQ==", "bodyText": "@Vatavuk I'm already using pass for the password value sent from user. I'm using the name stored because it represents the value which is stored in our Yaml file.", "url": "https://github.com/artipie/artipie/pull/215#discussion_r443774255", "createdAt": "2020-06-22T19:20:17Z", "author": {"login": "paulodamaso"}, "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -66,7 +59,8 @@ public AuthFromYaml(final YamlMapping cred) {\n         Optional<String> res = Optional.empty();\n         if (users != null && users.yamlMapping(user) != null) {\n             final String stored = users.yamlMapping(user).string(\"pass\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NzU4Mg=="}, "originalCommit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjM1NTgyOnYy", "diffSide": "RIGHT", "path": "src/test/java/com/artipie/auth/AuthFromYamlTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOToyMDozMVrOGlUC-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxOToyNzoxNFrOGnOB7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3ODkzOA==", "bodyText": "@paulodamaso where is login used? I believe its redundant", "url": "https://github.com/artipie/artipie/pull/215#discussion_r441778938", "createdAt": "2020-06-17T19:20:31Z", "author": {"login": "Vatavuk"}, "path": "src/test/java/com/artipie/auth/AuthFromYamlTest.java", "diffHunk": "@@ -136,32 +140,46 @@ void doesNotAuthoriseByMainLogin() {\n     /**\n      * Composes yaml settings.\n      * @param user User\n+     * @param type Password type\n      * @param pass Password\n      * @return Settings\n      */\n-    private static YamlMapping settings(final String user, final String pass) {\n+    private static YamlMapping settings(\n+        final String user,\n+        final String type,\n+        final String pass) {\n         return Yaml.createYamlMappingBuilder().add(\n             \"credentials\",\n             Yaml.createYamlMappingBuilder()\n-                .add(user, Yaml.createYamlMappingBuilder().add(\"pass\", pass).build())\n-                .build()\n+                .add(\n+                    user,\n+                    Yaml.createYamlMappingBuilder()\n+                    .add(\"type\", type)\n+                    .add(\"pass\", pass).build()\n+                ).build()\n         ).build();\n     }\n \n     /**\n      * Composes yaml settings.\n      * @param user User\n+     * @param type Password type\n      * @param pass Password\n      * @param login Alternative login\n      * @return Settings\n+     * @checkstyle ParameterNumberCheck (3 lines)\n      */\n-    private static YamlMapping settings(final String user, final String pass, final String login) {\n+    private static YamlMapping settings(final String user, final String type, final String pass,\n+        final String login) {\n         return Yaml.createYamlMappingBuilder().add(\n             \"credentials\",\n             Yaml.createYamlMappingBuilder()\n                 .add(\n                     user,\n-                    Yaml.createYamlMappingBuilder().add(\"pass\", pass).add(\"login\", login).build()\n+                    Yaml.createYamlMappingBuilder()\n+                    .add(\"type\", type)\n+                    .add(\"pass\", pass)\n+                    .add(\"login\", login).build()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "originalPosition": 147}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc3NzUxOQ==", "bodyText": "@Vatavuk login will be used to provide an alternative login (there is a puzzle in AuthFromYaml)", "url": "https://github.com/artipie/artipie/pull/215#discussion_r443777519", "createdAt": "2020-06-22T19:27:14Z", "author": {"login": "paulodamaso"}, "path": "src/test/java/com/artipie/auth/AuthFromYamlTest.java", "diffHunk": "@@ -136,32 +140,46 @@ void doesNotAuthoriseByMainLogin() {\n     /**\n      * Composes yaml settings.\n      * @param user User\n+     * @param type Password type\n      * @param pass Password\n      * @return Settings\n      */\n-    private static YamlMapping settings(final String user, final String pass) {\n+    private static YamlMapping settings(\n+        final String user,\n+        final String type,\n+        final String pass) {\n         return Yaml.createYamlMappingBuilder().add(\n             \"credentials\",\n             Yaml.createYamlMappingBuilder()\n-                .add(user, Yaml.createYamlMappingBuilder().add(\"pass\", pass).build())\n-                .build()\n+                .add(\n+                    user,\n+                    Yaml.createYamlMappingBuilder()\n+                    .add(\"type\", type)\n+                    .add(\"pass\", pass).build()\n+                ).build()\n         ).build();\n     }\n \n     /**\n      * Composes yaml settings.\n      * @param user User\n+     * @param type Password type\n      * @param pass Password\n      * @param login Alternative login\n      * @return Settings\n+     * @checkstyle ParameterNumberCheck (3 lines)\n      */\n-    private static YamlMapping settings(final String user, final String pass, final String login) {\n+    private static YamlMapping settings(final String user, final String type, final String pass,\n+        final String login) {\n         return Yaml.createYamlMappingBuilder().add(\n             \"credentials\",\n             Yaml.createYamlMappingBuilder()\n                 .add(\n                     user,\n-                    Yaml.createYamlMappingBuilder().add(\"pass\", pass).add(\"login\", login).build()\n+                    Yaml.createYamlMappingBuilder()\n+                    .add(\"type\", type)\n+                    .add(\"pass\", pass)\n+                    .add(\"login\", login).build()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3ODkzOA=="}, "originalCommit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "originalPosition": 147}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2421, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}