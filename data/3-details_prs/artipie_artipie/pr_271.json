{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MzQ0NjEw", "number": 271, "title": "Authentication and authorization logging", "bodyText": "#197 - added INFO logs for authentication and authorization operations.", "createdAt": "2020-07-07T11:15:06Z", "url": "https://github.com/artipie/artipie/pull/271", "merged": true, "mergeCommit": {"oid": "9e27698b541755374db3e9c268a8c063a1cb02b5"}, "closed": true, "closedAt": "2020-07-08T14:52:18Z", "author": {"login": "g4s8"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyj7ZZgH2gAyNDQ1MzQ0NjEwOjZlOTcyYmU4ZGM3NTBiOWEwYTQ0NGE2MzJhMDI5NzNiMGY0Nzg1YjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcy7ZiHgH2gAyNDQ1MzQ0NjEwOmNjMzZjYzBlYjk2MWZhY2I2NzMxMzZmMDE2OTU2NWVjYzliMGE4NTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6e972be8dc750b9a0a444a632a02973b0f4785b1", "author": {"user": {"login": "g4s8", "name": "Kirill"}}, "url": "https://github.com/artipie/artipie/commit/6e972be8dc750b9a0a444a632a02973b0f4785b1", "committedDate": "2020-07-07T11:13:51Z", "message": "#197 - authentication and authorization logging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzODA4ODAz", "url": "https://github.com/artipie/artipie/pull/271#pullrequestreview-443808803", "createdAt": "2020-07-07T11:41:07Z", "commit": {"oid": "6e972be8dc750b9a0a444a632a02973b0f4785b1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxMTo0MTowOFrOGt6tlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxMTo0NToyMFrOGt617w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDgwMTA0Nw==", "bodyText": "@g4s8 please consider renaming the class to YamlPermissions as it more common to put implementation specifics first and interface name second", "url": "https://github.com/artipie/artipie/pull/271#discussion_r450801047", "createdAt": "2020-07-07T11:41:08Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/PermissionsYaml.java", "diffHunk": "@@ -36,7 +37,7 @@\n  * on repository yaml configuration file.\n  * @since 0.2\n  */\n-public final class RpPermissions implements Permissions {\n+public final class PermissionsYaml implements Permissions {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e972be8dc750b9a0a444a632a02973b0f4785b1"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDgwMjgyNw==", "bodyText": "@g4s8 logging level looks to be too high for this kind of messages as they explain they do not log actions, but explain reason why certain actions were made. I'd suggest to decrease logging level to debug or make it configurable", "url": "https://github.com/artipie/artipie/pull/271#discussion_r450802827", "createdAt": "2020-07-07T11:44:36Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/PermissionsYaml.java", "diffHunk": "@@ -52,23 +53,29 @@\n      * Ctor.\n      * @param conf Config file\n      */\n-    public RpPermissions(final File conf) {\n+    public PermissionsYaml(final File conf) {\n         this(readYaml(conf));\n     }\n \n     /**\n      * Ctor.\n      * @param yaml Configuration yaml\n      */\n-    public RpPermissions(final YamlMapping yaml) {\n+    public PermissionsYaml(final YamlMapping yaml) {\n         this.yaml = yaml;\n     }\n \n     @Override\n     public boolean allowed(final String name, final String action) {\n         final YamlMapping all = this.yaml.yamlMapping(\"permissions\");\n-        return check(all.yamlSequence(name), action)\n-            || check(all.yamlSequence(RpPermissions.WILDCARD), action);\n+        final boolean res = check(all.yamlSequence(name), action)\n+            || check(all.yamlSequence(PermissionsYaml.WILDCARD), action);\n+        if (res) {\n+            Logger.info(this, \"Operation '%s' allowed for '%s'\", action, name);\n+        } else {\n+            Logger.info(this, \"Operation '%s' denied for '%s'\", action, name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e972be8dc750b9a0a444a632a02973b0f4785b1"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDgwMzA1NQ==", "bodyText": "@g4s8 logging levels, see my previous comment", "url": "https://github.com/artipie/artipie/pull/271#discussion_r450803055", "createdAt": "2020-07-07T11:45:05Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/auth/AuthFromEnv.java", "diffHunk": "@@ -71,8 +72,10 @@ public AuthFromEnv(final Map<String, String> env) {\n         // @checkstyle LineLengthCheck (5 lines)\n         if (Objects.equals(Objects.requireNonNull(username), this.env.get(AuthFromEnv.ENV_NAME))\n             && Objects.equals(Objects.requireNonNull(password), this.env.get(AuthFromEnv.ENV_PASS))) {\n+            Logger.info(this, \"Successfully authenticated '%s' user\", username);\n             result = Optional.of(username);\n         } else {\n+            Logger.info(this, \"Failed to authenticate '%s' user\", username);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e972be8dc750b9a0a444a632a02973b0f4785b1"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDgwMzE4Mw==", "bodyText": "@g4s8 logging levels, see my previous comment", "url": "https://github.com/artipie/artipie/pull/271#discussion_r450803183", "createdAt": "2020-07-07T11:45:20Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -84,6 +85,11 @@ public AuthFromYaml(final YamlMapping cred) {\n                 }\n             }\n         }\n+        if (res.isEmpty()) {\n+            Logger.info(this, \"Failed to authenticate '%s' user\", user);\n+        } else {\n+            Logger.info(this, \"Successfully authenticated '%s' user\", user);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e972be8dc750b9a0a444a632a02973b0f4785b1"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccf5525ee91ad11ff619f090f8422519770ff4f0", "author": {"user": {"login": "g4s8", "name": "Kirill"}}, "url": "https://github.com/artipie/artipie/commit/ccf5525ee91ad11ff619f090f8422519770ff4f0", "committedDate": "2020-07-07T14:03:48Z", "message": "#197 - review fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "651bfee52a100a869c9118bd6726cee9fbdcae89", "author": {"user": {"login": "g4s8", "name": "Kirill"}}, "url": "https://github.com/artipie/artipie/commit/651bfee52a100a869c9118bd6726cee9fbdcae89", "committedDate": "2020-07-07T14:11:02Z", "message": "Merge branch 'master' into 197"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzOTQ1NDg2", "url": "https://github.com/artipie/artipie/pull/271#pullrequestreview-443945486", "createdAt": "2020-07-07T14:26:42Z", "commit": {"oid": "651bfee52a100a869c9118bd6726cee9fbdcae89"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNDoyNjo0MlrOGuBJ8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNDoyNjo0MlrOGuBJ8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkwNjYxMQ==", "bodyText": "@g4s8 guess you forgot to delete logging here", "url": "https://github.com/artipie/artipie/pull/271#discussion_r450906611", "createdAt": "2020-07-07T14:26:42Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/YamlPermissions.java", "diffHunk": "@@ -52,23 +53,29 @@\n      * Ctor.\n      * @param conf Config file\n      */\n-    public RpPermissions(final File conf) {\n+    public YamlPermissions(final File conf) {\n         this(readYaml(conf));\n     }\n \n     /**\n      * Ctor.\n      * @param yaml Configuration yaml\n      */\n-    public RpPermissions(final YamlMapping yaml) {\n+    public YamlPermissions(final YamlMapping yaml) {\n         this.yaml = yaml;\n     }\n \n     @Override\n     public boolean allowed(final String name, final String action) {\n         final YamlMapping all = this.yaml.yamlMapping(\"permissions\");\n-        return check(all.yamlSequence(name), action)\n-            || check(all.yamlSequence(RpPermissions.WILDCARD), action);\n+        final boolean res = check(all.yamlSequence(name), action)\n+            || check(all.yamlSequence(YamlPermissions.WILDCARD), action);\n+        if (res) {\n+            Logger.info(this, \"Operation '%s' allowed for '%s'\", action, name);\n+        } else {\n+            Logger.info(this, \"Operation '%s' denied for '%s'\", action, name);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "651bfee52a100a869c9118bd6726cee9fbdcae89"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a495fa194a2f7d4b857f5e08ff52f94827e542a", "author": {"user": {"login": "g4s8", "name": "Kirill"}}, "url": "https://github.com/artipie/artipie/commit/4a495fa194a2f7d4b857f5e08ff52f94827e542a", "committedDate": "2020-07-07T15:21:42Z", "message": "#197 - removed logging from yaml-permissions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDI0MzE2", "url": "https://github.com/artipie/artipie/pull/271#pullrequestreview-444024316", "createdAt": "2020-07-07T15:49:21Z", "commit": {"oid": "4a495fa194a2f7d4b857f5e08ff52f94827e542a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb6e5ad295435d292aba40078186323654ac8b10", "author": {"user": {"login": "g4s8", "name": "Kirill"}}, "url": "https://github.com/artipie/artipie/commit/fb6e5ad295435d292aba40078186323654ac8b10", "committedDate": "2020-07-08T14:32:36Z", "message": "Merge branch 'master' into 197"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc36cc0eb961facb673136f0169565ecc9b0a855", "author": {"user": {"login": "g4s8", "name": "Kirill"}}, "url": "https://github.com/artipie/artipie/commit/cc36cc0eb961facb673136f0169565ecc9b0a855", "committedDate": "2020-07-08T14:34:35Z", "message": "Merge branch 'master' into 197"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3016, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}