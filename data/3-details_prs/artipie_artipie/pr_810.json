{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwMzM3MzI1", "number": 810, "title": "#797 - Get value for different extensions ", "bodyText": "Part of #797\nImplemented valueFrom to get content from file with either of two extensions (yaml and yml). Added tests.", "createdAt": "2020-12-15T15:32:48Z", "url": "https://github.com/artipie/artipie/pull/810", "merged": true, "mergeCommit": {"oid": "13677f0b72150632e0ff0fbea2d23ca16e1d5834"}, "closed": true, "closedAt": "2020-12-17T10:51:28Z", "author": {"login": "genryxy"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmcF86AH2gAyNTQwMzM3MzI1OjIzOGE3MDBhMWYxZDJjMGQyODMzZWFmM2YwZDA0MzMwYWY1NGQ4ODU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnBBR1gFqTU1NDQ3MTgyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "238a700a1f1d2c0d2833eaf3f0d04330af54d885", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/238a700a1f1d2c0d2833eaf3f0d04330af54d885", "committedDate": "2020-12-15T15:30:12Z", "message": "#797 - Add valueFrom for ConfigFiles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "853c7c7a08076fe44121418ee37553c02d71c35d", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/853c7c7a08076fe44121418ee37553c02d71c35d", "committedDate": "2020-12-15T16:17:40Z", "message": "#797 - Fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78d48c48b3217c8a6702719a1ba2bc67c8a16057", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/78d48c48b3217c8a6702719a1ba2bc67c8a16057", "committedDate": "2020-12-15T16:20:59Z", "message": "#797 - Remove suppressWarning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dfd94d104cee5319b38f03876e129db737c5537", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/5dfd94d104cee5319b38f03876e129db737c5537", "committedDate": "2020-12-15T16:51:39Z", "message": "#797 - Fix qulice"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzNDI5MTAz", "url": "https://github.com/artipie/artipie/pull/810#pullrequestreview-553429103", "createdAt": "2020-12-16T07:50:45Z", "commit": {"oid": "5dfd94d104cee5319b38f03876e129db737c5537"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwNzo1MDo0NVrOIG4Iog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwODo0NzoxNVrOIG6JDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4MjA4Mg==", "bodyText": "@genryxy I'd suggest to not have this constant, but instead create a method that extract extension (if any) from filename", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544082082", "createdAt": "2020-12-16T07:50:45Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/repo/ConfigFile.java", "diffHunk": "@@ -50,12 +52,17 @@\n      */\n     private static final Pattern PTN_ALL = Pattern.compile(\"(?<name>.+?)(?<extension>\\\\.[^.]*$|$)\");\n \n+    /**\n+     * Extension group name.\n+     */\n+    private static final String EXTNSN = \"extension\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dfd94d104cee5319b38f03876e129db737c5537"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4MzY5NA==", "bodyText": "@genryxy it's better to return CompletionStage then CompletableFuture. CompletableFuture might be more convenient to use sometimes, but it is not an interface and has methods for completion, that should not be provided to user", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544083694", "createdAt": "2020-12-16T07:53:52Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/repo/ConfigFile.java", "diffHunk": "@@ -76,19 +83,19 @@ public ConfigFile(final Key filename) {\n      * @param storage Storage where the file with different extensions is checked for existence\n      * @return True if a file with either of the two extensions exists, false otherwise.\n      */\n-    public CompletionStage<Boolean> existsIn(final Storage storage) {\n-        final CompletionStage<Boolean> res;\n-        if (this.isYamlOrYml() || this.matcher(\"extension\").isEmpty()) {\n+    public CompletableFuture<Boolean> existsIn(final Storage storage) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dfd94d104cee5319b38f03876e129db737c5537"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4NDM1Nw==", "bodyText": "@genryxy same concern here about CompletionStage vsCompletableFuture", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544084357", "createdAt": "2020-12-16T07:55:10Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/repo/ConfigFile.java", "diffHunk": "@@ -100,6 +107,38 @@ public ConfigFile(final Key filename) {\n         return res;\n     }\n \n+    /**\n+     * Obtains contents from the specified storage. If files with both extensions\n+     * exists, the file with `.yaml` extension will be obtained.\n+     * @param storage Storage from which the file is obtained\n+     * @return Content of the file.\n+     */\n+    public CompletableFuture<Content> valueFrom(final Storage storage) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dfd94d104cee5319b38f03876e129db737c5537"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4NDk2MA==", "bodyText": "@genryxy I'd suggest to make key a method of Format class instead of static method", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544084960", "createdAt": "2020-12-16T07:56:18Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/repo/ConfigFile.java", "diffHunk": "@@ -131,4 +170,50 @@ private String matcher(final String group) {\n         return matcher.group(group);\n     }\n \n+    /**\n+     * Key.\n+     * @param name Filename\n+     * @param extension Extension\n+     * @return Key from filename and extension.\n+     */\n+    private static Key key(final String name, final String extension) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dfd94d104cee5319b38f03876e129db737c5537"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4NTQ0Mw==", "bodyText": "@genryxy do not see reason to use 3rd party class StringUtils here. String.format works here as well.", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544085443", "createdAt": "2020-12-16T07:57:14Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/repo/ConfigFile.java", "diffHunk": "@@ -131,4 +170,50 @@ private String matcher(final String group) {\n         return matcher.group(group);\n     }\n \n+    /**\n+     * Key.\n+     * @param name Filename\n+     * @param extension Extension\n+     * @return Key from filename and extension.\n+     */\n+    private static Key key(final String name, final String extension) {\n+        return new Key.From(StringUtils.join(\"\", name, extension));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dfd94d104cee5319b38f03876e129db737c5537"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4NjQ2Mw==", "bodyText": "@genryxy I'd suggest to rename the class to Extension, because .yml and .yaml are not different formats, but extensions. The comment for the class also states that we are talking about extensions.", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544086463", "createdAt": "2020-12-16T07:59:19Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/repo/ConfigFile.java", "diffHunk": "@@ -131,4 +170,50 @@ private String matcher(final String group) {\n         return matcher.group(group);\n     }\n \n+    /**\n+     * Key.\n+     * @param name Filename\n+     * @param extension Extension\n+     * @return Key from filename and extension.\n+     */\n+    private static Key key(final String name, final String extension) {\n+        return new Key.From(StringUtils.join(\"\", name, extension));\n+    }\n+\n+    /**\n+     * Config files extensions.\n+     */\n+    enum Formats {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dfd94d104cee5319b38f03876e129db737c5537"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDExNDk1OQ==", "bodyText": "@genryxy @CsvSource is not needed here, it's easier to use @ValueSource for single argument tests", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544114959", "createdAt": "2020-12-16T08:47:15Z", "author": {"login": "olegmoz"}, "path": "src/test/java/com/artipie/repo/ConfigFileTest.java", "diffHunk": "@@ -38,26 +40,65 @@\n  * Test cases for {@link ConfigFile}.\n  * @since 0.14\n  */\n+@SuppressWarnings(\"PMD.AvoidDuplicateLiterals\")\n final class ConfigFileTest {\n \n     /**\n      * Filename.\n      */\n     private static final String NAME = \"my-file\";\n \n+    /**\n+     * Content.\n+     */\n+    private static final byte[] CONTENT = \"content from config file\".getBytes();\n+\n     @ParameterizedTest\n     @CsvSource({\".yaml\", \".yml\", \"''\"})\n-    void existInStorageReturnsWhenYamlExist(final String extension) {\n+    void existInStorageReturnsTrueWhenYamlExist(final String extension) {\n         final Storage storage = new InMemoryStorage();\n         this.saveByKey(storage, \".yaml\");\n         MatcherAssert.assertThat(\n             new ConfigFile(new Key.From(ConfigFileTest.NAME + extension))\n                 .existsIn(storage)\n-                .toCompletableFuture().join(),\n+                .join(),\n             new IsEqual<>(true)\n         );\n     }\n \n+    @ParameterizedTest\n+    @CsvSource({\".yaml\", \".yml\", \"''\"})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dfd94d104cee5319b38f03876e129db737c5537"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a40dfec52f17627b4ac109a2dbcf969507f375de", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/a40dfec52f17627b4ac109a2dbcf969507f375de", "committedDate": "2020-12-17T07:05:43Z", "message": "#797 - Changes by review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4efe634be81b054afa5c025f237cc4dc4622f69f", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/4efe634be81b054afa5c025f237cc4dc4622f69f", "committedDate": "2020-12-17T07:10:12Z", "message": "#797 - Remove unnecessary transoformation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5515304dc7a80ff9dd084fbe09fd7d36b762b16", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/d5515304dc7a80ff9dd084fbe09fd7d36b762b16", "committedDate": "2020-12-17T10:27:35Z", "message": "Merge branch 'master' into 797-valuefrom-diff-extensions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NDcxODI3", "url": "https://github.com/artipie/artipie/pull/810#pullrequestreview-554471827", "createdAt": "2020-12-17T10:31:35Z", "commit": {"oid": "d5515304dc7a80ff9dd084fbe09fd7d36b762b16"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3361, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}