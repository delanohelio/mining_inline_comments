{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2MDQ0MTY5", "number": 532, "title": "#521 - Auth fix for Docker repositories", "bodyText": "Closes #521\nProper response from /v2/ endpoint", "createdAt": "2020-08-31T04:59:29Z", "url": "https://github.com/artipie/artipie/pull/532", "merged": true, "mergeCommit": {"oid": "b849b1529e77182a3823ec5e29b018a5446ffb9f"}, "closed": true, "closedAt": "2020-08-31T10:49:15Z", "author": {"login": "olegmoz"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEL1dmgBqjM3MDgyMTQ1MDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEQijIgFqTQ3ODUwNjQ0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9c7587cc6dd66c8679a99b3b1071693315725625", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/9c7587cc6dd66c8679a99b3b1071693315725625", "committedDate": "2020-08-31T04:58:41Z", "message": "#521 - Auth fix for Docker repositories"}, "afterCommit": {"oid": "3b0fe4b25bcf81abc1965c325e9af49b84d0383b", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/3b0fe4b25bcf81abc1965c325e9af49b84d0383b", "committedDate": "2020-08-31T05:17:44Z", "message": "#521 - Auth fix for Docker repositories"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3b0fe4b25bcf81abc1965c325e9af49b84d0383b", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/3b0fe4b25bcf81abc1965c325e9af49b84d0383b", "committedDate": "2020-08-31T05:17:44Z", "message": "#521 - Auth fix for Docker repositories"}, "afterCommit": {"oid": "fd8f149fda2229b395dcba41f8725a406f55a307", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/fd8f149fda2229b395dcba41f8725a406f55a307", "committedDate": "2020-08-31T05:35:50Z", "message": "#521 - Auth fix for Docker repositories"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd8f149fda2229b395dcba41f8725a406f55a307", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/fd8f149fda2229b395dcba41f8725a406f55a307", "committedDate": "2020-08-31T05:35:50Z", "message": "#521 - Auth fix for Docker repositories"}, "afterCommit": {"oid": "780d731084229843b33d071eb235e003fd219011", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/780d731084229843b33d071eb235e003fd219011", "committedDate": "2020-08-31T05:41:13Z", "message": "#521 - Auth fix for Docker repositories"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dd4682ae03204e16f13acde48281f46391631f8", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/5dd4682ae03204e16f13acde48281f46391631f8", "committedDate": "2020-08-31T06:04:42Z", "message": "#521 - Auth fix for Docker repositories"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "780d731084229843b33d071eb235e003fd219011", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/780d731084229843b33d071eb235e003fd219011", "committedDate": "2020-08-31T05:41:13Z", "message": "#521 - Auth fix for Docker repositories"}, "afterCommit": {"oid": "5dd4682ae03204e16f13acde48281f46391631f8", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/5dd4682ae03204e16f13acde48281f46391631f8", "committedDate": "2020-08-31T06:04:42Z", "message": "#521 - Auth fix for Docker repositories"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NDkyMjU0", "url": "https://github.com/artipie/artipie/pull/532#pullrequestreview-478492254", "createdAt": "2020-08-31T10:28:37Z", "commit": {"oid": "5dd4682ae03204e16f13acde48281f46391631f8"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxMDoyODozN1rOHJzErg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxMDoyODozN1rOHJzErg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDAzNjAxNA==", "bodyText": "@olegmoz you can use SliceHasResponse here:\nMatcherAssert.assertThat(\n  new DockerRoutingSlice(...),\n  new SliceHasResponse(\n    new RsHasStatus(status),\n    new RequestLine(...)\n  )\n)", "url": "https://github.com/artipie/artipie/pull/532#discussion_r480036014", "createdAt": "2020-08-31T10:28:37Z", "author": {"login": "g4s8"}, "path": "src/test/java/com/artipie/http/DockerRoutingSliceTest.java", "diffHunk": "@@ -54,19 +70,37 @@ void ignoresNonDockerRequests() throws Exception {\n         final String path = \"/repo/name\";\n         verify(\n             new DockerRoutingSlice(\n+                new Settings.Fake(),\n                 new AssertSlice(new RqLineHasUri(new RqLineHasUri.HasPath(path)))\n             ),\n             path\n         );\n     }\n \n     @Test\n-    void emptyDockerRequest() throws Exception {\n-        verify(\n-            new DockerRoutingSlice(\n-                new AssertSlice(new RqLineHasUri(new RqLineHasUri.HasPath(\"\")))\n-            ),\n-            \"/v2\"\n+    void emptyDockerRequest() {\n+        final String username = \"alice\";\n+        final String password = \"letmein\";\n+        final Response response = new DockerRoutingSlice(\n+            new SettingsWithAuth(new Authentication.Single(username, password)),\n+            (line, headers, body) -> {\n+                throw new UnsupportedOperationException();\n+            }\n+        ).response(\n+            new RequestLine(RqMethod.GET, \"/v2/\").toString(),\n+            new Headers.From(new Authorization.Basic(username, password)),\n+            Content.EMPTY\n+        );\n+        MatcherAssert.assertThat(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5dd4682ae03204e16f13acde48281f46391631f8"}, "originalPosition": 74}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffd01be9fe10a0618af2ee2549daad851e5c0af8", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/ffd01be9fe10a0618af2ee2549daad851e5c0af8", "committedDate": "2020-08-31T10:34:27Z", "message": "#521 - Changes by review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NDk2NTkz", "url": "https://github.com/artipie/artipie/pull/532#pullrequestreview-478496593", "createdAt": "2020-08-31T10:37:00Z", "commit": {"oid": "ffd01be9fe10a0618af2ee2549daad851e5c0af8"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NTA2NDQz", "url": "https://github.com/artipie/artipie/pull/532#pullrequestreview-478506443", "createdAt": "2020-08-31T10:49:09Z", "commit": {"oid": "ffd01be9fe10a0618af2ee2549daad851e5c0af8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3523, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}