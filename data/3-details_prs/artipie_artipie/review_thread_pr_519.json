{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0NTA5Mjky", "number": 519, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwOTo0MjoxMFrOEdJKJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwOTo1Nzo0NFrOEdJh5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTk0MjEyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/artipie/api/artifactory/AddUpdatePermissionSlice.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwOTo0MjoxMFrOHIIjTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwOTo0MjoxMFrOHIIjTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI5MDc2Ng==", "bodyText": "@genryxy name repoopt looks odd, I'd suggest to name this variable simply opt", "url": "https://github.com/artipie/artipie/pull/519#discussion_r478290766", "createdAt": "2020-08-27T09:42:10Z", "author": {"login": "olenagerasimova"}, "path": "src/main/java/com/artipie/api/artifactory/AddUpdatePermissionSlice.java", "diffHunk": "@@ -74,27 +67,21 @@ public AddUpdatePermissionSlice(final Settings settings) {\n     @Override\n     public Response response(final String line, final Iterable<Map.Entry<String, String>> headers,\n         final Publisher<ByteBuffer> body) {\n-        final Matcher matcher = AddUpdatePermissionSlice.PATH.matcher(\n-            new RequestLineFrom(line).uri().toString()\n-        );\n-        final Response res;\n-        if (matcher.matches()) {\n-            res = new AsyncResponse(\n+        final Optional<String> repoopt = new FromRqLine(line, FromRqLine.Group.REPO).get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b0f36d2872d63038659362430fad280194e8dd3"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTk0MzI5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/artipie/api/artifactory/DeletePermissionSlice.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwOTo0MjoyOVrOHIIkAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwOTo0MjoyOVrOHIIkAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI5MDk0Nw==", "bodyText": "@genryxy same suggestion about naming", "url": "https://github.com/artipie/artipie/pull/519#discussion_r478290947", "createdAt": "2020-08-27T09:42:29Z", "author": {"login": "olenagerasimova"}, "path": "src/main/java/com/artipie/api/artifactory/DeletePermissionSlice.java", "diffHunk": "@@ -67,13 +60,9 @@ public DeletePermissionSlice(final Settings settings) {\n     @Override\n     public Response response(final String line, final Iterable<Map.Entry<String, String>> headers,\n         final Publisher<ByteBuffer> body) {\n-        final Response res;\n-        final Matcher matcher = DeletePermissionSlice.PATH.matcher(\n-            new RequestLineFrom(line).uri().toString()\n-        );\n-        if (matcher.matches()) {\n-            final String repo = matcher.group(\"repo\");\n-            res = new AsyncResponse(\n+        final Optional<String> repoopt = new FromRqLine(line, FromRqLine.Group.REPO).get();\n+        return repoopt.<Response>map(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b0f36d2872d63038659362430fad280194e8dd3"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk4OTk5OTE2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/artipie/api/artifactory/FromRqLine.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwOTo1Njo0MVrOHIJFIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwOTo1Njo0MVrOHIJFIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI5OTQyNg==", "bodyText": "@genryxy as you created enum, let's add patterns to this enum, create getter for the patterns and rename it to Pattern or RqPattern:\nUSER(Pattern.compile(\"/api/security/users/(?<username>[^/.]+)\"))\n...\npublic Pattern pattern() {\n   return this.pattern;\n}\n\nThus we will get rid of constants and will use enum items in ArtipieApi.\nFrom FromRqLine.get() method can address matcher group by index instead of group name, group names will not be neede.", "url": "https://github.com/artipie/artipie/pull/519#discussion_r478299426", "createdAt": "2020-08-27T09:56:41Z", "author": {"login": "olenagerasimova"}, "path": "src/main/java/com/artipie/api/artifactory/FromRqLine.java", "diffHunk": "@@ -58,14 +90,53 @@\n      */\n     Optional<String> get() {\n         final Optional<String> username;\n-        final Matcher matcher = UserFromRqLine.PTRN.matcher(\n+        final Matcher matcher = this.ptrn.matcher(\n             new RequestLineFrom(this.rqline).uri().toString()\n         );\n         if (matcher.matches()) {\n-            username = Optional.of(matcher.group(\"username\"));\n+            username = Optional.of(matcher.group(this.mtchgroup.group()));\n         } else {\n             username = Optional.empty();\n         }\n         return username;\n     }\n+\n+    /**\n+     * Group name for part of the request line.\n+     */\n+    enum Group {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b0f36d2872d63038659362430fad280194e8dd3"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MDAwMjkyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/artipie/api/artifactory/GetPermissionSlice.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwOTo1Nzo0NFrOHIJHZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwOTo1Nzo0NFrOHIJHZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODMwMDAwNA==", "bodyText": "@genryxy same suggestion about naming", "url": "https://github.com/artipie/artipie/pull/519#discussion_r478300004", "createdAt": "2020-08-27T09:57:44Z", "author": {"login": "olenagerasimova"}, "path": "src/main/java/com/artipie/api/artifactory/GetPermissionSlice.java", "diffHunk": "@@ -71,20 +64,13 @@ public GetPermissionSlice(final Settings settings) {\n     @Override\n     public Response response(final String line, final Iterable<Map.Entry<String, String>> headers,\n         final Publisher<ByteBuffer> body) {\n-        final Matcher matcher = GetPermissionSlice.PTRN.matcher(\n-            new RequestLineFrom(line).uri().toString()\n-        );\n-        final Response res;\n-        if (matcher.matches()) {\n-            final String repo = matcher.group(\"repo\");\n-            res = new AsyncResponse(\n+        final Optional<String> repoopt = new FromRqLine(line, FromRqLine.Group.REPO).get();\n+        return repoopt.<Response>map(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b0f36d2872d63038659362430fad280194e8dd3"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2148, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}