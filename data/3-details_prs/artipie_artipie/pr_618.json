{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNzc2ODA0", "number": 618, "title": "#571 - Added docs for path patterns support & fixed GET endpoint", "bodyText": "Part of #571\nAdded docs for path patterns support & fixed GET endpoint", "createdAt": "2020-09-22T08:29:56Z", "url": "https://github.com/artipie/artipie/pull/618", "merged": true, "mergeCommit": {"oid": "0afdec4a93f8a48de26c19f5c62f18fa8c1772d0"}, "closed": true, "closedAt": "2020-09-22T14:07:24Z", "author": {"login": "olegmoz"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLTtJvgH2gAyNDkwNzc2ODA0OjZhOWU5ZWFlNDE1OGVlY2E2MTE3MmM0N2YyYjhmYjQxZDA0YzFiZWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLYLKbgH2gAyNDkwNzc2ODA0OmVmZmFlNDI2YjhmNzg2MjczYWU4ODZkOWE2ZjkwYjRiZTU2OGZlY2E=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/6a9e9eae4158eeca61172c47f2b8fb41d04c1bef", "committedDate": "2020-09-22T08:27:55Z", "message": "#571 - Added docs for path patterns support & fixed GET endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMjgxNzcx", "url": "https://github.com/artipie/artipie/pull/618#pullrequestreview-493281771", "createdAt": "2020-09-22T09:32:04Z", "commit": {"oid": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTozMjowNFrOHVx1HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTo0MTozMlrOHVyKvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU5ODU1Ng==", "bodyText": "@olegmoz I'd suggest to simplify this sentence to \"Path patterns to apply permissions to\"", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492598556", "createdAt": "2020-09-22T09:32:04Z", "author": {"login": "olenagerasimova"}, "path": "REST_API.md", "diffHunk": "@@ -143,6 +144,7 @@ Fields description:\n \n Field name | Type | Meaning | Required\n ------ | ------ | ------ | ------\n+includesPattern | string | Path pattern to which permissions are applied | Y", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwMTA0OQ==", "bodyText": "@olegmoz I'd suggest to rephrase:\ninclude-patterns is an optional argument (effectively value [\"**\"] is set by default)\nwhich allows specifying path patterns to apply permissions to.", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492601049", "createdAt": "2020-09-22T09:36:23Z", "author": {"login": "olenagerasimova"}, "path": "REST_API.md", "diffHunk": "@@ -183,9 +186,15 @@ The following synonyms and shortened values for standard operations are supporte\n - `delete` - `d`\n - `manage` (any operation is allowed) - `m`, `admin`\n \n+`include-patterns` is an optional argument (effectively is `[\"**\"]` by default) \n+which allows specifying path patterns to which permissions are applied.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwMTYxMA==", "bodyText": "@olegmoz let's remove point at the end of the sentence, they are not required in the lists", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492601610", "createdAt": "2020-09-22T09:37:15Z", "author": {"login": "olenagerasimova"}, "path": "REST_API.md", "diffHunk": "@@ -183,9 +186,15 @@ The following synonyms and shortened values for standard operations are supporte\n - `delete` - `d`\n - `manage` (any operation is allowed) - `m`, `admin`\n \n+`include-patterns` is an optional argument (effectively is `[\"**\"]` by default) \n+which allows specifying path patterns to which permissions are applied.\n+Path patterns are specified by Ant-like expressions.\n+\n Possible responses:\n - `200 OK` when permissions were added successfully\n - `500 INTERNAL ERROR` in the case of unexpected server error\n+- `400 BAD REQUEST` in the cases when repository name does not exist \n+ or `include-patterns` format is invalid.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwNDA5Mg==", "bodyText": "@olegmoz I'm not sure I like these changes as include-patterns is actually a list, would not it be better to revert changes here and add several patterns in one test method?", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492604092", "createdAt": "2020-09-22T09:41:32Z", "author": {"login": "olenagerasimova"}, "path": "src/test/java/com/artipie/api/artifactory/GetPermissionSliceTest.java", "diffHunk": "@@ -129,25 +127,17 @@ void returnsUsersAndPermissionsList() {\n                             .add(john, Json.createArrayBuilder().add(\"r\").add(\"w\").build())\n                             .add(mark, Json.createArrayBuilder().add(\"m\").build())\n                             .build(),\n-                        Collections.singletonList(\"**\")\n+                        \"**/*\"\n                     )\n                 ),\n                 new RequestLine(RqMethod.GET, String.format(\"/api/security/permissions/%s\", repo))\n             )\n         );\n     }\n \n-    private byte[] response(\n-        final String repo,\n-        final JsonObject users,\n-        final Collection<String> patterns\n-    ) {\n-        final JsonArrayBuilder incpatterns = Json.createArrayBuilder();\n-        for (final String pattern : patterns) {\n-            incpatterns.add(pattern);\n-        }\n+    private byte[] response(final String repo, final JsonObject users, final String pattern) {\n         return Json.createObjectBuilder()\n-            .add(\"include-patterns\", incpatterns)\n+            .add(\"includesPattern\", pattern)\n             .add(\"repositories\", Json.createArrayBuilder().add(repo).build())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3e5b8c65761d1d83b2e51e9821807a02c9592fe", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/b3e5b8c65761d1d83b2e51e9821807a02c9592fe", "committedDate": "2020-09-22T10:20:29Z", "message": "#571 - Changes by review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMzkxMTQ4", "url": "https://github.com/artipie/artipie/pull/618#pullrequestreview-493391148", "createdAt": "2020-09-22T12:09:40Z", "commit": {"oid": "b3e5b8c65761d1d83b2e51e9821807a02c9592fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "effae426b8f786273ae886d9a6f90b4be568feca", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/effae426b8f786273ae886d9a6f90b4be568feca", "committedDate": "2020-09-22T13:40:19Z", "message": "Merge branch 'master' into 571-include-patterns-doc-and-fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2987, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}