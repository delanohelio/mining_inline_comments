{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNDg1MDM0", "number": 627, "title": "#572 - add reader group and permission", "bodyText": "Part of #573\n\nuser created from AddUpdateUserSlice always is in readers group\nrepo permissions updated/created from AddUpdatePermissionSlice always include read right for readers groups", "createdAt": "2020-09-24T14:23:27Z", "url": "https://github.com/artipie/artipie/pull/627", "merged": true, "mergeCommit": {"oid": "7e48a090288f2d3776144d3c01e705b53fb8ac92"}, "closed": true, "closedAt": "2020-09-25T09:22:40Z", "author": {"login": "olenagerasimova"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMB8gLgH2gAyNDkyNDg1MDM0OjMwZGY5MDQwZGJkNmFmMjAzYWUwNGY4NGEzZWYwMWFmNWZmM2NmY2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMRyjmAH2gAyNDkyNDg1MDM0OjAyM2MzYzkwZWMwMWNiYmUyNzgzMGVkZDVlOTAyMjhmYWMxMTc0MWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "30df9040dbd6af203ae04f84a3ef01af5ff3cfcf", "author": {"user": {"login": "olenagerasimova", "name": "Alena"}}, "url": "https://github.com/artipie/artipie/commit/30df9040dbd6af203ae04f84a3ef01af5ff3cfcf", "committedDate": "2020-09-24T14:20:19Z", "message": "#572 - add reader group and permission"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NjUzOTE3", "url": "https://github.com/artipie/artipie/pull/627#pullrequestreview-495653917", "createdAt": "2020-09-24T14:47:57Z", "commit": {"oid": "30df9040dbd6af203ae04f84a3ef01af5ff3cfcf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo0Nzo1N1rOHXenOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo1MDo1NFrOHXewcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4MDg1Ng==", "bodyText": "@olenagerasimova /readers group should be added only if new repository is created. Otherwise it won't be possible to revoke permissions for the group", "url": "https://github.com/artipie/artipie/pull/627#discussion_r494380856", "createdAt": "2020-09-24T14:47:57Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/api/artifactory/AddUpdatePermissionSlice.java", "diffHunk": "@@ -142,6 +143,7 @@ public Response response(final String line, final Iterable<Map.Entry<String, Str\n                     )\n                 )\n         );\n+        res.add(new RepoPermissions.PermissionItem(\"/readers\", new ListOf<String>(\"read\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30df9040dbd6af203ae04f84a3ef01af5ff3cfcf"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4MzIxNw==", "bodyText": "@olenagerasimova same as with adding readers group to repository, this should be done only on new user creation", "url": "https://github.com/artipie/artipie/pull/627#discussion_r494383217", "createdAt": "2020-09-24T14:50:54Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/api/artifactory/AddUpdateUserSlice.java", "diffHunk": "@@ -108,11 +108,12 @@ public Response response(final String line, final Iterable<Map.Entry<String, Str\n             json -> {\n                 final Optional<Pair<Users.User, String>> res;\n                 if (json.containsKey(pswd) && json.containsKey(email)) {\n-                    List<String> list = Collections.emptyList();\n+                    List<String> list = new ArrayList<>(1);\n                     if (json.containsKey(groups)) {\n                         list = json.getJsonArray(groups).getValuesAs(JsonString.class)\n                             .stream().map(JsonString::getString).collect(Collectors.toList());\n                     }\n+                    list.add(\"readers\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30df9040dbd6af203ae04f84a3ef01af5ff3cfcf"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "323ae7b685279d34fefb476be2d5635442399d01", "author": {"user": {"login": "olenagerasimova", "name": "Alena"}}, "url": "https://github.com/artipie/artipie/commit/323ae7b685279d34fefb476be2d5635442399d01", "committedDate": "2020-09-25T06:16:05Z", "message": "#572 - CR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bad57cc5d52746f5e07b10f329baf2c93be1ff1", "author": {"user": {"login": "olenagerasimova", "name": "Alena"}}, "url": "https://github.com/artipie/artipie/commit/7bad57cc5d52746f5e07b10f329baf2c93be1ff1", "committedDate": "2020-09-25T06:38:12Z", "message": "#572 - test corrected"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MjI4ODI2", "url": "https://github.com/artipie/artipie/pull/627#pullrequestreview-496228826", "createdAt": "2020-09-25T08:47:47Z", "commit": {"oid": "7bad57cc5d52746f5e07b10f329baf2c93be1ff1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "023c3c90ec01cbbe27830edd5e90228fac11741c", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/023c3c90ec01cbbe27830edd5e90228fac11741c", "committedDate": "2020-09-25T08:47:56Z", "message": "Merge branch 'master' into 572-add-readers-by-def"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3375, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}