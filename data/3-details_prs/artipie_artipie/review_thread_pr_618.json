{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNzc2ODA0", "number": 618, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTozMjowNFrOEmAFiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTo0MTozMlrOEmAS4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MjgyNzYzOnYy", "diffSide": "RIGHT", "path": "REST_API.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTozMjowNFrOHVx1HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTozMjowNFrOHVx1HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU5ODU1Ng==", "bodyText": "@olegmoz I'd suggest to simplify this sentence to \"Path patterns to apply permissions to\"", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492598556", "createdAt": "2020-09-22T09:32:04Z", "author": {"login": "olenagerasimova"}, "path": "REST_API.md", "diffHunk": "@@ -143,6 +144,7 @@ Fields description:\n \n Field name | Type | Meaning | Required\n ------ | ------ | ------ | ------\n+includesPattern | string | Path pattern to which permissions are applied | Y", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4Mjg0MjcwOnYy", "diffSide": "RIGHT", "path": "REST_API.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTozNjoyM1rOHVx-2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTozNjoyM1rOHVx-2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwMTA0OQ==", "bodyText": "@olegmoz I'd suggest to rephrase:\ninclude-patterns is an optional argument (effectively value [\"**\"] is set by default)\nwhich allows specifying path patterns to apply permissions to.", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492601049", "createdAt": "2020-09-22T09:36:23Z", "author": {"login": "olenagerasimova"}, "path": "REST_API.md", "diffHunk": "@@ -183,9 +186,15 @@ The following synonyms and shortened values for standard operations are supporte\n - `delete` - `d`\n - `manage` (any operation is allowed) - `m`, `admin`\n \n+`include-patterns` is an optional argument (effectively is `[\"**\"]` by default) \n+which allows specifying path patterns to which permissions are applied.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4Mjg0NjI1OnYy", "diffSide": "RIGHT", "path": "REST_API.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTozNzoxNVrOHVyBCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTozNzoxNVrOHVyBCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwMTYxMA==", "bodyText": "@olegmoz let's remove point at the end of the sentence, they are not required in the lists", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492601610", "createdAt": "2020-09-22T09:37:15Z", "author": {"login": "olenagerasimova"}, "path": "REST_API.md", "diffHunk": "@@ -183,9 +186,15 @@ The following synonyms and shortened values for standard operations are supporte\n - `delete` - `d`\n - `manage` (any operation is allowed) - `m`, `admin`\n \n+`include-patterns` is an optional argument (effectively is `[\"**\"]` by default) \n+which allows specifying path patterns to which permissions are applied.\n+Path patterns are specified by Ant-like expressions.\n+\n Possible responses:\n - `200 OK` when permissions were added successfully\n - `500 INTERNAL ERROR` in the case of unexpected server error\n+- `400 BAD REQUEST` in the cases when repository name does not exist \n+ or `include-patterns` format is invalid.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4Mjg2MTc2OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/artipie/api/artifactory/GetPermissionSliceTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwOTo0MTozMlrOHVyKvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxMjowODo1MVrOHV23gA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwNDA5Mg==", "bodyText": "@olegmoz I'm not sure I like these changes as include-patterns is actually a list, would not it be better to revert changes here and add several patterns in one test method?", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492604092", "createdAt": "2020-09-22T09:41:32Z", "author": {"login": "olenagerasimova"}, "path": "src/test/java/com/artipie/api/artifactory/GetPermissionSliceTest.java", "diffHunk": "@@ -129,25 +127,17 @@ void returnsUsersAndPermissionsList() {\n                             .add(john, Json.createArrayBuilder().add(\"r\").add(\"w\").build())\n                             .add(mark, Json.createArrayBuilder().add(\"m\").build())\n                             .build(),\n-                        Collections.singletonList(\"**\")\n+                        \"**/*\"\n                     )\n                 ),\n                 new RequestLine(RqMethod.GET, String.format(\"/api/security/permissions/%s\", repo))\n             )\n         );\n     }\n \n-    private byte[] response(\n-        final String repo,\n-        final JsonObject users,\n-        final Collection<String> patterns\n-    ) {\n-        final JsonArrayBuilder incpatterns = Json.createArrayBuilder();\n-        for (final String pattern : patterns) {\n-            incpatterns.add(pattern);\n-        }\n+    private byte[] response(final String repo, final JsonObject users, final String pattern) {\n         return Json.createObjectBuilder()\n-            .add(\"include-patterns\", incpatterns)\n+            .add(\"includesPattern\", pattern)\n             .add(\"repositories\", Json.createArrayBuilder().add(repo).build())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYyNDQ1NA==", "bodyText": "@olenagerasimova that's not about test - it happens that original API has only one path in GET response, see https://www.jfrog.com/confluence/display/rtf/artifactory+rest+api#ArtifactoryRESTAPI-GetPermissionTargetDetails and application/vnd.org.jfrog.artifactory.security.PermissionTarget+json format description here: https://www.jfrog.com/confluence/display/JFROG/Security+Configuration+JSON\nSo original implementation was wrong. I noticed it only updating the docs", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492624454", "createdAt": "2020-09-22T10:18:01Z", "author": {"login": "olegmoz"}, "path": "src/test/java/com/artipie/api/artifactory/GetPermissionSliceTest.java", "diffHunk": "@@ -129,25 +127,17 @@ void returnsUsersAndPermissionsList() {\n                             .add(john, Json.createArrayBuilder().add(\"r\").add(\"w\").build())\n                             .add(mark, Json.createArrayBuilder().add(\"m\").build())\n                             .build(),\n-                        Collections.singletonList(\"**\")\n+                        \"**/*\"\n                     )\n                 ),\n                 new RequestLine(RqMethod.GET, String.format(\"/api/security/permissions/%s\", repo))\n             )\n         );\n     }\n \n-    private byte[] response(\n-        final String repo,\n-        final JsonObject users,\n-        final Collection<String> patterns\n-    ) {\n-        final JsonArrayBuilder incpatterns = Json.createArrayBuilder();\n-        for (final String pattern : patterns) {\n-            incpatterns.add(pattern);\n-        }\n+    private byte[] response(final String repo, final JsonObject users, final String pattern) {\n         return Json.createObjectBuilder()\n-            .add(\"include-patterns\", incpatterns)\n+            .add(\"includesPattern\", pattern)\n             .add(\"repositories\", Json.createArrayBuilder().add(repo).build())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwNDA5Mg=="}, "originalCommit": {"oid": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY4MTA4OA==", "bodyText": "@olegmoz oh, I see, thanks", "url": "https://github.com/artipie/artipie/pull/618#discussion_r492681088", "createdAt": "2020-09-22T12:08:51Z", "author": {"login": "olenagerasimova"}, "path": "src/test/java/com/artipie/api/artifactory/GetPermissionSliceTest.java", "diffHunk": "@@ -129,25 +127,17 @@ void returnsUsersAndPermissionsList() {\n                             .add(john, Json.createArrayBuilder().add(\"r\").add(\"w\").build())\n                             .add(mark, Json.createArrayBuilder().add(\"m\").build())\n                             .build(),\n-                        Collections.singletonList(\"**\")\n+                        \"**/*\"\n                     )\n                 ),\n                 new RequestLine(RqMethod.GET, String.format(\"/api/security/permissions/%s\", repo))\n             )\n         );\n     }\n \n-    private byte[] response(\n-        final String repo,\n-        final JsonObject users,\n-        final Collection<String> patterns\n-    ) {\n-        final JsonArrayBuilder incpatterns = Json.createArrayBuilder();\n-        for (final String pattern : patterns) {\n-            incpatterns.add(pattern);\n-        }\n+    private byte[] response(final String repo, final JsonObject users, final String pattern) {\n         return Json.createObjectBuilder()\n-            .add(\"include-patterns\", incpatterns)\n+            .add(\"includesPattern\", pattern)\n             .add(\"repositories\", Json.createArrayBuilder().add(repo).build())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYwNDA5Mg=="}, "originalCommit": {"oid": "6a9e9eae4158eeca61172c47f2b8fb41d04c1bef"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2208, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}