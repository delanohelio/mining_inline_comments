{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5NzI0MTc1", "number": 550, "title": "Ubuntu single upload visualization", "bodyText": "Preview:\n\nRelated to #431.", "createdAt": "2020-09-04T14:12:59Z", "url": "https://github.com/artipie/artipie/pull/550", "merged": true, "mergeCommit": {"oid": "0cd3b2c02b77d54a54b359de0e39ae3643bc47cc"}, "closed": true, "closedAt": "2020-09-07T13:03:22Z", "author": {"login": "Sammers21"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFltN6AH2gAyNDc5NzI0MTc1OjA0MTI3YmQ3MGZlOGI4NWRkYTE2NmMxM2FmMmUwMDJjODNiN2ZhMDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdGip2iAFqTQ4MzUzOTU2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "04127bd70fe8b85dda166c13af2e002c83b7fa05", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/04127bd70fe8b85dda166c13af2e002c83b7fa05", "committedDate": "2020-09-04T14:02:44Z", "message": "#431 - draw ubuntu single upload"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39658d026eb51fc43a321ab8fc5bab4d69075acb", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/39658d026eb51fc43a321ab8fc5bab4d69075acb", "committedDate": "2020-09-04T14:12:30Z", "message": "#431 - draw ubuntu single upload"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f86a4105077d2f92665046b171614eb8a65c584", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/1f86a4105077d2f92665046b171614eb8a65c584", "committedDate": "2020-09-04T14:16:05Z", "message": "#431 - polishing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e85d5a4dfa312d7a9e1bab939e91cf7243e4e8c2", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/e85d5a4dfa312d7a9e1bab939e91cf7243e4e8c2", "committedDate": "2020-09-04T14:24:15Z", "message": "#431 - change repo and branch to artipie/gh-pages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNTI1NjE2", "url": "https://github.com/artipie/artipie/pull/550#pullrequestreview-483525616", "createdAt": "2020-09-07T12:41:30Z", "commit": {"oid": "e85d5a4dfa312d7a9e1bab939e91cf7243e4e8c2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMjo0MTozMFrOHN99ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMjo0MTo1M1rOHN9-JA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwODY3Nw==", "bodyText": "@Sammers21 I don't think we need to hard-code Docker benchmarks in code, how we will switch between benchmarks when we have many of them?", "url": "https://github.com/artipie/artipie/pull/550#discussion_r484408677", "createdAt": "2020-09-07T12:41:30Z", "author": {"login": "g4s8"}, "path": "benchmarks/index.html", "diffHunk": "@@ -1,21 +1,103 @@\n <!DOCTYPE html>\n <html>\n-  <body>\n-    <script>\n-      (async () => {\n-        const response = await fetch('https://api.github.com/repos/artipie/artipie/contents/benchmarks?ref=gh-pages');\n-        const data = await response.json();\n-        let htmlString = '<h1>Performance tests</h1><ul>';\n-        for (let file of data) {\n-          if (file.type === 'dir') {\n-            htmlString += `<li>${file.name}</li><ul>`;\n-            htmlString += `<li><a href=\"${file.name}/files/upload/index.html\">Files upload</a></li>`;\n-            htmlString += '</ul>';\n-          }\n+<body>\n+<script src=\"https://cdn.jsdelivr.net/npm/chart.js@2.8.0\"></script>\n+<div class=\"chart-container\" style=\"position: relative; height:30vh; width:80vw\">\n+    <canvas id=\"docker_single_upload\"></canvas>\n+</div>\n+<script>\n+    /**\n+     * Compare strings with numeric versions\n+     * @param one The one string\n+     * @param another The another string\n+     * @returns {number} The result of comparison\n+     */\n+    function compareDottedString(one, another) {\n+        let a1 = one.split('.');\n+        let b1 = another.split('.');\n+        let len = Math.max(a1.length, b1.length);\n+        for (var i = 0; i < len; i++) {\n+            let _a = +a1[i] || 0;\n+            let _b = +b1[i] || 0;\n+            if (_a === _b) continue;\n+            else return _a > _b ? 1 : -1\n         }\n-        htmlString += '</ul>';\n-        document.getElementsByTagName('body')[0].innerHTML = htmlString;\n-      })()\n-    </script>\n-  </body>\n+        return 0;\n+    }\n+\n+    (async () => {\n+        let repository = 'artipie/artipie';\n+        let branch = 'gh-pages';\n+        const response = await fetch(`https://api.github.com/repos/${repository}/contents/benchmarks?ref=${branch}`);\n+        const data = await response.json()\n+\n+        // array of benchmarks results and versions\n+        let results = (await Promise.all(\n+                data.filter(el => el.type === 'dir')\n+                    .map(el => {\n+                        let version = el.name;\n+                        return fetch(\n+                            `https://raw.githubusercontent.com/${repository}/${branch}/benchmarks/${version}/benchmark-results.json`\n+                        ).then(response => {\n+                            if (!response.ok) {\n+                                throw new Error(`Can't find results for version ${version}`)\n+                            }\n+                            return response.json()\n+                        }).then(json => {\n+                            return {\n+                                \"version\": version,\n+                                \"results\": json\n+                            }\n+                        }).catch(er => {\n+                        })\n+                    })\n+            )\n+        ).filter(el => el !== undefined)\n+            .sort((one, another) => compareDottedString(one.version, another.version))\n+\n+\n+        // Draw Chart\n+        let labels = results.map(json => json.version)\n+        let dt = results.map(json => json.results.docker[\"single-upload\"].artipie.images[0].ubuntu)\n+        let ctx = document.getElementById('docker_single_upload').getContext('2d');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e85d5a4dfa312d7a9e1bab939e91cf7243e4e8c2"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwODg2OA==", "bodyText": "@Sammers21 and same here: \"Docker...\" hardcoded", "url": "https://github.com/artipie/artipie/pull/550#discussion_r484408868", "createdAt": "2020-09-07T12:41:53Z", "author": {"login": "g4s8"}, "path": "benchmarks/index.html", "diffHunk": "@@ -1,21 +1,103 @@\n <!DOCTYPE html>\n <html>\n-  <body>\n-    <script>\n-      (async () => {\n-        const response = await fetch('https://api.github.com/repos/artipie/artipie/contents/benchmarks?ref=gh-pages');\n-        const data = await response.json();\n-        let htmlString = '<h1>Performance tests</h1><ul>';\n-        for (let file of data) {\n-          if (file.type === 'dir') {\n-            htmlString += `<li>${file.name}</li><ul>`;\n-            htmlString += `<li><a href=\"${file.name}/files/upload/index.html\">Files upload</a></li>`;\n-            htmlString += '</ul>';\n-          }\n+<body>\n+<script src=\"https://cdn.jsdelivr.net/npm/chart.js@2.8.0\"></script>\n+<div class=\"chart-container\" style=\"position: relative; height:30vh; width:80vw\">\n+    <canvas id=\"docker_single_upload\"></canvas>\n+</div>\n+<script>\n+    /**\n+     * Compare strings with numeric versions\n+     * @param one The one string\n+     * @param another The another string\n+     * @returns {number} The result of comparison\n+     */\n+    function compareDottedString(one, another) {\n+        let a1 = one.split('.');\n+        let b1 = another.split('.');\n+        let len = Math.max(a1.length, b1.length);\n+        for (var i = 0; i < len; i++) {\n+            let _a = +a1[i] || 0;\n+            let _b = +b1[i] || 0;\n+            if (_a === _b) continue;\n+            else return _a > _b ? 1 : -1\n         }\n-        htmlString += '</ul>';\n-        document.getElementsByTagName('body')[0].innerHTML = htmlString;\n-      })()\n-    </script>\n-  </body>\n+        return 0;\n+    }\n+\n+    (async () => {\n+        let repository = 'artipie/artipie';\n+        let branch = 'gh-pages';\n+        const response = await fetch(`https://api.github.com/repos/${repository}/contents/benchmarks?ref=${branch}`);\n+        const data = await response.json()\n+\n+        // array of benchmarks results and versions\n+        let results = (await Promise.all(\n+                data.filter(el => el.type === 'dir')\n+                    .map(el => {\n+                        let version = el.name;\n+                        return fetch(\n+                            `https://raw.githubusercontent.com/${repository}/${branch}/benchmarks/${version}/benchmark-results.json`\n+                        ).then(response => {\n+                            if (!response.ok) {\n+                                throw new Error(`Can't find results for version ${version}`)\n+                            }\n+                            return response.json()\n+                        }).then(json => {\n+                            return {\n+                                \"version\": version,\n+                                \"results\": json\n+                            }\n+                        }).catch(er => {\n+                        })\n+                    })\n+            )\n+        ).filter(el => el !== undefined)\n+            .sort((one, another) => compareDottedString(one.version, another.version))\n+\n+\n+        // Draw Chart\n+        let labels = results.map(json => json.version)\n+        let dt = results.map(json => json.results.docker[\"single-upload\"].artipie.images[0].ubuntu)\n+        let ctx = document.getElementById('docker_single_upload').getContext('2d');\n+        new Chart(ctx, {\n+            type: 'bar',\n+            data: {\n+                labels: labels,\n+                datasets: [{\n+                    label: 'Docker single upload time',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e85d5a4dfa312d7a9e1bab939e91cf7243e4e8c2"}, "originalPosition": 85}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNTM5NTYy", "url": "https://github.com/artipie/artipie/pull/550#pullrequestreview-483539562", "createdAt": "2020-09-07T13:03:16Z", "commit": {"oid": "e85d5a4dfa312d7a9e1bab939e91cf7243e4e8c2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3539, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}