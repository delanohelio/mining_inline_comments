{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxOTg0OTc3", "number": 171, "title": "Read auth yaml settings", "bodyText": "#171 - Implemented com.artipie.YamlSettings#auth method to obtain configured Authentication.", "createdAt": "2020-05-22T15:26:04Z", "url": "https://github.com/artipie/artipie/pull/171", "merged": true, "mergeCommit": {"oid": "92de29ab90ea6438766b685c239b3dabb45c6ba0"}, "closed": true, "closedAt": "2020-05-26T12:09:58Z", "author": {"login": "olenagerasimova"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjz8qbgH2gAyNDIxOTg0OTc3OjMxNmVjMzJmZTM2NTY5NTY4MTNkYzY5NTc3ZDUyYjlhODM0ZTUyYmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclDjfxAFqTQxODIzMzcwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "316ec32fe3656956813dc69577d52b9a834e52be", "author": {"user": {"login": "olenagerasimova", "name": "Alena"}}, "url": "https://github.com/artipie/artipie/commit/316ec32fe3656956813dc69577d52b9a834e52be", "committedDate": "2020-05-22T15:24:51Z", "message": "Obtain auth for #146"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "75ae46ce0f8b8609b08aa6f7989852f9b9709af4", "author": {"user": {"login": "olenagerasimova", "name": "Alena"}}, "url": "https://github.com/artipie/artipie/commit/75ae46ce0f8b8609b08aa6f7989852f9b9709af4", "committedDate": "2020-05-25T12:58:09Z", "message": "Merge branch 'master' of https://github.com/artipie/artipie into 146-obtain-auth\n\n\u0001 Conflicts:\n\u0001\tsrc/main/java/com/artipie/Pie.java\n\u0001\tsrc/main/java/com/artipie/SliceFromConfig.java\n\u0001\tsrc/main/java/com/artipie/YamlSettings.java\n\u0001\tsrc/test/java/com/artipie/YamlSettingsTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9420d9eeaf3e812b8953b13f1a1eeac040b022b4", "author": {"user": {"login": "olenagerasimova", "name": "Alena"}}, "url": "https://github.com/artipie/artipie/commit/9420d9eeaf3e812b8953b13f1a1eeac040b022b4", "committedDate": "2020-05-25T13:04:34Z", "message": "master merge to #146"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NzI3OTk4", "url": "https://github.com/artipie/artipie/pull/171#pullrequestreview-417727998", "createdAt": "2020-05-25T13:57:04Z", "commit": {"oid": "9420d9eeaf3e812b8953b13f1a1eeac040b022b4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzo1NzowNFrOGaB_Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzo1NzowNFrOGaB_Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk0ODcxOA==", "bodyText": "@olenagerasimova I think if user creates configuration with file type credentials but doesn't specify path, we should not fall back to env credentials but throw an exception (return CompletableFuture.failedFuture()), because it's not a valid scenario, rather administrator mistake.", "url": "https://github.com/artipie/artipie/pull/171#discussion_r429948718", "createdAt": "2020-05-25T13:57:04Z", "author": {"login": "g4s8"}, "path": "src/main/java/com/artipie/YamlSettings.java", "diffHunk": "@@ -55,26 +71,61 @@ public Storage storage() throws IOException {\n         return new YamlStorageSettings(\n             Yaml.createYamlInput(this.content)\n                 .readYamlMapping()\n-                .yamlMapping(\"meta\")\n+                .yamlMapping(YamlSettings.META)\n                 .yamlMapping(\"storage\")\n         ).storage();\n     }\n \n     @Override\n     public CompletionStage<Authentication> auth() throws IOException {\n-        //@checkstyle MethodBodyCommentsCheck (12 lines)\n-        // @todo #146:30min Implement this method to obtain authentications: for now\n-        //  we have AuthFromEnv, which is available when `credentials.type` equals `env`, and\n-        //  AuthFromYaml, which is available when `credentials.type` equals\n-        //  `file` and `credentials.path` specified. New `credentials` section in main artipie\n-        //  config:\n-        //  credentials:\n-        //    # let's support `env` and `file` types for now\n-        //    type: file\n-        //    # file location, storage key, relative to `meta.storage.path`\n-        //    path: _credentials.yml\n-        //  For details check comments in #146.\n-        //  After implementing pass found authentications to slices.\n-        throw new NotImplementedException(\"Not yet implemented\");\n+        final YamlMapping cred = Yaml.createYamlInput(this.content)\n+            .readYamlMapping()\n+            .yamlMapping(YamlSettings.META)\n+            .yamlMapping(\"credentials\");\n+        final CompletionStage<Authentication> res;\n+        final String path = \"path\";\n+        if (cred != null && \"file\".equals(cred.string(\"type\")) && cred.string(path) != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9420d9eeaf3e812b8953b13f1a1eeac040b022b4"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de35739af406e48243ed3c0e48370f31fde0e2f8", "author": {"user": {"login": "olenagerasimova", "name": "Alena"}}, "url": "https://github.com/artipie/artipie/commit/de35739af406e48243ed3c0e48370f31fde0e2f8", "committedDate": "2020-05-25T18:15:36Z", "message": "obtain auth to #146 CR"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MjMzNzAy", "url": "https://github.com/artipie/artipie/pull/171#pullrequestreview-418233702", "createdAt": "2020-05-26T12:09:46Z", "commit": {"oid": "de35739af406e48243ed3c0e48370f31fde0e2f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3193, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}