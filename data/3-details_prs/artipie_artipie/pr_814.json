{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxOTI0Mzc1", "number": 814, "title": "#797 - Use ConfigFile where RxStorage is used for config files", "bodyText": "Part of #797\nUse ConfigFile where RxStorageWrapper is used", "createdAt": "2020-12-17T15:02:24Z", "url": "https://github.com/artipie/artipie/pull/814", "merged": true, "mergeCommit": {"oid": "13b0e7291c04735b67f651ba941ade8ae2850577"}, "closed": true, "closedAt": "2020-12-18T10:47:00Z", "author": {"login": "genryxy"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnE4EwgH2gAyNTQxOTI0Mzc1Ojc2MGNkMzJiOGZiYWE3N2FjOWRiZmE0MzdhY2YyM2NhZGU0OGVjNzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdnV1oWAFqTU1NTM4MzQ5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "760cd32b8fbaa77ac9dbfa437acf23cade48ec76", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/760cd32b8fbaa77ac9dbfa437acf23cade48ec76", "committedDate": "2020-12-17T15:01:09Z", "message": "#797 - Use ConfigFile with RxStorage is used"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1MjIyNzMw", "url": "https://github.com/artipie/artipie/pull/814#pullrequestreview-555222730", "createdAt": "2020-12-18T07:29:42Z", "commit": {"oid": "760cd32b8fbaa77ac9dbfa437acf23cade48ec76"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwNzoyOTo0MlrOIIV-6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwNzozNzo0OFrOIIWLFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTYxOTY5MA==", "bodyText": "@genryxy converting new ConfigFile(...).valueFrom(...) into Single and later converting this Single into CompletionStage one again seems pointless. I'd suggest to not do it and transform CompletionStage into result using thenApply, thenCompose etc", "url": "https://github.com/artipie/artipie/pull/814#discussion_r545619690", "createdAt": "2020-12-18T07:29:42Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/RepoPermissionsFromStorage.java", "diffHunk": "@@ -177,11 +176,11 @@ public RepoPermissionsFromStorage(final Storage storage) {\n      * @return Completion action with yaml repo section\n      */\n     private CompletionStage<YamlMapping> repo(final Key key) {\n-        return new RxStorageWrapper(this.storage)\n-            .value(key)\n-            .to(new ContentAsYaml())\n-            .map(yaml -> yaml.yamlMapping(RepoPermissionsFromStorage.REPO_SECTION))\n-            .to(SingleInterop.get());\n+        return SingleInterop.fromFuture(\n+            new ConfigFile(key).valueFrom(this.storage)\n+        ).to(new ContentAsYaml())\n+        .map(yaml -> yaml.yamlMapping(RepoPermissionsFromStorage.REPO_SECTION))\n+        .to(SingleInterop.get());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "760cd32b8fbaa77ac9dbfa437acf23cade48ec76"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTYyMjgwNw==", "bodyText": "@genryxy same concern here, I'd suggest to transform CompletionStage into result directly without using Single", "url": "https://github.com/artipie/artipie/pull/814#discussion_r545622807", "createdAt": "2020-12-18T07:37:48Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/UsersFromStorageYaml.java", "diffHunk": "@@ -163,14 +163,14 @@ public UsersFromStorageYaml(final Storage storage, final Key key) {\n      *  figure out why, make necessary corrections and use `ContentAs` here.\n      */\n     public CompletionStage<YamlMapping> yaml() {\n-        return new RxStorageWrapper(this.storage)\n-            .value(this.key)\n-            .flatMap(content -> new Concatenation(content).single())\n-            .map(Remaining::new)\n-            .map(Remaining::bytes)\n-            .map(bytes -> Yaml.createYamlInput(new String(bytes, StandardCharsets.US_ASCII)))\n-            .map(YamlInput::readYamlMapping)\n-            .to(SingleInterop.get());\n+        return SingleInterop.fromFuture(\n+            new ConfigFile(this.key).valueFrom(this.storage)\n+        ).flatMap(content -> new Concatenation(content).single())\n+        .map(Remaining::new)\n+        .map(Remaining::bytes)\n+        .map(bytes -> Yaml.createYamlInput(new String(bytes, StandardCharsets.US_ASCII)))\n+        .map(YamlInput::readYamlMapping)\n+        .to(SingleInterop.get());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "760cd32b8fbaa77ac9dbfa437acf23cade48ec76"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb40ee39fde8387df32510d5b8244b52d959f817", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/bb40ee39fde8387df32510d5b8244b52d959f817", "committedDate": "2020-12-18T09:53:41Z", "message": "#797 - Changes by review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ceb171c4cfb92e2266c0695b565bf974996992d", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/9ceb171c4cfb92e2266c0695b565bf974996992d", "committedDate": "2020-12-18T10:09:26Z", "message": "#797 - Revert changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1MzgzNDk1", "url": "https://github.com/artipie/artipie/pull/814#pullrequestreview-555383495", "createdAt": "2020-12-18T10:46:52Z", "commit": {"oid": "9ceb171c4cfb92e2266c0695b565bf974996992d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3364, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}