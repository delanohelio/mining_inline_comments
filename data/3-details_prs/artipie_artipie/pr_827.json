{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1NTQyMzEx", "number": 827, "title": "#826 - Verbose output for IT cases", "bodyText": "Closes #826\nMade output for integration tests more verbose by refactoring TestContainer", "createdAt": "2020-12-25T07:37:30Z", "url": "https://github.com/artipie/artipie/pull/827", "merged": true, "mergeCommit": {"oid": "7cddd248169e42810df77d36302ed7ed1e1b18b6"}, "closed": true, "closedAt": "2020-12-25T08:54:51Z", "author": {"login": "genryxy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdpjTT5AH2gAyNTQ1NTQyMzExOjdjNDRlM2FhMTIyMmE0MDA4NDkwZjBlMTlmYTU1NmE1MjJhNDQ3NmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdpkbgAgFqTU1ODc4Nzg2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7c44e3aa1222a4008490f0e19fa556a522a4476d", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/7c44e3aa1222a4008490f0e19fa556a522a4476d", "committedDate": "2020-12-25T07:35:54Z", "message": "#826 - Verbose output for IT cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4Nzc5Mjk1", "url": "https://github.com/artipie/artipie/pull/827#pullrequestreview-558779295", "createdAt": "2020-12-25T08:00:47Z", "commit": {"oid": "7c44e3aa1222a4008490f0e19fa556a522a4476d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQwODowMDo0N1rOILZz0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNVQwODoxMDoxNVrOILZ5uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODgyODExMw==", "bodyText": "@genryxy that looks like too complicated logic for output. I'd suggest to just print stdout and stderr after every command executed as DEBUG logging message and throw stderr content as exception if error code is not zero.", "url": "https://github.com/artipie/artipie/pull/827#discussion_r548828113", "createdAt": "2020-12-25T08:00:47Z", "author": {"login": "olegmoz"}, "path": "src/test/java/com/artipie/test/TestContainer.java", "diffHunk": "@@ -106,4 +133,20 @@ public void close() {\n         Logger.debug(this, \"Command:\\n%s\", String.join(\" \", command));\n         return this.cntn.execInContainer(command);\n     }\n+\n+    /**\n+     * Log std result of the command execution.\n+     * @param exec Result of the execution\n+     * @param error Is it necessary to log stderr as error?\n+     */\n+    private void logStd(final Container.ExecResult exec, final boolean error) {\n+        final String outputerr = String.format(\"\\nSTDERR:\\n%s\", exec.getStderr());\n+        if (error) {\n+            Logger.info(this, String.format(\"\\nSTDOUT:\\n%s\", exec.getStdout()));\n+            Logger.error(this, outputerr);\n+        } else {\n+            Logger.warn(this, outputerr);\n+        }\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c44e3aa1222a4008490f0e19fa556a522a4476d"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODgyOTYyNw==", "bodyText": "@genryxy the code for replacing \\n with empty string is duplicated 3 times in this class, I'd suggest to extract a function for that", "url": "https://github.com/artipie/artipie/pull/827#discussion_r548829627", "createdAt": "2020-12-25T08:10:15Z", "author": {"login": "olegmoz"}, "path": "src/test/java/com/artipie/test/TestContainer.java", "diffHunk": "@@ -88,7 +90,32 @@ public String execStdErr(final String... command) throws Exception {\n      * @throws Exception In case of exception during execution command in container.\n      */\n     public String execStdout(final String... command) throws Exception {\n-        return this.exec(command).getStdout().replace(\"\\n\", \"\");\n+        final Container.ExecResult exec = this.exec(command);\n+        final int code = exec.getExitCode();\n+        if (code != 0) {\n+            this.logStd(exec, true);\n+            throw new IllegalStateException(\n+                String.format(\n+                    \"'%s' failed with %s code\", String.join(\" \", command), code\n+                )\n+            );\n+        }\n+        this.logStd(exec, false);\n+        return exec.getStdout().replace(\"\\n\", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c44e3aa1222a4008490f0e19fa556a522a4476d"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc43765b073668c5b90500b9bcd58c841a5543b3", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/dc43765b073668c5b90500b9bcd58c841a5543b3", "committedDate": "2020-12-25T08:33:23Z", "message": "#826 - Changes by review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4Nzg3ODYx", "url": "https://github.com/artipie/artipie/pull/827#pullrequestreview-558787861", "createdAt": "2020-12-25T08:54:45Z", "commit": {"oid": "dc43765b073668c5b90500b9bcd58c841a5543b3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3370, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}