{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MDI1MjY3", "number": 215, "title": "For #203: changing password storage", "bodyText": "For #203:\n\nchanged how credentials are stored\nchanged tests", "createdAt": "2020-06-17T18:33:51Z", "url": "https://github.com/artipie/artipie/pull/215", "merged": true, "mergeCommit": {"oid": "6a563e5a2c8314fe9985c17de56143270e059728"}, "closed": true, "closedAt": "2020-07-03T09:23:02Z", "author": {"login": "paulodamaso"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsON9UAH2gAyNDM2MDI1MjY3OjU5NWEzM2I5YTFkNTU1YmU0NThlNmQzZDMwY2MxMDg2YzZhN2E4MGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxP4dcgH2gAyNDM2MDI1MjY3OjYwOTA2MDY1YWI1YjJmOGRhNjE4MzQyY2YzNTQwY2Q2NTZkNzcwMTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b", "author": {"user": {"login": "paulodamaso", "name": "Paulo Lobo"}}, "url": "https://github.com/artipie/artipie/commit/595a33b9a1d555be458e6d3d30cc1086c6a7a80b", "committedDate": "2020-06-17T18:32:40Z", "message": "For #203: changing password storage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNzAwODcz", "url": "https://github.com/artipie/artipie/pull/215#pullrequestreview-432700873", "createdAt": "2020-06-17T19:15:41Z", "commit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOToxNTo0MVrOGlT5ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOToyMDozMVrOGlUC-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NjUyMg==", "bodyText": "@paulodamaso I would move null checks to check method to make it more readable or add another method validParams that would check against null. wdyt?", "url": "https://github.com/artipie/artipie/pull/215#discussion_r441776522", "createdAt": "2020-06-17T19:15:41Z", "author": {"login": "Vatavuk"}, "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -66,7 +59,8 @@ public AuthFromYaml(final YamlMapping cred) {\n         Optional<String> res = Optional.empty();\n         if (users != null && users.yamlMapping(user) != null) {\n             final String stored = users.yamlMapping(user).string(\"pass\");\n-            if (stored != null && check(stored, pass)) {\n+            final String type = users.yamlMapping(user).string(\"type\");\n+            if (stored != null && type != null && check(stored, type, pass)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NzU4Mg==", "bodyText": "@paulodamaso I believe variable name pass instead of stored would be more appropriate.", "url": "https://github.com/artipie/artipie/pull/215#discussion_r441777582", "createdAt": "2020-06-17T19:17:44Z", "author": {"login": "Vatavuk"}, "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -66,7 +59,8 @@ public AuthFromYaml(final YamlMapping cred) {\n         Optional<String> res = Optional.empty();\n         if (users != null && users.yamlMapping(user) != null) {\n             final String stored = users.yamlMapping(user).string(\"pass\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3ODkzOA==", "bodyText": "@paulodamaso where is login used? I believe its redundant", "url": "https://github.com/artipie/artipie/pull/215#discussion_r441778938", "createdAt": "2020-06-17T19:20:31Z", "author": {"login": "Vatavuk"}, "path": "src/test/java/com/artipie/auth/AuthFromYamlTest.java", "diffHunk": "@@ -136,32 +140,46 @@ void doesNotAuthoriseByMainLogin() {\n     /**\n      * Composes yaml settings.\n      * @param user User\n+     * @param type Password type\n      * @param pass Password\n      * @return Settings\n      */\n-    private static YamlMapping settings(final String user, final String pass) {\n+    private static YamlMapping settings(\n+        final String user,\n+        final String type,\n+        final String pass) {\n         return Yaml.createYamlMappingBuilder().add(\n             \"credentials\",\n             Yaml.createYamlMappingBuilder()\n-                .add(user, Yaml.createYamlMappingBuilder().add(\"pass\", pass).build())\n-                .build()\n+                .add(\n+                    user,\n+                    Yaml.createYamlMappingBuilder()\n+                    .add(\"type\", type)\n+                    .add(\"pass\", pass).build()\n+                ).build()\n         ).build();\n     }\n \n     /**\n      * Composes yaml settings.\n      * @param user User\n+     * @param type Password type\n      * @param pass Password\n      * @param login Alternative login\n      * @return Settings\n+     * @checkstyle ParameterNumberCheck (3 lines)\n      */\n-    private static YamlMapping settings(final String user, final String pass, final String login) {\n+    private static YamlMapping settings(final String user, final String type, final String pass,\n+        final String login) {\n         return Yaml.createYamlMappingBuilder().add(\n             \"credentials\",\n             Yaml.createYamlMappingBuilder()\n                 .add(\n                     user,\n-                    Yaml.createYamlMappingBuilder().add(\"pass\", pass).add(\"login\", login).build()\n+                    Yaml.createYamlMappingBuilder()\n+                    .add(\"type\", type)\n+                    .add(\"pass\", pass)\n+                    .add(\"login\", login).build()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "originalPosition": 147}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MjA3MDMw", "url": "https://github.com/artipie/artipie/pull/215#pullrequestreview-435207030", "createdAt": "2020-06-22T19:20:17Z", "commit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxOToyMDoxN1rOGnN1Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxOToyNzoxNFrOGnOB7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc3NDI1NQ==", "bodyText": "@Vatavuk I'm already using pass for the password value sent from user. I'm using the name stored because it represents the value which is stored in our Yaml file.", "url": "https://github.com/artipie/artipie/pull/215#discussion_r443774255", "createdAt": "2020-06-22T19:20:17Z", "author": {"login": "paulodamaso"}, "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -66,7 +59,8 @@ public AuthFromYaml(final YamlMapping cred) {\n         Optional<String> res = Optional.empty();\n         if (users != null && users.yamlMapping(user) != null) {\n             final String stored = users.yamlMapping(user).string(\"pass\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NzU4Mg=="}, "originalCommit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc3NjgyMA==", "bodyText": "@Vatavuk I don't think it's a good idea, here's why:\n\nvalidParams wouldn't mean nothing here, since stored and type are not login parameters, they are data stored into Yaml file instead: if they are null, means that we don't have these field for the current user;\ncheck method just checks if the two values match plainly or digested, so I don't think that we should move these tests inside this method", "url": "https://github.com/artipie/artipie/pull/215#discussion_r443776820", "createdAt": "2020-06-22T19:25:41Z", "author": {"login": "paulodamaso"}, "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -66,7 +59,8 @@ public AuthFromYaml(final YamlMapping cred) {\n         Optional<String> res = Optional.empty();\n         if (users != null && users.yamlMapping(user) != null) {\n             final String stored = users.yamlMapping(user).string(\"pass\");\n-            if (stored != null && check(stored, pass)) {\n+            final String type = users.yamlMapping(user).string(\"type\");\n+            if (stored != null && type != null && check(stored, type, pass)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3NjUyMg=="}, "originalCommit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc3NzUxOQ==", "bodyText": "@Vatavuk login will be used to provide an alternative login (there is a puzzle in AuthFromYaml)", "url": "https://github.com/artipie/artipie/pull/215#discussion_r443777519", "createdAt": "2020-06-22T19:27:14Z", "author": {"login": "paulodamaso"}, "path": "src/test/java/com/artipie/auth/AuthFromYamlTest.java", "diffHunk": "@@ -136,32 +140,46 @@ void doesNotAuthoriseByMainLogin() {\n     /**\n      * Composes yaml settings.\n      * @param user User\n+     * @param type Password type\n      * @param pass Password\n      * @return Settings\n      */\n-    private static YamlMapping settings(final String user, final String pass) {\n+    private static YamlMapping settings(\n+        final String user,\n+        final String type,\n+        final String pass) {\n         return Yaml.createYamlMappingBuilder().add(\n             \"credentials\",\n             Yaml.createYamlMappingBuilder()\n-                .add(user, Yaml.createYamlMappingBuilder().add(\"pass\", pass).build())\n-                .build()\n+                .add(\n+                    user,\n+                    Yaml.createYamlMappingBuilder()\n+                    .add(\"type\", type)\n+                    .add(\"pass\", pass).build()\n+                ).build()\n         ).build();\n     }\n \n     /**\n      * Composes yaml settings.\n      * @param user User\n+     * @param type Password type\n      * @param pass Password\n      * @param login Alternative login\n      * @return Settings\n+     * @checkstyle ParameterNumberCheck (3 lines)\n      */\n-    private static YamlMapping settings(final String user, final String pass, final String login) {\n+    private static YamlMapping settings(final String user, final String type, final String pass,\n+        final String login) {\n         return Yaml.createYamlMappingBuilder().add(\n             \"credentials\",\n             Yaml.createYamlMappingBuilder()\n                 .add(\n                     user,\n-                    Yaml.createYamlMappingBuilder().add(\"pass\", pass).add(\"login\", login).build()\n+                    Yaml.createYamlMappingBuilder()\n+                    .add(\"type\", type)\n+                    .add(\"pass\", pass)\n+                    .add(\"login\", login).build()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3ODkzOA=="}, "originalCommit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "originalPosition": 147}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MjczNDkz", "url": "https://github.com/artipie/artipie/pull/215#pullrequestreview-435273493", "createdAt": "2020-06-22T21:05:43Z", "commit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1NTAxMjA1", "url": "https://github.com/artipie/artipie/pull/215#pullrequestreview-435501205", "createdAt": "2020-06-23T07:12:51Z", "commit": {"oid": "595a33b9a1d555be458e6d3d30cc1086c6a7a80b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f1c2f4667a728779c6f40d16c822b0672dbb3fe", "author": {"user": {"login": "paulodamaso", "name": "Paulo Lobo"}}, "url": "https://github.com/artipie/artipie/commit/4f1c2f4667a728779c6f40d16c822b0672dbb3fe", "committedDate": "2020-06-30T19:35:42Z", "message": "For #203: allowing the use of two configuration schemas"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMjczMjc4", "url": "https://github.com/artipie/artipie/pull/215#pullrequestreview-442273278", "createdAt": "2020-07-03T09:18:30Z", "commit": {"oid": "4f1c2f4667a728779c6f40d16c822b0672dbb3fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60906065ab5b2f8da618342cf3540cd656d77018", "author": {"user": {"login": "g4s8", "name": "Kirill"}}, "url": "https://github.com/artipie/artipie/commit/60906065ab5b2f8da618342cf3540cd656d77018", "committedDate": "2020-07-03T09:18:37Z", "message": "Merge branch 'master' into 203"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3216, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}