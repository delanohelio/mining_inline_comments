{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNDg1MDM0", "number": 627, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo0Nzo1N1rOEnFPcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo1MDo1NFrOEnFVaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NDE1Nzk0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/artipie/api/artifactory/AddUpdatePermissionSlice.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo0Nzo1N1rOHXenOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNjozMDoyN1rOHXjHeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4MDg1Ng==", "bodyText": "@olenagerasimova /readers group should be added only if new repository is created. Otherwise it won't be possible to revoke permissions for the group", "url": "https://github.com/artipie/artipie/pull/627#discussion_r494380856", "createdAt": "2020-09-24T14:47:57Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/api/artifactory/AddUpdatePermissionSlice.java", "diffHunk": "@@ -142,6 +143,7 @@ public Response response(final String line, final Iterable<Map.Entry<String, Str\n                     )\n                 )\n         );\n+        res.add(new RepoPermissions.PermissionItem(\"/readers\", new ListOf<String>(\"read\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30df9040dbd6af203ae04f84a3ef01af5ff3cfcf"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQwNTU2NQ==", "bodyText": "@olegmoz are you sure such behavior will be correct from our colleagues point of view? As far as I understood, users always have read permission", "url": "https://github.com/artipie/artipie/pull/627#discussion_r494405565", "createdAt": "2020-09-24T15:20:35Z", "author": {"login": "olenagerasimova"}, "path": "src/main/java/com/artipie/api/artifactory/AddUpdatePermissionSlice.java", "diffHunk": "@@ -142,6 +143,7 @@ public Response response(final String line, final Iterable<Map.Entry<String, Str\n                     )\n                 )\n         );\n+        res.add(new RepoPermissions.PermissionItem(\"/readers\", new ListOf<String>(\"read\")));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4MDg1Ng=="}, "originalCommit": {"oid": "30df9040dbd6af203ae04f84a3ef01af5ff3cfcf"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDQ1NDY0OQ==", "bodyText": "@olenagerasimova I tried to lookup requirements about it and cannot really find direct answer. So let's assume readers group is always present in repository and all users are in readers group.\nStill there is a problem in this line: we need to add readers group to the list only if it is absent in request. Otherwise it is going to be duplicated if user is loaded and the saved as-is. The same goes for adding readers group to user in AddUpdateUserSlice class.", "url": "https://github.com/artipie/artipie/pull/627#discussion_r494454649", "createdAt": "2020-09-24T16:30:27Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/api/artifactory/AddUpdatePermissionSlice.java", "diffHunk": "@@ -142,6 +143,7 @@ public Response response(final String line, final Iterable<Map.Entry<String, Str\n                     )\n                 )\n         );\n+        res.add(new RepoPermissions.PermissionItem(\"/readers\", new ListOf<String>(\"read\")));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4MDg1Ng=="}, "originalCommit": {"oid": "30df9040dbd6af203ae04f84a3ef01af5ff3cfcf"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NDE3MzIwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/artipie/api/artifactory/AddUpdateUserSlice.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo1MDo1NFrOHXewcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxNDo1MDo1NFrOHXewcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDM4MzIxNw==", "bodyText": "@olenagerasimova same as with adding readers group to repository, this should be done only on new user creation", "url": "https://github.com/artipie/artipie/pull/627#discussion_r494383217", "createdAt": "2020-09-24T14:50:54Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/api/artifactory/AddUpdateUserSlice.java", "diffHunk": "@@ -108,11 +108,12 @@ public Response response(final String line, final Iterable<Map.Entry<String, Str\n             json -> {\n                 final Optional<Pair<Users.User, String>> res;\n                 if (json.containsKey(pswd) && json.containsKey(email)) {\n-                    List<String> list = Collections.emptyList();\n+                    List<String> list = new ArrayList<>(1);\n                     if (json.containsKey(groups)) {\n                         list = json.getJsonArray(groups).getValuesAs(JsonString.class)\n                             .stream().map(JsonString::getString).collect(Collectors.toList());\n                     }\n+                    list.add(\"readers\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30df9040dbd6af203ae04f84a3ef01af5ff3cfcf"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2014, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}