{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MTYyMTg2", "number": 39, "title": "For #35: removed redundant methods for YamlSettings", "bodyText": "For #35: removed redundant methods for YamlSettings.\n\nRemoved redundant methods from YamlSetting, which are already executed in StrictYamlMapping;\nLeft question in issue about how StrictYamlMapping and YamlMapping should behave", "createdAt": "2020-03-10T14:20:53Z", "url": "https://github.com/artipie/artipie/pull/39", "merged": true, "mergeCommit": {"oid": "fcbf4cefa561b0e378fb048bc1d7b19ad9aa2f9a"}, "closed": true, "closedAt": "2020-03-12T12:14:30Z", "author": {"login": "paulodamaso"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMTPVRgH2gAyMzg2MTYyMTg2OmE2M2VmZmU0NjRjOGQxZDNhZGQ5YWQ1MDFkNTZjOTExZWE5ODQzNTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcM6qioAFqTM3MzUwMjE5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a63effe464c8d1d3add9ad501d56c911ea984357", "author": {"user": {"login": "paulodamaso", "name": "Paulo Lobo"}}, "url": "https://github.com/artipie/artipie/commit/a63effe464c8d1d3add9ad501d56c911ea984357", "committedDate": "2020-03-10T14:18:07Z", "message": "For #35: removed redundant methods for YamlSettings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjMxNDMw", "url": "https://github.com/artipie/artipie/pull/39#pullrequestreview-372631430", "createdAt": "2020-03-11T10:23:05Z", "commit": {"oid": "a63effe464c8d1d3add9ad501d56c911ea984357"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDoyMzowNlrOF0w74g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDoyMzowNlrOF0w74g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg3MjAzNA==", "bodyText": "@paulodamaso Please use the type variable declared in L58", "url": "https://github.com/artipie/artipie/pull/39#discussion_r390872034", "createdAt": "2020-03-11T10:23:06Z", "author": {"login": "HDouss"}, "path": "src/main/java/com/artipie/YamlSettings.java", "diffHunk": "@@ -53,61 +53,12 @@ public YamlSettings(final String content) {\n \n     @Override\n     public Storage storage() throws IOException {\n-        final YamlMapping yaml = this.storageYaml();\n-        final String type = string(yaml, \"type\");\n-        if (type.equals(\"fs\")) {\n-            return new FileStorage(Path.of(string(yaml, \"path\")));\n+        final YamlMapping yaml =\n+            Yaml.createYamlInput(this.content).readYamlMapping().yamlMapping(\"meta\").yamlMapping(\"storage\");\n+        final String type =  yaml.string(\"type\");\n+        if (\"fs\".equals(yaml.string(\"type\"))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a63effe464c8d1d3add9ad501d56c911ea984357"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bc4cdae98e3472b29215706718c80c75faea95e", "author": {"user": {"login": "paulodamaso", "name": "Paulo Lobo"}}, "url": "https://github.com/artipie/artipie/commit/9bc4cdae98e3472b29215706718c80c75faea95e", "committedDate": "2020-03-12T00:54:03Z", "message": "Merge remote-tracking branch 'upstream/master' into 35"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "145972ebcedd8a4d7746e43aba4ce3dba709b815", "author": {"user": {"login": "paulodamaso", "name": "Paulo Lobo"}}, "url": "https://github.com/artipie/artipie/commit/145972ebcedd8a4d7746e43aba4ce3dba709b815", "committedDate": "2020-03-12T01:04:58Z", "message": "For #35: updated eo-yaml lib and fixed YamlSettings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMzQ3Nzg5", "url": "https://github.com/artipie/artipie/pull/39#pullrequestreview-373347789", "createdAt": "2020-03-12T08:14:30Z", "commit": {"oid": "145972ebcedd8a4d7746e43aba4ce3dba709b815"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMzcwMDg0", "url": "https://github.com/artipie/artipie/pull/39#pullrequestreview-373370084", "createdAt": "2020-03-12T08:52:58Z", "commit": {"oid": "145972ebcedd8a4d7746e43aba4ce3dba709b815"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODo1Mjo1OFrOF1VxJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwODo1Mjo1OFrOF1VxJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ3NTQ5NA==", "bodyText": "@paulodamaso previously we checked that the first and second mappings are not nulls, now we check only last string using  StrictYamlMapping, so if meta mapping is null then we'll get NullPointerException here. Maybe we need some unit tests before refactoring?", "url": "https://github.com/artipie/artipie/pull/39#discussion_r391475494", "createdAt": "2020-03-12T08:52:58Z", "author": {"login": "g4s8"}, "path": "src/main/java/com/artipie/YamlSettings.java", "diffHunk": "@@ -53,61 +54,17 @@ public YamlSettings(final String content) {\n \n     @Override\n     public Storage storage() throws IOException {\n-        final YamlMapping yaml = this.storageYaml();\n-        final String type = string(yaml, \"type\");\n-        if (type.equals(\"fs\")) {\n-            return new FileStorage(Path.of(string(yaml, \"path\")));\n-        }\n-        throw new IllegalStateException(String.format(\"Unsupported storage type: '%s'\", type));\n-    }\n-\n-    /**\n-     * Read storage section from YAML.\n-     *\n-     * @return Storage section.\n-     * @throws IOException In case of problems with reading YAML from source.\n-     */\n-    private YamlMapping storageYaml() throws IOException {\n-        return mapping(\n-            mapping(\n-                Yaml.createYamlInput(this.content).readYamlMapping(),\n-                \"meta\"\n-            ),\n-            \"storage\"\n-        );\n-    }\n-\n-    /**\n-     * Gets mapping by key from YAML, fails if no such key exists.\n-     *\n-     * @param yaml YAML to take the value from.\n-     * @param key Key to take value by.\n-     * @return Value found by key.\n-     */\n-    private static YamlMapping mapping(final YamlMapping yaml, final String key) {\n-        final YamlMapping mapping = yaml.yamlMapping(key);\n-        if (mapping == null) {\n-            throw new IllegalArgumentException(\n-                String.format(\"Cannot find '%s' mapping:\\n%s\", key, yaml)\n-            );\n-        }\n-        return mapping;\n-    }\n-\n-    /**\n-     * Gets string by key from YAML, fails if no such key exists.\n-     *\n-     * @param yaml YAML to take the value from.\n-     * @param key Key to take value by.\n-     * @return Value found by key.\n-     */\n-    private static String string(final YamlMapping yaml, final String key) {\n-        final String string = yaml.string(key);\n-        if (string == null) {\n-            throw new IllegalArgumentException(\n-                String.format(\"Cannot find '%s' string:\\n%s\", key, yaml)\n+        final YamlMapping yaml =\n+            new StrictYamlMapping(\n+                Yaml.createYamlInput(this.content)\n+                .readYamlMapping()\n+                .yamlMapping(\"meta\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "145972ebcedd8a4d7746e43aba4ce3dba709b815"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNTAyMTk0", "url": "https://github.com/artipie/artipie/pull/39#pullrequestreview-373502194", "createdAt": "2020-03-12T12:14:08Z", "commit": {"oid": "145972ebcedd8a4d7746e43aba4ce3dba709b815"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3134, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}