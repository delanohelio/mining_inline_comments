{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzOTMxNTA3", "number": 566, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzo1MjowOVrOEibBlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzo1NDo1OVrOEibFqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NTI5ODE1OnYy", "diffSide": "RIGHT", "path": "src/test/java/com/artipie/api/artifactory/GetPermissionSliceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzo1MjowOVrOHQSQQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzo1MjowOVrOHQSQQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgzODMzNg==", "bodyText": "@olenagerasimova this variable is useless, we may just put into string", "url": "https://github.com/artipie/artipie/pull/566#discussion_r486838336", "createdAt": "2020-09-11T07:52:09Z", "author": {"login": "olegmoz"}, "path": "src/test/java/com/artipie/api/artifactory/GetPermissionSliceTest.java", "diffHunk": "@@ -72,6 +72,18 @@ void returnsBadRequestOnInvalidRequest() {\n         );\n     }\n \n+    @Test\n+    void returnsNotFoundIfRepoDoesNotExists() {\n+        final String repo = \"pypi\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a97328d093fd78433f68338c23245fa49c0018d"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0NTMwODU3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/artipie/api/artifactory/GetPermissionSlice.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzo1NDo1OVrOHQSWmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzo1NDo1OVrOHQSWmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgzOTk2Mw==", "bodyText": "@olenagerasimova we may wrap only the code in opt.map(...) with AsyncResponse and also return RsWithStatus without wrapping it into CompletableFuture in .orElse(...). This will simplify code a little bit", "url": "https://github.com/artipie/artipie/pull/566#discussion_r486839963", "createdAt": "2020-09-11T07:54:59Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/api/artifactory/GetPermissionSlice.java", "diffHunk": "@@ -65,12 +70,27 @@ public GetPermissionSlice(final Settings settings) {\n     public Response response(final String line, final Iterable<Map.Entry<String, String>> headers,\n         final Publisher<ByteBuffer> body) {\n         final Optional<String> opt = new FromRqLine(line, FromRqLine.RqPattern.REPO).get();\n-        return opt.<Response>map(\n-            repo -> new AsyncResponse(\n-                new RepoPermissions.FromSettings(this.settings).permissions(repo)\n-                    .thenApply(map -> new RsJson(GetPermissionSlice.response(map, repo)))\n-            )\n-        ).orElse(new RsWithStatus(RsStatus.BAD_REQUEST));\n+        return new AsyncResponse(\n+            opt.map(\n+                repo -> new Unchecked<>(this.settings::storage).value()\n+                    .exists(new Key.From(String.format(\"%s.yaml\", repo))).thenCompose(\n+                        exists -> {\n+                            final CompletionStage<Response> res;\n+                            if (exists) {\n+                                res = new RepoPermissions.FromSettings(this.settings)\n+                                    .permissions(repo).thenApply(\n+                                        perms -> new RsJson(\n+                                            GetPermissionSlice.response(perms, repo)\n+                                        )\n+                                    );\n+                            } else {\n+                                res = CompletableFuture.completedStage(StandardRs.NOT_FOUND);\n+                            }\n+                            return res;\n+                        }\n+                    )\n+            ).orElse(CompletableFuture.completedFuture(new RsWithStatus(RsStatus.BAD_REQUEST)))\n+        );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a97328d093fd78433f68338c23245fa49c0018d"}, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2179, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}