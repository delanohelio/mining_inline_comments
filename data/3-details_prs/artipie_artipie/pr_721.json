{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5ODk3NTIz", "number": 721, "title": "#605 - Verify with authentication in npmIT", "bodyText": "Closes #605\nVerify installation and publishing with authentication in npmITCase", "createdAt": "2020-10-26T09:31:46Z", "url": "https://github.com/artipie/artipie/pull/721", "merged": true, "mergeCommit": {"oid": "5dd17484af23777e83e66e7a3947a37100a37f2f"}, "closed": true, "closedAt": "2020-10-26T13:06:44Z", "author": {"login": "genryxy"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWQ81jAH2gAyNTA5ODk3NTIzOjYzZWU0Y2Y3ZTg3MjZkMzFmOTc5ZWFhYmMyNGZiYjY1ZmM1MjRmN2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWTuwRAH2gAyNTA5ODk3NTIzOmQ4NTVmZTY0ZTU1MmRiODNhYTEwOGNlNDRkMmMyN2FmMmNkMTkzYjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "63ee4cf7e8726d31f979eaabc24fbb65fc524f7a", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/63ee4cf7e8726d31f979eaabc24fbb65fc524f7a", "committedDate": "2020-10-26T09:28:30Z", "message": "#605 - Verify install and publish with auth"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Njk3OTIw", "url": "https://github.com/artipie/artipie/pull/721#pullrequestreview-516697920", "createdAt": "2020-10-26T11:45:10Z", "commit": {"oid": "63ee4cf7e8726d31f979eaabc24fbb65fc524f7a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTo0NToxMFrOHoL4sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTo0NTo1NFrOHoL6IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg5OTgyNg==", "bodyText": "@genryxy it looks like here you check too many details about output. I think it will be enough to see that there is error message with 403 Forbidden text. Building whole URL looks excessive.", "url": "https://github.com/artipie/artipie/pull/721#discussion_r511899826", "createdAt": "2020-10-26T11:45:10Z", "author": {"login": "olegmoz"}, "path": "src/test/java/com/artipie/npm/NpmITCase.java", "diffHunk": "@@ -153,6 +166,46 @@ void npmPublish() throws Exception {\n         );\n     }\n \n+    @Test\n+    void npmInstallFailWithForbidden() throws Exception {\n+        final ArtipieServer.User user = ArtipieServer.BOB;\n+        this.init(false);\n+        this.saveFilesToStrg(NpmITCase.PROJ);\n+        MatcherAssert.assertThat(\n+            this.exec(\n+                \"npm\", \"install\", NpmITCase.PROJ,\n+                \"--registry\", this.url(Optional.of(user))\n+            ).getStderr().replaceAll(\"\\n\", \"\"),\n+            new StringContains(\n+                String.format(\n+                    \"npm ERR! 403 403 Forbidden - GET http://%s:***@%s:%d/my-npm/%s\",\n+                    user.name(), NpmITCase.HOST, this.port, NpmITCase.PROJ.replace(\"/\", \"%2f\")\n+                )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63ee4cf7e8726d31f979eaabc24fbb65fc524f7a"}, "originalPosition": 142}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkwMDE5Mg==", "bodyText": "@genryxy same concern about checking URL", "url": "https://github.com/artipie/artipie/pull/721#discussion_r511900192", "createdAt": "2020-10-26T11:45:54Z", "author": {"login": "olegmoz"}, "path": "src/test/java/com/artipie/npm/NpmITCase.java", "diffHunk": "@@ -153,6 +166,46 @@ void npmPublish() throws Exception {\n         );\n     }\n \n+    @Test\n+    void npmInstallFailWithForbidden() throws Exception {\n+        final ArtipieServer.User user = ArtipieServer.BOB;\n+        this.init(false);\n+        this.saveFilesToStrg(NpmITCase.PROJ);\n+        MatcherAssert.assertThat(\n+            this.exec(\n+                \"npm\", \"install\", NpmITCase.PROJ,\n+                \"--registry\", this.url(Optional.of(user))\n+            ).getStderr().replaceAll(\"\\n\", \"\"),\n+            new StringContains(\n+                String.format(\n+                    \"npm ERR! 403 403 Forbidden - GET http://%s:***@%s:%d/my-npm/%s\",\n+                    user.name(), NpmITCase.HOST, this.port, NpmITCase.PROJ.replace(\"/\", \"%2f\")\n+                )\n+            )\n+        );\n+    }\n+\n+    @Test\n+    void npmPublishFailWithForbidden() throws Exception {\n+        final ArtipieServer.User user = ArtipieServer.BOB;\n+        this.init(false);\n+        new TestResource(\"npm/simple-npm-project\")\n+            .addFilesTo(this.storage, new Key.From(NpmITCase.PROJ));\n+        MatcherAssert.assertThat(\n+            \"Package was published\",\n+            this.exec(\n+                \"npm\", \"publish\", NpmITCase.PROJ,\n+                \"--registry\", this.url(Optional.of(user))\n+            ).getStderr().replaceAll(\"\\n\", \"\"),\n+            new StringContains(\n+                String.format(\n+                    \"npm ERR! 403 403 Forbidden - PUT http://%s:***@%s:%d/my-npm/%s\",\n+                    user.name(), NpmITCase.HOST, this.port, NpmITCase.PROJ.replace(\"/\", \"%2f\")\n+                )\n+            )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63ee4cf7e8726d31f979eaabc24fbb65fc524f7a"}, "originalPosition": 164}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09c64c3f19e8de61d0ef5d3c5ad55e66a639e262", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/09c64c3f19e8de61d0ef5d3c5ad55e66a639e262", "committedDate": "2020-10-26T12:10:28Z", "message": "#605 - CR"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NzM2ODk5", "url": "https://github.com/artipie/artipie/pull/721#pullrequestreview-516736899", "createdAt": "2020-10-26T12:42:43Z", "commit": {"oid": "09c64c3f19e8de61d0ef5d3c5ad55e66a639e262"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d855fe64e552db83aa108ce44d2c27af2cd193b1", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/d855fe64e552db83aa108ce44d2c27af2cd193b1", "committedDate": "2020-10-26T12:42:50Z", "message": "Merge branch 'master' into 605-npmITWithAuth"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3444, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}