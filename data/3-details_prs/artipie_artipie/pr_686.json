{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNDg4NTY1", "number": 686, "title": "#633 - Response 404 to request not related to repos", "bodyText": "Closes #633\nRespond with 404 to request not related to repositories in SliceByPath", "createdAt": "2020-10-12T10:40:12Z", "url": "https://github.com/artipie/artipie/pull/686", "merged": true, "mergeCommit": {"oid": "c377343c2382fb6556b3e458b7caccc721571b63"}, "closed": true, "closedAt": "2020-10-13T06:23:50Z", "author": {"login": "genryxy"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRxi5ogH2gAyNTAxNDg4NTY1OmM2ZDVlMjYzN2YzMTRlZjUyYWM5MDU1NTJmNWI2NjUxYzYyMTY3YTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR0o_XgH2gAyNTAxNDg4NTY1OjhiOTQ0NDIyMmZjMjZkNzE5MjIxMjFjMTBiZTkyNjM1ZGExZTQ0MjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c6d5e2637f314ef52ac905552f5b6651c62167a7", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/c6d5e2637f314ef52ac905552f5b6651c62167a7", "committedDate": "2020-10-12T10:37:25Z", "message": "#633 - Response 404 to request not related to repos"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e367e75ff9c09181c2b85ff00f685564cddd728", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/6e367e75ff9c09181c2b85ff00f685564cddd728", "committedDate": "2020-10-12T10:54:11Z", "message": "#633 - Fix condition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NTI5MDY1", "url": "https://github.com/artipie/artipie/pull/686#pullrequestreview-506529065", "createdAt": "2020-10-12T11:19:44Z", "commit": {"oid": "6e367e75ff9c09181c2b85ff00f685564cddd728"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMToxOTo0NVrOHf6dEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMToyMToyMFrOHf6gaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzIyNTYxOA==", "bodyText": "@genryxy I see that you use Key.ROOT as special value that means repository name cannot be extracted from path. That is not that great design to have such values with special handling. It will be more obvious to return Optional<Key> from method and have special handling for absent value", "url": "https://github.com/artipie/artipie/pull/686#discussion_r503225618", "createdAt": "2020-10-12T11:19:45Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/http/SliceByPath.java", "diffHunk": "@@ -76,18 +76,13 @@ public Response response(final String line, final Iterable<Map.Entry<String, Str\n         final Publisher<ByteBuffer> body) {\n         final Key key;\n         try {\n-            final String[] split = new RequestLineFrom(line).uri().getPath()\n-                .replaceAll(\"^/+\", \"\").split(\"/\");\n-            if (this.settings.layout().equals(\"org\")) {\n-                if (split.length < 2) {\n-                    throw new IllegalStateException(\"Expected at least 2 path segments\");\n-                }\n-                key = new Key.From(split[0], split[1]);\n-            } else {\n-                if (split.length < 1) {\n-                    throw new IllegalStateException(\"Expected at least 1 path segment\");\n-                }\n-                key = new Key.From(split[0]);\n+            key = this.keyFromPath(new RequestLineFrom(line).uri().getPath());\n+            if (key.equals(Key.ROOT)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e367e75ff9c09181c2b85ff00f685564cddd728"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzIyNjQ3Mg==", "bodyText": "@genryxy using not final variables should be avoided. Mutable values make code harder to understand. Please change key variable to be final.", "url": "https://github.com/artipie/artipie/pull/686#discussion_r503226472", "createdAt": "2020-10-12T11:21:20Z", "author": {"login": "olegmoz"}, "path": "src/main/java/com/artipie/http/SliceByPath.java", "diffHunk": "@@ -98,4 +93,25 @@ public Response response(final String line, final Iterable<Map.Entry<String, Str\n             );\n         }\n     }\n+\n+    /**\n+     * Key from path.\n+     * @param path Path from request line\n+     * @return Key from path.\n+     * @throws IOException In case of problems with reading settings.\n+     */\n+    private Key keyFromPath(final String path) throws IOException {\n+        final String[] split = path.replaceAll(\"^/+\", \"\").split(\"/\");\n+        Key key = Key.ROOT;\n+        if (this.settings.layout().equals(\"org\")) {\n+            if (split.length >= 2) {\n+                key = new Key.From(split[0], split[1]);\n+            }\n+        } else {\n+            if (split.length >= 1) {\n+                key = new Key.From(split[0]);\n+            }\n+        }\n+        return key;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e367e75ff9c09181c2b85ff00f685564cddd728"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30e001a06bcc689d476bf73b188409d99a4654a5", "author": {"user": {"login": "genryxy", "name": "Alexander"}}, "url": "https://github.com/artipie/artipie/commit/30e001a06bcc689d476bf73b188409d99a4654a5", "committedDate": "2020-10-12T12:35:42Z", "message": "#633 - CR"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NjU3MTI1", "url": "https://github.com/artipie/artipie/pull/686#pullrequestreview-506657125", "createdAt": "2020-10-12T14:13:16Z", "commit": {"oid": "30e001a06bcc689d476bf73b188409d99a4654a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b9444222fc26d71922121c10be92635da1e4424", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/8b9444222fc26d71922121c10be92635da1e4424", "committedDate": "2020-10-12T14:13:47Z", "message": "Merge branch 'master' into 633-rsNotFound"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3424, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}