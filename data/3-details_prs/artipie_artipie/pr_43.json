{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3NjY3NzE2", "number": 43, "title": "Add dockerfile", "bodyText": "The first step of #41", "createdAt": "2020-03-13T09:09:18Z", "url": "https://github.com/artipie/artipie/pull/43", "merged": true, "mergeCommit": {"oid": "d20571ed1cc672a11b8c7a31c9deccb3e9118c7c"}, "closed": true, "closedAt": "2020-03-18T14:05:09Z", "author": {"login": "Sammers21"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcM7cxeAH2gAyMzg3NjY3NzE2OmIyNzg5NTRlNWMxNzg2YWZjOWE5NzcyNTg1ODhmZGI0MTA0Nzg4ODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO32I0AFqTM3Njg5NDAxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b278954e5c1786afc9a977258588fdb410478884", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/b278954e5c1786afc9a977258588fdb410478884", "committedDate": "2020-03-12T13:09:00Z", "message": "add docker image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "980ac3f23cbd13a7e712f06218c787cb44bbf89c", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/980ac3f23cbd13a7e712f06218c787cb44bbf89c", "committedDate": "2020-03-13T08:37:52Z", "message": "attempt to pack with graalvm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4de46d5cc622a7dea20b999e37b2567399950572", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/4de46d5cc622a7dea20b999e37b2567399950572", "committedDate": "2020-03-13T09:08:04Z", "message": "finalize docker file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4461f3e2d3059fb4574f815f9985088631ef239c", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/4461f3e2d3059fb4574f815f9985088631ef239c", "committedDate": "2020-03-13T09:09:24Z", "message": "Merge branch 'master' into add_docker"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NDI3MzQ5", "url": "https://github.com/artipie/artipie/pull/43#pullrequestreview-374427349", "createdAt": "2020-03-13T16:09:50Z", "commit": {"oid": "4461f3e2d3059fb4574f815f9985088631ef239c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjowOTo1MFrOF2Jolw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjoxNDowMlrOF2JyLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyNTI3MQ==", "bodyText": "@Sammers21 I would recommend changing(just single RUN) the above instructions a little bit just to save one layers:\nFROM maven:3.6.3-jdk-13 as build_jar\nWORKDIR /jar\nCOPY pom.xml .\nCOPY src/ /jar/src/\nRUN yum install git -y && \\ \n        mvn dependency:go-offline && \\\n        mvn package", "url": "https://github.com/artipie/artipie/pull/43#discussion_r392325271", "createdAt": "2020-03-13T16:09:50Z", "author": {"login": "fanifieiev"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,22 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4461f3e2d3059fb4574f815f9985088631ef239c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyNzcyNg==", "bodyText": "@Sammers21 Also would recommend just a single RUN", "url": "https://github.com/artipie/artipie/pull/43#discussion_r392327726", "createdAt": "2020-03-13T16:14:02Z", "author": {"login": "fanifieiev"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,22 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package\n+\n+FROM adoptopenjdk/openjdk13:alpine-jre\n+WORKDIR /artipie\n+COPY --from=build_jar /jar/target/artipie-jar-with-dependencies.jar /artipie/artipie.jar\n+VOLUME /artipie/repositories\n+RUN echo -e \"meta:\\n\\\n+  storage:\\n\\\n+    type: fs\\n\\\n+    path: /artipie/repositories\\n\"\\\n+>> /artipie/config.yml\n+RUN cat  /artipie/config.yml", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4461f3e2d3059fb4574f815f9985088631ef239c"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d292b1ae971c7c61ef506dbb1c0318cb9f957a6", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/4d292b1ae971c7c61ef506dbb1c0318cb9f957a6", "committedDate": "2020-03-16T10:36:10Z", "message": "remove ` cat  /artipie/config.yml` step"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ec3618fd27a286a3e86c26c40bd3ab088a03dc2", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/8ec3618fd27a286a3e86c26c40bd3ab088a03dc2", "committedDate": "2020-03-16T10:36:40Z", "message": "Merge branch 'add_docker' of github.com:Sammers21/artipie into add_docker"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1MTI0MDYy", "url": "https://github.com/artipie/artipie/pull/43#pullrequestreview-375124062", "createdAt": "2020-03-16T11:31:03Z", "commit": {"oid": "8ec3618fd27a286a3e86c26c40bd3ab088a03dc2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/adb9dc50a35797978f34ff9c663df3a2101b9562", "committedDate": "2020-03-16T14:16:12Z", "message": "Merge branch 'master' into add_docker"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NjQwMTY1", "url": "https://github.com/artipie/artipie/pull/43#pullrequestreview-375640165", "createdAt": "2020-03-16T23:03:01Z", "commit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTE1MTA3", "url": "https://github.com/artipie/artipie/pull/43#pullrequestreview-376115107", "createdAt": "2020-03-17T14:57:41Z", "commit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo1Nzo0MVrOF3gFog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTowOTozOVrOF3gnoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0MTczMA==", "bodyText": "@Sammers21 let's set a version from docker args:\nFROM ...\nARG version=\"1.0-SNAPSHOT\"\n# ...\nRUN mvn versions:set -DnewVersion=${version} && mvn package -B --quiet\nThen we can build it like docker build --build-arg=\"version=${BUILD_TAG}\" and git tag will be propagated to jar manifest.\nAlso, I'd use -B and --quiet options for mvn package, since most probably build will be called from CD tools.", "url": "https://github.com/artipie/artipie/pull/43#discussion_r393741730", "createdAt": "2020-03-17T14:57:41Z", "author": {"login": "g4s8"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,21 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0Mjg0Ng==", "bodyText": "@Sammers21 it can be COPY src/ .", "url": "https://github.com/artipie/artipie/pull/43#discussion_r393742846", "createdAt": "2020-03-17T14:59:08Z", "author": {"login": "g4s8"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,21 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0MzQ5NA==", "bodyText": "@Sammers21 please add description metadata: LABEL Description=\"Artipie ...\"", "url": "https://github.com/artipie/artipie/pull/43#discussion_r393743494", "createdAt": "2020-03-17T14:59:59Z", "author": {"login": "g4s8"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,21 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0Mzg3MQ==", "bodyText": "@Sammers21 it can be COPY --from=build_jar /jar/target/artipie-jar-with-dependencies.jar .", "url": "https://github.com/artipie/artipie/pull/43#discussion_r393743871", "createdAt": "2020-03-17T15:00:28Z", "author": {"login": "g4s8"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,21 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package\n+\n+FROM adoptopenjdk/openjdk13:alpine-jre\n+WORKDIR /artipie\n+COPY --from=build_jar /jar/target/artipie-jar-with-dependencies.jar /artipie/artipie.jar", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc1MDQzMw==", "bodyText": "@Sammers21 first: let's use command line options instead of system properties, second: I think it would be to specify entrypoint as java artipie.jar but command as --port=80 --storage=/artipie/config - then user will be able to customize CMD options, e.g. by using docker run artipie:1.0 --storage=s3:///bucket/configs", "url": "https://github.com/artipie/artipie/pull/43#discussion_r393750433", "createdAt": "2020-03-17T15:09:39Z", "author": {"login": "g4s8"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,21 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package\n+\n+FROM adoptopenjdk/openjdk13:alpine-jre\n+WORKDIR /artipie\n+COPY --from=build_jar /jar/target/artipie-jar-with-dependencies.jar /artipie/artipie.jar\n+VOLUME /artipie/repositories\n+RUN echo -e \"meta:\\n\\\n+  storage:\\n\\\n+    type: fs\\n\\\n+    path: /artipie/repositories\\n\"\\\n+>> /artipie/config.yml\n+EXPOSE 80\n+ENTRYPOINT java -Dartipie.storage=/artipie/config.yml \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3c40c983d57c5f4f274fb167a3cf92933be196d", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/c3c40c983d57c5f4f274fb167a3cf92933be196d", "committedDate": "2020-03-18T12:55:20Z", "message": "add -B and --quiet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b622bcee1cb31955eea3b3e54a54c0645f5d59af", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/b622bcee1cb31955eea3b3e54a54c0645f5d59af", "committedDate": "2020-03-18T12:55:39Z", "message": "Merge branch 'master' of https://github.com/artipie/artipie into add_docker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83144dc084f5aad4554c8c04beec12465a434686", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/83144dc084f5aad4554c8c04beec12465a434686", "committedDate": "2020-03-18T12:58:58Z", "message": "add propagate todo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0a71cb8e42a6d6a6c4d3b0929722c81fbaf60bf", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/e0a71cb8e42a6d6a6c4d3b0929722c81fbaf60bf", "committedDate": "2020-03-18T13:13:44Z", "message": "'COPY src/ /jar/src/' -> 'COPY src/ .'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0372a724e2a0897d316b3ec00baa0aab459a5236", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/0372a724e2a0897d316b3ec00baa0aab459a5236", "committedDate": "2020-03-18T13:29:23Z", "message": "add cmd with default launch options"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c39c764727811401924f5ff4842d29148811b5d8", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/c39c764727811401924f5ff4842d29148811b5d8", "committedDate": "2020-03-18T13:29:46Z", "message": "Merge branch 'add_docker' of github.com:Sammers21/artipie into add_docker"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58ed3abd94922a217868f67e15632c5cc8c26fb2", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/58ed3abd94922a217868f67e15632c5cc8c26fb2", "committedDate": "2020-03-18T13:36:54Z", "message": "don't use relative path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0c8f16467f2f08060df90e9ceb043b83f364877", "author": {"user": {"login": "Sammers21", "name": "Pavel Drankov"}}, "url": "https://github.com/artipie/artipie/commit/a0c8f16467f2f08060df90e9ceb043b83f364877", "committedDate": "2020-03-18T14:04:19Z", "message": "add 30 min to puzzle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2ODk0MDE5", "url": "https://github.com/artipie/artipie/pull/43#pullrequestreview-376894019", "createdAt": "2020-03-18T14:04:56Z", "commit": {"oid": "a0c8f16467f2f08060df90e9ceb043b83f364877"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3138, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}