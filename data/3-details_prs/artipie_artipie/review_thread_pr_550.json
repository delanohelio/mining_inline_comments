{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5NzI0MTc1", "number": 550, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMjo0MTozMFrOEg7Aig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMjo0MTo1M1rOEg7BBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyOTU2NjgyOnYy", "diffSide": "RIGHT", "path": "benchmarks/index.html", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMjo0MTozMFrOHN99ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMjo0MzoxMlrOHN-Axg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwODY3Nw==", "bodyText": "@Sammers21 I don't think we need to hard-code Docker benchmarks in code, how we will switch between benchmarks when we have many of them?", "url": "https://github.com/artipie/artipie/pull/550#discussion_r484408677", "createdAt": "2020-09-07T12:41:30Z", "author": {"login": "g4s8"}, "path": "benchmarks/index.html", "diffHunk": "@@ -1,21 +1,103 @@\n <!DOCTYPE html>\n <html>\n-  <body>\n-    <script>\n-      (async () => {\n-        const response = await fetch('https://api.github.com/repos/artipie/artipie/contents/benchmarks?ref=gh-pages');\n-        const data = await response.json();\n-        let htmlString = '<h1>Performance tests</h1><ul>';\n-        for (let file of data) {\n-          if (file.type === 'dir') {\n-            htmlString += `<li>${file.name}</li><ul>`;\n-            htmlString += `<li><a href=\"${file.name}/files/upload/index.html\">Files upload</a></li>`;\n-            htmlString += '</ul>';\n-          }\n+<body>\n+<script src=\"https://cdn.jsdelivr.net/npm/chart.js@2.8.0\"></script>\n+<div class=\"chart-container\" style=\"position: relative; height:30vh; width:80vw\">\n+    <canvas id=\"docker_single_upload\"></canvas>\n+</div>\n+<script>\n+    /**\n+     * Compare strings with numeric versions\n+     * @param one The one string\n+     * @param another The another string\n+     * @returns {number} The result of comparison\n+     */\n+    function compareDottedString(one, another) {\n+        let a1 = one.split('.');\n+        let b1 = another.split('.');\n+        let len = Math.max(a1.length, b1.length);\n+        for (var i = 0; i < len; i++) {\n+            let _a = +a1[i] || 0;\n+            let _b = +b1[i] || 0;\n+            if (_a === _b) continue;\n+            else return _a > _b ? 1 : -1\n         }\n-        htmlString += '</ul>';\n-        document.getElementsByTagName('body')[0].innerHTML = htmlString;\n-      })()\n-    </script>\n-  </body>\n+        return 0;\n+    }\n+\n+    (async () => {\n+        let repository = 'artipie/artipie';\n+        let branch = 'gh-pages';\n+        const response = await fetch(`https://api.github.com/repos/${repository}/contents/benchmarks?ref=${branch}`);\n+        const data = await response.json()\n+\n+        // array of benchmarks results and versions\n+        let results = (await Promise.all(\n+                data.filter(el => el.type === 'dir')\n+                    .map(el => {\n+                        let version = el.name;\n+                        return fetch(\n+                            `https://raw.githubusercontent.com/${repository}/${branch}/benchmarks/${version}/benchmark-results.json`\n+                        ).then(response => {\n+                            if (!response.ok) {\n+                                throw new Error(`Can't find results for version ${version}`)\n+                            }\n+                            return response.json()\n+                        }).then(json => {\n+                            return {\n+                                \"version\": version,\n+                                \"results\": json\n+                            }\n+                        }).catch(er => {\n+                        })\n+                    })\n+            )\n+        ).filter(el => el !== undefined)\n+            .sort((one, another) => compareDottedString(one.version, another.version))\n+\n+\n+        // Draw Chart\n+        let labels = results.map(json => json.version)\n+        let dt = results.map(json => json.results.docker[\"single-upload\"].artipie.images[0].ubuntu)\n+        let ctx = document.getElementById('docker_single_upload').getContext('2d');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e85d5a4dfa312d7a9e1bab939e91cf7243e4e8c2"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwOTU0Mg==", "bodyText": "@g4s8, it is the first step. Anything else will come later", "url": "https://github.com/artipie/artipie/pull/550#discussion_r484409542", "createdAt": "2020-09-07T12:43:12Z", "author": {"login": "Sammers21"}, "path": "benchmarks/index.html", "diffHunk": "@@ -1,21 +1,103 @@\n <!DOCTYPE html>\n <html>\n-  <body>\n-    <script>\n-      (async () => {\n-        const response = await fetch('https://api.github.com/repos/artipie/artipie/contents/benchmarks?ref=gh-pages');\n-        const data = await response.json();\n-        let htmlString = '<h1>Performance tests</h1><ul>';\n-        for (let file of data) {\n-          if (file.type === 'dir') {\n-            htmlString += `<li>${file.name}</li><ul>`;\n-            htmlString += `<li><a href=\"${file.name}/files/upload/index.html\">Files upload</a></li>`;\n-            htmlString += '</ul>';\n-          }\n+<body>\n+<script src=\"https://cdn.jsdelivr.net/npm/chart.js@2.8.0\"></script>\n+<div class=\"chart-container\" style=\"position: relative; height:30vh; width:80vw\">\n+    <canvas id=\"docker_single_upload\"></canvas>\n+</div>\n+<script>\n+    /**\n+     * Compare strings with numeric versions\n+     * @param one The one string\n+     * @param another The another string\n+     * @returns {number} The result of comparison\n+     */\n+    function compareDottedString(one, another) {\n+        let a1 = one.split('.');\n+        let b1 = another.split('.');\n+        let len = Math.max(a1.length, b1.length);\n+        for (var i = 0; i < len; i++) {\n+            let _a = +a1[i] || 0;\n+            let _b = +b1[i] || 0;\n+            if (_a === _b) continue;\n+            else return _a > _b ? 1 : -1\n         }\n-        htmlString += '</ul>';\n-        document.getElementsByTagName('body')[0].innerHTML = htmlString;\n-      })()\n-    </script>\n-  </body>\n+        return 0;\n+    }\n+\n+    (async () => {\n+        let repository = 'artipie/artipie';\n+        let branch = 'gh-pages';\n+        const response = await fetch(`https://api.github.com/repos/${repository}/contents/benchmarks?ref=${branch}`);\n+        const data = await response.json()\n+\n+        // array of benchmarks results and versions\n+        let results = (await Promise.all(\n+                data.filter(el => el.type === 'dir')\n+                    .map(el => {\n+                        let version = el.name;\n+                        return fetch(\n+                            `https://raw.githubusercontent.com/${repository}/${branch}/benchmarks/${version}/benchmark-results.json`\n+                        ).then(response => {\n+                            if (!response.ok) {\n+                                throw new Error(`Can't find results for version ${version}`)\n+                            }\n+                            return response.json()\n+                        }).then(json => {\n+                            return {\n+                                \"version\": version,\n+                                \"results\": json\n+                            }\n+                        }).catch(er => {\n+                        })\n+                    })\n+            )\n+        ).filter(el => el !== undefined)\n+            .sort((one, another) => compareDottedString(one.version, another.version))\n+\n+\n+        // Draw Chart\n+        let labels = results.map(json => json.version)\n+        let dt = results.map(json => json.results.docker[\"single-upload\"].artipie.images[0].ubuntu)\n+        let ctx = document.getElementById('docker_single_upload').getContext('2d');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwODY3Nw=="}, "originalCommit": {"oid": "e85d5a4dfa312d7a9e1bab939e91cf7243e4e8c2"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyOTU2ODA3OnYy", "diffSide": "RIGHT", "path": "benchmarks/index.html", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMjo0MTo1M1rOHN9-JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMjo0MzoyNVrOHN-BMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwODg2OA==", "bodyText": "@Sammers21 and same here: \"Docker...\" hardcoded", "url": "https://github.com/artipie/artipie/pull/550#discussion_r484408868", "createdAt": "2020-09-07T12:41:53Z", "author": {"login": "g4s8"}, "path": "benchmarks/index.html", "diffHunk": "@@ -1,21 +1,103 @@\n <!DOCTYPE html>\n <html>\n-  <body>\n-    <script>\n-      (async () => {\n-        const response = await fetch('https://api.github.com/repos/artipie/artipie/contents/benchmarks?ref=gh-pages');\n-        const data = await response.json();\n-        let htmlString = '<h1>Performance tests</h1><ul>';\n-        for (let file of data) {\n-          if (file.type === 'dir') {\n-            htmlString += `<li>${file.name}</li><ul>`;\n-            htmlString += `<li><a href=\"${file.name}/files/upload/index.html\">Files upload</a></li>`;\n-            htmlString += '</ul>';\n-          }\n+<body>\n+<script src=\"https://cdn.jsdelivr.net/npm/chart.js@2.8.0\"></script>\n+<div class=\"chart-container\" style=\"position: relative; height:30vh; width:80vw\">\n+    <canvas id=\"docker_single_upload\"></canvas>\n+</div>\n+<script>\n+    /**\n+     * Compare strings with numeric versions\n+     * @param one The one string\n+     * @param another The another string\n+     * @returns {number} The result of comparison\n+     */\n+    function compareDottedString(one, another) {\n+        let a1 = one.split('.');\n+        let b1 = another.split('.');\n+        let len = Math.max(a1.length, b1.length);\n+        for (var i = 0; i < len; i++) {\n+            let _a = +a1[i] || 0;\n+            let _b = +b1[i] || 0;\n+            if (_a === _b) continue;\n+            else return _a > _b ? 1 : -1\n         }\n-        htmlString += '</ul>';\n-        document.getElementsByTagName('body')[0].innerHTML = htmlString;\n-      })()\n-    </script>\n-  </body>\n+        return 0;\n+    }\n+\n+    (async () => {\n+        let repository = 'artipie/artipie';\n+        let branch = 'gh-pages';\n+        const response = await fetch(`https://api.github.com/repos/${repository}/contents/benchmarks?ref=${branch}`);\n+        const data = await response.json()\n+\n+        // array of benchmarks results and versions\n+        let results = (await Promise.all(\n+                data.filter(el => el.type === 'dir')\n+                    .map(el => {\n+                        let version = el.name;\n+                        return fetch(\n+                            `https://raw.githubusercontent.com/${repository}/${branch}/benchmarks/${version}/benchmark-results.json`\n+                        ).then(response => {\n+                            if (!response.ok) {\n+                                throw new Error(`Can't find results for version ${version}`)\n+                            }\n+                            return response.json()\n+                        }).then(json => {\n+                            return {\n+                                \"version\": version,\n+                                \"results\": json\n+                            }\n+                        }).catch(er => {\n+                        })\n+                    })\n+            )\n+        ).filter(el => el !== undefined)\n+            .sort((one, another) => compareDottedString(one.version, another.version))\n+\n+\n+        // Draw Chart\n+        let labels = results.map(json => json.version)\n+        let dt = results.map(json => json.results.docker[\"single-upload\"].artipie.images[0].ubuntu)\n+        let ctx = document.getElementById('docker_single_upload').getContext('2d');\n+        new Chart(ctx, {\n+            type: 'bar',\n+            data: {\n+                labels: labels,\n+                datasets: [{\n+                    label: 'Docker single upload time',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e85d5a4dfa312d7a9e1bab939e91cf7243e4e8c2"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwOTY1MA==", "bodyText": "@g4s8, it is the first step. Anything else will come later", "url": "https://github.com/artipie/artipie/pull/550#discussion_r484409650", "createdAt": "2020-09-07T12:43:25Z", "author": {"login": "Sammers21"}, "path": "benchmarks/index.html", "diffHunk": "@@ -1,21 +1,103 @@\n <!DOCTYPE html>\n <html>\n-  <body>\n-    <script>\n-      (async () => {\n-        const response = await fetch('https://api.github.com/repos/artipie/artipie/contents/benchmarks?ref=gh-pages');\n-        const data = await response.json();\n-        let htmlString = '<h1>Performance tests</h1><ul>';\n-        for (let file of data) {\n-          if (file.type === 'dir') {\n-            htmlString += `<li>${file.name}</li><ul>`;\n-            htmlString += `<li><a href=\"${file.name}/files/upload/index.html\">Files upload</a></li>`;\n-            htmlString += '</ul>';\n-          }\n+<body>\n+<script src=\"https://cdn.jsdelivr.net/npm/chart.js@2.8.0\"></script>\n+<div class=\"chart-container\" style=\"position: relative; height:30vh; width:80vw\">\n+    <canvas id=\"docker_single_upload\"></canvas>\n+</div>\n+<script>\n+    /**\n+     * Compare strings with numeric versions\n+     * @param one The one string\n+     * @param another The another string\n+     * @returns {number} The result of comparison\n+     */\n+    function compareDottedString(one, another) {\n+        let a1 = one.split('.');\n+        let b1 = another.split('.');\n+        let len = Math.max(a1.length, b1.length);\n+        for (var i = 0; i < len; i++) {\n+            let _a = +a1[i] || 0;\n+            let _b = +b1[i] || 0;\n+            if (_a === _b) continue;\n+            else return _a > _b ? 1 : -1\n         }\n-        htmlString += '</ul>';\n-        document.getElementsByTagName('body')[0].innerHTML = htmlString;\n-      })()\n-    </script>\n-  </body>\n+        return 0;\n+    }\n+\n+    (async () => {\n+        let repository = 'artipie/artipie';\n+        let branch = 'gh-pages';\n+        const response = await fetch(`https://api.github.com/repos/${repository}/contents/benchmarks?ref=${branch}`);\n+        const data = await response.json()\n+\n+        // array of benchmarks results and versions\n+        let results = (await Promise.all(\n+                data.filter(el => el.type === 'dir')\n+                    .map(el => {\n+                        let version = el.name;\n+                        return fetch(\n+                            `https://raw.githubusercontent.com/${repository}/${branch}/benchmarks/${version}/benchmark-results.json`\n+                        ).then(response => {\n+                            if (!response.ok) {\n+                                throw new Error(`Can't find results for version ${version}`)\n+                            }\n+                            return response.json()\n+                        }).then(json => {\n+                            return {\n+                                \"version\": version,\n+                                \"results\": json\n+                            }\n+                        }).catch(er => {\n+                        })\n+                    })\n+            )\n+        ).filter(el => el !== undefined)\n+            .sort((one, another) => compareDottedString(one.version, another.version))\n+\n+\n+        // Draw Chart\n+        let labels = results.map(json => json.version)\n+        let dt = results.map(json => json.results.docker[\"single-upload\"].artipie.images[0].ubuntu)\n+        let ctx = document.getElementById('docker_single_upload').getContext('2d');\n+        new Chart(ctx, {\n+            type: 'bar',\n+            data: {\n+                labels: labels,\n+                datasets: [{\n+                    label: 'Docker single upload time',", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQwODg2OA=="}, "originalCommit": {"oid": "e85d5a4dfa312d7a9e1bab939e91cf7243e4e8c2"}, "originalPosition": 85}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2173, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}