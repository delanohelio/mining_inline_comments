{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE0NTgyNDkw", "number": 117, "title": "Return 404 if repo config doesnt exist", "bodyText": "#74 - added check if config exist and return 404 HTTP code if does not", "createdAt": "2020-05-07T09:59:38Z", "url": "https://github.com/artipie/artipie/pull/117", "merged": true, "mergeCommit": {"oid": "2ef2028f29ee2b5fa4b794091c9ed57408373f13"}, "closed": true, "closedAt": "2020-05-08T07:53:02Z", "author": {"login": "g4s8"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABce6OM8gH2gAyNDE0NTgyNDkwOmM5NjkwYWMzMmFiOWRkMmM3MWYwN2Y2YzcyMWI5NGQ2ZDc5MTFkNDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfMwRJgFqTQwODA1Mzk1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c9690ac32ab9dd2c71f07f6c721b94d6d7911d41", "author": {"user": {"login": "g4s8", "name": "Kirill"}}, "url": "https://github.com/artipie/artipie/commit/c9690ac32ab9dd2c71f07f6c721b94d6d7911d41", "committedDate": "2020-05-07T09:53:49Z", "message": "#74 - return 404 if repo canfig doesnt exist"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3Nzc1NDc1", "url": "https://github.com/artipie/artipie/pull/117#pullrequestreview-407775475", "createdAt": "2020-05-07T19:34:17Z", "commit": {"oid": "c9690ac32ab9dd2c71f07f6c721b94d6d7911d41"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTozNDoxOFrOGSNQcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QxOTozNDoxOFrOGSNQcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NDc1NQ==", "bodyText": "@g4s8 can we test this scenario?", "url": "https://github.com/artipie/artipie/pull/117#discussion_r421744755", "createdAt": "2020-05-07T19:34:18Z", "author": {"login": "Vatavuk"}, "path": "src/main/java/com/artipie/Pie.java", "diffHunk": "@@ -83,15 +87,38 @@ public Response response(final String line, final Iterable<Map.Entry<String, Str\n         }\n         final String repo = parts[0];\n         Logger.debug(this, \"Slice repo=%s\", repo);\n+        final Key.From key = new Key.From(String.format(\"%s.yaml\", repo));\n         return new AsyncSlice(\n             CompletableFuture.supplyAsync(\n                 () -> new Unchecked<>(this.settings::storage).value()\n-            )\n-                .thenComposeAsync(\n-                    storage -> storage.value(new Key.From(String.format(\"%s.yaml\", repo)))\n+            ).thenCompose(\n+                storage -> storage.exists(key).thenApply(\n+                    exist -> {\n+                        final Slice slice;\n+                        if (exist) {\n+                            slice = new AsyncSlice(\n+                                storage.value(key).thenApply(\n+                                    content -> new SliceFromConfig(\n+                                        new RepoConfig(this.vertx, content),\n+                                        this.vertx.fileSystem()\n+                                    )\n+                                )\n+                            );\n+                        } else {\n+                            slice = new SliceSimple(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9690ac32ab9dd2c71f07f6c721b94d6d7911d41"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0866563c4b6a786303859c61693fc4e305a1f4eb", "author": {"user": {"login": "g4s8", "name": "Kirill"}}, "url": "https://github.com/artipie/artipie/commit/0866563c4b6a786303859c61693fc4e305a1f4eb", "committedDate": "2020-05-08T07:24:18Z", "message": "#74 - (cr) todo for test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e74bdae795c8a1b757d01ff85a18c1dd51f91c83", "author": {"user": {"login": "g4s8", "name": "Kirill"}}, "url": "https://github.com/artipie/artipie/commit/e74bdae795c8a1b757d01ff85a18c1dd51f91c83", "committedDate": "2020-05-08T07:24:35Z", "message": "Merge branch 'master' into 74"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MDUzOTU5", "url": "https://github.com/artipie/artipie/pull/117#pullrequestreview-408053959", "createdAt": "2020-05-08T07:29:19Z", "commit": {"oid": "e74bdae795c8a1b757d01ff85a18c1dd51f91c83"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3176, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}