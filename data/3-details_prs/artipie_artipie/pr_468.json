{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwNzM3MzEz", "number": 468, "title": "#449 - Added ArtipieServer class", "bodyText": "Part of #449\nAdded ArtipieServer class to run server in tests with single repo configured", "createdAt": "2020-08-20T07:56:48Z", "url": "https://github.com/artipie/artipie/pull/468", "merged": true, "mergeCommit": {"oid": "5966489d2a1ed5829396e4e9d85d0370bb9d9c94"}, "closed": true, "closedAt": "2020-08-20T09:22:20Z", "author": {"login": "olegmoz"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdArduKgH2gAyNDcwNzM3MzEzOjIxZmE1ZDZhODU0MzE1NGMzZmMzYjU3ODA4Yjk3ZTYwNDk3YjdlYTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAseuUgH2gAyNDcwNzM3MzEzOmJkNzU5YmM3NzZkYjczYjgwNmMwMmFmNzY0MzMyNzRiOTA3NTJkYjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "21fa5d6a8543154c3fc3b57808b97e60497b7ea7", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/21fa5d6a8543154c3fc3b57808b97e60497b7ea7", "committedDate": "2020-08-20T07:55:37Z", "message": "#449 - Added ArtipieServer class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMzY4NTUy", "url": "https://github.com/artipie/artipie/pull/468#pullrequestreview-471368552", "createdAt": "2020-08-20T08:19:48Z", "commit": {"oid": "21fa5d6a8543154c3fc3b57808b97e60497b7ea7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwODoxOTo0OFrOHDzeHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwODoxOTo0OFrOHDzeHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc1MTA3MA==", "bodyText": "@olegmoz we have code to create repository yaml config in several tests (in YamlSettingsTest for example), what do you think of adding todo to introduce class in test scope to create different configuration?", "url": "https://github.com/artipie/artipie/pull/468#discussion_r473751070", "createdAt": "2020-08-20T08:19:48Z", "author": {"login": "olenagerasimova"}, "path": "src/test/java/com/artipie/ArtipieServer.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie;\n+\n+import com.amihaiemil.eoyaml.Yaml;\n+import io.vertx.reactivex.core.Vertx;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.Optional;\n+\n+/**\n+ * Artipie server with single repository configured.\n+ *\n+ * @since 0.10\n+ */\n+public class ArtipieServer {\n+\n+    /**\n+     * Root path.\n+     */\n+    private final Path root;\n+\n+    /**\n+     * Repo name.\n+     */\n+    private final String name;\n+\n+    /**\n+     * Repo config.\n+     */\n+    private final String config;\n+\n+    /**\n+     * Vert.x instance used to run the server.\n+     */\n+    private Vertx vertx;\n+\n+    /**\n+     * Running server.\n+     */\n+    private VertxMain server;\n+\n+    /**\n+     * Ctor.\n+     *\n+     * @param root Root directory.\n+     * @param name Repo name.\n+     * @param config Repo config.\n+     */\n+    public ArtipieServer(final Path root, final String name, final String config) {\n+        this.root = root;\n+        this.name = name;\n+        this.config = config;\n+    }\n+\n+    /**\n+     * Starts the server.\n+     *\n+     * @return Port the servers listening on.\n+     * @throws IOException In case of error creating configs or running the server.\n+     */\n+    public int start() throws IOException {\n+        final Path repos = this.root.resolve(\"repos\");\n+        repos.toFile().mkdir();\n+        Files.write(\n+            repos.resolve(String.format(\"%s.yaml\", this.name)),\n+            this.config.getBytes()\n+        );\n+        final Path cfg = this.root.resolve(\"artipie.yaml\");\n+        Files.write(\n+            cfg,\n+            Yaml.createYamlMappingBuilder().add(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21fa5d6a8543154c3fc3b57808b97e60497b7ea7"}, "originalPosition": 94}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cbd582778ebc8fb6a59d24ae0b66c03a2a3a7a0", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/9cbd582778ebc8fb6a59d24ae0b66c03a2a3a7a0", "committedDate": "2020-08-20T08:39:22Z", "message": "#449 - Changes by review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33528212f331becd306b030f700b0557c4b2f4ed", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/33528212f331becd306b030f700b0557c4b2f4ed", "committedDate": "2020-08-20T08:41:09Z", "message": "Merge branch 'master' into 449-single-repo-server"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxMzk0NTk2", "url": "https://github.com/artipie/artipie/pull/468#pullrequestreview-471394596", "createdAt": "2020-08-20T08:54:30Z", "commit": {"oid": "33528212f331becd306b030f700b0557c4b2f4ed"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd759bc776db73b806c02af76433274b90752db3", "author": {"user": {"login": "olegmoz", "name": "Oleg Mozzhechkov"}}, "url": "https://github.com/artipie/artipie/commit/bd759bc776db73b806c02af76433274b90752db3", "committedDate": "2020-08-20T09:06:37Z", "message": "Merge branch 'master' into 449-single-repo-server"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3468, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}