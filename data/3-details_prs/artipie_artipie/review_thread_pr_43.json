{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3NjY3NzE2", "number": 43, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjowOTo1MFrODn48YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTowOTozOVrODowwpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTU0MDE2OnYy", "diffSide": "RIGHT", "path": "Dockerfile", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjowOTo1MFrOF2Jolw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMzoyMDoyNFrOF2z1uQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyNTI3MQ==", "bodyText": "@Sammers21 I would recommend changing(just single RUN) the above instructions a little bit just to save one layers:\nFROM maven:3.6.3-jdk-13 as build_jar\nWORKDIR /jar\nCOPY pom.xml .\nCOPY src/ /jar/src/\nRUN yum install git -y && \\ \n        mvn dependency:go-offline && \\\n        mvn package", "url": "https://github.com/artipie/artipie/pull/43#discussion_r392325271", "createdAt": "2020-03-13T16:09:50Z", "author": {"login": "fanifieiev"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,22 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4461f3e2d3059fb4574f815f9985088631ef239c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg2NzMwOA==", "bodyText": "Since we use a 2-staged build, the number of layers in the first step image does not important.", "url": "https://github.com/artipie/artipie/pull/43#discussion_r392867308", "createdAt": "2020-03-16T09:00:10Z", "author": {"login": "Sammers21"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,22 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyNTI3MQ=="}, "originalCommit": {"oid": "4461f3e2d3059fb4574f815f9985088631ef239c"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzAxNjc2MQ==", "bodyText": "@Sammers21 ok", "url": "https://github.com/artipie/artipie/pull/43#discussion_r393016761", "createdAt": "2020-03-16T13:20:24Z", "author": {"login": "fanifieiev"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,22 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyNTI3MQ=="}, "originalCommit": {"oid": "4461f3e2d3059fb4574f815f9985088631ef239c"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMTU1NTUzOnYy", "diffSide": "RIGHT", "path": "Dockerfile", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjoxNDowMlrOF2JyLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDozNDo0M1rOF2t9EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyNzcyNg==", "bodyText": "@Sammers21 Also would recommend just a single RUN", "url": "https://github.com/artipie/artipie/pull/43#discussion_r392327726", "createdAt": "2020-03-13T16:14:02Z", "author": {"login": "fanifieiev"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,22 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package\n+\n+FROM adoptopenjdk/openjdk13:alpine-jre\n+WORKDIR /artipie\n+COPY --from=build_jar /jar/target/artipie-jar-with-dependencies.jar /artipie/artipie.jar\n+VOLUME /artipie/repositories\n+RUN echo -e \"meta:\\n\\\n+  storage:\\n\\\n+    type: fs\\n\\\n+    path: /artipie/repositories\\n\"\\\n+>> /artipie/config.yml\n+RUN cat  /artipie/config.yml", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4461f3e2d3059fb4574f815f9985088631ef239c"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkyMDMzNw==", "bodyText": "That was introduced for debug purposes only. I've just removed it.", "url": "https://github.com/artipie/artipie/pull/43#discussion_r392920337", "createdAt": "2020-03-16T10:34:43Z", "author": {"login": "Sammers21"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,22 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package\n+\n+FROM adoptopenjdk/openjdk13:alpine-jre\n+WORKDIR /artipie\n+COPY --from=build_jar /jar/target/artipie-jar-with-dependencies.jar /artipie/artipie.jar\n+VOLUME /artipie/repositories\n+RUN echo -e \"meta:\\n\\\n+  storage:\\n\\\n+    type: fs\\n\\\n+    path: /artipie/repositories\\n\"\\\n+>> /artipie/config.yml\n+RUN cat  /artipie/config.yml", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMyNzcyNg=="}, "originalCommit": {"oid": "4461f3e2d3059fb4574f815f9985088631ef239c"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDYzMzU1OnYy", "diffSide": "RIGHT", "path": "Dockerfile", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo1Nzo0MVrOF3gFog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMjo1OTo0N1rOF4DzUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0MTczMA==", "bodyText": "@Sammers21 let's set a version from docker args:\nFROM ...\nARG version=\"1.0-SNAPSHOT\"\n# ...\nRUN mvn versions:set -DnewVersion=${version} && mvn package -B --quiet\nThen we can build it like docker build --build-arg=\"version=${BUILD_TAG}\" and git tag will be propagated to jar manifest.\nAlso, I'd use -B and --quiet options for mvn package, since most probably build will be called from CD tools.", "url": "https://github.com/artipie/artipie/pull/43#discussion_r393741730", "createdAt": "2020-03-17T14:57:41Z", "author": {"login": "g4s8"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,21 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyNjg2NQ==", "bodyText": "Then we can build it like docker build --build-arg=\"version=${BUILD_TAG}\" and git tag will be propagated to jar manifest.\n\nCreated a TODO for that\n\nAlso, I'd use -B and --quiet options for mvn package, since most probably build will be called from CD tools.\n\nDone", "url": "https://github.com/artipie/artipie/pull/43#discussion_r394326865", "createdAt": "2020-03-18T12:59:47Z", "author": {"login": "Sammers21"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,21 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0MTczMA=="}, "originalCommit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDY0MDE4OnYy", "diffSide": "RIGHT", "path": "Dockerfile", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo1OTowOFrOF3gJ_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo1OTowOFrOF3gJ_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0Mjg0Ng==", "bodyText": "@Sammers21 it can be COPY src/ .", "url": "https://github.com/artipie/artipie/pull/43#discussion_r393742846", "createdAt": "2020-03-17T14:59:08Z", "author": {"login": "g4s8"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,21 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDY0Mzg0OnYy", "diffSide": "RIGHT", "path": "Dockerfile", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo1OTo1OVrOF3gMhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo1OTo1OVrOF3gMhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0MzQ5NA==", "bodyText": "@Sammers21 please add description metadata: LABEL Description=\"Artipie ...\"", "url": "https://github.com/artipie/artipie/pull/43#discussion_r393743494", "createdAt": "2020-03-17T14:59:59Z", "author": {"login": "g4s8"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,21 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDY0NTk5OnYy", "diffSide": "RIGHT", "path": "Dockerfile", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTowMDoyOFrOF3gN_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMzoyNjozMFrOF4E0gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0Mzg3MQ==", "bodyText": "@Sammers21 it can be COPY --from=build_jar /jar/target/artipie-jar-with-dependencies.jar .", "url": "https://github.com/artipie/artipie/pull/43#discussion_r393743871", "createdAt": "2020-03-17T15:00:28Z", "author": {"login": "g4s8"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,21 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package\n+\n+FROM adoptopenjdk/openjdk13:alpine-jre\n+WORKDIR /artipie\n+COPY --from=build_jar /jar/target/artipie-jar-with-dependencies.jar /artipie/artipie.jar", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMzOTEwMQ==", "bodyText": "I also can be as is. It is explicit and clear", "url": "https://github.com/artipie/artipie/pull/43#discussion_r394339101", "createdAt": "2020-03-18T13:19:39Z", "author": {"login": "Sammers21"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,21 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package\n+\n+FROM adoptopenjdk/openjdk13:alpine-jre\n+WORKDIR /artipie\n+COPY --from=build_jar /jar/target/artipie-jar-with-dependencies.jar /artipie/artipie.jar", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0Mzg3MQ=="}, "originalCommit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDM0MzU1NQ==", "bodyText": "@Sammers21 ok, but let's use single style in the Dockerfile. If you think explicit version is clearer, then remove WORKDIRs and use full paths everywhere.", "url": "https://github.com/artipie/artipie/pull/43#discussion_r394343555", "createdAt": "2020-03-18T13:26:30Z", "author": {"login": "g4s8"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,21 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package\n+\n+FROM adoptopenjdk/openjdk13:alpine-jre\n+WORKDIR /artipie\n+COPY --from=build_jar /jar/target/artipie-jar-with-dependencies.jar /artipie/artipie.jar", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0Mzg3MQ=="}, "originalCommit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ0MDY4NTE5OnYy", "diffSide": "RIGHT", "path": "Dockerfile", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTowOTozOVrOF3gnoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTowOTozOVrOF3gnoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc1MDQzMw==", "bodyText": "@Sammers21 first: let's use command line options instead of system properties, second: I think it would be to specify entrypoint as java artipie.jar but command as --port=80 --storage=/artipie/config - then user will be able to customize CMD options, e.g. by using docker run artipie:1.0 --storage=s3:///bucket/configs", "url": "https://github.com/artipie/artipie/pull/43#discussion_r393750433", "createdAt": "2020-03-17T15:09:39Z", "author": {"login": "g4s8"}, "path": "Dockerfile", "diffHunk": "@@ -0,0 +1,21 @@\n+FROM maven:3.6.3-jdk-13 as build_jar\n+RUN yum install git -y\n+WORKDIR /jar\n+COPY pom.xml .\n+RUN mvn dependency:go-offline\n+COPY src/ /jar/src/\n+RUN mvn package\n+\n+FROM adoptopenjdk/openjdk13:alpine-jre\n+WORKDIR /artipie\n+COPY --from=build_jar /jar/target/artipie-jar-with-dependencies.jar /artipie/artipie.jar\n+VOLUME /artipie/repositories\n+RUN echo -e \"meta:\\n\\\n+  storage:\\n\\\n+    type: fs\\n\\\n+    path: /artipie/repositories\\n\"\\\n+>> /artipie/config.yml\n+EXPOSE 80\n+ENTRYPOINT java -Dartipie.storage=/artipie/config.yml \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adb9dc50a35797978f34ff9c663df3a2101b9562"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2351, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}