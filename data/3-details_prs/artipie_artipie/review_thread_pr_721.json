{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5ODk3NTIz", "number": 721, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTo0NToxMFrOEx3Tsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTo0NTo1NFrOEx3UmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzIxODQyOnYy", "diffSide": "RIGHT", "path": "src/test/java/com/artipie/npm/NpmITCase.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTo0NToxMFrOHoL4sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTo0NToxMFrOHoL4sg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg5OTgyNg==", "bodyText": "@genryxy it looks like here you check too many details about output. I think it will be enough to see that there is error message with 403 Forbidden text. Building whole URL looks excessive.", "url": "https://github.com/artipie/artipie/pull/721#discussion_r511899826", "createdAt": "2020-10-26T11:45:10Z", "author": {"login": "olegmoz"}, "path": "src/test/java/com/artipie/npm/NpmITCase.java", "diffHunk": "@@ -153,6 +166,46 @@ void npmPublish() throws Exception {\n         );\n     }\n \n+    @Test\n+    void npmInstallFailWithForbidden() throws Exception {\n+        final ArtipieServer.User user = ArtipieServer.BOB;\n+        this.init(false);\n+        this.saveFilesToStrg(NpmITCase.PROJ);\n+        MatcherAssert.assertThat(\n+            this.exec(\n+                \"npm\", \"install\", NpmITCase.PROJ,\n+                \"--registry\", this.url(Optional.of(user))\n+            ).getStderr().replaceAll(\"\\n\", \"\"),\n+            new StringContains(\n+                String.format(\n+                    \"npm ERR! 403 403 Forbidden - GET http://%s:***@%s:%d/my-npm/%s\",\n+                    user.name(), NpmITCase.HOST, this.port, NpmITCase.PROJ.replace(\"/\", \"%2f\")\n+                )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63ee4cf7e8726d31f979eaabc24fbb65fc524f7a"}, "originalPosition": 142}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNzIyMDcyOnYy", "diffSide": "RIGHT", "path": "src/test/java/com/artipie/npm/NpmITCase.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTo0NTo1NFrOHoL6IA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTo0NTo1NFrOHoL6IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTkwMDE5Mg==", "bodyText": "@genryxy same concern about checking URL", "url": "https://github.com/artipie/artipie/pull/721#discussion_r511900192", "createdAt": "2020-10-26T11:45:54Z", "author": {"login": "olegmoz"}, "path": "src/test/java/com/artipie/npm/NpmITCase.java", "diffHunk": "@@ -153,6 +166,46 @@ void npmPublish() throws Exception {\n         );\n     }\n \n+    @Test\n+    void npmInstallFailWithForbidden() throws Exception {\n+        final ArtipieServer.User user = ArtipieServer.BOB;\n+        this.init(false);\n+        this.saveFilesToStrg(NpmITCase.PROJ);\n+        MatcherAssert.assertThat(\n+            this.exec(\n+                \"npm\", \"install\", NpmITCase.PROJ,\n+                \"--registry\", this.url(Optional.of(user))\n+            ).getStderr().replaceAll(\"\\n\", \"\"),\n+            new StringContains(\n+                String.format(\n+                    \"npm ERR! 403 403 Forbidden - GET http://%s:***@%s:%d/my-npm/%s\",\n+                    user.name(), NpmITCase.HOST, this.port, NpmITCase.PROJ.replace(\"/\", \"%2f\")\n+                )\n+            )\n+        );\n+    }\n+\n+    @Test\n+    void npmPublishFailWithForbidden() throws Exception {\n+        final ArtipieServer.User user = ArtipieServer.BOB;\n+        this.init(false);\n+        new TestResource(\"npm/simple-npm-project\")\n+            .addFilesTo(this.storage, new Key.From(NpmITCase.PROJ));\n+        MatcherAssert.assertThat(\n+            \"Package was published\",\n+            this.exec(\n+                \"npm\", \"publish\", NpmITCase.PROJ,\n+                \"--registry\", this.url(Optional.of(user))\n+            ).getStderr().replaceAll(\"\\n\", \"\"),\n+            new StringContains(\n+                String.format(\n+                    \"npm ERR! 403 403 Forbidden - PUT http://%s:***@%s:%d/my-npm/%s\",\n+                    user.name(), NpmITCase.HOST, this.port, NpmITCase.PROJ.replace(\"/\", \"%2f\")\n+                )\n+            )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63ee4cf7e8726d31f979eaabc24fbb65fc524f7a"}, "originalPosition": 164}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2081, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}