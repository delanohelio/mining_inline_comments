{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxMzgyNDIw", "number": 517, "title": "fix skip steps in jsonformfragment", "bodyText": "", "createdAt": "2020-11-16T06:07:53Z", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/517", "merged": true, "mergeCommit": {"oid": "b101ac111e0efa7386cfb8b741d73aa7b5c05916"}, "closed": true, "closedAt": "2020-11-18T09:11:32Z", "author": {"login": "bennsimon"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdc-nhkAH2gAyNTIxMzgyNDIwOmFiYmQ4OTJkZWI1YTk2YzdiYjgzNmVkZDMwYjhjZWY4YjY5ZjgwNWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddqVROgFqTUzMzIyODM5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "abbd892deb5a96c7bb836edd30b8cef8b69f805d", "author": {"user": {"login": "bennsimon", "name": "Benn Simon"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/abbd892deb5a96c7bb836edd30b8cef8b69f805d", "committedDate": "2020-11-16T06:04:24Z", "message": "fix skip steps in jsonformfragment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMzA3NDk4", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/517#pullrequestreview-531307498", "createdAt": "2020-11-16T13:14:43Z", "commit": {"oid": "abbd892deb5a96c7bb836edd30b8cef8b69f805d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzoxNDo0NFrOHz-MaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzoxNDo0NFrOHz-MaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI1ODQwOA==", "bodyText": "Why do we need to subtract 1?", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/517#discussion_r524258408", "createdAt": "2020-11-16T13:14:44Z", "author": {"login": "vincent-karuri"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonFormFragment.java", "diffHunk": "@@ -299,12 +299,8 @@ public void skipLoadedStepsOnNextPressed() {\n     private int getFormStepNumber(String nextFormNumber) {\n         int formNumber = 0;\n         if (StringUtils.isNotBlank(nextFormNumber)) {\n-            int currentFormNumber = Integer.parseInt(nextFormNumber.substring(4, 5)) - 1;\n-            if (currentFormNumber > 0) {\n-                formNumber = currentFormNumber;\n-            } else if (currentFormNumber == 0) {\n-                formNumber = 1;\n-            }\n+            int currentFormNumber = Integer.parseInt(nextFormNumber.substring(4)) - 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abbd892deb5a96c7bb836edd30b8cef8b69f805d"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxMzA5MTQ3", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/517#pullrequestreview-531309147", "createdAt": "2020-11-16T13:17:01Z", "commit": {"oid": "abbd892deb5a96c7bb836edd30b8cef8b69f805d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzoxNzowMlrOHz-Riw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzoxNzowMlrOHz-Riw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI1OTcyMw==", "bodyText": "Any reason this is removed?", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/517#discussion_r524259723", "createdAt": "2020-11-16T13:17:02Z", "author": {"login": "vincent-karuri"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/presenters/JsonFormFragmentPresenter.java", "diffHunk": "@@ -465,13 +462,30 @@ public boolean validateOnSubmit() {\n         return entireJsonForm.optBoolean(JsonFormConstants.VALIDATE_ON_SUBMIT, false);\n     }\n \n-    private boolean moveToNextStep() {\n-        if (!\"\".equals(mStepDetails.optString(JsonFormConstants.NEXT))) {\n-            JsonFormFragment next = JsonFormFragment\n-                    .getFormFragment(mStepDetails.optString(JsonFormConstants.NEXT));\n+    public void executeRefreshLogicForNextStep() {\n+        final String nextStep = getFormFragment().getJsonApi().nextStep();\n+        if (StringUtils.isNotBlank(nextStep)) {\n+            getmJsonFormInteractor().fetchFormElements(nextStep, getFormFragment(), getFormFragment().getJsonApi().getmJSONObject().optJSONObject(nextStep), getView().getCommonListener(), false);\n+            getFormFragment().getJsonApi().initializeDependencyMaps();\n+            cleanDataForNextStep();\n+            getFormFragment().getJsonApi().invokeRefreshLogic(null, false, null, null, nextStep, true);\n+            if (!getFormFragment().getJsonApi().isNextStepRelevant()) {\n+                Utils.checkIfStepHasNoSkipLogic(getFormFragment());\n+            }\n+            getFormFragment().skipStepsOnNextPressed(nextStep);\n+        }\n+    }\n+\n+    private void cleanDataForNextStep() {\n+        getFormFragment().getJsonApi().setNextStepRelevant(false);\n+    }\n+\n+    protected boolean moveToNextStep() {\n+        final String nextStep = getFormFragment().getJsonApi().nextStep();\n+        if (!\"\".equals(nextStep)) {\n+            JsonFormFragment next = JsonFormFragment.getFormFragment(nextStep);\n             getView().hideKeyBoard();\n             getView().transactThis(next);\n-            return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abbd892deb5a96c7bb836edd30b8cef8b69f805d"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a7359cd68af138ab8a746e48332703227cd708e", "author": {"user": {"login": "bennsimon", "name": "Benn Simon"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/9a7359cd68af138ab8a746e48332703227cd708e", "committedDate": "2020-11-17T06:22:25Z", "message": "code cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7779936526b6bb29b583731ebdd39b282510f355", "author": {"user": {"login": "bennsimon", "name": "Benn Simon"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/7779936526b6bb29b583731ebdd39b282510f355", "committedDate": "2020-11-18T06:43:44Z", "message": "fix duplicate fragment on backstack issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29d1f5fc29f8c1306fdc2734b043c7195a636f46", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/29d1f5fc29f8c1306fdc2734b043c7195a636f46", "committedDate": "2020-11-18T08:54:46Z", "message": "Make creation of next jsonformfragment configurable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMjI4Mzkz", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/517#pullrequestreview-533228393", "createdAt": "2020-11-18T09:00:17Z", "commit": {"oid": "29d1f5fc29f8c1306fdc2734b043c7195a636f46"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2341, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}