{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwNDUzODA5", "number": 454, "title": "Fix Get ResourceBundle with properties from the DB", "bodyText": "Added .properties file extension when retrieving properties details\nHandled loading properties based on Locale\nFixed retrieving Object[][] when getting ResourceBundle - return empty array instead of null\nDisabled Caching of properties since the DBResourceBundle handles different properties and locales\nUpdated tests to test getting properties with different Locales\n\n\nRelated issues\n\nopensrp/opensrp-client-anc#524\nopensrp/opensrp-client-core#547\nopensrp/opensrp-client-anc#521\nopensrp/opensrp-client-anc#527", "createdAt": "2020-07-16T19:33:50Z", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/454", "merged": true, "mergeCommit": {"oid": "b935b4266be73c1044ed7df974953c2e05336de4"}, "closed": true, "closedAt": "2020-07-20T08:24:29Z", "author": {"login": "allan-on"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1kJkRAH2gAyNDUwNDUzODA5Ojc0MmY4YjNiNDYxMDQ4NmU0YzQ1ODQxNTRhZGE1OGE1YmM0YzA3OTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc2s8OkAFqTQ1MTM3ODA4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "742f8b3b4610486e4c4584154ada58a5bc4c0795", "author": {"user": {"login": "allan-on", "name": "Allan Onchuru"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/742f8b3b4610486e4c4584154ada58a5bc4c0795", "committedDate": "2020-07-16T19:11:06Z", "message": ":bug: Return empty Object 2D array instead of null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d11a7c7e443eb3c9727412fb5d743e712463f6b", "author": {"user": {"login": "allan-on", "name": "Allan Onchuru"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/0d11a7c7e443eb3c9727412fb5d743e712463f6b", "committedDate": "2020-07-16T19:24:51Z", "message": ":construction: Add .properties extension for retrieving properties files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e06269edad2c08e697f2ea71793f4f3b9b7371e0", "author": {"user": {"login": "allan-on", "name": "Allan Onchuru"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/e06269edad2c08e697f2ea71793f4f3b9b7371e0", "committedDate": "2020-07-16T19:48:00Z", "message": ":heavy_check_mark: Fix failing test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54293cc53f9245eea28b7eb97e48c5ecb3c0d1de", "author": {"user": {"login": "allan-on", "name": "Allan Onchuru"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/54293cc53f9245eea28b7eb97e48c5ecb3c0d1de", "committedDate": "2020-07-16T20:10:42Z", "message": ":white_check_mark: Add test for ResourceBundle is empty when properties doesn't exist in the DB"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af427a9e21abfd1612671dbd4c006849e6129341", "author": {"user": {"login": "allan-on", "name": "Allan Onchuru"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/af427a9e21abfd1612671dbd4c006849e6129341", "committedDate": "2020-07-17T08:51:27Z", "message": ":white_check_mark: Fix failing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ee10dfdde1c336d0df023e3d19688e4eb08988e", "author": {"user": {"login": "allan-on", "name": "Allan Onchuru"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/4ee10dfdde1c336d0df023e3d19688e4eb08988e", "committedDate": "2020-07-17T12:32:24Z", "message": ":sparkles: Get translated YAML with properties from the DB"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7151d892b4b1b86c45c71a57add5f294a33cc5e0", "author": {"user": {"login": "allan-on", "name": "Allan Onchuru"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/7151d892b4b1b86c45c71a57add5f294a33cc5e0", "committedDate": "2020-07-17T12:40:09Z", "message": ":bug: Disable DBResouceBundle caching\n\nThis is to allow handling different properties and also different locales"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03890e153a75acd234f6fd4a57cd0504df9932f3", "author": {"user": {"login": "allan-on", "name": "Allan Onchuru"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/03890e153a75acd234f6fd4a57cd0504df9932f3", "committedDate": "2020-07-17T12:42:25Z", "message": ":bug: Handle locales for properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51fda1a7c651a962632085d78435e69a3713eb1e", "author": {"user": {"login": "allan-on", "name": "Allan Onchuru"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/51fda1a7c651a962632085d78435e69a3713eb1e", "committedDate": "2020-07-17T12:43:34Z", "message": ":construction: Pass context for retrieving ResourceBundle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b1a53dc1e850b9262d31ae50ad1b39891970049", "author": {"user": {"login": "allan-on", "name": "Allan Onchuru"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/5b1a53dc1e850b9262d31ae50ad1b39891970049", "committedDate": "2020-07-17T12:45:28Z", "message": ":white_check_mark: Test get DBResourceBundle with different locale"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de02abbdadb8a51946759eafcd573122285e7a4f", "author": {"user": {"login": "allan-on", "name": "Allan Onchuru"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/de02abbdadb8a51946759eafcd573122285e7a4f", "committedDate": "2020-07-17T13:54:32Z", "message": ":construction: Move get properties from repository to DBResourceBundleControl"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNzYxOTE2", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/454#pullrequestreview-450761916", "createdAt": "2020-07-17T15:39:32Z", "commit": {"oid": "de02abbdadb8a51946759eafcd573122285e7a4f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNTozOTozMlrOGzX1ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNTozOTozMlrOGzX1ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUyMTA2MQ==", "bodyText": "Add the override annotation. I know it doesn't change the execution but it's easier for readability", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/454#discussion_r456521061", "createdAt": "2020-07-17T15:39:32Z", "author": {"login": "ekigamba"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/domain/DBResourceBundleControl.java", "diffHunk": "@@ -15,7 +19,28 @@ public DBResourceBundleControl(String identifier) {\n     public ResourceBundle newBundle(String baseName, Locale locale, String format, ClassLoader loader, boolean reload)\n             throws IllegalAccessException,\n             InstantiationException {\n-        return new DBResourceBundle(identifier);\n+        return new DBResourceBundle(getPropertiesFromRepository(identifier));\n+    }\n+\n+    // Don't cache since the DBResourceBundle handles properties for different Locales\n+    public long getTimeToLive(String arg0, Locale arg1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de02abbdadb8a51946759eafcd573122285e7a4f"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3988b032208084ed4f1ee781f5940a48be20c312", "author": {"user": {"login": "allan-on", "name": "Allan Onchuru"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/3988b032208084ed4f1ee781f5940a48be20c312", "committedDate": "2020-07-17T16:56:17Z", "message": ":art: Add Override annotation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzM5OTQz", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/454#pullrequestreview-451339943", "createdAt": "2020-07-20T06:56:53Z", "commit": {"oid": "3988b032208084ed4f1ee781f5940a48be20c312"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMzc4MDg1", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/454#pullrequestreview-451378085", "createdAt": "2020-07-20T07:59:29Z", "commit": {"oid": "3988b032208084ed4f1ee781f5940a48be20c312"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzo1OTozMFrOGz-SOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQwNzo1OTozMFrOGz-SOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE1MTAzNQ==", "bodyText": "Nice test \ud83d\udc4d", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/454#discussion_r457151035", "createdAt": "2020-07-20T07:59:30Z", "author": {"login": "ekigamba"}, "path": "android-json-form-wizard/src/test/java/com/vijay/jsonwizard/utils/NativeFormLangUtilsTest.java", "diffHunk": "@@ -84,16 +87,35 @@ public void testYamlFileTranslationShouldReturnUntranslatedYamlFile() {\n     }\n \n     @Test\n-    public void canGetResourceBundleWithPropertiesFromRepository() {\n+    public void testCanGetResourceBundleWithPropertiesFromRepository() {\n         ClientFormContract.Dao clientFormRepository = Mockito.mock(ClientFormContract.Dao.class);\n         NativeFormLibrary.getInstance().setClientFormDao(clientFormRepository);\n-        String properties = \"step1.title = New client record\\nstep1.previous_label = SAVE AND EXIT\";\n+        Context context = RuntimeEnvironment.application;\n+        String enProperties = \"step1.title = New client record\\nstep1.previous_label = SAVE AND EXIT\";\n         String interpolatedJsonForm = testUtils.getResourceFileContentsAsString(\"test_form_translation_interpolated\");\n \n         ClientFormContract.Model clientForm = new TestClientForm();\n-        clientForm.setJson(properties);\n-        Mockito.doReturn(clientForm).when(clientFormRepository).getActiveClientFormByIdentifier(Mockito.eq(\"form_strings\"));\n \n-        assertEquals(\"New client record\", NativeFormLangUtils.getResourceBundleFromRepository(interpolatedJsonForm).getString(\"step1.title\"));\n+        clientForm.setJson(enProperties);\n+        Mockito.doReturn(clientForm).when(clientFormRepository).getActiveClientFormByIdentifier(Mockito.eq(\"form_strings.properties\"));\n+        assertEquals(\"SAVE AND EXIT\",  NativeFormLangUtils.getResourceBundleFromRepository(RuntimeEnvironment.application, interpolatedJsonForm).getString(\"step1.previous_label\"));\n+\n+        String swProperties = \"step1.title = Rekodi mpya\\nstep1.previous_label = WEKA ALAFU ONDOKA\";\n+        clientForm.setJson(swProperties);\n+        NativeFormLangUtils.setAppLocale(context, \"sw\");\n+        Mockito.doReturn(clientForm).when(clientFormRepository).getActiveClientFormByIdentifier(Mockito.eq(\"form_strings_sw.properties\"));\n+        assertEquals(\"Rekodi mpya\",  NativeFormLangUtils.getResourceBundleFromRepository(RuntimeEnvironment.application, interpolatedJsonForm).getString(\"step1.title\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3988b032208084ed4f1ee781f5940a48be20c312"}, "originalPosition": 45}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2416, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}