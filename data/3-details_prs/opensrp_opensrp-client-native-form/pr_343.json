{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1MzI1OTI5", "number": 343, "title": "Add relevance and calculations on repeating group", "bodyText": "", "createdAt": "2020-01-21T14:12:38Z", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/343", "merged": true, "mergeCommit": {"oid": "dd69f197a1dedb958b979e1c43b386a9e33af0fb"}, "closed": true, "closedAt": "2020-01-29T08:55:02Z", "author": {"login": "manutarus"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb62TvFAH2gAyMzY1MzI1OTI5OmJjOTBjNTA4Mjc4OGU4NTkwNmYwN2QwMzI3N2VlNjk1ZGY4ZmQwNzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_B-VegFqTM0OTk0MTI0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bc90c5082788e85906f07d03277ee695df8fd079", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/bc90c5082788e85906f07d03277ee695df8fd079", "committedDate": "2020-01-16T08:58:58Z", "message": "add relevance repeating group question"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9dea0ef9ea6dc050d5dad3f61028ec75d22336f", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/c9dea0ef9ea6dc050d5dad3f61028ec75d22336f", "committedDate": "2020-01-16T09:01:50Z", "message": "add repeating group section"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e312f75265ecae17fc8ded1b51b8b3fc0e0b661c", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/e312f75265ecae17fc8ded1b51b8b3fc0e0b661c", "committedDate": "2020-01-16T11:15:06Z", "message": "Merge branch 'master' of github.com:OpenSRP/opensrp-client-native-form into repeating_group_relevance_calculations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60e6cf0e16602f2b18ba8e237b5e8d2f26e8300f", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/60e6cf0e16602f2b18ba8e237b5e8d2f26e8300f", "committedDate": "2020-01-17T11:53:04Z", "message": "fix issue with setting view tags for an already existing id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1744e8560b6d2a42389dd793ddf60365653888e1", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/1744e8560b6d2a42389dd793ddf60365653888e1", "committedDate": "2020-01-17T13:23:52Z", "message": "add function to get dynamic rules engine address"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7b2c872985fcf0358af5960ad3a61eaef4dc1a3", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/b7b2c872985fcf0358af5960ad3a61eaef4dc1a3", "committedDate": "2020-01-17T13:25:11Z", "message": "add function to get dynamic calculation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4e4cbb4d2f3abcf02e8913631b5252c34e4fd16", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/f4e4cbb4d2f3abcf02e8913631b5252c34e4fd16", "committedDate": "2020-01-17T13:26:37Z", "message": "build calculations with unique ids"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78491da2892ff6819b31959fc322e0058efde038", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/78491da2892ff6819b31959fc322e0058efde038", "committedDate": "2020-01-21T14:08:44Z", "message": "add relevance to repeating group sample form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ede7a5c9c980b48e11ffaa1972e9b93e3cca0a0", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/8ede7a5c9c980b48e11ffaa1972e9b93e3cca0a0", "committedDate": "2020-01-21T14:09:12Z", "message": "add calculation to repeating group sample form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "477a5b8234ae60e999ae14c21ee80fdde30ef389", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/477a5b8234ae60e999ae14c21ee80fdde30ef389", "committedDate": "2020-01-21T14:09:36Z", "message": "Merge branch 'master' of github.com:OpenSRP/opensrp-client-native-form into repeating_group_relevance_calculations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1OTExODEx", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/343#pullrequestreview-345911811", "createdAt": "2020-01-21T14:20:49Z", "commit": {"oid": "477a5b8234ae60e999ae14c21ee80fdde30ef389"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNDoyMDo1MFrOFf7pWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxNDoyMzo0MlrOFf7vjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAyNzQxOA==", "bodyText": "Conventional naming of variables here", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/343#discussion_r369027418", "createdAt": "2020-01-21T14:20:50Z", "author": {"login": "bennsimon"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java", "diffHunk": "@@ -309,7 +309,12 @@ public void refreshCalculationLogic(String parentKey, String childKey, boolean p\n \n                         String[] address = getAddressFromMap(widgetKey, stepName, JsonFormConstants.CALCULATION);\n                         if (address == null && curRelevance.has(JsonFormConstants.JSON_FORM_KEY.EX_RULES)) {\n-                            address = getRulesEngineAddress(curKey, curRelevance, curView, JsonFormConstants.CALCULATION);\n+                            JSONObject ex_rules = curRelevance.getJSONObject(JsonFormConstants.JSON_FORM_KEY.EX_RULES);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "477a5b8234ae60e999ae14c21ee80fdde30ef389"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAyODA5Ng==", "bodyText": "change the name of rulesFile to a address", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/343#discussion_r369028096", "createdAt": "2020-01-21T14:22:01Z", "author": {"login": "bennsimon"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java", "diffHunk": "@@ -1665,11 +1665,14 @@ private ExObjectResult isExObjectRelevant(Facts curValueMap, JSONObject object)\n         return Utils.getConditionKeys(condition);\n     }\n \n-    private void updateCalculation(Facts valueMap, View view, String rulesFile) {\n-\n+    private void updateCalculation(Facts valueMap, View view, String[] rulesFile) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "477a5b8234ae60e999ae14c21ee80fdde30ef389"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAyOTAwNw==", "bodyText": "any naming with relevance i guess should now be changed to calculation", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/343#discussion_r369029007", "createdAt": "2020-01-21T14:23:42Z", "author": {"login": "bennsimon"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/task/AttachRepeatingGroupTask.java", "diffHunk": "@@ -242,4 +244,58 @@ private void buildRelevanceWithUniqueIds(JSONObject element, String uniqueId) th\n         }\n \n     }\n+\n+    private void buildCalculationWithUniqueId(JSONObject element, String uniqueId) throws JSONException {\n+        JSONObject calculation = element.optJSONObject(CALCULATION);\n+        if (calculation != null) {\n+            if (calculation.has(RuleConstant.RULES_ENGINE) && widgetArgs != null) {\n+                JSONObject jsonRulesEngineObject = calculation.optJSONObject(RuleConstant.RULES_ENGINE);\n+                JSONObject jsonExRules = jsonRulesEngineObject.optJSONObject(JsonFormConstants.JSON_FORM_KEY.EX_RULES);\n+                String fileName = JsonFormConstants.RULE + jsonExRules.optString(RuleConstant.RULES_DYNAMIC);\n+\n+                if (!rulesFileMap.containsKey(fileName)) {\n+                    Iterable<Object> objectIterable = Utils.readYamlFile(fileName, widgetArgs.getContext());\n+                    List<Map<String, Object>> arrayList = new ArrayList<>();\n+                    while (objectIterable.iterator().hasNext()) {\n+                        Map<String, Object> map = (Map<String, Object>) objectIterable.iterator().next();\n+                        if (map != null) {\n+                            arrayList.add(map);\n+                        }\n+                    }\n+                    rulesFileMap.put(fileName, arrayList);\n+                }\n+\n+                List<Map<String, Object>> mapArrayList = rulesFileMap.get(fileName);\n+\n+                JSONArray jsonArrayRules = new JSONArray();\n+                JSONObject keyJsonObject = new JSONObject();\n+                keyJsonObject.put(KEY, uniqueId);\n+                jsonArrayRules.put(keyJsonObject);\n+                for (Map<String, Object> map : mapArrayList) {\n+                    JSONObject jsonRulesDynamicObject = new JSONObject();\n+                    String strCondition = (String) map.get(RuleConstant.CONDITION);\n+                    List<String> conditionKeys = Utils.getConditionKeys(strCondition);\n+                    for (String conditionKey : conditionKeys) {\n+                        strCondition = strCondition.replace(conditionKey, conditionKey + \"_\" + uniqueId);\n+                    }\n+                    jsonRulesDynamicObject.put(RuleConstant.NAME, String.valueOf(map.get(RuleConstant.NAME)).concat(\"_\").concat(uniqueId));\n+                    jsonRulesDynamicObject.put(RuleConstant.DESCRIPTION, String.valueOf(map.get(RuleConstant.DESCRIPTION)).concat(\"_\").concat(uniqueId));\n+                    jsonRulesDynamicObject.put(RuleConstant.PRIORITY, map.get(RuleConstant.PRIORITY));\n+                    jsonRulesDynamicObject.put(RuleConstant.ACTIONS, ((ArrayList<String>) map.get(RuleConstant.ACTIONS)).get(0));\n+                    jsonRulesDynamicObject.put(RuleConstant.CONDITION, String.valueOf(strCondition));\n+                    jsonArrayRules.put(jsonRulesDynamicObject);\n+                }\n+\n+                jsonExRules.put(RuleConstant.RULES_DYNAMIC, jsonArrayRules);\n+\n+            } else {\n+                String currRelevanceKey = calculation.keys().next();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "477a5b8234ae60e999ae14c21ee80fdde30ef389"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "633ee98a34e017933246b858f5f1419d42258ff8", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/633ee98a34e017933246b858f5f1419d42258ff8", "committedDate": "2020-01-21T14:31:28Z", "message": "Update variable naming as per review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "929f7fe9cf1c9ffcdb4548b434ab0b4286ffcc80", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/929f7fe9cf1c9ffcdb4548b434ab0b4286ffcc80", "committedDate": "2020-01-21T14:37:16Z", "message": "Update variable names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d845094ee6d3dce124405ba5cdd0ebb91046c5a7", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/d845094ee6d3dce124405ba5cdd0ebb91046c5a7", "committedDate": "2020-01-21T14:38:02Z", "message": "Bump up version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbae9c6179f1fcd6398f74f221b795bedc828543", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/fbae9c6179f1fcd6398f74f221b795bedc828543", "committedDate": "2020-01-22T07:45:05Z", "message": "Remove Unnecessary use of fully qualified"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "307539fee2284ffdbf3403b1068d7683489bf8b2", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/307539fee2284ffdbf3403b1068d7683489bf8b2", "committedDate": "2020-01-22T08:39:24Z", "message": "Update current calculation var name to a more relevant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "640fd3717e2cf43400bf2db1a435253df15be2d4", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/640fd3717e2cf43400bf2db1a435253df15be2d4", "committedDate": "2020-01-27T11:44:42Z", "message": "Merge branch 'master' of github.com:OpenSRP/opensrp-client-native-form into repeating_group_relevance_calculations\nBump up version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9b417dcb7618c986f77cfb41893311e7869d9dc", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/f9b417dcb7618c986f77cfb41893311e7869d9dc", "committedDate": "2020-01-27T14:21:25Z", "message": "code abstraction on getting rule uniqueid for relevance and calculation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "888039e5984d39cd534baaa565d8e7de20314296", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/888039e5984d39cd534baaa565d8e7de20314296", "committedDate": "2020-01-27T14:33:33Z", "message": "use relevant variable naming"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7692792bc8bc5037a8e337b278504d1873c25a52", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/7692792bc8bc5037a8e337b278504d1873c25a52", "committedDate": "2020-01-28T10:19:32Z", "message": "Merge branch 'master' of github.com:OpenSRP/opensrp-client-native-form into repeating_group_relevance_calculations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d55451f0af5a33b8b365fd73cacab61cc3b679f", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/8d55451f0af5a33b8b365fd73cacab61cc3b679f", "committedDate": "2020-01-28T18:15:00Z", "message": "added relevance decided id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "286117cf72d55ef4af0f0e6290337bb67ef1fbc0", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/286117cf72d55ef4af0f0e6290337bb67ef1fbc0", "committedDate": "2020-01-28T18:16:14Z", "message": "add relevance rules for repeating group question"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45cacaa2a528d3437e97436673590391ea4f1c42", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/45cacaa2a528d3437e97436673590391ea4f1c42", "committedDate": "2020-01-28T18:16:57Z", "message": "add repeating group rules file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b86ad2e4e0704435c18f31f32605ab27f91e7ff", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/9b86ad2e4e0704435c18f31f32605ab27f91e7ff", "committedDate": "2020-01-28T18:17:32Z", "message": "add calculations to sample form"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02740df8ec9c458da2ff3c550bae3ec6db450ac4", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/02740df8ec9c458da2ff3c550bae3ec6db450ac4", "committedDate": "2020-01-28T18:18:11Z", "message": "code clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19ca65e89db2efcec97ed3615b69a9cc0cb15b23", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/19ca65e89db2efcec97ed3615b69a9cc0cb15b23", "committedDate": "2020-01-28T18:18:56Z", "message": "added tag on view called relevanced_decided (object of boolean) on JsonFormActivity:1899\nadded code to check when tag changes inside the RepeatingGroupFactory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2519cf588e3ac739af910933d2fb9595de86c46", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/b2519cf588e3ac739af910933d2fb9595de86c46", "committedDate": "2020-01-28T18:56:45Z", "message": "remove extra semicolon"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5OTQxMjQx", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/343#pullrequestreview-349941241", "createdAt": "2020-01-29T08:50:09Z", "commit": {"oid": "b2519cf588e3ac739af910933d2fb9595de86c46"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2430, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}