{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxMzgyNDIw", "number": 517, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzoxNDo0NFrOE5e36g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzoxNzowMlrOE5e7RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NzEwMTIyOnYy", "diffSide": "RIGHT", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonFormFragment.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzoxNDo0NFrOHz-MaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzoyNjoyMFrOHz-ncQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI1ODQwOA==", "bodyText": "Why do we need to subtract 1?", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/517#discussion_r524258408", "createdAt": "2020-11-16T13:14:44Z", "author": {"login": "vincent-karuri"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonFormFragment.java", "diffHunk": "@@ -299,12 +299,8 @@ public void skipLoadedStepsOnNextPressed() {\n     private int getFormStepNumber(String nextFormNumber) {\n         int formNumber = 0;\n         if (StringUtils.isNotBlank(nextFormNumber)) {\n-            int currentFormNumber = Integer.parseInt(nextFormNumber.substring(4, 5)) - 1;\n-            if (currentFormNumber > 0) {\n-                formNumber = currentFormNumber;\n-            } else if (currentFormNumber == 0) {\n-                formNumber = 1;\n-            }\n+            int currentFormNumber = Integer.parseInt(nextFormNumber.substring(4)) - 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abbd892deb5a96c7bb836edd30b8cef8b69f805d"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI2NTMyOQ==", "bodyText": "If we are trying to get the current step number, won't https://github.com/OpenSRP/opensrp-client-native-form/pull/407/files#diff-4af3b3a5f5179b96a2f8051da8ad980ec341e72fc18aa4bd23f0cbc2c2216845L739 suffice?\nThe current logic assumes that the next step will always be +1 which is not always certain to be true.", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/517#discussion_r524265329", "createdAt": "2020-11-16T13:26:20Z", "author": {"login": "vincent-karuri"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonFormFragment.java", "diffHunk": "@@ -299,12 +299,8 @@ public void skipLoadedStepsOnNextPressed() {\n     private int getFormStepNumber(String nextFormNumber) {\n         int formNumber = 0;\n         if (StringUtils.isNotBlank(nextFormNumber)) {\n-            int currentFormNumber = Integer.parseInt(nextFormNumber.substring(4, 5)) - 1;\n-            if (currentFormNumber > 0) {\n-                formNumber = currentFormNumber;\n-            } else if (currentFormNumber == 0) {\n-                formNumber = 1;\n-            }\n+            int currentFormNumber = Integer.parseInt(nextFormNumber.substring(4)) - 1;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI1ODQwOA=="}, "originalCommit": {"oid": "abbd892deb5a96c7bb836edd30b8cef8b69f805d"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NzEwOTgwOnYy", "diffSide": "LEFT", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/presenters/JsonFormFragmentPresenter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzoxNzowMlrOHz-Riw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxMzoxNzowMlrOHz-Riw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI1OTcyMw==", "bodyText": "Any reason this is removed?", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/517#discussion_r524259723", "createdAt": "2020-11-16T13:17:02Z", "author": {"login": "vincent-karuri"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/presenters/JsonFormFragmentPresenter.java", "diffHunk": "@@ -465,13 +462,30 @@ public boolean validateOnSubmit() {\n         return entireJsonForm.optBoolean(JsonFormConstants.VALIDATE_ON_SUBMIT, false);\n     }\n \n-    private boolean moveToNextStep() {\n-        if (!\"\".equals(mStepDetails.optString(JsonFormConstants.NEXT))) {\n-            JsonFormFragment next = JsonFormFragment\n-                    .getFormFragment(mStepDetails.optString(JsonFormConstants.NEXT));\n+    public void executeRefreshLogicForNextStep() {\n+        final String nextStep = getFormFragment().getJsonApi().nextStep();\n+        if (StringUtils.isNotBlank(nextStep)) {\n+            getmJsonFormInteractor().fetchFormElements(nextStep, getFormFragment(), getFormFragment().getJsonApi().getmJSONObject().optJSONObject(nextStep), getView().getCommonListener(), false);\n+            getFormFragment().getJsonApi().initializeDependencyMaps();\n+            cleanDataForNextStep();\n+            getFormFragment().getJsonApi().invokeRefreshLogic(null, false, null, null, nextStep, true);\n+            if (!getFormFragment().getJsonApi().isNextStepRelevant()) {\n+                Utils.checkIfStepHasNoSkipLogic(getFormFragment());\n+            }\n+            getFormFragment().skipStepsOnNextPressed(nextStep);\n+        }\n+    }\n+\n+    private void cleanDataForNextStep() {\n+        getFormFragment().getJsonApi().setNextStepRelevant(false);\n+    }\n+\n+    protected boolean moveToNextStep() {\n+        final String nextStep = getFormFragment().getJsonApi().nextStep();\n+        if (!\"\".equals(nextStep)) {\n+            JsonFormFragment next = JsonFormFragment.getFormFragment(nextStep);\n             getView().hideKeyBoard();\n             getView().transactThis(next);\n-            return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abbd892deb5a96c7bb836edd30b8cef8b69f805d"}, "originalPosition": 97}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2012, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}