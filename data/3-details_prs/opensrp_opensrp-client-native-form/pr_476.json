{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4NjkyMzgw", "number": 476, "title": "Save repeating group count to obs", "bodyText": "", "createdAt": "2020-09-03T14:57:01Z", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/476", "merged": true, "mergeCommit": {"oid": "348336a0d97f6fac9f1341fda4b37613ba83b00c"}, "closed": true, "closedAt": "2020-09-11T06:20:15Z", "author": {"login": "vincent-karuri"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFRx31gH2gAyNDc4NjkyMzgwOmJmMGQ3YzgyNTYxMzAwNWI3ODM5ZGQ2MTYzNmE4ZTBmNzU4MTlhMWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHu_u0gFqTQ4NjQ5NDIyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bf0d7c825613005b7839dd61636a8e0f75819a1b", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/bf0d7c825613005b7839dd61636a8e0f75819a1b", "committedDate": "2020-09-03T14:49:43Z", "message": "Save repeating group count to obs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27802baba81f19e70b48cede3d32527a577e5a03", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/27802baba81f19e70b48cede3d32527a577e5a03", "committedDate": "2020-09-03T15:37:17Z", "message": "Fix failing test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "154ee06ef71ccd438a15419d94a153f1d2a2dd6b", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/154ee06ef71ccd438a15419d94a153f1d2a2dd6b", "committedDate": "2020-09-03T15:32:05Z", "message": "Fix failing test"}, "afterCommit": {"oid": "27802baba81f19e70b48cede3d32527a577e5a03", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/27802baba81f19e70b48cede3d32527a577e5a03", "committedDate": "2020-09-03T15:37:17Z", "message": "Fix failing test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c501d1a94a08e0962dda471ed8c4832bdb99e7b", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/8c501d1a94a08e0962dda471ed8c4832bdb99e7b", "committedDate": "2020-09-03T16:37:08Z", "message": "Add repeating group test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f07b690480259c45511784d1324958024480d733", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/f07b690480259c45511784d1324958024480d733", "committedDate": "2020-09-04T06:24:41Z", "message": "Bump lib version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f8ddd7fcdb02fda309037b791a9a168054e1466e", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/f8ddd7fcdb02fda309037b791a9a168054e1466e", "committedDate": "2020-09-03T16:37:38Z", "message": "Bump lib version"}, "afterCommit": {"oid": "f07b690480259c45511784d1324958024480d733", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/f07b690480259c45511784d1324958024480d733", "committedDate": "2020-09-04T06:24:41Z", "message": "Bump lib version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5049e1b482b4b2e3b9abc17093dcbd22f423c967", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/5049e1b482b4b2e3b9abc17093dcbd22f423c967", "committedDate": "2020-09-04T08:57:15Z", "message": "Append repeating group key to child element's key"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdbc3f8f435ea642f52bdaec5ce45e2be5c79007", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/bdbc3f8f435ea642f52bdaec5ce45e2be5c79007", "committedDate": "2020-09-04T09:33:05Z", "message": "Add RepeatingGroupFactory unique id generation test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c34e55eedbfca2a90a512516925f207e6be03813", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/c34e55eedbfca2a90a512516925f207e6be03813", "committedDate": "2020-09-04T09:27:22Z", "message": "Add RepeatingGroupFactory unique id generation test"}, "afterCommit": {"oid": "bdbc3f8f435ea642f52bdaec5ce45e2be5c79007", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/bdbc3f8f435ea642f52bdaec5ce45e2be5c79007", "committedDate": "2020-09-04T09:33:05Z", "message": "Add RepeatingGroupFactory unique id generation test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "631159c26bb0b345203b06e3542abb8d4805b10c", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/631159c26bb0b345203b06e3542abb8d4805b10c", "committedDate": "2020-09-04T13:57:10Z", "message": "Pull repeating group count field label from repeating group widget"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9b7b4af487f903db3aeb1a55f135b315faccf5cc", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/9b7b4af487f903db3aeb1a55f135b315faccf5cc", "committedDate": "2020-09-04T13:39:21Z", "message": "Pull repeating group count field label from repeating group widget"}, "afterCommit": {"oid": "631159c26bb0b345203b06e3542abb8d4805b10c", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/631159c26bb0b345203b06e3542abb8d4805b10c", "committedDate": "2020-09-04T13:57:10Z", "message": "Pull repeating group count field label from repeating group widget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "877163f20bacfba6fbfb6eeb77f053c9813ec04f", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/877163f20bacfba6fbfb6eeb77f053c9813ec04f", "committedDate": "2020-09-04T14:20:35Z", "message": "Fix failing tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMjY5MzY2", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/476#pullrequestreview-483269366", "createdAt": "2020-09-07T06:23:51Z", "commit": {"oid": "877163f20bacfba6fbfb6eeb77f053c9813ec04f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNjoyMzo1MVrOHNxlhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNjo1MzoyNFrOHNyQ2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIwNTk1OA==", "bodyText": "This change will break stuff for us.", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/476#discussion_r484205958", "createdAt": "2020-09-07T06:23:51Z", "author": {"login": "bennsimon"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/task/AttachRepeatingGroupTask.java", "diffHunk": "@@ -192,7 +192,7 @@ private void formatRepeatingGroupLabelText(EditText referenceEditText, TextView\n \n     protected void addUniqueIdentifiers(JSONObject element, String uniqueId) throws JSONException {\n         // make repeating group element key unique\n-        String currKey = element.getString(KEY);\n+        String currKey = widgetArgs.getJsonObject().getString(KEY) + \"_\" + element.getString(KEY);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "877163f20bacfba6fbfb6eeb77f053c9813ec04f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIwNjI5Ng==", "bodyText": "Any reason for this because this change might break other people's code.", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/476#discussion_r484206296", "createdAt": "2020-09-07T06:24:48Z", "author": {"login": "bennsimon"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/widgets/RepeatingGroupFactory.java", "diffHunk": "@@ -221,22 +255,33 @@ private void retrieveRepeatingGroupCountFromRemoteReferenceEditText(final @NonNu\n     }\n \n     @VisibleForTesting\n-    protected void setGlobalLayoutListener(@NonNull final View rootLayout, @NonNull final MaterialEditText referenceEditText, final int remoteReferenceValue) {\n+    protected void setGlobalLayoutListener(@NonNull final View rootLayout,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "877163f20bacfba6fbfb6eeb77f053c9813ec04f"}, "originalPosition": 188}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIwNjQ5MQ==", "bodyText": "This change will break our code.", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/476#discussion_r484206491", "createdAt": "2020-09-07T06:25:16Z", "author": {"login": "bennsimon"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/widgets/RepeatingGroupFactory.java", "diffHunk": "@@ -305,23 +366,26 @@ private void addRequiredValidator(JSONObject jsonObject, MaterialEditText editTe\n         }\n     }\n \n-    protected void addOnDoneAction(TextView textView) {\n+    protected void addOnDoneAction(final TextView textView, final ImageButton doneButton, final WidgetArgs widgetArgs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "877163f20bacfba6fbfb6eeb77f053c9813ec04f"}, "originalPosition": 281}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIwNzA3NA==", "bodyText": "Any reason why you relocated this? It might break code for others.", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/476#discussion_r484207074", "createdAt": "2020-09-07T06:26:50Z", "author": {"login": "bennsimon"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/widgets/RepeatingGroupFactory.java", "diffHunk": "@@ -59,31 +65,29 @@\n public class RepeatingGroupFactory implements FormWidgetFactory {\n \n     private static Map<Integer, String> repeatingGroupLayouts = new HashMap<>();\n-    private final String REFERENCE_EDIT_TEXT_HINT = \"reference_edit_text_hint\";\n+    public static final String REFERENCE_EDIT_TEXT_HINT = \"reference_edit_text_hint\";\n     private final String REPEATING_GROUP_LABEL = \"repeating_group_label\";\n     private final String REFERENCE_EDIT_TEXT = \"reference_edit_text\";\n     private final String REPEATING_GROUP_MAX = \"repeating_group_max\";\n     private final String REPEATING_GROUP_MIN = \"repeating_group_min\";\n     protected int MAX_NUM_REPEATING_GROUPS = 35;\n     protected int MIN_NUM_REPEATING_GROUPS = 0;\n-    private ImageButton doneButton;\n-    private WidgetArgs widgetArgs;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "877163f20bacfba6fbfb6eeb77f053c9813ec04f"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIxMjMzMg==", "bodyText": "You could use the api to write data here, since for other projects the count may have openmrs attributes.", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/476#discussion_r484212332", "createdAt": "2020-09-07T06:41:25Z", "author": {"login": "bennsimon"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/widgets/RepeatingGroupFactory.java", "diffHunk": "@@ -289,11 +338,23 @@ public void onTextChanged(CharSequence s, int start, int before, int count) {\n             @Override\n             public void afterTextChanged(Editable s) {\n                 doneButton.setImageResource(R.drawable.ic_done_grey);\n-                JsonFormFragmentPresenter.validate(widgetArgs.getFormFragment(), referenceEditText, false);\n+                ValidationStatus validationStatus = JsonFormFragmentPresenter\n+                        .validate(widgetArgs.getFormFragment(), referenceEditText, false);\n+                if (validationStatus.isValid()) {\n+                    writeJsonObjectValue(repeatingGroupCount, s.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "877163f20bacfba6fbfb6eeb77f053c9813ec04f"}, "originalPosition": 259}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIxNzA0OQ==", "bodyText": "So here just curious:\n\nWhat prevents several widgetArgs.getJsonObject().get(KEY) + \"_count\" fields added to the form step several times depending on back and forth form traversals.\nWhy is the type an empty string?\nWhat is the text for?\nWhat is the use of openmrs entity ids if the value is not written by JsonApi write method", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/476#discussion_r484217049", "createdAt": "2020-09-07T06:53:24Z", "author": {"login": "bennsimon"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/widgets/RepeatingGroupFactory.java", "diffHunk": "@@ -109,18 +117,36 @@\n             doneButton.setOnClickListener(new View.OnClickListener() {\n                 @Override\n                 public void onClick(View v) {\n-                    addOnDoneAction(referenceEditText);\n+                    addOnDoneAction(referenceEditText, doneButton, widgetArgs);\n                 }\n             });\n         }\n \n         ((JsonApi) context).addFormDataView(referenceEditText);\n-        setViewTags(rootLayout);\n-        prepareViewChecks(rootLayout, context);\n+        setViewTags(rootLayout, widgetArgs);\n+        prepareViewChecks(rootLayout, context, widgetArgs);\n \n         return views;\n     }\n \n+    /**\n+     * Returns the object that holds the repeating group count\n+     *\n+     * @return\n+     * @throws JSONException\n+     */\n+    private JSONObject getRepeatingGroupCountObj(WidgetArgs widgetArgs) throws JSONException {\n+        JSONObject repeatingGroupCount = new JSONObject();\n+        repeatingGroupCount.put(KEY, widgetArgs.getJsonObject().get(KEY) + \"_count\");\n+        repeatingGroupCount.put(OPENMRS_ENTITY_PARENT, \"\");\n+        repeatingGroupCount.put(OPENMRS_ENTITY, \"\");\n+        repeatingGroupCount.put(OPENMRS_ENTITY_ID, \"\");\n+        repeatingGroupCount.put(TYPE, \"\");\n+        repeatingGroupCount.put(TEXT, widgetArgs.getJsonObject().get(REFERENCE_EDIT_TEXT_HINT));\n+        getStepFields(getJsonApi(widgetArgs).getStep(widgetArgs.getStepName())).put(repeatingGroupCount);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "877163f20bacfba6fbfb6eeb77f053c9813ec04f"}, "originalPosition": 111}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5327a2bc87cb05a58f1a4a1458180d60483ba115", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/5327a2bc87cb05a58f1a4a1458180d60483ba115", "committedDate": "2020-09-10T09:59:01Z", "message": "Revert appending parent key in repeating group child element"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f32f8705793a7828c99ee5fda8ff3cb6984d85fb", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/f32f8705793a7828c99ee5fda8ff3cb6984d85fb", "committedDate": "2020-09-10T09:59:11Z", "message": "Revert \"Add RepeatingGroupFactory unique id generation test\"\n\nThis reverts commit bdbc3f8f435ea642f52bdaec5ce45e2be5c79007."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02da9747a1da4d0881157dc38928dcca34dfa4df", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/02da9747a1da4d0881157dc38928dcca34dfa4df", "committedDate": "2020-09-10T12:20:31Z", "message": "Do not re-add the repeating group count object during form traversals"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a1b473012cc89bd1ee19679886f2e46e87eaad9", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/1a1b473012cc89bd1ee19679886f2e46e87eaad9", "committedDate": "2020-09-10T10:06:54Z", "message": "Do not re-add the repeating group count object during form traversals"}, "afterCommit": {"oid": "02da9747a1da4d0881157dc38928dcca34dfa4df", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/02da9747a1da4d0881157dc38928dcca34dfa4df", "committedDate": "2020-09-10T12:20:31Z", "message": "Do not re-add the repeating group count object during form traversals"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2823891452ac511048ddec986e1dbd828a3f127", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/e2823891452ac511048ddec986e1dbd828a3f127", "committedDate": "2020-09-10T13:04:25Z", "message": "Add RepeatingGroupFactory test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "463292fbfb1c278f75fc626274b831b2d78d54c9", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/463292fbfb1c278f75fc626274b831b2d78d54c9", "committedDate": "2020-09-10T15:11:26Z", "message": "Return exitsting repeating group obj"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e2f8534db6e97dc5e3e4e1c0d9d5a31029ab73e3", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/e2f8534db6e97dc5e3e4e1c0d9d5a31029ab73e3", "committedDate": "2020-09-10T13:33:07Z", "message": "Return exitsting repeating group obj"}, "afterCommit": {"oid": "463292fbfb1c278f75fc626274b831b2d78d54c9", "author": {"user": {"login": "vincent-karuri", "name": null}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/463292fbfb1c278f75fc626274b831b2d78d54c9", "committedDate": "2020-09-10T15:11:26Z", "message": "Return exitsting repeating group obj"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NDk0MjI0", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/476#pullrequestreview-486494224", "createdAt": "2020-09-11T05:59:57Z", "commit": {"oid": "463292fbfb1c278f75fc626274b831b2d78d54c9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2421, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}