{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1Njg0MDU3", "number": 361, "title": "Remove deleted views", "bodyText": "remove deleted views from form json", "createdAt": "2020-02-15T06:08:22Z", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/361", "merged": true, "mergeCommit": {"oid": "01ffafff857102bf9ea9f8d60bf9a4bff74f0e20"}, "closed": true, "closedAt": "2020-02-17T12:33:44Z", "author": {"login": "manutarus"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEdyJaAH2gAyMzc1Njg0MDU3OjUzNWNkZjhmYWI0ZGE1ZjIyNmE3NGFhY2NjZWE4YjUyNjZjNTE2ZWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFMYggAFqTM1OTY5NTc3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "535cdf8fab4da5f226a74aacccea8b5266c516ef", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/535cdf8fab4da5f226a74aacccea8b5266c516ef", "committedDate": "2020-02-15T06:03:48Z", "message": "remove deleted views from form json"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d3bcdb8fd520710ca72df1a8e0bea3abfdc2eae", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/5d3bcdb8fd520710ca72df1a8e0bea3abfdc2eae", "committedDate": "2020-02-15T06:05:54Z", "message": "Bump up version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6813e0c56dc4868e11294b295d9e1c2ecdc4f791", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/6813e0c56dc4868e11294b295d9e1c2ecdc4f791", "committedDate": "2020-02-15T06:10:55Z", "message": "Invoke refresh logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d9a795333ce27d89a46392b2a18cc546924b722", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/1d9a795333ce27d89a46392b2a18cc546924b722", "committedDate": "2020-02-15T06:26:50Z", "message": "remove unused imports reported by codacy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6233b90e6eec5addf17ee446a9713eb6f1c492ea", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/6233b90e6eec5addf17ee446a9713eb6f1c492ea", "committedDate": "2020-02-15T08:50:54Z", "message": "reformat code structure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NTc4MTcw", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/361#pullrequestreview-359578170", "createdAt": "2020-02-17T09:08:14Z", "commit": {"oid": "6233b90e6eec5addf17ee446a9713eb6f1c492ea"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwOTowODoxNFrOFqc28g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwOToxNToyOVrOFqdEjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA1NzMzMA==", "bodyText": "What is this arrayList for?", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/361#discussion_r380057330", "createdAt": "2020-02-17T09:08:14Z", "author": {"login": "bennsimon"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/task/AttachRepeatingGroupTask.java", "diffHunk": "@@ -72,6 +74,7 @@ public AttachRepeatingGroupTask(final ViewParent parent, int numRepeatingGroups,\n     @Override\n     protected void onPreExecute() {\n         showProgressDialog(R.string.please_wait_title, R.string.creating_repeating_group_message, widgetArgs.getFormFragment().getContext());\n+        repeatingGroups = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6233b90e6eec5addf17ee446a9713eb6f1c492ea"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA1NzQ1Nw==", "bodyText": "I think the comment here can be updated", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/361#discussion_r380057457", "createdAt": "2020-02-17T09:08:32Z", "author": {"login": "bennsimon"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/task/AttachRepeatingGroupTask.java", "diffHunk": "@@ -100,14 +104,27 @@ protected void onPostExecute(List<View> result) {\n                     keysToRemove.add(repeatingGroupKey);\n                     rootLayout.removeViewAt(i);\n                 }\n-                // remove deleted fields from form json\n+//                remove deleted fields from form json\n+                ArrayList<String> removeThisFields = new ArrayList<>();\n                 int len = fields.length();\n                 for (int i = len - 1; i >= 0; i--) {\n                     String[] key = ((String) fields.getJSONObject(i).get(KEY)).split(\"_\");\n                     if (keysToRemove.contains(key[key.length - 1])) {\n+                        removeThisFields.add((String) fields.getJSONObject(i).get(KEY));\n                         fields.remove(i);\n                     }\n                 }\n+//                remove deleted views from form json", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6233b90e6eec5addf17ee446a9713eb6f1c492ea"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA2MDA1MA==", "bodyText": "This method seems reusable you can add it in utils", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/361#discussion_r380060050", "createdAt": "2020-02-17T09:13:55Z", "author": {"login": "bennsimon"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/task/AttachRepeatingGroupTask.java", "diffHunk": "@@ -100,14 +104,27 @@ protected void onPostExecute(List<View> result) {\n                     keysToRemove.add(repeatingGroupKey);\n                     rootLayout.removeViewAt(i);\n                 }\n-                // remove deleted fields from form json\n+//                remove deleted fields from form json\n+                ArrayList<String> removeThisFields = new ArrayList<>();\n                 int len = fields.length();\n                 for (int i = len - 1; i >= 0; i--) {\n                     String[] key = ((String) fields.getJSONObject(i).get(KEY)).split(\"_\");\n                     if (keysToRemove.contains(key[key.length - 1])) {\n+                        removeThisFields.add((String) fields.getJSONObject(i).get(KEY));\n                         fields.remove(i);\n                     }\n                 }\n+//                remove deleted views from form json\n+                Collection<View> viewCollection =  widgetArgs.getFormFragment().getJsonApi().getFormDataViews();\n+                Iterator<View> viewIterator = viewCollection.iterator();\n+                while (viewIterator.hasNext()){\n+                    View view = viewIterator.next();\n+                    String key = (String) view.getTag(R.id.key);\n+                    if(removeThisFields.contains(key)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6233b90e6eec5addf17ee446a9713eb6f1c492ea"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA2MDgxNA==", "bodyText": "I think you should check for null in this chained method calls widgetArgs.getFormFragment().getJsonApi().getFormDataViews()", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/361#discussion_r380060814", "createdAt": "2020-02-17T09:15:29Z", "author": {"login": "bennsimon"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/task/AttachRepeatingGroupTask.java", "diffHunk": "@@ -100,14 +104,27 @@ protected void onPostExecute(List<View> result) {\n                     keysToRemove.add(repeatingGroupKey);\n                     rootLayout.removeViewAt(i);\n                 }\n-                // remove deleted fields from form json\n+//                remove deleted fields from form json\n+                ArrayList<String> removeThisFields = new ArrayList<>();\n                 int len = fields.length();\n                 for (int i = len - 1; i >= 0; i--) {\n                     String[] key = ((String) fields.getJSONObject(i).get(KEY)).split(\"_\");\n                     if (keysToRemove.contains(key[key.length - 1])) {\n+                        removeThisFields.add((String) fields.getJSONObject(i).get(KEY));\n                         fields.remove(i);\n                     }\n                 }\n+//                remove deleted views from form json\n+                Collection<View> viewCollection =  widgetArgs.getFormFragment().getJsonApi().getFormDataViews();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6233b90e6eec5addf17ee446a9713eb6f1c492ea"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e321e67070578c86cf66b3462c5709b7183df06f", "author": {"user": {"login": "manutarus", "name": "Emmanuel Tarus"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/e321e67070578c86cf66b3462c5709b7183df06f", "committedDate": "2020-02-17T11:51:29Z", "message": "abstract fuction to remove deleted feilds from form json object"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5Njk1Nzc4", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/361#pullrequestreview-359695778", "createdAt": "2020-02-17T12:21:20Z", "commit": {"oid": "e321e67070578c86cf66b3462c5709b7183df06f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2440, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}