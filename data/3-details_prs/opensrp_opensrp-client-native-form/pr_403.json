{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5NDU0NDcx", "number": 403, "title": "Adds a native form testing app", "bodyText": "Adds a native form testing app.\ncloses #399", "createdAt": "2020-04-06T08:01:23Z", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403", "merged": true, "mergeCommit": {"oid": "2bb091e202ecfce35d4b44ed87f883b1a7134bf9"}, "closed": true, "closedAt": "2020-08-12T12:05:20Z", "author": {"login": "rkodev"}, "timelineItems": {"totalCount": 41, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcU6BstgH2gAyMzk5NDU0NDcxOmM2NzBkYmE1ODQ1ZGEyNjY2Y2Y4NjNmMDA3NmQ5NjViODFlYTlkZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc-Jh5AgH2gAyMzk5NDU0NDcxOmRkZjk1YjEyNDYyNjI3MjAyZWRkNTAxZDk3NjFjZTQ2OGFkYzgzZmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c670dba5845da2666cf863f0076d965b81ea9ddd", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/c670dba5845da2666cf863f0076d965b81ea9ddd", "committedDate": "2020-04-06T08:00:55Z", "message": "Adds a native form testing app"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32daab0d84d3d6d6ea98e1705fb8b502f0ae88f9", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/32daab0d84d3d6d6ea98e1705fb8b502f0ae88f9", "committedDate": "2020-04-06T08:01:29Z", "message": "Merge branch 'master' into native_form_tester"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b8163277a8c08657bda53171cd23430945d15f7", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/0b8163277a8c08657bda53171cd23430945d15f7", "committedDate": "2020-04-06T10:52:25Z", "message": "Update sample form structure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da0bf1c3ba1642cb33a8212f975293a47dc21288", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/da0bf1c3ba1642cb33a8212f975293a47dc21288", "committedDate": "2020-04-07T12:42:18Z", "message": "Update form data source"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fab70629397ae47d6f6ff502ff1451fd2f444e4", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/7fab70629397ae47d6f6ff502ff1451fd2f444e4", "committedDate": "2020-04-07T15:01:33Z", "message": "Read 'Form' config object from disk"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2327e548b5e7a01a8ed75e250e9e33145983deb", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/b2327e548b5e7a01a8ed75e250e9e33145983deb", "committedDate": "2020-04-07T16:40:12Z", "message": "Adds custom config forms"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df3b56e50d8a4730041a512908b52d8c8e2839f3", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/df3b56e50d8a4730041a512908b52d8c8e2839f3", "committedDate": "2020-04-07T16:44:46Z", "message": "Fix codacy strikes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "602e102d95601f333ab4a3151d5a11a82953add3", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/602e102d95601f333ab4a3151d5a11a82953add3", "committedDate": "2020-04-07T16:54:18Z", "message": "Run device read threads on executor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea90807def0185c1d12a2c25faba62bdea3f04bc", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/ea90807def0185c1d12a2c25faba62bdea3f04bc", "committedDate": "2020-04-07T16:54:38Z", "message": "Merge branch 'master' into native_form_tester"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9040cb1ee36ec10938b460948e8fc7a11e35a0c9", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/9040cb1ee36ec10938b460948e8fc7a11e35a0c9", "committedDate": "2020-04-20T10:12:19Z", "message": "Merge branch 'master' into native_form_tester"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NDc4MDg4", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#pullrequestreview-396478088", "createdAt": "2020-04-20T13:57:28Z", "commit": {"oid": "7fab70629397ae47d6f6ff502ff1451fd2f444e4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxMzo1NzoyOVrOGIV0aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxMzo1NzoyOVrOGIV0aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM5OTI3NQ==", "bodyText": "This class looks very similar to  com.vijay.jsonwizard.domain.Form.", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#discussion_r411399275", "createdAt": "2020-04-20T13:57:29Z", "author": {"login": "vincent-karuri"}, "path": "sample/src/main/java/org/smartregister/nativeform/domain/ConfigForm.java", "diffHunk": "@@ -0,0 +1,192 @@\n+package org.smartregister.nativeform.domain;\n+\n+import android.content.Context;\n+\n+import com.vijay.jsonwizard.domain.Form;\n+\n+import org.smartregister.nativeform.util.FileReaderUtil;\n+import org.smartregister.nativeform.util.ResourceType;\n+\n+import java.util.Set;\n+\n+public class ConfigForm {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7fab70629397ae47d6f6ff502ff1451fd2f444e4"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTA5Nzc2", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#pullrequestreview-396509776", "createdAt": "2020-04-20T14:31:06Z", "commit": {"oid": "9040cb1ee36ec10938b460948e8fc7a11e35a0c9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDozMTowNlrOGIXdkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDozMTowNlrOGIXdkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQyNjE5Mw==", "bodyText": "json.form this appears throughout the code, maybe use a constant in it's place?", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#discussion_r411426193", "createdAt": "2020-04-20T14:31:06Z", "author": {"login": "vincent-karuri"}, "path": "sample/src/main/java/org/smartregister/nativeform/interactor/FormTesterInteractor.java", "diffHunk": "@@ -0,0 +1,185 @@\n+package org.smartregister.nativeform.interactor;\n+\n+import android.content.Context;\n+import android.content.res.AssetManager;\n+import android.os.Environment;\n+import android.os.Handler;\n+import android.os.Looper;\n+import android.support.annotation.Nullable;\n+\n+import com.google.gson.Gson;\n+import com.vijay.jsonwizard.constants.JsonFormConstants;\n+import com.vijay.jsonwizard.domain.Form;\n+\n+import org.jetbrains.annotations.NotNull;\n+import org.smartregister.nativeform.contract.FormTesterContract;\n+import org.smartregister.nativeform.domain.ConfigForm;\n+import org.smartregister.nativeform.domain.JsonForm;\n+import org.smartregister.nativeform.util.FileReaderUtil;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+\n+public class FormTesterInteractor implements FormTesterContract.Interactor {\n+    private Gson gson = null;\n+    private ExecutorService executorService = Executors.newFixedThreadPool(1);\n+\n+    @Override\n+    public void exportDefaultForms(Context context, FormTesterContract.Presenter presenter) {\n+        executorService.execute(() -> {\n+            AssetManager assetManager = context.getAssets();\n+            try {\n+                String root = verifyOrCreateDiskDirectory();\n+\n+                String[] image_source = {\"json.form\", \"json.form.config\", \"img\", \"image\", \"rule\"};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9040cb1ee36ec10938b460948e8fc7a11e35a0c9"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTEyMzMw", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#pullrequestreview-396512330", "createdAt": "2020-04-20T14:33:47Z", "commit": {"oid": "9040cb1ee36ec10938b460948e8fc7a11e35a0c9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDozMzo0N1rOGIXl-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDozMzo0N1rOGIXl-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQyODM0NA==", "bodyText": "Snake case?", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#discussion_r411428344", "createdAt": "2020-04-20T14:33:47Z", "author": {"login": "vincent-karuri"}, "path": "sample/src/main/java/org/smartregister/nativeform/interactor/FormTesterInteractor.java", "diffHunk": "@@ -0,0 +1,185 @@\n+package org.smartregister.nativeform.interactor;\n+\n+import android.content.Context;\n+import android.content.res.AssetManager;\n+import android.os.Environment;\n+import android.os.Handler;\n+import android.os.Looper;\n+import android.support.annotation.Nullable;\n+\n+import com.google.gson.Gson;\n+import com.vijay.jsonwizard.constants.JsonFormConstants;\n+import com.vijay.jsonwizard.domain.Form;\n+\n+import org.jetbrains.annotations.NotNull;\n+import org.smartregister.nativeform.contract.FormTesterContract;\n+import org.smartregister.nativeform.domain.ConfigForm;\n+import org.smartregister.nativeform.domain.JsonForm;\n+import org.smartregister.nativeform.util.FileReaderUtil;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+\n+public class FormTesterInteractor implements FormTesterContract.Interactor {\n+    private Gson gson = null;\n+    private ExecutorService executorService = Executors.newFixedThreadPool(1);\n+\n+    @Override\n+    public void exportDefaultForms(Context context, FormTesterContract.Presenter presenter) {\n+        executorService.execute(() -> {\n+            AssetManager assetManager = context.getAssets();\n+            try {\n+                String root = verifyOrCreateDiskDirectory();\n+\n+                String[] image_source = {\"json.form\", \"json.form.config\", \"img\", \"image\", \"rule\"};\n+                for (String sourceDir : image_source) {\n+                    exportDirectory(assetManager, sourceDir, context, root, true);\n+                }\n+\n+                readForms(context, presenter);\n+            } catch (IOException e) {\n+                e.printStackTrace();\n+            }\n+        });\n+    }\n+\n+    private void exportDirectory(AssetManager assetManager, String sourceDir, Context context, String root, boolean createRoot) throws IOException {\n+        String[] local_assets = assetManager.list(sourceDir);\n+        if (local_assets != null && local_assets.length > 0) {\n+            for (String assetName : local_assets) {\n+                // export all in\n+                try {\n+\n+                    // if the assetName is a folder extract this\n+                    String[] child_assets = assetManager.list(sourceDir + \"/\" + assetName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9040cb1ee36ec10938b460948e8fc7a11e35a0c9"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTE2MzU5", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#pullrequestreview-396516359", "createdAt": "2020-04-20T14:38:05Z", "commit": {"oid": "9040cb1ee36ec10938b460948e8fc7a11e35a0c9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDozODowNVrOGIXyvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDozODowNVrOGIXyvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQzMTYxMg==", "bodyText": "Why not use convertStreamToString here?", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#discussion_r411431612", "createdAt": "2020-04-20T14:38:05Z", "author": {"login": "vincent-karuri"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/filesource/AssetsFileSource.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package com.vijay.jsonwizard.filesource;\n+\n+import android.content.Context;\n+\n+import com.vijay.jsonwizard.interfaces.FormFileSource;\n+\n+import org.jeasy.rules.api.Rules;\n+import org.jeasy.rules.mvel.MVELRuleFactory;\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+\n+import timber.log.Timber;\n+\n+/***\n+ * used to read files stored on the APP's asset folder\n+ *\n+ */\n+public class AssetsFileSource implements FormFileSource {\n+\n+    public static AssetsFileSource INSTANCE = new AssetsFileSource();\n+\n+    private AssetsFileSource() {\n+    }\n+\n+    @Override\n+    public Rules getRulesFromFile(Context context, String fileName) throws Exception {\n+        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(context.getAssets().open(fileName)));\n+        return MVELRuleFactory.createRulesFrom(bufferedReader);\n+    }\n+\n+    @Override\n+    public JSONObject getFormFromFile(Context context, String fileName) {\n+        try {\n+            String newFileName = \"json.form/\" + fileName + \".json\";\n+\n+            InputStream inputStream = context.getAssets()\n+                    .open(newFileName);\n+\n+            BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream,\n+                    \"UTF-8\"));\n+            String jsonString;\n+            StringBuilder stringBuilder = new StringBuilder();\n+            while ((jsonString = reader.readLine()) != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9040cb1ee36ec10938b460948e8fc7a11e35a0c9"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTE3Mjk0", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#pullrequestreview-396517294", "createdAt": "2020-04-20T14:39:07Z", "commit": {"oid": "9040cb1ee36ec10938b460948e8fc7a11e35a0c9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDozOTowN1rOGIX11w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDozOTowN1rOGIX11w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQzMjQwNw==", "bodyText": "Why not use getFileInputStream here?", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#discussion_r411432407", "createdAt": "2020-04-20T14:39:07Z", "author": {"login": "vincent-karuri"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/filesource/AssetsFileSource.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package com.vijay.jsonwizard.filesource;\n+\n+import android.content.Context;\n+\n+import com.vijay.jsonwizard.interfaces.FormFileSource;\n+\n+import org.jeasy.rules.api.Rules;\n+import org.jeasy.rules.mvel.MVELRuleFactory;\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+\n+import timber.log.Timber;\n+\n+/***\n+ * used to read files stored on the APP's asset folder\n+ *\n+ */\n+public class AssetsFileSource implements FormFileSource {\n+\n+    public static AssetsFileSource INSTANCE = new AssetsFileSource();\n+\n+    private AssetsFileSource() {\n+    }\n+\n+    @Override\n+    public Rules getRulesFromFile(Context context, String fileName) throws Exception {\n+        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(context.getAssets().open(fileName)));\n+        return MVELRuleFactory.createRulesFrom(bufferedReader);\n+    }\n+\n+    @Override\n+    public JSONObject getFormFromFile(Context context, String fileName) {\n+        try {\n+            String newFileName = \"json.form/\" + fileName + \".json\";\n+\n+            InputStream inputStream = context.getAssets()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9040cb1ee36ec10938b460948e8fc7a11e35a0c9"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTMwMTIz", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#pullrequestreview-396530123", "createdAt": "2020-04-20T14:52:45Z", "commit": {"oid": "9040cb1ee36ec10938b460948e8fc7a11e35a0c9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDo1Mjo0NVrOGIYglg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQxNDo1Mjo0NVrOGIYglg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ0MzM1MA==", "bodyText": "Snake case?", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#discussion_r411443350", "createdAt": "2020-04-20T14:52:45Z", "author": {"login": "vincent-karuri"}, "path": "sample/src/main/java/org/smartregister/nativeform/interactor/FormTesterInteractor.java", "diffHunk": "@@ -0,0 +1,185 @@\n+package org.smartregister.nativeform.interactor;\n+\n+import android.content.Context;\n+import android.content.res.AssetManager;\n+import android.os.Environment;\n+import android.os.Handler;\n+import android.os.Looper;\n+import android.support.annotation.Nullable;\n+\n+import com.google.gson.Gson;\n+import com.vijay.jsonwizard.constants.JsonFormConstants;\n+import com.vijay.jsonwizard.domain.Form;\n+\n+import org.jetbrains.annotations.NotNull;\n+import org.smartregister.nativeform.contract.FormTesterContract;\n+import org.smartregister.nativeform.domain.ConfigForm;\n+import org.smartregister.nativeform.domain.JsonForm;\n+import org.smartregister.nativeform.util.FileReaderUtil;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+\n+public class FormTesterInteractor implements FormTesterContract.Interactor {\n+    private Gson gson = null;\n+    private ExecutorService executorService = Executors.newFixedThreadPool(1);\n+\n+    @Override\n+    public void exportDefaultForms(Context context, FormTesterContract.Presenter presenter) {\n+        executorService.execute(() -> {\n+            AssetManager assetManager = context.getAssets();\n+            try {\n+                String root = verifyOrCreateDiskDirectory();\n+\n+                String[] image_source = {\"json.form\", \"json.form.config\", \"img\", \"image\", \"rule\"};\n+                for (String sourceDir : image_source) {\n+                    exportDirectory(assetManager, sourceDir, context, root, true);\n+                }\n+\n+                readForms(context, presenter);\n+            } catch (IOException e) {\n+                e.printStackTrace();\n+            }\n+        });\n+    }\n+\n+    private void exportDirectory(AssetManager assetManager, String sourceDir, Context context, String root, boolean createRoot) throws IOException {\n+        String[] local_assets = assetManager.list(sourceDir);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9040cb1ee36ec10938b460948e8fc7a11e35a0c9"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NTMzODA4", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#pullrequestreview-396533808", "createdAt": "2020-04-20T14:56:34Z", "commit": {"oid": "9040cb1ee36ec10938b460948e8fc7a11e35a0c9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cefc53359d6e5af6847a2890b25faa44d7182131", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/cefc53359d6e5af6847a2890b25faa44d7182131", "committedDate": "2020-04-21T15:33:23Z", "message": "Fix file name, Introduce form constants"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b7b8ec6bf8b0f284cc0cb362a83f0ef203760c5", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/6b7b8ec6bf8b0f284cc0cb362a83f0ef203760c5", "committedDate": "2020-04-21T15:42:21Z", "message": "Merge branch 'master' into native_form_tester"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfd076f295f8ad28072e32dfa788d98fc45a0992", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/cfd076f295f8ad28072e32dfa788d98fc45a0992", "committedDate": "2020-04-21T16:05:53Z", "message": "Merge branch 'native_form_tester' of github.com:OpenSRP/opensrp-client-native-form into native_form_tester"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2273fc8d82587b466100397c931c1d5c8e468693", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/2273fc8d82587b466100397c931c1d5c8e468693", "committedDate": "2020-07-29T13:06:20Z", "message": "Merge origin master to branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69289264fa3c96141920da0631fb6a05b1098588", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/69289264fa3c96141920da0631fb6a05b1098588", "committedDate": "2020-07-29T13:46:13Z", "message": "Refactor code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c9b5dbebfc9e9e65ec6c47bab682b92e271ec18", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/5c9b5dbebfc9e9e65ec6c47bab682b92e271ec18", "committedDate": "2020-07-29T14:09:09Z", "message": "Separate sample app and form tester app"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d35819007ab9b8614bb2873570de7c992c128b57", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/d35819007ab9b8614bb2873570de7c992c128b57", "committedDate": "2020-07-29T14:39:16Z", "message": "Fix bug on rules engine"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66ddee69eba592a20da41d13b7a66488d45dd0f4", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/66ddee69eba592a20da41d13b7a66488d45dd0f4", "committedDate": "2020-07-29T15:09:53Z", "message": "Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5348ec346467b4aef3414100d8f2985e942f8656", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/5348ec346467b4aef3414100d8f2985e942f8656", "committedDate": "2020-07-29T15:43:36Z", "message": "Reuse Utils class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31b5dc2ac1ffa2b2080c1261b30c72eb2d039db7", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/31b5dc2ac1ffa2b2080c1261b30c72eb2d039db7", "committedDate": "2020-07-29T15:55:56Z", "message": "Remove NPath on ConfigForm"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTUwMjAx", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#pullrequestreview-458150201", "createdAt": "2020-07-30T07:30:41Z", "commit": {"oid": "5348ec346467b4aef3414100d8f2985e942f8656"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzozMDo0MVrOG5XSdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNzozMDo0MVrOG5XSdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgwMzU3NQ==", "bodyText": "You can use Timber", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#discussion_r462803575", "createdAt": "2020-07-30T07:30:41Z", "author": {"login": "vincent-karuri"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/Utils.java", "diffHunk": "@@ -803,6 +808,16 @@ public static String formatDateToPattern(String date, String inputFormat, String\n         format = new SimpleDateFormat(outputFormat);\n         return format.format(newDate);\n     }\n+\n+    public static int getResourceId(Context context, String name, ResourceType resourceType)\n+    {\n+        try {\n+            return context.getResources().getIdentifier(name, resourceType.getType(), context.getPackageName());\n+        } catch (Exception e) {\n+            e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5348ec346467b4aef3414100d8f2985e942f8656"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32a12cdfb2e6875ffb1f7163cf995f388a4d6584", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/32a12cdfb2e6875ffb1f7163cf995f388a4d6584", "committedDate": "2020-07-30T09:37:49Z", "message": "Adds unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b93b62c08b63d425b9c4158318c31058f8397be9", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/b93b62c08b63d425b9c4158318c31058f8397be9", "committedDate": "2020-07-30T11:39:52Z", "message": "Fix builf"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "deaf63a82c5f97df6521dc8fd53bf9addcc3c7ad", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/deaf63a82c5f97df6521dc8fd53bf9addcc3c7ad", "committedDate": "2020-07-30T11:48:26Z", "message": "Merge branch 'master' into native_form_tester"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5fffd6b1e65b485e2736ec3619bea96645af7fb", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/b5fffd6b1e65b485e2736ec3619bea96645af7fb", "committedDate": "2020-07-30T11:49:00Z", "message": "Remove unused imports  in AssetsFileSourceTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMDY3ODQ3", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#pullrequestreview-460067847", "createdAt": "2020-08-03T14:21:23Z", "commit": {"oid": "b5fffd6b1e65b485e2736ec3619bea96645af7fb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDoyMToyNFrOG67ezQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDoyMToyNFrOG67ezQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ0NTEzMw==", "bodyText": "Why not call getFileInputStream(Context context, String fileName) here?", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#discussion_r464445133", "createdAt": "2020-08-03T14:21:24Z", "author": {"login": "vincent-karuri"}, "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/filesource/AssetsFileSource.java", "diffHunk": "@@ -0,0 +1,45 @@\n+package com.vijay.jsonwizard.filesource;\n+\n+import android.content.Context;\n+\n+import com.vijay.jsonwizard.constants.JsonFormConstants;\n+import com.vijay.jsonwizard.interfaces.FormFileSource;\n+import com.vijay.jsonwizard.utils.Utils;\n+\n+import org.jeasy.rules.api.Rules;\n+import org.jeasy.rules.mvel.MVELRuleFactory;\n+import org.json.JSONObject;\n+\n+import java.io.BufferedReader;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+\n+/***\n+ * used to read files stored on the APP's asset folder\n+ *\n+ */\n+public class AssetsFileSource implements FormFileSource {\n+\n+    public static AssetsFileSource INSTANCE = new AssetsFileSource();\n+\n+    private AssetsFileSource() {\n+    }\n+\n+    @Override\n+    public Rules getRulesFromFile(Context context, String fileName) throws Exception {\n+        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(context.getAssets().open(fileName)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5fffd6b1e65b485e2736ec3619bea96645af7fb"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMDc3MjIx", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#pullrequestreview-460077221", "createdAt": "2020-08-03T14:32:26Z", "commit": {"oid": "32a12cdfb2e6875ffb1f7163cf995f388a4d6584"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDozMjoyNlrOG6764w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDozMjoyNlrOG6764w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ1MjMyMw==", "bodyText": "Wouldn't it be better to verify that the content is as expected and not just that it's not empty?", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#discussion_r464452323", "createdAt": "2020-08-03T14:32:26Z", "author": {"login": "vincent-karuri"}, "path": "android-json-form-wizard/src/test/java/com/vijay/jsonwizard/filesource/DiskFileSourceTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.vijay.jsonwizard.filesource;\n+\n+import android.content.Context;\n+import android.os.Environment;\n+\n+import org.jeasy.rules.api.Rules;\n+import org.json.JSONObject;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.powermock.api.mockito.PowerMockito;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.File;\n+import java.io.InputStream;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({Environment.class})\n+public class DiskFileSourceTest {\n+\n+    @Rule\n+    public TemporaryFolder storageDirectory = new TemporaryFolder();\n+\n+    @Mock\n+    private Context context;\n+\n+    private DiskFileSource diskFileSource = Mockito.spy(DiskFileSource.INSTANCE);\n+\n+    @Mock\n+    private File externalFile;\n+\n+    @Before\n+    public void setUp() {\n+        Mockito.doReturn(\"/tmp/downloads\").when(externalFile).toString();\n+\n+        PowerMockito.mockStatic(Environment.class);\n+        Mockito.when(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOWNLOADS)).thenReturn(externalFile);\n+    }\n+\n+    @Test\n+    public void testGetRulesFromFileConvertsFileToRules() throws Exception {\n+\n+        String specifiedString = \"1\";\n+        String relevance = \"---\\n\" +\n+                \"name: step1_last_name\\n\" +\n+                \"description: last_name\\n\" +\n+                \"priority: 1\\n\" +\n+                \"condition: \\\"step1_first_Name.equalsIgnoreCase('Doe')\\\"\\n\" +\n+                \"actions:\\n\" +\n+                \"    - \\\"calculation = \" + specifiedString + \"\\\"\";\n+\n+        InputStream inputStream = new ByteArrayInputStream(relevance.getBytes());\n+        Mockito.doReturn(inputStream).when(diskFileSource).getInputStream(Mockito.any(File.class));\n+\n+        Rules rules = diskFileSource.getRulesFromFile(context, \"test_rule\");\n+        Assert.assertFalse(rules.isEmpty());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32a12cdfb2e6875ffb1f7163cf995f388a4d6584"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMDc3Mzk3", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#pullrequestreview-460077397", "createdAt": "2020-08-03T14:32:37Z", "commit": {"oid": "32a12cdfb2e6875ffb1f7163cf995f388a4d6584"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDozMjozN1rOG677bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDozMjozN1rOG677bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ1MjQ2Mw==", "bodyText": "Wouldn't it be better to verify that the content is as expected and not just that it's not empty?", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#discussion_r464452463", "createdAt": "2020-08-03T14:32:37Z", "author": {"login": "vincent-karuri"}, "path": "android-json-form-wizard/src/test/java/com/vijay/jsonwizard/filesource/AssetsFileSourceTest.java", "diffHunk": "@@ -0,0 +1,88 @@\n+package com.vijay.jsonwizard.filesource;\n+\n+import android.content.Context;\n+import android.content.res.AssetManager;\n+\n+import org.jeasy.rules.api.Rules;\n+import org.json.JSONException;\n+import org.json.JSONObject;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.MockitoAnnotations;\n+import org.mockito.junit.MockitoJUnitRunner;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+\n+@RunWith(MockitoJUnitRunner.class)\n+public class AssetsFileSourceTest {\n+    @Mock\n+    private Context context;\n+\n+    @Mock\n+    private AssetManager assetManager;\n+\n+    private AssetsFileSource assetsFileSource = AssetsFileSource.INSTANCE;\n+\n+    @Before\n+    public void setUp() {\n+        MockitoAnnotations.initMocks(this);\n+    }\n+\n+    @Test\n+    public void testInstanceIsNoNull() {\n+        Assert.assertNotNull(AssetsFileSource.INSTANCE);\n+    }\n+\n+    @Test\n+    public void testGetRulesFromFileConvertsFileToRules() throws Exception {\n+        String specifiedString = \"1\";\n+        String relevance = \"---\\n\" +\n+                \"name: step1_last_name\\n\" +\n+                \"description: last_name\\n\" +\n+                \"priority: 1\\n\" +\n+                \"condition: \\\"step1_first_Name.equalsIgnoreCase('Doe')\\\"\\n\" +\n+                \"actions:\\n\" +\n+                \"    - \\\"calculation = \" + specifiedString + \"\\\"\";\n+\n+\n+        Mockito.when(context.getAssets()).thenReturn(assetManager);\n+        InputStream inputStream = new ByteArrayInputStream(relevance.getBytes());\n+        Mockito.when(assetManager.open(\"rule/test\")).thenReturn(inputStream);\n+\n+        Rules rules = assetsFileSource.getRulesFromFile(context, \"rule/test\");\n+        Assert.assertFalse(rules.isEmpty());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32a12cdfb2e6875ffb1f7163cf995f388a4d6584"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMDc4OTk0", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#pullrequestreview-460078994", "createdAt": "2020-08-03T14:34:26Z", "commit": {"oid": "32a12cdfb2e6875ffb1f7163cf995f388a4d6584"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDozNDoyNlrOG68ARw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDozNDoyNlrOG68ARw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ1MzcwMw==", "bodyText": "Do you need to spy the SUT? Is there an alternative?", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#discussion_r464453703", "createdAt": "2020-08-03T14:34:26Z", "author": {"login": "vincent-karuri"}, "path": "android-json-form-wizard/src/test/java/com/vijay/jsonwizard/filesource/DiskFileSourceTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.vijay.jsonwizard.filesource;\n+\n+import android.content.Context;\n+import android.os.Environment;\n+\n+import org.jeasy.rules.api.Rules;\n+import org.json.JSONObject;\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.powermock.api.mockito.PowerMockito;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.powermock.modules.junit4.PowerMockRunner;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.File;\n+import java.io.InputStream;\n+\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({Environment.class})\n+public class DiskFileSourceTest {\n+\n+    @Rule\n+    public TemporaryFolder storageDirectory = new TemporaryFolder();\n+\n+    @Mock\n+    private Context context;\n+\n+    private DiskFileSource diskFileSource = Mockito.spy(DiskFileSource.INSTANCE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32a12cdfb2e6875ffb1f7163cf995f388a4d6584"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "254ea1d8a8cf36ec6c9f74f7b241aa13056519bc", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/254ea1d8a8cf36ec6c9f74f7b241aa13056519bc", "committedDate": "2020-08-03T15:34:36Z", "message": "Add returned rules values"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1beb9891356c16c9426968b5638dfb2e4dfb4167", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/1beb9891356c16c9426968b5638dfb2e4dfb4167", "committedDate": "2020-08-03T15:46:24Z", "message": "Check returned rules for DiskFileSource and AssetFileSource"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMTM4NjA3", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/403#pullrequestreview-460138607", "createdAt": "2020-08-03T15:47:51Z", "commit": {"oid": "1beb9891356c16c9426968b5638dfb2e4dfb4167"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7134ee0cfae005cf1f74b19f43d18fad6d262457", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/7134ee0cfae005cf1f74b19f43d18fad6d262457", "committedDate": "2020-08-12T08:56:03Z", "message": "Merge branch 'master' into native_form_tester"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddf95b12462627202edd501d9761ce468adc83fd", "author": {"user": {"login": "rkodev", "name": "Ronald K"}}, "url": "https://github.com/opensrp/opensrp-client-native-form/commit/ddf95b12462627202edd501d9761ce468adc83fd", "committedDate": "2020-08-12T11:15:33Z", "message": "Merge branch 'master' into native_form_tester"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2377, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}