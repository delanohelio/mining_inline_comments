{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4OTE1MjQx", "number": 163, "reviewThreads": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MDozMlrOETi8Mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjo0MDozNVrOETwlPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTMwODY3OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/replay/ReplayClockContext.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MDozMlrOG5Vnbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjoxNjoyN1rOG5qOMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NjE3NQ==", "bodyText": "the current method takes in delaySeconds as a long. If we wanted to, we can have it take a Java Duration instead, although perhaps not in this PR", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462776175", "createdAt": "2020-07-30T06:50:32Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/replay/ReplayClockContext.java", "diffHunk": "@@ -140,7 +141,7 @@ boolean isReplaying() {\n     final OpenRequestInfo<?, Long> context = new OpenRequestInfo<>(firingTime);\n     final StartTimerCommandAttributes timer =\n         StartTimerCommandAttributes.newBuilder()\n-            .setStartToFireTimeoutSeconds(delaySeconds)\n+            .setStartToFireTimeout(Durations.fromSeconds(delaySeconds))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExMzc3OQ==", "bodyText": "Let's make it Duration. As the API that calls it uses Duration and milliseconds.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463113779", "createdAt": "2020-07-30T16:16:27Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/replay/ReplayClockContext.java", "diffHunk": "@@ -140,7 +141,7 @@ boolean isReplaying() {\n     final OpenRequestInfo<?, Long> context = new OpenRequestInfo<>(firingTime);\n     final StartTimerCommandAttributes timer =\n         StartTimerCommandAttributes.newBuilder()\n-            .setStartToFireTimeoutSeconds(delaySeconds)\n+            .setStartToFireTimeout(Durations.fromSeconds(delaySeconds))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NjE3NQ=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTMxMTg0OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MToxNVrOG5VpWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjo1NjoyMVrOG5ru4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NjY2NA==", "bodyText": "Should we change ReplayWorkflowContextImp to take in a java.time.Duration instead of the start time in Nanoseconds in a subsequent PR?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462776664", "createdAt": "2020-07-30T06:51:15Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "diffHunk": "@@ -115,14 +118,14 @@\n           \"First event in the history is not WorkflowExecutionStarted\");\n     }\n     startedEvent = firstEvent.getWorkflowExecutionStartedEventAttributes();\n-    wfStartTimeNanos = firstEvent.getTimestamp();\n+    wfStartTimeNanos = Timestamps.toNanos(firstEvent.getEventTime());\n \n     context =\n         new ReplayWorkflowContextImpl(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExNjA5Nw==", "bodyText": "I don't think Duration is the right class for timestamps which represent point in time.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463116097", "createdAt": "2020-07-30T16:20:04Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "diffHunk": "@@ -115,14 +118,14 @@\n           \"First event in the history is not WorkflowExecutionStarted\");\n     }\n     startedEvent = firstEvent.getWorkflowExecutionStartedEventAttributes();\n-    wfStartTimeNanos = firstEvent.getTimestamp();\n+    wfStartTimeNanos = Timestamps.toNanos(firstEvent.getEventTime());\n \n     context =\n         new ReplayWorkflowContextImpl(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NjY2NA=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEzODUyOQ==", "bodyText": "sorry I meant Timestamp. I definitely interchanged those quite a bit while doing this diff.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463138529", "createdAt": "2020-07-30T16:56:21Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "diffHunk": "@@ -115,14 +118,14 @@\n           \"First event in the history is not WorkflowExecutionStarted\");\n     }\n     startedEvent = firstEvent.getWorkflowExecutionStartedEventAttributes();\n-    wfStartTimeNanos = firstEvent.getTimestamp();\n+    wfStartTimeNanos = Timestamps.toNanos(firstEvent.getEventTime());\n \n     context =\n         new ReplayWorkflowContextImpl(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NjY2NA=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTMxMzkxOnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MTo0MFrOG5VqmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjoyMDoyOFrOG5qYSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3Njk4NQ==", "bodyText": "should we have processEventLoop take in a java.time.Duration instead?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462776985", "createdAt": "2020-07-30T06:51:40Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "diffHunk": "@@ -460,7 +464,7 @@ private boolean handleWorkflowTaskImpl(\n         forceCreateNewWorkflowTask =\n             processEventLoop(\n                 startTime,\n-                startedEvent.getWorkflowTaskTimeoutSeconds(),\n+                (int) Durations.toSeconds(startedEvent.getWorkflowTaskTimeout()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExNjM2Mg==", "bodyText": "Yes", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463116362", "createdAt": "2020-07-30T16:20:28Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "diffHunk": "@@ -460,7 +464,7 @@ private boolean handleWorkflowTaskImpl(\n         forceCreateNewWorkflowTask =\n             processEventLoop(\n                 startTime,\n-                startedEvent.getWorkflowTaskTimeoutSeconds(),\n+                (int) Durations.toSeconds(startedEvent.getWorkflowTaskTimeout()),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3Njk4NQ=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTMxNTEzOnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MTo1M1rOG5VrVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjoyMDozN1rOG5qYvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NzE3NA==", "bodyText": "return a Duration instead?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462777174", "createdAt": "2020-07-30T06:51:53Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "diffHunk": "@@ -606,7 +610,7 @@ private boolean executeLocalActivities(long startTime, int workflowTaskTimeoutSe\n   }\n \n   int getWorkflowTaskTimeoutSeconds() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExNjQ3Ng==", "bodyText": "yes", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463116476", "createdAt": "2020-07-30T16:20:37Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "diffHunk": "@@ -606,7 +610,7 @@ private boolean executeLocalActivities(long startTime, int workflowTaskTimeoutSe\n   }\n \n   int getWorkflowTaskTimeoutSeconds() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NzE3NA=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTMxNzI3OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/replay/WorkflowContext.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MjoxOVrOG5VssQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjoyMTo0MlrOG5qbsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NzUyMQ==", "bodyText": "Should we change all the methods here to return Durations instead?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462777521", "createdAt": "2020-07-30T06:52:19Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/replay/WorkflowContext.java", "diffHunk": "@@ -102,25 +103,25 @@ WorkflowExecution getParentWorkflowExecution() {\n \n   int getWorkflowRunTimeoutSeconds() {\n     WorkflowExecutionStartedEventAttributes attributes = getWorkflowStartedEventAttributes();\n-    return attributes.getWorkflowRunTimeoutSeconds();\n+    return (int) Durations.toSeconds(attributes.getWorkflowRunTimeout());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExNzIzMw==", "bodyText": "yes, with exception of get..Timestamp ones.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463117233", "createdAt": "2020-07-30T16:21:42Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/replay/WorkflowContext.java", "diffHunk": "@@ -102,25 +103,25 @@ WorkflowExecution getParentWorkflowExecution() {\n \n   int getWorkflowRunTimeoutSeconds() {\n     WorkflowExecutionStartedEventAttributes attributes = getWorkflowStartedEventAttributes();\n-    return attributes.getWorkflowRunTimeoutSeconds();\n+    return (int) Durations.toSeconds(attributes.getWorkflowRunTimeout());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NzUyMQ=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTMxOTY0OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/sync/ActivityInfoImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1Mjo0OFrOG5VuIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjoyMjoyM1rOG5qdMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3Nzg5MQ==", "bodyText": "change to return java.time.Duration?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462777891", "createdAt": "2020-07-30T06:52:48Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/sync/ActivityInfoImpl.java", "diffHunk": "@@ -65,23 +66,22 @@ public String getActivityType() {\n \n   @Override\n   public long getScheduledTimestamp() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExNzYxNg==", "bodyText": "No, as it is timestamp", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463117616", "createdAt": "2020-07-30T16:22:23Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/sync/ActivityInfoImpl.java", "diffHunk": "@@ -65,23 +66,22 @@ public String getActivityType() {\n \n   @Override\n   public long getScheduledTimestamp() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3Nzg5MQ=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTMyMjM0OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MzoyM1rOG5VvuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjoyMzo1OFrOG5qg0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3ODI5Nw==", "bodyText": "should we change this to Duration?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462778297", "createdAt": "2020-07-30T06:53:23Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -168,15 +171,15 @@\n \n   static final class WorkflowData {\n     Optional<TestServiceRetryState> retryState;\n-    int backoffStartIntervalInSeconds;\n+    long backoffStartIntervalInSeconds;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExODU0NQ==", "bodyText": "To Duration or milliseconds", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463118545", "createdAt": "2020-07-30T16:23:58Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -168,15 +171,15 @@\n \n   static final class WorkflowData {\n     Optional<TestServiceRetryState> retryState;\n-    int backoffStartIntervalInSeconds;\n+    long backoffStartIntervalInSeconds;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3ODI5Nw=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTMyNzk1OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1NDozOVrOG5VzLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjoyNTo1M1rOG5ql-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3OTE4Mg==", "bodyText": "change to use java.time.Duration and java timestamp equivalent?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462779182", "createdAt": "2020-07-30T06:54:39Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -984,7 +987,7 @@ private static void scheduleActivityTask(\n       ScheduleActivityTaskCommandAttributes d,\n       long workflowTaskCompletedEventId) {\n     RetryPolicy retryPolicy = ensureDefaultFieldsForActivityRetryPolicy(d.getRetryPolicy());\n-    long expirationInterval = TimeUnit.SECONDS.toMillis(d.getScheduleToCloseTimeoutSeconds());\n+    long expirationInterval = Durations.toMillis(d.getScheduleToCloseTimeout());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExOTg2NQ==", "bodyText": "Duration", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463119865", "createdAt": "2020-07-30T16:25:53Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -984,7 +987,7 @@ private static void scheduleActivityTask(\n       ScheduleActivityTaskCommandAttributes d,\n       long workflowTaskCompletedEventId) {\n     RetryPolicy retryPolicy = ensureDefaultFieldsForActivityRetryPolicy(d.getRetryPolicy());\n-    long expirationInterval = TimeUnit.SECONDS.toMillis(d.getScheduleToCloseTimeoutSeconds());\n+    long expirationInterval = Durations.toMillis(d.getScheduleToCloseTimeout());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3OTE4Mg=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 134}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTMzMzk4OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/TestServiceRetryState.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1NTo0NVrOG5V20Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjozMTozNlrOG5qz-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MDExMw==", "bodyText": "change these intervals/expirations to java.time.Durations?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462780113", "createdAt": "2020-07-30T06:55:45Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestServiceRetryState.java", "diffHunk": "@@ -104,10 +105,10 @@ BackoffInterval getBackoffIntervalInSeconds(Optional<String> errorType, long cur\n       // MaximumAttempts is the total attempts, including initial (non-retry) attempt.\n       return new BackoffInterval(RetryState.RETRY_STATE_MAXIMUM_ATTEMPTS_REACHED);\n     }\n-    long initInterval = TimeUnit.SECONDS.toMillis(retryPolicy.getInitialIntervalInSeconds());\n+    long initInterval = Durations.toMillis(retryPolicy.getInitialInterval());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyMzQ0OQ==", "bodyText": "Only if it improves readability of this code.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463123449", "createdAt": "2020-07-30T16:31:36Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/TestServiceRetryState.java", "diffHunk": "@@ -104,10 +105,10 @@ BackoffInterval getBackoffIntervalInSeconds(Optional<String> errorType, long cur\n       // MaximumAttempts is the total attempts, including initial (non-retry) attempt.\n       return new BackoffInterval(RetryState.RETRY_STATE_MAXIMUM_ATTEMPTS_REACHED);\n     }\n-    long initInterval = TimeUnit.SECONDS.toMillis(retryPolicy.getInitialIntervalInSeconds());\n+    long initInterval = Durations.toMillis(retryPolicy.getInitialInterval());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MDExMw=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTMzNjA3OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1NjoxM1rOG5V4LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjozMzowNFrOG5q3RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MDQ2MQ==", "bodyText": "change from long to Duration? Same for the rest of the items in this file", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462780461", "createdAt": "2020-07-30T06:56:13Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -163,7 +164,7 @@\n       StartWorkflowExecutionRequest startRequest,\n       String runId,\n       Optional<TestServiceRetryState> retryState,\n-      int backoffStartIntervalInSeconds,\n+      long backoffStartIntervalInSeconds,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyNDI5Mw==", "bodyText": "Either change to the duration or make sure that all the intervals are in milliseconds.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463124293", "createdAt": "2020-07-30T16:33:04Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -163,7 +164,7 @@\n       StartWorkflowExecutionRequest startRequest,\n       String runId,\n       Optional<TestServiceRetryState> retryState,\n-      int backoffStartIntervalInSeconds,\n+      long backoffStartIntervalInSeconds,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MDQ2MQ=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTM0MjY0OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1NzozMVrOG5V8Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjozNjozOVrOG5q_jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MTQ3MA==", "bodyText": "can this argument come in as a java duration?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462781470", "createdAt": "2020-07-30T06:57:31Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -1258,10 +1269,10 @@ private void startNewCronRun(\n         ContinueAsNewWorkflowExecutionCommandAttributes.newBuilder()\n             .setInput(startRequest.getInput())\n             .setWorkflowType(startRequest.getWorkflowType())\n-            .setWorkflowRunTimeoutSeconds(startRequest.getWorkflowRunTimeoutSeconds())\n-            .setWorkflowTaskTimeoutSeconds(startRequest.getWorkflowTaskTimeoutSeconds())\n+            .setWorkflowRunTimeout(startRequest.getWorkflowRunTimeout())\n+            .setWorkflowTaskTimeout(startRequest.getWorkflowTaskTimeout())\n             .setTaskQueue(startRequest.getTaskQueue())\n-            .setBackoffStartIntervalInSeconds(backoffIntervalSeconds)\n+            .setBackoffStartInterval(Durations.fromSeconds(backoffIntervalSeconds))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 298}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyNjQxNQ==", "bodyText": "Yes, we should remove \"Seconds\" from everwhere.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463126415", "createdAt": "2020-07-30T16:36:39Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -1258,10 +1269,10 @@ private void startNewCronRun(\n         ContinueAsNewWorkflowExecutionCommandAttributes.newBuilder()\n             .setInput(startRequest.getInput())\n             .setWorkflowType(startRequest.getWorkflowType())\n-            .setWorkflowRunTimeoutSeconds(startRequest.getWorkflowRunTimeoutSeconds())\n-            .setWorkflowTaskTimeoutSeconds(startRequest.getWorkflowTaskTimeoutSeconds())\n+            .setWorkflowRunTimeout(startRequest.getWorkflowRunTimeout())\n+            .setWorkflowTaskTimeout(startRequest.getWorkflowTaskTimeout())\n             .setTaskQueue(startRequest.getTaskQueue())\n-            .setBackoffStartIntervalInSeconds(backoffIntervalSeconds)\n+            .setBackoffStartInterval(Durations.fromSeconds(backoffIntervalSeconds))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MTQ3MA=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 298}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTM0NDA2OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1Nzo0OVrOG5V88g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjozNzowMFrOG5rAXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MTY4Mg==", "bodyText": "java duration here and for the other variables in this file?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462781682", "createdAt": "2020-07-30T06:57:49Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -1390,7 +1401,7 @@ public void startWorkflow(\n               scheduleWorkflowTask(ctx);\n             }\n \n-            int runTimeoutSeconds = startRequest.getWorkflowRunTimeoutSeconds();\n+            long runTimeoutSeconds = Durations.toSeconds(startRequest.getWorkflowRunTimeout());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 316}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyNjYyMA==", "bodyText": "If it improves readability", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463126620", "createdAt": "2020-07-30T16:37:00Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -1390,7 +1401,7 @@ public void startWorkflow(\n               scheduleWorkflowTask(ctx);\n             }\n \n-            int runTimeoutSeconds = startRequest.getWorkflowRunTimeoutSeconds();\n+            long runTimeoutSeconds = Durations.toSeconds(startRequest.getWorkflowRunTimeout());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MTY4Mg=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 316}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTM0NTI2OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1ODowNFrOG5V9oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1ODowNFrOG5V9oQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MTg1Nw==", "bodyText": "convert to java duration?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462781857", "createdAt": "2020-07-30T06:58:04Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowService.java", "diffHunk": "@@ -257,7 +258,7 @@ StartWorkflowExecutionResponse startWorkflowExecutionImpl(\n       }\n       Optional<TestServiceRetryState> retryState;\n       if (startRequest.hasRetryPolicy()) {\n-        long expirationInterval = startRequest.getWorkflowExecutionTimeoutSeconds();\n+        long expirationInterval = Durations.toSeconds(startRequest.getWorkflowExecutionTimeout());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTM0NzE0OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/worker/LocalActivityWorker.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1ODoyOVrOG5V-xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjozOToxMlrOG5rFew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MjE0OA==", "bodyText": "use actual duration here?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462782148", "createdAt": "2020-07-30T06:58:29Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/worker/LocalActivityWorker.java", "diffHunk": "@@ -260,16 +262,18 @@ public Throwable wrapFailure(Task task, Throwable failure) {\n       retryPolicy.getNonRetryableErrorTypesList().toArray(doNotRetry);\n       RetryOptions retryOptions =\n           RetryOptions.newBuilder()\n-              .setMaximumInterval(Duration.ofSeconds(retryPolicy.getMaximumIntervalInSeconds()))\n-              .setInitialInterval(Duration.ofSeconds(retryPolicy.getInitialIntervalInSeconds()))\n+              .setMaximumInterval(\n+                  ProtobufTimeUtils.ToJavaDuration(retryPolicy.getMaximumInterval()))\n+              .setInitialInterval(\n+                  ProtobufTimeUtils.ToJavaDuration(retryPolicy.getInitialInterval()))\n               .setMaximumAttempts(retryPolicy.getMaximumAttempts())\n               .setBackoffCoefficient(retryPolicy.getBackoffCoefficient())\n               .setDoNotRetry(doNotRetry)\n               .build();\n       long sleepMillis = retryOptions.calculateSleepTime(attempt);\n       long elapsedTask = System.currentTimeMillis() - task.taskStartTime;\n       long elapsedTotal = elapsedTask + params.getElapsedTime();\n-      int timeoutSeconds = activityTask.getScheduleToCloseTimeoutSeconds();\n+      int timeoutSeconds = (int) Durations.toSeconds(activityTask.getScheduleToCloseTimeout());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyNzkzMQ==", "bodyText": "Or Duration or millis", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463127931", "createdAt": "2020-07-30T16:39:12Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/worker/LocalActivityWorker.java", "diffHunk": "@@ -260,16 +262,18 @@ public Throwable wrapFailure(Task task, Throwable failure) {\n       retryPolicy.getNonRetryableErrorTypesList().toArray(doNotRetry);\n       RetryOptions retryOptions =\n           RetryOptions.newBuilder()\n-              .setMaximumInterval(Duration.ofSeconds(retryPolicy.getMaximumIntervalInSeconds()))\n-              .setInitialInterval(Duration.ofSeconds(retryPolicy.getInitialIntervalInSeconds()))\n+              .setMaximumInterval(\n+                  ProtobufTimeUtils.ToJavaDuration(retryPolicy.getMaximumInterval()))\n+              .setInitialInterval(\n+                  ProtobufTimeUtils.ToJavaDuration(retryPolicy.getInitialInterval()))\n               .setMaximumAttempts(retryPolicy.getMaximumAttempts())\n               .setBackoffCoefficient(retryPolicy.getBackoffCoefficient())\n               .setDoNotRetry(doNotRetry)\n               .build();\n       long sleepMillis = retryOptions.calculateSleepTime(attempt);\n       long elapsedTask = System.currentTimeMillis() - task.taskStartTime;\n       long elapsedTotal = elapsedTask + params.getElapsedTime();\n-      int timeoutSeconds = activityTask.getScheduleToCloseTimeoutSeconds();\n+      int timeoutSeconds = (int) Durations.toSeconds(activityTask.getScheduleToCloseTimeout());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MjE0OA=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTM0OTE0OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1ODo1NFrOG5WABA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1ODo1NFrOG5WABA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MjQ2OA==", "bodyText": "use duration here?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462782468", "createdAt": "2020-07-30T06:58:54Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowService.java", "diffHunk": "@@ -305,7 +306,7 @@ private StartWorkflowExecutionResponse startWorkflowExecutionNoRunningCheckLocke\n       String runId,\n       Optional<String> continuedExecutionRunId,\n       Optional<TestServiceRetryState> retryState,\n-      int backoffStartIntervalInSeconds,\n+      long backoffStartIntervalInSeconds,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTM1MDMyOnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1OToxMlrOG5WAzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1OToxMlrOG5WAzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MjY2OA==", "bodyText": "use duration here", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462782668", "createdAt": "2020-07-30T06:59:12Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -1485,8 +1497,8 @@ private void updateHeartbeatTimer(\n       RequestContext ctx,\n       long activityId,\n       StateMachine<ActivityTaskData> activity,\n-      int startToCloseTimeout,\n-      int heartbeatTimeout) {\n+      long startToCloseTimeout,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 338}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4OTM1MDkyOnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1OToxOFrOG5WBLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1OToxOFrOG5WBLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4Mjc2NA==", "bodyText": "use duration here", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462782764", "createdAt": "2020-07-30T06:59:18Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -1637,8 +1649,9 @@ public boolean heartbeatActivityTask(long scheduledEventId, Payloads details) {\n           }\n           ActivityTaskData data = activity.getData();\n           data.lastHeartbeatTime = clock.getAsLong();\n-          int startToCloseTimeout = data.scheduledEvent.getStartToCloseTimeoutSeconds();\n-          int heartbeatTimeout = data.scheduledEvent.getHeartbeatTimeoutSeconds();\n+          long startToCloseTimeout =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 349}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MTQ5MzI5OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjoyNzowMFrOG5qpRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjoyNzowMFrOG5qpRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyMDcxMQ==", "bodyText": "Consider adding a method to ctx that returns Proto Timestamp.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463120711", "createdAt": "2020-07-30T16:27:00Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -1020,11 +1023,11 @@ private static void scheduleActivityTask(\n             .setWorkflowExecution(ctx.getExecution())\n             .setActivityId(d.getActivityId())\n             .setInput(d.getInput())\n-            .setHeartbeatTimeoutSeconds(d.getHeartbeatTimeoutSeconds())\n-            .setScheduleToCloseTimeoutSeconds(d.getScheduleToCloseTimeoutSeconds())\n-            .setStartToCloseTimeoutSeconds(d.getStartToCloseTimeoutSeconds())\n-            .setScheduledTimestamp(ctx.currentTimeInNanoseconds())\n-            .setScheduledTimestampThisAttempt(ctx.currentTimeInNanoseconds())\n+            .setHeartbeatTimeout(d.getHeartbeatTimeout())\n+            .setScheduleToCloseTimeout(d.getScheduleToCloseTimeout())\n+            .setStartToCloseTimeout(d.getStartToCloseTimeout())\n+            .setScheduledTime(Timestamps.fromNanos(ctx.currentTimeInNanoseconds()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 166}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MTQ5NjIxOnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjoyNzo0NlrOG5qrEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjoyNzo0NlrOG5qrEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyMTE2OA==", "bodyText": "Consider adding a method to the store that returns Proto Timestamp.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463121168", "createdAt": "2020-07-30T16:27:46Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -1272,11 +1274,11 @@ private static void startActivityTask(\n     a.setAttempt(data.getAttempt());\n     // Setting timestamp here as the default logic will set it to the time when it is added to the\n     // history. But in the case of retry it happens only after an activity completion.\n-    long timestamp = TimeUnit.MILLISECONDS.toNanos(data.store.currentTimeMillis());\n+    Timestamp timestamp = Timestamps.fromMillis(data.store.currentTimeMillis());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 204}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MTUwMDk1OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjoyOTowNlrOG5quDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjoyOTowNlrOG5quDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyMTkzMw==", "bodyText": "Consider changing the constant from seconds as well.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463121933", "createdAt": "2020-07-30T16:29:06Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -1859,17 +1862,19 @@ private static void failExternalCancellation(\n \n   // Mimics the default activity retry policy of a standard Temporal server.\n   static RetryPolicy ensureDefaultFieldsForActivityRetryPolicy(RetryPolicy originalPolicy) {\n-    int initialIntervalInSeconds =\n-        originalPolicy.getInitialIntervalInSeconds() == 0\n-            ? DEFAULT_ACTIVITY_RETRY_INITIAL_INTERVAL_SECONDS\n-            : originalPolicy.getInitialIntervalInSeconds();\n+    Duration initialInterval =\n+        Durations.compare(originalPolicy.getInitialInterval(), Durations.ZERO) == 0\n+            ? Durations.fromSeconds(DEFAULT_ACTIVITY_RETRY_INITIAL_INTERVAL_SECONDS)\n+            : originalPolicy.getInitialInterval();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 252}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MTUwNjQ3OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjozMDoyOFrOG5qxbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjozMDoyOFrOG5qxbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyMjc5Nw==", "bodyText": "I'm curious if \"originalPolicy.getInitialInterval() == Durations.ZERO\" would work.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463122797", "createdAt": "2020-07-30T16:30:28Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -1859,17 +1862,19 @@ private static void failExternalCancellation(\n \n   // Mimics the default activity retry policy of a standard Temporal server.\n   static RetryPolicy ensureDefaultFieldsForActivityRetryPolicy(RetryPolicy originalPolicy) {\n-    int initialIntervalInSeconds =\n-        originalPolicy.getInitialIntervalInSeconds() == 0\n-            ? DEFAULT_ACTIVITY_RETRY_INITIAL_INTERVAL_SECONDS\n-            : originalPolicy.getInitialIntervalInSeconds();\n+    Duration initialInterval =\n+        Durations.compare(originalPolicy.getInitialInterval(), Durations.ZERO) == 0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 250}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MTUyNTk5OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjozNTo1M1rOG5q90w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjozNTo1M1rOG5q90w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyNTk3MQ==", "bodyText": "Let's migrate timer from seconds", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463125971", "createdAt": "2020-07-30T16:35:53Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -1059,7 +1068,8 @@ private void processStartTimer(\n     timer = StateMachines.newTimerStateMachine();\n     timers.put(timerId, timer);\n     timer.action(StateMachines.Action.START, ctx, a, workflowTaskCompletedId);\n-    ctx.addTimer(a.getStartToFireTimeoutSeconds(), () -> fireTimer(timerId), \"fire timer\");\n+    ctx.addTimer(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 269}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MTU0MzY0OnYy", "diffSide": "RIGHT", "path": "src/test/java/io/temporal/testUtils/TestServiceUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjo0MDozNVrOG5rIxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjo0MDozNVrOG5rIxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyODc3NA==", "bodyText": "the arguments should be converted to Duration", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463128774", "createdAt": "2020-07-30T16:40:35Z", "author": {"login": "mfateev"}, "path": "src/test/java/io/temporal/testUtils/TestServiceUtils.java", "diffHunk": "@@ -59,8 +60,8 @@ public static void startWorkflowExecution(\n     request.setNamespace(namespace);\n     request.setWorkflowId(UUID.randomUUID().toString());\n     request.setTaskQueue(createNormalTaskQueue(taskqueueName));\n-    request.setWorkflowRunTimeoutSeconds(workflowRunTimeoutSeconds);\n-    request.setWorkflowTaskTimeoutSeconds(workflowTaskTimeoutSeconds);\n+    request.setWorkflowRunTimeout(Durations.fromSeconds(workflowRunTimeoutSeconds));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1712, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}