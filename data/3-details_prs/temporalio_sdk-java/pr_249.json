{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4MzA0MTE1", "number": 249, "title": "Fix NPE in sticky poller", "bodyText": "Previously we've used to always initialize a sticky task queue dispatcher and start a sticky poller.\nThis caused problems like:\njava.lang.NullPointerException: null\n    \tat io.temporal.internal.worker.WorkflowWorker.apply(WorkflowWorker.java:272) ~[service-1.0.jar:?]\n    \tat io.temporal.internal.sync.SyncWorkflowWorker.apply(SyncWorkflowWorker.java:215) ~[service-1.0.jar:?]\n    \tat io.temporal.internal.sync.SyncWorkflowWorker.apply(SyncWorkflowWorker.java:51) ~[service-1.0.jar:?]\n    \tat io.temporal.internal.worker.PollWorkflowTaskDispatcher.process(PollWorkflowTaskDispatcher.java:75) ~[service-1.0.jar:?]\n    \tat io.temporal.internal.worker.PollWorkflowTaskDispatcher.process(PollWorkflowTaskDispatcher.java:40) ~[service-1.0.jar:?]\n    \tat io.temporal.internal.worker.Poller$PollExecutionTask.run(Poller.java:277) ~[service-1.0.jar:?]\n    \tat io.temporal.internal.worker.Poller$PollLoopTask.run(Poller.java:242) [service-1.0.jar:?]\n    \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\n    \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\n    \tat java.lang.Thread.run(Thread.java:834) [?:?]\n\nIn case if user would register a worker that doesn't have any activities alongside worker that doesn't have any workflows registered and would run them on the same task queue. This happened because if both workers are created using same factory object in the same java process they would be polling on the same sticky task queue and one of them wouldn't have workflow implementations registered. Furthermore since the same sticky task queue is used, latest registered worker would be the one registered with the dispatcher.\nThis fix addresses the problem by only subscribing workers to the sticky task queue dispatcher if they have workflows registered.\nFor more context read here:\nhttps://community.temporal.io/t/timeouts-on-local-host-specific-task-queue/844/14", "createdAt": "2020-11-10T08:09:29Z", "url": "https://github.com/temporalio/sdk-java/pull/249", "merged": true, "mergeCommit": {"oid": "aa04a4b8f679b244902ddac79d6c393f81da9e27"}, "closed": true, "closedAt": "2020-11-11T00:24:01Z", "author": {"login": "vitarb"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbEtgdgH2gAyNTE4MzA0MTE1OmI4Zjk2NzhiNTNjNjMwMGQ4MDNlNGJjMmU0OTU5NmEzYTNkZTA4ZmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbQneFgH2gAyNTE4MzA0MTE1OjE3NzZmYzE4YzkwMGViYjNjMzVmYWEyNDAzNDAwYzk0ZjBmOTkyNDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b8f9678b53c6300d803e4bc2e49596a3a3de08ff", "author": {"user": {"login": "vitarb", "name": "Vitaly"}}, "url": "https://github.com/temporalio/sdk-java/commit/b8f9678b53c6300d803e4bc2e49596a3a3de08ff", "committedDate": "2020-11-10T08:02:31Z", "message": "Fix NPE in worker initialization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NDM5ODAw", "url": "https://github.com/temporalio/sdk-java/pull/249#pullrequestreview-527439800", "createdAt": "2020-11-10T17:28:41Z", "commit": {"oid": "b8f9678b53c6300d803e4bc2e49596a3a3de08ff"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNzoyODo0MlrOHwnhgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNzoyOToxMlrOHwni5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc0MTI0OA==", "bodyText": "Any reason for using a different name?", "url": "https://github.com/temporalio/sdk-java/pull/249#discussion_r520741248", "createdAt": "2020-11-10T17:28:42Z", "author": {"login": "mfateev"}, "path": "temporal-sdk/src/main/java/io/temporal/internal/worker/LocalActivityWorker.java", "diffHunk": "@@ -93,6 +93,10 @@ public void start() {\n     }\n   }\n \n+  public boolean hasSupportedTypes() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8f9678b53c6300d803e4bc2e49596a3a3de08ff"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc0MTYwNA==", "bodyText": "If you feel strongly about the new name then rename the one on the handler to be consistent.", "url": "https://github.com/temporalio/sdk-java/pull/249#discussion_r520741604", "createdAt": "2020-11-10T17:29:12Z", "author": {"login": "mfateev"}, "path": "temporal-sdk/src/main/java/io/temporal/internal/worker/LocalActivityWorker.java", "diffHunk": "@@ -93,6 +93,10 @@ public void start() {\n     }\n   }\n \n+  public boolean hasSupportedTypes() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc0MTI0OA=="}, "originalCommit": {"oid": "b8f9678b53c6300d803e4bc2e49596a3a3de08ff"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1776fc18c900ebb3c35faa2403400c94f0f99244", "author": {"user": {"login": "vitarb", "name": "Vitaly"}}, "url": "https://github.com/temporalio/sdk-java/commit/1776fc18c900ebb3c35faa2403400c94f0f99244", "committedDate": "2020-11-10T21:54:47Z", "message": "rename method"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3480, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}