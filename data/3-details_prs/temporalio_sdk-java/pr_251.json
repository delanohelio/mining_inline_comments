{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwODE1OTUz", "number": 251, "title": "Stop using illegal reflective access for setting cause during exception", "bodyText": "This change removes illegal reflective access to the cause field in the CheckedExceptionWrapper replacing it with shallow unwrapping of the exception plus full unwrapping during serialization.\nThe reason we need to keep shallow unwrapping instead of getting rid of it entirely is because there are a few places in the pre-serialization code that either log or conduct actions based on the client exception. Look at POJOWorkflowImplementationFactory and POJOActivityTaskHandler as examples.\nOne tradeoff that we have to make here is whether or not we want to eliminate a possibility of client seeing CheckedExceptionWrapper as current approach doesn't guarantee that and if there are multiple layers of wrappers inner layers might be visible in the log, logged by POJOActivityTaskHandler. Preferred way to solve it could be by transforming that exception to Failure before logging, alternatively we could reimplement unwrap by serializing to failure and back, which would eliminate all exception wrappers in the process.", "createdAt": "2020-11-13T19:52:15Z", "url": "https://github.com/temporalio/sdk-java/pull/251", "merged": true, "mergeCommit": {"oid": "4bb23c3a660de6a2630901d0dc6c049d9742ebe1"}, "closed": true, "closedAt": "2020-11-17T02:10:59Z", "author": {"login": "vitarb"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcMiyDAH2gAyNTIwODE1OTUzOmI2MjAyMDg0MTlmOGY3ZGZhZDAwNDhmMmJmMDEzMjYxOGZhYWUyYjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddL9h0AFqTUzMTc5OTgxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b620208419f8f7dfad0048f2bf0132618faae2b2", "author": {"user": {"login": "vitarb", "name": "Vitaly"}}, "url": "https://github.com/temporalio/sdk-java/commit/b620208419f8f7dfad0048f2bf0132618faae2b2", "committedDate": "2020-11-13T19:43:58Z", "message": "Stop using illegal reflective access for setting cause during exception\nunwrapping"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNzkzNTcx", "url": "https://github.com/temporalio/sdk-java/pull/251#pullrequestreview-531793571", "createdAt": "2020-11-16T21:27:44Z", "commit": {"oid": "b620208419f8f7dfad0048f2bf0132618faae2b2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMToyNzo0NFrOH0TQ0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQyMTozMDo0NFrOH0TeyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDYwMzYwMw==", "bodyText": "I would move it to the top of the method to avoid unnecessary e.getMessage call.", "url": "https://github.com/temporalio/sdk-java/pull/251#discussion_r524603603", "createdAt": "2020-11-16T21:27:44Z", "author": {"login": "mfateev"}, "path": "temporal-sdk/src/main/java/io/temporal/failure/FailureConverter.java", "diffHunk": "@@ -195,11 +190,14 @@ public static Failure exceptionToFailureNoUnwrapping(Throwable e) {\n     } else {\n       message = e.getMessage() == null ? \"\" : e.getMessage();\n     }\n+    if (e instanceof CheckedExceptionWrapper) {\n+      return exceptionToFailure(e.getCause());\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b620208419f8f7dfad0048f2bf0132618faae2b2"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDYwNzE3Nw==", "bodyText": "Remove causeField and the related initialization code above.\nRemove setThrowableCause method below.", "url": "https://github.com/temporalio/sdk-java/pull/251#discussion_r524607177", "createdAt": "2020-11-16T21:30:44Z", "author": {"login": "mfateev"}, "path": "temporal-sdk/src/main/java/io/temporal/internal/common/CheckedExceptionWrapper.java", "diffHunk": "@@ -69,25 +69,11 @@ public static RuntimeException wrap(Throwable e) {\n   }\n \n   /**\n-   * Removes CheckedException wrapper from the whole chain of Exceptions. Assumes that wrapper\n+   * Removes CheckedExceptionWrapper from the top of the chain of Exceptions. Assumes that wrapper", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b620208419f8f7dfad0048f2bf0132618faae2b2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "798f45312ca3d885993575bb2ef7355eb26bdfdf", "author": {"user": {"login": "vitarb", "name": "Vitaly"}}, "url": "https://github.com/temporalio/sdk-java/commit/798f45312ca3d885993575bb2ef7355eb26bdfdf", "committedDate": "2020-11-16T21:34:20Z", "message": "Address CR feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNzk5ODEz", "url": "https://github.com/temporalio/sdk-java/pull/251#pullrequestreview-531799813", "createdAt": "2020-11-16T21:37:12Z", "commit": {"oid": "798f45312ca3d885993575bb2ef7355eb26bdfdf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3481, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}