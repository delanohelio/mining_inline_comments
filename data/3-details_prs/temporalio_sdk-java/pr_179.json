{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4MjMwMjgx", "number": 179, "title": "Wired upsertSearchAttributes to the WorkflowStateMachines", "bodyText": "Also changed state machines to not retain passed arguments after a command is created. It will reduce memory consumption.", "createdAt": "2020-08-15T00:12:59Z", "url": "https://github.com/temporalio/sdk-java/pull/179", "merged": true, "mergeCommit": {"oid": "b640aaeb5fcf82d785c3bf3a144756764579e7f3"}, "closed": true, "closedAt": "2020-08-15T01:23:57Z", "author": {"login": "mfateev"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-9S8KgH2gAyNDY4MjMwMjgxOmMzOWEyNTU5ZWJhMTY1OGViNTcwMzdiNTFjNDU2NTNlMjQzMWVhMmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc--wYogH2gAyNDY4MjMwMjgxOjdiNWFiYmM3MzNmOGJmOWViYzlhMTMyMWM2ZjUyOWY5ZjZiOWE0Njk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c39a2559eba1658eb57037b51c45653e2431ea2f", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/c39a2559eba1658eb57037b51c45653e2431ea2f", "committedDate": "2020-08-14T23:34:17Z", "message": "Improved state machine code coverage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc7bfd9450f6363853692c82945132d5d67d8162", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/dc7bfd9450f6363853692c82945132d5d67d8162", "committedDate": "2020-08-14T23:57:13Z", "message": "Wired search attributes. Fixed input retention"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc898db588e795fc7fc1fe00aea21366e2e55837", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/bc898db588e795fc7fc1fe00aea21366e2e55837", "committedDate": "2020-08-15T00:04:47Z", "message": "Fixed testUpsertSearchAttributes unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59c7883847124e46a87e20d89b3545d15cd4f8bc", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/59c7883847124e46a87e20d89b3545d15cd4f8bc", "committedDate": "2020-08-15T00:10:23Z", "message": "retention of signal external fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "022ad879b91f5e3c5e4c81fe3d6f48419ffdbe74", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/022ad879b91f5e3c5e4c81fe3d6f48419ffdbe74", "committedDate": "2020-08-15T00:11:20Z", "message": "timer state machine diagram readded"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7461f0a134c0e78f5d38baee939b531ade1808f8", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/7461f0a134c0e78f5d38baee939b531ade1808f8", "committedDate": "2020-08-15T00:33:09Z", "message": "dead code removal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3OTM0NDQy", "url": "https://github.com/temporalio/sdk-java/pull/179#pullrequestreview-467934442", "createdAt": "2020-08-15T01:03:49Z", "commit": {"oid": "7461f0a134c0e78f5d38baee939b531ade1808f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQwMTowMzo0OVrOHBGlYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQwMTowMzo0OVrOHBGlYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxODQ5Nw==", "bodyText": "curious what inspired you to make this change (whether it just occurred to you or you saw something interesting during local debugging / execution)", "url": "https://github.com/temporalio/sdk-java/pull/179#discussion_r470918497", "createdAt": "2020-08-15T01:03:49Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/statemachines/ActivityStateMachine.java", "diffHunk": "@@ -415,5 +404,6 @@ private void createRequestCancelActivityTaskCommand() {\n                 RequestCancelActivityTaskCommandAttributes.newBuilder()\n                     .setScheduledEventId(getInitialCommandEventId()))\n             .build());\n+    parameters = null; // avoid retaining large input for the duration of the activity", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7461f0a134c0e78f5d38baee939b531ade1808f8"}, "originalPosition": 162}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3OTM1MDQ3", "url": "https://github.com/temporalio/sdk-java/pull/179#pullrequestreview-467935047", "createdAt": "2020-08-15T01:09:30Z", "commit": {"oid": "7461f0a134c0e78f5d38baee939b531ade1808f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQwMTowOTozMFrOHBGoGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQwMTowOTozMFrOHBGoGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxOTE5Mg==", "bodyText": "[Nit] Fix error message to say MutableSideEffectStateMachine", "url": "https://github.com/temporalio/sdk-java/pull/179#discussion_r470919192", "createdAt": "2020-08-15T01:09:30Z", "author": {"login": "mastermanu"}, "path": "src/test/java/io/temporal/internal/statemachines/MutableSideEffectStateMachineTest.java", "diffHunk": "@@ -34,15 +38,46 @@\n import io.temporal.api.history.v1.MarkerRecordedEventAttributes;\n import io.temporal.api.history.v1.TimerFiredEventAttributes;\n import io.temporal.common.converter.DataConverter;\n+import java.util.ArrayList;\n import java.util.List;\n import java.util.Optional;\n+import org.junit.AfterClass;\n import org.junit.Test;\n \n public class MutableSideEffectStateMachineTest {\n \n   private final DataConverter converter = DataConverter.getDefaultInstance();\n   private WorkflowStateMachines stateMachines;\n \n+  private static final List<\n+          StateMachine<\n+              MutableSideEffectStateMachine.State,\n+              MutableSideEffectStateMachine.ExplicitEvent,\n+              MutableSideEffectStateMachine.InvocationStateMachine>>\n+      stateMachineList = new ArrayList<>();\n+\n+  private WorkflowStateMachines newStateMachines(TestEntityManagerListenerBase listener) {\n+    return new WorkflowStateMachines(\n+        listener, (stateMachine -> stateMachineList.add(stateMachine)));\n+  }\n+\n+  @AfterClass\n+  public static void generateCoverage() {\n+    List<Transition> missed =\n+        MutableSideEffectStateMachine.STATE_MACHINE_DEFINITION.getUnvisitedTransitions(\n+            stateMachineList);\n+    if (!missed.isEmpty()) {\n+      CommandsGeneratePlantUMLStateDiagrams.writeToFile(\n+          \"test\",\n+          MutableSideEffectStateMachine.class,\n+          MutableSideEffectStateMachine.STATE_MACHINE_DEFINITION.asPlantUMLStateDiagramCoverage(\n+              stateMachineList));\n+      fail(\n+          \"SideEffectStateMachine is missing test coverage for the following transitions:\\n\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7461f0a134c0e78f5d38baee939b531ade1808f8"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3OTM1MTA5", "url": "https://github.com/temporalio/sdk-java/pull/179#pullrequestreview-467935109", "createdAt": "2020-08-15T01:10:08Z", "commit": {"oid": "7461f0a134c0e78f5d38baee939b531ade1808f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQwMToxMDowOVrOHBGobg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQwMToxMDowOVrOHBGobg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxOTI3OA==", "bodyText": "[Nit] fix error message to say TimerStateMachine", "url": "https://github.com/temporalio/sdk-java/pull/179#discussion_r470919278", "createdAt": "2020-08-15T01:10:09Z", "author": {"login": "mastermanu"}, "path": "src/test/java/io/temporal/internal/statemachines/TimerStateMachineTest.java", "diffHunk": "@@ -34,15 +35,42 @@\n import io.temporal.internal.common.ProtobufTimeUtils;\n import io.temporal.workflow.Functions;\n import java.time.Duration;\n+import java.util.ArrayList;\n import java.util.List;\n import java.util.Optional;\n+import org.junit.AfterClass;\n import org.junit.Test;\n \n public class TimerStateMachineTest {\n \n   private final DataConverter converter = DataConverter.getDefaultInstance();\n   private WorkflowStateMachines stateMachines;\n \n+  private static final List<\n+          StateMachine<TimerStateMachine.State, TimerStateMachine.ExplicitEvent, TimerStateMachine>>\n+      stateMachineList = new ArrayList<>();\n+\n+  private WorkflowStateMachines newStateMachines(TestEntityManagerListenerBase listener) {\n+    return new WorkflowStateMachines(\n+        listener, (stateMachine -> stateMachineList.add(stateMachine)));\n+  }\n+\n+  @AfterClass\n+  public static void generateCoverage() {\n+    List<Transition> missed =\n+        TimerStateMachine.STATE_MACHINE_DEFINITION.getUnvisitedTransitions(stateMachineList);\n+    if (!missed.isEmpty()) {\n+      CommandsGeneratePlantUMLStateDiagrams.writeToFile(\n+          \"test\",\n+          TimerStateMachine.class,\n+          TimerStateMachine.STATE_MACHINE_DEFINITION.asPlantUMLStateDiagramCoverage(\n+              stateMachineList));\n+      fail(\n+          \"SideEffectStateMachine is missing test coverage for the following transitions:\\n\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7461f0a134c0e78f5d38baee939b531ade1808f8"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3OTM1MjQx", "url": "https://github.com/temporalio/sdk-java/pull/179#pullrequestreview-467935241", "createdAt": "2020-08-15T01:11:31Z", "commit": {"oid": "7461f0a134c0e78f5d38baee939b531ade1808f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b5abbc733f8bf9ebc9a1321c6f529f9f6b9a469", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/7b5abbc733f8bf9ebc9a1321c6f529f9f6b9a469", "committedDate": "2020-08-15T01:16:21Z", "message": "PR comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3506, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}