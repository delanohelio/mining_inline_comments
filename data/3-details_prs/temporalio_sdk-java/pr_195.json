{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyMTY1MjM4", "number": 195, "title": "Retry options", "bodyText": "Fix for #174.\nThe validation and defaulting of RetryOptions are removed when scheduling activities and child workflows. The service is expected to perform validation as well as provide defaults for them.\nAdded validation and defaulting of RetryOptions for local activities as service is not involved in their execution.", "createdAt": "2020-08-23T19:12:23Z", "url": "https://github.com/temporalio/sdk-java/pull/195", "merged": true, "mergeCommit": {"oid": "3ca7bf530a306a36ea32aae02a8b3b3d9de11bbb"}, "closed": true, "closedAt": "2020-08-23T19:50:56Z", "author": {"login": "mfateev"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdBjxxWAH2gAyNDcyMTY1MjM4OmQ0YTYyZTk0N2U5NzAyODNiNmRkYjljNDJmYjQyMjc3MGYxMDg5NTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBzWOyAFqTQ3MzAzNjc5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d4a62e947e970283b6ddb9c42fb422770f108952", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/d4a62e947e970283b6ddb9c42fb422770f108952", "committedDate": "2020-08-23T01:32:12Z", "message": "Added Throwable cause test. Improved log message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c21b6c60f450fabbc62543335b3577b6a6e19c4", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/7c21b6c60f450fabbc62543335b3577b6a6e19c4", "committedDate": "2020-08-23T19:08:51Z", "message": "Fixed defaults for RetryOptions in local and non local activities"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMDM2MjAz", "url": "https://github.com/temporalio/sdk-java/pull/195#pullrequestreview-473036203", "createdAt": "2020-08-23T19:30:48Z", "commit": {"oid": "7c21b6c60f450fabbc62543335b3577b6a6e19c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QxOTozMDo0OFrOHFPU7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QxOTozMDo0OFrOHFPU7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI1NjA0NA==", "bodyText": "previously we used to return a new copy.  Now we return the same instance back.  Can this cause issues?", "url": "https://github.com/temporalio/sdk-java/pull/195#discussion_r475256044", "createdAt": "2020-08-23T19:30:48Z", "author": {"login": "samarabbas"}, "path": "src/main/java/io/temporal/common/RetryOptions.java", "diffHunk": "@@ -66,10 +66,10 @@ public static RetryOptions merge(MethodRetry r, RetryOptions o) {\n       if (o == null) {\n         return null;\n       }\n-      return RetryOptions.newBuilder(o).validateBuildWithDefaults();\n+      return o;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c21b6c60f450fabbc62543335b3577b6a6e19c4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMDM2NDE1", "url": "https://github.com/temporalio/sdk-java/pull/195#pullrequestreview-473036415", "createdAt": "2020-08-23T19:33:51Z", "commit": {"oid": "7c21b6c60f450fabbc62543335b3577b6a6e19c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QxOTozMzo1MVrOHFPWDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QxOTozMzo1MVrOHFPWDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI1NjMzNA==", "bodyText": "validateBuildWithDefaults needs to match same validation we do on server sides for activities?", "url": "https://github.com/temporalio/sdk-java/pull/195#discussion_r475256334", "createdAt": "2020-08-23T19:33:51Z", "author": {"login": "samarabbas"}, "path": "src/main/java/io/temporal/internal/sync/SyncWorkflowContext.java", "diffHunk": "@@ -343,9 +343,8 @@ private ExecuteLocalActivityParameters constructExecuteLocalActivityParameters(\n       activityTask.setInput(input.get());\n     }\n     RetryOptions retryOptions = options.getRetryOptions();\n-    if (retryOptions != null) {\n-      activityTask.setRetryPolicy(toRetryPolicy(retryOptions));\n-    }\n+    activityTask.setRetryPolicy(\n+        toRetryPolicy(RetryOptions.newBuilder(retryOptions).validateBuildWithDefaults()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c21b6c60f450fabbc62543335b3577b6a6e19c4"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMDM2NTM5", "url": "https://github.com/temporalio/sdk-java/pull/195#pullrequestreview-473036539", "createdAt": "2020-08-23T19:36:09Z", "commit": {"oid": "7c21b6c60f450fabbc62543335b3577b6a6e19c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QxOTozNjowOVrOHFPW_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QxOTozNjowOVrOHFPW_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI1NjU3NQ==", "bodyText": "I'm confused why no validation here?  I thought this is also all client-side.", "url": "https://github.com/temporalio/sdk-java/pull/195#discussion_r475256575", "createdAt": "2020-08-23T19:36:09Z", "author": {"login": "samarabbas"}, "path": "src/main/java/io/temporal/internal/sync/WorkflowRetryerInternal.java", "diffHunk": "@@ -186,7 +186,6 @@ public static void retry(\n   }\n \n   private static RetryOptions getRetryOptionsSideEffect(String retryId, RetryOptions options) {\n-    options = RetryOptions.newBuilder(options).validateBuildWithDefaults();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7c21b6c60f450fabbc62543335b3577b6a6e19c4"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMDM2Nzkx", "url": "https://github.com/temporalio/sdk-java/pull/195#pullrequestreview-473036791", "createdAt": "2020-08-23T19:40:36Z", "commit": {"oid": "7c21b6c60f450fabbc62543335b3577b6a6e19c4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3510, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}