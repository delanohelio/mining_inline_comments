{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4OTE1MjQx", "number": 163, "title": "Syncs Java SDK to latest Temporal Proto", "bodyText": "Main changes are around replacing fields that were originally seconds as integers with google protobuf Durations\nCode was changed in this order:\n\nUse Durations as much as possible\nIf conversion is required, convert to smallest granularity possible (nanoseconds, then milliseconds)\n\n\n\nUnit tests pass against both mock server (which was updated) and the latest one-box build of Temporal from master", "createdAt": "2020-07-30T06:46:07Z", "url": "https://github.com/temporalio/sdk-java/pull/163", "merged": true, "mergeCommit": {"oid": "8b460ace48ea8c8f376d7b0630920232fa9c03fd"}, "closed": true, "closedAt": "2020-07-31T00:21:39Z", "author": {"login": "mastermanu"}, "timelineItems": {"totalCount": 48, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc509noAH2gAyNDU4OTE1MjQxOjBjZDEwNThiZGZiODU4OGQzNzUxNTFkODY4MDE4MjMzYmIzZWRmY2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6I-s4gFqTQ1ODg0NTYxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0cd1058bdfb8588d375151d868018233bb3edfcd", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/0cd1058bdfb8588d375151d868018233bb3edfcd", "committedDate": "2020-07-30T01:02:08Z", "message": "moves to latest submodule"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4c8142dd5dfb4b4ff2c313879842ef13efc3b1b", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/a4c8142dd5dfb4b4ff2c313879842ef13efc3b1b", "committedDate": "2020-07-30T04:20:01Z", "message": "first pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6dac690ad678d6670b773415c5b0becfeee5e01", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/f6dac690ad678d6670b773415c5b0becfeee5e01", "committedDate": "2020-07-30T04:51:45Z", "message": "second pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "063dec9a47935d1132e2b4179650b3cb6ecd5255", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/063dec9a47935d1132e2b4179650b3cb6ecd5255", "committedDate": "2020-07-30T04:52:17Z", "message": "run gradlew build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58e12059821640eae64eb33ab02ad5f71c865f0f", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/58e12059821640eae64eb33ab02ad5f71c865f0f", "committedDate": "2020-07-30T05:05:32Z", "message": "third pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5baa4b5b651761dc090043464ad78733bc517ae7", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/5baa4b5b651761dc090043464ad78733bc517ae7", "committedDate": "2020-07-30T05:11:25Z", "message": "30 errors remaining"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15111630eeb8f345053be860e88ad73b1e690536", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/15111630eeb8f345053be860e88ad73b1e690536", "committedDate": "2020-07-30T05:24:51Z", "message": "15 remaining errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f371776e7064f3fe6157db6d399cea7c10b54e96", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/f371776e7064f3fe6157db6d399cea7c10b54e96", "committedDate": "2020-07-30T05:39:46Z", "message": "another pass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c86b725c734e2f7a5b654da3e2e7696290f44748", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/c86b725c734e2f7a5b654da3e2e7696290f44748", "committedDate": "2020-07-30T05:41:29Z", "message": "last file change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5735849e79e4c82da37aae7ec215d6ba8910ab73", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/5735849e79e4c82da37aae7ec215d6ba8910ab73", "committedDate": "2020-07-30T06:19:44Z", "message": "fixes tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/57c623846a7bf06b47f900027405c5cbc8442b30", "committedDate": "2020-07-30T06:43:02Z", "message": "minor cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTI3Mjcy", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458127272", "createdAt": "2020-07-30T06:50:32Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MDozMlrOG5Vnbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MDozMlrOG5Vnbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NjE3NQ==", "bodyText": "the current method takes in delaySeconds as a long. If we wanted to, we can have it take a Java Duration instead, although perhaps not in this PR", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462776175", "createdAt": "2020-07-30T06:50:32Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/replay/ReplayClockContext.java", "diffHunk": "@@ -140,7 +141,7 @@ boolean isReplaying() {\n     final OpenRequestInfo<?, Long> context = new OpenRequestInfo<>(firingTime);\n     final StartTimerCommandAttributes timer =\n         StartTimerCommandAttributes.newBuilder()\n-            .setStartToFireTimeoutSeconds(delaySeconds)\n+            .setStartToFireTimeout(Durations.fromSeconds(delaySeconds))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTI3NTk2", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458127596", "createdAt": "2020-07-30T06:51:15Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MToxNVrOG5VpWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MToxNVrOG5VpWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NjY2NA==", "bodyText": "Should we change ReplayWorkflowContextImp to take in a java.time.Duration instead of the start time in Nanoseconds in a subsequent PR?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462776664", "createdAt": "2020-07-30T06:51:15Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "diffHunk": "@@ -115,14 +118,14 @@\n           \"First event in the history is not WorkflowExecutionStarted\");\n     }\n     startedEvent = firstEvent.getWorkflowExecutionStartedEventAttributes();\n-    wfStartTimeNanos = firstEvent.getTimestamp();\n+    wfStartTimeNanos = Timestamps.toNanos(firstEvent.getEventTime());\n \n     context =\n         new ReplayWorkflowContextImpl(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTI3ODAw", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458127800", "createdAt": "2020-07-30T06:51:40Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MTo0MFrOG5VqmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MTo0MFrOG5VqmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3Njk4NQ==", "bodyText": "should we have processEventLoop take in a java.time.Duration instead?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462776985", "createdAt": "2020-07-30T06:51:40Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "diffHunk": "@@ -460,7 +464,7 @@ private boolean handleWorkflowTaskImpl(\n         forceCreateNewWorkflowTask =\n             processEventLoop(\n                 startTime,\n-                startedEvent.getWorkflowTaskTimeoutSeconds(),\n+                (int) Durations.toSeconds(startedEvent.getWorkflowTaskTimeout()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTI3OTE0", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458127914", "createdAt": "2020-07-30T06:51:52Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MTo1M1rOG5VrVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MTo1M1rOG5VrVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NzE3NA==", "bodyText": "return a Duration instead?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462777174", "createdAt": "2020-07-30T06:51:53Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "diffHunk": "@@ -606,7 +610,7 @@ private boolean executeLocalActivities(long startTime, int workflowTaskTimeoutSe\n   }\n \n   int getWorkflowTaskTimeoutSeconds() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTI4MTI5", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458128129", "createdAt": "2020-07-30T06:52:19Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MjoxOVrOG5VssQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MjoxOVrOG5VssQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NzUyMQ==", "bodyText": "Should we change all the methods here to return Durations instead?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462777521", "createdAt": "2020-07-30T06:52:19Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/replay/WorkflowContext.java", "diffHunk": "@@ -102,25 +103,25 @@ WorkflowExecution getParentWorkflowExecution() {\n \n   int getWorkflowRunTimeoutSeconds() {\n     WorkflowExecutionStartedEventAttributes attributes = getWorkflowStartedEventAttributes();\n-    return attributes.getWorkflowRunTimeoutSeconds();\n+    return (int) Durations.toSeconds(attributes.getWorkflowRunTimeout());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTI4Mzcw", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458128370", "createdAt": "2020-07-30T06:52:47Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1Mjo0OFrOG5VuIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1Mjo0OFrOG5VuIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3Nzg5MQ==", "bodyText": "change to return java.time.Duration?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462777891", "createdAt": "2020-07-30T06:52:48Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/sync/ActivityInfoImpl.java", "diffHunk": "@@ -65,23 +66,22 @@ public String getActivityType() {\n \n   @Override\n   public long getScheduledTimestamp() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTI4NjQz", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458128643", "createdAt": "2020-07-30T06:53:23Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MzoyM1rOG5VvuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1MzoyM1rOG5VvuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3ODI5Nw==", "bodyText": "should we change this to Duration?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462778297", "createdAt": "2020-07-30T06:53:23Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -168,15 +171,15 @@\n \n   static final class WorkflowData {\n     Optional<TestServiceRetryState> retryState;\n-    int backoffStartIntervalInSeconds;\n+    long backoffStartIntervalInSeconds;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTI5Mjk2", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458129296", "createdAt": "2020-07-30T06:54:39Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1NDozOVrOG5VzLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1NDozOVrOG5VzLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3OTE4Mg==", "bodyText": "change to use java.time.Duration and java timestamp equivalent?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462779182", "createdAt": "2020-07-30T06:54:39Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -984,7 +987,7 @@ private static void scheduleActivityTask(\n       ScheduleActivityTaskCommandAttributes d,\n       long workflowTaskCompletedEventId) {\n     RetryPolicy retryPolicy = ensureDefaultFieldsForActivityRetryPolicy(d.getRetryPolicy());\n-    long expirationInterval = TimeUnit.SECONDS.toMillis(d.getScheduleToCloseTimeoutSeconds());\n+    long expirationInterval = Durations.toMillis(d.getScheduleToCloseTimeout());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 134}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTI5OTA4", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458129908", "createdAt": "2020-07-30T06:55:45Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1NTo0NVrOG5V20Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1NTo0NVrOG5V20Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MDExMw==", "bodyText": "change these intervals/expirations to java.time.Durations?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462780113", "createdAt": "2020-07-30T06:55:45Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestServiceRetryState.java", "diffHunk": "@@ -104,10 +105,10 @@ BackoffInterval getBackoffIntervalInSeconds(Optional<String> errorType, long cur\n       // MaximumAttempts is the total attempts, including initial (non-retry) attempt.\n       return new BackoffInterval(RetryState.RETRY_STATE_MAXIMUM_ATTEMPTS_REACHED);\n     }\n-    long initInterval = TimeUnit.SECONDS.toMillis(retryPolicy.getInitialIntervalInSeconds());\n+    long initInterval = Durations.toMillis(retryPolicy.getInitialInterval());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTMwMTM3", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458130137", "createdAt": "2020-07-30T06:56:13Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1NjoxM1rOG5V4LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1NjoxM1rOG5V4LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MDQ2MQ==", "bodyText": "change from long to Duration? Same for the rest of the items in this file", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462780461", "createdAt": "2020-07-30T06:56:13Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -163,7 +164,7 @@\n       StartWorkflowExecutionRequest startRequest,\n       String runId,\n       Optional<TestServiceRetryState> retryState,\n-      int backoffStartIntervalInSeconds,\n+      long backoffStartIntervalInSeconds,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTMwODE5", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458130819", "createdAt": "2020-07-30T06:57:30Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1NzozMVrOG5V8Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1NzozMVrOG5V8Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MTQ3MA==", "bodyText": "can this argument come in as a java duration?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462781470", "createdAt": "2020-07-30T06:57:31Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -1258,10 +1269,10 @@ private void startNewCronRun(\n         ContinueAsNewWorkflowExecutionCommandAttributes.newBuilder()\n             .setInput(startRequest.getInput())\n             .setWorkflowType(startRequest.getWorkflowType())\n-            .setWorkflowRunTimeoutSeconds(startRequest.getWorkflowRunTimeoutSeconds())\n-            .setWorkflowTaskTimeoutSeconds(startRequest.getWorkflowTaskTimeoutSeconds())\n+            .setWorkflowRunTimeout(startRequest.getWorkflowRunTimeout())\n+            .setWorkflowTaskTimeout(startRequest.getWorkflowTaskTimeout())\n             .setTaskQueue(startRequest.getTaskQueue())\n-            .setBackoffStartIntervalInSeconds(backoffIntervalSeconds)\n+            .setBackoffStartInterval(Durations.fromSeconds(backoffIntervalSeconds))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 298}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTMwOTc3", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458130977", "createdAt": "2020-07-30T06:57:49Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1Nzo0OVrOG5V88g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1Nzo0OVrOG5V88g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MTY4Mg==", "bodyText": "java duration here and for the other variables in this file?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462781682", "createdAt": "2020-07-30T06:57:49Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -1390,7 +1401,7 @@ public void startWorkflow(\n               scheduleWorkflowTask(ctx);\n             }\n \n-            int runTimeoutSeconds = startRequest.getWorkflowRunTimeoutSeconds();\n+            long runTimeoutSeconds = Durations.toSeconds(startRequest.getWorkflowRunTimeout());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 316}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTMxMTAx", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458131101", "createdAt": "2020-07-30T06:58:04Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1ODowNFrOG5V9oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1ODowNFrOG5V9oQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MTg1Nw==", "bodyText": "convert to java duration?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462781857", "createdAt": "2020-07-30T06:58:04Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowService.java", "diffHunk": "@@ -257,7 +258,7 @@ StartWorkflowExecutionResponse startWorkflowExecutionImpl(\n       }\n       Optional<TestServiceRetryState> retryState;\n       if (startRequest.hasRetryPolicy()) {\n-        long expirationInterval = startRequest.getWorkflowExecutionTimeoutSeconds();\n+        long expirationInterval = Durations.toSeconds(startRequest.getWorkflowExecutionTimeout());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTMxMzEy", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458131312", "createdAt": "2020-07-30T06:58:29Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1ODoyOVrOG5V-xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1ODoyOVrOG5V-xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MjE0OA==", "bodyText": "use actual duration here?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462782148", "createdAt": "2020-07-30T06:58:29Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/worker/LocalActivityWorker.java", "diffHunk": "@@ -260,16 +262,18 @@ public Throwable wrapFailure(Task task, Throwable failure) {\n       retryPolicy.getNonRetryableErrorTypesList().toArray(doNotRetry);\n       RetryOptions retryOptions =\n           RetryOptions.newBuilder()\n-              .setMaximumInterval(Duration.ofSeconds(retryPolicy.getMaximumIntervalInSeconds()))\n-              .setInitialInterval(Duration.ofSeconds(retryPolicy.getInitialIntervalInSeconds()))\n+              .setMaximumInterval(\n+                  ProtobufTimeUtils.ToJavaDuration(retryPolicy.getMaximumInterval()))\n+              .setInitialInterval(\n+                  ProtobufTimeUtils.ToJavaDuration(retryPolicy.getInitialInterval()))\n               .setMaximumAttempts(retryPolicy.getMaximumAttempts())\n               .setBackoffCoefficient(retryPolicy.getBackoffCoefficient())\n               .setDoNotRetry(doNotRetry)\n               .build();\n       long sleepMillis = retryOptions.calculateSleepTime(attempt);\n       long elapsedTask = System.currentTimeMillis() - task.taskStartTime;\n       long elapsedTotal = elapsedTask + params.getElapsedTime();\n-      int timeoutSeconds = activityTask.getScheduleToCloseTimeoutSeconds();\n+      int timeoutSeconds = (int) Durations.toSeconds(activityTask.getScheduleToCloseTimeout());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTMxNTI1", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458131525", "createdAt": "2020-07-30T06:58:54Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1ODo1NFrOG5WABA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1ODo1NFrOG5WABA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MjQ2OA==", "bodyText": "use duration here?", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462782468", "createdAt": "2020-07-30T06:58:54Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowService.java", "diffHunk": "@@ -305,7 +306,7 @@ private StartWorkflowExecutionResponse startWorkflowExecutionNoRunningCheckLocke\n       String runId,\n       Optional<String> continuedExecutionRunId,\n       Optional<TestServiceRetryState> retryState,\n-      int backoffStartIntervalInSeconds,\n+      long backoffStartIntervalInSeconds,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTMxNjg2", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458131686", "createdAt": "2020-07-30T06:59:12Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1OToxMlrOG5WAzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1OToxMlrOG5WAzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MjY2OA==", "bodyText": "use duration here", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462782668", "createdAt": "2020-07-30T06:59:12Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -1485,8 +1497,8 @@ private void updateHeartbeatTimer(\n       RequestContext ctx,\n       long activityId,\n       StateMachine<ActivityTaskData> activity,\n-      int startToCloseTimeout,\n-      int heartbeatTimeout) {\n+      long startToCloseTimeout,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 338}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MTMxNzUz", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458131753", "createdAt": "2020-07-30T06:59:18Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1OToxOFrOG5WBLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwNjo1OToxOFrOG5WBLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4Mjc2NA==", "bodyText": "use duration here", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r462782764", "createdAt": "2020-07-30T06:59:18Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -1637,8 +1649,9 @@ public boolean heartbeatActivityTask(long scheduledEventId, Payloads details) {\n           }\n           ActivityTaskData data = activity.getData();\n           data.lastHeartbeatTime = clock.getAsLong();\n-          int startToCloseTimeout = data.scheduledEvent.getStartToCloseTimeoutSeconds();\n-          int heartbeatTimeout = data.scheduledEvent.getHeartbeatTimeoutSeconds();\n+          long startToCloseTimeout =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 349}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NTU1ODI2", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458555826", "createdAt": "2020-07-30T16:16:27Z", "commit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "state": "COMMENTED", "comments": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjoxNjoyN1rOG5qOMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxNjo0MDozNVrOG5rIxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExMzc3OQ==", "bodyText": "Let's make it Duration. As the API that calls it uses Duration and milliseconds.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463113779", "createdAt": "2020-07-30T16:16:27Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/replay/ReplayClockContext.java", "diffHunk": "@@ -140,7 +141,7 @@ boolean isReplaying() {\n     final OpenRequestInfo<?, Long> context = new OpenRequestInfo<>(firingTime);\n     final StartTimerCommandAttributes timer =\n         StartTimerCommandAttributes.newBuilder()\n-            .setStartToFireTimeoutSeconds(delaySeconds)\n+            .setStartToFireTimeout(Durations.fromSeconds(delaySeconds))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NjE3NQ=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExNjA5Nw==", "bodyText": "I don't think Duration is the right class for timestamps which represent point in time.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463116097", "createdAt": "2020-07-30T16:20:04Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "diffHunk": "@@ -115,14 +118,14 @@\n           \"First event in the history is not WorkflowExecutionStarted\");\n     }\n     startedEvent = firstEvent.getWorkflowExecutionStartedEventAttributes();\n-    wfStartTimeNanos = firstEvent.getTimestamp();\n+    wfStartTimeNanos = Timestamps.toNanos(firstEvent.getEventTime());\n \n     context =\n         new ReplayWorkflowContextImpl(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NjY2NA=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExNjM2Mg==", "bodyText": "Yes", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463116362", "createdAt": "2020-07-30T16:20:28Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "diffHunk": "@@ -460,7 +464,7 @@ private boolean handleWorkflowTaskImpl(\n         forceCreateNewWorkflowTask =\n             processEventLoop(\n                 startTime,\n-                startedEvent.getWorkflowTaskTimeoutSeconds(),\n+                (int) Durations.toSeconds(startedEvent.getWorkflowTaskTimeout()),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3Njk4NQ=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExNjQ3Ng==", "bodyText": "yes", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463116476", "createdAt": "2020-07-30T16:20:37Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/replay/ReplayWorkflowExecutor.java", "diffHunk": "@@ -606,7 +610,7 @@ private boolean executeLocalActivities(long startTime, int workflowTaskTimeoutSe\n   }\n \n   int getWorkflowTaskTimeoutSeconds() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NzE3NA=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExNzIzMw==", "bodyText": "yes, with exception of get..Timestamp ones.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463117233", "createdAt": "2020-07-30T16:21:42Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/replay/WorkflowContext.java", "diffHunk": "@@ -102,25 +103,25 @@ WorkflowExecution getParentWorkflowExecution() {\n \n   int getWorkflowRunTimeoutSeconds() {\n     WorkflowExecutionStartedEventAttributes attributes = getWorkflowStartedEventAttributes();\n-    return attributes.getWorkflowRunTimeoutSeconds();\n+    return (int) Durations.toSeconds(attributes.getWorkflowRunTimeout());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3NzUyMQ=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExNzYxNg==", "bodyText": "No, as it is timestamp", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463117616", "createdAt": "2020-07-30T16:22:23Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/sync/ActivityInfoImpl.java", "diffHunk": "@@ -65,23 +66,22 @@ public String getActivityType() {\n \n   @Override\n   public long getScheduledTimestamp() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3Nzg5MQ=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExODU0NQ==", "bodyText": "To Duration or milliseconds", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463118545", "createdAt": "2020-07-30T16:23:58Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -168,15 +171,15 @@\n \n   static final class WorkflowData {\n     Optional<TestServiceRetryState> retryState;\n-    int backoffStartIntervalInSeconds;\n+    long backoffStartIntervalInSeconds;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3ODI5Nw=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzExOTg2NQ==", "bodyText": "Duration", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463119865", "createdAt": "2020-07-30T16:25:53Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -984,7 +987,7 @@ private static void scheduleActivityTask(\n       ScheduleActivityTaskCommandAttributes d,\n       long workflowTaskCompletedEventId) {\n     RetryPolicy retryPolicy = ensureDefaultFieldsForActivityRetryPolicy(d.getRetryPolicy());\n-    long expirationInterval = TimeUnit.SECONDS.toMillis(d.getScheduleToCloseTimeoutSeconds());\n+    long expirationInterval = Durations.toMillis(d.getScheduleToCloseTimeout());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc3OTE4Mg=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyMDcxMQ==", "bodyText": "Consider adding a method to ctx that returns Proto Timestamp.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463120711", "createdAt": "2020-07-30T16:27:00Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -1020,11 +1023,11 @@ private static void scheduleActivityTask(\n             .setWorkflowExecution(ctx.getExecution())\n             .setActivityId(d.getActivityId())\n             .setInput(d.getInput())\n-            .setHeartbeatTimeoutSeconds(d.getHeartbeatTimeoutSeconds())\n-            .setScheduleToCloseTimeoutSeconds(d.getScheduleToCloseTimeoutSeconds())\n-            .setStartToCloseTimeoutSeconds(d.getStartToCloseTimeoutSeconds())\n-            .setScheduledTimestamp(ctx.currentTimeInNanoseconds())\n-            .setScheduledTimestampThisAttempt(ctx.currentTimeInNanoseconds())\n+            .setHeartbeatTimeout(d.getHeartbeatTimeout())\n+            .setScheduleToCloseTimeout(d.getScheduleToCloseTimeout())\n+            .setStartToCloseTimeout(d.getStartToCloseTimeout())\n+            .setScheduledTime(Timestamps.fromNanos(ctx.currentTimeInNanoseconds()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 166}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyMTE2OA==", "bodyText": "Consider adding a method to the store that returns Proto Timestamp.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463121168", "createdAt": "2020-07-30T16:27:46Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -1272,11 +1274,11 @@ private static void startActivityTask(\n     a.setAttempt(data.getAttempt());\n     // Setting timestamp here as the default logic will set it to the time when it is added to the\n     // history. But in the case of retry it happens only after an activity completion.\n-    long timestamp = TimeUnit.MILLISECONDS.toNanos(data.store.currentTimeMillis());\n+    Timestamp timestamp = Timestamps.fromMillis(data.store.currentTimeMillis());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 204}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyMTkzMw==", "bodyText": "Consider changing the constant from seconds as well.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463121933", "createdAt": "2020-07-30T16:29:06Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -1859,17 +1862,19 @@ private static void failExternalCancellation(\n \n   // Mimics the default activity retry policy of a standard Temporal server.\n   static RetryPolicy ensureDefaultFieldsForActivityRetryPolicy(RetryPolicy originalPolicy) {\n-    int initialIntervalInSeconds =\n-        originalPolicy.getInitialIntervalInSeconds() == 0\n-            ? DEFAULT_ACTIVITY_RETRY_INITIAL_INTERVAL_SECONDS\n-            : originalPolicy.getInitialIntervalInSeconds();\n+    Duration initialInterval =\n+        Durations.compare(originalPolicy.getInitialInterval(), Durations.ZERO) == 0\n+            ? Durations.fromSeconds(DEFAULT_ACTIVITY_RETRY_INITIAL_INTERVAL_SECONDS)\n+            : originalPolicy.getInitialInterval();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 252}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyMjc5Nw==", "bodyText": "I'm curious if \"originalPolicy.getInitialInterval() == Durations.ZERO\" would work.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463122797", "createdAt": "2020-07-30T16:30:28Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/StateMachines.java", "diffHunk": "@@ -1859,17 +1862,19 @@ private static void failExternalCancellation(\n \n   // Mimics the default activity retry policy of a standard Temporal server.\n   static RetryPolicy ensureDefaultFieldsForActivityRetryPolicy(RetryPolicy originalPolicy) {\n-    int initialIntervalInSeconds =\n-        originalPolicy.getInitialIntervalInSeconds() == 0\n-            ? DEFAULT_ACTIVITY_RETRY_INITIAL_INTERVAL_SECONDS\n-            : originalPolicy.getInitialIntervalInSeconds();\n+    Duration initialInterval =\n+        Durations.compare(originalPolicy.getInitialInterval(), Durations.ZERO) == 0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 250}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyMzQ0OQ==", "bodyText": "Only if it improves readability of this code.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463123449", "createdAt": "2020-07-30T16:31:36Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/TestServiceRetryState.java", "diffHunk": "@@ -104,10 +105,10 @@ BackoffInterval getBackoffIntervalInSeconds(Optional<String> errorType, long cur\n       // MaximumAttempts is the total attempts, including initial (non-retry) attempt.\n       return new BackoffInterval(RetryState.RETRY_STATE_MAXIMUM_ATTEMPTS_REACHED);\n     }\n-    long initInterval = TimeUnit.SECONDS.toMillis(retryPolicy.getInitialIntervalInSeconds());\n+    long initInterval = Durations.toMillis(retryPolicy.getInitialInterval());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MDExMw=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyNDI5Mw==", "bodyText": "Either change to the duration or make sure that all the intervals are in milliseconds.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463124293", "createdAt": "2020-07-30T16:33:04Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -163,7 +164,7 @@\n       StartWorkflowExecutionRequest startRequest,\n       String runId,\n       Optional<TestServiceRetryState> retryState,\n-      int backoffStartIntervalInSeconds,\n+      long backoffStartIntervalInSeconds,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MDQ2MQ=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyNTk3MQ==", "bodyText": "Let's migrate timer from seconds", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463125971", "createdAt": "2020-07-30T16:35:53Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -1059,7 +1068,8 @@ private void processStartTimer(\n     timer = StateMachines.newTimerStateMachine();\n     timers.put(timerId, timer);\n     timer.action(StateMachines.Action.START, ctx, a, workflowTaskCompletedId);\n-    ctx.addTimer(a.getStartToFireTimeoutSeconds(), () -> fireTimer(timerId), \"fire timer\");\n+    ctx.addTimer(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 269}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyNjQxNQ==", "bodyText": "Yes, we should remove \"Seconds\" from everwhere.", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463126415", "createdAt": "2020-07-30T16:36:39Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -1258,10 +1269,10 @@ private void startNewCronRun(\n         ContinueAsNewWorkflowExecutionCommandAttributes.newBuilder()\n             .setInput(startRequest.getInput())\n             .setWorkflowType(startRequest.getWorkflowType())\n-            .setWorkflowRunTimeoutSeconds(startRequest.getWorkflowRunTimeoutSeconds())\n-            .setWorkflowTaskTimeoutSeconds(startRequest.getWorkflowTaskTimeoutSeconds())\n+            .setWorkflowRunTimeout(startRequest.getWorkflowRunTimeout())\n+            .setWorkflowTaskTimeout(startRequest.getWorkflowTaskTimeout())\n             .setTaskQueue(startRequest.getTaskQueue())\n-            .setBackoffStartIntervalInSeconds(backoffIntervalSeconds)\n+            .setBackoffStartInterval(Durations.fromSeconds(backoffIntervalSeconds))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MTQ3MA=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 298}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyNjYyMA==", "bodyText": "If it improves readability", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463126620", "createdAt": "2020-07-30T16:37:00Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/testservice/TestWorkflowMutableStateImpl.java", "diffHunk": "@@ -1390,7 +1401,7 @@ public void startWorkflow(\n               scheduleWorkflowTask(ctx);\n             }\n \n-            int runTimeoutSeconds = startRequest.getWorkflowRunTimeoutSeconds();\n+            long runTimeoutSeconds = Durations.toSeconds(startRequest.getWorkflowRunTimeout());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MTY4Mg=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 316}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyNzkzMQ==", "bodyText": "Or Duration or millis", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463127931", "createdAt": "2020-07-30T16:39:12Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/worker/LocalActivityWorker.java", "diffHunk": "@@ -260,16 +262,18 @@ public Throwable wrapFailure(Task task, Throwable failure) {\n       retryPolicy.getNonRetryableErrorTypesList().toArray(doNotRetry);\n       RetryOptions retryOptions =\n           RetryOptions.newBuilder()\n-              .setMaximumInterval(Duration.ofSeconds(retryPolicy.getMaximumIntervalInSeconds()))\n-              .setInitialInterval(Duration.ofSeconds(retryPolicy.getInitialIntervalInSeconds()))\n+              .setMaximumInterval(\n+                  ProtobufTimeUtils.ToJavaDuration(retryPolicy.getMaximumInterval()))\n+              .setInitialInterval(\n+                  ProtobufTimeUtils.ToJavaDuration(retryPolicy.getInitialInterval()))\n               .setMaximumAttempts(retryPolicy.getMaximumAttempts())\n               .setBackoffCoefficient(retryPolicy.getBackoffCoefficient())\n               .setDoNotRetry(doNotRetry)\n               .build();\n       long sleepMillis = retryOptions.calculateSleepTime(attempt);\n       long elapsedTask = System.currentTimeMillis() - task.taskStartTime;\n       long elapsedTotal = elapsedTask + params.getElapsedTime();\n-      int timeoutSeconds = activityTask.getScheduleToCloseTimeoutSeconds();\n+      int timeoutSeconds = (int) Durations.toSeconds(activityTask.getScheduleToCloseTimeout());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc4MjE0OA=="}, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEyODc3NA==", "bodyText": "the arguments should be converted to Duration", "url": "https://github.com/temporalio/sdk-java/pull/163#discussion_r463128774", "createdAt": "2020-07-30T16:40:35Z", "author": {"login": "mfateev"}, "path": "src/test/java/io/temporal/testUtils/TestServiceUtils.java", "diffHunk": "@@ -59,8 +60,8 @@ public static void startWorkflowExecution(\n     request.setNamespace(namespace);\n     request.setWorkflowId(UUID.randomUUID().toString());\n     request.setTaskQueue(createNormalTaskQueue(taskqueueName));\n-    request.setWorkflowRunTimeoutSeconds(workflowRunTimeoutSeconds);\n-    request.setWorkflowTaskTimeoutSeconds(workflowTaskTimeoutSeconds);\n+    request.setWorkflowRunTimeout(Durations.fromSeconds(workflowRunTimeoutSeconds));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57c623846a7bf06b47f900027405c5cbc8442b30"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffd8bc7c0a4e591c032c850f1fe4e8fb4996bce6", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/ffd8bc7c0a4e591c032c850f1fe4e8fb4996bce6", "committedDate": "2020-07-30T17:19:13Z", "message": "fixes tests against one box server"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a2fd32a999afe99c3f11f868efdc82eaa9d9ba5", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/0a2fd32a999afe99c3f11f868efdc82eaa9d9ba5", "committedDate": "2020-07-30T20:07:49Z", "message": "adjusts for attempt starting at 1"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a41e203d379a6fe4e8d191feff25e961a39163d5", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/a41e203d379a6fe4e8d191feff25e961a39163d5", "committedDate": "2020-07-30T19:55:31Z", "message": "fixes up tests"}, "afterCommit": {"oid": "0a2fd32a999afe99c3f11f868efdc82eaa9d9ba5", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/0a2fd32a999afe99c3f11f868efdc82eaa9d9ba5", "committedDate": "2020-07-30T20:07:49Z", "message": "adjusts for attempt starting at 1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1d630ae3ab18fcab7f1821bcb2e1324f096083c", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/a1d630ae3ab18fcab7f1821bcb2e1324f096083c", "committedDate": "2020-07-30T21:30:25Z", "message": "replace seconds with durations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f8119be58e08887bf2dc903a70e136839063554", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/2f8119be58e08887bf2dc903a70e136839063554", "committedDate": "2020-07-30T21:45:46Z", "message": "more cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a5b5c098b89aaddf271d38e609db7a7cad530f4", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/8a5b5c098b89aaddf271d38e609db7a7cad530f4", "committedDate": "2020-07-30T22:30:16Z", "message": "adds proto timestamp to ctx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "335d08714ba886855568eca96947dbc19c3551de", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/335d08714ba886855568eca96947dbc19c3551de", "committedDate": "2020-07-30T22:54:50Z", "message": "more changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "999fe2bdcbbbdc0e826a5464635c25fdb4a7f311", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/999fe2bdcbbbdc0e826a5464635c25fdb4a7f311", "committedDate": "2020-07-30T23:03:53Z", "message": "final cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d868b2384f9f5a9058ec78bab0d8edb5a9b5fcbc", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/d868b2384f9f5a9058ec78bab0d8edb5a9b5fcbc", "committedDate": "2020-07-30T23:11:37Z", "message": "rename variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b8259e0348bd9c6f8782b23ab713c94cc29dab3", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/5b8259e0348bd9c6f8782b23ab713c94cc29dab3", "committedDate": "2020-07-30T23:13:27Z", "message": "protects against overflow in protobuf library"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70098edc349d8a38ff2c4ce869403b6adaf7adc4", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/70098edc349d8a38ff2c4ce869403b6adaf7adc4", "committedDate": "2020-07-30T23:18:36Z", "message": "more protection against overflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b8f5f9e37db771619921df334602c470b12ffb4", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/4b8f5f9e37db771619921df334602c470b12ffb4", "committedDate": "2020-07-30T23:22:53Z", "message": "nit code cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "231e07ff69b9fda6a738362e4fe6f82f45bda13d", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/231e07ff69b9fda6a738362e4fe6f82f45bda13d", "committedDate": "2020-07-30T23:29:02Z", "message": "gets rid of a few places where toSeconds is used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c58a3bdea51db827c1297108d0bbe9fa6b7bf25", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/5c58a3bdea51db827c1297108d0bbe9fa6b7bf25", "committedDate": "2020-07-30T23:29:26Z", "message": "formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3715946b03fcbde2ac6806026e1336b803549a35", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/3715946b03fcbde2ac6806026e1336b803549a35", "committedDate": "2020-07-30T23:30:54Z", "message": "fix static overflow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d5de8f82b739bca294ec5e5b76bb95b05b5be08", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/8d5de8f82b739bca294ec5e5b76bb95b05b5be08", "committedDate": "2020-07-30T23:43:42Z", "message": "fixes two places where we are reading a millisecond value as a second"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "216204ddebe829b00df3fa88d870a48f3b2bc88d", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/216204ddebe829b00df3fa88d870a48f3b2bc88d", "committedDate": "2020-07-30T23:46:51Z", "message": "fixes situation where we are casting to seconds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87e0c0b666cf93c6896a767546ffabfedddd7618", "author": {"user": {"login": "mastermanu", "name": null}}, "url": "https://github.com/temporalio/sdk-java/commit/87e0c0b666cf93c6896a767546ffabfedddd7618", "committedDate": "2020-07-31T00:00:11Z", "message": "protobuf cannot directly compare with ZERO value"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4ODQ1NjE4", "url": "https://github.com/temporalio/sdk-java/pull/163#pullrequestreview-458845618", "createdAt": "2020-07-31T00:21:25Z", "commit": {"oid": "87e0c0b666cf93c6896a767546ffabfedddd7618"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3501, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}