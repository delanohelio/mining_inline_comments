{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1NjQzNzI5", "number": 289, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxODowNjo0NVrOFJllHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxODoyMzozNlrOFJl2eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NTk3MjEzOnYy", "diffSide": "RIGHT", "path": "temporal-sdk/src/main/java/io/temporal/activity/DynamicActivity.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxODowNjo0NVrOIL-6bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxODowNjo0NVrOIL-6bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzNjAxNA==", "bodyText": "One sentence example might be useful", "url": "https://github.com/temporalio/sdk-java/pull/289#discussion_r549436014", "createdAt": "2020-12-28T18:06:45Z", "author": {"login": "Sushisource"}, "path": "temporal-sdk/src/main/java/io/temporal/activity/DynamicActivity.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ *  Copyright (C) 2020 Temporal Technologies, Inc. All Rights Reserved.\n+ *\n+ *  Copyright 2012-2016 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *  Modifications copyright (C) 2017 Uber Technologies, Inc.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\"). You may not\n+ *  use this file except in compliance with the License. A copy of the License is\n+ *  located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed on\n+ *  an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package io.temporal.activity;\n+\n+import io.temporal.common.converter.EncodedValues;\n+\n+/**\n+ * Use DynamicActivity to implement any number of activity types dynamically. When an activity\n+ * implementation that extends DynamicActivity is registered it is called for any activity type\n+ * invocation that doesn't have an explicitly registered handler. Only one instance that implements\n+ * DynamicActivity per {@link io.temporal.worker.Worker} is allowed.\n+ *\n+ * <p>The DynamicActivity can be useful for integrations with existing libraries.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cbe996e4f51482a2e5c3080b993b5b460fd47da"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NTk4MjY3OnYy", "diffSide": "RIGHT", "path": "temporal-sdk/src/main/java/io/temporal/internal/sync/POJOActivityTaskHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxODoxMjozOFrOIL_Adw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxODoxMjozOFrOIL_Adw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzNzU1OQ==", "bodyText": "Would be good to indicate workers can only have one DynamicActivity implementation in a docstring somewhere", "url": "https://github.com/temporalio/sdk-java/pull/289#discussion_r549437559", "createdAt": "2020-12-28T18:12:38Z", "author": {"login": "Sushisource"}, "path": "temporal-sdk/src/main/java/io/temporal/internal/sync/POJOActivityTaskHandler.java", "diffHunk": "@@ -83,11 +86,19 @@\n     this.interceptors = Objects.requireNonNull(interceptors);\n   }\n \n-  private void addActivityImplementation(\n+  private void registerActivityImplementation(\n       Object activity, BiFunction<Method, Object, ActivityTaskExecutor> newTaskExecutor) {\n     if (activity instanceof Class) {\n       throw new IllegalArgumentException(\"Activity object instance expected, not the class\");\n     }\n+    if (activity instanceof DynamicActivity) {\n+      if (dynamicActivity != null) {\n+        throw new IllegalStateException(\n+            \"An implementation of DynamicActivity is already registered with the worker\");\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cbe996e4f51482a2e5c3080b993b5b460fd47da"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NTk4ODY3OnYy", "diffSide": "RIGHT", "path": "temporal-sdk/src/main/java/io/temporal/internal/sync/POJOActivityTaskHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxODoxNTo0NlrOIL_D2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxODoxNTo0NlrOIL_D2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzODQyNA==", "bodyText": "Quite a lot of the code in here is quite similar to the above POJOActivityImplementation -- would be nice to dedupe as reasonable.", "url": "https://github.com/temporalio/sdk-java/pull/289#discussion_r549438424", "createdAt": "2020-12-28T18:15:46Z", "author": {"login": "Sushisource"}, "path": "temporal-sdk/src/main/java/io/temporal/internal/sync/POJOActivityTaskHandler.java", "diffHunk": "@@ -287,6 +301,96 @@ public Object execute(Object[] arguments) {\n     }\n   }\n \n+  private class DynamicActivityImplementation implements ActivityTaskExecutor {\n+\n+    private final DynamicActivity activity;\n+\n+    public DynamicActivityImplementation(DynamicActivity activity) {\n+      this.activity = activity;\n+    }\n+\n+    @Override\n+    public ActivityTaskHandler.Result execute(ActivityInfoImpl info, Scope metricsScope) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cbe996e4f51482a2e5c3080b993b5b460fd47da"}, "originalPosition": 116}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NTk5MTM1OnYy", "diffSide": "RIGHT", "path": "temporal-sdk/src/main/java/io/temporal/internal/sync/POJOWorkflowImplementationFactory.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxODoxNzowMFrOIL_FSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxODoxNzowMFrOIL_FSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQzODc5Mg==", "bodyText": "Same as other comment - would be nice to expose this restriction to user in docstring.", "url": "https://github.com/temporalio/sdk-java/pull/289#discussion_r549438792", "createdAt": "2020-12-28T18:17:00Z", "author": {"login": "Sushisource"}, "path": "temporal-sdk/src/main/java/io/temporal/internal/sync/POJOWorkflowImplementationFactory.java", "diffHunk": "@@ -94,23 +97,33 @@\n     this.contextPropagators = contextPropagators;\n   }\n \n-  void addWorkflowImplementationTypes(\n+  void registerWorkflowImplementationTypes(\n       WorkflowImplementationOptions options, Class<?>[] workflowImplementationTypes) {\n     for (Class<?> type : workflowImplementationTypes) {\n-      addWorkflowImplementationType(options, type);\n+      registerWorkflowImplementationType(options, type);\n     }\n   }\n \n   <R> void addWorkflowImplementationFactory(Class<R> clazz, Functions.Func<R> factory) {\n+    @SuppressWarnings(\"unchecked\")\n     WorkflowImplementationOptions unitTestingOptions =\n         WorkflowImplementationOptions.newBuilder()\n             .setFailWorkflowExceptionTypes(Throwable.class)\n             .build();\n     addWorkflowImplementationFactory(unitTestingOptions, clazz, factory);\n   }\n \n+  @SuppressWarnings(\"unchecked\")\n   <R> void addWorkflowImplementationFactory(\n       WorkflowImplementationOptions options, Class<R> clazz, Functions.Func<R> factory) {\n+    if (DynamicWorkflow.class.isAssignableFrom(clazz)) {\n+      if (dynamicWorkflowImplementationFactory != null) {\n+        throw new IllegalStateException(\n+            \"An implementation of DynamicWorkflow or its factory is already registered with the worker\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cbe996e4f51482a2e5c3080b993b5b460fd47da"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1NjAxNjU4OnYy", "diffSide": "RIGHT", "path": "temporal-sdk/src/main/java/io/temporal/workflow/DynamicWorkflow.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxODoyMzozNlrOIL_V6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOFQxODoyMzozNlrOIL_V6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ0MzA0OA==", "bodyText": "Presumably it's necessary for the dynamic workflow to always be deterministic in the same way that normal workflows are, right? IE: Deterministic w.r.t. EncodedValues. Might be worth making reference to that here just so users don't think magically that requirement has gone away.", "url": "https://github.com/temporalio/sdk-java/pull/289#discussion_r549443048", "createdAt": "2020-12-28T18:23:36Z", "author": {"login": "Sushisource"}, "path": "temporal-sdk/src/main/java/io/temporal/workflow/DynamicWorkflow.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ *  Copyright (C) 2020 Temporal Technologies, Inc. All Rights Reserved.\n+ *\n+ *  Copyright 2012-2016 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *  Modifications copyright (C) 2017 Uber Technologies, Inc.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\"). You may not\n+ *  use this file except in compliance with the License. A copy of the License is\n+ *  located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ *  or in the \"license\" file accompanying this file. This file is distributed on\n+ *  an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *  express or implied. See the License for the specific language governing\n+ *  permissions and limitations under the License.\n+ */\n+\n+package io.temporal.workflow;\n+\n+import io.temporal.common.converter.EncodedValues;\n+\n+/**\n+ * Use DynamicWorkflow to implement any number of workflow types dynamically. When a workflow\n+ * implementation type that extends DynamicWorkflow is registered, it is used to implement any\n+ * workflow type that is not implicitly registered with the {@link io.temporal.worker.Worker}. Only\n+ * one type that implements DynamicWorkflow per worker is allowed.\n+ *\n+ * <p>The main use case for DynamicWorkflow is an implementation of custom Domain Specific Languages\n+ * (DSLs). A single implementation can implement a workflow type which definition is dynamically\n+ * loaded from some external source.\n+ *", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7cbe996e4f51482a2e5c3080b993b5b460fd47da"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1691, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}