{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1MDIxODYx", "number": 143, "title": "Activity interceptor", "bodyText": "", "createdAt": "2020-07-06T21:54:58Z", "url": "https://github.com/temporalio/sdk-java/pull/143", "merged": true, "mergeCommit": {"oid": "112dd5d31cd7e184730e471f3908faa71644da3c"}, "closed": true, "closedAt": "2020-07-07T18:52:53Z", "author": {"login": "mfateev"}, "timelineItems": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcv4pQQAH2gAyNDQ1MDIxODYxOjFlZGVhY2U1NDE3ODFhYzIyNmY0OWY1YWEwMWNjNjM5N2MyMWFlNGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyqTzGAH2gAyNDQ1MDIxODYxOmI0ZDRjNjA5MDlkMjc2MDI3ZTVkYjMzNTU5NDY0NjRmYzMwNWQ0NTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1edeace541781ac226f49f5aa01cc6397c21ae4d", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/1edeace541781ac226f49f5aa01cc6397c21ae4d", "committedDate": "2020-06-29T03:40:16Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "747e91c4f4deb30bedc5af1001db2b0644f718c0", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/747e91c4f4deb30bedc5af1001db2b0644f718c0", "committedDate": "2020-06-29T04:05:49Z", "message": "Refactored ExecuteActivityParameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc5649d86c7529e456061c05567573fde273e2bd", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/dc5649d86c7529e456061c05567573fde273e2bd", "committedDate": "2020-06-30T01:34:57Z", "message": "Refactored ExecuteChildWorkflowParameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2722ddae75ec1129e8262456d7e55ed59c4c672d", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/2722ddae75ec1129e8262456d7e55ed59c4c672d", "committedDate": "2020-06-30T16:09:06Z", "message": "Refactored ContinueAsNewWorkflowExecutionParameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be7dc29289a3e6814c41a0e9a3c5fd394cb32930", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/be7dc29289a3e6814c41a0e9a3c5fd394cb32930", "committedDate": "2020-06-30T16:35:50Z", "message": "Refactored QueryWorkflowParameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c8d88b1503d0fb01249c5533901954113429c8c", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/4c8d88b1503d0fb01249c5533901954113429c8c", "committedDate": "2020-06-30T21:40:11Z", "message": "Refactored TerminateWorkflowExecutionParameters. Added WorkflowStub.terminate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd13c1f2a569e8497d540c1754acee7e7ee90fd3", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/bd13c1f2a569e8497d540c1754acee7e7ee90fd3", "committedDate": "2020-06-30T23:50:59Z", "message": "Refactored StartChildWorkflowExecutionParameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "665b53fdb5939f5c358fe30557f7b87f69638bd0", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/665b53fdb5939f5c358fe30557f7b87f69638bd0", "committedDate": "2020-07-01T03:35:43Z", "message": "refactored SignalWithStartWorkflowExecutionParameters & StartWorkflowExecutionParameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71a8718c1ff742b22cbc60076084323312a40a0a", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/71a8718c1ff742b22cbc60076084323312a40a0a", "committedDate": "2020-07-01T04:01:29Z", "message": "SignalExternalWorkflowParameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68b9ae9761863a9c7c6ff98c86247cce8859b0a7", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/68b9ae9761863a9c7c6ff98c86247cce8859b0a7", "committedDate": "2020-07-01T04:02:45Z", "message": "removed RetryParameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "461510a60dd0cc6cca6afb0dab06b48c954817f1", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/461510a60dd0cc6cca6afb0dab06b48c954817f1", "committedDate": "2020-07-01T04:07:20Z", "message": "RemovedSignalExternalWorkflowParameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff12203e12b6a43d7f5c592843e7c024dba75a4b", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/ff12203e12b6a43d7f5c592843e7c024dba75a4b", "committedDate": "2020-07-01T04:32:45Z", "message": "Switched from Builder to attributes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b71abee100be4aebe2d58bee5d4665387286632", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/0b71abee100be4aebe2d58bee5d4665387286632", "committedDate": "2020-07-01T05:02:18Z", "message": "From builder to request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca776f9ceb4ccd1c92d46ae5cc53097def0255d5", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/ca776f9ceb4ccd1c92d46ae5cc53097def0255d5", "committedDate": "2020-07-01T22:19:05Z", "message": "Removed Terminate & Cancel parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b150f5bc599325dcc1fb8d2af2cccb875376d6a", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/7b150f5bc599325dcc1fb8d2af2cccb875376d6a", "committedDate": "2020-07-01T22:29:37Z", "message": "Deleted ContinueAsNewWorkflowExecutionParameters and QueryWorkflowParameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddb41068db9b4ecceab17bfb212a302ddb9d289a", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/ddb41068db9b4ecceab17bfb212a302ddb9d289a", "committedDate": "2020-07-01T22:37:52Z", "message": "Removed StartWorkflowExecutionParameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3078285d662639921eb425a663aceb5fc6cab4ef", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/3078285d662639921eb425a663aceb5fc6cab4ef", "committedDate": "2020-07-03T16:36:07Z", "message": "Merge branch 'master' of github.com:temporalio/temporal-java-sdk into parameters-refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32abd66f604e765adc5c9993b20ac796699e3e37", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/32abd66f604e765adc5c9993b20ac796699e3e37", "committedDate": "2020-07-03T16:54:14Z", "message": "Updated default RPC timeout to 10 seconds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c2628d2542f7a7eedcc465b144255ae6bfad529", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/8c2628d2542f7a7eedcc465b144255ae6bfad529", "committedDate": "2020-07-03T16:54:37Z", "message": "Updated dependcy versions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec481797f5868a9dbf205e2448daa800713fa74f", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/ec481797f5868a9dbf205e2448daa800713fa74f", "committedDate": "2020-07-03T16:55:02Z", "message": "Removed unused variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a9695e808679bb8eb9a72988f57e94a2cc150d6", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/8a9695e808679bb8eb9a72988f57e94a2cc150d6", "committedDate": "2020-07-03T17:10:00Z", "message": "Updated gradle to 6.5.1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d2571a4c94dc6f7e2ef424e94aba26b96f92afd", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/8d2571a4c94dc6f7e2ef424e94aba26b96f92afd", "committedDate": "2020-07-03T17:29:13Z", "message": "checkUpdates plugin added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43a2c79cb8eac4ee3e85e8de848e9e37f64b6baf", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/43a2c79cb8eac4ee3e85e8de848e9e37f64b6baf", "committedDate": "2020-07-03T19:13:07Z", "message": "Build will print list of failed tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce5a7578a6aab0810200c9665ffd152b24fe1eec", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/ce5a7578a6aab0810200c9665ffd152b24fe1eec", "committedDate": "2020-07-03T19:13:40Z", "message": "Allowed multiple calls to registerWorkflowImplementationTypes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6af33c9997cfccad6e802251106b0d3118720839", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/6af33c9997cfccad6e802251106b0d3118720839", "committedDate": "2020-07-03T20:30:19Z", "message": "ActivityInterceptor added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "100761aed130b31f78fab8e03ca2d6658b7dcdc5", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/100761aed130b31f78fab8e03ca2d6658b7dcdc5", "committedDate": "2020-07-06T20:28:17Z", "message": "Added ActivityInterceptor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c9863fd9030894bc286061c5740ec107cd4ca37", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/2c9863fd9030894bc286061c5740ec107cd4ca37", "committedDate": "2020-07-06T20:28:27Z", "message": "Merge branch 'master' of github.com:temporalio/temporal-java-sdk into activity-interceptor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d97f0e5a1cae736219339f5efa2a1d855e69075", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/3d97f0e5a1cae736219339f5efa2a1d855e69075", "committedDate": "2020-07-06T21:54:34Z", "message": "Added ActivityInterceptor test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3337462e8cff25dd02adab143f3936e3386e0e28", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/3337462e8cff25dd02adab143f3936e3386e0e28", "committedDate": "2020-07-06T22:25:59Z", "message": "Added metricScope to local activity context"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52b7eaea633c57a2e4e7b954f927cb6d006cef48", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/52b7eaea633c57a2e4e7b954f927cb6d006cef48", "committedDate": "2020-07-07T00:29:04Z", "message": "Fixed interception of a local activity"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNTY2MDE3", "url": "https://github.com/temporalio/sdk-java/pull/143#pullrequestreview-443566017", "createdAt": "2020-07-07T05:10:31Z", "commit": {"oid": "52b7eaea633c57a2e4e7b954f927cb6d006cef48"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwNToxMDozMVrOGtvTeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwNToxMDozMVrOGtvTeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDYxNDEzNw==", "bodyText": "Minor nit - Looks like stack trace in this test JSON may be out of sync after this change:\nhttps://github.com/temporalio/temporal-java-sdk/blob/master/src/test/resources/testAsyncActivityRetryHistory.json#L122", "url": "https://github.com/temporalio/sdk-java/pull/143#discussion_r450614137", "createdAt": "2020-07-07T05:10:31Z", "author": {"login": "shawnhathaway"}, "path": "src/main/java/io/temporal/internal/sync/POJOActivityTaskHandler.java", "diffHunk": "@@ -234,29 +277,30 @@ public Result handle(\n \n     @Override\n     public ActivityTaskHandler.Result execute(ActivityInfoImpl info, Scope metricsScope) {\n-      ActivityExecutionContext context = new LocalActivityExecutionContextImpl(info);\n-      CurrentActivityExecutionContext.set(context);\n+      ActivityExecutionContext context = new LocalActivityExecutionContextImpl(info, metricsScope);\n       Optional<Payloads> input = info.getInput();\n+      ActivityInboundCallsInterceptor inboundCallsInterceptor =\n+          new POJOActivityInboundCallsInterceptor(activity, method);\n+      for (ActivityInterceptor interceptor : interceptors) {\n+        inboundCallsInterceptor = interceptor.interceptActivity(inboundCallsInterceptor);\n+      }\n+      inboundCallsInterceptor.init(context);\n       try {\n         Object[] args =\n             dataConverter.arrayFromPayloads(\n                 input, method.getParameterTypes(), method.getGenericParameterTypes());\n-        Object result = method.invoke(activity, args);\n+        Object result = inboundCallsInterceptor.execute(args);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "52b7eaea633c57a2e4e7b954f927cb6d006cef48"}, "originalPosition": 168}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4d4c60909d276027e5db3355946464fc305d456", "author": {"user": {"login": "mfateev", "name": "Maxim Fateev"}}, "url": "https://github.com/temporalio/sdk-java/commit/b4d4c60909d276027e5db3355946464fc305d456", "committedDate": "2020-07-07T18:39:56Z", "message": "Regenerated json files as stack traces have changed"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3495, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}