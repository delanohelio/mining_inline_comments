{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5NzEwMjY4", "number": 164, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMTo0NjoxNVrOET5vlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjoxMjo0MlrOET5_vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MzA0NDY5OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/common/converter/DataConverter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMTo0NjoxNVrOG55bJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjoxMToxMlrOG55yVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2Mjg1NQ==", "bodyText": "the first clause of this condition checks that parameterTypes is not null, so this parameterTypes==null check is unnecessary, right? Or did you mean to check if genericParameterTypes is null?", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463362855", "createdAt": "2020-07-31T01:46:15Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/common/converter/DataConverter.java", "diffHunk": "@@ -51,30 +53,56 @@ static DataConverter getDefaultInstance() {\n   Optional<Payloads> toPayloads(Object... values) throws DataConverterException;\n \n   /**\n-   * Implements conversion of a single value.\n+   * Implements conversion of an array of values of different types. Useful for deserializing\n+   * arguments of function invocations.\n    *\n-   * @param content Serialized value to convert to a Java object.\n+   * @param index index of the value in the payloads\n+   * @param content serialized value to convert to Java objects.\n    * @param parameterType type of the parameter stored in the content\n    * @param genericParameterType generic type of the parameter stored in the content\n    * @return converted Java object\n    * @throws DataConverterException if conversion of the data passed as parameter failed for any\n    *     reason.\n    */\n-  <T> T fromPayloads(Optional<Payloads> content, Class<T> parameterType, Type genericParameterType)\n+  <T> T fromPayloads(\n+      int index, Optional<Payloads> content, Class<T> parameterType, Type genericParameterType)\n       throws DataConverterException;\n \n-  /**\n-   * Implements conversion of an array of values of different types. Useful for deserializing\n-   * arguments of function invocations.\n-   *\n-   * @param content serialized value to convert to Java objects.\n-   * @param parameterTypes types of the parameters stored in the content\n-   * @param genericParameterTypes generic types of the parameters stored in the content\n-   * @return array of converted Java objects\n-   * @throws DataConverterException if conversion of the data passed as parameter failed for any\n-   *     reason.\n-   */\n-  Object[] arrayFromPayloads(\n-      Optional<Payloads> content, Class<?>[] parameterTypes, Type[] genericParameterTypes)\n-      throws DataConverterException;\n+  static Object[] arrayFromPayloads(\n+      DataConverter converter,\n+      Optional<Payloads> content,\n+      Class<?>[] parameterTypes,\n+      Type[] genericParameterTypes)\n+      throws DataConverterException {\n+    if (parameterTypes != null\n+        && (parameterTypes == null || parameterTypes.length != genericParameterTypes.length)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2ODc5MQ==", "bodyText": "good catch!", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463368791", "createdAt": "2020-07-31T02:11:12Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/common/converter/DataConverter.java", "diffHunk": "@@ -51,30 +53,56 @@ static DataConverter getDefaultInstance() {\n   Optional<Payloads> toPayloads(Object... values) throws DataConverterException;\n \n   /**\n-   * Implements conversion of a single value.\n+   * Implements conversion of an array of values of different types. Useful for deserializing\n+   * arguments of function invocations.\n    *\n-   * @param content Serialized value to convert to a Java object.\n+   * @param index index of the value in the payloads\n+   * @param content serialized value to convert to Java objects.\n    * @param parameterType type of the parameter stored in the content\n    * @param genericParameterType generic type of the parameter stored in the content\n    * @return converted Java object\n    * @throws DataConverterException if conversion of the data passed as parameter failed for any\n    *     reason.\n    */\n-  <T> T fromPayloads(Optional<Payloads> content, Class<T> parameterType, Type genericParameterType)\n+  <T> T fromPayloads(\n+      int index, Optional<Payloads> content, Class<T> parameterType, Type genericParameterType)\n       throws DataConverterException;\n \n-  /**\n-   * Implements conversion of an array of values of different types. Useful for deserializing\n-   * arguments of function invocations.\n-   *\n-   * @param content serialized value to convert to Java objects.\n-   * @param parameterTypes types of the parameters stored in the content\n-   * @param genericParameterTypes generic types of the parameters stored in the content\n-   * @return array of converted Java objects\n-   * @throws DataConverterException if conversion of the data passed as parameter failed for any\n-   *     reason.\n-   */\n-  Object[] arrayFromPayloads(\n-      Optional<Payloads> content, Class<?>[] parameterTypes, Type[] genericParameterTypes)\n-      throws DataConverterException;\n+  static Object[] arrayFromPayloads(\n+      DataConverter converter,\n+      Optional<Payloads> content,\n+      Class<?>[] parameterTypes,\n+      Type[] genericParameterTypes)\n+      throws DataConverterException {\n+    if (parameterTypes != null\n+        && (parameterTypes == null || parameterTypes.length != genericParameterTypes.length)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2Mjg1NQ=="}, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MzA1MTM3OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/common/converter/DataConverter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMTo1MDoyOFrOG55e8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjoxMTo1OVrOG55zCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2MzgyNw==", "bodyText": "what if the count of payloads is much greater than that of the parameters? Basically does the user need to know that they are missing out on some payloads? Or is this well understood?", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463363827", "createdAt": "2020-07-31T01:50:28Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/common/converter/DataConverter.java", "diffHunk": "@@ -51,30 +53,56 @@ static DataConverter getDefaultInstance() {\n   Optional<Payloads> toPayloads(Object... values) throws DataConverterException;\n \n   /**\n-   * Implements conversion of a single value.\n+   * Implements conversion of an array of values of different types. Useful for deserializing\n+   * arguments of function invocations.\n    *\n-   * @param content Serialized value to convert to a Java object.\n+   * @param index index of the value in the payloads\n+   * @param content serialized value to convert to Java objects.\n    * @param parameterType type of the parameter stored in the content\n    * @param genericParameterType generic type of the parameter stored in the content\n    * @return converted Java object\n    * @throws DataConverterException if conversion of the data passed as parameter failed for any\n    *     reason.\n    */\n-  <T> T fromPayloads(Optional<Payloads> content, Class<T> parameterType, Type genericParameterType)\n+  <T> T fromPayloads(\n+      int index, Optional<Payloads> content, Class<T> parameterType, Type genericParameterType)\n       throws DataConverterException;\n \n-  /**\n-   * Implements conversion of an array of values of different types. Useful for deserializing\n-   * arguments of function invocations.\n-   *\n-   * @param content serialized value to convert to Java objects.\n-   * @param parameterTypes types of the parameters stored in the content\n-   * @param genericParameterTypes generic types of the parameters stored in the content\n-   * @return array of converted Java objects\n-   * @throws DataConverterException if conversion of the data passed as parameter failed for any\n-   *     reason.\n-   */\n-  Object[] arrayFromPayloads(\n-      Optional<Payloads> content, Class<?>[] parameterTypes, Type[] genericParameterTypes)\n-      throws DataConverterException;\n+  static Object[] arrayFromPayloads(\n+      DataConverter converter,\n+      Optional<Payloads> content,\n+      Class<?>[] parameterTypes,\n+      Type[] genericParameterTypes)\n+      throws DataConverterException {\n+    if (parameterTypes != null\n+        && (parameterTypes == null || parameterTypes.length != genericParameterTypes.length)) {\n+      throw new IllegalArgumentException(\n+          \"parameterTypes don't match length of valueTypes: \"\n+              + Arrays.toString(parameterTypes)\n+              + \"<>\"\n+              + Arrays.toString(genericParameterTypes));\n+    }\n+\n+    int length = parameterTypes.length;\n+    Object[] result = new Object[length];\n+    if (!content.isPresent()) {\n+      // Return defaults for all the parameters\n+      for (int i = 0; i < parameterTypes.length; i++) {\n+        result[i] = Defaults.defaultValue((Class<?>) genericParameterTypes[i]);\n+      }\n+      return result;\n+    }\n+    Payloads payloads = content.get();\n+    int count = payloads.getPayloadsCount();\n+    for (int i = 0; i < parameterTypes.length; i++) {\n+      Class<?> pt = parameterTypes[i];\n+      Type gt = genericParameterTypes[i];\n+      if (i >= count) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2ODk3MQ==", "bodyText": "Good question. The current answer is that it is needed to be able to add and remove arguments of functions.", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463368971", "createdAt": "2020-07-31T02:11:59Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/common/converter/DataConverter.java", "diffHunk": "@@ -51,30 +53,56 @@ static DataConverter getDefaultInstance() {\n   Optional<Payloads> toPayloads(Object... values) throws DataConverterException;\n \n   /**\n-   * Implements conversion of a single value.\n+   * Implements conversion of an array of values of different types. Useful for deserializing\n+   * arguments of function invocations.\n    *\n-   * @param content Serialized value to convert to a Java object.\n+   * @param index index of the value in the payloads\n+   * @param content serialized value to convert to Java objects.\n    * @param parameterType type of the parameter stored in the content\n    * @param genericParameterType generic type of the parameter stored in the content\n    * @return converted Java object\n    * @throws DataConverterException if conversion of the data passed as parameter failed for any\n    *     reason.\n    */\n-  <T> T fromPayloads(Optional<Payloads> content, Class<T> parameterType, Type genericParameterType)\n+  <T> T fromPayloads(\n+      int index, Optional<Payloads> content, Class<T> parameterType, Type genericParameterType)\n       throws DataConverterException;\n \n-  /**\n-   * Implements conversion of an array of values of different types. Useful for deserializing\n-   * arguments of function invocations.\n-   *\n-   * @param content serialized value to convert to Java objects.\n-   * @param parameterTypes types of the parameters stored in the content\n-   * @param genericParameterTypes generic types of the parameters stored in the content\n-   * @return array of converted Java objects\n-   * @throws DataConverterException if conversion of the data passed as parameter failed for any\n-   *     reason.\n-   */\n-  Object[] arrayFromPayloads(\n-      Optional<Payloads> content, Class<?>[] parameterTypes, Type[] genericParameterTypes)\n-      throws DataConverterException;\n+  static Object[] arrayFromPayloads(\n+      DataConverter converter,\n+      Optional<Payloads> content,\n+      Class<?>[] parameterTypes,\n+      Type[] genericParameterTypes)\n+      throws DataConverterException {\n+    if (parameterTypes != null\n+        && (parameterTypes == null || parameterTypes.length != genericParameterTypes.length)) {\n+      throw new IllegalArgumentException(\n+          \"parameterTypes don't match length of valueTypes: \"\n+              + Arrays.toString(parameterTypes)\n+              + \"<>\"\n+              + Arrays.toString(genericParameterTypes));\n+    }\n+\n+    int length = parameterTypes.length;\n+    Object[] result = new Object[length];\n+    if (!content.isPresent()) {\n+      // Return defaults for all the parameters\n+      for (int i = 0; i < parameterTypes.length; i++) {\n+        result[i] = Defaults.defaultValue((Class<?>) genericParameterTypes[i]);\n+      }\n+      return result;\n+    }\n+    Payloads payloads = content.get();\n+    int count = payloads.getPayloadsCount();\n+    for (int i = 0; i < parameterTypes.length; i++) {\n+      Class<?> pt = parameterTypes[i];\n+      Type gt = genericParameterTypes[i];\n+      if (i >= count) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2MzgyNw=="}, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MzA2MDEwOnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/common/converter/EncodedValues.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMTo1NjowN1rOG55kOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjoxMzoxM1rOG550Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2NTE3Nw==", "bodyText": "we are guaranteed that at least one of values / payloads is not null right? Basically, values and payloads cannot both be null because (Object... values) guarantees values is at least of length 0 if that constructor is used?", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463365177", "createdAt": "2020-07-31T01:56:07Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/common/converter/EncodedValues.java", "diffHunk": "@@ -58,22 +58,35 @@ public void setDataConverter(DataConverter converter) {\n   }\n \n   @Override\n-  public <T> T get(Class<T> parameterType) throws DataConverterException {\n-    if (value != null) {\n-      @SuppressWarnings(\"unchecked\")\n-      T result = (T) value.orElse(null);\n-      return result;\n+  public int getSize() {\n+    if (values != null) {\n+      return values.length;\n     } else {\n-      if (converter == null) {\n-        throw new IllegalStateException(\"converter not set\");\n+      if (payloads.isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2OTI2Mw==", "bodyText": "In a lot of cases, Payloads are not set at all if there are no any values. But we probably need to audit for this.", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463369263", "createdAt": "2020-07-31T02:13:13Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/common/converter/EncodedValues.java", "diffHunk": "@@ -58,22 +58,35 @@ public void setDataConverter(DataConverter converter) {\n   }\n \n   @Override\n-  public <T> T get(Class<T> parameterType) throws DataConverterException {\n-    if (value != null) {\n-      @SuppressWarnings(\"unchecked\")\n-      T result = (T) value.orElse(null);\n-      return result;\n+  public int getSize() {\n+    if (values != null) {\n+      return values.length;\n     } else {\n-      if (converter == null) {\n-        throw new IllegalStateException(\"converter not set\");\n+      if (payloads.isPresent()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2NTE3Nw=="}, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MzA2NDU5OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/common/converter/EncodedValues.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMTo1OToxM1rOG55nFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjoxNTowNFrOG5518w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2NTkwOA==", "bodyText": "No need to initialize / cache the converted object into the values array right?", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463365908", "createdAt": "2020-07-31T01:59:13Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/common/converter/EncodedValues.java", "diffHunk": "@@ -58,22 +58,35 @@ public void setDataConverter(DataConverter converter) {\n   }\n \n   @Override\n-  public <T> T get(Class<T> parameterType) throws DataConverterException {\n-    if (value != null) {\n-      @SuppressWarnings(\"unchecked\")\n-      T result = (T) value.orElse(null);\n-      return result;\n+  public int getSize() {\n+    if (values != null) {\n+      return values.length;\n     } else {\n-      if (converter == null) {\n-        throw new IllegalStateException(\"converter not set\");\n+      if (payloads.isPresent()) {\n+        return payloads.get().getPayloadsCount();\n+      } else {\n+        return 0;\n       }\n-      return converter.fromPayloads(payloads, parameterType, parameterType);\n     }\n   }\n \n   @Override\n-  public <T> T get(Class<T> parameterType, Type genericParameterType)\n+  public <T> T get(int index, Class<T> parameterType) throws DataConverterException {\n+    return get(index, parameterType, parameterType);\n+  }\n+\n+  @Override\n+  public <T> T get(int index, Class<T> parameterType, Type genericParameterType)\n       throws DataConverterException {\n-    return converter.fromPayloads(payloads, parameterType, genericParameterType);\n+    if (values != null) {\n+      @SuppressWarnings(\"unchecked\")\n+      T result = (T) values[index];\n+      return result;\n+    } else {\n+      if (converter == null) {\n+        throw new IllegalStateException(\"converter not set\");\n+      }\n+      return converter.fromPayloads(index, payloads, parameterType, genericParameterType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2OTcxNQ==", "bodyText": "The idea of Values is that it can be created with objects or Payloads. I'm not sure if caching is really going to help here as every value accessed only once I believe.", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463369715", "createdAt": "2020-07-31T02:15:04Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/common/converter/EncodedValues.java", "diffHunk": "@@ -58,22 +58,35 @@ public void setDataConverter(DataConverter converter) {\n   }\n \n   @Override\n-  public <T> T get(Class<T> parameterType) throws DataConverterException {\n-    if (value != null) {\n-      @SuppressWarnings(\"unchecked\")\n-      T result = (T) value.orElse(null);\n-      return result;\n+  public int getSize() {\n+    if (values != null) {\n+      return values.length;\n     } else {\n-      if (converter == null) {\n-        throw new IllegalStateException(\"converter not set\");\n+      if (payloads.isPresent()) {\n+        return payloads.get().getPayloadsCount();\n+      } else {\n+        return 0;\n       }\n-      return converter.fromPayloads(payloads, parameterType, parameterType);\n     }\n   }\n \n   @Override\n-  public <T> T get(Class<T> parameterType, Type genericParameterType)\n+  public <T> T get(int index, Class<T> parameterType) throws DataConverterException {\n+    return get(index, parameterType, parameterType);\n+  }\n+\n+  @Override\n+  public <T> T get(int index, Class<T> parameterType, Type genericParameterType)\n       throws DataConverterException {\n-    return converter.fromPayloads(payloads, parameterType, genericParameterType);\n+    if (values != null) {\n+      @SuppressWarnings(\"unchecked\")\n+      T result = (T) values[index];\n+      return result;\n+    } else {\n+      if (converter == null) {\n+        throw new IllegalStateException(\"converter not set\");\n+      }\n+      return converter.fromPayloads(index, payloads, parameterType, genericParameterType);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2NTkwOA=="}, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MzA2ODc1OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/failure/ApplicationFailure.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjowMTo0NlrOG55plQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjoyNjozMlrOG56BAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2NjU0OQ==", "bodyText": "didn't quite follow the 2nd sentence of this comment. did you mean to say if the type is NOT included", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463366549", "createdAt": "2020-07-31T02:01:46Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/failure/ApplicationFailure.java", "diffHunk": "@@ -51,49 +51,47 @@\n  */\n public final class ApplicationFailure extends TemporalFailure {\n   private final String type;\n-  private final Value details;\n+  private final Values details;\n   private boolean nonRetryable;\n \n   /**\n+   * New ApplicationFailure with {@link #isNonRetryable()} flag set to false. Note that this", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM3MjU0Ng==", "bodyText": "Good catch.", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463372546", "createdAt": "2020-07-31T02:26:32Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/failure/ApplicationFailure.java", "diffHunk": "@@ -51,49 +51,47 @@\n  */\n public final class ApplicationFailure extends TemporalFailure {\n   private final String type;\n-  private final Value details;\n+  private final Values details;\n   private boolean nonRetryable;\n \n   /**\n+   * New ApplicationFailure with {@link #isNonRetryable()} flag set to false. Note that this", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2NjU0OQ=="}, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MzA3MTI0OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/failure/ApplicationFailure.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjowMzowOVrOG55q-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjoyNzoxOFrOG56Bvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2NjkwNg==", "bodyText": "why not just call it newRetryableFailure?", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463366906", "createdAt": "2020-07-31T02:03:09Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/failure/ApplicationFailure.java", "diffHunk": "@@ -51,49 +51,47 @@\n  */\n public final class ApplicationFailure extends TemporalFailure {\n   private final String type;\n-  private final Value details;\n+  private final Values details;\n   private boolean nonRetryable;\n \n   /**\n+   * New ApplicationFailure with {@link #isNonRetryable()} flag set to false. Note that this\n+   * exception still can be retried by the service if its type is included into doNotRetry property\n+   * of the correspondent retry policy.\n+   *\n    * @param message optional error message\n    * @param type optional error type that is used by {@link\n    *     io.temporal.common.RetryOptions#addDoNotRetry(String...)}.\n    * @param details optional details about the failure. They are serialized using the same approach\n-   *     as arguments and results and can be accessed through {@link #getDetails()}\n-   * @param cause failure cause. Each element of the cause chain is converted to ApplicationFailure\n-   *     if it doesn't extend {@link TemporalFailure}.\n+   *     as arguments and results.\n    */\n-  public ApplicationFailure(String message, String type, Object details, Exception cause) {\n-    this(message, type, new EncodedValue(details), false, cause);\n+  public static ApplicationFailure newFailure(String message, String type, Object... details) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM3MjczNA==", "bodyText": "I called it initially. But then I found that it is very confusing that it can be not retried if the policy says so.", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463372734", "createdAt": "2020-07-31T02:27:18Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/failure/ApplicationFailure.java", "diffHunk": "@@ -51,49 +51,47 @@\n  */\n public final class ApplicationFailure extends TemporalFailure {\n   private final String type;\n-  private final Value details;\n+  private final Values details;\n   private boolean nonRetryable;\n \n   /**\n+   * New ApplicationFailure with {@link #isNonRetryable()} flag set to false. Note that this\n+   * exception still can be retried by the service if its type is included into doNotRetry property\n+   * of the correspondent retry policy.\n+   *\n    * @param message optional error message\n    * @param type optional error type that is used by {@link\n    *     io.temporal.common.RetryOptions#addDoNotRetry(String...)}.\n    * @param details optional details about the failure. They are serialized using the same approach\n-   *     as arguments and results and can be accessed through {@link #getDetails()}\n-   * @param cause failure cause. Each element of the cause chain is converted to ApplicationFailure\n-   *     if it doesn't extend {@link TemporalFailure}.\n+   *     as arguments and results.\n    */\n-  public ApplicationFailure(String message, String type, Object details, Exception cause) {\n-    this(message, type, new EncodedValue(details), false, cause);\n+  public static ApplicationFailure newFailure(String message, String type, Object... details) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2NjkwNg=="}, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MzA3MjM3OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/failure/ApplicationFailure.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjowMzo1MVrOG55rnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjozMDoyOVrOG56EuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2NzA2OQ==", "bodyText": "[Nit], having boolean names that are negative (nonRetryable vs retryable) can be kind of confusing", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463367069", "createdAt": "2020-07-31T02:03:51Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/failure/ApplicationFailure.java", "diffHunk": "@@ -51,49 +51,47 @@\n  */\n public final class ApplicationFailure extends TemporalFailure {\n   private final String type;\n-  private final Value details;\n+  private final Values details;\n   private boolean nonRetryable;\n \n   /**\n+   * New ApplicationFailure with {@link #isNonRetryable()} flag set to false. Note that this\n+   * exception still can be retried by the service if its type is included into doNotRetry property\n+   * of the correspondent retry policy.\n+   *\n    * @param message optional error message\n    * @param type optional error type that is used by {@link\n    *     io.temporal.common.RetryOptions#addDoNotRetry(String...)}.\n    * @param details optional details about the failure. They are serialized using the same approach\n-   *     as arguments and results and can be accessed through {@link #getDetails()}\n-   * @param cause failure cause. Each element of the cause chain is converted to ApplicationFailure\n-   *     if it doesn't extend {@link TemporalFailure}.\n+   *     as arguments and results.\n    */\n-  public ApplicationFailure(String message, String type, Object details, Exception cause) {\n-    this(message, type, new EncodedValue(details), false, cause);\n+  public static ApplicationFailure newFailure(String message, String type, Object... details) {\n+    return new ApplicationFailure(message, type, false, new EncodedValues(details), null);\n   }\n \n   /**\n+   * New ApplicationFailure with {@link #isNonRetryable()} flag set to true.\n+   *\n+   * <p>It means that this exception is not going to be retried even if it is not included into\n+   * retry policy doNotRetry list.\n+   *\n    * @param message optional error message\n-   * @param type optional error type that is used by {@link\n-   *     io.temporal.common.RetryOptions#addDoNotRetry(String...)}.\n+   * @param type optional error type\n    * @param details optional details about the failure. They are serialized using the same approach\n    *     as arguments and results.\n    */\n-  public ApplicationFailure(String message, String type, Object details) {\n-    this(message, type, new EncodedValue(details), false, null);\n-  }\n-\n-  /**\n-   * @param message optional error message\n-   * @param type optional error type that is used by {@link\n-   *     io.temporal.common.RetryOptions#addDoNotRetry(String...)}.\n-   */\n-  public ApplicationFailure(String message, String type) {\n-    this(message, type, new EncodedValue(null), false, null);\n+  public static ApplicationFailure newNonRetryableFailure(\n+      String message, String type, Object... details) {\n+    return new ApplicationFailure(message, type, true, new EncodedValues(details), null);\n   }\n \n-  /** * @param message optional error message */\n-  public ApplicationFailure(String message) {\n-    this(message, null);\n+  static ApplicationFailure newFromValues(\n+      String message, String type, boolean nonRetryable, Values details, Throwable cause) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM3MzQ5Nw==", "bodyText": "I almost always follow the pattern that the default value should be the default value for the type. So the default of the boolean type is false. So the field is called nonRetryable as its default is false. But I agree that it looks weird in the parameter name.", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463373497", "createdAt": "2020-07-31T02:30:29Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/failure/ApplicationFailure.java", "diffHunk": "@@ -51,49 +51,47 @@\n  */\n public final class ApplicationFailure extends TemporalFailure {\n   private final String type;\n-  private final Value details;\n+  private final Values details;\n   private boolean nonRetryable;\n \n   /**\n+   * New ApplicationFailure with {@link #isNonRetryable()} flag set to false. Note that this\n+   * exception still can be retried by the service if its type is included into doNotRetry property\n+   * of the correspondent retry policy.\n+   *\n    * @param message optional error message\n    * @param type optional error type that is used by {@link\n    *     io.temporal.common.RetryOptions#addDoNotRetry(String...)}.\n    * @param details optional details about the failure. They are serialized using the same approach\n-   *     as arguments and results and can be accessed through {@link #getDetails()}\n-   * @param cause failure cause. Each element of the cause chain is converted to ApplicationFailure\n-   *     if it doesn't extend {@link TemporalFailure}.\n+   *     as arguments and results.\n    */\n-  public ApplicationFailure(String message, String type, Object details, Exception cause) {\n-    this(message, type, new EncodedValue(details), false, cause);\n+  public static ApplicationFailure newFailure(String message, String type, Object... details) {\n+    return new ApplicationFailure(message, type, false, new EncodedValues(details), null);\n   }\n \n   /**\n+   * New ApplicationFailure with {@link #isNonRetryable()} flag set to true.\n+   *\n+   * <p>It means that this exception is not going to be retried even if it is not included into\n+   * retry policy doNotRetry list.\n+   *\n    * @param message optional error message\n-   * @param type optional error type that is used by {@link\n-   *     io.temporal.common.RetryOptions#addDoNotRetry(String...)}.\n+   * @param type optional error type\n    * @param details optional details about the failure. They are serialized using the same approach\n    *     as arguments and results.\n    */\n-  public ApplicationFailure(String message, String type, Object details) {\n-    this(message, type, new EncodedValue(details), false, null);\n-  }\n-\n-  /**\n-   * @param message optional error message\n-   * @param type optional error type that is used by {@link\n-   *     io.temporal.common.RetryOptions#addDoNotRetry(String...)}.\n-   */\n-  public ApplicationFailure(String message, String type) {\n-    this(message, type, new EncodedValue(null), false, null);\n+  public static ApplicationFailure newNonRetryableFailure(\n+      String message, String type, Object... details) {\n+    return new ApplicationFailure(message, type, true, new EncodedValues(details), null);\n   }\n \n-  /** * @param message optional error message */\n-  public ApplicationFailure(String message) {\n-    this(message, null);\n+  static ApplicationFailure newFromValues(\n+      String message, String type, boolean nonRetryable, Values details, Throwable cause) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2NzA2OQ=="}, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MzA3NDkxOnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/internal/sync/ActivityExecutionContextImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjowNToyNFrOG55tHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjozMzo0N1rOG56H_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2NzQ1NA==", "bodyText": "we didn't want this function to have an overload without the index that internally assumes the first element? seems painful to pass in 0 every time", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463367454", "createdAt": "2020-07-31T02:05:24Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/internal/sync/ActivityExecutionContextImpl.java", "diffHunk": "@@ -130,7 +130,7 @@\n         return result;\n       }\n       Optional<Payloads> details = info.getHeartbeatDetails();\n-      return Optional.ofNullable(dataConverter.fromPayloads(details, detailsClass, detailsType));\n+      return Optional.ofNullable(dataConverter.fromPayloads(0, details, detailsClass, detailsType));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM3NDMzNQ==", "bodyText": "This class is used only internally by the SDK, so I think having an explicit index makes sense to indicate that it can hold multiple values.", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463374335", "createdAt": "2020-07-31T02:33:47Z", "author": {"login": "mfateev"}, "path": "src/main/java/io/temporal/internal/sync/ActivityExecutionContextImpl.java", "diffHunk": "@@ -130,7 +130,7 @@\n         return result;\n       }\n       Optional<Payloads> details = info.getHeartbeatDetails();\n-      return Optional.ofNullable(dataConverter.fromPayloads(details, detailsClass, detailsType));\n+      return Optional.ofNullable(dataConverter.fromPayloads(0, details, detailsClass, detailsType));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2NzQ1NA=="}, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MzA3OTE5OnYy", "diffSide": "RIGHT", "path": "src/test/java/io/temporal/workflow/WorkflowTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjowODoxMlrOG55vkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjozNTozNlrOG56J8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2ODA4Mw==", "bodyText": "and we still have a test that validates get without the index specified works fine?", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463368083", "createdAt": "2020-07-31T02:08:12Z", "author": {"login": "mastermanu"}, "path": "src/test/java/io/temporal/workflow/WorkflowTest.java", "diffHunk": "@@ -3995,7 +3996,10 @@ public void testWorkflowFailureNonRetryableFlag() {\n     } catch (WorkflowException e) {\n       assertTrue(e.getCause() instanceof ApplicationFailure);\n       assertEquals(\"foo\", ((ApplicationFailure) e.getCause()).getType());\n-      assertEquals(\"details\", ((ApplicationFailure) e.getCause()).getDetails().get(String.class));\n+      assertEquals(\n+          \"details1\", ((ApplicationFailure) e.getCause()).getDetails().get(0, String.class));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM3NDgzMg==", "bodyText": "I checked and found at least two unit tests that call it.", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463374832", "createdAt": "2020-07-31T02:35:36Z", "author": {"login": "mfateev"}, "path": "src/test/java/io/temporal/workflow/WorkflowTest.java", "diffHunk": "@@ -3995,7 +3996,10 @@ public void testWorkflowFailureNonRetryableFlag() {\n     } catch (WorkflowException e) {\n       assertTrue(e.getCause() instanceof ApplicationFailure);\n       assertEquals(\"foo\", ((ApplicationFailure) e.getCause()).getType());\n-      assertEquals(\"details\", ((ApplicationFailure) e.getCause()).getDetails().get(String.class));\n+      assertEquals(\n+          \"details1\", ((ApplicationFailure) e.getCause()).getDetails().get(0, String.class));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2ODA4Mw=="}, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5MzA4NjA2OnYy", "diffSide": "RIGHT", "path": "src/main/java/io/temporal/common/converter/EncodedValues.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjoxMjo0MlrOG55zrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMjoxMjo0MlrOG55zrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM2OTEzMw==", "bodyText": "if the user exceeds the bounds of the values/payload, no issues right?", "url": "https://github.com/temporalio/sdk-java/pull/164#discussion_r463369133", "createdAt": "2020-07-31T02:12:42Z", "author": {"login": "mastermanu"}, "path": "src/main/java/io/temporal/common/converter/EncodedValues.java", "diffHunk": "@@ -58,22 +58,35 @@ public void setDataConverter(DataConverter converter) {\n   }\n \n   @Override\n-  public <T> T get(Class<T> parameterType) throws DataConverterException {\n-    if (value != null) {\n-      @SuppressWarnings(\"unchecked\")\n-      T result = (T) value.orElse(null);\n-      return result;\n+  public int getSize() {\n+    if (values != null) {\n+      return values.length;\n     } else {\n-      if (converter == null) {\n-        throw new IllegalStateException(\"converter not set\");\n+      if (payloads.isPresent()) {\n+        return payloads.get().getPayloadsCount();\n+      } else {\n+        return 0;\n       }\n-      return converter.fromPayloads(payloads, parameterType, parameterType);\n     }\n   }\n \n   @Override\n-  public <T> T get(Class<T> parameterType, Type genericParameterType)\n+  public <T> T get(int index, Class<T> parameterType) throws DataConverterException {\n+    return get(index, parameterType, parameterType);\n+  }\n+\n+  @Override\n+  public <T> T get(int index, Class<T> parameterType, Type genericParameterType)\n       throws DataConverterException {\n-    return converter.fromPayloads(payloads, parameterType, genericParameterType);\n+    if (values != null) {\n+      @SuppressWarnings(\"unchecked\")\n+      T result = (T) values[index];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e39d1fb78153dcd2e2c161b93d0090a7d64ac377"}, "originalPosition": 75}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1715, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}