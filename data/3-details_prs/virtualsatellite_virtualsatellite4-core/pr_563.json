{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5MDY4NTkw", "number": 563, "title": "Improve editing domain's handling of Non-DVLM Models ", "bodyText": "Closes #562\nCurrently the transactional builders save all resources in the resource set after building. The equation and inheritance builder (and also the ResourceChangeListner) however ignore non-dvlm changes and thus then overwrite external changes. As it makes sense that equation + inheritance builder only work with DVLM resources and it also make sense that the saveAll() on the TransationalEditingDomain saves all resources, I added an option to only save DVLM resources which can be used from builders.\n\nAdd a saveAll option to only save DVLM resources in the editing domain\nAdd option in transactional builders to uses this new saveAll option\nif the builder only works with DVLM resources\nUpdate inheritance and equation builder to only save DVLM resources\n-Update resource change listner to also handle changes of non-dvlm files", "createdAt": "2020-04-05T12:56:12Z", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/563", "merged": true, "mergeCommit": {"oid": "c3611ff9f89897ff30bbd38d3ef921e2a9d04d04"}, "closed": true, "closedAt": "2020-04-16T12:55:24Z", "author": {"login": "franzTobiasDLR"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUplGgAH2gAyMzk5MDY4NTkwOjdmZDNhOTkxNTliZjE3NDNhZjZkNTFkZWU2OWY3YWI2ODk0ZWMzMzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYLWThgFqTM5NDU1Njg5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7fd3a99159bf1743af6d51dee69f7ab6894ec332", "author": {"user": {"login": "franzTobiasDLR", "name": null}}, "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/7fd3a99159bf1743af6d51dee69f7ab6894ec332", "committedDate": "2020-04-05T12:51:12Z", "message": "Add save all option to only save DVLM resources from builders\n\n- Add a option to only save DVLM resources in the editing domain\n- Add option in transactional builders to uses this new saveAll option\nif the builder only works with DVLM resources\n- Update inheritance and equation builder to only save DVLM resources"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efe073ef1deb5a1032a6ec5e7689d88a9dcc6309", "author": {"user": {"login": "franzTobiasDLR", "name": null}}, "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/efe073ef1deb5a1032a6ec5e7689d88a9dcc6309", "committedDate": "2020-04-06T06:48:57Z", "message": "Make default behavior to not save non-DVLM resources - (Task #562)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a610e5b705d9c3f48ef5351fa19054edc98d724e", "author": {"user": {"login": "franzTobiasDLR", "name": null}}, "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/a610e5b705d9c3f48ef5351fa19054edc98d724e", "committedDate": "2020-04-06T06:58:58Z", "message": "Add documentation for new saveAll option - (Task #562)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMDI4OTEy", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/563#pullrequestreview-390028912", "createdAt": "2020-04-08T14:28:29Z", "commit": {"oid": "a610e5b705d9c3f48ef5351fa19054edc98d724e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "625fff01372ebe69047206a60974aac21e4b95ec", "author": {"user": {"login": "franzTobiasDLR", "name": null}}, "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/625fff01372ebe69047206a60974aac21e4b95ec", "committedDate": "2020-04-09T16:30:55Z", "message": "Add handling of non-dvlm changes - (Task #562)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bf5cc0cc10787bfb185bc608cf46e3ca584b047", "author": {"user": {"login": "franzTobiasDLR", "name": null}}, "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/6bf5cc0cc10787bfb185bc608cf46e3ca584b047", "committedDate": "2020-04-09T16:49:06Z", "message": "Some minor refactorings - (Task #562)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7e6f739a778a8635f352d00cb54c9bd005fffb8", "author": {"user": {"login": "franzTobiasDLR", "name": null}}, "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/d7e6f739a778a8635f352d00cb54c9bd005fffb8", "committedDate": "2020-04-11T22:29:17Z", "message": "Merge remote-tracking branch 'origin/development' into feature/task_562-Inconsistency_builders_save_non_dvlm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cdcb9af5ddd69bf76992017481e67b24cd5873b", "author": {"user": {"login": "franzTobiasDLR", "name": null}}, "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/9cdcb9af5ddd69bf76992017481e67b24cd5873b", "committedDate": "2020-04-13T23:28:12Z", "message": "Add test for handling of external models - (Task #562)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNzQ5MjU3", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/563#pullrequestreview-393749257", "createdAt": "2020-04-15T13:00:42Z", "commit": {"oid": "9cdcb9af5ddd69bf76992017481e67b24cd5873b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMzowMDo0MlrOGF4i2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNjowOTowNlrOGGBECg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODgyMjQ4OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\t\tif (!dvlmResourcesOnly || (dvlmResourcesOnly && fileIsDVLMResource)) {\n          \n          \n            \n            \t\t\t\t\t\tif (fileIsDVLMResource || !dvlmResourcesOnly) {", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/563#discussion_r408822488", "createdAt": "2020-04-15T13:00:42Z", "author": {"login": "andriikovalov-dlr"}, "path": "de.dlr.sc.virsat.project/src/de/dlr/sc/virsat/project/editingDomain/VirSatTransactionalEditingDomain.java", "diffHunk": "@@ -357,9 +356,12 @@ public void saveAll(boolean supressRemoveDanglingReferences) {\n \t\t\t\tthis.writeExclusive(() -> {\r\n \t\t\t\t\tList<Resource> resources = new ArrayList<Resource>(virSatResourceSet.getResources());\r\n \t\t\t\t\tfor (Resource resource : resources) {\r\n-\t\t\t\t\t\tsaveResource(resource, supressRemoveDanglingReferences);\r\n-\t\t\t\t\t\tvirSatResourceSet.updateDiagnostic(resource);\r\n-\t\t\t\t\t\tvirSatResourceSet.notifyDiagnosticListeners(resource);\r\n+\t\t\t\t\t\tboolean fileIsDVLMResource = VirSatProjectCommons.FILENAME_EXTENSION.equalsIgnoreCase(resource.getURI().fileExtension());\r\n+\t\t\t\t\t\tif (!dvlmResourcesOnly || (dvlmResourcesOnly && fileIsDVLMResource)) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cdcb9af5ddd69bf76992017481e67b24cd5873b"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODk2MjA1OA==", "bodyText": "Let's move repetitive code into a method like doExternalChange()", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/563#discussion_r408962058", "createdAt": "2020-04-15T16:09:06Z", "author": {"login": "andriikovalov-dlr"}, "path": "de.dlr.sc.virsat.model.extension.tests.test/src/de/dlr/sc/virsat/project/editingDomain/VirSatTransactionalEditingDomainNonDVLMTest.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*******************************************************************************\n+ * Copyright (c) 2008-2019 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package de.dlr.sc.virsat.project.editingDomain;\n+\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+\n+import java.io.IOException;\n+import java.util.Collections;\n+\n+import org.eclipse.core.resources.IFile;\n+import org.eclipse.core.runtime.CoreException;\n+import org.eclipse.emf.ecore.resource.Resource;\n+import org.eclipse.emf.ecore.resource.ResourceSet;\n+import org.eclipse.emf.transaction.RecordingCommand;\n+import org.eclipse.emf.transaction.TransactionalEditingDomain;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\n+import de.dlr.sc.virsat.model.extension.tests.model.TestStructuralElement;\n+import de.dlr.sc.virsat.model.extension.tests.test.ATestConceptTestCase;\n+import de.dlr.sc.virsat.model.external.tests.Container;\n+import de.dlr.sc.virsat.model.external.tests.ExternalTestType;\n+import de.dlr.sc.virsat.model.external.tests.TestsFactory;\n+import de.dlr.sc.virsat.project.resources.command.CreateSeiResourceAndFileCommand;\n+\n+public class VirSatTransactionalEditingDomainNonDVLMTest extends ATestConceptTestCase {\n+\t\n+\tprivate static final String EXTERNAL_RESOURCE_NAME = \"test/ExternalModel.etests\";\n+\tprivate Resource externalModelResourceVirSatDomain;\n+\tprivate Container containerVirsatContext;\n+\tprivate IFile modelFile;\n+\t\n+\t\n+\t@Before\n+\tpublic void setUpModel() throws CoreException, IOException {\n+\t\tsuper.setUp();\n+\t\t\n+\t\t// Setup VirSat project context to also respect external changes\n+\t\taddEditingDomainAndRepository(true);\n+\t\texecuteAsCommand(() -> loadConceptAndInstallToRepository(CONCEPT_ID_CORE));\n+\t\texecuteAsCommand(() -> loadTestConcept());\n+\t\tTestStructuralElement tsei = new TestStructuralElement(testConcept);\n+\t\tStructuralElementInstance sei = tsei.getStructuralElementInstance();\n+\t\texecuteAsCommand(() -> repository.getRootEntities().add(sei));\n+\t\teditingDomain.getCommandStack().execute(new CreateSeiResourceAndFileCommand(rs, sei));\n+\t\t\n+\t\t// Create external model resource\n+\t\tmodelFile = testProject.getFile(EXTERNAL_RESOURCE_NAME);\n+\t\texternalModelResourceVirSatDomain = rs.safeGetResource(modelFile, true);\n+\t\t\n+\t\t// Create external model content\n+\t\tcontainerVirsatContext = TestsFactory.eINSTANCE.createContainer();\n+\t\texecuteAsCommand(() -> externalModelResourceVirSatDomain.getContents().add(containerVirsatContext));\n+\t\texternalModelResourceVirSatDomain.save(Collections.emptyMap());\n+\t}\n+\t\n+\t@Test\n+\tpublic void testSaveAll() throws IOException {\n+\t\t// Do some external changes\n+\t\tTransactionalEditingDomain externalEditingDomain = TransactionalEditingDomain.Factory.INSTANCE.createEditingDomain();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cdcb9af5ddd69bf76992017481e67b24cd5873b"}, "originalPosition": 70}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b56459fa23815fb4d74f8818390f19ffcb0603ea", "author": {"user": {"login": "franzTobiasDLR", "name": null}}, "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/b56459fa23815fb4d74f8818390f19ffcb0603ea", "committedDate": "2020-04-16T10:06:06Z", "message": "Update de.dlr.sc.virsat.project/src/de/dlr/sc/virsat/project/editingDomain/VirSatTransactionalEditingDomain.java\n\nCo-Authored-By: andriikovalov-dlr <48556822+andriikovalov-dlr@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69f18e1038050720e8ffdc20b11b7e82cb01858c", "author": {"user": {"login": "franzTobiasDLR", "name": null}}, "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/69f18e1038050720e8ffdc20b11b7e82cb01858c", "committedDate": "2020-04-16T11:44:19Z", "message": "Move external change to dedicated model - (Task #562)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NTU2ODkw", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/563#pullrequestreview-394556890", "createdAt": "2020-04-16T11:53:35Z", "commit": {"oid": "69f18e1038050720e8ffdc20b11b7e82cb01858c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 642, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}