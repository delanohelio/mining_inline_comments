{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyMzMxMDA2", "number": 265, "title": "HH-117779 decrease hikari validationTimeout", "bodyText": "https://jira.hh.ru/browse/HH-117779\n\u0423\u043c\u0435\u043d\u044c\u0448\u0438\u043b validationTimeout, \u0447\u0442\u043e\u0431\u044b \u0435\u0441\u043b\u0438 \u043f\u0435\u0440\u0432\u043e\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u043e\u043a\u0430\u0437\u0430\u043b\u043e\u0441\u044c \u0434\u043e\u0445\u043b\u044b\u043c, \u0431\u044b\u043b\u043e \u0435\u0449\u0451 \u043d\u0435\u043c\u043d\u043e\u0433\u043e \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0443\u0441\u043f\u0435\u0442\u044c \u043f\u043e\u043f\u044b\u0442\u0430\u0442\u044c\u0441\u044f \u0432\u0437\u044f\u0442\u044c \u0434\u0440\u0443\u0433\u043e\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435.", "createdAt": "2020-10-13T13:42:46Z", "url": "https://github.com/hhru/nuts-and-bolts/pull/265", "merged": true, "mergeCommit": {"oid": "ad69e3ed5306fba09f1033dad4464c00d58a0e32"}, "closed": true, "closedAt": "2020-10-15T07:54:06Z", "author": {"login": "Powerrr"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSI0mdAH2gAyNTAyMzMxMDA2OjFjYmEyMzFhNmZjNjBlNzRlOGIxNGU0NDE4OGE0MzViNDU1NmYyY2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSJWH9gFqTUwNzQ4OTQwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1cba231a6fc60e74e8b14e44188a435b4556f2cd", "author": {"user": {"login": "Powerrr", "name": "Roman Kozlov"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/1cba231a6fc60e74e8b14e44188a435b4556f2cd", "committedDate": "2020-10-13T13:44:34Z", "message": "HH-117779 decrease hikari validationTimeout"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4b1660b4e9da5879c9ab00da5edeecf211d025ab", "author": {"user": {"login": "Powerrr", "name": "Roman Kozlov"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/4b1660b4e9da5879c9ab00da5edeecf211d025ab", "committedDate": "2020-10-13T13:22:22Z", "message": "HH-117779 decrease hicari validationTimeout"}, "afterCommit": {"oid": "1cba231a6fc60e74e8b14e44188a435b4556f2cd", "author": {"user": {"login": "Powerrr", "name": "Roman Kozlov"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/1cba231a6fc60e74e8b14e44188a435b4556f2cd", "committedDate": "2020-10-13T13:44:34Z", "message": "HH-117779 decrease hikari validationTimeout"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NDg5NDA4", "url": "https://github.com/hhru/nuts-and-bolts/pull/265#pullrequestreview-507489408", "createdAt": "2020-10-13T14:20:52Z", "commit": {"oid": "1cba231a6fc60e74e8b14e44188a435b4556f2cd"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNDoyMDo1M1rOHgpSAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNDoyMDo1M1rOHgpSAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk5MjgzNQ==", "bodyText": "\u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u044b \u0432 \u0445\u0438\u043a\u0430\u0440\u0438 \u043d\u0435\u0442?", "url": "https://github.com/hhru/nuts-and-bolts/pull/265#discussion_r503992835", "createdAt": "2020-10-13T14:20:53Z", "author": {"login": "dzharikhin"}, "path": "nab-data-source/src/main/java/ru/hh/nab/datasource/DataSourceFactory.java", "diffHunk": "@@ -72,7 +74,10 @@ private static HikariConfig createBaseHikariConfig(String dataSourceName, FileSe\n     config.setPassword(dataSourceSettings.getString(PASSWORD));\n     config.setPoolName(dataSourceName);\n     config.setReadOnly(false);\n-    config.setValidationTimeout(config.getConnectionTimeout() + DEFAULT_VALIDATION_TIMEOUT_INCREMENT_MS);\n+\n+    long validationTimeoutMs = Math.round(config.getConnectionTimeout() * DEFAULT_VALIDATION_TIMEOUT_RATIO);\n+    config.setValidationTimeout(Math.max(validationTimeoutMs, HIKARI_MIN_VALIDATION_TIMEOUT_MS));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cba231a6fc60e74e8b14e44188a435b4556f2cd"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3343, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}