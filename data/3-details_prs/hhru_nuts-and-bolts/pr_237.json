{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNzY1MTE4", "number": 237, "title": "HH-107064 cath IllegalArgumentException in JClientContextProviderFilter", "bodyText": "https://jira.hh.ru/browse/HH-107064", "createdAt": "2020-04-08T10:31:23Z", "url": "https://github.com/hhru/nuts-and-bolts/pull/237", "merged": true, "mergeCommit": {"oid": "f57e657c7a5bb2a6fcac7cb90159466691504153"}, "closed": true, "closedAt": "2020-04-08T13:00:19Z", "author": {"login": "genroelgvozo"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVlXbRAH2gAyNDAwNzY1MTE4OjU2ZTNiOTMyYzhmZmY1M2MxMmFmNzU3NGU2MjQ5Y2M4M2JlOTQ0YjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVnO_nAFqTM4OTkzNDcwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "56e3b932c8fff53c12af7574e6249cc83be944b2", "author": {"user": {"login": "genroelgvozo", "name": "Oleg Negrozov"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/56e3b932c8fff53c12af7574e6249cc83be944b2", "committedDate": "2020-04-08T10:30:34Z", "message": "HH-107064 cath IllegalArgumentException in JClientContextProviderFilter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5ODYxNjUy", "url": "https://github.com/hhru/nuts-and-bolts/pull/237#pullrequestreview-389861652", "createdAt": "2020-04-08T10:49:40Z", "commit": {"oid": "56e3b932c8fff53c12af7574e6249cc83be944b2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMDo0OTo0MFrOGCptrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMDo0OTo0MFrOGCptrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQzMzc3NA==", "bodyText": "\u0442\u0443\u0442 \u0442\u044b \u043b\u043e\u0432\u0438\u0448\u044c \u0438 \u0442\u043e, \u0447\u0442\u043e \u0432\u044b\u043b\u0435\u0442\u0438\u0442 \u0438\u0437 chain.doFilter(). \u043d\u0430\u0434\u043e \u0431\u043e\u043b\u0435\u0435 \u0443\u0437\u043a\u0438\u0439 try - \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430 getRequestHeadersMap() \u0438 getQueryParamsMap()", "url": "https://github.com/hhru/nuts-and-bolts/pull/237#discussion_r405433774", "createdAt": "2020-04-08T10:49:40Z", "author": {"login": "Powerrr"}, "path": "nab-jclient/src/main/java/ru/hh/nab/jclient/JClientContextProviderFilter.java", "diffHunk": "@@ -33,6 +34,8 @@ public void doFilter(ServletRequest request, ServletResponse response, FilterCha\n     try {\n       contextThreadLocalSupplier.addContext(getRequestHeadersMap(request), getQueryParamsMap(request));\n       chain.doFilter(request, response);\n+    } catch (IllegalArgumentException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56e3b932c8fff53c12af7574e6249cc83be944b2"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa8d09f500e2bad23463a3162993e4c9dc37ce59", "author": {"user": {"login": "genroelgvozo", "name": "Oleg Negrozov"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/aa8d09f500e2bad23463a3162993e4c9dc37ce59", "committedDate": "2020-04-08T11:31:41Z", "message": "HH-107064 review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5OTI1OTQ1", "url": "https://github.com/hhru/nuts-and-bolts/pull/237#pullrequestreview-389925945", "createdAt": "2020-04-08T12:29:02Z", "commit": {"oid": "aa8d09f500e2bad23463a3162993e4c9dc37ce59"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMjoyOTowMlrOGCs6bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMjoyOTowMlrOGCs6bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ4NjE5MQ==", "bodyText": "\u0434\u043e\u043f\u0438\u0448\u0438 \u0441\u044e\u0434\u0430 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443, \u0447\u0442\u043e \u0447\u0435\u0439\u043d \u043f\u0440\u0438 \u044d\u0442\u043e\u043c \u043d\u0435 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442\u0441\u044f - \u0443\u0436 \u0431\u043e\u043b\u044c\u043d\u043e \u043f\u0440\u0438\u0447\u0443\u0434\u043b\u0438\u0432\u044b\u0439 \u043a\u043e\u0434)", "url": "https://github.com/hhru/nuts-and-bolts/pull/237#discussion_r405486191", "createdAt": "2020-04-08T12:29:02Z", "author": {"login": "dzharikhin"}, "path": "nab-tests/src/test/java/ru/hh/nab/jclient/JClientContextProviderFilterTest.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package ru.hh.nab.jclient;\n+\n+import org.junit.Test;\n+import ru.hh.jclient.common.HttpClientContextThreadLocalSupplier;\n+\n+import javax.servlet.FilterChain;\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.IOException;\n+import java.util.Collections;\n+\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.when;\n+\n+public class JClientContextProviderFilterTest {\n+\n+  @Test\n+  public void testInvalidQueryParams() throws IOException, ServletException {\n+    JClientContextProviderFilter filter = new JClientContextProviderFilter(mock(HttpClientContextThreadLocalSupplier.class));\n+    HttpServletRequest request = mock(HttpServletRequest.class);\n+    HttpServletResponse response = mock(HttpServletResponse.class);\n+    FilterChain chain = mock(FilterChain.class);\n+\n+    when(request.getHeaderNames()).thenReturn(Collections.emptyEnumeration());\n+    when(request.getQueryString()).thenReturn(\"/query?%\");\n+\n+    filter.doFilter(request, response, chain);\n+    verify(response).sendError(HttpServletResponse.SC_BAD_REQUEST);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa8d09f500e2bad23463a3162993e4c9dc37ce59"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9689f22dfd51c1a256871fb4ecb45f7fc540c5f7", "author": {"user": {"login": "genroelgvozo", "name": "Oleg Negrozov"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/9689f22dfd51c1a256871fb4ecb45f7fc540c5f7", "committedDate": "2020-04-08T12:32:33Z", "message": "HH-107064 review 2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5OTM0NzA1", "url": "https://github.com/hhru/nuts-and-bolts/pull/237#pullrequestreview-389934705", "createdAt": "2020-04-08T12:41:10Z", "commit": {"oid": "9689f22dfd51c1a256871fb4ecb45f7fc540c5f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3293, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}