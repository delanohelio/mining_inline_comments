{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMjQ3Nzc3", "number": 230, "title": "HH-105938 support X-HH-AcceptErrors header for custom exceptions", "bodyText": "\u0418\u0434\u0435\u044f \u0432 \u0442\u043e\u043c, \u0447\u0442\u043e\u0431\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u0438\u043c\u0435\u0442\u044c \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u044c \u0440\u0435\u0433\u0443\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u0435\u0434\u0438\u0430 \u0442\u0430\u0439\u043f \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u0434\u043e\u043b\u0436\u043d\u044b \u043f\u0440\u0438\u043b\u0435\u0442\u0430\u0442\u044c \u043e\u0448\u0438\u0431\u043a\u0438 \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u0438\u0445 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u0434\u0435\u0441\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c.\n\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u043e\u0448\u0438\u0431\u043a\u0438 \u0434\u0436\u0435\u0440\u0441\u0438 \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u044e\u0442\u0441\u044f \u0443\u0436\u0435 \u043f\u043e\u0447\u043b\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u0432\u0441\u0435\u0445 \u0444\u0438\u043b\u044c\u0442\u0440\u043e\u0432 \u0438 \u0434\u043b\u044f \u043d\u0438\u0445 \u043c\u0435\u0434\u0438\u0430\u0442\u0430\u0439\u043f \u0441\u0431\u0440\u0430\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f \u0438 \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0437\u0430\u043d\u043e\u0432\u043e, \u0438\u0441\u0445\u043e\u0434\u044f \u0438\u043c\u0435\u043d\u043d\u043e \u0438\u0437 Accept \u0445\u044d\u0434\u0435\u0440\u0430.\n\u0421 \u0434\u0440\u0443\u0433\u043e\u0439 \u0441\u0442\u043e\u0440\u043e\u043d\u044b \u0434\u0436\u0435\u0440\u0441\u0451\u0432\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430, \u043f\u0440\u0438\u043b\u0435\u0442\u0435\u0432\u0448\u0430\u044f \u0434\u0430\u0436\u0435 \u0432 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u043c \u0444\u043e\u0440\u043c\u0430\u0442\u0435, \u0432\u0441\u0451 \u0440\u0430\u0432\u043d\u043e \u043d\u0435 \u0434\u0435\u0441\u0435\u0440\u0438\u0430\u043b\u0438\u0437\u0443\u0435\u0442\u0441\u044f \u0432 \u043d\u0443\u0436\u043d\u044b\u0439 \u043d\u0430\u043c \u043a\u043b\u0430\u0441\u0441 \u043e\u0448\u0438\u0431\u043a\u0438, \u0442\u0430\u043a \u0447\u0442\u043e, \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e, \u044d\u0442\u0438\u043c \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u0435\u043d\u0435\u0431\u0440\u0435\u0447\u044c.", "createdAt": "2020-03-23T09:00:35Z", "url": "https://github.com/hhru/nuts-and-bolts/pull/230", "merged": true, "mergeCommit": {"oid": "985b94e832b595286640e7eba33b825e74565f19"}, "closed": true, "closedAt": "2020-03-31T10:56:34Z", "author": {"login": "Afftobus"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQbJTSAFqTM3OTI2NzQxMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcS_wThABqjMxODI0MDU0MTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MjY3NDEy", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#pullrequestreview-379267412", "createdAt": "2020-03-23T09:44:32Z", "commit": {"oid": "f2b27b946e0abf20c90c68068bcac60a6e8716dd"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwOTo0NDozMlrOF59mew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwOTo0NjoyM1rOF59qnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMyMjQyNw==", "bodyText": "\u044d\u0442\u043e \u0433\u0434\u0435-\u0442\u043e \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0441\u0442\u043e\u043f\u0443\u0434\u043e\u0432\u043e \u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u043e\u0439", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#discussion_r396322427", "createdAt": "2020-03-23T09:44:32Z", "author": {"login": "dzharikhin"}, "path": "nab-starter/src/main/java/ru/hh/nab/starter/filters/ErrorAcceptFilter.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package ru.hh.nab.starter.filters;\n+\n+import javax.ws.rs.container.ContainerRequestContext;\n+import javax.ws.rs.container.ContainerResponseContext;\n+import javax.ws.rs.container.ContainerResponseFilter;\n+import javax.ws.rs.ext.Provider;\n+import java.io.IOException;\n+import java.util.List;\n+\n+@Provider\n+public class ErrorAcceptFilter implements ContainerResponseFilter {\n+    @Override\n+    public void filter(ContainerRequestContext requestContext,\n+                       ContainerResponseContext responseContext) throws IOException {\n+        if (responseContext.getStatus() >= 400) {\n+            String AcceptErrors = requestContext.getHeaders().getFirst(\"X-HH-AcceptErrors\");\n+            if (AcceptErrors != null) {\n+                responseContext.getHeaders().replace(\"Content-Type\", List.of(AcceptErrors));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2b27b946e0abf20c90c68068bcac60a6e8716dd"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMyMzQ4Nw==", "bodyText": "\u044d\u0442\u043e \u043d\u0443 \u043b\u0438\u0431\u043e RequestHeaders, \u043b\u0438\u0431\u043e \u0440\u0430\u0437 \u0443\u0436 \u0432\u0441\u0435-\u0442\u0430\u043a\u0438 \u043c\u044b \u0441\u0432\u044f\u0437\u044b\u0432\u0430\u0435\u043c jclient \u0438 nab, \u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0432 jclient-common-api \u043e\u0431\u044a\u044f\u0432\u0438\u0442\u044c, \u0430 \u0432 \u0441\u0442\u0430\u0440\u0442\u0435\u0440 \u0431\u0430\u0445\u043d\u0443\u0442\u044c \u043e\u0442 jclient-common-api \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u044c. \u0438 \u043e\u0442\u0442\u0443\u0434\u0430 \u0431\u0440\u0430\u0442\u044c. \u0432 \u043d\u0430\u0431\u0435 \u0435\u0449\u0435 \u043e\u0434\u0438\u043d \u0445\u0435\u0434\u0435\u0440 \u0442\u0430\u043a\u043e\u0439 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u043f\u0440\u043e outerTimeout - \u0435\u0433\u043e \u0442\u043e\u0436\u0435 \u043c\u043e\u0436\u043d\u043e \u0431\u0443\u0434\u0435\u0442 \u0442\u043e\u0433\u0434\u0430 \u0438\u0437 jclient'\u0430 \u0437\u0430\u0431\u0440\u0430\u0442\u044c", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#discussion_r396323487", "createdAt": "2020-03-23T09:46:23Z", "author": {"login": "dzharikhin"}, "path": "nab-starter/src/main/java/ru/hh/nab/starter/filters/ErrorAcceptFilter.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package ru.hh.nab.starter.filters;\n+\n+import javax.ws.rs.container.ContainerRequestContext;\n+import javax.ws.rs.container.ContainerResponseContext;\n+import javax.ws.rs.container.ContainerResponseFilter;\n+import javax.ws.rs.ext.Provider;\n+import java.io.IOException;\n+import java.util.List;\n+\n+@Provider\n+public class ErrorAcceptFilter implements ContainerResponseFilter {\n+    @Override\n+    public void filter(ContainerRequestContext requestContext,\n+                       ContainerResponseContext responseContext) throws IOException {\n+        if (responseContext.getStatus() >= 400) {\n+            String AcceptErrors = requestContext.getHeaders().getFirst(\"X-HH-AcceptErrors\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2b27b946e0abf20c90c68068bcac60a6e8716dd"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MzE4NjY5", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#pullrequestreview-379318669", "createdAt": "2020-03-23T10:53:35Z", "commit": {"oid": "f2b27b946e0abf20c90c68068bcac60a6e8716dd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMDo1MzozNlrOF6AG7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMDo1MzozNlrOF6AG7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM2MzUwMw==", "bodyText": "\u043d\u0430 \u0433\u043b\u0430\u0437 \u0442\u0443\u0442 \u043d\u0435 \u043d\u0443\u0436\u0435\u043d \u043f\u0435\u0440\u0435\u043d\u043e\u0441 \u0441\u0442\u0440\u043e\u043a\u0438 \u0438 \u0432\u0441\u0435 \u0432\u043b\u0435\u0437\u0435\u0442 \u0432 150", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#discussion_r396363503", "createdAt": "2020-03-23T10:53:36Z", "author": {"login": "kincajou"}, "path": "nab-starter/src/main/java/ru/hh/nab/starter/filters/ErrorAcceptFilter.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package ru.hh.nab.starter.filters;\n+\n+import javax.ws.rs.container.ContainerRequestContext;\n+import javax.ws.rs.container.ContainerResponseContext;\n+import javax.ws.rs.container.ContainerResponseFilter;\n+import javax.ws.rs.ext.Provider;\n+import java.io.IOException;\n+import java.util.List;\n+\n+@Provider\n+public class ErrorAcceptFilter implements ContainerResponseFilter {\n+    @Override\n+    public void filter(ContainerRequestContext requestContext,\n+                       ContainerResponseContext responseContext) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2b27b946e0abf20c90c68068bcac60a6e8716dd"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyODE4ODI4", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#pullrequestreview-382818828", "createdAt": "2020-03-27T12:37:55Z", "commit": {"oid": "6eed99b4478afc1ca542e90362e1cc9c41ede817"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMjozNzo1NVrOF8vTJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxMjozODo0NVrOF8vUzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzMzgyOQ==", "bodyText": "\u043d\u0435 \u043d\u0443\u0436\u0435\u043d scope", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#discussion_r399233829", "createdAt": "2020-03-27T12:37:55Z", "author": {"login": "dzharikhin"}, "path": "nab-starter/pom.xml", "diffHunk": "@@ -210,6 +210,12 @@\n             <version>3.1.6</version>\n             <scope>test</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>ru.hh.jclient-common</groupId>\n+            <artifactId>jclient-common-api</artifactId>\n+            <version>${jclient.version}</version>\n+            <scope>compile</scope>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6eed99b4478afc1ca542e90362e1cc9c41ede817"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzNDAzMw==", "bodyText": "\u0438 \u0435\u0449\u0435 \u0442\u0430\u043c \u0435\u0441\u0442\u044c \u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u0430 outerTimeout - \u0435\u0435 \u0442\u043e\u0436\u0435 \u0434\u0430\u0432\u0430\u0439 \u0436\u0430\u0445\u043d\u0435\u043c \u0438\u0437 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0440\u0430\u0437 \u0443\u0436 \u043f\u043e\u0448\u043b\u043e", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#discussion_r399234033", "createdAt": "2020-03-27T12:38:23Z", "author": {"login": "dzharikhin"}, "path": "nab-starter/pom.xml", "diffHunk": "@@ -210,6 +210,12 @@\n             <version>3.1.6</version>\n             <scope>test</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>ru.hh.jclient-common</groupId>\n+            <artifactId>jclient-common-api</artifactId>\n+            <version>${jclient.version}</version>\n+            <scope>compile</scope>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzMzgyOQ=="}, "originalCommit": {"oid": "6eed99b4478afc1ca542e90362e1cc9c41ede817"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzNDI1Mg==", "bodyText": "\u0447\u0442\u043e \u0437\u0430 \u0437\u0430\u043f\u044f\u0442\u0430\u044f? \u043e\u0442\u043a\u0443\u0434\u0430, \u0434\u043b\u044f \u0447\u0435\u0433\u043e? \u044d\u0442\u043e \u043d\u0430\u0448 \u0445\u0435\u0434\u0435\u0440 \u0438 \u043c\u044b \u0432\u0441\u0435 \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u0438\u0440\u0443\u0435\u043c", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#discussion_r399234252", "createdAt": "2020-03-27T12:38:45Z", "author": {"login": "dzharikhin"}, "path": "nab-starter/src/main/java/ru/hh/nab/starter/filters/ErrorAcceptFilter.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package ru.hh.nab.starter.filters;\n+\n+import javax.ws.rs.container.ContainerRequestContext;\n+import javax.ws.rs.container.ContainerResponseContext;\n+import javax.ws.rs.container.ContainerResponseFilter;\n+import javax.ws.rs.ext.Provider;\n+import java.io.IOException;\n+import java.util.List;\n+\n+import static javax.ws.rs.core.HttpHeaders.CONTENT_TYPE;\n+import static ru.hh.jclient.common.HttpHeaderNames.X_HH_ACCEPT_ERRORS;\n+\n+@Provider\n+public class ErrorAcceptFilter implements ContainerResponseFilter {\n+    @Override\n+    public void filter(ContainerRequestContext requestContext, ContainerResponseContext responseContext) throws IOException {\n+        if (responseContext.getStatus() >= 400) {\n+            String acceptErrors = requestContext.getHeaders().getFirst(X_HH_ACCEPT_ERRORS);\n+            if (acceptErrors != null) {\n+                String[] mediatypes = acceptErrors.split(\",\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6eed99b4478afc1ca542e90362e1cc9c41ede817"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNjE1NDcz", "url": "https://github.com/hhru/nuts-and-bolts/pull/230#pullrequestreview-383615473", "createdAt": "2020-03-30T08:05:09Z", "commit": {"oid": "fb65056215786fb789f9e8029b7356a15e15d8d0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8edd34208c98e6feaf4ca7da35567a40dd75165a", "author": {"user": null}, "url": "https://github.com/hhru/nuts-and-bolts/commit/8edd34208c98e6feaf4ca7da35567a40dd75165a", "committedDate": "2020-03-30T10:03:26Z", "message": "HH-105938 up jclient version"}, "afterCommit": {"oid": "8a55f33f25d96205f9e7bd4a6c137c1756a13616", "author": {"user": null}, "url": "https://github.com/hhru/nuts-and-bolts/commit/8a55f33f25d96205f9e7bd4a6c137c1756a13616", "committedDate": "2020-03-30T10:29:03Z", "message": "HH-105938 support X-HH-AcceptErrors header for custom exceptions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc44af2e7e9d974b4f0356253bc20d043bd2884a", "author": {"user": null}, "url": "https://github.com/hhru/nuts-and-bolts/commit/cc44af2e7e9d974b4f0356253bc20d043bd2884a", "committedDate": "2020-03-31T09:33:03Z", "message": "HH-105938 support X-HH-AcceptErrors header for custom exceptions"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8a55f33f25d96205f9e7bd4a6c137c1756a13616", "author": {"user": null}, "url": "https://github.com/hhru/nuts-and-bolts/commit/8a55f33f25d96205f9e7bd4a6c137c1756a13616", "committedDate": "2020-03-30T10:29:03Z", "message": "HH-105938 support X-HH-AcceptErrors header for custom exceptions"}, "afterCommit": {"oid": "cc44af2e7e9d974b4f0356253bc20d043bd2884a", "author": {"user": null}, "url": "https://github.com/hhru/nuts-and-bolts/commit/cc44af2e7e9d974b4f0356253bc20d043bd2884a", "committedDate": "2020-03-31T09:33:03Z", "message": "HH-105938 support X-HH-AcceptErrors header for custom exceptions"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3397, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}