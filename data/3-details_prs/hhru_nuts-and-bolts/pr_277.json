{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMjk1MjUz", "number": 277, "title": "HH-119532 Fix unnecessary shutdown hook", "bodyText": "", "createdAt": "2020-11-18T16:09:02Z", "url": "https://github.com/hhru/nuts-and-bolts/pull/277", "merged": true, "mergeCommit": {"oid": "54f7b953cca33e95e0588944d9224d93bb61a918"}, "closed": true, "closedAt": "2020-11-19T09:02:10Z", "author": {"login": "nicholasgribanov"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddwU1FAH2gAyNTIzMjk1MjUzOjU5ZDNkYmI0MmMxYTUwNjA5ZGU2NGNkOTYxZmY0N2ZlZGVmODMyNzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdd-SvCgFqTUzNDE2OTM5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "59d3dbb42c1a50609de64cd961ff47fedef83276", "author": {"user": null}, "url": "https://github.com/hhru/nuts-and-bolts/commit/59d3dbb42c1a50609de64cd961ff47fedef83276", "committedDate": "2020-11-18T15:59:14Z", "message": "HH-119532 Fix unnecessary shutdown hook"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNjEzNjk0", "url": "https://github.com/hhru/nuts-and-bolts/pull/277#pullrequestreview-533613694", "createdAt": "2020-11-18T16:14:06Z", "commit": {"oid": "59d3dbb42c1a50609de64cd961ff47fedef83276"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MTY5Mzkw", "url": "https://github.com/hhru/nuts-and-bolts/pull/277#pullrequestreview-534169390", "createdAt": "2020-11-19T08:15:27Z", "commit": {"oid": "59d3dbb42c1a50609de64cd961ff47fedef83276"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODoxNToyN1rOH2RQAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODoxNToyN1rOH2RQAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY2Nzc3Ng==", "bodyText": "\u0430 \u0440\u0430\u043d\u044c\u0448\u0435 \u043e\u0442\u0434\u0430\u0432\u0430\u043b?", "url": "https://github.com/hhru/nuts-and-bolts/pull/277#discussion_r526667776", "createdAt": "2020-11-19T08:15:27Z", "author": {"login": "heruv1m"}, "path": "nab-tests/src/test/java/ru/hh/nab/starter/NabApplicationTest.java", "diffHunk": "@@ -56,6 +58,29 @@ public void runShouldStartJetty() {\n     }\n   }\n \n+  @Test\n+  public void testCloseAllContextsAfterStopJetty() {\n+\n+    JettyServer server = NabApplication.runWebApp(new NabServletContextConfig(), NabTestConfig.class);\n+    WebApplicationContext webApplicationContext = getWebApplicationContext(server.getServletContext());\n+    Invocation.Builder statusReq = ClientBuilder.newBuilder().build().target(UriBuilder.fromUri(\"http://localhost\").port(server.getPort()).build())\n+        .path(\"status\").request();\n+\n+    assertEquals(NabTestConfig.TEST_SERVICE_NAME, webApplicationContext.getBean(\"serviceName\"));\n+    assertEquals(NabTestConfig.TEST_SERVICE_NAME, webApplicationContext.getParent().getBean(\"serviceName\"));\n+    try (Response response = statusReq.get()) {\n+      assertEquals(Response.Status.OK.getStatusCode(), response.getStatus());\n+    }\n+\n+    server.stop();\n+\n+    assertFalse(server.isRunning());\n+    assertThrows(ProcessingException.class, statusReq::get);\n+    assertThrows(IllegalStateException.class, () -> webApplicationContext.getBean(\"serviceName\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59d3dbb42c1a50609de64cd961ff47fedef83276"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3367, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}