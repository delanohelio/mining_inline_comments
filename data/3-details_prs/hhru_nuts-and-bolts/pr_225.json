{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2NzM4Njcw", "number": 225, "title": "HH-101495 add unit tests for kafka's listener and publisher", "bodyText": "https://jira.hh.ru/browse/HH-101495\n\u0414\u043e\u0431\u0430\u0432\u0438\u043b \u043a\u0430\u0444\u043a\u0430 \u043a\u043e\u043d\u0444\u0438\u0433 \u0432 \u043c\u043e\u0434\u0443\u043b\u044c nab-testbase\n\u0414\u043e\u0431\u0430\u0432\u0438\u043b \u0442\u0435\u0441\u0442\u043e\u0432 \u0432 nab-tests\n\u041f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043b \u043f\u0430\u043a\u0435\u0442 \u0432 nab-kafka", "createdAt": "2020-01-24T09:05:09Z", "url": "https://github.com/hhru/nuts-and-bolts/pull/225", "merged": true, "mergeCommit": {"oid": "137ed512fb840a56067ad0c9211c13f3b6f12c53"}, "closed": true, "closedAt": "2020-01-28T10:08:57Z", "author": {"login": "vorobey92"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9dnYJAH2gAyMzY2NzM4NjcwOmNkYzcyMDAwNTgwYjJiNTk1MWQyZDNkMjk4M2JiMzFlOTY0ZWM3OTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-uGdFgFqTM0OTIzNzA4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cdc72000580b2b5951d2d3d2983bb31e964ec796", "author": {"user": {"login": "vorobey92", "name": "\u0418\u0432\u0430\u043d \u0412\u043e\u0440\u043e\u0431\u044c\u0435\u0432"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/cdc72000580b2b5951d2d3d2983bb31e964ec796", "committedDate": "2020-01-24T11:54:34Z", "message": "HH-101495 add spring config for kafka unit tests, add few unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "182532d3a22ebc65b650330f9a9f3e3be84243c8", "author": {"user": {"login": "vorobey92", "name": "\u0418\u0432\u0430\u043d \u0412\u043e\u0440\u043e\u0431\u044c\u0435\u0432"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/182532d3a22ebc65b650330f9a9f3e3be84243c8", "committedDate": "2020-01-24T11:54:34Z", "message": "HH-101495 rename package according to classes' names"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "706bbcb18ae1999a8b27120b02d9c3cbcf4288bd", "author": {"user": {"login": "vorobey92", "name": "\u0418\u0432\u0430\u043d \u0412\u043e\u0440\u043e\u0431\u044c\u0435\u0432"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/706bbcb18ae1999a8b27120b02d9c3cbcf4288bd", "committedDate": "2020-01-24T08:58:10Z", "message": "HH-101495 rename package according to classes' names"}, "afterCommit": {"oid": "182532d3a22ebc65b650330f9a9f3e3be84243c8", "author": {"user": {"login": "vorobey92", "name": "\u0418\u0432\u0430\u043d \u0412\u043e\u0440\u043e\u0431\u044c\u0435\u0432"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/182532d3a22ebc65b650330f9a9f3e3be84243c8", "committedDate": "2020-01-24T11:54:34Z", "message": "HH-101495 rename package according to classes' names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3OTE1NzIy", "url": "https://github.com/hhru/nuts-and-bolts/pull/225#pullrequestreview-347915722", "createdAt": "2020-01-24T12:14:17Z", "commit": {"oid": "182532d3a22ebc65b650330f9a9f3e3be84243c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxMjoxNDoxN1rOFhb7Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxMjoxNDoxN1rOFhb7Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYwNDgwMg==", "bodyText": "\u0442\u0443\u0442 \u0432\u043e\u0442 \u043d\u0435 \u043e\u0447\u0435\u043d\u044c \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u043a\u043b\u044e\u0447 \u043a\u043e\u043d\u0444\u0438\u0433\u043e\u0432 \u0434\u043b\u044f \u043a\u0430\u0444\u043a\u0438 \u0432 \u0440\u0430\u0437\u043d\u044b\u0445 \u0441\u0435\u0440\u0432\u0438\u0441\u0430\u0445 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0440\u0430\u0437\u043d\u044b\u043c", "url": "https://github.com/hhru/nuts-and-bolts/pull/225#discussion_r370604802", "createdAt": "2020-01-24T12:14:17Z", "author": {"login": "bokshitsky"}, "path": "nab-testbase/src/main/java/ru/hh/nab/testbase/kafka/NabKafkaCommonTestConfig.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package ru.hh.nab.testbase.kafka;\n+\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Primary;\n+import ru.hh.kafka.test.TestKafka;\n+import static ru.hh.nab.testbase.NabTestConfig.createProperties;\n+import java.io.IOException;\n+import java.util.Properties;\n+\n+@Configuration\n+public class NabKafkaCommonTestConfig {\n+\n+  @Bean\n+  @Primary\n+  Properties serviceProperties(TestKafka testKafka) throws IOException {\n+    Properties serviceProperties = createProperties(\"service-test.properties\");\n+    serviceProperties.putAll(createProperties(\"kafka-test.properties\"));\n+    serviceProperties.setProperty(\"kafka.common.bootstrap.servers\", testKafka.getBootstrapServers());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "182532d3a22ebc65b650330f9a9f3e3be84243c8"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3OTE2MjAy", "url": "https://github.com/hhru/nuts-and-bolts/pull/225#pullrequestreview-347916202", "createdAt": "2020-01-24T12:15:25Z", "commit": {"oid": "182532d3a22ebc65b650330f9a9f3e3be84243c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxMjoxNToyNVrOFhb8ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxMjoxNToyNVrOFhb8ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYwNTE1Nw==", "bodyText": "\u0434\u0443\u043c\u0430\u044e, \u044d\u0442\u043e \u0432\u0441\u0451-\u0442\u0430\u043a\u0438 \u043d\u0430\u0434\u043e \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u043c \u0430\u0440\u0442\u0435\u0444\u0430\u043a\u0442\u043e\u043c, \u0447\u0442\u043e\u0431\u044b \u0432 \u0442\u0435\u0441\u0442\u044b \u043a\u0430\u0444\u043a\u0430 \u043f\u043e\u0434\u0440\u0443\u0431\u0430\u043b\u0430\u0441\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0435\u0441\u043b\u0438 \u043e\u043d\u0430 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043d\u0443\u0436\u043d\u0430", "url": "https://github.com/hhru/nuts-and-bolts/pull/225#discussion_r370605157", "createdAt": "2020-01-24T12:15:25Z", "author": {"login": "bokshitsky"}, "path": "nab-tests/pom.xml", "diffHunk": "@@ -49,6 +49,11 @@\n             <artifactId>nab-jclient</artifactId>\n             <version>${project.version}</version>\n         </dependency>\n+        <dependency>\n+            <groupId>${project.groupId}</groupId>\n+            <artifactId>nab-kafka</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "182532d3a22ebc65b650330f9a9f3e3be84243c8"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3OTE2NTA5", "url": "https://github.com/hhru/nuts-and-bolts/pull/225#pullrequestreview-347916509", "createdAt": "2020-01-24T12:16:09Z", "commit": {"oid": "182532d3a22ebc65b650330f9a9f3e3be84243c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxMjoxNjowOVrOFhb9Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQxMjoxNjowOVrOFhb9Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYwNTQxMA==", "bodyText": "\u0431\u0438\u043d objectMapper \u043d\u0435 \u043e\u0447 \u0445\u043e\u0440\u043e\u0448\u0430\u044f \u0438\u0434\u0435\u044f - \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u0441\u0442\u043e\u044f\u043d\u043d\u043e \u0442\u0430\u043c \u0441 \u0447\u0435\u043c-\u0442\u043e \u043a\u043e\u043d\u0444\u043b\u0438\u043a\u0442\u043e\u0432\u0430\u0442\u044c-\u043f\u0435\u0440\u0435\u0442\u0438\u0440\u0430\u0442\u044c", "url": "https://github.com/hhru/nuts-and-bolts/pull/225#discussion_r370605410", "createdAt": "2020-01-24T12:16:09Z", "author": {"login": "bokshitsky"}, "path": "nab-tests/src/test/java/ru/hh/nab/kafka/KafkaTestConfig.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package ru.hh.nab.kafka;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Import;\n+import ru.hh.nab.common.properties.FileSettings;\n+import ru.hh.nab.kafka.listener.DefaultListenerFactory;\n+import ru.hh.nab.kafka.listener.DeserializerSupplier;\n+import ru.hh.nab.kafka.listener.ListenerFactory;\n+import ru.hh.nab.kafka.publisher.PublisherFactory;\n+import ru.hh.nab.kafka.publisher.SerializerSupplier;\n+import ru.hh.nab.kafka.serialization.JacksonDeserializerSupplier;\n+import ru.hh.nab.kafka.serialization.JacksonSerializerSupplier;\n+import ru.hh.nab.kafka.util.ConfigProvider;\n+import ru.hh.nab.testbase.kafka.NabKafkaJsonTestConfig;\n+import java.util.Properties;\n+\n+@Configuration\n+@Import({NabKafkaJsonTestConfig.class})\n+public class KafkaTestConfig {\n+\n+  @Bean\n+  ObjectMapper objectMapper(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "182532d3a22ebc65b650330f9a9f3e3be84243c8"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4f1babd691c2a6459791f3d90cb3292545d0b1e", "author": {"user": {"login": "vorobey92", "name": "\u0418\u0432\u0430\u043d \u0412\u043e\u0440\u043e\u0431\u044c\u0435\u0432"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/f4f1babd691c2a6459791f3d90cb3292545d0b1e", "committedDate": "2020-01-27T16:48:50Z", "message": "HH-101495 user kafkaClusterName when setting props, user TestObjectMapperSupplier instead of simple ObjectMapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "137ed512fb840a56067ad0c9211c13f3b6f12c53", "author": {"user": {"login": "vorobey92", "name": "\u0418\u0432\u0430\u043d \u0412\u043e\u0440\u043e\u0431\u044c\u0435\u0432"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/137ed512fb840a56067ad0c9211c13f3b6f12c53", "committedDate": "2020-01-28T09:36:45Z", "message": "HH-101495 remove test configs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MjM3MDg3", "url": "https://github.com/hhru/nuts-and-bolts/pull/225#pullrequestreview-349237087", "createdAt": "2020-01-28T09:40:55Z", "commit": {"oid": "137ed512fb840a56067ad0c9211c13f3b6f12c53"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3389, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}