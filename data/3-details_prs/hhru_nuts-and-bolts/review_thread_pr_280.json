{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1NzA1NzI0", "number": 280, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzowNjo1MlrOE8NVow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzowNjo1MlrOE8NVow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNTY4NTQ3OnYy", "diffSide": "RIGHT", "path": "nab-starter/src/main/java/ru/hh/nab/starter/ConsulService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzowNjo1MlrOH4Mpmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMzowNjo1MlrOH4Mpmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY4OTU2Mw==", "bodyText": "interruptedFlag?", "url": "https://github.com/hhru/nuts-and-bolts/pull/280#discussion_r528689563", "createdAt": "2020-11-23T13:06:52Z", "author": {"login": "pvorlov"}, "path": "nab-starter/src/main/java/ru/hh/nab/starter/ConsulService.java", "diffHunk": "@@ -98,14 +98,22 @@ public void register() {\n     return kvClient.getValueAsString(String.format(\"host/%s/weight\", hostName));\n   }\n \n-  @PreDestroy\n-  void deregister() {\n+  public void deregister() {\n     if (enabled) {\n       agentClient.deregister(service.getId());\n+      LOGGER.debug(\"De-registered id: {} from consul, going to sleep {}ms to wait possible requests\", id, sleepAfterDeregisterMillis);\n+      trySleep();\n       LOGGER.info(\"De-registered id: {} from consul\", id);\n     }\n   }\n \n+  private void trySleep() {\n+    try {\n+      Thread.sleep(sleepAfterDeregisterMillis);\n+    } catch (InterruptedException ignored) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0aff8da5d3241e51fc515a2eac4cc3333c555e96"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4296, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}