{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzMjk1MjUz", "number": 277, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODoxNToyN1rOE67EdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODoxNToyN1rOE67EdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMjIwNjYwOnYy", "diffSide": "RIGHT", "path": "nab-tests/src/test/java/ru/hh/nab/starter/NabApplicationTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODoxNToyN1rOH2RQAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwODoxODoyNVrOH2RWbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY2Nzc3Ng==", "bodyText": "\u0430 \u0440\u0430\u043d\u044c\u0448\u0435 \u043e\u0442\u0434\u0430\u0432\u0430\u043b?", "url": "https://github.com/hhru/nuts-and-bolts/pull/277#discussion_r526667776", "createdAt": "2020-11-19T08:15:27Z", "author": {"login": "heruv1m"}, "path": "nab-tests/src/test/java/ru/hh/nab/starter/NabApplicationTest.java", "diffHunk": "@@ -56,6 +58,29 @@ public void runShouldStartJetty() {\n     }\n   }\n \n+  @Test\n+  public void testCloseAllContextsAfterStopJetty() {\n+\n+    JettyServer server = NabApplication.runWebApp(new NabServletContextConfig(), NabTestConfig.class);\n+    WebApplicationContext webApplicationContext = getWebApplicationContext(server.getServletContext());\n+    Invocation.Builder statusReq = ClientBuilder.newBuilder().build().target(UriBuilder.fromUri(\"http://localhost\").port(server.getPort()).build())\n+        .path(\"status\").request();\n+\n+    assertEquals(NabTestConfig.TEST_SERVICE_NAME, webApplicationContext.getBean(\"serviceName\"));\n+    assertEquals(NabTestConfig.TEST_SERVICE_NAME, webApplicationContext.getParent().getBean(\"serviceName\"));\n+    try (Response response = statusReq.get()) {\n+      assertEquals(Response.Status.OK.getStatusCode(), response.getStatus());\n+    }\n+\n+    server.stop();\n+\n+    assertFalse(server.isRunning());\n+    assertThrows(ProcessingException.class, statusReq::get);\n+    assertThrows(IllegalStateException.class, () -> webApplicationContext.getBean(\"serviceName\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59d3dbb42c1a50609de64cd961ff47fedef83276"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY2OTQyMg==", "bodyText": "\u0414\u0430, \u0431\u044b\u043b\u0430 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f, \u0447\u0442\u043e \u043a\u043e\u043d\u043d\u0435\u043a\u0442 \u043e\u0442\u043a\u0440\u044b\u0442, \u043d\u043e \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430 \u0443\u0436\u0435 \u043d\u0435\u0442.", "url": "https://github.com/hhru/nuts-and-bolts/pull/277#discussion_r526669422", "createdAt": "2020-11-19T08:18:25Z", "author": {"login": "nicholasgribanov"}, "path": "nab-tests/src/test/java/ru/hh/nab/starter/NabApplicationTest.java", "diffHunk": "@@ -56,6 +58,29 @@ public void runShouldStartJetty() {\n     }\n   }\n \n+  @Test\n+  public void testCloseAllContextsAfterStopJetty() {\n+\n+    JettyServer server = NabApplication.runWebApp(new NabServletContextConfig(), NabTestConfig.class);\n+    WebApplicationContext webApplicationContext = getWebApplicationContext(server.getServletContext());\n+    Invocation.Builder statusReq = ClientBuilder.newBuilder().build().target(UriBuilder.fromUri(\"http://localhost\").port(server.getPort()).build())\n+        .path(\"status\").request();\n+\n+    assertEquals(NabTestConfig.TEST_SERVICE_NAME, webApplicationContext.getBean(\"serviceName\"));\n+    assertEquals(NabTestConfig.TEST_SERVICE_NAME, webApplicationContext.getParent().getBean(\"serviceName\"));\n+    try (Response response = statusReq.get()) {\n+      assertEquals(Response.Status.OK.getStatusCode(), response.getStatus());\n+    }\n+\n+    server.stop();\n+\n+    assertFalse(server.isRunning());\n+    assertThrows(ProcessingException.class, statusReq::get);\n+    assertThrows(IllegalStateException.class, () -> webApplicationContext.getBean(\"serviceName\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY2Nzc3Ng=="}, "originalCommit": {"oid": "59d3dbb42c1a50609de64cd961ff47fedef83276"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4293, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}