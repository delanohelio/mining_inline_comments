{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzNDY3ODU0", "number": 250, "title": "HH-112089 do not start kafka consumer if found unused properties", "bodyText": "https://jira.hh.ru/browse/HH-112089", "createdAt": "2020-07-02T11:54:07Z", "url": "https://github.com/hhru/nuts-and-bolts/pull/250", "merged": true, "mergeCommit": {"oid": "79a9115ec4d0edb8889d6314c779d5f040c9419c"}, "closed": true, "closedAt": "2020-07-02T14:15:22Z", "author": {"login": "alexeydubinin"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcw9c5QgH2gAyNDQzNDY3ODU0OjFmMzMyMWU5OWUyYjAwMzkzNzRiYmIzMTY2MWZjNjEyMzBiMTQyOTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcw-5gBAH2gAyNDQzNDY3ODU0OmVjYzI5YzA1OTAxMWZhYmMxYTNkMGQ5NGNlMTgyMmI2ZWE2ZmZmODU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1f3321e99e2b0039374bbb31661fc61230b14296", "author": {"user": {"login": "alexeydubinin", "name": "Alexey Dubinin"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/1f3321e99e2b0039374bbb31661fc61230b14296", "committedDate": "2020-07-02T11:50:13Z", "message": "HH-112089 do not start kafka consumer if found unused properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNjEzOTEz", "url": "https://github.com/hhru/nuts-and-bolts/pull/250#pullrequestreview-441613913", "createdAt": "2020-07-02T12:06:37Z", "commit": {"oid": "1f3321e99e2b0039374bbb31661fc61230b14296"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMjowNjozN1rOGsJ71Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMjowNjozN1rOGsJ71Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1MzMwMQ==", "bodyText": "String::cast \u0442\u0443\u0442 \u0441\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442?", "url": "https://github.com/hhru/nuts-and-bolts/pull/250#discussion_r448953301", "createdAt": "2020-07-02T12:06:37Z", "author": {"login": "bokshitsky"}, "path": "nab-kafka/src/main/java/ru/hh/nab/kafka/util/ConfigProvider.java", "diffHunk": "@@ -90,9 +94,26 @@ private void checkConfig(FileSettings nabConsumerSettings, FileSettings allConsu\n   }\n \n   private Map<String, Object> getTopicOverriddenConsumerProperties(String topicName) {\n+    findAnyMatchedKey(String.format(\n+        TOPIC_CONSUMER_INVALID_CONFIG_REGEXP_TEMPLATE, kafkaClusterName, topicName))\n+        .ifPresent(key -> {\n+          throw new IllegalArgumentException(\n+              String.format(\"Unused property found: '%s'\", key)\n+          );\n+        });\n     return getConfigAsMap(String.format(TOPIC_CONSUMER_CONFIG_TEMPLATE, kafkaClusterName, topicName));\n   }\n \n+  private Optional<String> findAnyMatchedKey(String pattern) {\n+    Pattern compiledPattern = Pattern.compile(pattern);\n+    return fileSettings.getProperties().keySet()\n+        .stream()\n+        .filter(String.class::isInstance)\n+        .map(key -> (String) key)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f3321e99e2b0039374bbb31661fc61230b14296"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adea320f03d9c7a4cc6d596165c189a95d8e4500", "author": {"user": {"login": "alexeydubinin", "name": "Alexey Dubinin"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/adea320f03d9c7a4cc6d596165c189a95d8e4500", "committedDate": "2020-07-02T12:48:05Z", "message": "HH-112089 do not start kafka consumer if found unsupported properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNjQ3MDI1", "url": "https://github.com/hhru/nuts-and-bolts/pull/250#pullrequestreview-441647025", "createdAt": "2020-07-02T12:51:53Z", "commit": {"oid": "adea320f03d9c7a4cc6d596165c189a95d8e4500"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMjo1MTo1M1rOGsLcOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMjo1MTo1M1rOGsLcOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk3Nzk3Ng==", "bodyText": "checkNames \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u0438\u0432\u0430\u0442\u043d\u044b\u043c \u0441\u0434\u0435\u043b\u0430\u0442\u044c", "url": "https://github.com/hhru/nuts-and-bolts/pull/250#discussion_r448977976", "createdAt": "2020-07-02T12:51:53Z", "author": {"login": "bokshitsky"}, "path": "nab-kafka/src/main/java/ru/hh/nab/kafka/util/ConfigProvider.java", "diffHunk": "@@ -83,16 +88,45 @@ private void checkConfig(FileSettings nabConsumerSettings, FileSettings allConsu\n           String.format(\"'%s' should not be larger then '%s'\", BACKOFF_MAX_INTERVAL_NAME, MAX_POLL_INTERVAL_MS_CONFIG)\n       );\n     }\n+    checkNames(allConsumerSettings);\n+  }\n+\n+  void checkNames(FileSettings allConsumerSettings) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adea320f03d9c7a4cc6d596165c189a95d8e4500"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNjQ3NDk0", "url": "https://github.com/hhru/nuts-and-bolts/pull/250#pullrequestreview-441647494", "createdAt": "2020-07-02T12:52:26Z", "commit": {"oid": "adea320f03d9c7a4cc6d596165c189a95d8e4500"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMjo1MjoyNlrOGsLdxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMjo1MjoyNlrOGsLdxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk3ODM3NA==", "bodyText": "\u0414\u0443\u043c\u0430\u044e, \u043b\u0443\u0447\u0448\u0435 \u0430\u0433\u0440\u0435\u0433\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u0441\u0435 \u043a\u043b\u044e\u0447\u0438 \u043d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0435 \u0438 \u0432 \u043e\u0448\u0438\u0431\u043a\u0435 \u0438\u0445 \u0431\u0440\u043e\u0441\u0438\u0442\u044c, \u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043f\u044f\u0442\u0443\u044e", "url": "https://github.com/hhru/nuts-and-bolts/pull/250#discussion_r448978374", "createdAt": "2020-07-02T12:52:26Z", "author": {"login": "bokshitsky"}, "path": "nab-kafka/src/main/java/ru/hh/nab/kafka/util/ConfigProvider.java", "diffHunk": "@@ -83,16 +88,45 @@ private void checkConfig(FileSettings nabConsumerSettings, FileSettings allConsu\n           String.format(\"'%s' should not be larger then '%s'\", BACKOFF_MAX_INTERVAL_NAME, MAX_POLL_INTERVAL_MS_CONFIG)\n       );\n     }\n+    checkNames(allConsumerSettings);\n+  }\n+\n+  void checkNames(FileSettings allConsumerSettings) {\n+    Set<String> supportedNames = ConsumerConfig.configNames();\n+    allConsumerSettings.getProperties().keySet().forEach(key -> {\n+      if (!supportedNames.contains(key)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adea320f03d9c7a4cc6d596165c189a95d8e4500"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNjU2MTYw", "url": "https://github.com/hhru/nuts-and-bolts/pull/250#pullrequestreview-441656160", "createdAt": "2020-07-02T13:03:11Z", "commit": {"oid": "adea320f03d9c7a4cc6d596165c189a95d8e4500"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMzowMzoxMVrOGsL4dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxMzowMzoxMVrOGsL4dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk4NTIwNg==", "bodyText": "\u0430 \u0442\u0435\u0441\u0442\u044b \u0441\u0432\u0435\u0440\u0445\u0443 \u0432\u043e\u043e\u0431\u0449\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u044e\u0442?", "url": "https://github.com/hhru/nuts-and-bolts/pull/250#discussion_r448985206", "createdAt": "2020-07-02T13:03:11Z", "author": {"login": "SCREEN88"}, "path": "nab-kafka/src/test/java/ru/hh/nab/kafka/util/ConfigProviderTest.java", "diffHunk": "@@ -70,6 +71,40 @@ public void shouldReturnOverriddenConsumerSettingForSpecificTopic() {\n     assertEquals(defaultValue, result.get(testKey));\n   }\n \n+  @Test\n+  public void shouldFailOnUnusedOverriddenConsumerSettingForSpecificTopic() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adea320f03d9c7a4cc6d596165c189a95d8e4500"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecc29c059011fabc1a3d0d94ce1822b6ea6fff85", "author": {"user": {"login": "alexeydubinin", "name": "Alexey Dubinin"}}, "url": "https://github.com/hhru/nuts-and-bolts/commit/ecc29c059011fabc1a3d0d94ce1822b6ea6fff85", "committedDate": "2020-07-02T13:31:22Z", "message": "HH-112089 notify about several invalid keys at once"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3314, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}