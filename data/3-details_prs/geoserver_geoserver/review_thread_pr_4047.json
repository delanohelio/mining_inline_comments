{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0MzAyMzA0", "number": 4047, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjozMDo1NVrODgrQ1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzoyMToxOFrODgsONw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTg5ODQ0OnYy", "diffSide": "LEFT", "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjozMDo1NVrOFrAjvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzozMDowN1rOFrCUrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0MjIzNw==", "bodyText": "Why doesn't the group.getStyles() already contains the correct style?  When a layer is added the layer group a style is selected right? at that moment it would make  sense to select the right style for remote layers too.", "url": "https://github.com/geoserver/geoserver/pull/4047#discussion_r380642237", "createdAt": "2020-02-18T12:30:55Z", "author": {"login": "nmco"}, "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "diffHunk": "@@ -241,7 +242,18 @@ private static void allStylesForRendering(\n                     PublishedInfo p = group.getLayers().get(i);\n                     StyleInfo s = group.getStyles().get(i);\n                     if (p instanceof LayerInfo) {\n-                        styles.add(group.getStyles().get(i));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "814b6e14c8f3152d45be8125251ca2b69a918423"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY3MTE1MQ==", "bodyText": "because the style group does not know about the layer default", "url": "https://github.com/geoserver/geoserver/pull/4047#discussion_r380671151", "createdAt": "2020-02-18T13:30:07Z", "author": {"login": "imranrajjad"}, "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "diffHunk": "@@ -241,7 +242,18 @@ private static void allStylesForRendering(\n                     PublishedInfo p = group.getLayers().get(i);\n                     StyleInfo s = group.getStyles().get(i);\n                     if (p instanceof LayerInfo) {\n-                        styles.add(group.getStyles().get(i));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0MjIzNw=="}, "originalCommit": {"oid": "814b6e14c8f3152d45be8125251ca2b69a918423"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTkwMzAyOnYy", "diffSide": "RIGHT", "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjozMjoyMlrOFrAmVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjo1MzozM1rOFrBMlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0MjkwMg==", "bodyText": "I find this method hard to read:\n\nWhy is named process layer? it doesn't seem to process anything specific, it just retrieves the correct style for a remote layer no? so why not name it something like getRemoteWmsLayerStyle.\nWhat's the provided styleInfo object?", "url": "https://github.com/geoserver/geoserver/pull/4047#discussion_r380642902", "createdAt": "2020-02-18T12:32:22Z", "author": {"login": "nmco"}, "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "diffHunk": "@@ -531,6 +543,29 @@ private static void expandStyleGroup(\n         }\n     }\n \n+    /**\n+     * Ensures that WMSLayer Info inside layergroup associates with correct remote style\n+     *\n+     * @return returns a compatible StyleInfo representing a remote style if required\n+     */\n+    private static StyleInfo processWMSLayer(WMSLayerInfo wmsLayerInfo, StyleInfo styleInfo) {\n+\n+        if (styleInfo == null) styleInfo = wmsLayerInfo.getDefaultStyle();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "814b6e14c8f3152d45be8125251ca2b69a918423"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY1MjY5Mg==", "bodyText": "understood will change name.\nThe provided style is whatever style was configured against the layer during layergroup configuration. In case of cascaded wms layer, its the default raster", "url": "https://github.com/geoserver/geoserver/pull/4047#discussion_r380652692", "createdAt": "2020-02-18T12:53:33Z", "author": {"login": "imranrajjad"}, "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "diffHunk": "@@ -531,6 +543,29 @@ private static void expandStyleGroup(\n         }\n     }\n \n+    /**\n+     * Ensures that WMSLayer Info inside layergroup associates with correct remote style\n+     *\n+     * @return returns a compatible StyleInfo representing a remote style if required\n+     */\n+    private static StyleInfo processWMSLayer(WMSLayerInfo wmsLayerInfo, StyleInfo styleInfo) {\n+\n+        if (styleInfo == null) styleInfo = wmsLayerInfo.getDefaultStyle();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0MjkwMg=="}, "originalCommit": {"oid": "814b6e14c8f3152d45be8125251ca2b69a918423"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTkwNjU4OnYy", "diffSide": "RIGHT", "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjozMzozNFrOFrAoZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjozMzozNFrOFrAoZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0MzQyOA==", "bodyText": "If the select style is not a valid style for this layer then an exception should be throw. Otherwise this may hide this fact and everything will look fine until it doesn't.", "url": "https://github.com/geoserver/geoserver/pull/4047#discussion_r380643428", "createdAt": "2020-02-18T12:33:34Z", "author": {"login": "nmco"}, "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "diffHunk": "@@ -531,6 +543,29 @@ private static void expandStyleGroup(\n         }\n     }\n \n+    /**\n+     * Ensures that WMSLayer Info inside layergroup associates with correct remote style\n+     *\n+     * @return returns a compatible StyleInfo representing a remote style if required\n+     */\n+    private static StyleInfo processWMSLayer(WMSLayerInfo wmsLayerInfo, StyleInfo styleInfo) {\n+\n+        if (styleInfo == null) styleInfo = wmsLayerInfo.getDefaultStyle();\n+        else if (!wmsLayerInfo.findRemoteStyleByName(styleInfo.getName()).isPresent()) {\n+            if (LOGGER.isLoggable(Level.FINE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "814b6e14c8f3152d45be8125251ca2b69a918423"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NjA1NTU5OnYy", "diffSide": "RIGHT", "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzoyMToxOFrOFrCDBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzoyOToyOVrOFrCTfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY2NjYzMQ==", "bodyText": "Resourcer?", "url": "https://github.com/geoserver/geoserver/pull/4047#discussion_r380666631", "createdAt": "2020-02-18T13:21:18Z", "author": {"login": "aaime"}, "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "diffHunk": "@@ -531,6 +543,29 @@ private static void expandStyleGroup(\n         }\n     }\n \n+    /**\n+     * Ensures that WMSLayer Info inside layergroup associates with correct remote style\n+     *\n+     * @return returns a compatible StyleInfo representing a remote style if required\n+     */\n+    private static StyleInfo processWMSLayer(WMSLayerInfo wmsLayerInfo, StyleInfo styleInfo) {\n+\n+        if (styleInfo == null) styleInfo = wmsLayerInfo.getDefaultStyle();\n+        else if (!wmsLayerInfo.findRemoteStyleByName(styleInfo.getName()).isPresent()) {\n+            if (LOGGER.isLoggable(Level.FINE)) {\n+                LOGGER.fine(\n+                        styleInfo.getName()\n+                                + \" style is not a known remote style for WMS Layer \"\n+                                + wmsLayerInfo\n+                                + \",\"\n+                                + \" Re-configure the Resourcer\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "814b6e14c8f3152d45be8125251ca2b69a918423"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY3MDg0NA==", "bodyText": "\ud83e\udd26\u200d\u2642", "url": "https://github.com/geoserver/geoserver/pull/4047#discussion_r380670844", "createdAt": "2020-02-18T13:29:29Z", "author": {"login": "imranrajjad"}, "path": "src/main/src/main/java/org/geoserver/catalog/LayerGroupHelper.java", "diffHunk": "@@ -531,6 +543,29 @@ private static void expandStyleGroup(\n         }\n     }\n \n+    /**\n+     * Ensures that WMSLayer Info inside layergroup associates with correct remote style\n+     *\n+     * @return returns a compatible StyleInfo representing a remote style if required\n+     */\n+    private static StyleInfo processWMSLayer(WMSLayerInfo wmsLayerInfo, StyleInfo styleInfo) {\n+\n+        if (styleInfo == null) styleInfo = wmsLayerInfo.getDefaultStyle();\n+        else if (!wmsLayerInfo.findRemoteStyleByName(styleInfo.getName()).isPresent()) {\n+            if (LOGGER.isLoggable(Level.FINE)) {\n+                LOGGER.fine(\n+                        styleInfo.getName()\n+                                + \" style is not a known remote style for WMS Layer \"\n+                                + wmsLayerInfo\n+                                + \",\"\n+                                + \" Re-configure the Resourcer\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY2NjYzMQ=="}, "originalCommit": {"oid": "814b6e14c8f3152d45be8125251ca2b69a918423"}, "originalPosition": 47}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4083, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}