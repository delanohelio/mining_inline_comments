{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NzEwMTM0", "number": 4451, "title": "[GEOS-9716] Add simple output formats support for complex features", "bodyText": "This PR adds Simple features output formats support for App-Schema complex features, by adding a configuration (disabled by default) on WFS service and Layer configuration.\nThis functionality will allow GeoServer to convert complex features to Simple feature for output formats that only work with simple features like:\n\nCSV\nKML\nSHAPE-ZIP\n\nTicket:\nhttps://osgeo-org.atlassian.net/browse/GEOS-9716\nChecklist\n\nReviewing is a process done by project maintainers, mostly on a volunteer basis. We try to keep the overhead as small as possible and appreciate if you help us to do so by completing the following items. Feel free to ask in a comment if you have troubles with any of them.\n\nSubmitting the PR does not require you to check all items, but by the time it gets merged, they should be either satisfied or inapplicable.\nFor all pull requests:\n\n Confirm you have read the contribution guidelines\n You have sent a Contribution Licence Agreement (CLA) as necessary (not required for small changes, e.g., fixing typos in documentation)\n Make sure the first PR targets the master branch, eventual backports will be managed later. This can be ignored if the PR is fixing an issue that only happens in a specific branch, but not in newer ones.\n\nThe following are required only for core and extension modules (they are welcomed, but not required, for community modules):\n\n There is a ticket in Jira describing the issue/improvement/feature (a notable exemptions is, changes not visible to end users)\n PR for bug fixes and small new features are presented as a single commit\n Commit message must be in the form \"[GEOS-XYZW] Title of the Jira ticket\" (export to XML in Jira generates the message in this exact form)\n The pull request contains changes related to a single objective. If multiple focuses cannot be avoided, each one is in its own commit and has a separate ticket describing it.\n New unit tests have been added covering the changes\n This PR passes all existing unit tests (test results will be reported by travis-ci after opening this PR)\n This PR passes the QA checks (QA checks results will be reported by travis-ci after opening this PR)\n Commits changing the UI, existing user workflows, or adding new functionality, need to include documentation updates (screenshots, text)\n Commits changing the REST API, or any configuration object, should check if the REST API docs (Swagger YAML files and classic documentation) need to be updated.", "createdAt": "2020-08-14T00:58:40Z", "url": "https://github.com/geoserver/geoserver/pull/4451", "merged": true, "mergeCommit": {"oid": "2894d58bc9a921ab0dfbdd59670670c2830514f3"}, "closed": true, "closedAt": "2020-08-31T16:45:29Z", "author": {"login": "fernandor777"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-zkB9ABqjM2NTU5OTQzNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCGdFegBqjM2ODY1ODU0NTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6db7bdda763247ca47b3413a9cc64a3641f3f418", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/6db7bdda763247ca47b3413a9cc64a3641f3f418", "committedDate": "2020-08-14T00:57:12Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}, "afterCommit": {"oid": "89d99c07db56f2ab81ec29de62995ac918c1e8e7", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/89d99c07db56f2ab81ec29de62995ac918c1e8e7", "committedDate": "2020-08-14T12:13:34Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89d99c07db56f2ab81ec29de62995ac918c1e8e7", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/89d99c07db56f2ab81ec29de62995ac918c1e8e7", "committedDate": "2020-08-14T12:13:34Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}, "afterCommit": {"oid": "be10c1832ee01e1031f212765d2c8ca3b823755e", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/be10c1832ee01e1031f212765d2c8ca3b823755e", "committedDate": "2020-08-14T12:44:18Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be10c1832ee01e1031f212765d2c8ca3b823755e", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/be10c1832ee01e1031f212765d2c8ca3b823755e", "committedDate": "2020-08-14T12:44:18Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}, "afterCommit": {"oid": "83a289058a679510d919a6193f9b3c63a0ea91f2", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/83a289058a679510d919a6193f9b3c63a0ea91f2", "committedDate": "2020-08-14T13:30:19Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "83a289058a679510d919a6193f9b3c63a0ea91f2", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/83a289058a679510d919a6193f9b3c63a0ea91f2", "committedDate": "2020-08-14T13:30:19Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}, "afterCommit": {"oid": "71e7356cd3ce68142a35050d02d44c51c5712f78", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/71e7356cd3ce68142a35050d02d44c51c5712f78", "committedDate": "2020-08-14T14:00:47Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "71e7356cd3ce68142a35050d02d44c51c5712f78", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/71e7356cd3ce68142a35050d02d44c51c5712f78", "committedDate": "2020-08-14T14:00:47Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}, "afterCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/a369b17177d37afbc3e9d3cbe180f91423b3c4d5", "committedDate": "2020-08-14T14:37:29Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NDQ0MTY1", "url": "https://github.com/geoserver/geoserver/pull/4451#pullrequestreview-468444165", "createdAt": "2020-08-17T13:06:18Z", "commit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMzowNjoxOFrOHBn8AA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxMzo0NzowM1rOHBpdzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ2NDk2MA==", "bodyText": "This is a mouthful. I'd go with \"simpleConversionEnabled\"", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r471464960", "createdAt": "2020-08-17T13:06:18Z", "author": {"login": "aaime"}, "path": "src/main/src/main/java/org/geoserver/catalog/impl/ResourceInfoImpl.java", "diffHunk": "@@ -77,6 +77,8 @@\n \n     protected List<String> disabledServices = new ArrayList<>();\n \n+    protected Boolean activateComplexToSimpleOutput = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ2NTE3NA==", "bodyText": "It's a getter for a boolean, should use \"is\" instead of \"get\" as the prefix.", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r471465174", "createdAt": "2020-08-17T13:06:45Z", "author": {"login": "aaime"}, "path": "src/main/src/main/java/org/geoserver/catalog/impl/ResourceInfoImpl.java", "diffHunk": "@@ -383,6 +385,16 @@ public void setDisabledServices(List<String> disabledServices) {\n         this.disabledServices = disabledServices;\n     }\n \n+    @Override\n+    public Boolean getActivateComplexToSimpleOutput() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ2NzcwMQ==", "bodyText": "The format is not really \"aware\" on its own here... it's more like \"ComplexFeatureUnware\" really, and needs other code to help it with conversion from simple to complex.\nMaybe you should be marking GML3OutputFormat and GeoJSONOutputFormat as ComplexFeatureAware instead, and the XSLT and OGR output formats, with a default implementation of supportsComplexFeatures that returns true all the time.", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r471467701", "createdAt": "2020-08-17T13:11:20Z", "author": {"login": "aaime"}, "path": "src/wfs/src/main/java/org/geoserver/wfs/response/ShapeZipOutputFormat.java", "diffHunk": "@@ -83,7 +83,7 @@\n  * @author ported to gs 1.6.x by Saul Farber, MassGIS, saul.farber@state.ma.us\n  */\n public class ShapeZipOutputFormat extends WFSGetFeatureOutputFormat\n-        implements ApplicationContextAware {\n+        implements ApplicationContextAware, ComplexFeatureAwareFormat {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ3MTgyNQ==", "bodyText": "This name is configuring. Normally modules with \"web\" inside have UI elements and can be removed if the Wicket GUI is tossed away. This one instead seems to contain the complex to simple conversion machinery... should have been named app-schema-core instead.", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r471471825", "createdAt": "2020-08-17T13:18:13Z", "author": {"login": "aaime"}, "path": "src/extension/app-schema/app-schema-web/pom.xml", "diffHunk": "@@ -0,0 +1,198 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+    Copyright (C) 2020 - Open Source Geospatial Foundation. All rights reserved.\n+    This code is licensed under the GPL 2.0 license, available at the root\n+    application directory.\n+-->\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n+    xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n+\n+    <modelVersion>4.0.0</modelVersion>\n+\n+    <parent>\n+        <groupId>org.geoserver.extension</groupId>\n+        <artifactId>gs-app-schema</artifactId>\n+        <version>2.18-SNAPSHOT</version>\n+    </parent>\n+\n+    <groupId>org.geoserver.extension</groupId>\n+    <artifactId>gs-app-schema-web</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ3MjUxNA==", "bodyText": "So here the full, qualified name is used, however, in getComplexAttributeValue, the lookup is made based on the simple name. Confusing?", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r471472514", "createdAt": "2020-08-17T13:19:24Z", "author": {"login": "aaime"}, "path": "src/extension/app-schema/app-schema-web/src/main/java/org/geoserver/complex/ComplexToSimpleFeatureCollection.java", "diffHunk": "@@ -0,0 +1,216 @@\n+/* (c) 2020 Open Source Geospatial Foundation - all rights reserved\n+ * This code is licensed under the GPL 2.0 license, available at the root\n+ * application directory.\n+ */\n+package org.geoserver.complex;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.NoSuchElementException;\n+import java.util.Optional;\n+import java.util.logging.Logger;\n+import org.geotools.data.DataUtilities;\n+import org.geotools.data.simple.SimpleFeatureCollection;\n+import org.geotools.data.simple.SimpleFeatureIterator;\n+import org.geotools.feature.FeatureCollection;\n+import org.geotools.feature.FeatureIterator;\n+import org.geotools.feature.simple.SimpleFeatureBuilder;\n+import org.geotools.filter.AttributeExpressionImpl;\n+import org.geotools.geometry.jts.ReferencedEnvelope;\n+import org.geotools.util.logging.Logging;\n+import org.opengis.feature.Feature;\n+import org.opengis.feature.FeatureVisitor;\n+import org.opengis.feature.Property;\n+import org.opengis.feature.simple.SimpleFeature;\n+import org.opengis.feature.simple.SimpleFeatureType;\n+import org.opengis.feature.type.FeatureType;\n+import org.opengis.feature.type.PropertyDescriptor;\n+import org.opengis.filter.Filter;\n+import org.opengis.filter.sort.SortBy;\n+import org.opengis.util.ProgressListener;\n+import org.xml.sax.helpers.NamespaceSupport;\n+\n+/**\n+ * Feature collection Wrapper. Converts complex features to simple features on the fly based on the\n+ * Layer info rules.\n+ */\n+public class ComplexToSimpleFeatureCollection implements SimpleFeatureCollection {\n+\n+    private static final Logger LOG = Logging.getLogger(ComplexToSimpleFeatureCollection.class);\n+\n+    private final Map<String, String> rulesMap;\n+    private final FeatureCollection<FeatureType, Feature> delegate;\n+    private final NamespaceSupport namespaceSupport;\n+\n+    private final SimpleFeatureType featureType;\n+\n+    /**\n+     * Constructor.\n+     *\n+     * @param rulesMap the complex to simple features transformation rules map\n+     * @param featureCollection the source complex features collection\n+     */\n+    public ComplexToSimpleFeatureCollection(\n+            Map<String, String> rulesMap,\n+            FeatureCollection<FeatureType, Feature> featureCollection,\n+            NamespaceSupport namespaceSupport) {\n+        this.rulesMap = new HashMap(requireNonNull(rulesMap));\n+        this.delegate = requireNonNull(featureCollection);\n+        this.namespaceSupport = requireNonNull(namespaceSupport);\n+        this.featureType = requireNonNull(buildConvertedType());\n+        LOG.fine(() -> \"Converted feature type: \" + featureType);\n+    }\n+\n+    /**\n+     * Builds and returns the simple feature type based on the complex type and the transformation\n+     * rules.\n+     */\n+    protected SimpleFeatureType buildConvertedType() {\n+        FeatureTypeConverter converter =\n+                new FeatureTypeConverter(delegate.getSchema(), rulesMap, namespaceSupport);\n+        return converter.produceSimpleType();\n+    }\n+\n+    @Override\n+    public SimpleFeatureType getSchema() {\n+        return featureType;\n+    }\n+\n+    @Override\n+    public SimpleFeatureIterator features() {\n+        return new ComplexToSimpleFeatureIterator(delegate.features());\n+    }\n+\n+    @Override\n+    public SimpleFeatureCollection subCollection(Filter filter) {\n+        return null;\n+    }\n+\n+    @Override\n+    public SimpleFeatureCollection sort(SortBy order) {\n+        return null;\n+    }\n+\n+    @Override\n+    public String getID() {\n+        return delegate.getID();\n+    }\n+\n+    @Override\n+    public void accepts(FeatureVisitor visitor, ProgressListener progress) throws IOException {\n+        DataUtilities.visit(this, visitor, progress);\n+    }\n+\n+    @Override\n+    public ReferencedEnvelope getBounds() {\n+        return delegate.getBounds();\n+    }\n+\n+    @Override\n+    public boolean contains(Object o) {\n+        return delegate.contains(o);\n+    }\n+\n+    @Override\n+    public boolean containsAll(Collection<?> o) {\n+        return delegate.containsAll(o);\n+    }\n+\n+    @Override\n+    public boolean isEmpty() {\n+        return delegate.isEmpty();\n+    }\n+\n+    @Override\n+    public int size() {\n+        return delegate.size();\n+    }\n+\n+    @Override\n+    public Object[] toArray() {\n+        return getFeaturesList().toArray();\n+    }\n+\n+    @Override\n+    public <O> O[] toArray(O[] a) {\n+        return getFeaturesList().toArray(a);\n+    }\n+\n+    private List<SimpleFeature> getFeaturesList() {\n+        try (SimpleFeatureIterator featureIterator = features()) {\n+            List<SimpleFeature> featuresList = new ArrayList<>();\n+            while (featureIterator.hasNext()) {\n+                featuresList.add(featureIterator.next());\n+            }\n+            return featuresList;\n+        }\n+    }\n+\n+    /** Feature iterator wrapper, converts every complex feature into a simple feature. */\n+    class ComplexToSimpleFeatureIterator implements SimpleFeatureIterator {\n+\n+        private FeatureIterator<Feature> delegate;\n+\n+        public ComplexToSimpleFeatureIterator(FeatureIterator<Feature> delegate) {\n+            this.delegate = delegate;\n+        }\n+\n+        public boolean hasNext() {\n+            return delegate.hasNext();\n+        }\n+\n+        public SimpleFeature next() throws NoSuchElementException {\n+            SimpleFeature simpleFeature = convert(delegate.next());\n+            LOG.finer(() -> \"Converted simple feature: \" + simpleFeature);\n+            return simpleFeature;\n+        }\n+\n+        /**\n+         * Transform the original complex feature into a simple feature, using the convention and\n+         * rules. Returns the resulting simple feature.\n+         */\n+        private SimpleFeature convert(Feature feature) {\n+            SimpleFeatureBuilder builder = new SimpleFeatureBuilder(featureType);\n+            for (PropertyDescriptor descriptor : featureType.getDescriptors()) {\n+                String simpleName = descriptor.getName().getLocalPart();\n+                Object attributeValue = getComplexAttributeValue(simpleName, feature);\n+                builder.set(descriptor.getName(), attributeValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5"}, "originalPosition": 183}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ3NjU4NA==", "bodyText": "Doesn't need to be public, does it?", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r471476584", "createdAt": "2020-08-17T13:25:51Z", "author": {"login": "aaime"}, "path": "src/extension/app-schema/app-schema-web/src/main/java/org/geoserver/complex/ComplexToSimpleOutputCommons.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/* (c) 2020 Open Source Geospatial Foundation - all rights reserved\n+ * This code is licensed under the GPL 2.0 license, available at the root\n+ * application directory.\n+ */\n+package org.geoserver.complex;\n+\n+import java.util.List;\n+import javax.xml.namespace.QName;\n+import org.geoserver.ows.Request;\n+\n+/** Common constants and functions for complex to simple features conversion. */\n+public class ComplexToSimpleOutputCommons {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ3NzExOQ==", "bodyText": "In GeoServer loggers are (almost) uniformly called LOGGER", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r471477119", "createdAt": "2020-08-17T13:26:41Z", "author": {"login": "aaime"}, "path": "src/extension/app-schema/app-schema-web/src/main/java/org/geoserver/complex/ComplexToSimpleFeatureCollection.java", "diffHunk": "@@ -0,0 +1,216 @@\n+/* (c) 2020 Open Source Geospatial Foundation - all rights reserved\n+ * This code is licensed under the GPL 2.0 license, available at the root\n+ * application directory.\n+ */\n+package org.geoserver.complex;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.NoSuchElementException;\n+import java.util.Optional;\n+import java.util.logging.Logger;\n+import org.geotools.data.DataUtilities;\n+import org.geotools.data.simple.SimpleFeatureCollection;\n+import org.geotools.data.simple.SimpleFeatureIterator;\n+import org.geotools.feature.FeatureCollection;\n+import org.geotools.feature.FeatureIterator;\n+import org.geotools.feature.simple.SimpleFeatureBuilder;\n+import org.geotools.filter.AttributeExpressionImpl;\n+import org.geotools.geometry.jts.ReferencedEnvelope;\n+import org.geotools.util.logging.Logging;\n+import org.opengis.feature.Feature;\n+import org.opengis.feature.FeatureVisitor;\n+import org.opengis.feature.Property;\n+import org.opengis.feature.simple.SimpleFeature;\n+import org.opengis.feature.simple.SimpleFeatureType;\n+import org.opengis.feature.type.FeatureType;\n+import org.opengis.feature.type.PropertyDescriptor;\n+import org.opengis.filter.Filter;\n+import org.opengis.filter.sort.SortBy;\n+import org.opengis.util.ProgressListener;\n+import org.xml.sax.helpers.NamespaceSupport;\n+\n+/**\n+ * Feature collection Wrapper. Converts complex features to simple features on the fly based on the\n+ * Layer info rules.\n+ */\n+public class ComplexToSimpleFeatureCollection implements SimpleFeatureCollection {\n+\n+    private static final Logger LOG = Logging.getLogger(ComplexToSimpleFeatureCollection.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4MDQ3OA==", "bodyText": "Careful here, it's true that the string concatenation does not happen unless needed, but the creation of the lambda (which is, itself, also an object, instantiated and carried around) is not avoided. For something happening for all returned features, it should be guarded.", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r471480478", "createdAt": "2020-08-17T13:32:01Z", "author": {"login": "aaime"}, "path": "src/extension/app-schema/app-schema-web/src/main/java/org/geoserver/complex/ComplexToSimpleFeatureCollection.java", "diffHunk": "@@ -0,0 +1,216 @@\n+/* (c) 2020 Open Source Geospatial Foundation - all rights reserved\n+ * This code is licensed under the GPL 2.0 license, available at the root\n+ * application directory.\n+ */\n+package org.geoserver.complex;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.NoSuchElementException;\n+import java.util.Optional;\n+import java.util.logging.Logger;\n+import org.geotools.data.DataUtilities;\n+import org.geotools.data.simple.SimpleFeatureCollection;\n+import org.geotools.data.simple.SimpleFeatureIterator;\n+import org.geotools.feature.FeatureCollection;\n+import org.geotools.feature.FeatureIterator;\n+import org.geotools.feature.simple.SimpleFeatureBuilder;\n+import org.geotools.filter.AttributeExpressionImpl;\n+import org.geotools.geometry.jts.ReferencedEnvelope;\n+import org.geotools.util.logging.Logging;\n+import org.opengis.feature.Feature;\n+import org.opengis.feature.FeatureVisitor;\n+import org.opengis.feature.Property;\n+import org.opengis.feature.simple.SimpleFeature;\n+import org.opengis.feature.simple.SimpleFeatureType;\n+import org.opengis.feature.type.FeatureType;\n+import org.opengis.feature.type.PropertyDescriptor;\n+import org.opengis.filter.Filter;\n+import org.opengis.filter.sort.SortBy;\n+import org.opengis.util.ProgressListener;\n+import org.xml.sax.helpers.NamespaceSupport;\n+\n+/**\n+ * Feature collection Wrapper. Converts complex features to simple features on the fly based on the\n+ * Layer info rules.\n+ */\n+public class ComplexToSimpleFeatureCollection implements SimpleFeatureCollection {\n+\n+    private static final Logger LOG = Logging.getLogger(ComplexToSimpleFeatureCollection.class);\n+\n+    private final Map<String, String> rulesMap;\n+    private final FeatureCollection<FeatureType, Feature> delegate;\n+    private final NamespaceSupport namespaceSupport;\n+\n+    private final SimpleFeatureType featureType;\n+\n+    /**\n+     * Constructor.\n+     *\n+     * @param rulesMap the complex to simple features transformation rules map\n+     * @param featureCollection the source complex features collection\n+     */\n+    public ComplexToSimpleFeatureCollection(\n+            Map<String, String> rulesMap,\n+            FeatureCollection<FeatureType, Feature> featureCollection,\n+            NamespaceSupport namespaceSupport) {\n+        this.rulesMap = new HashMap(requireNonNull(rulesMap));\n+        this.delegate = requireNonNull(featureCollection);\n+        this.namespaceSupport = requireNonNull(namespaceSupport);\n+        this.featureType = requireNonNull(buildConvertedType());\n+        LOG.fine(() -> \"Converted feature type: \" + featureType);\n+    }\n+\n+    /**\n+     * Builds and returns the simple feature type based on the complex type and the transformation\n+     * rules.\n+     */\n+    protected SimpleFeatureType buildConvertedType() {\n+        FeatureTypeConverter converter =\n+                new FeatureTypeConverter(delegate.getSchema(), rulesMap, namespaceSupport);\n+        return converter.produceSimpleType();\n+    }\n+\n+    @Override\n+    public SimpleFeatureType getSchema() {\n+        return featureType;\n+    }\n+\n+    @Override\n+    public SimpleFeatureIterator features() {\n+        return new ComplexToSimpleFeatureIterator(delegate.features());\n+    }\n+\n+    @Override\n+    public SimpleFeatureCollection subCollection(Filter filter) {\n+        return null;\n+    }\n+\n+    @Override\n+    public SimpleFeatureCollection sort(SortBy order) {\n+        return null;\n+    }\n+\n+    @Override\n+    public String getID() {\n+        return delegate.getID();\n+    }\n+\n+    @Override\n+    public void accepts(FeatureVisitor visitor, ProgressListener progress) throws IOException {\n+        DataUtilities.visit(this, visitor, progress);\n+    }\n+\n+    @Override\n+    public ReferencedEnvelope getBounds() {\n+        return delegate.getBounds();\n+    }\n+\n+    @Override\n+    public boolean contains(Object o) {\n+        return delegate.contains(o);\n+    }\n+\n+    @Override\n+    public boolean containsAll(Collection<?> o) {\n+        return delegate.containsAll(o);\n+    }\n+\n+    @Override\n+    public boolean isEmpty() {\n+        return delegate.isEmpty();\n+    }\n+\n+    @Override\n+    public int size() {\n+        return delegate.size();\n+    }\n+\n+    @Override\n+    public Object[] toArray() {\n+        return getFeaturesList().toArray();\n+    }\n+\n+    @Override\n+    public <O> O[] toArray(O[] a) {\n+        return getFeaturesList().toArray(a);\n+    }\n+\n+    private List<SimpleFeature> getFeaturesList() {\n+        try (SimpleFeatureIterator featureIterator = features()) {\n+            List<SimpleFeature> featuresList = new ArrayList<>();\n+            while (featureIterator.hasNext()) {\n+                featuresList.add(featureIterator.next());\n+            }\n+            return featuresList;\n+        }\n+    }\n+\n+    /** Feature iterator wrapper, converts every complex feature into a simple feature. */\n+    class ComplexToSimpleFeatureIterator implements SimpleFeatureIterator {\n+\n+        private FeatureIterator<Feature> delegate;\n+\n+        public ComplexToSimpleFeatureIterator(FeatureIterator<Feature> delegate) {\n+            this.delegate = delegate;\n+        }\n+\n+        public boolean hasNext() {\n+            return delegate.hasNext();\n+        }\n+\n+        public SimpleFeature next() throws NoSuchElementException {\n+            SimpleFeature simpleFeature = convert(delegate.next());\n+            LOG.finer(() -> \"Converted simple feature: \" + simpleFeature);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5"}, "originalPosition": 170}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4MzExMQ==", "bodyText": "Just thinking out loud here... is this enough? Does one have a workspace for all secondary namespaces when setting up an app-schema mapping?", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r471483111", "createdAt": "2020-08-17T13:36:25Z", "author": {"login": "aaime"}, "path": "src/extension/app-schema/app-schema-web/src/main/java/org/geoserver/complex/ComplexToSimpleOutputHandler.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/* (c) 2020 Open Source Geospatial Foundation - all rights reserved\n+ * This code is licensed under the GPL 2.0 license, available at the root\n+ * application directory.\n+ */\n+package org.geoserver.complex;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.logging.Logger;\n+import javax.xml.namespace.QName;\n+import org.geoserver.catalog.Catalog;\n+import org.geoserver.catalog.LayerInfo;\n+import org.geoserver.catalog.MetadataMap;\n+import org.geoserver.catalog.NamespaceInfo;\n+import org.geoserver.ows.Request;\n+import org.geoserver.wfs.request.FeatureCollectionResponse;\n+import org.geotools.feature.NameImpl;\n+import org.geotools.util.logging.Logging;\n+import org.opengis.feature.type.Name;\n+import org.xml.sax.helpers.NamespaceSupport;\n+\n+/**\n+ * Performs the complex to simple feature collection transformation returning the wrapped feature\n+ * collection.\n+ */\n+public class ComplexToSimpleOutputHandler {\n+\n+    private static final Logger LOG = Logging.getLogger(ComplexToSimpleOutputHandler.class);\n+\n+    private final FeatureCollectionResponse result;\n+    private final Catalog catalog;\n+\n+    private final QName layerName;\n+\n+    public ComplexToSimpleOutputHandler(\n+            Request request, FeatureCollectionResponse result, Catalog catalog) {\n+        this.result = requireNonNull(result);\n+        this.catalog = requireNonNull(catalog);\n+        this.layerName = requireNonNull(ComplexToSimpleOutputCommons.getLayerName(request));\n+    }\n+\n+    /** Performs the transformation and returns the decorated Feature collection . */\n+    public Object execute() {\n+        LOG.fine(() -> \"Executing handler for layer name: \" + layerName);\n+        // get the rules map\n+        Map<String, String> rulesMap = getRulesMap();\n+        // get the feature collection\n+        @SuppressWarnings(\"unchecked\")\n+        ComplexToSimpleFeatureCollection collection =\n+                new ComplexToSimpleFeatureCollection(\n+                        rulesMap, result.getFeature().get(0), buildNamespaceSupport(catalog));\n+        // return the correct type based on the input collection response type\n+        if (result instanceof FeatureCollectionResponse.WFS20) {\n+            return new ComplexToSimpleFeatureCollectionResponse20(result, collection);\n+        } else if (result instanceof FeatureCollectionResponse.WFS11) {\n+            return new ComplexToSimpleFeatureCollectionResponse11(result, collection);\n+        }\n+        return collection;\n+    }\n+\n+    /** Returns the transformation rules map from the GeoServer layer configurations. */\n+    @SuppressWarnings(\"unchecked\")\n+    private Map<String, String> getRulesMap() {\n+        Name name = new NameImpl(layerName);\n+        LayerInfo layerInfo = catalog.getLayerByName(name);\n+        MetadataMap metadataMap = layerInfo.getMetadata();\n+        Map<String, String> map =\n+                metadataMap.get(ComplexToSimpleOutputCommons.RULES_METADATAMAP_KEY, Map.class);\n+        if (map == null) {\n+            LOG.fine(() -> \"Rules map not found on layer: \" + layerInfo);\n+            return Collections.emptyMap();\n+        }\n+        LOG.fine(() -> \"Rules map found: \" + map);\n+        return map;\n+    }\n+\n+    /**\n+     * Builds the {@link NamespaceSupport} instance from the catalog available namespaces.\n+     *\n+     * @param catalog the GeoServer catalog\n+     * @return the resulting instance\n+     */\n+    private NamespaceSupport buildNamespaceSupport(Catalog catalog) {\n+        List<NamespaceInfo> namespaces = catalog.getNamespaces();\n+        NamespaceSupport nsSupport = new NamespaceSupport();\n+        for (NamespaceInfo namespaceInfo : namespaces) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4NjcxOQ==", "bodyText": "Guess also this class could have been package private. In general, I'd suggest to limit visibility to the minimum actually needed, makes easier to change classes/methods later, no backwards compatibility to preserve.", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r471486719", "createdAt": "2020-08-17T13:42:02Z", "author": {"login": "aaime"}, "path": "src/extension/app-schema/app-schema-web/src/main/java/org/geoserver/complex/FeatureTypeConverter.java", "diffHunk": "@@ -0,0 +1,187 @@\n+/* (c) 2020 Open Source Geospatial Foundation - all rights reserved\n+ * This code is licensed under the GPL 2.0 license, available at the root\n+ * application directory.\n+ */\n+package org.geoserver.complex;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Optional;\n+import java.util.logging.Logger;\n+import org.geotools.feature.simple.SimpleFeatureTypeBuilder;\n+import org.geotools.filter.AttributeExpressionImpl;\n+import org.geotools.util.logging.Logging;\n+import org.opengis.feature.simple.SimpleFeatureType;\n+import org.opengis.feature.type.AttributeDescriptor;\n+import org.opengis.feature.type.AttributeType;\n+import org.opengis.feature.type.FeatureType;\n+import org.opengis.feature.type.GeometryDescriptor;\n+import org.opengis.feature.type.Name;\n+import org.opengis.feature.type.PropertyDescriptor;\n+import org.xml.sax.helpers.NamespaceSupport;\n+\n+/**\n+ * Converts a complex feature type to a simple one based on the provided transformation rules map.\n+ */\n+public class FeatureTypeConverter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4NzQ5NA==", "bodyText": "Single method used only in the dispatcher callback, why roll a separate class for it?", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r471487494", "createdAt": "2020-08-17T13:43:12Z", "author": {"login": "aaime"}, "path": "src/extension/app-schema/app-schema-web/src/main/java/org/geoserver/complex/OutputFormatsSupport.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/* (c) 2020 Open Source Geospatial Foundation - all rights reserved\n+ * This code is licensed under the GPL 2.0 license, available at the root\n+ * application directory.\n+ */\n+package org.geoserver.complex;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import org.apache.commons.lang3.StringUtils;\n+import org.geoserver.platform.GeoServerExtensions;\n+import org.geoserver.platform.Operation;\n+import org.geoserver.wfs.WFSGetFeatureOutputFormat;\n+import org.geoserver.wfs.response.ComplexFeatureAwareFormat;\n+\n+/**\n+ * Provides high level function to check if the provided format is supported by complex to simple\n+ * features conversion.\n+ */\n+public class OutputFormatsSupport {\n+\n+    /** Checks if the provided format is supported by complex to simple features conversion. */\n+    public static boolean isSupported(String format, Object value, Operation operation) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4OTAzMg==", "bodyText": "Good! I would also check that GML3 encoding was unaffected (e..g, did not lose namespaces and the like).", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r471489032", "createdAt": "2020-08-17T13:45:32Z", "author": {"login": "aaime"}, "path": "src/extension/app-schema/app-schema-test/src/test/java/org/geoserver/test/SimpleOutputTest.java", "diffHunk": "@@ -0,0 +1,276 @@\n+/* (c) 2020 Open Source Geospatial Foundation - all rights reserved\n+ * This code is licensed under the GPL 2.0 license, available at the root\n+ * application directory.\n+ */\n+package org.geoserver.test;\n+\n+import static org.geoserver.complex.ComplexToSimpleOutputCommons.RULES_METADATAMAP_KEY;\n+import static org.junit.Assert.assertEquals;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.custommonkey.xmlunit.SimpleNamespaceContext;\n+import org.custommonkey.xmlunit.XMLUnit;\n+import org.custommonkey.xmlunit.XpathEngine;\n+import org.custommonkey.xmlunit.exceptions.XpathException;\n+import org.geoserver.catalog.Catalog;\n+import org.geoserver.catalog.FeatureTypeInfo;\n+import org.geoserver.catalog.LayerInfo;\n+import org.geoserver.catalog.MetadataMap;\n+import org.geoserver.catalog.WorkspaceInfo;\n+import org.geoserver.data.test.SystemTestData;\n+import org.geotools.data.DataAccess;\n+import org.geotools.data.FeatureSource;\n+import org.geotools.data.complex.AppSchemaDataAccess;\n+import org.geotools.feature.NameImpl;\n+import org.geotools.jdbc.JDBCFeatureStore;\n+import org.junit.Test;\n+import org.opengis.feature.type.Name;\n+import org.w3c.dom.Document;\n+\n+/** Set of tests for simple output formats on complex features requests. */\n+public class SimpleOutputTest extends StationsAppSchemaTestSupport {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ4OTk5Nw==", "bodyText": "One might wonder why this is even needed. I'd at least suggest to explain that it would come with some loss of information. Or it could be made even simpler, and just happen if the target output format is not able to handle complex features natively, the current alternative is a hard exception... what would be the harm?", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r471489997", "createdAt": "2020-08-17T13:47:03Z", "author": {"login": "aaime"}, "path": "doc/en/user/source/data/webadmin/layers.rst", "diffHunk": "@@ -297,6 +297,7 @@ Sets the WFS specific publishing parameters.\n \n * **Per-Request Feature Limit**\u2014Sets the maximum number of features for a layer a WFS GetFeature operation should generate (regardless of the actual number of query hits)\n * **Maximum number of decimals**\u2014Sets the maximum number of decimals in GML output.\n+* **Activate complex to simple features conversion** - Enables the conversion of complex features to simple features, using only SF-0 (simple) attributes for compatible output formats like CSV, KML, SHAPE-ZIP.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a369b17177d37afbc3e9d3cbe180f91423b3c4d5", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/a369b17177d37afbc3e9d3cbe180f91423b3c4d5", "committedDate": "2020-08-14T14:37:29Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}, "afterCommit": {"oid": "b2266fe9d1998ca17527335852b6badf0e571596", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/b2266fe9d1998ca17527335852b6badf0e571596", "committedDate": "2020-08-17T23:26:52Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2266fe9d1998ca17527335852b6badf0e571596", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/b2266fe9d1998ca17527335852b6badf0e571596", "committedDate": "2020-08-17T23:26:52Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}, "afterCommit": {"oid": "79c7cd501ecadded1948c46021ee75e50c4e2d72", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/79c7cd501ecadded1948c46021ee75e50c4e2d72", "committedDate": "2020-08-17T23:49:57Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "79c7cd501ecadded1948c46021ee75e50c4e2d72", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/79c7cd501ecadded1948c46021ee75e50c4e2d72", "committedDate": "2020-08-17T23:49:57Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}, "afterCommit": {"oid": "6612cc479ae740200d67e73d37f47fbbdf8247aa", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/6612cc479ae740200d67e73d37f47fbbdf8247aa", "committedDate": "2020-08-18T03:24:47Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6612cc479ae740200d67e73d37f47fbbdf8247aa", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/6612cc479ae740200d67e73d37f47fbbdf8247aa", "committedDate": "2020-08-18T03:24:47Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}, "afterCommit": {"oid": "87f2df9defc0c8b858eaf98adaa11284d73492ce", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/87f2df9defc0c8b858eaf98adaa11284d73492ce", "committedDate": "2020-08-19T13:00:41Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "87f2df9defc0c8b858eaf98adaa11284d73492ce", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/87f2df9defc0c8b858eaf98adaa11284d73492ce", "committedDate": "2020-08-19T13:00:41Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}, "afterCommit": {"oid": "46ed29882630432766644c98dd8abda06569dd25", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/46ed29882630432766644c98dd8abda06569dd25", "committedDate": "2020-08-19T14:52:29Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "46ed29882630432766644c98dd8abda06569dd25", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/46ed29882630432766644c98dd8abda06569dd25", "committedDate": "2020-08-19T14:52:29Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}, "afterCommit": {"oid": "5d01155a54cc74f41a2a320613a750afb30e1cfb", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/5d01155a54cc74f41a2a320613a750afb30e1cfb", "committedDate": "2020-08-21T16:09:29Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMzQwNDA4", "url": "https://github.com/geoserver/geoserver/pull/4451#pullrequestreview-473340408", "createdAt": "2020-08-24T10:25:40Z", "commit": {"oid": "5d01155a54cc74f41a2a320613a750afb30e1cfb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMDoyNTo0MFrOHFeOAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxMDozMDo1OFrOHFehkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUwMDAzNQ==", "bodyText": "As per my previous comment, this is a boolean properly, should be using \"is\" instead of \"get\":\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Boolean getSimpleConversionEnabled();\n          \n          \n            \n                Boolean isSimpleConversionEnabled();", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r475500035", "createdAt": "2020-08-24T10:25:40Z", "author": {"login": "aaime"}, "path": "src/main/src/main/java/org/geoserver/catalog/ResourceInfo.java", "diffHunk": "@@ -374,4 +374,16 @@\n \n     /** Set the list of disabled services names for this resource */\n     void setDisabledServices(List<String> disabledServices);\n+\n+    /**\n+     * Flag that determines if complex features will be converted to simple feature for compatible\n+     * output formats.\n+     */\n+    Boolean getSimpleConversionEnabled();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d01155a54cc74f41a2a320613a750afb30e1cfb"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUwNTA0MQ==", "bodyText": "Typo (and while I was at it, expanded explanation:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * **Activate complex to simple features conversion** - If the target output format does not handle complex features nativelty, this option enables the conversion of complex features to simple features, using only SF-0 (simple) attributes.  This means that nested features and multiple-value attributes will be omitted from the final result.\n          \n          \n            \n            * **Activate complex to simple features conversion** - If the target output format does not handle complex features natively, this option enables the conversion of complex features to simple features, using only SF-0 (simple) attributes.  This means that nested features and multiple-value attributes will be omitted from the final result, instead of throwing errors while generating the output. Output formats capable of handling complex features are not affected.", "url": "https://github.com/geoserver/geoserver/pull/4451#discussion_r475505041", "createdAt": "2020-08-24T10:30:58Z", "author": {"login": "aaime"}, "path": "doc/en/user/source/data/webadmin/layers.rst", "diffHunk": "@@ -297,6 +297,7 @@ Sets the WFS specific publishing parameters.\n \n * **Per-Request Feature Limit**\u2014Sets the maximum number of features for a layer a WFS GetFeature operation should generate (regardless of the actual number of query hits)\n * **Maximum number of decimals**\u2014Sets the maximum number of decimals in GML output.\n+* **Activate complex to simple features conversion** - If the target output format does not handle complex features nativelty, this option enables the conversion of complex features to simple features, using only SF-0 (simple) attributes.  This means that nested features and multiple-value attributes will be omitted from the final result.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d01155a54cc74f41a2a320613a750afb30e1cfb"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "494558e6bc5e18b8bea0a2071325d9b0d101157b", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/494558e6bc5e18b8bea0a2071325d9b0d101157b", "committedDate": "2020-08-24T17:56:02Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d01155a54cc74f41a2a320613a750afb30e1cfb", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/5d01155a54cc74f41a2a320613a750afb30e1cfb", "committedDate": "2020-08-21T16:09:29Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}, "afterCommit": {"oid": "494558e6bc5e18b8bea0a2071325d9b0d101157b", "author": {"user": {"login": "fernandor777", "name": "Fernando Mi\u00f1o"}}, "url": "https://github.com/geoserver/geoserver/commit/494558e6bc5e18b8bea0a2071325d9b0d101157b", "committedDate": "2020-08-24T17:56:02Z", "message": "[GEOS-9716] Add simple output formats support for complex features"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1543, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}