{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3Njk1ODU4", "number": 4074, "title": "[GEOS-9508] [GEOS-6175] Static content not displayed + Text doesn't fit the legend box", "bodyText": "\u2026n the style\n\nChecklist\n\nReviewing is a process done by project maintainers, mostly on a volunteer basis. We try to keep the overhead as small as possible and appreciate if you help us to do so by completing the following items. Feel free to ask in a comment if you have troubles with any of them.\n\nFor all pull requests:\n\n Confirm you have read the contribution guidelines\n You have sent a Contribution Licence Agreement (CLA) as necessary (not required for small changes, e.g., fixing typos in documentation)\n Make sure the first PR targets the master branch, eventual backports will be managed later. This can be ignored if the PR is fixing an issue that only happens in a specific branch, but not in newer ones.\n\nThe following are required only for core and extension modules (they are welcomed, but not required, for community modules):\n\n There is a ticket in Jira describing the issue/improvement/feature (a notable exemptions is, changes not visible to end users)\n PR for bug fixes and small new features are presented as a single commit\n Commit message must be in the form \"[GEOS-XYZW] Title of the Jira ticket\" (export to XML in Jira generates the message in this exact form)\n New unit tests have been added covering the changes\n This PR passes all existing unit tests (test results will be reported by travis-ci after opening this PR)\n This PR passes the QA checks (QA checks results will be reported by travis-ci after opening this PR)\n Commits changing the UI, existing user workflows, or adding new functionality, need to include documentation updates (screenshots, text)\n Committs changing the REST API, or any configuration object, should check it the REST API docs (Swagger YAML files and classic documentation) need to be updated.\n\nSubmitting the PR does not require you to check all items, but by the time it gets merged, they should be either satisfied or inapplicable.", "createdAt": "2020-02-20T11:15:12Z", "url": "https://github.com/geoserver/geoserver/pull/4074", "merged": true, "mergeCommit": {"oid": "caec58d462bc212a8ef6770b541cee529d8fb759"}, "closed": true, "closedAt": "2020-03-02T11:38:21Z", "author": {"login": "taba90"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGJSt2gBqjMwNTU0NTYyOTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJqnwJABqjMwODcxODc1Mzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "da7336b81f136fa8dccaf72e1f61a2277bb359e8", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/da7336b81f136fa8dccaf72e1f61a2277bb359e8", "committedDate": "2020-02-20T11:14:24Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}, "afterCommit": {"oid": "0517f6b2d98dd8370c17a2dc5b0c826f9cb0ed61", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/0517f6b2d98dd8370c17a2dc5b0c826f9cb0ed61", "committedDate": "2020-02-20T11:18:43Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0517f6b2d98dd8370c17a2dc5b0c826f9cb0ed61", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/0517f6b2d98dd8370c17a2dc5b0c826f9cb0ed61", "committedDate": "2020-02-20T11:18:43Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}, "afterCommit": {"oid": "f81711307f459bc13e6779442964b13bc180463e", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/f81711307f459bc13e6779442964b13bc180463e", "committedDate": "2020-02-20T11:24:22Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f81711307f459bc13e6779442964b13bc180463e", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/f81711307f459bc13e6779442964b13bc180463e", "committedDate": "2020-02-20T11:24:22Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}, "afterCommit": {"oid": "45df530b046d16064e57a7e3b93d3e1f8df7435f", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/45df530b046d16064e57a7e3b93d3e1f8df7435f", "committedDate": "2020-02-20T12:32:43Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "45df530b046d16064e57a7e3b93d3e1f8df7435f", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/45df530b046d16064e57a7e3b93d3e1f8df7435f", "committedDate": "2020-02-20T12:32:43Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}, "afterCommit": {"oid": "0a88580a436b5ab0e7ddb87981970b3047e325df", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/0a88580a436b5ab0e7ddb87981970b3047e325df", "committedDate": "2020-02-20T12:51:44Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a88580a436b5ab0e7ddb87981970b3047e325df", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/0a88580a436b5ab0e7ddb87981970b3047e325df", "committedDate": "2020-02-20T12:51:44Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}, "afterCommit": {"oid": "7a4366e5164f3b8c9d85424c4ac90ea37041ec35", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/7a4366e5164f3b8c9d85424c4ac90ea37041ec35", "committedDate": "2020-02-20T14:41:01Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a4366e5164f3b8c9d85424c4ac90ea37041ec35", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/7a4366e5164f3b8c9d85424c4ac90ea37041ec35", "committedDate": "2020-02-20T14:41:01Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}, "afterCommit": {"oid": "50110cf44ec2f8bd14f24d0d71a2e19c49cd71f0", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/50110cf44ec2f8bd14f24d0d71a2e19c49cd71f0", "committedDate": "2020-02-21T09:05:52Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50110cf44ec2f8bd14f24d0d71a2e19c49cd71f0", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/50110cf44ec2f8bd14f24d0d71a2e19c49cd71f0", "committedDate": "2020-02-21T09:05:52Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}, "afterCommit": {"oid": "3596ef61854461dd1324fe22a5d1766d84988be1", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/3596ef61854461dd1324fe22a5d1766d84988be1", "committedDate": "2020-02-21T11:09:52Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3596ef61854461dd1324fe22a5d1766d84988be1", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/3596ef61854461dd1324fe22a5d1766d84988be1", "committedDate": "2020-02-21T11:09:52Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}, "afterCommit": {"oid": "2335d2195e675e4ac242297bcd8692bb22db3aa9", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/2335d2195e675e4ac242297bcd8692bb22db3aa9", "committedDate": "2020-02-21T11:13:42Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2335d2195e675e4ac242297bcd8692bb22db3aa9", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/2335d2195e675e4ac242297bcd8692bb22db3aa9", "committedDate": "2020-02-21T11:13:42Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}, "afterCommit": {"oid": "5b56657211bcf6e3628a53d7304b70ba117a5590", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/5b56657211bcf6e3628a53d7304b70ba117a5590", "committedDate": "2020-02-21T13:13:14Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5b56657211bcf6e3628a53d7304b70ba117a5590", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/5b56657211bcf6e3628a53d7304b70ba117a5590", "committedDate": "2020-02-21T13:13:14Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}, "afterCommit": {"oid": "e8c9b73cb9e44a2a4a0f2ad92ed3d690d5a1136b", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/e8c9b73cb9e44a2a4a0f2ad92ed3d690d5a1136b", "committedDate": "2020-02-21T14:08:52Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8c9b73cb9e44a2a4a0f2ad92ed3d690d5a1136b", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/e8c9b73cb9e44a2a4a0f2ad92ed3d690d5a1136b", "committedDate": "2020-02-21T14:08:52Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}, "afterCommit": {"oid": "6d02bdefd4d2847d1de8e7082fc22dbd6422be2e", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/6d02bdefd4d2847d1de8e7082fc22dbd6422be2e", "committedDate": "2020-02-21T15:47:38Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6d02bdefd4d2847d1de8e7082fc22dbd6422be2e", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/6d02bdefd4d2847d1de8e7082fc22dbd6422be2e", "committedDate": "2020-02-21T15:47:38Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}, "afterCommit": {"oid": "750835617c7d52ad340a805b6347ed30e0e9e63e", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/750835617c7d52ad340a805b6347ed30e0e9e63e", "committedDate": "2020-02-24T07:57:20Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "750835617c7d52ad340a805b6347ed30e0e9e63e", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/750835617c7d52ad340a805b6347ed30e0e9e63e", "committedDate": "2020-02-24T07:57:20Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}, "afterCommit": {"oid": "4e58d038f9d80fe26f44a805409eb9fc6ffea996", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/4e58d038f9d80fe26f44a805409eb9fc6ffea996", "committedDate": "2020-02-24T10:07:20Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4e58d038f9d80fe26f44a805409eb9fc6ffea996", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/4e58d038f9d80fe26f44a805409eb9fc6ffea996", "committedDate": "2020-02-24T10:07:20Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}, "afterCommit": {"oid": "38aef34b1fc5c425934751b810061b56c3b1dab1", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/38aef34b1fc5c425934751b810061b56c3b1dab1", "committedDate": "2020-02-24T11:11:03Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "38aef34b1fc5c425934751b810061b56c3b1dab1", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/38aef34b1fc5c425934751b810061b56c3b1dab1", "committedDate": "2020-02-24T11:11:03Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}, "afterCommit": {"oid": "c6875ccdfefb6a06fe9b0a4d2e1c1e583851e2c6", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/c6875ccdfefb6a06fe9b0a4d2e1c1e583851e2c6", "committedDate": "2020-02-24T18:34:11Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c6875ccdfefb6a06fe9b0a4d2e1c1e583851e2c6", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/c6875ccdfefb6a06fe9b0a4d2e1c1e583851e2c6", "committedDate": "2020-02-24T18:34:11Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}, "afterCommit": {"oid": "2bbdd360c5562ae18c68670747fe47de0e37371a", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/2bbdd360c5562ae18c68670747fe47de0e37371a", "committedDate": "2020-02-24T20:37:25Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2bbdd360c5562ae18c68670747fe47de0e37371a", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/2bbdd360c5562ae18c68670747fe47de0e37371a", "committedDate": "2020-02-24T20:37:25Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}, "afterCommit": {"oid": "c600198eef4ff4316e733d406a9364ba6faf1017", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/c600198eef4ff4316e733d406a9364ba6faf1017", "committedDate": "2020-02-24T21:22:32Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c600198eef4ff4316e733d406a9364ba6faf1017", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/c600198eef4ff4316e733d406a9364ba6faf1017", "committedDate": "2020-02-24T21:22:32Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}, "afterCommit": {"oid": "9f679bd51be1f793115b861f60b1f13c0bf2de70", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/9f679bd51be1f793115b861f60b1f13c0bf2de70", "committedDate": "2020-02-25T08:13:41Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9f679bd51be1f793115b861f60b1f13c0bf2de70", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/9f679bd51be1f793115b861f60b1f13c0bf2de70", "committedDate": "2020-02-25T08:13:41Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}, "afterCommit": {"oid": "748da222c291a97dc81a58ac7f2602db0176c42f", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/748da222c291a97dc81a58ac7f2602db0176c42f", "committedDate": "2020-02-25T08:50:45Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "748da222c291a97dc81a58ac7f2602db0176c42f", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/748da222c291a97dc81a58ac7f2602db0176c42f", "committedDate": "2020-02-25T08:50:45Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}, "afterCommit": {"oid": "0725832dfad77baa9322fe31fecb28a7f5e3bffa", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/0725832dfad77baa9322fe31fecb28a7f5e3bffa", "committedDate": "2020-02-25T11:10:43Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NTIzMjM1", "url": "https://github.com/geoserver/geoserver/pull/4074#pullrequestreview-366523235", "createdAt": "2020-02-28T16:26:12Z", "commit": {"oid": "0725832dfad77baa9322fe31fecb28a7f5e3bffa"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNjoyNjoxMlrOFv64Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNjoyODo0M1rOFv6-MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5MjA3MA==", "bodyText": "This resolution dance, is this the only place where it needs to happen? No usage in UI for example?", "url": "https://github.com/geoserver/geoserver/pull/4074#discussion_r385792070", "createdAt": "2020-02-28T16:26:12Z", "author": {"login": "aaime"}, "path": "src/wms/src/main/java/org/geoserver/wms/decoration/LegendDecoration.java", "diffHunk": "@@ -293,4 +313,55 @@ private String findTitle(Layer layer, Catalog catalog) {\n         public BufferedImage legend;\n         public GetLegendGraphicRequest request;\n     }\n+\n+    private LegendInfo resolveLegendInfo(\n+            LegendInfo legendInfo, GetLegendGraphicRequest request, StyleInfo context) {\n+        if (legendInfo == null) {\n+            return null; // not available\n+        }\n+        String onlineResource = legendInfo.getOnlineResource();\n+        String baseUrl = request.getBaseUrl();\n+        if (onlineResource == null) {\n+            return null;\n+        }\n+        URL url = null;\n+        try {\n+            URI uri = new URI(onlineResource);\n+            GeoServerResourceLoader resources = wms.getCatalog().getResourceLoader();\n+            if (uri.isAbsolute()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0725832dfad77baa9322fe31fecb28a7f5e3bffa"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5MjY0MQ==", "bodyText": "Hmm... LegendInfo is part of the catalog configuration, are we sure that it can be modified just like this without side effects? Is it wrapped in a ModificationProxy at runtime? If so, unless it gets saved, there are no problems, otherwise, best to clone it before changing it.", "url": "https://github.com/geoserver/geoserver/pull/4074#discussion_r385792641", "createdAt": "2020-02-28T16:27:12Z", "author": {"login": "aaime"}, "path": "src/wms/src/main/java/org/geoserver/wms/decoration/LegendDecoration.java", "diffHunk": "@@ -293,4 +313,55 @@ private String findTitle(Layer layer, Catalog catalog) {\n         public BufferedImage legend;\n         public GetLegendGraphicRequest request;\n     }\n+\n+    private LegendInfo resolveLegendInfo(\n+            LegendInfo legendInfo, GetLegendGraphicRequest request, StyleInfo context) {\n+        if (legendInfo == null) {\n+            return null; // not available\n+        }\n+        String onlineResource = legendInfo.getOnlineResource();\n+        String baseUrl = request.getBaseUrl();\n+        if (onlineResource == null) {\n+            return null;\n+        }\n+        URL url = null;\n+        try {\n+            URI uri = new URI(onlineResource);\n+            GeoServerResourceLoader resources = wms.getCatalog().getResourceLoader();\n+            if (uri.isAbsolute()) {\n+                if (baseUrl != null && onlineResource.startsWith(baseUrl + \"styles/\")) {\n+                    // convert relative to styles durectory\n+                    onlineResource = onlineResource.substring(baseUrl.length() + 7);\n+                } else {\n+                    legendInfo.setOnlineResource(new URL(onlineResource).toString());\n+                    return legendInfo; // an actual external graphic reference\n+                }\n+            } else {\n+                // not absolute, try relative to the style if available, otherwise search\n+                // in the styles directory\n+                if (context != null) {\n+                    GeoServerDataDirectory dd = new GeoServerDataDirectory(resources);\n+                    Resource styleParentResource = dd.get(context);\n+                    if (styleParentResource != null\n+                            && styleParentResource.getType() == Resource.Type.DIRECTORY) {\n+                        url =\n+                                URLs.fileToUrl(\n+                                        new File(\n+                                                styleParentResource.dir().getCanonicalPath(),\n+                                                onlineResource));\n+                    }\n+                }\n+            }\n+            if (url == null) {\n+                File styles = resources.findOrCreateDirectory(\"styles\");\n+                URL base = URLs.fileToUrl(styles);\n+                url = new URL(base, onlineResource);\n+            }\n+        } catch (Exception e) {\n+            return null; // Do not try this online resource\n+        }\n+        legendInfo.setOnlineResource(url.toExternalForm());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0725832dfad77baa9322fe31fecb28a7f5e3bffa"}, "originalPosition": 125}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5Mjk4Mw==", "bodyText": "GeoServer is prone to have dangling style references, best to filter out null styles in this loop.", "url": "https://github.com/geoserver/geoserver/pull/4074#discussion_r385792983", "createdAt": "2020-02-28T16:27:49Z", "author": {"login": "aaime"}, "path": "src/wms/src/main/java/org/geoserver/wms/decoration/LegendDecoration.java", "diffHunk": "@@ -101,6 +107,22 @@ public Dimension findOptimalSize(Graphics2D g2d, WMSMapContent mapContext) {\n                 request.setKvp(dispatcherRequest.getKvp());\n                 request.setRawKvp(dispatcherRequest.getRawKvp());\n             }\n+            // online resource handling\n+            LayerInfo info = wms.getLayerByName(layer.getTitle());\n+            StyleInfo defaultStyle = info.getDefaultStyle();\n+            StyleInfo sInfo =\n+                    info.getStyles()\n+                            .stream()\n+                            .filter(s -> s.getName().equals(layer.getStyle().getName()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0725832dfad77baa9322fe31fecb28a7f5e3bffa"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc5MzU4NA==", "bodyText": "All this preparation is done to get the LegendInfo, right? If so, best to move it in a separate method, and just return the legend info, without cluttering this method with otherwise unused variables.", "url": "https://github.com/geoserver/geoserver/pull/4074#discussion_r385793584", "createdAt": "2020-02-28T16:28:43Z", "author": {"login": "aaime"}, "path": "src/wms/src/main/java/org/geoserver/wms/decoration/LegendDecoration.java", "diffHunk": "@@ -101,6 +107,22 @@ public Dimension findOptimalSize(Graphics2D g2d, WMSMapContent mapContext) {\n                 request.setKvp(dispatcherRequest.getKvp());\n                 request.setRawKvp(dispatcherRequest.getRawKvp());\n             }\n+            // online resource handling\n+            LayerInfo info = wms.getLayerByName(layer.getTitle());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0725832dfad77baa9322fe31fecb28a7f5e3bffa"}, "originalPosition": 40}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0725832dfad77baa9322fe31fecb28a7f5e3bffa", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/0725832dfad77baa9322fe31fecb28a7f5e3bffa", "committedDate": "2020-02-25T11:10:43Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}, "afterCommit": {"oid": "6bc0d7ece233e6ffbb7d61acf48629d3cac8d67e", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/6bc0d7ece233e6ffbb7d61acf48629d3cac8d67e", "committedDate": "2020-03-02T09:07:33Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc7d918ff8bb15d3f6239c74346c6653f8ad98b3", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/dc7d918ff8bb15d3f6239c74346c6653f8ad98b3", "committedDate": "2020-03-02T09:19:59Z", "message": "[GEOS-9508] Legend Decorator does not display the static legend set in the style"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6bc0d7ece233e6ffbb7d61acf48629d3cac8d67e", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/6bc0d7ece233e6ffbb7d61acf48629d3cac8d67e", "committedDate": "2020-03-02T09:07:33Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}, "afterCommit": {"oid": "f489c73a16c29aa91293f2ed19d54b4ecd344ac6", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/f489c73a16c29aa91293f2ed19d54b4ecd344ac6", "committedDate": "2020-03-02T09:20:07Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8dab02be0d2dd5e88677bbf9f675e781992f16fd", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/8dab02be0d2dd5e88677bbf9f675e781992f16fd", "committedDate": "2020-03-02T09:50:32Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f489c73a16c29aa91293f2ed19d54b4ecd344ac6", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/f489c73a16c29aa91293f2ed19d54b4ecd344ac6", "committedDate": "2020-03-02T09:20:07Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}, "afterCommit": {"oid": "8dab02be0d2dd5e88677bbf9f675e781992f16fd", "author": {"user": {"login": "taba90", "name": null}}, "url": "https://github.com/geoserver/geoserver/commit/8dab02be0d2dd5e88677bbf9f675e781992f16fd", "committedDate": "2020-03-02T09:50:32Z", "message": "[GEOS-6175] Decoration - Auto-sized legend doesn't fit"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1492, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}