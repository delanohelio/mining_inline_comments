{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyNTM2NzE0", "number": 4098, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODoyNToxOVrODkX50w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxOTozMjo1NVrODkZVJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NDY2OTYzOnYy", "diffSide": "RIGHT", "path": "src/extension/mbstyle/src/test/java/org/geoserver/community/mbstyle/web/MBStyleEditPageTest.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxODoyNToxOVrOFwqNaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxOToyNToyMFrOFwsNgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2NzUyOA==", "bodyText": "@tbarsballe there is a significant regression found by this test, to be handled in the geotools code.\nIt looks like references to a sprite sheet are not being picked or have changed. Still I would like to track this as a separate issue rather than hold up the pull request (which just covers geoserver integration).", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386567528", "createdAt": "2020-03-02T18:25:19Z", "author": {"login": "jodygarnett"}, "path": "src/extension/mbstyle/src/test/java/org/geoserver/community/mbstyle/web/MBStyleEditPageTest.java", "diffHunk": "@@ -81,20 +82,14 @@ public void testMbstyleChange() throws Exception {\n         tester.executeAjaxEvent(\"apply\", \"click\");\n         tester.assertModelValue(\"styleForm:context:panel:previewStyleGroup\", true);\n         assertNotNull(getCatalog().getStyleByName(\"mbstyle\").getSLD());\n-        PointSymbolizer ps =\n-                (PointSymbolizer)\n-                        getCatalog()\n-                                .getStyleByName(\"mbstyle\")\n-                                .getStyle()\n-                                .featureTypeStyles()\n-                                .get(0)\n-                                .rules()\n-                                .get(0)\n-                                .symbolizers()\n-                                .get(0);\n-        ExternalGraphic eg = (ExternalGraphic) ps.getGraphic().graphicalSymbols().get(0);\n-        assertEquals(\n-                eg.getURI(),\n-                \"http://localhost:8080/geoserver/styles/mbsprites#icon=${strURLEncode('circle')}&size=${strURLEncode(Interpolate(POP_MAX,0,0.7,40000000,3.7,'numeric'))}\");\n+        Style style = getCatalog().getStyleByName(\"mbstyle\").getStyle();\n+        Symbolizer sym = style.featureTypeStyles().get(0).rules().get(0).symbolizers().get(0);\n+\n+        assertTrue(sym instanceof PointSymbolizer);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00ad83349ee5ba4f100626aaf1cc47bf97fe7bc2"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU4ODQ3Nw==", "bodyText": "Reporting issue here: https://osgeo-org.atlassian.net/browse/GEOT-6522", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386588477", "createdAt": "2020-03-02T19:03:39Z", "author": {"login": "jodygarnett"}, "path": "src/extension/mbstyle/src/test/java/org/geoserver/community/mbstyle/web/MBStyleEditPageTest.java", "diffHunk": "@@ -81,20 +82,14 @@ public void testMbstyleChange() throws Exception {\n         tester.executeAjaxEvent(\"apply\", \"click\");\n         tester.assertModelValue(\"styleForm:context:panel:previewStyleGroup\", true);\n         assertNotNull(getCatalog().getStyleByName(\"mbstyle\").getSLD());\n-        PointSymbolizer ps =\n-                (PointSymbolizer)\n-                        getCatalog()\n-                                .getStyleByName(\"mbstyle\")\n-                                .getStyle()\n-                                .featureTypeStyles()\n-                                .get(0)\n-                                .rules()\n-                                .get(0)\n-                                .symbolizers()\n-                                .get(0);\n-        ExternalGraphic eg = (ExternalGraphic) ps.getGraphic().graphicalSymbols().get(0);\n-        assertEquals(\n-                eg.getURI(),\n-                \"http://localhost:8080/geoserver/styles/mbsprites#icon=${strURLEncode('circle')}&size=${strURLEncode(Interpolate(POP_MAX,0,0.7,40000000,3.7,'numeric'))}\");\n+        Style style = getCatalog().getStyleByName(\"mbstyle\").getStyle();\n+        Symbolizer sym = style.featureTypeStyles().get(0).rules().get(0).symbolizers().get(0);\n+\n+        assertTrue(sym instanceof PointSymbolizer);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2NzUyOA=="}, "originalCommit": {"oid": "00ad83349ee5ba4f100626aaf1cc47bf97fe7bc2"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU5NTMwNg==", "bodyText": "The test itself is intended to just make sure geoserver properly updates the cached SLD for non-SLD styles in the resource pool when a style is saved using the UI; it just happens to use a style that contains an icon.\nThe icon lookup is to verify the conversion worked.\nAs for the spritesheet reference - for named icons matching the well-known icon names in GeoServer (e.g. 'circle'), mbstyle should be bypassing the spritesheet entirely. I can't recall where exactly that special case was implemented - I'll try and track it down. So, the issue isn't quite that its not finding the spritesheet, since the spritesheet listed in the style is just a dummy value and doesn't exist\nAs an aside, commenting out a portion of the test and setting  the test to @Ignore is overkill - just use Ignore and preserve the test content.", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386595306", "createdAt": "2020-03-02T19:16:24Z", "author": {"login": "tbarsballe"}, "path": "src/extension/mbstyle/src/test/java/org/geoserver/community/mbstyle/web/MBStyleEditPageTest.java", "diffHunk": "@@ -81,20 +82,14 @@ public void testMbstyleChange() throws Exception {\n         tester.executeAjaxEvent(\"apply\", \"click\");\n         tester.assertModelValue(\"styleForm:context:panel:previewStyleGroup\", true);\n         assertNotNull(getCatalog().getStyleByName(\"mbstyle\").getSLD());\n-        PointSymbolizer ps =\n-                (PointSymbolizer)\n-                        getCatalog()\n-                                .getStyleByName(\"mbstyle\")\n-                                .getStyle()\n-                                .featureTypeStyles()\n-                                .get(0)\n-                                .rules()\n-                                .get(0)\n-                                .symbolizers()\n-                                .get(0);\n-        ExternalGraphic eg = (ExternalGraphic) ps.getGraphic().graphicalSymbols().get(0);\n-        assertEquals(\n-                eg.getURI(),\n-                \"http://localhost:8080/geoserver/styles/mbsprites#icon=${strURLEncode('circle')}&size=${strURLEncode(Interpolate(POP_MAX,0,0.7,40000000,3.7,'numeric'))}\");\n+        Style style = getCatalog().getStyleByName(\"mbstyle\").getStyle();\n+        Symbolizer sym = style.featureTypeStyles().get(0).rules().get(0).symbolizers().get(0);\n+\n+        assertTrue(sym instanceof PointSymbolizer);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2NzUyOA=="}, "originalCommit": {"oid": "00ad83349ee5ba4f100626aaf1cc47bf97fe7bc2"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU5OTA1Nw==", "bodyText": "Andrea points out this change was intensional (https://osgeo-org.atlassian.net/browse/GEOT-6443) so I will update this test case to resolve.", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386599057", "createdAt": "2020-03-02T19:23:03Z", "author": {"login": "jodygarnett"}, "path": "src/extension/mbstyle/src/test/java/org/geoserver/community/mbstyle/web/MBStyleEditPageTest.java", "diffHunk": "@@ -81,20 +82,14 @@ public void testMbstyleChange() throws Exception {\n         tester.executeAjaxEvent(\"apply\", \"click\");\n         tester.assertModelValue(\"styleForm:context:panel:previewStyleGroup\", true);\n         assertNotNull(getCatalog().getStyleByName(\"mbstyle\").getSLD());\n-        PointSymbolizer ps =\n-                (PointSymbolizer)\n-                        getCatalog()\n-                                .getStyleByName(\"mbstyle\")\n-                                .getStyle()\n-                                .featureTypeStyles()\n-                                .get(0)\n-                                .rules()\n-                                .get(0)\n-                                .symbolizers()\n-                                .get(0);\n-        ExternalGraphic eg = (ExternalGraphic) ps.getGraphic().graphicalSymbols().get(0);\n-        assertEquals(\n-                eg.getURI(),\n-                \"http://localhost:8080/geoserver/styles/mbsprites#icon=${strURLEncode('circle')}&size=${strURLEncode(Interpolate(POP_MAX,0,0.7,40000000,3.7,'numeric'))}\");\n+        Style style = getCatalog().getStyleByName(\"mbstyle\").getStyle();\n+        Symbolizer sym = style.featureTypeStyles().get(0).rules().get(0).symbolizers().get(0);\n+\n+        assertTrue(sym instanceof PointSymbolizer);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2NzUyOA=="}, "originalCommit": {"oid": "00ad83349ee5ba4f100626aaf1cc47bf97fe7bc2"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwMDMyMw==", "bodyText": "Right, that makes sense. You should just be able to grab a spritesheet + sprite name from one of the GeoTools MBStyle tests - the appearance of the style doesn't matter here, just that it gets properly translated into an SLD symbol", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386600323", "createdAt": "2020-03-02T19:25:20Z", "author": {"login": "tbarsballe"}, "path": "src/extension/mbstyle/src/test/java/org/geoserver/community/mbstyle/web/MBStyleEditPageTest.java", "diffHunk": "@@ -81,20 +82,14 @@ public void testMbstyleChange() throws Exception {\n         tester.executeAjaxEvent(\"apply\", \"click\");\n         tester.assertModelValue(\"styleForm:context:panel:previewStyleGroup\", true);\n         assertNotNull(getCatalog().getStyleByName(\"mbstyle\").getSLD());\n-        PointSymbolizer ps =\n-                (PointSymbolizer)\n-                        getCatalog()\n-                                .getStyleByName(\"mbstyle\")\n-                                .getStyle()\n-                                .featureTypeStyles()\n-                                .get(0)\n-                                .rules()\n-                                .get(0)\n-                                .symbolizers()\n-                                .get(0);\n-        ExternalGraphic eg = (ExternalGraphic) ps.getGraphic().graphicalSymbols().get(0);\n-        assertEquals(\n-                eg.getURI(),\n-                \"http://localhost:8080/geoserver/styles/mbsprites#icon=${strURLEncode('circle')}&size=${strURLEncode(Interpolate(POP_MAX,0,0.7,40000000,3.7,'numeric'))}\");\n+        Style style = getCatalog().getStyleByName(\"mbstyle\").getStyle();\n+        Symbolizer sym = style.featureTypeStyles().get(0).rules().get(0).symbolizers().get(0);\n+\n+        assertTrue(sym instanceof PointSymbolizer);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU2NzUyOA=="}, "originalCommit": {"oid": "00ad83349ee5ba4f100626aaf1cc47bf97fe7bc2"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5NDkwMzQwOnYy", "diffSide": "RIGHT", "path": "doc/en/user/source/styling/mbstyle/installing.rst", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxOTozMjo1NVrOFwsdZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QwNjoxMDoyOFrOFw5Yrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwNDM5MA==", "bodyText": "An actual link to the download page might be nice here, since there was a link before.", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386604390", "createdAt": "2020-03-02T19:32:55Z", "author": {"login": "tbarsballe"}, "path": "doc/en/user/source/styling/mbstyle/installing.rst", "diffHunk": "@@ -3,8 +3,14 @@\n Installing the GeoServer MBStyle extension\n ==========================================\n \n- #. Download the extension from the `nightly GeoServer community module builds <https://build.geoserver.org/geoserver/master/community-latest/>`_.\n+The MBStyle extension is listed on the GeoServer download page.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6dd1664230b64eff8d2cc49f66e8f92c8160204"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY4ODE0OA==", "bodyText": "Trying to think what to do for that, either link to the geoserver release page, or straight to source forge.", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386688148", "createdAt": "2020-03-02T22:25:06Z", "author": {"login": "jodygarnett"}, "path": "doc/en/user/source/styling/mbstyle/installing.rst", "diffHunk": "@@ -3,8 +3,14 @@\n Installing the GeoServer MBStyle extension\n ==========================================\n \n- #. Download the extension from the `nightly GeoServer community module builds <https://build.geoserver.org/geoserver/master/community-latest/>`_.\n+The MBStyle extension is listed on the GeoServer download page.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwNDM5MA=="}, "originalCommit": {"oid": "e6dd1664230b64eff8d2cc49f66e8f92c8160204"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY5MTUwMQ==", "bodyText": "I'd say just the GeoServer release page would be simplest", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386691501", "createdAt": "2020-03-02T22:32:23Z", "author": {"login": "tbarsballe"}, "path": "doc/en/user/source/styling/mbstyle/installing.rst", "diffHunk": "@@ -3,8 +3,14 @@\n Installing the GeoServer MBStyle extension\n ==========================================\n \n- #. Download the extension from the `nightly GeoServer community module builds <https://build.geoserver.org/geoserver/master/community-latest/>`_.\n+The MBStyle extension is listed on the GeoServer download page.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwNDM5MA=="}, "originalCommit": {"oid": "e6dd1664230b64eff8d2cc49f66e8f92c8160204"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjcyNjIyMQ==", "bodyText": "Actually that ended up being hard:\n\nWe could hard code it (and then have a maintenance trouble updating each page)\nThere was no way to use substitutions (since those cannot be used in generating links)\nEnded up making three external link definitions (artifacts, extension plugins, community plugins) ... and then making those dynamic based on \"snapshot\" (build server) or \"release\" (source forge)\n\nPlease have a look.", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386726221", "createdAt": "2020-03-03T00:06:41Z", "author": {"login": "jodygarnett"}, "path": "doc/en/user/source/styling/mbstyle/installing.rst", "diffHunk": "@@ -3,8 +3,14 @@\n Installing the GeoServer MBStyle extension\n ==========================================\n \n- #. Download the extension from the `nightly GeoServer community module builds <https://build.geoserver.org/geoserver/master/community-latest/>`_.\n+The MBStyle extension is listed on the GeoServer download page.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwNDM5MA=="}, "originalCommit": {"oid": "e6dd1664230b64eff8d2cc49f66e8f92c8160204"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjczMjExNQ==", "bodyText": "You went way fancier then I was expecting, I was just thinking linking http://geoserver.org , or http://geoserver.org/release/{version}\nI was just looking for something of comparable utility to the prior link.\nYour solution does seem reasonable, assuming it is stable - i.e. doesn't break next time the we update versions. It looks stable enough, but sometimes the release scripts miss a version # somewhere (or a step gets inadvertently skipped).", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386732115", "createdAt": "2020-03-03T00:25:59Z", "author": {"login": "tbarsballe"}, "path": "doc/en/user/source/styling/mbstyle/installing.rst", "diffHunk": "@@ -3,8 +3,14 @@\n Installing the GeoServer MBStyle extension\n ==========================================\n \n- #. Download the extension from the `nightly GeoServer community module builds <https://build.geoserver.org/geoserver/master/community-latest/>`_.\n+The MBStyle extension is listed on the GeoServer download page.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwNDM5MA=="}, "originalCommit": {"oid": "e6dd1664230b64eff8d2cc49f66e8f92c8160204"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgxNjE3NQ==", "bodyText": "Yeah as above there was no way to add \"version\" into a URL, so no kill like overkill.", "url": "https://github.com/geoserver/geoserver/pull/4098#discussion_r386816175", "createdAt": "2020-03-03T06:10:28Z", "author": {"login": "jodygarnett"}, "path": "doc/en/user/source/styling/mbstyle/installing.rst", "diffHunk": "@@ -3,8 +3,14 @@\n Installing the GeoServer MBStyle extension\n ==========================================\n \n- #. Download the extension from the `nightly GeoServer community module builds <https://build.geoserver.org/geoserver/master/community-latest/>`_.\n+The MBStyle extension is listed on the GeoServer download page.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwNDM5MA=="}, "originalCommit": {"oid": "e6dd1664230b64eff8d2cc49f66e8f92c8160204"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4006, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}