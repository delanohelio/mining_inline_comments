{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3NzAwMTI3", "number": 4582, "title": "Support decorations with multiple layers and legend styling in WPS downloads", "bodyText": "This PR involves improvements on decorations and legend styling on WPS downloads, in a way that:\n\nallow to style the background color, opacity and other styling attributed for a LegendDecorator,\nallow to add multiple legend decorations based on layers that are requested in the WPS payload.\n\nAs an example of use, a request with this payload\n<wps:Execute version=\"1.0.0\" service=\"WPS\"\n   (...)\n    <wps:Input>\n      <ows:Identifier>layer</ows:Identifier>\n      <wps:Data>\n        <wps:ComplexData xmlns:dwn=\"http://geoserver.org/wps/download\">\n          <dwn:Layer>\n            <dwn:Name>tiger:tiger_roads,</dwn:Name>\n            <dwn:DecoratorName>layout1</dwn:Name>\n          </dwn:Layer>\n        </wps:ComplexData>\n      </wps:Data>\n    </wps:Input>\n    (...)\n    <wps:Input>\n      <ows:Identifier>layer</ows:Identifier>\n      <wps:Data>\n        <wps:ComplexData xmlns:dwn=\"http://geoserver.org/wps/download\">\n          <dwn:Layer>\n            <dwn:Name>tiger:poly_landmarks</dwn:Name>\n            <dwn:DecoratorName>layout2</dwn:Name>\n          </dwn:Layer>\n        </wps:ComplexData>\n      </wps:Data>\n    </wps:Input>\n  </wps:DataInputs>\n  (...)\nwith these layouts definitions (layout1 and layout2)\n<layout>\n\t<decoration type=\"layout_roads\" affinity=\"top,right\" offset=\"6,6\" size=\"auto\">\n               <option name=\"legend_options\" value=\"bgColor:0xFFFFEE;\"\" />\n        </decoration>\n</layout>\n\nand\n<layout>\n\t<decoration type=\"layout_lands\" affinity=\"top,left\" offset=\"6,6\" size=\"auto\">\n               <option name=\"legend_options\" value=\"bgColor:0xFFFFEE;\"\" />\n        </decoration>\n</layout>\n\nwould result in\n\nAlso it's possible to set a header area at top of result on which legends can be placed (using a new optional Input for the WPS gs:downloadMap process)\nChecklist\n\nReviewing is a process done by project maintainers, mostly on a volunteer basis. We try to keep the overhead as small as possible and appreciate if you help us to do so by completing the following items. Feel free to ask in a comment if you have troubles with any of them.\n\nSubmitting the PR does not require you to check all items, but by the time it gets merged, they should be either satisfied or inapplicable.\nFor all pull requests:\n\n Confirm you have read the contribution guidelines\n You have sent a Contribution Licence Agreement (CLA) as necessary (not required for small changes, e.g., fixing typos in documentation)\n Make sure the first PR targets the master branch, eventual backports will be managed later. This can be ignored if the PR is fixing an issue that only happens in a specific branch, but not in newer ones.\n\nThe following are required only for core and extension modules (they are welcomed, but not required, for community modules):\n\n There is a ticket in Jira describing the issue/improvement/feature (a notable exemptions is, changes not visible to end users)\n PR for bug fixes and small new features are presented as a single commit\n Commit message must be in the form \"[GEOS-XYZW] Title of the Jira ticket\" (export to XML in Jira generates the message in this exact form)\n The pull request contains changes related to a single objective. If multiple focuses cannot be avoided, each one is in its own commit and has a separate ticket describing it.\n New unit tests have been added covering the changes\n This PR passes all existing unit tests (test results will be reported by travis-ci after opening this PR)\n This PR passes the QA checks (QA checks results will be reported by travis-ci after opening this PR)\n Commits changing the UI, existing user workflows, or adding new functionality, need to include documentation updates (screenshots, text)\n Commits changing the REST API, or any configuration object, should check if the REST API docs (Swagger YAML files and classic documentation) need to be updated.", "createdAt": "2020-11-25T21:26:55Z", "url": "https://github.com/geoserver/geoserver/pull/4582", "merged": true, "mergeCommit": {"oid": "8a00580b03c75f0239af2179a5a67015d27376b9"}, "closed": true, "closedAt": "2020-12-01T13:40:47Z", "author": {"login": "jemacchi"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdf_9lBAH2gAyNTI3NzAwMTI3OmMxMDBiNWEyYThjY2ExNWRjOGM1YTUyNGU5MWY5YTcxMDEyYWU2NWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhrIb0AH2gAyNTI3NzAwMTI3OjMyZmI4MTk1YzcyYTNkMjA0NWQ0MTY3Zjg3NDYxZjI0OGFkN2ZlYmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c100b5a2a8cca15dc8c5a524e91f9a71012ae65f", "author": {"user": null}, "url": "https://github.com/geoserver/geoserver/commit/c100b5a2a8cca15dc8c5a524e91f9a71012ae65f", "committedDate": "2020-11-25T15:20:10Z", "message": "Support decorations with multiple layers in WPS downloads.\nHeader decoration detection. Extended formatting options for legends.\nNew vendor option for format_options in GetMap request."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1917174df5426f87e43a985b10a8d8233ca6f3e", "author": {"user": null}, "url": "https://github.com/geoserver/geoserver/commit/c1917174df5426f87e43a985b10a8d8233ca6f3e", "committedDate": "2020-11-25T15:28:17Z", "message": "Merge branch 'master' of https://github.com/geoserver/geoserver into multiple-layers-decoration-wps-downloadmap"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b96d33e231857e30a98d03b7052e14fbadf739d", "author": {"user": null}, "url": "https://github.com/geoserver/geoserver/commit/1b96d33e231857e30a98d03b7052e14fbadf739d", "committedDate": "2020-11-25T21:09:08Z", "message": "New WPS gs:DownloadMap related documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55c3d9e2c2a1d36b2b8d0d15aca628edaf3e4a3b", "author": {"user": null}, "url": "https://github.com/geoserver/geoserver/commit/55c3d9e2c2a1d36b2b8d0d15aca628edaf3e4a3b", "committedDate": "2020-11-26T12:41:30Z", "message": "Format rules compliance"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNzkyMjI1", "url": "https://github.com/geoserver/geoserver/pull/4582#pullrequestreview-540792225", "createdAt": "2020-11-30T10:48:34Z", "commit": {"oid": "55c3d9e2c2a1d36b2b8d0d15aca628edaf3e4a3b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMDo0ODozNFrOH71hPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMDo1Mjo0NlrOH71rZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUwNDg5NQ==", "bodyText": "May be interesting for a client interested in doing its own composing (e.g., control separately the transparency of map and decoration), but I would remove the comment about where and how it's used in GeoServer community modules.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * ``decorationsOnly`` (values = ``true``, ``false``): Disabled by default. When value is true, it allows to get a transparent sized image for the request on which maps are not rendered, but it keeps the decorations applied (if present). This parameter is internally used for WPS gs:DownloadMap when applying multiple legends decorations in the process.\n          \n          \n            \n            * ``decorationsOnly`` (values = ``true``, ``false``): Disabled by default. When value is true, it allows to get a transparent sized image for the request on which maps are not rendered, but it keeps the decorations applied (if present).", "url": "https://github.com/geoserver/geoserver/pull/4582#discussion_r532504895", "createdAt": "2020-11-30T10:48:34Z", "author": {"login": "aaime"}, "path": "doc/en/user/source/services/wms/vendor.rst", "diffHunk": "@@ -153,6 +154,7 @@ The supported format options are:\n * ``kmlvisible`` (values = ``true``, ``false``): Indicates whether layers selected will default to enabled or not. Default behavior is enabled. This parameter primarily affects Google Earth rendering.\n * ``advancedProjectionHandling`` (values = ``true``, ``false``): Enable \\ Disable advanced projection handling, if it is enabled in the GUI. If it is disabled in the GUI, this option has no effect.\n * ``mapWrapping`` (values = ``true``, ``false``): Enable \\ Disable continuous map wrapping, if it is enabled in the GUI. If it is disabled in the GUI, this option has no effect. Continuous map wrapping will also be disabled if ``advancedProjectionHandling`` is disabled.\n+* ``decorationsOnly`` (values = ``true``, ``false``): Disabled by default. When value is true, it allows to get a transparent sized image for the request on which maps are not rendered, but it keeps the decorations applied (if present). This parameter is internally used for WPS gs:DownloadMap when applying multiple legends decorations in the process.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55c3d9e2c2a1d36b2b8d0d15aca628edaf3e4a3b"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUwNTcxNQ==", "bodyText": "So many white space changes... it's one of the reason why we adopted google-format, the structure is predictable and only actual changes show up in the diff. For this time, no problem, but for the future, please either avoid formatting changes in docs, or put them in a separate commit.", "url": "https://github.com/geoserver/geoserver/pull/4582#discussion_r532505715", "createdAt": "2020-11-30T10:49:54Z", "author": {"login": "aaime"}, "path": "doc/en/user/source/services/wms/vendor.rst", "diffHunk": "@@ -358,7 +361,7 @@ An example with XML POST:\n       version=\"1.1.1\" service=\"WMS\" rootLayer=\"false\">\n    </ogc:GetCapabilities>\n \n-   \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55c3d9e2c2a1d36b2b8d0d15aca628edaf3e4a3b"}, "originalPosition": 150}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUwNzQ5Mg==", "bodyText": "Add javadoc for public constant.", "url": "https://github.com/geoserver/geoserver/pull/4582#discussion_r532507492", "createdAt": "2020-11-30T10:52:46Z", "author": {"login": "aaime"}, "path": "src/wms/src/main/java/org/geoserver/wms/map/RenderedImageMapOutputFormat.java", "diffHunk": "@@ -160,6 +160,8 @@\n     private static final String DISABLE_DATELINE_WRAPPING_HEURISTIC_FORMAT_OPTION =\n             \"disableDatelineWrappingHeuristic\";\n \n+    public static final String DECORATIONS_ONLY_FORMAT_OPTION = \"decorationsOnly\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55c3d9e2c2a1d36b2b8d0d15aca628edaf3e4a3b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18d891e9657190a986091b5aa45e80219cdf11a6", "author": {"user": {"login": "jemacchi", "name": "Jose Macchi"}}, "url": "https://github.com/geoserver/geoserver/commit/18d891e9657190a986091b5aa45e80219cdf11a6", "committedDate": "2020-11-30T19:12:41Z", "message": "Update doc/en/user/source/services/wms/vendor.rst\n\nCo-authored-by: Andrea Aime <andrea.aime@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32fb8195c72a3d2045d4167f87461f248ad7febc", "author": {"user": null}, "url": "https://github.com/geoserver/geoserver/commit/32fb8195c72a3d2045d4167f87461f248ad7febc", "committedDate": "2020-11-30T20:11:52Z", "message": "Documentation adjustments based on PR feedback"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1518, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}