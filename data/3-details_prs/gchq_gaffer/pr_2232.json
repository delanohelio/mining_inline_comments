{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1OTAyMTc3", "number": 2232, "title": "Gh 2225 federated get all graph info", "bodyText": "", "createdAt": "2020-01-22T15:01:38Z", "url": "https://github.com/gchq/Gaffer/pull/2232", "merged": true, "mergeCommit": {"oid": "1495fb380d84ef8d2ff1abf9caa7dbe0d93357be"}, "closed": true, "closedAt": "2020-01-23T10:14:27Z", "author": {"login": "GCHQDev404"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABbyRvQsgH2gAyMzY1OTAyMTc3OjNlMTg3ZWY0YzRjYTI4NGNmN2YyYmY5NWVjNzY1MTZjMjNmZTIzYjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9Hkt6gFqTM0NzE4NDg3Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3e187ef4c4ca284cf7f2bf95ec76516c23fe23b3", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/3e187ef4c4ca284cf7f2bf95ec76516c23fe23b3", "committedDate": "2019-12-20T17:51:09Z", "message": "Typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69e26a38fabb70bd1fab37798d277f13e7c856db", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/69e26a38fabb70bd1fab37798d277f13e7c856db", "committedDate": "2020-01-17T15:49:13Z", "message": "gh-2223 FederatedAdminIT tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd0052afdb2944a048393344cc97f80a29784e0d", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/dd0052afdb2944a048393344cc97f80a29784e0d", "committedDate": "2020-01-17T15:49:30Z", "message": "gh-2223 Admin Override for RemoveGraph and GetAllGraphIds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "336425581173a62997f9efb0dc169619b33266dd", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/336425581173a62997f9efb0dc169619b33266dd", "committedDate": "2020-01-17T15:50:26Z", "message": "gh-2223 Admin override for RemoveGraph uses predicate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15f7ad1d0730f65d33533bb1f590d2b740e126e1", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/15f7ad1d0730f65d33533bb1f590d2b740e126e1", "committedDate": "2020-01-17T15:50:37Z", "message": "gh-2223 FederatedAdminIT tests for a NonAdmin user requesting admin override."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f9e65937dd4ba645439f874ce0894e3e5161906", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/7f9e65937dd4ba645439f874ce0894e3e5161906", "committedDate": "2020-01-17T17:11:03Z", "message": "gh-2223 change to gaffer.store.admin.auth and renaming"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66d769ac1d19ebc1ea22025917485e28c1794087", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/66d769ac1d19ebc1ea22025917485e28c1794087", "committedDate": "2020-01-17T17:17:10Z", "message": "gh-2225 Federated GetAllGraphInfo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c447901ad7573340ae01578203d9f5011370adfa", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/c447901ad7573340ae01578203d9f5011370adfa", "committedDate": "2020-01-17T17:17:33Z", "message": "gh-2225 FederatedGetAllGraphInfoHandler has AdminAll and User usage."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5891ac0d1fa3c535f20b988f8cff13529a6aea14", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/5891ac0d1fa3c535f20b988f8cff13529a6aea14", "committedDate": "2020-01-17T17:33:10Z", "message": "gh-2223 checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd5055e26296fab04a7d69d23cd3e53aa4fabd97", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/fd5055e26296fab04a7d69d23cd3e53aa4fabd97", "committedDate": "2020-01-17T17:33:29Z", "message": "gh-2225 checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6699a0a362fb7bb298cf7819d92686b46ab51462", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/6699a0a362fb7bb298cf7819d92686b46ab51462", "committedDate": "2020-01-18T18:02:05Z", "message": "gh-2225 GetGraphInfo can be filtered by graphIds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d4d7104042eebff93f876761d4a567a216a11bd", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/2d4d7104042eebff93f876761d4a567a216a11bd", "committedDate": "2020-01-20T20:07:05Z", "message": "gh-2223 remove graph admin param added."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4a69281b1220337e7c78efa016d5883408ce93a", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/d4a69281b1220337e7c78efa016d5883408ce93a", "committedDate": "2020-01-20T20:08:49Z", "message": "gh-2225 getAllGraphsAndAuths isAdmin param"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be4b64e033b63e85a954d2cb3e495f236d451d31", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/be4b64e033b63e85a954d2cb3e495f236d451d31", "committedDate": "2020-01-21T15:04:25Z", "message": "Merge branch 'develop' into gh-2223-Federated-Admin-override"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b893e9d87aef924765afba8c7affd533c71d9fdd", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/b893e9d87aef924765afba8c7affd533c71d9fdd", "committedDate": "2020-01-21T15:04:48Z", "message": "Merge branch 'develop' into gh-2225-federated-getAllGraphInfo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f54bc80d150c59ba87bcc18ea08d0ef1f038980d", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/f54bc80d150c59ba87bcc18ea08d0ef1f038980d", "committedDate": "2020-01-21T18:04:16Z", "message": "gh-2223 refinements and package protected methods in FederatedGraphStorage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68e6a108c0b59216e257c05dd0522ddf6dc7b062", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/68e6a108c0b59216e257c05dd0522ddf6dc7b062", "committedDate": "2020-01-21T18:19:00Z", "message": "gh-2225 refinements and package protected methods in FederatedGraphStorage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f292a9346528e09ee0e12b93ce438b6d0c7053cf", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/f292a9346528e09ee0e12b93ce438b6d0c7053cf", "committedDate": "2020-01-22T15:14:52Z", "message": "Merge branch 'gh-2223-Federated-Admin-override' into gh-2225-federated-getAllGraphInfo\n\n# Conflicts:\n#\tstore-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedGraphStorage.java\n#\tstore-implementation/federated-store/src/test/java/uk/gov/gchq/gaffer/federatedstore/integration/FederatedAdminIT.java"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2fb4c2076e104eccb67f1d783e4dc1c44702611b", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/2fb4c2076e104eccb67f1d783e4dc1c44702611b", "committedDate": "2020-01-22T15:13:17Z", "message": "Merge branch 'gh-2223-Federated-Admin-override' into gh-2225-federated-getAllGraphInfo\n\n# Conflicts:\n#\tstore-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedGraphStorage.java\n#\tstore-implementation/federated-store/src/test/java/uk/gov/gchq/gaffer/federatedstore/integration/FederatedAdminIT.java"}, "afterCommit": {"oid": "f292a9346528e09ee0e12b93ce438b6d0c7053cf", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/f292a9346528e09ee0e12b93ce438b6d0c7053cf", "committedDate": "2020-01-22T15:14:52Z", "message": "Merge branch 'gh-2223-Federated-Admin-override' into gh-2225-federated-getAllGraphInfo\n\n# Conflicts:\n#\tstore-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedGraphStorage.java\n#\tstore-implementation/federated-store/src/test/java/uk/gov/gchq/gaffer/federatedstore/integration/FederatedAdminIT.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a9065ea0d479997e8f5ea215063ce47afaa921b", "author": {"user": {"login": "d47853", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/2a9065ea0d479997e8f5ea215063ce47afaa921b", "committedDate": "2020-01-22T15:50:47Z", "message": "Merge branch 'federated-admin-changes' into gh-2225-federated-getAllGraphInfo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2NzA0MDkw", "url": "https://github.com/gchq/Gaffer/pull/2232#pullrequestreview-346704090", "createdAt": "2020-01-22T16:01:53Z", "commit": {"oid": "2a9065ea0d479997e8f5ea215063ce47afaa921b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNjowMTo1M1rOFghm3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMlQxNjo0Mjo1OFrOFgjHHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY0OTM3NA==", "bodyText": "Don't think you need this second check", "url": "https://github.com/gchq/Gaffer/pull/2232#discussion_r369649374", "createdAt": "2020-01-22T16:01:53Z", "author": {"login": "d47853"}, "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedGraphStorage.java", "diffHunk": "@@ -513,4 +513,36 @@ private void makeAllGraphsFromCache() throws StorageException {\n             }\n         }\n     }\n+\n+    HashMap<String, Object> getAllGraphsAndAuths(final User user, final List<String> graphIds) {\n+        final HashMap<String, Object> graphIdFedAccessMap = new HashMap<>();\n+        storage.entrySet()\n+                .stream()\n+                .filter(entry -> isValidToView(user, entry.getKey()))\n+                .forEach(entry -> {\n+                    FederatedAccess federatedAccess = entry.getKey();\n+                    populateGraphIdAccessMap(graphIdFedAccessMap, graphIds, federatedAccess, entry.getValue());\n+                });\n+\n+        return graphIdFedAccessMap;\n+    }\n+\n+    private void populateGraphIdAccessMap(final HashMap<String, Object> graphIdFedAccessMap, final List<String> graphIds, final FederatedAccess federatedAccess, final Set<Graph> graphs) {\n+        for (final Graph g : graphs) {\n+            if (nonNull(graphIds) && !graphIds.isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a9065ea0d479997e8f5ea215063ce47afaa921b"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY2OTY2Mw==", "bodyText": "Why use the toString()? Isn't it simpler to just add the FederatedAccess object directly?", "url": "https://github.com/gchq/Gaffer/pull/2232#discussion_r369669663", "createdAt": "2020-01-22T16:35:44Z", "author": {"login": "d47853"}, "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedGraphStorage.java", "diffHunk": "@@ -513,4 +513,36 @@ private void makeAllGraphsFromCache() throws StorageException {\n             }\n         }\n     }\n+\n+    HashMap<String, Object> getAllGraphsAndAuths(final User user, final List<String> graphIds) {\n+        final HashMap<String, Object> graphIdFedAccessMap = new HashMap<>();\n+        storage.entrySet()\n+                .stream()\n+                .filter(entry -> isValidToView(user, entry.getKey()))\n+                .forEach(entry -> {\n+                    FederatedAccess federatedAccess = entry.getKey();\n+                    populateGraphIdAccessMap(graphIdFedAccessMap, graphIds, federatedAccess, entry.getValue());\n+                });\n+\n+        return graphIdFedAccessMap;\n+    }\n+\n+    private void populateGraphIdAccessMap(final HashMap<String, Object> graphIdFedAccessMap, final List<String> graphIds, final FederatedAccess federatedAccess, final Set<Graph> graphs) {\n+        for (final Graph g : graphs) {\n+            if (nonNull(graphIds) && !graphIds.isEmpty()) {\n+                if (graphIds.contains(g.getGraphId())) {\n+                    graphIdFedAccessMap.put(g.getGraphId(), federatedAccess.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a9065ea0d479997e8f5ea215063ce47afaa921b"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY3MjQ0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright 2017-2019 Crown Copyright\n          \n          \n            \n             * Copyright 2020 Crown Copyright", "url": "https://github.com/gchq/Gaffer/pull/2232#discussion_r369672440", "createdAt": "2020-01-22T16:40:25Z", "author": {"login": "d47853"}, "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/operation/GetAllGraphInfo.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2017-2019 Crown Copyright", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a9065ea0d479997e8f5ea215063ce47afaa921b"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY3Mjk2Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            @Since(\"1.10.4\")\n          \n          \n            \n            @Since(\"1.10.6\")", "url": "https://github.com/gchq/Gaffer/pull/2232#discussion_r369672966", "createdAt": "2020-01-22T16:41:17Z", "author": {"login": "d47853"}, "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/operation/GetAllGraphInfo.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2017-2019 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package uk.gov.gchq.gaffer.federatedstore.operation;\n+\n+import com.fasterxml.jackson.annotation.JsonPropertyOrder;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import org.apache.commons.lang3.exception.CloneFailedException;\n+\n+import uk.gov.gchq.gaffer.operation.io.Output;\n+import uk.gov.gchq.gaffer.operation.serialisation.TypeReferenceImpl;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+\n+import java.util.Map;\n+\n+import static uk.gov.gchq.gaffer.federatedstore.FederatedStoreConstants.KEY_OPERATION_OPTIONS_GRAPH_IDS;\n+\n+/**\n+ * An Operation to get all the graphIds within scope of the FederatedStore.\n+ */\n+@JsonPropertyOrder(value = {\"class\"}, alphabetic = true)\n+@Since(\"1.10.4\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a9065ea0d479997e8f5ea215063ce47afaa921b"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY3MzQ0MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright 2017-2019 Crown Copyright\n          \n          \n            \n             * Copyright 2020 Crown Copyright", "url": "https://github.com/gchq/Gaffer/pull/2232#discussion_r369673440", "createdAt": "2020-01-22T16:42:05Z", "author": {"login": "d47853"}, "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/operation/handler/impl/FederatedGetAllGraphInfoHandler.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2017-2019 Crown Copyright", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a9065ea0d479997e8f5ea215063ce47afaa921b"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY3NDAxMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright 2017-2019 Crown Copyright\n          \n          \n            \n             * Copyright 2020 Crown Copyright", "url": "https://github.com/gchq/Gaffer/pull/2232#discussion_r369674012", "createdAt": "2020-01-22T16:42:58Z", "author": {"login": "d47853"}, "path": "store-implementation/federated-store/src/test/java/uk/gov/gchq/gaffer/federatedstore/operation/GetAllGraphInfoTest.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2017-2019 Crown Copyright", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a9065ea0d479997e8f5ea215063ce47afaa921b"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c299ea38d4d4e179814c8bc5353216c2edc10db", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/3c299ea38d4d4e179814c8bc5353216c2edc10db", "committedDate": "2020-01-22T16:56:25Z", "message": "Apply suggestions from code review\n\nCo-Authored-By: d47853 <d47853@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3244a4ba2a4d7d7a191edbd33465b42916b990c", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/b3244a4ba2a4d7d7a191edbd33465b42916b990c", "committedDate": "2020-01-22T17:54:12Z", "message": "gh-2225 PR changes GetGraphInfo returns FederatedAccess not string."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MTg0ODcz", "url": "https://github.com/gchq/Gaffer/pull/2232#pullrequestreview-347184873", "createdAt": "2020-01-23T10:13:45Z", "commit": {"oid": "b3244a4ba2a4d7d7a191edbd33465b42916b990c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1829, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}