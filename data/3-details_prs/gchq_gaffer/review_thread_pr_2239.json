{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3OTQzMjgy", "number": 2239, "reviewThreads": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzo1NDo1NVrODeGhyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wOFQxNTo1MDoxNlrOGsM8yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyODkwODI3OnYy", "diffSide": "RIGHT", "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElements.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzo1NDo1NVrOFnFPfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wN1QxNzo1NDo1NVrOFnFPfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUyNDY3MA==", "bodyText": "2020", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r376524670", "createdAt": "2020-02-07T17:54:55Z", "author": {"login": "GCHQDev404"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElements.java", "diffHunk": "@@ -0,0 +1,259 @@\n+/*\n+ * Copyright 2017-2019 Crown Copyright", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8df72146afe7237eb55e9af08118053756217930"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzg3NTAwNTQ3OnYy", "diffSide": "RIGHT", "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElements.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xM1QxNDozOTo1MlrOJIIpeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xM1QxNDozOTo1MlrOJIIpeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjUxMDA3Mw==", "bodyText": "is 2017 correct ?", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r612510073", "createdAt": "2021-04-13T14:39:52Z", "author": {"login": "GCHQDev404"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElements.java", "diffHunk": "@@ -0,0 +1,259 @@\n+/*\n+ * Copyright 2017-2020 Crown Copyright", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d9487d3dafcd70427d887903c75ba5835b46826"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzg3NTAwODQ4OnYy", "diffSide": "RIGHT", "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueToTuple.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xM1QxNDo0MDoyMVrOJIIrTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0xM1QxNDo0MDoyMVrOJIIrTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYxMjUxMDU0MQ==", "bodyText": "If these are all new please examine all the copyright dates.", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r612510541", "createdAt": "2021-04-13T14:40:21Z", "author": {"login": "GCHQDev404"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueToTuple.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright 2019 Crown Copyright", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d9487d3dafcd70427d887903c75ba5835b46826"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzkzODI3OTYxOnYy", "diffSide": "RIGHT", "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElements.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0yOFQwOToxMDowMlrOJRKTWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0yOFQwOToxMDowMlrOJRKTWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMTk3NDM2Mw==", "bodyText": "new Class with copyright starting from 2017? This occurs many times.", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r621974363", "createdAt": "2021-04-28T09:10:02Z", "author": {"login": "GCHQDev404"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElements.java", "diffHunk": "@@ -0,0 +1,259 @@\n+/*\n+ * Copyright 2017-2021 Crown Copyright", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b9103cd1fee2a96d77e7b5c683fd3f98e1dfa2"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzkzODMxODE0OnYy", "diffSide": "RIGHT", "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElementsTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0yOFQwOToxNTowOFrOJRKp3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNC0yOFQwOToxNTowOFrOJRKp3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMTk4MDEyNg==", "bodyText": "I'm seeing warning about incomplete tests with abstract methods that have not been implemented.\nPlease review, and amend. I'm seeing this many test locations.", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r621980126", "createdAt": "2021-04-28T09:15:08Z", "author": {"login": "GCHQDev404"}, "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElementsTest.java", "diffHunk": "@@ -0,0 +1,437 @@\n+/*\n+ * Copyright 2017-2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import com.google.common.collect.Sets;\n+import org.junit.Test;\n+\n+import uk.gov.gchq.gaffer.commonutil.JsonAssert;\n+import uk.gov.gchq.gaffer.commonutil.TestGroups;\n+import uk.gov.gchq.gaffer.data.element.Edge;\n+import uk.gov.gchq.gaffer.data.element.Element;\n+import uk.gov.gchq.gaffer.data.element.Entity;\n+import uk.gov.gchq.gaffer.exception.SerialisationException;\n+import uk.gov.gchq.gaffer.jsonserialisation.JSONSerialiser;\n+import uk.gov.gchq.koryphe.binaryoperator.KorypheBinaryOperator;\n+import uk.gov.gchq.koryphe.function.FunctionTest;\n+import uk.gov.gchq.koryphe.impl.binaryoperator.CollectionConcat;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+import static uk.gov.gchq.gaffer.data.util.ElementUtil.assertElementEquals;\n+\n+public class ReduceRelatedElementsTest extends FunctionTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30b9103cd1fee2a96d77e7b5c683fd3f98e1dfa2"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDA5MDE5MzkwOnYy", "diffSide": "RIGHT", "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElements.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0wM1QxMDoyMzo0MlrOJmz1Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0yOVQxNTozNzoxNlrOKHzHOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NDY3NDg3MA==", "bodyText": "This is out of date due to how old this PR is.\nNew classes need this value to be updated for the version it will be added to.\n1.16.2 I think will be the next version.\nThis is a number that needs to be chased until it gets merged in.\nplease review for all other New classes.", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r644674870", "createdAt": "2021-06-03T10:23:42Z", "author": {"login": "GCHQDev404"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElements.java", "diffHunk": "@@ -0,0 +1,259 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonTypeInfo;\n+import org.apache.commons.lang3.StringUtils;\n+\n+import uk.gov.gchq.gaffer.data.element.Edge;\n+import uk.gov.gchq.gaffer.data.element.Element;\n+import uk.gov.gchq.gaffer.data.element.Entity;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+import uk.gov.gchq.koryphe.function.KorypheFunction;\n+import uk.gov.gchq.koryphe.impl.binaryoperator.First;\n+import uk.gov.gchq.koryphe.util.IterableUtil;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.BinaryOperator;\n+\n+import static java.util.Objects.isNull;\n+import static java.util.Objects.nonNull;\n+import static org.apache.commons.collections.CollectionUtils.isEmpty;\n+\n+/**\n+ * A {@code ReduceRelatedElements} is a {@link KorypheFunction} which takes an {@link Iterable} or {@link Element}s and\n+ * combines all related elements using the provided aggregator functions.\n+ */\n+@Since(\"1.10.6\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a6211f1d7885172b096d863bcd13b8b3bc2e2464"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NzM4NzE3Mg==", "bodyText": "Next version will be 1.17", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r647387172", "createdAt": "2021-06-08T12:24:15Z", "author": {"login": "n3101"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElements.java", "diffHunk": "@@ -0,0 +1,259 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonTypeInfo;\n+import org.apache.commons.lang3.StringUtils;\n+\n+import uk.gov.gchq.gaffer.data.element.Edge;\n+import uk.gov.gchq.gaffer.data.element.Element;\n+import uk.gov.gchq.gaffer.data.element.Entity;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+import uk.gov.gchq.koryphe.function.KorypheFunction;\n+import uk.gov.gchq.koryphe.impl.binaryoperator.First;\n+import uk.gov.gchq.koryphe.util.IterableUtil;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.BinaryOperator;\n+\n+import static java.util.Objects.isNull;\n+import static java.util.Objects.nonNull;\n+import static org.apache.commons.collections.CollectionUtils.isEmpty;\n+\n+/**\n+ * A {@code ReduceRelatedElements} is a {@link KorypheFunction} which takes an {@link Iterable} or {@link Element}s and\n+ * combines all related elements using the provided aggregator functions.\n+ */\n+@Since(\"1.10.6\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NDY3NDg3MA=="}, "originalCommit": {"oid": "a6211f1d7885172b096d863bcd13b8b3bc2e2464"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY3OTI2NjEwNA==", "bodyText": "Next version is now 1.18.0", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r679266104", "createdAt": "2021-07-29T15:37:16Z", "author": {"login": "t92549"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElements.java", "diffHunk": "@@ -0,0 +1,259 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+\n+import com.fasterxml.jackson.annotation.JsonTypeInfo;\n+import org.apache.commons.lang3.StringUtils;\n+\n+import uk.gov.gchq.gaffer.data.element.Edge;\n+import uk.gov.gchq.gaffer.data.element.Element;\n+import uk.gov.gchq.gaffer.data.element.Entity;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+import uk.gov.gchq.koryphe.function.KorypheFunction;\n+import uk.gov.gchq.koryphe.impl.binaryoperator.First;\n+import uk.gov.gchq.koryphe.util.IterableUtil;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.BinaryOperator;\n+\n+import static java.util.Objects.isNull;\n+import static java.util.Objects.nonNull;\n+import static org.apache.commons.collections.CollectionUtils.isEmpty;\n+\n+/**\n+ * A {@code ReduceRelatedElements} is a {@link KorypheFunction} which takes an {@link Iterable} or {@link Element}s and\n+ * combines all related elements using the provided aggregator functions.\n+ */\n+@Since(\"1.10.6\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0NDY3NDg3MA=="}, "originalCommit": {"oid": "a6211f1d7885172b096d863bcd13b8b3bc2e2464"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDEyNDI4MjA5OnYy", "diffSide": "RIGHT", "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueToTupleTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0xMVQwOTo0NTozMFrOJrvVQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0xMVQwOTo0NTozMFrOJrvVQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTg0NDAzMw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return new Class[]{String.class};\n          \n          \n            \n                    return new Class[]{Tuple.class};", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r649844033", "createdAt": "2021-06-11T09:45:30Z", "author": {"login": "GCHQDev404"}, "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueToTupleTest.java", "diffHunk": "@@ -0,0 +1,138 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import com.google.common.collect.Lists;\n+import org.junit.Test;\n+\n+import uk.gov.gchq.gaffer.commonutil.JsonAssert;\n+import uk.gov.gchq.gaffer.exception.SerialisationException;\n+import uk.gov.gchq.gaffer.jsonserialisation.JSONSerialiser;\n+import uk.gov.gchq.gaffer.types.TypeSubTypeValue;\n+import uk.gov.gchq.koryphe.function.FunctionComposite;\n+import uk.gov.gchq.koryphe.function.FunctionTest;\n+import uk.gov.gchq.koryphe.impl.function.Length;\n+import uk.gov.gchq.koryphe.impl.function.ToString;\n+import uk.gov.gchq.koryphe.tuple.Tuple;\n+import uk.gov.gchq.koryphe.tuple.function.TupleAdaptedFunctionComposite;\n+\n+import java.util.Arrays;\n+import java.util.function.Function;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+public class TypeSubTypeValueToTupleTest extends FunctionTest<TypeSubTypeValueToTuple> {\n+\n+    @Test\n+    public void shouldHandleNullInput() {\n+        // Given\n+        final TypeSubTypeValueToTuple function = getInstance();\n+\n+        // When\n+        final Tuple<String> result = function.apply(null);\n+\n+        // Then\n+        assertNull(result);\n+    }\n+\n+    @Test\n+    public void shouldConvertTypeSubTypeValueToTuple() {\n+        // Given\n+        final TypeSubTypeValue typeSubTypeValue = new TypeSubTypeValue(\"type\", \"subType\", \"value\");\n+        final TypeSubTypeValueToTuple function = getInstance();\n+\n+        // When\n+        final Tuple<String> result = function.apply(typeSubTypeValue);\n+\n+        // Then\n+        assertEquals(\"type\", result.get(\"type\"));\n+        assertEquals(\"value\", result.get(\"value\"));\n+    }\n+\n+    @Test\n+    public void shouldGetAndSetUsingCompositeFunction() {\n+        // Given\n+        final TypeSubTypeValue typeSubTypeValue = new TypeSubTypeValue(\"type\", \"subType\", \"value\");\n+        final Function<Object, Object> compositeFunction = new FunctionComposite(Lists.newArrayList(\n+                new TypeSubTypeValueToTuple(),\n+                new TupleAdaptedFunctionComposite.Builder()\n+                        .select(new String[]{\"value\"})\n+                        .execute(new FunctionComposite(Arrays.asList(\n+                                new Length(),\n+                                new ToString()\n+                        )))\n+                        .project(new String[]{\"type\"})\n+                        .build()\n+        ));\n+\n+        // When\n+        compositeFunction.apply(typeSubTypeValue);\n+\n+        // Then\n+        assertEquals(new TypeSubTypeValue(\"5\", \"subType\", \"value\"), typeSubTypeValue);\n+    }\n+\n+    @Override\n+    protected TypeSubTypeValueToTuple getInstance() {\n+        return new TypeSubTypeValueToTuple();\n+    }\n+\n+    @Override\n+    protected Iterable getDifferentInstancesOrNull() {\n+        return null;\n+    }\n+\n+    @Override\n+    protected Class<? extends TypeSubTypeValueToTuple> getFunctionClass() {\n+        return TypeSubTypeValueToTuple.class;\n+    }\n+\n+    @Override\n+    protected Class[] getExpectedSignatureInputClasses() {\n+        return new Class[]{TypeSubTypeValue.class};\n+    }\n+\n+    @Override\n+    protected Class[] getExpectedSignatureOutputClasses() {\n+        return new Class[]{String.class};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "762eb19c8015f21cb1b8a4a65285b4b9a6518b35"}, "originalPosition": 113}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDEyNDI4NTU0OnYy", "diffSide": "RIGHT", "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/TypeValueToTupleTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0xMVQwOTo0NjoyOVrOJrvXjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0xMVQwOTo0NjoyOVrOJrvXjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTg0NDYyMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return new Class[]{TypeValue.class};\n          \n          \n            \n                    return new Class[]{Tuple.class};", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r649844622", "createdAt": "2021-06-11T09:46:29Z", "author": {"login": "GCHQDev404"}, "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/TypeValueToTupleTest.java", "diffHunk": "@@ -0,0 +1,137 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import com.google.common.collect.Lists;\n+import org.junit.Test;\n+\n+import uk.gov.gchq.gaffer.commonutil.JsonAssert;\n+import uk.gov.gchq.gaffer.exception.SerialisationException;\n+import uk.gov.gchq.gaffer.jsonserialisation.JSONSerialiser;\n+import uk.gov.gchq.gaffer.types.TypeValue;\n+import uk.gov.gchq.koryphe.function.FunctionComposite;\n+import uk.gov.gchq.koryphe.function.FunctionTest;\n+import uk.gov.gchq.koryphe.impl.function.Length;\n+import uk.gov.gchq.koryphe.impl.function.ToString;\n+import uk.gov.gchq.koryphe.tuple.Tuple;\n+import uk.gov.gchq.koryphe.tuple.function.TupleAdaptedFunctionComposite;\n+\n+import java.util.Arrays;\n+import java.util.function.Function;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+\n+public class TypeValueToTupleTest extends FunctionTest {\n+\n+    @Test\n+    public void shouldHandleNullInput() {\n+        // Given\n+        final TypeValueToTuple function = getInstance();\n+\n+        // When\n+        final Tuple<String> result = function.apply(null);\n+\n+        // Then\n+        assertNull(result);\n+    }\n+\n+    @Test\n+    public void shouldConvertTypeValueToTuple() {\n+        // Given\n+        final TypeValue typeValue = new TypeValue(\"type\", \"value\");\n+        final TypeValueToTuple function = getInstance();\n+\n+        // When\n+        final Tuple<String> result = function.apply(typeValue);\n+\n+        // Then\n+        assertEquals(\"type\", result.get(\"type\"));\n+        assertEquals(\"value\", result.get(\"value\"));\n+    }\n+\n+    @Test\n+    public void shouldGetAndSetUsingCompositeFunction() {\n+        // Given\n+        final TypeValue typeValue = new TypeValue(\"type\", \"value\");\n+        final Function<Object, Object> compositeFunction = new FunctionComposite(Lists.newArrayList(\n+                new TypeValueToTuple(),\n+                new TupleAdaptedFunctionComposite.Builder()\n+                        .select(new String[]{\"value\"})\n+                        .execute(new FunctionComposite(Arrays.asList(\n+                                new Length(),\n+                                new ToString()\n+                        )))\n+                        .project(new String[]{\"type\"})\n+                        .build()\n+        ));\n+\n+        // When\n+        compositeFunction.apply(typeValue);\n+\n+        // Then\n+        assertEquals(new TypeValue(\"5\", \"value\"), typeValue);\n+    }\n+\n+    @Override\n+    protected TypeValueToTuple getInstance() {\n+        return new TypeValueToTuple();\n+    }\n+\n+    @Override\n+    protected Iterable getDifferentInstancesOrNull() {\n+        return null;\n+    }\n+\n+    @Override\n+    protected Class<? extends TypeValueToTuple> getFunctionClass() {\n+        return TypeValueToTuple.class;\n+    }\n+\n+    @Override\n+    protected Class[] getExpectedSignatureInputClasses() {\n+        return new Class[]{TypeValue.class};\n+    }\n+\n+    @Override\n+    protected Class[] getExpectedSignatureOutputClasses() {\n+        return new Class[]{TypeValue.class};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "762eb19c8015f21cb1b8a4a65285b4b9a6518b35"}, "originalPosition": 112}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDEyNDI4ODg2OnYy", "diffSide": "RIGHT", "path": "core/operation/src/test/java/uk/gov/gchq/gaffer/operation/function/ToTrailingWildcardPairTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0xMVQwOTo0NzoxOFrOJrvZrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0xMVQwOTo0NzoxOFrOJrvZrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTg0NTE2Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return new Class[0];\n          \n          \n            \n                    return new Class[]{String.class};", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r649845166", "createdAt": "2021-06-11T09:47:18Z", "author": {"login": "GCHQDev404"}, "path": "core/operation/src/test/java/uk/gov/gchq/gaffer/operation/function/ToTrailingWildcardPairTest.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.operation.function;\n+\n+import org.junit.Test;\n+\n+import uk.gov.gchq.gaffer.commonutil.JsonAssert;\n+import uk.gov.gchq.gaffer.commonutil.pair.Pair;\n+import uk.gov.gchq.gaffer.data.element.id.EntityId;\n+import uk.gov.gchq.gaffer.exception.SerialisationException;\n+import uk.gov.gchq.gaffer.jsonserialisation.JSONSerialiser;\n+import uk.gov.gchq.koryphe.function.FunctionTest;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+\n+public class ToTrailingWildcardPairTest extends FunctionTest {\n+\n+    @Test\n+    public void shouldHandleNullInput() {\n+        // Given\n+        final ToTrailingWildcardPair function = new ToTrailingWildcardPair();\n+\n+        // When\n+        final Pair<EntityId, EntityId> result = function.apply(null);\n+\n+        // Then\n+        assertNull(result);\n+    }\n+\n+    @Test\n+    public void shouldCreateEntityIdPair() {\n+        // Given\n+        final ToTrailingWildcardPair function = new ToTrailingWildcardPair();\n+\n+        // When\n+        final Pair<EntityId, EntityId> result = function.apply(\"value1\");\n+\n+        // Then\n+        assertEquals(\"value1\", result.getFirst().getVertex());\n+        assertEquals(\"value1~\", result.getSecond().getVertex());\n+    }\n+\n+    @Override\n+    protected ToTrailingWildcardPair getInstance() {\n+        return new ToTrailingWildcardPair();\n+    }\n+\n+    @Override\n+    protected Iterable getDifferentInstancesOrNull() {\n+        return null;\n+    }\n+\n+    @Override\n+    protected Class<? extends ToTrailingWildcardPair> getFunctionClass() {\n+        return ToTrailingWildcardPair.class;\n+    }\n+\n+    @Override\n+    protected Class[] getExpectedSignatureInputClasses() {\n+        return new Class[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "762eb19c8015f21cb1b8a4a65285b4b9a6518b35"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDEyNDI4OTk0OnYy", "diffSide": "RIGHT", "path": "core/operation/src/test/java/uk/gov/gchq/gaffer/operation/function/ToTrailingWildcardPairTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0xMVQwOTo0NzozNFrOJrvaUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0xMVQwOTo0NzozNFrOJrvaUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTg0NTMzMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return new Class[0];\n          \n          \n            \n                    return new Class[]{Pair.class};", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r649845331", "createdAt": "2021-06-11T09:47:34Z", "author": {"login": "GCHQDev404"}, "path": "core/operation/src/test/java/uk/gov/gchq/gaffer/operation/function/ToTrailingWildcardPairTest.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.operation.function;\n+\n+import org.junit.Test;\n+\n+import uk.gov.gchq.gaffer.commonutil.JsonAssert;\n+import uk.gov.gchq.gaffer.commonutil.pair.Pair;\n+import uk.gov.gchq.gaffer.data.element.id.EntityId;\n+import uk.gov.gchq.gaffer.exception.SerialisationException;\n+import uk.gov.gchq.gaffer.jsonserialisation.JSONSerialiser;\n+import uk.gov.gchq.koryphe.function.FunctionTest;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+\n+public class ToTrailingWildcardPairTest extends FunctionTest {\n+\n+    @Test\n+    public void shouldHandleNullInput() {\n+        // Given\n+        final ToTrailingWildcardPair function = new ToTrailingWildcardPair();\n+\n+        // When\n+        final Pair<EntityId, EntityId> result = function.apply(null);\n+\n+        // Then\n+        assertNull(result);\n+    }\n+\n+    @Test\n+    public void shouldCreateEntityIdPair() {\n+        // Given\n+        final ToTrailingWildcardPair function = new ToTrailingWildcardPair();\n+\n+        // When\n+        final Pair<EntityId, EntityId> result = function.apply(\"value1\");\n+\n+        // Then\n+        assertEquals(\"value1\", result.getFirst().getVertex());\n+        assertEquals(\"value1~\", result.getSecond().getVertex());\n+    }\n+\n+    @Override\n+    protected ToTrailingWildcardPair getInstance() {\n+        return new ToTrailingWildcardPair();\n+    }\n+\n+    @Override\n+    protected Iterable getDifferentInstancesOrNull() {\n+        return null;\n+    }\n+\n+    @Override\n+    protected Class<? extends ToTrailingWildcardPair> getFunctionClass() {\n+        return ToTrailingWildcardPair.class;\n+    }\n+\n+    @Override\n+    protected Class[] getExpectedSignatureInputClasses() {\n+        return new Class[0];\n+    }\n+\n+    @Override\n+    protected Class[] getExpectedSignatureOutputClasses() {\n+        return new Class[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "762eb19c8015f21cb1b8a4a65285b4b9a6518b35"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDEyNDMyNTQxOnYy", "diffSide": "RIGHT", "path": "core/operation/src/test/java/uk/gov/gchq/gaffer/operation/function/ToTrailingWildcardPairTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0xMVQwOTo1NjowNlrOJrvvmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0xMVQwOTo1NjowNlrOJrvvmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTg1MDc3Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class ToTrailingWildcardPairTest extends FunctionTest {\n          \n          \n            \n            public class ToTrailingWildcardPairTest extends FunctionTest<ToTrailingWildcardPair> {", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r649850777", "createdAt": "2021-06-11T09:56:06Z", "author": {"login": "GCHQDev404"}, "path": "core/operation/src/test/java/uk/gov/gchq/gaffer/operation/function/ToTrailingWildcardPairTest.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.operation.function;\n+\n+import org.junit.Test;\n+\n+import uk.gov.gchq.gaffer.commonutil.JsonAssert;\n+import uk.gov.gchq.gaffer.commonutil.pair.Pair;\n+import uk.gov.gchq.gaffer.data.element.id.EntityId;\n+import uk.gov.gchq.gaffer.exception.SerialisationException;\n+import uk.gov.gchq.gaffer.jsonserialisation.JSONSerialiser;\n+import uk.gov.gchq.koryphe.function.FunctionTest;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+\n+public class ToTrailingWildcardPairTest extends FunctionTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "762eb19c8015f21cb1b8a4a65285b4b9a6518b35"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDEyNDMyOTQ1OnYy", "diffSide": "RIGHT", "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/TypeValueToTupleTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0xMVQwOTo1NzowNVrOJrvyCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0xMVQwOTo1NzowNVrOJrvyCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0OTg1MTQwMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class TypeValueToTupleTest extends FunctionTest {\n          \n          \n            \n            public class TypeValueToTupleTest extends FunctionTest<TypeValueToTuple> {", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r649851400", "createdAt": "2021-06-11T09:57:05Z", "author": {"login": "GCHQDev404"}, "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/TypeValueToTupleTest.java", "diffHunk": "@@ -0,0 +1,137 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import com.google.common.collect.Lists;\n+import org.junit.Test;\n+\n+import uk.gov.gchq.gaffer.commonutil.JsonAssert;\n+import uk.gov.gchq.gaffer.exception.SerialisationException;\n+import uk.gov.gchq.gaffer.jsonserialisation.JSONSerialiser;\n+import uk.gov.gchq.gaffer.types.TypeValue;\n+import uk.gov.gchq.koryphe.function.FunctionComposite;\n+import uk.gov.gchq.koryphe.function.FunctionTest;\n+import uk.gov.gchq.koryphe.impl.function.Length;\n+import uk.gov.gchq.koryphe.impl.function.ToString;\n+import uk.gov.gchq.koryphe.tuple.Tuple;\n+import uk.gov.gchq.koryphe.tuple.function.TupleAdaptedFunctionComposite;\n+\n+import java.util.Arrays;\n+import java.util.function.Function;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+\n+public class TypeValueToTupleTest extends FunctionTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "762eb19c8015f21cb1b8a4a65285b4b9a6518b35"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDM0NDc5OTMwOnYy", "diffSide": "RIGHT", "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueTuple.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0wNFQxNzo0ODoyNVrOKLMzsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0wNFQxNzo0ODoyNVrOKLMzsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MjgzMjgxNw==", "bodyText": "Formatting tidy up here.", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r682832817", "createdAt": "2021-08-04T17:48:25Z", "author": {"login": "t511203"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueTuple.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import uk.gov.gchq.gaffer.types.TypeSubTypeValue;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+import uk.gov.gchq.koryphe.tuple.Tuple;\n+\n+import java.util.Arrays;\n+\n+import static java.util.Objects.isNull;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "636a27a3e415ec8e1da76f0b52bfd8ea1c8aeb24"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDM0NDgwMDU0OnYy", "diffSide": "RIGHT", "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueTuple.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0wNFQxNzo0ODo0MFrOKLM0aw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0wNFQxODozNzozNFrOKLO0qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MjgzMzAwMw==", "bodyText": "Missing Javadoc.", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r682833003", "createdAt": "2021-08-04T17:48:40Z", "author": {"login": "t511203"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueTuple.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import uk.gov.gchq.gaffer.types.TypeSubTypeValue;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+import uk.gov.gchq.koryphe.tuple.Tuple;\n+\n+import java.util.Arrays;\n+\n+import static java.util.Objects.isNull;\n+@Since(\"1.17.0\")\n+@Summary(\"Tuple object for TypeSubTypeValue\")\n+public class TypeSubTypeValueTuple implements Tuple<String> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "636a27a3e415ec8e1da76f0b52bfd8ea1c8aeb24"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Mjg0MTI1Nw==", "bodyText": "Also worth updating these as the next release this will go into will be 1.19.0 now.", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r682841257", "createdAt": "2021-08-04T18:00:16Z", "author": {"login": "t92549"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueTuple.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import uk.gov.gchq.gaffer.types.TypeSubTypeValue;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+import uk.gov.gchq.koryphe.tuple.Tuple;\n+\n+import java.util.Arrays;\n+\n+import static java.util.Objects.isNull;\n+@Since(\"1.17.0\")\n+@Summary(\"Tuple object for TypeSubTypeValue\")\n+public class TypeSubTypeValueTuple implements Tuple<String> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MjgzMzAwMw=="}, "originalCommit": {"oid": "636a27a3e415ec8e1da76f0b52bfd8ea1c8aeb24"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Mjg2NTgzMg==", "bodyText": ":D this could go on indefinitely.", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r682865832", "createdAt": "2021-08-04T18:37:34Z", "author": {"login": "GCHQDev404"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueTuple.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import uk.gov.gchq.gaffer.types.TypeSubTypeValue;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+import uk.gov.gchq.koryphe.tuple.Tuple;\n+\n+import java.util.Arrays;\n+\n+import static java.util.Objects.isNull;\n+@Since(\"1.17.0\")\n+@Summary(\"Tuple object for TypeSubTypeValue\")\n+public class TypeSubTypeValueTuple implements Tuple<String> {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MjgzMzAwMw=="}, "originalCommit": {"oid": "636a27a3e415ec8e1da76f0b52bfd8ea1c8aeb24"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDM0NDgwNzI5OnYy", "diffSide": "RIGHT", "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueTuple.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0wNFQxNzo0OTo1OFrOKLM4Uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0wNFQxODozNDo0MFrOKLOtHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MjgzNDAwMw==", "bodyText": "Might be safer to remove this telescoping constructor behaviour.", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r682834003", "createdAt": "2021-08-04T17:49:58Z", "author": {"login": "t511203"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueTuple.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import uk.gov.gchq.gaffer.types.TypeSubTypeValue;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+import uk.gov.gchq.koryphe.tuple.Tuple;\n+\n+import java.util.Arrays;\n+\n+import static java.util.Objects.isNull;\n+@Since(\"1.17.0\")\n+@Summary(\"Tuple object for TypeSubTypeValue\")\n+public class TypeSubTypeValueTuple implements Tuple<String> {\n+    private TypeSubTypeValue tsv;\n+\n+    public TypeSubTypeValueTuple() {\n+        this(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "636a27a3e415ec8e1da76f0b52bfd8ea1c8aeb24"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4Mjg2MzkwMw==", "bodyText": "Why? the issue with telescoping contractors behaviour is the parameter list grows and grows, this has 1 thing in it.", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r682863903", "createdAt": "2021-08-04T18:34:40Z", "author": {"login": "GCHQDev404"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueTuple.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import uk.gov.gchq.gaffer.types.TypeSubTypeValue;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+import uk.gov.gchq.koryphe.tuple.Tuple;\n+\n+import java.util.Arrays;\n+\n+import static java.util.Objects.isNull;\n+@Since(\"1.17.0\")\n+@Summary(\"Tuple object for TypeSubTypeValue\")\n+public class TypeSubTypeValueTuple implements Tuple<String> {\n+    private TypeSubTypeValue tsv;\n+\n+    public TypeSubTypeValueTuple() {\n+        this(null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MjgzNDAwMw=="}, "originalCommit": {"oid": "636a27a3e415ec8e1da76f0b52bfd8ea1c8aeb24"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDM0NDgxMTk4OnYy", "diffSide": "RIGHT", "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeValueTuple.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0wNFQxNzo1MDo1OVrOKLM7Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0wNFQxNzo1MDo1OVrOKLM7Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4MjgzNDcxNQ==", "bodyText": "Same comment here regarding telescoping constructors.", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r682834715", "createdAt": "2021-08-04T17:50:59Z", "author": {"login": "t511203"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeValueTuple.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import uk.gov.gchq.gaffer.types.TypeValue;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+import uk.gov.gchq.koryphe.tuple.Tuple;\n+\n+import java.util.Arrays;\n+\n+import static java.util.Objects.isNull;\n+@Since(\"1.17.0\")\n+@Summary(\"Converts an TypeSubTypeValue into a Tuple\")\n+public class TypeValueTuple implements Tuple<String> {\n+    private TypeValue tv;\n+\n+    public TypeValueTuple() {\n+        this(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "636a27a3e415ec8e1da76f0b52bfd8ea1c8aeb24"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDM2NjYzODYzOnYy", "diffSide": "RIGHT", "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/TypeValueToTupleTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0xMFQxNDoxNDoyNVrOKOR3qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0xMFQxNTowMjozN1rOKOUntQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjA2MTQ4Mg==", "bodyText": "Perhaps this should be changed back to Class[]{String.class}. Despite the slightly confusing layout, checking that the Tuple contains the correct type is potentially more useful, as explained in gchq/koryphe#225 (comment).", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r686061482", "createdAt": "2021-08-10T14:14:25Z", "author": {"login": "t92549"}, "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/TypeValueToTupleTest.java", "diffHunk": "@@ -0,0 +1,132 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import com.google.common.collect.Lists;\n+import org.junit.jupiter.api.Test;\n+\n+import uk.gov.gchq.gaffer.commonutil.JsonAssert;\n+import uk.gov.gchq.gaffer.exception.SerialisationException;\n+import uk.gov.gchq.gaffer.jsonserialisation.JSONSerialiser;\n+import uk.gov.gchq.gaffer.types.TypeValue;\n+import uk.gov.gchq.koryphe.function.FunctionComposite;\n+import uk.gov.gchq.koryphe.function.FunctionTest;\n+import uk.gov.gchq.koryphe.impl.function.Length;\n+import uk.gov.gchq.koryphe.impl.function.ToString;\n+import uk.gov.gchq.koryphe.tuple.Tuple;\n+import uk.gov.gchq.koryphe.tuple.function.TupleAdaptedFunctionComposite;\n+\n+import java.util.Arrays;\n+import java.util.function.Function;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertNull;\n+\n+public class TypeValueToTupleTest extends FunctionTest<TypeValueToTuple> {\n+\n+    @Test\n+    public void shouldHandleNullInput() {\n+        // Given\n+        final TypeValueToTuple function = getInstance();\n+\n+        // When\n+        final Tuple<String> result = function.apply(null);\n+\n+        // Then\n+        assertNull(result);\n+    }\n+\n+    @Test\n+    public void shouldConvertTypeValueToTuple() {\n+        // Given\n+        final TypeValue typeValue = new TypeValue(\"type\", \"value\");\n+        final TypeValueToTuple function = getInstance();\n+\n+        // When\n+        final Tuple<String> result = function.apply(typeValue);\n+\n+        // Then\n+        assertEquals(\"type\", result.get(\"type\"));\n+        assertEquals(\"value\", result.get(\"value\"));\n+    }\n+\n+    @Test\n+    public void shouldGetAndSetUsingCompositeFunction() {\n+        // Given\n+        final TypeValue typeValue = new TypeValue(\"type\", \"value\");\n+        final Function<Object, Object> compositeFunction = new FunctionComposite(Lists.newArrayList(\n+                new TypeValueToTuple(),\n+                new TupleAdaptedFunctionComposite.Builder()\n+                        .select(new String[]{\"value\"})\n+                        .execute(new FunctionComposite(Arrays.asList(\n+                                new Length(),\n+                                new ToString()\n+                        )))\n+                        .project(new String[]{\"type\"})\n+                        .build()\n+        ));\n+\n+        // When\n+        compositeFunction.apply(typeValue);\n+\n+        // Then\n+        assertEquals(new TypeValue(\"5\", \"value\"), typeValue);\n+    }\n+\n+    @Override\n+    protected TypeValueToTuple getInstance() {\n+        return new TypeValueToTuple();\n+    }\n+\n+    @Override\n+    protected Iterable getDifferentInstancesOrNull() {\n+        return null;\n+    }\n+\n+    @Override\n+    protected Class<? extends TypeValueToTuple> getFunctionClass() {\n+        return TypeValueToTuple.class;\n+    }\n+\n+    @Override\n+    protected Class[] getExpectedSignatureInputClasses() {\n+        return new Class[]{TypeValue.class};\n+    }\n+\n+    @Override\n+    protected Class[] getExpectedSignatureOutputClasses() {\n+        return new Class[]{TypeValueTuple.class};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e07f416fbf544155759fcbfec4db6b41bf486fba"}, "originalPosition": 112}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjEwNjU0OQ==", "bodyText": "After some more understanding, it is okay for Gaffer to implement its own concrete implementations of a Tuple and test for those types (see gchq/koryphe#225 (comment)). No changes should be required here.", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r686106549", "createdAt": "2021-08-10T15:02:37Z", "author": {"login": "t92549"}, "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/TypeValueToTupleTest.java", "diffHunk": "@@ -0,0 +1,132 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import com.google.common.collect.Lists;\n+import org.junit.jupiter.api.Test;\n+\n+import uk.gov.gchq.gaffer.commonutil.JsonAssert;\n+import uk.gov.gchq.gaffer.exception.SerialisationException;\n+import uk.gov.gchq.gaffer.jsonserialisation.JSONSerialiser;\n+import uk.gov.gchq.gaffer.types.TypeValue;\n+import uk.gov.gchq.koryphe.function.FunctionComposite;\n+import uk.gov.gchq.koryphe.function.FunctionTest;\n+import uk.gov.gchq.koryphe.impl.function.Length;\n+import uk.gov.gchq.koryphe.impl.function.ToString;\n+import uk.gov.gchq.koryphe.tuple.Tuple;\n+import uk.gov.gchq.koryphe.tuple.function.TupleAdaptedFunctionComposite;\n+\n+import java.util.Arrays;\n+import java.util.function.Function;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertNull;\n+\n+public class TypeValueToTupleTest extends FunctionTest<TypeValueToTuple> {\n+\n+    @Test\n+    public void shouldHandleNullInput() {\n+        // Given\n+        final TypeValueToTuple function = getInstance();\n+\n+        // When\n+        final Tuple<String> result = function.apply(null);\n+\n+        // Then\n+        assertNull(result);\n+    }\n+\n+    @Test\n+    public void shouldConvertTypeValueToTuple() {\n+        // Given\n+        final TypeValue typeValue = new TypeValue(\"type\", \"value\");\n+        final TypeValueToTuple function = getInstance();\n+\n+        // When\n+        final Tuple<String> result = function.apply(typeValue);\n+\n+        // Then\n+        assertEquals(\"type\", result.get(\"type\"));\n+        assertEquals(\"value\", result.get(\"value\"));\n+    }\n+\n+    @Test\n+    public void shouldGetAndSetUsingCompositeFunction() {\n+        // Given\n+        final TypeValue typeValue = new TypeValue(\"type\", \"value\");\n+        final Function<Object, Object> compositeFunction = new FunctionComposite(Lists.newArrayList(\n+                new TypeValueToTuple(),\n+                new TupleAdaptedFunctionComposite.Builder()\n+                        .select(new String[]{\"value\"})\n+                        .execute(new FunctionComposite(Arrays.asList(\n+                                new Length(),\n+                                new ToString()\n+                        )))\n+                        .project(new String[]{\"type\"})\n+                        .build()\n+        ));\n+\n+        // When\n+        compositeFunction.apply(typeValue);\n+\n+        // Then\n+        assertEquals(new TypeValue(\"5\", \"value\"), typeValue);\n+    }\n+\n+    @Override\n+    protected TypeValueToTuple getInstance() {\n+        return new TypeValueToTuple();\n+    }\n+\n+    @Override\n+    protected Iterable getDifferentInstancesOrNull() {\n+        return null;\n+    }\n+\n+    @Override\n+    protected Class<? extends TypeValueToTuple> getFunctionClass() {\n+        return TypeValueToTuple.class;\n+    }\n+\n+    @Override\n+    protected Class[] getExpectedSignatureInputClasses() {\n+        return new Class[]{TypeValue.class};\n+    }\n+\n+    @Override\n+    protected Class[] getExpectedSignatureOutputClasses() {\n+        return new Class[]{TypeValueTuple.class};", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjA2MTQ4Mg=="}, "originalCommit": {"oid": "e07f416fbf544155759fcbfec4db6b41bf486fba"}, "originalPosition": 112}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDM2NjY0MDQwOnYy", "diffSide": "RIGHT", "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeValueToTuple.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0xMFQxNDoxNDo0MVrOKOR4sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOC0xMFQxNDoyMzoyNlrOKOSZCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjA2MTc0NA==", "bodyText": "Perhaps this should be changed back to Tuple<String>. This ensures that the output signature can be properly tested, as explained below. As well as this, it is more obvious what should go inside the Tuple. If this is the case, then perhaps this should also be changed in TypeSubTypeValueToTuple as well as some other places in the code base too?", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r686061744", "createdAt": "2021-08-10T14:14:41Z", "author": {"login": "t92549"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeValueToTuple.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import uk.gov.gchq.gaffer.types.TypeValue;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+import uk.gov.gchq.koryphe.function.KorypheFunction;\n+\n+/**\n+ * A {@code TypeValueToTuple} is a {@link KorypheFunction} that converts an {@link TypeValue} into a {@link TypeValueTuple}.\n+ */\n+@Since(\"1.19.0\")\n+@Summary(\"Converts an TypeValue into a Tuple\")\n+public class TypeValueToTuple extends KorypheFunction<TypeValue, TypeValueTuple> {\n+    @Override\n+    public TypeValueTuple apply(final TypeValue input) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e07f416fbf544155759fcbfec4db6b41bf486fba"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjA3MDAyNg==", "bodyText": "Or perhaps creating and testing for a specific TypeValueTuple is preferred?", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r686070026", "createdAt": "2021-08-10T14:23:26Z", "author": {"login": "t92549"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeValueToTuple.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import uk.gov.gchq.gaffer.types.TypeValue;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+import uk.gov.gchq.koryphe.function.KorypheFunction;\n+\n+/**\n+ * A {@code TypeValueToTuple} is a {@link KorypheFunction} that converts an {@link TypeValue} into a {@link TypeValueTuple}.\n+ */\n+@Since(\"1.19.0\")\n+@Summary(\"Converts an TypeValue into a Tuple\")\n+public class TypeValueToTuple extends KorypheFunction<TypeValue, TypeValueTuple> {\n+    @Override\n+    public TypeValueTuple apply(final TypeValue input) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY4NjA2MTc0NA=="}, "originalCommit": {"oid": "e07f416fbf544155759fcbfec4db6b41bf486fba"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ4OTc4MjkyOnYy", "diffSide": "RIGHT", "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueTuple.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wOFQxNTowODoyMlrOKf4ISA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wOFQxNTowODoyMlrOKf4ISA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNDUxNDEyMA==", "bodyText": "Might be worth sticking these literals in constants considering they're reused a bit", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r704514120", "createdAt": "2021-09-08T15:08:22Z", "author": {"login": "t11947"}, "path": "core/data/src/main/java/uk/gov/gchq/gaffer/data/element/function/TypeSubTypeValueTuple.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import uk.gov.gchq.gaffer.types.TypeSubTypeValue;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+import uk.gov.gchq.koryphe.tuple.Tuple;\n+\n+import java.util.Arrays;\n+\n+import static java.util.Objects.isNull;\n+\n+/**\n+ * A {@link TypeSubTypeValueTuple} class represents a {@link TypeSubTypeValue} object as a Koryphe n-valued {@link Tuple}.\n+ */\n+@Since(\"1.19.0\")\n+@Summary(\"Tuple object for TypeSubTypeValue\")\n+public class TypeSubTypeValueTuple implements Tuple<String> {\n+    private final TypeSubTypeValue tsv;\n+\n+    public TypeSubTypeValueTuple() {\n+        this.tsv = new TypeSubTypeValue();\n+    }\n+\n+    public TypeSubTypeValueTuple(final TypeSubTypeValue tsv) {\n+        if (isNull(tsv)) {\n+            this.tsv = new TypeSubTypeValue();\n+        } else {\n+            this.tsv = tsv;\n+        }\n+    }\n+\n+    @Override\n+    public void put(final String key, final Object value) {\n+        final String stringValue = isNull(value) ? null : value.toString();\n+        if (\"type\".equalsIgnoreCase(key)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa1ad553d5762291517f26cf0aaa1e2c5888f9bb"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ4OTgwNDU0OnYy", "diffSide": "RIGHT", "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElementsTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wOFQxNToxMTo0M1rOKf4VFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wOFQxNToxMTo0M1rOKf4VFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNDUxNzM5Ng==", "bodyText": "I'd probably find another way to get the test to pass", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r704517396", "createdAt": "2021-09-08T15:11:43Z", "author": {"login": "t11947"}, "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElementsTest.java", "diffHunk": "@@ -0,0 +1,453 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import com.google.common.collect.Sets;\n+import org.junit.jupiter.api.Test;\n+\n+import uk.gov.gchq.gaffer.commonutil.JsonAssert;\n+import uk.gov.gchq.gaffer.commonutil.TestGroups;\n+import uk.gov.gchq.gaffer.data.element.Edge;\n+import uk.gov.gchq.gaffer.data.element.Element;\n+import uk.gov.gchq.gaffer.data.element.Entity;\n+import uk.gov.gchq.gaffer.exception.SerialisationException;\n+import uk.gov.gchq.gaffer.jsonserialisation.JSONSerialiser;\n+import uk.gov.gchq.koryphe.binaryoperator.KorypheBinaryOperator;\n+import uk.gov.gchq.koryphe.function.FunctionTest;\n+import uk.gov.gchq.koryphe.impl.binaryoperator.CollectionConcat;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import static uk.gov.gchq.gaffer.data.util.ElementUtil.assertElementEquals;\n+\n+public class ReduceRelatedElementsTest extends FunctionTest<ReduceRelatedElements> {\n+    public static final String RELATES_TO = \"relatesTo\";\n+    public static final String VISIBILITY = \"visibility\";\n+\n+    @Test\n+    public void shouldReturnNullForNullValue() {\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+\n+        // When\n+        final Object result = function.apply(null);\n+\n+        // Then\n+        assertNull(result);\n+    }\n+\n+    @Test\n+    public void shouldReduceRelatedElements() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build()\n+        );\n+\n+        // When\n+        final Iterable<Element> result = function.apply(elements);\n+\n+        // Then\n+        final List<Element> expectedElements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\", \"private\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex3a))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2b)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"relatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build()\n+        );\n+        assertElementEquals(expectedElements, result);\n+    }\n+\n+    @Test\n+    public void shouldReduceRelatedElementsWithManyRelationships() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+        Object vertex4a = \"vertex4a\";\n+        Object vertex4b = \"vertex4b longest\";\n+        Object vertex5a = \"vertex5a\";\n+        Object vertex5b = \"vertex5b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex4b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex5b)\n+                        .dest(vertex4a)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build()\n+        );\n+\n+        // When\n+        final Iterable<Element> result = function.apply(elements);\n+\n+        // Then\n+        final List<Element> expectedElements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\", \"private\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex3a))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2b)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"relatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build()\n+        );\n+//        assertElementEquals(expectedElements, result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa1ad553d5762291517f26cf0aaa1e2c5888f9bb"}, "originalPosition": 261}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ4OTgxMjkzOnYy", "diffSide": "RIGHT", "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElementsTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wOFQxNToxMzowN1rOKf4aOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wOFQxNToxMzowN1rOKf4aOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNDUxODcxNA==", "bodyText": "Consider using assertThrows", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r704518714", "createdAt": "2021-09-08T15:13:07Z", "author": {"login": "t11947"}, "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElementsTest.java", "diffHunk": "@@ -0,0 +1,453 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import com.google.common.collect.Sets;\n+import org.junit.jupiter.api.Test;\n+\n+import uk.gov.gchq.gaffer.commonutil.JsonAssert;\n+import uk.gov.gchq.gaffer.commonutil.TestGroups;\n+import uk.gov.gchq.gaffer.data.element.Edge;\n+import uk.gov.gchq.gaffer.data.element.Element;\n+import uk.gov.gchq.gaffer.data.element.Entity;\n+import uk.gov.gchq.gaffer.exception.SerialisationException;\n+import uk.gov.gchq.gaffer.jsonserialisation.JSONSerialiser;\n+import uk.gov.gchq.koryphe.binaryoperator.KorypheBinaryOperator;\n+import uk.gov.gchq.koryphe.function.FunctionTest;\n+import uk.gov.gchq.koryphe.impl.binaryoperator.CollectionConcat;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import static uk.gov.gchq.gaffer.data.util.ElementUtil.assertElementEquals;\n+\n+public class ReduceRelatedElementsTest extends FunctionTest<ReduceRelatedElements> {\n+    public static final String RELATES_TO = \"relatesTo\";\n+    public static final String VISIBILITY = \"visibility\";\n+\n+    @Test\n+    public void shouldReturnNullForNullValue() {\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+\n+        // When\n+        final Object result = function.apply(null);\n+\n+        // Then\n+        assertNull(result);\n+    }\n+\n+    @Test\n+    public void shouldReduceRelatedElements() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build()\n+        );\n+\n+        // When\n+        final Iterable<Element> result = function.apply(elements);\n+\n+        // Then\n+        final List<Element> expectedElements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\", \"private\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex3a))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2b)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"relatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build()\n+        );\n+        assertElementEquals(expectedElements, result);\n+    }\n+\n+    @Test\n+    public void shouldReduceRelatedElementsWithManyRelationships() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+        Object vertex4a = \"vertex4a\";\n+        Object vertex4b = \"vertex4b longest\";\n+        Object vertex5a = \"vertex5a\";\n+        Object vertex5b = \"vertex5b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex4b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex5b)\n+                        .dest(vertex4a)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build()\n+        );\n+\n+        // When\n+        final Iterable<Element> result = function.apply(elements);\n+\n+        // Then\n+        final List<Element> expectedElements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\", \"private\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex3a))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2b)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"relatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build()\n+        );\n+//        assertElementEquals(expectedElements, result);\n+    }\n+\n+    @Test\n+    public void shouldReturnInputIfNoRelatedVertexGroups() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = new ReduceRelatedElements();\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build()\n+        );\n+\n+        // When\n+        final Iterable<Element> result = function.apply(elements);\n+\n+        // Then\n+        assertElementEquals(elements, result);\n+    }\n+\n+    @Test\n+    public void shouldFailIfNoVisibilityAggregatorProvided() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = new ReduceRelatedElements();\n+        function.setVisibilityProperty(VISIBILITY);\n+        function.setVisibilityAggregator(null);\n+        function.setVertexAggregator(new Longest());\n+        function.setRelatedVertexGroups(Collections.singleton(RELATES_TO));\n+\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build()\n+        );\n+\n+        // When\n+        try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa1ad553d5762291517f26cf0aaa1e2c5888f9bb"}, "originalPosition": 385}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ4OTgzMjU4OnYy", "diffSide": "RIGHT", "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElementsTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wOFQxNToxNjoyNlrOKf4mTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wOFQxNToxNjoyNlrOKf4mTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNDUyMTgwNA==", "bodyText": "Might be worth making these constants at the class level if they're reused in multiple tests", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r704521804", "createdAt": "2021-09-08T15:16:26Z", "author": {"login": "t11947"}, "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElementsTest.java", "diffHunk": "@@ -0,0 +1,453 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import com.google.common.collect.Sets;\n+import org.junit.jupiter.api.Test;\n+\n+import uk.gov.gchq.gaffer.commonutil.JsonAssert;\n+import uk.gov.gchq.gaffer.commonutil.TestGroups;\n+import uk.gov.gchq.gaffer.data.element.Edge;\n+import uk.gov.gchq.gaffer.data.element.Element;\n+import uk.gov.gchq.gaffer.data.element.Entity;\n+import uk.gov.gchq.gaffer.exception.SerialisationException;\n+import uk.gov.gchq.gaffer.jsonserialisation.JSONSerialiser;\n+import uk.gov.gchq.koryphe.binaryoperator.KorypheBinaryOperator;\n+import uk.gov.gchq.koryphe.function.FunctionTest;\n+import uk.gov.gchq.koryphe.impl.binaryoperator.CollectionConcat;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import static uk.gov.gchq.gaffer.data.util.ElementUtil.assertElementEquals;\n+\n+public class ReduceRelatedElementsTest extends FunctionTest<ReduceRelatedElements> {\n+    public static final String RELATES_TO = \"relatesTo\";\n+    public static final String VISIBILITY = \"visibility\";\n+\n+    @Test\n+    public void shouldReturnNullForNullValue() {\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+\n+        // When\n+        final Object result = function.apply(null);\n+\n+        // Then\n+        assertNull(result);\n+    }\n+\n+    @Test\n+    public void shouldReduceRelatedElements() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build()\n+        );\n+\n+        // When\n+        final Iterable<Element> result = function.apply(elements);\n+\n+        // Then\n+        final List<Element> expectedElements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\", \"private\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex3a))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2b)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"relatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build()\n+        );\n+        assertElementEquals(expectedElements, result);\n+    }\n+\n+    @Test\n+    public void shouldReduceRelatedElementsWithManyRelationships() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+        Object vertex4a = \"vertex4a\";\n+        Object vertex4b = \"vertex4b longest\";\n+        Object vertex5a = \"vertex5a\";\n+        Object vertex5b = \"vertex5b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex4b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex5b)\n+                        .dest(vertex4a)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build()\n+        );\n+\n+        // When\n+        final Iterable<Element> result = function.apply(elements);\n+\n+        // Then\n+        final List<Element> expectedElements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\", \"private\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex3a))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2b)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"relatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build()\n+        );\n+//        assertElementEquals(expectedElements, result);\n+    }\n+\n+    @Test\n+    public void shouldReturnInputIfNoRelatedVertexGroups() {\n+        Object vertex1a = \"vertex1a longest\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa1ad553d5762291517f26cf0aaa1e2c5888f9bb"}, "originalPosition": 266}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ4OTg4MDgxOnYy", "diffSide": "RIGHT", "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElementsTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wOFQxNToyNDoxOFrOKf5Djg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wOFQyMDozNjoxNFrOKgGyQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNDUyOTI5NA==", "bodyText": "It might be worth including some more granular testing of the (currently private) logic found in some of the helper methods.", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r704529294", "createdAt": "2021-09-08T15:24:18Z", "author": {"login": "t11947"}, "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElementsTest.java", "diffHunk": "@@ -0,0 +1,453 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import com.google.common.collect.Sets;\n+import org.junit.jupiter.api.Test;\n+\n+import uk.gov.gchq.gaffer.commonutil.JsonAssert;\n+import uk.gov.gchq.gaffer.commonutil.TestGroups;\n+import uk.gov.gchq.gaffer.data.element.Edge;\n+import uk.gov.gchq.gaffer.data.element.Element;\n+import uk.gov.gchq.gaffer.data.element.Entity;\n+import uk.gov.gchq.gaffer.exception.SerialisationException;\n+import uk.gov.gchq.gaffer.jsonserialisation.JSONSerialiser;\n+import uk.gov.gchq.koryphe.binaryoperator.KorypheBinaryOperator;\n+import uk.gov.gchq.koryphe.function.FunctionTest;\n+import uk.gov.gchq.koryphe.impl.binaryoperator.CollectionConcat;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import static uk.gov.gchq.gaffer.data.util.ElementUtil.assertElementEquals;\n+\n+public class ReduceRelatedElementsTest extends FunctionTest<ReduceRelatedElements> {\n+    public static final String RELATES_TO = \"relatesTo\";\n+    public static final String VISIBILITY = \"visibility\";\n+\n+    @Test\n+    public void shouldReturnNullForNullValue() {\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+\n+        // When\n+        final Object result = function.apply(null);\n+\n+        // Then\n+        assertNull(result);\n+    }\n+\n+    @Test\n+    public void shouldReduceRelatedElements() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build()\n+        );\n+\n+        // When\n+        final Iterable<Element> result = function.apply(elements);\n+\n+        // Then\n+        final List<Element> expectedElements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\", \"private\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex3a))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2b)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"relatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build()\n+        );\n+        assertElementEquals(expectedElements, result);\n+    }\n+\n+    @Test\n+    public void shouldReduceRelatedElementsWithManyRelationships() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+        Object vertex4a = \"vertex4a\";\n+        Object vertex4b = \"vertex4b longest\";\n+        Object vertex5a = \"vertex5a\";\n+        Object vertex5b = \"vertex5b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex4b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex5b)\n+                        .dest(vertex4a)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build()\n+        );\n+\n+        // When\n+        final Iterable<Element> result = function.apply(elements);\n+\n+        // Then\n+        final List<Element> expectedElements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\", \"private\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex3a))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2b)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"relatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build()\n+        );\n+//        assertElementEquals(expectedElements, result);\n+    }\n+\n+    @Test\n+    public void shouldReturnInputIfNoRelatedVertexGroups() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = new ReduceRelatedElements();\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build()\n+        );\n+\n+        // When\n+        final Iterable<Element> result = function.apply(elements);\n+\n+        // Then\n+        assertElementEquals(elements, result);\n+    }\n+\n+    @Test\n+    public void shouldFailIfNoVisibilityAggregatorProvided() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = new ReduceRelatedElements();\n+        function.setVisibilityProperty(VISIBILITY);\n+        function.setVisibilityAggregator(null);\n+        function.setVertexAggregator(new Longest());\n+        function.setRelatedVertexGroups(Collections.singleton(RELATES_TO));\n+\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build()\n+        );\n+\n+        // When\n+        try {\n+            function.apply(elements);\n+\n+            fail();\n+        } catch (final IllegalArgumentException e) {\n+            // Then\n+            assertTrue(e.getMessage().contains(\"No visibility aggregator provided, so visibilities cannot be combined.\"));\n+        }\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa1ad553d5762291517f26cf0aaa1e2c5888f9bb"}, "originalPosition": 394}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNDc1NDI0Mw==", "bodyText": "Might be worth extracting the updater method to its own class/set of helper methods to keep encapsulation.", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r704754243", "createdAt": "2021-09-08T20:36:14Z", "author": {"login": "t11947"}, "path": "core/data/src/test/java/uk/gov/gchq/gaffer/data/element/function/ReduceRelatedElementsTest.java", "diffHunk": "@@ -0,0 +1,453 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.data.element.function;\n+\n+import com.google.common.collect.Sets;\n+import org.junit.jupiter.api.Test;\n+\n+import uk.gov.gchq.gaffer.commonutil.JsonAssert;\n+import uk.gov.gchq.gaffer.commonutil.TestGroups;\n+import uk.gov.gchq.gaffer.data.element.Edge;\n+import uk.gov.gchq.gaffer.data.element.Element;\n+import uk.gov.gchq.gaffer.data.element.Entity;\n+import uk.gov.gchq.gaffer.exception.SerialisationException;\n+import uk.gov.gchq.gaffer.jsonserialisation.JSONSerialiser;\n+import uk.gov.gchq.koryphe.binaryoperator.KorypheBinaryOperator;\n+import uk.gov.gchq.koryphe.function.FunctionTest;\n+import uk.gov.gchq.koryphe.impl.binaryoperator.CollectionConcat;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import static uk.gov.gchq.gaffer.data.util.ElementUtil.assertElementEquals;\n+\n+public class ReduceRelatedElementsTest extends FunctionTest<ReduceRelatedElements> {\n+    public static final String RELATES_TO = \"relatesTo\";\n+    public static final String VISIBILITY = \"visibility\";\n+\n+    @Test\n+    public void shouldReturnNullForNullValue() {\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+\n+        // When\n+        final Object result = function.apply(null);\n+\n+        // Then\n+        assertNull(result);\n+    }\n+\n+    @Test\n+    public void shouldReduceRelatedElements() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build()\n+        );\n+\n+        // When\n+        final Iterable<Element> result = function.apply(elements);\n+\n+        // Then\n+        final List<Element> expectedElements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\", \"private\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex3a))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2b)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"relatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build()\n+        );\n+        assertElementEquals(expectedElements, result);\n+    }\n+\n+    @Test\n+    public void shouldReduceRelatedElementsWithManyRelationships() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+        Object vertex4a = \"vertex4a\";\n+        Object vertex4b = \"vertex4b longest\";\n+        Object vertex5a = \"vertex5a\";\n+        Object vertex5b = \"vertex5b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = getInstance();\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex4b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex5b)\n+                        .dest(vertex4a)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build()\n+        );\n+\n+        // When\n+        final Iterable<Element> result = function.apply(elements);\n+\n+        // Then\n+        final List<Element> expectedElements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\", \"private\"))\n+                        .property(\"sourceRelatedVertices\", Sets.newHashSet(vertex1b))\n+                        .property(\"destinationRelatedVertices\", Sets.newHashSet(vertex3a))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2b)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .property(\"relatedVertices\", Sets.newHashSet(vertex2a))\n+                        .build()\n+        );\n+//        assertElementEquals(expectedElements, result);\n+    }\n+\n+    @Test\n+    public void shouldReturnInputIfNoRelatedVertexGroups() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = new ReduceRelatedElements();\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build()\n+        );\n+\n+        // When\n+        final Iterable<Element> result = function.apply(elements);\n+\n+        // Then\n+        assertElementEquals(elements, result);\n+    }\n+\n+    @Test\n+    public void shouldFailIfNoVisibilityAggregatorProvided() {\n+        Object vertex1a = \"vertex1a longest\";\n+        Object vertex1b = \"vertex1b\";\n+        Object vertex2a = \"vertex2a\";\n+        Object vertex2b = \"vertex2b longest\";\n+        Object vertex3a = \"vertex3a\";\n+        Object vertex3b = \"vertex3b longest\";\n+\n+        // Given\n+        final ReduceRelatedElements function = new ReduceRelatedElements();\n+        function.setVisibilityProperty(VISIBILITY);\n+        function.setVisibilityAggregator(null);\n+        function.setVertexAggregator(new Longest());\n+        function.setRelatedVertexGroups(Collections.singleton(RELATES_TO));\n+\n+        final List<Element> elements = Arrays.asList(\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex2a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1b)\n+                        .dest(vertex3a)\n+                        .directed(true)\n+                        .group(TestGroups.EDGE)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Entity.Builder()\n+                        .vertex(vertex2a)\n+                        .group(TestGroups.ENTITY)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex1a)\n+                        .dest(vertex1b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex2a)\n+                        .dest(vertex2b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"public\"))\n+                        .build(),\n+                new Edge.Builder()\n+                        .source(vertex3a)\n+                        .dest(vertex3b)\n+                        .directed(true)\n+                        .group(RELATES_TO)\n+                        .property(VISIBILITY, Sets.newHashSet(\"private\"))\n+                        .build()\n+        );\n+\n+        // When\n+        try {\n+            function.apply(elements);\n+\n+            fail();\n+        } catch (final IllegalArgumentException e) {\n+            // Then\n+            assertTrue(e.getMessage().contains(\"No visibility aggregator provided, so visibilities cannot be combined.\"));\n+        }\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNDUyOTI5NA=="}, "originalCommit": {"oid": "fa1ad553d5762291517f26cf0aaa1e2c5888f9bb"}, "originalPosition": 394}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDQ5MDAyNjk5OnYy", "diffSide": "RIGHT", "path": "core/operation/src/main/java/uk/gov/gchq/gaffer/operation/function/ToTrailingWildcardPair.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wOFQxNTo1MDoxNlrOKf6d8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wOS0wOFQxNTo1MDoxNlrOKf6d8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwNDU1MjQzNA==", "bodyText": "Is it worth adding null checking/defaulting for if endOfRange is null?", "url": "https://github.com/gchq/Gaffer/pull/2239#discussion_r704552434", "createdAt": "2021-09-08T15:50:16Z", "author": {"login": "t11947"}, "path": "core/operation/src/main/java/uk/gov/gchq/gaffer/operation/function/ToTrailingWildcardPair.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright 2021 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package uk.gov.gchq.gaffer.operation.function;\n+\n+import uk.gov.gchq.gaffer.commonutil.pair.Pair;\n+import uk.gov.gchq.gaffer.data.element.id.EntityId;\n+import uk.gov.gchq.gaffer.operation.data.EntitySeed;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+import uk.gov.gchq.koryphe.function.KorypheFunction;\n+\n+/**\n+ * A {@code ToTrailingWildcardPair} is a {@link KorypheFunction} that takes an input value to use as the starting value\n+ * for a range and creates a value to use as the end point. Note that the both of the vertex values must first be converted\n+ * to {@link String}s. These values are then wrapped up as {@link EntitySeed}s.\n+ */\n+@Since(\"1.19.0\")\n+@Summary(\"Converts an input value into a pair of EntityIds representing a range.\")\n+public class ToTrailingWildcardPair extends KorypheFunction<String, Pair<EntityId, EntityId>> {\n+\n+    private String endOfRange = \"~\";\n+\n+    @Override\n+    public Pair<EntityId, EntityId> apply(final String input) {\n+        if (null == input) {\n+            return null;\n+        }\n+\n+        return createPair(input);\n+    }\n+\n+    public String getEndOfRange() {\n+        return endOfRange;\n+    }\n+\n+    public void setEndOfRange(final String endOfRange) {\n+        this.endOfRange = endOfRange;\n+    }\n+\n+    private Pair<EntityId, EntityId> createPair(final String vertex) {\n+        return new Pair<>(new EntitySeed(vertex), new EntitySeed(vertex + getEndOfRange()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fa1ad553d5762291517f26cf0aaa1e2c5888f9bb"}, "originalPosition": 54}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4340, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}