{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczODY2MTQw", "number": 2241, "title": "Gh 2240 federated view validator bug", "bodyText": "", "createdAt": "2020-02-11T20:31:20Z", "url": "https://github.com/gchq/Gaffer/pull/2241", "merged": true, "mergeCommit": {"oid": "5d1a43336b6756a6981c1bf9c38266c97af4c357"}, "closed": true, "closedAt": "2020-02-14T12:29:48Z", "author": {"login": "GCHQDev404"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcC_xtpgH2gAyMzczODY2MTQwOjg2NTVhMWQ4MzExYTE1OTEzMzNjMjliM2NlNDVlNjEyNTg2YzI1MzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEOtA2gFqTM1ODkwODQyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8655a1d8311a1591333c29b3ce45e612586c2530", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/8655a1d8311a1591333c29b3ce45e612586c2530", "committedDate": "2020-02-10T16:32:15Z", "message": "gh-2240 FederatedViewValidator bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9cad6da21d952dd947c3bfbf3a028d6fd37eb90", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/e9cad6da21d952dd947c3bfbf3a028d6fd37eb90", "committedDate": "2020-02-11T18:15:36Z", "message": "gh-2240 FederatedViewValidator bug."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77e7d114bbc36108d2c0baa4721d320afdc18dcb", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/77e7d114bbc36108d2c0baa4721d320afdc18dcb", "committedDate": "2020-02-12T16:07:40Z", "message": "gh-2240 FederatedViewValidator removing dead code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ccf984f879205d66a1235ef896efbd48e985dc14", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/ccf984f879205d66a1235ef896efbd48e985dc14", "committedDate": "2020-02-12T16:06:36Z", "message": "Merge branch 'gh-2240-FederatedViewValidator-bug' of github.com:gchq/Gaffer into gh-2240-FederatedViewValidator-bug"}, "afterCommit": {"oid": "77e7d114bbc36108d2c0baa4721d320afdc18dcb", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/77e7d114bbc36108d2c0baa4721d320afdc18dcb", "committedDate": "2020-02-12T16:07:40Z", "message": "gh-2240 FederatedViewValidator removing dead code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NTkzNDU3", "url": "https://github.com/gchq/Gaffer/pull/2241#pullrequestreview-357593457", "createdAt": "2020-02-12T16:21:49Z", "commit": {"oid": "77e7d114bbc36108d2c0baa4721d320afdc18dcb"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNjoyMTo0OVrOFo1S0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxNjoyMjoxNFrOFo1T2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM2MDUzMA==", "bodyText": "Couldn't you just add it to the validation result here?", "url": "https://github.com/gchq/Gaffer/pull/2241#discussion_r378360530", "createdAt": "2020-02-12T16:21:49Z", "author": {"login": "d47853"}, "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/schema/FederatedViewValidator.java", "diffHunk": "@@ -56,14 +61,38 @@ public ValidationResult validate(final View view, final Schema schema, final Set\n     }\n \n     protected ValidationResult getEdgeResult(final View view, final Schema schema, final Set<StoreTrait> storeTraits, final boolean isStoreOrdered) {\n-        final ValidationResult edgeResult = new ValidationResult();\n-        validateEdge(view, schema, storeTraits, isStoreOrdered, edgeResult);\n-        return edgeResult;\n+        final Function<Map.Entry<String, ViewElementDefinition>, ValidationResult> validationResultFunction = e -> {\n+            final ValidationResult singleResult = new ValidationResult();\n+            validateEdge(new View.Builder().edge(e.getKey(), e.getValue()).build(), schema, storeTraits, isStoreOrdered, singleResult);\n+            return singleResult;\n+        };\n+\n+        return getElementResult(validationResultFunction, view.getEdges());\n     }\n \n     protected ValidationResult getEntityResult(final View view, final Schema schema, final Set<StoreTrait> storeTraits, final boolean isStoreOrdered) {\n-        final ValidationResult entitiesResult = new ValidationResult();\n-        validateEntities(view, schema, storeTraits, isStoreOrdered, entitiesResult);\n-        return entitiesResult;\n+\n+        final Function<Map.Entry<String, ViewElementDefinition>, ValidationResult> validationResultFunction = e -> {\n+            final ValidationResult singleResult = new ValidationResult();\n+            validateEntities(new View.Builder().entity(e.getKey(), e.getValue()).build(), schema, storeTraits, isStoreOrdered, singleResult);\n+            return singleResult;\n+        };\n+        return getElementResult(validationResultFunction, view.getEntities());\n+    }\n+\n+    private ValidationResult getElementResult(final Function<Map.Entry<String, ViewElementDefinition>, ValidationResult> validationResultFunction, final Map<String, ViewElementDefinition> elements) {\n+        final ValidationResult rtn = new ValidationResult();\n+\n+        final List<ValidationResult> viewResults = elements.entrySet().stream()\n+                .map(validationResultFunction)\n+                .collect(Collectors.toList());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77e7d114bbc36108d2c0baa4721d320afdc18dcb"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM2MDc5NA==", "bodyText": "elements is a little misleading - elementDefinitions may be more appropriate", "url": "https://github.com/gchq/Gaffer/pull/2241#discussion_r378360794", "createdAt": "2020-02-12T16:22:14Z", "author": {"login": "d47853"}, "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/schema/FederatedViewValidator.java", "diffHunk": "@@ -56,14 +61,38 @@ public ValidationResult validate(final View view, final Schema schema, final Set\n     }\n \n     protected ValidationResult getEdgeResult(final View view, final Schema schema, final Set<StoreTrait> storeTraits, final boolean isStoreOrdered) {\n-        final ValidationResult edgeResult = new ValidationResult();\n-        validateEdge(view, schema, storeTraits, isStoreOrdered, edgeResult);\n-        return edgeResult;\n+        final Function<Map.Entry<String, ViewElementDefinition>, ValidationResult> validationResultFunction = e -> {\n+            final ValidationResult singleResult = new ValidationResult();\n+            validateEdge(new View.Builder().edge(e.getKey(), e.getValue()).build(), schema, storeTraits, isStoreOrdered, singleResult);\n+            return singleResult;\n+        };\n+\n+        return getElementResult(validationResultFunction, view.getEdges());\n     }\n \n     protected ValidationResult getEntityResult(final View view, final Schema schema, final Set<StoreTrait> storeTraits, final boolean isStoreOrdered) {\n-        final ValidationResult entitiesResult = new ValidationResult();\n-        validateEntities(view, schema, storeTraits, isStoreOrdered, entitiesResult);\n-        return entitiesResult;\n+\n+        final Function<Map.Entry<String, ViewElementDefinition>, ValidationResult> validationResultFunction = e -> {\n+            final ValidationResult singleResult = new ValidationResult();\n+            validateEntities(new View.Builder().entity(e.getKey(), e.getValue()).build(), schema, storeTraits, isStoreOrdered, singleResult);\n+            return singleResult;\n+        };\n+        return getElementResult(validationResultFunction, view.getEntities());\n+    }\n+\n+    private ValidationResult getElementResult(final Function<Map.Entry<String, ViewElementDefinition>, ValidationResult> validationResultFunction, final Map<String, ViewElementDefinition> elements) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77e7d114bbc36108d2c0baa4721d320afdc18dcb"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12532ab332d4f3c5390c2a8747226b936cdb737e", "author": {"user": {"login": "GCHQDev404", "name": null}}, "url": "https://github.com/gchq/Gaffer/commit/12532ab332d4f3c5390c2a8747226b936cdb737e", "committedDate": "2020-02-13T15:47:51Z", "message": "gh-2240 pr change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4OTA4NDIw", "url": "https://github.com/gchq/Gaffer/pull/2241#pullrequestreview-358908420", "createdAt": "2020-02-14T12:29:37Z", "commit": {"oid": "12532ab332d4f3c5390c2a8747226b936cdb737e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1845, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}