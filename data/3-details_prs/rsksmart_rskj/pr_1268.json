{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ1NDg5MTgz", "number": 1268, "title": "Start Round Sync State", "bodyText": "On the following pr. the next feature were added:\n\n\nIn GetBlockHeader message were renamed variables. This message is going to ask for a number of headers from a starting number instead of from a best block. Because this, the variable bestBlockHeader where renamed as startBlockHeader\n\n\nBecause the light client works with headers, syncprocessor doesn't receive blocks.\n\n\nTwo peers (light and full) are being sync. The full peer starts sending to the light peer blocks until the latter receives a known block. The known block is the common ancestor between peers. Then, the light peer transits to StartRoundSync state where starts downloading block headers, not all blockheaders from the common ancestor to the best block known by the light peer, but some of them which are called pivots.\n\n\nAlso in testing, two mains things were made. The first one, change all testing where the state's transition ends in SearchCommonAncestor to ends in StartSyncRound or, to an error state MoreBlocksThanAllowed or MessageNotRequested and also add tests for the StartRoundSync state. The second one, extracted methods in tests to made these more readable. This is a step to move all auxiliar methods to TestUtils.\n\n\nIt's important to know that the error states will disappear and will be replaced for a error handler.", "createdAt": "2020-07-07T15:29:21Z", "url": "https://github.com/rsksmart/rskj/pull/1268", "merged": true, "mergeCommit": {"oid": "1b01be0b43a0d534248f7432e814b56e70ab691e"}, "closed": true, "closedAt": "2020-07-07T19:08:33Z", "author": {"login": "julianlen"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuvEbBAH2gAyNDQ1NDg5MTgzOjU5NmFmZGQzMTBkNDVmZTljNjg4YjIxNWFmNDBiMjY5MTlhYWU0YmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcyqn8KAFqTQ0NDE2OTI1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "596afdd310d45fe9c688b215af40b26919aae4bc", "author": {"user": {"login": "julianlen", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/596afdd310d45fe9c688b215af40b26919aae4bc", "committedDate": "2020-06-25T13:56:58Z", "message": "change variable of blockHeader message bestblock to startBlockHash"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95fe5bfb55efd68a66ea1c6ad3537d027f6a7d9d", "author": {"user": {"login": "julianlen", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/95fe5bfb55efd68a66ea1c6ad3537d027f6a7d9d", "committedDate": "2020-06-25T13:58:52Z", "message": "syncProcessor works only with headers"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7b520ff18d7d5177a34062123b4e0e3361e3a5e", "author": {"user": {"login": "julianlen", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/c7b520ff18d7d5177a34062123b4e0e3361e3a5e", "committedDate": "2020-07-07T14:23:39Z", "message": "Enhance testing and add tests for StartRoundSyncState"}, "afterCommit": {"oid": "a261e71067649b005d40742056f4243bd5a180a1", "author": {"user": {"login": "julianlen", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/a261e71067649b005d40742056f4243bd5a180a1", "committedDate": "2020-07-07T17:02:47Z", "message": "Enhance testing and add tests for StartRoundSyncState"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MTUxMjA5", "url": "https://github.com/rsksmart/rskj/pull/1268#pullrequestreview-444151209", "createdAt": "2020-07-07T18:35:14Z", "commit": {"oid": "b13980cb644da21638c9b90e11aec5d3dd796b9c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxODozNToxNFrOGuK2wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxODozNToxNFrOGuK2wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA2NTUzNg==", "bodyText": "the method naming is a little confusing, I know they do the same thing, but with different messages, you should rename it reflecting that", "url": "https://github.com/rsksmart/rskj/pull/1268#discussion_r451065536", "createdAt": "2020-07-07T18:35:14Z", "author": {"login": "smcsicardi"}, "path": "rskj-core/src/main/java/co/rsk/net/light/LightSyncProcessor.java", "diffHunk": "@@ -120,44 +123,77 @@ public void sendStatusMessage(LightPeer lightPeer) {\n                 block.getNumber(), lightPeer.getPeerIdShort());\n     }\n \n-    public void sendBlockHeadersMessage(LightPeer lightPeer, byte[] bestBlock, int max, int skip, boolean reverse) {\n-        GetBlockHeadersByHashMessage blockHeaderMessage = new GetBlockHeadersByHashMessage(++lastRequestedId, bestBlock, max, skip, reverse);\n+    public void sendBlockHeadersMessage(LightPeer lightPeer, byte[] startBlockHash, int maxAmountOfHeaders, int skip, boolean reverse) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b13980cb644da21638c9b90e11aec5d3dd796b9c"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9419dc06861784092542e723d4b5dcb2f2f00fdf", "author": {"user": {"login": "julianlen", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/9419dc06861784092542e723d4b5dcb2f2f00fdf", "committedDate": "2020-07-07T18:50:05Z", "message": "StartRoundSync state added as the transition from FindCommonAncestor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cb40e45681dce4e699a8bd64de030b4565c7202", "author": {"user": {"login": "julianlen", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/9cb40e45681dce4e699a8bd64de030b4565c7202", "committedDate": "2020-07-07T18:50:06Z", "message": "Enhance testing and add tests for StartRoundSyncState"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "924332904345c30028607bddcb83a3d28d446f49", "author": {"user": {"login": "julianlen", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/924332904345c30028607bddcb83a3d28d446f49", "committedDate": "2020-07-07T18:53:25Z", "message": "MAX_REQUESTED_HEADERS used as max amount of headers and modified tests of LightSyncProcessor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9669b25dfcbf5634cfa616ccd267f9cf83cf4324", "author": {"user": {"login": "julianlen", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/9669b25dfcbf5634cfa616ccd267f9cf83cf4324", "committedDate": "2020-07-07T18:53:32Z", "message": "max variable in GetBlockHeaderMessage replaced by maxAmountOfHeaders"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b13980cb644da21638c9b90e11aec5d3dd796b9c", "author": {"user": {"login": "julianlen", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/b13980cb644da21638c9b90e11aec5d3dd796b9c", "committedDate": "2020-07-07T18:24:05Z", "message": "max variable in GetBlockHeaderMessage replaced by maxAmountOfHeaders"}, "afterCommit": {"oid": "9669b25dfcbf5634cfa616ccd267f9cf83cf4324", "author": {"user": {"login": "julianlen", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/9669b25dfcbf5634cfa616ccd267f9cf83cf4324", "committedDate": "2020-07-07T18:53:32Z", "message": "max variable in GetBlockHeaderMessage replaced by maxAmountOfHeaders"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MTY5MjU4", "url": "https://github.com/rsksmart/rskj/pull/1268#pullrequestreview-444169258", "createdAt": "2020-07-07T19:01:56Z", "commit": {"oid": "9669b25dfcbf5634cfa616ccd267f9cf83cf4324"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 480, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}