{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNjY2MDQy", "number": 1296, "title": "Clean returnDataBuffer for call-like opcodes", "bodyText": "This PR aims\n\nto move this other PR into \"hardfork mode\"\nFix this issue\n\nAccording to the EIP-211\nIf the call-like opcode is executed but does not really instantiate a call frame (for example \ndue to insufficient funds for a value transfer or if the called contract does not exist), \nthe return data buffer is empty.\n\nSince VM code it's critical, we've decided to implement it as part of hardfork.\nI've also added elements to ConsensusRule & NetworkUpgrade enums to be used in the future network upgrade\nNOTE: ConsensusRule name (eip211Compatibility) will be changed", "createdAt": "2020-08-24T17:35:36Z", "url": "https://github.com/rsksmart/rskj/pull/1296", "merged": true, "mergeCommit": {"oid": "a67d17630760d0e8cb81836be59679e53224dae8"}, "closed": true, "closedAt": "2020-09-16T16:55:41Z", "author": {"login": "fedejinich"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCGbPUAFqTQ3MzcyODkxOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJe1BOgFqTQ4OTc5MDQyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNzI4OTE4", "url": "https://github.com/rsksmart/rskj/pull/1296#pullrequestreview-473728918", "createdAt": "2020-08-24T17:54:09Z", "commit": {"oid": "b6de7ac557863e33b481d930244ba7e33d27cccc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNzo1NDowOVrOHFwG8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQxNzo1NDowOVrOHFwG8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc5MzEzNg==", "bodyText": "Any test to exercise the behavior BEFORE this activation?", "url": "https://github.com/rsksmart/rskj/pull/1296#discussion_r475793136", "createdAt": "2020-08-24T17:54:09Z", "author": {"login": "ajlopezrsk"}, "path": "rskj-core/src/test/java/org/ethereum/vm/VMTest.java", "diffHunk": "@@ -222,6 +223,119 @@ public void testSTATICCALLWithStatusOne() {\n         assertTrue(program.getStack().isEmpty());\n     }\n \n+    // This test should throw an exception because we are reading from the RETURNDATABUFFER\n+    // in a non-existent position. This results in an error according to EIP 211\n+    @Test(expected = RuntimeException.class)\n+    public void doCall_returnDataBuffer_DataIsZeroAfterCallToNonExistentContract() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6de7ac557863e33b481d930244ba7e33d27cccc"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0ODI5MDkz", "url": "https://github.com/rsksmart/rskj/pull/1296#pullrequestreview-474829093", "createdAt": "2020-08-25T20:29:52Z", "commit": {"oid": "b6de7ac557863e33b481d930244ba7e33d27cccc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMDoyOTo1MlrOHGolCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQyMDozNTo0NlrOHGoxJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcxODM0NA==", "bodyText": "shouldnt exist en rskip from our side anyway?", "url": "https://github.com/rsksmart/rskj/pull/1296#discussion_r476718344", "createdAt": "2020-08-25T20:29:52Z", "author": {"login": "patogallaiovlabs"}, "path": "rskj-core/src/main/java/org/ethereum/config/blockchain/upgrades/ConsensusRule.java", "diffHunk": "@@ -50,7 +50,8 @@\n     RSKIP151(\"rskip151\"),\n     RSKIP152(\"rskip152\"),\n     RSKIP156(\"rskip156\"),\n-    RSKIPUMM(\"rskipUMM\");\n+    RSKIPUMM(\"rskipUMM\"),\n+    EIP_211_COMPATIBILITY(\"eip211Compatibility\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6de7ac557863e33b481d930244ba7e33d27cccc"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcyMDYwMg==", "bodyText": "iris300? :P", "url": "https://github.com/rsksmart/rskj/pull/1296#discussion_r476720602", "createdAt": "2020-08-25T20:34:11Z", "author": {"login": "patogallaiovlabs"}, "path": "rskj-core/src/main/resources/config/devnet.conf", "diffHunk": "@@ -7,7 +7,8 @@ blockchain.config {\n         orchid060 = 0,\n         wasabi100 = 0,\n         twoToThree = 0,\n-        papyrus200 = 0\n+        papyrus200 = 0,\n+        iris = 0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6de7ac557863e33b481d930244ba7e33d27cccc"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcyMTQ0Ng==", "bodyText": "this never worked? \ud83e\udd14", "url": "https://github.com/rsksmart/rskj/pull/1296#discussion_r476721446", "createdAt": "2020-08-25T20:35:46Z", "author": {"login": "patogallaiovlabs"}, "path": "rskj-core/src/test/java/org/ethereum/config/blockchain/upgrades/ActivationConfigTest.java", "diffHunk": "@@ -29,14 +29,15 @@\n public class ActivationConfigTest {\n     private static final Config BASE_CONFIG = ConfigFactory.parseString(String.join(\"\\n\",\n             \"hardforkActivationHeights: {\",\n-            \"    genesis: 0\",\n-            \"    bahamas: 0\",\n+            \"    genesis: 0,\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6de7ac557863e33b481d930244ba7e33d27cccc"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTYxMzcy", "url": "https://github.com/rsksmart/rskj/pull/1296#pullrequestreview-476961372", "createdAt": "2020-08-27T18:04:47Z", "commit": {"oid": "b6de7ac557863e33b481d930244ba7e33d27cccc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3OTk3MTY0", "url": "https://github.com/rsksmart/rskj/pull/1296#pullrequestreview-477997164", "createdAt": "2020-08-28T20:08:22Z", "commit": {"oid": "db6495bb733eb4b7422db28c7d7eec99aa73c949"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ca008a0eaead8c811c5e5756d3b8c0fd0d9c3e7", "author": {"user": {"login": "fedejinich", "name": "Fede Jinich"}}, "url": "https://github.com/rsksmart/rskj/commit/5ca008a0eaead8c811c5e5756d3b8c0fd0d9c3e7", "committedDate": "2020-09-04T13:32:12Z", "message": "renamed new consensus rule to match rskip171 & renamed network upgrade to match iris300"}, "afterCommit": {"oid": "f8d47b1f22c78ec8ecb298fbe8b4cc8ad77f35ff", "author": {"user": {"login": "fedejinich", "name": "Fede Jinich"}}, "url": "https://github.com/rsksmart/rskj/commit/f8d47b1f22c78ec8ecb298fbe8b4cc8ad77f35ff", "committedDate": "2020-09-09T19:37:59Z", "message": "renamed new consensus rule to match rskip171"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5e0c26bd3257b301df12bd236259b73a172b341", "author": {"user": {"login": "joaquinlpereyra", "name": "Joaqu\u00edn L. Pereyra"}}, "url": "https://github.com/rsksmart/rskj/commit/b5e0c26bd3257b301df12bd236259b73a172b341", "committedDate": "2020-09-16T15:21:43Z", "message": "add tests for eip 211"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8e3d9b70b3b288a41f6f972e578641fe07be6fb", "author": {"user": {"login": "joaquinlpereyra", "name": "Joaqu\u00edn L. Pereyra"}}, "url": "https://github.com/rsksmart/rskj/commit/b8e3d9b70b3b288a41f6f972e578641fe07be6fb", "committedDate": "2020-09-16T15:21:44Z", "message": "fixed comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26f7640bfc7f52511d181fc601ba3e5d8f4e191e", "author": {"user": {"login": "joaquinlpereyra", "name": "Joaqu\u00edn L. Pereyra"}}, "url": "https://github.com/rsksmart/rskj/commit/26f7640bfc7f52511d181fc601ba3e5d8f4e191e", "committedDate": "2020-09-16T15:21:45Z", "message": "fix array size"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "459849249bb0101d7d9cfd1396605cb4365d34f2", "author": {"user": {"login": "joaquinlpereyra", "name": "Joaqu\u00edn L. Pereyra"}}, "url": "https://github.com/rsksmart/rskj/commit/459849249bb0101d7d9cfd1396605cb4365d34f2", "committedDate": "2020-09-16T15:21:46Z", "message": "simplify and document tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72eeda39c27790c86d23246370920bf19db56925", "author": {"user": {"login": "joaquinlpereyra", "name": "Joaqu\u00edn L. Pereyra"}}, "url": "https://github.com/rsksmart/rskj/commit/72eeda39c27790c86d23246370920bf19db56925", "committedDate": "2020-09-16T15:21:47Z", "message": "reset return data buffer if call frame not created\n\nThis is to make us EIP-211 compatible.\nIssue is #921 on Github has a bit of discussion."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07564acd514af02a04499562327035507286fc36", "author": {"user": {"login": "fedejinich", "name": "Fede Jinich"}}, "url": "https://github.com/rsksmart/rskj/commit/07564acd514af02a04499562327035507286fc36", "committedDate": "2020-09-16T15:21:48Z", "message": "Program.callToAddress clean returnDataBuffer by consensus rule"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36d1d8b0bdd6718c54275bffe7e9f10669841163", "author": {"user": {"login": "fedejinich", "name": "Fede Jinich"}}, "url": "https://github.com/rsksmart/rskj/commit/36d1d8b0bdd6718c54275bffe7e9f10669841163", "committedDate": "2020-09-16T15:21:49Z", "message": "more test cases for returnDataBuffer state on callToAddres (and renamed previous tests)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b03ac47e5fc7fe86c003790c22e379bc44c99343", "author": {"user": {"login": "fedejinich", "name": "Fede Jinich"}}, "url": "https://github.com/rsksmart/rskj/commit/b03ac47e5fc7fe86c003790c22e379bc44c99343", "committedDate": "2020-09-16T15:21:50Z", "message": "clean returnDataBuffer for precompiled call-like opcodes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "032581fa79bb8b8b8242bc2cde29c1821ea2bd59", "author": {"user": {"login": "fedejinich", "name": "Fede Jinich"}}, "url": "https://github.com/rsksmart/rskj/commit/032581fa79bb8b8b8242bc2cde29c1821ea2bd59", "committedDate": "2020-09-16T15:21:51Z", "message": "renamed new consensus rule to match rskip171"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f8d47b1f22c78ec8ecb298fbe8b4cc8ad77f35ff", "author": {"user": {"login": "fedejinich", "name": "Fede Jinich"}}, "url": "https://github.com/rsksmart/rskj/commit/f8d47b1f22c78ec8ecb298fbe8b4cc8ad77f35ff", "committedDate": "2020-09-09T19:37:59Z", "message": "renamed new consensus rule to match rskip171"}, "afterCommit": {"oid": "032581fa79bb8b8b8242bc2cde29c1821ea2bd59", "author": {"user": {"login": "fedejinich", "name": "Fede Jinich"}}, "url": "https://github.com/rsksmart/rskj/commit/032581fa79bb8b8b8242bc2cde29c1821ea2bd59", "committedDate": "2020-09-16T15:21:51Z", "message": "renamed new consensus rule to match rskip171"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NzkwNDI0", "url": "https://github.com/rsksmart/rskj/pull/1296#pullrequestreview-489790424", "createdAt": "2020-09-16T16:17:37Z", "commit": {"oid": "032581fa79bb8b8b8242bc2cde29c1821ea2bd59"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 512, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}