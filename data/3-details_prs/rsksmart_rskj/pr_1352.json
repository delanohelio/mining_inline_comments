{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0MDIwMTY1", "number": 1352, "title": "Fixed issue with empty contract's return result", "bodyText": "This fixes compatibility issue for empty contracts return result.\nDescription\nEmpty contract return should be 0x, but it\u2019s 0x00 instead.\nMotivation and Context\nTo be compatible with Ethereum JSON-RPC clients 0x should be returned by eth_call for an empty contract instead of 0x00.\nHow Has This Been Tested?\n\n\n\nUsing unit tests\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Breaking change (fix or feature that would cause existing functionality to not work as expected)\n\nChecklist:\n\n\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n Tests for the changes have been added (for bug fixes / features)\n Requires Activation Code (Hard Fork)\n\nfit: node-call-changes", "createdAt": "2020-11-02T12:18:05Z", "url": "https://github.com/rsksmart/rskj/pull/1352", "merged": true, "mergeCommit": {"oid": "d9015dcadea578e02eb50eff8f120c644baf02aa"}, "closed": true, "closedAt": "2020-12-28T17:54:59Z", "author": {"login": "Vovchyk"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZ9Ww-gFqTUyNTQ4NjI1Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdqp8u_AFqTU1OTI0MjQyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1NDg2MjU3", "url": "https://github.com/rsksmart/rskj/pull/1352#pullrequestreview-525486257", "createdAt": "2020-11-06T20:52:55Z", "commit": {"oid": "402cd25ec532fd54ea226799196c970b55966f41"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMDo1Mjo1NVrOHu9Ncg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNlQyMDo1MzoyOVrOHu9OQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk5OTQxMA==", "bodyText": "I would not test agains the function, but for the explicit value", "url": "https://github.com/rsksmart/rskj/pull/1352#discussion_r518999410", "createdAt": "2020-11-06T20:52:55Z", "author": {"login": "patogallaiovlabs"}, "path": "rskj-core/src/test/java/co/rsk/rpc/modules/eth/EthModuleTest.java", "diffHunk": "@@ -75,7 +112,7 @@ public void callSmokeTest() {\n                         null, null, null));\n \n         String result = eth.call(args, \"latest\");\n-        assertThat(result, is(TypeConverter.toJsonHex(hreturn)));\n+        assertThat(result, is(TypeConverter.toUnformattedJsonHex(hReturn)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "402cd25ec532fd54ea226799196c970b55966f41"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODk5OTYxOA==", "bodyText": "Same here, to be clear whats the expected value.", "url": "https://github.com/rsksmart/rskj/pull/1352#discussion_r518999618", "createdAt": "2020-11-06T20:53:29Z", "author": {"login": "patogallaiovlabs"}, "path": "rskj-core/src/test/java/co/rsk/rpc/modules/eth/EthModuleTest.java", "diffHunk": "@@ -52,10 +53,46 @@ public void callSmokeTest() {\n                 .thenReturn(blockResult);\n         when(blockResult.getBlock()).thenReturn(block);\n \n-        byte[] hreturn = TypeConverter.stringToByteArray(\"hello\");\n+        byte[] hReturn = TypeConverter.stringToByteArray(\"hello\");\n+        ProgramResult executorResult = mock(ProgramResult.class);\n+        when(executorResult.getHReturn())\n+                .thenReturn(hReturn);\n+\n+        ReversibleTransactionExecutor executor = mock(ReversibleTransactionExecutor.class);\n+        when(executor.executeTransaction(eq(blockResult.getBlock()), any(), any(), any(), any(), any(), any(), any()))\n+                .thenReturn(executorResult);\n+\n+        EthModule eth = new EthModule(\n+                null,\n+                anyByte(),\n+                null,\n+                null,\n+                executor,\n+                retriever,\n+                null,\n+                null,\n+                null,\n+                new BridgeSupportFactory(\n+                        null, null, null));\n+\n+        String result = eth.call(args, \"latest\");\n+        assertThat(result, is(TypeConverter.toUnformattedJsonHex(hReturn)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "402cd25ec532fd54ea226799196c970b55966f41"}, "originalPosition": 36}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "402cd25ec532fd54ea226799196c970b55966f41", "author": {"user": {"login": "Vovchyk", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/402cd25ec532fd54ea226799196c970b55966f41", "committedDate": "2020-11-02T12:37:08Z", "message": "Small refactoring"}, "afterCommit": {"oid": "3d3d090440cab02744e52f0770f579fa5b5e230f", "author": {"user": {"login": "Vovchyk", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/3d3d090440cab02744e52f0770f579fa5b5e230f", "committedDate": "2020-11-10T13:29:16Z", "message": "Refactored unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNDIwNDEy", "url": "https://github.com/rsksmart/rskj/pull/1352#pullrequestreview-530420412", "createdAt": "2020-11-13T21:15:46Z", "commit": {"oid": "3d3d090440cab02744e52f0770f579fa5b5e230f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMToxNTo0NlrOHy_zgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QyMToxNTo0NlrOHy_zgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzNjIyNQ==", "bodyText": "Could we have a test using an address without code? To be sure EthModule reacts with the expected behavior, even if we change the internal code in the future. In this test, we are presuming the hReturn will be the empty byte array.", "url": "https://github.com/rsksmart/rskj/pull/1352#discussion_r523236225", "createdAt": "2020-11-13T21:15:46Z", "author": {"login": "ajlopezrsk"}, "path": "rskj-core/src/test/java/co/rsk/rpc/modules/eth/EthModuleTest.java", "diffHunk": "@@ -52,10 +54,48 @@ public void callSmokeTest() {\n                 .thenReturn(blockResult);\n         when(blockResult.getBlock()).thenReturn(block);\n \n-        byte[] hreturn = TypeConverter.stringToByteArray(\"hello\");\n+        byte[] hReturn = TypeConverter.stringToByteArray(\"hello\");\n+        ProgramResult executorResult = mock(ProgramResult.class);\n+        when(executorResult.getHReturn())\n+                .thenReturn(hReturn);\n+\n+        ReversibleTransactionExecutor executor = mock(ReversibleTransactionExecutor.class);\n+        when(executor.executeTransaction(eq(blockResult.getBlock()), any(), any(), any(), any(), any(), any(), any()))\n+                .thenReturn(executorResult);\n+\n+        EthModule eth = new EthModule(\n+                null,\n+                anyByte(),\n+                null,\n+                null,\n+                executor,\n+                retriever,\n+                null,\n+                null,\n+                null,\n+                new BridgeSupportFactory(\n+                        null, null, null));\n+\n+        String expectedResult = TypeConverter.toUnformattedJsonHex(hReturn);\n+        String actualResult = eth.call(args, \"latest\");\n+\n+        assertEquals(expectedResult, actualResult);\n+    }\n+\n+    @Test\n+    public void callWithoutReturn() {\n+        Web3.CallArguments args = new Web3.CallArguments();\n+        BlockResult blockResult = mock(BlockResult.class);\n+        Block block = mock(Block.class);\n+        ExecutionBlockRetriever retriever = mock(ExecutionBlockRetriever.class);\n+        when(retriever.getExecutionBlock_workaround(\"latest\"))\n+                .thenReturn(blockResult);\n+        when(blockResult.getBlock()).thenReturn(block);\n+\n+        byte[] hReturn = new byte[0];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d3d090440cab02744e52f0770f579fa5b5e230f"}, "originalPosition": 56}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3d3d090440cab02744e52f0770f579fa5b5e230f", "author": {"user": {"login": "Vovchyk", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/3d3d090440cab02744e52f0770f579fa5b5e230f", "committedDate": "2020-11-10T13:29:16Z", "message": "Refactored unit test"}, "afterCommit": {"oid": "06da8b0b9033c4a62bba4b48ba06685067a20d1a", "author": {"user": {"login": "Vovchyk", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/06da8b0b9033c4a62bba4b48ba06685067a20d1a", "committedDate": "2020-11-19T17:22:01Z", "message": "Fixed testCall_getRevertReason test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NzA3NTk0", "url": "https://github.com/rsksmart/rskj/pull/1352#pullrequestreview-534707594", "createdAt": "2020-11-19T17:56:34Z", "commit": {"oid": "06da8b0b9033c4a62bba4b48ba06685067a20d1a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NzA4NDc0", "url": "https://github.com/rsksmart/rskj/pull/1352#pullrequestreview-534708474", "createdAt": "2020-11-19T17:57:41Z", "commit": {"oid": "06da8b0b9033c4a62bba4b48ba06685067a20d1a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "06da8b0b9033c4a62bba4b48ba06685067a20d1a", "author": {"user": {"login": "Vovchyk", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/06da8b0b9033c4a62bba4b48ba06685067a20d1a", "committedDate": "2020-11-19T17:22:01Z", "message": "Fixed testCall_getRevertReason test"}, "afterCommit": {"oid": "5074d61a809238852556c26d9338ad21662dad45", "author": {"user": {"login": "Vovchyk", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/5074d61a809238852556c26d9338ad21662dad45", "committedDate": "2020-12-17T13:42:19Z", "message": "Fixed testCall_getRevertReason test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0Njc4Mzkx", "url": "https://github.com/rsksmart/rskj/pull/1352#pullrequestreview-554678391", "createdAt": "2020-12-17T14:52:53Z", "commit": {"oid": "5074d61a809238852556c26d9338ad21662dad45"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84bbc63a36b6b66a0af273183ddc1ace6de2d3a2", "author": {"user": {"login": "Vovchyk", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/84bbc63a36b6b66a0af273183ddc1ace6de2d3a2", "committedDate": "2020-12-28T17:07:16Z", "message": "Fixed issue with empty contract's return result"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bef10ab801f0086abec3d21c8c0b8d83a77f9ee5", "author": {"user": {"login": "Vovchyk", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/bef10ab801f0086abec3d21c8c0b8d83a77f9ee5", "committedDate": "2020-12-28T17:07:16Z", "message": "Small refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1c6af18ab40596f5d8b779bbf51a744518de3e5", "author": {"user": {"login": "Vovchyk", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/f1c6af18ab40596f5d8b779bbf51a744518de3e5", "committedDate": "2020-12-28T17:07:16Z", "message": "Refactored unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3715d8b1ca02aab0a5bd3ec38a571bf05becdfb6", "author": {"user": {"login": "Vovchyk", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/3715d8b1ca02aab0a5bd3ec38a571bf05becdfb6", "committedDate": "2020-12-28T17:18:42Z", "message": "Added test for no contract return case in Web3ImplTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8fec98e574af403d9a067557663a12e0872dea5", "author": {"user": {"login": "Vovchyk", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/a8fec98e574af403d9a067557663a12e0872dea5", "committedDate": "2020-12-28T17:18:44Z", "message": "Fixed testCall_getRevertReason test"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5074d61a809238852556c26d9338ad21662dad45", "author": {"user": {"login": "Vovchyk", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/5074d61a809238852556c26d9338ad21662dad45", "committedDate": "2020-12-17T13:42:19Z", "message": "Fixed testCall_getRevertReason test"}, "afterCommit": {"oid": "a8fec98e574af403d9a067557663a12e0872dea5", "author": {"user": {"login": "Vovchyk", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/a8fec98e574af403d9a067557663a12e0872dea5", "committedDate": "2020-12-28T17:18:44Z", "message": "Fixed testCall_getRevertReason test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5MjQyNDI0", "url": "https://github.com/rsksmart/rskj/pull/1352#pullrequestreview-559242424", "createdAt": "2020-12-28T17:54:30Z", "commit": {"oid": "a8fec98e574af403d9a067557663a12e0872dea5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 617, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}