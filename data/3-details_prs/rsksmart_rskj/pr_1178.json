{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwMjg2MDA3", "number": 1178, "title": "2wp improvements", "bodyText": "This PR implements improvements to the 2 way peg.\nAdds support to locking from p2sh-p2wpkh bitcoin addresses! (segwit compatible mode)\nAllows refunding to multisig bitcoin addresses, both legacy and segwit.\nAdds new methods to Bridge:\n\nregisterBtcCoinbaseTransaction: Registers crucial information for an already registered block's coinbase transaction. This information is then used when registering a segwit transaction.\nhasBtcBlockCoinbaseTransactionInformation: informs if the coinbase for a given block was informed or not.\nFixes problems with performance tests, and patches other problems.\n\nfed: 2wp-segwit\nfit: 2wp-segwit", "createdAt": "2020-02-26T14:02:07Z", "url": "https://github.com/rsksmart/rskj/pull/1178", "merged": true, "mergeCommit": {"oid": "bac014a02a94236cb5451f8dd507c19c4b589a63"}, "closed": true, "closedAt": "2020-03-09T17:15:40Z", "author": {"login": "josedahlquist"}, "timelineItems": {"totalCount": 36, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIHTE_gFqTM2NDkyNDgxMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMAxHKgFqTM3MTM1MDU1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0OTI0ODEz", "url": "https://github.com/rsksmart/rskj/pull/1178#pullrequestreview-364924813", "createdAt": "2020-02-26T14:07:39Z", "commit": {"oid": "e3253d5cf7a9ed3c748e1dd3fcaa6203610abcb5"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0OTg0MjI5", "url": "https://github.com/rsksmart/rskj/pull/1178#pullrequestreview-364984229", "createdAt": "2020-02-26T15:16:29Z", "commit": {"oid": "8c9643d489400d38ef69f9172e5eb7bfe663c115"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8c9643d489400d38ef69f9172e5eb7bfe663c115", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/8c9643d489400d38ef69f9172e5eb7bfe663c115", "committedDate": "2020-02-26T15:10:18Z", "message": "Refactor BtcLockSender classes and interactions"}, "afterCommit": {"oid": "cebc2662c22791f4d85978cd89b90ad7afd0598b", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/cebc2662c22791f4d85978cd89b90ad7afd0598b", "committedDate": "2020-02-26T18:10:44Z", "message": "Refactor BtcLockSender classes and interactions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NjExNzc5", "url": "https://github.com/rsksmart/rskj/pull/1178#pullrequestreview-367611779", "createdAt": "2020-03-02T23:46:17Z", "commit": {"oid": "2ff9ec55f3892883b8d3f0485f2fb70231634447"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4311f87975313b56003e6d96c4c78c8f272f327f", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/4311f87975313b56003e6d96c4c78c8f272f327f", "committedDate": "2020-03-04T14:44:15Z", "message": "Fix double lock with segwit addresses"}, "afterCommit": {"oid": "36df238af56a8690b170a3a5b88d3ed2516d5568", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/36df238af56a8690b170a3a5b88d3ed2516d5568", "committedDate": "2020-03-06T11:15:24Z", "message": "Fix double lock with segwit addresses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "706b5b952d32557ca5250d719500160918d22922", "author": {"user": null}, "url": "https://github.com/rsksmart/rskj/commit/706b5b952d32557ca5250d719500160918d22922", "committedDate": "2020-03-06T11:34:09Z", "message": "Includes RSKIP143 into ConsensusRules files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65710b5f2342a825ceb0ee134af2c7b270c1efa4", "author": {"user": null}, "url": "https://github.com/rsksmart/rskj/commit/65710b5f2342a825ceb0ee134af2c7b270c1efa4", "committedDate": "2020-03-06T11:34:13Z", "message": "Include new abstract class to can parse different kind of transaction and a new exception to be used for this class."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28d5817b8e06873143525f8c6c3412c623687ff7", "author": {"user": null}, "url": "https://github.com/rsksmart/rskj/commit/28d5817b8e06873143525f8c6c3412c623687ff7", "committedDate": "2020-03-06T11:34:13Z", "message": "Adds P2pkhBtcLockSender class and unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "497dc063865b179bd51281996502112f190cd80c", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/497dc063865b179bd51281996502112f190cd80c", "committedDate": "2020-03-06T11:34:13Z", "message": "Add P2shP2wpkhBtcLockSender to parse 2wp locks using segwit compatible inputs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "434263180d7cfa4a55b396a31f2da461798e0ceb", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/434263180d7cfa4a55b396a31f2da461798e0ceb", "committedDate": "2020-03-06T11:34:13Z", "message": "add BtcLockSenderProvider\n\n- Integrates P2shP2wpkhBtcLockSender instantiation\n- Integrates P2pkhBtcLockSender instantiation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38ee084e5fb8c558e9c3a648a730eb595ec9804f", "author": {"user": {"login": "marcos-iov", "name": "Marcos Irisarri"}}, "url": "https://github.com/rsksmart/rskj/commit/38ee084e5fb8c558e9c3a648a730eb595ec9804f", "committedDate": "2020-03-06T11:34:13Z", "message": "Changed logic in registerBtcTransaction to use BtcLockSender"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "252491cc308618354d38ccec9701a8d40cc3ff43", "author": {"user": null}, "url": "https://github.com/rsksmart/rskj/commit/252491cc308618354d38ccec9701a8d40cc3ff43", "committedDate": "2020-03-06T11:34:13Z", "message": "Includes a function in BridgeUtils to identify if a tx can be processed or not"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43d9916681648de0519721d763c44e0803b29d6f", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/43d9916681648de0519721d763c44e0803b29d6f", "committedDate": "2020-03-06T11:34:13Z", "message": "Add CoinbaseInformation class and stored it in Bridge storage\n\nCoinbaseInformation will be used to store Witness commitment and Witness reserved value in the processing of segwit transactions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4cb16d83c3b7cb64006536cc35387990bd61150", "author": {"user": {"login": "marcos-iov", "name": "Marcos Irisarri"}}, "url": "https://github.com/rsksmart/rskj/commit/d4cb16d83c3b7cb64006536cc35387990bd61150", "committedDate": "2020-03-06T11:34:13Z", "message": "Add P2shMultisigBtcLockSender"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad8e21096fa0092c8ce6a70219e67af1f7365d2d", "author": {"user": {"login": "marcos-iov", "name": "Marcos Irisarri"}}, "url": "https://github.com/rsksmart/rskj/commit/ad8e21096fa0092c8ce6a70219e67af1f7365d2d", "committedDate": "2020-03-06T11:34:13Z", "message": "Add P2shP2wshBtcLockSender"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a34bcec2f92b08c9e8b32630f140681747879846", "author": {"user": {"login": "marcos-iov", "name": "Marcos Irisarri"}}, "url": "https://github.com/rsksmart/rskj/commit/a34bcec2f92b08c9e8b32630f140681747879846", "committedDate": "2020-03-06T11:34:13Z", "message": "Refactor BtcLockSender tests to use the same raw txs in every test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26fa233d280568bee72349023dff1d9b892de318", "author": {"user": {"login": "marcos-iov", "name": "Marcos Irisarri"}}, "url": "https://github.com/rsksmart/rskj/commit/26fa233d280568bee72349023dff1d9b892de318", "committedDate": "2020-03-06T11:34:13Z", "message": "Add logic in registerBtcTransaction to refund multisig addresses after RSKIP 143 activation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68d99aab24a9e62e5619b254d0d5a28c460f6f22", "author": {"user": {"login": "marcos-iov", "name": "Marcos Irisarri"}}, "url": "https://github.com/rsksmart/rskj/commit/68d99aab24a9e62e5619b254d0d5a28c460f6f22", "committedDate": "2020-03-06T11:34:13Z", "message": "Add unit tests for multisig addresses lock refund on the bridge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4df25b031d6513a88466842fdf06c97a86d9f2fb", "author": {"user": {"login": "marcos-iov", "name": "Marcos Irisarri"}}, "url": "https://github.com/rsksmart/rskj/commit/4df25b031d6513a88466842fdf06c97a86d9f2fb", "committedDate": "2020-03-06T11:34:13Z", "message": "Refactor registerBtcTransaction tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11512875899f7461bfa30265146a10b530175d23", "author": {"user": {"login": "marcos-iov", "name": "Marcos Irisarri"}}, "url": "https://github.com/rsksmart/rskj/commit/11512875899f7461bfa30265146a10b530175d23", "committedDate": "2020-03-06T11:34:13Z", "message": "Refactor BridgeSupport tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1e6619a865974f7156e4e1ae106d6bff62a74b9", "author": {"user": {"login": "guidohernan93", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/d1e6619a865974f7156e4e1ae106d6bff62a74b9", "committedDate": "2020-03-06T11:34:13Z", "message": "Updates build.gradle to use bitcoinj 9"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5003869ad62243ad5a0c2c28755c912347346c4", "author": {"user": {"login": "guidohernan93", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/c5003869ad62243ad5a0c2c28755c912347346c4", "committedDate": "2020-03-06T11:34:13Z", "message": "Fix repository issues in BridgePerformanceTestCase"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "36df238af56a8690b170a3a5b88d3ed2516d5568", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/36df238af56a8690b170a3a5b88d3ed2516d5568", "committedDate": "2020-03-06T11:15:24Z", "message": "Fix double lock with segwit addresses"}, "afterCommit": {"oid": "99ea0314ed813563fad17644e4588ddc9980f170", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/99ea0314ed813563fad17644e4588ddc9980f170", "committedDate": "2020-03-06T11:34:14Z", "message": "Fix double lock with segwit addresses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNjg0ODQ2", "url": "https://github.com/rsksmart/rskj/pull/1178#pullrequestreview-370684846", "createdAt": "2020-03-06T23:25:06Z", "commit": {"oid": "99ea0314ed813563fad17644e4588ddc9980f170"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMTczOTIy", "url": "https://github.com/rsksmart/rskj/pull/1178#pullrequestreview-371173922", "createdAt": "2020-03-09T13:18:55Z", "commit": {"oid": "99ea0314ed813563fad17644e4588ddc9980f170"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMzoxODo1NVrOFzmjkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMzoxODo1NVrOFzmjkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY1MzM5NQ==", "bodyText": "Throws exception if size != 1 but the message says it expects size to be 2", "url": "https://github.com/rsksmart/rskj/pull/1178#discussion_r389653395", "createdAt": "2020-03-09T13:18:55Z", "author": {"login": "marcos-iov"}, "path": "rskj-core/src/main/java/co/rsk/peg/BridgeSerializationUtils.java", "diffHunk": "@@ -707,6 +708,30 @@ public static Integer deserializeInteger(byte[] data) {\n         return Optional.of(RLP.decodeBigInteger(data, 0).longValue());\n     }\n \n+    public static CoinbaseInformation deserializeCoinbaseInformation(byte[] data) {\n+        if (data == null) {\n+            return null;\n+        }\n+        RLPList rlpList = (RLPList)RLP.decode2(data).get(0);\n+\n+        if (rlpList.size() != 1) {\n+            throw new RuntimeException(String.format(\"Invalid serialized coinbase information, expected 2 values but got %n\", rlpList.size()));\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99ea0314ed813563fad17644e4588ddc9980f170"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb695173cf81f16238adf8c608401b2cbdba8e6f", "author": {"user": null}, "url": "https://github.com/rsksmart/rskj/commit/fb695173cf81f16238adf8c608401b2cbdba8e6f", "committedDate": "2020-03-09T13:38:00Z", "message": "Add coinbase related methods to Bridge\n\nBridge methods\n- registerBtcCoinbaseTransaction: Given a blockHash, it registers the witness merkle root extracted from the coinbase\n- hasBtcBlockCoinbaseTransactionInformation: Given a blockhash, indicates if it contains coinbase information\n\nCreated performance tests for these methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc81458b0564501ead26ce2ae8988f228a905a33", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/cc81458b0564501ead26ce2ae8988f228a905a33", "committedDate": "2020-03-09T13:38:05Z", "message": "Refactor BtcLockSender classes and interactions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bf05fae41a038d84b37884da71b537bd87faf57", "author": {"user": null}, "url": "https://github.com/rsksmart/rskj/commit/7bf05fae41a038d84b37884da71b537bd87faf57", "committedDate": "2020-03-09T13:38:05Z", "message": "Fix bug in getBtcTrnsactionConfirmation test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30ce67927474309bab74b28206d9b06c36b316f4", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/30ce67927474309bab74b28206d9b06c36b316f4", "committedDate": "2020-03-09T13:38:05Z", "message": "Add test to verify Bridge lock event supports p2sh addresses"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e25f7de540c92555012917293463d5d6e5ab1654", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/e25f7de540c92555012917293463d5d6e5ab1654", "committedDate": "2020-03-09T13:38:05Z", "message": "Improve logs for BridgeSupport"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMTgwNTU0", "url": "https://github.com/rsksmart/rskj/pull/1178#pullrequestreview-371180554", "createdAt": "2020-03-09T13:27:04Z", "commit": {"oid": "99ea0314ed813563fad17644e4588ddc9980f170"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMzoyNzowNFrOFznEJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMzoyNzowNFrOFznEJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY2MTczMg==", "bodyText": "Confusing comment", "url": "https://github.com/rsksmart/rskj/pull/1178#discussion_r389661732", "createdAt": "2020-03-09T13:27:04Z", "author": {"login": "marcos-iov"}, "path": "rskj-core/src/main/java/co/rsk/peg/BridgeSupport.java", "diffHunk": "@@ -324,21 +337,26 @@ public void registerBtcTransaction(Transaction rskTx, byte[] btcTxSerialized, in\n         BtcTransaction btcTx = new BtcTransaction(bridgeConstants.getBtcParams(), btcTxSerialized);\n         btcTx.verify();\n \n+        // Check the again tx was not already processed but making sure to use the txid (no witness)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99ea0314ed813563fad17644e4588ddc9980f170"}, "originalPosition": 75}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33fcf235acbe818154419ab037562917379c9205", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/33fcf235acbe818154419ab037562917379c9205", "committedDate": "2020-03-09T14:02:27Z", "message": "Fix double lock with segwit addresses"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "99ea0314ed813563fad17644e4588ddc9980f170", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/99ea0314ed813563fad17644e4588ddc9980f170", "committedDate": "2020-03-06T11:34:14Z", "message": "Fix double lock with segwit addresses"}, "afterCommit": {"oid": "33fcf235acbe818154419ab037562917379c9205", "author": {"user": {"login": "josedahlquist", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/33fcf235acbe818154419ab037562917379c9205", "committedDate": "2020-03-09T14:02:27Z", "message": "Fix double lock with segwit addresses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMzIxMjU0", "url": "https://github.com/rsksmart/rskj/pull/1178#pullrequestreview-371321254", "createdAt": "2020-03-09T16:10:55Z", "commit": {"oid": "33fcf235acbe818154419ab037562917379c9205"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMzIxNjM2", "url": "https://github.com/rsksmart/rskj/pull/1178#pullrequestreview-371321636", "createdAt": "2020-03-09T16:11:24Z", "commit": {"oid": "33fcf235acbe818154419ab037562917379c9205"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMzUwNTU1", "url": "https://github.com/rsksmart/rskj/pull/1178#pullrequestreview-371350555", "createdAt": "2020-03-09T16:46:49Z", "commit": {"oid": "33fcf235acbe818154419ab037562917379c9205"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 651, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}