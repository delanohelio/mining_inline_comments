{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5MjIxMjAx", "number": 1360, "title": "Make BtcBlockStore cache configurable", "bodyText": "Description\n\nMake BtcBlockStore cache configurable, with 2 options: depth and size.\nAdd more logs, to identify possible issues in long sync.\nMotivation and Context\n\n\nWhen making a long-sync in testnet, I found some range of blocks with a lot of BTC blocks, which makes it really hard to process. Increasing the cache, would make it faster and would take more advantage of this cache. As the configuration of this cache are now static fields, I made this change so we could configure it depending on the chain we are.\nFor the purpose of this PR, we wanted to change only testnet params.\nHow Has This Been Tested?\n\n\n\nSyncing with Boton instance on testnet.\nTypes of changes\n\n\n Bug fix (non-breaking change which fixes an issue)\n New feature (non-breaking change which adds functionality)\n Breaking change (fix or feature that would cause existing functionality to not work as expected)\n\nChecklist:\n\n\n\n My code follows the code style of this project.\n My change requires a change to the documentation.\n I have updated the documentation accordingly.\n Tests for the changes have been added (for bug fixes / features)\n Requires Activation Code (Hard Fork)\n\n\nOther information:\n\nProperties:\n\ncache.btcBlockStore.size: default to 10k\ncache.btcBlockStore.depth: default to 5k (depth is calculated by the height of the block)", "createdAt": "2020-11-11T14:08:30Z", "url": "https://github.com/rsksmart/rskj/pull/1360", "merged": true, "mergeCommit": {"oid": "63dbf936232a193101b8d9ff1fad61ecfaf8d85d"}, "closed": true, "closedAt": "2021-01-21T18:57:36Z", "author": {"login": "patogallaiovlabs"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbgbCUgFqTUyODMyMzc4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdyYC9QAFqTU3MzU3MzM2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MzIzNzgz", "url": "https://github.com/rsksmart/rskj/pull/1360#pullrequestreview-528323783", "createdAt": "2020-11-11T16:19:40Z", "commit": {"oid": "d52494c6646aa7c18db3320ef4ae574025179638"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNjoxOTo0MVrOHxUNUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNjoxOTo0MVrOHxUNUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ3MzM2Mg==", "bodyText": "This is different than the default value, is it ok?", "url": "https://github.com/rsksmart/rskj/pull/1360#discussion_r521473362", "createdAt": "2020-11-11T16:19:41Z", "author": {"login": "donequis"}, "path": "rskj-core/src/main/resources/config/testnet.conf", "diffHunk": "@@ -71,3 +71,10 @@ wallet {\n     enabled = false\n     accounts = []\n }\n+\n+cache {\n+    btcBlockStore {\n+        depth: 50000,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d52494c6646aa7c18db3320ef4ae574025179638"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4MzI2Mjkz", "url": "https://github.com/rsksmart/rskj/pull/1360#pullrequestreview-528326293", "createdAt": "2020-11-11T16:22:23Z", "commit": {"oid": "d52494c6646aa7c18db3320ef4ae574025179638"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNjoyMjoyNFrOHxUUmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNjoyMjoyNFrOHxUUmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ3NTIyNQ==", "bodyText": "There are two things that you can check here (or in the caller)\n\n\nThat depth <= size\n\n\nThat depth >= 4000 or some other constant. You can add a warning log in case that it fails, there's no reason to fail. But a lower value sounds problematic", "url": "https://github.com/rsksmart/rskj/pull/1360#discussion_r521475225", "createdAt": "2020-11-11T16:22:24Z", "author": {"login": "donequis"}, "path": "rskj-core/src/main/java/co/rsk/config/RskSystemProperties.java", "diffHunk": "@@ -338,6 +338,14 @@ public int getReceiptsCacheSize() {\n         return configFromFiles.getInt(\"cache.receipts.max-elements\");\n     }\n \n+    public int getBtcBlockStoreCacheSize() {\n+        return configFromFiles.getInt(\"cache.btcBlockStore.size\");\n+    }\n+\n+    public int getBtcBlockStoreCacheDepth() {\n+        return configFromFiles.getInt(\"cache.btcBlockStore.depth\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d52494c6646aa7c18db3320ef4ae574025179638"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60dac5e4bd71a9ed4a14f50e1ccc9cbaf1d7984b", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/60dac5e4bd71a9ed4a14f50e1ccc9cbaf1d7984b", "committedDate": "2020-11-12T20:14:39Z", "message": "Add config warnings"}, "afterCommit": {"oid": "847324eb215001e25c802b077a376063d6e82ef0", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/847324eb215001e25c802b077a376063d6e82ef0", "committedDate": "2020-11-12T20:17:58Z", "message": "Add config warnings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "847324eb215001e25c802b077a376063d6e82ef0", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/847324eb215001e25c802b077a376063d6e82ef0", "committedDate": "2020-11-12T20:17:58Z", "message": "Add config warnings"}, "afterCommit": {"oid": "c5f59b249f47575eaa63b89272cbbd6dddc2fc85", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/c5f59b249f47575eaa63b89272cbbd6dddc2fc85", "committedDate": "2020-11-16T14:24:54Z", "message": "Add config warnings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f35362259189fc2115fec1c0efbfef49acc7da30", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/f35362259189fc2115fec1c0efbfef49acc7da30", "committedDate": "2020-11-17T17:17:31Z", "message": "finding the correct value"}, "afterCommit": {"oid": "a1396b82849d2ff17e3721364ef9392fd27f0f97", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/a1396b82849d2ff17e3721364ef9392fd27f0f97", "committedDate": "2021-01-19T19:07:31Z", "message": "Comment suggested config for Full Sync"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a1396b82849d2ff17e3721364ef9392fd27f0f97", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/a1396b82849d2ff17e3721364ef9392fd27f0f97", "committedDate": "2021-01-19T19:07:31Z", "message": "Comment suggested config for Full Sync"}, "afterCommit": {"oid": "1f77d2f0c03f3c6a9963f9145bc561a76522ed67", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/1f77d2f0c03f3c6a9963f9145bc561a76522ed67", "committedDate": "2021-01-21T13:14:46Z", "message": "Comment suggested config for Full Sync"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6358847d2da41fc36771781349c8f66f8c4a5e6", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/c6358847d2da41fc36771781349c8f66f8c4a5e6", "committedDate": "2021-01-21T14:09:58Z", "message": "Increase Bridge Cache (BTC Bck Store) / Add logs to block execution and save"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35d364abf6ec1953e042915d2d7a22fad88f1327", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/35d364abf6ec1953e042915d2d7a22fad88f1327", "committedDate": "2021-01-21T14:09:58Z", "message": "make BTCBlockStore Cache Size/Depth configurable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ad6982f414b5278fd3dee7f6c81e7fb5a5bf6dc", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/9ad6982f414b5278fd3dee7f6c81e7fb5a5bf6dc", "committedDate": "2021-01-21T14:09:58Z", "message": "Add config warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf33169bda19ea9c85806afe49c3fa8d4372c788", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/bf33169bda19ea9c85806afe49c3fa8d4372c788", "committedDate": "2021-01-21T14:09:58Z", "message": "finding the correct value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29dbff073a2df552e8e74b5f37eb3e33b17c4975", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/29dbff073a2df552e8e74b5f37eb3e33b17c4975", "committedDate": "2021-01-21T14:09:58Z", "message": "Comment suggested config for Full Sync"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f77d2f0c03f3c6a9963f9145bc561a76522ed67", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/1f77d2f0c03f3c6a9963f9145bc561a76522ed67", "committedDate": "2021-01-21T13:14:46Z", "message": "Comment suggested config for Full Sync"}, "afterCommit": {"oid": "29dbff073a2df552e8e74b5f37eb3e33b17c4975", "author": {"user": {"login": "patogallaiovlabs", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/29dbff073a2df552e8e74b5f37eb3e33b17c4975", "committedDate": "2021-01-21T14:09:58Z", "message": "Comment suggested config for Full Sync"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTczNTczMzY3", "url": "https://github.com/rsksmart/rskj/pull/1360#pullrequestreview-573573367", "createdAt": "2021-01-21T17:34:24Z", "commit": {"oid": "29dbff073a2df552e8e74b5f37eb3e33b17c4975"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 623, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}