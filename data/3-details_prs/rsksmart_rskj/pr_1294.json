{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5Njg5NzE2", "number": 1294, "title": "Log nanoseconds as seconds", "bodyText": "Some log messages include time measured in nanoseconds. In this new code, that information is formatted to seconds, with 6 decimal places.\nExamples:\n2020-08-18-14:40:17.0838 INFO [blockchain] [message handler] [blockHash=e3....52, blockHeight=1083025]  block: num: [1083025] hash: [e3....52], processed after: [0.083470]seconds, result IMPORTED_BEST\n2020-08-18-14:40:22.0662 INFO [blockchain] [message handler] [blockHash=c4....4b, blockHeight=1083057]  block: num: [1083057] hash: [c4---4b], processed after: [0.038909]seconds, result IMPORTED_BEST\n\n\nI put 6 decimals places, because some times have millionths of a second, ie:\n2020-08-18-14:49:38.0125 DEBUG [messageProcess] [message handler]  Message[NEW_BLOCK_HASHES] processed after [0.000189] seconds.\n2020-08-18-14:49:38.0128 DEBUG [messageProcess] [message handler]  Message[NEW_BLOCK_HASHES] processed after [0.000133] seconds.\n2020-08-18-14:49:38.0158 DEBUG [messageProcess] [message handler]  Message[STATUS_MESSAGE] processed after [0.000026] seconds.\n\n\nThey could be very frequent, so it is important to not count them as zero time\nAlso, this pull request add warns to block processing if processing time > 1 minute", "createdAt": "2020-08-18T19:21:11Z", "url": "https://github.com/rsksmart/rskj/pull/1294", "merged": true, "mergeCommit": {"oid": "ed8f572b49d33c6cc69dfad2d5c9a1231aee2a2b"}, "closed": true, "closedAt": "2020-09-07T16:33:12Z", "author": {"login": "ajlopezrsk"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAc4IKgBqjM2NzEyMDY5NjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdGkZXQAFqTQ4MzYxOTU2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ba84cc9e793d084f78c82035291309c5c13025de", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/ba84cc9e793d084f78c82035291309c5c13025de", "committedDate": "2020-08-18T19:35:20Z", "message": "Fixing sonar issues"}, "afterCommit": {"oid": "8586239c912498f1e48c360d5bb4e07b521a62ce", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/8586239c912498f1e48c360d5bb4e07b521a62ce", "committedDate": "2020-08-19T14:54:24Z", "message": "Warn if block process takes more than one minute"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNDczNTUy", "url": "https://github.com/rsksmart/rskj/pull/1294#pullrequestreview-471473552", "createdAt": "2020-08-20T10:40:48Z", "commit": {"oid": "8586239c912498f1e48c360d5bb4e07b521a62ce"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8586239c912498f1e48c360d5bb4e07b521a62ce", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/8586239c912498f1e48c360d5bb4e07b521a62ce", "committedDate": "2020-08-19T14:54:24Z", "message": "Warn if block process takes more than one minute"}, "afterCommit": {"oid": "f2c48d17aca9c5a090d00dbc8bfba1a9c0cd46e6", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/f2c48d17aca9c5a090d00dbc8bfba1a9c0cd46e6", "committedDate": "2020-08-26T13:41:06Z", "message": "Warn if block process takes more than one minute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f2c48d17aca9c5a090d00dbc8bfba1a9c0cd46e6", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/f2c48d17aca9c5a090d00dbc8bfba1a9c0cd46e6", "committedDate": "2020-08-26T13:41:06Z", "message": "Warn if block process takes more than one minute"}, "afterCommit": {"oid": "91a86107862921e14dec88b596b923bfa738a1e0", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/91a86107862921e14dec88b596b923bfa738a1e0", "committedDate": "2020-08-27T20:12:27Z", "message": "Warn if block process takes more than one minute"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5OTg4MDk5", "url": "https://github.com/rsksmart/rskj/pull/1294#pullrequestreview-479988099", "createdAt": "2020-09-01T17:58:18Z", "commit": {"oid": "91a86107862921e14dec88b596b923bfa738a1e0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNzo1ODoxOFrOHLCDSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxODowMDowOVrOHLCHlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMyOTk5NQ==", "bodyText": "final?", "url": "https://github.com/rsksmart/rskj/pull/1294#discussion_r481329995", "createdAt": "2020-09-01T17:58:18Z", "author": {"login": "patogallaiovlabs"}, "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockUtils.java", "diffHunk": "@@ -32,9 +32,14 @@\n  * Created by ajlopez on 19/08/2016.\n  */\n public class BlockUtils {\n+    private static long MAX_BLOCK_PROCESS_TIME_NANOSECONDS = 60_000_000_000L;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91a86107862921e14dec88b596b923bfa738a1e0"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMzMTA5NA==", "bodyText": "I would add some tests for this method, seems to have some complexity.", "url": "https://github.com/rsksmart/rskj/pull/1294#discussion_r481331094", "createdAt": "2020-09-01T18:00:09Z", "author": {"login": "patogallaiovlabs"}, "path": "rskj-core/src/main/java/co/rsk/net/BlockProcessResult.java", "diffHunk": "@@ -69,10 +71,17 @@ public boolean isInvalidBlock() {\n \n     private void logResult(String blockHash, Duration processingTime) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91a86107862921e14dec88b596b923bfa738a1e0"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "91a86107862921e14dec88b596b923bfa738a1e0", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/91a86107862921e14dec88b596b923bfa738a1e0", "committedDate": "2020-08-27T20:12:27Z", "message": "Warn if block process takes more than one minute"}, "afterCommit": {"oid": "278cca473857d83248851467d5cc2ae822d5262b", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/278cca473857d83248851467d5cc2ae822d5262b", "committedDate": "2020-09-02T14:15:17Z", "message": "Warn if block process takes more than one minute"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63f6c31bcc4e4e8d620597b891d7b155b4ea309b", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/63f6c31bcc4e4e8d620597b891d7b155b4ea309b", "committedDate": "2020-09-02T20:49:33Z", "message": "Static constant as final"}, "afterCommit": {"oid": "66f3a40736615f3845ad24f66f422aace7b04cd2", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/66f3a40736615f3845ad24f66f422aace7b04cd2", "committedDate": "2020-09-03T19:09:43Z", "message": "BlockProcessorResult build log message"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMTc3Mjky", "url": "https://github.com/rsksmart/rskj/pull/1294#pullrequestreview-482177292", "createdAt": "2020-09-03T20:24:11Z", "commit": {"oid": "66f3a40736615f3845ad24f66f422aace7b04cd2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMDoyNDoxMVrOHM2SHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMDoyNDoxMVrOHM2SHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIzNDMzMg==", "bodyText": "you don't need to add num and hash, MDC adds that to every logged line", "url": "https://github.com/rsksmart/rskj/pull/1294#discussion_r483234332", "createdAt": "2020-09-03T20:24:11Z", "author": {"login": "nicops"}, "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockChainImpl.java", "diffHunk": "@@ -156,7 +157,15 @@ public ImportResult tryToConnect(Block block) {\n                     long saveTime = System.nanoTime();\n                     ImportResult result = internalTryToConnect(block);\n                     long totalTime = System.nanoTime() - saveTime;\n-                    logger.info(\"block: num: [{}] hash: [{}], processed after: [{}]nano, result {}\", block.getNumber(), block.getPrintableHash(), totalTime, result);\n+                    String timeInSeconds = FormatUtils.formatNanosecondsToSeconds(totalTime);\n+\n+                    if (BlockUtils.tooMuchProcessTime(totalTime)) {\n+                        logger.warn(\"block: num: [{}] hash: [{}], processed after: [{}]seconds, result {}\", block.getNumber(), block.getPrintableHash(), timeInSeconds, result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66f3a40736615f3845ad24f66f422aace7b04cd2"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMTc3OTcy", "url": "https://github.com/rsksmart/rskj/pull/1294#pullrequestreview-482177972", "createdAt": "2020-09-03T20:25:16Z", "commit": {"oid": "66f3a40736615f3845ad24f66f422aace7b04cd2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMDoyNToxNlrOHM2ULA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMDoyNToxNlrOHM2ULA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIzNDg2MA==", "bodyText": "same comment as above, you can dispense of the num and hash", "url": "https://github.com/rsksmart/rskj/pull/1294#discussion_r483234860", "createdAt": "2020-09-03T20:25:16Z", "author": {"login": "nicops"}, "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockChainImpl.java", "diffHunk": "@@ -257,7 +266,14 @@ private ImportResult internalTryToConnect(Block block) {\n             // to the parent's repository.\n \n             long totalTime = System.nanoTime() - saveTime;\n-            logger.trace(\"block: num: [{}] hash: [{}], executed after: [{}]nano\", block.getNumber(), block.getPrintableHash(), totalTime);\n+            String timeInSeconds = FormatUtils.formatNanosecondsToSeconds(totalTime);\n+\n+            if (BlockUtils.tooMuchProcessTime(totalTime)) {\n+                logger.warn(\"block: num: [{}] hash: [{}], executed after: [{}]seconds\", block.getNumber(), block.getPrintableHash(), timeInSeconds);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66f3a40736615f3845ad24f66f422aace7b04cd2"}, "originalPosition": 33}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "43150872f0c40152e0333a0e933c413aeaabfd7b", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/43150872f0c40152e0333a0e933c413aeaabfd7b", "committedDate": "2020-09-03T20:24:05Z", "message": "Conditional in some logs"}, "afterCommit": {"oid": "ca80546f20446187ee720cdb56851a6fabdb43cf", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/ca80546f20446187ee720cdb56851a6fabdb43cf", "committedDate": "2020-09-03T21:40:56Z", "message": "Conditional in some logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fae62f6f7ac6ee23d2a1a67888730f27608830c", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/4fae62f6f7ac6ee23d2a1a67888730f27608830c", "committedDate": "2020-09-07T13:13:04Z", "message": "Format nanoseconds to seconds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c315c8f4c3fe8f19cd309a0c3b92dae3556ba72", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/3c315c8f4c3fe8f19cd309a0c3b92dae3556ba72", "committedDate": "2020-09-07T13:13:04Z", "message": "Log messages in seconds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db8c74372eca710f51b0a94f1f49b81362f4b444", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/db8c74372eca710f51b0a94f1f49b81362f4b444", "committedDate": "2020-09-07T13:13:04Z", "message": "Fixing sonar issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1509b10bc7fc20682b4d558e3e1e6ad677548c35", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/1509b10bc7fc20682b4d558e3e1e6ad677548c35", "committedDate": "2020-09-07T13:13:04Z", "message": "Warn if block process takes more than one minute"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41ee2a6c64827f40b8c57a568ea2ef9a67d12efb", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/41ee2a6c64827f40b8c57a568ea2ef9a67d12efb", "committedDate": "2020-09-07T13:13:04Z", "message": "Static constant as final"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89f40bedef30a82a726017725cc21b691bf7981f", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/89f40bedef30a82a726017725cc21b691bf7981f", "committedDate": "2020-09-07T13:13:04Z", "message": "BlockProcessorResult build log message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da3d5f2ca0e440aa112edcbf5304ddf022c2e238", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/da3d5f2ca0e440aa112edcbf5304ddf022c2e238", "committedDate": "2020-09-07T13:13:04Z", "message": "Conditional in some logs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ca80546f20446187ee720cdb56851a6fabdb43cf", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/ca80546f20446187ee720cdb56851a6fabdb43cf", "committedDate": "2020-09-03T21:40:56Z", "message": "Conditional in some logs"}, "afterCommit": {"oid": "da3d5f2ca0e440aa112edcbf5304ddf022c2e238", "author": {"user": {"login": "ajlopez", "name": null}}, "url": "https://github.com/rsksmart/rskj/commit/da3d5f2ca0e440aa112edcbf5304ddf022c2e238", "committedDate": "2020-09-07T13:13:04Z", "message": "Conditional in some logs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNjE5NTYz", "url": "https://github.com/rsksmart/rskj/pull/1294#pullrequestreview-483619563", "createdAt": "2020-09-07T15:05:04Z", "commit": {"oid": "da3d5f2ca0e440aa112edcbf5304ddf022c2e238"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 509, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}