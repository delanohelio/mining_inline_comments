{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5Njg5NzE2", "number": 1294, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNzo1ODoxOFrOEfBMSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMDoyNToxNlrOEgJPbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwOTYwODQyOnYy", "diffSide": "RIGHT", "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNzo1ODoxOFrOHLCDSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxNTozODoxMFrOHMsdNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMyOTk5NQ==", "bodyText": "final?", "url": "https://github.com/rsksmart/rskj/pull/1294#discussion_r481329995", "createdAt": "2020-09-01T17:58:18Z", "author": {"login": "patogallaiovlabs"}, "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockUtils.java", "diffHunk": "@@ -32,9 +32,14 @@\n  * Created by ajlopez on 19/08/2016.\n  */\n public class BlockUtils {\n+    private static long MAX_BLOCK_PROCESS_TIME_NANOSECONDS = 60_000_000_000L;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91a86107862921e14dec88b596b923bfa738a1e0"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3MzMzMw==", "bodyText": "done", "url": "https://github.com/rsksmart/rskj/pull/1294#discussion_r483073333", "createdAt": "2020-09-03T15:38:10Z", "author": {"login": "ajlopezrsk"}, "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockUtils.java", "diffHunk": "@@ -32,9 +32,14 @@\n  * Created by ajlopez on 19/08/2016.\n  */\n public class BlockUtils {\n+    private static long MAX_BLOCK_PROCESS_TIME_NANOSECONDS = 60_000_000_000L;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMyOTk5NQ=="}, "originalCommit": {"oid": "91a86107862921e14dec88b596b923bfa738a1e0"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwOTYxNTI0OnYy", "diffSide": "RIGHT", "path": "rskj-core/src/main/java/co/rsk/net/BlockProcessResult.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxODowMDowOVrOHLCHlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMDowNToyNFrOHM1qBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMzMTA5NA==", "bodyText": "I would add some tests for this method, seems to have some complexity.", "url": "https://github.com/rsksmart/rskj/pull/1294#discussion_r481331094", "createdAt": "2020-09-01T18:00:09Z", "author": {"login": "patogallaiovlabs"}, "path": "rskj-core/src/main/java/co/rsk/net/BlockProcessResult.java", "diffHunk": "@@ -69,10 +71,17 @@ public boolean isInvalidBlock() {\n \n     private void logResult(String blockHash, Duration processingTime) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91a86107862921e14dec88b596b923bfa738a1e0"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIyNDA3MA==", "bodyText": "Done", "url": "https://github.com/rsksmart/rskj/pull/1294#discussion_r483224070", "createdAt": "2020-09-03T20:05:24Z", "author": {"login": "ajlopezrsk"}, "path": "rskj-core/src/main/java/co/rsk/net/BlockProcessResult.java", "diffHunk": "@@ -69,10 +71,17 @@ public boolean isInvalidBlock() {\n \n     private void logResult(String blockHash, Duration processingTime) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMzMTA5NA=="}, "originalCommit": {"oid": "91a86107862921e14dec88b596b923bfa738a1e0"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMTQwOTQ0OnYy", "diffSide": "RIGHT", "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockChainImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMDoyNDoxMVrOHM2SHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMDo1NTo0OVrOHM3Mag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIzNDMzMg==", "bodyText": "you don't need to add num and hash, MDC adds that to every logged line", "url": "https://github.com/rsksmart/rskj/pull/1294#discussion_r483234332", "createdAt": "2020-09-03T20:24:11Z", "author": {"login": "nicops"}, "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockChainImpl.java", "diffHunk": "@@ -156,7 +157,15 @@ public ImportResult tryToConnect(Block block) {\n                     long saveTime = System.nanoTime();\n                     ImportResult result = internalTryToConnect(block);\n                     long totalTime = System.nanoTime() - saveTime;\n-                    logger.info(\"block: num: [{}] hash: [{}], processed after: [{}]nano, result {}\", block.getNumber(), block.getPrintableHash(), totalTime, result);\n+                    String timeInSeconds = FormatUtils.formatNanosecondsToSeconds(totalTime);\n+\n+                    if (BlockUtils.tooMuchProcessTime(totalTime)) {\n+                        logger.warn(\"block: num: [{}] hash: [{}], processed after: [{}]seconds, result {}\", block.getNumber(), block.getPrintableHash(), timeInSeconds, result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66f3a40736615f3845ad24f66f422aace7b04cd2"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI0OTI1OA==", "bodyText": "OK, but why such messages were not changed in the pull request that adds the MDC? The above messages are only an improve over those messages", "url": "https://github.com/rsksmart/rskj/pull/1294#discussion_r483249258", "createdAt": "2020-09-03T20:55:49Z", "author": {"login": "ajlopezrsk"}, "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockChainImpl.java", "diffHunk": "@@ -156,7 +157,15 @@ public ImportResult tryToConnect(Block block) {\n                     long saveTime = System.nanoTime();\n                     ImportResult result = internalTryToConnect(block);\n                     long totalTime = System.nanoTime() - saveTime;\n-                    logger.info(\"block: num: [{}] hash: [{}], processed after: [{}]nano, result {}\", block.getNumber(), block.getPrintableHash(), totalTime, result);\n+                    String timeInSeconds = FormatUtils.formatNanosecondsToSeconds(totalTime);\n+\n+                    if (BlockUtils.tooMuchProcessTime(totalTime)) {\n+                        logger.warn(\"block: num: [{}] hash: [{}], processed after: [{}]seconds, result {}\", block.getNumber(), block.getPrintableHash(), timeInSeconds, result);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIzNDMzMg=="}, "originalCommit": {"oid": "66f3a40736615f3845ad24f66f422aace7b04cd2"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyMTQxMjk0OnYy", "diffSide": "RIGHT", "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockChainImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMDoyNToxNlrOHM2ULA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMDoyNToxNlrOHM2ULA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIzNDg2MA==", "bodyText": "same comment as above, you can dispense of the num and hash", "url": "https://github.com/rsksmart/rskj/pull/1294#discussion_r483234860", "createdAt": "2020-09-03T20:25:16Z", "author": {"login": "nicops"}, "path": "rskj-core/src/main/java/co/rsk/core/bc/BlockChainImpl.java", "diffHunk": "@@ -257,7 +266,14 @@ private ImportResult internalTryToConnect(Block block) {\n             // to the parent's repository.\n \n             long totalTime = System.nanoTime() - saveTime;\n-            logger.trace(\"block: num: [{}] hash: [{}], executed after: [{}]nano\", block.getNumber(), block.getPrintableHash(), totalTime);\n+            String timeInSeconds = FormatUtils.formatNanosecondsToSeconds(totalTime);\n+\n+            if (BlockUtils.tooMuchProcessTime(totalTime)) {\n+                logger.warn(\"block: num: [{}] hash: [{}], executed after: [{}]seconds\", block.getNumber(), block.getPrintableHash(), timeInSeconds);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "66f3a40736615f3845ad24f66f422aace7b04cd2"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4460, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}