{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2Njg0MDc5", "number": 2248, "title": "[005] - Fix problems in productionalized CDC code", "bodyText": "Checklist\n\n Tags Set\n Milestone Set", "createdAt": "2020-05-12T12:11:03Z", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2248", "merged": true, "mergeCommit": {"oid": "5bc278169d0fa757b645893017160d3272c30d54"}, "closed": true, "closedAt": "2020-05-20T06:21:13Z", "author": {"login": "jbartok"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgeToNgH2gAyNDE2Njg0MDc5OjYwYzMyNmIyNWM5YTdlMWJjNTZhNGFjN2MzMTcyODc2NTNhNzIxOGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABci0AXNAFqTQxNDQxNDU1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "60c326b25c9a7e1bc56a4ac7c317287653a7218a", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/60c326b25c9a7e1bc56a4ac7c317287653a7218a", "committedDate": "2020-05-12T06:30:15Z", "message": "Set Jet version for website replacement script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4edb48ed6e9d387a08aa24246580e4ce39c88547", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/4edb48ed6e9d387a08aa24246580e4ce39c88547", "committedDate": "2020-05-12T06:40:30Z", "message": "Change type of serialization used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a53fbbfaaa376eaae975cbc12064e7cdf4d26e7f", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/a53fbbfaaa376eaae975cbc12064e7cdf4d26e7f", "committedDate": "2020-05-12T10:08:13Z", "message": "Use JSON convenience instead of Jackson jr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73bd41ca81629a4ce2c59acdd9a557aa8e1b49e9", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/73bd41ca81629a4ce2c59acdd9a557aa8e1b49e9", "committedDate": "2020-05-12T10:08:43Z", "message": "Fix jar assembly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e5db9ffd16579bfd386113e97f85c706a266132", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/2e5db9ffd16579bfd386113e97f85c706a266132", "committedDate": "2020-05-12T11:24:18Z", "message": "Remove redundant cast"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d0a87e2beb2efa4299bf0fb3bc6c44e039a3956", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/3d0a87e2beb2efa4299bf0fb3bc6c44e039a3956", "committedDate": "2020-05-13T11:47:48Z", "message": "Fix some website content"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe83154cda3fbf649a35994a18c295ed92b89a71", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/fe83154cda3fbf649a35994a18c295ed92b89a71", "committedDate": "2020-05-14T11:24:03Z", "message": "Re-implement CDC specific map sinks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "413937b2cb6b7317e5c84509fce6c631d61927cf", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/413937b2cb6b7317e5c84509fce6c631d61927cf", "committedDate": "2020-05-14T11:57:38Z", "message": "Make jackson annotations part of the main CDC jar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16ad3b0872c4b895e546b27645847a70e402d886", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/16ad3b0872c4b895e546b27645847a70e402d886", "committedDate": "2020-05-14T12:05:45Z", "message": "Adjust tutorial to latest changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a59106887703490494daac5408771f3c49d8de01", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/a59106887703490494daac5408771f3c49d8de01", "committedDate": "2020-05-14T13:17:46Z", "message": "Merge branch 'master' into cdc-fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "701f42a903d2d35ecef0908a59673c69b4011caa", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/701f42a903d2d35ecef0908a59673c69b4011caa", "committedDate": "2020-05-15T05:28:37Z", "message": "Adapt to latest json convenience changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ef66ff6aa2402357010fa73701d2629aa37ef96", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/9ef66ff6aa2402357010fa73701d2629aa37ef96", "committedDate": "2020-05-15T06:39:11Z", "message": "Add CDC map sink to sources & sinks page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bb9f77b46043deed30f5f479e44492cd5396d39", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/4bb9f77b46043deed30f5f479e44492cd5396d39", "committedDate": "2020-05-15T06:54:09Z", "message": "Revert some changes in the tutorial"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce0aca55ed49d9ebf81d29f0b7d19c9d46f75191", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/ce0aca55ed49d9ebf81d29f0b7d19c9d46f75191", "committedDate": "2020-05-15T07:29:37Z", "message": "Change licensing of the CDC modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df1d4e6be0596f6ee1cc8216c22629a70eaf5c24", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/df1d4e6be0596f6ee1cc8216c22629a70eaf5c24", "committedDate": "2020-05-15T08:13:59Z", "message": "Fix javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f1dd23fd08921e489c04cabbd48b1549fc85822", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/6f1dd23fd08921e489c04cabbd48b1549fc85822", "committedDate": "2020-05-15T11:07:10Z", "message": "Extract some common processor code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2574aadd70d20f8eddcba4b4eae81585da8ad60f", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/2574aadd70d20f8eddcba4b4eae81585da8ad60f", "committedDate": "2020-05-18T06:50:26Z", "message": "Force total parallelism of sink to 1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e04c2b46a5ec47e783aed646821b32bb59401168", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/e04c2b46a5ec47e783aed646821b32bb59401168", "committedDate": "2020-05-18T06:55:54Z", "message": "Merge branch 'master' into cdc-fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dafdb7c8c76c887a2fe1d0a99bc9648d771e0ce2", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/dafdb7c8c76c887a2fe1d0a99bc9648d771e0ce2", "committedDate": "2020-05-18T07:40:39Z", "message": "Re-add dependency exclusion from master"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecb771581dff407afb78761b76f47006964c1cf1", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/ecb771581dff407afb78761b76f47006964c1cf1", "committedDate": "2020-05-18T07:53:06Z", "message": "Proper fix for licenses"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNTM5ODM2", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2248#pullrequestreview-413539836", "createdAt": "2020-05-18T12:21:10Z", "commit": {"oid": "ecb771581dff407afb78761b76f47006964c1cf1"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxMjoyMToxMFrOGW0ofw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxMjo0OTowM1rOGW1nTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU4NDE5MQ==", "bodyText": "should call this file ClassHeaderApache.txt perhaps", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2248#discussion_r426584191", "createdAt": "2020-05-18T12:21:10Z", "author": {"login": "cangencer"}, "path": "extensions/cdc-debezium/pom.xml", "diffHunk": "@@ -34,12 +34,22 @@\n \n     <properties>\n         <debezium.version>1.1.0.Final</debezium.version>\n-        <jackson.jr.version>2.11.0</jackson.jr.version>\n         <kafka.connect.version>2.3.1</kafka.connect.version>\n         <testcontainers.version>1.13.0</testcontainers.version>\n         <log4j2.slf4j.binding.version>2.13.2</log4j2.slf4j.binding.version>\n+\n+        <!-- needed for CheckStyle -->\n+        <checkstyle.headerLocation>${maven.multiModuleProjectDirectory}/checkstyle/ClassHeader.txt</checkstyle.headerLocation>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecb771581dff407afb78761b76f47006964c1cf1"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU5MjM4NA==", "bodyText": "this method can be inlined into the serializer", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2248#discussion_r426592384", "createdAt": "2020-05-18T12:35:43Z", "author": {"login": "cangencer"}, "path": "extensions/cdc-debezium/src/main/java/com/hazelcast/jet/cdc/impl/ChangeRecordImpl.java", "diffHunk": "@@ -102,26 +98,15 @@ public String toString() {\n         return toJson();\n     }\n \n-    @Override\n-    public int getFactoryId() {\n-        return CdcJsonDataSerializerHook.FACTORY_ID;\n-    }\n-\n-    @Override\n-    public int getClassId() {\n-        return CdcJsonDataSerializerHook.CHANGE_RECORD;\n-    }\n-\n-    @Override\n-    public void writeData(ObjectDataOutput out) throws IOException {\n+    void writeData(ObjectDataOutput out) throws IOException {\n         out.writeUTF(keyJson);\n         out.writeUTF(valueJson);\n     }\n \n-    @Override\n-    public void readData(ObjectDataInput in) throws IOException {\n-        keyJson = in.readUTF();\n-        valueJson = in.readUTF();\n+    static ChangeRecordImpl readData(ObjectDataInput in) throws IOException {\n+        String keyJson = in.readUTF();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecb771581dff407afb78761b76f47006964c1cf1"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU5MjU4Ng==", "bodyText": "it would be better to inline the serialization methods if you're using StreamSerializer", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2248#discussion_r426592586", "createdAt": "2020-05-18T12:36:05Z", "author": {"login": "cangencer"}, "path": "extensions/cdc-debezium/src/main/java/com/hazelcast/jet/cdc/impl/CdcSource.java", "diffHunk": "@@ -234,26 +233,16 @@ public void setOffset(Map<String, ?> partition, Map<String, ?> offset) {\n             partitionsToOffset.put(partition, offset);\n         }\n \n-        @Override\n-        public int getFactoryId() {\n-            return CdcJsonDataSerializerHook.FACTORY_ID;\n-        }\n-\n-        @Override\n-        public int getClassId() {\n-            return CdcJsonDataSerializerHook.SOURCE_STATE;\n-        }\n-\n-        @Override\n-        public void writeData(ObjectDataOutput out) throws IOException {\n+        void writeData(ObjectDataOutput out) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecb771581dff407afb78761b76f47006964c1cf1"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU5NjYzNw==", "bodyText": "again can be inlined", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2248#discussion_r426596637", "createdAt": "2020-05-18T12:43:05Z", "author": {"login": "cangencer"}, "path": "extensions/cdc-debezium/src/main/java/com/hazelcast/jet/cdc/impl/RecordPartImpl.java", "diffHunk": "@@ -77,23 +79,13 @@ public String toString() {\n         return toJson();\n     }\n \n-    @Override\n-    public int getFactoryId() {\n-        return CdcJsonDataSerializerHook.FACTORY_ID;\n-    }\n-\n-    @Override\n-    public int getClassId() {\n-        return CdcJsonDataSerializerHook.RECORD_PART;\n-    }\n-\n-    @Override\n-    public void writeData(ObjectDataOutput out) throws IOException {\n+    void writeData(ObjectDataOutput out) throws IOException {\n         out.writeUTF(json);\n     }\n \n-    @Override\n-    public void readData(ObjectDataInput in) throws IOException {\n-        json = in.readUTF();\n+    static RecordPartImpl readData(ObjectDataInput in) throws IOException {\n+        String json = in.readUTF();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecb771581dff407afb78761b76f47006964c1cf1"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjU5ODMzNA==", "bodyText": "too much duplication with UpdateMapP", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2248#discussion_r426598334", "createdAt": "2020-05-18T12:45:58Z", "author": {"login": "cangencer"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/connector/UpdateMapWithMaterializedValuesP.java", "diffHunk": "@@ -0,0 +1,217 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.impl.connector;\n+\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.function.FunctionEx;\n+import com.hazelcast.internal.serialization.SerializationService;\n+import com.hazelcast.jet.core.Inbox;\n+import com.hazelcast.jet.core.JetDataSerializerHook;\n+import com.hazelcast.jet.core.Outbox;\n+import com.hazelcast.jet.core.Processor;\n+import com.hazelcast.map.EntryProcessor;\n+import com.hazelcast.map.IMap;\n+import com.hazelcast.nio.ObjectDataInput;\n+import com.hazelcast.nio.ObjectDataOutput;\n+import com.hazelcast.nio.serialization.IdentifiedDataSerializable;\n+\n+import javax.annotation.CheckReturnValue;\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+public class UpdateMapWithMaterializedValuesP<T, K, V> extends AsyncHazelcastWriterP {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecb771581dff407afb78761b76f47006964c1cf1"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYwMDI2OQ==", "bodyText": "would be better to call this PartitionService, and then you can initialize it in init() automatically and allow it to be used from subclasses automatically.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2248#discussion_r426600269", "createdAt": "2020-05-18T12:49:03Z", "author": {"login": "cangencer"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/connector/AsyncHazelcastWriterP.java", "diffHunk": "@@ -158,4 +164,32 @@ private boolean asyncCallsDone() {\n         checkError();\n         return allWritten;\n     }\n+\n+    static class PartitionInfo {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ecb771581dff407afb78761b76f47006964c1cf1"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e826cc53ba19537cc6daf529887258139074c8ce", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/e826cc53ba19537cc6daf529887258139074c8ce", "committedDate": "2020-05-18T14:37:24Z", "message": "Inline some methods used for serialization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb6f9f81f8b67dd53d59f6980749ff5c1be3fe8e", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/fb6f9f81f8b67dd53d59f6980749ff5c1be3fe8e", "committedDate": "2020-05-19T05:55:34Z", "message": "Rename Apache license header file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f497ad9817cb0126691cec52ebb1ec51084eb55", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/5f497ad9817cb0126691cec52ebb1ec51084eb55", "committedDate": "2020-05-19T06:35:14Z", "message": "Merge branch 'master' into cdc-fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b49840fc7f61bf2e501d493a077943e3048c8084", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/b49840fc7f61bf2e501d493a077943e3048c8084", "committedDate": "2020-05-19T06:36:36Z", "message": "Adapt to latest changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb1ddb0f7aaa5619c0f705aba0531894173991de", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/cb1ddb0f7aaa5619c0f705aba0531894173991de", "committedDate": "2020-05-19T07:52:08Z", "message": "Move CdcSinks to another PR"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NDE0NTU5", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2248#pullrequestreview-414414559", "createdAt": "2020-05-19T12:54:58Z", "commit": {"oid": "cb1ddb0f7aaa5619c0f705aba0531894173991de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3784, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}