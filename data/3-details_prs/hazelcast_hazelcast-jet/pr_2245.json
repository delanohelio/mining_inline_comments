{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1OTIxMDY3", "number": 2245, "title": "Improve gRPC module", "bodyText": "Changes:\n\ncreate channel per processor\nmake service destroy timeout and channel shutdown timeout configurable\nUse common ForkJoinPool as executor for the channel\n\nChecklist\n\n Tags Set\n Milestone Set", "createdAt": "2020-05-11T07:30:53Z", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245", "merged": true, "mergeCommit": {"oid": "c62593cd38bdcd1f24c905afe997094dbfdbddd2"}, "closed": true, "closedAt": "2020-05-20T10:21:14Z", "author": {"login": "frant-hartm"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceSel7gH2gAyNDE1OTIxMDY3OmY5YjUyYzZjNGNmOGFhOTc3YTc3NWU0YmFhZGVmOTEzYzM0NDMwNDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjGYZzgFqTQxNTE5Mjk2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f9b52c6c4cf8aa977a775e4baadef913c3443043", "author": {"user": {"login": "frant-hartm", "name": "Franti\u0161ek Hartman"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/f9b52c6c4cf8aa977a775e4baadef913c3443043", "committedDate": "2020-05-05T11:35:31Z", "message": "Create channel per processor, add timeout settings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7225ac893596c367719854b8680da1eb649ea1e6", "author": {"user": {"login": "frant-hartm", "name": "Franti\u0161ek Hartman"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/7225ac893596c367719854b8680da1eb649ea1e6", "committedDate": "2020-05-05T11:43:54Z", "message": "Use common ForkJoinPool as channel executor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bc94b697a065367dd2955a730bccdb8ab4018ac", "author": {"user": {"login": "frant-hartm", "name": "Franti\u0161ek Hartman"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/9bc94b697a065367dd2955a730bccdb8ab4018ac", "committedDate": "2020-05-05T11:43:59Z", "message": "Fix javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d", "author": {"user": {"login": "frant-hartm", "name": "Franti\u0161ek Hartman"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/6ba29ad5ce8a9337cf478164490ee68eca973c6d", "committedDate": "2020-05-11T06:51:59Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwODUyMjI2", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#pullrequestreview-410852226", "createdAt": "2020-05-13T12:00:43Z", "commit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMjowMDo0M1rOGUuMQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMjowMDo0M1rOGUuMQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDM4MTUwNQ==", "bodyText": "maybe we should point the user to where you can learn more about these proeprties?", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#discussion_r424381505", "createdAt": "2020-05-13T12:00:43Z", "author": {"login": "cangencer"}, "path": "site/docs/how-tos/grpc.md", "diffHunk": "@@ -246,6 +246,15 @@ stage.mapUsingServiceAsyncBatched(bidiService,\n })\n ```\n \n+If your batch takes close to or more than 1 s (including the network\n+overhead) you should increase the value for following properties to\n+perform clean shutdown:\n+\n+```\n+jet.grpc.destroy.timeout", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwODUyNDMw", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#pullrequestreview-410852430", "createdAt": "2020-05-13T12:01:01Z", "commit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMjowMTowMVrOGUuM7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMjowMTowMVrOGUuM7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDM4MTY3OQ==", "bodyText": "missing @since, you can include here and drop the rest on the same file.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#discussion_r424381679", "createdAt": "2020-05-13T12:01:01Z", "author": {"login": "cangencer"}, "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/impl/GrpcProperties.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright 2020 Hazelcast Inc.\n+ *\n+ * Licensed under the Hazelcast Community License (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://hazelcast.com/hazelcast-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.grpc.impl;\n+\n+import com.hazelcast.spi.properties.HazelcastProperty;\n+import io.grpc.stub.StreamObserver;\n+\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+\n+/**\n+ * Properties of the grpc module\n+ */\n+public final class GrpcProperties {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwODU2Njk1", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#pullrequestreview-410856695", "createdAt": "2020-05-13T12:07:45Z", "commit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MzY5Nzky", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#pullrequestreview-414369792", "createdAt": "2020-05-19T11:56:02Z", "commit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMTo1NjowMlrOGXc5CA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMjowNTowNlrOGXdMdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0Mzc4NA==", "bodyText": "Better add seconds to the name. That way when you see the system property somewhere, you'll know the time unit.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#discussion_r427243784", "createdAt": "2020-05-19T11:56:02Z", "author": {"login": "mtopolnik"}, "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/impl/GrpcProperties.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright 2020 Hazelcast Inc.\n+ *\n+ * Licensed under the Hazelcast Community License (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://hazelcast.com/hazelcast-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.grpc.impl;\n+\n+import com.hazelcast.spi.properties.HazelcastProperty;\n+import io.grpc.stub.StreamObserver;\n+\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+\n+/**\n+ * Properties of the grpc module\n+ */\n+public final class GrpcProperties {\n+\n+    /**\n+     * Time to wait for {@link StreamObserver#onCompleted()} confirmation when destroying a\n+     * {@link BidirectionalStreamingService}\n+     * You may want to increase this value when your gRPC calls take longer than 1 s to cleanly shutdown the service.\n+     * <p>\n+     * The default value is 1 s\n+     *\n+     * @since 4.2\n+     */\n+    public static final HazelcastProperty DESTROY_TIMEOUT\n+            = new HazelcastProperty(\"jet.grpc.destroy.timeout\", 1, SECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0NTM4OA==", "bodyText": "Add the timeout to the log statement, as well as instruction on how to set it (system property name).", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#discussion_r427245388", "createdAt": "2020-05-19T11:59:00Z", "author": {"login": "mtopolnik"}, "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/impl/GrpcUtil.java", "diffHunk": "@@ -52,8 +52,8 @@ public static Throwable translateGrpcException(Throwable exception) {\n      * Tries orderly shutdown first {@link ManagedChannel#shutdown()}, then forceful shutdown\n      * {@link ManagedChannel#shutdownNow()}.\n      */\n-    public static void shutdownChannel(ManagedChannel channel, ILogger logger) throws InterruptedException {\n-        if (!channel.shutdown().awaitTermination(1, SECONDS)) {\n+    public static void shutdownChannel(ManagedChannel channel, ILogger logger, long timeout) throws InterruptedException {\n+        if (!channel.shutdown().awaitTermination(timeout, SECONDS)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0Njk0NQ==", "bodyText": "Javadoc has a grammar error: \"Shutdowns\". Should be Shuts down {@link ManagedChannel}.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#discussion_r427246945", "createdAt": "2020-05-19T12:01:57Z", "author": {"login": "mtopolnik"}, "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/impl/GrpcUtil.java", "diffHunk": "@@ -52,8 +52,8 @@ public static Throwable translateGrpcException(Throwable exception) {\n      * Tries orderly shutdown first {@link ManagedChannel#shutdown()}, then forceful shutdown\n      * {@link ManagedChannel#shutdownNow()}.\n      */\n-    public static void shutdownChannel(ManagedChannel channel, ILogger logger) throws InterruptedException {\n-        if (!channel.shutdown().awaitTermination(1, SECONDS)) {\n+    public static void shutdownChannel(ManagedChannel channel, ILogger logger, long timeout) throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0ODc1OA==", "bodyText": "\"If your batch takes more than ~0.8 seconds (including the network overhead), you should increase the value of the following properties so that the clean shutdown succeeds\"", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#discussion_r427248758", "createdAt": "2020-05-19T12:05:06Z", "author": {"login": "mtopolnik"}, "path": "site/docs/how-tos/grpc.md", "diffHunk": "@@ -246,6 +246,15 @@ stage.mapUsingServiceAsyncBatched(bidiService,\n })\n ```\n \n+If your batch takes close to or more than 1 s (including the network", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c06db67e9159c16fcd78d56ea7a35d2b4288f7e8", "author": {"user": {"login": "frant-hartm", "name": "Franti\u0161ek Hartman"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/c06db67e9159c16fcd78d56ea7a35d2b4288f7e8", "committedDate": "2020-05-19T13:07:33Z", "message": "Address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MTkyOTYz", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#pullrequestreview-415192963", "createdAt": "2020-05-20T10:19:31Z", "commit": {"oid": "c06db67e9159c16fcd78d56ea7a35d2b4288f7e8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3777, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}