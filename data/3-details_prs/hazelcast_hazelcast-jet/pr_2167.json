{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMzU1NDY3", "number": 2167, "title": "Shutdown gRPC channels cleanly", "bodyText": "Several fixes\n\nclosing channels doesn't happen imediatelly - added awatTermination\nServer stored in local variable not shutdown at end of test\nonCompleted should call onCompleted on responseObserver\n\nChecklist\n\n Tags Set\n Milestone Set", "createdAt": "2020-04-14T18:51:49Z", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2167", "merged": true, "mergeCommit": {"oid": "71d7fb4f14cd16517792ce9af4728571c79ae988"}, "closed": true, "closedAt": "2020-04-15T12:12:16Z", "author": {"login": "frant-hartm"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXoFquAH2gAyNDAzMzU1NDY3OmQ3OTFhYWI5NzI2ZThjOTRjOTQyNTI5ZTM4NWUyNTA1OTE3MzUxMGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX1ne1AFqTM5MzY1MjUwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d791aab9726e8c94c942529e385e25059173510c", "author": {"user": {"login": "frant-hartm", "name": "Franti\u0161ek Hartman"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/d791aab9726e8c94c942529e385e25059173510c", "committedDate": "2020-04-14T18:48:44Z", "message": "Shutdown gRPC channels cleanly\n\nSeveral fixes\n- closing channels doesn't happen imediatelly - added awatTermination\n- Server stored in local variable not shutdown at end of test\n- onCompleted should call onCompleted on responseObserver"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNDc2NDYz", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2167#pullrequestreview-393476463", "createdAt": "2020-04-15T06:02:02Z", "commit": {"oid": "d791aab9726e8c94c942529e385e25059173510c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNjowMjowMlrOGFq7EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNjowMjowMlrOGFq7EA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU5OTMxMg==", "bodyText": "what happens if times out 5 seconds?", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2167#discussion_r408599312", "createdAt": "2020-04-15T06:02:02Z", "author": {"login": "cangencer"}, "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/GrpcServices.java", "diffHunk": "@@ -107,7 +108,7 @@ private GrpcServices() {\n                 .withCreateContextFn(ctx -> channelFn.get().build())\n                 .withCreateServiceFn((ctx, channel) -> new UnaryService<>(channel, callStubFn))\n                 .withDestroyServiceFn(UnaryService::destroy)\n-                .withDestroyContextFn(ManagedChannel::shutdown);\n+                .withDestroyContextFn(channel -> channel.shutdown().awaitTermination(5, TimeUnit.SECONDS));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d791aab9726e8c94c942529e385e25059173510c"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc58ee4611892e013f7e2f6b102a983fbc18a44a", "author": {"user": {"login": "frant-hartm", "name": "Franti\u0161ek Hartman"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/bc58ee4611892e013f7e2f6b102a983fbc18a44a", "committedDate": "2020-04-15T07:57:26Z", "message": "Add forceful shutdown when normal shutdown doesn't terminate.\nExtract shutdown to GrpcUtil."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTkxODUy", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2167#pullrequestreview-393591852", "createdAt": "2020-04-15T09:08:58Z", "commit": {"oid": "bc58ee4611892e013f7e2f6b102a983fbc18a44a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOTowODo1OFrOGFwtTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwOTowODo1OFrOGFwtTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY5NDA5Mg==", "bodyText": "it would be better to use the logger from ctx, you can do this by making createContextFn return tuple2(channel, logger) , kind of ugly, but it should be fine.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2167#discussion_r408694092", "createdAt": "2020-04-15T09:08:58Z", "author": {"login": "cangencer"}, "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/GrpcServices.java", "diffHunk": "@@ -107,7 +112,7 @@ private GrpcServices() {\n                 .withCreateContextFn(ctx -> channelFn.get().build())\n                 .withCreateServiceFn((ctx, channel) -> new UnaryService<>(channel, callStubFn))\n                 .withDestroyServiceFn(UnaryService::destroy)\n-                .withDestroyContextFn(ManagedChannel::shutdown);\n+                .withDestroyContextFn(channel -> GrpcUtil.shutdownChannel(channel, logger));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc58ee4611892e013f7e2f6b102a983fbc18a44a"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0112a7bd4bfe9b93024d627d8b4ecd19f0bc10a", "author": {"user": {"login": "frant-hartm", "name": "Franti\u0161ek Hartman"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/c0112a7bd4bfe9b93024d627d8b4ecd19f0bc10a", "committedDate": "2020-04-15T09:20:17Z", "message": "Add logger to context"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjUyNTA1", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2167#pullrequestreview-393652505", "createdAt": "2020-04-15T10:34:26Z", "commit": {"oid": "c0112a7bd4bfe9b93024d627d8b4ecd19f0bc10a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2791, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}