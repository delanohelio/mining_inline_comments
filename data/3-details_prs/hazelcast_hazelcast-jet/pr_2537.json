{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMjAzNzAw", "number": 2537, "title": "Fix MySql related intermittent network test failures (issue #2534)", "bodyText": "Issue is caused by some kind of cleanup problem, affecting the Ryuk resource reapers. This resource manager is not mandatory, tests already do manual container management, so will disable it. Hopefully the reduced complexity will get rid of the clean-up issues experienced.\nFixes #2534", "createdAt": "2020-09-21T10:45:33Z", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2537", "merged": true, "mergeCommit": {"oid": "617dd19f1f222c32ffd9f3e541034643adb99134"}, "closed": true, "closedAt": "2020-09-23T10:11:15Z", "author": {"login": "jbartok"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLA99sgH2gAyNDkwMjAzNzAwOjAzMTljNmZkMGUyYzJmYmI4ZTE3ZTNhZmI5MDE3NjZjZTJhZjcxOTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLozxMgFqTQ5NDQ1MDE2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0319c6fd0e2c2fbb8e17e3afb901766ce2af7199", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/0319c6fd0e2c2fbb8e17e3afb901766ce2af7199", "committedDate": "2020-09-21T10:38:05Z", "message": "Disable using Ryuk resource reaper"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0Mjg0MTk4", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2537#pullrequestreview-494284198", "createdAt": "2020-09-23T06:52:36Z", "commit": {"oid": "0319c6fd0e2c2fbb8e17e3afb901766ce2af7199"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNjo1MjozNlrOHWY2Gg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNjo1Njo0M1rOHWY-sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIzNzc4Ng==", "bodyText": "Could you add a comment explaining this? I have no idea why it is needed.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2537#discussion_r493237786", "createdAt": "2020-09-23T06:52:36Z", "author": {"login": "frant-hartm"}, "path": "extensions/cdc-mysql/src/test/java/com/hazelcast/jet/cdc/mysql/MySqlCdcNetworkIntegrationTest.java", "diffHunk": "@@ -93,6 +99,12 @@\n         });\n     }\n \n+    @Before\n+    public void before() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0319c6fd0e2c2fbb8e17e3afb901766ce2af7199"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIzOTk4NQ==", "bodyText": "Not related to this PR, but could it be made more deterministic by having a CountDownLatch, call await here and CountDownLatch#countDown in a first step of the pipeline (peek/map)?", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2537#discussion_r493239985", "createdAt": "2020-09-23T06:56:43Z", "author": {"login": "frant-hartm"}, "path": "extensions/cdc-mysql/src/test/java/com/hazelcast/jet/cdc/mysql/MySqlCdcNetworkIntegrationTest.java", "diffHunk": "@@ -139,31 +151,34 @@ public void when_networkDisconnectDuringSnapshotting_then_jetSourceIsStuckUntilR\n                 ToxiproxyContainer toxiproxy = initToxiproxy(network);\n         ) {\n             MySQLContainer<?> mysql = initMySql(network, null);\n-            ToxiproxyContainer.ContainerProxy proxy = initProxy(toxiproxy, mysql);\n-            Pipeline pipeline = initPipeline(proxy.getContainerIpAddress(), proxy.getProxyPort());\n-            // when job starts\n-            JetInstance jet = createJetMembers(2)[0];\n-            Job job = jet.newJob(pipeline);\n-            assertJobStatusEventually(job, RUNNING);\n+            try {\n+                ToxiproxyContainer.ContainerProxy proxy = initProxy(toxiproxy, mysql);\n+                Pipeline pipeline = initPipeline(proxy.getContainerIpAddress(), proxy.getProxyPort());\n+                // when job starts\n+                JetInstance jet = createJetMembers(2)[0];\n+                Job job = jet.newJob(pipeline);\n+                assertJobStatusEventually(job, RUNNING);\n \n-            // and snapshotting is ongoing (we have no exact way of identifying\n-            // the moment, but random sleep will catch it at least some of the time)\n-            TimeUnit.MILLISECONDS.sleep(ThreadLocalRandom.current().nextInt(0, 500));\n+                // and snapshotting is ongoing (we have no exact way of identifying\n+                // the moment, but random sleep will catch it at least some of the time)\n+                TimeUnit.MILLISECONDS.sleep(ThreadLocalRandom.current().nextInt(0, 500));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0319c6fd0e2c2fbb8e17e3afb901766ce2af7199"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0628bb6301001b5fc7230db8e363700eb78f3a81", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/0628bb6301001b5fc7230db8e363700eb78f3a81", "committedDate": "2020-09-23T07:25:26Z", "message": "Add comment to clarify intention"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NDEwODM1", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2537#pullrequestreview-494410835", "createdAt": "2020-09-23T08:15:56Z", "commit": {"oid": "0628bb6301001b5fc7230db8e363700eb78f3a81"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52a9d4993a25bd026f6617b6c95541d3873363c0", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/52a9d4993a25bd026f6617b6c95541d3873363c0", "committedDate": "2020-09-23T08:19:28Z", "message": "Merge branch 'master' into issue-2534"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1ee0451e8c676df7dd059a942d8177a22cfd33c", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/e1ee0451e8c676df7dd059a942d8177a22cfd33c", "committedDate": "2020-09-23T08:20:51Z", "message": "Add missing explanation to before method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NDE1ODQ3", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2537#pullrequestreview-494415847", "createdAt": "2020-09-23T08:22:05Z", "commit": {"oid": "e1ee0451e8c676df7dd059a942d8177a22cfd33c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f5752386c723b26692253850f9405daa298cd5c", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/6f5752386c723b26692253850f9405daa298cd5c", "committedDate": "2020-09-23T09:00:27Z", "message": "Exclude junit-dep from newly added dependency"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NDUwMTY5", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2537#pullrequestreview-494450169", "createdAt": "2020-09-23T09:03:09Z", "commit": {"oid": "6f5752386c723b26692253850f9405daa298cd5c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3619, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}