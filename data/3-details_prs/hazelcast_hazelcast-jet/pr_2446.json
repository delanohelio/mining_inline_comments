{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwNzEzMTQy", "number": 2446, "title": "Relocate pipeline.toDag() transformation", "bodyText": "This PR deprecates Pipeline.toDag() as public API. Jet used to call this method on the client side, whithin a JetInstance.newJob(Pipeline) call. After this change, the method is called on the server side and the client sends the pipeline to the server.\nFor this reason, Pipeline, Source, Sink and other components of the pipeline became Serializable.\nChecklist\n\n Tags Set\n Milestone Set\n Any breaking changes are documented\n\nList of breaking changes:\n\nPipeline API: Sources.streamFromProcessorWithWatermarks: type of metaSupplierFn changes from Function to FunctionEx\nCore API: StreamEventJournalP.streamRemoteMapSupplier and .streamRemoteCacheSupplier: the ClientConfig parameter changes type to String (XML representation of the config).", "createdAt": "2020-08-20T07:09:37Z", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446", "merged": true, "mergeCommit": {"oid": "2115dc70e1a518e405ddb05eeadb14910af6280c"}, "closed": true, "closedAt": "2020-09-08T11:09:30Z", "author": {"login": "ufukyilmaz"}, "timelineItems": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAqe7nAH2gAyNDcwNzEzMTQyOmJmMjA5ZDYwMDA4MDQ0MTk1ODhmYjI4ZThkNDZkMzc0MDJkODZlNzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdGht9hgH2gAyNDcwNzEzMTQyOmUxYzIwMjczODk4YmIxM2EyNGIwNzMxN2QwMjUzYzMyZjlmZmQ1MTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bf209d6000804419588fb28e8d46d37402d86e71", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/bf209d6000804419588fb28e8d46d37402d86e71", "committedDate": "2020-08-20T06:47:02Z", "message": "Remove the pipeline.toDag() call from the client side."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37d9dc382d3cb4a09ce4d5f0424fcd2fd3043b44", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/37d9dc382d3cb4a09ce4d5f0424fcd2fd3043b44", "committedDate": "2020-08-20T08:14:14Z", "message": "Fix checkstyle: Remove unused imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc57834bf221dc104bd899bbe867ea888e682e9d", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/cc57834bf221dc104bd899bbe867ea888e682e9d", "committedDate": "2020-08-20T08:36:51Z", "message": "Make Pipeline and associated classes serializable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e159045c5028b8766b6bc9bc6447b1130fceeb6", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/7e159045c5028b8766b6bc9bc6447b1130fceeb6", "committedDate": "2020-08-20T09:48:56Z", "message": "Update the methods to deserialize job definition and convert it to DAG if it's pipeline."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d496d500616e97077c0e8b78968bfd6997879be0", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/d496d500616e97077c0e8b78968bfd6997879be0", "committedDate": "2020-08-20T15:18:25Z", "message": "Remove an old, unused code."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67af6e3903cb197e735be65a521a7d42416add72", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/67af6e3903cb197e735be65a521a7d42416add72", "committedDate": "2020-08-20T15:23:05Z", "message": "Make some of the associated classes of PipelineImpl serializable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daa73c4f446c71b9c1749ddeae3f4ad1c56ca95f", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/daa73c4f446c71b9c1749ddeae3f4ad1c56ca95f", "committedDate": "2020-08-21T12:00:32Z", "message": "Make the source processors including ClientConfig serializable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "738f8e447427748b72374c375496c735bf374d54", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/738f8e447427748b72374c375496c735bf374d54", "committedDate": "2020-08-21T12:59:24Z", "message": "Remove the unnecessary usage of generic type."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efb2cb890be7d3219656796a63f3b4dd2a40572e", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/efb2cb890be7d3219656796a63f3b4dd2a40572e", "committedDate": "2020-08-24T09:47:23Z", "message": "Remove the duplicate code fragments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18d77e318e25a2d54479f7d1a1bdb3985bb2cde8", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/18d77e318e25a2d54479f7d1a1bdb3985bb2cde8", "committedDate": "2020-08-25T14:35:35Z", "message": "Try to determine the LPs of the transforms/vertices before the DAG creation is completed.\nAdd determineLocalParallelism() functions to the transforms."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a60b0a7dba971f64202b3aa096aaa1eda79df6e9", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/a60b0a7dba971f64202b3aa096aaa1eda79df6e9", "committedDate": "2020-08-26T06:30:53Z", "message": "Call determineLocalParallelism() for each transform in the DAG creation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9e2ed703c2c2732c72fb4b302973456aaa4b303", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/d9e2ed703c2c2732c72fb4b302973456aaa4b303", "committedDate": "2020-08-26T07:17:39Z", "message": "Fix checkstyle: trailing space."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a460ed5031ea30ea8861764ca4fc6e233d972e9", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/3a460ed5031ea30ea8861764ca4fc6e233d972e9", "committedDate": "2020-08-26T08:14:08Z", "message": "Remove the unused generic type."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c565ec0e7e00625220a95324e9376beb7babd6d3", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/c565ec0e7e00625220a95324e9376beb7babd6d3", "committedDate": "2020-09-01T11:07:01Z", "message": "Remove unnecessary Vertex.determineLocalParallelism() calls. Undo irrelevant formatting change."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10dde8dc766b607fe96055963d03fc8f783b3e6f", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/10dde8dc766b607fe96055963d03fc8f783b3e6f", "committedDate": "2020-09-01T11:41:56Z", "message": "Add missing determine LP function in TimestampTransform."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df8971525014c64cdd44bb4a6c73f29c8af43f53", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/df8971525014c64cdd44bb4a6c73f29c8af43f53", "committedDate": "2020-09-01T12:14:43Z", "message": "Revert to previous commit."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c304ebfa47570a65d2d10d11fbecdf54d71961be", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/c304ebfa47570a65d2d10d11fbecdf54d71961be", "committedDate": "2020-09-02T07:21:26Z", "message": "Add determineLocalParallelism methods to GroupTransform and HashJoinTransform."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwNzgyNDQ2", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#pullrequestreview-480782446", "createdAt": "2020-09-02T12:47:04Z", "commit": {"oid": "c304ebfa47570a65d2d10d11fbecdf54d71961be"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMjo0NzowNFrOHLtbTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMzoyOToxN1rOHLvJiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA0MDY1Mw==", "bodyText": "Maybe we can create a JobDefinition interface that will be internal. Will have no methods and can extend Serializable. Then make DAG and PipelineImpl implement it. It can be more readable this way.\nThen we can have newJobInt method that will do the above switching.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r482040653", "createdAt": "2020-09-02T12:47:04Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/AbstractJetInstance.java", "diffHunk": "@@ -80,16 +92,30 @@ public Job newJobIfAbsent(@Nonnull DAG dag, @Nonnull JobConfig config) {\n                         return job;\n                     }\n                 }\n-\n                 try {\n-                    return newJob(dag, config);\n+                    if (jobDefinition instanceof PipelineImpl) {\n+                        return newJob((PipelineImpl) jobDefinition, config);\n+                    } else {\n+                        return newJob((DAG) jobDefinition, config);\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c304ebfa47570a65d2d10d11fbecdf54d71961be"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA0NzEwNg==", "bodyText": "We never use these methods.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r482047106", "createdAt": "2020-09-02T12:57:09Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/pipeline/transform/Transform.java", "diffHunk": "@@ -56,6 +58,12 @@\n     @Nonnull\n     List<Transform> upstream();\n \n+    boolean isLocalParallelismDetermined();\n+\n+    void setLocalParallelismDetermined(boolean localParallelismDetermined);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c304ebfa47570a65d2d10d11fbecdf54d71961be"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA1MTI0MQ==", "bodyText": "The localParallelism parameter is always the localParallelism() method, we can remove this parameter.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r482051241", "createdAt": "2020-09-02T13:03:25Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/pipeline/transform/AbstractTransform.java", "diffHunk": "@@ -115,4 +131,31 @@ protected final boolean shouldRebalanceAnyInput() {\n         }\n         return false;\n     }\n+\n+    /**\n+     * Determines the local parallelism value for the transform by looking\n+     * its local parallelism, preferred local parallelism, and the default\n+     * local parallelism provided in Pipeline.Context object.\n+     * <p>\n+     * If none of them is set, returns the default local parallelism\n+     * provided in Pipeline.Context object.\n+     */\n+    protected void determineLocalParallelism(int localParallelism, int preferredLocalParallelism, Pipeline.Context ctx) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c304ebfa47570a65d2d10d11fbecdf54d71961be"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA1MTY4OQ==", "bodyText": "Do we need this as a public API?\nWe miss the @since tag here\nThe name Context suggests that there will be more methods in the future, but those methods will have to be default. Context object instances are normally provided by the environment, not by the user. Why don't we just use int defaultLocalParallelism argument?\nInstead of a new method we could maybe deprecate the toDag() method. It's not a supported way to use Jet.\nIf we don't provide this method, I think we can also remove the AbstractTransform.determineLocalParallelism, which is almost a clone of Vertex.determineLocalParallelism. We can keep just -1 for LP and the vertex will take care. But in this point maybe I missed something, I'm not sure.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r482051689", "createdAt": "2020-09-02T13:04:07Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/pipeline/Pipeline.java", "diffHunk": "@@ -99,9 +100,24 @@ static Pipeline create() {\n     @Nonnull\n     DAG toDag();\n \n+    /**\n+     * Transforms the pipeline into a Jet DAG, which can be submitted for\n+     * execution to a Jet instance.\n+     */\n+    @Nonnull\n+    DAG toDag(Context context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c304ebfa47570a65d2d10d11fbecdf54d71961be"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA2NDIzMg==", "bodyText": "We force the user to pass client XML as a string, but the conversion to string isn't public API. Also we change this overload of streamRemoteMapP, but not the other overload. I think we should stick with the original signature and convert to string for the user in the method body.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r482064232", "createdAt": "2020-09-02T13:22:50Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/processor/SourceProcessors.java", "diffHunk": "@@ -180,14 +182,14 @@ public static ProcessorSupplier readRemoteMapP(@Nonnull String mapName, @Nonnull\n     @Nonnull\n     public static <T, K, V> ProcessorMetaSupplier streamRemoteMapP(\n             @Nonnull String mapName,\n-            @Nonnull ClientConfig clientConfig,\n+            @Nonnull String clientXml,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c304ebfa47570a65d2d10d11fbecdf54d71961be"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA2ODg3Mg==", "bodyText": "Here we mutate the pipeline. The following code will have unexpected behavior.\nPipeline p = ...\nDAG dagWithLp1 = p.toDag(() -> 1);\nDAG dagWithLp2 = p.toDag(() -> 2);\nBoth DAGs will use LP=1 where default LP was used.\nI also don't see a reason why do we need this. Can't we have the vertices with LP=1 and rely on the logic in Vertex class?", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r482068872", "createdAt": "2020-09-02T13:29:17Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/pipeline/Planner.java", "diffHunk": "@@ -111,6 +113,11 @@ DAG createDag() {\n             }\n         }\n \n+        // determine exact local parallelism of the transforms\n+        for (Transform transform : adjacencyMap.keySet()) {\n+            transform.determineLocalParallelism(ctx);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c304ebfa47570a65d2d10d11fbecdf54d71961be"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e08a7091fe1ec52120ae65754ede8b1783cbd9cb", "author": {"user": {"login": "viliam-durina", "name": "Viliam Durina"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/e08a7091fe1ec52120ae65754ede8b1783cbd9cb", "committedDate": "2020-09-02T14:08:35Z", "message": "Fix grammar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e55ee212e2af3e1a9d846218b5cdace353709edd", "author": {"user": {"login": "viliam-durina", "name": "Viliam Durina"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/e55ee212e2af3e1a9d846218b5cdace353709edd", "committedDate": "2020-09-02T14:09:46Z", "message": "Reuse cluster in DetermineLocalParallelismTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27d799a7025700e524221770dacbd6910feec465", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/27d799a7025700e524221770dacbd6910feec465", "committedDate": "2020-09-03T07:20:05Z", "message": "Partially address the review comments:\n- Remove unused methods and unnecessary method parameters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3eccfdd62edf7d2ee7b89bb7f601f34f083af7ba", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/3eccfdd62edf7d2ee7b89bb7f601f34f083af7ba", "committedDate": "2020-09-03T07:29:30Z", "message": "Commit to demonstrate the serialization error when move the xml to string conversion to a lower level."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwODI0MjU1", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#pullrequestreview-480824255", "createdAt": "2020-09-02T13:34:18Z", "commit": {"oid": "c304ebfa47570a65d2d10d11fbecdf54d71961be"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMzozNDoxOVrOHLvX4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMzozNjo0M1rOHLveeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA3MjU0NQ==", "bodyText": "This doesn't need to be serializable.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r482072545", "createdAt": "2020-09-02T13:34:19Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/pipeline/SourceBuilder.java", "diffHunk": "@@ -68,7 +69,7 @@\n      *\n      * @param <T> type of the emitted item\n      */\n-    public interface SourceBuffer<T> {\n+    public interface SourceBuffer<T> extends Serializable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c304ebfa47570a65d2d10d11fbecdf54d71961be"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA3NDIzNA==", "bodyText": "This is a breaking change. But I'm not sure if we can do anything about it. We at least need to document it.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r482074234", "createdAt": "2020-09-02T13:36:43Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/pipeline/Sources.java", "diffHunk": "@@ -128,7 +128,7 @@ private Sources() {\n     public static <T> StreamSource<T> streamFromProcessorWithWatermarks(\n             @Nonnull String sourceName,\n             boolean supportsNativeTimestamps,\n-            @Nonnull Function<EventTimePolicy<? super T>, ProcessorMetaSupplier> metaSupplierFn\n+            @Nonnull FunctionEx<EventTimePolicy<? super T>, ProcessorMetaSupplier> metaSupplierFn", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c304ebfa47570a65d2d10d11fbecdf54d71961be"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a149339753a80dff802e9b017b071e7417ea760", "author": {"user": {"login": "viliam-durina", "name": "Viliam Durina"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/5a149339753a80dff802e9b017b071e7417ea760", "committedDate": "2020-09-03T08:46:40Z", "message": "Fix ClientConfig serialization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae62c5dc61ee3172d890c2ca2b2e858f1ec6e522", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/ae62c5dc61ee3172d890c2ca2b2e858f1ec6e522", "committedDate": "2020-09-03T14:32:54Z", "message": "Address the review comments:\n- Define a new interface JobDefinition and make AbstractJetInstance more readable.\n- Remove the DAG(Context ctx) from external API.\n- Small fixes such as unnecessarily serializable interface etc."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adc47fbf7a47b1f51ecd2bf3b4575cdcd66d98a2", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/adc47fbf7a47b1f51ecd2bf3b4575cdcd66d98a2", "committedDate": "2020-09-03T14:37:05Z", "message": "Add JobDefinition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d11250c4f3e7bcc35acc86f8e8ceeeb2b4fed59", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/5d11250c4f3e7bcc35acc86f8e8ceeeb2b4fed59", "committedDate": "2020-09-04T06:52:59Z", "message": "- Remove determineLocalParallelism method from transforms. Just revert it.\n- Pass context to addToDag method of transforms."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7dcd10cb17d6934f0fa9363ad8a336d746af3d2", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/c7dcd10cb17d6934f0fa9363ad8a336d746af3d2", "committedDate": "2020-09-04T07:27:01Z", "message": "Add missing class def."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dcf20d44cf259f811e5a85bca93f56a09e105fc", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/7dcf20d44cf259f811e5a85bca93f56a09e105fc", "committedDate": "2020-09-04T08:50:27Z", "message": "Remove the context passing logic in the Planner."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1935247c17d35a7c1d5219c96961739e48d34e83", "author": {"user": {"login": "viliam-durina", "name": "Viliam Durina"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/1935247c17d35a7c1d5219c96961739e48d34e83", "committedDate": "2020-09-07T09:54:57Z", "message": "Don't capture JmsSourceBuilder in lambdas"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b238469f99c075bed383d8b012751a111cfe8a2a", "author": {"user": {"login": "viliam-durina", "name": "Viliam Durina"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/b238469f99c075bed383d8b012751a111cfe8a2a", "committedDate": "2020-09-07T09:55:30Z", "message": "Improve wording"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26ca0a62944f11b860062ecc1a7dac940a18dd21", "author": {"user": {"login": "viliam-durina", "name": "Viliam Durina"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/26ca0a62944f11b860062ecc1a7dac940a18dd21", "committedDate": "2020-09-07T10:20:52Z", "message": "Remove Serializable from SourceBuilder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMzQzNzIz", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#pullrequestreview-483343723", "createdAt": "2020-09-07T08:12:28Z", "commit": {"oid": "7dcf20d44cf259f811e5a85bca93f56a09e105fc"}, "state": "APPROVED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwODoxMjoyOVrOHN1Kxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwOTo0NToyNFrOHN4jGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI2NDY0Nw==", "bodyText": "We should mark the toDag() method as deprecated. It will be supported only for bw-compatibility and users should not use it. If they have a pipeline, they should submit a pipeline.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r484264647", "createdAt": "2020-09-07T08:12:29Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/pipeline/Pipeline.java", "diffHunk": "@@ -42,7 +43,7 @@\n  *\n  * @since 3.0\n  */\n-public interface Pipeline {\n+public interface Pipeline extends Serializable {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dcf20d44cf259f811e5a85bca93f56a09e105fc"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI3MjA2MQ==", "bodyText": "We should use the terms MUST, SHOULD or MAY according to the documentation standards, see https://tools.ietf.org/html/rfc2119. Here we should use MUST.\nBut it's not strictly correct here. Every instance of FunctionEx is Serializable and in 4.3 we're changing the required type. Maybe it would be better to say:\n\"Since version Jet 4.3 this argument changed from Function to FunctionEx to support serializability.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r484272061", "createdAt": "2020-09-07T08:25:18Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/pipeline/Sources.java", "diffHunk": "@@ -120,15 +120,17 @@ private Sources() {\n      * If you are implementing a custom source processor, be sure to check out\n      * the {@link EventTimeMapper} class that will help you correctly implement\n      * watermark emission.\n-     *  @param sourceName user-friendly source name\n+     *\n+     * @param sourceName user-friendly source name\n      * @param supportsNativeTimestamps true, if the processor is able to work\n-     * @param metaSupplierFn factory of processor meta-suppliers\n+     * @param metaSupplierFn factory of processor meta-suppliers. Since version\n+     *                      4.3 this function should be Serializable.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dcf20d44cf259f811e5a85bca93f56a09e105fc"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMxODU5Mw==", "bodyText": "Use JobDefinition", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r484318593", "createdAt": "2020-09-07T09:43:00Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/AbstractJobProxy.java", "diffHunk": "@@ -70,13 +69,13 @@\n         this.logger = loggingService().getLogger(Job.class);\n     }\n \n-    AbstractJobProxy(T container, long jobId, DAG dag, JobConfig config) {\n+    AbstractJobProxy(T container, long jobId, Object jobDefinition, JobConfig config) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dcf20d44cf259f811e5a85bca93f56a09e105fc"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMxODc5Mg==", "bodyText": "Use JobDefinition", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r484318792", "createdAt": "2020-09-07T09:43:22Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/ClientJobProxy.java", "diffHunk": "@@ -63,8 +62,8 @@\n         super(client, jobId);\n     }\n \n-    ClientJobProxy(JetClientInstanceImpl client, long jobId, DAG dag, JobConfig config) {\n-        super(client, jobId, dag, config);\n+    ClientJobProxy(JetClientInstanceImpl client, long jobId, Object jobDefinition, JobConfig config) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dcf20d44cf259f811e5a85bca93f56a09e105fc"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMxODkyOQ==", "bodyText": "Use JobDefinition", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r484318929", "createdAt": "2020-09-07T09:43:37Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/JetBootstrap.java", "diffHunk": "@@ -341,8 +341,8 @@ public Job newJobProxy(long jobId) {\n         }\n \n         @Override\n-        public Job newJobProxy(long jobId, DAG dag, JobConfig config) {\n-            return instance.newJobProxy(jobId, dag, config);\n+        public Job newJobProxy(long jobId, Object jobDefinition, JobConfig config) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dcf20d44cf259f811e5a85bca93f56a09e105fc"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMxOTE2NQ==", "bodyText": "Use JobDefinition", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r484319165", "createdAt": "2020-09-07T09:44:01Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/JetClientInstanceImpl.java", "diffHunk": "@@ -108,8 +107,8 @@ public boolean existsDistributedObject(@Nonnull String serviceName, @Nonnull Str\n     }\n \n     @Override\n-    public Job newJobProxy(long jobId, DAG dag, JobConfig config) {\n-        return new ClientJobProxy(this, jobId, dag, config);\n+    public Job newJobProxy(long jobId, Object jobDefinition, JobConfig config) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dcf20d44cf259f811e5a85bca93f56a09e105fc"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMxOTIyMA==", "bodyText": "Use JobDefinition", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r484319220", "createdAt": "2020-09-07T09:44:06Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/JetInstanceImpl.java", "diffHunk": "@@ -126,8 +125,8 @@ public Job newJobProxy(long jobId) {\n     }\n \n     @Override\n-    public Job newJobProxy(long jobId, DAG dag, JobConfig config) {\n-        return new JobProxy((NodeEngineImpl) nodeEngine, jobId, dag, config);\n+    public Job newJobProxy(long jobId, Object jobDefinition, JobConfig config) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dcf20d44cf259f811e5a85bca93f56a09e105fc"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMyMDAyNA==", "bodyText": "Use JobDefinition", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2446#discussion_r484320024", "createdAt": "2020-09-07T09:45:24Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/JobProxy.java", "diffHunk": "@@ -58,8 +57,8 @@ public JobProxy(NodeEngineImpl nodeEngine, long jobId) {\n         super(nodeEngine, jobId);\n     }\n \n-    public JobProxy(NodeEngineImpl engine, long jobId, DAG dag, JobConfig config) {\n-        super(engine, jobId, dag, config);\n+    public JobProxy(NodeEngineImpl engine, long jobId, Object jobDefinition, JobConfig config) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7dcf20d44cf259f811e5a85bca93f56a09e105fc"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f44ab960c74e46f4f83502a8891bff3d1249e388", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/f44ab960c74e46f4f83502a8891bff3d1249e388", "committedDate": "2020-09-07T10:51:54Z", "message": "Address the review comments:\n- Move \"JobDefinition\" to internal package\n- Deprecate toDag() method."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "157ab622da2be3f784b804e82c4b057f2d56d737", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/157ab622da2be3f784b804e82c4b057f2d56d737", "committedDate": "2020-09-07T11:03:50Z", "message": "Address the review comments:\n- Add missing JobDefinition declarations.\n- Improve the documentation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86956609f445e6edc9e18cdb5f5723473af86098", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/86956609f445e6edc9e18cdb5f5723473af86098", "committedDate": "2020-09-07T11:12:34Z", "message": "Merge remote-tracking branch 'upstream/master' into relocate-dag-transform"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1c20273898bb13a24b07317d0253c32f9ffd511", "author": {"user": {"login": "ufukyilmaz", "name": null}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/e1c20273898bb13a24b07317d0253c32f9ffd511", "committedDate": "2020-09-07T11:57:51Z", "message": "Remove JobDefinition interface."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3584, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}