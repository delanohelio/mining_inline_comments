{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0OTM3OTM2", "number": 1865, "title": "Add a type check for the initilized object by ManagedContext", "bodyText": "The initialized object can have a different type than the original object passed to the ManagedContext. We check and throw exception if so.\nChecklist\n\n Tags Set\n Milestone Set\n[NA] Any breaking changes are documented\n[NA] New public APIs have @Nonnull/@Nullable annotations\n[NA] New public APIs have @since tags in Javadoc\n[NA] For code samples, code sample main readme is updated", "createdAt": "2020-01-20T17:22:51Z", "url": "https://github.com/hazelcast/hazelcast-jet/pull/1865", "merged": true, "mergeCommit": {"oid": "2caad25254c25c017e760f1dad01afb2b9cc54f4"}, "closed": true, "closedAt": "2020-01-21T13:30:06Z", "author": {"login": "gurbuzali"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8PyW_AH2gAyMzY0OTM3OTM2OjY3ODE2YzgyNTQwODIxZGU5N2JjZTMzZTQ1ZTA0NjczZTU1ZWZiNTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8gMf-AH2gAyMzY0OTM3OTM2OmUxZmI0NjU1ODRlMmYxNDExOTk5YWQ5MTdkNjBjNGIwNmQ0ZTcxZmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "67816c82540821de97bce33e45e04673e55efb58", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/67816c82540821de97bce33e45e04673e55efb58", "committedDate": "2020-01-20T17:13:58Z", "message": "add a type check for the initilized object by ManagedContext"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1NDU0Nzk1", "url": "https://github.com/hazelcast/hazelcast-jet/pull/1865#pullrequestreview-345454795", "createdAt": "2020-01-20T17:29:45Z", "commit": {"oid": "67816c82540821de97bce33e45e04673e55efb58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxNzoyOTo0NVrOFflWIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxNzoyOTo0NVrOFflWIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODY2MjA0OQ==", "bodyText": "shouldn't use the Util method here too?", "url": "https://github.com/hazelcast/hazelcast-jet/pull/1865#discussion_r368662049", "createdAt": "2020-01-20T17:29:45Z", "author": {"login": "cangencer"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/ProcessorTasklet.java", "diffHunk": "@@ -197,10 +198,11 @@ private OutboxImpl createOutbox(@Nonnull OutboundCollector ssCollector) {\n \n     @Override\n     public void init() {\n-        if (serializationService.getManagedContext() != null) {\n+        ManagedContext managedContext = serializationService.getManagedContext();\n+        if (managedContext != null) {\n             Processor toInit = processor instanceof ProcessorWrapper\n                     ? ((ProcessorWrapper) processor).getWrapped() : processor;\n-            Object initialized = serializationService.getManagedContext().initialize(toInit);\n+            Object initialized = managedContext.initialize(toInit);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "67816c82540821de97bce33e45e04673e55efb58"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b96c251a9921eb0e0ce0bdfa3e2eb4f1e51ef235", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/b96c251a9921eb0e0ce0bdfa3e2eb4f1e51ef235", "committedDate": "2020-01-20T18:23:46Z", "message": "add null check to the initialized object"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d494365cd5d014a32f54fee4b405c7d4abe5787", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/4d494365cd5d014a32f54fee4b405c7d4abe5787", "committedDate": "2020-01-21T11:09:56Z", "message": "remove explicit class type checking, make ProcessorWrapper mutable to set the initialized object"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3ccce3595fb00a09a234a62f5e7735ccf7dcc0e", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/d3ccce3595fb00a09a234a62f5e7735ccf7dcc0e", "committedDate": "2020-01-21T11:18:55Z", "message": "fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1ODA1NTU4", "url": "https://github.com/hazelcast/hazelcast-jet/pull/1865#pullrequestreview-345805558", "createdAt": "2020-01-21T11:23:05Z", "commit": {"oid": "d3ccce3595fb00a09a234a62f5e7735ccf7dcc0e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMToyMzowNVrOFf2qEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQxMToyMzowNVrOFf2qEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODk0NTY4Mg==", "bodyText": "do we want to pass the cause here, just in case?", "url": "https://github.com/hazelcast/hazelcast-jet/pull/1865#discussion_r368945682", "createdAt": "2020-01-21T11:23:05Z", "author": {"login": "cangencer"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/ProcessorTasklet.java", "diffHunk": "@@ -197,11 +198,23 @@ private OutboxImpl createOutbox(@Nonnull OutboundCollector ssCollector) {\n \n     @Override\n     public void init() {\n-        if (serializationService.getManagedContext() != null) {\n+        ManagedContext managedContext = serializationService.getManagedContext();\n+        if (managedContext != null) {\n             Processor toInit = processor instanceof ProcessorWrapper\n                     ? ((ProcessorWrapper) processor).getWrapped() : processor;\n-            Object initialized = serializationService.getManagedContext().initialize(toInit);\n-            assert initialized == toInit : \"different object returned\";\n+            Object initialized = null;\n+            try {\n+                initialized = managedContext.initialize(toInit);\n+                toInit = (Processor) initialized;\n+            } catch (ClassCastException e) {\n+                throw new IllegalArgumentException(String.format(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3ccce3595fb00a09a234a62f5e7735ccf7dcc0e"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15b039bb4945822c7f2430a5b993fcffc50945cb", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/15b039bb4945822c7f2430a5b993fcffc50945cb", "committedDate": "2020-01-21T11:51:18Z", "message": "add more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1fb465584e2f1411999ad917d60c4b06d4e71fb", "author": {"user": null}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/e1fb465584e2f1411999ad917d60c4b06d4e71fb", "committedDate": "2020-01-21T12:21:00Z", "message": "checkstyle"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2926, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}