{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxNTMxNjI4", "number": 2082, "title": "Enable job-level serializer for IMDG Lists", "bodyText": "Allowed job-level serializers to be used with IMDG Lists.\nChecklist\n\n Tags Set\n Milestone Set", "createdAt": "2020-03-20T13:27:16Z", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2082", "merged": true, "mergeCommit": {"oid": "ae4f040364e64897a408404c3dcae644f949cbe4"}, "closed": true, "closedAt": "2020-03-30T13:09:05Z", "author": {"login": "gierlachg"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPgfcNgH2gAyMzkxNTMxNjI4OjAwNjA0ZDY0MzVkMzEzMWY1Mjk2NjZjNjllZTM3MmRmZmE3N2IxN2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSt1wnAH2gAyMzkxNTMxNjI4OjAzZjk0ZGRjODFlY2RkOGRlMzc5ZWJhZTFkNzA4MDBlMDY0NTEyYjc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "00604d6435d3131f529666c69ee372dffa77b17f", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/00604d6435d3131f529666c69ee372dffa77b17f", "committedDate": "2020-03-20T13:26:15Z", "message": "Enable job-level serializer for IMDG Lists"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b01d57a7cff488f762869a72bb5adcd1372f6b7", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/0b01d57a7cff488f762869a72bb5adcd1372f6b7", "committedDate": "2020-03-24T10:19:41Z", "message": "Merge branch 'master' into job_list\n\n# Conflicts:\n#\thazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/connector/HazelcastWriters.java\n#\thazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/connector/WriteMapP.java\n#\thazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/connector/WriteObservableP.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d037632636d7efc87fe039f4974e2325f89ff43", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/4d037632636d7efc87fe039f4974e2325f89ff43", "committedDate": "2020-03-25T07:19:26Z", "message": "Merge branch 'master' into job_list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd76257672d9d20da89c50268e87ec15f6d3d368", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/fd76257672d9d20da89c50268e87ec15f6d3d368", "committedDate": "2020-03-25T07:41:46Z", "message": "Add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d338e886f3f9208dc8372b713fb4102350d9a931", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/d338e886f3f9208dc8372b713fb4102350d9a931", "committedDate": "2020-03-26T14:16:01Z", "message": "Merge branch 'master' into job_list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79487b009f7e9679cee1f5d7b5ce4617a316a8ab", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/79487b009f7e9679cee1f5d7b5ce4617a316a8ab", "committedDate": "2020-03-26T14:53:01Z", "message": "Formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "834ef529e5865963ef3e835defb7faef1eced5bd", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/834ef529e5865963ef3e835defb7faef1eced5bd", "committedDate": "2020-03-26T15:54:45Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78719f6e0b306a44d6e0c15e310ff933b37f9304", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/78719f6e0b306a44d6e0c15e310ff933b37f9304", "committedDate": "2020-03-26T17:20:52Z", "message": "Fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f473b2a1d9d47ca32f7fd9be887a960c1397c996", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/f473b2a1d9d47ca32f7fd9be887a960c1397c996", "committedDate": "2020-03-26T17:22:03Z", "message": "Javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a07420aba42d0fcdad11b9149d15a252d05ff2e", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/0a07420aba42d0fcdad11b9149d15a252d05ff2e", "committedDate": "2020-03-26T17:53:27Z", "message": "Fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzODAxNTQ5", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2082#pullrequestreview-383801549", "createdAt": "2020-03-30T12:26:35Z", "commit": {"oid": "0a07420aba42d0fcdad11b9149d15a252d05ff2e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMjoyNjozNVrOF9nP0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMjoyNjozNVrOF9nP0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE1MDQ4MQ==", "bodyText": "did we really need both data iterator and sublist here? seems unnecessary. you can just get sublist(0, size) when size <= FETCH_SIZE", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2082#discussion_r400150481", "createdAt": "2020-03-30T12:26:35Z", "author": {"login": "cangencer"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/connector/ReadIListP.java", "diffHunk": "@@ -52,18 +64,40 @@ public boolean isCooperative() {\n     @Override\n     protected void init(@Nonnull Context context) {\n         HazelcastInstance instance;\n+        SerializationService serializationService;\n         if (isRemote()) {\n             instance = client = newHazelcastClient(asClientConfig(clientXml));\n+            serializationService = ((HazelcastClientProxy) instance).getSerializationService();\n         } else {\n             instance = context.jetInstance().getHazelcastInstance();\n+            serializationService = ((ProcCtx) context).serializationService();\n         }\n-        IList<Object> list = instance.getList(name);\n-        final int size = list.size();\n-        traverser = size <= FETCH_SIZE ?\n-                traverseIterable(list)\n-                :\n+        traverser = createTraverser(instance, name).map(serializationService::toObject);\n+    }\n+\n+    @SuppressWarnings(\"rawtypes\")\n+    private Traverser<Data> createTraverser(HazelcastInstance instance, String name) {\n+        IList<Data> list = instance.getList(name);\n+        int size = list.size();\n+\n+        if (list instanceof ClientListProxy) {\n+            ClientListProxy proxy = (ClientListProxy) list;\n+            return createTraverser(size, proxy::dataIterator, proxy::dataSubList);\n+        } else if (list instanceof ListProxyImpl) {\n+            ListProxyImpl proxy = (ListProxyImpl) list;\n+            return createTraverser(size, proxy::dataIterator, proxy::dataSubList);\n+        } else {\n+            throw new RuntimeException(\"Unexpected list class: \" + list.getClass().getName());\n+        }\n+    }\n+\n+    private Traverser<Data> createTraverser(int size,\n+                                            Supplier<Iterator<Data>> iteratorSupplier,\n+                                            BiFunction<Integer, Integer, List<Data>> subListSupplier) {\n+        return size <= FETCH_SIZE ?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a07420aba42d0fcdad11b9149d15a252d05ff2e"}, "originalPosition": 74}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzODAyMDE5", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2082#pullrequestreview-383802019", "createdAt": "2020-03-30T12:27:16Z", "commit": {"oid": "0a07420aba42d0fcdad11b9149d15a252d05ff2e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03f94ddc81ecdd8de379ebae1d70800e064512b7", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/03f94ddc81ecdd8de379ebae1d70800e064512b7", "committedDate": "2020-03-30T12:41:10Z", "message": "Simplify ReadListP"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3815, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}