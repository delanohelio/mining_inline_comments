{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0NTI0NjA0", "number": 2469, "title": "BatchStage.sort()", "bodyText": "Introduces sorting feature for batch use cases of hazelcast jet.\nUsage:\nBatchStage.sort() for sorting based on natural ordering of items.\nBatchStage.sort(ComparatorEx<V> comparator) for sorting based on user-defined comparator.\nBreaking change: this changes the Edge and EdgeDef serialization format, breaking the backwards compatibility of a suspended job if it resumes on a newer Jet version.\nChecklist\n\n Tags Set\n Milestone Set\n New public APIs have @Nonnull/@Nullable annotations\n New public APIs have @since tags in Javadoc", "createdAt": "2020-08-27T08:00:54Z", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469", "merged": true, "mergeCommit": {"oid": "73fe09d5cac40178068a48d23bfb0f8ee61d0ec8"}, "closed": true, "closedAt": "2020-09-16T12:20:00Z", "author": {"login": "MohamedMandouh"}, "timelineItems": {"totalCount": 49, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCr-QSAH2gAyNDc0NTI0NjA0OmNmY2Q1ZmU4YThlYTJkYWVlZGMxNjVhMzcwOWU4MWNhZWZjNmQwMGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJbJyigFqTQ4OTU1MTE4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cfcd5fe8a8ea2daeedc165a3709e81caefc6d00e", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/cfcd5fe8a8ea2daeedc165a3709e81caefc6d00e", "committedDate": "2020-08-26T13:39:00Z", "message": "add in-memory sort"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25cfa0f11365586fcf2da5e7f80b03c8f453865c", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/25cfa0f11365586fcf2da5e7f80b03c8f453865c", "committedDate": "2020-08-27T05:09:09Z", "message": "add in-memory sort"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7478050c6a689836c9b5a95eee2e86c79870471b", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/7478050c6a689836c9b5a95eee2e86c79870471b", "committedDate": "2020-08-27T05:16:53Z", "message": "Merge remote-tracking branch 'origin/in-memory-sorting' into in-memory-sorting\n\n# Conflicts:\n#\thazelcast-jet-core/src/main/java/com/hazelcast/jet/core/Edge.java\n#\thazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/init/EdgeDef.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26e76f729c8c12192db35ee3de058ca966a292f1", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/26e76f729c8c12192db35ee3de058ca966a292f1", "committedDate": "2020-08-27T05:48:46Z", "message": "remove SerializableComparator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "139910da8fb215b56ed4e42e54f72e1e0fc63088", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/139910da8fb215b56ed4e42e54f72e1e0fc63088", "committedDate": "2020-08-27T06:08:16Z", "message": "replace TreeMap with TreeSet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7e239333bf5bd89f85f9e2eec7aa7692156eb75", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/b7e239333bf5bd89f85f9e2eec7aa7692156eb75", "committedDate": "2020-08-27T07:50:19Z", "message": "replace ComparatorEx by Comparator in SortPrepareP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d4013f2b5b32a2c12d15ab9412e9db80c014d54", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/8d4013f2b5b32a2c12d15ab9412e9db80c014d54", "committedDate": "2020-08-27T09:21:48Z", "message": "add @NonNull/@Nullable\nadd @since\ncleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1e488d574d325209c632adc4e4d4ee480ca53e4", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/a1e488d574d325209c632adc4e4d4ee480ca53e4", "committedDate": "2020-08-29T12:20:16Z", "message": "add BatchStage.sort()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NDcxMTE1", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#pullrequestreview-478471115", "createdAt": "2020-08-31T09:51:46Z", "commit": {"oid": "a1e488d574d325209c632adc4e4d4ee480ca53e4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwOTo1MTo0NlrOHJyC-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwOTo1MTo0NlrOHJyC-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDAxOTE5Mg==", "bodyText": "You may already have made progress by consuming some items in previous while loop iterations.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#discussion_r480019192", "createdAt": "2020-08-31T09:51:46Z", "author": {"login": "mtopolnik"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/ConcurrentInboundEdgeStream.java", "diffHunk": "@@ -165,6 +177,51 @@ public ProgressState drainTo(Predicate<Object> dest) {\n         return tracker.toProgressState();\n     }\n \n+    private ProgressState drainToWithComparator(Predicate<Object> dest) {\n+        int batchSize = -1;\n+        while (true) {\n+            int minIndex = 0;\n+            Object minItem = null;\n+            for (int queueIndex = 0; queueIndex < conveyor.queueCount(); queueIndex++) {\n+                final QueuedPipe<Object> q = conveyor.queue(queueIndex);\n+                if (q == null) {\n+                    continue;\n+                }\n+                Object headObject = q.peek();\n+                Object headItem;\n+                if (headObject instanceof ObjectWithPartitionId) {\n+                    headItem = ((ObjectWithPartitionId) headObject).getItem();\n+                } else {\n+                    headItem = headObject;\n+                }\n+                if (headItem == null) {\n+                    return NO_PROGRESS;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1e488d574d325209c632adc4e4d4ee480ca53e4"}, "originalPosition": 75}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1176d4387732bb6efbf5e56263e4d709a0153365", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/1176d4387732bb6efbf5e56263e4d709a0153365", "committedDate": "2020-08-31T15:56:59Z", "message": "fix returning NO_PROGRESS whenever a queue returns null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c8897d18bf2616969b8edad54f30fab61a2c2b4", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/4c8897d18bf2616969b8edad54f30fab61a2c2b4", "committedDate": "2020-08-31T16:02:21Z", "message": "pass checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4ODM1MDA5", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#pullrequestreview-478835009", "createdAt": "2020-08-31T18:15:06Z", "commit": {"oid": "4c8897d18bf2616969b8edad54f30fab61a2c2b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODoxNTowNlrOHKDWTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODoxNTowNlrOHKDWTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMwMjY2OA==", "bodyText": "we could add a reference back to monoticOrder here", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#discussion_r480302668", "createdAt": "2020-08-31T18:15:06Z", "author": {"login": "cangencer"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/Edge.java", "diffHunk": "@@ -371,6 +373,27 @@ public Edge isolated() {\n         return partitioner;\n     }\n \n+    /**\n+     * Sets a comparator on this edge. The comparator is used by {@link ConcurrentInboundEdgeStream}\n+     * to determine which cluster member to receive the next item from over this edge.\n+     *\n+     * @since 4.3\n+     */\n+    public Edge monotonicOrder(@Nonnull ComparatorEx<Object> comparator) {\n+        this.comparator = comparator;\n+        return this;\n+    }\n+\n+    /**\n+     * Returns the comparator defined on this edge.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c8897d18bf2616969b8edad54f30fab61a2c2b4"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4ODM1OTcy", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#pullrequestreview-478835972", "createdAt": "2020-08-31T18:16:29Z", "commit": {"oid": "4c8897d18bf2616969b8edad54f30fab61a2c2b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODoxNjoyOVrOHKDZMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODoxNjoyOVrOHKDZMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMwMzQxMQ==", "bodyText": "should be ? super T", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#discussion_r480303411", "createdAt": "2020-08-31T18:16:29Z", "author": {"login": "cangencer"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/pipeline/BatchStage.java", "diffHunk": "@@ -66,6 +67,22 @@\n     @Nonnull @Override\n     BatchStage<T> rebalance();\n \n+    /**\n+     * Attaches a stage that sorts items based on their natural ordering.\n+     *\n+     * @since 4.3\n+     */\n+    @Nonnull\n+    BatchStage<T> sort();\n+\n+    /**\n+     * Attaches a stage that sorts the items based on user-defined comparator.\n+     *\n+     * @since 4.3\n+     */\n+    @Nonnull\n+    BatchStage<T> sort(@Nonnull ComparatorEx<T> comparator);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c8897d18bf2616969b8edad54f30fab61a2c2b4"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4ODM2Mjc3", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#pullrequestreview-478836277", "createdAt": "2020-08-31T18:16:55Z", "commit": {"oid": "4c8897d18bf2616969b8edad54f30fab61a2c2b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODoxNjo1NlrOHKDaKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODoxNjo1NlrOHKDaKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMwMzY1OQ==", "bodyText": "should use T here instead of V", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#discussion_r480303659", "createdAt": "2020-08-31T18:16:56Z", "author": {"login": "cangencer"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/pipeline/transform/SortTransform.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.impl.pipeline.transform;\n+\n+import com.hazelcast.function.ComparatorEx;\n+import com.hazelcast.jet.core.ProcessorMetaSupplier;\n+import com.hazelcast.jet.core.ProcessorSupplier;\n+import com.hazelcast.jet.core.Vertex;\n+import com.hazelcast.jet.core.processor.Processors;\n+import com.hazelcast.jet.impl.pipeline.Planner;\n+import com.hazelcast.jet.impl.pipeline.Planner.PlannerVertex;\n+\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+\n+import static com.hazelcast.function.FunctionEx.identity;\n+import static com.hazelcast.jet.core.Edge.between;\n+import static com.hazelcast.jet.core.processor.Processors.sortPrepareP;\n+\n+\n+public class SortTransform<V> extends AbstractTransform {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c8897d18bf2616969b8edad54f30fab61a2c2b4"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4ODM3NjE3", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#pullrequestreview-478837617", "createdAt": "2020-08-31T18:19:01Z", "commit": {"oid": "4c8897d18bf2616969b8edad54f30fab61a2c2b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODoxOTowMVrOHKDeNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxODoxOTowMVrOHKDeNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMwNDY5NQ==", "bodyText": "I don't think using SortedSet is correct here. It will skip duplicates. PriorityQueue would be more correct.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#discussion_r480304695", "createdAt": "2020-08-31T18:19:01Z", "author": {"login": "cangencer"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/processor/SortPrepareP.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.impl.processor;\n+\n+import com.hazelcast.jet.Traverser;\n+import com.hazelcast.jet.core.AbstractProcessor;\n+\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import java.util.Comparator;\n+import java.util.Iterator;\n+import java.util.SortedSet;\n+import java.util.TreeSet;\n+\n+public class SortPrepareP<V> extends AbstractProcessor {\n+    private final SortedSet<V> set;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c8897d18bf2616969b8edad54f30fab61a2c2b4"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f4a0b158c907ca467164d23f68c312e2a5cb81a", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/9f4a0b158c907ca467164d23f68c312e2a5cb81a", "committedDate": "2020-09-02T09:53:10Z", "message": "apply requested changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b9cba52a7c5500babe6079b8ee6d157b2ccddc8", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/9b9cba52a7c5500babe6079b8ee6d157b2ccddc8", "committedDate": "2020-09-03T12:23:15Z", "message": "Add @Nonnull"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "532e4ab79ea3d2352cbf39ce4724cfd03f217749", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/532e4ab79ea3d2352cbf39ce4724cfd03f217749", "committedDate": "2020-09-03T14:04:10Z", "message": "Remove the requirement for Comparator<Object>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c8a39d1b1c074a72130485ae9b1dc1dc91d525e", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/1c8a39d1b1c074a72130485ae9b1dc1dc91d525e", "committedDate": "2020-09-03T14:04:30Z", "message": "Improve Javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7b9ea5a0df3f9821f096d4129edad7f29800704", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/a7b9ea5a0df3f9821f096d4129edad7f29800704", "committedDate": "2020-09-03T14:05:14Z", "message": "Assert monotonic order in CIES"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18a7d4fe06cdd3ace4ed350cde623fcf0fe2d94b", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/18a7d4fe06cdd3ace4ed350cde623fcf0fe2d94b", "committedDate": "2020-09-03T14:05:48Z", "message": "Simplify draining logic in CIES"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca6439638cdee433a514857ae5b0c3b590b32652", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/ca6439638cdee433a514857ae5b0c3b590b32652", "committedDate": "2020-09-03T14:16:31Z", "message": "Remove numActiveQueues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b884ea5c5b7f779e562bd5f6fa6adaacfdf09c8", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/8b884ea5c5b7f779e562bd5f6fa6adaacfdf09c8", "committedDate": "2020-09-03T14:16:37Z", "message": "Merge nested ifs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6ad9b298479cb28711a325d95d19a2ce8aa3fd0", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/a6ad9b298479cb28711a325d95d19a2ce8aa3fd0", "committedDate": "2020-09-04T12:07:36Z", "message": "Upgraded deps in NOTICE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9499597afb0dea4996675ec4a8184176fd9ba0b9", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/9499597afb0dea4996675ec4a8184176fd9ba0b9", "committedDate": "2020-09-04T12:09:42Z", "message": "Improve Javadoc of Processors.sortPrepareP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "193663d7577d222eeee295b8d7b6c03ebf296398", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/193663d7577d222eeee295b8d7b6c03ebf296398", "committedDate": "2020-09-04T12:09:57Z", "message": "Improve generic type treatment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c02162c7a2c5d9419f371fc5696da44bdc0d717a", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/c02162c7a2c5d9419f371fc5696da44bdc0d717a", "committedDate": "2020-09-04T12:10:08Z", "message": "Simplify SortPrepareP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89d51090958c5ad6eca9de6ca96f2680714bf546", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/89d51090958c5ad6eca9de6ca96f2680714bf546", "committedDate": "2020-09-04T12:17:25Z", "message": "Rename SortPrepareP -> SortP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf4907a3866331a686df133d09e018abbc99f002", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/bf4907a3866331a686df133d09e018abbc99f002", "committedDate": "2020-09-04T12:46:13Z", "message": "Fix generics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f30b5ce3f83ae9ed6487ef4bfc3f16c262dcb13", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/4f30b5ce3f83ae9ed6487ef4bfc3f16c262dcb13", "committedDate": "2020-09-04T13:19:36Z", "message": "Merge branch 'master' into in-memory-sorting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a3be9689b4ee40e6c0ac1399988de18408f18a2", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/2a3be9689b4ee40e6c0ac1399988de18408f18a2", "committedDate": "2020-09-04T13:43:40Z", "message": "Work around JDK 8 compiler bug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cb38972bfe409df8c0942841aa7ed781d7ab6a1", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/8cb38972bfe409df8c0942841aa7ed781d7ab6a1", "committedDate": "2020-09-05T13:53:53Z", "message": "Fix two bugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1bbf30ad991a38e30134207565b2b9e03882afb", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/f1bbf30ad991a38e30134207565b2b9e03882afb", "committedDate": "2020-09-05T13:54:02Z", "message": "Add BatchStageTest.sort()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d629a5cac935303213d1b8d4a3a693c9082b8943", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/d629a5cac935303213d1b8d4a3a693c9082b8943", "committedDate": "2020-09-05T14:10:49Z", "message": "add ProcessorsTest.sort"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMzU2ODA2", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#pullrequestreview-483356806", "createdAt": "2020-09-07T08:29:55Z", "commit": {"oid": "d629a5cac935303213d1b8d4a3a693c9082b8943"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwODoyOTo1NVrOHN1ygg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwODoyOTo1NVrOHN1ygg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI3NDgxOA==", "bodyText": "Override annotation is missing here.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#discussion_r484274818", "createdAt": "2020-09-07T08:29:55Z", "author": {"login": "ufukyilmaz"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/processor/SortP.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.impl.processor;\n+\n+import com.hazelcast.jet.Traverser;\n+import com.hazelcast.jet.core.AbstractProcessor;\n+\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+import java.util.Comparator;\n+import java.util.PriorityQueue;\n+\n+public class SortP<T> extends AbstractProcessor {\n+    private final PriorityQueue<T> priorityQueue;\n+    private final Traverser<T> resultTraverser;\n+\n+    public SortP(@Nullable Comparator<T> comparator) {\n+        this.priorityQueue = new PriorityQueue<>(comparator);\n+        this.resultTraverser = priorityQueue::poll;\n+    }\n+\n+    @SuppressWarnings(\"unchecked\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d629a5cac935303213d1b8d4a3a693c9082b8943"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMzgxNzY1", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#pullrequestreview-483381765", "createdAt": "2020-09-07T09:01:34Z", "commit": {"oid": "d629a5cac935303213d1b8d4a3a693c9082b8943"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwOTowMTozNFrOHN28Cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwOTowMTozNFrOHN28Cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI5MzY0Mw==", "bodyText": "Can you explain which kind of input data this processor can effectively sort (It seems to me that it cannot sort the streaming data completely, but I'm not sure.)?\nIs this processor's only use case to sort the data completely or can it be used for other purposes such as partial sorting?\nAlso, could you document what the comparator parameter does and what the type parameter is?", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#discussion_r484293643", "createdAt": "2020-09-07T09:01:34Z", "author": {"login": "ufukyilmaz"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/processor/Processors.java", "diffHunk": "@@ -972,6 +976,22 @@ private Processors() {\n                 (singletonTraverser, service, item) -> flatMapFn.apply(service, item));\n     }\n \n+    /**\n+     * Returns a supplier of processors for a vertex that sorts its input using\n+     * a {@link PriorityQueue} and emits it in the {@code complete} phase.\n+     * <p>\n+     * The output edge of this vertex should be {@link Edge#distributed\n+     * distributed} {@link Edge#monotonicOrder monotonicOrder} {@link\n+     * Edge#allToOne allToOne} so it preserves the ordering when merging\n+     * the data from all upstream processors.\n+     *\n+     * @since 4.3", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d629a5cac935303213d1b8d4a3a693c9082b8943"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMzkyMzM0", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#pullrequestreview-483392334", "createdAt": "2020-09-07T09:15:46Z", "commit": {"oid": "d629a5cac935303213d1b8d4a3a693c9082b8943"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwOToxNTo0NlrOHN3eGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwOToxNTo0NlrOHN3eGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMwMjM2MA==", "bodyText": "Public APIs should include a detailed explanation, sample usage, and parameter and return value descriptions. Could you add them? You can refer to the methods in the GeneralStage interface.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#discussion_r484302360", "createdAt": "2020-09-07T09:15:46Z", "author": {"login": "ufukyilmaz"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/pipeline/BatchStage.java", "diffHunk": "@@ -66,6 +67,23 @@\n     @Nonnull @Override\n     BatchStage<T> rebalance();\n \n+    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d629a5cac935303213d1b8d4a3a693c9082b8943"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a23a817651a3733d23a8a928a0ad104051220edc", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/a23a817651a3733d23a8a928a0ad104051220edc", "committedDate": "2020-09-08T15:27:30Z", "message": "add missing Override"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb6751d9c157eed144c1ec163f2b8a66315ed6e6", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/eb6751d9c157eed144c1ec163f2b8a66315ed6e6", "committedDate": "2020-09-08T15:54:20Z", "message": "add sample usage, param and return annotaitions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f59a0dde50041f563acc9e5227ef8c0174ae641", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/5f59a0dde50041f563acc9e5227ef8c0174ae641", "committedDate": "2020-09-12T12:43:47Z", "message": "add \"only available for batch\" in javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e381704740418cd7eee743c4b283cfb4eb69904", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/0e381704740418cd7eee743c4b283cfb4eb69904", "committedDate": "2020-09-12T15:20:00Z", "message": "introduce BatchStage.partialSort"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0d102bbe1c9d9923150042b46f1cb407fcef3ab", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/c0d102bbe1c9d9923150042b46f1cb407fcef3ab", "committedDate": "2020-09-14T04:04:58Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "029432bc0e714faa32b9063d41040a9fe0c659b5", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/029432bc0e714faa32b9063d41040a9fe0c659b5", "committedDate": "2020-09-14T13:25:20Z", "message": "Revert \"cleanup\"\n\nThis reverts commit c0d102bb"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a045a23916482180f76e098d0e2fdb6b1fddca6d", "author": {"user": {"login": "MohamedMandouh", "name": "Mohamed Mandouh"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/a045a23916482180f76e098d0e2fdb6b1fddca6d", "committedDate": "2020-09-14T13:25:38Z", "message": "Revert \"introduce BatchStage.partialSort\"\n\nThis reverts commit 0e381704"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3d124d28d06cbd9c01c40298f41f2efdee174da", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/b3d124d28d06cbd9c01c40298f41f2efdee174da", "committedDate": "2020-09-14T14:17:26Z", "message": "Improve Javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85a31da26087ea42a806a4c51a4e7d05edd67836", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/85a31da26087ea42a806a4c51a4e7d05edd67836", "committedDate": "2020-09-14T14:19:54Z", "message": "Improved Edge doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3ODI3MTcx", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#pullrequestreview-487827171", "createdAt": "2020-09-14T14:26:52Z", "commit": {"oid": "85a31da26087ea42a806a4c51a4e7d05edd67836"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "befdc1d9d7bfc6aa4166a41fcb0aebebfe1d547a", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/befdc1d9d7bfc6aa4166a41fcb0aebebfe1d547a", "committedDate": "2020-09-16T08:50:30Z", "message": "Add jet-start.sh docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NTUxMTgz", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2469#pullrequestreview-489551183", "createdAt": "2020-09-16T12:00:41Z", "commit": {"oid": "befdc1d9d7bfc6aa4166a41fcb0aebebfe1d547a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3590, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}