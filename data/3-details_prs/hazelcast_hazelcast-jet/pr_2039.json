{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzNDcwNTU5", "number": 2039, "title": " Support job-level serializers in Processors", "bodyText": "This PR is part of the effort to add job level serialization support.\nProcessors rely on global SerializationService either retrieved directly from NodeEngine or injected through SerializationServiceAware.\nIn order to use job-level serializers, Processors have been decoupled from NodeEngine and SerializationServiceAware. Custom/job-level SerializationService has been made accessible to Processors through ProcSupplierCtx.\nJob-level serializers for IMDG processors are not supported yet.\nChecklist\n\n Tags Set\n Milestone Set", "createdAt": "2020-03-04T10:40:25Z", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2039", "merged": true, "mergeCommit": {"oid": "2532f5a8dcd02f9371d40453dfddaeb83257b2fb"}, "closed": true, "closedAt": "2020-03-05T12:56:10Z", "author": {"login": "gierlachg"}, "timelineItems": {"totalCount": 42, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIIkLbAH2gAyMzgzNDcwNTU5OmMyOWI5ZTVmYzA3NDZlMzMxMTBjYWQzNDY2NDI0ZGI1YzZjYWYxOTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKpCoBAFqTM2OTQ1NzgyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c29b9e5fc0746e33110cad3466424db5c6caf197", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/c29b9e5fc0746e33110cad3466424db5c6caf197", "committedDate": "2020-02-26T15:36:14Z", "message": "Add DataInput/DataOutput."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e6976eb21e40110c538fbc388b99faec472f52f", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/6e6976eb21e40110c538fbc388b99faec472f52f", "committedDate": "2020-02-27T07:53:24Z", "message": "Add DataInput/DataOutput."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a177ca2125ef4aafc188c03886a88482e79fcd4a", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/a177ca2125ef4aafc188c03886a88482e79fcd4a", "committedDate": "2020-02-27T08:22:43Z", "message": "Add DataInput/DataOutput."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "454306a55534826bd1147d9723604c3de060c41b", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/454306a55534826bd1147d9723604c3de060c41b", "committedDate": "2020-02-27T08:47:40Z", "message": "Add DataInput/DataOutput."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34ffe5bf20b5a3158e222b36970094aa38f5d74b", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/34ffe5bf20b5a3158e222b36970094aa38f5d74b", "committedDate": "2020-02-27T09:01:33Z", "message": "Add DataInput/DataOutput"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6ab4bbac5dd2d1ba8484331afd6a8bc0385c3de", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/e6ab4bbac5dd2d1ba8484331afd6a8bc0385c3de", "committedDate": "2020-02-27T09:07:51Z", "message": "Add DataInput/DataOutput"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "001bcabe6a38134b8487c0cf8ceabd93efb8c909", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/001bcabe6a38134b8487c0cf8ceabd93efb8c909", "committedDate": "2020-02-27T09:33:18Z", "message": "Add DataInput/DataOutput"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b3b4022e83d0d59f56dfdce20c69348905dfcec", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/7b3b4022e83d0d59f56dfdce20c69348905dfcec", "committedDate": "2020-02-27T10:32:36Z", "message": "Add DataInput/DataOutput"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b64f1f3709cc9fd93d4740164f76dd79cba76fdf", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/b64f1f3709cc9fd93d4740164f76dd79cba76fdf", "committedDate": "2020-02-27T10:42:50Z", "message": "Add DataInput/DataOutput"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95edf20891d1ebab490072fcac899e85c8d0ef82", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/95edf20891d1ebab490072fcac899e85c8d0ef82", "committedDate": "2020-02-27T11:06:42Z", "message": "Add DataInput/DataOutput"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3a3ac276c46b6cf8fd246df9e873e3cbc90c7da", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/d3a3ac276c46b6cf8fd246df9e873e3cbc90c7da", "committedDate": "2020-02-27T11:46:41Z", "message": "Merge branch 'master' into serializness_networking\n\n# Conflicts:\n#\tpom.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01aa369f5e6065ee52c6ea47d3b6bc3721701806", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/01aa369f5e6065ee52c6ea47d3b6bc3721701806", "committedDate": "2020-02-27T11:54:45Z", "message": "Add DataInput/DataOutput"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "254fd66d3b3c3c4495471869ff308b604d3a82ca", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/254fd66d3b3c3c4495471869ff308b604d3a82ca", "committedDate": "2020-02-27T12:34:25Z", "message": "Merge branch 'master' into serializness_networking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dec4d9c82eea8c86729364b40a042ff7c008f990", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/dec4d9c82eea8c86729364b40a042ff7c008f990", "committedDate": "2020-02-27T14:06:07Z", "message": "Add DataInput/DataOutput"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79bfadc3587c57b14263987eff2e50ae721c7191", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/79bfadc3587c57b14263987eff2e50ae721c7191", "committedDate": "2020-02-27T14:41:10Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c971f987750eae45e0ef6d77f271f79369f83846", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/c971f987750eae45e0ef6d77f271f79369f83846", "committedDate": "2020-02-28T08:31:35Z", "message": "Configure SenderTasklet with custom SerializationService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bb2d4263aef1903a55396ad897991aceee3701b", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/4bb2d4263aef1903a55396ad897991aceee3701b", "committedDate": "2020-02-28T10:25:07Z", "message": "Simplify bytes writing & reading"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91cb86e9aae490b3b282428fc9c94ad062c9849e", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/91cb86e9aae490b3b282428fc9c94ad062c9849e", "committedDate": "2020-02-28T11:54:36Z", "message": "Extract MemoryWriter & MemoryReader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9648218d35d89c854f559975c6689ee11e95cb0f", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/9648218d35d89c854f559975c6689ee11e95cb0f", "committedDate": "2020-02-28T12:07:49Z", "message": "Merge branch 'serializness_networking' into sender_serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f730dc3e06639647269cb6f6fbf786e4dbca95a", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/6f730dc3e06639647269cb6f6fbf786e4dbca95a", "committedDate": "2020-03-02T08:13:27Z", "message": "Add PR link to @Deprecated comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "523e4e0c2146f62c114841de83b2238d0a25c1f5", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/523e4e0c2146f62c114841de83b2238d0a25c1f5", "committedDate": "2020-03-02T08:20:05Z", "message": "Merge branch 'serializness_networking' into sender_serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c2f0290cf0877a8d4ad2ea7c59cec0e94ef9945", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/3c2f0290cf0877a8d4ad2ea7c59cec0e94ef9945", "committedDate": "2020-03-02T08:50:27Z", "message": "Replace MemoryDataInput with MemoryReader to avoid allocation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0220710637b6aceb8b9bedf4282b4cc132bcc5b7", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/0220710637b6aceb8b9bedf4282b4cc132bcc5b7", "committedDate": "2020-03-02T08:51:17Z", "message": "Merge branch 'serializness_networking' into sender_serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d09475761c52ecd34d222df9c28da3a68b04694", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/5d09475761c52ecd34d222df9c28da3a68b04694", "committedDate": "2020-03-02T08:54:35Z", "message": "Replace MemoryDataInput with MemoryReader to avoid allocation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b57b4855be49fc945a54980303afeadfec2f3a11", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/b57b4855be49fc945a54980303afeadfec2f3a11", "committedDate": "2020-03-02T08:54:55Z", "message": "Merge branch 'serializness_networking' into sender_serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25a7b7f9a56fe74eec7d965e741adafebee0fb2d", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/25a7b7f9a56fe74eec7d965e741adafebee0fb2d", "committedDate": "2020-03-02T13:08:34Z", "message": "Configure Processors with custom SerializationService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39c115d087ed8b62e78f92e1ef3521a6dd1b636a", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/39c115d087ed8b62e78f92e1ef3521a6dd1b636a", "committedDate": "2020-03-02T13:28:16Z", "message": "Configure Processors with custom SerializationService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1789785b1db1cb8997fc1342f4e775ceef659f58", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/1789785b1db1cb8997fc1342f4e775ceef659f58", "committedDate": "2020-03-03T10:20:53Z", "message": "Merge branch 'master' into sender_serializer\n\n# Conflicts:\n#\thazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/Networking.java\n#\thazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/util/ImdgUtil.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "804620da117638cdcc0797999913ad12a5848017", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/804620da117638cdcc0797999913ad12a5848017", "committedDate": "2020-03-03T10:37:10Z", "message": "Merge branch 'sender_serializer' into processor_serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52e51ea5b095a607fae14c7d6d6beb70de1dd479", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/52e51ea5b095a607fae14c7d6d6beb70de1dd479", "committedDate": "2020-03-03T12:33:45Z", "message": "Merge branch 'master' into sender_serializer\n\n# Conflicts:\n#\thazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/Networking.java\n#\thazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/util/ImdgUtil.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51e2b2033ccdac77179e286687e54b989728aa98", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/51e2b2033ccdac77179e286687e54b989728aa98", "committedDate": "2020-03-03T12:34:26Z", "message": "Merge branch 'sender_serializer' into processor_serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa34a4f326b21597379bd2da65f61120401bba58", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/aa34a4f326b21597379bd2da65f61120401bba58", "committedDate": "2020-03-04T10:17:18Z", "message": "Merge branch 'master' into processor_serializer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efa36aa04d432fd3b0a82fe2b5b34dfbde422018", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/efa36aa04d432fd3b0a82fe2b5b34dfbde422018", "committedDate": "2020-03-04T10:22:23Z", "message": "Formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "679f334edf283edd6a9cd56a5bd2742e53b7ba2b", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/679f334edf283edd6a9cd56a5bd2742e53b7ba2b", "committedDate": "2020-03-04T10:46:04Z", "message": "Remove unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4Njg0NjAw", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2039#pullrequestreview-368684600", "createdAt": "2020-03-04T11:00:38Z", "commit": {"oid": "679f334edf283edd6a9cd56a5bd2742e53b7ba2b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMTowMDozOFrOFxo2NQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxMzoyMzoxNFrOFxtCAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU5Mzc4MQ==", "bodyText": "This is a public API method and InternalSerializationService is an internal interface. We should not expose it to the user.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2039#discussion_r387593781", "createdAt": "2020-03-04T11:00:38Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/ProcessorSupplier.java", "diffHunk": "@@ -131,5 +132,11 @@ static ProcessorSupplier of(@Nonnull SupplierEx<? extends Processor> processorSu\n          */\n         @Nonnull\n         File attachedFile(@Nonnull String id);\n+\n+        /**\n+         * Returns serialization service associated with this job.\n+         */\n+        @Nonnull\n+        InternalSerializationService serializationService();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679f334edf283edd6a9cd56a5bd2742e53b7ba2b"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY2MjA0MA==", "bodyText": "We should get the MangedContext from context.jetInstance().hazelcastInstance() downcasted to HazelcastInstanceImpl", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2039#discussion_r387662040", "createdAt": "2020-03-04T13:22:45Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/connector/ConvenientSourceP.java", "diffHunk": "@@ -109,6 +105,7 @@ public boolean isCooperative() {\n     @Override\n     protected void init(@Nonnull Context context) {\n         // createFn is allowed to return null, we'll call `destroyFn` even for null `ctx`\n+        ManagedContext managedContext = context.serializationService().getManagedContext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679f334edf283edd6a9cd56a5bd2742e53b7ba2b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY2MjMzOQ==", "bodyText": "Same here", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2039#discussion_r387662339", "createdAt": "2020-03-04T13:23:14Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/connector/WriteBufferedP.java", "diffHunk": "@@ -64,6 +61,7 @@ public void init(@Nonnull Outbox outbox, @Nonnull Context context) {\n         if (localBuff == null) {\n             throw new JetException(\"Null buffer created\");\n         }\n+        ManagedContext managedContext = context.serializationService().getManagedContext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679f334edf283edd6a9cd56a5bd2742e53b7ba2b"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b68212389b6d08a05e3c2e0c3f53dc8171b6d069", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/b68212389b6d08a05e3c2e0c3f53dc8171b6d069", "committedDate": "2020-03-04T15:37:19Z", "message": "Hide InternalSerializationService & expose ManagedContext"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15caea71b28e6feff19a98b34ece5ffddc94adfb", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/15caea71b28e6feff19a98b34ece5ffddc94adfb", "committedDate": "2020-03-04T15:41:41Z", "message": "Formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4OTIzNDg4", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2039#pullrequestreview-368923488", "createdAt": "2020-03-04T16:21:32Z", "commit": {"oid": "15caea71b28e6feff19a98b34ece5ffddc94adfb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjoyMTozMlrOFx0HbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjozMTowMlrOFx0hnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc3ODQxMg==", "bodyText": "ManagedContext is available also on ProcessorMetaSupplier level I think", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2039#discussion_r387778412", "createdAt": "2020-03-04T16:21:32Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/ProcessorSupplier.java", "diffHunk": "@@ -131,5 +132,11 @@ static ProcessorSupplier of(@Nonnull SupplierEx<? extends Processor> processorSu\n          */\n         @Nonnull\n         File attachedFile(@Nonnull String id);\n+\n+        /**\n+         * Returns {@link ManagedContext} associated with this job.\n+         */\n+        @Nonnull\n+        ManagedContext managedContext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15caea71b28e6feff19a98b34ece5ffddc94adfb"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc3OTc4MA==", "bodyText": "SerializationAware isn't public API. Public classes shouldn't implement non-public interfaces.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2039#discussion_r387779780", "createdAt": "2020-03-04T16:23:24Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/test/TestProcessorSupplierContext.java", "diffHunk": "@@ -34,10 +38,20 @@\n  */\n public class TestProcessorSupplierContext\n         extends TestProcessorMetaSupplierContext\n-        implements ProcessorSupplier.Context {\n+        implements ProcessorSupplier.Context, SerializationAware {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15caea71b28e6feff19a98b34ece5ffddc94adfb"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc4MDc0OQ==", "bodyText": "We can use the no-arg constructor", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2039#discussion_r387780749", "createdAt": "2020-03-04T16:24:53Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/test/TestSupport.java", "diffHunk": "@@ -791,21 +791,22 @@ private void doCall(String methodName, boolean isCooperative, Runnable r) {\n     }\n \n     private void initProcessor(Processor processor, TestOutbox outbox) {\n-        TestProcessorContext context = new TestProcessorContext()\n+        InternalSerializationService serializationService;\n+        if (jetInstance != null && jetInstance.getHazelcastInstance() instanceof SerializationServiceSupport) {\n+            SerializationServiceSupport impl = (SerializationServiceSupport) jetInstance.getHazelcastInstance();\n+            serializationService = (InternalSerializationService) impl.getSerializationService();\n+        } else {\n+            serializationService = new DefaultSerializationServiceBuilder()\n+                    .setManagedContext(e -> e)\n+                    .build();\n+        }\n+\n+        TestProcessorContext context = new TestProcessorContext(serializationService)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15caea71b28e6feff19a98b34ece5ffddc94adfb"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc4NTExNg==", "bodyText": "It would be safer and easier to get the managed context from the jetInstance(). Theoretically the serializationService could have different managedContext. It's not the member's serialization service. IMO, the managedContext shouldn't be published by it. Maybe we can even use SerializationService instead of InternalSerializationService, do we use any other method than toObject and toData?", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2039#discussion_r387785116", "createdAt": "2020-03-04T16:31:02Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/execution/init/Contexts.java", "diffHunk": "@@ -225,6 +231,16 @@ private static String tempDirPrefix(String jetInstanceName, String jobId, String\n                     + \"-\" + jobId\n                     + \"-\" + resourceId.substring(0, min(32, resourceId.length())).replaceAll(\"[^\\\\w.\\\\-$]\", \"_\");\n         }\n+\n+        @Nonnull @Override\n+        public ManagedContext managedContext() {\n+            return serializationService.getManagedContext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15caea71b28e6feff19a98b34ece5ffddc94adfb"}, "originalPosition": 64}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3471b2135dc9324485b8c20cfb2d9f0db06f6a7d", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/3471b2135dc9324485b8c20cfb2d9f0db06f6a7d", "committedDate": "2020-03-05T08:04:59Z", "message": "Remove SerializationAware"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "495200c265678c4c8a339ce9fecd787324f9cfe4", "author": {"user": {"login": "gierlachg", "name": "Grzegorz Gierlach"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/495200c265678c4c8a339ce9fecd787324f9cfe4", "committedDate": "2020-03-05T08:07:21Z", "message": "Fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a84fd96590e3590f78bc64fff04baf371552c9b", "author": {"user": {"login": "viliam-durina", "name": "Viliam Durina"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/9a84fd96590e3590f78bc64fff04baf371552c9b", "committedDate": "2020-03-05T10:32:09Z", "message": "Tweaks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDU3ODIw", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2039#pullrequestreview-369457820", "createdAt": "2020-03-05T10:34:18Z", "commit": {"oid": "495200c265678c4c8a339ce9fecd787324f9cfe4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2883, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}