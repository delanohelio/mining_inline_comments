{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMjc2MzAy", "number": 2538, "title": "Add test for not emit windows too early with sparse events", "bodyText": "Test is added as nightly test since it takes more than 15seconds.\nThis PR also adds sparse event test plan to left menu on site.\nChecklist\n\n Tags Set\n Milestone Set\n[N/A] Any breaking changes are documented\n[N/A] New public APIs have @Nonnull/@Nullable annotations\n[N/A] New public APIs have @since tags in Javadoc\n[N/A] For code samples, code sample main readme is updated", "createdAt": "2020-09-21T12:54:22Z", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2538", "merged": true, "mergeCommit": {"oid": "022ec154a2d3828da400584650d2aeb3ca69e198"}, "closed": true, "closedAt": "2020-09-23T07:34:02Z", "author": {"login": "olukas"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLC4anAH2gAyNDkwMjc2MzAyOjgzYjNjODU1ZGNlZmY4MmNjOGI2NTJhOGMwZGEwODc3N2Q4Mjk1Yzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLYokRABqjM3OTM0ODg4NDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "83b3c855dceff82cc8b652a8c0da08777d8295c9", "author": {"user": {"login": "olukas", "name": "Ondrej Lukas"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/83b3c855dceff82cc8b652a8c0da08777d8295c9", "committedDate": "2020-09-21T12:51:50Z", "message": "Add test for not emit windows too early with sparse events"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNzI4Mzc0", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2538#pullrequestreview-492728374", "createdAt": "2020-09-21T15:22:11Z", "commit": {"oid": "83b3c855dceff82cc8b652a8c0da08777d8295c9"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNToyMjoxMlrOHVWICg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNToyMjoxMlrOHVWICg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE0NDY1MA==", "bodyText": "This is time-sensitive. If it takes 5 secs to submit the job, this assert can fail.\nWe can instead start measuring before submitting the job and we can safely check that more than 15 seconds passed before the first event appeared.\nlong start = System.nanoTime();\nnewJob(p);\nassertTrueEventually( /* one item in sinkList */);\nassertTrue(System.nanoTime() - start > 15 seconds);", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2538#discussion_r492144650", "createdAt": "2020-09-21T15:22:12Z", "author": {"login": "viliam-durina"}, "path": "hazelcast-jet-core/src/test/java/com/hazelcast/jet/pipeline/StreamSourceStageTest.java", "diffHunk": "@@ -165,6 +167,29 @@ public void when_sparseItemsWithIngestionTimestamps_then_noExtraLatency() {\n         job.cancel();\n     }\n \n+    @Test\n+    @Category(NightlyTest.class)\n+    public void when_sparseItemsWithIngestionTimestamps_then_windowIsNotEmittedTooEarly() {\n+        IList<WindowResult<Long>> sinkList = instance.getList(randomMapName());\n+        IMap<Integer, Integer> map = instance.getMap(randomMapName());\n+\n+        Pipeline p = Pipeline.create();\n+        p.readFrom(Sources.mapJournal(map, START_FROM_OLDEST))\n+         .withIngestionTimestamps()\n+         .window(WindowDefinition.session(15_000))\n+         .aggregate(AggregateOperations.counting())\n+         .writeTo(Sinks.list(sinkList));\n+\n+        Job job = instance.newJob(p);\n+        assertEquals(0, sinkList.size());\n+        map.put(5, 5);\n+\n+        assertTrueAllTheTime(() -> assertEquals(0, sinkList.size()), 10);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83b3c855dceff82cc8b652a8c0da08777d8295c9"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "393a2e55ef09f4fa333910d96e8ec04a371f763b", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/393a2e55ef09f4fa333910d96e8ec04a371f763b", "committedDate": "2020-09-22T14:12:18Z", "message": "Improve test robustness"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "239debd95b18b3f86452b842e06309f259261ac3", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/239debd95b18b3f86452b842e06309f259261ac3", "committedDate": "2020-09-22T13:59:19Z", "message": "Improve test robustness"}, "afterCommit": {"oid": "393a2e55ef09f4fa333910d96e8ec04a371f763b", "author": {"user": {"login": "mtopolnik", "name": "Marko Topolnik"}}, "url": "https://github.com/hazelcast/hazelcast-jet/commit/393a2e55ef09f4fa333910d96e8ec04a371f763b", "committedDate": "2020-09-22T14:12:18Z", "message": "Improve test robustness"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3623, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}