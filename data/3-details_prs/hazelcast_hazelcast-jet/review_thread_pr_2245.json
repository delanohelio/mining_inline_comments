{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1OTIxMDY3", "number": 2245, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMjowMDo0M1rOD8CFYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMjowNTowNlrOD9xGqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0Mjc1Mjk2OnYy", "diffSide": "RIGHT", "path": "site/docs/how-tos/grpc.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMjowMDo0M1rOGUuMQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMjowMDo0M1rOGUuMQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDM4MTUwNQ==", "bodyText": "maybe we should point the user to where you can learn more about these proeprties?", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#discussion_r424381505", "createdAt": "2020-05-13T12:00:43Z", "author": {"login": "cangencer"}, "path": "site/docs/how-tos/grpc.md", "diffHunk": "@@ -246,6 +246,15 @@ stage.mapUsingServiceAsyncBatched(bidiService,\n })\n ```\n \n+If your batch takes close to or more than 1 s (including the network\n+overhead) you should increase the value for following properties to\n+perform clean shutdown:\n+\n+```\n+jet.grpc.destroy.timeout", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0Mjc1NDE5OnYy", "diffSide": "RIGHT", "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/impl/GrpcProperties.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMjowMTowMVrOGUuM7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMjowMTowMVrOGUuM7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDM4MTY3OQ==", "bodyText": "missing @since, you can include here and drop the rest on the same file.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#discussion_r424381679", "createdAt": "2020-05-13T12:01:01Z", "author": {"login": "cangencer"}, "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/impl/GrpcProperties.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright 2020 Hazelcast Inc.\n+ *\n+ * Licensed under the Hazelcast Community License (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://hazelcast.com/hazelcast-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.grpc.impl;\n+\n+import com.hazelcast.spi.properties.HazelcastProperty;\n+import io.grpc.stub.StreamObserver;\n+\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+\n+/**\n+ * Properties of the grpc module\n+ */\n+public final class GrpcProperties {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDkxMjc0OnYy", "diffSide": "RIGHT", "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/impl/GrpcProperties.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMTo1NjowMlrOGXc5CA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMjo1MTo0NFrOGXe6Aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0Mzc4NA==", "bodyText": "Better add seconds to the name. That way when you see the system property somewhere, you'll know the time unit.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#discussion_r427243784", "createdAt": "2020-05-19T11:56:02Z", "author": {"login": "mtopolnik"}, "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/impl/GrpcProperties.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright 2020 Hazelcast Inc.\n+ *\n+ * Licensed under the Hazelcast Community License (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://hazelcast.com/hazelcast-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.grpc.impl;\n+\n+import com.hazelcast.spi.properties.HazelcastProperty;\n+import io.grpc.stub.StreamObserver;\n+\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+\n+/**\n+ * Properties of the grpc module\n+ */\n+public final class GrpcProperties {\n+\n+    /**\n+     * Time to wait for {@link StreamObserver#onCompleted()} confirmation when destroying a\n+     * {@link BidirectionalStreamingService}\n+     * You may want to increase this value when your gRPC calls take longer than 1 s to cleanly shutdown the service.\n+     * <p>\n+     * The default value is 1 s\n+     *\n+     * @since 4.2\n+     */\n+    public static final HazelcastProperty DESTROY_TIMEOUT\n+            = new HazelcastProperty(\"jet.grpc.destroy.timeout\", 1, SECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI3NjgwMw==", "bodyText": "Added.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#discussion_r427276803", "createdAt": "2020-05-19T12:51:44Z", "author": {"login": "frant-hartm"}, "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/impl/GrpcProperties.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright 2020 Hazelcast Inc.\n+ *\n+ * Licensed under the Hazelcast Community License (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://hazelcast.com/hazelcast-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.grpc.impl;\n+\n+import com.hazelcast.spi.properties.HazelcastProperty;\n+import io.grpc.stub.StreamObserver;\n+\n+import static java.util.concurrent.TimeUnit.SECONDS;\n+\n+/**\n+ * Properties of the grpc module\n+ */\n+public final class GrpcProperties {\n+\n+    /**\n+     * Time to wait for {@link StreamObserver#onCompleted()} confirmation when destroying a\n+     * {@link BidirectionalStreamingService}\n+     * You may want to increase this value when your gRPC calls take longer than 1 s to cleanly shutdown the service.\n+     * <p>\n+     * The default value is 1 s\n+     *\n+     * @since 4.2\n+     */\n+    public static final HazelcastProperty DESTROY_TIMEOUT\n+            = new HazelcastProperty(\"jet.grpc.destroy.timeout\", 1, SECONDS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0Mzc4NA=="}, "originalCommit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDkyMjI5OnYy", "diffSide": "RIGHT", "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/impl/GrpcUtil.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMTo1OTowMFrOGXc_TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMTo1OTowMFrOGXc_TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0NTM4OA==", "bodyText": "Add the timeout to the log statement, as well as instruction on how to set it (system property name).", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#discussion_r427245388", "createdAt": "2020-05-19T11:59:00Z", "author": {"login": "mtopolnik"}, "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/impl/GrpcUtil.java", "diffHunk": "@@ -52,8 +52,8 @@ public static Throwable translateGrpcException(Throwable exception) {\n      * Tries orderly shutdown first {@link ManagedChannel#shutdown()}, then forceful shutdown\n      * {@link ManagedChannel#shutdownNow()}.\n      */\n-    public static void shutdownChannel(ManagedChannel channel, ILogger logger) throws InterruptedException {\n-        if (!channel.shutdown().awaitTermination(1, SECONDS)) {\n+    public static void shutdownChannel(ManagedChannel channel, ILogger logger, long timeout) throws InterruptedException {\n+        if (!channel.shutdown().awaitTermination(timeout, SECONDS)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDkzMTQ1OnYy", "diffSide": "RIGHT", "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/impl/GrpcUtil.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMjowMTo1N1rOGXdFYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMjoyMTozN1rOGXdxlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0Njk0NQ==", "bodyText": "Javadoc has a grammar error: \"Shutdowns\". Should be Shuts down {@link ManagedChannel}.", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#discussion_r427246945", "createdAt": "2020-05-19T12:01:57Z", "author": {"login": "mtopolnik"}, "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/impl/GrpcUtil.java", "diffHunk": "@@ -52,8 +52,8 @@ public static Throwable translateGrpcException(Throwable exception) {\n      * Tries orderly shutdown first {@link ManagedChannel#shutdown()}, then forceful shutdown\n      * {@link ManagedChannel#shutdownNow()}.\n      */\n-    public static void shutdownChannel(ManagedChannel channel, ILogger logger) throws InterruptedException {\n-        if (!channel.shutdown().awaitTermination(1, SECONDS)) {\n+    public static void shutdownChannel(ManagedChannel channel, ILogger logger, long timeout) throws InterruptedException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI1ODI2MQ==", "bodyText": "Most of the internet agrees with you, I bet both will be correct in 20 years! :-)", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#discussion_r427258261", "createdAt": "2020-05-19T12:21:37Z", "author": {"login": "frant-hartm"}, "path": "extensions/grpc/src/main/java/com/hazelcast/jet/grpc/impl/GrpcUtil.java", "diffHunk": "@@ -52,8 +52,8 @@ public static Throwable translateGrpcException(Throwable exception) {\n      * Tries orderly shutdown first {@link ManagedChannel#shutdown()}, then forceful shutdown\n      * {@link ManagedChannel#shutdownNow()}.\n      */\n-    public static void shutdownChannel(ManagedChannel channel, ILogger logger) throws InterruptedException {\n-        if (!channel.shutdown().awaitTermination(1, SECONDS)) {\n+    public static void shutdownChannel(ManagedChannel channel, ILogger logger, long timeout) throws InterruptedException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0Njk0NQ=="}, "originalCommit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDk0MjUxOnYy", "diffSide": "RIGHT", "path": "site/docs/how-tos/grpc.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMjowNTowNlrOGXdMdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMjowNTowNlrOGXdMdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzI0ODc1OA==", "bodyText": "\"If your batch takes more than ~0.8 seconds (including the network overhead), you should increase the value of the following properties so that the clean shutdown succeeds\"", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2245#discussion_r427248758", "createdAt": "2020-05-19T12:05:06Z", "author": {"login": "mtopolnik"}, "path": "site/docs/how-tos/grpc.md", "diffHunk": "@@ -246,6 +246,15 @@ stage.mapUsingServiceAsyncBatched(bidiService,\n })\n ```\n \n+If your batch takes close to or more than 1 s (including the network", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba29ad5ce8a9337cf478164490ee68eca973c6d"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4704, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}