{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MDEwOTYz", "number": 4101, "title": "Plfm 6284", "bodyText": "", "createdAt": "2020-06-17T18:02:55Z", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101", "merged": true, "mergeCommit": {"oid": "4a52e1e945a05f3f6721567cf0ed7017401ba016"}, "closed": true, "closedAt": "2020-06-17T19:05:45Z", "author": {"login": "john-hill"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrpBofgH2gAyNDM2MDEwOTYzOjY5NzMwZGMyMzQ5YTFjYzExM2NhNGIzZWRhODJlYzYwYmU4N2VmYWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsOr5VAFqTQzMjY2MTMyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "69730dc2349a1cc113ca4b3eda82ec60be87efaf", "author": {"user": {"login": "john-hill", "name": "John Hill"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/69730dc2349a1cc113ca4b3eda82ec60be87efaf", "committedDate": "2020-06-15T23:12:43Z", "message": "changed parser for semantic version prefix to dash"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c1701b846615e9046927887485775649500167c", "author": {"user": {"login": "john-hill", "name": "John Hill"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/5c1701b846615e9046927887485775649500167c", "committedDate": "2020-06-15T23:45:02Z", "message": "changed test to accout for dash instead of slash"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88e1b7323ac62664a75705ad432d4e71d3199ff0", "author": {"user": {"login": "john-hill", "name": "John Hill"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/88e1b7323ac62664a75705ad432d4e71d3199ff0", "committedDate": "2020-06-16T00:06:28Z", "message": "manager level tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "973798df2a78c150a32843b3a7ea9b9cf5343bc5", "author": {"user": {"login": "john-hill", "name": "John Hill"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/973798df2a78c150a32843b3a7ea9b9cf5343bc5", "committedDate": "2020-06-16T01:13:39Z", "message": "changed Synapse schema boostrap to use dash and include concreteType for object types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3813e36439c5be705e0df58349a7a1310ad83381", "author": {"user": {"login": "john-hill", "name": "John Hill"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/3813e36439c5be705e0df58349a7a1310ad83381", "committedDate": "2020-06-16T18:53:44Z", "message": "more test fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3086fc81f71f38d3e95f09e1b3bf05fe82cec7db", "author": {"user": {"login": "john-hill", "name": "John Hill"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/3086fc81f71f38d3e95f09e1b3bf05fe82cec7db", "committedDate": "2020-06-17T01:46:10Z", "message": "fix IT test, java client, and manager to parse the  for controller methods"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae", "author": {"user": {"login": "john-hill", "name": "John Hill"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/753ca374faf501b6c0fd0b3f9fb96abcdee555ae", "committedDate": "2020-06-17T03:37:35Z", "message": "fix client delete"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNjYxMzI3", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101#pullrequestreview-432661327", "createdAt": "2020-06-17T18:22:46Z", "commit": {"oid": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae"}, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyMjo0NlrOGlRxKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOTowNDozMlrOGlTijQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MTYxMQ==", "bodyText": "schema id?", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101#discussion_r441741611", "createdAt": "2020-06-17T18:22:46Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/schema/JsonSchemaManagerImpl.java", "diffHunk": "@@ -301,33 +293,28 @@ public void truncateAll() {\n \n \t@WriteTransaction\n \t@Override\n-\tpublic void deleteSchemaAllVersion(UserInfo user, String organizationName, String schemaName) {\n+\tpublic void deleteSchemaById(UserInfo user, String $id) {\n \t\tValidateArgument.required(user, \"user\");\n-\t\tValidateArgument.required(organizationName, \"organizationName\");\n-\t\tValidateArgument.required(schemaName, \"schemaName\");\n-\t\tJsonSchemaVersionInfo versionInfo = jsonSchemaDao.getVersionLatestInfo(organizationName, schemaName);\n-\t\t// Must have delete on the organization\n-\t\tif (!user.isAdmin()) {\n-\t\t\taclDao.canAccess(user, versionInfo.getOrganizationId(), ObjectType.ORGANIZATION, ACCESS_TYPE.DELETE)\n-\t\t\t\t\t.checkAuthorizationOrElseThrow();\n+\t\tValidateArgument.required($id, \"organizationName\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MzI2OQ==", "bodyText": "There is a missing @OverRide in the implementation", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101#discussion_r441743269", "createdAt": "2020-06-17T18:25:45Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/schema/JsonSchemaManager.java", "diffHunk": "@@ -82,24 +82,7 @@\n \t * @param semanticVersion\n \t * @return\n \t */\n-\tJsonSchema getSchema(String organizationName, String schemaName, String semanticVersion);\n-\n-\t/**\n-\t * Attempt to delete all version of a schema.\n-\t * @param user\n-\t * @param organizationName\n-\t * @param schemaName\n-\t */\n-\tpublic void deleteSchemaAllVersion(UserInfo user, String organizationName, String schemaName);\n-\t\n-\t/**\n-\t * Delete a specific version of a schema.\n-\t * @param user\n-\t * @param organizationName\n-\t * @param schemaName\n-\t * @param semanticVersion\n-\t */\n-\tvoid deleteSchemaVersion(UserInfo user, String organizationName, String schemaName, String semanticVersion);\n+\tJsonSchema getSchema(String $id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc2ODEyNA==", "bodyText": "Please make sure that the published BNF in the controller docs (schema create?) for the schema is aligned with the dash.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101#discussion_r441768124", "createdAt": "2020-06-17T18:59:51Z", "author": {"login": "marcomarasca"}, "path": "services/repository/src/main/java/org/sagebionetworks/repo/web/controller/JsonSchemaController.java", "diffHunk": "@@ -275,38 +277,24 @@ public void deleteOrganization(@RequestParam(value = AuthorizationConstants.USER\n \t}\n \n \t/**\n-\t * Get a registered JSON schema using its $id. This method excludes the semantic\n-\t * version, and will return the latest version of the schema.\n+\t * Get a registered JSON schema using its $id.\n \t * \n \t * @param userId\n-\t * @param id     The $if of the schema to get.\n+\t * @param organizationName The organization name of the schema.\n+\t * @param schemaNameDashSemanticVersion The schema name with an optional dash semantic version.\n \t * @return\n \t */\n \t@RequiredScope({ view })\n \t@ResponseStatus(HttpStatus.OK)\n \t@RequestMapping(value = { UrlHelpers.JSON_SHCEMA_TYPE_REG_ORG_NAME }, method = RequestMethod.GET)\n-\tpublic @ResponseBody JsonSchema getJsonSchemaNoVersion(@PathVariable String organizationName,\n-\t\t\t@PathVariable String schemaName) {\n-\t\tString semanticVersion = null;\n-\t\treturn serviceProvider.getSchemaServices().getSchema(organizationName, schemaName, semanticVersion);\n+\tpublic @ResponseBody JsonSchema getJsonSchemaNoVersion(@PathVariable(required = true) String organizationName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3MDQ2MA==", "bodyText": "Should have the \"type\" property as \"string\"", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101#discussion_r441770460", "createdAt": "2020-06-17T19:04:11Z", "author": {"login": "marcomarasca"}, "path": "services/workers/src/test/resources/pets/Cat.json", "diffHunk": "@@ -10,6 +10,9 @@\n \t\"properties\": {\n \t\t\"breed\": {\n \t\t\t\"$ref\": \"my.organization/pets.cat.Breed\"\n+\t\t},\n+\t\t\"petType\": {\n+\t\t\t\"const\": \"cat\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3MDYzNw==", "bodyText": "Should have \"type\" property with value \"string\"", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101#discussion_r441770637", "createdAt": "2020-06-17T19:04:32Z", "author": {"login": "marcomarasca"}, "path": "services/workers/src/test/resources/pets/Dog.json", "diffHunk": "@@ -4,12 +4,15 @@\n \t\"description\": \"...\",\n \t\"allOf\": [\n \t\t{\n-\t\t\t\"$ref\": \"my.organization/pets.Pet/1.0.3\"\n+\t\t\t\"$ref\": \"my.organization/pets.Pet-1.0.3\"\n \t\t}\n \t],\n \t\"properties\": {\n \t\t\"breed\": {\n \t\t\t\"$ref\": \"my.organization/pets.dog.Breed\"\n+\t\t},\n+\t\t\"petType\": {\n+\t\t\t\"const\": \"dog\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4766, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}