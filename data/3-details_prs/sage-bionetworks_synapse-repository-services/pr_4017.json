{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4MjQ5OTgx", "number": 4017, "title": "Add new maxListLength field to ColumnModel allowing users to specify their own list size restriction (PLFM-6168)", "bodyText": "", "createdAt": "2020-04-23T23:26:14Z", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4017", "merged": true, "mergeCommit": {"oid": "78c7eb72ab9eea08d0fcc0b30aedebb521ebe3e7"}, "closed": true, "closedAt": "2020-04-24T23:09:04Z", "author": {"login": "zimingd"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaSbdkAH2gAyNDA4MjQ5OTgxOmFmMmViZjdlNzI5ZjMzNzM3OTQ5OGI0ZmZmODlhMDg3MTZkMGRiY2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABca5zhvgFqTQwMDMxNzkyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "af2ebf7e729f337379498b4fff89a08716d0dbce", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/af2ebf7e729f337379498b4fff89a08716d0dbce", "committedDate": "2020-04-23T01:16:24Z", "message": "listmax length to help estimate row query max size"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb393cbe4e066f4f6b58d70f7af70dc4edd66886", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/eb393cbe4e066f4f6b58d70f7af70dc4edd66886", "committedDate": "2020-04-23T02:07:12Z", "message": "test fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebf513a1415081033144ee860e6039764e5d2422", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/ebf513a1415081033144ee860e6039764e5d2422", "committedDate": "2020-04-23T03:05:42Z", "message": "fix test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjM5MTYx", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4017#pullrequestreview-400239161", "createdAt": "2020-04-24T20:09:40Z", "commit": {"oid": "ebf513a1415081033144ee860e6039764e5d2422"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDowOTo0MVrOGLndWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDowOTo0MVrOGLndWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzNDAwOQ==", "bodyText": "at least two", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4017#discussion_r414834009", "createdAt": "2020-04-24T20:09:41Z", "author": {"login": "john-hill"}, "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/persistence/table/ColumnModelUtils.java", "diffHunk": "@@ -235,6 +239,19 @@ public static ColumnModel createNormalizedClone(ColumnModel toClone, int maxEnum\n \t\t}\r\n \t}\r\n \r\n+\tstatic void validateListLengthForClone(ColumnModel clone){\r\n+\t\tif(clone.getMaximumListLength() == null){\r\n+\t\t\t// Use the default value\r\n+\t\t\tclone.setMaximumListLength(ColumnConstants.DEFAULT_LIST_LENGTH);\r\n+\t\t}else if(clone.getMaximumListLength() > ColumnConstants.MAX_ALLOWED_LIST_LENGTH){\r\n+\t\t\t// The max is beyond the allowed size\r\n+\t\t\tthrow new IllegalArgumentException(\"ColumnModel.maximumListLength for a LIST column cannot exceed: \"+ColumnConstants.MAX_ALLOWED_LIST_LENGTH);\r\n+\t\t} else if (clone.getMaximumListLength() < 0) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebf513a1415081033144ee860e6039764e5d2422"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjQ0MTI4", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4017#pullrequestreview-400244128", "createdAt": "2020-04-24T20:18:35Z", "commit": {"oid": "ebf513a1415081033144ee860e6039764e5d2422"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDoxODozNVrOGLnu9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDoxODozNVrOGLnu9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzODUxOQ==", "bodyText": "let  ColumnModelUtils.createDTOFromDBO(backup); handle the set to default (not setting it here)", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4017#discussion_r414838519", "createdAt": "2020-04-24T20:18:35Z", "author": {"login": "john-hill"}, "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/persistence/table/DBOColumnModel.java", "diffHunk": "@@ -116,7 +121,20 @@ public MigrationType getMigratableTableType() {\n \r\n \t@Override\r\n \tpublic MigratableTableTranslation<DBOColumnModel, DBOColumnModel> getTranslator() {\r\n-\t\treturn new BasicMigratableTableTranslation<DBOColumnModel>();\r\n+\t\treturn new BasicMigratableTableTranslation<DBOColumnModel>(){\r\n+\t\t\t@TemporaryCode(author=\"ziming\", comment = \"one-time migration change. remove after stack 309\")\r\n+\t\t\t@Override\r\n+\t\t\tpublic DBOColumnModel createDatabaseObjectFromBackup(DBOColumnModel backup) {\r\n+\t\t\t\t//doing this round trip will assign default value to maxListLength\r\n+\t\t\t\tColumnModel columnModel = ColumnModelUtils.createDTOFromDBO(backup);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebf513a1415081033144ee860e6039764e5d2422"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjUxMzQ4", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4017#pullrequestreview-400251348", "createdAt": "2020-04-24T20:31:08Z", "commit": {"oid": "ebf513a1415081033144ee860e6039764e5d2422"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDozMTowOVrOGLoJEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDozMTowOVrOGLoJEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg0NTIwMA==", "bodyText": "eliminate the default and just use the max (100)", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4017#discussion_r414845200", "createdAt": "2020-04-24T20:31:09Z", "author": {"login": "john-hill"}, "path": "lib/jdomodels/src/test/java/org/sagebionetworks/repo/model/dbo/persistence/table/DBOColumnModelTempTest.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package org.sagebionetworks.repo.model.dbo.persistence.table;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNotEquals;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.sagebionetworks.StackConfigurationSingleton;\n+import org.sagebionetworks.repo.model.dbo.migration.MigratableTableTranslation;\n+import org.sagebionetworks.repo.model.table.ColumnConstants;\n+import org.sagebionetworks.repo.model.table.ColumnModel;\n+import org.sagebionetworks.repo.model.table.ColumnType;\n+import org.sagebionetworks.util.TemporaryCode;\n+\n+@TemporaryCode(author = \"ziming\", comment = \"one-time migration change. remove after stack 309\")\n+public class DBOColumnModelTempTest {\n+\n+\tprivate MigratableTableTranslation<DBOColumnModel, DBOColumnModel> translator;\n+\n+\t@BeforeEach\n+\tpublic void setup() {\n+\t\ttranslator = new DBOColumnModel().getTranslator();\n+\t}\n+\n+\t@Test\n+\tpublic void testTranslator_noMaxListLength() {\n+\t\tColumnModel noMaxListLength = new ColumnModel();\n+\t\tnoMaxListLength.setId(\"123\");\n+\t\tnoMaxListLength.setColumnType(ColumnType.INTEGER_LIST);\n+\t\tnoMaxListLength.setName(\"name\");\n+\n+\t\tColumnModel modifiedColumnModel = translateColumnModel(noMaxListLength);\n+\n+\t\tassertNotEquals(noMaxListLength, modifiedColumnModel);\n+\t\tassertEquals(ColumnConstants.MAX_ALLOWED_LIST_LENGTH, modifiedColumnModel.getMaximumListLength());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebf513a1415081033144ee860e6039764e5d2422"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMjUxNjYy", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4017#pullrequestreview-400251662", "createdAt": "2020-04-24T20:31:42Z", "commit": {"oid": "ebf513a1415081033144ee860e6039764e5d2422"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDozMTo0MlrOGLoKRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQyMDozMTo0MlrOGLoKRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg0NTUxMA==", "bodyText": "default 100", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4017#discussion_r414845510", "createdAt": "2020-04-24T20:31:42Z", "author": {"login": "john-hill"}, "path": "lib/lib-auto-generated/src/main/resources/schema/org/sagebionetworks/repo/model/table/ColumnModel.json", "diffHunk": "@@ -82,6 +82,10 @@\n             \"type\": \"integer\",\n             \"description\": \"A parameter for columnTypes with a maximum size.  For example, ColumnType.STRINGs have a default maximum size of 50 characters, but can be set to a maximumSize of 1 to 1000 characters.\"\n         },\n+        \"maximumListLength\": {\n+            \"type\": \"integer\",\n+            \"description\": \"Required if using a columnType with a \\\"_LIST\\\" suffix. Describes the maximum number of values that will appear in that list. Value range 1-100 inclusive. Default 25\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebf513a1415081033144ee860e6039764e5d2422"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0dc5a953926c5a2e9beb49be30bfd0c79c8b683", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/b0dc5a953926c5a2e9beb49be30bfd0c79c8b683", "committedDate": "2020-04-24T21:42:30Z", "message": "code review changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMzE3OTI4", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4017#pullrequestreview-400317928", "createdAt": "2020-04-24T23:08:59Z", "commit": {"oid": "b0dc5a953926c5a2e9beb49be30bfd0c79c8b683"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4671, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}