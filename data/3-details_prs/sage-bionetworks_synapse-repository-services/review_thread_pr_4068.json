{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2MTM3MDUy", "number": 4068, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxODoxMTo0NVrOEB3Qbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxODoyMzo1MFrOEB3rYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMzg5MzU5OnYy", "diffSide": "RIGHT", "path": "services/repository/src/main/java/org/sagebionetworks/repo/web/UrlHelpers.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxODoxMTo0NlrOGd-Daw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxODoxMTo0NlrOGd-Daw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA3ODU3MQ==", "bodyText": "Might want to consider simplifying the URL to just /entity/{id}/schema/binding or /entity/{id}/jsonschema/binding", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4068#discussion_r434078571", "createdAt": "2020-06-02T18:11:46Z", "author": {"login": "marcomarasca"}, "path": "services/repository/src/main/java/org/sagebionetworks/repo/web/UrlHelpers.java", "diffHunk": "@@ -232,6 +232,7 @@\n \tpublic static final String COPY = \"/copy\";\n \tpublic static final String FILE_HANDLES_COPY = FILE_HANDLES + COPY;\n \tpublic static final String ENTITY_DATA_TYPE = ENTITY_ID+\"/datatype\";\n+\tpublic static final String ENTITY_BIND_JSON_SCHEMA = ENTITY_ID+\"/bound/json/schema\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71ca201336cbfc4dd69657388704ee0bff3b9fd1"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMzk1Mzk4OnYy", "diffSide": "RIGHT", "path": "lib/jdomodels/src/test/java/org/sagebionetworks/repo/model/dbo/dao/NodeDAOImplTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxODoyMjoyNFrOGd-oyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxODoyMjoyNFrOGd-oyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA4ODEzOA==", "bodyText": "Might want to rename to boundEntityId, also the name of the method findFirstBoundJsonSchema might be findFirstNodeIdBoundJsonSchema", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4068#discussion_r434088138", "createdAt": "2020-06-02T18:22:24Z", "author": {"login": "marcomarasca"}, "path": "lib/jdomodels/src/test/java/org/sagebionetworks/repo/model/dbo/dao/NodeDAOImplTest.java", "diffHunk": "@@ -4214,4 +4222,84 @@ public void testGetNameNotFound() {\n \t\t\tnodeDao.getNodeName(\"syn999999\");\r\n \t\t});\r\n \t}\r\n+\t\r\n+\t@Test\r\n+\tpublic void testFindFirstBoundJsonSchema() throws JSONObjectAdapterException {\r\n+\t\tjsonSchemaTestHelper.truncateAll();\r\n+\t\t// Setup some hierarchy.\r\n+\t\t// grandparent\r\n+\t\tNode grandparent = NodeTestUtils.createNew(\"grandparent\", creatorUserGroupId);\r\n+\t\tgrandparent = nodeDao.createNewNode(grandparent);\r\n+\t\tLong grandId = KeyFactory.stringToKey(grandparent.getId());\r\n+\t\ttoDelete.add(grandparent.getId());\r\n+\t\t// parent\r\n+\t\tNode parent = NodeTestUtils.createNew(\"parent\", creatorUserGroupId);\r\n+\t\tparent.setParentId(grandparent.getId());\r\n+\t\tparent = nodeDao.createNewNode(parent);\r\n+\t\tLong parentId = KeyFactory.stringToKey(parent.getId());\r\n+\t\ttoDelete.add(parent.getId());\r\n+\t\t// child\r\n+\t\tNode child = NodeTestUtils.createNew(\"child\", creatorUserGroupId);\r\n+\t\tchild.setParentId(parent.getId());\r\n+\t\tchild = nodeDao.createNewNode(child);\r\n+\t\tLong childId = KeyFactory.stringToKey(child.getId());\r\n+\t\ttoDelete.add(child.getId());\r\n+\r\n+\t\tString schema$id = \"my.org/foo.bar/1.2.3\";\r\n+\t\tint index = 0;\r\n+\t\tJsonSchemaVersionInfo schemaInfo = jsonSchemaTestHelper.createNewSchemaVersion(creatorUserGroupId, schema$id,\r\n+\t\t\t\tindex);\r\n+\t\t// bind the schema to the grand parent\r\n+\t\tJsonSchemaObjectBinding binding = jsonSchemaTestHelper.bindSchemaToObject(creatorUserGroupId, schema$id,\r\n+\t\t\t\tgrandId, BoundObjectType.entity);\r\n+\r\n+\t\t// call under test\r\n+\t\tLong boundId = nodeDao.findFirstBoundJsonSchema(childId);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71ca201336cbfc4dd69657388704ee0bff3b9fd1"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwMzk2MjU5OnYy", "diffSide": "RIGHT", "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/NodeDAOImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxODoyMzo1MFrOGd-t-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxODoyMzo1MFrOGd-t-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA4OTQ2NA==", "bodyText": "We might want to expose the max depth as a parameter so we can test it and set the default at the manager level", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4068#discussion_r434089464", "createdAt": "2020-06-02T18:23:50Z", "author": {"login": "marcomarasca"}, "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/NodeDAOImpl.java", "diffHunk": "@@ -2034,5 +2039,29 @@ public String getNodeName(String nodeId) {\n \t\t\tthrow new NotFoundException();\n \t\t}\n \t}\n+\t\n+\n+\t@Override\n+\tpublic Long findFirstBoundJsonSchema(Long nodeId) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71ca201336cbfc4dd69657388704ee0bff3b9fd1"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3061, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}