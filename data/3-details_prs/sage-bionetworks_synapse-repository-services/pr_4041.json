{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3MDE4NjI1", "number": 4041, "title": "additional LIKE filter API (PLFM-6192)", "bodyText": "", "createdAt": "2020-05-12T23:01:11Z", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4041", "merged": true, "mergeCommit": {"oid": "06921efae39eecb68901ee2dfaa72e7d952b44b0"}, "closed": true, "closedAt": "2020-05-15T23:17:44Z", "author": {"login": "zimingd"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgsdTGgH2gAyNDE3MDE4NjI1OjZjN2M2ODNkZWVhZDkxYzc5YjJiYzgyN2MwOTFmZDhhNTNmNGY0ZmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchqg3xAFqTQxMzAxNDYxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6c7c683deead91c79b2bc827c091fd8a53f4f4fa", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/6c7c683deead91c79b2bc827c091fd8a53f4f4fa", "committedDate": "2020-05-12T22:59:29Z", "message": "additional like filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57ff0b9182ada63a6a03813480861e37969f6fe2", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/57ff0b9182ada63a6a03813480861e37969f6fe2", "committedDate": "2020-05-12T23:13:24Z", "message": "wire up usage of additonal filters. make additonal filters modify resulting sql"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02c2a6e5768a7f222722271b2e5beeb7826d691f", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/02c2a6e5768a7f222722271b2e5beeb7826d691f", "committedDate": "2020-05-12T23:19:16Z", "message": "fix NPE"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTE3NTQw", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4041#pullrequestreview-410517540", "createdAt": "2020-05-13T00:53:51Z", "commit": {"oid": "02c2a6e5768a7f222722271b2e5beeb7826d691f"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMDo1Mzo1MVrOGUd32w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwMToyMDoxNlrOGUeRog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDExNDEzOQ==", "bodyText": "Consider naming this as ColumnValueFilter and use an Enum with the supported Operators so we could extend it in the future.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4041#discussion_r424114139", "createdAt": "2020-05-13T00:53:51Z", "author": {"login": "marcomarasca"}, "path": "lib/lib-auto-generated/src/main/resources/schema/org/sagebionetworks/repo/model/table/LikeQueryFilter.json", "diffHunk": "@@ -0,0 +1,17 @@\n+{\n+\t\"implements\": [{\"$ref\":\"org.sagebionetworks.repo.model.table.QueryFilter\"}],\n+\t\"description\": \"A LIKE filter against a column. Values within the values list have an OR relationship\",\n+\t\"properties\": {\n+\t\t\"columnName\":{\n+\t\t\t\"type\": \"string\",\n+\t\t\t\"description\": \"name of the column to filter\"\n+\t\t},", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02c2a6e5768a7f222722271b2e5beeb7826d691f"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDExODY0MQ==", "bodyText": "Consider move this to the SQLTranslatorUtils and rename it to translateQueryFilters", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4041#discussion_r424118641", "createdAt": "2020-05-13T01:11:51Z", "author": {"login": "marcomarasca"}, "path": "lib/lib-table-cluster/src/main/java/org/sagebionetworks/table/cluster/SQLUtils.java", "diffHunk": "@@ -2046,4 +2047,63 @@ public static String getViewScopeSubTypeFilter(ViewScopeFilter scopeFilter) {\n \t\t\r\n \t\treturn builder.toString();\r\n \t}\r\n+\r\n+\tpublic static String appendAdditionalFilters(List<QueryFilter> additionalFilters){\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02c2a6e5768a7f222722271b2e5beeb7826d691f"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDEyMDczOA==", "bodyText": "We could probably make this method generic (maybe move it to some query/sql util class) and reuse it for facets", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4041#discussion_r424120738", "createdAt": "2020-05-13T01:20:16Z", "author": {"login": "marcomarasca"}, "path": "lib/lib-table-cluster/src/main/java/org/sagebionetworks/table/cluster/SqlQuery.java", "diffHunk": "@@ -178,6 +182,20 @@ public SqlQuery(\n \t\t\tSelectList expandedSelectList = SQLTranslatorUtils.createSelectListFromSchema(tableSchema);\r\n \t\t\tthis.model.replaceSelectList(expandedSelectList);\r\n \t\t}\r\n+\r\n+\r\n+\t\t//Append additionalFilters onto the WHERE clause\r\n+\t\tif(additionalFilters != null && !additionalFilters.isEmpty()) {\r\n+\t\t\tString additionalFilterSearchCondition = SQLUtils.appendAdditionalFilters(additionalFilters);\r\n+\t\t\tStringBuilder whereClauseBuilder = new StringBuilder();\r\n+\t\t\tFacetUtils.appendFacetWhereClauseToStringBuilderIfNecessary(whereClauseBuilder,additionalFilterSearchCondition, this.model.getTableExpression().getWhereClause());\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02c2a6e5768a7f222722271b2e5beeb7826d691f"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0b4734632919fb34d28388cfc4fb00768df763e", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/b0b4734632919fb34d28388cfc4fb00768df763e", "committedDate": "2020-05-14T02:24:17Z", "message": "move static methods to diffent classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "891243d537c70d9be710fb1f911a83860143d224", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/891243d537c70d9be710fb1f911a83860143d224", "committedDate": "2020-05-14T02:41:57Z", "message": "use enum for QueryFilter operators"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44b1d4366d517e3a28c668a23cd8555013e87307", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/44b1d4366d517e3a28c668a23cd8555013e87307", "committedDate": "2020-05-14T04:25:49Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3fb5449cca4929174e60e60b327296a3dae44c5", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/e3fb5449cca4929174e60e60b327296a3dae44c5", "committedDate": "2020-05-15T23:09:23Z", "message": "Merge branch 'develop' into PLFM-6192"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMDE0NjEx", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4041#pullrequestreview-413014611", "createdAt": "2020-05-15T23:17:30Z", "commit": {"oid": "e3fb5449cca4929174e60e60b327296a3dae44c5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4707, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}