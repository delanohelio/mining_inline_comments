{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1MjI2MzI2", "number": 4066, "title": "PLFM-6159: Code review follow up", "bodyText": "", "createdAt": "2020-05-29T17:14:22Z", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4066", "merged": true, "mergeCommit": {"oid": "c8cdda07a23649d274bf007bafc9e18587227372"}, "closed": true, "closedAt": "2020-06-02T01:18:57Z", "author": {"login": "marcomarasca"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcl3vmXgH2gAyNDI1MjI2MzI2OjE1ZjNhMzFhNDIyOTNlMTBjMDQ1NDZkNmJlNzFhM2NiMGI4MzczMDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnKcFHgFqTQyMjI4MDc4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "15f3a31a42293e10c04546d6be71a3cb0b837305", "author": {"user": {"login": "marcomarasca", "name": "Marco Marasca"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/15f3a31a42293e10c04546d6be71a3cb0b837305", "committedDate": "2020-05-29T00:58:03Z", "message": "PLFM-6159: Simplify findByName in DefaultColumnModel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97d4f05ae1fb5a6f2d1e6bcc545ebfb204932b2c", "author": {"user": {"login": "marcomarasca", "name": "Marco Marasca"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/97d4f05ae1fb5a6f2d1e6bcc545ebfb204932b2c", "committedDate": "2020-05-29T00:58:03Z", "message": "PLFM-6159: Removed modifiedBy from submission view columns"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f28c892366df2baa7794ccea869eb3f287ab002d", "author": {"user": {"login": "marcomarasca", "name": "Marco Marasca"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/f28c892366df2baa7794ccea869eb3f287ab002d", "committedDate": "2020-05-29T00:58:03Z", "message": "PLFM-6159: New integration test with multiple evaluations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db9c6760d6e8c5b4e007cb94630677705f8125eb", "author": {"user": {"login": "marcomarasca", "name": "Marco Marasca"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/db9c6760d6e8c5b4e007cb94630677705f8125eb", "committedDate": "2020-05-29T00:58:03Z", "message": "PLFM-6159: Additional tests on new column types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1664a84f87857b9dd22eadfc18c3ffd8c1ca8778", "author": {"user": {"login": "marcomarasca", "name": "Marco Marasca"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/1664a84f87857b9dd22eadfc18c3ffd8c1ca8778", "committedDate": "2020-05-29T01:29:34Z", "message": "PLFM-6159: Added submission view client integration test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e7f4fc21f709a6c3238db68db4195941ed353f6", "author": {"user": {"login": "marcomarasca", "name": "Marco Marasca"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/5e7f4fc21f709a6c3238db68db4195941ed353f6", "committedDate": "2020-05-29T02:03:42Z", "message": "PLFM-6159: New enumeration with subset of view entity types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dabaf1f3f8312ca02b490b505f00ad5c33a915a", "author": {"user": {"login": "marcomarasca", "name": "Marco Marasca"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/7dabaf1f3f8312ca02b490b505f00ad5c33a915a", "committedDate": "2020-05-29T02:34:50Z", "message": "PLFM-6159: Remove ViewScopeUtils"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "240f8c3a5c5b119f9ae1b5d40baea73a38dc0bad", "author": {"user": {"login": "marcomarasca", "name": "Marco Marasca"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/240f8c3a5c5b119f9ae1b5d40baea73a38dc0bad", "committedDate": "2020-05-29T03:35:19Z", "message": "PLFM-6159: ACL check optimization for submission views"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjc4NTYx", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4066#pullrequestreview-422278561", "createdAt": "2020-06-02T01:10:53Z", "commit": {"oid": "240f8c3a5c5b119f9ae1b5d40baea73a38dc0bad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwMToxMDo1M1rOGde5SA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwMToxMDo1M1rOGde5SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2ODA3Mg==", "bodyText": "need a better name.  maybe getAccessibleIds()", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4066#discussion_r433568072", "createdAt": "2020-06-02T01:10:53Z", "author": {"login": "john-hill"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/evaluation/manager/EvaluationPermissionsManagerImpl.java", "diffHunk": "@@ -144,24 +147,61 @@ public AccessControlList getAcl(UserInfo userInfo, String evalId)\n \t@Override\n \tpublic AuthorizationStatus hasAccess(UserInfo userInfo, String evalId, ACCESS_TYPE accessType)\n \t\t\tthrows NotFoundException, DatastoreException {\n-\t\tif (userInfo == null) {\n-\t\t\tthrow new IllegalArgumentException(\"User info cannot be null.\");\n-\t\t}\n \t\tif (evalId == null || evalId.isEmpty()) {\n \t\t\tthrow new IllegalArgumentException(\"Evaluation ID cannot be null or empty.\");\n \t\t}\n+\n+\t\treturn hasAccess(userInfo, accessType).orElseGet(() -> {\n+\t\t\tif (!aclDAO.canAccess(userInfo.getGroups(), evalId, ObjectType.EVALUATION, accessType)) {\n+\t\t\t\treturn AuthorizationStatus.accessDenied(\"User lacks \"+accessType+\" access to Evaluation \"+evalId);\n+\t\t\t}\n+\t\t\t\n+\t\t\treturn AuthorizationStatus.authorized();\n+\t\t});\n+\t}\n+\t\n+\t@Override\n+\tpublic AuthorizationStatus hasAccess(UserInfo userInfo, ACCESS_TYPE accessType, List<String> evaluationIds)\n+\t\t\tthrows NotFoundException, DatastoreException {\n+\t\tif (evaluationIds == null || evaluationIds.isEmpty()) {\n+\t\t\tthrow new IllegalArgumentException(\"The set of evaluation ids cannot be null or empty.\");\n+\t\t}\n+\t\t\n+\t\tSet<Long> benefactorIds = evaluationIds.stream()\n+\t\t\t\t.map((id) -> KeyFactory.stringToKey(id))\n+\t\t\t\t.collect(Collectors.toSet());\n+\t\t\n+\t\treturn hasAccess(userInfo, accessType).orElseGet(() -> {\n+\t\t\tSet<Long> accessibleSet = aclDAO.getAccessibleBenefactors(userInfo.getGroups(), benefactorIds, ObjectType.EVALUATION, accessType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "240f8c3a5c5b119f9ae1b5d40baea73a38dc0bad"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMjgwNzg2", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4066#pullrequestreview-422280786", "createdAt": "2020-06-02T01:18:51Z", "commit": {"oid": "240f8c3a5c5b119f9ae1b5d40baea73a38dc0bad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4737, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}