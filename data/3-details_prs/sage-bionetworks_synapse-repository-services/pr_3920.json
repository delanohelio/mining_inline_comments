{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4ODM0NzA0", "number": 3920, "title": "make multi-value work for tables again (PLFM-6058)", "bodyText": "", "createdAt": "2020-01-30T00:36:47Z", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920", "merged": true, "mergeCommit": {"oid": "7a580c41ee3a3be50c04415cbea1f9f74488b6d9"}, "closed": true, "closedAt": "2020-02-01T00:27:56Z", "author": {"login": "zimingd"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-5aSSAH2gAyMzY4ODM0NzA0OjUyMGE4NmFkODhlZjVkMTU2MDEzZGE0Y2FmNGI4NWI5MmRmYzk5MmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_4lh3AFqTM1MTg0NjA2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "520a86ad88ef5d156013da4caf4b85b92dfc992d", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/520a86ad88ef5d156013da4caf4b85b92dfc992d", "committedDate": "2020-01-28T22:51:32Z", "message": "fix tables for multi-value columns"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cff3c2c4f37b6047a5000856aeb55f6aa0a2281", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/6cff3c2c4f37b6047a5000856aeb55f6aa0a2281", "committedDate": "2020-01-29T03:23:22Z", "message": "keep in transaction and add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99c1336ef94430d95d0bcaccd931010d92751db0", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/99c1336ef94430d95d0bcaccd931010d92751db0", "committedDate": "2020-01-29T03:57:50Z", "message": "fix duplicate key insert for index tables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cd0894ff012d148400894649edd9cf54ca3df70", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/1cd0894ff012d148400894649edd9cf54ca3df70", "committedDate": "2020-01-29T04:42:55Z", "message": "start code for migrating IT100TableControllerTest test into TableViewIntegrationTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abed699400a33a92ab66d42c8d1eed17d41133c7", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/abed699400a33a92ab66d42c8d1eed17d41133c7", "committedDate": "2020-01-30T00:32:23Z", "message": "transfer IT test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a382fd138e11d2f4212c28b1b16ba0e50702332d", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/a382fd138e11d2f4212c28b1b16ba0e50702332d", "committedDate": "2020-01-30T00:33:20Z", "message": "Merge branch 'develop' of github.com:Sage-Bionetworks/Synapse-Repository-Services into PLFM-6058-row-diff-only"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNTMyMDU2", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#pullrequestreview-350532056", "createdAt": "2020-01-30T01:18:21Z", "commit": {"oid": "a382fd138e11d2f4212c28b1b16ba0e50702332d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwMToxODoyMVrOFjc2nA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwMToxODoyMVrOFjc2nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjcxNzIxMg==", "bodyText": "will delete then add instead.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#discussion_r372717212", "createdAt": "2020-01-30T01:18:21Z", "author": {"login": "john-hill"}, "path": "lib/lib-table-cluster/src/main/java/org/sagebionetworks/table/cluster/SQLUtils.java", "diffHunk": "@@ -1965,7 +1965,8 @@ public static String insertIntoListColumnIndexTable(IdAndVersion tableIdAndVersi\n \t\t\t\t\" ORDINAL FOR ORDINALITY, \" +\r\n \t\t\t\t\" COLUMN_EXPAND \" + columnExpandTypeSQl + \" PATH '$'\" +\r\n \t\t\t\t\" )\" +\r\n-\t\t\t\t\") TEMP_JSON_TABLE\"+rowFilter;\r\n+\t\t\t\t\") TEMP_JSON_TABLE\"+rowFilter+\r\n+\t\t\t\t\" ON DUPLICATE KEY UPDATE \" + unnestedColumnName + \"=\" + \"TEMP_JSON_TABLE.COLUMN_EXPAND\";\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a382fd138e11d2f4212c28b1b16ba0e50702332d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNTM1MjQ2", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#pullrequestreview-350535246", "createdAt": "2020-01-30T01:29:42Z", "commit": {"oid": "a382fd138e11d2f4212c28b1b16ba0e50702332d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwMToyOTo0MlrOFjdBXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwMToyOTo0MlrOFjdBXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjcxOTk2NQ==", "bodyText": "can add a new type of grouping to SparseChangeSet, then iterate over new grouping and both delete then add for each group of rows for each list column.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#discussion_r372719965", "createdAt": "2020-01-30T01:29:42Z", "author": {"login": "john-hill"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/table/TableIndexManagerImpl.java", "diffHunk": "@@ -109,9 +116,37 @@ public Void doInTransaction(TransactionStatus status) {\n \t\t\t\t\t\t\t// set the new max version for the index\r\n \t\t\t\t\t\t\ttableIndexDao.setMaxCurrentCompleteVersionForTable(\r\n \t\t\t\t\t\t\t\t\ttableId, changeSetVersionNumber);\r\n+\r\n+\t\t\t\t\t\t\t//once all changes to main table are applied, populate the list-type columns with the changes.\r\n+\t\t\t\t\t\t\tfor(Map.Entry<ColumnModel, Set<Long>> entry : listColumnsToRowIdMap.entrySet()){\r\n+\t\t\t\t\t\t\t\ttableIndexDao.populateListColumnIndexTable(tableId, entry.getKey(), entry.getValue());\r\n+\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\treturn null;\r\n \t\t\t\t\t\t}\r\n \t\t\t\t\t});\r\n+\r\n+\r\n+\t\t}\r\n+\t}\r\n+\r\n+\tpublic static void recordListColumnChanges(Map<ColumnModel, Set<Long>> listColumnsToRowIdMap, Grouping grouping){\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a382fd138e11d2f4212c28b1b16ba0e50702332d"}, "originalPosition": 96}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52144091520f021c00f19d4052818910e154f806", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/52144091520f021c00f19d4052818910e154f806", "committedDate": "2020-01-31T01:31:20Z", "message": "undo on duplicate key update for populating list column indexes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1b6a7522500a88266926b91ea133534363b3367", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/d1b6a7522500a88266926b91ea133534363b3367", "committedDate": "2020-01-31T02:01:36Z", "message": "add method to delete from a list column index table to TableIndexDao"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ce3c819a6dfc89efc9d1771f839faf012b7bc8b", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/6ce3c819a6dfc89efc9d1771f839faf012b7bc8b", "committedDate": "2020-01-31T06:31:02Z", "message": "use sparse row grouping for list columns"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "179586636018fef0e0fe21b4968bd30698ba414a", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/179586636018fef0e0fe21b4968bd30698ba414a", "committedDate": "2020-01-31T19:52:57Z", "message": "Merge branch 'develop' of github.com:Sage-Bionetworks/Synapse-Repository-Services into PLFM-6058-row-diff-only"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8339b7f8c7bc43c344134ccf1efea14036dfbdc7", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/8339b7f8c7bc43c344134ccf1efea14036dfbdc7", "committedDate": "2020-01-31T20:45:16Z", "message": "undo unnecessary change in test setup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNzk3MDgz", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#pullrequestreview-351797083", "createdAt": "2020-01-31T21:46:59Z", "commit": {"oid": "8339b7f8c7bc43c344134ccf1efea14036dfbdc7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMTo0Njo1OVrOFkY19A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMTo0Njo1OVrOFkY19A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcwMDA4NA==", "bodyText": "only one null?", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#discussion_r373700084", "createdAt": "2020-01-31T21:46:59Z", "author": {"login": "john-hill"}, "path": "lib/lib-table-cluster/src/test/java/org/sagebionetworks/table/cluster/TableIndexDAOImplTest.java", "diffHunk": "@@ -2597,6 +2598,117 @@ public void testCreateAndPopulateListColumnIndexTables__StringListDataTooLarge()\n \t\tassertEquals(\"The size of the column 'myList' is too small.\" +\r\n \t\t\t\t\" Unable to automatically determine the necessary size to fit all values in a STRING_LIST column\", message);\r\n \t}\r\n+\r\n+\t@Test\r\n+\tpublic void testDeleteFromListColumnIndexTable_NullTableId() {\r\n+\t\ttableId = null;\r\n+\t\tColumnModel multiValue = new ColumnModel();\r\n+\t\tmultiValue.setId(\"886\");\r\n+\t\tmultiValue.setColumnType(ColumnType.STRING_LIST);\r\n+\t\tmultiValue.setName(\"multiValue\");\r\n+\t\tmultiValue.setMaximumSize(100L);\r\n+\t\tSet<Long> rowIdFilter = null;\r\n+\t\tassertThrows(IllegalArgumentException.class, ()->{\r\n+\t\t\t// call under test\r\n+\t\t\ttableIndexDAO.deleteFromListColumnIndexTable(tableId, multiValue, rowIdFilter);\r\n+\t\t});\r\n+\t}\r\n+\r\n+\t@Test\r\n+\tpublic void testDeleteFromListColumnIndexTable_NullColumn() {\r\n+\t\tColumnModel multiValue = null;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8339b7f8c7bc43c344134ccf1efea14036dfbdc7"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNzk3NDUw", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#pullrequestreview-351797450", "createdAt": "2020-01-31T21:47:46Z", "commit": {"oid": "8339b7f8c7bc43c344134ccf1efea14036dfbdc7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMTo0Nzo0NlrOFkY3BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMTo0Nzo0NlrOFkY3BQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcwMDM1Nw==", "bodyText": "member for the null helps reader see what is null", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#discussion_r373700357", "createdAt": "2020-01-31T21:47:46Z", "author": {"login": "john-hill"}, "path": "lib/lib-table-cluster/src/test/java/org/sagebionetworks/table/cluster/TableIndexDAOImplTest.java", "diffHunk": "@@ -2597,6 +2598,117 @@ public void testCreateAndPopulateListColumnIndexTables__StringListDataTooLarge()\n \t\tassertEquals(\"The size of the column 'myList' is too small.\" +\r\n \t\t\t\t\" Unable to automatically determine the necessary size to fit all values in a STRING_LIST column\", message);\r\n \t}\r\n+\r\n+\t@Test\r\n+\tpublic void testDeleteFromListColumnIndexTable_NullTableId() {\r\n+\t\ttableId = null;\r\n+\t\tColumnModel multiValue = new ColumnModel();\r\n+\t\tmultiValue.setId(\"886\");\r\n+\t\tmultiValue.setColumnType(ColumnType.STRING_LIST);\r\n+\t\tmultiValue.setName(\"multiValue\");\r\n+\t\tmultiValue.setMaximumSize(100L);\r\n+\t\tSet<Long> rowIdFilter = null;\r\n+\t\tassertThrows(IllegalArgumentException.class, ()->{\r\n+\t\t\t// call under test\r\n+\t\t\ttableIndexDAO.deleteFromListColumnIndexTable(tableId, multiValue, rowIdFilter);\r\n+\t\t});\r\n+\t}\r\n+\r\n+\t@Test\r\n+\tpublic void testDeleteFromListColumnIndexTable_NullColumn() {\r\n+\t\tColumnModel multiValue = null;\r\n+\t\tSet<Long> rowIdFilter = null;\r\n+\t\tassertThrows(IllegalArgumentException.class, ()->{\r\n+\t\t\t// call under test\r\n+\t\t\ttableIndexDAO.populateListColumnIndexTable(tableId, multiValue, rowIdFilter);\r\n+\t\t});\r\n+\t}\r\n+\r\n+\t@Test\r\n+\tpublic void testDeleteFromListColumnIndexTable_NotListType() {\r\n+\t\tColumnModel multiValue = new ColumnModel();\r\n+\t\tmultiValue.setId(\"886\");\r\n+\t\tmultiValue.setColumnType(ColumnType.STRING);\r\n+\t\tmultiValue.setName(\"multiValue\");\r\n+\t\tmultiValue.setMaximumSize(100L);\r\n+\t\tSet<Long> rowIdFilter = Sets.newHashSet(1L);\r\n+\t\tString message = assertThrows(IllegalArgumentException.class, ()->{\r\n+\t\t\t// call under test\r\n+\t\t\ttableIndexDAO.deleteFromListColumnIndexTable(tableId, multiValue, rowIdFilter);\r\n+\t\t}).getMessage();\r\n+\t\tassertEquals(\"Only valid for List type columns\", message);\r\n+\t}\r\n+\r\n+\t@Test\r\n+\tpublic void testDeleteFromListColumnIndexTable_nullRowFilter() {\r\n+\t\tColumnModel multiValue = new ColumnModel();\r\n+\t\tmultiValue.setId(\"886\");\r\n+\t\tmultiValue.setColumnType(ColumnType.STRING_LIST);\r\n+\t\tmultiValue.setName(\"multiValue\");\r\n+\t\tmultiValue.setMaximumSize(100L);\r\n+\t\tString message = assertThrows(IllegalArgumentException.class, ()->{\r\n+\t\t\t// call under test\r\n+\t\t\ttableIndexDAO.deleteFromListColumnIndexTable(tableId, multiValue, null);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8339b7f8c7bc43c344134ccf1efea14036dfbdc7"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNzk4MjIz", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#pullrequestreview-351798223", "createdAt": "2020-01-31T21:49:31Z", "commit": {"oid": "8339b7f8c7bc43c344134ccf1efea14036dfbdc7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMTo0OTozMVrOFkY5bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMTo0OTozMVrOFkY5bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcwMDk3NA==", "bodyText": "can use the helper for the counts", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#discussion_r373700974", "createdAt": "2020-01-31T21:49:31Z", "author": {"login": "john-hill"}, "path": "lib/lib-table-cluster/src/test/java/org/sagebionetworks/table/cluster/TableIndexDAOImplTest.java", "diffHunk": "@@ -2597,6 +2598,117 @@ public void testCreateAndPopulateListColumnIndexTables__StringListDataTooLarge()\n \t\tassertEquals(\"The size of the column 'myList' is too small.\" +\r\n \t\t\t\t\" Unable to automatically determine the necessary size to fit all values in a STRING_LIST column\", message);\r\n \t}\r\n+\r\n+\t@Test\r\n+\tpublic void testDeleteFromListColumnIndexTable_NullTableId() {\r\n+\t\ttableId = null;\r\n+\t\tColumnModel multiValue = new ColumnModel();\r\n+\t\tmultiValue.setId(\"886\");\r\n+\t\tmultiValue.setColumnType(ColumnType.STRING_LIST);\r\n+\t\tmultiValue.setName(\"multiValue\");\r\n+\t\tmultiValue.setMaximumSize(100L);\r\n+\t\tSet<Long> rowIdFilter = null;\r\n+\t\tassertThrows(IllegalArgumentException.class, ()->{\r\n+\t\t\t// call under test\r\n+\t\t\ttableIndexDAO.deleteFromListColumnIndexTable(tableId, multiValue, rowIdFilter);\r\n+\t\t});\r\n+\t}\r\n+\r\n+\t@Test\r\n+\tpublic void testDeleteFromListColumnIndexTable_NullColumn() {\r\n+\t\tColumnModel multiValue = null;\r\n+\t\tSet<Long> rowIdFilter = null;\r\n+\t\tassertThrows(IllegalArgumentException.class, ()->{\r\n+\t\t\t// call under test\r\n+\t\t\ttableIndexDAO.populateListColumnIndexTable(tableId, multiValue, rowIdFilter);\r\n+\t\t});\r\n+\t}\r\n+\r\n+\t@Test\r\n+\tpublic void testDeleteFromListColumnIndexTable_NotListType() {\r\n+\t\tColumnModel multiValue = new ColumnModel();\r\n+\t\tmultiValue.setId(\"886\");\r\n+\t\tmultiValue.setColumnType(ColumnType.STRING);\r\n+\t\tmultiValue.setName(\"multiValue\");\r\n+\t\tmultiValue.setMaximumSize(100L);\r\n+\t\tSet<Long> rowIdFilter = Sets.newHashSet(1L);\r\n+\t\tString message = assertThrows(IllegalArgumentException.class, ()->{\r\n+\t\t\t// call under test\r\n+\t\t\ttableIndexDAO.deleteFromListColumnIndexTable(tableId, multiValue, rowIdFilter);\r\n+\t\t}).getMessage();\r\n+\t\tassertEquals(\"Only valid for List type columns\", message);\r\n+\t}\r\n+\r\n+\t@Test\r\n+\tpublic void testDeleteFromListColumnIndexTable_nullRowFilter() {\r\n+\t\tColumnModel multiValue = new ColumnModel();\r\n+\t\tmultiValue.setId(\"886\");\r\n+\t\tmultiValue.setColumnType(ColumnType.STRING_LIST);\r\n+\t\tmultiValue.setName(\"multiValue\");\r\n+\t\tmultiValue.setMaximumSize(100L);\r\n+\t\tString message = assertThrows(IllegalArgumentException.class, ()->{\r\n+\t\t\t// call under test\r\n+\t\t\ttableIndexDAO.deleteFromListColumnIndexTable(tableId, multiValue, null);\r\n+\t\t}).getMessage();\r\n+\t\tassertEquals(\"rowIds is required and must not be empty.\", message);\r\n+\t}\r\n+\r\n+\t@Test\r\n+\tpublic void testDeleteFromListColumnIndexTable_EmptyRowFilter() {\r\n+\t\tColumnModel multiValue = new ColumnModel();\r\n+\t\tmultiValue.setId(\"886\");\r\n+\t\tmultiValue.setColumnType(ColumnType.STRING_LIST);\r\n+\t\tmultiValue.setName(\"multiValue\");\r\n+\t\tmultiValue.setMaximumSize(100L);\r\n+\t\tSet<Long> rowIdFilter = Collections.emptySet();\r\n+\t\tString message = assertThrows(IllegalArgumentException.class, ()->{\r\n+\t\t\t// call under test\r\n+\t\t\ttableIndexDAO.deleteFromListColumnIndexTable(tableId, multiValue, rowIdFilter);\r\n+\t\t}).getMessage();\r\n+\t\tassertEquals(\"rowIds is required and must not be empty.\", message);\r\n+\t}\r\n+\r\n+\r\n+\t@Test\r\n+\tpublic void testDeleteFromListColumnIndexTable() {\r\n+\t\t// create a table with a long column.\r\n+\t\tColumnModel intColumn = new ColumnModel();\r\n+\t\tintColumn.setId(\"12\");\r\n+\t\tintColumn.setName(\"foo\");\r\n+\t\tintColumn.setColumnType(ColumnType.INTEGER);\r\n+\r\n+\t\tColumnModel stringListColumn = new ColumnModel();\r\n+\t\tstringListColumn.setId(\"15\");\r\n+\t\tstringListColumn.setName(\"myList\");\r\n+\t\tstringListColumn.setMaximumSize(54L);\r\n+\t\tstringListColumn.setColumnType(ColumnType.STRING_LIST);\r\n+\r\n+\r\n+\t\tColumnModel booleanColumn = new ColumnModel();\r\n+\t\tbooleanColumn.setId(\"13\");\r\n+\t\tbooleanColumn.setName(\"bar\");\r\n+\t\tbooleanColumn.setColumnType(ColumnType.BOOLEAN);\r\n+\r\n+\t\tList<ColumnModel> schema = Lists.newArrayList(intColumn, stringListColumn ,booleanColumn);\r\n+\r\n+\t\tcreateOrUpdateTable(schema, tableId, isView);\r\n+\r\n+\t\tint numRows = 5;\r\n+\t\tList<Row> rows = TableModelTestUtils.createRows(schema, numRows);\r\n+\t\tcreateOrUpdateOrDeleteRows(tableId, rows, schema);\r\n+\r\n+\t\ttableIndexDAO.populateListColumnIndexTable(tableId, stringListColumn, null);\r\n+\r\n+\t\tString listColumnindexTableName = SQLUtils.getTableNameForMultiValueColumnIndex(tableId, stringListColumn.getId());\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8339b7f8c7bc43c344134ccf1efea14036dfbdc7"}, "originalPosition": 113}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNzk5OTE1", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#pullrequestreview-351799915", "createdAt": "2020-01-31T21:53:29Z", "commit": {"oid": "8339b7f8c7bc43c344134ccf1efea14036dfbdc7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMTo1MzoyOVrOFkY-pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMTo1MzoyOVrOFkY-pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcwMjMxMA==", "bodyText": "move up", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#discussion_r373702310", "createdAt": "2020-01-31T21:53:29Z", "author": {"login": "john-hill"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/table/TableIndexManagerImpl.java", "diffHunk": "@@ -109,9 +109,17 @@ public Void doInTransaction(TransactionStatus status) {\n \t\t\t\t\t\t\t// set the new max version for the index\r\n \t\t\t\t\t\t\ttableIndexDao.setMaxCurrentCompleteVersionForTable(\r\n \t\t\t\t\t\t\t\t\ttableId, changeSetVersionNumber);\r\n+\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8339b7f8c7bc43c344134ccf1efea14036dfbdc7"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxODAwNDcw", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#pullrequestreview-351800470", "createdAt": "2020-01-31T21:54:36Z", "commit": {"oid": "8339b7f8c7bc43c344134ccf1efea14036dfbdc7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMTo1NDozN1rOFkZAUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMTo1NDozN1rOFkZAUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzcwMjczOA==", "bodyText": "remove", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#discussion_r373702738", "createdAt": "2020-01-31T21:54:37Z", "author": {"login": "john-hill"}, "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/manager/table/TableIndexManagerImplTest.java", "diffHunk": "@@ -1298,5 +1340,65 @@ public TableChangeMetaData setupMockColumnChange(long changeNumber) throws NotFo\n \t\t}\r\n \t\treturn schema;\r\n \t}\r\n-\t\r\n+\r\n+\tprivate class SparseRowTestImpl implements SparseRow{\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8339b7f8c7bc43c344134ccf1efea14036dfbdc7"}, "originalPosition": 73}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b13fe956205b15e8110bd333664698e2bd5de499", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/b13fe956205b15e8110bd333664698e2bd5de499", "committedDate": "2020-01-31T23:05:01Z", "message": "code review changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db400c2eab6b55f7c5dbe3a5628b5dbb3862d7e6", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/db400c2eab6b55f7c5dbe3a5628b5dbb3862d7e6", "committedDate": "2020-01-31T23:41:31Z", "message": "Merge branch 'develop' of github.com:Sage-Bionetworks/Synapse-Repository-Services into PLFM-6058-row-diff-only"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxODQ2MDYz", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3920#pullrequestreview-351846063", "createdAt": "2020-02-01T00:27:50Z", "commit": {"oid": "db400c2eab6b55f7c5dbe3a5628b5dbb3862d7e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4785, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}