{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNTQ0MDY2", "number": 4001, "title": "validate multi-value column before schema change is accepted (PLFM-6190)", "bodyText": "", "createdAt": "2020-04-15T05:07:58Z", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4001", "merged": true, "mergeCommit": {"oid": "2f356350572cf6e77e7224ecb1b6de981bf021b3"}, "closed": true, "closedAt": "2020-04-16T23:40:43Z", "author": {"login": "zimingd"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXuzfggH2gAyNDAzNTQ0MDY2OjczYjVjNjU3ZDlhNjc0N2RjYmI4NjU5NmMwODJmMDdmMTk0MWY0YWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYVdkVAFqTM5NTA3MDYxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "73b5c657d9a6747dcbb86596c082f07f1941f4ab", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/73b5c657d9a6747dcbb86596c082f07f1941f4ab", "committedDate": "2020-04-15T02:38:13Z", "message": "altertemp for multivalue column dao functions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3c71482811e8a9209a2f0ac0518148f490c491f", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/c3c71482811e8a9209a2f0ac0518148f490c491f", "committedDate": "2020-04-15T05:07:06Z", "message": "fix sql for update and finsihed test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "716467812d2a546710e7dcd7104c3e7899ae0446", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/716467812d2a546710e7dcd7104c3e7899ae0446", "committedDate": "2020-04-15T05:18:55Z", "message": "fixtests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26cad81b6c87d74217f0a9119469e06fb5958f65", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/26cad81b6c87d74217f0a9119469e06fb5958f65", "committedDate": "2020-04-16T03:31:26Z", "message": "cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ace8cb7e9fa53f6a9164229e18e7f81acd1e025c", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/ace8cb7e9fa53f6a9164229e18e7f81acd1e025c", "committedDate": "2020-04-16T03:56:11Z", "message": "why is it deleted"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62ed53b67fd18f3debd1d556c56900640284de0f", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/62ed53b67fd18f3debd1d556c56900640284de0f", "committedDate": "2020-04-16T04:06:58Z", "message": "temporarily build 1 test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffc9f59973c46b140307d4848babdc71ad4794b2", "author": {"user": {"login": "zimingd", "name": "Ziming Dong"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/ffc9f59973c46b140307d4848babdc71ad4794b2", "committedDate": "2020-04-16T04:13:30Z", "message": "retry build"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDY2MjA5", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4001#pullrequestreview-395066209", "createdAt": "2020-04-16T23:27:48Z", "commit": {"oid": "ffc9f59973c46b140307d4848babdc71ad4794b2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMzoyNzo0OFrOGG6riw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMzoyNzo0OFrOGG6riw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkwNjA1OQ==", "bodyText": "alterTemp=false;", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4001#discussion_r409906059", "createdAt": "2020-04-16T23:27:48Z", "author": {"login": "john-hill"}, "path": "lib/lib-table-cluster/src/main/java/org/sagebionetworks/table/cluster/TableIndexDAOImpl.java", "diffHunk": "@@ -165,7 +165,7 @@ private static TransactionTemplate createTransactionTemplate(DataSourceTransacti\n \r\n \t@Override\r\n \tpublic void deleteTable(IdAndVersion tableId) {\r\n-\t\tdeleteMultiValueTablesForTable(tableId);\r\n+\t\tdeleteMultiValueTablesForTable(tableId, false);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffc9f59973c46b140307d4848babdc71ad4794b2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDY2MzIz", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4001#pullrequestreview-395066323", "createdAt": "2020-04-16T23:28:06Z", "commit": {"oid": "ffc9f59973c46b140307d4848babdc71ad4794b2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMzoyODowNlrOGG6r5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMzoyODowNlrOGG6r5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkwNjE1MA==", "bodyText": "alterTemp=false", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4001#discussion_r409906150", "createdAt": "2020-04-16T23:28:06Z", "author": {"login": "john-hill"}, "path": "lib/lib-table-cluster/src/main/java/org/sagebionetworks/table/cluster/TableIndexDAOImpl.java", "diffHunk": "@@ -446,32 +447,32 @@ public boolean alterTableAsNeeded(IdAndVersion tableId, List<ColumnChangeDetails\n \r\n \t@Override\r\n \tpublic Set<Long> getMultivalueColumnIndexTableColumnIds(IdAndVersion tableId){\r\n-\t\treturn getMultivalueColumnIndexTableNames(tableId)\r\n+\t\treturn getMultivalueColumnIndexTableNames(tableId, false)\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffc9f59973c46b140307d4848babdc71ad4794b2"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDY3NTQ4", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4001#pullrequestreview-395067548", "createdAt": "2020-04-16T23:31:39Z", "commit": {"oid": "ffc9f59973c46b140307d4848babdc71ad4794b2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMzozMTozOVrOGG6wZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMzozMTozOVrOGG6wZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkwNzMwMQ==", "bodyText": "altertemp=false", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4001#discussion_r409907301", "createdAt": "2020-04-16T23:31:39Z", "author": {"login": "john-hill"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/table/TableIndexManagerImpl.java", "diffHunk": "@@ -111,7 +111,7 @@ public void applyChangeSetToIndex(final IdAndVersion tableId, final SparseChange\n \t\t\t\t\t\t\t//once all changes to main table are applied, populate the list-type columns with the changes.\r\n \t\t\t\t\t\t\tfor(ListColumnRowChanges listColumnChange : rowset.groupListColumnChanges()){\r\n \t\t\t\t\t\t\t\ttableIndexDao.deleteFromListColumnIndexTable(tableId, listColumnChange.getColumnModel(), listColumnChange.getRowIds());\r\n-\t\t\t\t\t\t\t\ttableIndexDao.populateListColumnIndexTable(tableId, listColumnChange.getColumnModel(), listColumnChange.getRowIds());\r\n+\t\t\t\t\t\t\t\ttableIndexDao.populateListColumnIndexTable(tableId, listColumnChange.getColumnModel(), listColumnChange.getRowIds(), false);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffc9f59973c46b140307d4848babdc71ad4794b2"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDY3Nzc2", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4001#pullrequestreview-395067776", "createdAt": "2020-04-16T23:32:23Z", "commit": {"oid": "ffc9f59973c46b140307d4848babdc71ad4794b2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMzozMjoyM1rOGG6xQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMzozMjoyM1rOGG6xQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkwNzUyMA==", "bodyText": "alterTemp=false", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4001#discussion_r409907520", "createdAt": "2020-04-16T23:32:23Z", "author": {"login": "john-hill"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/table/TableIndexManagerImpl.java", "diffHunk": "@@ -354,26 +356,30 @@ public void populateListColumnIndexTables(final IdAndVersion tableIdAndVersion,\n \t\tValidateArgument.required(schema, \"schema\");\r\n \t\tfor(ColumnModel column: schema) {\r\n \t\t\tif (ColumnTypeListMappings.isList(column.getColumnType())) {\r\n-\t\t\t\ttableIndexDao.populateListColumnIndexTable(tableIdAndVersion, column, rowIds);\r\n+\t\t\t\ttableIndexDao.populateListColumnIndexTable(tableIdAndVersion, column, rowIds, false);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffc9f59973c46b140307d4848babdc71ad4794b2"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDcwNjE1", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4001#pullrequestreview-395070615", "createdAt": "2020-04-16T23:40:34Z", "commit": {"oid": "ffc9f59973c46b140307d4848babdc71ad4794b2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4862, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}