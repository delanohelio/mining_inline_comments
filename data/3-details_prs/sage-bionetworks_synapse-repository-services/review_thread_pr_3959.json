{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyNzE3MjA1", "number": 3959, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOToyMDozM1rODkyIIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwMTowMjo1MFrODoBWCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5ODk2NjA5OnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/BasicIssue.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOToyMDozM1rOFxTNCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOToyMDozM1rOFxTNCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIzOTE3Ng==", "bodyText": "toJSONObject.\nWe could create a dedicated mapper for the json structure that JIRA expects.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3959#discussion_r387239176", "createdAt": "2020-03-03T19:20:33Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/BasicIssue.java", "diffHunk": "@@ -0,0 +1,112 @@\n+package org.sagebionetworks.repo.util.jrjc;\n+\n+import org.json.simple.JSONObject;\n+\n+import java.util.Map;\n+\n+public class BasicIssue {\n+    private String summary;\n+    private String projectId;\n+    private Long issueTypeId;\n+    private Map<String, String> customFields;\n+\n+    public String getSummary() {\n+        return summary;\n+    }\n+\n+    public void setSummary(String summary) {\n+        this.summary = summary;\n+    }\n+\n+    public String getProjectId() {\n+        return projectId;\n+    }\n+\n+    public void setProjectId(String projectId) {\n+        this.projectId = projectId;\n+    }\n+\n+    public Long getIssueTypeId() {\n+        return issueTypeId;\n+    }\n+\n+    public void setIssueTypeId(Long issueTypeId) {\n+        this.issueTypeId = issueTypeId;\n+    }\n+\n+    public Map<String, String> getCustomFields() {\n+        return customFields;\n+    }\n+\n+    public void setCustomFields(Map<String, String> customFields) {\n+        this.customFields = customFields;\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        final int prime = 31;\n+        int result = 1;\n+        result = prime * result + ((summary == null) ? 0 : summary.hashCode());\n+        result = prime * result + ((projectId == null) ? 0 : projectId.hashCode());\n+        result = prime * result + ((issueTypeId == null) ? 0 : issueTypeId.hashCode());\n+        result = prime * result + ((customFields == null) ? 0 : customFields.hashCode());\n+        return result;\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj)\n+            return true;\n+        if (obj == null)\n+            return false;\n+        if (getClass() != obj.getClass())\n+            return false;\n+        BasicIssue other = (BasicIssue) obj;\n+        if (summary == null) {\n+            if (other.summary != null)\n+                return false;\n+        } else if (!summary.equals(other.summary))\n+            return false;\n+        if (projectId == null) {\n+            if (other.projectId != null)\n+                return false;\n+        } else if (!projectId.equals(other.projectId))\n+            return false;\n+        if (issueTypeId == null) {\n+            if (other.issueTypeId != null)\n+                return false;\n+        } else if (!issueTypeId.equals(other.issueTypeId))\n+            return false;\n+        if (customFields == null) {\n+            if (other.customFields != null)\n+                return false;\n+        } else if (!customFields.equals(other.customFields))\n+            return false;\n+        return true;\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return \"BasicIssue [summary=\" + summary + \", issueTypeId=\" + issueTypeId\n+            + \", projectId=\" + projectId + \", fields=\" + customFields + \"]\";\n+    }\n+\n+    public JSONObject toJONObject() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5360bedc8839c53d5cf30498a25490716830aef7"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5ODk4NTQwOnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JRJCHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOToyNjoyMFrOFxTZNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOToyNjoyMFrOFxTZNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI0MjI5NA==", "bodyText": "Cast to string can be removed", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3959#discussion_r387242294", "createdAt": "2020-03-03T19:26:20Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JRJCHelper.java", "diffHunk": "@@ -21,17 +21,17 @@ public static String createFlagIssue(JiraClient jiraClient, String principalId,\n         params.put(JIRA_PRINCIPAL_ID_ISSUE_FIELD_NAME, principalId);\n         params.put(JIRA_USER_DISPLAY_NAME_ISSUE_FIELD_NAME, displayName);\n         params.put(JIRA_SYNAPSE_ENTITY_ID_FIELD_NAME, dataObjectId);\n-        JSONObject createdIssue = createIssue(jiraClient, JIRA_FLAG_ISSUE_TYPE_NAME, FLAG_SUMMARY, params);\n-\t\treturn (String) createdIssue.get(\"key\");\n+        CreatedIssue createdIssue = createIssue(jiraClient, JIRA_FLAG_ISSUE_TYPE_NAME, FLAG_SUMMARY, params);\n+\t\treturn (String) createdIssue.getKey();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5360bedc8839c53d5cf30498a25490716830aef7"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTAwNjcyOnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JRJCHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTozMjozN1rOFxTmkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTozMjozN1rOFxTmkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI0NTcxNA==", "bodyText": "This could be null, we should probably handle this if the JIRA api changes again", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3959#discussion_r387245714", "createdAt": "2020-03-03T19:32:37Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JRJCHelper.java", "diffHunk": "@@ -41,28 +41,28 @@ public static String createRestrictIssue(JiraClient jiraClient, String principal\n \t * @param params a map from field names to field values\n \t * @return\n \t */\n-\tpublic static JSONObject createIssue(JiraClient jiraClient, String issueTypeName, String summary, Map<String,String> params) {\n-\t\tJSONObject projectInfo = jiraClient.getProjectInfo(JIRA_PROJECT_KEY, issueTypeName);\n-\t\tString projectId = (String) projectInfo.get(\"id\");\n-\t\tLong issueTypeId = (Long) projectInfo.get(\"issueTypeId\");\n-\n+\tpublic static CreatedIssue createIssue(JiraClient jiraClient, String issueTypeName, String summary, Map<String,String> params) {\n+\t\tProjectInfo projectInfo = jiraClient.getProjectInfo(JIRA_PROJECT_KEY, issueTypeName);\n+\t\tString projectId = projectInfo.getProjectId();\n+\t\tLong issueTypeId = projectInfo.getIssueTypeId();\n \t\tMap<String, String> fieldsMap = jiraClient.getFields();\n-\t\tJSONObject issue = new JSONObject();\n-\t\tJSONObject issueFields = new JSONObject();\n-\t\tJSONObject o = new JSONObject();\n-\t\tissueFields.put(\"summary\", summary);\n-\t\to = new JSONObject();\n-\t\to.put(\"id\", projectId);\n-\t\tissueFields.put(\"project\", o);\n-\t\to = new JSONObject();\n-\t\to.put(\"id\", issueTypeId);\n-\t\tissueFields.put(\"issuetype\", o);\n+\n+\t\tBasicIssue basicIssue = new BasicIssue();\n+\t\tbasicIssue.setProjectId(projectId);\n+\t\tbasicIssue.setIssueTypeId(issueTypeId);\n+\t\tbasicIssue.setSummary(summary);\n+\t\tbasicIssue.setCustomFields(mapParams(fieldsMap, params));\n+\n+\t\tCreatedIssue createdIssue = jiraClient.createIssue(basicIssue);\n+\t\treturn createdIssue;\n+\t}\n+\n+\tprivate static Map<String, String> mapParams(Map<String, String>fieldsMap, Map<String, String> params) {\n+\t\tMap<String, String> mapped = new HashMap<>();\n \t\tfor (String k: params.keySet()) {\n \t\t\tString fk = fieldsMap.get(k);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5360bedc8839c53d5cf30498a25490716830aef7"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTAxNzM3OnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/CreatedIssue.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTozNjowM1rOFxTtmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTozNjowM1rOFxTtmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI0NzUxMg==", "bodyText": "This should return a CreatedIssue and avoid overriding the instance (Maybe a static method or better an external mapper)", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3959#discussion_r387247512", "createdAt": "2020-03-03T19:36:03Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/CreatedIssue.java", "diffHunk": "@@ -0,0 +1,90 @@\n+package org.sagebionetworks.repo.util.jrjc;\n+\n+import org.json.simple.JSONObject;\n+import org.json.simple.parser.JSONParser;\n+\n+import java.util.Objects;\n+\n+public class CreatedIssue {\n+\n+    private String id;\n+    private String key;\n+    private String url;\n+\n+\n+    public String getId() {\n+        return id;\n+    }\n+\n+    public void setId(String id) {\n+        this.id = id;\n+    }\n+\n+    public String getKey() {\n+        return key;\n+    }\n+\n+    public void setKey(String key) {\n+        this.key = key;\n+    }\n+\n+    public String getUrl() {\n+        return url;\n+    }\n+\n+    public void setUrl(String url) {\n+        this.url = url;\n+    }\n+\n+    @Override\n+    public boolean equals(Object o) {\n+        if (this == o)\n+            return true;\n+        if (o == null)\n+            return false;\n+        if (getClass() != o.getClass())\n+            return false;\n+        CreatedIssue other = (CreatedIssue) o;\n+        if (id == null) {\n+            if (other.id != null)\n+                return false;\n+        } else if (!id.equals(other.id))\n+            return false;\n+        if (key == null) {\n+            if (other.key != null)\n+                return false;\n+        } else if (!key.equals(other.key))\n+            return false;\n+        if (url == null) {\n+            if (other.url != null)\n+                return false;\n+        } else if (!url.equals(other.url))\n+            return false;\n+        return true;\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        final int prime = 31;\n+        int result = 1;\n+        result = prime * result + ((id == null) ? 0 : id.hashCode());\n+        result = prime * result + ((key == null) ? 0 : key.hashCode());\n+        result = prime * result + ((url == null) ? 0 : url.hashCode());\n+        return result;\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return \"CreatedIssue [id=\" + id + \", key=\" + key + \", url=\" + url + \"]\";\n+    }\n+\n+    public void initFromJSONObject(JSONObject jsonObject) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5360bedc8839c53d5cf30498a25490716830aef7"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTA1MDExOnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/util/jrjc/BasicIssueTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTo0NjowOFrOFxUCYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTo0NjowOFrOFxUCYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI1MjgzNA==", "bodyText": "public modifier", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3959#discussion_r387252834", "createdAt": "2020-03-03T19:46:08Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/util/jrjc/BasicIssueTest.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package org.sagebionetworks.repo.util.jrjc;\n+\n+import org.json.simple.JSONObject;\n+import org.junit.jupiter.api.Test;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class BasicIssueTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5360bedc8839c53d5cf30498a25490716830aef7"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTA2NjkxOnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/util/jrjc/JiraClientImplTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTo1MDo0NVrOFxUMYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxOTo1MDo0NVrOFxUMYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI1NTM5Mg==", "bodyText": "Use @InjectMocks instead of the reflection", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3959#discussion_r387255392", "createdAt": "2020-03-03T19:50:45Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/util/jrjc/JiraClientImplTest.java", "diffHunk": "@@ -37,18 +36,14 @@\n     private static final String USERNAME = \"userName\";\n     private static final String USERAPIKEY = \"userApiKey\";\n \n-    @Before\n+    @BeforeEach\n     public void setUp() throws Exception {\n         jiraClient = new JiraClientImpl();\n         ReflectionTestUtils.setField(jiraClient, \"httpClient\", mockHttpClient);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5360bedc8839c53d5cf30498a25490716830aef7"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTEwMTQ5OnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JiraClientImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMDowMDo0NVrOFxUhbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMDowMDo0NVrOFxUhbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI2MDc4MA==", "bodyText": "You can inject the StackConfiguration with @autowire since the manager imports it as a bean.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3959#discussion_r387260780", "createdAt": "2020-03-03T20:00:45Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JiraClientImpl.java", "diffHunk": "@@ -11,6 +12,7 @@\n import org.json.simple.parser.ParseException;\n import org.sagebionetworks.simpleHttpClient.*;\n import org.sagebionetworks.url.HttpMethod;\n+import org.springframework.beans.factory.annotation.Autowired;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5360bedc8839c53d5cf30498a25490716830aef7"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5OTEyMTA1OnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/util/jrjc/JiraClientImplTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMDowNzowMVrOFxUtyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QyMDowNzowMVrOFxUtyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI2Mzk0NQ==", "bodyText": "add the test prefix to test methods", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3959#discussion_r387263945", "createdAt": "2020-03-03T20:07:01Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/util/jrjc/JiraClientImplTest.java", "diffHunk": "@@ -37,18 +36,14 @@\n     private static final String USERNAME = \"userName\";\n     private static final String USERAPIKEY = \"userApiKey\";\n \n-    @Before\n+    @BeforeEach\n     public void setUp() throws Exception {\n         jiraClient = new JiraClientImpl();\n         ReflectionTestUtils.setField(jiraClient, \"httpClient\", mockHttpClient);\n         ReflectionTestUtils.setField(jiraClient, \"USERNAME\", USERNAME);\n         ReflectionTestUtils.setField(jiraClient, \"APIKEY\", USERAPIKEY);\n     }\n \n-    @After\n-    public void tearDown() throws Exception {\n-    }\n-\n     @Test\n     public void getProjectInfo() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5360bedc8839c53d5cf30498a25490716830aef7"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNDQ0MjA3OnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JiraClientImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxOToxNjoxNVrOF1FNWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxOToxNjoxNVrOF1FNWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTIwNDE4NA==", "bodyText": "Can remove", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3959#discussion_r391204184", "createdAt": "2020-03-11T19:16:15Z", "author": {"login": "xschildw"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JiraClientImpl.java", "diffHunk": "@@ -28,7 +30,7 @@\n \tpublic static final String NAME_KEY = \"name\";\n \tpublic static final String ID_KEY = \"id\";\n \n-\tprivate final SimpleHttpClient httpClient;\n+\tprivate SimpleHttpClient httpClient;\n \tprivate String USERNAME;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386bc5b60aa959b2904a180e864211fb5b0784e8"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNDQ0ODg0OnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JiraClientImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxOToxODoyN1rOF1FR3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxOToxODoyN1rOF1FR3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTIwNTM0Mw==", "bodyText": "Change name of method", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3959#discussion_r391205343", "createdAt": "2020-03-11T19:18:27Z", "author": {"login": "xschildw"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JiraClientImpl.java", "diffHunk": "@@ -196,4 +198,36 @@ static void handleResponseStatus(int status) {\n \t\theaders.put(HttpHeaders.USER_AGENT, USER_AGENT);\n \t\treturn headers;\n \t}\n+\n+\tprivate static JSONObject toJSONObject(BasicIssue basicIssue) {\n+\t\tJSONObject issue = new JSONObject();\n+\t\tJSONObject issueFields = new JSONObject();\n+\t\tissueFields.put(\"summary\", basicIssue.getSummary());\n+\t\tJSONObject o = new JSONObject();\n+\t\to.put(\"id\", basicIssue.getProjectId());\n+\t\tissueFields.put(\"project\", o);\n+\t\to = new JSONObject();\n+\t\to.put(\"id\", basicIssue.getIssueTypeId());\n+\t\tissueFields.put(\"issuetype\", o);\n+\t\tif (basicIssue.getCustomFields() != null) {\n+\t\t\tfor (String k: basicIssue.getCustomFields().keySet()) {\n+\t\t\t\tissueFields.put(k, basicIssue.getCustomFields().get(k));\n+\t\t\t}\n+\t\t}\n+\t\tissue.put(\"fields\", issueFields);\n+\t\treturn issue;\n+\t}\n+\n+\tprivate static CreatedIssue fromJSONObject(JSONObject jsonObject) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386bc5b60aa959b2904a180e864211fb5b0784e8"}, "originalPosition": 136}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNDQ1NDIzOnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JiraClientImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxOToyMDowMlrOF1FVLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxOToyMDowMlrOF1FVLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTIwNjE4OQ==", "bodyText": "Also  move to static", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3959#discussion_r391206189", "createdAt": "2020-03-11T19:20:02Z", "author": {"login": "xschildw"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JiraClientImpl.java", "diffHunk": "@@ -39,16 +41,17 @@\n \tprivate static final String JIRA_PROJECT_ISSUE_TYPES_KEY = \"issueTypes\";\n \tprivate static final String JIRA_PROJECT_ID_KEY = \"id\";\n \n+\t@Autowired\n+\tprivate StackConfiguration config;\n+\n \tpublic JiraClientImpl() {\n \t\tSimpleHttpClientConfig httpClientConfig = new SimpleHttpClientConfig();\n \t\thttpClientConfig.setSocketTimeoutMs(TIME_OUT);\n \t\thttpClient = new SimpleHttpClientImpl(httpClientConfig);\n-\t\tUSERNAME = StackConfigurationSingleton.singleton().getJiraUserEmail();\n-\t\tAPIKEY = StackConfigurationSingleton.singleton().getJiraUserApikey();\n \t}\n \n \t@Override\n-\tpublic JSONObject getProjectInfo(String projectKey, String issueTypeName) {\n+\tpublic ProjectInfo getProjectInfo(String projectKey, String issueTypeName) {\n \t\tSimpleHttpRequest req = createRequest(JIRA_API_PROJECT_URL, \"SG\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "386bc5b60aa959b2904a180e864211fb5b0784e8"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzMjkxNjU3OnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/util/jrjc/JRJCHelperTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwMTowMjo1MFrOF2W3Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQwMTowMjo1MFrOF2W3Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjU0MjAzNA==", "bodyText": "Put whens back inline", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3959#discussion_r392542034", "createdAt": "2020-03-14T01:02:50Z", "author": {"login": "xschildw"}, "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/util/jrjc/JRJCHelperTest.java", "diffHunk": "@@ -94,4 +86,33 @@ public void testCreateFlagIssue() throws Exception {\n \n \t}\n \n+\t@Test\n+\tpublic void testCreateIssueBadMapping() throws Exception {\n+\t\tMap<String,String> badFields = new HashMap<String, String>();\n+\t\tbadFields.put(\"Synapse Principal ID\", \"id1\");\n+\t\tbadFields.put(\"Synapse User Name\", \"id2\"); // This one does not map\n+\t\tbadFields.put(\"Synapse Data Object\", \"id3\");\n+\t\twhen(jiraClient.getFields()).thenReturn(badFields);\n+\n+\t\t// Call under test\n+\t\tAssertions.assertThrows(JiraClientException.class, () -> {\n+\t\t\t\tJRJCHelper.createFlagIssue(jiraClient, TEST_PRINCIPAL_ID, TEST_DISPLAY_NAME, TEST_DATA_OBJECT_ID);\n+\t\t\t}\n+\t\t);\n+\n+\t}\n+\n+\tprivate void initFields() {\n+\t\twhen(mockCreatedIssue.getKey()).thenReturn(\"SG-101\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9f0f867ee820ee6896d0ec51e9eafaa856803098"}, "originalPosition": 69}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3138, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}