{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMTk3OTMx", "number": 3995, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNzoyODoyMVrODwz02g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNzozMTozOFrODwz4KQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyNTA3MzU0OnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/manager/authentication/AuthenticationManagerImplUnitTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNzoyODoyMVrOGEAvgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNzoyODoyMVrOGEAvgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg1OTY1MQ==", "bodyText": "You probably don't need the eq()", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3995#discussion_r406859651", "createdAt": "2020-04-10T17:28:21Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/manager/authentication/AuthenticationManagerImplUnitTest.java", "diffHunk": "@@ -215,8 +212,11 @@ public void testLogin(){\n \t///////////////////////////////////////////////////////////\n \t@Test\n \tpublic void testGetLoginResponseAfterSuccessfulAuthentication_validReciept(){\n+\t\tsetupMockUserGroupDAO();\n \t\tString newReceipt = \"uwu\";\n \t\twhen(mockAuthReceiptDAO.replaceReceipt(userId, receipt)).thenReturn(newReceipt);\n+\t\t//when(mockAuthReceiptDAO.createNewReceipt(userId)).thenReturn(receipt);\n+\t\twhen(mockAuthDAO.changeSessionToken(eq(userId), eq((String) null))).thenReturn(synapseSessionToken);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ccf83141ce01bb6455efd962ceab5824c782eaf"}, "originalPosition": 134}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyNTA3OTgzOnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/manager/authentication/AuthenticationManagerImplUnitTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNzozMDozN1rOGEAzXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNzozMDozN1rOGEAzXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg2MDYzOA==", "bodyText": "You could check the retuned IllegalArgumentException and validate the message", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3995#discussion_r406860638", "createdAt": "2020-04-10T17:30:37Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/manager/authentication/AuthenticationManagerImplUnitTest.java", "diffHunk": "@@ -398,24 +408,30 @@ public void testFindUserForAuthentication_userNotFound(){\n \t/////////////////////////////////////////////////////////////\n \t// validateChangePassword(ChangePasswordWithCurrentPassword)\n \t/////////////////////////////////////////////////////////////\n-\t@Test(expected = IllegalArgumentException.class)\n+\t@Test\n \tpublic void testValidateChangePassword_withCurrentPassword_nullUsername(){\n \t\tchangePasswordWithCurrentPassword.setUsername(null);\n \n-\t\t//method under test\n-\t\tauthManager.validateChangePassword(changePasswordWithCurrentPassword);\n+\t\tAssertions.assertThrows(IllegalArgumentException.class, () -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ccf83141ce01bb6455efd962ceab5824c782eaf"}, "originalPosition": 202}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUyNTA4MjAxOnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/manager/authentication/AuthenticationManagerImplUnitTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNzozMTozOFrOGEA0yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMFQxNzozMTozOFrOGEA0yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg2MTAwMw==", "bodyText": "Can be @mock", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3995#discussion_r406861003", "createdAt": "2020-04-10T17:31:38Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/manager/authentication/AuthenticationManagerImplUnitTest.java", "diffHunk": "@@ -449,56 +469,77 @@ public void testValidateChangePassword_withToken_valid(){\n \t\tverify(mockPasswordResetTokenGenerator).isValidToken(passwordResetSignedToken);\n \t}\n \n+\t@Test\n+\tpublic void testValidateChangePassword_withToken_missingToken() {\n+\t\tchangePasswordWithToken.setPasswordChangeToken(null);\n+\n+\t\tAssertions.assertThrows(IllegalArgumentException.class, () -> {\n+\t\t\t// call under test\n+\t\t\tauthManager.validateChangePassword(changePasswordWithToken);\n+\t\t});\n+\t}\n+\n \n \t////////////////////\n \t// changePassword()\n \t////////////////////\n \n-\t@Test(expected = IllegalArgumentException.class)\n+\t@Test\n \tpublic void testChangePassword_NullNewPassword(){\n+\t\twhen(mockUserCredentialValidator.checkPasswordWithThrottling(userId, password)).thenReturn(true);\n+\t\tsetupMockPrincipalAliasDAO();\n+\n \t\tchangePasswordWithCurrentPassword.setNewPassword(null);\n-\t\tauthManager.changePassword(changePasswordWithCurrentPassword);\n+\t\tAssertions.assertThrows(IllegalArgumentException.class, () -> {\n+\t\t\t// call under test\n+\t\t\tauthManager.changePassword(changePasswordWithCurrentPassword);\n+\t\t});\n \t}\n \n \n-\t@Test(expected = IllegalArgumentException.class)\n+\t@Test\n \tpublic void testChangePassword_unknownImplementation(){\n-\t\t//use anonymous implementation\n-\t\tauthManager.changePassword(new ChangePasswordInterface() {\n-\t\t\t@Override\n-\t\t\tpublic String getNewPassword() {\n-\t\t\t\treturn \"\";\n-\t\t\t}\n-\n-\t\t\t@Override\n-\t\t\tpublic void setNewPassword(String newPassword) {\n-\n-\t\t\t}\n-\n-\t\t\t@Override\n-\t\t\tpublic String getConcreteType() {\n-\t\t\t\treturn null;\n-\t\t\t}\n-\n-\t\t\t@Override\n-\t\t\tpublic void setConcreteType(String concreteType) {\n-\n-\t\t\t}\n-\n-\t\t\t@Override\n-\t\t\tpublic JSONObjectAdapter initializeFromJSONObject(JSONObjectAdapter jsonObjectAdapter) throws JSONObjectAdapterException {\n-\t\t\t\treturn null;\n-\t\t\t}\n-\n-\t\t\t@Override\n-\t\t\tpublic JSONObjectAdapter writeToJSONObject(JSONObjectAdapter jsonObjectAdapter) throws JSONObjectAdapterException {\n-\t\t\t\treturn null;\n-\t\t\t}\n+\t\tAssertions.assertThrows(IllegalArgumentException.class, () -> {\n+\t\t\t//use anonymous implementation\n+\t\t\tauthManager.changePassword(new ChangePasswordInterface() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ccf83141ce01bb6455efd962ceab5824c782eaf"}, "originalPosition": 321}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3166, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}