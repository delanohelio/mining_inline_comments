{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMDY5MTkx", "number": 4207, "title": "Plfm 6390", "bodyText": "", "createdAt": "2020-09-23T22:16:34Z", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207", "merged": true, "mergeCommit": {"oid": "5881d0aa300491cd91e1f3b2be122daf79b9237c"}, "closed": true, "closedAt": "2020-09-30T23:26:57Z", "author": {"login": "nlgilber"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKLVAtgH2gAyNDkyMDY5MTkxOmU3ZTBiODAxYzdlNWJhMmQyZWQ5NmJhZmY5ZjliNGUwN2QwYzQ5NTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOE8-oAFqTQ5OTg2Nzk0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e7e0b801c7e5ba2d2ed96baff9f9b4e07d0c4956", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/e7e0b801c7e5ba2d2ed96baff9f9b4e07d0c4956", "committedDate": "2020-09-18T20:08:23Z", "message": "throw exception, validate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97e073ae0a1ddc497c66aa45b6950df1cc17a31f", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/97e073ae0a1ddc497c66aa45b6950df1cc17a31f", "committedDate": "2020-09-23T20:05:10Z", "message": " added get Team to check valid team"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c298820f9899f8190c417c2c7c72155385f62178", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/c298820f9899f8190c417c2c7c72155385f62178", "committedDate": "2020-09-23T20:15:10Z", "message": " merge conflict -- resolved"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec17dc094c78627c111e833b215a992a9e45d436", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/ec17dc094c78627c111e833b215a992a9e45d436", "committedDate": "2020-09-23T21:31:55Z", "message": "minor change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "503b92d6c2a48bbe0101f6f84b6b5fdbc2ef1e47", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/503b92d6c2a48bbe0101f6f84b6b5fdbc2ef1e47", "committedDate": "2020-09-24T18:00:33Z", "message": " added more tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76ad3ed56514b86aad2cc4a45134bf74396124f3", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/76ad3ed56514b86aad2cc4a45134bf74396124f3", "committedDate": "2020-09-24T18:05:23Z", "message": " call under test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1OTE4MjM2", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#pullrequestreview-495918236", "createdAt": "2020-09-24T20:15:35Z", "commit": {"oid": "76ad3ed56514b86aad2cc4a45134bf74396124f3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMDoxNTozNVrOHXrD2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMDozNjoyNVrOHXrt8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU4NDc5Mw==", "bodyText": "If we want to use a more friendly message, it makes sense to do this at the DAO so that the message is coherent wherever it is used.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r494584793", "createdAt": "2020-09-24T20:15:35Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/team/TeamManagerImpl.java", "diffHunk": "@@ -437,8 +439,12 @@ public PaginatedTeamIds listIdsByMember(String teamMemberId, String nextPageToke\n \t * @see org.sagebionetworks.repo.manager.team.TeamManager#get(java.lang.String)\n \t */\n \t@Override\n-\tpublic Team get(String id) throws DatastoreException, NotFoundException {\n-\t\treturn teamDAO.get(id);\n+\tpublic Team get(String teamId) throws DatastoreException, NotFoundException {\n+\t\ttry {\n+\t\t\treturn teamDAO.get(teamId);\n+\t\t} catch (NotFoundException e) {\n+\t\t\tthrow new NotFoundException(\"Team does not exist for teamId: \" + teamId ,e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76ad3ed56514b86aad2cc4a45134bf74396124f3"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU4OTcxNA==", "bodyText": "Could be a better approach to create a dedicated validation method that takes in input the id of the team and checks its existence, maybe without fetching the whole team data from the database.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r494589714", "createdAt": "2020-09-24T20:25:20Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/team/TeamManagerImpl.java", "diffHunk": "@@ -335,7 +335,8 @@ private void bindTeamName(String name, Long teamId){\n \n \t@Override\n \tpublic PaginatedResults<TeamMember> listMembers(String teamId, TeamMemberTypeFilterOptions memberType, long limit,\n-\t\t\tlong offset) throws DatastoreException {\n+\t\t\tlong offset) throws DatastoreException, NotFoundException {\n+\t\tget(teamId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76ad3ed56514b86aad2cc4a45134bf74396124f3"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU5NDA5Mg==", "bodyText": "Let us upgrade to Junit 5, make sure the class extends AbstractAutowiredControllerJunit5TestBase", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r494594092", "createdAt": "2020-09-24T20:33:31Z", "author": {"login": "marcomarasca"}, "path": "services/repository/src/test/java/org/sagebionetworks/repo/web/controller/TeamControllerAutowiredTest.java", "diffHunk": "@@ -64,4 +68,27 @@ public void testListTeams() throws Exception {\n \tpublic void testGetTeamIdsByMember() throws Exception {\n \t\tservletTestHelper.getTeamIdsByMember(dispatchServlet, 1L, TeamSortOrder.TEAM_NAME, true);\n \t}\n+\n+\t/**\n+\t * PLFM-6390\n+\t * @throws Exception\n+\t */\n+\t@Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76ad3ed56514b86aad2cc4a45134bf74396124f3"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU5NDU3OA==", "bodyText": "Might be worth adding a test to the TeamServiceAutowireTest.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r494594578", "createdAt": "2020-09-24T20:34:25Z", "author": {"login": "marcomarasca"}, "path": "services/repository/src/test/java/org/sagebionetworks/repo/web/controller/TeamControllerAutowiredTest.java", "diffHunk": "@@ -64,4 +68,27 @@ public void testListTeams() throws Exception {\n \tpublic void testGetTeamIdsByMember() throws Exception {\n \t\tservletTestHelper.getTeamIdsByMember(dispatchServlet, 1L, TeamSortOrder.TEAM_NAME, true);\n \t}\n+\n+\t/**\n+\t * PLFM-6390\n+\t * @throws Exception\n+\t */\n+\t@Test\n+\tpublic void testGetTeamMembersByInvalidId() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76ad3ed56514b86aad2cc4a45134bf74396124f3"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU5NTU3MQ==", "bodyText": "Let us extract the expected message to its own variable.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r494595571", "createdAt": "2020-09-24T20:36:25Z", "author": {"login": "marcomarasca"}, "path": "services/repository/src/test/java/org/sagebionetworks/repo/web/controller/TeamControllerAutowiredTest.java", "diffHunk": "@@ -64,4 +68,27 @@ public void testListTeams() throws Exception {\n \tpublic void testGetTeamIdsByMember() throws Exception {\n \t\tservletTestHelper.getTeamIdsByMember(dispatchServlet, 1L, TeamSortOrder.TEAM_NAME, true);\n \t}\n+\n+\t/**\n+\t * PLFM-6390\n+\t * @throws Exception\n+\t */\n+\t@Test\n+\tpublic void testGetTeamMembersByInvalidId() throws Exception {\n+\t\tString invalidTeamId = \"000\";\n+\t\tNotFoundException exception = Assertions.assertThrows(NotFoundException.class, () -> {\n+\t\t\t// Call under test\n+\t\t\tservletTestHelper.getTeamMembersWithTeamId(dispatchServlet, adminUserId, invalidTeamId);\n+\t\t});\n+\t\tAssert.assertEquals(\"{\\\"reason\\\":\\\"Team does not exist for teamId: \" + invalidTeamId + \"\\\"}\", exception.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76ad3ed56514b86aad2cc4a45134bf74396124f3"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbaee031beb05f416b3697fca298fc45b84908ed", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/dbaee031beb05f416b3697fca298fc45b84908ed", "committedDate": "2020-09-25T00:51:39Z", "message": " added checkTeamExists teamDAO"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37f59c33216c4fcde6b9a9722f9fabdcb576a6fe", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/37f59c33216c4fcde6b9a9722f9fabdcb576a6fe", "committedDate": "2020-09-25T17:11:26Z", "message": " junit 5"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf0fc27b0f4d110b5e6a6b8aec2a4418ebe5f60c", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/cf0fc27b0f4d110b5e6a6b8aec2a4418ebe5f60c", "committedDate": "2020-09-25T17:12:54Z", "message": " junit 5 autowire"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6e0a3b14217e3fc2bf25ba52c8894c4b0632f4e", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/d6e0a3b14217e3fc2bf25ba52c8894c4b0632f4e", "committedDate": "2020-09-25T21:19:25Z", "message": "pull request changes, junit5, tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37fe1e3eda7c89b72566b6757cda4d5f9f312ab1", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/37fe1e3eda7c89b72566b6757cda4d5f9f312ab1", "committedDate": "2020-09-25T21:21:30Z", "message": "Merge branch 'develop' into PLFM-6390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f99def6ffe28782fa0b81ccce5f32d37666d725", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/1f99def6ffe28782fa0b81ccce5f32d37666d725", "committedDate": "2020-09-25T21:26:05Z", "message": "minor changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13f897f0fa4a84b7ffc968727ea00c7740ef682d", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/13f897f0fa4a84b7ffc968727ea00c7740ef682d", "committedDate": "2020-09-25T21:28:15Z", "message": "small change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/8a5b95f17729cea5bf60c44e704f582c427432e0", "committedDate": "2020-09-25T21:43:05Z", "message": " validateam getfileHandleId"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NzYzMjg2", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#pullrequestreview-497763286", "createdAt": "2020-09-28T17:49:22Z", "commit": {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNzo0OToyMlrOHZJUPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxODoxMzoxOVrOHZKInA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEyOTA4Nw==", "bodyText": "The limit 1 is not required, this query will always return 1 value.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496129087", "createdAt": "2020-09-28T17:49:22Z", "author": {"login": "marcomarasca"}, "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/DBOTeamDAOImpl.java", "diffHunk": "@@ -193,6 +193,8 @@\n \t\t\t\t+\" FROM \"+TeamUtils.ALL_TEAMS_AND_ADMIN_MEMBERS_CORE\n \t\t\t\t+\" AND gm.\"+COL_GROUP_MEMBERS_MEMBER_ID+\"=:\"+COL_GROUP_MEMBERS_MEMBER_ID;\n \n+\tprivate static final String SELECT_CHECK_TEAM_EXISTS = \"SELECT COUNT(*) FROM \" + TABLE_TEAM + \" WHERE \" + COL_TEAM_ID + \" = ? LIMIT 1\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzMTY1OA==", "bodyText": "Missing @OverRide annotation", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496131658", "createdAt": "2020-09-28T17:53:42Z", "author": {"login": "marcomarasca"}, "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/DBOTeamDAOImpl.java", "diffHunk": "@@ -316,6 +318,13 @@ public Team get(String id) throws DatastoreException, NotFoundException {\n \t\tTeam dto = TeamUtils.copyDboToDto(dbo);\n \t\treturn dto;\n \t}\n+\n+\tpublic void validateTeamExists(String teamId) throws DatastoreException, NotFoundException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzMjU3NA==", "bodyText": "As previously noted, if you want to have a consistent message this can be applied to the get in the dao", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496132574", "createdAt": "2020-09-28T17:55:17Z", "author": {"login": "marcomarasca"}, "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/DBOTeamDAOImpl.java", "diffHunk": "@@ -316,6 +318,13 @@ public Team get(String id) throws DatastoreException, NotFoundException {\n \t\tTeam dto = TeamUtils.copyDboToDto(dbo);\n \t\treturn dto;\n \t}\n+\n+\tpublic void validateTeamExists(String teamId) throws DatastoreException, NotFoundException {\n+\t\tLong exists = jdbcTemplate.queryForObject(SELECT_CHECK_TEAM_EXISTS, Long.class, teamId);\n+\t\tif (exists == 0) {\n+\t\t\tthrow new NotFoundException(\"Team does not exist for teamId: \" + teamId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzMzkwNA==", "bodyText": "You can return a boolean from your query", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496133904", "createdAt": "2020-09-28T17:57:33Z", "author": {"login": "marcomarasca"}, "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/DBOTeamDAOImpl.java", "diffHunk": "@@ -316,6 +318,13 @@ public Team get(String id) throws DatastoreException, NotFoundException {\n \t\tTeam dto = TeamUtils.copyDboToDto(dbo);\n \t\treturn dto;\n \t}\n+\n+\tpublic void validateTeamExists(String teamId) throws DatastoreException, NotFoundException {\n+\t\tLong exists = jdbcTemplate.queryForObject(SELECT_CHECK_TEAM_EXISTS, Long.class, teamId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzNDcxOQ==", "bodyText": "You can import statically the needed assertion methods.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496134719", "createdAt": "2020-09-28T17:59:02Z", "author": {"login": "marcomarasca"}, "path": "lib/jdomodels/src/test/java/org/sagebionetworks/repo/model/dbo/dao/DBOTeamDAOImplTest.java", "diffHunk": "@@ -349,10 +349,10 @@ public void testGetAllTeamsAndMembers() {\n \t\tfor (Team t : expectedAllTeamsAndMembers.keySet()) {\n \t\t\tCollection<TeamMember> expectedTeamMembers = expectedAllTeamsAndMembers.get(t);\n \t\t\tCollection<TeamMember> actualTeamMembers = actualAllTeamsAndMembers.get(t);\n-\t\t\tassertNotNull(\"Missing key \"+t, actualTeamMembers);\n+\t\t\tAssertions.assertNotNull(actualTeamMembers, \"Missing key \"+t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzNTc5Nw==", "bodyText": "The public modifier is not needed", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496135797", "createdAt": "2020-09-28T18:00:54Z", "author": {"login": "marcomarasca"}, "path": "lib/models/src/main/java/org/sagebionetworks/repo/model/TeamDAO.java", "diffHunk": "@@ -25,7 +25,18 @@\n \t * @throws NotFoundException\n \t */\n \tpublic Team get(String id) throws DatastoreException, NotFoundException;\n-\t\n+\n+\n+\t/**\n+\t * Validates that team exists, if the team does not exist, throws an exception\n+\t *\n+\t * @param teamId\n+\t * @return\n+\t * @throws DatastoreException\n+\t * @throws NotFoundException\n+\t */\n+\tpublic void validateTeamExists(String teamId) throws DatastoreException, NotFoundException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzNTk3Mg==", "bodyText": "\"throws a NotFoundException\"", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496135972", "createdAt": "2020-09-28T18:01:12Z", "author": {"login": "marcomarasca"}, "path": "lib/models/src/main/java/org/sagebionetworks/repo/model/TeamDAO.java", "diffHunk": "@@ -25,7 +25,18 @@\n \t * @throws NotFoundException\n \t */\n \tpublic Team get(String id) throws DatastoreException, NotFoundException;\n-\t\n+\n+\n+\t/**\n+\t * Validates that team exists, if the team does not exist, throws an exception", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzNjAzOQ==", "bodyText": "When is this thrown?", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496136039", "createdAt": "2020-09-28T18:01:20Z", "author": {"login": "marcomarasca"}, "path": "lib/models/src/main/java/org/sagebionetworks/repo/model/TeamDAO.java", "diffHunk": "@@ -25,7 +25,18 @@\n \t * @throws NotFoundException\n \t */\n \tpublic Team get(String id) throws DatastoreException, NotFoundException;\n-\t\n+\n+\n+\t/**\n+\t * Validates that team exists, if the team does not exist, throws an exception\n+\t *\n+\t * @param teamId\n+\t * @return\n+\t * @throws DatastoreException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzODQ2Mg==", "bodyText": "We should test the logic of the method and not that a single line of code is invoked.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496138462", "createdAt": "2020-09-28T18:05:42Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/manager/team/TeamManagerImplTest.java", "diffHunk": "@@ -974,60 +963,47 @@ public void testListAllMembersWithPrefix() {\n \n \t\twhen(mockPrincipalPrefixDao.listTeamMembersForPrefix(prefix, Long.parseLong(TEAM_ID),10L, 0L)).thenReturn(Arrays.asList(adminMemberId, nonAdminMemberId));\t\t\n \t\twhen(mockTeamDAO.listMembers(Collections.singletonList(Long.parseLong(TEAM_ID)), Arrays.asList(adminMemberId, nonAdminMemberId))).thenReturn(ListWrapper.wrap(Arrays.asList(adminMember, nonAdminMember), TeamMember.class));\n-\t\t\n+\n \t\tList<TeamMember> actual = teamManagerImpl.listMembersForPrefix(prefix, TEAM_ID, TeamMemberTypeFilterOptions.ALL, 10L, 0L).getResults();\n \t\t\n \t\tverify(mockPrincipalPrefixDao, times(1)).listTeamMembersForPrefix(prefix, Long.parseLong(TEAM_ID), 10L, 0L);\n \t\tverify(mockTeamDAO, times(1)).listMembers(Collections.singletonList(Long.parseLong(TEAM_ID)), Arrays.asList(adminMemberId, nonAdminMemberId));\n \t\tassertEquals(Arrays.asList(adminMember, nonAdminMember), actual);\n \t}\n \n+\n \t@Test\n-\tpublic void testListMembersForPrefixInvalidTeam() {\n+\tpublic void testListMembersForPrefixCheckTeamExists() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzOTIwMQ==", "bodyText": "Good practice is to setup the mock for this call.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496139201", "createdAt": "2020-09-28T18:07:06Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/manager/team/TeamManagerImplTest.java", "diffHunk": "@@ -974,60 +963,47 @@ public void testListAllMembersWithPrefix() {\n \n \t\twhen(mockPrincipalPrefixDao.listTeamMembersForPrefix(prefix, Long.parseLong(TEAM_ID),10L, 0L)).thenReturn(Arrays.asList(adminMemberId, nonAdminMemberId));\t\t\n \t\twhen(mockTeamDAO.listMembers(Collections.singletonList(Long.parseLong(TEAM_ID)), Arrays.asList(adminMemberId, nonAdminMemberId))).thenReturn(ListWrapper.wrap(Arrays.asList(adminMember, nonAdminMember), TeamMember.class));\n-\t\t\n+\n \t\tList<TeamMember> actual = teamManagerImpl.listMembersForPrefix(prefix, TEAM_ID, TeamMemberTypeFilterOptions.ALL, 10L, 0L).getResults();\n \t\t\n \t\tverify(mockPrincipalPrefixDao, times(1)).listTeamMembersForPrefix(prefix, Long.parseLong(TEAM_ID), 10L, 0L);\n \t\tverify(mockTeamDAO, times(1)).listMembers(Collections.singletonList(Long.parseLong(TEAM_ID)), Arrays.asList(adminMemberId, nonAdminMemberId));\n \t\tassertEquals(Arrays.asList(adminMember, nonAdminMember), actual);\n \t}\n \n+\n \t@Test\n-\tpublic void testListMembersForPrefixInvalidTeam() {\n+\tpublic void testListMembersForPrefixCheckTeamExists() {\n+\t\tArrayList<Long> list = new ArrayList<Long>();\n+\t\tlist.add(Long.parseLong(TEAM_ID));\n+\t\twhen(mockTeamDAO.listMembers(list, Arrays.asList())).thenReturn(ListWrapper.wrap(Arrays.asList(), TeamMember.class));\n \t\tString prefix = \"pfx\";\n-\t\tString invalidTeamId = \"000\";\n-\t\tNotFoundException ex = new NotFoundException(\"teamDAO\");\n-\t\twhen(mockTeamDAO.get(invalidTeamId)).thenThrow(ex);\n-\t\tNotFoundException exception = Assertions.assertThrows(NotFoundException.class, () -> {\n-\t\t\t// Call under test\n-\t\t\tteamManagerImpl.listMembersForPrefix(prefix, invalidTeamId, null, 10L, 0L);\n-\t\t});\n-\t\tassertEquals(\"Team does not exist for teamId: \" + invalidTeamId, exception.getMessage());\n-        assertEquals(ex, exception.getCause());\n+\t\t// Call under test\n+\t\tteamManagerImpl.listMembersForPrefix(prefix, TEAM_ID, TeamMemberTypeFilterOptions.ALL, 10L, 0L);\n+\t\tverify(mockTeamDAO).validateTeamExists(TEAM_ID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE0MTUyMA==", "bodyText": "You are making an additional query that is not necessary, the get(teamId) already throws an exception.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496141520", "createdAt": "2020-09-28T18:11:23Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/team/TeamManagerImpl.java", "diffHunk": "@@ -730,6 +726,7 @@ public String getIconPreviewURL(UserInfo userInfo, String teamId) throws NotFoun\n \t}\n \n \tString getFileHandleId(String teamId) throws NotFoundException {\n+\t\tteamDAO.validateTeamExists(teamId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE0MjQ5Mg==", "bodyText": "Assertions. is not needed as the assertion methods are statically imported.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496142492", "createdAt": "2020-09-28T18:13:19Z", "author": {"login": "marcomarasca"}, "path": "services/repository/src/test/java/org/sagebionetworks/repo/web/controller/TeamControllerAutowiredTest.java", "diffHunk": "@@ -75,12 +79,13 @@ public void testGetTeamIdsByMember() throws Exception {\n \t */\n \t@Test\n \tpublic void testGetTeamMembersByInvalidId() throws Exception {\n-\t\tString invalidTeamId = \"000\";\n+\t\tString invalidTeamId = \"404\";\n+\t\tString expectedResponse = \"{\\\"reason\\\":\\\"Team does not exist for teamId: \" + invalidTeamId + \"\\\"}\";\n \t\tNotFoundException exception = Assertions.assertThrows(NotFoundException.class, () -> {\n \t\t\t// Call under test\n \t\t\tservletTestHelper.getTeamMembersWithTeamId(dispatchServlet, adminUserId, invalidTeamId);\n \t\t});\n-\t\tAssert.assertEquals(\"{\\\"reason\\\":\\\"Team does not exist for teamId: \" + invalidTeamId + \"\\\"}\", exception.getMessage());\n+\t\tAssertions.assertEquals(expectedResponse, exception.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6249af246872babd1b07b0e69f277c493f38ff9d", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/6249af246872babd1b07b0e69f277c493f38ff9d", "committedDate": "2020-09-29T02:43:35Z", "message": "add tests, add exception to get function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "530eb80bb4fb9665eb92f4bcc220df0e978fe443", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/530eb80bb4fb9665eb92f4bcc220df0e978fe443", "committedDate": "2020-09-29T20:27:18Z", "message": " testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "751e032863bed724a659030d7bcf8ac654d6ed00", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/751e032863bed724a659030d7bcf8ac654d6ed00", "committedDate": "2020-09-30T17:32:57Z", "message": "added tests in TeamManagerImpl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39a3dc0c3ec3bfa42a7081862efe276088d870a6", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/39a3dc0c3ec3bfa42a7081862efe276088d870a6", "committedDate": "2020-09-30T17:37:26Z", "message": "Merge branch 'develop' into PLFM-6390"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9086a6c9c9859e968b6bd860ff369aaffab928c3", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/9086a6c9c9859e968b6bd860ff369aaffab928c3", "committedDate": "2020-09-30T19:13:55Z", "message": "verify TeamDAO.get()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30573e257952c5fb5f3e17bdd0be5c71d21e152d", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/30573e257952c5fb5f3e17bdd0be5c71d21e152d", "committedDate": "2020-09-30T19:18:17Z", "message": " minor change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82e71e25aad7dc2ac3434d5751026871cefcf0df", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/82e71e25aad7dc2ac3434d5751026871cefcf0df", "committedDate": "2020-09-30T20:08:59Z", "message": " verify number of times"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e81caf17b933b7163b97a34b838190a61af3ba5f", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/e81caf17b933b7163b97a34b838190a61af3ba5f", "committedDate": "2020-09-30T20:36:52Z", "message": " teamserviceautowire"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "087f5c2a96699e7a7700eced6303aff2561b200e", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/087f5c2a96699e7a7700eced6303aff2561b200e", "committedDate": "2020-09-30T21:01:06Z", "message": " mock error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed6d6c37cc7e393ef4c0b6d84e4272a1dd935937", "author": {"user": {"login": "nlgilber", "name": "Nicoletta"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/ed6d6c37cc7e393ef4c0b6d84e4272a1dd935937", "committedDate": "2020-09-30T21:42:36Z", "message": "intellij"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5ODY3OTQ4", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#pullrequestreview-499867948", "createdAt": "2020-09-30T22:58:24Z", "commit": {"oid": "ed6d6c37cc7e393ef4c0b6d84e4272a1dd935937"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4665, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}