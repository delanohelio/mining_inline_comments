{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5NzkzMzUw", "number": 4021, "title": "PLFM-6158 - Part C: Initial refactoring of EntityField dependency", "bodyText": "", "createdAt": "2020-04-27T23:07:48Z", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4021", "merged": true, "mergeCommit": {"oid": "d2e14a2a5bbd4413b6971aab109c20d026679f41"}, "closed": true, "closedAt": "2020-04-28T01:06:44Z", "author": {"login": "marcomarasca"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcb3DfrAH2gAyNDA5NzkzMzUwOmU5M2Q0MjEyNzc3OTNjZDQwMWI1MDdiOGMyZTY5NjBmZTE3ODU1NDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcb5SWQAFqTQwMTQzMDQ2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e93d421277793cd401b507b8c2e6960fe1785544", "author": {"user": {"login": "marcomarasca", "name": "Marco Marasca"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/e93d421277793cd401b507b8c2e6960fe1785544", "committedDate": "2020-04-27T22:30:38Z", "message": "PLFM-6158: Initial approach to get rid of EntityField"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9d5d0e9ae8c4ce413fddb879227538ad436042f", "author": {"user": {"login": "marcomarasca", "name": "Marco Marasca"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/e9d5d0e9ae8c4ce413fddb879227538ad436042f", "committedDate": "2020-04-27T22:40:51Z", "message": "PLFM-6158: Deprecate method that depends on EntityField"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f58f16819ace774610aa83eb54a7440df50279a5", "author": {"user": {"login": "marcomarasca", "name": "Marco Marasca"}}, "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/f58f16819ace774610aa83eb54a7440df50279a5", "committedDate": "2020-04-27T23:06:12Z", "message": "PLFM-6158: Additional parameterization by object type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNDI0MTY0", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4021#pullrequestreview-401424164", "createdAt": "2020-04-28T00:46:03Z", "commit": {"oid": "f58f16819ace774610aa83eb54a7440df50279a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwMDo0NjowM1rOGM9saA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwMDo0NjowM1rOGM9saA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjI0Njg4OA==", "bodyText": "Convert EntityField to be more generic -> ObjectField, and use it statically in many places, but not all.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4021#discussion_r416246888", "createdAt": "2020-04-28T00:46:03Z", "author": {"login": "john-hill"}, "path": "lib/lib-table-cluster/src/main/java/org/sagebionetworks/table/cluster/TableIndexDAOImpl.java", "diffHunk": "@@ -934,6 +938,37 @@ public void createViewSnapshotFromEntityReplication(ObjectType objectType, Long\n \t\t\toutputStream.writeNext(row);\r\n \t\t});\r\n \t}\r\n+\t\r\n+\t// Translates the Column Model schema into a column metadata schema, that maps to the object/annotation replication index\r\n+\tList<ColumnMetadata> translateSchema(ObjectType objectType, List<ColumnModel> schema) {\r\n+\t\treturn schema.stream()\r\n+\t\t\t.map((ColumnModel columnModel) -> translateColumnModel(objectType, columnModel))\r\n+\t\t\t.collect(Collectors.toList());\r\n+\t}\r\n+\t\r\n+\tColumnMetadata translateColumnModel(ObjectType objectType, ColumnModel model) {\r\n+\t\t// First determine if this an object column or an annotation\r\n+\t\tOptional<EntityField> entityField = findObjectField(objectType, model);\r\n+\t\t\r\n+\t\tString selectColumnForId = SQLUtils.getColumnNameForId(model.getId());\r\n+\t\tboolean isObjectReplicationField;\r\n+\t\tString selectColumnName;\r\n+\t\t\r\n+\t\tif (entityField.isPresent()) {\r\n+\t\t\tisObjectReplicationField = true;\r\n+\t\t\tselectColumnName = entityField.get().getDatabaseColumnName();\r\n+\t\t} else {\r\n+\t\t\tisObjectReplicationField = false;\r\n+\t\t\tselectColumnName = SQLUtils.translateColumnTypeToAnnotationValueName(model.getColumnType());\r\n+\t\t}\r\n+\t\t\r\n+\t\treturn new ColumnMetadata(model, selectColumnName, selectColumnForId, isObjectReplicationField);\r\n+\t}\r\n+\t\r\n+\tOptional<EntityField> findObjectField(ObjectType objectType, ColumnModel model) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58f16819ace774610aa83eb54a7440df50279a5"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNDI4Nzc4", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4021#pullrequestreview-401428778", "createdAt": "2020-04-28T01:01:11Z", "commit": {"oid": "f58f16819ace774610aa83eb54a7440df50279a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwMTowMToxMVrOGM-AOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwMTowMToxMVrOGM-AOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjI1MTk2MA==", "bodyText": "needs a test or revert to the tested code.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4021#discussion_r416251960", "createdAt": "2020-04-28T01:01:11Z", "author": {"login": "john-hill"}, "path": "lib/lib-table-cluster/src/main/java/org/sagebionetworks/table/cluster/TableIndexDAOImpl.java", "diffHunk": "@@ -934,6 +938,37 @@ public void createViewSnapshotFromEntityReplication(ObjectType objectType, Long\n \t\t\toutputStream.writeNext(row);\r\n \t\t});\r\n \t}\r\n+\t\r\n+\t// Translates the Column Model schema into a column metadata schema, that maps to the object/annotation replication index\r\n+\tList<ColumnMetadata> translateSchema(ObjectType objectType, List<ColumnModel> schema) {\r\n+\t\treturn schema.stream()\r\n+\t\t\t.map((ColumnModel columnModel) -> translateColumnModel(objectType, columnModel))\r\n+\t\t\t.collect(Collectors.toList());\r\n+\t}\r\n+\t\r\n+\tColumnMetadata translateColumnModel(ObjectType objectType, ColumnModel model) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f58f16819ace774610aa83eb54a7440df50279a5"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNDMwNDYy", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4021#pullrequestreview-401430462", "createdAt": "2020-04-28T01:06:40Z", "commit": {"oid": "f58f16819ace774610aa83eb54a7440df50279a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4679, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}