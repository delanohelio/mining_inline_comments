{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MDEwOTYz", "number": 4101, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyMjo0NlrOEGdtBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOTowNDozMlrOEGevng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjEzNTczOnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/schema/JsonSchemaManagerImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyMjo0NlrOGlRxKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyMjo0NlrOGlRxKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MTYxMQ==", "bodyText": "schema id?", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101#discussion_r441741611", "createdAt": "2020-06-17T18:22:46Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/schema/JsonSchemaManagerImpl.java", "diffHunk": "@@ -301,33 +293,28 @@ public void truncateAll() {\n \n \t@WriteTransaction\n \t@Override\n-\tpublic void deleteSchemaAllVersion(UserInfo user, String organizationName, String schemaName) {\n+\tpublic void deleteSchemaById(UserInfo user, String $id) {\n \t\tValidateArgument.required(user, \"user\");\n-\t\tValidateArgument.required(organizationName, \"organizationName\");\n-\t\tValidateArgument.required(schemaName, \"schemaName\");\n-\t\tJsonSchemaVersionInfo versionInfo = jsonSchemaDao.getVersionLatestInfo(organizationName, schemaName);\n-\t\t// Must have delete on the organization\n-\t\tif (!user.isAdmin()) {\n-\t\t\taclDao.canAccess(user, versionInfo.getOrganizationId(), ObjectType.ORGANIZATION, ACCESS_TYPE.DELETE)\n-\t\t\t\t\t.checkAuthorizationOrElseThrow();\n+\t\tValidateArgument.required($id, \"organizationName\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjE0NTg5OnYy", "diffSide": "RIGHT", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/schema/JsonSchemaManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyNTo0NVrOGlR3pQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODoyNTo0NVrOGlR3pQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MzI2OQ==", "bodyText": "There is a missing @OverRide in the implementation", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101#discussion_r441743269", "createdAt": "2020-06-17T18:25:45Z", "author": {"login": "marcomarasca"}, "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/schema/JsonSchemaManager.java", "diffHunk": "@@ -82,24 +82,7 @@\n \t * @param semanticVersion\n \t * @return\n \t */\n-\tJsonSchema getSchema(String organizationName, String schemaName, String semanticVersion);\n-\n-\t/**\n-\t * Attempt to delete all version of a schema.\n-\t * @param user\n-\t * @param organizationName\n-\t * @param schemaName\n-\t */\n-\tpublic void deleteSchemaAllVersion(UserInfo user, String organizationName, String schemaName);\n-\t\n-\t/**\n-\t * Delete a specific version of a schema.\n-\t * @param user\n-\t * @param organizationName\n-\t * @param schemaName\n-\t * @param semanticVersion\n-\t */\n-\tvoid deleteSchemaVersion(UserInfo user, String organizationName, String schemaName, String semanticVersion);\n+\tJsonSchema getSchema(String $id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjI5MDg0OnYy", "diffSide": "RIGHT", "path": "services/repository/src/main/java/org/sagebionetworks/repo/web/controller/JsonSchemaController.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODo1OTo1MVrOGlTYvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxODo1OTo1MVrOGlTYvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc2ODEyNA==", "bodyText": "Please make sure that the published BNF in the controller docs (schema create?) for the schema is aligned with the dash.", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101#discussion_r441768124", "createdAt": "2020-06-17T18:59:51Z", "author": {"login": "marcomarasca"}, "path": "services/repository/src/main/java/org/sagebionetworks/repo/web/controller/JsonSchemaController.java", "diffHunk": "@@ -275,38 +277,24 @@ public void deleteOrganization(@RequestParam(value = AuthorizationConstants.USER\n \t}\n \n \t/**\n-\t * Get a registered JSON schema using its $id. This method excludes the semantic\n-\t * version, and will return the latest version of the schema.\n+\t * Get a registered JSON schema using its $id.\n \t * \n \t * @param userId\n-\t * @param id     The $if of the schema to get.\n+\t * @param organizationName The organization name of the schema.\n+\t * @param schemaNameDashSemanticVersion The schema name with an optional dash semantic version.\n \t * @return\n \t */\n \t@RequiredScope({ view })\n \t@ResponseStatus(HttpStatus.OK)\n \t@RequestMapping(value = { UrlHelpers.JSON_SHCEMA_TYPE_REG_ORG_NAME }, method = RequestMethod.GET)\n-\tpublic @ResponseBody JsonSchema getJsonSchemaNoVersion(@PathVariable String organizationName,\n-\t\t\t@PathVariable String schemaName) {\n-\t\tString semanticVersion = null;\n-\t\treturn serviceProvider.getSchemaServices().getSchema(organizationName, schemaName, semanticVersion);\n+\tpublic @ResponseBody JsonSchema getJsonSchemaNoVersion(@PathVariable(required = true) String organizationName,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjMwNTE1OnYy", "diffSide": "RIGHT", "path": "services/workers/src/test/resources/pets/Cat.json", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOTowNDoxMVrOGlTh3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOTowNDoxMVrOGlTh3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3MDQ2MA==", "bodyText": "Should have the \"type\" property as \"string\"", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101#discussion_r441770460", "createdAt": "2020-06-17T19:04:11Z", "author": {"login": "marcomarasca"}, "path": "services/workers/src/test/resources/pets/Cat.json", "diffHunk": "@@ -10,6 +10,9 @@\n \t\"properties\": {\n \t\t\"breed\": {\n \t\t\t\"$ref\": \"my.organization/pets.cat.Breed\"\n+\t\t},\n+\t\t\"petType\": {\n+\t\t\t\"const\": \"cat\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1MjMwNjIyOnYy", "diffSide": "RIGHT", "path": "services/workers/src/test/resources/pets/Dog.json", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOTowNDozMlrOGlTijQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxOTowNDozMlrOGlTijQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc3MDYzNw==", "bodyText": "Should have \"type\" property with value \"string\"", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101#discussion_r441770637", "createdAt": "2020-06-17T19:04:32Z", "author": {"login": "marcomarasca"}, "path": "services/workers/src/test/resources/pets/Dog.json", "diffHunk": "@@ -4,12 +4,15 @@\n \t\"description\": \"...\",\n \t\"allOf\": [\n \t\t{\n-\t\t\t\"$ref\": \"my.organization/pets.Pet/1.0.3\"\n+\t\t\t\"$ref\": \"my.organization/pets.Pet-1.0.3\"\n \t\t}\n \t],\n \t\"properties\": {\n \t\t\"breed\": {\n \t\t\t\"$ref\": \"my.organization/pets.dog.Breed\"\n+\t\t},\n+\t\t\"petType\": {\n+\t\t\t\"const\": \"dog\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3084, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}