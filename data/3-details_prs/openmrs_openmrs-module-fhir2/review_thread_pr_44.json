{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MTg0Nzc0", "number": 44, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODoxNjozN1rODa-ZLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDozMDoxMFrODbPY0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NjExODIzOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/FhirServiceRequestDao.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODoxNjozN1rOFiMjHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODoxNjozN1rOFiMjHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQwMTUwMw==", "bodyText": "My opinion is that this belongs in the FhirTaskDao.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/44#discussion_r371401503", "createdAt": "2020-01-27T18:16:37Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/FhirServiceRequestDao.java", "diffHunk": "@@ -11,9 +11,15 @@\n \n import javax.validation.constraints.NotNull;\n \n+import java.util.Collection;\n+import java.util.List;\n+\n import org.openmrs.TestOrder;\n+import org.openmrs.module.fhir2.Task;\n \n public interface FhirServiceRequestDao {\n \t\n \tTestOrder getTestOrderByUuid(@NotNull String uuid);\n+\n+\tCollection<Task> getOrderTasksByOrderUUID(@NotNull String uuid);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3317f7cb58eb9fa0cdcd2117a29490a5b838c689"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NjExODUxOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirServiceRequestDaoImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODoxNjo0NFrOFiMjSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODoxNjo0NFrOFiMjSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQwMTU0Ng==", "bodyText": "See above.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/44#discussion_r371401546", "createdAt": "2020-01-27T18:16:44Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirServiceRequestDaoImpl.java", "diffHunk": "@@ -39,4 +43,10 @@ public TestOrder getTestOrderByUuid(String uuid) {\n \t\treturn (TestOrder) sessionFactory.getCurrentSession().createCriteria(TestOrder.class)\n \t\t        .add(Restrictions.eq(\"uuid\", uuid)).uniqueResult();\n \t}\n+\n+\t@Override\n+\tpublic Collection<Task> getOrderTasksByOrderUUID(String uuid) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3317f7cb58eb9fa0cdcd2117a29490a5b838c689"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NjExODkzOnYy", "diffSide": "LEFT", "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirServiceRequestServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODoxNjo1MlrOFiMjhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODoxNjo1MlrOFiMjhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQwMTYwNA==", "bodyText": "Please remove this", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/44#discussion_r371401604", "createdAt": "2020-01-27T18:16:52Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirServiceRequestServiceImpl.java", "diffHunk": "@@ -38,5 +38,6 @@ public ServiceRequest getServiceRequestByUuid(String uuid) {\n \t\t\n \t\treturn translator.toFhirResource(openmrsOrder);\n \t}\n-\t", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3317f7cb58eb9fa0cdcd2117a29490a5b838c689"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5NjEyNDY3OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ServiceRequestTranslatorImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODoxODo0N1rOFiMnHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxODoxODo0N1rOFiMnHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQwMjUyNQ==", "bodyText": "Preferably, should be taskService here.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/44#discussion_r371402525", "createdAt": "2020-01-27T18:18:47Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ServiceRequestTranslatorImpl.java", "diffHunk": "@@ -9,33 +9,37 @@\n  */\n package org.openmrs.module.fhir2.api.translators.impl;\n \n+import javax.inject.Inject;\n import javax.validation.constraints.NotNull;\n \n+import java.util.Collection;\n+import java.util.List;\n+\n import lombok.AccessLevel;\n import lombok.Setter;\n import org.hl7.fhir.r4.model.ServiceRequest;\n import org.openmrs.TestOrder;\n+import org.openmrs.module.fhir2.Task;\n+import org.openmrs.module.fhir2.api.dao.FhirServiceRequestDao;\n import org.openmrs.module.fhir2.api.translators.ServiceRequestTranslator;\n import org.springframework.stereotype.Component;\n \n @Component\n @Setter(AccessLevel.PACKAGE)\n public class ServiceRequestTranslatorImpl implements ServiceRequestTranslator {\n-\t\n+\n+\t@Inject\n+\tFhirServiceRequestDao dao;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3317f7cb58eb9fa0cdcd2117a29490a5b838c689"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODg3NDY2OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirTaskDaoImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyMzoxM1rOFimw1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyMzoxM1rOFimw1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzMDk5OQ==", "bodyText": "This should probably be getTasksByBasedOnUuid() for consistency\norderUuid should probably just be uuid.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/44#discussion_r371830999", "createdAt": "2020-01-28T14:23:13Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirTaskDaoImpl.java", "diffHunk": "@@ -45,4 +48,10 @@ public Task saveTask(Task task) throws DAOException {\n \tpublic Task getTaskByUuid(String uuid) {\n \t\treturn (Task) sessionFactory.getCurrentSession().createCriteria(Task.class).add(eq(\"uuid\", uuid)).uniqueResult();\n \t}\n+\n+\t@Override\n+\tpublic Collection<Task> getTasksByBasedOnUUID(String resourceType, String orderUuid) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a580202b0560b0d4bb160f2af84b37bcd08f9f48"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODg4NDU2OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirTaskServiceImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyNTo0NlrOFim21g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyNTo0NlrOFim21g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzMjUzNA==", "bodyText": "Do we need this explicit filtering here?", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/44#discussion_r371832534", "createdAt": "2020-01-28T14:25:46Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirTaskServiceImpl.java", "diffHunk": "@@ -71,5 +78,17 @@ public Task updateTask(String uuid, Task task) {\n \t\t\n \t\treturn translator.toFhirResource(dao.saveTask(translator.toOpenmrsType(openmrsTask, task)));\n \t}\n-\t\n+\n+\t@Override\n+\tpublic Collection<Task> getTasksByBasedOn(Class<? extends DomainResource> obj, String uuid) {\n+\t\tCollection<Task> associatedTasks = new ArrayList<>();\n+\n+\t\tif(obj == ServiceRequest.class || obj == MedicationRequest.class || obj == CarePlan.class){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a580202b0560b0d4bb160f2af84b37bcd08f9f48"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODg5MjcwOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirTaskServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyNzo1MlrOFim75w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyNzo1MlrOFim75w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzMzgzMQ==", "bodyText": "This could also be:\ndao.getTaskByBasedOnUuid(obj.getSimpleName(), uuid).stream().map(translator::toFhirResource).collect(Collectors.toList())", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/44#discussion_r371833831", "createdAt": "2020-01-28T14:27:52Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirTaskServiceImpl.java", "diffHunk": "@@ -71,5 +78,17 @@ public Task updateTask(String uuid, Task task) {\n \t\t\n \t\treturn translator.toFhirResource(dao.saveTask(translator.toOpenmrsType(openmrsTask, task)));\n \t}\n-\t\n+\n+\t@Override\n+\tpublic Collection<Task> getTasksByBasedOn(Class<? extends DomainResource> obj, String uuid) {\n+\t\tCollection<Task> associatedTasks = new ArrayList<>();\n+\n+\t\tif(obj == ServiceRequest.class || obj == MedicationRequest.class || obj == CarePlan.class){\n+\t\t\tfor(org.openmrs.module.fhir2.Task openmrsTask : dao.getTasksByBasedOnUUID(obj.getSimpleName(), uuid)){\n+\t\t\t\tassociatedTasks.add(translator.toFhirResource(openmrsTask));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a580202b0560b0d4bb160f2af84b37bcd08f9f48"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODg5NDU0OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirTaskServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyODoyMVrOFim9HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyODoyMVrOFim9HA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzNDE0MA==", "bodyText": "By convention, a Class object should be named clazz.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/44#discussion_r371834140", "createdAt": "2020-01-28T14:28:21Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirTaskServiceImpl.java", "diffHunk": "@@ -71,5 +78,17 @@ public Task updateTask(String uuid, Task task) {\n \t\t\n \t\treturn translator.toFhirResource(dao.saveTask(translator.toOpenmrsType(openmrsTask, task)));\n \t}\n-\t\n+\n+\t@Override\n+\tpublic Collection<Task> getTasksByBasedOn(Class<? extends DomainResource> obj, String uuid) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a580202b0560b0d4bb160f2af84b37bcd08f9f48"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODg5ODQ1OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ServiceRequestTranslatorImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyOToxM1rOFim_Zw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDoyOToxM1rOFim_Zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzNDcyNw==", "bodyText": "One new line rather than two", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/44#discussion_r371834727", "createdAt": "2020-01-28T14:29:13Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ServiceRequestTranslatorImpl.java", "diffHunk": "@@ -9,33 +9,36 @@\n  */\n package org.openmrs.module.fhir2.api.translators.impl;\n \n+import javax.inject.Inject;\n import javax.validation.constraints.NotNull;\n \n+import java.util.Collection;\n+\n import lombok.AccessLevel;\n import lombok.Setter;\n import org.hl7.fhir.r4.model.ServiceRequest;\n+import org.hl7.fhir.r4.model.Task;\n import org.openmrs.TestOrder;\n+import org.openmrs.module.fhir2.api.FhirTaskService;\n import org.openmrs.module.fhir2.api.translators.ServiceRequestTranslator;\n import org.springframework.stereotype.Component;\n \n @Component\n @Setter(AccessLevel.PACKAGE)\n public class ServiceRequestTranslatorImpl implements ServiceRequestTranslator {\n-\t\n+\n+\t@Inject\n+\tFhirTaskService taskService;\n+\n \t@Override\n \tpublic ServiceRequest toFhirResource(@NotNull TestOrder order) {\n \t\tServiceRequest serviceRequest = new ServiceRequest();\n-\t\t\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a580202b0560b0d4bb160f2af84b37bcd08f9f48"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI5ODkwMjU4OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/FhirTaskDao.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDozMDoxMFrOFinB0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDozMDoxMFrOFinB0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzNTM0Ng==", "bodyText": "This can probably just take a class object rather than a string.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/44#discussion_r371835346", "createdAt": "2020-01-28T14:30:10Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/FhirTaskDao.java", "diffHunk": "@@ -11,12 +11,15 @@\n \n import javax.validation.constraints.NotNull;\n \n+import java.util.Collection;\n+\n import org.openmrs.module.fhir2.Task;\n \n public interface FhirTaskDao {\n \t\n \tpublic Task saveTask(Task task);\n \t\n \tpublic Task getTaskByUuid(@NotNull String taskUUID);\n-\t\n+\n+\tpublic Collection<Task> getTasksByBasedOnUUID(String resourceType, String orderUuid);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a580202b0560b0d4bb160f2af84b37bcd08f9f48"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1219, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}