{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNjc4MzY4", "number": 179, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzo1NDo0OFrOD_B3Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxODowMTo0OFrOD_B9-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDE3Mzk5OnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirUserDefaultPropertiesImpl.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNzo1NDo0OFrOGZfYdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwODozMDo1OVrOGaT_PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM4MTc0OQ==", "bodyText": "It's stored in the user_property table with the user_id equal to the user_id and the property equal to defaultLocale (OpenmrsConstants.USER_PROPERTY_DEFAULT_LOCALE). Of course, the difficult thing is \"how do we know who the current user is\". Unfortunately, this information is stored in a ThreadLocal object stored in Context...", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/179#discussion_r429381749", "createdAt": "2020-05-22T17:54:48Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirUserDefaultPropertiesImpl.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.api.impl;\n+\n+import java.util.Locale;\n+\n+import lombok.AccessLevel;\n+import lombok.Setter;\n+import lombok.extern.slf4j.Slf4j;\n+import org.openmrs.module.fhir2.api.FhirGlobalPropertyService;\n+import org.openmrs.module.fhir2.api.FhirUserDefaultProperties;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+@Slf4j\n+@Component\n+@Transactional\n+@Setter(AccessLevel.PACKAGE)\n+public class FhirUserDefaultPropertiesImpl implements FhirUserDefaultProperties {\n+\t\n+\t@Autowired\n+\tprivate FhirGlobalPropertyService globalPropertyService;\n+\t\n+\t@Override\n+\tpublic Locale getDefaultLocale() {\n+\t\t// TODO find a way of getting userLocale without relying on context\n+\t\t// return Context.getLocale();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da2bd1c2d85bb2ada2260f540be6e0b3ff14169f"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM5MzQxMg==", "bodyText": "The one place we could kind of get access to the current user is in the AuthenticationFilter.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/179#discussion_r429393412", "createdAt": "2020-05-22T18:23:36Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirUserDefaultPropertiesImpl.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.api.impl;\n+\n+import java.util.Locale;\n+\n+import lombok.AccessLevel;\n+import lombok.Setter;\n+import lombok.extern.slf4j.Slf4j;\n+import org.openmrs.module.fhir2.api.FhirGlobalPropertyService;\n+import org.openmrs.module.fhir2.api.FhirUserDefaultProperties;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+@Slf4j\n+@Component\n+@Transactional\n+@Setter(AccessLevel.PACKAGE)\n+public class FhirUserDefaultPropertiesImpl implements FhirUserDefaultProperties {\n+\t\n+\t@Autowired\n+\tprivate FhirGlobalPropertyService globalPropertyService;\n+\t\n+\t@Override\n+\tpublic Locale getDefaultLocale() {\n+\t\t// TODO find a way of getting userLocale without relying on context\n+\t\t// return Context.getLocale();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM4MTc0OQ=="}, "originalCommit": {"oid": "da2bd1c2d85bb2ada2260f540be6e0b3ff14169f"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0MzY0NQ==", "bodyText": "Or Context.getAuthenticatedUser(). I know using Context or UserContext is the last thing we need.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/179#discussion_r430243645", "createdAt": "2020-05-26T08:30:59Z", "author": {"login": "corneliouzbett"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirUserDefaultPropertiesImpl.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.api.impl;\n+\n+import java.util.Locale;\n+\n+import lombok.AccessLevel;\n+import lombok.Setter;\n+import lombok.extern.slf4j.Slf4j;\n+import org.openmrs.module.fhir2.api.FhirGlobalPropertyService;\n+import org.openmrs.module.fhir2.api.FhirUserDefaultProperties;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+@Slf4j\n+@Component\n+@Transactional\n+@Setter(AccessLevel.PACKAGE)\n+public class FhirUserDefaultPropertiesImpl implements FhirUserDefaultProperties {\n+\t\n+\t@Autowired\n+\tprivate FhirGlobalPropertyService globalPropertyService;\n+\t\n+\t@Override\n+\tpublic Locale getDefaultLocale() {\n+\t\t// TODO find a way of getting userLocale without relying on context\n+\t\t// return Context.getLocale();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM4MTc0OQ=="}, "originalCommit": {"oid": "da2bd1c2d85bb2ada2260f540be6e0b3ff14169f"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NDE5MTMwOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirUserDefaultPropertiesImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxODowMTo0OFrOGZfjtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxODowMTo0OFrOGZfjtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM4NDYzMQ==", "bodyText": "I'd suggest that rather than doing this, we replace the _ with - and call Locale.forLanguageTag() with the resulting string. The reason is that this way we can support a much wider range of locales than is possible if we assume this rather narrow format.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/179#discussion_r429384631", "createdAt": "2020-05-22T18:01:48Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirUserDefaultPropertiesImpl.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.api.impl;\n+\n+import java.util.Locale;\n+\n+import lombok.AccessLevel;\n+import lombok.Setter;\n+import lombok.extern.slf4j.Slf4j;\n+import org.openmrs.module.fhir2.api.FhirGlobalPropertyService;\n+import org.openmrs.module.fhir2.api.FhirUserDefaultProperties;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+@Slf4j\n+@Component\n+@Transactional\n+@Setter(AccessLevel.PACKAGE)\n+public class FhirUserDefaultPropertiesImpl implements FhirUserDefaultProperties {\n+\t\n+\t@Autowired\n+\tprivate FhirGlobalPropertyService globalPropertyService;\n+\t\n+\t@Override\n+\tpublic Locale getDefaultLocale() {\n+\t\t// TODO find a way of getting userLocale without relying on context\n+\t\t// return Context.getLocale();\n+\t\tString locale = globalPropertyService.getGlobalProperty(\"default_locale\", \"en_GB\");\n+\t\tif (locale.contains(\"_\")) {\n+\t\t\tString[] langRegion = locale.split(\"_\");\n+\t\t\tlog.info(\"Language :\" + langRegion[0]);\n+\t\t\tlog.info(\"Region :\" + langRegion[1]);\n+\t\t\treturn new Locale.Builder().setLanguage(langRegion[0]).setRegion(langRegion[1]).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da2bd1c2d85bb2ada2260f540be6e0b3ff14169f"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 894, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}