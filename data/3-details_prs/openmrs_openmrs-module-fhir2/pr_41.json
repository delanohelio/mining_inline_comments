{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MTY1MTUx", "number": 41, "title": " FM2-40 Implement OMOD unit tests for Task, Service Request, and Diagnostic Report", "bodyText": "FM2-40 Implement OMOD unit tests for Task, Service Request, and Diagnostic Report\n\n\n\nDescription of what I changed\nAdded OMOD unit tests for Task, DiagnosticReport, and ServiceRequest\n\n\nIssue I worked on\n\n\n\n\nsee https://issues.openmrs.org/browse/FM2-40\nChecklist: I completed these to help reviewers :)\n\n\n\n\n My pull request only contains ONE single commit.\nNo? -> read here on how to squash multiple commits into one\n\n\n My IDE is configured to follow the code style of this project.\nNo? Unsure? -> configure your IDE, format the code and add the changes with git add . && git commit --amend\n\n\n I have added tests to cover my changes. (If you refactored\nexisting code that was well tested you do not have to add tests)\nNo? -> write tests and add them to this commit git add . && git commit --amend\n\n\n I ran mvn clean package right before creating this pull request and\nadded all formatting changes to my commit.\nNo? -> execute above command\n\n\n All new and existing tests passed.\nNo? -> figure out why and add the fix to your commit. It is your responsibility to make sure your code works.\n\n\n My pull request is based on the latest changes of the master branch.\nNo? Unsure? -> execute command git pull --rebase upstream master", "createdAt": "2020-01-25T23:27:59Z", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41", "merged": true, "mergeCommit": {"oid": "b780ea8e02d18ce3cf5442887f6155f1b6a2b8bc"}, "closed": true, "closedAt": "2020-03-04T18:23:06Z", "author": {"login": "pmanko"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-qHJPgBqjI5ODQyODY2MjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKax4-gBqjMwOTc3NDkwNDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "77eea479d6ff8cc5686a69195691d318b6d645ef", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/77eea479d6ff8cc5686a69195691d318b6d645ef", "committedDate": "2020-01-25T23:20:34Z", "message": "Implemented basic OMOD unit tests for Task and ServiceRequest for\nFM2-40."}, "afterCommit": {"oid": "60041f702f8c8797e5583dc599dc479699389da8", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/60041f702f8c8797e5583dc599dc479699389da8", "committedDate": "2020-01-28T05:00:51Z", "message": "Implemented basic OMOD unit tests for Task and ServiceRequest for FM2-40."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "60041f702f8c8797e5583dc599dc479699389da8", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/60041f702f8c8797e5583dc599dc479699389da8", "committedDate": "2020-01-28T05:00:51Z", "message": "Implemented basic OMOD unit tests for Task and ServiceRequest for FM2-40."}, "afterCommit": {"oid": "b7aa4bf1b370f322303c5a604b5203b962ee9c8f", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/b7aa4bf1b370f322303c5a604b5203b962ee9c8f", "committedDate": "2020-01-28T05:21:24Z", "message": "Implemented basic Task OMOD unit tests for FM2-40."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5Mzk4NzQz", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#pullrequestreview-349398743", "createdAt": "2020-01-28T14:07:17Z", "commit": {"oid": "b7aa4bf1b370f322303c5a604b5203b962ee9c8f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDowNzoxN1rOFimLSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxNDowNzoxN1rOFimLSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyMTM4NA==", "bodyText": "We should have one testing naming convention per file. I'd probably prefer changing this one to updateTask_shouldUpdateTask()", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#discussion_r371821384", "createdAt": "2020-01-28T14:07:17Z", "author": {"login": "ibacher"}, "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/TaskFhirResourceProviderTest.java", "diffHunk": "@@ -82,4 +83,22 @@ public void getTaskByWithWrongId_shouldThrowResourceNotFoundException() {\n \t\tassertThat(resourceProvider.getTaskById(idType), nullValue());\n \t}\n \n+\t@Test\n+\tpublic void createTask_shouldCreateNewTask() {\n+\t\twhen(taskService.saveTask(task)).thenReturn(task);\n+\n+\t\tMethodOutcome result = resourceProvider.createTask(task);\n+\t\tassertThat(result.getResource(), equalTo(task));\n+\t}\n+\n+\t@Test\n+\tpublic void shouldUpdateTask() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7aa4bf1b370f322303c5a604b5203b962ee9c8f"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMDUwMTIx", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#pullrequestreview-353050121", "createdAt": "2020-02-04T15:08:22Z", "commit": {"oid": "b7aa4bf1b370f322303c5a604b5203b962ee9c8f"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b7aa4bf1b370f322303c5a604b5203b962ee9c8f", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/b7aa4bf1b370f322303c5a604b5203b962ee9c8f", "committedDate": "2020-01-28T05:21:24Z", "message": "Implemented basic Task OMOD unit tests for FM2-40."}, "afterCommit": {"oid": "6a48c58d1043858a3326385262f36c3fd8672777", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/6a48c58d1043858a3326385262f36c3fd8672777", "committedDate": "2020-02-12T21:21:25Z", "message": "Test fixes and first attempt at Create/Update web tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3ODE0OTU1", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#pullrequestreview-357814955", "createdAt": "2020-02-12T21:52:49Z", "commit": {"oid": "6a48c58d1043858a3326385262f36c3fd8672777"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMTo1Mjo0OVrOFo_5JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMjowMDowN1rOFpAGcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUzNDE4MA==", "bodyText": "I'd save this as a file in the (non-existent) test/resources/org/openmrs/module/fhir2/providers. It can then be loaded by doing something like:\ntry (InputStream is = this.getClass().getClassLoader.getResourceAsStream(\"org/openmrs/module/fhir2/providers/TestDiagnosticReport_LAB.json\") {\n\tjsonDiagnosticReport = IOUtils.toString(is);\n}", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#discussion_r378534180", "createdAt": "2020-02-12T21:52:49Z", "author": {"login": "ibacher"}, "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/DiagnosticReportFhirResourceProviderWebTest.java", "diffHunk": "@@ -32,6 +32,34 @@\n \t\n \tprivate static final String WRONG_UUID = \"9bf0d1ac-62a8-4440-a5a1-eb1015a7cc65\";\n \t\n+\t// TODO: Load from file or clean up some other way - maybe Resource --> JSON representation\n+\tprivate static final String JSON_DIAGNOSTIC_REPORT = \"{\\n\" + \"    \\\"resourceType\\\": \\\"Bundle\\\",\\n\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a48c58d1043858a3326385262f36c3fd8672777"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUzNjI5MQ==", "bodyText": "This probably also should have:\nrequest.setHeader(CONTENT_TYPE, FhirMediaTypes.JSON.toString());", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#discussion_r378536291", "createdAt": "2020-02-12T21:57:20Z", "author": {"login": "ibacher"}, "path": "omod/src/test/java/org/openmrs/module/fhir2/web/servlet/BaseFhirResourceProviderTest.java", "diffHunk": "@@ -141,6 +141,11 @@ public FhirRequestBuilder accept(@NotNull MediaType mediaType) {\n \t\t\treturn this;\n \t\t}\n \t\t\n+\t\tpublic FhirRequestBuilder jsonContent(@NotNull String json) {\n+\t\t\trequest.setContent(json.getBytes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a48c58d1043858a3326385262f36c3fd8672777"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUzNzU4Nw==", "bodyText": "You almost certainly need something here like:\nwhen(service.updateDiagnosticReport(any(), any())).thenReturn(diagnosticReport);", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#discussion_r378537587", "createdAt": "2020-02-12T22:00:07Z", "author": {"login": "ibacher"}, "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/DiagnosticReportFhirResourceProviderWebTest.java", "diffHunk": "@@ -84,7 +113,8 @@ public void updateDiagnosticReport_shouldUpdateExistingDiagnosticReport() throws\n \t\tDiagnosticReport diagnosticReport = new DiagnosticReport();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a48c58d1043858a3326385262f36c3fd8672777"}, "originalPosition": 46}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a48c58d1043858a3326385262f36c3fd8672777", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/6a48c58d1043858a3326385262f36c3fd8672777", "committedDate": "2020-02-12T21:21:25Z", "message": "Test fixes and first attempt at Create/Update web tests"}, "afterCommit": {"oid": "dd92fad901f93e03e56ec7f24cc489c98c5007f5", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/dd92fad901f93e03e56ec7f24cc489c98c5007f5", "committedDate": "2020-02-17T21:23:19Z", "message": "Test fixes and first attempt at Create/Update web tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5OTcyMjQz", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#pullrequestreview-359972243", "createdAt": "2020-02-17T21:28:33Z", "commit": {"oid": "dd92fad901f93e03e56ec7f24cc489c98c5007f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QyMToyODozM1rOFqwCHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QyMToyODozM1rOFqwCHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM3MTQ4Nw==", "bodyText": "I can't figure out why this test (and the corresponding Task Web test) return status code 0 instead of 405. The MethodNotAllowedException seems to not be getting handled correctly, and I couldn't untangle it after looking into it a bit.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#discussion_r380371487", "createdAt": "2020-02-17T21:28:33Z", "author": {"login": "pmanko"}, "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/DiagnosticReportFhirResourceProviderWebTest.java", "diffHunk": "@@ -71,43 +85,83 @@ public void getDiagnosticReportByWrongUuid_shouldReturn404() throws Exception {\n \t\n \t@Test\n \tpublic void createDiagnosticReport_shouldCreateNewDiagnosticReport() throws Exception {\n+\t\tString jsonDiagnosticReport;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_DIAGNOSTIC_REPORT_PATH)) {\n+\t\t\tjsonDiagnosticReport = IOUtils.toString(is);\n+\t\t}\n+\t\t\n \t\tDiagnosticReport diagnosticReport = new DiagnosticReport();\n \t\tdiagnosticReport.setId(DIAGNOSTIC_REPORT_UUID);\n \t\t\n-\t\tMockHttpServletResponse response = post(\"/DiagnosticReport\").accept(FhirMediaTypes.JSON).go();\n+\t\twhen(service.saveDiagnosticReport(any(DiagnosticReport.class))).thenReturn(diagnosticReport);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/DiagnosticReport\").jsonContent(jsonDiagnosticReport)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n \t\t\n \t\tassertThat(response, isCreated());\n \t}\n \t\n \t@Test\n \tpublic void updateDiagnosticReport_shouldUpdateExistingDiagnosticReport() throws Exception {\n+\t\tString jsonDiagnosticReport;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_DIAGNOSTIC_REPORT_PATH)) {\n+\t\t\tjsonDiagnosticReport = IOUtils.toString(is);\n+\t\t}\n+\t\t\n \t\tDiagnosticReport diagnosticReport = new DiagnosticReport();\n \t\tdiagnosticReport.setId(DIAGNOSTIC_REPORT_UUID);\n \t\t\n-\t\tMockHttpServletResponse response = put(\"/DiagnosticReport/\" + WRONG_UUID).accept(FhirMediaTypes.JSON).go();\n+\t\twhen(service.updateDiagnosticReport(anyString(), any(DiagnosticReport.class))).thenReturn(diagnosticReport);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/DiagnosticReport/\" + DIAGNOSTIC_REPORT_UUID)\n+\t\t        .jsonContent(jsonDiagnosticReport).accept(FhirMediaTypes.JSON).go();\n \t\t\n \t\tassertThat(response, isOk());\n \t}\n \t\n \t@Test\n \tpublic void updateDiagnosticReport_shouldErrorForIdMismatch() throws Exception {\n-\t\tDiagnosticReport diagnosticReport = new DiagnosticReport();\n-\t\tdiagnosticReport.setId(DIAGNOSTIC_REPORT_UUID);\n+\t\tString jsonDiagnosticReport;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_DIAGNOSTIC_REPORT_PATH)) {\n+\t\t\tjsonDiagnosticReport = IOUtils.toString(is);\n+\t\t}\n \t\t\n-\t\tMockHttpServletResponse response = put(\"/DiagnosticReport/\" + WRONG_UUID).accept(FhirMediaTypes.JSON).go();\n+\t\tMockHttpServletResponse response = put(\"/DiagnosticReport/\" + WRONG_UUID).jsonContent(jsonDiagnosticReport)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n \t\t\n-\t\t// TODO: Fix so status is 400, not 200. See\n-\t\tassertThat(response, isOk());\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(),\n+\t\t    containsStringIgnoringCase(\"body must contain an ID element which matches the request URL\"));\n \t}\n \t\n \t@Test\n \tpublic void updateDiagnosticReport_shouldErrorForNoId() throws Exception {\n-\t\tDiagnosticReport diagnosticReport = new DiagnosticReport();\n-\t\tdiagnosticReport.setId(DIAGNOSTIC_REPORT_UUID);\n+\t\tString jsonDiagnosticReport;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_DIAGNOSTIC_REPORT_NoId_PATH)) {\n+\t\t\tjsonDiagnosticReport = IOUtils.toString(is);\n+\t\t}\n \t\t\n-\t\tMockHttpServletResponse response = put(\"/DiagnosticReport/\").accept(FhirMediaTypes.JSON).go();\n+\t\tMockHttpServletResponse response = put(\"/DiagnosticReport/\" + DIAGNOSTIC_REPORT_UUID)\n+\t\t        .jsonContent(jsonDiagnosticReport).accept(FhirMediaTypes.JSON).go();\n \t\t\n-\t\t// TODO: Fix so status is 400, not 200.\n-\t\tassertThat(response, isOk());\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateDiagnosticReport_shouldErrorForNonexistentDiagnosticReport() throws Exception {\n+\t\tString jsonDiagnosticReport;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_DIAGNOSTIC_REPORT_WRONG_UUID_PATH)) {\n+\t\t\tjsonDiagnosticReport = IOUtils.toString(is);\n+\t\t}\n+\t\t\n+\t\twhen(service.updateDiagnosticReport(eq(WRONG_UUID), any(DiagnosticReport.class)))\n+\t\t        .thenThrow(MethodNotAllowedException.class);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/DiagnosticReport/\" + WRONG_UUID).jsonContent(jsonDiagnosticReport)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\t// Not sure why this is returning HTTP status code 0\n+\t\tassertThat(response, isMethodNotAllowed());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd92fad901f93e03e56ec7f24cc489c98c5007f5"}, "originalPosition": 126}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5OTczNzE1", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#pullrequestreview-359973715", "createdAt": "2020-02-17T21:33:40Z", "commit": {"oid": "dd92fad901f93e03e56ec7f24cc489c98c5007f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QyMTozMzo0MFrOFqwGxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QyMTozMzo0MFrOFqwGxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM3MjY3OA==", "bodyText": "Not sure if this test is necessary, and if the error handling for updates in the DiagnosticReport and Task ServiceImpl are necessary either. The error handling gets handled by the HAPI libraries, and when(service.updateDiatnosticReport()) is not needed for this and ShouldErrorForIdMismatch() tests. In other words, the error handling implementation for these to cases doesn't seem to have an effect on the handling of the actual request.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#discussion_r380372678", "createdAt": "2020-02-17T21:33:40Z", "author": {"login": "pmanko"}, "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/DiagnosticReportFhirResourceProviderWebTest.java", "diffHunk": "@@ -71,43 +85,83 @@ public void getDiagnosticReportByWrongUuid_shouldReturn404() throws Exception {\n \t\n \t@Test\n \tpublic void createDiagnosticReport_shouldCreateNewDiagnosticReport() throws Exception {\n+\t\tString jsonDiagnosticReport;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_DIAGNOSTIC_REPORT_PATH)) {\n+\t\t\tjsonDiagnosticReport = IOUtils.toString(is);\n+\t\t}\n+\t\t\n \t\tDiagnosticReport diagnosticReport = new DiagnosticReport();\n \t\tdiagnosticReport.setId(DIAGNOSTIC_REPORT_UUID);\n \t\t\n-\t\tMockHttpServletResponse response = post(\"/DiagnosticReport\").accept(FhirMediaTypes.JSON).go();\n+\t\twhen(service.saveDiagnosticReport(any(DiagnosticReport.class))).thenReturn(diagnosticReport);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/DiagnosticReport\").jsonContent(jsonDiagnosticReport)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n \t\t\n \t\tassertThat(response, isCreated());\n \t}\n \t\n \t@Test\n \tpublic void updateDiagnosticReport_shouldUpdateExistingDiagnosticReport() throws Exception {\n+\t\tString jsonDiagnosticReport;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_DIAGNOSTIC_REPORT_PATH)) {\n+\t\t\tjsonDiagnosticReport = IOUtils.toString(is);\n+\t\t}\n+\t\t\n \t\tDiagnosticReport diagnosticReport = new DiagnosticReport();\n \t\tdiagnosticReport.setId(DIAGNOSTIC_REPORT_UUID);\n \t\t\n-\t\tMockHttpServletResponse response = put(\"/DiagnosticReport/\" + WRONG_UUID).accept(FhirMediaTypes.JSON).go();\n+\t\twhen(service.updateDiagnosticReport(anyString(), any(DiagnosticReport.class))).thenReturn(diagnosticReport);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/DiagnosticReport/\" + DIAGNOSTIC_REPORT_UUID)\n+\t\t        .jsonContent(jsonDiagnosticReport).accept(FhirMediaTypes.JSON).go();\n \t\t\n \t\tassertThat(response, isOk());\n \t}\n \t\n \t@Test\n \tpublic void updateDiagnosticReport_shouldErrorForIdMismatch() throws Exception {\n-\t\tDiagnosticReport diagnosticReport = new DiagnosticReport();\n-\t\tdiagnosticReport.setId(DIAGNOSTIC_REPORT_UUID);\n+\t\tString jsonDiagnosticReport;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_DIAGNOSTIC_REPORT_PATH)) {\n+\t\t\tjsonDiagnosticReport = IOUtils.toString(is);\n+\t\t}\n \t\t\n-\t\tMockHttpServletResponse response = put(\"/DiagnosticReport/\" + WRONG_UUID).accept(FhirMediaTypes.JSON).go();\n+\t\tMockHttpServletResponse response = put(\"/DiagnosticReport/\" + WRONG_UUID).jsonContent(jsonDiagnosticReport)\n+\t\t        .accept(FhirMediaTypes.JSON).go();\n \t\t\n-\t\t// TODO: Fix so status is 400, not 200. See\n-\t\tassertThat(response, isOk());\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(),\n+\t\t    containsStringIgnoringCase(\"body must contain an ID element which matches the request URL\"));\n \t}\n \t\n \t@Test\n \tpublic void updateDiagnosticReport_shouldErrorForNoId() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd92fad901f93e03e56ec7f24cc489c98c5007f5"}, "originalPosition": 94}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMTQwNjEy", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#pullrequestreview-361140612", "createdAt": "2020-02-19T14:12:32Z", "commit": {"oid": "dd92fad901f93e03e56ec7f24cc489c98c5007f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDoxMjozMlrOFrpltg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDoxMjozMlrOFrpltg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMxNDQ4Ng==", "bodyText": "This should be !diagnosticReport.getId().equals(uuid). Strings are objects and for objects == asserts that they refer to the same object. This works when the strings are all generated inside the VM because of Java's string interning but is likely to fail in a real-world situation.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#discussion_r381314486", "createdAt": "2020-02-19T14:12:32Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirDiagnosticReportServiceImpl.java", "diffHunk": "@@ -44,12 +46,24 @@ public DiagnosticReport saveDiagnosticReport(DiagnosticReport diagnosticReport)\n \t\n \t@Override\n \tpublic DiagnosticReport updateDiagnosticReport(String uuid, DiagnosticReport diagnosticReport) {\n+\t\tif (diagnosticReport.getId() == null) {\n+\t\t\tthrow new InvalidRequestException(\"Diagnostic Report resource is missing id.\");\n+\t\t}\n+\t\t\n+\t\tif (diagnosticReport.getId() != uuid) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd92fad901f93e03e56ec7f24cc489c98c5007f5"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dd92fad901f93e03e56ec7f24cc489c98c5007f5", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/dd92fad901f93e03e56ec7f24cc489c98c5007f5", "committedDate": "2020-02-17T21:23:19Z", "message": "Test fixes and first attempt at Create/Update web tests"}, "afterCommit": {"oid": "103271db51e5fd79eb4c8feb3b5ee3831b7715a4", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/103271db51e5fd79eb4c8feb3b5ee3831b7715a4", "committedDate": "2020-02-26T20:44:44Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "103271db51e5fd79eb4c8feb3b5ee3831b7715a4", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/103271db51e5fd79eb4c8feb3b5ee3831b7715a4", "committedDate": "2020-02-26T20:44:44Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}, "afterCommit": {"oid": "cd3102992462366b4a91585cbc3b86b7ae7eb960", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/cd3102992462366b4a91585cbc3b86b7ae7eb960", "committedDate": "2020-02-26T21:00:38Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cd3102992462366b4a91585cbc3b86b7ae7eb960", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/cd3102992462366b4a91585cbc3b86b7ae7eb960", "committedDate": "2020-02-26T21:00:38Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}, "afterCommit": {"oid": "10d0537f8bdd229b4e0206cdd1d7d4d04319d646", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/10d0537f8bdd229b4e0206cdd1d7d4d04319d646", "committedDate": "2020-02-26T21:02:38Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "10d0537f8bdd229b4e0206cdd1d7d4d04319d646", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/10d0537f8bdd229b4e0206cdd1d7d4d04319d646", "committedDate": "2020-02-26T21:02:38Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}, "afterCommit": {"oid": "6c319cfe510f1ace172be668cd8f408f401765ac", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/6c319cfe510f1ace172be668cd8f408f401765ac", "committedDate": "2020-02-26T21:26:19Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODY2MzIx", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#pullrequestreview-365866321", "createdAt": "2020-02-27T17:43:14Z", "commit": {"oid": "6c319cfe510f1ace172be668cd8f408f401765ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzo0MzoxNFrOFva4uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzo0MzoxNFrOFva4uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2Nzg5Ng==", "bodyText": "Can we change these names to something that actually reflects what they are testing? Also, are you planning to add more tests to this class in a new PR?", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#discussion_r385267896", "createdAt": "2020-02-27T17:43:14Z", "author": {"login": "ibacher"}, "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/ServiceRequestFhirResourceProviderWebTest.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.providers;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.mockito.Mockito.when;\n+\n+import lombok.AccessLevel;\n+import lombok.Getter;\n+import org.hl7.fhir.r4.model.ServiceRequest;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.Mock;\n+import org.mockito.junit.MockitoJUnitRunner;\n+import org.openmrs.module.fhir2.api.FhirServiceRequestService;\n+import org.openmrs.module.fhir2.web.servlet.BaseFhirResourceProviderTest;\n+import org.springframework.mock.web.MockHttpServletResponse;\n+\n+@RunWith(MockitoJUnitRunner.class)\n+public class ServiceRequestFhirResourceProviderWebTest extends BaseFhirResourceProviderTest<ServiceRequestFhirResourceProvider, ServiceRequest> {\n+\t\n+\tprivate static final String SERVICE_REQUEST_UUID = \"7d13b03b-58c2-43f5-b34d-08750c51aea9\";\n+\t\n+\tprivate static final String WRONG_SERVICE_REQUEST_UUID = \"92b04062-e57d-43aa-8c38-90a1ad70080c\";\n+\t\n+\t@Getter(AccessLevel.PUBLIC)\n+\tprivate ServiceRequestFhirResourceProvider resourceProvider;\n+\t\n+\t@Mock\n+\tprivate FhirServiceRequestService service;\n+\t\n+\t@Override\n+\tpublic void setup() throws Exception {\n+\t\tresourceProvider = new ServiceRequestFhirResourceProvider();\n+\t\tresourceProvider.setServiceRequestService(service);\n+\t\tsuper.setup();\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPractitionerById_shouldReturnPractitioner() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c319cfe510f1ace172be668cd8f408f401765ac"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1ODY3MTc2", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#pullrequestreview-365867176", "createdAt": "2020-02-27T17:44:27Z", "commit": {"oid": "6c319cfe510f1ace172be668cd8f408f401765ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzo0NDoyOFrOFva7Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QxNzo0NDoyOFrOFva7Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2ODUzOQ==", "bodyText": "JSON_DIAGNOSTIC_REPORT_NoId_PATH -> JSON_DIAGNOSTIC_REPORT_NO_ID_PATH or something similar", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#discussion_r385268539", "createdAt": "2020-02-27T17:44:28Z", "author": {"login": "ibacher"}, "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/DiagnosticReportFhirResourceProviderWebTest.java", "diffHunk": "@@ -32,6 +40,12 @@\n \t\n \tprivate static final String WRONG_UUID = \"9bf0d1ac-62a8-4440-a5a1-eb1015a7cc65\";\n \t\n+\tprivate static final String JSON_DIAGNOSTIC_REPORT_PATH = \"org/openmrs/module/fhir2/providers/TestDiagnosticReport_CreateUpdate.json\";\n+\t\n+\tprivate static final String JSON_DIAGNOSTIC_REPORT_NoId_PATH = \"org/openmrs/module/fhir2/providers/TestDiagnosticReport_CreateUpdate_NoId.json\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c319cfe510f1ace172be668cd8f408f401765ac"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c319cfe510f1ace172be668cd8f408f401765ac", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/6c319cfe510f1ace172be668cd8f408f401765ac", "committedDate": "2020-02-26T21:26:19Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}, "afterCommit": {"oid": "d893fed0e23beeee89b3e3dc8a78d273f66da56e", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/d893fed0e23beeee89b3e3dc8a78d273f66da56e", "committedDate": "2020-02-27T23:00:41Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d893fed0e23beeee89b3e3dc8a78d273f66da56e", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/d893fed0e23beeee89b3e3dc8a78d273f66da56e", "committedDate": "2020-02-27T23:00:41Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}, "afterCommit": {"oid": "7f385ef3d0552a456f8192f325fcf23025da61af", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/7f385ef3d0552a456f8192f325fcf23025da61af", "committedDate": "2020-02-27T23:04:50Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3OTUyNzA2", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#pullrequestreview-367952706", "createdAt": "2020-03-03T12:54:07Z", "commit": {"oid": "7f385ef3d0552a456f8192f325fcf23025da61af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dfedc4157c704276d24407fe9736eb7f5fe36138", "author": {"user": {"login": "ibacher", "name": "Ian"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/dfedc4157c704276d24407fe9736eb7f5fe36138", "committedDate": "2020-03-03T12:54:14Z", "message": "Merge branch 'master' into FM-2-40-Task-ServiceRequest"}, "afterCommit": {"oid": "c9fafde2219c52109769c2ccb710c0f975d94251", "author": {"user": {"login": "ibacher", "name": "Ian"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/c9fafde2219c52109769c2ccb710c0f975d94251", "committedDate": "2020-03-04T16:13:15Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4OTM4ODIz", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#pullrequestreview-368938823", "createdAt": "2020-03-04T16:39:15Z", "commit": {"oid": "c9fafde2219c52109769c2ccb710c0f975d94251"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjozOToxNVrOFx02jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxNjozOToxNVrOFx02jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc5MDQ3OA==", "bodyText": "@ibacher I'm not sure why this test is failing.\nAlso, your param to prop changes are in this PR?", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/41#discussion_r387790478", "createdAt": "2020-03-04T16:39:15Z", "author": {"login": "pmanko"}, "path": "api/src/test/java/org/openmrs/module/fhir2/api/dao/impl/FhirPersonDaoImplTest.java", "diffHunk": "@@ -246,6 +246,7 @@ public void shouldReturnCollectionOfPeopleSortedByName() {\n \t\t\n \t\t// Smallest given name of person i should be less than the largest given name of person i + 1.\n \t\tfor (int i = 1; i < people.size(); i++) {\n+\t\t\tassertThat(people.get(i-1).getNames(), not(empty())); // Not sure why this test is failing", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9fafde2219c52109769c2ccb710c0f975d94251"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c9fafde2219c52109769c2ccb710c0f975d94251", "author": {"user": {"login": "ibacher", "name": "Ian"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/c9fafde2219c52109769c2ccb710c0f975d94251", "committedDate": "2020-03-04T16:13:15Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}, "afterCommit": {"oid": "955845cf230d9cdec03b5b529ae75c0aa528379f", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/955845cf230d9cdec03b5b529ae75c0aa528379f", "committedDate": "2020-03-04T16:42:58Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27d002e2ca1e124d30e7b549af1e96a6980eeeba", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/27d002e2ca1e124d30e7b549af1e96a6980eeeba", "committedDate": "2020-03-04T17:57:09Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "955845cf230d9cdec03b5b529ae75c0aa528379f", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/955845cf230d9cdec03b5b529ae75c0aa528379f", "committedDate": "2020-03-04T16:42:58Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}, "afterCommit": {"oid": "27d002e2ca1e124d30e7b549af1e96a6980eeeba", "author": {"user": {"login": "pmanko", "name": "Piotr Mankowski"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/27d002e2ca1e124d30e7b549af1e96a6980eeeba", "committedDate": "2020-03-04T17:57:09Z", "message": "FM2-40 OMOD tests for ServiceRequest, DiagnosticReport, and Task"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4364, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}