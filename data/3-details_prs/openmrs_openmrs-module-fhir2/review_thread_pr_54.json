{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwODMzOTU0", "number": 54, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNDoyODozOFrODc_xRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNjoyMjoxNFrODdCmnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNzMxNTI2OnYy", "diffSide": "RIGHT", "path": "api/src/test/java/org/openmrs/module/fhir2/api/translators/impl/LocationTranslatorImplTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNDoyODozOFrOFlV-cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNDoyODozOFrOFlV-cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcwMTY4Mg==", "bodyText": "Extract constants", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/54#discussion_r374701682", "createdAt": "2020-02-04T14:28:38Z", "author": {"login": "corneliouzbett"}, "path": "api/src/test/java/org/openmrs/module/fhir2/api/translators/impl/LocationTranslatorImplTest.java", "diffHunk": "@@ -271,4 +275,29 @@ public void getLocationContactDetails_shouldWorkAsExpected() {\n \t\tassertThat(omrsLocation.getActiveAttributes().size(), equalTo(1));\n \t\t\n \t}\n+\t\n+\t@Test\n+\tpublic void toFhirResource_shoudTranslateOpenmrsTagsToFhirLocationTags() {\n+\t\tLocationTag tag = new LocationTag(\"Login location\", \"Used to identify login locations\");\n+\t\tomrsLocation.addTag(tag);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "321bc171c54478305ffabab689f9b09ad178cfdc"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNzMzODIzOnYy", "diffSide": "RIGHT", "path": "api/src/test/java/org/openmrs/module/fhir2/api/translators/impl/LocationTranslatorImplTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNDozNDo1MFrOFlWM1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNjoyMzoyMFrOFlaiJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcwNTM2Nw==", "bodyText": "I think the size here should be greaterThanOrEqualTo(1):\nassertThat(omrsLocation.getTags().size(), greaterThanOrEqualTo(1));", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/54#discussion_r374705367", "createdAt": "2020-02-04T14:34:50Z", "author": {"login": "corneliouzbett"}, "path": "api/src/test/java/org/openmrs/module/fhir2/api/translators/impl/LocationTranslatorImplTest.java", "diffHunk": "@@ -271,4 +275,29 @@ public void getLocationContactDetails_shouldWorkAsExpected() {\n \t\tassertThat(omrsLocation.getActiveAttributes().size(), equalTo(1));\n \t\t\n \t}\n+\t\n+\t@Test\n+\tpublic void toFhirResource_shoudTranslateOpenmrsTagsToFhirLocationTags() {\n+\t\tLocationTag tag = new LocationTag(\"Login location\", \"Used to identify login locations\");\n+\t\tomrsLocation.addTag(tag);\n+\t\torg.hl7.fhir.r4.model.Location fhirLocation = locationTranslator.toFhirResource(omrsLocation);\n+\t\tassertThat(fhirLocation.getMeta().getTag(), notNullValue());\n+\t\tassertThat(fhirLocation.getMeta().getTag().size(), greaterThanOrEqualTo(0));\n+\t\tassertThat(fhirLocation.getMeta().getTag().get(0).getCode(), is(\"Login location\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void toOpenmrsType_shouldTranslateFhirTagsToOpenmrsLocationTags() {\n+\t\tList<Coding> tags = new ArrayList<>();\n+\t\tCoding tag = new Coding();\n+\t\ttag.setCode(\"Lab location\");\n+\t\ttag.setDisplay(\"Used to identify lab resources\");\n+\t\ttags.add(tag);\n+\t\torg.hl7.fhir.r4.model.Location fhirLocation = new org.hl7.fhir.r4.model.Location();\n+\t\tfhirLocation.getMeta().setTag(tags);\n+\t\tomrsLocation = locationTranslator.toOpenmrsType(fhirLocation);\n+\t\tassertThat(omrsLocation.getTags(), notNullValue());\n+\t\tassertThat(omrsLocation.getTags().size(), greaterThanOrEqualTo(0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "321bc171c54478305ffabab689f9b09ad178cfdc"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc3NjM1OA==", "bodyText": "You could even use assertThat(omrsLocation.getTags(), hasSize(greaterThanOrEqualTo(1));, but that might be getting too fancy.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/54#discussion_r374776358", "createdAt": "2020-02-04T16:23:20Z", "author": {"login": "ibacher"}, "path": "api/src/test/java/org/openmrs/module/fhir2/api/translators/impl/LocationTranslatorImplTest.java", "diffHunk": "@@ -271,4 +275,29 @@ public void getLocationContactDetails_shouldWorkAsExpected() {\n \t\tassertThat(omrsLocation.getActiveAttributes().size(), equalTo(1));\n \t\t\n \t}\n+\t\n+\t@Test\n+\tpublic void toFhirResource_shoudTranslateOpenmrsTagsToFhirLocationTags() {\n+\t\tLocationTag tag = new LocationTag(\"Login location\", \"Used to identify login locations\");\n+\t\tomrsLocation.addTag(tag);\n+\t\torg.hl7.fhir.r4.model.Location fhirLocation = locationTranslator.toFhirResource(omrsLocation);\n+\t\tassertThat(fhirLocation.getMeta().getTag(), notNullValue());\n+\t\tassertThat(fhirLocation.getMeta().getTag().size(), greaterThanOrEqualTo(0));\n+\t\tassertThat(fhirLocation.getMeta().getTag().get(0).getCode(), is(\"Login location\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void toOpenmrsType_shouldTranslateFhirTagsToOpenmrsLocationTags() {\n+\t\tList<Coding> tags = new ArrayList<>();\n+\t\tCoding tag = new Coding();\n+\t\ttag.setCode(\"Lab location\");\n+\t\ttag.setDisplay(\"Used to identify lab resources\");\n+\t\ttags.add(tag);\n+\t\torg.hl7.fhir.r4.model.Location fhirLocation = new org.hl7.fhir.r4.model.Location();\n+\t\tfhirLocation.getMeta().setTag(tags);\n+\t\tomrsLocation = locationTranslator.toOpenmrsType(fhirLocation);\n+\t\tassertThat(omrsLocation.getTags(), notNullValue());\n+\t\tassertThat(omrsLocation.getTags().size(), greaterThanOrEqualTo(0));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcwNTM2Nw=="}, "originalCommit": {"oid": "321bc171c54478305ffabab689f9b09ad178cfdc"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNzM0NzM3OnYy", "diffSide": "RIGHT", "path": "api/src/test/java/org/openmrs/module/fhir2/api/translators/impl/LocationTranslatorImplTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNDozNzoxMVrOFlWSVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNDozNzoxMVrOFlWSVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDcwNjc3Mw==", "bodyText": "Extract this constant.\nSince you are using in more than one location", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/54#discussion_r374706773", "createdAt": "2020-02-04T14:37:11Z", "author": {"login": "corneliouzbett"}, "path": "api/src/test/java/org/openmrs/module/fhir2/api/translators/impl/LocationTranslatorImplTest.java", "diffHunk": "@@ -271,4 +275,29 @@ public void getLocationContactDetails_shouldWorkAsExpected() {\n \t\tassertThat(omrsLocation.getActiveAttributes().size(), equalTo(1));\n \t\t\n \t}\n+\t\n+\t@Test\n+\tpublic void toFhirResource_shoudTranslateOpenmrsTagsToFhirLocationTags() {\n+\t\tLocationTag tag = new LocationTag(\"Login location\", \"Used to identify login locations\");\n+\t\tomrsLocation.addTag(tag);\n+\t\torg.hl7.fhir.r4.model.Location fhirLocation = locationTranslator.toFhirResource(omrsLocation);\n+\t\tassertThat(fhirLocation.getMeta().getTag(), notNullValue());\n+\t\tassertThat(fhirLocation.getMeta().getTag().size(), greaterThanOrEqualTo(0));\n+\t\tassertThat(fhirLocation.getMeta().getTag().get(0).getCode(), is(\"Login location\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void toOpenmrsType_shouldTranslateFhirTagsToOpenmrsLocationTags() {\n+\t\tList<Coding> tags = new ArrayList<>();\n+\t\tCoding tag = new Coding();\n+\t\ttag.setCode(\"Lab location\");\n+\t\ttag.setDisplay(\"Used to identify lab resources\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "321bc171c54478305ffabab689f9b09ad178cfdc"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxNzc3OTUxOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/LocationTranslatorImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNjoyMjoxNFrOFlae8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNjoyMjoxNFrOFlae8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc3NTUzOQ==", "bodyText": "We should probably add this to FhirConstants. Something like:\nOPENMRS_FHIR_EXT_LOCATION_TAG = OPENMRS_FHIR_EXT_PREFIX + \"/location-tag\";", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/54#discussion_r374775539", "createdAt": "2020-02-04T16:22:14Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/LocationTranslatorImpl.java", "diffHunk": "@@ -78,6 +80,12 @@ public Location toFhirResource(org.openmrs.Location openmrsLocation) {\n \t\t\t}\n \t\t\t\n \t\t\tfhirLocation.setTelecom(getLocationContactDetails(openmrsLocation));\n+\t\t\t\n+\t\t\tif (openmrsLocation.getTags() != null) {\n+\t\t\t\tfor (LocationTag tag : openmrsLocation.getTags()) {\n+\t\t\t\t\tfhirLocation.getMeta().addTag(FhirConstants.OPENMRS_FHIR_EXT_PREFIX + \"/location-tag\", tag.getName(), tag.getDescription());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "321bc171c54478305ffabab689f9b09ad178cfdc"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1229, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}