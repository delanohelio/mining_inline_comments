{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MDY0NDA5", "number": 246, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjoyMzoyNFrOELjc-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMjozNjoxM1rOELqr9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTUwNjUxOnYy", "diffSide": "RIGHT", "path": "api/src/main/java/org/openmrs/module/fhir2/providers/r3/ListFhirResourceProvider.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwNjoyMzoyNFrOGtKMnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMjowMToyN1rOGtUYLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAwNjE3NQ==", "bodyText": "change this to;\nreturn FhirProviderUtils.buildDelete(List30_40.convertList(listResource))));", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/246#discussion_r450006175", "createdAt": "2020-07-06T06:23:24Z", "author": {"login": "corneliouzbett"}, "path": "api/src/main/java/org/openmrs/module/fhir2/providers/r3/ListFhirResourceProvider.java", "diffHunk": "@@ -50,4 +59,34 @@ public ListResource getListById(@IdParam @NotNull IdType id) {\n \t\t\n \t\treturn List30_40.convertList(listResource);\n \t}\n+\n+\t@Create\n+\t@SuppressWarnings(\"unused\")\n+\tpublic MethodOutcome creatListResource(@ResourceParam ListResource listResource) {\n+\t\treturn FhirProviderUtils.buildCreate(\n+\t\t\t\tlistService.create(List30_40.convertList(listResource)));\n+\t}\n+\n+\t@Update\n+\t@SuppressWarnings(\"unused\")\n+\tpublic MethodOutcome updateListResource(@IdParam IdType id, @ResourceParam ListResource listResource) {\n+\t\tif (id == null || id.getIdPart() == null) {\n+\t\t\tthrow new InvalidRequestException(\"id must be specified to update\");\n+\t\t}\n+\n+\t\tlistResource.setId(id.getIdPart());\n+\n+\t\treturn FhirProviderUtils.buildUpdate(listService.update(id.getIdPart(),\n+\t\t\t\tList30_40.convertList(listResource)));\n+\t}\n+\n+\t@Delete\n+\t@SuppressWarnings(\"unused\")\n+\tpublic OperationOutcome deleteListResource(@IdParam @NotNull IdType id) {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = listService.delete(id.getIdPart());\n+\t\tif (listResource == null) {\n+\t\t\tthrow new ResourceNotFoundException(\"Could not find list to delete with id \" + id.getIdPart());\n+\t\t}\n+\t\treturn OperationOutcome30_40.convertOperationOutcome(FhirProviderUtils.buildDelete(listResource));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4720a43d522dd58ef459f10772bed2e665fa327"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE3Mjk3NA==", "bodyText": "@corneliouzbett  sure", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/246#discussion_r450172974", "createdAt": "2020-07-06T12:01:27Z", "author": {"login": "Akayeshmantha"}, "path": "api/src/main/java/org/openmrs/module/fhir2/providers/r3/ListFhirResourceProvider.java", "diffHunk": "@@ -50,4 +59,34 @@ public ListResource getListById(@IdParam @NotNull IdType id) {\n \t\t\n \t\treturn List30_40.convertList(listResource);\n \t}\n+\n+\t@Create\n+\t@SuppressWarnings(\"unused\")\n+\tpublic MethodOutcome creatListResource(@ResourceParam ListResource listResource) {\n+\t\treturn FhirProviderUtils.buildCreate(\n+\t\t\t\tlistService.create(List30_40.convertList(listResource)));\n+\t}\n+\n+\t@Update\n+\t@SuppressWarnings(\"unused\")\n+\tpublic MethodOutcome updateListResource(@IdParam IdType id, @ResourceParam ListResource listResource) {\n+\t\tif (id == null || id.getIdPart() == null) {\n+\t\t\tthrow new InvalidRequestException(\"id must be specified to update\");\n+\t\t}\n+\n+\t\tlistResource.setId(id.getIdPart());\n+\n+\t\treturn FhirProviderUtils.buildUpdate(listService.update(id.getIdPart(),\n+\t\t\t\tList30_40.convertList(listResource)));\n+\t}\n+\n+\t@Delete\n+\t@SuppressWarnings(\"unused\")\n+\tpublic OperationOutcome deleteListResource(@IdParam @NotNull IdType id) {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = listService.delete(id.getIdPart());\n+\t\tif (listResource == null) {\n+\t\t\tthrow new ResourceNotFoundException(\"Could not find list to delete with id \" + id.getIdPart());\n+\t\t}\n+\t\treturn OperationOutcome30_40.convertOperationOutcome(FhirProviderUtils.buildDelete(listResource));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAwNjE3NQ=="}, "originalCommit": {"oid": "c4720a43d522dd58ef459f10772bed2e665fa327"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNjY4MTk1OnYy", "diffSide": "RIGHT", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r3/ListFhirResourceProviderWebTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMjozMzowMVrOGtVVSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMjo0Mzo0OFrOGtVqvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4ODYxOQ==", "bodyText": "Don't you think you should be using delete instead of get in this test ?", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/246#discussion_r450188619", "createdAt": "2020-07-06T12:33:01Z", "author": {"login": "varung-31"}, "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r3/ListFhirResourceProviderWebTest.java", "diffHunk": "@@ -76,4 +92,91 @@ public void shouldReturn404IfListNotFound() throws Exception {\n \t\t\n \t\tassertThat(response, isNotFound());\n \t}\n+\t\n+\t@Test\n+\tpublic void createList_shouldCreateNewList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LIST_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\twhen(cohortFhirListService.create(any(org.hl7.fhir.r4.model.ListResource.class))).thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/List\").jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t\tassertThat(response.getStatus(), is(201));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldUpdateRequestedList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\twhen(cohortFhirListService.update(any(String.class), any(org.hl7.fhir.r4.model.ListResource.class)))\n+\t\t        .thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + LIST_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldErrorForNoId() throws Exception {\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_NO_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + LIST_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldErrorForIdMissMatch() throws Exception {\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_WRONG_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + UNKNOWN_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON)\n+\t\t        .go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(),\n+\t\t    containsStringIgnoringCase(\"body must contain an ID element which matches the request URL\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteList_shouldDeleteList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\twhen(cohortFhirListService.delete(LIST_UUID)).thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = delete(\"/List/\" + LIST_UUID).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteList_shouldReturn404ForNonExistingList() throws Exception {\n+\t\twhen(cohortFhirListService.get(UNKNOWN_UUID)).thenReturn(null);\n+\t\t\n+\t\tMockHttpServletResponse response = get(\"/List/\" + UNKNOWN_UUID).accept(FhirMediaTypes.JSON).go();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbeb7c59acd52149eb84910ad80839838420b523"}, "originalPosition": 124}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE5NDEwOQ==", "bodyText": "exactly it was a mistake", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/246#discussion_r450194109", "createdAt": "2020-07-06T12:43:48Z", "author": {"login": "Akayeshmantha"}, "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r3/ListFhirResourceProviderWebTest.java", "diffHunk": "@@ -76,4 +92,91 @@ public void shouldReturn404IfListNotFound() throws Exception {\n \t\t\n \t\tassertThat(response, isNotFound());\n \t}\n+\t\n+\t@Test\n+\tpublic void createList_shouldCreateNewList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LIST_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\twhen(cohortFhirListService.create(any(org.hl7.fhir.r4.model.ListResource.class))).thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/List\").jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t\tassertThat(response.getStatus(), is(201));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldUpdateRequestedList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\twhen(cohortFhirListService.update(any(String.class), any(org.hl7.fhir.r4.model.ListResource.class)))\n+\t\t        .thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + LIST_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldErrorForNoId() throws Exception {\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_NO_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + LIST_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldErrorForIdMissMatch() throws Exception {\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_WRONG_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + UNKNOWN_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON)\n+\t\t        .go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(),\n+\t\t    containsStringIgnoringCase(\"body must contain an ID element which matches the request URL\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteList_shouldDeleteList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\twhen(cohortFhirListService.delete(LIST_UUID)).thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = delete(\"/List/\" + LIST_UUID).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteList_shouldReturn404ForNonExistingList() throws Exception {\n+\t\twhen(cohortFhirListService.get(UNKNOWN_UUID)).thenReturn(null);\n+\t\t\n+\t\tMockHttpServletResponse response = get(\"/List/\" + UNKNOWN_UUID).accept(FhirMediaTypes.JSON).go();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4ODYxOQ=="}, "originalCommit": {"oid": "fbeb7c59acd52149eb84910ad80839838420b523"}, "originalPosition": 124}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNjY4MjgxOnYy", "diffSide": "RIGHT", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r4/ListFhirResourceProviderWebTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMjozMzoxOFrOGtVV0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMjozMzoxOFrOGtVV0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4ODc1NA==", "bodyText": "ditto", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/246#discussion_r450188754", "createdAt": "2020-07-06T12:33:18Z", "author": {"login": "varung-31"}, "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r4/ListFhirResourceProviderWebTest.java", "diffHunk": "@@ -76,4 +96,84 @@ public void shouldReturn404IfListNotFound() throws Exception {\n \t\t\n \t\tassertThat(response, isNotFound());\n \t}\n+\t\n+\t@Test\n+\tpublic void createList_shouldCreateNewList() throws Exception {\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LIST_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\twhen(cohortFhirListService.create(any(ListResource.class))).thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/List\").jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t\tassertThat(response.getStatus(), is(201));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldUpdateRequestedList() throws Exception {\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\twhen(cohortFhirListService.update(any(String.class), any(ListResource.class))).thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + LIST_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldErrorForNoId() throws Exception {\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_NO_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + LIST_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldErrorForIdMissMatch() throws Exception {\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_WRONG_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + UNKNOWN_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON)\n+\t\t        .go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(),\n+\t\t    containsStringIgnoringCase(\"body must contain an ID element which matches the request URL\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteList_shouldDeleteList() throws Exception {\n+\t\twhen(cohortFhirListService.delete(LIST_UUID)).thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = delete(\"/List/\" + LIST_UUID).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteList_shouldReturn404ForNonExistingList() throws Exception {\n+\t\twhen(cohortFhirListService.get(UNKNOWN_UUID)).thenReturn(null);\n+\t\t\n+\t\tMockHttpServletResponse response = get(\"/List/\" + UNKNOWN_UUID).accept(FhirMediaTypes.JSON).go();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbeb7c59acd52149eb84910ad80839838420b523"}, "originalPosition": 128}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNjY5MTczOnYy", "diffSide": "RIGHT", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r3/ListFhirResourceProviderWebTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMjozNjoxM1rOGtVbZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMjo0NToyM1rOGtVuNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE5MDE4MA==", "bodyText": "You can also add an assert here as -\nassertThat(response.getStatus(), equalTo(404));", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/246#discussion_r450190180", "createdAt": "2020-07-06T12:36:13Z", "author": {"login": "varung-31"}, "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r3/ListFhirResourceProviderWebTest.java", "diffHunk": "@@ -76,4 +92,91 @@ public void shouldReturn404IfListNotFound() throws Exception {\n \t\t\n \t\tassertThat(response, isNotFound());\n \t}\n+\t\n+\t@Test\n+\tpublic void createList_shouldCreateNewList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LIST_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\twhen(cohortFhirListService.create(any(org.hl7.fhir.r4.model.ListResource.class))).thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/List\").jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t\tassertThat(response.getStatus(), is(201));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldUpdateRequestedList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\twhen(cohortFhirListService.update(any(String.class), any(org.hl7.fhir.r4.model.ListResource.class)))\n+\t\t        .thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + LIST_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldErrorForNoId() throws Exception {\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_NO_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + LIST_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldErrorForIdMissMatch() throws Exception {\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_WRONG_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + UNKNOWN_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON)\n+\t\t        .go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(),\n+\t\t    containsStringIgnoringCase(\"body must contain an ID element which matches the request URL\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteList_shouldDeleteList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\twhen(cohortFhirListService.delete(LIST_UUID)).thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = delete(\"/List/\" + LIST_UUID).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteList_shouldReturn404ForNonExistingList() throws Exception {\n+\t\twhen(cohortFhirListService.get(UNKNOWN_UUID)).thenReturn(null);\n+\t\t\n+\t\tMockHttpServletResponse response = get(\"/List/\" + UNKNOWN_UUID).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isNotFound());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fbeb7c59acd52149eb84910ad80839838420b523"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE5Mzg1Mg==", "bodyText": "404 == notfound", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/246#discussion_r450193852", "createdAt": "2020-07-06T12:43:20Z", "author": {"login": "Akayeshmantha"}, "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r3/ListFhirResourceProviderWebTest.java", "diffHunk": "@@ -76,4 +92,91 @@ public void shouldReturn404IfListNotFound() throws Exception {\n \t\t\n \t\tassertThat(response, isNotFound());\n \t}\n+\t\n+\t@Test\n+\tpublic void createList_shouldCreateNewList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LIST_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\twhen(cohortFhirListService.create(any(org.hl7.fhir.r4.model.ListResource.class))).thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/List\").jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t\tassertThat(response.getStatus(), is(201));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldUpdateRequestedList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\twhen(cohortFhirListService.update(any(String.class), any(org.hl7.fhir.r4.model.ListResource.class)))\n+\t\t        .thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + LIST_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldErrorForNoId() throws Exception {\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_NO_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + LIST_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldErrorForIdMissMatch() throws Exception {\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_WRONG_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + UNKNOWN_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON)\n+\t\t        .go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(),\n+\t\t    containsStringIgnoringCase(\"body must contain an ID element which matches the request URL\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteList_shouldDeleteList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\twhen(cohortFhirListService.delete(LIST_UUID)).thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = delete(\"/List/\" + LIST_UUID).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteList_shouldReturn404ForNonExistingList() throws Exception {\n+\t\twhen(cohortFhirListService.get(UNKNOWN_UUID)).thenReturn(null);\n+\t\t\n+\t\tMockHttpServletResponse response = get(\"/List/\" + UNKNOWN_UUID).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isNotFound());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE5MDE4MA=="}, "originalCommit": {"oid": "fbeb7c59acd52149eb84910ad80839838420b523"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE5NDk5OQ==", "bodyText": "Yeah I know, but just because the method name says 404, you might consider adding it.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/246#discussion_r450194999", "createdAt": "2020-07-06T12:45:23Z", "author": {"login": "varung-31"}, "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/r3/ListFhirResourceProviderWebTest.java", "diffHunk": "@@ -76,4 +92,91 @@ public void shouldReturn404IfListNotFound() throws Exception {\n \t\t\n \t\tassertThat(response, isNotFound());\n \t}\n+\t\n+\t@Test\n+\tpublic void createList_shouldCreateNewList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_CREATE_LIST_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\twhen(cohortFhirListService.create(any(org.hl7.fhir.r4.model.ListResource.class))).thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = post(\"/List\").jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isCreated());\n+\t\tassertThat(response.getStatus(), is(201));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldUpdateRequestedList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\twhen(cohortFhirListService.update(any(String.class), any(org.hl7.fhir.r4.model.ListResource.class)))\n+\t\t        .thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + LIST_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldErrorForNoId() throws Exception {\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_NO_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + LIST_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(), containsStringIgnoringCase(\"body must contain an ID element for update\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void updateList_shouldErrorForIdMissMatch() throws Exception {\n+\t\tString listJson;\n+\t\ttry (InputStream is = this.getClass().getClassLoader().getResourceAsStream(JSON_UPDATE_LIST_WRONG_ID_PATH)) {\n+\t\t\tObjects.requireNonNull(is);\n+\t\t\tlistJson = IOUtils.toString(is, StandardCharsets.UTF_8);\n+\t\t}\n+\t\t\n+\t\tMockHttpServletResponse response = put(\"/List/\" + UNKNOWN_UUID).jsonContent(listJson).accept(FhirMediaTypes.JSON)\n+\t\t        .go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentAsString(),\n+\t\t    containsStringIgnoringCase(\"body must contain an ID element which matches the request URL\"));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteList_shouldDeleteList() throws Exception {\n+\t\torg.hl7.fhir.r4.model.ListResource listResource = new org.hl7.fhir.r4.model.ListResource();\n+\t\tlistResource.setId(LIST_UUID);\n+\t\twhen(cohortFhirListService.delete(LIST_UUID)).thenReturn(listResource);\n+\t\t\n+\t\tMockHttpServletResponse response = delete(\"/List/\" + LIST_UUID).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isOk());\n+\t\tassertThat(response.getContentType(), equalTo(FhirMediaTypes.JSON.toString()));\n+\t}\n+\t\n+\t@Test\n+\tpublic void deleteList_shouldReturn404ForNonExistingList() throws Exception {\n+\t\twhen(cohortFhirListService.get(UNKNOWN_UUID)).thenReturn(null);\n+\t\t\n+\t\tMockHttpServletResponse response = get(\"/List/\" + UNKNOWN_UUID).accept(FhirMediaTypes.JSON).go();\n+\t\t\n+\t\tassertThat(response, isNotFound());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE5MDE4MA=="}, "originalCommit": {"oid": "fbeb7c59acd52149eb84910ad80839838420b523"}, "originalPosition": 126}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1015, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}