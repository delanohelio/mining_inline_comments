{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3NjU0NzUx", "number": 194, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxMzo1ODoxM1rOECkyyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzowMzo0MVrOECpxVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMTM1NDMyOnYy", "diffSide": "RIGHT", "path": "omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxMzo1ODoxM1rOGfHUOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxMzo1ODoxM1rOGfHUOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTI3ODkwNQ==", "bodyText": "Constants should be UPPER_CASE. Also, we have a FhirConstants class for holding this type of information.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/194#discussion_r435278905", "createdAt": "2020-06-04T13:58:13Z", "author": {"login": "ibacher"}, "path": "omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java", "diffHunk": "@@ -34,6 +35,8 @@\n \t\n \tprivate static final long serialVersionUID = 1L;\n \t\n+\tprotected static final String hapiDefaultNarrativesPropFile = \"classpath:ca/uhn/fhir/narrative/narratives.properties\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ead16f584ead2d2b141a561128a17fe4e3627d3"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMTM3MTQ0OnYy", "diffSide": "RIGHT", "path": "omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNDowMjowM1rOGfHfuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNDo1NDo1M1rOGfJ_SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTI4MTg1MQ==", "bodyText": "Please don't do this this way. The problem here is that you're hard-coding the FhirContext which is actually being set by Spring (see above). The correct thing to do here would be to replace where you have the call to this.setDefaultNarrativeGenerator() with the last line of code:\ngetFhirContext().setNarrativeGenerator(new CustomThymeleafNarrativeGenerator(hapiDefaultNarrativesPropFile));\nThat way, it only depends on the FhirContext that is set by Spring, so that we don't break support for DSTU3 while doing this.\nIt might also be worth thinking about if we could load the ThymeleafNarrativeGenerator from Spring, as this might give us more flexibility in defining the property files to load, instead of needing to know about them ahead of time.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/194#discussion_r435281851", "createdAt": "2020-06-04T14:02:03Z", "author": {"login": "ibacher"}, "path": "omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java", "diffHunk": "@@ -92,4 +97,9 @@ public void setResourceProviders(Collection<IResourceProvider> theProviders) {\n \tpublic void setServerAddressStrategy(IServerAddressStrategy theServerAddressStrategy) {\n \t\tsuper.setServerAddressStrategy(theServerAddressStrategy);\n \t}\n+\t\n+\tprotected void setDefaultNarrativeGenerator() {\n+\t\tthis.setFhirContext(FhirContext.forR4());\n+\t\tgetFhirContext().setNarrativeGenerator(new CustomThymeleafNarrativeGenerator(hapiDefaultNarrativesPropFile));\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ead16f584ead2d2b141a561128a17fe4e3627d3"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTMyMjY5Nw==", "bodyText": "Okay, I'll do the changes.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/194#discussion_r435322697", "createdAt": "2020-06-04T14:54:53Z", "author": {"login": "ShivanshRakesh"}, "path": "omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java", "diffHunk": "@@ -92,4 +97,9 @@ public void setResourceProviders(Collection<IResourceProvider> theProviders) {\n \tpublic void setServerAddressStrategy(IServerAddressStrategy theServerAddressStrategy) {\n \t\tsuper.setServerAddressStrategy(theServerAddressStrategy);\n \t}\n+\t\n+\tprotected void setDefaultNarrativeGenerator() {\n+\t\tthis.setFhirContext(FhirContext.forR4());\n+\t\tgetFhirContext().setNarrativeGenerator(new CustomThymeleafNarrativeGenerator(hapiDefaultNarrativesPropFile));\n+\t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTI4MTg1MQ=="}, "originalCommit": {"oid": "9ead16f584ead2d2b141a561128a17fe4e3627d3"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxMjE2OTgxOnYy", "diffSide": "RIGHT", "path": "pom.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzowMzo0MVrOGfPdaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQxNzowMzo0MVrOGfPdaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQxMjMyOA==", "bodyText": "So the set of dependencies here should be kept as minimal as possible. These should be moved to the dependencyManagement section and then included in the POM where they are necessary (possibly only in the OMOD). I'd also drop the dependency on commons-io or change it's scope to \"provided\", since it's included in the platform.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/194#discussion_r435412328", "createdAt": "2020-06-04T17:03:41Z", "author": {"login": "ibacher"}, "path": "pom.xml", "diffHunk": "@@ -319,6 +319,21 @@\n \t\t\t<artifactId>powermock-api-mockito2</artifactId>\n \t\t\t<scope>test</scope>\n \t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>org.thymeleaf</groupId>\n+\t\t\t<artifactId>thymeleaf</artifactId>\n+\t\t\t<version>3.0.11.RELEASE</version>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>commons-io</groupId>\n+\t\t\t<artifactId>commons-io</artifactId>\n+\t\t\t<version>2.6</version>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>com.github.ben-manes.caffeine</groupId>\n+\t\t\t<artifactId>caffeine</artifactId>\n+\t\t\t<version>2.8.2</version>\n+\t\t</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "15e7fd07a99b3d9a49b5149fd98e00db15af0e2a"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 912, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}