{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMDA1NjUz", "number": 152, "title": "FM2-152: Update Encounter DAO and Service", "bodyText": "link;https://issues.openmrs.org/browse/FM2-152", "createdAt": "2020-04-28T09:47:06Z", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/152", "merged": true, "mergeCommit": {"oid": "2bd78ba66549402afb1942d8d02a9d9059e31dca"}, "closed": true, "closedAt": "2020-05-01T18:46:35Z", "author": {"login": "gitcliff"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccFa-WgFqTQwMTkzMTU1MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcdGPcTgFqTQwNDMzMTg0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxOTMxNTUw", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/152#pullrequestreview-401931550", "createdAt": "2020-04-28T15:06:15Z", "commit": {"oid": "f606f192b9cea83100e305c8d30721d997c88e48"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNTowNjoxNVrOGNYvLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxNToxMzo1NFrOGNZHOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY4OTk2Nw==", "bodyText": "You shouldn't need to implement this method at all.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/152#discussion_r416689967", "createdAt": "2020-04-28T15:06:15Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirEncounterDaoImpl.java", "diffHunk": "@@ -9,41 +9,31 @@\n  */\n package org.openmrs.module.fhir2.api.dao.impl;\n \n-import static org.hibernate.criterion.Restrictions.eq;\n-\n import java.util.Collection;\n \n import ca.uhn.fhir.rest.param.DateRangeParam;\n import ca.uhn.fhir.rest.param.ReferenceAndListParam;\n import lombok.AccessLevel;\n import lombok.Setter;\n import org.hibernate.Criteria;\n-import org.hibernate.SessionFactory;\n import org.openmrs.Encounter;\n import org.openmrs.module.fhir2.api.dao.FhirEncounterDao;\n-import org.springframework.beans.factory.annotation.Autowired;\n-import org.springframework.beans.factory.annotation.Qualifier;\n import org.springframework.stereotype.Component;\n \n @Component\n @Setter(AccessLevel.PACKAGE)\n-public class FhirEncounterDaoImpl extends BaseDaoImpl implements FhirEncounterDao {\n-\t\n-\t@Autowired\n-\t@Qualifier(\"sessionFactory\")\n-\tprivate SessionFactory sessionFactory;\n+public class FhirEncounterDaoImpl extends BaseFhirDaoImpl<Encounter> implements FhirEncounterDao {\n \t\n \t@Override\n-\tpublic Encounter getEncounterByUuid(String uuid) {\n-\t\treturn (Encounter) sessionFactory.getCurrentSession().createCriteria(Encounter.class).add(eq(\"uuid\", uuid))\n-\t\t        .uniqueResult();\n+\tpublic Encounter get(String uuid) {\n+\t\treturn super.get(uuid);\n \t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f606f192b9cea83100e305c8d30721d997c88e48"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY5MDUxNQ==", "bodyText": "This shouldn't be necessary to have here at all.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/152#discussion_r416690515", "createdAt": "2020-04-28T15:06:52Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirEncounterServiceImpl.java", "diffHunk": "@@ -37,8 +39,8 @@\n \t\n \t@Override\n \t@Transactional(readOnly = true)\n-\tpublic Encounter getEncounterByUuid(String uuid) {\n-\t\treturn translator.toFhirResource(dao.getEncounterByUuid(uuid));\n+\tpublic Encounter get(String uuid) {\n+\t\treturn translator.toFhirResource(dao.get(uuid));\n \t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f606f192b9cea83100e305c8d30721d997c88e48"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY5NjEyMA==", "bodyText": "Rather than explicitly generating these fields, I would add the annotation @Getter(AccessLevel.PROTECTED) right above the annotation for @Setter at the top of the class.", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/152#discussion_r416696120", "createdAt": "2020-04-28T15:13:54Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirEncounterServiceImpl.java", "diffHunk": "@@ -48,4 +50,14 @@ public Encounter getEncounterByUuid(String uuid) {\n \t\treturn dao.searchForEncounters(date, location, participant, subject).stream().map(translator::toFhirResource)\n \t\t        .collect(Collectors.toList());\n \t}\n+\t\n+\t@Override\n+\tprotected FhirDao<org.openmrs.Encounter> getDao() {\n+\t\treturn dao;\n+\t}\n+\t\n+\t@Override\n+\tprotected OpenmrsFhirTranslator<org.openmrs.Encounter, Encounter> getTranslator() {\n+\t\treturn translator;\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f606f192b9cea83100e305c8d30721d997c88e48"}, "originalPosition": 44}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f606f192b9cea83100e305c8d30721d997c88e48", "author": {"user": {"login": "gitcliff", "name": null}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/f606f192b9cea83100e305c8d30721d997c88e48", "committedDate": "2020-04-28T08:37:14Z", "message": "FM2-152:Update Encounter DAO and Service"}, "afterCommit": {"oid": "62280a8b5f606f2f5899827d2d9763665e6a22ce", "author": {"user": {"login": "gitcliff", "name": null}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/62280a8b5f606f2f5899827d2d9763665e6a22ce", "committedDate": "2020-04-28T18:22:33Z", "message": "FM2-152:Update Encounter DAO and Service"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMTAxOTI2", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/152#pullrequestreview-402101926", "createdAt": "2020-04-28T18:27:32Z", "commit": {"oid": "62280a8b5f606f2f5899827d2d9763665e6a22ce"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxODoyNzozM1rOGNhYJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxODoyNzo0M1rOGNhYeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgzMTUyNg==", "bodyText": "Can we get rid of this comment?", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/152#discussion_r416831526", "createdAt": "2020-04-28T18:27:33Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirEncounterServiceImpl.java", "diffHunk": "@@ -24,22 +20,26 @@\n import org.springframework.stereotype.Component;\n import org.springframework.transaction.annotation.Transactional;\n \n+import ca.uhn.fhir.rest.param.DateRangeParam;\n+import ca.uhn.fhir.rest.param.ReferenceAndListParam;\n+import lombok.AccessLevel;\n+import lombok.Getter;\n+import lombok.Setter;\n+\n @Component\n @Transactional\n @Setter(AccessLevel.PACKAGE)\n-public class FhirEncounterServiceImpl implements FhirEncounterService {\n+@Getter(AccessLevel.PROTECTED)\n+public class FhirEncounterServiceImpl extends BaseFhirService<Encounter, org.openmrs.Encounter> implements FhirEncounterService {\n \t\n \t@Autowired\n \tFhirEncounterDao dao;\n \t\n \t@Autowired\n \tEncounterTranslator translator;\n \t\n-\t@Override\n-\t@Transactional(readOnly = true)\n-\tpublic Encounter getEncounterByUuid(String uuid) {\n-\t\treturn translator.toFhirResource(dao.getEncounterByUuid(uuid));\n-\t}\n+\n+\t//The get(String uuid) method which fetches the encounter by a uuid is handled in the FhirEncounterService interface ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62280a8b5f606f2f5899827d2d9763665e6a22ce"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjgzMTYxMA==", "bodyText": "Can we get rid of this comment?", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/152#discussion_r416831610", "createdAt": "2020-04-28T18:27:43Z", "author": {"login": "ibacher"}, "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirEncounterDaoImpl.java", "diffHunk": "@@ -9,41 +9,28 @@\n  */\n package org.openmrs.module.fhir2.api.dao.impl;\n \n-import static org.hibernate.criterion.Restrictions.eq;\n-\n import java.util.Collection;\n \n import ca.uhn.fhir.rest.param.DateRangeParam;\n import ca.uhn.fhir.rest.param.ReferenceAndListParam;\n import lombok.AccessLevel;\n import lombok.Setter;\n import org.hibernate.Criteria;\n-import org.hibernate.SessionFactory;\n import org.openmrs.Encounter;\n import org.openmrs.module.fhir2.api.dao.FhirEncounterDao;\n-import org.springframework.beans.factory.annotation.Autowired;\n-import org.springframework.beans.factory.annotation.Qualifier;\n import org.springframework.stereotype.Component;\n \n @Component\n @Setter(AccessLevel.PACKAGE)\n-public class FhirEncounterDaoImpl extends BaseDaoImpl implements FhirEncounterDao {\n-\t\n-\t@Autowired\n-\t@Qualifier(\"sessionFactory\")\n-\tprivate SessionFactory sessionFactory;\n+public class FhirEncounterDaoImpl extends BaseFhirDaoImpl<Encounter> implements FhirEncounterDao {\n \t\n-\t@Override\n-\tpublic Encounter getEncounterByUuid(String uuid) {\n-\t\treturn (Encounter) sessionFactory.getCurrentSession().createCriteria(Encounter.class).add(eq(\"uuid\", uuid))\n-\t\t        .uniqueResult();\n-\t}\n+\t//The get(String uuid) method which fetches the encounter by a uuid is handled in the FhirEncounterDao interface ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62280a8b5f606f2f5899827d2d9763665e6a22ce"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62280a8b5f606f2f5899827d2d9763665e6a22ce", "author": {"user": {"login": "gitcliff", "name": null}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/62280a8b5f606f2f5899827d2d9763665e6a22ce", "committedDate": "2020-04-28T18:22:33Z", "message": "FM2-152:Update Encounter DAO and Service"}, "afterCommit": {"oid": "e0a2de5f0bf458bdce1738d19702cae8fee328ad", "author": {"user": {"login": "gitcliff", "name": null}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/e0a2de5f0bf458bdce1738d19702cae8fee328ad", "committedDate": "2020-04-28T19:13:33Z", "message": "FM2-152:Update Encounter DAO and Service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9710fd1bb1f646af3ae00cd2061ffed20672cda2", "author": {"user": {"login": "gitcliff", "name": null}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/9710fd1bb1f646af3ae00cd2061ffed20672cda2", "committedDate": "2020-05-01T09:18:49Z", "message": "FM2-152:Update Encounter Dao and Service"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1443d3f2b3196605951be2576fddbffb83b5d834", "author": {"user": {"login": "ibacher", "name": "Ian"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/1443d3f2b3196605951be2576fddbffb83b5d834", "committedDate": "2020-04-30T18:12:28Z", "message": "Merge branch 'master' into FM2-152"}, "afterCommit": {"oid": "9710fd1bb1f646af3ae00cd2061ffed20672cda2", "author": {"user": {"login": "gitcliff", "name": null}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/9710fd1bb1f646af3ae00cd2061ffed20672cda2", "committedDate": "2020-05-01T09:18:49Z", "message": "FM2-152:Update Encounter Dao and Service"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzMxODQ1", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/152#pullrequestreview-404331845", "createdAt": "2020-05-01T18:46:11Z", "commit": {"oid": "9710fd1bb1f646af3ae00cd2061ffed20672cda2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4285, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}