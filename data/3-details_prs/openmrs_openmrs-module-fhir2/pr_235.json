{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMTA1MjI5", "number": 235, "title": "FM2-248:-Update MedicationFhirResource Provider delete method.", "bodyText": "Update MedicationFhirResource Provider delete method.\nIssue I worked on\nsee https://issues.openmrs.org/browse/FM2-248\nChecklist: I completed these to help reviewers :)\n\n\n[x ] My IDE is configured to follow the code style of this project.\nNo? Unsure? -> configure your IDE, format the code and add the changes with git add . && git commit --amend\n\n\n[ x] I have added tests to cover my changes. (If you refactored\nexisting code that was well tested you do not have to add tests)\nNo? -> write tests and add them to this commit git add . && git commit --amend\n\n\n[ x] I ran mvn clean package right before creating this pull request and\nadded all formatting changes to my commit.\nNo? -> execute above command\n\n\n[x ] All new and existing tests passed.\nNo? -> figure out why and add the fix to your commit. It is your responsibility to make sure your code works.\n\n\n[ x] My pull request is based on the latest changes of the master branch.\nNo? Unsure? -> execute command git pull --rebase upstream master", "createdAt": "2020-06-28T19:48:53Z", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/235", "merged": true, "mergeCommit": {"oid": "41e719a8c388d947e01bc1e1ef6061badbadcbe6"}, "closed": true, "closedAt": "2020-06-29T12:08:31Z", "author": {"login": "Akayeshmantha"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcv8YIVgFqTQzODk2NjA3NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcv_5dPAFqTQzOTA3NDU0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4OTY2MDc0", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/235#pullrequestreview-438966074", "createdAt": "2020-06-29T07:55:32Z", "commit": {"oid": "efe267ecf1f3fa5c01919d34074ac0507a2ac730"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwNzo1NTozMlrOGqI4Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwNzo1ODo0NFrOGqI-2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgzODgxOQ==", "bodyText": "import org.hl7.fhir.dstu3.model.OperationOutcome;", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/235#discussion_r446838819", "createdAt": "2020-06-29T07:55:32Z", "author": {"login": "corneliouzbett"}, "path": "api/src/main/java/org/openmrs/module/fhir2/providers/r3/MedicationFhirResourceProvider.java", "diffHunk": "@@ -22,8 +22,8 @@\n import org.hl7.fhir.convertors.conv30_40.Medication30_40;\n import org.hl7.fhir.dstu3.model.IdType;\n import org.hl7.fhir.dstu3.model.Medication;\n-import org.hl7.fhir.dstu3.model.OperationOutcome;\n import org.hl7.fhir.instance.model.api.IBaseResource;\n+import org.hl7.fhir.r4.model.OperationOutcome;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efe267ecf1f3fa5c01919d34074ac0507a2ac730"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjgzOTI4OQ==", "bodyText": "return OperationOutcome30_40.convertOperationOutcome(FhirProviderUtils.buildDelete(medication));", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/235#discussion_r446839289", "createdAt": "2020-06-29T07:56:25Z", "author": {"login": "corneliouzbett"}, "path": "api/src/main/java/org/openmrs/module/fhir2/providers/r3/MedicationFhirResourceProvider.java", "diffHunk": "@@ -87,9 +87,7 @@ public OperationOutcome deleteMedication(@IdParam @NotNull IdType id) {\n \t\tif (medication == null) {\n \t\t\tthrow new ResourceNotFoundException(\"Could not find medication to update with id \" + id.getIdPart());\n \t\t}\n-\t\tOperationOutcome retVal = new OperationOutcome();\n-\t\tretVal.setId(id.getIdPart());\n-\t\tretVal.getText().setDivAsString(\"Deleted successfully\");\n-\t\treturn retVal;\n+\t\t\n+\t\treturn FhirProviderUtils.buildDelete(medication);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efe267ecf1f3fa5c01919d34074ac0507a2ac730"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg0MDUzOA==", "bodyText": "Add more assertions i.e\nassertThat(result.getIssueFirstRep().getSeverity(), equalTo(OperationOutcome.IssueSeverity.INFORMATION));\nassertThat(result.getIssueFirstRep().getDetails().getCodingFirstRep().getCode(), equalTo(\"MSG_DELETED\"));", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/235#discussion_r446840538", "createdAt": "2020-06-29T07:58:44Z", "author": {"login": "corneliouzbett"}, "path": "api/src/test/java/org/openmrs/module/fhir2/providers/r3/MedicationFhirResourceProviderTest.java", "diffHunk": "@@ -213,22 +213,18 @@ public void searchForMedication_shouldReturnMatchingBundleOfMedicationByIngredie\n \t//\t}\n \t\n \t@Test\n-\tpublic void shouldDeleteMedication() {\n-\t\torg.hl7.fhir.r4.model.Medication med = medication;\n-\t\tmed.setStatus(org.hl7.fhir.r4.model.Medication.MedicationStatus.INACTIVE);\n-\t\t\n-\t\twhen(fhirMedicationService.delete(MEDICATION_UUID)).thenReturn(med);\n+\tpublic void deleteMedication_shouldDeleteRequestedMedication() {\n+\t\twhen(fhirMedicationService.delete(MEDICATION_UUID)).thenReturn(medication);\n \t\t\n \t\tOperationOutcome result = resourceProvider.deleteMedication(new IdType().setValue(MEDICATION_UUID));\n \t\tassertThat(result, CoreMatchers.notNullValue());\n-\t\tassertThat(result.getId(), equalTo(MEDICATION_UUID));\n+\t\tassertThat(result.getIssue(), notNullValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efe267ecf1f3fa5c01919d34074ac0507a2ac730"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1226f90a5edac668f9ffd62aab739430e206d797", "author": {"user": {"login": "Akayeshmantha", "name": "Ayeshmantha Perera"}}, "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/1226f90a5edac668f9ffd62aab739430e206d797", "committedDate": "2020-06-29T10:25:59Z", "message": "FM2-248:-Update MedicationFhirResource Provider delete method."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MDc0NTQ4", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/235#pullrequestreview-439074548", "createdAt": "2020-06-29T12:07:18Z", "commit": {"oid": "1226f90a5edac668f9ffd62aab739430e206d797"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4127, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}