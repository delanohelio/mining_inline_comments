{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyMzI2Njg4", "number": 7340, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMzoyODoxN1rOE6R0VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxOToyNDoxMFrOE7NOUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NTQ0Nzg5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/nextcloud/client/media/PlayerService.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMzoyODoxN1rOH1Pr9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNzoyNzoxMlrOH1gLpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU5MzU5MQ==", "bodyText": "This is nasty. But if we need this workaround, I'd put it in onCreate().", "url": "https://github.com/nextcloud/android/pull/7340#discussion_r525593591", "createdAt": "2020-11-17T23:28:17Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/nextcloud/client/media/PlayerService.kt", "diffHunk": "@@ -101,6 +101,13 @@ class PlayerService : Service() {\n         stop.action = ACTION_STOP\n         val pendingStop = PendingIntent.getService(this, 0, stop, 0)\n         notificationBuilder.addAction(0, \"STOP\", pendingStop)\n+\n+        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.O) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41dcb04a13591a3efd35a4dc8fbb1ef51c1a593c"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTg2Mzg0NQ==", "bodyText": "True, this is not meant to be the final version.\nI just did a quick PR for testing, so that user can give feedback.", "url": "https://github.com/nextcloud/android/pull/7340#discussion_r525863845", "createdAt": "2020-11-18T07:27:12Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/nextcloud/client/media/PlayerService.kt", "diffHunk": "@@ -101,6 +101,13 @@ class PlayerService : Service() {\n         stop.action = ACTION_STOP\n         val pendingStop = PendingIntent.getService(this, 0, stop, 0)\n         notificationBuilder.addAction(0, \"STOP\", pendingStop)\n+\n+        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.O) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU5MzU5MQ=="}, "originalCommit": {"oid": "41dcb04a13591a3efd35a4dc8fbb1ef51c1a593c"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNTE4MDk2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/owncloud/android/ui/preview/PreviewMediaFragment.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxOToyNDoxMFrOH2uGYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwODoyNzo1NFrOH3FTXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE0MDQ0OA==", "bodyText": "This looks like a solution for this case.\nHowever, because stopAudio() results in Intent being sent to a service and thus it starts the service, the call is simply not safe to use in other places. I think we should internally call Service.stopSelf() if there is nothing to play as well.", "url": "https://github.com/nextcloud/android/pull/7340#discussion_r527140448", "createdAt": "2020-11-19T19:24:10Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/preview/PreviewMediaFragment.java", "diffHunk": "@@ -324,7 +324,9 @@ public void onStart() {\n                 mMultiListContainer.setVisibility(View.GONE);\n                 mPreviewContainer.setVisibility(View.VISIBLE);\n             } else if (MimeTypeUtil.isVideo(file)) {\n-                stopAudio();\n+                if (mMediaPlayerServiceConnection.isConnected() && mMediaPlayerServiceConnection.isPlaying()) {\n+                    stopAudio();\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8f17962bd8bcd9c5390b897798f3cf3ecdaa7f56"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzUxNTIzNw==", "bodyText": "In PreviewMediaFragment onStart() I tried to bind to an existing player service.\nReason is:\n\nstart a long audio file\nstart a video\naudio stops, video sound is played, but audio notification is still there (and cannot be resumed)\n\nSo my quick idea was to bind to audio service when starting video and stop audio service.\nBut this does not work.", "url": "https://github.com/nextcloud/android/pull/7340#discussion_r527515237", "createdAt": "2020-11-20T08:17:54Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/owncloud/android/ui/preview/PreviewMediaFragment.java", "diffHunk": "@@ -324,7 +324,9 @@ public void onStart() {\n                 mMultiListContainer.setVisibility(View.GONE);\n                 mPreviewContainer.setVisibility(View.VISIBLE);\n             } else if (MimeTypeUtil.isVideo(file)) {\n-                stopAudio();\n+                if (mMediaPlayerServiceConnection.isConnected() && mMediaPlayerServiceConnection.isPlaying()) {\n+                    stopAudio();\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE0MDQ0OA=="}, "originalCommit": {"oid": "8f17962bd8bcd9c5390b897798f3cf3ecdaa7f56"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzUyMDYwNg==", "bodyText": "Fixed with adding a \"play/pause\" button.", "url": "https://github.com/nextcloud/android/pull/7340#discussion_r527520606", "createdAt": "2020-11-20T08:27:54Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/owncloud/android/ui/preview/PreviewMediaFragment.java", "diffHunk": "@@ -324,7 +324,9 @@ public void onStart() {\n                 mMultiListContainer.setVisibility(View.GONE);\n                 mPreviewContainer.setVisibility(View.VISIBLE);\n             } else if (MimeTypeUtil.isVideo(file)) {\n-                stopAudio();\n+                if (mMediaPlayerServiceConnection.isConnected() && mMediaPlayerServiceConnection.isPlaying()) {\n+                    stopAudio();\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE0MDQ0OA=="}, "originalCommit": {"oid": "8f17962bd8bcd9c5390b897798f3cf3ecdaa7f56"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3225, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}