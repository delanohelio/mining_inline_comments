{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExODk0NjAz", "number": 5986, "title": "Remove Evernote job scheduler dependency", "bodyText": "Tests written\n\nThis change removed all traces of Evernote job scheduler API. Interestingly, evernote platform abstraction for power manager and active network were used. Those are removed as well and replaced by our own APIs.", "createdAt": "2020-04-30T23:32:23Z", "url": "https://github.com/nextcloud/android/pull/5986", "merged": true, "mergeCommit": {"oid": "4247a512c231b46220732b3812edb1610c89e267"}, "closed": true, "closedAt": "2020-05-06T14:38:04Z", "author": {"login": "ezaquarii"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcc1yMGgFqTQwMzk0NjY5NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcepAzsAH2gAyNDExODk0NjAzOjcwODQ3MzVmNWU0YTJlNjNjZGRhNzQzYjNlZDExYjYyN2JjZGI1ZmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTQ2Njk0", "url": "https://github.com/nextcloud/android/pull/5986#pullrequestreview-403946694", "createdAt": "2020-04-30T23:35:44Z", "commit": {"oid": "fcbff7019b8537f7bff9e4f96fbce283fb817dff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQyMzozNTo0NFrOGO94rA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQyMzozNTo0NFrOGO94rA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM0NzE4MA==", "bodyText": "I guess we'll make use of it when we finally do async server availability API. For now, I'll put it here as a reminder/proposal for the API.", "url": "https://github.com/nextcloud/android/pull/5986#discussion_r418347180", "createdAt": "2020-04-30T23:35:44Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/nextcloud/client/network/Connectivity.kt", "diffHunk": "@@ -0,0 +1,13 @@\n+package com.nextcloud.client.network\n+\n+data class Connectivity(\n+    val isConnected: Boolean = false,\n+    val isMetered: Boolean = false,\n+    val isWifi: Boolean = false,\n+    val isServerAvailable: Boolean? = null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcbff7019b8537f7bff9e4f96fbce283fb817dff"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTQ4MTgw", "url": "https://github.com/nextcloud/android/pull/5986#pullrequestreview-403948180", "createdAt": "2020-04-30T23:40:11Z", "commit": {"oid": "fcbff7019b8537f7bff9e4f96fbce283fb817dff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQyMzo0MDoxMVrOGO99xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQyMzo0MDoxMVrOGO99xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM0ODQ4Ng==", "bodyText": "I don't get what was the purpose of this line?", "url": "https://github.com/nextcloud/android/pull/5986#discussion_r418348486", "createdAt": "2020-04-30T23:40:11Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/files/services/FileUploader.java", "diffHunk": "@@ -1027,7 +1026,6 @@ public static void retryFailedUploads(\n                         uploadsStorageManager.updateUpload(failedUpload);\n                     }\n                 } else {\n-                    charging = charging || Device.getBatteryStatus(context).getBatteryPercent() == 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcbff7019b8537f7bff9e4f96fbce283fb817dff"}, "originalPosition": 31}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94237fcfe10b53b11c0ae0a4475e77b37b918463", "author": {"user": null}, "url": "https://github.com/nextcloud/android/commit/94237fcfe10b53b11c0ae0a4475e77b37b918463", "committedDate": "2020-04-30T23:46:01Z", "message": "Drone: update FindBugs results to reflect reduced error/warning count [skip ci]\n\nSigned-off-by: nextcloud-android-bot <android@nextcloud.com>"}, "afterCommit": {"oid": "419d802f382d3565b2fb998697853aa99b32959d", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/419d802f382d3565b2fb998697853aa99b32959d", "committedDate": "2020-04-30T23:58:16Z", "message": "Remove Evernote job scheduler dependency\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTg4Nzc2", "url": "https://github.com/nextcloud/android/pull/5986#pullrequestreview-403988776", "createdAt": "2020-05-01T02:08:20Z", "commit": {"oid": "1ec762678f492fbe0878306e85d6353a3501db84"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMjowODoyMFrOGPAN1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMjowODoyMFrOGPAN1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM4NTM2NA==", "bodyText": "This is unrelated, but it was broken. I guess that it slipped through because we have permanently failing IT tests and probably didn't eyeball the failing test list carefully enough.", "url": "https://github.com/nextcloud/android/pull/5986#discussion_r418385364", "createdAt": "2020-05-01T02:08:20Z", "author": {"login": "ezaquarii"}, "path": "src/test/java/com/nextcloud/client/jobs/BackgroundJobFactoryTest.kt", "diffHunk": "@@ -86,6 +88,12 @@ class BackgroundJobFactoryTest {\n     @Mock\n     private lateinit var connectivityService: ConnectivityService\n \n+    @Mock\n+    private lateinit var notificationManager: NotificationManager", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ec762678f492fbe0878306e85d6353a3501db84"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTg5NTg5", "url": "https://github.com/nextcloud/android/pull/5986#pullrequestreview-403989589", "createdAt": "2020-05-01T02:12:01Z", "commit": {"oid": "1ec762678f492fbe0878306e85d6353a3501db84"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMjoxMjowMVrOGPAQ_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMjoxMjowMVrOGPAQ_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM4NjE3NQ==", "bodyText": "I renamed the isInernetWalled() API.\nWe could have perfect internet connectivity but the server could be in maintenance mode, which this API checks as well. So he name referring to a \"walled garden\" probably went past it's shelf live at some point, so I renamed it.", "url": "https://github.com/nextcloud/android/pull/5986#discussion_r418386175", "createdAt": "2020-05-01T02:12:01Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/nextcloud/client/network/ConnectivityService.java", "diffHunk": "@@ -20,10 +20,25 @@\n \n package com.nextcloud.client.network;\n \n-import com.evernote.android.job.JobRequest;\n-\n+/**\n+ * This service provides information about current network connectivity\n+ * and server reachableity.\n+ */\n public interface ConnectivityService {\n-    boolean isInternetWalled();\n-    boolean isOnlineWithWifi();\n-    JobRequest.NetworkType getActiveNetworkType();\n+\n+    /**\n+     * Check if server is accessible by issuing HTTP status check request.\n+     * Since this call involves network traffic, it should not be called\n+     * on a main thread.\n+     *\n+     * @return True if server is reachable and operational, false otherwise\n+     */\n+    boolean isServerAvailable();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ec762678f492fbe0878306e85d6353a3501db84"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTkwMDA5", "url": "https://github.com/nextcloud/android/pull/5986#pullrequestreview-403990009", "createdAt": "2020-05-01T02:13:45Z", "commit": {"oid": "1ec762678f492fbe0878306e85d6353a3501db84"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMjoxMzo0NVrOGPASPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMjoxMzo0NVrOGPASPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM4NjQ5NA==", "bodyText": "This was confusing status... Having those flags in that varying form made simple \"connected\" statate quite unintuitive to figure out. Connectivity gives one a simpler answer.", "url": "https://github.com/nextcloud/android/pull/5986#discussion_r418386494", "createdAt": "2020-05-01T02:13:45Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/nextcloud/client/network/ConnectivityServiceImpl.java", "diffHunk": "@@ -116,65 +116,37 @@ public boolean isInternetWalled() {\n                 }\n             }\n         } else {\n-            return getActiveNetworkType() == JobRequest.NetworkType.ANY;\n+            return !getConnectivity().isConnected();\n         }\n \n         return true;\n     }\n \n     @Override\n-    public boolean isOnlineWithWifi() {\n+    public Connectivity getConnectivity() {\n+        NetworkInfo ni;\n         try {\n-            NetworkInfo activeNetwork = connectivityManager.getActiveNetworkInfo();\n-\n-            if (activeNetwork.isConnectedOrConnecting()) {\n-                switch (activeNetwork.getType()) {\n-                    case ConnectivityManager.TYPE_VPN:\n-                        // check if any other network is wifi\n-                        for (NetworkInfo networkInfo : connectivityManager.getAllNetworkInfo()) {\n-                            if (networkInfo.isConnectedOrConnecting() &&\n-                                networkInfo.getType() == ConnectivityManager.TYPE_WIFI) {\n-                                return true;\n-                            }\n-                        }\n-                        return false;\n-\n-                    case ConnectivityManager.TYPE_WIFI:\n-                        return true;\n-\n-                    default:\n-                        return false;\n-                }\n-            } else {\n-                return false;\n-            }\n-        } catch (NullPointerException exception) {\n-            return false;\n-        }\n-    }\n-\n-    @Override\n-    public JobRequest.NetworkType getActiveNetworkType() {\n-        NetworkInfo networkInfo;\n-        try {\n-            networkInfo = connectivityManager.getActiveNetworkInfo();\n+            ni = platformConnectivityManager.getActiveNetworkInfo();\n         } catch (Throwable t) {\n-            return JobRequest.NetworkType.ANY;\n-        }\n-\n-        if (networkInfo == null || !networkInfo.isConnectedOrConnecting()) {\n-            return JobRequest.NetworkType.ANY;\n+            ni = null; // no network available or no information (permission denied?)\n         }\n \n-        boolean metered = ConnectivityManagerCompat.isActiveNetworkMetered(connectivityManager);\n-        if (!metered) {\n-            return JobRequest.NetworkType.UNMETERED;\n+        if (ni != null) {\n+            boolean isConnected = ni.isConnectedOrConnecting();\n+            boolean isMetered = ConnectivityManagerCompat.isActiveNetworkMetered(platformConnectivityManager);\n+            boolean isWifi = ni.getType() == ConnectivityManager.TYPE_WIFI || isAnyOtherNetworkWifi();\n+            return new Connectivity(isConnected, isMetered, isWifi, null);\n+        } else {\n+            return Connectivity.DISCONNECTED;\n         }\n+    }\n \n-        if (networkInfo.isRoaming()) {\n-            return JobRequest.NetworkType.CONNECTED;\n-        } else {\n-            return JobRequest.NetworkType.NOT_ROAMING;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ec762678f492fbe0878306e85d6353a3501db84"}, "originalPosition": 119}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzOTkwMzI1", "url": "https://github.com/nextcloud/android/pull/5986#pullrequestreview-403990325", "createdAt": "2020-05-01T02:15:05Z", "commit": {"oid": "1ec762678f492fbe0878306e85d6353a3501db84"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMjoxNTowNlrOGPATdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwMjoxNTowNlrOGPATdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM4NjgwNQ==", "bodyText": "I was considering adding another API but realized that those queries go over IPC to another process. Having a one-stop-shop for complete status is slightly more performant.", "url": "https://github.com/nextcloud/android/pull/5986#discussion_r418386805", "createdAt": "2020-05-01T02:15:06Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/nextcloud/client/device/PowerManagementServiceImpl.kt", "diffHunk": "@@ -71,16 +71,24 @@ internal class PowerManagementServiceImpl(\n     override val isPowerSavingExclusionAvailable: Boolean\n         get() = deviceInfo.vendor in OVERLY_AGGRESSIVE_POWER_SAVING_VENDORS\n \n-    override val isBatteryCharging: Boolean\n+    override val battery: BatteryStatus", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ec762678f492fbe0878306e85d6353a3501db84"}, "originalPosition": 32}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1ec762678f492fbe0878306e85d6353a3501db84", "author": {"user": null}, "url": "https://github.com/nextcloud/android/commit/1ec762678f492fbe0878306e85d6353a3501db84", "committedDate": "2020-05-01T00:10:04Z", "message": "Drone: update FindBugs results to reflect reduced error/warning count [skip ci]\n\nSigned-off-by: nextcloud-android-bot <android@nextcloud.com>"}, "afterCommit": {"oid": "691a7c60c407cf9c6fdf1b87770ff9b5f3689036", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/691a7c60c407cf9c6fdf1b87770ff9b5f3689036", "committedDate": "2020-05-01T18:19:57Z", "message": "Remove Evernote job scheduler dependency\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7754bcbe870027acd04f97cdff2f8854264bdee8", "author": {"user": null}, "url": "https://github.com/nextcloud/android/commit/7754bcbe870027acd04f97cdff2f8854264bdee8", "committedDate": "2020-05-01T18:28:39Z", "message": "Drone: update FindBugs results to reflect reduced error/warning count [skip ci]\n\nSigned-off-by: nextcloud-android-bot <android@nextcloud.com>"}, "afterCommit": {"oid": "5c7cbf99232ce24da87f9d3bae27dcc3e44c27a8", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/5c7cbf99232ce24da87f9d3bae27dcc3e44c27a8", "committedDate": "2020-05-03T23:56:22Z", "message": "Remove Evernote job scheduler dependency\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MDkzMjI3", "url": "https://github.com/nextcloud/android/pull/5986#pullrequestreview-405093227", "createdAt": "2020-05-04T15:24:16Z", "commit": {"oid": "3f5caa45b9e84ed822808e1457052271803af484"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNToyNDoxN1rOGQFb0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNToyNDoxN1rOGQFb0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUxOTQ0MA==", "bodyText": "Can we keep networkInfo?", "url": "https://github.com/nextcloud/android/pull/5986#discussion_r419519440", "createdAt": "2020-05-04T15:24:17Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/nextcloud/client/network/ConnectivityServiceImpl.java", "diffHunk": "@@ -116,65 +116,37 @@ public boolean isInternetWalled() {\n                 }\n             }\n         } else {\n-            return getActiveNetworkType() == JobRequest.NetworkType.ANY;\n+            return !getConnectivity().isConnected();\n         }\n \n         return true;\n     }\n \n     @Override\n-    public boolean isOnlineWithWifi() {\n+    public Connectivity getConnectivity() {\n+        NetworkInfo ni;\n         try {\n-            NetworkInfo activeNetwork = connectivityManager.getActiveNetworkInfo();\n-\n-            if (activeNetwork.isConnectedOrConnecting()) {\n-                switch (activeNetwork.getType()) {\n-                    case ConnectivityManager.TYPE_VPN:\n-                        // check if any other network is wifi\n-                        for (NetworkInfo networkInfo : connectivityManager.getAllNetworkInfo()) {\n-                            if (networkInfo.isConnectedOrConnecting() &&\n-                                networkInfo.getType() == ConnectivityManager.TYPE_WIFI) {\n-                                return true;\n-                            }\n-                        }\n-                        return false;\n-\n-                    case ConnectivityManager.TYPE_WIFI:\n-                        return true;\n-\n-                    default:\n-                        return false;\n-                }\n-            } else {\n-                return false;\n-            }\n-        } catch (NullPointerException exception) {\n-            return false;\n-        }\n-    }\n-\n-    @Override\n-    public JobRequest.NetworkType getActiveNetworkType() {\n-        NetworkInfo networkInfo;\n-        try {\n-            networkInfo = connectivityManager.getActiveNetworkInfo();\n+            ni = platformConnectivityManager.getActiveNetworkInfo();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f5caa45b9e84ed822808e1457052271803af484"}, "originalPosition": 91}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MDkzNTM4", "url": "https://github.com/nextcloud/android/pull/5986#pullrequestreview-405093538", "createdAt": "2020-05-04T15:24:37Z", "commit": {"oid": "3f5caa45b9e84ed822808e1457052271803af484"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNToyNDozN1rOGQFc3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNToyNDozN1rOGQFc3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUxOTcwOQ==", "bodyText": "Same here.", "url": "https://github.com/nextcloud/android/pull/5986#discussion_r419519709", "createdAt": "2020-05-04T15:24:37Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/nextcloud/client/network/ConnectivityServiceImpl.java", "diffHunk": "@@ -116,65 +116,37 @@ public boolean isInternetWalled() {\n                 }\n             }\n         } else {\n-            return getActiveNetworkType() == JobRequest.NetworkType.ANY;\n+            return !getConnectivity().isConnected();\n         }\n \n         return true;\n     }\n \n     @Override\n-    public boolean isOnlineWithWifi() {\n+    public Connectivity getConnectivity() {\n+        NetworkInfo ni;\n         try {\n-            NetworkInfo activeNetwork = connectivityManager.getActiveNetworkInfo();\n-\n-            if (activeNetwork.isConnectedOrConnecting()) {\n-                switch (activeNetwork.getType()) {\n-                    case ConnectivityManager.TYPE_VPN:\n-                        // check if any other network is wifi\n-                        for (NetworkInfo networkInfo : connectivityManager.getAllNetworkInfo()) {\n-                            if (networkInfo.isConnectedOrConnecting() &&\n-                                networkInfo.getType() == ConnectivityManager.TYPE_WIFI) {\n-                                return true;\n-                            }\n-                        }\n-                        return false;\n-\n-                    case ConnectivityManager.TYPE_WIFI:\n-                        return true;\n-\n-                    default:\n-                        return false;\n-                }\n-            } else {\n-                return false;\n-            }\n-        } catch (NullPointerException exception) {\n-            return false;\n-        }\n-    }\n-\n-    @Override\n-    public JobRequest.NetworkType getActiveNetworkType() {\n-        NetworkInfo networkInfo;\n-        try {\n-            networkInfo = connectivityManager.getActiveNetworkInfo();\n+            ni = platformConnectivityManager.getActiveNetworkInfo();\n         } catch (Throwable t) {\n-            return JobRequest.NetworkType.ANY;\n-        }\n-\n-        if (networkInfo == null || !networkInfo.isConnectedOrConnecting()) {\n-            return JobRequest.NetworkType.ANY;\n+            ni = null; // no network available or no information (permission denied?)\n         }\n \n-        boolean metered = ConnectivityManagerCompat.isActiveNetworkMetered(connectivityManager);\n-        if (!metered) {\n-            return JobRequest.NetworkType.UNMETERED;\n+        if (ni != null) {\n+            boolean isConnected = ni.isConnectedOrConnecting();\n+            boolean isMetered = ConnectivityManagerCompat.isActiveNetworkMetered(platformConnectivityManager);\n+            boolean isWifi = ni.getType() == ConnectivityManager.TYPE_WIFI || isAnyOtherNetworkWifi();\n+            return new Connectivity(isConnected, isMetered, isWifi, null);\n+        } else {\n+            return Connectivity.DISCONNECTED;\n         }\n+    }\n \n-        if (networkInfo.isRoaming()) {\n-            return JobRequest.NetworkType.CONNECTED;\n-        } else {\n-            return JobRequest.NetworkType.NOT_ROAMING;\n+    private boolean isAnyOtherNetworkWifi() {\n+        for (NetworkInfo ni : platformConnectivityManager.getAllNetworkInfo()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f5caa45b9e84ed822808e1457052271803af484"}, "originalPosition": 119}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f5caa45b9e84ed822808e1457052271803af484", "author": {"user": null}, "url": "https://github.com/nextcloud/android/commit/3f5caa45b9e84ed822808e1457052271803af484", "committedDate": "2020-05-04T00:05:57Z", "message": "Drone: update FindBugs results to reflect reduced error/warning count [skip ci]\n\nSigned-off-by: nextcloud-android-bot <android@nextcloud.com>"}, "afterCommit": {"oid": "c38a067312bb34711324b07e1e7815d2762f56e8", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/c38a067312bb34711324b07e1e7815d2762f56e8", "committedDate": "2020-05-04T20:40:31Z", "message": "Remove Evernote job scheduler dependency\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NTA2ODAw", "url": "https://github.com/nextcloud/android/pull/5986#pullrequestreview-405506800", "createdAt": "2020-05-05T05:51:56Z", "commit": {"oid": "7d0ac610733135d8009fba5139094eb5f0387324"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NTEzMTI5", "url": "https://github.com/nextcloud/android/pull/5986#pullrequestreview-405513129", "createdAt": "2020-05-05T06:11:29Z", "commit": {"oid": "7d0ac610733135d8009fba5139094eb5f0387324"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7fdb33217a477bdfeb5a4fd69467f372bd34d517", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/7fdb33217a477bdfeb5a4fd69467f372bd34d517", "committedDate": "2020-05-05T06:27:24Z", "message": "Test needs connected wifi\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}, "afterCommit": {"oid": "821f68fc8dc7ce13c33461b166a8b6de6c1e45fc", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/821f68fc8dc7ce13c33461b166a8b6de6c1e45fc", "committedDate": "2020-05-05T06:34:13Z", "message": "Test needs connected wifi\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "245decb0f88c2326ff1fa3aa688c8ebb9d53f58d", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/245decb0f88c2326ff1fa3aa688c8ebb9d53f58d", "committedDate": "2020-05-05T15:25:32Z", "message": "show \"no new version available\" only when clicking on it, not in background check\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8073a0d0038b643c740de331692e4a7f725c7770", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/8073a0d0038b643c740de331692e4a7f725c7770", "committedDate": "2020-05-05T21:57:16Z", "message": "Remove Evernote job scheduler dependency\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "821f68fc8dc7ce13c33461b166a8b6de6c1e45fc", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/821f68fc8dc7ce13c33461b166a8b6de6c1e45fc", "committedDate": "2020-05-05T06:34:13Z", "message": "Test needs connected wifi\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}, "afterCommit": {"oid": "8073a0d0038b643c740de331692e4a7f725c7770", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/8073a0d0038b643c740de331692e4a7f725c7770", "committedDate": "2020-05-05T21:57:16Z", "message": "Remove Evernote job scheduler dependency\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eee55edb805973acb041a3b02e3e71b4a8d4237a", "author": {"user": null}, "url": "https://github.com/nextcloud/android/commit/eee55edb805973acb041a3b02e3e71b4a8d4237a", "committedDate": "2020-05-05T21:57:56Z", "message": "Merge commit '8073a0d0038b643c740de331692e4a7f725c7770'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MTg1MTY0", "url": "https://github.com/nextcloud/android/pull/5986#pullrequestreview-406185164", "createdAt": "2020-05-05T21:58:46Z", "commit": {"oid": "8073a0d0038b643c740de331692e4a7f725c7770"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQyMTo1ODo0N1rOGQ9HdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQyMTo1ODo0N1rOGQ9HdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQzMTczMg==", "bodyText": "Sadly, lint is crashing due to internal bug:\nhttps://www.kaminsky.me/nc-dev/android-lint/13796.html#LintError\n../../../src/main/java/com/nextcloud/client/jobs/BackgroundJobManagerImpl.kt: Unexpected failure during lint analysis of BackgroundJobManagerImpl.kt (this is a bug in lint or one of the libraries it depends on)\n\nMessage: null cannot be cast to non-null type kotlin.Long\n\nThe crash seems to involve the detector androidx.work.lint.InvalidPeriodicWorkRequestIntervalDetector.\nYou can try disabling it with something like this:\n    android {\n        lintOptions {\n            disable \"InvalidPeriodicWorkRequestInterval\"\n        }\n    }\n\nStack: TypeCastException:InvalidPeriodicWorkRequestIntervalDetector.visitConstructor(InvalidPeriodicWorkRequestIntervalDetector.kt:70)\n\u2190UElementVisitor$DelegatingPsiVisitor.visitNewExpression(UElementVisitor.kt:1099)\n\u2190UElementVisitor$DelegatingPsiVisitor.visitCallExpression(UElementVisitor.kt:1063)\n\u2190KotlinUFunctionCallExpression.accept(KotlinUFunctionCallExpression.kt:198)\n\u2190UQualifiedReferenceExpression$DefaultImpls.accept(UQualifiedReferenceExpression.kt:48)\n\u2190KotlinUQualifiedReferenceExpression.accept(KotlinUQualifiedReferenceExpression.kt:27)\n\u2190UQualifiedReferenceExpression$DefaultImpls.accept(UQualifiedReferenceExpression.kt:47)\n\u2190KotlinUQualifiedReferenceExpression.accept(KotlinUQualifiedReferenceExpression.kt:27)\n\nYou can set environment variable LINT_PRINT_STACKTRACE=true to dump a full stacktrace to stdout.", "url": "https://github.com/nextcloud/android/pull/5986#discussion_r420431732", "createdAt": "2020-05-05T21:58:47Z", "author": {"login": "ezaquarii"}, "path": "build.gradle", "diffHunk": "@@ -119,7 +119,8 @@ android {\n             'IconMissingDensityFolder',\n             'IconDensities',\n             'GoogleAppIndexingWarning',\n-            'MissingDefaultResource'\n+            'MissingDefaultResource',\n+            'InvalidPeriodicWorkRequestInterval' // crashes due to a bug in lint itself", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8073a0d0038b643c740de331692e4a7f725c7770"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cf41b93ff12f7e5fe12875db96bfcf7a568b8a6", "author": {"user": null}, "url": "https://github.com/nextcloud/android/commit/1cf41b93ff12f7e5fe12875db96bfcf7a568b8a6", "committedDate": "2020-05-05T22:08:08Z", "message": "Drone: update FindBugs results to reflect reduced error/warning count [skip ci]\n\nSigned-off-by: nextcloud-android-bot <android@nextcloud.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab6d2557e09694928b1e7619ef5da3de75858c59", "author": {"user": {"login": "nextcloud-bot", "name": "Nextcloud Bot"}}, "url": "https://github.com/nextcloud/android/commit/ab6d2557e09694928b1e7619ef5da3de75858c59", "committedDate": "2020-05-06T03:24:26Z", "message": "[tx-robot] updated from transifex"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d86e5bb25631425cda85e1021aac62ecbb669268", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/d86e5bb25631425cda85e1021aac62ecbb669268", "committedDate": "2020-05-06T11:56:23Z", "message": "Merge pull request #6007 from nextcloud/devInfoOnlyOnClick\n\nshow \"no new version available\" only when clicking on it, not in background check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f899c2c668f1406e52cd997098ec9621335aa7e8", "author": {"user": null}, "url": "https://github.com/nextcloud/android/commit/f899c2c668f1406e52cd997098ec9621335aa7e8", "committedDate": "2020-05-06T13:35:15Z", "message": "Merge commit '1cf41b93ff12f7e5fe12875db96bfcf7a568b8a6'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7084735f5e4a2e63cdda743b3ed11b627bcdb5fb", "author": {"user": null}, "url": "https://github.com/nextcloud/android/commit/7084735f5e4a2e63cdda743b3ed11b627bcdb5fb", "committedDate": "2020-05-06T13:50:48Z", "message": "Drone: update Lint results to reflect reduced error/warning count [skip ci]\n\nSigned-off-by: nextcloud-android-bot <android@nextcloud.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4599, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}