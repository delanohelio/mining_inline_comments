{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5MTg1MDQ1", "number": 5810, "title": "Make the name collision policy for auto uploads selectable", "bodyText": "Resolves #5827\nFix #5755\nFix #5599\nFix #4260\nFix #5846\nSince #4788 synching WhatsApp Backups or similar files that don't change their name to Nextcloud is horrible, as one is asked how the files should be handled for every single file every day (well - as often the files change..).\nThis PR adds the option for synced folders how name collisions with updated files should be handled.\nThe options are (as proposed in #5599):\n\nAsk me every time\nRename new version\nOverwrite remote version\n\n\nDisclaimer: probably did not run all tests cleanly and did not update the screenshots, as that seemed nearly impossible on Windows..", "createdAt": "2020-04-05T17:46:50Z", "url": "https://github.com/nextcloud/android/pull/5810", "merged": true, "mergeCommit": {"oid": "af0b39ebe9dc64f2740c7ddf2831a645cf5daa45"}, "closed": true, "closedAt": "2020-04-16T06:03:26Z", "author": {"login": "fodinabor"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUzJ0XgFqTM4Nzg3NzQ1Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX7UHvgH2gAyMzk5MTg1MDQ1OjQ2NGFhZGVkMTQ5MDM1MjU5NDhjZTU1NTk0MDU4MmYzOTY3NjIzNGU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODc3NDU3", "url": "https://github.com/nextcloud/android/pull/5810#pullrequestreview-387877457", "createdAt": "2020-04-05T23:59:42Z", "commit": {"oid": "7df28bc9a084067692b54c809dc7a40c20b41710"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQyMzo1OTo0MlrOGBEjug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQyMzo1OTo0MlrOGBEjug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc3NjQ0Mg==", "bodyText": "I know the previous arguments is also a magic number, but I would argue that they should both be replaced by their corresponding constants.\nFileUploader.LOCAL_BEHAVIOUR_MOVE\nFileUploader.NameCollisionPolicy.ASK_USER.serialize()", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r403776442", "createdAt": "2020-04-05T23:59:42Z", "author": {"login": "ashpieboop"}, "path": "src/test/java/com/owncloud/android/ui/activity/SyncedFoldersActivityTest.java", "diffHunk": "@@ -167,6 +167,7 @@ private SyncedFolderDisplayItem create(String folderName, boolean enabled) {\n                                            true,\n                                            \"test@nextcloud.com\",\n                                            1,\n+                                           3,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7df28bc9a084067692b54c809dc7a40c20b41710"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MDM4MjU5", "url": "https://github.com/nextcloud/android/pull/5810#pullrequestreview-389038259", "createdAt": "2020-04-07T11:49:19Z", "commit": {"oid": "7354e468a41f6d8f3b66af84136f38ad62ed6628"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMTo0OToxOVrOGB_z9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMTo0OToxOVrOGB_z9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc0NzI1NQ==", "bodyText": "Maybe move this as default in switch?", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404747255", "createdAt": "2020-04-07T11:49:19Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/owncloud/android/ui/dialog/parcel/SyncedFolderParcelable.java", "diffHunk": "@@ -146,6 +151,33 @@ public void setUploadAction(String uploadAction) {\n         }\n     }\n \n+\n+    public Integer getNameCollisionPolicyInteger() {\n+        switch (nameCollisionPolicy) {\n+            case ASK_USER:\n+                return 0;\n+            case OVERWRITE:\n+                return 1;\n+            case RENAME:\n+                return 2;\n+        }\n+        return 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7354e468a41f6d8f3b66af84136f38ad62ed6628"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MDM4MzYw", "url": "https://github.com/nextcloud/android/pull/5810#pullrequestreview-389038360", "createdAt": "2020-04-07T11:49:30Z", "commit": {"oid": "7354e468a41f6d8f3b66af84136f38ad62ed6628"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMTo0OTozMVrOGB_0SQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMTo0OTozMVrOGB_0SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc0NzMzNw==", "bodyText": "\"this,\" is unneeded", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404747337", "createdAt": "2020-04-07T11:49:31Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/owncloud/android/ui/dialog/parcel/SyncedFolderParcelable.java", "diffHunk": "@@ -146,6 +151,33 @@ public void setUploadAction(String uploadAction) {\n         }\n     }\n \n+\n+    public Integer getNameCollisionPolicyInteger() {\n+        switch (nameCollisionPolicy) {\n+            case ASK_USER:\n+                return 0;\n+            case OVERWRITE:\n+                return 1;\n+            case RENAME:\n+                return 2;\n+        }\n+        return 0;\n+    }\n+\n+    public void setNameCollisionPolicy(String nameCollisionPolicy) {\n+        switch (nameCollisionPolicy) {\n+            case \"NAME_COLLISION_POLICY_ASK\":\n+                this.nameCollisionPolicy = FileUploader.NameCollisionPolicy.ASK_USER;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7354e468a41f6d8f3b66af84136f38ad62ed6628"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MTM1OTEw", "url": "https://github.com/nextcloud/android/pull/5810#pullrequestreview-389135910", "createdAt": "2020-04-07T13:50:52Z", "commit": {"oid": "7354e468a41f6d8f3b66af84136f38ad62ed6628"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMzo1MDo1MlrOGCEisA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNDoxNzowMVrOGCFvbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyNDc1Mg==", "bodyText": "Ther should be 1 statement per line. Please break it into separate statements. Coalescing complex code into gigantic nested statements make it very difficult to read and debug.", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404824752", "createdAt": "2020-04-07T13:50:52Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/dialog/SyncedFolderPreferencesDialogFragment.java", "diffHunk": "@@ -454,6 +470,36 @@ public void onCancel(DialogInterface dialog) {\n         behaviourDialog.show();\n     }\n \n+    private void showNameCollisionPolicyDialog() {\n+        AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());\n+        builder.setTitle(ThemeUtils.getColoredTitle(\n+            getResources().getString(R.string.pref_instant_name_collision_policy_dialogTitle),\n+            ThemeUtils.primaryAccentColor(getContext())))\n+            .setSingleChoiceItems(getResources().getTextArray(R.array.pref_name_collision_policy_entries),\n+                                  mSyncedFolder.getNameCollisionPolicyInteger(),\n+                                  new\n+                                      DialogInterface.OnClickListener() {\n+                                          public void onClick(DialogInterface dialog, int which) {\n+                                              mSyncedFolder.setNameCollisionPolicy(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7354e468a41f6d8f3b66af84136f38ad62ed6628"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyNjE4NQ==", "bodyText": "Please consider extractin this interface into a fragment member. Those callbacks are de facto piece of fragment logic and here are mixed with construction logic.\nAlternatively we could create 2 methods in fragment and link them here.", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404826185", "createdAt": "2020-04-07T13:52:48Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/dialog/SyncedFolderPreferencesDialogFragment.java", "diffHunk": "@@ -454,6 +470,36 @@ public void onCancel(DialogInterface dialog) {\n         behaviourDialog.show();\n     }\n \n+    private void showNameCollisionPolicyDialog() {\n+        AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());\n+        builder.setTitle(ThemeUtils.getColoredTitle(\n+            getResources().getString(R.string.pref_instant_name_collision_policy_dialogTitle),\n+            ThemeUtils.primaryAccentColor(getContext())))\n+            .setSingleChoiceItems(getResources().getTextArray(R.array.pref_name_collision_policy_entries),\n+                                  mSyncedFolder.getNameCollisionPolicyInteger(),\n+                                  new\n+                                      DialogInterface.OnClickListener() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7354e468a41f6d8f3b66af84136f38ad62ed6628"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyOTgwOA==", "bodyText": "Did you mean setCollisionPolicyByName(String collisionPolicyName)? This function name does not make sense - it says that someobdy chooses a name for a collision policy.\nI think it refers to the unfornately named NameCollisionPolicy type.\n@tobiasKaminsky  what do you think? can we fix it?", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404829808", "createdAt": "2020-04-07T13:57:32Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/dialog/parcel/SyncedFolderParcelable.java", "diffHunk": "@@ -146,6 +151,33 @@ public void setUploadAction(String uploadAction) {\n         }\n     }\n \n+\n+    public Integer getNameCollisionPolicyInteger() {\n+        switch (nameCollisionPolicy) {\n+            case ASK_USER:\n+                return 0;\n+            case OVERWRITE:\n+                return 1;\n+            case RENAME:\n+                return 2;\n+        }\n+        return 0;\n+    }\n+\n+    public void setNameCollisionPolicy(String nameCollisionPolicy) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7354e468a41f6d8f3b66af84136f38ad62ed6628"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgzMDAxMQ==", "bodyText": "Please consider eliminating magic values and moveing them to documented constants.", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404830011", "createdAt": "2020-04-07T13:57:50Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/dialog/parcel/SyncedFolderParcelable.java", "diffHunk": "@@ -146,6 +151,33 @@ public void setUploadAction(String uploadAction) {\n         }\n     }\n \n+\n+    public Integer getNameCollisionPolicyInteger() {\n+        switch (nameCollisionPolicy) {\n+            case ASK_USER:\n+                return 0;\n+            case OVERWRITE:\n+                return 1;\n+            case RENAME:\n+                return 2;\n+        }\n+        return 0;\n+    }\n+\n+    public void setNameCollisionPolicy(String nameCollisionPolicy) {\n+        switch (nameCollisionPolicy) {\n+            case \"NAME_COLLISION_POLICY_ASK\":\n+                this.nameCollisionPolicy = FileUploader.NameCollisionPolicy.ASK_USER;\n+                break;\n+            case \"NAME_COLLISION_POLICY_OVERWRITE\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7354e468a41f6d8f3b66af84136f38ad62ed6628"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgzNDkxOQ==", "bodyText": "No sure why do we pass a primitive type instead of strongly typed enum here?", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404834919", "createdAt": "2020-04-07T14:04:22Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/datamodel/SyncedFolderDisplayItem.java", "diffHunk": "@@ -60,6 +60,7 @@ public SyncedFolderDisplayItem(long id,\n                                    boolean subfolderByDate,\n                                    String account,\n                                    int uploadAction,\n+                                   int nameCollisionPolicy,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7354e468a41f6d8f3b66af84136f38ad62ed6628"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgzNjk3MQ==", "bodyText": "Please provide a javadoc for this method. The name does not tell the story. Why do we convert it to int? What is the meaning of this int? Constraints?\nPlease consider using primitive type instead of boxed type.", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404836971", "createdAt": "2020-04-07T14:07:20Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/dialog/parcel/SyncedFolderParcelable.java", "diffHunk": "@@ -146,6 +151,33 @@ public void setUploadAction(String uploadAction) {\n         }\n     }\n \n+\n+    public Integer getNameCollisionPolicyInteger() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7354e468a41f6d8f3b66af84136f38ad62ed6628"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg0MTAzMw==", "bodyText": "This conversion could be folded into enum NameCollisionPolicy:\npublic static NameCollisionPolicy fromName(String policyName) { ... }\n@tobiasKaminsky I think the name choosen for this concept is invalid. While here, we could rename it into CollisionPolicyName, so it respects english grammar rules. As it is now - it's just confusing.", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404841033", "createdAt": "2020-04-07T14:12:49Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/dialog/parcel/SyncedFolderParcelable.java", "diffHunk": "@@ -146,6 +151,33 @@ public void setUploadAction(String uploadAction) {\n         }\n     }\n \n+\n+    public Integer getNameCollisionPolicyInteger() {\n+        switch (nameCollisionPolicy) {\n+            case ASK_USER:\n+                return 0;\n+            case OVERWRITE:\n+                return 1;\n+            case RENAME:\n+                return 2;\n+        }\n+        return 0;\n+    }\n+\n+    public void setNameCollisionPolicy(String nameCollisionPolicy) {\n+        switch (nameCollisionPolicy) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7354e468a41f6d8f3b66af84136f38ad62ed6628"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg0NDM5Ng==", "bodyText": "Can we use the same names as in the enum? That makes it possible to use NameCollisionPolicy.valueOf() directly.\n@tobiasKaminsky Given that the type has been probably misnamed, if we want to fix it it's time to do it here instead of spilling this confusing name everywhere.", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404844396", "createdAt": "2020-04-07T14:17:01Z", "author": {"login": "ezaquarii"}, "path": "src/main/res/values/attrs.xml", "diffHunk": "@@ -11,4 +11,16 @@\n \t\t<item>LOCAL_BEHAVIOUR_MOVE</item>\n \t\t<item>LOCAL_BEHAVIOUR_DELETE</item>\n \t</string-array>\n+\n+    <string-array name=\"pref_name_collision_policy_entries\" translatable=\"false\">\n+        <item>@string/pref_instant_name_collision_policy_entries_always_ask</item>\n+        <item>@string/pref_instant_name_collision_policy_entries_overwrite</item>\n+        <item>@string/pref_instant_name_collision_policy_entries_rename</item>\n+    </string-array>\n+\n+    <string-array name=\"pref_name_collision_policy_entryValues\" translatable=\"false\">\n+        <item>NAME_COLLISION_POLICY_ASK</item>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7354e468a41f6d8f3b66af84136f38ad62ed6628"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMDY2MTgx", "url": "https://github.com/nextcloud/android/pull/5810#pullrequestreview-393066181", "createdAt": "2020-04-14T15:52:50Z", "commit": {"oid": "4bcef9a02e9717dde792f7c6c58a903f0e524b65"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjA4MDQy", "url": "https://github.com/nextcloud/android/pull/5810#pullrequestreview-393608042", "createdAt": "2020-04-15T09:30:43Z", "commit": {"oid": "4bcef9a02e9717dde792f7c6c58a903f0e524b65"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32da47d6a31503d885ffa3a0acebb1cfbd697f71", "author": {"user": {"login": "fodinabor", "name": null}}, "url": "https://github.com/nextcloud/android/commit/32da47d6a31503d885ffa3a0acebb1cfbd697f71", "committedDate": "2020-04-15T17:12:06Z", "message": "Make the name collision policy for auto uploads selectable, fixes #5599.\n\nSigned-off-by: Joachim Meyer <joachim@joameyer.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db3bd029ca6c4d673f477624c6fb1f746d666525", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/db3bd029ca6c4d673f477624c6fb1f746d666525", "committedDate": "2020-04-15T17:12:16Z", "message": "code formatting\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "464aaded14903525948ce555940582f39676234e", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/464aaded14903525948ce555940582f39676234e", "committedDate": "2020-04-15T17:12:43Z", "message": "increase spotbugs\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4678, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}