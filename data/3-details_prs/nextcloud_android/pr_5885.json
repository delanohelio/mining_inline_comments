{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0MTU1NjM0", "number": 5885, "title": "Do not run insertAllDBEntriesForSyncedFolder directly", "bodyText": "Fix #5882\nPreviously we ran insertAllDBEntriesForSyncedFolder on UI, which causes a lag on very big folders.\nNow we use FilesSyncJob, which does the same, but is a Job, which runs in background.\n@ezaquarii @AndyScherzinger\nSigned-off-by: tobiasKaminsky tobias@kaminsky.me\nTesting\nWriting tests is very important. Please try to write some tests for your PR.\nIf you need help, please do not hesitate to ask in this PR for help.\nunit tests\ninstrumented tests\nUI tests\n\n Tests written, or not not needed", "createdAt": "2020-04-16T06:57:26Z", "url": "https://github.com/nextcloud/android/pull/5885", "merged": true, "mergeCommit": {"oid": "f9fc4fb8f9b44e5d4ecbc37ae0d5960ac488cbf8"}, "closed": true, "closedAt": "2020-04-16T21:41:03Z", "author": {"login": "tobiasKaminsky"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYHJz7gBqjMyMzg0NTgwMzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYTv8tABqjMyNDE5NTQzNDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a8f89ced47cdee5fad53467711a9e06ecccc8faf", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/a8f89ced47cdee5fad53467711a9e06ecccc8faf", "committedDate": "2020-04-16T06:56:26Z", "message": "Do not run insertAllDBEntriesForSyncedFolder directly, but use FilesSyncJob\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}, "afterCommit": {"oid": "b6cd1f703f56b996c0acf92a49c11ad9275a5c2d", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/b6cd1f703f56b996c0acf92a49c11ad9275a5c2d", "committedDate": "2020-04-16T07:00:08Z", "message": "Do not run insertAllDBEntriesForSyncedFolder directly, but use FilesSyncJob\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MzU0MTU1", "url": "https://github.com/nextcloud/android/pull/5885#pullrequestreview-394354155", "createdAt": "2020-04-16T07:11:21Z", "commit": {"oid": "b6cd1f703f56b996c0acf92a49c11ad9275a5c2d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b6cd1f703f56b996c0acf92a49c11ad9275a5c2d", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/b6cd1f703f56b996c0acf92a49c11ad9275a5c2d", "committedDate": "2020-04-16T07:00:08Z", "message": "Do not run insertAllDBEntriesForSyncedFolder directly, but use FilesSyncJob\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}, "afterCommit": {"oid": "8ed170963806782e3cff7c776d42f3a18dc37fb5", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/8ed170963806782e3cff7c776d42f3a18dc37fb5", "committedDate": "2020-04-16T09:58:14Z", "message": "Do not run insertAllDBEntriesForSyncedFolder directly, but use FilesSyncJob\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NTcwNDAz", "url": "https://github.com/nextcloud/android/pull/5885#pullrequestreview-394570403", "createdAt": "2020-04-16T12:13:20Z", "commit": {"oid": "8ed170963806782e3cff7c776d42f3a18dc37fb5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NTg0ODQ2", "url": "https://github.com/nextcloud/android/pull/5885#pullrequestreview-394584846", "createdAt": "2020-04-16T12:33:00Z", "commit": {"oid": "8ed170963806782e3cff7c776d42f3a18dc37fb5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMjozMzowMFrOGGjBeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMjozMzowMFrOGGjBeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUxODQ1OA==", "bodyText": "@tobiasKaminsky I'm not sure what this flag is supposed to do in this context?", "url": "https://github.com/nextcloud/android/pull/5885#discussion_r409518458", "createdAt": "2020-04-16T12:33:00Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/MainApp.java", "diffHunk": "@@ -768,15 +768,7 @@ private static void initiateExistingAutoUploadEntries(Clock clock) {\n         new Thread(() -> {\n             AppPreferences preferences = AppPreferencesImpl.fromContext(getAppContext());\n             if (!preferences.isAutoUploadInitialized()) {\n-                SyncedFolderProvider syncedFolderProvider =\n-                    new SyncedFolderProvider(MainApp.getAppContext().getContentResolver(), preferences, clock);\n-\n-                for (SyncedFolder syncedFolder : syncedFolderProvider.getSyncedFolders()) {\n-                    if (syncedFolder.isEnabled()) {\n-                        FilesSyncHelper.insertAllDBEntriesForSyncedFolder(syncedFolder, true);\n-                    }\n-                }\n-\n+                FilesSyncHelper.startFilesSyncJobNow(null);\n                 preferences.setAutoUploadInit(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ed170963806782e3cff7c776d42f3a18dc37fb5"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ed170963806782e3cff7c776d42f3a18dc37fb5", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/8ed170963806782e3cff7c776d42f3a18dc37fb5", "committedDate": "2020-04-16T09:58:14Z", "message": "Do not run insertAllDBEntriesForSyncedFolder directly, but use FilesSyncJob\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}, "afterCommit": {"oid": "e55fdd1289bc28f03f6244e9e4f910ac27a2e81c", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/e55fdd1289bc28f03f6244e9e4f910ac27a2e81c", "committedDate": "2020-04-16T15:17:25Z", "message": "Do not run insertAllDBEntriesForSyncedFolder directly, but use FilesSyncJob\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e55fdd1289bc28f03f6244e9e4f910ac27a2e81c", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/e55fdd1289bc28f03f6244e9e4f910ac27a2e81c", "committedDate": "2020-04-16T15:17:25Z", "message": "Do not run insertAllDBEntriesForSyncedFolder directly, but use FilesSyncJob\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}, "afterCommit": {"oid": "9345102aa0748110f9601eee8156268a1757f7e3", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/9345102aa0748110f9601eee8156268a1757f7e3", "committedDate": "2020-04-16T21:22:19Z", "message": "Do not run insertAllDBEntriesForSyncedFolder directly, but use FilesSyncJob\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4a1c7ae615b306132a803e84989284b4fe94cab", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/c4a1c7ae615b306132a803e84989284b4fe94cab", "committedDate": "2020-04-16T21:40:26Z", "message": "Do not run insertAllDBEntriesForSyncedFolder directly, but use FilesSyncJob\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9345102aa0748110f9601eee8156268a1757f7e3", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/9345102aa0748110f9601eee8156268a1757f7e3", "committedDate": "2020-04-16T21:22:19Z", "message": "Do not run insertAllDBEntriesForSyncedFolder directly, but use FilesSyncJob\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}, "afterCommit": {"oid": "c4a1c7ae615b306132a803e84989284b4fe94cab", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/c4a1c7ae615b306132a803e84989284b4fe94cab", "committedDate": "2020-04-16T21:40:26Z", "message": "Do not run insertAllDBEntriesForSyncedFolder directly, but use FilesSyncJob\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4697, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}