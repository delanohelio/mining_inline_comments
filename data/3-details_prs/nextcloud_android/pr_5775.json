{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1Njc5ODE4", "number": 5775, "title": "if no offline editor is available, use OO/Cool/Text", "bodyText": "Fix #5340\n\ndownload an OO capable file\nhave no local app that can open it\npreviously: \"no app to handle it\"\nnow: uses OO/Cool/Text if available, else \"no app to handle it\"\n\nSigned-off-by: tobiasKaminsky tobias@kaminsky.me\nTesting\nWriting tests is very important. Please try to write some tests for your PR.\nIf you need help, please do not hesitate to ask in this PR for help.\nunit tests\ninstrumented tests\nUI tests\n\n Tests written, or not not needed", "createdAt": "2020-03-30T14:13:43Z", "url": "https://github.com/nextcloud/android/pull/5775", "merged": true, "mergeCommit": {"oid": "c6be91a0968bf09d179c805dd2b65d794c8b5a7b"}, "closed": true, "closedAt": "2020-03-30T18:06:31Z", "author": {"login": "tobiasKaminsky"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSvJKgAH2gAyMzk1Njc5ODE4OmQzZjNiOThiZTBjODlkZmIxNGE3ZDdiNjQ1ZmExMTNjOWExNDBhYzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSye3QgFqTM4NDEwMzkzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d3f3b98be0c89dfb14a7d7b645fa113c9a140ac9", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/d3f3b98be0c89dfb14a7d7b645fa113c9a140ac9", "committedDate": "2020-03-30T14:12:16Z", "message": "if no offline editor is available, use OO/Cool/Text\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzOTYwMDM5", "url": "https://github.com/nextcloud/android/pull/5775#pullrequestreview-383960039", "createdAt": "2020-03-30T15:16:00Z", "commit": {"oid": "d3f3b98be0c89dfb14a7d7b645fa113c9a140ac9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNToxNjowMFrOF9uyBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNToxNjowMFrOF9uyBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI3MzkyNw==", "bodyText": "the return calls aren't needed", "url": "https://github.com/nextcloud/android/pull/5775#discussion_r400273927", "createdAt": "2020-03-30T15:16:00Z", "author": {"login": "AndyScherzinger"}, "path": "src/main/java/com/owncloud/android/ui/helpers/FileOperationsHelper.java", "diffHunk": "@@ -278,16 +280,25 @@ public void openFile(OCFile file) {\n                     queryIntentActivities(openFileWithIntent, PackageManager.GET_RESOLVED_FILTER);\n \n             if (launchables.isEmpty()) {\n-                Account account = fileActivity.getAccount();\n-                OCCapability capability = fileActivity.getStorageManager().getCapability(account.name);\n-                if (capability.getRichDocumentsMimeTypeList().contains(file.getMimeType()) &&\n-                    android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP &&\n-                    capability.getRichDocumentsDirectEditing().isTrue()) {\n-                    openFileAsRichDocument(file, fileActivity);\n-                    return;\n+                Optional<User> optionalUser = fileActivity.getUser();\n+\n+                if (optionalUser.isPresent() && FileMenuFilter.isEditorAvailable(fileActivity.getContentResolver(),\n+                                                                                 optionalUser.get(),\n+                                                                                 file.getMimeType()) &&\n+                    android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {\n+                    openFileWithTextEditor(file, fileActivity);\n                 } else {\n-                    DisplayUtils.showSnackMessage(fileActivity, R.string.file_list_no_app_for_file_type);\n-                    return;\n+                    Account account = fileActivity.getAccount();\n+                    OCCapability capability = fileActivity.getStorageManager().getCapability(account.name);\n+                    if (capability.getRichDocumentsMimeTypeList().contains(file.getMimeType()) &&\n+                        android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP &&\n+                        capability.getRichDocumentsDirectEditing().isTrue()) {\n+                        openFileAsRichDocument(file, fileActivity);\n+                        return;\n+                    } else {\n+                        DisplayUtils.showSnackMessage(fileActivity, R.string.file_list_no_app_for_file_type);\n+                        return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3f3b98be0c89dfb14a7d7b645fa113c9a140ac9"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MTAzOTM4", "url": "https://github.com/nextcloud/android/pull/5775#pullrequestreview-384103938", "createdAt": "2020-03-30T18:05:41Z", "commit": {"oid": "d3f3b98be0c89dfb14a7d7b645fa113c9a140ac9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4671, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}