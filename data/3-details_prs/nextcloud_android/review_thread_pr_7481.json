{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3MjI5NzQ4", "number": 7481, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwNzoyNjoyMFrOE9GCiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwNzoyNjoyMFrOE9GCiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyNDk3NTQ1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwNzoyNjoyMFrOH5mIXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxMDo1OTo1NVrOIAhODw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE1NTYxMg==", "bodyText": "do we need some negative button tinting here (needs to be done after show() else negativeButton will return as null)?", "url": "https://github.com/nextcloud/android/pull/7481#discussion_r530155612", "createdAt": "2020-11-25T07:26:20Z", "author": {"login": "AndyScherzinger"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -272,14 +274,38 @@ protected void onCreate(Bundle savedInstanceState) {\n         if (taskRetainerFragment == null) {\n             taskRetainerFragment = new TaskRetainerFragment();\n             fm.beginTransaction()\n-                    .add(taskRetainerFragment, TaskRetainerFragment.FTAG_TASK_RETAINER_FRAGMENT).commit();\n+                .add(taskRetainerFragment, TaskRetainerFragment.FTAG_TASK_RETAINER_FRAGMENT).commit();\n         }   // else, Fragment already created and retained across configuration change\n \n         if (Intent.ACTION_VIEW.equals(getIntent().getAction())) {\n             handleOpenFileViaIntent(getIntent());\n         }\n \n         mPlayerConnection = new PlayerServiceConnection(this);\n+\n+        checkStoragePath();\n+    }\n+\n+    private void checkStoragePath() {\n+        String newStorage = Environment.getExternalStorageDirectory().getAbsolutePath();\n+        String storagePath = preferences.getStoragePath(newStorage);\n+        if (!preferences.isStoragePathValid() && !new File(storagePath).exists()) {\n+            // falling back to default\n+            preferences.setStoragePath(newStorage);\n+            preferences.setStoragePathValid();\n+            MainApp.setStoragePath(newStorage);\n+\n+            try {\n+                new AlertDialog.Builder(this, R.style.Theme_ownCloud_Dialog)\n+                    .setTitle(R.string.wrong_storage_path)\n+                    .setMessage(R.string.wrong_storage_path_desc)\n+                    .setNegativeButton(R.string.dialog_close, (dialog, which) -> dialog.dismiss())\n+                    .setIcon(R.drawable.ic_settings)\n+                    .show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85ba950ea1af4d2816120b711ad5350fa014483c"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQxNTE4Mw==", "bodyText": "DONE: 9ffe679", "url": "https://github.com/nextcloud/android/pull/7481#discussion_r537415183", "createdAt": "2020-12-07T10:59:55Z", "author": {"login": "AndyScherzinger"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -272,14 +274,38 @@ protected void onCreate(Bundle savedInstanceState) {\n         if (taskRetainerFragment == null) {\n             taskRetainerFragment = new TaskRetainerFragment();\n             fm.beginTransaction()\n-                    .add(taskRetainerFragment, TaskRetainerFragment.FTAG_TASK_RETAINER_FRAGMENT).commit();\n+                .add(taskRetainerFragment, TaskRetainerFragment.FTAG_TASK_RETAINER_FRAGMENT).commit();\n         }   // else, Fragment already created and retained across configuration change\n \n         if (Intent.ACTION_VIEW.equals(getIntent().getAction())) {\n             handleOpenFileViaIntent(getIntent());\n         }\n \n         mPlayerConnection = new PlayerServiceConnection(this);\n+\n+        checkStoragePath();\n+    }\n+\n+    private void checkStoragePath() {\n+        String newStorage = Environment.getExternalStorageDirectory().getAbsolutePath();\n+        String storagePath = preferences.getStoragePath(newStorage);\n+        if (!preferences.isStoragePathValid() && !new File(storagePath).exists()) {\n+            // falling back to default\n+            preferences.setStoragePath(newStorage);\n+            preferences.setStoragePathValid();\n+            MainApp.setStoragePath(newStorage);\n+\n+            try {\n+                new AlertDialog.Builder(this, R.style.Theme_ownCloud_Dialog)\n+                    .setTitle(R.string.wrong_storage_path)\n+                    .setMessage(R.string.wrong_storage_path_desc)\n+                    .setNegativeButton(R.string.dialog_close, (dialog, which) -> dialog.dismiss())\n+                    .setIcon(R.drawable.ic_settings)\n+                    .show();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE1NTYxMg=="}, "originalCommit": {"oid": "85ba950ea1af4d2816120b711ad5350fa014483c"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3234, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}