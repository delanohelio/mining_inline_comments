{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3NTI0NjM3", "number": 5328, "title": "Added \"not enough space dialog\"", "bodyText": "Hi,\nIt fixes : #5178 (pre-approved by @jancborchardt IRL).\nWhen we try to synchronize a \"too big\" folder/file (with a superior length than the phone available storage), the app will allow to synchronize it without any problem.\nWith this PR, it's now no longer allowed.\n(I don't know how translations are handled through transifex, but the English and French are already translated)", "createdAt": "2020-01-27T14:33:56Z", "url": "https://github.com/nextcloud/android/pull/5328", "merged": true, "mergeCommit": {"oid": "0936945b3c012f4a34825f9018ac9bc673479c8e"}, "closed": true, "closedAt": "2020-02-05T11:14:41Z", "author": {"login": "Kilian-Perisset"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9e1SeAH2gAyMzY3NTI0NjM3OjhlMDljOTlmMWZmN2EwNDBiNzZlMGZlNGJjOGI0MDNlYmI5YTNjYTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBTYPmgFqTM1MzYwMDk2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8e09c99f1ff7a040b76e0fe4bc8b403ebb9a3ca2", "author": {"user": {"login": "Kilian-Perisset", "name": "Kilian P\u00e9risset"}}, "url": "https://github.com/nextcloud/android/commit/8e09c99f1ff7a040b76e0fe4bc8b403ebb9a3ca2", "committedDate": "2020-01-24T13:19:40Z", "message": "Added dialog when sync is too heavy for device (unfinished)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c146d4f08f37c4bf813f44dd5261c011f1562ca", "author": {"user": {"login": "Kilian-Perisset", "name": "Kilian P\u00e9risset"}}, "url": "https://github.com/nextcloud/android/commit/5c146d4f08f37c4bf813f44dd5261c011f1562ca", "committedDate": "2020-01-24T13:37:15Z", "message": "Added translations for dialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fac55da6b158aca95da8bab7f1e41c20d0a8da2", "author": {"user": {"login": "Kilian-Perisset", "name": "Kilian P\u00e9risset"}}, "url": "https://github.com/nextcloud/android/commit/9fac55da6b158aca95da8bab7f1e41c20d0a8da2", "committedDate": "2020-01-24T14:08:03Z", "message": "Added args for SyncFileNotEnoughSpaceFragment (unfinished)\n\nCaption support is missing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03a307825d53ca1024cc8d723691d1b30fa2ac1f", "author": {"user": {"login": "Kilian-Perisset", "name": "Kilian P\u00e9risset"}}, "url": "https://github.com/nextcloud/android/commit/03a307825d53ca1024cc8d723691d1b30fa2ac1f", "committedDate": "2020-01-27T14:29:46Z", "message": "Finished \"Not Enough Space\" dialog + Optimized UX"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56076dfd96c7f2a75e763a91f117d039bdd5f96d", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/56076dfd96c7f2a75e763a91f117d039bdd5f96d", "committedDate": "2020-01-28T10:26:41Z", "message": "small typo enhancements\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54f30670dde6cfd62ffcdcba0bc60393b95909f6", "author": {"user": {"login": "Kilian-Perisset", "name": "Kilian P\u00e9risset"}}, "url": "https://github.com/nextcloud/android/commit/54f30670dde6cfd62ffcdcba0bc60393b95909f6", "committedDate": "2020-01-28T12:28:54Z", "message": "Removed translatable attribute from strings\n\nSigned-off-by: Kilian P\u00e9risset <kilian.perisset@infomaniak.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c44f2003dcdf9abe645c80259bd4bbbb7510adc", "author": {"user": {"login": "Kilian-Perisset", "name": "Kilian P\u00e9risset"}}, "url": "https://github.com/nextcloud/android/commit/1c44f2003dcdf9abe645c80259bd4bbbb7510adc", "committedDate": "2020-01-28T12:59:24Z", "message": "Removed codacy issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3c19410c810846988493480dea274a6845a75b1", "author": {"user": {"login": "Kilian-Perisset", "name": "Kilian P\u00e9risset"}}, "url": "https://github.com/nextcloud/android/commit/e3c19410c810846988493480dea274a6845a75b1", "committedDate": "2020-01-28T13:05:50Z", "message": "Removed redundant code for Codacy grade"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5MzYyMjIx", "url": "https://github.com/nextcloud/android/pull/5328#pullrequestreview-349362221", "createdAt": "2020-01-28T13:14:28Z", "commit": {"oid": "e3c19410c810846988493480dea274a6845a75b1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8737d9b835c5d659b79fcf4f3b07bd4922a493d0", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/8737d9b835c5d659b79fcf4f3b07bd4922a493d0", "committedDate": "2020-01-28T15:02:19Z", "message": "add ui test\n- some small code changes\n- removed unneeded code\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NzY2MjQ3", "url": "https://github.com/nextcloud/android/pull/5328#pullrequestreview-349766247", "createdAt": "2020-01-28T23:02:11Z", "commit": {"oid": "e3c19410c810846988493480dea274a6845a75b1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQyMzowMjoxMlrOFi3o0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQyMzowNzo0OFrOFi3waw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEwNzQ3Mg==", "bodyText": "Please consider hasEnoughSpace.", "url": "https://github.com/nextcloud/android/pull/5328#discussion_r372107472", "createdAt": "2020-01-28T23:02:12Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/helpers/FileOperationsHelper.java", "diffHunk": "@@ -1043,5 +1039,22 @@ public static String getCapturedImageName() {\n         return new SimpleDateFormat(\"yyyy-MM-dd_HHmmss\", Locale.US).format(new Date()) + \".jpg\";\n     }\n \n+    public static Pair<Boolean, Long> isSpaceEnough(OCFile file) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3c19410c810846988493480dea274a6845a75b1"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEwOTQxOQ==", "bodyText": "I'd consider a data class with named fields:\ndata class AvailableSpace(val hasEnoughSpace: Boolean, val availableSpace: Long)\nor somehting similar (this is Kotlin, btw).\nPair is pretty useful concept in general, but the first and second field names are less than helpful when reading. I guess this is why Java did not ship Pair at all, argumenting that one should just create a well-named type instead.\nIf you believe that we should use Pair anyway, please consider using the class available in Kotlin stdlib instead of Android platform API, which gives us headaches during testing.", "url": "https://github.com/nextcloud/android/pull/5328#discussion_r372109419", "createdAt": "2020-01-28T23:07:48Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/helpers/FileOperationsHelper.java", "diffHunk": "@@ -1043,5 +1039,22 @@ public static String getCapturedImageName() {\n         return new SimpleDateFormat(\"yyyy-MM-dd_HHmmss\", Locale.US).format(new Date()) + \".jpg\";\n     }\n \n+    public static Pair<Boolean, Long> isSpaceEnough(OCFile file) {\n+        StatFs stat = new StatFs(Environment.getExternalStorageDirectory().getPath());\n+        long availableBytesOnDevice;\n+        if (android.os.Build.VERSION.SDK_INT >=\n+            android.os.Build.VERSION_CODES.JELLY_BEAN_MR2) {\n+            availableBytesOnDevice = stat.getBlockSizeLong() * stat.getAvailableBlocksLong();\n+        }\n+        else {\n+            availableBytesOnDevice = (long) stat.getBlockSize() * (long) stat.getAvailableBlocks();\n+        }\n+\n+        boolean isSpaceEnough = file.getFileLength() < availableBytesOnDevice;\n+\n+        return new Pair<>(isSpaceEnough, availableBytesOnDevice);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3c19410c810846988493480dea274a6845a75b1"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d5e3da126bda11b883a53d0b04e3d162c920d74", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/9d5e3da126bda11b883a53d0b04e3d162c920d74", "committedDate": "2020-01-29T07:35:20Z", "message": "Merge remote-tracking branch 'origin/fix/not-enough-space-dialog' into fix/not-enough-space-dialog\n\n# Conflicts:\n#\tsrc/main/java/com/owncloud/android/ui/dialog/SyncFileNotEnoughSpaceDialogFragment.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52edda73f6c0e9c668da8ebe609ea20352e83eb0", "author": {"user": {"login": "Kilian-Perisset", "name": "Kilian P\u00e9risset"}}, "url": "https://github.com/nextcloud/android/commit/52edda73f6c0e9c668da8ebe609ea20352e83eb0", "committedDate": "2020-01-29T09:39:45Z", "message": "Formated the code and removed Pair"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bed2adc2f923e05a8fd89fef297839027949a9c", "author": {"user": {"login": "Kilian-Perisset", "name": "Kilian P\u00e9risset"}}, "url": "https://github.com/nextcloud/android/commit/4bed2adc2f923e05a8fd89fef297839027949a9c", "committedDate": "2020-01-29T09:39:52Z", "message": "Merge branch 'fix/not-enough-space-dialog' of github.com:nextcloud/android into fix/not-enough-space-dialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dbce81c1d222faef07055d34e04b57ac2ba0b3a", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/6dbce81c1d222faef07055d34e04b57ac2ba0b3a", "committedDate": "2020-01-30T13:55:18Z", "message": "update screenshot\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ac4e1394be716c5bcfaec591565f3305202a694", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/1ac4e1394be716c5bcfaec591565f3305202a694", "committedDate": "2020-01-30T13:56:50Z", "message": "update screenshot test cases\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82baea306205977844ee3d523fbf380a7eaa2505", "author": {"user": {"login": "Kilian-Perisset", "name": "Kilian P\u00e9risset"}}, "url": "https://github.com/nextcloud/android/commit/82baea306205977844ee3d523fbf380a7eaa2505", "committedDate": "2020-01-30T15:55:37Z", "message": "Normalized the code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMjAwOTgy", "url": "https://github.com/nextcloud/android/pull/5328#pullrequestreview-351200982", "createdAt": "2020-01-30T22:59:24Z", "commit": {"oid": "82baea306205977844ee3d523fbf380a7eaa2505"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b74c9f25173e6bd7714d0f127ef8d66cb19907af", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/b74c9f25173e6bd7714d0f127ef8d66cb19907af", "committedDate": "2020-02-04T10:24:10Z", "message": "use correct storage location\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88c4d6d2abfdb5f6ebe94690098899a7a9680974", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/88c4d6d2abfdb5f6ebe94690098899a7a9680974", "committedDate": "2020-02-04T10:24:19Z", "message": "Merge remote-tracking branch 'origin/fix/not-enough-space-dialog' into fix/not-enough-space-dialog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyODU0OTg4", "url": "https://github.com/nextcloud/android/pull/5328#pullrequestreview-352854988", "createdAt": "2020-02-04T10:08:02Z", "commit": {"oid": "82baea306205977844ee3d523fbf380a7eaa2505"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDowODowMlrOFlOd2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMDoxNjozNFrOFlOvjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3ODY0OA==", "bodyText": "please line wrap", "url": "https://github.com/nextcloud/android/pull/5328#discussion_r374578648", "createdAt": "2020-02-04T10:08:02Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/owncloud/android/ui/dialog/SyncFileNotEnoughSpaceDialogFragment.java", "diffHunk": "@@ -0,0 +1,132 @@\n+/*\n+ *   Nextcloud Android client application\n+ *\n+ *   @author Kilian P\u00e9risset\n+ *   Copyright (C) 2020 Infomaniak Network SA\n+ *\n+ *   This program is free software: you can redistribute it and/or modify\n+ *   it under the terms of the GNU Affero General Public License (GPLv3),\n+ *   as published by the Free Software Foundation.\n+ *\n+ *   This program is distributed in the hope that it will be useful,\n+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *   GNU General Public License for more details.\n+ *\n+ *   You should have received a copy of the GNU General Public License\n+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package com.owncloud.android.ui.dialog;\n+\n+import android.app.Dialog;\n+import android.content.Intent;\n+import android.os.Build;\n+import android.os.Bundle;\n+import android.os.storage.StorageManager;\n+\n+import com.owncloud.android.R;\n+import com.owncloud.android.datamodel.OCFile;\n+import com.owncloud.android.ui.dialog.ConfirmationDialogFragment.ConfirmationDialogFragmentListener;\n+import com.owncloud.android.ui.fragment.OCFileListFragment;\n+import com.owncloud.android.utils.DisplayUtils;\n+import com.owncloud.android.utils.ThemeUtils;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.RequiresApi;\n+import androidx.appcompat.app.AlertDialog;\n+\n+/**\n+ * Dialog requiring confirmation when a file/folder is too \"big\" to be synchronized/downloaded on device.\n+ */\n+public class SyncFileNotEnoughSpaceDialogFragment extends ConfirmationDialogFragment implements\n+    ConfirmationDialogFragmentListener {\n+\n+    private static final String ARG_PASSED_FILE = \"fragment_parent_caller\";\n+    private static final int REQUEST_CODE_STORAGE = 20;\n+\n+    private OCFile targetFile;\n+\n+    public static SyncFileNotEnoughSpaceDialogFragment newInstance(OCFile file, long availableDeviceSpace) {\n+        Bundle args = new Bundle();\n+        SyncFileNotEnoughSpaceDialogFragment frag = new SyncFileNotEnoughSpaceDialogFragment();\n+        String properFileSize = DisplayUtils.bytesToHumanReadable(file.getFileLength());\n+        String properDiskAvailableSpace = DisplayUtils.bytesToHumanReadable(availableDeviceSpace);\n+\n+        // Defining title, message and resources\n+        args.putInt(ARG_TITLE_ID, R.string.sync_not_enough_space_dialog_title);\n+        args.putInt(ARG_MESSAGE_RESOURCE_ID, R.string.sync_not_enough_space_dialog_placeholder);\n+        args.putStringArray(ARG_MESSAGE_ARGUMENTS, new String[]{file.getFileName(), properFileSize, properDiskAvailableSpace});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82baea306205977844ee3d523fbf380a7eaa2505"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU3OTAyNA==", "bodyText": "What happens on older Android versions?", "url": "https://github.com/nextcloud/android/pull/5328#discussion_r374579024", "createdAt": "2020-02-04T10:08:41Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/owncloud/android/ui/dialog/SyncFileNotEnoughSpaceDialogFragment.java", "diffHunk": "@@ -0,0 +1,132 @@\n+/*\n+ *   Nextcloud Android client application\n+ *\n+ *   @author Kilian P\u00e9risset\n+ *   Copyright (C) 2020 Infomaniak Network SA\n+ *\n+ *   This program is free software: you can redistribute it and/or modify\n+ *   it under the terms of the GNU Affero General Public License (GPLv3),\n+ *   as published by the Free Software Foundation.\n+ *\n+ *   This program is distributed in the hope that it will be useful,\n+ *   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ *   GNU General Public License for more details.\n+ *\n+ *   You should have received a copy of the GNU General Public License\n+ *   along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package com.owncloud.android.ui.dialog;\n+\n+import android.app.Dialog;\n+import android.content.Intent;\n+import android.os.Build;\n+import android.os.Bundle;\n+import android.os.storage.StorageManager;\n+\n+import com.owncloud.android.R;\n+import com.owncloud.android.datamodel.OCFile;\n+import com.owncloud.android.ui.dialog.ConfirmationDialogFragment.ConfirmationDialogFragmentListener;\n+import com.owncloud.android.ui.fragment.OCFileListFragment;\n+import com.owncloud.android.utils.DisplayUtils;\n+import com.owncloud.android.utils.ThemeUtils;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.RequiresApi;\n+import androidx.appcompat.app.AlertDialog;\n+\n+/**\n+ * Dialog requiring confirmation when a file/folder is too \"big\" to be synchronized/downloaded on device.\n+ */\n+public class SyncFileNotEnoughSpaceDialogFragment extends ConfirmationDialogFragment implements\n+    ConfirmationDialogFragmentListener {\n+\n+    private static final String ARG_PASSED_FILE = \"fragment_parent_caller\";\n+    private static final int REQUEST_CODE_STORAGE = 20;\n+\n+    private OCFile targetFile;\n+\n+    public static SyncFileNotEnoughSpaceDialogFragment newInstance(OCFile file, long availableDeviceSpace) {\n+        Bundle args = new Bundle();\n+        SyncFileNotEnoughSpaceDialogFragment frag = new SyncFileNotEnoughSpaceDialogFragment();\n+        String properFileSize = DisplayUtils.bytesToHumanReadable(file.getFileLength());\n+        String properDiskAvailableSpace = DisplayUtils.bytesToHumanReadable(availableDeviceSpace);\n+\n+        // Defining title, message and resources\n+        args.putInt(ARG_TITLE_ID, R.string.sync_not_enough_space_dialog_title);\n+        args.putInt(ARG_MESSAGE_RESOURCE_ID, R.string.sync_not_enough_space_dialog_placeholder);\n+        args.putStringArray(ARG_MESSAGE_ARGUMENTS, new String[]{file.getFileName(), properFileSize, properDiskAvailableSpace});\n+        args.putParcelable(ARG_PASSED_FILE, file);\n+\n+        // Defining buttons\n+        if (file.isFolder()) {\n+            args.putInt(ARG_POSITIVE_BTN_RES, R.string.sync_not_enough_space_dialog_action_choose);\n+        }\n+        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.N_MR1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82baea306205977844ee3d523fbf380a7eaa2505"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4MjUzNQ==", "bodyText": "This is correct, but for me it is not intuitive to read, what about this:\ngetRemainingSpaceOnDevice -> should return how much space is left in this folder/partition\n(no need of passing OCFile)\nthen it is just a\nboolean isSpaceEnough = remainingSpaceOnDevice > file.getFileLenght();", "url": "https://github.com/nextcloud/android/pull/5328#discussion_r374582535", "createdAt": "2020-02-04T10:15:25Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/owncloud/android/ui/fragment/OCFileListFragment.java", "diffHunk": "@@ -1720,6 +1724,33 @@ private boolean isSearchEventSet(SearchEvent event) {\n             && event.getUnsetType() != null;\n     }\n \n+    private void syncAndCheckFiles(Collection<OCFile> files) {\n+        for (OCFile file : files) {\n+            // Get the remaining space on device (after file download)\n+            long remainingSpaceOnDevice = FileOperationsHelper.getRemainingSpaceOnDevice(file);\n+            // Get the total available space on device (before file download)\n+            long availableSpaceOnDevice = file.getFileLength() + remainingSpaceOnDevice;\n+            // Determine if space is enough to download the file\n+            boolean isSpaceEnough = remainingSpaceOnDevice > 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82baea306205977844ee3d523fbf380a7eaa2505"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU4MzE4MQ==", "bodyText": "As written above, return remaining space as method name suggests that, do not subtract file length", "url": "https://github.com/nextcloud/android/pull/5328#discussion_r374583181", "createdAt": "2020-02-04T10:16:34Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/owncloud/android/ui/helpers/FileOperationsHelper.java", "diffHunk": "@@ -1043,5 +1038,19 @@ public static String getCapturedImageName() {\n         return new SimpleDateFormat(\"yyyy-MM-dd_HHmmss\", Locale.US).format(new Date()) + \".jpg\";\n     }\n \n+    public static Long getRemainingSpaceOnDevice(OCFile file) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82baea306205977844ee3d523fbf380a7eaa2505"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9a47e6b3b6a9412b6d512d5bffe5a8cb6c10e4c", "author": {"user": {"login": "Kilian-Perisset", "name": "Kilian P\u00e9risset"}}, "url": "https://github.com/nextcloud/android/commit/f9a47e6b3b6a9412b6d512d5bffe5a8cb6c10e4c", "committedDate": "2020-02-05T09:50:44Z", "message": "Formated the code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNjAwOTY2", "url": "https://github.com/nextcloud/android/pull/5328#pullrequestreview-353600966", "createdAt": "2020-02-05T10:14:41Z", "commit": {"oid": "f9a47e6b3b6a9412b6d512d5bffe5a8cb6c10e4c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4762, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}