{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1Njc5ODE4", "number": 5775, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNToxNjowMFrODsuNUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNToxNjowMFrODsuNUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4MjIxMDA5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/owncloud/android/ui/helpers/FileOperationsHelper.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNToxNjowMFrOF9uyBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxODowNTozMVrOF914ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI3MzkyNw==", "bodyText": "the return calls aren't needed", "url": "https://github.com/nextcloud/android/pull/5775#discussion_r400273927", "createdAt": "2020-03-30T15:16:00Z", "author": {"login": "AndyScherzinger"}, "path": "src/main/java/com/owncloud/android/ui/helpers/FileOperationsHelper.java", "diffHunk": "@@ -278,16 +280,25 @@ public void openFile(OCFile file) {\n                     queryIntentActivities(openFileWithIntent, PackageManager.GET_RESOLVED_FILTER);\n \n             if (launchables.isEmpty()) {\n-                Account account = fileActivity.getAccount();\n-                OCCapability capability = fileActivity.getStorageManager().getCapability(account.name);\n-                if (capability.getRichDocumentsMimeTypeList().contains(file.getMimeType()) &&\n-                    android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP &&\n-                    capability.getRichDocumentsDirectEditing().isTrue()) {\n-                    openFileAsRichDocument(file, fileActivity);\n-                    return;\n+                Optional<User> optionalUser = fileActivity.getUser();\n+\n+                if (optionalUser.isPresent() && FileMenuFilter.isEditorAvailable(fileActivity.getContentResolver(),\n+                                                                                 optionalUser.get(),\n+                                                                                 file.getMimeType()) &&\n+                    android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {\n+                    openFileWithTextEditor(file, fileActivity);\n                 } else {\n-                    DisplayUtils.showSnackMessage(fileActivity, R.string.file_list_no_app_for_file_type);\n-                    return;\n+                    Account account = fileActivity.getAccount();\n+                    OCCapability capability = fileActivity.getStorageManager().getCapability(account.name);\n+                    if (capability.getRichDocumentsMimeTypeList().contains(file.getMimeType()) &&\n+                        android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP &&\n+                        capability.getRichDocumentsDirectEditing().isTrue()) {\n+                        openFileAsRichDocument(file, fileActivity);\n+                        return;\n+                    } else {\n+                        DisplayUtils.showSnackMessage(fileActivity, R.string.file_list_no_app_for_file_type);\n+                        return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3f3b98be0c89dfb14a7d7b645fa113c9a140ac9"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM4MTc3NQ==", "bodyText": "They are, otherwise the next block starting at Line 305 will be executed.", "url": "https://github.com/nextcloud/android/pull/5775#discussion_r400381775", "createdAt": "2020-03-30T17:51:37Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/owncloud/android/ui/helpers/FileOperationsHelper.java", "diffHunk": "@@ -278,16 +280,25 @@ public void openFile(OCFile file) {\n                     queryIntentActivities(openFileWithIntent, PackageManager.GET_RESOLVED_FILTER);\n \n             if (launchables.isEmpty()) {\n-                Account account = fileActivity.getAccount();\n-                OCCapability capability = fileActivity.getStorageManager().getCapability(account.name);\n-                if (capability.getRichDocumentsMimeTypeList().contains(file.getMimeType()) &&\n-                    android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP &&\n-                    capability.getRichDocumentsDirectEditing().isTrue()) {\n-                    openFileAsRichDocument(file, fileActivity);\n-                    return;\n+                Optional<User> optionalUser = fileActivity.getUser();\n+\n+                if (optionalUser.isPresent() && FileMenuFilter.isEditorAvailable(fileActivity.getContentResolver(),\n+                                                                                 optionalUser.get(),\n+                                                                                 file.getMimeType()) &&\n+                    android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {\n+                    openFileWithTextEditor(file, fileActivity);\n                 } else {\n-                    DisplayUtils.showSnackMessage(fileActivity, R.string.file_list_no_app_for_file_type);\n-                    return;\n+                    Account account = fileActivity.getAccount();\n+                    OCCapability capability = fileActivity.getStorageManager().getCapability(account.name);\n+                    if (capability.getRichDocumentsMimeTypeList().contains(file.getMimeType()) &&\n+                        android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP &&\n+                        capability.getRichDocumentsDirectEditing().isTrue()) {\n+                        openFileAsRichDocument(file, fileActivity);\n+                        return;\n+                    } else {\n+                        DisplayUtils.showSnackMessage(fileActivity, R.string.file_list_no_app_for_file_type);\n+                        return;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI3MzkyNw=="}, "originalCommit": {"oid": "d3f3b98be0c89dfb14a7d7b645fa113c9a140ac9"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM5MDMzMA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/nextcloud/android/pull/5775#discussion_r400390330", "createdAt": "2020-03-30T18:05:31Z", "author": {"login": "AndyScherzinger"}, "path": "src/main/java/com/owncloud/android/ui/helpers/FileOperationsHelper.java", "diffHunk": "@@ -278,16 +280,25 @@ public void openFile(OCFile file) {\n                     queryIntentActivities(openFileWithIntent, PackageManager.GET_RESOLVED_FILTER);\n \n             if (launchables.isEmpty()) {\n-                Account account = fileActivity.getAccount();\n-                OCCapability capability = fileActivity.getStorageManager().getCapability(account.name);\n-                if (capability.getRichDocumentsMimeTypeList().contains(file.getMimeType()) &&\n-                    android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP &&\n-                    capability.getRichDocumentsDirectEditing().isTrue()) {\n-                    openFileAsRichDocument(file, fileActivity);\n-                    return;\n+                Optional<User> optionalUser = fileActivity.getUser();\n+\n+                if (optionalUser.isPresent() && FileMenuFilter.isEditorAvailable(fileActivity.getContentResolver(),\n+                                                                                 optionalUser.get(),\n+                                                                                 file.getMimeType()) &&\n+                    android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {\n+                    openFileWithTextEditor(file, fileActivity);\n                 } else {\n-                    DisplayUtils.showSnackMessage(fileActivity, R.string.file_list_no_app_for_file_type);\n-                    return;\n+                    Account account = fileActivity.getAccount();\n+                    OCCapability capability = fileActivity.getStorageManager().getCapability(account.name);\n+                    if (capability.getRichDocumentsMimeTypeList().contains(file.getMimeType()) &&\n+                        android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP &&\n+                        capability.getRichDocumentsDirectEditing().isTrue()) {\n+                        openFileAsRichDocument(file, fileActivity);\n+                        return;\n+                    } else {\n+                        DisplayUtils.showSnackMessage(fileActivity, R.string.file_list_no_app_for_file_type);\n+                        return;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI3MzkyNw=="}, "originalCommit": {"oid": "d3f3b98be0c89dfb14a7d7b645fa113c9a140ac9"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3062, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}