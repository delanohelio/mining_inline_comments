{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxODIwMjI5", "number": 6997, "title": "Re-use the existing foreground notification for FileUploader progress notifications", "bodyText": "Closes #4998", "createdAt": "2020-09-23T14:24:14Z", "url": "https://github.com/nextcloud/android/pull/6997", "merged": true, "mergeCommit": {"oid": "10de2577200e7fd6477949c640b18b8c81596ff5"}, "closed": true, "closedAt": "2020-09-25T05:42:16Z", "author": {"login": "grote"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLtabmABqjM3OTg0MDU1MjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMPIZ8gFqTQ5NjEyMzY5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f6bb199aed4f536fc2be2bd63c5de179ae2949af", "author": {"user": {"login": "grote", "name": "Torsten Grote"}}, "url": "https://github.com/nextcloud/android/commit/f6bb199aed4f536fc2be2bd63c5de179ae2949af", "committedDate": "2020-09-23T14:22:45Z", "message": "Re-use the existing foreground notification for FileUploader progress\n\nnotifications"}, "afterCommit": {"oid": "7717318c8a30b8bc497f119251718f5349e26a1a", "author": {"user": {"login": "grote", "name": "Torsten Grote"}}, "url": "https://github.com/nextcloud/android/commit/7717318c8a30b8bc497f119251718f5349e26a1a", "committedDate": "2020-09-23T14:24:24Z", "message": "Re-use the existing foreground notification for FileUploader progress\n\nnotifications\n\nSigned-off-by: Torsten Grote <t@grobox.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NzIwMDIx", "url": "https://github.com/nextcloud/android/pull/6997#pullrequestreview-494720021", "createdAt": "2020-09-23T14:26:26Z", "commit": {"oid": "7717318c8a30b8bc497f119251718f5349e26a1a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNDoyNjoyNlrOHWxPOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNDoyNzo0OVrOHWxT6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzNzQzMg==", "bodyText": "This does not seem to be necessary anymore as we now cancel the notification when the service is destroyed.\nWas this maybe a relic from before using a foreground service or did you still see that the service was killed without calling onDestroy()?", "url": "https://github.com/nextcloud/android/pull/6997#discussion_r493637432", "createdAt": "2020-09-23T14:26:26Z", "author": {"login": "grote"}, "path": "src/main/java/com/owncloud/android/files/services/FileUploader.java", "diffHunk": "@@ -240,24 +240,13 @@ public void onCreate() {\n         mNotification = builder.build();\n \n         // TODO Add UploadResult.KILLED?\n-        int failedCounter = mUploadsStorageManager.failInProgressUploads(UploadResult.SERVICE_INTERRUPTED);\n-        if (failedCounter > 0) {\n-            resurrection();\n-        }\n+        mUploadsStorageManager.failInProgressUploads(UploadResult.SERVICE_INTERRUPTED);\n \n         // add AccountsUpdatedListener\n         AccountManager am = AccountManager.get(getApplicationContext());\n         am.addOnAccountsUpdatedListener(this, null, false);\n     }\n \n-    /**\n-     * Service clean-up when restarted after being killed\n-     */\n-    private void resurrection() {\n-        // remove stucked notification\n-        mNotificationManager.cancel(R.string.uploader_upload_in_progress_ticker);\n-    }\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7717318c8a30b8bc497f119251718f5349e26a1a"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzODYzMw==", "bodyText": "First, I was replacing the progress notification with the general foreground service notification here (mNotification), but that doesn't seem to be necessary as we either cancel it when the service gets destroyed or replace it with a new notification when starting the next upload.", "url": "https://github.com/nextcloud/android/pull/6997#discussion_r493638633", "createdAt": "2020-09-23T14:27:49Z", "author": {"login": "grote"}, "path": "src/main/java/com/owncloud/android/files/services/FileUploader.java", "diffHunk": "@@ -748,8 +740,6 @@ private void notifyUploadResult(UploadFileOperation upload, RemoteOperationResul\n             mNotificationManager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);\n         }\n \n-        mNotificationManager.cancel(R.string.uploader_upload_in_progress_ticker);\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7717318c8a30b8bc497f119251718f5349e26a1a"}, "originalPosition": 59}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7717318c8a30b8bc497f119251718f5349e26a1a", "author": {"user": {"login": "grote", "name": "Torsten Grote"}}, "url": "https://github.com/nextcloud/android/commit/7717318c8a30b8bc497f119251718f5349e26a1a", "committedDate": "2020-09-23T14:24:24Z", "message": "Re-use the existing foreground notification for FileUploader progress\n\nnotifications\n\nSigned-off-by: Torsten Grote <t@grobox.de>"}, "afterCommit": {"oid": "715b21420eb0ad9a904930c67361968fe18bfadb", "author": {"user": {"login": "grote", "name": "Torsten Grote"}}, "url": "https://github.com/nextcloud/android/commit/715b21420eb0ad9a904930c67361968fe18bfadb", "committedDate": "2020-09-24T07:32:24Z", "message": "Re-use the existing foreground notification for FileUploader progress\n\nnotifications\n\nSigned-off-by: Torsten Grote <t@grobox.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dc30d88ba29d670791bcbe4dc2f0eb7014c00a0", "author": {"user": {"login": "grote", "name": "Torsten Grote"}}, "url": "https://github.com/nextcloud/android/commit/6dc30d88ba29d670791bcbe4dc2f0eb7014c00a0", "committedDate": "2020-09-24T12:35:12Z", "message": "Re-use the existing foreground notification for FileUploader progress\n\nnotifications\n\nSigned-off-by: Torsten Grote <t@grobox.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "715b21420eb0ad9a904930c67361968fe18bfadb", "author": {"user": {"login": "grote", "name": "Torsten Grote"}}, "url": "https://github.com/nextcloud/android/commit/715b21420eb0ad9a904930c67361968fe18bfadb", "committedDate": "2020-09-24T07:32:24Z", "message": "Re-use the existing foreground notification for FileUploader progress\n\nnotifications\n\nSigned-off-by: Torsten Grote <t@grobox.de>"}, "afterCommit": {"oid": "6dc30d88ba29d670791bcbe4dc2f0eb7014c00a0", "author": {"user": {"login": "grote", "name": "Torsten Grote"}}, "url": "https://github.com/nextcloud/android/commit/6dc30d88ba29d670791bcbe4dc2f0eb7014c00a0", "committedDate": "2020-09-24T12:35:12Z", "message": "Re-use the existing foreground notification for FileUploader progress\n\nnotifications\n\nSigned-off-by: Torsten Grote <t@grobox.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MTIzNjk0", "url": "https://github.com/nextcloud/android/pull/6997#pullrequestreview-496123694", "createdAt": "2020-09-25T05:42:05Z", "commit": {"oid": "6dc30d88ba29d670791bcbe4dc2f0eb7014c00a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4479, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}