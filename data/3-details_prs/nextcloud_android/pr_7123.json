{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NDA1Mzkz", "number": 7123, "title": "Add status to sharee", "bodyText": "TODO\n\n base on library PR\n use Status from Library\n\nAlso moved text to two lines\n\nSigned-off-by: tobiasKaminsky tobias@kaminsky.me\nTesting\nWriting tests is very important. Please try to write some tests for your PR.\nIf you need help, please do not hesitate to ask in this PR for help.\nunit tests\ninstrumented tests\nUI tests\n\n Tests written, or not not needed", "createdAt": "2020-10-21T09:52:14Z", "url": "https://github.com/nextcloud/android/pull/7123", "merged": true, "mergeCommit": {"oid": "d09b460c842f09de0f2919ea3fd2643ec5ec7015"}, "closed": true, "closedAt": "2020-10-30T09:09:09Z", "author": {"login": "tobiasKaminsky"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUqj7zgFqTUxMzUxNzA2NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXjEORgBqjM5NDAyMzI1NzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNTE3MDY0", "url": "https://github.com/nextcloud/android/pull/7123#pullrequestreview-513517064", "createdAt": "2020-10-21T10:10:59Z", "commit": {"oid": "0748f498f99b6d463110c1462f07d954cbae2b8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMDoxMDo1OVrOHlkdpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMDoxMDo1OVrOHlkdpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE1Njc3Mw==", "bodyText": "the string-keys should be converted to constants GetShareesRemoteOperation.*", "url": "https://github.com/nextcloud/android/pull/7123#discussion_r509156773", "createdAt": "2020-10-21T10:10:59Z", "author": {"login": "AndyScherzinger"}, "path": "src/main/java/com/owncloud/android/providers/UsersAndGroupsSearchProvider.java", "diffHunk": "@@ -229,21 +243,35 @@ private Cursor searchForUsersOrGroups(Uri uri) {\n                 Iterator<JSONObject> namesIt = names.iterator();\n                 JSONObject item;\n                 String displayName;\n-                int icon = 0;\n+                String subline = null;\n+                Object icon = 0;\n                 Uri dataUri;\n                 int count = 0;\n                 while (namesIt.hasNext()) {\n                     item = namesIt.next();\n                     dataUri = null;\n                     displayName = null;\n                     String userName = item.getString(GetShareesRemoteOperation.PROPERTY_LABEL);\n+                    String name = item.isNull(\"name\") ? \"\" : item.getString(\"name\");\n                     JSONObject value = item.getJSONObject(GetShareesRemoteOperation.NODE_VALUE);\n                     ShareType type = ShareType.fromValue(value.getInt(GetShareesRemoteOperation.PROPERTY_SHARE_TYPE));\n                     String shareWith = value.getString(GetShareesRemoteOperation.PROPERTY_SHARE_WITH);\n \n+                    Status status;\n+                    JSONObject statusObject = item.optJSONObject(\"status\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0748f498f99b6d463110c1462f07d954cbae2b8f"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNTY0MTQ0", "url": "https://github.com/nextcloud/android/pull/7123#pullrequestreview-513564144", "createdAt": "2020-10-21T11:14:07Z", "commit": {"oid": "0748f498f99b6d463110c1462f07d954cbae2b8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMToxNDowN1rOHlmomg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMToxNDowN1rOHlmomg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE5MjM0Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private Paint mTextPaint;\n          \n          \n            \n                private Paint textPaint;", "url": "https://github.com/nextcloud/android/pull/7123#discussion_r509192346", "createdAt": "2020-10-21T11:14:07Z", "author": {"login": "AndyScherzinger"}, "path": "src/main/java/com/owncloud/android/ui/StatusDrawable.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ *\n+ * Nextcloud Android client application\n+ *\n+ * @author Tobias Kaminsky\n+ * Copyright (C) 2020 Tobias Kaminsky\n+ * Copyright (C) 2020 Nextcloud GmbH\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with this program. If not, see <https://www.gnu.org/licenses/>.\n+ */\n+\n+package com.owncloud.android.ui;\n+\n+import android.content.Context;\n+import android.graphics.Canvas;\n+import android.graphics.Color;\n+import android.graphics.ColorFilter;\n+import android.graphics.Paint;\n+import android.graphics.PixelFormat;\n+import android.graphics.drawable.Drawable;\n+\n+import com.owncloud.android.utils.BitmapUtils;\n+\n+import androidx.annotation.DrawableRes;\n+import androidx.annotation.NonNull;\n+import androidx.core.content.res.ResourcesCompat;\n+\n+/**\n+ * A Drawable object that draws a status\n+ */\n+public class StatusDrawable extends Drawable {\n+    private String mText = null;\n+    private @DrawableRes int icon = -1;\n+    private Paint mTextPaint;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0748f498f99b6d463110c1462f07d954cbae2b8f"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNTY0NTEy", "url": "https://github.com/nextcloud/android/pull/7123#pullrequestreview-513564512", "createdAt": "2020-10-21T11:14:36Z", "commit": {"oid": "0748f498f99b6d463110c1462f07d954cbae2b8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMToxNDozNlrOHlmprg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMToxNDozNlrOHlmprg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE5MjYyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private String mText = null;\n          \n          \n            \n                private String text = null;", "url": "https://github.com/nextcloud/android/pull/7123#discussion_r509192622", "createdAt": "2020-10-21T11:14:36Z", "author": {"login": "AndyScherzinger"}, "path": "src/main/java/com/owncloud/android/ui/StatusDrawable.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ *\n+ * Nextcloud Android client application\n+ *\n+ * @author Tobias Kaminsky\n+ * Copyright (C) 2020 Tobias Kaminsky\n+ * Copyright (C) 2020 Nextcloud GmbH\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with this program. If not, see <https://www.gnu.org/licenses/>.\n+ */\n+\n+package com.owncloud.android.ui;\n+\n+import android.content.Context;\n+import android.graphics.Canvas;\n+import android.graphics.Color;\n+import android.graphics.ColorFilter;\n+import android.graphics.Paint;\n+import android.graphics.PixelFormat;\n+import android.graphics.drawable.Drawable;\n+\n+import com.owncloud.android.utils.BitmapUtils;\n+\n+import androidx.annotation.DrawableRes;\n+import androidx.annotation.NonNull;\n+import androidx.core.content.res.ResourcesCompat;\n+\n+/**\n+ * A Drawable object that draws a status\n+ */\n+public class StatusDrawable extends Drawable {\n+    private String mText = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0748f498f99b6d463110c1462f07d954cbae2b8f"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNTY0Njc5", "url": "https://github.com/nextcloud/android/pull/7123#pullrequestreview-513564679", "createdAt": "2020-10-21T11:14:51Z", "commit": {"oid": "0748f498f99b6d463110c1462f07d954cbae2b8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMToxNDo1MVrOHlmqKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMToxNDo1MVrOHlmqKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE5Mjc0Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final Paint mBackground;\n          \n          \n            \n                private final Paint background;", "url": "https://github.com/nextcloud/android/pull/7123#discussion_r509192746", "createdAt": "2020-10-21T11:14:51Z", "author": {"login": "AndyScherzinger"}, "path": "src/main/java/com/owncloud/android/ui/StatusDrawable.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ *\n+ * Nextcloud Android client application\n+ *\n+ * @author Tobias Kaminsky\n+ * Copyright (C) 2020 Tobias Kaminsky\n+ * Copyright (C) 2020 Nextcloud GmbH\n+ *\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU Affero General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Affero General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with this program. If not, see <https://www.gnu.org/licenses/>.\n+ */\n+\n+package com.owncloud.android.ui;\n+\n+import android.content.Context;\n+import android.graphics.Canvas;\n+import android.graphics.Color;\n+import android.graphics.ColorFilter;\n+import android.graphics.Paint;\n+import android.graphics.PixelFormat;\n+import android.graphics.drawable.Drawable;\n+\n+import com.owncloud.android.utils.BitmapUtils;\n+\n+import androidx.annotation.DrawableRes;\n+import androidx.annotation.NonNull;\n+import androidx.core.content.res.ResourcesCompat;\n+\n+/**\n+ * A Drawable object that draws a status\n+ */\n+public class StatusDrawable extends Drawable {\n+    private String mText = null;\n+    private @DrawableRes int icon = -1;\n+    private Paint mTextPaint;\n+    private final Paint mBackground;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0748f498f99b6d463110c1462f07d954cbae2b8f"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNTY5MzQ0", "url": "https://github.com/nextcloud/android/pull/7123#pullrequestreview-513569344", "createdAt": "2020-10-21T11:21:23Z", "commit": {"oid": "0748f498f99b6d463110c1462f07d954cbae2b8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMToyMToyM1rOHlm4nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMToyMToyM1rOHlm4nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE5NjQ0NQ==", "bodyText": "primary_dark or primary?", "url": "https://github.com/nextcloud/android/pull/7123#discussion_r509196445", "createdAt": "2020-10-21T11:21:23Z", "author": {"login": "AndyScherzinger"}, "path": "src/main/java/com/owncloud/android/utils/BitmapUtils.java", "diffHunk": "@@ -194,12 +202,19 @@ else if (orientation == ExifInterface.ORIENTATION_ROTATE_270) {\n         return resultBitmap;\n     }\n \n-    public static Color usernameToColor(String name) throws NoSuchAlgorithmException {\n+    public static Color usernameToColor(String name) {\n         String hash = name.toLowerCase(Locale.ROOT);\n \n         // already a md5 hash?\n         if (!hash.matches(\"([0-9a-f]{4}-?){8}$\")) {\n-            hash = md5(hash);\n+            try {\n+                hash = md5(hash);\n+            } catch (NoSuchAlgorithmException e) {\n+                int color = getResources().getColor(R.color.primary_dark);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0748f498f99b6d463110c1462f07d954cbae2b8f"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNTcxNzM0", "url": "https://github.com/nextcloud/android/pull/7123#pullrequestreview-513571734", "createdAt": "2020-10-21T11:24:42Z", "commit": {"oid": "0748f498f99b6d463110c1462f07d954cbae2b8f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMToyNDo0MlrOHlm_yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMToyNDo0MlrOHlm_yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE5ODI4Mg==", "bodyText": "I think we (still) don't prefix with ~", "url": "https://github.com/nextcloud/android/pull/7123#discussion_r509198282", "createdAt": "2020-10-21T11:24:42Z", "author": {"login": "AndyScherzinger"}, "path": "src/main/res/drawable/ic_user_status_away.xml", "diffHunk": "@@ -0,0 +1,32 @@\n+<!--\n+  ~\n+  ~ Nextcloud Android client application", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0748f498f99b6d463110c1462f07d954cbae2b8f"}, "originalPosition": 3}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4a5283f16bda7bb434b78ce906b315b4c3b385e3", "author": {"user": null}, "url": "https://github.com/nextcloud/android/commit/4a5283f16bda7bb434b78ce906b315b4c3b385e3", "committedDate": "2020-10-29T11:06:55Z", "message": "Drone: update Lint results to reflect reduced error/warning count [skip ci]\n\nSigned-off-by: nextcloud-android-bot <android@nextcloud.com>"}, "afterCommit": {"oid": "096007e27f073369a7f9869a220930248b122f1d", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/096007e27f073369a7f9869a220930248b122f1d", "committedDate": "2020-10-29T11:34:01Z", "message": "fix spotbugs & lint\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5Nzk5NDcw", "url": "https://github.com/nextcloud/android/pull/7123#pullrequestreview-519799470", "createdAt": "2020-10-29T15:36:32Z", "commit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTozNjozMlrOHqh2fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTozNjozMlrOHqh2fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDM1Njg2Mw==", "bodyText": "Codacy found an issue: Avoid instantiating FileInputStream, FileOutputStream, FileReader, or FileWriter", "url": "https://github.com/nextcloud/android/pull/7123#discussion_r514356863", "createdAt": "2020-10-29T15:36:32Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/providers/UsersAndGroupsSearchProvider.java", "diffHunk": "@@ -324,6 +374,59 @@ public int update(@NonNull Uri uri, ContentValues values, String selection, Stri\n         return 0;\n     }\n \n+    @Nullable\n+    @Override\n+    @SuppressFBWarnings(\"IOI_USE_OF_FILE_STREAM_CONSTRUCTORS\") // TODO remove with API26\n+    public ParcelFileDescriptor openFile(@NonNull Uri uri, @NonNull String mode) throws FileNotFoundException {\n+        ArbitraryDataProvider arbitraryDataProvider = new ArbitraryDataProvider(getContext().getContentResolver());\n+\n+        String userId = uri.getQueryParameter(\"shareWith\");\n+        String displayName = uri.getQueryParameter(\"displayName\");\n+        String accountName = accountManager.getUser().getAccountName();\n+        String serverName = accountName.substring(accountName.lastIndexOf('@') + 1);\n+\n+        String eTag = arbitraryDataProvider.getValue(userId + \"@\" + serverName, ThumbnailsCacheManager.AVATAR);\n+        String avatarKey = \"a_\" + userId + \"_\" + serverName + \"_\" + eTag;\n+\n+        StatusType status = StatusType.valueOf(uri.getQueryParameter(\"status\"));\n+        String icon = uri.getQueryParameter(\"icon\");\n+\n+        Bitmap avatarBitmap = ThumbnailsCacheManager.getBitmapFromDiskCache(avatarKey);\n+\n+        if (avatarBitmap == null) {\n+            float avatarRadius = getContext().getResources().getDimension(R.dimen.list_item_avatar_icon_radius);\n+            avatarBitmap = BitmapUtils.drawableToBitmap(TextDrawable.createNamedAvatar(displayName, avatarRadius));\n+        }\n+\n+        Bitmap avatar = BitmapUtils.createAvatarWithStatus(avatarBitmap, status, icon, getContext());\n+\n+        // create a file to write bitmap data\n+        File f = new File(getContext().getCacheDir(), \"test\");\n+        try {\n+            if (!f.createNewFile()) {\n+                throw new IllegalStateException(\"File could not be created!\");\n+            }\n+\n+            //Convert bitmap to byte array\n+            ByteArrayOutputStream bos = new ByteArrayOutputStream();\n+\n+            avatar.compress(Bitmap.CompressFormat.PNG, 90, bos);\n+            byte[] bitmapData = bos.toByteArray();\n+\n+            //write the bytes in file\n+            try (FileOutputStream fos = new FileOutputStream(f)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "originalPosition": 238}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5Nzk5NDgz", "url": "https://github.com/nextcloud/android/pull/7123#pullrequestreview-519799483", "createdAt": "2020-10-29T15:36:33Z", "commit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTozNjozM1rOHqh2iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTozNjozM1rOHqh2iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDM1Njg3NQ==", "bodyText": "Codacy found an issue: Avoid instantiating new objects inside loops", "url": "https://github.com/nextcloud/android/pull/7123#discussion_r514356875", "createdAt": "2020-10-29T15:36:33Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/providers/UsersAndGroupsSearchProvider.java", "diffHunk": "@@ -229,21 +244,37 @@ private Cursor searchForUsersOrGroups(Uri uri) {\n                 Iterator<JSONObject> namesIt = names.iterator();\n                 JSONObject item;\n                 String displayName;\n-                int icon = 0;\n+                String subline = null;\n+                Object icon = 0;\n                 Uri dataUri;\n                 int count = 0;\n                 while (namesIt.hasNext()) {\n                     item = namesIt.next();\n                     dataUri = null;\n                     displayName = null;\n                     String userName = item.getString(GetShareesRemoteOperation.PROPERTY_LABEL);\n+                    String name = item.isNull(\"name\") ? \"\" : item.getString(\"name\");\n                     JSONObject value = item.getJSONObject(GetShareesRemoteOperation.NODE_VALUE);\n                     ShareType type = ShareType.fromValue(value.getInt(GetShareesRemoteOperation.PROPERTY_SHARE_TYPE));\n                     String shareWith = value.getString(GetShareesRemoteOperation.PROPERTY_SHARE_WITH);\n \n+                    Status status;\n+                    JSONObject statusObject = item.optJSONObject(PROPERTY_STATUS);\n+\n+                    if (statusObject != null) {\n+                        status = new Status(\n+                            StatusType.valueOf(statusObject.getString(PROPERTY_STATUS)),\n+                            statusObject.isNull(PROPERTY_MESSAGE) ? \"\" : statusObject.getString(PROPERTY_MESSAGE),\n+                            statusObject.isNull(PROPERTY_ICON) ? \"\" : statusObject.getString(PROPERTY_ICON),\n+                            statusObject.isNull(PROPERTY_CLEAR_AT) ? -1 : statusObject.getInt(PROPERTY_CLEAR_AT)\n+                        );\n+                    } else {\n+                        status = new Status(StatusType.OFFLINE, \"\", \"\", -1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "originalPosition": 120}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5Nzk5NTAx", "url": "https://github.com/nextcloud/android/pull/7123#pullrequestreview-519799501", "createdAt": "2020-10-29T15:36:34Z", "commit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTozNjozNFrOHqh2lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTozNjozNFrOHqh2lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDM1Njg4Ng==", "bodyText": "Codacy found an issue: Avoid using redundant field initializer for 'bigText'", "url": "https://github.com/nextcloud/android/pull/7123#discussion_r514356886", "createdAt": "2020-10-29T15:36:34Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/ui/TextDrawable.java", "diffHunk": "@@ -65,6 +64,8 @@\n      */\n     private float mRadius;\n \n+    private boolean bigText = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5Nzk5NTIw", "url": "https://github.com/nextcloud/android/pull/7123#pullrequestreview-519799520", "createdAt": "2020-10-29T15:36:35Z", "commit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTozNjozNVrOHqh2og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTozNjozNVrOHqh2og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDM1Njg5OA==", "bodyText": "Codacy found an issue: Assigning an Object to null is a code smell.  Consider refactoring.", "url": "https://github.com/nextcloud/android/pull/7123#discussion_r514356898", "createdAt": "2020-10-29T15:36:35Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/utils/BitmapUtils.java", "diffHunk": "@@ -384,6 +414,90 @@ public static void setRoundedBitmapForGridMode(Bitmap thumbnail, ImageView image\n                                      imageView);\n     }\n \n+    public static Bitmap createAvatarWithStatus(Bitmap avatar, StatusType status, String icon, Context context) {\n+        float avatarRadius = getResources().getDimension(R.dimen.list_item_avatar_icon_radius);\n+        int width = DisplayUtils.convertDpToPixel(2 * avatarRadius, context);\n+\n+        Bitmap output = Bitmap.createBitmap(width, width, Bitmap.Config.ARGB_8888);\n+        Canvas canvas = new Canvas(output);\n+\n+        // avatar\n+        Bitmap croppedBitmap = getCroppedBitmap(avatar, width);\n+\n+        canvas.drawBitmap(croppedBitmap, 0f, 0f, null);\n+\n+        // status\n+        int statusSize = width / 4;\n+\n+        StatusDrawable statusDrawable;\n+        if (TextUtils.isEmpty(icon)) {\n+            switch (status) {\n+                case DND:\n+                    statusDrawable = new StatusDrawable(R.drawable.ic_user_status_dnd, statusSize, context);\n+                    statusDrawable.setBounds(width / 2,\n+                                             width / 2,\n+                                             width,\n+                                             width);\n+                    break;\n+\n+                case ONLINE:\n+                    statusDrawable = new StatusDrawable(new Color(255, 73, 179, 130), statusSize);\n+                    statusDrawable.setBounds(width,\n+                                             width,\n+                                             width,\n+                                             width);\n+                    break;\n+\n+                case AWAY:\n+                    statusDrawable = new StatusDrawable(R.drawable.ic_user_status_away, statusSize, context);\n+                    statusDrawable.setBounds(width / 2,\n+                                             width / 2,\n+                                             width,\n+                                             width);\n+                    break;\n+\n+                default:\n+                    // do not show\n+                    statusDrawable = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "originalPosition": 139}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5Nzk5NTM1", "url": "https://github.com/nextcloud/android/pull/7123#pullrequestreview-519799535", "createdAt": "2020-10-29T15:36:36Z", "commit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTozNjozNlrOHqh2qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTozNjozNlrOHqh2qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDM1NjkwNw==", "bodyText": "Codacy found an issue: Avoid instantiating new objects inside loops", "url": "https://github.com/nextcloud/android/pull/7123#discussion_r514356907", "createdAt": "2020-10-29T15:36:36Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/providers/UsersAndGroupsSearchProvider.java", "diffHunk": "@@ -229,21 +244,37 @@ private Cursor searchForUsersOrGroups(Uri uri) {\n                 Iterator<JSONObject> namesIt = names.iterator();\n                 JSONObject item;\n                 String displayName;\n-                int icon = 0;\n+                String subline = null;\n+                Object icon = 0;\n                 Uri dataUri;\n                 int count = 0;\n                 while (namesIt.hasNext()) {\n                     item = namesIt.next();\n                     dataUri = null;\n                     displayName = null;\n                     String userName = item.getString(GetShareesRemoteOperation.PROPERTY_LABEL);\n+                    String name = item.isNull(\"name\") ? \"\" : item.getString(\"name\");\n                     JSONObject value = item.getJSONObject(GetShareesRemoteOperation.NODE_VALUE);\n                     ShareType type = ShareType.fromValue(value.getInt(GetShareesRemoteOperation.PROPERTY_SHARE_TYPE));\n                     String shareWith = value.getString(GetShareesRemoteOperation.PROPERTY_SHARE_WITH);\n \n+                    Status status;\n+                    JSONObject statusObject = item.optJSONObject(PROPERTY_STATUS);\n+\n+                    if (statusObject != null) {\n+                        status = new Status(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "originalPosition": 113}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5Nzk5NTQ4", "url": "https://github.com/nextcloud/android/pull/7123#pullrequestreview-519799548", "createdAt": "2020-10-29T15:36:37Z", "commit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTozNjozN1rOHqh2tQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTozNjozN1rOHqh2tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDM1NjkxNw==", "bodyText": "Codacy found an issue: Assigning an Object to null is a code smell.  Consider refactoring.", "url": "https://github.com/nextcloud/android/pull/7123#discussion_r514356917", "createdAt": "2020-10-29T15:36:37Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/providers/UsersAndGroupsSearchProvider.java", "diffHunk": "@@ -254,30 +285,48 @@ private Cursor searchForUsersOrGroups(Uri uri) {\n                                 dataUri = Uri.withAppendedPath(remoteBaseUri, shareWith);\n \n                                 if (userName.equals(shareWith)) {\n-                                    displayName = getContext().getString(R.string.share_remote_clarification, userName);\n+                                    displayName = name;\n+                                    subline = getContext().getString(R.string.remote);\n                                 } else {\n                                     String[] uriSplitted = shareWith.split(\"@\");\n-                                    displayName = getContext().getString(R.string.share_known_remote_clarification,\n-                                                                         userName, uriSplitted[uriSplitted.length - 1]);\n+                                    displayName = name;\n+                                    subline = getContext().getString(R.string.share_known_remote_on_clarification,\n+                                                                     uriSplitted[uriSplitted.length - 1]);\n                                 }\n                             }\n                             break;\n \n                         case USER:\n                             displayName = userName;\n-                            icon = R.drawable.ic_user;\n+                            subline = (status.getMessage() == null || status.getMessage().isEmpty()) ? null :", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "originalPosition": 151}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5Nzk5NTU3", "url": "https://github.com/nextcloud/android/pull/7123#pullrequestreview-519799557", "createdAt": "2020-10-29T15:36:38Z", "commit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTozNjozOFrOHqh2uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxNTozNjozOFrOHqh2uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDM1NjkyMA==", "bodyText": "Codacy found an issue: Useless parentheses.", "url": "https://github.com/nextcloud/android/pull/7123#discussion_r514356920", "createdAt": "2020-10-29T15:36:38Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/providers/UsersAndGroupsSearchProvider.java", "diffHunk": "@@ -254,30 +285,48 @@ private Cursor searchForUsersOrGroups(Uri uri) {\n                                 dataUri = Uri.withAppendedPath(remoteBaseUri, shareWith);\n \n                                 if (userName.equals(shareWith)) {\n-                                    displayName = getContext().getString(R.string.share_remote_clarification, userName);\n+                                    displayName = name;\n+                                    subline = getContext().getString(R.string.remote);\n                                 } else {\n                                     String[] uriSplitted = shareWith.split(\"@\");\n-                                    displayName = getContext().getString(R.string.share_known_remote_clarification,\n-                                                                         userName, uriSplitted[uriSplitted.length - 1]);\n+                                    displayName = name;\n+                                    subline = getContext().getString(R.string.share_known_remote_on_clarification,\n+                                                                     uriSplitted[uriSplitted.length - 1]);\n                                 }\n                             }\n                             break;\n \n                         case USER:\n                             displayName = userName;\n-                            icon = R.drawable.ic_user;\n+                            subline = (status.getMessage() == null || status.getMessage().isEmpty()) ? null :", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "originalPosition": 151}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5OTk1NDY2", "url": "https://github.com/nextcloud/android/pull/7123#pullrequestreview-519995466", "createdAt": "2020-10-29T19:16:28Z", "commit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "df3da6ab8236e23a1c97e1a29469f652db4f7f57", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/df3da6ab8236e23a1c97e1a29469f652db4f7f57", "committedDate": "2020-10-29T15:30:07Z", "message": "add missing import\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}, "afterCommit": {"oid": "fe6a08aab4ddf45bd641f8c61fe611d10cf6cdd1", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/fe6a08aab4ddf45bd641f8c61fe611d10cf6cdd1", "committedDate": "2020-10-29T19:22:38Z", "message": "add missing import\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "45df8509e2d04b4ecbc870c5bb6f3d0c03fd9716", "author": {"user": {"login": "AndyScherzinger", "name": "Andy Scherzinger"}}, "url": "https://github.com/nextcloud/android/commit/45df8509e2d04b4ecbc870c5bb6f3d0c03fd9716", "committedDate": "2020-10-29T21:57:08Z", "message": "add dark screenshots\n\nSigned-off-by: Andy Scherzinger <info@andy-scherzinger.de>"}, "afterCommit": {"oid": "e6d3563c733a1b682b65f1c6b111baac1c15a223", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/e6d3563c733a1b682b65f1c6b111baac1c15a223", "committedDate": "2020-10-30T06:52:03Z", "message": "changes after rebase\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b0912f09b99e29da88d0cbf443c4da652578497", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/7b0912f09b99e29da88d0cbf443c4da652578497", "committedDate": "2020-10-30T07:03:03Z", "message": "changes after rebase\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}, "afterCommit": {"oid": "390a314297d65fa58b9feee7928a33c14d7630bf", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/390a314297d65fa58b9feee7928a33c14d7630bf", "committedDate": "2020-10-30T07:14:10Z", "message": "changes after rebase\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfb3778a9ad02fc1d4ba700560989ae4b3def18b", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/cfb3778a9ad02fc1d4ba700560989ae4b3def18b", "committedDate": "2020-10-30T08:20:02Z", "message": "Use status from lib\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "540285560acaa41c75c60f134c90e273f6c5c9ae", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/540285560acaa41c75c60f134c90e273f6c5c9ae", "committedDate": "2020-10-30T08:20:03Z", "message": "use primarey\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "640820826f0d2242057a60c2b33320704daf7f5d", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/640820826f0d2242057a60c2b33320704daf7f5d", "committedDate": "2020-10-30T08:20:03Z", "message": "changes after rebase\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "390a314297d65fa58b9feee7928a33c14d7630bf", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/390a314297d65fa58b9feee7928a33c14d7630bf", "committedDate": "2020-10-30T07:14:10Z", "message": "changes after rebase\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}, "afterCommit": {"oid": "b3762366947dbb778fa36b58a96215fd40fecd6b", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/b3762366947dbb778fa36b58a96215fd40fecd6b", "committedDate": "2020-10-30T08:20:35Z", "message": "changes after rebase\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d79b79685cc41f5f04e28b02ead867e998d67e4", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/3d79b79685cc41f5f04e28b02ead867e998d67e4", "committedDate": "2020-10-30T09:08:36Z", "message": "changes after rebase\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b3762366947dbb778fa36b58a96215fd40fecd6b", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/b3762366947dbb778fa36b58a96215fd40fecd6b", "committedDate": "2020-10-30T08:20:35Z", "message": "changes after rebase\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}, "afterCommit": {"oid": "3d79b79685cc41f5f04e28b02ead867e998d67e4", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/3d79b79685cc41f5f04e28b02ead867e998d67e4", "committedDate": "2020-10-30T09:08:36Z", "message": "changes after rebase\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4443, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}