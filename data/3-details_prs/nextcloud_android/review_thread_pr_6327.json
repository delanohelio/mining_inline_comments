{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NzY0ODEz", "number": 6327, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMToyNjo1N1rOEHiDrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMTozMToxNlrOEHiIdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzMzNDg3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/owncloud/android/ui/activity/FileActivity.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMToyNjo1N1rOGm8nNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMToyNjo1N1rOGm8nNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ5MjE0OQ==", "bodyText": "this identation seems wrong", "url": "https://github.com/nextcloud/android/pull/6327#discussion_r443492149", "createdAt": "2020-06-22T11:26:57Z", "author": {"login": "AndyScherzinger"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileActivity.java", "diffHunk": "@@ -377,10 +391,24 @@ public void onRemoteOperationFinish(RemoteOperation operation, RemoteOperationRe\n \n             } else {\n                 DisplayUtils.showSnackMessage(\n-                        this, ErrorMessageAdapter.getErrorCauseMessage(result, operation, getResources())\n-                );\n+                    this, ErrorMessageAdapter.getErrorCauseMessage(result, operation, getResources())\n+                                             );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd0a51f442b9ab9bfd06ec9b2bea912e9eb41191"}, "originalPosition": 65}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2MzM0NzExOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/owncloud/android/ui/activity/FileActivity.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMTozMToxNlrOGm8u4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQxMTozMToxNlrOGm8u4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ5NDExMg==", "bodyText": "also see below, this is a naming pattern and should thus be extracted to a separate method", "url": "https://github.com/nextcloud/android/pull/6327#discussion_r443494112", "createdAt": "2020-06-22T11:31:16Z", "author": {"login": "AndyScherzinger"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileActivity.java", "diffHunk": "@@ -720,4 +749,170 @@ public static void showShareLinkDialog(FileActivity activity, OCFile file, Strin\n         DialogFragment chooserDialog = ShareLinkToDialog.newInstance(intentToShareLink, packagesToExclude);\n         chooserDialog.show(activity.getSupportFragmentManager(), FileDisplayActivity.FTAG_CHOOSER_DIALOG);\n     }\n+\n+    private void onUpdateNoteForShareOperationFinish(RemoteOperationResult result) {\n+        FileDetailSharingFragment sharingFragment = getShareFileFragment();\n+\n+        if (result.isSuccess()) {\n+            if (sharingFragment != null) {\n+                sharingFragment.refreshPublicShareFromDB();\n+                sharingFragment.onUpdateShareInformation(result, getFile());\n+            }\n+        } else {\n+            DisplayUtils.showSnackMessage(this, R.string.note_could_not_sent);\n+        }\n+    }\n+\n+    private void onUpdateShareInformation(RemoteOperationResult result, @StringRes int defaultError) {\n+        Snackbar snackbar;\n+        FileDetailSharingFragment sharingFragment = getShareFileFragment();\n+\n+        if (result.isSuccess()) {\n+            updateFileFromDB();\n+            if (sharingFragment != null) {\n+                sharingFragment.onUpdateShareInformation(result, getFile());\n+            }\n+        } else if (sharingFragment != null && sharingFragment.getView() != null) {\n+            String errorResponse;\n+\n+            if (result.getData() != null && result.getData().size() > 0) {\n+                errorResponse = result.getData().get(0).toString();\n+            } else {\n+                errorResponse = \"\";\n+            }\n+\n+            if (!TextUtils.isEmpty(errorResponse)) {\n+                snackbar = Snackbar.make(sharingFragment.getView(), errorResponse, Snackbar.LENGTH_LONG);\n+            } else {\n+                snackbar = Snackbar.make(sharingFragment.getView(), defaultError, Snackbar.LENGTH_LONG);\n+            }\n+\n+            ThemeUtils.colorSnackbar(this, snackbar);\n+            snackbar.show();\n+        }\n+    }\n+\n+    private void onCreateShareViaLinkOperationFinish(CreateShareViaLinkOperation operation,\n+                                                     RemoteOperationResult result) {\n+        FileDetailSharingFragment sharingFragment = getShareFileFragment();\n+\n+        if (sharingFragment == null) {\n+            Log_OC.e(this, \"Access to non-existing file FileDetailSharingFragment\");\n+            return;\n+        }\n+\n+        if (result.isSuccess()) {\n+            updateFileFromDB();\n+\n+            // if share to user and share via link multiple ocshares are returned,\n+            // therefore filtering for public_link\n+            String link = \"\";\n+            OCFile file = null;\n+            for (Object object : result.getData()) {\n+                OCShare shareLink = (OCShare) object;\n+                if (TAG_PUBLIC_LINK.equalsIgnoreCase(shareLink.getShareType().name())) {\n+                    link = shareLink.getShareLink();\n+                    file = getStorageManager().getFileByPath(shareLink.getPath());\n+                    break;\n+                }\n+            }\n+\n+            copyAndShareFileLink(this, file, link);\n+\n+            sharingFragment.refreshPublicShareFromDB();\n+            sharingFragment.onUpdateShareInformation(result, getFile());\n+        } else {\n+            // Detect Failure (403) --> maybe needs password\n+            String password = operation.getPassword();\n+            if (result.getCode() == RemoteOperationResult.ResultCode.SHARE_FORBIDDEN &&\n+                TextUtils.isEmpty(password) &&\n+                getCapabilities().getFilesSharingPublicEnabled().isUnknown()) {\n+                // Was tried without password, but not sure that it's optional.\n+\n+                // Try with password before giving up; see also ShareFileFragment#OnShareViaLinkListener\n+                if (sharingFragment.isAdded()) { // only if added to the view hierarchy\n+\n+                    sharingFragment.requestPasswordForShareViaLink(true,\n+                                                                   getCapabilities().getFilesSharingPublicAskForOptionalPassword()\n+                                                                       .isTrue());\n+                }\n+\n+            } else {\n+                sharingFragment.refreshPublicShareFromDB();\n+                Snackbar snackbar = Snackbar.make(findViewById(android.R.id.content),\n+                                                  ErrorMessageAdapter.getErrorCauseMessage(result,\n+                                                                                           operation,\n+                                                                                           getResources()),\n+                                                  Snackbar.LENGTH_LONG);\n+                ThemeUtils.colorSnackbar(this, snackbar);\n+                snackbar.show();\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Shortcut to get access to the {@link FileDetailSharingFragment} instance, if any\n+     *\n+     * @return A {@link FileDetailSharingFragment} instance, or null\n+     */\n+    private @Nullable\n+    FileDetailSharingFragment getShareFileFragment() {\n+        Fragment fragment = getSupportFragmentManager().findFragmentByTag(ShareActivity.TAG_SHARE_FRAGMENT);\n+\n+        if (fragment == null) {\n+            fragment = getSupportFragmentManager().findFragmentByTag(TAG_SECOND_FRAGMENT);\n+        }\n+\n+        if (fragment instanceof FileDetailSharingFragment) {\n+            return (FileDetailSharingFragment) fragment;\n+        } else if (fragment instanceof FileDetailFragment) {\n+            FileDetailFragment fileDetailFragment = (FileDetailFragment) fragment;\n+            return fileDetailFragment.getFileDetailSharingFragment();\n+        } else {\n+            return null;\n+        }\n+    }\n+\n+    @Override\n+    protected void onNewIntent(Intent intent) {\n+        super.onNewIntent(intent);\n+\n+        if (UsersAndGroupsSearchProvider.ACTION_SHARE_WITH.equals(intent.getAction())) {\n+            Uri data = intent.getData();\n+            String dataString = intent.getDataString();\n+            String shareWith = dataString.substring(dataString.lastIndexOf('/') + 1);\n+\n+            ArrayList<String> existingSharees = new ArrayList<>();\n+            for (OCShare share : getStorageManager().getSharesWithForAFile(getFile().getRemotePath(),\n+                                                                           getAccount().name)) {\n+                existingSharees.add(share.getShareType() + \"_\" + share.getShareWith());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd0a51f442b9ab9bfd06ec9b2bea912e9eb41191"}, "originalPosition": 235}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3348, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}