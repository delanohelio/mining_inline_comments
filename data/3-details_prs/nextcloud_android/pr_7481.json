{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3MjI5NzQ4", "number": 7481, "title": "Fix edge case when app is restored during backup and storage path does not exist", "bodyText": "Fix #4151\nSigned-off-by: tobiasKaminsky tobias@kaminsky.me\nTesting\nWriting tests is very important. Please try to write some tests for your PR.\nIf you need help, please do not hesitate to ask in this PR for help.\nunit tests\ninstrumented tests\nUI tests\n\n Tests written, or not not needed", "createdAt": "2020-11-25T07:02:41Z", "url": "https://github.com/nextcloud/android/pull/7481", "merged": true, "mergeCommit": {"oid": "3d47ce579c5895873b3cbd012adbe8636ed0b6ef"}, "closed": true, "closedAt": "2020-12-07T16:40:11Z", "author": {"login": "tobiasKaminsky"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhskmQAFqTUzODIxNTMzNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj2RX1ABqjQwNzk4NzM0ODc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4MjE1MzM1", "url": "https://github.com/nextcloud/android/pull/7481#pullrequestreview-538215335", "createdAt": "2020-11-25T07:26:20Z", "commit": {"oid": "85ba950ea1af4d2816120b711ad5350fa014483c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwNzoyNjoyMFrOH5mIXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQwNzoyNjoyMFrOH5mIXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE1NTYxMg==", "bodyText": "do we need some negative button tinting here (needs to be done after show() else negativeButton will return as null)?", "url": "https://github.com/nextcloud/android/pull/7481#discussion_r530155612", "createdAt": "2020-11-25T07:26:20Z", "author": {"login": "AndyScherzinger"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -272,14 +274,38 @@ protected void onCreate(Bundle savedInstanceState) {\n         if (taskRetainerFragment == null) {\n             taskRetainerFragment = new TaskRetainerFragment();\n             fm.beginTransaction()\n-                    .add(taskRetainerFragment, TaskRetainerFragment.FTAG_TASK_RETAINER_FRAGMENT).commit();\n+                .add(taskRetainerFragment, TaskRetainerFragment.FTAG_TASK_RETAINER_FRAGMENT).commit();\n         }   // else, Fragment already created and retained across configuration change\n \n         if (Intent.ACTION_VIEW.equals(getIntent().getAction())) {\n             handleOpenFileViaIntent(getIntent());\n         }\n \n         mPlayerConnection = new PlayerServiceConnection(this);\n+\n+        checkStoragePath();\n+    }\n+\n+    private void checkStoragePath() {\n+        String newStorage = Environment.getExternalStorageDirectory().getAbsolutePath();\n+        String storagePath = preferences.getStoragePath(newStorage);\n+        if (!preferences.isStoragePathValid() && !new File(storagePath).exists()) {\n+            // falling back to default\n+            preferences.setStoragePath(newStorage);\n+            preferences.setStoragePathValid();\n+            MainApp.setStoragePath(newStorage);\n+\n+            try {\n+                new AlertDialog.Builder(this, R.style.Theme_ownCloud_Dialog)\n+                    .setTitle(R.string.wrong_storage_path)\n+                    .setMessage(R.string.wrong_storage_path_desc)\n+                    .setNegativeButton(R.string.dialog_close, (dialog, which) -> dialog.dismiss())\n+                    .setIcon(R.drawable.ic_settings)\n+                    .show();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85ba950ea1af4d2816120b711ad5350fa014483c"}, "originalPosition": 48}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "85ba950ea1af4d2816120b711ad5350fa014483c", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/85ba950ea1af4d2816120b711ad5350fa014483c", "committedDate": "2020-11-25T07:02:12Z", "message": "Fix edge case when app is restored during backup and storage path does not exist\nFix #4151\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}, "afterCommit": {"oid": "9ffe67931fa2e6084096249992afec79ba6836cb", "author": {"user": {"login": "AndyScherzinger", "name": "Andy Scherzinger"}}, "url": "https://github.com/nextcloud/android/commit/9ffe67931fa2e6084096249992afec79ba6836cb", "committedDate": "2020-12-07T10:59:24Z", "message": "add button tinting\n\nSigned-off-by: Andy Scherzinger <info@andy-scherzinger.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2MDM5MzE0", "url": "https://github.com/nextcloud/android/pull/7481#pullrequestreview-546039314", "createdAt": "2020-12-07T11:00:20Z", "commit": {"oid": "9ffe67931fa2e6084096249992afec79ba6836cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "975841735b4d2c5e46d92d48f2923a36bce2ffaa", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/975841735b4d2c5e46d92d48f2923a36bce2ffaa", "committedDate": "2020-12-07T14:17:39Z", "message": "Fix edge case when app is restored during backup and storage path does not exist\nFix #4151\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d35868f514f14605831b7dee824c5cf3960a5fe", "author": {"user": {"login": "AndyScherzinger", "name": "Andy Scherzinger"}}, "url": "https://github.com/nextcloud/android/commit/1d35868f514f14605831b7dee824c5cf3960a5fe", "committedDate": "2020-12-07T14:17:50Z", "message": "add button tinting\n\nSigned-off-by: Andy Scherzinger <info@andy-scherzinger.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ffe67931fa2e6084096249992afec79ba6836cb", "author": {"user": {"login": "AndyScherzinger", "name": "Andy Scherzinger"}}, "url": "https://github.com/nextcloud/android/commit/9ffe67931fa2e6084096249992afec79ba6836cb", "committedDate": "2020-12-07T10:59:24Z", "message": "add button tinting\n\nSigned-off-by: Andy Scherzinger <info@andy-scherzinger.de>"}, "afterCommit": {"oid": "1d35868f514f14605831b7dee824c5cf3960a5fe", "author": {"user": {"login": "AndyScherzinger", "name": "Andy Scherzinger"}}, "url": "https://github.com/nextcloud/android/commit/1d35868f514f14605831b7dee824c5cf3960a5fe", "committedDate": "2020-12-07T14:17:50Z", "message": "add button tinting\n\nSigned-off-by: Andy Scherzinger <info@andy-scherzinger.de>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4413, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}