{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyOTY4OTU4", "number": 5442, "title": "Fix crash during text file creation", "bodyText": "Fixes #5330\nSigned-off-by: Chris Narkiewicz hello@ezaquarii.com\nTesting\nManual test only. Create a text file, invoking template chooser dialog.", "createdAt": "2020-02-10T06:53:06Z", "url": "https://github.com/nextcloud/android/pull/5442", "merged": true, "mergeCommit": {"oid": "20b910a64643681891209bd9fb566b9e44c99216"}, "closed": true, "closedAt": "2020-02-17T09:34:28Z", "author": {"login": "ezaquarii"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcC3f7ZgBqjMwMjE1MDcyOTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFJIm1gFqTM1OTU1ODY5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f24de1fa6d859e658033d49c3de26dffe76ce3be", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/f24de1fa6d859e658033d49c3de26dffe76ce3be", "committedDate": "2020-02-10T06:52:08Z", "message": "Fix crash during text file creation\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "080d5d3bb5055f3376226d03b48b56ddd41815eb", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/080d5d3bb5055f3376226d03b48b56ddd41815eb", "committedDate": "2020-02-10T06:53:15Z", "message": "Fix crash during text file creation\n\nFixes #5330\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzE4OTYz", "url": "https://github.com/nextcloud/android/pull/5442#pullrequestreview-355718963", "createdAt": "2020-02-10T06:55:11Z", "commit": {"oid": "f24de1fa6d859e658033d49c3de26dffe76ce3be"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwNjo1NTozNlrOFnboOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwNjo1NTozNlrOFnboOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg5MTQ1MA==", "bodyText": "This is pretty common error I see. Both activities and fragments are passed as weak references to avoid leaks, but in case of fragment we must check if it has been detached.", "url": "https://github.com/nextcloud/android/pull/5442#discussion_r376891450", "createdAt": "2020-02-10T06:55:36Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/dialog/ChooseTemplateDialogFragment.java", "diffHunk": "@@ -241,35 +242,36 @@ protected String doInBackground(Void... voids) {\n                     new DirectEditingCreateFileRemoteOperation(path,\n                                                                creator.getEditor(),\n                                                                creator.getId(),\n-                                                               template.getTitle())\n-                        .execute(client);\n-\n-                if (result.isSuccess()) {\n-                    // get file\n-                    RemoteOperationResult newFileResult = new ReadFileRemoteOperation(path)\n-                            .execute(client);\n-\n-                    if (newFileResult.isSuccess()) {\n-                        OCFile temp = FileStorageUtils.fillOCFile((RemoteFile) newFileResult.getData().get(0));\n-\n-                        if (chooseTemplateDialogFragmentWeakReference.get() != null) {\n-                            FileDataStorageManager storageManager = new FileDataStorageManager(\n-                                user.toPlatformAccount(),\n-                                chooseTemplateDialogFragmentWeakReference.get().requireContext().getContentResolver());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "080d5d3bb5055f3376226d03b48b56ddd41815eb"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1ODY2OTU0", "url": "https://github.com/nextcloud/android/pull/5442#pullrequestreview-355866954", "createdAt": "2020-02-10T11:32:16Z", "commit": {"oid": "9780677626fdce6dcc21ebd23c861a04066dfdc9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMTozMjoxNlrOFniyIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxMTozMjoxNlrOFniyIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzAwODY3NQ==", "bodyText": "There is also \"isAdded\" or \"isDetached\", which we can use, or?\ngetContext is: return mHost == null ? null : mHost.getContext()\nisAdded is: return mHost != null && mAdded\nSo isAdded might even the more extensive check, or?", "url": "https://github.com/nextcloud/android/pull/5442#discussion_r377008675", "createdAt": "2020-02-10T11:32:16Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/owncloud/android/ui/dialog/ChooseTemplateDialogFragment.java", "diffHunk": "@@ -241,35 +242,36 @@ protected String doInBackground(Void... voids) {\n                     new DirectEditingCreateFileRemoteOperation(path,\n                                                                creator.getEditor(),\n                                                                creator.getId(),\n-                                                               template.getTitle())\n-                        .execute(client);\n-\n-                if (result.isSuccess()) {\n-                    // get file\n-                    RemoteOperationResult newFileResult = new ReadFileRemoteOperation(path)\n-                            .execute(client);\n-\n-                    if (newFileResult.isSuccess()) {\n-                        OCFile temp = FileStorageUtils.fillOCFile((RemoteFile) newFileResult.getData().get(0));\n-\n-                        if (chooseTemplateDialogFragmentWeakReference.get() != null) {\n-                            FileDataStorageManager storageManager = new FileDataStorageManager(\n-                                user.toPlatformAccount(),\n-                                chooseTemplateDialogFragmentWeakReference.get().requireContext().getContentResolver());\n-                            storageManager.saveFile(temp);\n-                            file = storageManager.getFileByPath(path);\n-\n-                            return result.getData().get(0).toString();\n-                        }\n-                         else {\n-                             return \"\";\n-                        }\n-                    } else {\n-                        return \"\";\n-                    }\n-                } else {\n+                                                               template.getTitle()).execute(client);\n+                if (!result.isSuccess()) {\n+                    return \"\";\n+                }\n+\n+                RemoteOperationResult newFileResult = new ReadFileRemoteOperation(path).execute(client);\n+                if (!newFileResult.isSuccess()) {\n                     return \"\";\n                 }\n+\n+                OCFile temp = FileStorageUtils.fillOCFile((RemoteFile) newFileResult.getData().get(0));\n+\n+                final ChooseTemplateDialogFragment fragment = chooseTemplateDialogFragmentWeakReference.get();\n+                if (fragment == null) {\n+                    return \"\";\n+                }\n+\n+                final Context context = fragment.getContext();\n+                if (context == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9780677626fdce6dcc21ebd23c861a04066dfdc9"}, "originalPosition": 57}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9780677626fdce6dcc21ebd23c861a04066dfdc9", "author": {"user": null}, "url": "https://github.com/nextcloud/android/commit/9780677626fdce6dcc21ebd23c861a04066dfdc9", "committedDate": "2020-02-10T07:04:34Z", "message": "Drone: update FindBugs results to reflect reduced error/warning count [skip ci]\n\nSigned-off-by: nextcloud-android-bot <android@nextcloud.com>"}, "afterCommit": {"oid": "9c9541c1d73c144742b5c94dda51f5c2e3f07ec7", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/9c9541c1d73c144742b5c94dda51f5c2e3f07ec7", "committedDate": "2020-02-13T22:08:31Z", "message": "Fix crash during text file creation\n\nFixes #5330\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9c9541c1d73c144742b5c94dda51f5c2e3f07ec7", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/9c9541c1d73c144742b5c94dda51f5c2e3f07ec7", "committedDate": "2020-02-13T22:08:31Z", "message": "Fix crash during text file creation\n\nFixes #5330\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "7583fab7e71b50c720b123ae14679ebab1eb88d6", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/7583fab7e71b50c720b123ae14679ebab1eb88d6", "committedDate": "2020-02-13T22:34:20Z", "message": "Fix crash during text file creation\n\nFixes #5330\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4ODIxMDQ1", "url": "https://github.com/nextcloud/android/pull/5442#pullrequestreview-358821045", "createdAt": "2020-02-14T09:47:36Z", "commit": {"oid": "829b3079dd6122767361c366561e2b2783c1e00d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4OTIyMTk0", "url": "https://github.com/nextcloud/android/pull/5442#pullrequestreview-358922194", "createdAt": "2020-02-14T12:57:09Z", "commit": {"oid": "829b3079dd6122767361c366561e2b2783c1e00d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0977c37916079f984d500dc700a19c76a9862d76", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/0977c37916079f984d500dc700a19c76a9862d76", "committedDate": "2020-02-17T08:30:37Z", "message": "Fix crash during text file creation\n\nFixes #5330\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "829b3079dd6122767361c366561e2b2783c1e00d", "author": {"user": null}, "url": "https://github.com/nextcloud/android/commit/829b3079dd6122767361c366561e2b2783c1e00d", "committedDate": "2020-02-13T22:47:52Z", "message": "Drone: update FindBugs results to reflect reduced error/warning count [skip ci]\n\nSigned-off-by: nextcloud-android-bot <android@nextcloud.com>"}, "afterCommit": {"oid": "0977c37916079f984d500dc700a19c76a9862d76", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/0977c37916079f984d500dc700a19c76a9862d76", "committedDate": "2020-02-17T08:30:37Z", "message": "Fix crash during text file creation\n\nFixes #5330\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NTU4Njk0", "url": "https://github.com/nextcloud/android/pull/5442#pullrequestreview-359558694", "createdAt": "2020-02-17T08:34:15Z", "commit": {"oid": "0977c37916079f984d500dc700a19c76a9862d76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwODozNDoxNVrOFqb5IQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwODozNDoxNVrOFqb5IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA0MTUwNQ==", "bodyText": "Issue found: Avoid declaring a variable if it is unreferenced before a possible exit point.", "url": "https://github.com/nextcloud/android/pull/5442#discussion_r380041505", "createdAt": "2020-02-17T08:34:15Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/ui/dialog/ChooseTemplateDialogFragment.java", "diffHunk": "@@ -241,35 +242,36 @@ protected String doInBackground(Void... voids) {\n                     new DirectEditingCreateFileRemoteOperation(path,\n                                                                creator.getEditor(),\n                                                                creator.getId(),\n-                                                               template.getTitle())\n-                        .execute(client);\n-\n-                if (result.isSuccess()) {\n-                    // get file\n-                    RemoteOperationResult newFileResult = new ReadFileRemoteOperation(path)\n-                            .execute(client);\n-\n-                    if (newFileResult.isSuccess()) {\n-                        OCFile temp = FileStorageUtils.fillOCFile((RemoteFile) newFileResult.getData().get(0));\n-\n-                        if (chooseTemplateDialogFragmentWeakReference.get() != null) {\n-                            FileDataStorageManager storageManager = new FileDataStorageManager(\n-                                user.toPlatformAccount(),\n-                                chooseTemplateDialogFragmentWeakReference.get().requireContext().getContentResolver());\n-                            storageManager.saveFile(temp);\n-                            file = storageManager.getFileByPath(path);\n-\n-                            return result.getData().get(0).toString();\n-                        }\n-                         else {\n-                             return \"\";\n-                        }\n-                    } else {\n-                        return \"\";\n-                    }\n-                } else {\n+                                                               template.getTitle()).execute(client);\n+                if (!result.isSuccess()) {\n+                    return \"\";\n+                }\n+\n+                RemoteOperationResult newFileResult = new ReadFileRemoteOperation(path).execute(client);\n+                if (!newFileResult.isSuccess()) {\n                     return \"\";\n                 }\n+\n+                OCFile temp = FileStorageUtils.fillOCFile((RemoteFile) newFileResult.getData().get(0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0977c37916079f984d500dc700a19c76a9862d76"}, "originalPosition": 49}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4790, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}