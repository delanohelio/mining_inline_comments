{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4MDk5NzMx", "number": 5345, "title": "Allows deep linking to open files", "bodyText": "Link: nc://directlink/f/{fileID} from direct linking\nResolves #2562\nSigned-off-by: Evans Jahja evansjahja13@gmail.com", "createdAt": "2020-01-28T16:09:26Z", "url": "https://github.com/nextcloud/android/pull/5345", "merged": true, "mergeCommit": {"oid": "de7b7f5c06d7c2fd98e9fe1e8f1c7df57312d47b"}, "closed": true, "closedAt": "2020-03-03T09:26:07Z", "author": {"login": "EvansJahja"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-5eudgFqTM0OTc2MzA2MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIHpfkAFqTM2NDk0NTEyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NzYzMDYx", "url": "https://github.com/nextcloud/android/pull/5345#pullrequestreview-349763061", "createdAt": "2020-01-28T22:54:59Z", "commit": {"oid": "d42bcbd88d6ca770405c534d0868e50dffe5880c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQyMjo1NDo1OVrOFi3exw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQyMjo1NDo1OVrOFi3exw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEwNDkwMw==", "bodyText": "I'm not exactly sure how this extra is set, but rewriting it before handling does not feel right. Also, I do not understand why we use last path segment as file id - is it the same thing?", "url": "https://github.com/nextcloud/android/pull/5345#discussion_r372104903", "createdAt": "2020-01-28T22:54:59Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -512,6 +512,9 @@ protected void onNewIntent(Intent intent) {\n             setFile(intent.getParcelableExtra(EXTRA_FILE));\n             showDetails(file);\n         } else if (Intent.ACTION_VIEW.equals(intent.getAction())) {\n+            if (!intent.hasExtra(KEY_FILE_ID)) {\n+                intent.putExtra(KEY_FILE_ID, intent.getData().getLastPathSegment());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d42bcbd88d6ca770405c534d0868e50dffe5880c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNTgyODUx", "url": "https://github.com/nextcloud/android/pull/5345#pullrequestreview-350582851", "createdAt": "2020-01-30T05:02:38Z", "commit": {"oid": "3108955594d231ea90a8a9d06c050161d5e0b7c5"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNjE2MjU3", "url": "https://github.com/nextcloud/android/pull/5345#pullrequestreview-352616257", "createdAt": "2020-02-03T22:43:06Z", "commit": {"oid": "3108955594d231ea90a8a9d06c050161d5e0b7c5"}, "state": "DISMISSED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QyMjo0MzowN1rOFlCk4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wM1QyMjo0NDo1NFrOFlCnjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDM4Mzg0MA==", "bodyText": "Not sure what is going on here. If you want to check if extra value is null, check usgin == operator. Using string formatting to compare string representation of objects is not how we do this in Java, which is strongly typed and don't need this kind of hacks, contrary to JavaScript.", "url": "https://github.com/nextcloud/android/pull/5345#discussion_r374383840", "createdAt": "2020-02-03T22:43:07Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -2628,8 +2628,27 @@ private void handleOpenFileViaIntent(Intent intent) {\n         showLoadingDialog(getString(R.string.retrieving_file));\n \n         String accountName = intent.getStringExtra(\"KEY_ACCOUNT\");\n+        String fileId = String.valueOf(intent.getStringExtra(KEY_FILE_ID));\n+\n+        if (accountName == null && \"null\".equals(fileId) && intent.getData() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3108955594d231ea90a8a9d06c050161d5e0b7c5"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDM4NDA0Nw==", "bodyText": "This string should be translated.", "url": "https://github.com/nextcloud/android/pull/5345#discussion_r374384047", "createdAt": "2020-02-03T22:43:37Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -2628,8 +2628,27 @@ private void handleOpenFileViaIntent(Intent intent) {\n         showLoadingDialog(getString(R.string.retrieving_file));\n \n         String accountName = intent.getStringExtra(\"KEY_ACCOUNT\");\n+        String fileId = String.valueOf(intent.getStringExtra(KEY_FILE_ID));\n+\n+        if (accountName == null && \"null\".equals(fileId) && intent.getData() != null) {\n+            // Handle intent coming from URI\n+            List<String> pathSegments = intent.getData().getPathSegments();\n+\n+            try {\n+                // Matches /{accountName}/f/{fileId}\n+                accountName = pathSegments.get(0);\n+                if (\"f\".equals(pathSegments.get(1))) {\n+                    fileId = pathSegments.get(2);\n+                }\n+            } catch (IndexOutOfBoundsException e) {\n+                dismissLoadingDialog();\n+                DisplayUtils.showSnackMessage(this, \"Invalid URL\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3108955594d231ea90a8a9d06c050161d5e0b7c5"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDM4NDUyNg==", "bodyText": "Please properly validate list size before using it. Exceptions are not meant to be used as a flow control mechanism.", "url": "https://github.com/nextcloud/android/pull/5345#discussion_r374384526", "createdAt": "2020-02-03T22:44:54Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -2628,8 +2628,27 @@ private void handleOpenFileViaIntent(Intent intent) {\n         showLoadingDialog(getString(R.string.retrieving_file));\n \n         String accountName = intent.getStringExtra(\"KEY_ACCOUNT\");\n+        String fileId = String.valueOf(intent.getStringExtra(KEY_FILE_ID));\n+\n+        if (accountName == null && \"null\".equals(fileId) && intent.getData() != null) {\n+            // Handle intent coming from URI\n+            List<String> pathSegments = intent.getData().getPathSegments();\n+\n+            try {\n+                // Matches /{accountName}/f/{fileId}\n+                accountName = pathSegments.get(0);\n+                if (\"f\".equals(pathSegments.get(1))) {\n+                    fileId = pathSegments.get(2);\n+                }\n+            } catch (IndexOutOfBoundsException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3108955594d231ea90a8a9d06c050161d5e0b7c5"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyOTIxNjE3", "url": "https://github.com/nextcloud/android/pull/5345#pullrequestreview-352921617", "createdAt": "2020-02-04T11:59:57Z", "commit": {"oid": "29999e690bd6213ebde7dd5a300c7c7557a40cd5"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyOTYyNjEz", "url": "https://github.com/nextcloud/android/pull/5345#pullrequestreview-352962613", "createdAt": "2020-02-04T13:13:05Z", "commit": {"oid": "29999e690bd6213ebde7dd5a300c7c7557a40cd5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMzoxMzowNVrOFlTg5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxMzoxMzowNVrOFlTg5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY2MTM0OA==", "bodyText": "@rullzer do you know if the directLink always contains \"index.php\" or can there be setups where no index.php is used?", "url": "https://github.com/nextcloud/android/pull/5345#discussion_r374661348", "createdAt": "2020-02-04T13:13:05Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/AndroidManifest.xml", "diffHunk": "@@ -117,6 +117,15 @@\n             <intent-filter>\n                 <action android:name=\"android.intent.action.SEARCH\" />\n             </intent-filter>\n+            <intent-filter>\n+                <action android:name=\"android.intent.action.VIEW\" />\n+                <category android:name=\"android.intent.category.DEFAULT\" />\n+                <category android:name=\"android.intent.category.BROWSABLE\" />\n+                <data android:scheme=\"http\"\n+                      android:host=\"*\"\n+                      android:pathPattern=\"/index.php/f/.*\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29999e690bd6213ebde7dd5a300c7c7557a40cd5"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjY0MzM1", "url": "https://github.com/nextcloud/android/pull/5345#pullrequestreview-353264335", "createdAt": "2020-02-04T20:04:39Z", "commit": {"oid": "29999e690bd6213ebde7dd5a300c7c7557a40cd5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDowNDozOVrOFlhtXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDowNDozOVrOFlhtXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5MzkxOQ==", "bodyText": "Maybe add an additional android:scheme=\"https\" here?\nThen it works with https links, too.", "url": "https://github.com/nextcloud/android/pull/5345#discussion_r374893919", "createdAt": "2020-02-04T20:04:39Z", "author": {"login": "szaimen"}, "path": "src/main/AndroidManifest.xml", "diffHunk": "@@ -117,6 +117,15 @@\n             <intent-filter>\n                 <action android:name=\"android.intent.action.SEARCH\" />\n             </intent-filter>\n+            <intent-filter>\n+                <action android:name=\"android.intent.action.VIEW\" />\n+                <category android:name=\"android.intent.category.DEFAULT\" />\n+                <category android:name=\"android.intent.category.BROWSABLE\" />\n+                <data android:scheme=\"http\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29999e690bd6213ebde7dd5a300c7c7557a40cd5"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MTM5MTQ5", "url": "https://github.com/nextcloud/android/pull/5345#pullrequestreview-355139149", "createdAt": "2020-02-07T13:01:07Z", "commit": {"oid": "5f7830e5132c0cce681d8b64f1883e49f7644bad"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2MzQ0Mjg4", "url": "https://github.com/nextcloud/android/pull/5345#pullrequestreview-356344288", "createdAt": "2020-02-10T23:41:07Z", "commit": {"oid": "e2ea710f5d0c4ecdaaf0f07843c726bc77e46dad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMzo0MTowOFrOFn5mag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQyMzo0MTowOFrOFn5mag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM4MjUwNg==", "bodyText": "We have discussed the format of account name extensively when trying to formalize account ID:\n#5006\nAFAIR, the conclusion was that we cannot rely on this format, but maybe we should take a step back and look at it again.\n@tobiasKaminsky @mario @AndyScherzinger", "url": "https://github.com/nextcloud/android/pull/5345#discussion_r377382506", "createdAt": "2020-02-10T23:41:08Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -2664,5 +2689,59 @@ private void handleOpenFileViaIntent(Intent intent) {\n                                                                           storageManager,\n                                                                           this);\n         fetchRemoteFileTask.execute();\n+\n+    }\n+\n+    private void findAccountAndOpenFile(String hostName, int port, String fileId) {\n+        String strPort = Integer.toString(port);\n+\n+        ArrayList<String> validAccounts = new ArrayList<>();\n+\n+        for (Account account : accountManager.getAccounts()) {\n+            String accountHostPort = account.name.split(\"@\")[1];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2ea710f5d0c4ecdaaf0f07843c726bc77e46dad"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4MzgyMzg3", "url": "https://github.com/nextcloud/android/pull/5345#pullrequestreview-358382387", "createdAt": "2020-02-13T16:50:10Z", "commit": {"oid": "891916e73a15edaa995ca579dd090e447b03bdaf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxNjo1MDoxMFrOFpbfPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxNjo1NzoyMFrOFpbwZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk4NjMwMA==", "bodyText": "Please do not use platform API. We try to get rid of it. We have our own abstraction of account: UserAccountManager and User.", "url": "https://github.com/nextcloud/android/pull/5345#discussion_r378986300", "createdAt": "2020-02-13T16:50:10Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -2664,5 +2691,48 @@ private void handleOpenFileViaIntent(Intent intent) {\n                                                                           storageManager,\n                                                                           this);\n         fetchRemoteFileTask.execute();\n+\n+    }\n+\n+    private void findAccountAndOpenFile(String scheme, String authority, String fileId) {\n+\n+        ArrayList<String> validAccounts = new ArrayList<>();\n+        String queryBaseUrl = scheme + \"://\" + authority;\n+\n+        for (Account account : accountManager.getAccounts()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "891916e73a15edaa995ca579dd090e447b03bdaf"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk4OTEwMA==", "bodyText": "I'm not sure what we do here.\nIs there any reason why we try to build the URL ourselves and then use getBaseUrlForAccount only to see if we built it correctly?", "url": "https://github.com/nextcloud/android/pull/5345#discussion_r378989100", "createdAt": "2020-02-13T16:54:47Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -2664,5 +2691,48 @@ private void handleOpenFileViaIntent(Intent intent) {\n                                                                           storageManager,\n                                                                           this);\n         fetchRemoteFileTask.execute();\n+\n+    }\n+\n+    private void findAccountAndOpenFile(String scheme, String authority, String fileId) {\n+\n+        ArrayList<String> validAccounts = new ArrayList<>();\n+        String queryBaseUrl = scheme + \"://\" + authority;\n+\n+        for (Account account : accountManager.getAccounts()) {\n+            try {\n+                if (AccountUtils.getBaseUrlForAccount(this, account).equals(queryBaseUrl)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "891916e73a15edaa995ca579dd090e447b03bdaf"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk5MDY5Mw==", "bodyText": "Please use User instead of Account.", "url": "https://github.com/nextcloud/android/pull/5345#discussion_r378990693", "createdAt": "2020-02-13T16:57:20Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -2664,5 +2691,48 @@ private void handleOpenFileViaIntent(Intent intent) {\n                                                                           storageManager,\n                                                                           this);\n         fetchRemoteFileTask.execute();\n+\n+    }\n+\n+    private void findAccountAndOpenFile(String scheme, String authority, String fileId) {\n+\n+        ArrayList<String> validAccounts = new ArrayList<>();\n+        String queryBaseUrl = scheme + \"://\" + authority;\n+\n+        for (Account account : accountManager.getAccounts()) {\n+            try {\n+                if (AccountUtils.getBaseUrlForAccount(this, account).equals(queryBaseUrl)) {\n+                    validAccounts.add(account.name);\n+                }\n+            } catch (AccountUtils.AccountNotFoundException ignored) {\n+            }\n+        }\n+\n+        if (validAccounts.size() == 0) {\n+            openFile(getAccount().name, fileId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "891916e73a15edaa995ca579dd090e447b03bdaf"}, "originalPosition": 87}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "04fc793c5b4d43ed5da61f6b9242253d1334d6c2", "author": {"user": {"login": "EvansJahja", "name": "Evans Jahja"}}, "url": "https://github.com/nextcloud/android/commit/04fc793c5b4d43ed5da61f6b9242253d1334d6c2", "committedDate": "2020-02-14T09:48:46Z", "message": "Uses getUser() instead of getAccount()\n\nSigned-off-by: Evans Jahja <evansjahja13@gmail.com>"}, "afterCommit": {"oid": "dee27b08dca211120d93033f9b013e50343e68e3", "author": {"user": {"login": "EvansJahja", "name": "Evans Jahja"}}, "url": "https://github.com/nextcloud/android/commit/dee27b08dca211120d93033f9b013e50343e68e3", "committedDate": "2020-02-14T09:55:02Z", "message": "Removes unnecessary imports\n\nSigned-off-by: Evans Jahja <evansjahja13@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5Mjc2MTAx", "url": "https://github.com/nextcloud/android/pull/5345#pullrequestreview-359276101", "createdAt": "2020-02-14T23:40:57Z", "commit": {"oid": "6d4ec4e8062a734b7bf1a0d00cd4a2424aa359cd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d06cbe27da55d91eaf302a5727ced97815ff8bca", "author": {"user": {"login": "Charon77", "name": null}}, "url": "https://github.com/nextcloud/android/commit/d06cbe27da55d91eaf302a5727ced97815ff8bca", "committedDate": "2020-02-26T13:55:19Z", "message": "Merge branch 'master' into deep_link"}, "afterCommit": {"oid": "aff6be0eb4680582b6dc45393bfdcff99bcdbe1f", "author": {"user": {"login": "EvansJahja", "name": "Evans Jahja"}}, "url": "https://github.com/nextcloud/android/commit/aff6be0eb4680582b6dc45393bfdcff99bcdbe1f", "committedDate": "2020-02-21T03:32:25Z", "message": "Limits account to have to match subdirectory, fails if account not found\n\nSigned-off-by: Evans Jahja <evansjahja13@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aff6be0eb4680582b6dc45393bfdcff99bcdbe1f", "author": {"user": {"login": "EvansJahja", "name": "Evans Jahja"}}, "url": "https://github.com/nextcloud/android/commit/aff6be0eb4680582b6dc45393bfdcff99bcdbe1f", "committedDate": "2020-02-21T03:32:25Z", "message": "Limits account to have to match subdirectory, fails if account not found\n\nSigned-off-by: Evans Jahja <evansjahja13@gmail.com>"}, "afterCommit": {"oid": "6ee7d25c54ccd6a58e2d3f951c83773243bcc6df", "author": {"user": {"login": "EvansJahja", "name": "Evans Jahja"}}, "url": "https://github.com/nextcloud/android/commit/6ee7d25c54ccd6a58e2d3f951c83773243bcc6df", "committedDate": "2020-02-26T14:22:13Z", "message": "Allows deep linking to open files\n\nSigned-off-by: Evans Jahja <evansjahja13@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0467cc37ca768f1e2d51779c1fcca739f131b14b", "author": {"user": {"login": "EvansJahja", "name": "Evans Jahja"}}, "url": "https://github.com/nextcloud/android/commit/0467cc37ca768f1e2d51779c1fcca739f131b14b", "committedDate": "2020-02-26T14:26:48Z", "message": "Allows deep linking to open files\n\nSigned-off-by: Evans Jahja <evansjahja13@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ee7d25c54ccd6a58e2d3f951c83773243bcc6df", "author": {"user": {"login": "EvansJahja", "name": "Evans Jahja"}}, "url": "https://github.com/nextcloud/android/commit/6ee7d25c54ccd6a58e2d3f951c83773243bcc6df", "committedDate": "2020-02-26T14:22:13Z", "message": "Allows deep linking to open files\n\nSigned-off-by: Evans Jahja <evansjahja13@gmail.com>"}, "afterCommit": {"oid": "0467cc37ca768f1e2d51779c1fcca739f131b14b", "author": {"user": {"login": "EvansJahja", "name": "Evans Jahja"}}, "url": "https://github.com/nextcloud/android/commit/0467cc37ca768f1e2d51779c1fcca739f131b14b", "committedDate": "2020-02-26T14:26:48Z", "message": "Allows deep linking to open files\n\nSigned-off-by: Evans Jahja <evansjahja13@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0OTQ1MTA2", "url": "https://github.com/nextcloud/android/pull/5345#pullrequestreview-364945106", "createdAt": "2020-02-26T14:32:07Z", "commit": {"oid": "0467cc37ca768f1e2d51779c1fcca739f131b14b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNDozMjowN1rOFutwGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNDozMjowN1rOFutwGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUyODQxMA==", "bodyText": "Issue found: Avoid using Literals in Conditional Statements", "url": "https://github.com/nextcloud/android/pull/5345#discussion_r384528410", "createdAt": "2020-02-26T14:32:07Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -2649,13 +2677,56 @@ private void handleOpenFileViaIntent(Intent intent) {\n         FileDataStorageManager storageManager = getStorageManager();\n \n         if (storageManager == null) {\n-            storageManager = new FileDataStorageManager(newAccount, getContentResolver());\n+            storageManager = new FileDataStorageManager(user.toPlatformAccount(), getContentResolver());\n         }\n \n-        FetchRemoteFileTask fetchRemoteFileTask = new FetchRemoteFileTask(newAccount,\n+        FetchRemoteFileTask fetchRemoteFileTask = new FetchRemoteFileTask(user.toPlatformAccount(),\n                                                                           fileId,\n                                                                           storageManager,\n                                                                           this);\n         fetchRemoteFileTask.execute();\n+\n+    }\n+\n+    private void findAccountAndOpenFile(String uri, String fileId) {\n+\n+        ArrayList<User> validUsers = new ArrayList<>();\n+\n+        for (User user : getUserAccountManager().getAllUsers()) {\n+            if (user.getServer().getUri().toString().equals(uri)) {\n+                validUsers.add(user);\n+            }\n+        }\n+\n+        if (validUsers.size() == 0) {\n+            dismissLoadingDialog();\n+            DisplayUtils.showSnackMessage(this, getString(R.string.associated_account_not_found));\n+            return;\n+        }\n+\n+        if (validUsers.size() == 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0467cc37ca768f1e2d51779c1fcca739f131b14b"}, "originalPosition": 115}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0OTQ1MTI0", "url": "https://github.com/nextcloud/android/pull/5345#pullrequestreview-364945124", "createdAt": "2020-02-26T14:32:08Z", "commit": {"oid": "0467cc37ca768f1e2d51779c1fcca739f131b14b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNDozMjowOFrOFutwKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNDozMjowOFrOFutwKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUyODQyNA==", "bodyText": "Issue found: This call to Collection.toArray() may be optimizable", "url": "https://github.com/nextcloud/android/pull/5345#discussion_r384528424", "createdAt": "2020-02-26T14:32:08Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -2649,13 +2677,56 @@ private void handleOpenFileViaIntent(Intent intent) {\n         FileDataStorageManager storageManager = getStorageManager();\n \n         if (storageManager == null) {\n-            storageManager = new FileDataStorageManager(newAccount, getContentResolver());\n+            storageManager = new FileDataStorageManager(user.toPlatformAccount(), getContentResolver());\n         }\n \n-        FetchRemoteFileTask fetchRemoteFileTask = new FetchRemoteFileTask(newAccount,\n+        FetchRemoteFileTask fetchRemoteFileTask = new FetchRemoteFileTask(user.toPlatformAccount(),\n                                                                           fileId,\n                                                                           storageManager,\n                                                                           this);\n         fetchRemoteFileTask.execute();\n+\n+    }\n+\n+    private void findAccountAndOpenFile(String uri, String fileId) {\n+\n+        ArrayList<User> validUsers = new ArrayList<>();\n+\n+        for (User user : getUserAccountManager().getAllUsers()) {\n+            if (user.getServer().getUri().toString().equals(uri)) {\n+                validUsers.add(user);\n+            }\n+        }\n+\n+        if (validUsers.size() == 0) {\n+            dismissLoadingDialog();\n+            DisplayUtils.showSnackMessage(this, getString(R.string.associated_account_not_found));\n+            return;\n+        }\n+\n+        if (validUsers.size() == 1) {\n+            openFile(validUsers.get(0).getAccountName(), fileId);\n+            return;\n+        }\n+\n+        ArrayList<String> validUserNames = new ArrayList<>();\n+\n+        for (User user : validUsers) {\n+            validUserNames.add(user.getAccountName());\n+        }\n+\n+        AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());\n+        builder\n+            .setTitle(R.string.common_choose_account)\n+            .setItems(validUserNames.toArray(new CharSequence[validUserNames.size()]),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0467cc37ca768f1e2d51779c1fcca739f131b14b"}, "originalPosition": 129}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4774, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}