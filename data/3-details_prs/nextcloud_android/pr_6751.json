{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMjI3MDAy", "number": 6751, "title": "Reset last sync date of files written via DocumentsProvider", "bodyText": "The sync operation detects changes by comparing timestamps in milliseconds. However, the local modification time only has a precision of seconds (even though given in milliseconds).\nWhen the DocumentsProvider is used programmatically, operations such as a create and a subsequent write can happen within the same second causing the sync operation to not detect the change and therefore failing to upload a file causing data loss.\nThis MR also moves the file close listener to the thread used by the DocumentsStorageProvider as this is more appropriate than the UI thread.\nFixes #6726 (I can create other tickets about the side-issues identified there)", "createdAt": "2020-08-19T15:05:00Z", "url": "https://github.com/nextcloud/android/pull/6751", "merged": true, "mergeCommit": {"oid": "ad7564b94206aa2febca8097e538627664cd1f49"}, "closed": true, "closedAt": "2020-08-24T07:51:11Z", "author": {"login": "grote"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAdA3vABqjM2NzEyNjg0ODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdB9zAigFqTQ3MzE5NjUxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4fdd0d067befb1e1a104d39fb500c4a70c084e5e", "author": {"user": {"login": "grote", "name": "Torsten Grote"}}, "url": "https://github.com/nextcloud/android/commit/4fdd0d067befb1e1a104d39fb500c4a70c084e5e", "committedDate": "2020-08-19T14:58:35Z", "message": "Reset last sync date of files written via DocumentsProvider\n\nThe sync operation detects changes by comparing timestamps in\nmilliseconds. However, the local modification time only has a precision\nof seconds (even though given in milliseconds).\nWhen the DocumentsProvider is used programmatically, operations such as\na create and a subsequent write can happen within the same second\ncausing the sync operation to not detect the change and therefore\nfailing to upload a file causing data loss.\n\nThis commit also moves the file close listener to the thread used by the\nDocumentsStorageProvider as this is more appropriate than the UI thread.\n\nFixes #6726"}, "afterCommit": {"oid": "f23010c97f190cd14bf64f56d65626022b4e860b", "author": {"user": {"login": "grote", "name": "Torsten Grote"}}, "url": "https://github.com/nextcloud/android/commit/f23010c97f190cd14bf64f56d65626022b4e860b", "committedDate": "2020-08-19T15:05:16Z", "message": "Reset last sync date of files written via DocumentsProvider\n\nThe sync operation detects changes by comparing timestamps in\nmilliseconds. However, the local modification time only has a precision\nof seconds (even though given in milliseconds).\nWhen the DocumentsProvider is used programmatically, operations such as\na create and a subsequent write can happen within the same second\ncausing the sync operation to not detect the change and therefore\nfailing to upload a file causing data loss.\n\nThis commit also moves the file close listener to the thread used by the\nDocumentsStorageProvider as this is more appropriate than the UI thread.\n\nFixes #6726\n\nSigned-off-by: Torsten Grote <t@grobox.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMzQzNzY1", "url": "https://github.com/nextcloud/android/pull/6751#pullrequestreview-472343765", "createdAt": "2020-08-21T09:29:52Z", "commit": {"oid": "f23010c97f190cd14bf64f56d65626022b4e860b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwOToyOTo1MlrOHElzAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwOToyOTo1MlrOHElzAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU3NTYxNg==", "bodyText": "Why did you extracted the handler to a member of this class?", "url": "https://github.com/nextcloud/android/pull/6751#discussion_r474575616", "createdAt": "2020-08-21T09:29:52Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/owncloud/android/providers/DocumentsStorageProvider.java", "diffHunk": "@@ -101,6 +101,7 @@\n     private static final long CACHE_EXPIRATION = TimeUnit.MILLISECONDS.convert(1, TimeUnit.MINUTES);\n \n     UserAccountManager accountManager;\n+    Handler handler;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f23010c97f190cd14bf64f56d65626022b4e860b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64ec7053989e16f5353204ddb79c1a58beb90baa", "author": {"user": {"login": "grote", "name": "Torsten Grote"}}, "url": "https://github.com/nextcloud/android/commit/64ec7053989e16f5353204ddb79c1a58beb90baa", "committedDate": "2020-08-21T12:15:19Z", "message": "Reset last sync date of files written via DocumentsProvider\n\nThe sync operation detects changes by comparing timestamps in\nmilliseconds. However, the local modification time only has a precision\nof seconds (even though given in milliseconds).\nWhen the DocumentsProvider is used programmatically, operations such as\na create and a subsequent write can happen within the same second\ncausing the sync operation to not detect the change and therefore\nfailing to upload a file causing data loss.\n\nThis commit also moves the file close listener to the thread used by the\nDocumentsStorageProvider as this is more appropriate than the UI thread.\n\nFixes #6726\n\nSigned-off-by: Torsten Grote <t@grobox.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f23010c97f190cd14bf64f56d65626022b4e860b", "author": {"user": {"login": "grote", "name": "Torsten Grote"}}, "url": "https://github.com/nextcloud/android/commit/f23010c97f190cd14bf64f56d65626022b4e860b", "committedDate": "2020-08-19T15:05:16Z", "message": "Reset last sync date of files written via DocumentsProvider\n\nThe sync operation detects changes by comparing timestamps in\nmilliseconds. However, the local modification time only has a precision\nof seconds (even though given in milliseconds).\nWhen the DocumentsProvider is used programmatically, operations such as\na create and a subsequent write can happen within the same second\ncausing the sync operation to not detect the change and therefore\nfailing to upload a file causing data loss.\n\nThis commit also moves the file close listener to the thread used by the\nDocumentsStorageProvider as this is more appropriate than the UI thread.\n\nFixes #6726\n\nSigned-off-by: Torsten Grote <t@grobox.de>"}, "afterCommit": {"oid": "64ec7053989e16f5353204ddb79c1a58beb90baa", "author": {"user": {"login": "grote", "name": "Torsten Grote"}}, "url": "https://github.com/nextcloud/android/commit/64ec7053989e16f5353204ddb79c1a58beb90baa", "committedDate": "2020-08-21T12:15:19Z", "message": "Reset last sync date of files written via DocumentsProvider\n\nThe sync operation detects changes by comparing timestamps in\nmilliseconds. However, the local modification time only has a precision\nof seconds (even though given in milliseconds).\nWhen the DocumentsProvider is used programmatically, operations such as\na create and a subsequent write can happen within the same second\ncausing the sync operation to not detect the change and therefore\nfailing to upload a file causing data loss.\n\nThis commit also moves the file close listener to the thread used by the\nDocumentsStorageProvider as this is more appropriate than the UI thread.\n\nFixes #6726\n\nSigned-off-by: Torsten Grote <t@grobox.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMTk2NTE3", "url": "https://github.com/nextcloud/android/pull/6751#pullrequestreview-473196517", "createdAt": "2020-08-24T07:51:05Z", "commit": {"oid": "64ec7053989e16f5353204ddb79c1a58beb90baa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4512, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}