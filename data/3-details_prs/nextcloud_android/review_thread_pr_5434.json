{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyNzgzNjY3", "number": 5434, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxMDoyNjozM1rODeQ_qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODozODoxNVrODfFoiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMDYyMzE0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/owncloud/android/ui/activity/ManageAccountsActivity.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxMDoyNjozM1rOFnUVCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxMDoyNjozM1rOFnUVCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc3MTg0OA==", "bodyText": "Issue found: Avoid instantiating new objects inside loops", "url": "https://github.com/nextcloud/android/pull/5434#discussion_r376771848", "createdAt": "2020-02-09T10:26:33Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/ui/activity/ManageAccountsActivity.java", "diffHunk": "@@ -223,25 +233,20 @@ private void initializeComponentGetters() {\n         }\n     }\n \n-    /**\n-     * creates the account list items list including the add-account action in case multiaccount_support is enabled.\n-     *\n-     * @return list of account list items\n-     */\n-    private List<AccountListItem> getAccountListItems() {\n-        Account[] accountList = AccountManager.get(this).getAccountsByType(MainApp.getAccountType(this));\n-        List<AccountListItem> adapterAccountList = new ArrayList<>(accountList.length);\n-        for (Account account : accountList) {\n-            boolean pendingForRemoval = arbitraryDataProvider.getBooleanValue(account, PENDING_FOR_REMOVAL);\n-            adapterAccountList.add(new AccountListItem(account, !pendingForRemoval));\n+    private List<UserListItem> getUserListItems() {\n+        List<User> users = accountManager.getAllUsers();\n+        List<UserListItem> userListItems = new ArrayList<>(users.size());\n+        for (User user : users) {\n+            boolean pendingForRemoval = arbitraryDataProvider.getBooleanValue(user.toPlatformAccount(),\n+                                                                              PENDING_FOR_REMOVAL);\n+            userListItems.add(new UserListItem(user, !pendingForRemoval));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c3df42239a555cf664266cbbfadfa81b8acd9bce"}, "originalPosition": 197}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMzE4NDQzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/owncloud/android/ui/adapter/UserListAdapter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNjowMjoxNFrOFnruag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNjowMjoxNFrOFnruag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1NTE3OA==", "bodyText": "DOH! Gihub is diffing wrong files!\nThis should be diffed against old AccountListAdapter, that has become UserListAdapter, becuase it shows users.\nOld UserListAdapter has become ShareeListAdapter, bacuse it shows users sharing a file.", "url": "https://github.com/nextcloud/android/pull/5434#discussion_r377155178", "createdAt": "2020-02-10T16:02:14Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/adapter/UserListAdapter.java", "diffHunk": "@@ -1,449 +1,339 @@\n /*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4b688e71758455818efed2855b1c7f248ea9fbc"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzMzUyMjg2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/owncloud/android/ui/adapter/ShareeListAdapter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNzozMTowMVrOFnvAYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQxNzozMTowMVrOFnvAYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIwODkyOA==", "bodyText": "This was UserListAdapter, renamed into Sharee*. Github is confused.", "url": "https://github.com/nextcloud/android/pull/5434#discussion_r377208928", "createdAt": "2020-02-10T17:31:01Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/adapter/ShareeListAdapter.java", "diffHunk": "@@ -0,0 +1,453 @@\n+/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48d9b58306dc652627fda31074c3d0d6f57a196c"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNTM1OTU3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/owncloud/android/ui/activity/UserInfoActivity.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwODozMToxNlrOFoAcFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwODozMToxNlrOFoAcFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ5NDU1MA==", "bodyText": "This would lead to a direct return after clicking on the user/account.\nAs far as I know, we had an empty for this previously.\nCan we have this?\nI can write a test case for this.", "url": "https://github.com/nextcloud/android/pull/5434#discussion_r377494550", "createdAt": "2020-02-11T08:31:16Z", "author": {"login": "tobiasKaminsky"}, "path": "src/main/java/com/owncloud/android/ui/activity/UserInfoActivity.java", "diffHunk": "@@ -116,15 +118,22 @@\n     private Unbinder unbinder;\n \n     private UserInfo userInfo;\n-    private Account account;\n+    private User user;\n \n     @Override\n     public void onCreate(Bundle savedInstanceState) {\n         Log_OC.v(TAG, \"onCreate() start\");\n         super.onCreate(savedInstanceState);\n         Bundle bundle = getIntent().getExtras();\n \n-        account = Parcels.unwrap(bundle.getParcelable(KEY_ACCOUNT));\n+        final Account account = Parcels.unwrap(bundle.getParcelable(KEY_ACCOUNT));\n+        Optional<User> optionalUser = accountManager.getUser(account != null ? account.name : \"\");\n+        if(!optionalUser.isPresent()) {\n+            finish();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fbaf2c9fd1f7f3f71e64599dcf79c980180ad8e"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzOTI0NzI2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/owncloud/android/ui/dialog/MultipleAccountsDialog.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODozODoxM1rOFolqIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODozODoxM1rOFolqIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODEwNDM1NA==", "bodyText": "Issue found: Avoid instantiating new objects inside loops", "url": "https://github.com/nextcloud/android/pull/5434#discussion_r378104354", "createdAt": "2020-02-12T08:38:13Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/ui/dialog/MultipleAccountsDialog.java", "diffHunk": "@@ -117,21 +120,21 @@ public Dialog onCreateDialog(Bundle savedInstanceState) {\n      *\n      * @return list of account list items\n      */\n-    private List<AccountListItem> getAccountListItems() {\n-        Account[] accountList = accountManager.getAccounts();\n-        List<AccountListItem> adapterAccountList = new ArrayList<>(accountList.length);\n-        for (Account account : accountList) {\n-            adapterAccountList.add(new AccountListItem(account));\n+    private List<UserListItem> getAccountListItems() {\n+        List<User> users = accountManager.getAllUsers();\n+        List<UserListItem> adapterUserList = new ArrayList<>(users.size());\n+        for (User user : users) {\n+            adapterUserList.add(new UserListItem(user));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0569b0de6543bfaf78d689c8b4296ca24fc2bdd3"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzOTI0NzM3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/owncloud/android/ui/activity/ManageAccountsActivity.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODozODoxNFrOFolqLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODozODoxNFrOFolqLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODEwNDM2Ng==", "bodyText": "Issue found: Avoid instantiating new objects inside loops", "url": "https://github.com/nextcloud/android/pull/5434#discussion_r378104366", "createdAt": "2020-02-12T08:38:14Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/ui/activity/ManageAccountsActivity.java", "diffHunk": "@@ -223,25 +232,20 @@ private void initializeComponentGetters() {\n         }\n     }\n \n-    /**\n-     * creates the account list items list including the add-account action in case multiaccount_support is enabled.\n-     *\n-     * @return list of account list items\n-     */\n-    private List<AccountListItem> getAccountListItems() {\n-        Account[] accountList = AccountManager.get(this).getAccountsByType(MainApp.getAccountType(this));\n-        List<AccountListItem> adapterAccountList = new ArrayList<>(accountList.length);\n-        for (Account account : accountList) {\n-            boolean pendingForRemoval = arbitraryDataProvider.getBooleanValue(account, PENDING_FOR_REMOVAL);\n-            adapterAccountList.add(new AccountListItem(account, !pendingForRemoval));\n+    private List<UserListItem> getUserListItems() {\n+        List<User> users = accountManager.getAllUsers();\n+        List<UserListItem> userListItems = new ArrayList<>(users.size());\n+        for (User user : users) {\n+            boolean pendingForRemoval = arbitraryDataProvider.getBooleanValue(user.toPlatformAccount(),\n+                                                                              PENDING_FOR_REMOVAL);\n+            userListItems.add(new UserListItem(user, !pendingForRemoval));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0569b0de6543bfaf78d689c8b4296ca24fc2bdd3"}, "originalPosition": 206}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzOTI0NzQ0OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/owncloud/android/ui/activity/ManageAccountsActivity.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODozODoxNVrOFolqOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQwODozODoxNVrOFolqOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODEwNDM3Nw==", "bodyText": "Issue found: Deeply nested if..then statements are hard to read", "url": "https://github.com/nextcloud/android/pull/5434#discussion_r378104377", "createdAt": "2020-02-12T08:38:15Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/ui/activity/ManageAccountsActivity.java", "diffHunk": "@@ -155,9 +155,12 @@ protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n         if (resultCode == KEY_DELETE_CODE && data != null) {\n             Bundle bundle = data.getExtras();\n             if (bundle != null && bundle.containsKey(UserInfoActivity.KEY_ACCOUNT)) {\n-                Account account = Parcels.unwrap(bundle.getParcelable(UserInfoActivity.KEY_ACCOUNT));\n-                accountName = account.name;\n-                performAccountRemoval(account);\n+                final Account account = Parcels.unwrap(bundle.getParcelable(UserInfoActivity.KEY_ACCOUNT));\n+                if (account != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0569b0de6543bfaf78d689c8b4296ca24fc2bdd3"}, "originalPosition": 128}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3162, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}