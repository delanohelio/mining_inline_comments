{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxMDQ3NTk4", "number": 6121, "title": "enhance deep linking to allow pretty urls", "bodyText": "Signed-off-by: szaimen szaimen@e.mail.de\nFor reference:\nHere you can find all news websites from google:\nThat contain in their link */f/*    (221.000)\nThat contain in their link */index.php/*    (15.500.000)\nAll news websites    (1.660.000.000) \nTesting\nWriting tests is very important. Please try to write some tests for your PR.\nIf you need help, please do not hesitate to ask in this PR for help.\nunit tests\ninstrumented tests\nUI tests\n\n Tests written, or not not needed", "createdAt": "2020-05-20T22:17:17Z", "url": "https://github.com/nextcloud/android/pull/6121", "merged": true, "mergeCommit": {"oid": "cee5b45b8402683231de319240db5e1b7eea78f7"}, "closed": true, "closedAt": "2020-06-30T10:30:44Z", "author": {"login": "szaimen"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjTM1ngFqTQxNTgxNzAwNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwSuz0AFqTQzOTg2NTIyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1ODE3MDA3", "url": "https://github.com/nextcloud/android/pull/6121#pullrequestreview-415817007", "createdAt": "2020-05-21T01:15:39Z", "commit": {"oid": "435481e7fe6fa6cf16a3112ff706b0e93c18338c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwMToxNTozOVrOGYjDVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQwMToxNTozOVrOGYjDVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM5MzMwMg==", "bodyText": "Actually I am not sure about that in the moment.\nThat allows 3 times deep nesting like e.g. https://www.example.de/ne/xt/cloud/f/501857 or https://www.example.de/next/cloud/index.php/f/501857\nWhat are your opinions on that?\nPossible would e.g. be also:\n                <data android:pathPattern=\"/f/..*\" />\n                <data android:pathPattern=\"/..*/f/..*\" />\n                <data android:pathPattern=\"/..*/..*/f/..*\" />\n                <data android:pathPattern=\"/..*/..*/index.php/f/..*\" />\n\nwhich would allow 2 times deep nesting\nor e.g.\n                <data android:pathPattern=\"/f/..*\" />\n                <data android:pathPattern=\"/..*/f/..*\" />\n                <data android:pathPattern=\"/..*/index.php/f/..*\" />\n\nwhich would only allow one time deep nesting\nBTW: android:pathPattern=\"/.*f/.*\" is here not possible, because it would allow trigger every link, that contains this pattern \"*f/*\"  which would be really too much imo; just look for that pattern on google: there are way too much sites containing that pattern.\nThe proposed solutions trigger only at links with \"*/f/*\" which is much more rare.", "url": "https://github.com/nextcloud/android/pull/6121#discussion_r428393302", "createdAt": "2020-05-21T01:15:39Z", "author": {"login": "szaimen"}, "path": "src/main/AndroidManifest.xml", "diffHunk": "@@ -121,14 +121,13 @@\n                 <action android:name=\"android.intent.action.VIEW\" />\n                 <category android:name=\"android.intent.category.DEFAULT\" />\n                 <category android:name=\"android.intent.category.BROWSABLE\" />\n-                <data android:scheme=\"http\"\n-                    android:host=\"*\"\n-                    android:pathPattern=\"/.*index.php/f/.*\"\n-                    />\n-                <data android:scheme=\"https\"\n-                      android:host=\"*\"\n-                      android:pathPattern=\"/.*index.php/f/.*\"\n-                    />\n+                <data android:scheme=\"http\" />\n+                <data android:scheme=\"https\" />\n+                <data android:host=\"*\" />\n+                <data android:pathPattern=\"/f/..*\" />\n+                <data android:pathPattern=\"/..*/f/..*\" />\n+                <data android:pathPattern=\"/..*/..*/f/..*\" />\n+                <data android:pathPattern=\"/..*/..*/..*/f/..*\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "435481e7fe6fa6cf16a3112ff706b0e93c18338c"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NDcwNzQ0", "url": "https://github.com/nextcloud/android/pull/6121#pullrequestreview-416470744", "createdAt": "2020-05-21T20:32:40Z", "commit": {"oid": "b9636c761b22b7a08bb6739ab339b33534348b68"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMDozMjo0MVrOGZB3Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQyMDozMjo0MVrOGZB3Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg5ODA3NQ==", "bodyText": "The PR description says that tests are not needed. We can extract this part and put it under test.", "url": "https://github.com/nextcloud/android/pull/6121#discussion_r428898075", "createdAt": "2020-05-21T20:32:41Z", "author": {"login": "ezaquarii"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -2625,12 +2625,21 @@ private void handleOpenFileViaIntent(Intent intent) {\n         if (userName == null && fileId == null && intent.getData() != null) {\n             // Handle intent coming from URI\n \n-            Pattern pattern  = Pattern.compile(\"(.*)/index\\\\.php/([f])/([0-9]+)$\");\n-            Matcher matcher = pattern.matcher(intent.getData().toString());\n-            if (matcher.matches()) {\n-                String uri = matcher.group(1);\n-                if (\"f\".equals(matcher.group(2))) {\n-                    fileId = matcher.group(3);\n+            Pattern pattern1 = Pattern.compile(\"(.*)/index\\\\.php/([f])/([0-9]+)$\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9636c761b22b7a08bb6739ab339b33534348b68"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a0c85723968fa86c14f168e79c872e3e04135a03", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/a0c85723968fa86c14f168e79c872e3e04135a03", "committedDate": "2020-05-28T00:23:31Z", "message": "Refactored deep link handling\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "65432b601090c3ef1168b03a7c776d411a3bcd2f", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/65432b601090c3ef1168b03a7c776d411a3bcd2f", "committedDate": "2020-05-28T00:26:05Z", "message": "Refactored deep link handling\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65432b601090c3ef1168b03a7c776d411a3bcd2f", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/65432b601090c3ef1168b03a7c776d411a3bcd2f", "committedDate": "2020-05-28T00:26:05Z", "message": "Refactored deep link handling\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "2659fbd692ac6adffeebe830324e09c10bcb0a39", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/2659fbd692ac6adffeebe830324e09c10bcb0a39", "committedDate": "2020-05-28T00:27:20Z", "message": "Refactored deep link handling\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2659fbd692ac6adffeebe830324e09c10bcb0a39", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/2659fbd692ac6adffeebe830324e09c10bcb0a39", "committedDate": "2020-05-28T00:27:20Z", "message": "Refactored deep link handling\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "ad5629d551ce6525f97ff14dfef1ac66de17f7bc", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/ad5629d551ce6525f97ff14dfef1ac66de17f7bc", "committedDate": "2020-05-28T00:33:41Z", "message": "Refactored deep link handling\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ad5629d551ce6525f97ff14dfef1ac66de17f7bc", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/ad5629d551ce6525f97ff14dfef1ac66de17f7bc", "committedDate": "2020-05-28T00:33:41Z", "message": "Refactored deep link handling\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "f78d22c649a8af19e040a61c102e35d51340fc38", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/f78d22c649a8af19e040a61c102e35d51340fc38", "committedDate": "2020-05-28T00:38:35Z", "message": "Refactored deep link handling\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f78d22c649a8af19e040a61c102e35d51340fc38", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/f78d22c649a8af19e040a61c102e35d51340fc38", "committedDate": "2020-05-28T00:38:35Z", "message": "Refactored deep link handling\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "a293cacea7ba6c9753008e1f71294d12c5fe047b", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/a293cacea7ba6c9753008e1f71294d12c5fe047b", "committedDate": "2020-05-28T00:40:28Z", "message": "Refactored deep link handling\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a293cacea7ba6c9753008e1f71294d12c5fe047b", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/a293cacea7ba6c9753008e1f71294d12c5fe047b", "committedDate": "2020-05-28T00:40:28Z", "message": "Refactored deep link handling\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "8c944cc91f7fce8887ae0c467150bde60a0ecbf9", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/8c944cc91f7fce8887ae0c467150bde60a0ecbf9", "committedDate": "2020-05-28T00:41:18Z", "message": "Refactored deep link handling\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "559c56a35ef8da90ec7260e067058ae3be376e10", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/559c56a35ef8da90ec7260e067058ae3be376e10", "committedDate": "2020-05-28T22:07:05Z", "message": "Move user filtering to deep link handler\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "725d754607253bc36926cbec19c0b4617d71fa6a", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/725d754607253bc36926cbec19c0b4617d71fa6a", "committedDate": "2020-05-28T22:15:25Z", "message": "Move user filtering to deep link handler\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "725d754607253bc36926cbec19c0b4617d71fa6a", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/725d754607253bc36926cbec19c0b4617d71fa6a", "committedDate": "2020-05-28T22:15:25Z", "message": "Move user filtering to deep link handler\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "c1b4ffa58252921540b3481f669937e6581c569b", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/c1b4ffa58252921540b3481f669937e6581c569b", "committedDate": "2020-05-30T14:31:31Z", "message": "Deep link handler tests\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c1b4ffa58252921540b3481f669937e6581c569b", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/c1b4ffa58252921540b3481f669937e6581c569b", "committedDate": "2020-05-30T14:31:31Z", "message": "Deep link handler tests\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "3f2a70c412d2384eb217e8201d2643be7fb103d9", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/3f2a70c412d2384eb217e8201d2643be7fb103d9", "committedDate": "2020-05-30T14:36:06Z", "message": "Deep link handler tests\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f2a70c412d2384eb217e8201d2643be7fb103d9", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/3f2a70c412d2384eb217e8201d2643be7fb103d9", "committedDate": "2020-05-30T14:36:06Z", "message": "Deep link handler tests\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "a32857e2344918ab1fa0fa152a494e8a44bfbc37", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/a32857e2344918ab1fa0fa152a494e8a44bfbc37", "committedDate": "2020-05-30T14:59:47Z", "message": "Deep link handler tests\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a32857e2344918ab1fa0fa152a494e8a44bfbc37", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/a32857e2344918ab1fa0fa152a494e8a44bfbc37", "committedDate": "2020-05-30T14:59:47Z", "message": "Deep link handler tests\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "4dfa70e3b25a6664539068449bfb2d0e24377c98", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/4dfa70e3b25a6664539068449bfb2d0e24377c98", "committedDate": "2020-05-30T16:40:24Z", "message": "Deep link handler tests\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDI4MDYw", "url": "https://github.com/nextcloud/android/pull/6121#pullrequestreview-421428060", "createdAt": "2020-05-30T17:02:22Z", "commit": {"oid": "4dfa70e3b25a6664539068449bfb2d0e24377c98"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxNzowMjoyMlrOGc0TuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxNzowMjoyMlrOGc0TuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg3MDMyOA==", "bodyText": "@szaimen we could proably simplify those regexps even further, but I have currently no time to work on it.", "url": "https://github.com/nextcloud/android/pull/6121#discussion_r432870328", "createdAt": "2020-05-30T17:02:22Z", "author": {"login": "ezaquarii"}, "path": "src/main/AndroidManifest.xml", "diffHunk": "@@ -121,14 +121,13 @@\n                 <action android:name=\"android.intent.action.VIEW\" />\n                 <category android:name=\"android.intent.category.DEFAULT\" />\n                 <category android:name=\"android.intent.category.BROWSABLE\" />\n-                <data android:scheme=\"http\"\n-                    android:host=\"*\"\n-                    android:pathPattern=\"/.*index.php/f/.*\"\n-                    />\n-                <data android:scheme=\"https\"\n-                      android:host=\"*\"\n-                      android:pathPattern=\"/.*index.php/f/.*\"\n-                    />\n+                <data android:scheme=\"http\" />\n+                <data android:scheme=\"https\" />\n+                <data android:host=\"*\" />\n+                <data android:pathPattern=\"/f/..*\" />\n+                <data android:pathPattern=\"/..*/f/..*\" />\n+                <data android:pathPattern=\"/..*/..*/f/..*\" />\n+                <data android:pathPattern=\"/..*/..*/..*/f/..*\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4dfa70e3b25a6664539068449bfb2d0e24377c98"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4dfa70e3b25a6664539068449bfb2d0e24377c98", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/4dfa70e3b25a6664539068449bfb2d0e24377c98", "committedDate": "2020-05-30T16:40:24Z", "message": "Deep link handler tests\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "c3f2c58c0fe989ae1e1719135dcc527fd2f369e1", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/c3f2c58c0fe989ae1e1719135dcc527fd2f369e1", "committedDate": "2020-06-04T08:59:08Z", "message": "Deep link handler tests\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5Njg4MDY3", "url": "https://github.com/nextcloud/android/pull/6121#pullrequestreview-439688067", "createdAt": "2020-06-30T05:50:45Z", "commit": {"oid": "c3f2c58c0fe989ae1e1719135dcc527fd2f369e1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "815e30166eb2b4e4c087a9e3acc65234a20fbeaf", "author": {"user": {"login": "szaimen", "name": null}}, "url": "https://github.com/nextcloud/android/commit/815e30166eb2b4e4c087a9e3acc65234a20fbeaf", "committedDate": "2020-06-30T05:51:20Z", "message": "allow pretty urls\n\nSigned-off-by: szaimen <szaimen@e.mail.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed4917db14fdb5059d5c4c56321e627370d0c900", "author": {"user": {"login": "szaimen", "name": null}}, "url": "https://github.com/nextcloud/android/commit/ed4917db14fdb5059d5c4c56321e627370d0c900", "committedDate": "2020-06-30T05:51:20Z", "message": "Update pattern matcher to allow pretty urls\n\nSigned-off-by: szaimen <szaimen@e.mail.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "214689bc0d3b17f34e044d11b3c17a9cfc51ee7b", "author": {"user": {"login": "szaimen", "name": null}}, "url": "https://github.com/nextcloud/android/commit/214689bc0d3b17f34e044d11b3c17a9cfc51ee7b", "committedDate": "2020-06-30T05:51:20Z", "message": "allow 3 times deep nextcloud nesting\n\nSigned-off-by: szaimen <szaimen@e.mail.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bcb126206426f8ca3e1ad98828791d3bc7b223ce", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/bcb126206426f8ca3e1ad98828791d3bc7b223ce", "committedDate": "2020-06-30T05:51:20Z", "message": "Deep link handler prototype\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50b19e5d7733fe27b4e7de96b390a140c8ea9f4d", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/50b19e5d7733fe27b4e7de96b390a140c8ea9f4d", "committedDate": "2020-06-30T05:51:21Z", "message": "Refactored deep link handling\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a887a4c32bb0da323f044682c17cf673174a4479", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/a887a4c32bb0da323f044682c17cf673174a4479", "committedDate": "2020-06-30T05:51:21Z", "message": "Move user filtering to deep link handler\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74e68d6b8eaade88fcdf83eedc8954f319b1d9ae", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/74e68d6b8eaade88fcdf83eedc8954f319b1d9ae", "committedDate": "2020-06-30T05:51:21Z", "message": "Deep link handler tests\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3f2c58c0fe989ae1e1719135dcc527fd2f369e1", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/c3f2c58c0fe989ae1e1719135dcc527fd2f369e1", "committedDate": "2020-06-04T08:59:08Z", "message": "Deep link handler tests\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}, "afterCommit": {"oid": "74e68d6b8eaade88fcdf83eedc8954f319b1d9ae", "author": {"user": {"login": "ezaquarii", "name": "Chris Narkiewicz"}}, "url": "https://github.com/nextcloud/android/commit/74e68d6b8eaade88fcdf83eedc8954f319b1d9ae", "committedDate": "2020-06-30T05:51:21Z", "message": "Deep link handler tests\n\nSigned-off-by: Chris Narkiewicz <hello@ezaquarii.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d7e8b770a36f532b268ca3e863265e74a4a0084", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/3d7e8b770a36f532b268ca3e863265e74a4a0084", "committedDate": "2020-06-30T06:45:52Z", "message": "add missing import\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05748959e9e1ba07d6987e3ef758d980fc57c1f4", "author": {"user": {"login": "tobiasKaminsky", "name": "Tobias Kaminsky"}}, "url": "https://github.com/nextcloud/android/commit/05748959e9e1ba07d6987e3ef758d980fc57c1f4", "committedDate": "2020-06-30T09:55:52Z", "message": "exit always with 0\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5ODY1MjIx", "url": "https://github.com/nextcloud/android/pull/6121#pullrequestreview-439865221", "createdAt": "2020-06-30T10:03:52Z", "commit": {"oid": "05748959e9e1ba07d6987e3ef758d980fc57c1f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxMDowMzo1MlrOGq1S5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxMDowMzo1MlrOGq1S5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU2NjU2NQ==", "bodyText": "Codacy found an issue: Avoid using Literals in Conditional Statements", "url": "https://github.com/nextcloud/android/pull/6121#discussion_r447566565", "createdAt": "2020-06-30T10:03:52Z", "author": {"login": "nextcloud-android-bot"}, "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -2408,44 +2402,54 @@ private void handleOpenFileViaIntent(Intent intent) {\n         String fileId = intent.getStringExtra(KEY_FILE_ID);\n \n         if (userName == null && fileId == null && intent.getData() != null) {\n-            // Handle intent coming from URI\n-\n-            Pattern pattern  = Pattern.compile(\"(.*)/index\\\\.php/([f])/([0-9]+)$\");\n-            Matcher matcher = pattern.matcher(intent.getData().toString());\n-            if (matcher.matches()) {\n-                String uri = matcher.group(1);\n-                if (\"f\".equals(matcher.group(2))) {\n-                    fileId = matcher.group(3);\n-                    findAccountAndOpenFile(uri, fileId);\n-                    return;\n-                }\n+            openDeepLink(intent.getData());\n+        } else {\n+            Optional<User> optionalUser = userName == null ? getUser() : getUserAccountManager().getUser(userName);\n+            if (optionalUser.isPresent()) {\n+                openFile(optionalUser.get(), fileId);\n             } else {\n                 dismissLoadingDialog();\n-                DisplayUtils.showSnackMessage(this, getString(R.string.invalid_url));\n-                return;\n+                DisplayUtils.showSnackMessage(this, getString(R.string.associated_account_not_found));\n             }\n         }\n-        openFile(userName, fileId);\n-\n     }\n-    private void openFile(String userName, String fileId) {\n-        Optional<User> optionalNewUser;\n-        User user;\n \n-        if (userName == null) {\n-            optionalNewUser = getUser();\n+    private void openDeepLink(Uri uri) {\n+        DeepLinkHandler linkHandler = new DeepLinkHandler(getUserAccountManager());\n+        DeepLinkHandler.Match match = linkHandler.parseDeepLink(uri);\n+        if (match == null) {\n+            dismissLoadingDialog();\n+            DisplayUtils.showSnackMessage(this, getString(R.string.invalid_url));\n+        } else if (match.getUsers().isEmpty()) {\n+            dismissLoadingDialog();\n+            DisplayUtils.showSnackMessage(this, getString(R.string.associated_account_not_found));\n+        } else if (match.getUsers().size() == 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05748959e9e1ba07d6987e3ef758d980fc57c1f4"}, "originalPosition": 83}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4637, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}