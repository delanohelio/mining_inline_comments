{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3MDQxNjQy", "number": 1921, "title": "OWLS-84517: Scaling failed when setting Dedicated to true", "bodyText": "When namespace selection strategy is configured to be 'Dedicated', requests to the Operator's REST endpoint fail authentication.  Authentication checks were always cluster scoped.  The fix is for REST endpoint authentication to be namespace scoped when in 'Dedicated' namespace selection strategy,", "createdAt": "2020-09-15T05:21:56Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1921", "merged": true, "mergeCommit": {"oid": "17522b4ef6d70689006e848c6d21073b3c963d82"}, "closed": true, "closedAt": "2020-09-17T14:56:03Z", "author": {"login": "lennyphan"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJAlVcAH2gAyNDg3MDQxNjQyOjA4MzFiN2RjODA4YzBkZThmZWUzYTQ1MDYwZWIwM2ViMWU1MDk2MGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJS8I8AFqTQ4OTIyOTgwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0831b7dc808c0de8fee3a45060eb03eb1e50960a", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0831b7dc808c0de8fee3a45060eb03eb1e50960a", "committedDate": "2020-09-15T05:03:20Z", "message": "Rest authentication of requests should use namespace scope for Dedicated selection strategy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4OTkwNzMx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1921#pullrequestreview-488990731", "createdAt": "2020-09-15T19:14:57Z", "commit": {"oid": "0831b7dc808c0de8fee3a45060eb03eb1e50960a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOToxNDo1N1rOHSQgEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOToxNDo1N1rOHSQgEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwNjc3MA==", "bodyText": "It is bad practice to leave a println in your tests. I assume you needed this for debugging and forgot to remove it?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1921#discussion_r488906770", "createdAt": "2020-09-15T19:14:57Z", "author": {"login": "russgold"}, "path": "operator/src/test/java/oracle/kubernetes/operator/helpers/AuthenticationProxyTest.java", "diffHunk": "@@ -0,0 +1,72 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.kubernetes.operator.helpers;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import com.meterware.simplestub.Memento;\n+import com.meterware.simplestub.StaticStubSupport;\n+import oracle.kubernetes.operator.helpers.AuthorizationProxy.Scope;\n+import oracle.kubernetes.utils.TestUtils;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.junit.MatcherAssert.assertThat;\n+\n+public class AuthenticationProxyTest {\n+\n+  private final List<Memento> mementos = new ArrayList<>();\n+  private final KubernetesTestSupport testSupport = new KubernetesTestSupport();\n+  private final AuthorizationProxyStub authorizationProxyStub = new AuthorizationProxyStub();\n+\n+  /**\n+   * Setup test.\n+   * @throws Exception on failure\n+   */\n+  @Before\n+  public void setUp() throws Exception {\n+    mementos.add(TestUtils.silenceOperatorLogger());\n+    mementos.add(testSupport.install());\n+    mementos.add(\n+        StaticStubSupport.install(AuthenticationProxy.class, \"authorizationProxy\", authorizationProxyStub));\n+  }\n+\n+  @After\n+  public void tearDown() {\n+    mementos.forEach(Memento::revert);\n+  }\n+\n+  @Test\n+  public void verify_authorizationScope_isCluster_whenNamespaceIsNull() {\n+    AuthenticationProxy authorizationProxy = new AuthenticationProxy();\n+    authorizationProxy.check(\"\", \"\", null);\n+    assertThat(authorizationProxyStub.scope, equalTo(Scope.cluster));\n+  }\n+\n+  @Test\n+  public void verify_authorizationScope_isNamespace_whenNamespaceIsDefined() {\n+    AuthenticationProxy authorizationProxy = new AuthenticationProxy();\n+    authorizationProxy.check(\"\", \"\", \"NS\");\n+    assertThat(authorizationProxyStub.scope, equalTo(Scope.namespace));\n+  }\n+\n+  private class AuthorizationProxyStub extends AuthorizationProxy {\n+    Scope scope;\n+\n+    public boolean check(\n+        String principal,\n+        Operation operation,\n+        Resource resource,\n+        String resourceName,\n+        Scope scope,\n+        String namespaceName) {\n+      this.scope = scope;\n+      System.out.println(\"AuthorizationProxyStub.check scope: \" + scope);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0831b7dc808c0de8fee3a45060eb03eb1e50960a"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "176fdbf517f967a8eeb5bd3d38669fe09ac8ff08", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/176fdbf517f967a8eeb5bd3d38669fe09ac8ff08", "committedDate": "2020-09-15T21:00:42Z", "message": "remove System.out.println from unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MDY5MTQz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1921#pullrequestreview-489069143", "createdAt": "2020-09-15T21:03:48Z", "commit": {"oid": "176fdbf517f967a8eeb5bd3d38669fe09ac8ff08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTczNDQz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1921#pullrequestreview-489173443", "createdAt": "2020-09-15T23:25:07Z", "commit": {"oid": "176fdbf517f967a8eeb5bd3d38669fe09ac8ff08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MjI5ODA1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1921#pullrequestreview-489229805", "createdAt": "2020-09-16T02:26:32Z", "commit": {"oid": "176fdbf517f967a8eeb5bd3d38669fe09ac8ff08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4151, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}