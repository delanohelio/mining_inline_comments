{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0OTcwOTg2", "number": 2067, "title": "Add data source online updates to the Update 4 MII sample.", "bodyText": "This adds datasource updates into MII sample use case Update 4.", "createdAt": "2020-11-20T21:50:51Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067", "merged": true, "mergeCommit": {"oid": "bb3cb473722471fe8208336f12390db713b2c06e"}, "closed": true, "closedAt": "2020-11-23T17:53:20Z", "author": {"login": "tbarnes-us"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeegGxgH2gAyNTI0OTcwOTg2OjQ3ZDkxYzliZDNiOTlkOWI4MTlmMDBlMmFjYWM5NWM3NTEzMzkyNWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdemAkxgH2gAyNTI0OTcwOTg2OjI3ODk4OWI3MjRmMDJkZTg0NWRjZmFhNmQ5ZDkzZjYzZjk0OGI1NmY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "47d91c9bd3b99d9b819f00e2acac95c75133925d", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/47d91c9bd3b99d9b819f00e2acac95c75133925d", "committedDate": "2020-11-20T21:47:11Z", "message": "Add data source online updates to the Update 4 MII sample."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/51849883c0067bc526a5f5df581834bb6e4164f8", "committedDate": "2020-11-20T22:05:56Z", "message": "minor doc update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODEwMjIx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067#pullrequestreview-535810221", "createdAt": "2020-11-20T22:09:27Z", "commit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjowOToyN1rOH3iadw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjowOToyN1rOH3iadw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzk5NzU1OQ==", "bodyText": "Should we add \"and a domain restart (roll)\" for update 3 as in update 1?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067#discussion_r527997559", "createdAt": "2020-11-20T22:09:27Z", "author": {"login": "alai8"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -14,14 +14,15 @@ description: \"Sample for supplying a WebLogic Deploy Tooling (WDT) model that th\n      - [Sample directory structure](#sample-directory-structure)\n      - [Ensuring your Kubernetes cluster can access images](#ensuring-your-kubernetes-cluster-can-access-images)\n    - [References](#references)\n-   - [Prerequisites for all domain types]({{< relref \"/samples/simple/domains/model-in-image/prerequisites#prerequisites-for-all-domain-types\" >}})\n-   - [Additional prerequisites for JRF domains]({{< relref \"/samples/simple/domains/model-in-image/prerequisites#additional-prerequisites-for-jrf-domains\" >}})\n-   - [Initial]({{< relref \"/samples/simple/domains/model-in-image/initial.md\" >}}) use case: An initial WebLogic domain\n-   - [Update 1]({{< relref \"/samples/simple/domains/model-in-image/update1.md\" >}}): Dynamically adding a data source using a model ConfigMap\n-   - [Update 2]({{< relref \"/samples/simple/domains/model-in-image/update2.md\" >}}): Deploying an additional domain\n-   - [Update 3]({{< relref \"/samples/simple/domains/model-in-image/update3.md\" >}}): Updating an application in an image\n-   - [Update 4]({{< relref \"/samples/simple/domains/model-in-image/update4.md\" >}}): Dynamically update Work Manager Threads Constraints configurations using a model ConfigMap without restarting servers\n-   - [Cleanup]({{< relref \"/samples/simple/domains/model-in-image/cleanup.md\" >}})\n+   - Sample steps\n+     - [Prerequisites for all domain types]({{< relref \"/samples/simple/domains/model-in-image/prerequisites#prerequisites-for-all-domain-types\" >}})\n+     - [Additional prerequisites for JRF domains]({{< relref \"/samples/simple/domains/model-in-image/prerequisites#additional-prerequisites-for-jrf-domains\" >}})\n+     - [Initial]({{< relref \"/samples/simple/domains/model-in-image/initial.md\" >}}) use case: An initial WebLogic domain\n+     - [Update 1]({{< relref \"/samples/simple/domains/model-in-image/update1.md\" >}}): Dynamically adding a data source using a model ConfigMap and a domain restart (roll)\n+     - [Update 2]({{< relref \"/samples/simple/domains/model-in-image/update2.md\" >}}): Deploying an additional domain\n+     - [Update 3]({{< relref \"/samples/simple/domains/model-in-image/update3.md\" >}}): Updating an application in an image", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODEyMDgw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067#pullrequestreview-535812080", "createdAt": "2020-11-20T22:13:27Z", "commit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjoxMzoyN1rOH3igVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjoxMzoyN1rOH3igVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzk5OTA2MA==", "bodyText": "I checked this file in accidentally and will remove it.  It's implicitly updated when you start the DB using the DB sample...", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067#discussion_r527999060", "createdAt": "2020-11-20T22:13:27Z", "author": {"login": "tbarnes-us"}, "path": "kubernetes/samples/scripts/create-oracle-db-service/common/oracle.db.yaml", "diffHunk": "@@ -71,4 +71,4 @@ spec:\n       securityContext: {}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODE0NTU2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067#pullrequestreview-535814556", "createdAt": "2020-11-20T22:18:53Z", "commit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjoxODo1NFrOH3ioUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjoxODo1NFrOH3ioUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAwMTEwNw==", "bodyText": "should this commented line be removed?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067#discussion_r528001107", "createdAt": "2020-11-20T22:18:54Z", "author": {"login": "alai8"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/model-in-image/utils/wl-pod-wait.sh", "diffHunk": "@@ -172,6 +176,32 @@ function print_table() {\n   done\n }\n \n+#\n+# get domain value specified by $1:\n+#   for example '.spec.introspectVersion' or '.spec.restartVersion'\n+# and place result in the env var named by $2\n+# if expected>0 and echo an Error and exit script non-zero\n+#\n+function getDomainValue() {\n+  local attvalue\n+  local ljpath=\"{$1}\"\n+  local __retvar=$2\n+  set +e\n+  attvalue=$(kubectl -n ${DOMAIN_NAMESPACE} get domain ${DOMAIN_UID} -o=jsonpath=\"$ljpath\" 2>&1)\n+  # attvalue=$(kubectl -n ${DOMAIN_NAMESPACE} get domain ${DOMAIN_UID} -o=jpath='{.spec.restartVersion}' 2>&1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODE1NDk1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067#pullrequestreview-535815495", "createdAt": "2020-11-20T22:20:53Z", "commit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjoyMDo1NFrOH3irWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjoyMDo1NFrOH3irWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAwMTg4MA==", "bodyText": "Looks like I doubled the http_proxy entry - I will fix.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067#discussion_r528001880", "createdAt": "2020-11-20T22:20:54Z", "author": {"login": "tbarnes-us"}, "path": "src/integration-tests/model-in-image/mii-sample-wrapper/README", "diffHunk": "@@ -78,8 +78,20 @@ INCLUDE_MODEL_CONFIGMAP ::: Tell sample to include a configuration.model.configM\n   in the domain resource, and to add a configuration.model.secrets reference\n   to a secret that's used by the configMap. Also used by './create-secrets.sh' to\n   deploy a secret the configMap uses. \n+  See also CORRECTED_DATASOURCE_SECRET.\n   Valid values are 'false' (default), and 'true'.\n \n+CORRECTED_DATASOURCE_SECRET ::: Use correct values in datasource secret\n+  The DS secret is used by the configMap's DS to point to a DB.\n+  It's deliberately incorrect by default so the sample\n+  can demonstrate dynamically updating the DS params using online.\n+  See also INCLUDE_MODEL_CONFIGMAP.\n+  Valid values are 'false' (default), and 'true'.\n+\n+http_proxy https_proxy ::: Proxies\n+  If running behind a proxy, then set as needed to allow curl access\n+  to github.com. Used by 'stage-tooling.sh'.\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODE1NTcz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067#pullrequestreview-535815573", "createdAt": "2020-11-20T22:21:05Z", "commit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjoyMTowNVrOH3iriQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjoyMTowNVrOH3iriQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAwMTkyOQ==", "bodyText": "duplicate", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067#discussion_r528001929", "createdAt": "2020-11-20T22:21:05Z", "author": {"login": "alai8"}, "path": "src/integration-tests/model-in-image/mii-sample-wrapper/README", "diffHunk": "@@ -78,8 +78,20 @@ INCLUDE_MODEL_CONFIGMAP ::: Tell sample to include a configuration.model.configM\n   in the domain resource, and to add a configuration.model.secrets reference\n   to a secret that's used by the configMap. Also used by './create-secrets.sh' to\n   deploy a secret the configMap uses. \n+  See also CORRECTED_DATASOURCE_SECRET.\n   Valid values are 'false' (default), and 'true'.\n \n+CORRECTED_DATASOURCE_SECRET ::: Use correct values in datasource secret\n+  The DS secret is used by the configMap's DS to point to a DB.\n+  It's deliberately incorrect by default so the sample\n+  can demonstrate dynamically updating the DS params using online.\n+  See also INCLUDE_MODEL_CONFIGMAP.\n+  Valid values are 'false' (default), and 'true'.\n+\n+http_proxy https_proxy ::: Proxies", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODIxMzgw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067#pullrequestreview-535821380", "createdAt": "2020-11-20T22:34:29Z", "commit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjozNDozMFrOH3i9XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQyMjozNDozMFrOH3i9XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAwNjQ5Mw==", "bodyText": "if [ $corrected_datasource_secret = \"true\" ]; then\n    export CORRECTED_DATASOURCE_SECRET=true\nfi\n\nshould be replaced with\nexport CORRECTED_DATASOURCE_SECRET=$corrected_datasource_secret", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067#discussion_r528006493", "createdAt": "2020-11-20T22:34:30Z", "author": {"login": "tbarnes-us"}, "path": "src/integration-tests/model-in-image/mii-sample-wrapper/generate-sample-doc.sh", "diffHunk": "@@ -132,6 +137,9 @@ for phase in initial update1 update2 update3 update4; do\n   if [ $configmap != \"None\" ]; then\n     export INCLUDE_MODEL_CONFIGMAP=true\n   fi\n+  if [ $corrected_datasource_secret = \"true\" ]; then\n+    export CORRECTED_DATASOURCE_SECRET=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1ODczODA5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067#pullrequestreview-535873809", "createdAt": "2020-11-21T02:21:49Z", "commit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwMjoyMTo0OVrOH3l9qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQwMjoyMTo0OVrOH3l9qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODA1NTcyMw==", "bodyText": "the kubectl edit command could use a little more help - provide the following snippet (substitute JRF for WLS for the JRF path):\n  configuration:\n    model:\n      configMap: sample-domain1-wdt-config-map\n      domainType: WLS\n      onlineUpdate:\n        enabled: true\n      runtimeEncryptionSecret: sample-domain1-runtime-encryption-secret", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2067#discussion_r528055723", "createdAt": "2020-11-21T02:21:49Z", "author": {"login": "tbarnes-us"}, "path": "docs-source/content/samples/simple/domains/model-in-image/update4.md", "diffHunk": "@@ -54,6 +57,31 @@ Here are the steps:\n      - To make it obvious which ConfigMap belong to which domains.\n      - To make it easier to clean up a domain. Typical cleanup scripts use the `weblogic.domainUID` label as a convenience for finding all resources associated with a domain.\n \n+1. Update the data source secret that you created in the Update 1 use case with a correct URL, a correct password, as well as with an increased maximum pool capacity:\n+\n+   ```\n+   $ kubectl -n sample-domain1-ns delete secret sample-domain1-datasource-secret\n+   $ kubectl -n sample-domain1-ns create secret generic \\\n+      sample-domain1-datasource-secret \\\n+      --from-literal='user=sys as sysdba' \\\n+      --from-literal='password=Oradoc_db1' \\\n+      --from-literal='max-capacity=10' \\\n+      --from-literal='url=jdbc:oracle:thin:@oracle-db.default.svc.cluster.local:1521/devpdb.k8s'\n+   $ kubectl -n sample-domain1-ns label  secret \\\n+      sample-domain1-datasource-secret \\\n+      weblogic.domainUID=sample-domain1\n+   ```\n+\n+1. Optionally start the database.\n+\n+    - If the database is running, then the sample application that we will run at the end of this step will verify that your updates to the data source secret took effect.\n+\n+    - If you are taking the `JRF` path through the sample, then the database will already be running. \n+\n+    - If you are taking the `WLS` path through the sample, then you can deploy the database by:\n+      - Following the the first step in [Set up and initialize an infrastructure database]({{< relref \"/samples/simple/domains/model-in-image/prerequisites.md#set-up-and-initialize-an-infrastructure-database\" >}}). This step is titled `Ensure that you have access to the database image, and then create a deployment`.\n+      - You can skip the remaining steps (they are only needed for `JRF`).\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51849883c0067bc526a5f5df581834bb6e4164f8"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "278989b724f02de845dcfaa6d9d93f63f948b56f", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/278989b724f02de845dcfaa6d9d93f63f948b56f", "committedDate": "2020-11-21T06:31:59Z", "message": "MII Sample Update 4 use case - Online data source updates"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3941, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}