{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMjMwNTAx", "number": 1557, "title": "cleanup.sh:  add fast WL pod exit, --force phase, backgrounding, and --timeout", "bodyText": "The problem:\nThe QA Jenkins runs are intermittently leaving k8s zombies behind for unknown reasons and consequently 'cleanup.sh' delete commands can hang.\nIn addition, cleanup.sh can take a relatively long time to finish even when it's running fine.\nThe fixes:\n(1) Add '--timeout=60s' to all initial 'nice' deletes.\n(2) Speedup WL pod termination by (a) modifying stopServer.sh to exit without first calling WLST shutdown if '/tmp/diefast' exists, and (b) having the cleanup.sh script create '/tmp/diefast' on all running wl pods before calling delete\n(3) Speedup deletes by running deletes in background, plus kill background jobs if they hang around more than 15 seconds.\n(4) Add a final phase to cleanup.sh that uses the '--force' delete option. This should be OK because cleanup.sh is only used in test and dev environments.", "createdAt": "2020-04-11T18:40:21Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1557", "merged": true, "mergeCommit": {"oid": "9dc8227e8e36b458fe1b2c03efe33c30df927a1e"}, "closed": true, "closedAt": "2020-04-15T12:47:49Z", "author": {"login": "tbarnes-us"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWqFTIgH2gAyNDAyMjMwNTAxOmM3OGI0NjQxYzg4YzZmZTI3MzliNGYxMGE0NzVkOThmNGE1Y2I1Yzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX3hhYAFqTM5MzczOTEyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c78b4641c88c6fe2739b4f10a475d98f4a5cb5c7", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c78b4641c88c6fe2739b4f10a475d98f4a5cb5c7", "committedDate": "2020-04-11T18:34:13Z", "message": "add --force delete phase to cleanup.sh"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODAxNjQ4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1557#pullrequestreview-391801648", "createdAt": "2020-04-11T21:24:54Z", "commit": {"oid": "c78b4641c88c6fe2739b4f10a475d98f4a5cb5c7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f35541ca6f980bcf3c92921d0d663fc718256fcb", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f35541ca6f980bcf3c92921d0d663fc718256fcb", "committedDate": "2020-04-11T22:03:11Z", "message": "set timeout in cleanup.sh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd5d395c9c9be834020ce15ecf465f966a2ba5b9", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/dd5d395c9c9be834020ce15ecf465f966a2ba5b9", "committedDate": "2020-04-11T23:37:52Z", "message": "fix typo in --timeout parameter for kubectl delete in cleanup.sh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fae07769d49b7f6cc75bc005ea43d6f656aa3b5", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1fae07769d49b7f6cc75bc005ea43d6f656aa3b5", "committedDate": "2020-04-12T01:39:19Z", "message": "add 'diefast' support to wl pods and to QA cleanup.sh script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ea439d00169d1ddae04a18253db2d923c5ba457", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0ea439d00169d1ddae04a18253db2d923c5ba457", "committedDate": "2020-04-13T17:48:04Z", "message": "cleanup.sh: run deletes in background and kill bg jobs if they take more than 15 seconds"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNDU1MTIw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1557#pullrequestreview-392455120", "createdAt": "2020-04-13T21:32:21Z", "commit": {"oid": "0ea439d00169d1ddae04a18253db2d923c5ba457"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QyMTozMjoyMVrOGE2HBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QyMTozMjoyMVrOGE2HBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzczNDAyMQ==", "bodyText": "This scares me \ud83d\ude28", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1557#discussion_r407734021", "createdAt": "2020-04-13T21:32:21Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/resources/scripts/stopServer.sh", "diffHunk": "@@ -48,6 +48,14 @@ function check_for_shutdown() {\n     return 0\n   fi\n \n+  if [ -e /tmp/diefast ]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ea439d00169d1ddae04a18253db2d923c5ba457"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNzAxNzkz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1557#pullrequestreview-393701793", "createdAt": "2020-04-15T11:53:29Z", "commit": {"oid": "0ea439d00169d1ddae04a18253db2d923c5ba457"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNzM5MTIx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1557#pullrequestreview-393739121", "createdAt": "2020-04-15T12:47:44Z", "commit": {"oid": "0ea439d00169d1ddae04a18253db2d923c5ba457"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 26, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}