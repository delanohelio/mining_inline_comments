{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzMjUyMTc4", "number": 1492, "title": "OWLS-79994: When scaling down the cluster with WLDF the number of replicas will go under the MinNumberOfServer", "bodyText": "When a dynamic cluster is configured, prevent scale down below the minimum dynamic cluster size.  When a replica request below the configured minimum dynamic cluster size, we log the following warning (analogous to the logging done for a request above the configured maxmimum cluster size):\n{\"timestamp\":\"03-24-2020T20:24:08.497+0000\",\"thread\":12,\"fiber\":\"engine-operator-thread-2-fiber-922\",\"domainUID\":\"sample-domain1\",\"level\":\"WARNING\",\"class\":\"oracle.kubernetes.operator.steps.ManagedServersUpStep$ServersUpStepFactory\",\"method\":\"logIfReplicasLessThanClusterServersMin\",\"timeInMillis\":1585081448497,\"message\":\"Replica request of 0 less than the minimum dynamic server count of 1 configured for cluster cluster-1\",\"exception\":\"\",\"code\":\"\",\"headers\":{},\"body\":\"\"}\nThis commit also updates the 'Cluster Status' (in the domain description) with the configured minimum 'replicas' value:\ne.g.\nStatus:\nClusters:\nCluster Name:      cluster-1\nMaximum Replicas:  5\nMinimum Replicas:  1\nReady Replicas:    2", "createdAt": "2020-03-24T20:58:05Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1492", "merged": true, "mergeCommit": {"oid": "29067021de1a413c4821a5168f2ff767e96d9345"}, "closed": true, "closedAt": "2020-03-25T16:21:31Z", "author": {"login": "lennyphan"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcP68CYgH2gAyMzkzMjUyMTc4OjY2NTg5YzVmNzM5ZTQyZjY3ODlkM2MzMTE2ZjVjN2FmYzExNjJjMjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRJ6gtgH2gAyMzkzMjUyMTc4OjllYmYzZDFmYWM5ZTcyMmI1OGMyMDQ4MGI1ODQwZWQ4ZTNjYmQwNDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "66589c5f739e42f6789d3c3116f5c7afc1162c26", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/66589c5f739e42f6789d3c3116f5c7afc1162c26", "committedDate": "2020-03-21T20:15:01Z", "message": "Prevent scaled down below configured minimum dynamic server count"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbb4a7243295b6aef9006192a405c44244e4a5a7", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/bbb4a7243295b6aef9006192a405c44244e4a5a7", "committedDate": "2020-03-22T19:44:04Z", "message": "Add minimum cluster size to cluster status"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "744c33cfafec787e17a2dc66fc39b0ed046c1cc9", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/744c33cfafec787e17a2dc66fc39b0ed046c1cc9", "committedDate": "2020-03-22T21:51:19Z", "message": "Add updated artifacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4fdf94fe48b17e832dc39e3999d3e2ef373cc53", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a4fdf94fe48b17e832dc39e3999d3e2ef373cc53", "committedDate": "2020-03-22T22:59:52Z", "message": "Update unit tests for minimum replicas"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22ce1abb25cbb3abefd32fa8735ba2ddd9f3d30e", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/22ce1abb25cbb3abefd32fa8735ba2ddd9f3d30e", "committedDate": "2020-03-24T17:36:00Z", "message": "Merge latest from develop to get commits from OWLS-78058"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9539a222d4d40a221f7efd405389bc718ead8ecf", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9539a222d4d40a221f7efd405389bc718ead8ecf", "committedDate": "2020-03-24T18:21:51Z", "message": "Fix copy constructor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjk5MDAy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1492#pullrequestreview-380699002", "createdAt": "2020-03-24T21:10:23Z", "commit": {"oid": "9539a222d4d40a221f7efd405389bc718ead8ecf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwODEzNDY2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1492#pullrequestreview-380813466", "createdAt": "2020-03-25T01:59:27Z", "commit": {"oid": "9539a222d4d40a221f7efd405389bc718ead8ecf"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMTo1OToyN1rOF7Jj9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMjowMTozMFrOF7Jl-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2Njk2NA==", "bodyText": "i am not getting why this needs to be synchronized", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1492#discussion_r397566964", "createdAt": "2020-03-25T01:59:27Z", "author": {"login": "markxnelson"}, "path": "operator/src/main/java/oracle/kubernetes/operator/wlsconfig/WlsClusterConfig.java", "diffHunk": "@@ -163,6 +163,14 @@ public synchronized int getMaxClusterSize() {\n     return hasDynamicServers() ? getClusterSize() + getMaxDynamicClusterSize() : getClusterSize();\n   }\n \n+  /**\n+   * Returns the minimum size of the cluster.\n+   * @return  For static clusters, the minimum size can be 0.  Dynamic servers will return the configured value.\n+   */\n+  public synchronized int getMinClusterSize() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9539a222d4d40a221f7efd405389bc718ead8ecf"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NzQ4MQ==", "bodyText": "space after comma - weird that checkstyle did not get that", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1492#discussion_r397567481", "createdAt": "2020-03-25T02:01:30Z", "author": {"login": "markxnelson"}, "path": "operator/src/test/java/oracle/kubernetes/operator/wlsconfig/WlsClusterConfigTest.java", "diffHunk": "@@ -241,17 +248,16 @@ public void verifyMaxClusterSizeForDynamicCluster() {\n   @Test\n   public void verifyMaxClusterSizeForMixedCluster() {\n     WlsDynamicServersConfig wlsDynamicServersConfig =\n-        createDynamicServersConfig(1, 1, \"ms-\", \"cluster1\");\n+        createDynamicServersConfig(1, 1, 1,\"ms-\", \"cluster1\");\n     WlsClusterConfig wlsClusterConfig = new WlsClusterConfig(\"cluster1\", wlsDynamicServersConfig);\n     wlsClusterConfig.addServerConfig(createWlsServerConfig(\"ms-0\", 8011, null));\n \n     assertThat(wlsClusterConfig.getMaxClusterSize(), equalTo(2));\n   }\n \n-  @Test\n   public void verifyGetUpdateDynamicClusterSizeUrlIncludesClusterName() {\n     WlsDynamicServersConfig wlsDynamicServersConfig =\n-        createDynamicServersConfig(1, 1, \"ms-\", \"cluster1\");\n+        createDynamicServersConfig(1, 1, 1,\"ms-\", \"cluster1\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9539a222d4d40a221f7efd405389bc718ead8ecf"}, "originalPosition": 130}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTgwOTIx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1492#pullrequestreview-381180921", "createdAt": "2020-03-25T14:07:49Z", "commit": {"oid": "9539a222d4d40a221f7efd405389bc718ead8ecf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ebf3d1fac9e722b58c20480b5840ed8e3cbd045", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9ebf3d1fac9e722b58c20480b5840ed8e3cbd045", "committedDate": "2020-03-25T16:15:51Z", "message": "Resolved code review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4892, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}