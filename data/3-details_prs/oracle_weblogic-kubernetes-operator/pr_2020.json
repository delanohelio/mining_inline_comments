{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzMTg2MjA1", "number": 2020, "title": "Owls85582 take all ALWAYS servers before considering rest of the servers when meet cluster replicas requirement", "bodyText": "Changed the operator code to take all severs with ALWAYS start policy before considering rest of the managed servers to meet the replicas requirement.\nAdd unit test cases for ALWAYS and NEVER start policy working with cluster replicas, including scale up and scale down.\n\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/2858/ (passed with the latest product changes)\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/2869/ (in progress with additional unit test changes)", "createdAt": "2020-10-30T17:51:06Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2020", "merged": true, "mergeCommit": {"oid": "c1e5c8dd1788f263f9247563ca2172c79a2ea14b"}, "closed": true, "closedAt": "2020-11-03T16:38:13Z", "author": {"login": "doxiao"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXZYE0gH2gAyNTEzMTg2MjA1OjU5OWU1YjU0ODdlODZhMDBiYjJmNGVjYzA2YjMxOTA3MDBmNmZiMmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdY60AbgFqTUyMjYwNTg5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "599e5b5487e86a00bb2f4ecc06b3190700f6fb2e", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/599e5b5487e86a00bb2f4ecc06b3190700f6fb2e", "committedDate": "2020-10-29T21:51:25Z", "message": "add all Always servers before consider IfNeeded servers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83fc388c56a7642d10a251c6c4a97a6173f5abbb", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/83fc388c56a7642d10a251c6c4a97a6173f5abbb", "committedDate": "2020-10-30T14:49:52Z", "message": "add unit test cases for NEVER policy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bb9ae31435da56db7e3d2aa8b793646e164db2d", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7bb9ae31435da56db7e3d2aa8b793646e164db2d", "committedDate": "2020-10-30T16:06:06Z", "message": "clean up unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7251b97731807540d9b6e9495e0b34d3b5c8d11", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b7251b97731807540d9b6e9495e0b34d3b5c8d11", "committedDate": "2020-10-30T16:40:03Z", "message": "minor changes to the unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwOTcwMTgx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2020#pullrequestreview-520970181", "createdAt": "2020-10-30T19:27:06Z", "commit": {"oid": "b7251b97731807540d9b6e9495e0b34d3b5c8d11"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxOToyNzowNlrOHrdF1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxOToyNzowNlrOHrdF1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTMyNzQ0NA==", "bodyText": "Would this approach affect the guaranteed 'lexi numeric' order in which we start or shutdown servers?  Or which servers are reported in status?   (For example, when we're shutting down a cluster's servers one-at-a-time, the goal is to shutdown only the 'highest' server first, then the second highest, and so on.)", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2020#discussion_r515327444", "createdAt": "2020-10-30T19:27:06Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/java/oracle/kubernetes/operator/steps/ManagedServersUpStep.java", "diffHunk": "@@ -118,23 +118,30 @@ public NextAction apply(Packet packet) {\n   private void addServersToFactory(@Nonnull ServersUpStepFactory factory, @Nonnull WlsDomainConfig wlsDomainConfig) {\n     Set<String> clusteredServers = new HashSet<>();\n \n+    List<ServerConfig> pendingServers = new ArrayList<>();\n     wlsDomainConfig.getClusterConfigs().values()\n-        .forEach(wlsClusterConfig -> addClusteredServersToFactory(factory, clusteredServers, wlsClusterConfig));\n+        .forEach(wlsClusterConfig -> addClusteredServersToFactory(\n+            factory, clusteredServers, wlsClusterConfig, pendingServers));\n \n     wlsDomainConfig.getServerConfigs().values().stream()\n         .filter(wlsServerConfig -> !clusteredServers.contains(wlsServerConfig.getName()))\n-        .forEach(wlsServerConfig -> factory.addServerIfNeeded(wlsServerConfig, null));\n+        .forEach(wlsServerConfig -> factory.addServerIfAlways(wlsServerConfig, null, pendingServers));\n+\n+    for (ServerConfig serverConfig : pendingServers) {\n+      factory.addServerIfNeeded(serverConfig.wlsServerConfig, serverConfig.wlsClusterConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7251b97731807540d9b6e9495e0b34d3b5c8d11"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bea31245afa4223a12eccf2f7ff44b2b1290c8d", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3bea31245afa4223a12eccf2f7ff44b2b1290c8d", "committedDate": "2020-10-30T23:34:07Z", "message": "resort the final server startup list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf4a4d9123dd147e4014772f8b581354b9d8439d", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/bf4a4d9123dd147e4014772f8b581354b9d8439d", "committedDate": "2020-10-30T23:35:58Z", "message": "Merge remote-tracking branch 'origin/develop' into owls85582-always-replicas"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMTQ2NTI0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2020#pullrequestreview-521146524", "createdAt": "2020-10-31T15:13:33Z", "commit": {"oid": "bf4a4d9123dd147e4014772f8b581354b9d8439d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMDM4Mzk4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2020#pullrequestreview-522038398", "createdAt": "2020-11-02T22:08:52Z", "commit": {"oid": "bf4a4d9123dd147e4014772f8b581354b9d8439d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNjA1ODk3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2020#pullrequestreview-522605897", "createdAt": "2020-11-03T15:22:43Z", "commit": {"oid": "bf4a4d9123dd147e4014772f8b581354b9d8439d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4063, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}