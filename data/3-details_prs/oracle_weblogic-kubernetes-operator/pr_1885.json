{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczNTQ3NTk1", "number": 1885, "title": "Retry docker login, image push/pull from/to repos", "bodyText": "There are quite few images are built when the tests starts to run, but sometimes the docker login , push/pull of images fail and the tests is aborted after spending about an hour. This PR aims to retry those steps when it fails due to network glitch or something.\nRan the tests multiple times and I don't see the failures now.\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/1635/\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/1633/\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/1632/\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/1631/\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/1630/\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/1629/\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/1628/", "createdAt": "2020-08-25T22:54:40Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1885", "merged": true, "mergeCommit": {"oid": "8e1c8390dab1cc779ac3ceb3db56bea329041220"}, "closed": true, "closedAt": "2020-08-26T19:43:35Z", "author": {"login": "sankarpn"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCH7M6gH2gAyNDczNTQ3NTk1OmNkMWZiZjg4OTliZThkNWMzN2UxYmY5M2UyM2IxNTU4ZTE5YzkzZTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCvQVmAFqTQ3NTcwNjM2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cd1fbf8899be8d5c37e1bf93e23b1558e19c93e2", "author": {"user": {"login": "sankarpn", "name": "Sankar Periyathambi Neelakandan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/cd1fbf8899be8d5c37e1bf93e23b1558e19c93e2", "committedDate": "2020-08-24T19:39:05Z", "message": "Using standard retry logic to retry the build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a19014dd9307dc10503daffa3fe89446c9e4ce99", "author": {"user": {"login": "sankarpn", "name": "Sankar Periyathambi Neelakandan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a19014dd9307dc10503daffa3fe89446c9e4ce99", "committedDate": "2020-08-24T23:16:45Z", "message": "Use retry for docker login and image pull and push"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f273e154cb3c99d953b75a4fc08f2c3d2f2f0dc0", "author": {"user": {"login": "sankarpn", "name": "Sankar Periyathambi Neelakandan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f273e154cb3c99d953b75a4fc08f2c3d2f2f0dc0", "committedDate": "2020-08-25T01:14:04Z", "message": "increase timeout to 30 minutes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15d1baf0c58738f17e5b17ed22dbd5f923125d5e", "author": {"user": {"login": "sankarpn", "name": "Sankar Periyathambi Neelakandan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/15d1baf0c58738f17e5b17ed22dbd5f923125d5e", "committedDate": "2020-08-25T15:50:38Z", "message": "Retry the push"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70c5b701601e29b5bb1d041ef7776d9c8d4008fd", "author": {"user": {"login": "sankarpn", "name": "Sankar Periyathambi Neelakandan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/70c5b701601e29b5bb1d041ef7776d9c8d4008fd", "committedDate": "2020-08-25T18:13:59Z", "message": "wip"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "488b0e7fd55a6082afc9825905ba3551fa40d087", "author": {"user": {"login": "sankarpn", "name": "Sankar Periyathambi Neelakandan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/488b0e7fd55a6082afc9825905ba3551fa40d087", "committedDate": "2020-08-25T18:20:23Z", "message": "use iterator to push"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1MDQzNTE0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1885#pullrequestreview-475043514", "createdAt": "2020-08-25T23:04:31Z", "commit": {"oid": "488b0e7fd55a6082afc9825905ba3551fa40d087"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NTYwODA2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1885#pullrequestreview-475560806", "createdAt": "2020-08-26T14:42:18Z", "commit": {"oid": "488b0e7fd55a6082afc9825905ba3551fa40d087"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNDo0MjoxOFrOHHPfWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQxNDo0MjoxOFrOHHPfWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM1NTg2NQ==", "bodyText": "removing this condition, test will fail when SKIP_BASIC_IMAGE_BUILD is set", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1885#discussion_r477355865", "createdAt": "2020-08-26T14:42:18Z", "author": {"login": "vanajamukkara"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/extensions/ImageBuilders.java", "diffHunk": "@@ -154,20 +172,33 @@ public void beforeAll(ExtensionContext context) {\n \n           if (!REPO_USERNAME.equals(REPO_DUMMY_VALUE)) {\n             logger.info(\"docker login\");\n-            assertTrue(dockerLogin(REPO_REGISTRY, REPO_USERNAME, REPO_PASSWORD), \"docker login failed\");\n+            withStandardRetryPolicy\n+                .conditionEvaluationListener(\n+                    condition -> logger.info(\"Waiting for docker login to be successful\"\n+                        + \"(elapsed time {0} ms, remaining time {1} ms)\",\n+                        condition.getElapsedTimeInMS(),\n+                        condition.getRemainingTimeInMS()))\n+                .until(() -> dockerLogin(OCR_REGISTRY, OCR_USERNAME, OCR_PASSWORD));\n           }\n         }\n-        // push the image\n+        // push the images to repo\n         if (!REPO_NAME.isEmpty()) {\n-          logger.info(\"docker push image {0} to {1}\", operatorImage, REPO_NAME);\n-          assertTrue(dockerPush(operatorImage), String.format(\"docker push failed for image %s\", operatorImage));\n \n-          if (System.getenv(\"SKIP_BASIC_IMAGE_BUILD\") == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "488b0e7fd55a6082afc9825905ba3551fa40d087"}, "originalPosition": 115}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9f00dbd19583557e6f45c9383e18e547042c8ae", "author": {"user": {"login": "sankarpn", "name": "Sankar Periyathambi Neelakandan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b9f00dbd19583557e6f45c9383e18e547042c8ae", "committedDate": "2020-08-26T15:57:41Z", "message": "check SKIP_BASIC_IMAGE_BUILD is set before pushing it to repo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NzA2MzY4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1885#pullrequestreview-475706368", "createdAt": "2020-08-26T17:28:28Z", "commit": {"oid": "b9f00dbd19583557e6f45c9383e18e547042c8ae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4412, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}