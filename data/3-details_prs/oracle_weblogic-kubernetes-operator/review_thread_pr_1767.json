{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMTM4NTYy", "number": 1767, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDowNjozNlrOEI_vZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDoxOTowNFrOEI_1pQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3ODY4Mzg4OnYy", "diffSide": "RIGHT", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDowNjozNlrOGpTBOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxODo0NToxM1rOGprJUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1NjQwOA==", "bodyText": "Do not evaluate and assign this until you are ready to use it.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1767#discussion_r445956408", "createdAt": "2020-06-26T04:06:36Z", "author": {"login": "sankarpn"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -41,7 +79,10 @@\n   private static final String RCUSCHEMAPREFIX = \"jrfdomainpv\";\n   private static final String ORACLEDBURLPREFIX = \"oracledb.\";\n   private static final String ORACLEDBSUFFIX = \".svc.cluster.local:1521/devpdb.k8s\";\n-\n+  private static final String RCUSYSUSERNAME = \"sys\";\n+  private static final String RCUSYSPASSWORD = \"Oradoc_db1\";\n+  private static final String RCUSCHEMAUSERNAME = \"myrcuuser\";\n+  private static final String RCUSCHEMAPASSWORD = \"Oradoc_db1\";\n \n   private static String dbUrl = null;\n   private static int dbPort = getNextFreePort(30000, 32767);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c97125d101994bf52db3ee6d7b2afb20e8c5c5e2"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MTY5OA==", "bodyText": "Fixed", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1767#discussion_r446351698", "createdAt": "2020-06-26T18:45:13Z", "author": {"login": "maggiehe00"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -41,7 +79,10 @@\n   private static final String RCUSCHEMAPREFIX = \"jrfdomainpv\";\n   private static final String ORACLEDBURLPREFIX = \"oracledb.\";\n   private static final String ORACLEDBSUFFIX = \".svc.cluster.local:1521/devpdb.k8s\";\n-\n+  private static final String RCUSYSUSERNAME = \"sys\";\n+  private static final String RCUSYSPASSWORD = \"Oradoc_db1\";\n+  private static final String RCUSCHEMAUSERNAME = \"myrcuuser\";\n+  private static final String RCUSCHEMAPASSWORD = \"Oradoc_db1\";\n \n   private static String dbUrl = null;\n   private static int dbPort = getNextFreePort(30000, 32767);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1NjQwOA=="}, "originalCommit": {"oid": "c97125d101994bf52db3ee6d7b2afb20e8c5c5e2"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3ODY4NzA4OnYy", "diffSide": "RIGHT", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDowOToxMVrOGpTDQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxODo0NToyM1rOGprJjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1NjkyOA==", "bodyText": "Now you need to initialize the logger in this method and remove the implements LoggedTest.\nSee #1765", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1767#discussion_r445956928", "createdAt": "2020-06-26T04:09:11Z", "author": {"login": "sankarpn"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -65,38 +110,31 @@\n    * @param namespaces injected by JUnit\n    */\n   @BeforeAll\n-  public static void initAll(@Namespaces(1) List<String> namespaces) {\n+  public static void initAll(@Namespaces(3) List<String> namespaces) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c97125d101994bf52db3ee6d7b2afb20e8c5c5e2"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIzOTgyNg==", "bodyText": "Yeah, when I merged to the latest develop branch I can see the conflicts.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1767#discussion_r446239826", "createdAt": "2020-06-26T15:03:57Z", "author": {"login": "maggiehe00"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -65,38 +110,31 @@\n    * @param namespaces injected by JUnit\n    */\n   @BeforeAll\n-  public static void initAll(@Namespaces(1) List<String> namespaces) {\n+  public static void initAll(@Namespaces(3) List<String> namespaces) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1NjkyOA=="}, "originalCommit": {"oid": "c97125d101994bf52db3ee6d7b2afb20e8c5c5e2"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MTc1Ng==", "bodyText": "Fixed.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1767#discussion_r446351756", "createdAt": "2020-06-26T18:45:23Z", "author": {"login": "maggiehe00"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -65,38 +110,31 @@\n    * @param namespaces injected by JUnit\n    */\n   @BeforeAll\n-  public static void initAll(@Namespaces(1) List<String> namespaces) {\n+  public static void initAll(@Namespaces(3) List<String> namespaces) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1NjkyOA=="}, "originalCommit": {"oid": "c97125d101994bf52db3ee6d7b2afb20e8c5c5e2"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3ODY5MzQ3OnYy", "diffSide": "RIGHT", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDoxMzo1N1rOGpTHHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxODo0NTozMlrOGprJ1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1NzkxOQ==", "bodyText": "Move the checkServiceExists before checkPodReady for both admin and managed server pods.\nThere are instances where when service creation fails, the pods never become ready and the error log messages will be misleading", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1767#discussion_r445957919", "createdAt": "2020-06-26T04:13:57Z", "author": {"login": "sankarpn"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -114,21 +152,196 @@ public static void initAll(@Namespaces(1) List<String> namespaces) {\n    * Create a JRF domain using WLST in a persistent volume.\n    * Create a domain custom resource with domainHomeSourceType as PersistentVolume.\n    * Verify domain pods runs in ready state and services are created.\n-   * Verify login to WebLogic console is successful.\n    */\n   @Test\n   @DisplayName(\"Create JRF domain in PV using WLST script\")\n   public void testJrfDomainInPvUsingWlst() {\n+    final String clusterName = \"cluster-jrfdomain-inpv\";\n+    final String adminServerName = \"wlst-admin-server\";\n+    final String adminServerPodName = domainUid + \"-\" + adminServerName;\n+    final String managedServerNameBase = \"wlst-ms-\";\n+    final int managedServerPort = 8001;\n+    final String managedServerPodNamePrefix = domainUid + \"-\" + managedServerNameBase;\n+    final int replicaCount = 2;\n+    final int t3ChannelPort = getNextFreePort(30000, 32767);\n+\n+    final String pvName = domainUid + \"-pv\";\n+    final String pvcName = domainUid + \"-pvc\";\n+\n+    // create pull secrets for jrfDomainNamespace when running in non Kind Kubernetes cluster\n+    if (isUseSecret) {\n+      createDockerRegistrySecret(OCR_USERNAME, OCR_PASSWORD,\n+          OCR_EMAIL, OCR_REGISTRY, OCR_SECRET_NAME, jrfDomainNamespace);\n+    }\n+\n+    // create JRF domain credential secret\n+    createSecretWithUsernamePassword(wlSecretName, jrfDomainNamespace,\n+        ADMIN_USERNAME_DEFAULT, ADMIN_PASSWORD_DEFAULT);\n+\n+    // create RCU credential secret\n+    CommonTestUtils.createRcuSecretWithUsernamePassword(rcuSecretName, jrfDomainNamespace,\n+        RCUSCHEMAUSERNAME, RCUSCHEMAPASSWORD, RCUSYSUSERNAME, RCUSYSPASSWORD);\n+\n+    // create persistent volume and persistent volume claim for domain\n+    CommonTestUtils.createPV(pvName, domainUid, this.getClass().getSimpleName());\n+    CommonTestUtils.createPVC(pvName, pvcName, domainUid, jrfDomainNamespace);\n+\n+    // create a temporary WebLogic domain property file\n+    File domainPropertiesFile = assertDoesNotThrow(() ->\n+            File.createTempFile(\"domain\", \"properties\"),\n+        \"Failed to create domain properties file\");\n+    Properties p = new Properties();\n+    p.setProperty(\"oracleHome\", \"/u01/oracle\"); //default $ORACLE_HOME\n+    p.setProperty(\"javaHome\", \"/u01/jdk\"); //default $JAVA_HOME\n+    p.setProperty(\"domainParentDir\", \"/shared/domains/\");\n+    p.setProperty(\"domainName\", domainUid);\n+    p.setProperty(\"domainUser\", ADMIN_USERNAME_DEFAULT);\n+    p.setProperty(\"domainPassword\", ADMIN_PASSWORD_DEFAULT);\n+    p.setProperty(\"rcuDb\", dbUrl);\n+    p.setProperty(\"rcuSchemaPrefix\", RCUSCHEMAPREFIX);\n+    p.setProperty(\"rcuSchemaPassword\", RCUSCHEMAPASSWORD);\n+    p.setProperty(\"adminListenPort\", \"7001\");\n+    p.setProperty(\"adminName\", adminServerName);\n+    p.setProperty(\"managedNameBase\", managedServerNameBase);\n+    p.setProperty(\"managedServerPort\",Integer.toString(managedServerPort));\n+    p.setProperty(\"prodMode\", \"true\");\n+    p.setProperty(\"managedCount\", \"4\");\n+    p.setProperty(\"clusterName\", clusterName);\n+    p.setProperty(\"t3ChannelPublicAddress\", K8S_NODEPORT_HOST);\n+    p.setProperty(\"t3ChannelPort\", Integer.toString(t3ChannelPort));\n+    p.setProperty(\"exposeAdminT3Channel\", \"true\");\n+\n+    assertDoesNotThrow(() ->\n+            p.store(new FileOutputStream(domainPropertiesFile), \"jrf wlst properties file\"),\n+        \"Failed to write domain properties file\");\n+\n+    // WLST script for creating domain\n+    Path wlstScript = Paths.get(RESOURCE_DIR, \"python-scripts\", \"jrf-wlst-create-domain-onpv.py\");\n+\n+    // create configmap and domain on persistent volume using the WLST script and property file\n+    createDomainOnPVUsingWlst(wlstScript, domainPropertiesFile.toPath(),\n+        pvName, pvcName, jrfDomainNamespace);\n+\n+    // create a domain custom resource configuration object\n+    logger.info(\"Creating domain custom resource\");\n+    Domain domain = new Domain()\n+        .apiVersion(DOMAIN_API_VERSION)\n+        .kind(\"Domain\")\n+        .metadata(new V1ObjectMeta()\n+            .name(domainUid)\n+            .namespace(jrfDomainNamespace))\n+        .spec(new DomainSpec()\n+            .domainUid(domainUid)\n+            .domainHome(\"/shared/domains/\" + domainUid)  // point to domain home in pv\n+            .domainHomeSourceType(\"PersistentVolume\") // set the domain home source type as pv\n+            .image(fmwImage)\n+            .imagePullPolicy(\"IfNotPresent\")\n+            .imagePullSecrets(isUseSecret ? Arrays.asList(\n+                new V1LocalObjectReference()\n+                    .name(OCR_SECRET_NAME))\n+                : null)\n+            .webLogicCredentialsSecret(new V1SecretReference()\n+                .name(wlSecretName)\n+                .namespace(jrfDomainNamespace))\n+            .includeServerOutInPodLog(true)\n+            .logHomeEnabled(Boolean.TRUE)\n+            .logHome(\"/shared/logs/\" + domainUid)\n+            .dataHome(\"\")\n+            .serverStartPolicy(\"IF_NEEDED\")\n+            .serverPod(new ServerPod() //serverpod\n+                .addEnvItem(new V1EnvVar()\n+                    .name(\"JAVA_OPTIONS\")\n+                    .value(\"-Dweblogic.StdoutDebugEnabled=false\"))\n+                .addEnvItem(new V1EnvVar()\n+                    .name(\"USER_MEM_ARGS\")\n+                    .value(\"-Djava.security.egd=file:/dev/./urandom \"))\n+                .addVolumesItem(new V1Volume()\n+                    .name(pvName)\n+                    .persistentVolumeClaim(new V1PersistentVolumeClaimVolumeSource()\n+                        .claimName(pvcName)))\n+                .addVolumeMountsItem(new V1VolumeMount()\n+                    .mountPath(\"/shared\")\n+                    .name(pvName)))\n+            .adminServer(new AdminServer() //admin server\n+                .serverStartState(\"RUNNING\")\n+                .adminService(new AdminService()\n+                    .addChannelsItem(new Channel()\n+                        .channelName(\"default\")\n+                        .nodePort(0))\n+                    .addChannelsItem(new Channel()\n+                        .channelName(\"T3Channel\")\n+                        .nodePort(t3ChannelPort))))\n+            .addClustersItem(new Cluster() //cluster\n+                .clusterName(clusterName)\n+                .replicas(replicaCount)\n+                .serverStartState(\"RUNNING\")));\n+\n+    // verify the domain custom resource is created\n+    createDomainAndVerify(domain, jrfDomainNamespace);\n+\n+    // verify admin server pod is ready\n+    checkPodReady(adminServerPodName, domainUid, jrfDomainNamespace);\n+\n+    // verify the admin server service created\n+    checkServiceExists(adminServerPodName, jrfDomainNamespace);\n+\n+    // verify managed server pods are ready\n+    for (int i = 1; i <= replicaCount; i++) {\n+      logger.info(\"Waiting for managed server pod {0} to be ready in namespace {1}\",\n+          managedServerPodNamePrefix + i, jrfDomainNamespace);\n+      checkPodReady(managedServerPodNamePrefix + i, domainUid, jrfDomainNamespace);\n+    }\n+\n+    // verify managed server services created\n+    for (int i = 1; i <= replicaCount; i++) {\n+      logger.info(\"Checking managed server service {0} is created in namespace {1}\",\n+          managedServerPodNamePrefix + i, jrfDomainNamespace);\n+      checkServiceExists(managedServerPodNamePrefix + i, jrfDomainNamespace);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c97125d101994bf52db3ee6d7b2afb20e8c5c5e2"}, "originalPosition": 282}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MTgyOA==", "bodyText": "Fixed.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1767#discussion_r446351828", "createdAt": "2020-06-26T18:45:32Z", "author": {"login": "maggiehe00"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -114,21 +152,196 @@ public static void initAll(@Namespaces(1) List<String> namespaces) {\n    * Create a JRF domain using WLST in a persistent volume.\n    * Create a domain custom resource with domainHomeSourceType as PersistentVolume.\n    * Verify domain pods runs in ready state and services are created.\n-   * Verify login to WebLogic console is successful.\n    */\n   @Test\n   @DisplayName(\"Create JRF domain in PV using WLST script\")\n   public void testJrfDomainInPvUsingWlst() {\n+    final String clusterName = \"cluster-jrfdomain-inpv\";\n+    final String adminServerName = \"wlst-admin-server\";\n+    final String adminServerPodName = domainUid + \"-\" + adminServerName;\n+    final String managedServerNameBase = \"wlst-ms-\";\n+    final int managedServerPort = 8001;\n+    final String managedServerPodNamePrefix = domainUid + \"-\" + managedServerNameBase;\n+    final int replicaCount = 2;\n+    final int t3ChannelPort = getNextFreePort(30000, 32767);\n+\n+    final String pvName = domainUid + \"-pv\";\n+    final String pvcName = domainUid + \"-pvc\";\n+\n+    // create pull secrets for jrfDomainNamespace when running in non Kind Kubernetes cluster\n+    if (isUseSecret) {\n+      createDockerRegistrySecret(OCR_USERNAME, OCR_PASSWORD,\n+          OCR_EMAIL, OCR_REGISTRY, OCR_SECRET_NAME, jrfDomainNamespace);\n+    }\n+\n+    // create JRF domain credential secret\n+    createSecretWithUsernamePassword(wlSecretName, jrfDomainNamespace,\n+        ADMIN_USERNAME_DEFAULT, ADMIN_PASSWORD_DEFAULT);\n+\n+    // create RCU credential secret\n+    CommonTestUtils.createRcuSecretWithUsernamePassword(rcuSecretName, jrfDomainNamespace,\n+        RCUSCHEMAUSERNAME, RCUSCHEMAPASSWORD, RCUSYSUSERNAME, RCUSYSPASSWORD);\n+\n+    // create persistent volume and persistent volume claim for domain\n+    CommonTestUtils.createPV(pvName, domainUid, this.getClass().getSimpleName());\n+    CommonTestUtils.createPVC(pvName, pvcName, domainUid, jrfDomainNamespace);\n+\n+    // create a temporary WebLogic domain property file\n+    File domainPropertiesFile = assertDoesNotThrow(() ->\n+            File.createTempFile(\"domain\", \"properties\"),\n+        \"Failed to create domain properties file\");\n+    Properties p = new Properties();\n+    p.setProperty(\"oracleHome\", \"/u01/oracle\"); //default $ORACLE_HOME\n+    p.setProperty(\"javaHome\", \"/u01/jdk\"); //default $JAVA_HOME\n+    p.setProperty(\"domainParentDir\", \"/shared/domains/\");\n+    p.setProperty(\"domainName\", domainUid);\n+    p.setProperty(\"domainUser\", ADMIN_USERNAME_DEFAULT);\n+    p.setProperty(\"domainPassword\", ADMIN_PASSWORD_DEFAULT);\n+    p.setProperty(\"rcuDb\", dbUrl);\n+    p.setProperty(\"rcuSchemaPrefix\", RCUSCHEMAPREFIX);\n+    p.setProperty(\"rcuSchemaPassword\", RCUSCHEMAPASSWORD);\n+    p.setProperty(\"adminListenPort\", \"7001\");\n+    p.setProperty(\"adminName\", adminServerName);\n+    p.setProperty(\"managedNameBase\", managedServerNameBase);\n+    p.setProperty(\"managedServerPort\",Integer.toString(managedServerPort));\n+    p.setProperty(\"prodMode\", \"true\");\n+    p.setProperty(\"managedCount\", \"4\");\n+    p.setProperty(\"clusterName\", clusterName);\n+    p.setProperty(\"t3ChannelPublicAddress\", K8S_NODEPORT_HOST);\n+    p.setProperty(\"t3ChannelPort\", Integer.toString(t3ChannelPort));\n+    p.setProperty(\"exposeAdminT3Channel\", \"true\");\n+\n+    assertDoesNotThrow(() ->\n+            p.store(new FileOutputStream(domainPropertiesFile), \"jrf wlst properties file\"),\n+        \"Failed to write domain properties file\");\n+\n+    // WLST script for creating domain\n+    Path wlstScript = Paths.get(RESOURCE_DIR, \"python-scripts\", \"jrf-wlst-create-domain-onpv.py\");\n+\n+    // create configmap and domain on persistent volume using the WLST script and property file\n+    createDomainOnPVUsingWlst(wlstScript, domainPropertiesFile.toPath(),\n+        pvName, pvcName, jrfDomainNamespace);\n+\n+    // create a domain custom resource configuration object\n+    logger.info(\"Creating domain custom resource\");\n+    Domain domain = new Domain()\n+        .apiVersion(DOMAIN_API_VERSION)\n+        .kind(\"Domain\")\n+        .metadata(new V1ObjectMeta()\n+            .name(domainUid)\n+            .namespace(jrfDomainNamespace))\n+        .spec(new DomainSpec()\n+            .domainUid(domainUid)\n+            .domainHome(\"/shared/domains/\" + domainUid)  // point to domain home in pv\n+            .domainHomeSourceType(\"PersistentVolume\") // set the domain home source type as pv\n+            .image(fmwImage)\n+            .imagePullPolicy(\"IfNotPresent\")\n+            .imagePullSecrets(isUseSecret ? Arrays.asList(\n+                new V1LocalObjectReference()\n+                    .name(OCR_SECRET_NAME))\n+                : null)\n+            .webLogicCredentialsSecret(new V1SecretReference()\n+                .name(wlSecretName)\n+                .namespace(jrfDomainNamespace))\n+            .includeServerOutInPodLog(true)\n+            .logHomeEnabled(Boolean.TRUE)\n+            .logHome(\"/shared/logs/\" + domainUid)\n+            .dataHome(\"\")\n+            .serverStartPolicy(\"IF_NEEDED\")\n+            .serverPod(new ServerPod() //serverpod\n+                .addEnvItem(new V1EnvVar()\n+                    .name(\"JAVA_OPTIONS\")\n+                    .value(\"-Dweblogic.StdoutDebugEnabled=false\"))\n+                .addEnvItem(new V1EnvVar()\n+                    .name(\"USER_MEM_ARGS\")\n+                    .value(\"-Djava.security.egd=file:/dev/./urandom \"))\n+                .addVolumesItem(new V1Volume()\n+                    .name(pvName)\n+                    .persistentVolumeClaim(new V1PersistentVolumeClaimVolumeSource()\n+                        .claimName(pvcName)))\n+                .addVolumeMountsItem(new V1VolumeMount()\n+                    .mountPath(\"/shared\")\n+                    .name(pvName)))\n+            .adminServer(new AdminServer() //admin server\n+                .serverStartState(\"RUNNING\")\n+                .adminService(new AdminService()\n+                    .addChannelsItem(new Channel()\n+                        .channelName(\"default\")\n+                        .nodePort(0))\n+                    .addChannelsItem(new Channel()\n+                        .channelName(\"T3Channel\")\n+                        .nodePort(t3ChannelPort))))\n+            .addClustersItem(new Cluster() //cluster\n+                .clusterName(clusterName)\n+                .replicas(replicaCount)\n+                .serverStartState(\"RUNNING\")));\n+\n+    // verify the domain custom resource is created\n+    createDomainAndVerify(domain, jrfDomainNamespace);\n+\n+    // verify admin server pod is ready\n+    checkPodReady(adminServerPodName, domainUid, jrfDomainNamespace);\n+\n+    // verify the admin server service created\n+    checkServiceExists(adminServerPodName, jrfDomainNamespace);\n+\n+    // verify managed server pods are ready\n+    for (int i = 1; i <= replicaCount; i++) {\n+      logger.info(\"Waiting for managed server pod {0} to be ready in namespace {1}\",\n+          managedServerPodNamePrefix + i, jrfDomainNamespace);\n+      checkPodReady(managedServerPodNamePrefix + i, domainUid, jrfDomainNamespace);\n+    }\n+\n+    // verify managed server services created\n+    for (int i = 1; i <= replicaCount; i++) {\n+      logger.info(\"Checking managed server service {0} is created in namespace {1}\",\n+          managedServerPodNamePrefix + i, jrfDomainNamespace);\n+      checkServiceExists(managedServerPodNamePrefix + i, jrfDomainNamespace);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1NzkxOQ=="}, "originalCommit": {"oid": "c97125d101994bf52db3ee6d7b2afb20e8c5c5e2"}, "originalPosition": 282}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3ODY5NjM2OnYy", "diffSide": "RIGHT", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/CommonTestUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDoxNjowNVrOGpTI8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxODo0NTo0MlrOGprKOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1ODM4NA==", "bodyText": "missing params sysUsername and sysPassword in javadoc", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1767#discussion_r445958384", "createdAt": "2020-06-26T04:16:05Z", "author": {"login": "sankarpn"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/CommonTestUtils.java", "diffHunk": "@@ -1080,6 +1105,31 @@ public static void createSecretWithUsernamePassword(String secretName,\n     assertTrue(secretCreated, String.format(\"create secret failed for %s\", secretName));\n   }\n \n+  /**\n+   * Create a RCU secret with username, password and sys_username, sys_password in the specified namespace.\n+   *\n+   * @param secretName secret name to create\n+   * @param namespace namespace in which the secret will be created\n+   * @param username username in the secret\n+   * @param password passowrd in the secret\n+   */\n+  public static void createRcuSecretWithUsernamePassword(String secretName, String namespace,\n+      String username, String password, String sysUsername, String sysPassword) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c97125d101994bf52db3ee6d7b2afb20e8c5c5e2"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MTkyOA==", "bodyText": "Fixed", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1767#discussion_r446351928", "createdAt": "2020-06-26T18:45:42Z", "author": {"login": "maggiehe00"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/CommonTestUtils.java", "diffHunk": "@@ -1080,6 +1105,31 @@ public static void createSecretWithUsernamePassword(String secretName,\n     assertTrue(secretCreated, String.format(\"create secret failed for %s\", secretName));\n   }\n \n+  /**\n+   * Create a RCU secret with username, password and sys_username, sys_password in the specified namespace.\n+   *\n+   * @param secretName secret name to create\n+   * @param namespace namespace in which the secret will be created\n+   * @param username username in the secret\n+   * @param password passowrd in the secret\n+   */\n+  public static void createRcuSecretWithUsernamePassword(String secretName, String namespace,\n+      String username, String password, String sysUsername, String sysPassword) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1ODM4NA=="}, "originalCommit": {"oid": "c97125d101994bf52db3ee6d7b2afb20e8c5c5e2"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3ODY5OTAyOnYy", "diffSide": "RIGHT", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/CommonTestUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDoxODoxNVrOGpTKlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxODo0NTo1OFrOGprKpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1ODgwNw==", "bodyText": "You need to get logger in each method it looks like.\nLoggingFacade logger = getLogger();", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1767#discussion_r445958807", "createdAt": "2020-06-26T04:18:15Z", "author": {"login": "sankarpn"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/CommonTestUtils.java", "diffHunk": "@@ -1660,8 +1710,223 @@ public static Path generateFileFromTemplate(\n     String out = targetFile.toString();\n     for (Map.Entry<String, String> entry : templateMap.entrySet()) {\n       logger.info(\"Replacing String {0} with the value {1}\", entry.getKey(), entry.getValue());\n-      replaceStringInFile(out, entry.getKey(), entry.getValue()); \n+      replaceStringInFile(out, entry.getKey(), entry.getValue());\n     }\n     return targetFile;\n   }\n+\n+  /**\n+  * Create a persistent volume.\n+   *\n+   * @param pvName name of the persistent volume to create\n+   * @param domainUid domain UID\n+   * @param className name of the class to call this method\n+   */\n+  public static void createPV(String pvName, String domainUid, String className) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c97125d101994bf52db3ee6d7b2afb20e8c5c5e2"}, "originalPosition": 138}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MjAzOQ==", "bodyText": "Done", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1767#discussion_r446352039", "createdAt": "2020-06-26T18:45:58Z", "author": {"login": "maggiehe00"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/CommonTestUtils.java", "diffHunk": "@@ -1660,8 +1710,223 @@ public static Path generateFileFromTemplate(\n     String out = targetFile.toString();\n     for (Map.Entry<String, String> entry : templateMap.entrySet()) {\n       logger.info(\"Replacing String {0} with the value {1}\", entry.getKey(), entry.getValue());\n-      replaceStringInFile(out, entry.getKey(), entry.getValue()); \n+      replaceStringInFile(out, entry.getKey(), entry.getValue());\n     }\n     return targetFile;\n   }\n+\n+  /**\n+  * Create a persistent volume.\n+   *\n+   * @param pvName name of the persistent volume to create\n+   * @param domainUid domain UID\n+   * @param className name of the class to call this method\n+   */\n+  public static void createPV(String pvName, String domainUid, String className) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1ODgwNw=="}, "originalCommit": {"oid": "c97125d101994bf52db3ee6d7b2afb20e8c5c5e2"}, "originalPosition": 138}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3ODY5OTg5OnYy", "diffSide": "RIGHT", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/CommonTestUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNDoxOTowNFrOGpTLJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxODo0NjowN1rOGprK6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1ODk0OQ==", "bodyText": "create logger, same applies for methods you are adding.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1767#discussion_r445958949", "createdAt": "2020-06-26T04:19:04Z", "author": {"login": "sankarpn"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/CommonTestUtils.java", "diffHunk": "@@ -1660,8 +1710,223 @@ public static Path generateFileFromTemplate(\n     String out = targetFile.toString();\n     for (Map.Entry<String, String> entry : templateMap.entrySet()) {\n       logger.info(\"Replacing String {0} with the value {1}\", entry.getKey(), entry.getValue());\n-      replaceStringInFile(out, entry.getKey(), entry.getValue()); \n+      replaceStringInFile(out, entry.getKey(), entry.getValue());\n     }\n     return targetFile;\n   }\n+\n+  /**\n+  * Create a persistent volume.\n+   *\n+   * @param pvName name of the persistent volume to create\n+   * @param domainUid domain UID\n+   * @param className name of the class to call this method\n+   */\n+  public static void createPV(String pvName, String domainUid, String className) {\n+    logger.info(\"creating persistent volume for pvName {0}, domainUid: {1}, className: {2}\",\n+        pvName, domainUid, className);\n+    Path pvHostPath = null;\n+    try {\n+      pvHostPath = Files.createDirectories(Paths.get(\n+          PV_ROOT, className, pvName));\n+      logger.info(\"Creating PV directory host path {0}\", pvHostPath);\n+      org.apache.commons.io.FileUtils.deleteDirectory(pvHostPath.toFile());\n+      Files.createDirectories(pvHostPath);\n+    } catch (IOException ioex) {\n+      logger.severe(ioex.getMessage());\n+      fail(\"Create persistent volume host path failed\");\n+    }\n+\n+    V1PersistentVolume v1pv = new V1PersistentVolume()\n+        .spec(new V1PersistentVolumeSpec()\n+            .addAccessModesItem(\"ReadWriteMany\")\n+            .storageClassName(\"weblogic-domain-storage-class\")\n+            .volumeMode(\"Filesystem\")\n+            .putCapacityItem(\"storage\", Quantity.fromString(\"5Gi\"))\n+            .persistentVolumeReclaimPolicy(\"Recycle\")\n+            .accessModes(Arrays.asList(\"ReadWriteMany\"))\n+            .hostPath(new V1HostPathVolumeSource()\n+                .path(pvHostPath.toString())))\n+        .metadata(new V1ObjectMeta()\n+            .name(pvName)\n+            .putLabelsItem(\"weblogic.resourceVersion\", \"domain-v2\")\n+            .putLabelsItem(\"weblogic.domainUid\", domainUid));\n+    boolean success = assertDoesNotThrow(() -> createPersistentVolume(v1pv),\n+        \"Failed to create persistent volume\");\n+    assertTrue(success, \"PersistentVolume creation failed\");\n+  }\n+\n+  /**\n+   * Create a persistent volume claim.\n+   *\n+   * @param pvName name of the persistent volume\n+   * @param pvcName name of the persistent volume claim to create\n+   * @param domainUid UID of the WebLogic domain\n+   * @param namespace name of the namespace in which to create the persistent volume claim\n+   */\n+  public static void createPVC(String pvName, String pvcName, String domainUid, String namespace) {\n+    logger.info(\"creating persistent volume claim for pvName {0}, pvcName {1}, \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c97125d101994bf52db3ee6d7b2afb20e8c5c5e2"}, "originalPosition": 181}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM1MjEwNQ==", "bodyText": "Done.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1767#discussion_r446352105", "createdAt": "2020-06-26T18:46:07Z", "author": {"login": "maggiehe00"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/CommonTestUtils.java", "diffHunk": "@@ -1660,8 +1710,223 @@ public static Path generateFileFromTemplate(\n     String out = targetFile.toString();\n     for (Map.Entry<String, String> entry : templateMap.entrySet()) {\n       logger.info(\"Replacing String {0} with the value {1}\", entry.getKey(), entry.getValue());\n-      replaceStringInFile(out, entry.getKey(), entry.getValue()); \n+      replaceStringInFile(out, entry.getKey(), entry.getValue());\n     }\n     return targetFile;\n   }\n+\n+  /**\n+  * Create a persistent volume.\n+   *\n+   * @param pvName name of the persistent volume to create\n+   * @param domainUid domain UID\n+   * @param className name of the class to call this method\n+   */\n+  public static void createPV(String pvName, String domainUid, String className) {\n+    logger.info(\"creating persistent volume for pvName {0}, domainUid: {1}, className: {2}\",\n+        pvName, domainUid, className);\n+    Path pvHostPath = null;\n+    try {\n+      pvHostPath = Files.createDirectories(Paths.get(\n+          PV_ROOT, className, pvName));\n+      logger.info(\"Creating PV directory host path {0}\", pvHostPath);\n+      org.apache.commons.io.FileUtils.deleteDirectory(pvHostPath.toFile());\n+      Files.createDirectories(pvHostPath);\n+    } catch (IOException ioex) {\n+      logger.severe(ioex.getMessage());\n+      fail(\"Create persistent volume host path failed\");\n+    }\n+\n+    V1PersistentVolume v1pv = new V1PersistentVolume()\n+        .spec(new V1PersistentVolumeSpec()\n+            .addAccessModesItem(\"ReadWriteMany\")\n+            .storageClassName(\"weblogic-domain-storage-class\")\n+            .volumeMode(\"Filesystem\")\n+            .putCapacityItem(\"storage\", Quantity.fromString(\"5Gi\"))\n+            .persistentVolumeReclaimPolicy(\"Recycle\")\n+            .accessModes(Arrays.asList(\"ReadWriteMany\"))\n+            .hostPath(new V1HostPathVolumeSource()\n+                .path(pvHostPath.toString())))\n+        .metadata(new V1ObjectMeta()\n+            .name(pvName)\n+            .putLabelsItem(\"weblogic.resourceVersion\", \"domain-v2\")\n+            .putLabelsItem(\"weblogic.domainUid\", domainUid));\n+    boolean success = assertDoesNotThrow(() -> createPersistentVolume(v1pv),\n+        \"Failed to create persistent volume\");\n+    assertTrue(success, \"PersistentVolume creation failed\");\n+  }\n+\n+  /**\n+   * Create a persistent volume claim.\n+   *\n+   * @param pvName name of the persistent volume\n+   * @param pvcName name of the persistent volume claim to create\n+   * @param domainUid UID of the WebLogic domain\n+   * @param namespace name of the namespace in which to create the persistent volume claim\n+   */\n+  public static void createPVC(String pvName, String pvcName, String domainUid, String namespace) {\n+    logger.info(\"creating persistent volume claim for pvName {0}, pvcName {1}, \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk1ODk0OQ=="}, "originalCommit": {"oid": "c97125d101994bf52db3ee6d7b2afb20e8c5c5e2"}, "originalPosition": 181}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4402, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}