{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3OTgwNzg5", "number": 2042, "title": "OWLS 85938 - Server lifecycle script changes to use domain.status.minimumReplicas when stopping/starting server", "bodyText": "OWLS 85938 - Server lifecycle script changes to use domain.status.minimumReplicas when allowReplicasBelowMinDynClusterSize is set to false. It also fixes a minor bug when setting server start policy to ALWAYS.\nThis change adds a check in stop script to see if replica count value is same as minimum replica count value and prevents script from incorrectly assuming that decreasing the replica count would shut down a server. Additionally, when replica count value of cluster is lower than minimum replica count, it resets the replica count value to minimum replica count value. This helps server start script to know the value of effective replica count.", "createdAt": "2020-11-09T19:12:19Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2042", "merged": true, "mergeCommit": {"oid": "42e68280c476c7d3aa25f5092631921d39b9467b"}, "closed": true, "closedAt": "2020-11-09T21:32:02Z", "author": {"login": "ankedia"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABda5iipgH2gAyNTE3OTgwNzg5OjljMWZjZGNmNjU3OGQ3MDhiNzlmZDY3ZTdmYmExYTM5OGE5NmFlNTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABda7BsfgFqTUyNjYzOTgwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9c1fcdcf6578d708b79fd67e7fba1a398a96ae58", "author": {"user": {"login": "ankedia", "name": "Anil Kedia"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9c1fcdcf6578d708b79fd67e7fba1a398a96ae58", "committedDate": "2020-11-09T19:01:35Z", "message": "OWLS-85938 - Server lifecycle script changes to check for minimum replicas and minor bug fix."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NjA5NzE1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2042#pullrequestreview-526609715", "createdAt": "2020-11-09T20:01:33Z", "commit": {"oid": "9c1fcdcf6578d708b79fd67e7fba1a398a96ae58"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NjEzNjEz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2042#pullrequestreview-526613613", "createdAt": "2020-11-09T20:07:06Z", "commit": {"oid": "9c1fcdcf6578d708b79fd67e7fba1a398a96ae58"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMDowNzowNlrOHv_qyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMDowNzowNlrOHv_qyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA4ODI2Nw==", "bodyText": "Maybe provide a little more detail:\nNot decreasing replica count: it is at its minimum. (See 'domain.spec.allowReplicasBelowMinDynClusterSize' and 'domain.status.clusters[].minimumReplicas' for details.)", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2042#discussion_r520088267", "createdAt": "2020-11-09T20:07:06Z", "author": {"login": "tbarnes-us"}, "path": "kubernetes/samples/scripts/domain-lifecycle/stopServer.sh", "diffHunk": "@@ -153,6 +154,16 @@ else\n   fi\n fi\n \n+if [[ -n \"${clusterName}\" && \"${keepReplicaConstant}\" == 'false' ]]; then\n+  # check if replica count can decrease below current value\n+  isReplicaCountEqualToMinReplicas \"${domainJson}\" \"${clusterName}\" replicasEqualsMinReplicas\n+  if [ \"${replicasEqualsMinReplicas}\" == 'true' ]; then\n+    printInfo \"Current replica count value is same as minimum number of replica count. \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c1fcdcf6578d708b79fd67e7fba1a398a96ae58"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dae3f14b1307d91d80e6576d4b5b757eea31804", "author": {"user": {"login": "ankedia", "name": "Anil Kedia"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6dae3f14b1307d91d80e6576d4b5b757eea31804", "committedDate": "2020-11-09T20:37:07Z", "message": "Provide more details in message when replica count is equal to min replicas."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NjM5ODA1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2042#pullrequestreview-526639805", "createdAt": "2020-11-09T20:45:31Z", "commit": {"oid": "6dae3f14b1307d91d80e6576d4b5b757eea31804"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3902, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}