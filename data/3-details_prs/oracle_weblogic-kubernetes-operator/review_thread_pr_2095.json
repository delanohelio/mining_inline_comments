{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MDY3MzE2", "number": 2095, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNjo0NDoxMVrOFEEh9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMzoyNVrOFEFS5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5ODEyODU0OnYy", "diffSide": "RIGHT", "path": "operator/src/main/resources/scripts/modelInImage.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNjo0NDoxMVrOIEA7Tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzowMzo0MlrOIEBuSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA4MDM5OQ==", "bodyText": "It'd be helpful to have a high level explanation of the encoding approach in this comment (the 'range' file's purpose, and the directory structure when it's not '0 0'...).", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#discussion_r541080399", "createdAt": "2020-12-11T16:44:11Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -514,6 +515,71 @@ function createModelDomain() {\n   trace \"Exiting createModelDomain\"\n }\n \n+\n+# Expands into the root directory the MII domain configuration, stored in one or more config maps\n+function restoreDomainConfig() {\n+  restoreEncodedTar \"domainzip.secure\" || return 1\n+\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh  || return 1\n+}\n+\n+# Expands into the root directory the MII primordial domain, stored in one or more config maps\n+function restorePrimordialDomain() {\n+  restoreEncodedTar \"primordial_domainzip.secure\" || return 1\n+}\n+\n+# Restores the specified directory, targz'ed and stored in one or more config maps after base 64 encoding", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d2cb146476385e6996d54c36830b96914e126b8"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5MzQ1MA==", "bodyText": "With your suggested change, I no longer need the range file, so I will remove the Java code that creates it.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#discussion_r541093450", "createdAt": "2020-12-11T17:03:42Z", "author": {"login": "russgold"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -514,6 +515,71 @@ function createModelDomain() {\n   trace \"Exiting createModelDomain\"\n }\n \n+\n+# Expands into the root directory the MII domain configuration, stored in one or more config maps\n+function restoreDomainConfig() {\n+  restoreEncodedTar \"domainzip.secure\" || return 1\n+\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh  || return 1\n+}\n+\n+# Expands into the root directory the MII primordial domain, stored in one or more config maps\n+function restorePrimordialDomain() {\n+  restoreEncodedTar \"primordial_domainzip.secure\" || return 1\n+}\n+\n+# Restores the specified directory, targz'ed and stored in one or more config maps after base 64 encoding", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA4MDM5OQ=="}, "originalCommit": {"oid": "1d2cb146476385e6996d54c36830b96914e126b8"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5ODE2NjUzOnYy", "diffSide": "RIGHT", "path": "operator/src/main/resources/scripts/modelInImage.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNjo1Mjo1NFrOIEBSRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzowMTowM1rOIEBn8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA4NjI3OA==", "bodyText": "Alternatively: cat ${OPERATOR_ROOT}/introspector*/${1} > /tmp/domain.secure.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#discussion_r541086278", "createdAt": "2020-12-11T16:52:54Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -514,6 +515,71 @@ function createModelDomain() {\n   trace \"Exiting createModelDomain\"\n }\n \n+\n+# Expands into the root directory the MII domain configuration, stored in one or more config maps\n+function restoreDomainConfig() {\n+  restoreEncodedTar \"domainzip.secure\" || return 1\n+\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh  || return 1\n+}\n+\n+# Expands into the root directory the MII primordial domain, stored in one or more config maps\n+function restorePrimordialDomain() {\n+  restoreEncodedTar \"primordial_domainzip.secure\" || return 1\n+}\n+\n+# Restores the specified directory, targz'ed and stored in one or more config maps after base 64 encoding\n+# args:\n+# $1 the name of the encoded file in the config map\n+function restoreEncodedTar() {\n+  cd / || return 1\n+  indexRange=\"$(getIndexRange $1)\"\n+  # shellcheck disable=SC2046\n+  cat $(buildConfigMapElements $1 $indexRange) > /tmp/domain.secure", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d2cb146476385e6996d54c36830b96914e126b8"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5MTgyNA==", "bodyText": "Thanks. That both simplifies the code and eliminates the need for the additional functions and their tests.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#discussion_r541091824", "createdAt": "2020-12-11T17:01:03Z", "author": {"login": "russgold"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -514,6 +515,71 @@ function createModelDomain() {\n   trace \"Exiting createModelDomain\"\n }\n \n+\n+# Expands into the root directory the MII domain configuration, stored in one or more config maps\n+function restoreDomainConfig() {\n+  restoreEncodedTar \"domainzip.secure\" || return 1\n+\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh  || return 1\n+}\n+\n+# Expands into the root directory the MII primordial domain, stored in one or more config maps\n+function restorePrimordialDomain() {\n+  restoreEncodedTar \"primordial_domainzip.secure\" || return 1\n+}\n+\n+# Restores the specified directory, targz'ed and stored in one or more config maps after base 64 encoding\n+# args:\n+# $1 the name of the encoded file in the config map\n+function restoreEncodedTar() {\n+  cd / || return 1\n+  indexRange=\"$(getIndexRange $1)\"\n+  # shellcheck disable=SC2046\n+  cat $(buildConfigMapElements $1 $indexRange) > /tmp/domain.secure", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA4NjI3OA=="}, "originalCommit": {"oid": "1d2cb146476385e6996d54c36830b96914e126b8"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5ODI0OTQ5OnYy", "diffSide": "RIGHT", "path": "operator/src/main/resources/scripts/modelInImage.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMjoyMVrOIECDGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMDo0OTowNVrOIFn60A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5ODc3Nw==", "bodyText": "@jshum2479 This is unrelated to Russ' enhancement, but shouldn't the old /tmp file be removed upon success? I assume it takes up a good amount of space.\ntar -xzf /tmp/domain.tar.gz || return 1\nrm /tmp/domain.tar.gz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#discussion_r541098777", "createdAt": "2020-12-11T17:12:21Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -514,6 +515,31 @@ function createModelDomain() {\n   trace \"Exiting createModelDomain\"\n }\n \n+\n+# Expands into the root directory the MII domain configuration, stored in one or more config maps\n+function restoreDomainConfig() {\n+  restoreEncodedTar \"domainzip.secure\" || return 1\n+\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh  || return 1\n+}\n+\n+# Expands into the root directory the MII primordial domain, stored in one or more config maps\n+function restorePrimordialDomain() {\n+  restoreEncodedTar \"primordial_domainzip.secure\" || return 1\n+}\n+\n+# Restores the specified directory, targz'ed and stored in one or more config maps after base 64 encoding\n+# args:\n+# $1 the name of the encoded file in the config map\n+function restoreEncodedTar() {\n+  cd / || return 1\n+  cat ${OPERATOR_ROOT}/introspector*/${1} > /tmp/domain.secure\n+  base64 -d \"/tmp/domain.secure\" > /tmp/domain.tar.gz || return 1\n+\n+  tar -xzf /tmp/domain.tar.gz || return 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aafd19d61e3ad5fb69405fca1302a720e6d19c32"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc2NzgyNA==", "bodyText": "modelInImage only affects the introspect pod which will go away anyway,  but since this method will be called in startServer.sh, we should clean up the specific file.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#discussion_r542767824", "createdAt": "2020-12-14T20:49:05Z", "author": {"login": "jshum2479"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -514,6 +515,31 @@ function createModelDomain() {\n   trace \"Exiting createModelDomain\"\n }\n \n+\n+# Expands into the root directory the MII domain configuration, stored in one or more config maps\n+function restoreDomainConfig() {\n+  restoreEncodedTar \"domainzip.secure\" || return 1\n+\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh  || return 1\n+}\n+\n+# Expands into the root directory the MII primordial domain, stored in one or more config maps\n+function restorePrimordialDomain() {\n+  restoreEncodedTar \"primordial_domainzip.secure\" || return 1\n+}\n+\n+# Restores the specified directory, targz'ed and stored in one or more config maps after base 64 encoding\n+# args:\n+# $1 the name of the encoded file in the config map\n+function restoreEncodedTar() {\n+  cd / || return 1\n+  cat ${OPERATOR_ROOT}/introspector*/${1} > /tmp/domain.secure\n+  base64 -d \"/tmp/domain.secure\" > /tmp/domain.tar.gz || return 1\n+\n+  tar -xzf /tmp/domain.tar.gz || return 1", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5ODc3Nw=="}, "originalCommit": {"oid": "aafd19d61e3ad5fb69405fca1302a720e6d19c32"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5ODI1MzgwOnYy", "diffSide": "RIGHT", "path": "operator/src/main/resources/scripts/modelInImage.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMzoyNVrOIECFnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMzoyNVrOIECFnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5OTQyMw==", "bodyText": "Append || return 1 to the cat...  (not strictly needed as the next line will fail if the cat fails)", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#discussion_r541099423", "createdAt": "2020-12-11T17:13:25Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -514,6 +515,31 @@ function createModelDomain() {\n   trace \"Exiting createModelDomain\"\n }\n \n+\n+# Expands into the root directory the MII domain configuration, stored in one or more config maps\n+function restoreDomainConfig() {\n+  restoreEncodedTar \"domainzip.secure\" || return 1\n+\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh  || return 1\n+}\n+\n+# Expands into the root directory the MII primordial domain, stored in one or more config maps\n+function restorePrimordialDomain() {\n+  restoreEncodedTar \"primordial_domainzip.secure\" || return 1\n+}\n+\n+# Restores the specified directory, targz'ed and stored in one or more config maps after base 64 encoding\n+# args:\n+# $1 the name of the encoded file in the config map\n+function restoreEncodedTar() {\n+  cd / || return 1\n+  cat ${OPERATOR_ROOT}/introspector*/${1} > /tmp/domain.secure", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aafd19d61e3ad5fb69405fca1302a720e6d19c32"}, "originalPosition": 46}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3811, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}