{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2Mzk3Mzcx", "number": 1998, "title": "Fix ENV variable setting in JRF domain in PV test class", "bodyText": "This PR is to set env variables in JRF domain in PV by grabbing the variables from docker image.\nTest result using image: phx.ocir.io/weblogick8s/stage/fmw-infrastructure:12.2.1.4\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/2517/testReport/\n(<10-19-2020 22:36:28>  <oracle.weblogic.kubernetes.ItJrfDomainInPV testJrfDomainInPvUsingWlst> <JAVA_HOME in image localhost:5000/weblogick8s/stage/fmw-infrastructure:12.2.1.4 is: /usr/java/jdk-8>)\nTest result using image: phx.ocir.io/weblogick8s/test-images/fmw-infrastructure:12.2.1.4\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/2545/testReport/\n(<JAVA_HOME in image localhost:5000/weblogick8s/test-images/fmw-infrastructure:12.2.1.4 is: /u01/jdk>)\nAfter addressing the review comments, Jenkins run passed at\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/2563/testReport/", "createdAt": "2020-10-20T01:54:12Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998", "merged": true, "mergeCommit": {"oid": "d447463be13c686480f9e0770a4a3d1caabbab07"}, "closed": true, "closedAt": "2020-10-21T21:48:52Z", "author": {"login": "maggiehe00"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTKo1dgH2gAyNTA2Mzk3MzcxOmMxMjNlMjFlZDc4Yzk3MWEyNDFkOTZjZjY2YTNhNWQzNWRiOGFiNzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUzLQ9gH2gAyNTA2Mzk3MzcxOmYwYmU1NzA2MjY5YzU5OGYzZWM5ODU3Njg0MDYxOGRiZWE2ZTdhOGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c123e21ed78c971a241d96cf66a3a5d35db8ab74", "author": {"user": {"login": "maggiehe00", "name": "Maggie He"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c123e21ed78c971a241d96cf66a3a5d35db8ab74", "committedDate": "2020-10-16T18:25:27Z", "message": "debug JAVA_HOME issue for fmw image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b65392692114355ac71f0e030d690a600346ec73", "author": {"user": {"login": "maggiehe00", "name": "Maggie He"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b65392692114355ac71f0e030d690a600346ec73", "committedDate": "2020-10-16T23:14:05Z", "message": "fix hard coded env var"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7410bfeb7d26eaaf19458dae5b686be723184980", "author": {"user": {"login": "maggiehe00", "name": "Maggie He"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7410bfeb7d26eaaf19458dae5b686be723184980", "committedDate": "2020-10-17T00:59:20Z", "message": "debugging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ff3c2bf04b4c9f313321053478ecf4fc25eb66d", "author": {"user": {"login": "maggiehe00", "name": "Maggie He"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8ff3c2bf04b4c9f313321053478ecf4fc25eb66d", "committedDate": "2020-10-17T03:48:23Z", "message": "debugging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b8c1d2824828116847d4285c96d2852fe6f260b", "author": {"user": {"login": "maggiehe00", "name": "Maggie He"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5b8c1d2824828116847d4285c96d2852fe6f260b", "committedDate": "2020-10-19T18:34:57Z", "message": "refactor the code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a7fff0c63252a23bac20e24e2c082dbbb2ddbfd", "author": {"user": {"login": "maggiehe00", "name": "Maggie He"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2a7fff0c63252a23bac20e24e2c082dbbb2ddbfd", "committedDate": "2020-10-19T18:40:14Z", "message": "delete the extra space line"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyODgzOTAw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#pullrequestreview-512883900", "createdAt": "2020-10-20T15:49:24Z", "commit": {"oid": "2a7fff0c63252a23bac20e24e2c082dbbb2ddbfd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNTo0OToyNFrOHlEo1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNTo0OToyNFrOHlEo1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYzNTM1MA==", "bodyText": "Can you check if the command is executed successfully or not by asserting the exit code or not null return string from exec command", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r508635350", "createdAt": "2020-10-20T15:49:24Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Docker.java", "diffHunk": "@@ -121,4 +125,26 @@ public static JsonObject createDockerConfigJson(String username, String password\n     configJsonObject.add(\"auths\", registryObject);\n     return configJsonObject;\n   }\n+\n+  /**\n+   * Get environment variable from docker image.\n+   * @param imageName image name\n+   * @param envVarName environment variable name\n+   * @return environment variable in the image\n+   */\n+  public static String getImageEnvVar(String imageName, String envVarName) {\n+    LoggingFacade logger = getLogger();\n+    String cmdToExecute = String.format(\"docker run %s /bin/bash -c 'echo \\\"$%s\\\"'\", imageName, envVarName);\n+    logger.info(\"getImageEnvVar with imageName: {0}, envVarName: {1}\", imageName, envVarName);\n+    ExecResult result = Command.withParams(\n+                              new CommandParams()\n+                                .command(cmdToExecute)\n+                                .saveResults(true)\n+                                .redirect(true)\n+                            ).executeAndReturnResult();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2a7fff0c63252a23bac20e24e2c082dbbb2ddbfd"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54d3fa2a63a939b63c9b63fae9ae614b7d317b36", "author": {"user": {"login": "maggiehe00", "name": "Maggie He"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/54d3fa2a63a939b63c9b63fae9ae614b7d317b36", "committedDate": "2020-10-20T19:06:15Z", "message": "Merge remote-tracking branch 'origin/develop' into jrfjava"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28ffbc4c9a6a7f2b5b9d3cf5da25f0e0f2546510", "author": {"user": {"login": "maggiehe00", "name": "Maggie He"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/28ffbc4c9a6a7f2b5b9d3cf5da25f0e0f2546510", "committedDate": "2020-10-20T20:17:08Z", "message": "address the review comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNzg5OTY1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#pullrequestreview-513789965", "createdAt": "2020-10-21T15:03:14Z", "commit": {"oid": "28ffbc4c9a6a7f2b5b9d3cf5da25f0e0f2546510"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MDczNDQ0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#pullrequestreview-514073444", "createdAt": "2020-10-21T18:44:19Z", "commit": {"oid": "28ffbc4c9a6a7f2b5b9d3cf5da25f0e0f2546510"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxODo0NDoxOVrOHl9rWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxODo0NDozMFrOHl9sAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU2OTg4MQ==", "bodyText": "you can assert for null", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r509569881", "createdAt": "2020-10-21T18:44:19Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -173,9 +176,16 @@ public void testJrfDomainInPvUsingWlst() {\n     File domainPropertiesFile = assertDoesNotThrow(() ->\n             File.createTempFile(\"domain\", \"properties\"),\n         \"Failed to create domain properties file\");\n+\n+    //get ENV variable from the image\n+    oracle_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28ffbc4c9a6a7f2b5b9d3cf5da25f0e0f2546510"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU3MDA0OQ==", "bodyText": "add assert for null", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r509570049", "createdAt": "2020-10-21T18:44:30Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -173,9 +176,16 @@ public void testJrfDomainInPvUsingWlst() {\n     File domainPropertiesFile = assertDoesNotThrow(() ->\n             File.createTempFile(\"domain\", \"properties\"),\n         \"Failed to create domain properties file\");\n+\n+    //get ENV variable from the image\n+    oracle_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\");\n+    logger.info(\"ORACLE_HOME in image {0} is: {1}\", FMWINFRA_IMAGE_TO_USE_IN_SPEC, oracle_home);\n+    java_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"JAVA_HOME\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28ffbc4c9a6a7f2b5b9d3cf5da25f0e0f2546510"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "857f2415386631dfcf07520c34b4273bfa366ef6", "author": {"user": {"login": "maggiehe00", "name": "Maggie He"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/857f2415386631dfcf07520c34b4273bfa366ef6", "committedDate": "2020-10-21T19:25:08Z", "message": "address the review comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTQyMjgx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#pullrequestreview-514142281", "createdAt": "2020-10-21T20:03:54Z", "commit": {"oid": "857f2415386631dfcf07520c34b4273bfa366ef6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDowMzo1NFrOHmB8Ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDowMzo1NFrOHmB8Ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYzOTY4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"envVar from image is null\");\n          \n          \n            \n                    \"envVar ORACLE_HOME from image is null\");", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r509639682", "createdAt": "2020-10-21T20:03:54Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -173,9 +176,20 @@ public void testJrfDomainInPvUsingWlst() {\n     File domainPropertiesFile = assertDoesNotThrow(() ->\n             File.createTempFile(\"domain\", \"properties\"),\n         \"Failed to create domain properties file\");\n+\n+    //get ENV variable from the image\n+    assertNotNull(getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\"),\n+        \"envVar from image is null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "857f2415386631dfcf07520c34b4273bfa366ef6"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTQyNjE2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#pullrequestreview-514142616", "createdAt": "2020-10-21T20:04:22Z", "commit": {"oid": "857f2415386631dfcf07520c34b4273bfa366ef6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDowNDoyMlrOHmB-TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDowNDoyMlrOHmB-TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY0MDI2OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"envVar from image is null\");\n          \n          \n            \n                    \"envVar JAVA_HOME from image is null\");", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r509640268", "createdAt": "2020-10-21T20:04:22Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -173,9 +176,20 @@ public void testJrfDomainInPvUsingWlst() {\n     File domainPropertiesFile = assertDoesNotThrow(() ->\n             File.createTempFile(\"domain\", \"properties\"),\n         \"Failed to create domain properties file\");\n+\n+    //get ENV variable from the image\n+    assertNotNull(getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\"),\n+        \"envVar from image is null\");\n+    oracle_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\");\n+    logger.info(\"ORACLE_HOME in image {0} is: {1}\", FMWINFRA_IMAGE_TO_USE_IN_SPEC, oracle_home);\n+    assertNotNull(getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"JAVA_HOME\"),\n+        \"envVar from image is null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "857f2415386631dfcf07520c34b4273bfa366ef6"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTQ0NjU4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#pullrequestreview-514144658", "createdAt": "2020-10-21T20:07:19Z", "commit": {"oid": "857f2415386631dfcf07520c34b4273bfa366ef6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0be5706269c598f3ec98576840618dbea6e7a8b", "author": {"user": {"login": "maggiehe00", "name": "Maggie He"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f0be5706269c598f3ec98576840618dbea6e7a8b", "committedDate": "2020-10-21T20:13:11Z", "message": "address the review comment"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4026, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}