{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwMzg4MDc0", "number": 1815, "title": "Fixes necessary for 2.6.0 to 3.0.0 upgrade", "bodyText": "Thank goodness @vanajamukkara tested the upgrade path again!\nI found and fixed a few problems:\n\nWhen the CRD replacement failed, you could only see the error message with FINE logging\nThe new schema version was added to the CRD in the wrong place\nFor the v1beta1 CRD version, we weren't updating the top-level version field\nWe were failing to mark the older schema versions as no longer being storage versions\nWe were failing to mark the new schema version as being the storage version\n\nWe were also seeing a problem with etcd complained that the updated CRD was \"too big\". The only solution to this was to change schema generation to not include descriptions from the built-in Kubernetes types that we reference. I compensated for this by referring to the kubectl explain documentation for those types.", "createdAt": "2020-07-16T17:57:12Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1815", "merged": true, "mergeCommit": {"oid": "54868a1135cf776c357d4f05226763b5398a1b7d"}, "closed": true, "closedAt": "2020-07-17T12:49:58Z", "author": {"login": "rjeberhard"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1gQLVAH2gAyNDUwMzg4MDc0OmIzZjQ4NzgyYTljNjFmNDEwNTI5MTBmMzU4N2I2NmM3YjFkNGM4ZDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1zLEZgFqTQ1MDYyMjY2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b3f48782a9c61f41052910f3587b66c7b1d4c8d0", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b3f48782a9c61f41052910f3587b66c7b1d4c8d0", "committedDate": "2020-07-16T14:38:42Z", "message": "Show failure status on 500 and other errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9ce0712c7f96b7352c21bef10e07312dfdb5fae", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e9ce0712c7f96b7352c21bef10e07312dfdb5fae", "committedDate": "2020-07-16T15:11:16Z", "message": "Report errors in CRD replace and create"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d0b595d901a61c36c36cbae0ebdb8ae7c819666", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1d0b595d901a61c36c36cbae0ebdb8ae7c819666", "committedDate": "2020-07-16T17:34:31Z", "message": "Several updates to CRD and CRD generation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMjAxNzQ3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1815#pullrequestreview-450201747", "createdAt": "2020-07-16T20:43:29Z", "commit": {"oid": "10a31c574746978ff78118a38a35e5423815f08f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca01dd4ba503c473ed24f0c6a0a2b98eb83542a4", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ca01dd4ba503c473ed24f0c6a0a2b98eb83542a4", "committedDate": "2020-07-16T22:52:23Z", "message": "Ignore null status following replace"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMjczMjgz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1815#pullrequestreview-450273283", "createdAt": "2020-07-16T23:04:50Z", "commit": {"oid": "c61d2f2c25a5df522577d5732f02aded146f875a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzowNDo1MFrOGy_uMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQyMzowNDo1MFrOGy_uMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEyNjAwMw==", "bodyText": "For 2.6 to 3.0 upgrade, I do expect the domain to be restarted.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1815#discussion_r456126003", "createdAt": "2020-07-16T23:04:50Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -157,6 +189,31 @@ private void upgradeOperator() throws Exception {\n     testClusterScaling(operator, domain, false);\n   }\n \n+  /**\n+   * Upgrades operator to develop branch by uninstalling old release operator\n+   * and installing latest operator.\n+   * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n+   */\n+  private void upgradeOperatorFrom2_6_0() throws Exception {\n+    operator.destroy();\n+    // Thread.sleep(30 * 1000);\n+    Map<String, Object> operatorMap = createOperatorMap(getNewSuffixCount(), true, \"\");\n+    operatorMap.put(\"namespace\", OP_NS);\n+    operatorMap.put(\"releaseName\", OP_DEP_NAME);\n+    operatorMap.put(\"serviceAccount\", OP_SA);\n+    operatorMap.put(\"externalRestEnabled\", true);\n+    operatorMap.put(\"javaLoggingLevel\", \"FINE\");\n+    List<String> domNs = new ArrayList<String>();\n+    domNs.add(DOM_NS);\n+    operatorMap.put(\"domainNamespaces\", domNs);\n+    operator = TestUtils.createOperator(operatorMap, Operator.RestCertType.LEGACY);\n+\n+    checkCrdVersion();\n+    checkDomainNotRestarted();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c61d2f2c25a5df522577d5732f02aded146f875a"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10a31c574746978ff78118a38a35e5423815f08f", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/10a31c574746978ff78118a38a35e5423815f08f", "committedDate": "2020-07-17T02:54:06Z", "message": "adding operator upgrade test for 2.6.0 to develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93de4c6096e35f6490123e1d6146297953517623", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/93de4c6096e35f6490123e1d6146297953517623", "committedDate": "2020-07-17T04:04:32Z", "message": "delete crd at the beginning of the test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d5427785a1196b96a353b0bb30bf7a296335b6a", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8d5427785a1196b96a353b0bb30bf7a296335b6a", "committedDate": "2020-07-17T04:10:12Z", "message": "fix checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c61d2f2c25a5df522577d5732f02aded146f875a", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c61d2f2c25a5df522577d5732f02aded146f875a", "committedDate": "2020-07-16T22:52:37Z", "message": "Merge branch 'upgrade-300' of https://github.com/oracle/weblogic-kubernetes-operator into upgrade-300"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f13a4f39fd72d85bc2a50c94a0e2181b34ba5698", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f13a4f39fd72d85bc2a50c94a0e2181b34ba5698", "committedDate": "2020-07-17T10:17:39Z", "message": "remove domain not restarted check and changes for 2.5.0 upgrade test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNjIyNjY3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1815#pullrequestreview-450622667", "createdAt": "2020-07-17T12:41:19Z", "commit": {"oid": "f13a4f39fd72d85bc2a50c94a0e2181b34ba5698"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4299, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}