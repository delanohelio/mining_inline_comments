{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5NDg2MTc2", "number": 1764, "title": "Owls 82147", "bodyText": "Include env vars in MII re-introspect MD5 checks so that the introspector job recreates the domain home if/when an environment variable changes between runs.", "createdAt": "2020-06-24T20:41:09Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1764", "merged": true, "mergeCommit": {"oid": "8b3fbd82a764ddf3cee360f41769eefb051ca45d"}, "closed": true, "closedAt": "2020-06-26T13:18:19Z", "author": {"login": "tbarnes-us"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcugJ6JgH2gAyNDM5NDg2MTc2OjMwYzU3Njk0MDc0MmViMDdiZDMyNGIzYmIwNWIxMTRlYTJkOGE4YzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvDGphAFqTQzODI4NjQ5Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "30c576940742eb07bd324b3bb05b114ea2d8a8c2", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/30c576940742eb07bd324b3bb05b114ea2d8a8c2", "committedDate": "2020-06-24T20:34:23Z", "message": "Detect env var change during MII re-instrospect (MD5 check)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3858434834cef7fceaf855dc8a9f6a783d87aa03", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3858434834cef7fceaf855dc8a9f6a783d87aa03", "committedDate": "2020-06-24T20:36:57Z", "message": "Merge remote-tracking branch 'origin/owls_82785' into owls_82785-owls_82147"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MDE1Mjc3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1764#pullrequestreview-437015277", "createdAt": "2020-06-24T21:20:53Z", "commit": {"oid": "3858434834cef7fceaf855dc8a9f6a783d87aa03"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MDY0NTYz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1764#pullrequestreview-437064563", "createdAt": "2020-06-24T23:05:37Z", "commit": {"oid": "3858434834cef7fceaf855dc8a9f6a783d87aa03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMzowNTozN1rOGomAKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMzowNTozN1rOGomAKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIxODg1Nw==", "bodyText": "Is the name of the environment variable alone sufficient, no need to have the value?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1764#discussion_r445218857", "createdAt": "2020-06-24T23:05:37Z", "author": {"login": "jshum2479"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/JobHelper.java", "diffHunk": "@@ -294,6 +294,16 @@ private String getAsServiceName() {\n         addEnvVar(vars, ServerEnvVars.DATA_HOME, dataHome);\n       }\n \n+      // Populate env var list used by the MII introspector job's 'short circuit' MD5\n+      // check. To prevent a false trip of the circuit breaker, the list must be the\n+      // same regardless of whether domainTopology == null.\n+      StringBuffer sb = new StringBuffer(vars.size() * 32);\n+      for (V1EnvVar var : vars) {\n+        sb.append(var.getName()).append(',');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3858434834cef7fceaf855dc8a9f6a783d87aa03"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MDY3NzM5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1764#pullrequestreview-437067739", "createdAt": "2020-06-24T23:14:13Z", "commit": {"oid": "3858434834cef7fceaf855dc8a9f6a783d87aa03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMzoxNDoxM1rOGomKhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMzoxNDoxM1rOGomKhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIyMTUwOA==", "bodyText": "We can probably enhance WDT to take file.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1764#discussion_r445221508", "createdAt": "2020-06-24T23:14:13Z", "author": {"login": "jshum2479"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -245,6 +245,7 @@ function buildWDTParams_MD5() {\n          \" but the secret does not have this key.\"\n       exit 1\n     else\n+      # TBD code review comment: pass credentials via filename instead of risking putting them in an env var", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3858434834cef7fceaf855dc8a9f6a783d87aa03"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MDk2Njcz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1764#pullrequestreview-437096673", "createdAt": "2020-06-25T00:41:29Z", "commit": {"oid": "3858434834cef7fceaf855dc8a9f6a783d87aa03"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwMDo0MToyOVrOGonsBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwMDo0MToyOVrOGonsBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI0NjQ3MQ==", "bodyText": "I think Tom added that for a reason. At one point in early stage of MII,  I use it for dynamic update - i.e. the job pod will use wlst online to update configuration.  That's one reason I can think of.  util.sh also has a function using it.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1764#discussion_r445246471", "createdAt": "2020-06-25T00:41:29Z", "author": {"login": "jshum2479"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/JobHelper.java", "diffHunk": "@@ -305,10 +315,6 @@ private String getAsServiceName() {\n           addEnvVar(vars, \"ADMIN_PORT_SECURE\", \"true\");\n         }\n         addEnvVar(vars, \"AS_SERVICE_NAME\", getAsServiceName());\n-\n-        // TBD Tom Barnes, Johnny Shum", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3858434834cef7fceaf855dc8a9f6a783d87aa03"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3Mzk5MjAw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1764#pullrequestreview-437399200", "createdAt": "2020-06-25T11:22:12Z", "commit": {"oid": "3858434834cef7fceaf855dc8a9f6a783d87aa03"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMToyMjoxMlrOGo2Wmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxMTo0ODoyN1rOGo3HPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ4Njc0Nw==", "bodyText": "The method name implies that it is only matching the name, but it is actually matching the name and value. It should be named in a way that makes it clear what is happening. Simple \"envVar\" would probably be a more readable choice.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1764#discussion_r445486747", "createdAt": "2020-06-25T11:22:12Z", "author": {"login": "russgold"}, "path": "operator/src/test/java/oracle/kubernetes/operator/helpers/Matchers.java", "diffHunk": "@@ -165,29 +170,63 @@ public void describeTo(Description description) {\n   }\n \n   static class EnvVarMatcher extends TypeSafeDiagnosingMatcher<V1EnvVar> {\n+    private static final String DONTCARE = \"SENTINEL_DONT_CARE\";\n     private final String expectedName;\n+    private final String expectedValueRegEx;\n \n     private EnvVarMatcher(String expectedName) {\n       this.expectedName = expectedName;\n+      this.expectedValueRegEx = DONTCARE;\n+    }\n+\n+    private EnvVarMatcher(String expectedName, String expectedValueRegEx) {\n+      this.expectedName = expectedName;\n+      this.expectedValueRegEx = expectedValueRegEx;\n     }\n \n     static EnvVarMatcher envVarWithName(@Nonnull String name) {\n       return new EnvVarMatcher(name);\n     }\n \n+    static EnvVarMatcher envVarWithName(@Nonnull String name, String value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3858434834cef7fceaf855dc8a9f6a783d87aa03"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ5MTk4Mg==", "bodyText": "So this is the name of an environment variable whose value is a comma-separated list of environment variable names? That's far from obvious. At the very least, please include a Javadoc comment explaining that.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1764#discussion_r445491982", "createdAt": "2020-06-25T11:33:26Z", "author": {"login": "russgold"}, "path": "operator/src/test/java/oracle/kubernetes/operator/helpers/JobHelperTest.java", "diffHunk": "@@ -78,6 +79,7 @@\n   private static final String DOMAIN_UID = \"JobHelperTestDomain\";\n   private static final String RAW_VALUE_1 = \"find uid1 at $(DOMAIN_HOME)\";\n   private static final String END_VALUE_1 = \"find uid1 at /u01/oracle/user_projects/domains\";\n+  private static final String OSEV = \"OPERATOR_SUPPLIED_ENV_VARS\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3858434834cef7fceaf855dc8a9f6a783d87aa03"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ5OTE5OA==", "bodyText": "\"hasEnvVarContains\" is a confusing name. It is not checking to see if it has a \"envVarContains,\" but rather whether the special env var OSEV includes the specified name in a list, correct? I had to do a fair amount of searching through the code even to come up with that suggestion.\nI would suggest then, that the actual test needs to be explicit. That is, fetch the envVar and check its contents. Among other things, you are testing that this envVar does not contain an entry for the admin user and password, but the matcher not(hasEnvVarContains(OSEV, \"ADMIN_PASSWORD\")) could easily be satisfied if there is no envVar whose name matches OSEV.\nTo make it easier to read, I would suggest an assertion such as:\nassertThat(getOSEVValues(), allOf(hasItem(configMapKeyRefEnvVar.getName()), etc.\nwhere getOSEVValues() returns a (possibly empty) list of the names in the OSEV variable.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1764#discussion_r445499198", "createdAt": "2020-06-25T11:48:27Z", "author": {"login": "russgold"}, "path": "operator/src/test/java/oracle/kubernetes/operator/helpers/JobHelperTest.java", "diffHunk": "@@ -351,6 +392,13 @@ public void whenAdminServerHasValueFromEnvironmentItems_introspectorPodStartupWi\n             hasItem(configMapKeyRefEnvVar),\n             hasItem(secretKeyRefEnvVar),\n             hasItem(fieldRefEnvVar)));\n+\n+    assertThat(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3858434834cef7fceaf855dc8a9f6a783d87aa03"}, "originalPosition": 116}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a27c3feff38adde8282a55e8ec214cf3ce849cdf", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a27c3feff38adde8282a55e8ec214cf3ce849cdf", "committedDate": "2020-06-25T15:20:20Z", "message": "Merge remote-tracking branch 'origin/owls_82785' into owls_82785-owls_82147"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ba48b5806f5516e74e65490d0617bc5eee2c3d5", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6ba48b5806f5516e74e65490d0617bc5eee2c3d5", "committedDate": "2020-06-25T20:06:18Z", "message": "Merge remote-tracking branch 'origin/owls_82785' into owls_82785-owls_82147"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99b242d0e4d0b1e5a62779741b7fac8778b92ea9", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/99b242d0e4d0b1e5a62779741b7fac8778b92ea9", "committedDate": "2020-06-26T05:25:38Z", "message": "minor changes: change env var name, add comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aefdbf95d7f95aa68263005dd96569026b791efe", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/aefdbf95d7f95aa68263005dd96569026b791efe", "committedDate": "2020-06-26T05:51:40Z", "message": "minor change: change method name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f821ce508f69570c5628cc9ce7225207dbf066b6", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f821ce508f69570c5628cc9ce7225207dbf066b6", "committedDate": "2020-06-26T07:07:54Z", "message": "minor changes: unit test helper renames, etc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Mjc2NjI2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1764#pullrequestreview-438276626", "createdAt": "2020-06-26T13:03:52Z", "commit": {"oid": "f821ce508f69570c5628cc9ce7225207dbf066b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Mjg2NDk2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1764#pullrequestreview-438286496", "createdAt": "2020-06-26T13:17:30Z", "commit": {"oid": "f821ce508f69570c5628cc9ce7225207dbf066b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4590, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}