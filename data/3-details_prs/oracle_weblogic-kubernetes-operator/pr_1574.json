{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MTg1NDE3", "number": 1574, "title": "Always use the latest release of WDT and Image Tool", "bodyText": "Find out the release number of the latest WDT/ImageTool, and use it as the version to use.", "createdAt": "2020-04-17T15:02:46Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574", "merged": true, "mergeCommit": {"oid": "394e57de3cf3d58174c26cf769e01e9e2b2b0761"}, "closed": true, "closedAt": "2020-04-21T20:26:38Z", "author": {"login": "doxiao"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYPrY7AH2gAyNDA1MTg1NDE3OmJmMjE2OGNiOTY5MTFmOTg5NGVkMGUyM2Q2MzU3ODkxZDFjZTlkZDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZ5rQ5AFqTM5NzY0ODkxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bf2168cb96911f9894ed0e23d6357891d1ce9dd5", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/bf2168cb96911f9894ed0e23d6357891d1ce9dd5", "committedDate": "2020-04-16T16:56:14Z", "message": "Initial changes for getting the latest version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e8350f9afbe5695fc1e56d5e5087f633e7836d0", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6e8350f9afbe5695fc1e56d5e5087f633e7836d0", "committedDate": "2020-04-17T01:57:01Z", "message": "Get the version number of the latest release of the tools"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ba62738a4cc570402e061846875c3721e2eb787", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9ba62738a4cc570402e061846875c3721e2eb787", "committedDate": "2020-04-17T01:58:57Z", "message": "Merge remote-tracking branch 'origin/develop' into use-latest-tools"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e4b76c2bcb09efb28e9e171085657d59b005b05", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5e4b76c2bcb09efb28e9e171085657d59b005b05", "committedDate": "2020-04-17T14:26:56Z", "message": "Minor updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c02cc41b844df77aca1e323945e5e03f5823ecf", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1c02cc41b844df77aca1e323945e5e03f5823ecf", "committedDate": "2020-04-17T14:59:42Z", "message": "Minor change in error handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1ODE2OTIy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574#pullrequestreview-395816922", "createdAt": "2020-04-17T22:58:56Z", "commit": {"oid": "1c02cc41b844df77aca1e323945e5e03f5823ecf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMjo1ODo1NlrOGHfW6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMjo1ODo1NlrOGHfW6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwNjk4NA==", "bodyText": "Dongbo, can you give details of when WIT returned a 0 exit code even though image creation failed?  Our tests should not work around bugs in the product.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574#discussion_r410506984", "createdAt": "2020-04-17T22:58:56Z", "author": {"login": "rjeberhard"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Command.java", "diffHunk": "@@ -46,12 +46,24 @@ public boolean execute() {\n           params.command(), \n           params.redirect(),\n           params.env());\n-      if (result.exitValue() != 0) {\n-        logger.warning(\"The command execution failed with the result: {0}\", result);\n+      if (params.saveStdOut()) {\n+        params.stdOut(result.stdout());\n+      }\n+\n+      // check both exitValue and stderr since sometimes the exitValue was 0 even when\n+      // the test execution failed.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c02cc41b844df77aca1e323945e5e03f5823ecf"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1ODE3NTQz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574#pullrequestreview-395817543", "createdAt": "2020-04-17T23:01:11Z", "commit": {"oid": "1c02cc41b844df77aca1e323945e5e03f5823ecf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMzowMToxMVrOGHfZBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMzowMToxMVrOGHfZBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwNzUyNg==", "bodyText": "I don't understand what this check is ensuring.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574#discussion_r410507526", "createdAt": "2020-04-17T23:01:11Z", "author": {"login": "rjeberhard"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Installer.java", "diffHunk": "@@ -80,13 +85,23 @@ private Installer params(InstallParams params) {\n    * @return true if the command succeeds \n    */\n   public boolean download() {\n+ \n     boolean downloadSucceeded = true;\n     boolean unzipSucceeded = true;\n     if (params.verify()\n         && new File(DOWNLOAD_DIR, params.fileName()).exists()) {\n       logger.info(\"File {0} already exists.\", params.fileName());\n     } else {\n+      // check and make sure DOWNLOAD_DIR exists; will create it if it is missing\n       checkDirectory(DOWNLOAD_DIR);\n+      \n+      // we check if we get the version of the tool correctly first\n+      if (params.version() == null \n+          || params.version().length() == 0\n+          || params.version().equalsIgnoreCase(\"latest\")) {\n+        logger.severe(\"Failed to get the latest version of {0}\", params.type());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c02cc41b844df77aca1e323945e5e03f5823ecf"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1ODE3ODk0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574#pullrequestreview-395817894", "createdAt": "2020-04-17T23:02:26Z", "commit": {"oid": "1c02cc41b844df77aca1e323945e5e03f5823ecf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMzowMjoyN1rOGHfZ_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMzowMjoyN1rOGHfZ_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwNzc3Mg==", "bodyText": "This looks like a simple fluent getter but is doing a lot more.  Let's make the method more descriptive of what is going on.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574#discussion_r410507772", "createdAt": "2020-04-17T23:02:27Z", "author": {"login": "rjeberhard"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/InstallParams.java", "diffHunk": "@@ -49,6 +49,7 @@ public InstallParams version(String version) {\n   }\n \n   public String version() {\n+    version = Installer.getActualVersionIfNeeded(location, type, version);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c02cc41b844df77aca1e323945e5e03f5823ecf"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1ODE3OTY3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574#pullrequestreview-395817967", "createdAt": "2020-04-17T23:02:42Z", "commit": {"oid": "1c02cc41b844df77aca1e323945e5e03f5823ecf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMzowMjo0MlrOGHfaNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMzowMjo0MlrOGHfaNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwNzgyOA==", "bodyText": "javadoc", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574#discussion_r410507828", "createdAt": "2020-04-17T23:02:42Z", "author": {"login": "rjeberhard"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Installer.java", "diffHunk": "@@ -122,4 +137,45 @@ private String buildDownloadCommand() {\n         params.fileName());\n     return command;\n   }\n+\n+  // Figure out the actual release number of the latest", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c02cc41b844df77aca1e323945e5e03f5823ecf"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1ODE4Mzcx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574#pullrequestreview-395818371", "createdAt": "2020-04-17T23:04:14Z", "commit": {"oid": "1c02cc41b844df77aca1e323945e5e03f5823ecf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMzowNDoxNFrOGHfbtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMzowNDoxNFrOGHfbtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwODIxNA==", "bodyText": "What does it mean to return null here?  If the command fails isn't that a bigger issue?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574#discussion_r410508214", "createdAt": "2020-04-17T23:04:14Z", "author": {"login": "rjeberhard"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Installer.java", "diffHunk": "@@ -122,4 +137,45 @@ private String buildDownloadCommand() {\n         params.fileName());\n     return command;\n   }\n+\n+  // Figure out the actual release number of the latest\n+  static String getActualVersionIfNeeded(\n+      String location,\n+      String type,\n+      String version\n+  ) {\n+    if (version == null || version.equalsIgnoreCase(\"latest\")) {\n+      String command = String.format(\n+          \"curl -fL %s/releases/latest -o %s/%s-%s\", \n+          location,\n+          DOWNLOAD_DIR,\n+          type,\n+          TMP_FILE_NAME);\n+      \n+      if (!Command.withParams(defaultCommandParams().command(command)).execute()) {\n+        return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c02cc41b844df77aca1e323945e5e03f5823ecf"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1ODE4NDU3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574#pullrequestreview-395818457", "createdAt": "2020-04-17T23:04:30Z", "commit": {"oid": "1c02cc41b844df77aca1e323945e5e03f5823ecf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMzowNDozMFrOGHfb-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMzowNDozMFrOGHfb-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwODI4MQ==", "bodyText": "Same comment", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574#discussion_r410508281", "createdAt": "2020-04-17T23:04:30Z", "author": {"login": "rjeberhard"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Installer.java", "diffHunk": "@@ -122,4 +137,45 @@ private String buildDownloadCommand() {\n         params.fileName());\n     return command;\n   }\n+\n+  // Figure out the actual release number of the latest\n+  static String getActualVersionIfNeeded(\n+      String location,\n+      String type,\n+      String version\n+  ) {\n+    if (version == null || version.equalsIgnoreCase(\"latest\")) {\n+      String command = String.format(\n+          \"curl -fL %s/releases/latest -o %s/%s-%s\", \n+          location,\n+          DOWNLOAD_DIR,\n+          type,\n+          TMP_FILE_NAME);\n+      \n+      if (!Command.withParams(defaultCommandParams().command(command)).execute()) {\n+        return null;\n+      }\n+\n+      command = String.format(\n+          \"cat %s/%s-%s | grep 'releases/download' | awk '{ split($0,a,/href=\\\"/);%s | %s\", \n+          DOWNLOAD_DIR, \n+          type, \n+          TMP_FILE_NAME, \n+          \" print a[2] }'\", \n+          \" cut -d/ -f 6\"); \n+    \n+      CommandParams params = \n+          defaultCommandParams()\n+          .command(command)\n+          .saveStdOut(true)\n+          .redirect(true);\n+\n+      if (Command.withParams(params).execute()) {\n+        return params.stdOut();\n+      } else {\n+        return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c02cc41b844df77aca1e323945e5e03f5823ecf"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1caee0ac01d28d7b0530a38592ef499597993ae", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a1caee0ac01d28d7b0530a38592ef499597993ae", "committedDate": "2020-04-20T14:53:18Z", "message": "Remove additional checks of the stderr on command execution result and add javadoc to the new method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b7af19ec9e0b365801eec60d0ef6889c0d5f8d5", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6b7af19ec9e0b365801eec60d0ef6889c0d5f8d5", "committedDate": "2020-04-20T17:51:30Z", "message": "Change return null to throw runtime exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "002eceee4069ab5d26259feeb38c98fdb5417ee4", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/002eceee4069ab5d26259feeb38c98fdb5417ee4", "committedDate": "2020-04-20T17:57:41Z", "message": "Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d47316f3c9178966c0ddd463345f428a4f6fb485", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d47316f3c9178966c0ddd463345f428a4f6fb485", "committedDate": "2020-04-20T18:07:10Z", "message": "Merge remote-tracking branch 'origin/develop' into use-latest-tools"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTQ3Mjgy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574#pullrequestreview-397547282", "createdAt": "2020-04-21T18:02:01Z", "commit": {"oid": "d47316f3c9178966c0ddd463345f428a4f6fb485"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NjQ4OTEz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1574#pullrequestreview-397648913", "createdAt": "2020-04-21T20:26:02Z", "commit": {"oid": "d47316f3c9178966c0ddd463345f428a4f6fb485"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4650, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}