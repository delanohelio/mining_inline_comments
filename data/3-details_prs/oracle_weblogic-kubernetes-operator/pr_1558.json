{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNjgzMDQy", "number": 1558, "title": "Log level review and change status from using patch to using endpoint", "bodyText": "This work started after my observation that the operator logs were cluttered with too much \"stream of consciousness\" that obscured important behavior.  Similarly, failures were hard to triage since messages about async responses were not correlated with the requests.\nTherefore, my initial intention was simply to adjust the log level of messages -- that is, move some log messages from INFO to FINE and vice-versa. However, I quickly found that more was needed as domain status updates were consistently failing and (as noted above) async response failures didn't include information about the request.\nIn order to fix the domain status update, I've decided to propose a non-backward compatible change...  I've modified our CRD to enable the status subresource: https://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/#status-subresource.  This means that the k8s REST API will expose a \"/status\" subresource for our domain resources specifically for updating the status stanza of the document. This is non-backward compatible because if an operator of version 2.5.0 was running in the same Kubernetes cluster as an operator of version 3.0.0, then the version 2.5.0 operator would be unable to update the status of domains.  I'm proposing we make this change now because 1) we wanted to do this at some point, so 3.0.0 makes sense, and 2) the domain status updating using the patch operation was working so inconsistently that it could not be relied upon.\nThis change includes markers for two \"TODO's\" that I thought are too large for this PR.", "createdAt": "2020-04-13T14:58:04Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1558", "merged": true, "mergeCommit": {"oid": "7ba0463f15e658f1ec3c1083b7bc8a8185791ab2"}, "closed": true, "closedAt": "2020-04-15T13:46:19Z", "author": {"login": "rjeberhard"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcWk6fQgH2gAyNDAyNjgzMDQyOjdlMDg0OTA5YmM3NjdkNWRhMGMzMzA3MTEwNWY5Zjk5YjFiYjVlYjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX4KBLAH2gAyNDAyNjgzMDQyOmE2YTM4NDNmMzYyM2E1MThlNjI4NzZiM2E1M2JlMWJkMDk3MjQyMzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7e084909bc767d5da0c33071105f9f99b1bb5eb7", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7e084909bc767d5da0c33071105f9f99b1bb5eb7", "committedDate": "2020-04-11T12:32:53Z", "message": "Review log message levels and include details about request when an async call fails"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a241b63a408d91c12d9462988ad257f37729824", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8a241b63a408d91c12d9462988ad257f37729824", "committedDate": "2020-04-12T17:16:03Z", "message": "Use status endpoint rather than patch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfbf6a6e20d968b7e86a57730335d116ed383f3b", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/dfbf6a6e20d968b7e86a57730335d116ed383f3b", "committedDate": "2020-04-13T11:32:42Z", "message": "Record work for other PR's"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8acf186cb23baa1897adc159d3d784d4fc7ee26d", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8acf186cb23baa1897adc159d3d784d4fc7ee26d", "committedDate": "2020-04-13T12:39:20Z", "message": "Continue adjusting log levels"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d0fe3cb7f40ab2c6f5f0ca3703b8e9081e8a467", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6d0fe3cb7f40ab2c6f5f0ca3703b8e9081e8a467", "committedDate": "2020-04-13T14:15:51Z", "message": "Fix exception display and retry on domain status"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8db2d46f9cd0548f773c95078df321273bd5f8de", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8db2d46f9cd0548f773c95078df321273bd5f8de", "committedDate": "2020-04-13T15:01:20Z", "message": "Update FailureStatusSourceException.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26a9421ed1d9daf4117c9b710dac2b26613e1840", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/26a9421ed1d9daf4117c9b710dac2b26613e1840", "committedDate": "2020-04-13T15:02:00Z", "message": "Update OtherUnrecoverableErrorBuilder.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMjUzNDc5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1558#pullrequestreview-392253479", "createdAt": "2020-04-13T16:21:31Z", "commit": {"oid": "26a9421ed1d9daf4117c9b710dac2b26613e1840"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNjoyMTozMlrOGEr7Pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNjoyMTozMlrOGEr7Pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU2NzE2Ng==", "bodyText": "There is a getFormattedMessage() method in the same class that does the same thing, but with less error checking. We can get rid of that method and replace usages with this new method instead.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1558#discussion_r407567166", "createdAt": "2020-04-13T16:21:32Z", "author": {"login": "alai8"}, "path": "operator/src/main/java/oracle/kubernetes/operator/logging/LoggingFacade.java", "diffHunk": "@@ -651,6 +652,36 @@ public String getFormattedMessage(String msg, Object... args) {\n     }\n   }\n \n+  /**\n+   * Accessor for the resource bundle backing this logger.\n+   * @return the bundle\n+   */\n+  public ResourceBundle getResourceBundle() {\n+    for (Logger l = getUnderlyingLogger(); l != null; l = l.getParent()) {\n+      ResourceBundle rb = l.getResourceBundle();\n+      if (rb != null) {\n+        return rb;\n+      }\n+    }\n+    throw new AssertionError(formatMessage(MessageKeys.RESOURCE_BUNDLE_NOT_FOUND));\n+  }\n+\n+  /**\n+   * Formats message based on string loaded from the resource bundle backing this logger.\n+   * @param msgId Message id\n+   * @param params Parameters to message formatting\n+   * @return Formatted message\n+   */\n+  public String formatMessage(String msgId, Object... params) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26a9421ed1d9daf4117c9b710dac2b26613e1840"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "802dc1609e14f1588e8c9d86396295859a61729d", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/802dc1609e14f1588e8c9d86396295859a61729d", "committedDate": "2020-04-13T16:35:48Z", "message": "Reconcile logger change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f195c51a59804113f6268ad754db042938a4db3", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6f195c51a59804113f6268ad754db042938a4db3", "committedDate": "2020-04-13T16:36:14Z", "message": "Merge branch 'log-review2' of https://github.com/oracle/weblogic-kubernetes-operator into log-review2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d426b905673543f4db918629776bcfd88d81801", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4d426b905673543f4db918629776bcfd88d81801", "committedDate": "2020-04-13T21:22:53Z", "message": "Merge remote-tracking branch 'origin/develop' into log-review2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "915cdd93021744a71845daf35e5a3e30c8880f1d", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/915cdd93021744a71845daf35e5a3e30c8880f1d", "committedDate": "2020-04-15T09:38:25Z", "message": "Merge remote-tracking branch 'origin/develop' into log-review2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNjk0NjI5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1558#pullrequestreview-393694629", "createdAt": "2020-04-15T11:41:53Z", "commit": {"oid": "915cdd93021744a71845daf35e5a3e30c8880f1d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMTo0MTo1M1rOGF11wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMTo0MTo1M1rOGF11wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc3ODE3Ng==", "bodyText": "what does this mean? which is evaluated first the or, or the elvis?\nis that what you intended?\nseems like some parens here would help future generations greatly", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1558#discussion_r408778176", "createdAt": "2020-04-15T11:41:53Z", "author": {"login": "markxnelson"}, "path": "operator/src/main/java/oracle/kubernetes/operator/calls/RequestParams.java", "diffHunk": "@@ -46,4 +51,31 @@ public RequestParams(\n   public String getLabelSelector() {\n     return callParams.getLabelSelector();\n   }\n+\n+  public String toString() {\n+    return toString(true);\n+  }\n+\n+  /**\n+   * Create readable details of request, optionally including the request body.\n+   * @param includeBody true if request body should be included\n+   * @return readable details of the request\n+   */\n+  public String toString(boolean includeBody) {\n+    StringBuilder sb = new StringBuilder();\n+    sb.append(call);\n+    if (namespace != null) {\n+      sb.append(' ');\n+      sb.append(LOGGER.formatMessage(MessageKeys.REQUEST_PARAMS_IN_NS, namespace));\n+    }\n+    if (name != null) {\n+      sb.append(namespace != null ? \", \" : \" \");\n+      sb.append(LOGGER.formatMessage(MessageKeys.REQUEST_PARAMS_FOR_NAME, name));\n+    }\n+    if (includeBody && body != null) {\n+      sb.append(namespace != null || name != null ? \", \" : \" \");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "915cdd93021744a71845daf35e5a3e30c8880f1d"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6a3843f3623a518e62876b3a53be1bd09724238", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a6a3843f3623a518e62876b3a53be1bd09724238", "committedDate": "2020-04-15T13:31:58Z", "message": "Review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 29, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}