{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MDY3MzE2", "number": 2095, "title": "Split MII zips across Config Maps", "bodyText": "Under some conditions, the zips generated by an MII domain may be too large to fit in a single config map, which has a total limit of 1 MB. To address that, this PR includes code to split the encoded archives across multiple config maps as needed, and reassemble them as part of starting up the server.\nAs this requires changes to the shell scripts, this PR also includes a new Maven mojo to run bash unit tests, using shunit2.\nNote: the mojo is not unique to this project and contains no Oracle-proprietary code. Since other projects may wish to unit tests scripts, we should look into releasing the plugin separately in the future.", "createdAt": "2020-12-10T16:36:40Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095", "merged": true, "mergeCommit": {"oid": "9208dfb36c98f63fa6877c912ec66b20b5e2b7ee"}, "closed": true, "closedAt": "2020-12-14T23:12:07Z", "author": {"login": "russgold"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdk1diAAH2gAyNTM2MDY3MzE2OjhlM2ZiNWRkZDE2MjI4YTdiZDUxYTVhNWIxZWZmMDcwMTZlMGRhNmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmMFRzgFqTU1MTg4MTkxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8e3fb5ddd16228a7bd51a5a5b1eff07016e0da6e", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8e3fb5ddd16228a7bd51a5a5b1eff07016e0da6e", "committedDate": "2020-12-10T15:55:44Z", "message": "Create plugin for running bash unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34e966a47aefc4cc44559c82e4a126b2ade6e838", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/34e966a47aefc4cc44559c82e4a126b2ade6e838", "committedDate": "2020-12-10T16:01:07Z", "message": "Support splitting encoded zips across multiple config maps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d2cb146476385e6996d54c36830b96914e126b8", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1d2cb146476385e6996d54c36830b96914e126b8", "committedDate": "2020-12-10T19:51:45Z", "message": "Update implementation docs to mention additional config maps"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMjY2MDAw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#pullrequestreview-550266000", "createdAt": "2020-12-11T16:44:11Z", "commit": {"oid": "1d2cb146476385e6996d54c36830b96914e126b8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNjo0NDoxMVrOIEA7Tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNjo0NDoxMVrOIEA7Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA4MDM5OQ==", "bodyText": "It'd be helpful to have a high level explanation of the encoding approach in this comment (the 'range' file's purpose, and the directory structure when it's not '0 0'...).", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#discussion_r541080399", "createdAt": "2020-12-11T16:44:11Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -514,6 +515,71 @@ function createModelDomain() {\n   trace \"Exiting createModelDomain\"\n }\n \n+\n+# Expands into the root directory the MII domain configuration, stored in one or more config maps\n+function restoreDomainConfig() {\n+  restoreEncodedTar \"domainzip.secure\" || return 1\n+\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh  || return 1\n+}\n+\n+# Expands into the root directory the MII primordial domain, stored in one or more config maps\n+function restorePrimordialDomain() {\n+  restoreEncodedTar \"primordial_domainzip.secure\" || return 1\n+}\n+\n+# Restores the specified directory, targz'ed and stored in one or more config maps after base 64 encoding", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d2cb146476385e6996d54c36830b96914e126b8"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMjgxNzE4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#pullrequestreview-550281718", "createdAt": "2020-12-11T16:52:53Z", "commit": {"oid": "1d2cb146476385e6996d54c36830b96914e126b8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNjo1Mjo1NFrOIEBSRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNjo1Mjo1NFrOIEBSRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA4NjI3OA==", "bodyText": "Alternatively: cat ${OPERATOR_ROOT}/introspector*/${1} > /tmp/domain.secure.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#discussion_r541086278", "createdAt": "2020-12-11T16:52:54Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -514,6 +515,71 @@ function createModelDomain() {\n   trace \"Exiting createModelDomain\"\n }\n \n+\n+# Expands into the root directory the MII domain configuration, stored in one or more config maps\n+function restoreDomainConfig() {\n+  restoreEncodedTar \"domainzip.secure\" || return 1\n+\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh  || return 1\n+}\n+\n+# Expands into the root directory the MII primordial domain, stored in one or more config maps\n+function restorePrimordialDomain() {\n+  restoreEncodedTar \"primordial_domainzip.secure\" || return 1\n+}\n+\n+# Restores the specified directory, targz'ed and stored in one or more config maps after base 64 encoding\n+# args:\n+# $1 the name of the encoded file in the config map\n+function restoreEncodedTar() {\n+  cd / || return 1\n+  indexRange=\"$(getIndexRange $1)\"\n+  # shellcheck disable=SC2046\n+  cat $(buildConfigMapElements $1 $indexRange) > /tmp/domain.secure", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d2cb146476385e6996d54c36830b96914e126b8"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccd44f38811ea7bc7fe92c15da7114c7512e377a", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ccd44f38811ea7bc7fe92c15da7114c7512e377a", "committedDate": "2020-12-11T16:59:27Z", "message": "simplify joining split archives"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aafd19d61e3ad5fb69405fca1302a720e6d19c32", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/aafd19d61e3ad5fb69405fca1302a720e6d19c32", "committedDate": "2020-12-11T17:00:42Z", "message": "delete unusued functions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMzA5Mzcz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#pullrequestreview-550309373", "createdAt": "2020-12-11T17:12:21Z", "commit": {"oid": "aafd19d61e3ad5fb69405fca1302a720e6d19c32"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMjoyMVrOIECDGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMjoyMVrOIECDGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5ODc3Nw==", "bodyText": "@jshum2479 This is unrelated to Russ' enhancement, but shouldn't the old /tmp file be removed upon success? I assume it takes up a good amount of space.\ntar -xzf /tmp/domain.tar.gz || return 1\nrm /tmp/domain.tar.gz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#discussion_r541098777", "createdAt": "2020-12-11T17:12:21Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -514,6 +515,31 @@ function createModelDomain() {\n   trace \"Exiting createModelDomain\"\n }\n \n+\n+# Expands into the root directory the MII domain configuration, stored in one or more config maps\n+function restoreDomainConfig() {\n+  restoreEncodedTar \"domainzip.secure\" || return 1\n+\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh  || return 1\n+}\n+\n+# Expands into the root directory the MII primordial domain, stored in one or more config maps\n+function restorePrimordialDomain() {\n+  restoreEncodedTar \"primordial_domainzip.secure\" || return 1\n+}\n+\n+# Restores the specified directory, targz'ed and stored in one or more config maps after base 64 encoding\n+# args:\n+# $1 the name of the encoded file in the config map\n+function restoreEncodedTar() {\n+  cd / || return 1\n+  cat ${OPERATOR_ROOT}/introspector*/${1} > /tmp/domain.secure\n+  base64 -d \"/tmp/domain.secure\" > /tmp/domain.tar.gz || return 1\n+\n+  tar -xzf /tmp/domain.tar.gz || return 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aafd19d61e3ad5fb69405fca1302a720e6d19c32"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMzEwODkz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#pullrequestreview-550310893", "createdAt": "2020-12-11T17:13:24Z", "commit": {"oid": "aafd19d61e3ad5fb69405fca1302a720e6d19c32"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMzoyNVrOIECFnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzoxMzoyNVrOIECFnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5OTQyMw==", "bodyText": "Append || return 1 to the cat...  (not strictly needed as the next line will fail if the cat fails)", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#discussion_r541099423", "createdAt": "2020-12-11T17:13:25Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -514,6 +515,31 @@ function createModelDomain() {\n   trace \"Exiting createModelDomain\"\n }\n \n+\n+# Expands into the root directory the MII domain configuration, stored in one or more config maps\n+function restoreDomainConfig() {\n+  restoreEncodedTar \"domainzip.secure\" || return 1\n+\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh  || return 1\n+}\n+\n+# Expands into the root directory the MII primordial domain, stored in one or more config maps\n+function restorePrimordialDomain() {\n+  restoreEncodedTar \"primordial_domainzip.secure\" || return 1\n+}\n+\n+# Restores the specified directory, targz'ed and stored in one or more config maps after base 64 encoding\n+# args:\n+# $1 the name of the encoded file in the config map\n+function restoreEncodedTar() {\n+  cd / || return 1\n+  cat ${OPERATOR_ROOT}/introspector*/${1} > /tmp/domain.secure", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aafd19d61e3ad5fb69405fca1302a720e6d19c32"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56b8abc94be48029e7f3d1d7b6b0be18859a2025", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/56b8abc94be48029e7f3d1d7b6b0be18859a2025", "committedDate": "2020-12-11T17:32:29Z", "message": "Remove unused functionality"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODYyODgz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#pullrequestreview-551862883", "createdAt": "2020-12-14T20:23:25Z", "commit": {"oid": "56b8abc94be48029e7f3d1d7b6b0be18859a2025"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODY0MzE3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#pullrequestreview-551864317", "createdAt": "2020-12-14T20:25:30Z", "commit": {"oid": "56b8abc94be48029e7f3d1d7b6b0be18859a2025"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODgxOTEz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2095#pullrequestreview-551881913", "createdAt": "2020-12-14T20:50:59Z", "commit": {"oid": "56b8abc94be48029e7f3d1d7b6b0be18859a2025"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3979, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}