{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1NDE3MjI1", "number": 1740, "title": "add readiness check after ingress is created", "bodyText": "In the current test framework, after the ingress is created, we just check the ingress exists but not check the ingress can actually route the app to the server pod.\nAdd the readiness check for ingress by calling WebLogic ready app and wait for 200 response code.\nJenkins result: https://build.weblogick8s.org:8443/view/all/job/weblogic-kubernetes-operator-model-in-image-tests-10/380/\nhttps://build.weblogick8s.org:8443/view/all/job/weblogic-kubernetes-operator-kind-new/409/\noracle.weblogic.kubernetes.ItIntrospectVersion.oracle.weblogic.kubernetes.ItIntrospectVersion failed intermittently even on develop branch on cluster 10.", "createdAt": "2020-06-16T19:15:42Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1740", "merged": true, "mergeCommit": {"oid": "a998588a681b4bac311736dd3fca7847f816fe3a"}, "closed": true, "closedAt": "2020-06-19T18:34:52Z", "author": {"login": "xiancao"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcr6K9_AH2gAyNDM1NDE3MjI1OmVhMTEwYzRjZmQ1ZjdhNTBmYjg0NmRlYjZkZjNmNTQ3ZmIyZThmMTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsl525AH2gAyNDM1NDE3MjI1OmFiZWFlZGFjMDNlMzczZTk2NjA0YzVjMTBjYTFiMjliNzQzMGI3ZDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ea110c4cfd5f7a50fb846deb6df3f547fb2e8f18", "author": {"user": {"login": "xiancao", "name": "Xian Cao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ea110c4cfd5f7a50fb846deb6df3f547fb2e8f18", "committedDate": "2020-06-16T19:11:18Z", "message": "add readiness check for ingress"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxODk1NTY1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1740#pullrequestreview-431895565", "createdAt": "2020-06-16T21:12:29Z", "commit": {"oid": "ea110c4cfd5f7a50fb846deb6df3f547fb2e8f18"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMToxMjoyOVrOGktXMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMToxMzoyM1rOGktYzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE0NTEzNg==", "bodyText": "createIngressForDomainAndVerify() can call checkIngressReady()", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1740#discussion_r441145136", "createdAt": "2020-06-16T21:12:29Z", "author": {"login": "vanajamukkara"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItScaleMiiDomainNginx.java", "diffHunk": "@@ -133,7 +134,10 @@ public static void initAll(@Namespaces(3) List<String> namespaces) {\n       clusterNameMsPortMap.put(CLUSTER_NAME_PREFIX + i, MANAGED_SERVER_PORT);\n     }\n     logger.info(\"Creating ingress for domain {0} in namespace {1}\", domainUid, domainNamespace);\n-    createIngressForDomainAndVerify(domainUid, domainNamespace, clusterNameMsPortMap);\n+    List<String> ingressHostList = createIngressForDomainAndVerify(domainUid, domainNamespace, clusterNameMsPortMap);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea110c4cfd5f7a50fb846deb6df3f547fb2e8f18"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE0NTU1MQ==", "bodyText": "log stdout and stderr as well", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1740#discussion_r441145551", "createdAt": "2020-06-16T21:13:23Z", "author": {"login": "vanajamukkara"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/TestUtils.java", "diffHunk": "@@ -179,6 +179,51 @@ public static String getDateAndTimeStamp() {\n     return dateFormat.format(date) + \"-\" + System.currentTimeMillis();\n   }\n \n+  /**\n+   * Call a web app and wait for the response code 200.\n+   * @param curlCmd curl command to call the web app\n+   * @param maxIterations max iterations to call the curl command\n+   * @return true if 200 response code is returned, false otherwise\n+   */\n+  public static boolean callWebAppAndWaitTillReady(String curlCmd, int maxIterations)  {\n+\n+    ExecResult result = null;\n+    String responseCode = \"\";\n+\n+    for (int i = 0; i < maxIterations; i++) {\n+      try {\n+        result = ExecCommand.exec(curlCmd);\n+        responseCode = result.stdout().trim();\n+\n+        if (result.exitValue() != 0 || !responseCode.equals(\"200\")) {\n+          logger.info(\"callWebApp did not return 200 response code, got {0}, iteration {1} of {2}\",\n+                  responseCode, i, maxIterations);\n+\n+          try {\n+            Thread.sleep(1000);\n+          } catch (InterruptedException ignore) {\n+            // ignore\n+          }\n+        } else if (responseCode.equals(\"200\")) {\n+          logger.info(\"callWebApp returned 200 response code, iteration {0}\", i);\n+          return true;\n+        }\n+      } catch (Exception e) {\n+        logger.info(\"Got exception while running command: {0}\", curlCmd);\n+        logger.info(e.toString());\n+        if (result != null) {\n+          logger.info(\"result.stdout: \\n{0}\", result.stdout());\n+          logger.info(\"result.stderr: \\n{0}\", result.stderr());\n+        }\n+        return false;\n+      }\n+    }\n+\n+    logger.info(\"FAILURE: callWebApp did not return 200 response code, got {0}\", responseCode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea110c4cfd5f7a50fb846deb6df3f547fb2e8f18"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "239a2f594be7c1e75f958774e793a0fc69f214f7", "author": {"user": {"login": "xiancao", "name": "Xian Cao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/239a2f594be7c1e75f958774e793a0fc69f214f7", "committedDate": "2020-06-16T22:55:56Z", "message": "fix with Vanaja's comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad32ce8949556f9b4d5e816f76907dce5ceeaa6f", "author": {"user": {"login": "xiancao", "name": "Xian Cao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ad32ce8949556f9b4d5e816f76907dce5ceeaa6f", "committedDate": "2020-06-16T22:56:05Z", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into xc-readiness4ingress"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNjIzNzEx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1740#pullrequestreview-432623711", "createdAt": "2020-06-17T17:33:06Z", "commit": {"oid": "ad32ce8949556f9b4d5e816f76907dce5ceeaa6f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNTc5NzUx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1740#pullrequestreview-433579751", "createdAt": "2020-06-18T19:23:28Z", "commit": {"oid": "ad32ce8949556f9b4d5e816f76907dce5ceeaa6f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abeaedac03e373e96604c5c10ca1b29b7430b7d1", "author": {"user": {"login": "xiancao", "name": "Xian Cao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/abeaedac03e373e96604c5c10ca1b29b7430b7d1", "committedDate": "2020-06-18T22:08:26Z", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into xc-readiness4ingress"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4547, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}