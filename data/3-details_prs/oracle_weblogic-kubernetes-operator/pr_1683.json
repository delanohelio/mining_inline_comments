{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MDM2MDc5", "number": 1683, "title": "Improvements found while diagnosing problems with fibers under load", "bodyText": "Anil,\nHere are the changes I have so far:\n\nUse 8.0.2\nNaming and numbering of fibers was wrong\nAdded reporting of suspend fibers with where they are suspended", "createdAt": "2020-05-27T18:24:13Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1683", "merged": true, "mergeCommit": {"oid": "6ced4782ab2cb8e89b8a734f65fa99ed5bf28157"}, "closed": true, "closedAt": "2020-05-28T15:28:53Z", "author": {"login": "rjeberhard"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcj3jTLAH2gAyNDI0MDM2MDc5OjY3ZjllMjZkNGYwNGQzNTg1OWU4NTJlOTlmZGVlOTU5Y2U5ODY5ZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclti2AAH2gAyNDI0MDM2MDc5OjFhZDkwY2I0YjI3NzkwYjBkMjMxNTNlOTNmNTEyM2Q4ZjVlNTI3ZjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "67f9e26d4f04d35859e852e99fdee959ce9869eb", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/67f9e26d4f04d35859e852e99fdee959ce9869eb", "committedDate": "2020-05-22T19:36:46Z", "message": "Add debugging for suspended fibers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38a12fe9c13061bdc55b9dfbcf910c25a2a5f2d9", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/38a12fe9c13061bdc55b9dfbcf910c25a2a5f2d9", "committedDate": "2020-05-22T20:09:30Z", "message": "Improve diagnostics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa7da4bab6ec7643362c6021cde29e3a1c5d2a09", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fa7da4bab6ec7643362c6021cde29e3a1c5d2a09", "committedDate": "2020-05-22T23:49:04Z", "message": "Change fiber numbering"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8895ee406307c766092f9bf8dc5263504ba4caa", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a8895ee406307c766092f9bf8dc5263504ba4caa", "committedDate": "2020-05-23T00:00:19Z", "message": "Client 8.0.2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b0c03f4fb4b9c89c2664ccd7fc453c9f209a229", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1b0c03f4fb4b9c89c2664ccd7fc453c9f209a229", "committedDate": "2020-05-24T13:09:12Z", "message": "Additional diagnostics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1af1039806a6c25ef09a4e5662980df54132b791", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1af1039806a6c25ef09a4e5662980df54132b791", "committedDate": "2020-05-27T15:47:07Z", "message": "Merge remote-tracking branch 'origin/develop' into fiber-suspend-debug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7376601db32f6663affcc6bf3e6983c5b0ef6807", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7376601db32f6663affcc6bf3e6983c5b0ef6807", "committedDate": "2020-05-27T17:03:10Z", "message": "Refactor test code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d0fad225d0d4857d1bb14010fec423917abaaad", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4d0fad225d0d4857d1bb14010fec423917abaaad", "committedDate": "2020-05-27T18:17:14Z", "message": "Remove unused code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NTE3NTg4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1683#pullrequestreview-419517588", "createdAt": "2020-05-27T18:54:29Z", "commit": {"oid": "4d0fad225d0d4857d1bb14010fec423917abaaad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODo1NDoyOVrOGbYulg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODo1NDoyOVrOGbYulg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM2OTg3OA==", "bodyText": "Consider using Optional.ofNullable(fiber.getLastIfSuspended()) rather than the separate get and if statement.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1683#discussion_r431369878", "createdAt": "2020-05-27T18:54:29Z", "author": {"login": "russgold"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "diffHunk": "@@ -219,6 +220,28 @@ public void stopNamespace(String ns) {\n     }\n   }\n \n+  /**\n+   * Report on currently suspended fibers. This is the first step toward diagnosing if we need special handling\n+   * to kill or kick these fibers.\n+   */\n+  public void reportSuspendedFibers() {\n+    if (LOGGER.isFineEnabled()) {\n+      BiConsumer<String, FiberGate> consumer =\n+          (namespace, gate) -> {\n+            gate.getCurrentFibers().forEach(\n+                (key, fiber) -> {\n+                  Step lastIfSuspended = fiber.getLastIfSuspended();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d0fad225d0d4857d1bb14010fec423917abaaad"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NTIwNDQ4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1683#pullrequestreview-419520448", "createdAt": "2020-05-27T18:58:23Z", "commit": {"oid": "4d0fad225d0d4857d1bb14010fec423917abaaad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODo1ODoyM1rOGbY3ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODo1ODoyM1rOGbY3ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM3MjE1NQ==", "bodyText": "The name is a bit unclear. Maybe getSuspendedStep would be clearer. Its semantics would be the same, as a fiber can have at most one suspended step.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1683#discussion_r431372155", "createdAt": "2020-05-27T18:58:23Z", "author": {"login": "russgold"}, "path": "operator/src/main/java/oracle/kubernetes/operator/work/Fiber.java", "diffHunk": "@@ -318,6 +319,22 @@ public boolean isDone() {\n     return status.get() == DONE;\n   }\n \n+  /**\n+   * The most recently invoked step if the fiber is currently suspended.\n+   * @return Last invoked step for suspended fiber.\n+   */\n+  public Step getLastIfSuspended() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d0fad225d0d4857d1bb14010fec423917abaaad"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffca5e68e6e03bfa761708fc773f0363b5953de3", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ffca5e68e6e03bfa761708fc773f0363b5953de3", "committedDate": "2020-05-27T19:26:04Z", "message": "Review comments and trigger full recheck"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NjUzMTEw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1683#pullrequestreview-419653110", "createdAt": "2020-05-27T22:27:20Z", "commit": {"oid": "ffca5e68e6e03bfa761708fc773f0363b5953de3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ad90cb4b27790b0d23153e93f5123d8f5e527f1", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1ad90cb4b27790b0d23153e93f5123d8f5e527f1", "committedDate": "2020-05-28T13:05:04Z", "message": "Merge remote-tracking branch 'origin/develop' into fiber-suspend-debug"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4440, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}