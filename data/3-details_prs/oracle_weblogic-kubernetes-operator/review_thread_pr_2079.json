{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5NzEwMzE4", "number": 2079, "reviewThreads": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNToxMDowMFrOFB0-sQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxODoyMjo1OFrOFChhjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDYwOTEzOnYy", "diffSide": "RIGHT", "path": "operator/src/main/resources/Operator.properties", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNToxMDowMFrOIArZBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNToyMDoyNVrOIAr5bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU4MTgyOA==", "bodyText": "Does the event have details about the domain and namespace?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537581828", "createdAt": "2020-12-07T15:10:00Z", "author": {"login": "jshum2479"}, "path": "operator/src/main/resources/Operator.properties", "diffHunk": "@@ -189,6 +189,7 @@ WLSKO-0176=Job {1} in namespace {0} failed, job details are {2}\n WLSKO-0177=Pod {0} in namespace {1} failed, the pod status is {2}\n WLSKO-0178=Operator cannot proceed, as the Custom Resource Definition for ''domains.weblogic.oracle'' is not installed.\n WLSKO-0179=Pod {0} in namespace {1} detected as stuck, and force-deleted\n+WLSKO-0180=Creating event: {0}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU5MDEyNw==", "bodyText": "The event resource are namespaced, and each event is associated with a domain resource.\nAs far as this log message is concerned, even operator log message contains the domainUID and the namespace that it is associated with.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537590127", "createdAt": "2020-12-07T15:20:25Z", "author": {"login": "doxiao"}, "path": "operator/src/main/resources/Operator.properties", "diffHunk": "@@ -189,6 +189,7 @@ WLSKO-0176=Job {1} in namespace {0} failed, job details are {2}\n WLSKO-0177=Pod {0} in namespace {1} failed, the pod status is {2}\n WLSKO-0178=Operator cannot proceed, as the Custom Resource Definition for ''domains.weblogic.oracle'' is not installed.\n WLSKO-0179=Pod {0} in namespace {1} detected as stuck, and force-deleted\n+WLSKO-0180=Creating event: {0}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU4MTgyOA=="}, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDgzMzU4OnYy", "diffSide": "RIGHT", "path": "docs-source/content/userguide/managing-domains/_index.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNTo1Mjo1M1rOIAtdJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNTo1Mjo1M1rOIAtdJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYxNTY1NQ==", "bodyText": "should be \"lets\" (no apostrophe), as it is singular.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537615655", "createdAt": "2020-12-07T15:52:53Z", "author": {"login": "russgold"}, "path": "docs-source/content/userguide/managing-domains/_index.md", "diffHunk": "@@ -146,13 +147,18 @@ See [Starting and stopping]({{< relref \"/userguide/managing-domains/domain-lifec\n \n ### Scaling clusters\n \n-The operator let's you initiate scaling of clusters in various ways:\n+The operator let you initiate scaling of clusters in various ways:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDg2NDE4OnYy", "diffSide": "RIGHT", "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNTo1ODoyMVrOIAtvLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjo1NTowNVrOIAwcqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyMDI3MA==", "bodyText": "Every call to withEventData appears to create a new EventData instance, using an EventItem. Why not simply pass the event Item and let the withEventData call create the EventData in one place?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537620270", "createdAt": "2020-12-07T15:58:21Z", "author": {"login": "russgold"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "diffHunk": "@@ -414,17 +420,26 @@ public void dispatchDomainWatch(Watch.Response<Domain> item) {\n \n   private void handleAddedDomain(Domain domain) {\n     LOGGER.info(MessageKeys.WATCH_DOMAIN, domain.getDomainUid());\n-    createMakeRightOperation(new DomainPresenceInfo(domain)).interrupt().withExplicitRecheck().execute();\n+    createMakeRightOperation(new DomainPresenceInfo(domain))\n+        .interrupt()\n+        .withExplicitRecheck()\n+        .withEventData(new EventData(EventItem.DOMAIN_CREATED))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY2NDY4Mw==", "bodyText": "Some of the callers provide a message too when they create a new EventData. We'll either need to have a withEventData that takes two parameters, or two signatures -- one with EventItem only and the other with both, or only one with both parameters (then some code paths would have to pass in a null for the second parameter - message).", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537664683", "createdAt": "2020-12-07T16:55:05Z", "author": {"login": "doxiao"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "diffHunk": "@@ -414,17 +420,26 @@ public void dispatchDomainWatch(Watch.Response<Domain> item) {\n \n   private void handleAddedDomain(Domain domain) {\n     LOGGER.info(MessageKeys.WATCH_DOMAIN, domain.getDomainUid());\n-    createMakeRightOperation(new DomainPresenceInfo(domain)).interrupt().withExplicitRecheck().execute();\n+    createMakeRightOperation(new DomainPresenceInfo(domain))\n+        .interrupt()\n+        .withExplicitRecheck()\n+        .withEventData(new EventData(EventItem.DOMAIN_CREATED))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyMDI3MA=="}, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDg3NTY0OnYy", "diffSide": "RIGHT", "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjowMDozOVrOIAt2Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjowMDozOVrOIAt2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyMjA3MA==", "bodyText": "good rename. shouldContinue reads more easily.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537622070", "createdAt": "2020-12-07T16:00:39Z", "author": {"login": "russgold"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "diffHunk": "@@ -631,51 +655,30 @@ public boolean wasInspectionRun() {\n       return inspectionRun;\n     }\n \n-    private boolean isShouldContinue() {\n+    private boolean shouldContinue() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 114}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDg4NTEwOnYy", "diffSide": "RIGHT", "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjowMjoyN1rOIAt7vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjowMjoyN1rOIAt7vQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyMzQ4NQ==", "bodyText": "For consistency with similar methods, please use shouldReportAbortedEvent", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537623485", "createdAt": "2020-12-07T16:02:27Z", "author": {"login": "russgold"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "diffHunk": "@@ -631,51 +655,30 @@ public boolean wasInspectionRun() {\n       return inspectionRun;\n     }\n \n-    private boolean isShouldContinue() {\n+    private boolean shouldContinue() {\n       DomainPresenceInfo cachedInfo = getExistingDomainPresenceInfo(getNamespace(), getDomainUid());\n-      int currentIntrospectFailureRetryCount = Optional.ofNullable(liveInfo)\n-          .map(DomainPresenceInfo::getDomain)\n-          .map(Domain::getStatus)\n-          .map(DomainStatus::getIntrospectJobFailureCount)\n-          .orElse(0);\n-\n-      String existingError = Optional.ofNullable(liveInfo)\n-          .map(DomainPresenceInfo::getDomain)\n-          .map(Domain::getStatus)\n-          .map(DomainStatus::getMessage)\n-          .orElse(null);\n \n-      boolean exceededFailureRetryCount = (currentIntrospectFailureRetryCount\n-          >= DomainPresence.getDomainPresenceFailureRetryMaxCount());\n+      String existingError = getExistingError();\n \n-      boolean isVersionsChanged = isImgRestartIntrospectVerChanged(liveInfo, cachedInfo);\n-\n-      if (cachedInfo == null || cachedInfo.getDomain() == null) {\n+      if (isNewDomain(cachedInfo)) {\n+        return true;\n+      } else if (needReportAbortedEvent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 137}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDg5MTE5OnYy", "diffSide": "RIGHT", "path": "operator/src/main/java/oracle/kubernetes/operator/DomainStatusUpdater.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjowMzo0M1rOIAt_jA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjoxMjozOVrOIAub5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyNDQ2MA==", "bodyText": "Looks like a typo -> EXCEEDE.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537624460", "createdAt": "2020-12-07T16:03:43Z", "author": {"login": "ankedia"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainStatusUpdater.java", "diffHunk": "@@ -51,10 +53,15 @@\n \n import static oracle.kubernetes.operator.LabelConstants.CLUSTERNAME_LABEL;\n import static oracle.kubernetes.operator.ProcessingConstants.DOMAIN_TOPOLOGY;\n+import static oracle.kubernetes.operator.ProcessingConstants.EXCEEDE_INTROSPECTOR_MAX_RETRY_COUNT_ERROR_MSG;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYzMTcxNg==", "bodyText": "good catch. will fix it.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537631716", "createdAt": "2020-12-07T16:12:39Z", "author": {"login": "doxiao"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainStatusUpdater.java", "diffHunk": "@@ -51,10 +53,15 @@\n \n import static oracle.kubernetes.operator.LabelConstants.CLUSTERNAME_LABEL;\n import static oracle.kubernetes.operator.ProcessingConstants.DOMAIN_TOPOLOGY;\n+import static oracle.kubernetes.operator.ProcessingConstants.EXCEEDE_INTROSPECTOR_MAX_RETRY_COUNT_ERROR_MSG;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyNDQ2MA=="}, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDkyNjI4OnYy", "diffSide": "RIGHT", "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjoxMDoyM1rOIAuUzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjoxMDoyM1rOIAuUzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyOTkwMw==", "bodyText": "There is no need to create step as a local variable, here. You could more cleanly simply return the created object. IntelliJ should have made this recommendation (look for the yellow bars on the right margin).\nYou might also consider using Optional. In this case, the entire method would be something like:\nprivate Step getEventStep(final Step next) {\n  return Optional.ofNullable(eventData).map(ed -> Step.chain(createEventStep(ed), next)).orElse(next);\n}", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537629903", "createdAt": "2020-12-07T16:10:23Z", "author": {"login": "russgold"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "diffHunk": "@@ -706,9 +769,24 @@ private void internalMakeRightDomainPresence() {\n     }\n \n     private StepAndPacket createDomainPlanSteps(Packet packet) {\n+      if (containsAbortedEventData()) {\n+        return new StepAndPacket(Step.chain(createEventStep(eventData), new TailStep()), packet);\n+      }\n+\n       return new StepAndPacket(\n-          createPopulatePacketServerMapsStep(createSteps()),\n-          packet);\n+          getEventStep(Step.chain(createPopulatePacketServerMapsStep(),  createSteps())), packet);\n+    }\n+\n+    private Step getEventStep(Step next) {\n+      if (eventData != null) {\n+        Step step = Step.chain(createEventStep(eventData), next);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 259}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDkzNjAxOnYy", "diffSide": "RIGHT", "path": "operator/src/main/java/oracle/kubernetes/operator/DomainStatusUpdater.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjoxMjoxNVrOIAuaoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjoxMjoxNVrOIAuaoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYzMTM5Mg==", "bodyText": "Minor nitpick- The and word is repeated in comment.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537631392", "createdAt": "2020-12-07T16:12:15Z", "author": {"login": "ankedia"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainStatusUpdater.java", "diffHunk": "@@ -139,13 +174,14 @@ public static Step createAvailableStep(String reason, Step next) {\n   }\n \n   /**\n-   * Asynchronous step to set Domain condition to Failed after an asynchronous call failure.\n+   * Asynchronous step to set Domain condition to Failed after an asynchronous call failure and\n+   * and to generate DOMAIN_PROCESSING_FAILED event.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDk0MjY0OnYy", "diffSide": "RIGHT", "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjoxMzozOVrOIAuerA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjoxMzozOVrOIAuerA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYzMjQyOA==", "bodyText": "Here, too, Optional is designed for cases like this. You could write:\n    return Optional.ofNullable(eventData).map(EventData::isDomainProcessingAborted).orElse(false);\n\nif you added the appropriate method to EventData.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537632428", "createdAt": "2020-12-07T16:13:39Z", "author": {"login": "russgold"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "diffHunk": "@@ -706,9 +769,24 @@ private void internalMakeRightDomainPresence() {\n     }\n \n     private StepAndPacket createDomainPlanSteps(Packet packet) {\n+      if (containsAbortedEventData()) {\n+        return new StepAndPacket(Step.chain(createEventStep(eventData), new TailStep()), packet);\n+      }\n+\n       return new StepAndPacket(\n-          createPopulatePacketServerMapsStep(createSteps()),\n-          packet);\n+          getEventStep(Step.chain(createPopulatePacketServerMapsStep(),  createSteps())), packet);\n+    }\n+\n+    private Step getEventStep(Step next) {\n+      if (eventData != null) {\n+        Step step = Step.chain(createEventStep(eventData), next);\n+        return step;\n+      }\n+      return next;\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 264}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDk0ODIwOnYy", "diffSide": "RIGHT", "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjoxNDo0NFrOIAuh5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjoxNDo0NFrOIAuh5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYzMzI1NQ==", "bodyText": "missing 'I' in the method name.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537633255", "createdAt": "2020-12-07T16:14:44Z", "author": {"login": "russgold"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "diffHunk": "@@ -747,53 +825,32 @@ private static boolean isSpecChanged(DomainPresenceInfo liveInfo, DomainPresence\n   }\n \n   private static boolean isImgRestartIntrospectVerChanged(DomainPresenceInfo liveInfo, DomainPresenceInfo cachedInfo) {\n-    String liveIntrospectVersion = Optional.ofNullable(liveInfo)\n-        .map(DomainPresenceInfo::getDomain)\n-        .map(Domain::getSpec)\n-        .map(DomainSpec::getIntrospectVersion)\n-        .orElse(null);\n+    return !Objects.equals(getIntrospectVersion(liveInfo), getIntrospectVersion(cachedInfo))\n+        || !Objects.equals(getRestartVersion(liveInfo), getRestartVersion(cachedInfo))\n+        || !Objects.equals(getntrospectImage(liveInfo), getntrospectImage(cachedInfo));\n+  }\n \n-    String cachedIntropectVersion = Optional.ofNullable(cachedInfo)\n+  private static String getntrospectImage(DomainPresenceInfo info) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 285}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NDk2NzI4OnYy", "diffSide": "RIGHT", "path": "operator/src/main/java/oracle/kubernetes/operator/DomainStatusUpdater.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjoxODozMlrOIAutHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMTowMDowN1rOIA6ePA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYzNjEyNA==", "bodyText": "The name is a bit confusing as \"Failed\" is an adjective and \"EventStep\" is a modified noun. The two are not parallel and should not be connected with \"and.\" I cannot tell the intent. Is it creating a step to report a failure event? If so, perhaps createFailureEventStep would be a better name.\nOr is it necessarily creating two steps? If so, \"Step\" should be plural, assuming that they are closely related.\nIn general, \"and\" in a method name is a warning that the method is doing two things, not just one.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537636124", "createdAt": "2020-12-07T16:18:32Z", "author": {"login": "russgold"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainStatusUpdater.java", "diffHunk": "@@ -139,13 +174,14 @@ public static Step createAvailableStep(String reason, Step next) {\n   }\n \n   /**\n-   * Asynchronous step to set Domain condition to Failed after an asynchronous call failure.\n+   * Asynchronous step to set Domain condition to Failed after an asynchronous call failure and\n+   * and to generate DOMAIN_PROCESSING_FAILED event.\n    *\n    * @param callResponse the response from an unrecoverable call\n    * @param next Next step\n    * @return Step\n    */\n-  public static Step createFailedStep(CallResponse<?> callResponse, Step next) {\n+  public static Step createFailedAndEventStep(CallResponse<?> callResponse, Step next) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgyODkyNA==", "bodyText": "I changed the name to createFailureRelatedSteps.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537828924", "createdAt": "2020-12-07T21:00:07Z", "author": {"login": "doxiao"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainStatusUpdater.java", "diffHunk": "@@ -139,13 +174,14 @@ public static Step createAvailableStep(String reason, Step next) {\n   }\n \n   /**\n-   * Asynchronous step to set Domain condition to Failed after an asynchronous call failure.\n+   * Asynchronous step to set Domain condition to Failed after an asynchronous call failure and\n+   * and to generate DOMAIN_PROCESSING_FAILED event.\n    *\n    * @param callResponse the response from an unrecoverable call\n    * @param next Next step\n    * @return Step\n    */\n-  public static Step createFailedStep(CallResponse<?> callResponse, Step next) {\n+  public static Step createFailedAndEventStep(CallResponse<?> callResponse, Step next) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYzNjEyNA=="}, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NTAwMDMzOnYy", "diffSide": "RIGHT", "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/EventHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjoyNDo1NFrOIAvA6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjoyNDo1NFrOIAvA6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY0MTE5Mw==", "bodyText": "Good use of enums", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537641193", "createdAt": "2020-12-07T16:24:54Z", "author": {"login": "russgold"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/EventHelper.java", "diffHunk": "@@ -0,0 +1,328 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.kubernetes.operator.helpers;\n+\n+import java.util.Optional;\n+\n+import io.kubernetes.client.openapi.models.V1Event;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1ObjectReference;\n+import oracle.kubernetes.operator.KubernetesConstants;\n+import oracle.kubernetes.operator.LabelConstants;\n+import oracle.kubernetes.operator.ProcessingConstants;\n+import oracle.kubernetes.operator.logging.LoggingFacade;\n+import oracle.kubernetes.operator.logging.LoggingFactory;\n+import oracle.kubernetes.operator.logging.MessageKeys;\n+import oracle.kubernetes.operator.steps.DefaultResponseStep;\n+import oracle.kubernetes.operator.work.NextAction;\n+import oracle.kubernetes.operator.work.Packet;\n+import oracle.kubernetes.operator.work.Step;\n+import org.joda.time.DateTime;\n+\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_CHANGED_EVENT;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_CHANGED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_CREATED_EVENT;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_CREATED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_DELETED_EVENT;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_DELETED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_ABORTED_EVENT;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_ABORTED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_COMPLETED_EVENT;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_COMPLETED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_FAILED_EVENT;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_FAILED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_RETRYING_EVENT;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_RETRYING_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_STARTING_EVENT;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_STARTING_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.EVENT_NORMAL;\n+import static oracle.kubernetes.operator.EventConstants.EVENT_WARNING;\n+import static oracle.kubernetes.operator.EventConstants.WEBLOGIC_OPERATOR_COMPONENT;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_PROCESSING_ABORTED;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_PROCESSING_COMPLETED;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_PROCESSING_STARTING;\n+import static oracle.kubernetes.operator.helpers.NamespaceHelper.getOperatorPodName;\n+\n+/** A Helper Class for the operator to create Kubernetes Events at the key points in the operator's workflow. */\n+public class EventHelper {\n+  private static final LoggingFacade LOGGER = LoggingFactory.getLogger(\"Operator\", \"Operator\");\n+\n+  /**\n+   * Factory for {@link Step} that asynchronously create an event.\n+   *\n+   * @param eventData event item\n+   * @return Step for creating an event\n+   */\n+  public static Step createEventStep(\n+      EventData eventData) {\n+    return new CreateEventStep(eventData);\n+  }\n+\n+  public static class CreateEventStep extends Step {\n+    private final EventData eventData;\n+\n+    CreateEventStep(EventData eventData) {\n+      this.eventData = eventData;\n+    }\n+\n+    @Override\n+    public NextAction apply(Packet packet) {\n+      if (hasProcessingNotStarted(packet) && (eventData.eventItem == DOMAIN_PROCESSING_COMPLETED)) {\n+        return doNext(packet);\n+      }\n+\n+      if (isDuplicatedStartedEvent(packet)) {\n+        return doNext(packet);\n+      }\n+\n+      LOGGER.fine(MessageKeys.CREATING_EVENT, eventData.eventItem);\n+\n+      packet.put(ProcessingConstants.EVENT_TYPE, eventData.eventItem);\n+\n+      V1Event event = createEvent(packet, eventData);\n+      return doNext(new CallBuilder()\n+              .createEventAsync(\n+                  event.getMetadata().getNamespace(),\n+                  event,\n+                  new DefaultResponseStep<>(getNext())),\n+          packet);\n+\n+    }\n+\n+    private boolean hasNotFailedOrRetried(Packet packet) {\n+      return packet.get(ProcessingConstants.EVENT_TYPE) != EventItem.DOMAIN_PROCESSING_FAILED\n+          && packet.get(ProcessingConstants.EVENT_TYPE) != EventItem.DOMAIN_PROCESSING_RETRYING;\n+    }\n+\n+    private boolean isDuplicatedStartedEvent(Packet packet) {\n+      return eventData.eventItem == EventItem.DOMAIN_PROCESSING_STARTING\n+          && packet.get(ProcessingConstants.EVENT_TYPE) == EventItem.DOMAIN_PROCESSING_STARTING;\n+    }\n+\n+    private boolean hasProcessingNotStarted(Packet packet) {\n+      return packet.get(ProcessingConstants.EVENT_TYPE) != DOMAIN_PROCESSING_STARTING;\n+    }\n+\n+  }\n+\n+  private static V1Event createEvent(\n+      Packet packet,\n+      EventData eventData) {\n+    DomainPresenceInfo info = packet.getSpi(DomainPresenceInfo.class);\n+    return new V1Event()\n+        .metadata(createMetadata(info, eventData.eventItem.getReason()))\n+        .reportingComponent(WEBLOGIC_OPERATOR_COMPONENT)\n+        .reportingInstance(getOperatorPodName())\n+        .lastTimestamp(eventData.eventItem.getLastTimestamp())\n+        .type(eventData.eventItem.getType())\n+        .reason(eventData.eventItem.getReason())\n+        .message(eventData.eventItem.getMessage(info, eventData))\n+        .involvedObject(createInvolvedObject(info));\n+  }\n+\n+  private static V1ObjectReference createInvolvedObject(DomainPresenceInfo info) {\n+    return new V1ObjectReference()\n+        .name(info.getDomainUid())\n+        .namespace(info.getNamespace())\n+        .kind(KubernetesConstants.DOMAIN)\n+        .apiVersion(KubernetesConstants.API_VERSION_WEBLOGIC_ORACLE);\n+  }\n+\n+  private static V1ObjectMeta createMetadata(\n+      DomainPresenceInfo info,\n+      String reason) {\n+    final V1ObjectMeta metadata =\n+        new V1ObjectMeta()\n+            .name(String.format(\"%s.%s.%s\", info.getDomainUid(), reason, System.currentTimeMillis()))\n+            .namespace(info.getNamespace());\n+\n+    metadata\n+        .putLabelsItem(LabelConstants.DOMAINUID_LABEL, info.getDomainUid())\n+        .putLabelsItem(LabelConstants.CREATEDBYOPERATOR_LABEL, \"true\");\n+\n+    return metadata;\n+  }\n+\n+  public enum EventItem {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 147}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NTAxMTM3OnYy", "diffSide": "RIGHT", "path": "operator/src/test/java/oracle/kubernetes/operator/helpers/EventHelperTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjoyNjo1OVrOIAvHig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjoyNjo1OVrOIAvHig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY0Mjg5MA==", "bodyText": "you can simply use is(true) here. The compiler will do the necessary unboxing.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537642890", "createdAt": "2020-12-07T16:26:59Z", "author": {"login": "russgold"}, "path": "operator/src/test/java/oracle/kubernetes/operator/helpers/EventHelperTest.java", "diffHunk": "@@ -0,0 +1,408 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.kubernetes.operator.helpers;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import com.meterware.simplestub.Memento;\n+import com.meterware.simplestub.StaticStubSupport;\n+import io.kubernetes.client.openapi.models.V1Event;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1ObjectReference;\n+import oracle.kubernetes.operator.DomainProcessorDelegateStub;\n+import oracle.kubernetes.operator.DomainProcessorImpl;\n+import oracle.kubernetes.operator.DomainProcessorTestSetup;\n+import oracle.kubernetes.operator.EventConstants;\n+import oracle.kubernetes.operator.MakeRightDomainOperation;\n+import oracle.kubernetes.operator.helpers.EventHelper.EventData;\n+import oracle.kubernetes.operator.work.Step;\n+import oracle.kubernetes.operator.work.TerminalStep;\n+import oracle.kubernetes.utils.TestUtils;\n+import oracle.kubernetes.weblogic.domain.DomainConfigurator;\n+import oracle.kubernetes.weblogic.domain.DomainConfiguratorFactory;\n+import oracle.kubernetes.weblogic.domain.model.Domain;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import static oracle.kubernetes.operator.DomainProcessorTestSetup.NS;\n+import static oracle.kubernetes.operator.DomainProcessorTestSetup.UID;\n+import static oracle.kubernetes.operator.DomainStatusUpdater.createFailedAndEventStep;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_CHANGED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_CREATED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_DELETED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_ABORTED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_COMPLETED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_FAILED_EVENT;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_FAILED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_RETRYING_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_STARTING_EVENT;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_STARTING_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.WEBLOGIC_OPERATOR_COMPONENT;\n+import static oracle.kubernetes.operator.KubernetesConstants.OPERATOR_NAMESPACE_ENV;\n+import static oracle.kubernetes.operator.KubernetesConstants.OPERATOR_POD_NAME_ENV;\n+import static oracle.kubernetes.operator.ProcessingConstants.JOB_POD_NAME;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_CHANGED;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_CREATED;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_DELETED;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_PROCESSING_ABORTED;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_PROCESSING_COMPLETED;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_PROCESSING_FAILED;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_PROCESSING_RETRYING;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_PROCESSING_STARTING;\n+import static org.hamcrest.CoreMatchers.equalTo;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+\n+public class EventHelperTest {\n+  private static final String OPERATOR_POD_NAME = \"my-weblogic-operator-1234\";\n+  private static final String OP_NS = \"operator-namespace\";\n+\n+  private final List<Memento> mementos = new ArrayList<>();\n+  private final KubernetesTestSupport testSupport = new KubernetesTestSupport();\n+  private final DomainProcessorDelegateStub processorDelegate = DomainProcessorDelegateStub.createDelegate(testSupport);\n+  private final DomainProcessorImpl processor = new DomainProcessorImpl(processorDelegate);\n+  private final Domain domain = DomainProcessorTestSetup.createTestDomain();\n+  private final Map<String, Map<String, DomainPresenceInfo>> presenceInfoMap = new HashMap<>();\n+  private final DomainPresenceInfo info = new DomainPresenceInfo(domain);\n+  private final MakeRightDomainOperation makeRightOperation\n+      = processor.createMakeRightOperation(info);\n+  private final String jobPodName = LegalNames.toJobIntrospectorName(UID);\n+\n+  @Before\n+  public void setUp() throws Exception {\n+    mementos.add(TestUtils.silenceOperatorLogger());\n+    mementos.add(testSupport.install());\n+    mementos.add(StaticStubSupport.install(DomainProcessorImpl.class, \"DOMAINS\", presenceInfoMap));\n+    mementos.add(TuningParametersStub.install());\n+    mementos.add(HelmAccessStub.install());\n+\n+    testSupport.addToPacket(JOB_POD_NAME, jobPodName);\n+    testSupport.addDomainPresenceInfo(info);\n+    testSupport.defineResources(domain);\n+    DomainProcessorTestSetup.defineRequiredResources(testSupport);\n+    HelmAccessStub.defineVariable(OPERATOR_NAMESPACE_ENV, OP_NS);\n+    HelmAccessStub.defineVariable(OPERATOR_POD_NAME_ENV, OPERATOR_POD_NAME);\n+  }\n+\n+  @After\n+  public void tearDown() {\n+    mementos.forEach(Memento::revert);\n+  }\n+\n+  @Test\n+  public void whenDomainMakeRightCalled_domainProcessingStartedEventCreated() {\n+    makeRightOperation.execute();\n+\n+    assertThat(\"Event DOMAIN_PROCESSING_STARTED\",\n+        containsEvent(getEvents(), DOMAIN_PROCESSING_STARTING_EVENT), is(Boolean.TRUE));\n+  }\n+\n+  @Test\n+  public void whenDomainMakeRightCalled_domainProcessingStartedEventCreatedWithExpectedNamespace() {\n+    makeRightOperation.execute();\n+\n+    assertThat(\"Event DOMAIN_PROCESSING_STARTED message\",\n+        containsEventWithNamespace(getEvents(),\n+            DOMAIN_PROCESSING_STARTING_EVENT),\n+        is(Boolean.TRUE));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 113}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NTAyODYxOnYy", "diffSide": "RIGHT", "path": "operator/src/test/java/oracle/kubernetes/operator/helpers/EventHelperTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjozMDoxN1rOIAvR5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNjozMDoxN1rOIAvR5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY0NTU0Mg==", "bodyText": "Intellij should be warning you here that you are accessing static methods using an instance. Pay attention to its warnings. Once you have changed this to use the preferred syntax for static methods, you can combine some lines to make the method shorter.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537645542", "createdAt": "2020-12-07T16:30:17Z", "author": {"login": "russgold"}, "path": "operator/src/test/java/oracle/kubernetes/operator/helpers/EventHelperTest.java", "diffHunk": "@@ -0,0 +1,408 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.kubernetes.operator.helpers;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import com.meterware.simplestub.Memento;\n+import com.meterware.simplestub.StaticStubSupport;\n+import io.kubernetes.client.openapi.models.V1Event;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1ObjectReference;\n+import oracle.kubernetes.operator.DomainProcessorDelegateStub;\n+import oracle.kubernetes.operator.DomainProcessorImpl;\n+import oracle.kubernetes.operator.DomainProcessorTestSetup;\n+import oracle.kubernetes.operator.EventConstants;\n+import oracle.kubernetes.operator.MakeRightDomainOperation;\n+import oracle.kubernetes.operator.helpers.EventHelper.EventData;\n+import oracle.kubernetes.operator.work.Step;\n+import oracle.kubernetes.operator.work.TerminalStep;\n+import oracle.kubernetes.utils.TestUtils;\n+import oracle.kubernetes.weblogic.domain.DomainConfigurator;\n+import oracle.kubernetes.weblogic.domain.DomainConfiguratorFactory;\n+import oracle.kubernetes.weblogic.domain.model.Domain;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import static oracle.kubernetes.operator.DomainProcessorTestSetup.NS;\n+import static oracle.kubernetes.operator.DomainProcessorTestSetup.UID;\n+import static oracle.kubernetes.operator.DomainStatusUpdater.createFailedAndEventStep;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_CHANGED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_CREATED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_DELETED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_ABORTED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_COMPLETED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_FAILED_EVENT;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_FAILED_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_RETRYING_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_STARTING_EVENT;\n+import static oracle.kubernetes.operator.EventConstants.DOMAIN_PROCESSING_STARTING_PATTERN;\n+import static oracle.kubernetes.operator.EventConstants.WEBLOGIC_OPERATOR_COMPONENT;\n+import static oracle.kubernetes.operator.KubernetesConstants.OPERATOR_NAMESPACE_ENV;\n+import static oracle.kubernetes.operator.KubernetesConstants.OPERATOR_POD_NAME_ENV;\n+import static oracle.kubernetes.operator.ProcessingConstants.JOB_POD_NAME;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_CHANGED;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_CREATED;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_DELETED;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_PROCESSING_ABORTED;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_PROCESSING_COMPLETED;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_PROCESSING_FAILED;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_PROCESSING_RETRYING;\n+import static oracle.kubernetes.operator.helpers.EventHelper.EventItem.DOMAIN_PROCESSING_STARTING;\n+import static org.hamcrest.CoreMatchers.equalTo;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+\n+public class EventHelperTest {\n+  private static final String OPERATOR_POD_NAME = \"my-weblogic-operator-1234\";\n+  private static final String OP_NS = \"operator-namespace\";\n+\n+  private final List<Memento> mementos = new ArrayList<>();\n+  private final KubernetesTestSupport testSupport = new KubernetesTestSupport();\n+  private final DomainProcessorDelegateStub processorDelegate = DomainProcessorDelegateStub.createDelegate(testSupport);\n+  private final DomainProcessorImpl processor = new DomainProcessorImpl(processorDelegate);\n+  private final Domain domain = DomainProcessorTestSetup.createTestDomain();\n+  private final Map<String, Map<String, DomainPresenceInfo>> presenceInfoMap = new HashMap<>();\n+  private final DomainPresenceInfo info = new DomainPresenceInfo(domain);\n+  private final MakeRightDomainOperation makeRightOperation\n+      = processor.createMakeRightOperation(info);\n+  private final String jobPodName = LegalNames.toJobIntrospectorName(UID);\n+\n+  @Before\n+  public void setUp() throws Exception {\n+    mementos.add(TestUtils.silenceOperatorLogger());\n+    mementos.add(testSupport.install());\n+    mementos.add(StaticStubSupport.install(DomainProcessorImpl.class, \"DOMAINS\", presenceInfoMap));\n+    mementos.add(TuningParametersStub.install());\n+    mementos.add(HelmAccessStub.install());\n+\n+    testSupport.addToPacket(JOB_POD_NAME, jobPodName);\n+    testSupport.addDomainPresenceInfo(info);\n+    testSupport.defineResources(domain);\n+    DomainProcessorTestSetup.defineRequiredResources(testSupport);\n+    HelmAccessStub.defineVariable(OPERATOR_NAMESPACE_ENV, OP_NS);\n+    HelmAccessStub.defineVariable(OPERATOR_POD_NAME_ENV, OPERATOR_POD_NAME);\n+  }\n+\n+  @After\n+  public void tearDown() {\n+    mementos.forEach(Memento::revert);\n+  }\n+\n+  @Test\n+  public void whenDomainMakeRightCalled_domainProcessingStartedEventCreated() {\n+    makeRightOperation.execute();\n+\n+    assertThat(\"Event DOMAIN_PROCESSING_STARTED\",\n+        containsEvent(getEvents(), DOMAIN_PROCESSING_STARTING_EVENT), is(Boolean.TRUE));\n+  }\n+\n+  @Test\n+  public void whenDomainMakeRightCalled_domainProcessingStartedEventCreatedWithExpectedNamespace() {\n+    makeRightOperation.execute();\n+\n+    assertThat(\"Event DOMAIN_PROCESSING_STARTED message\",\n+        containsEventWithNamespace(getEvents(),\n+            DOMAIN_PROCESSING_STARTING_EVENT),\n+        is(Boolean.TRUE));\n+  }\n+\n+  @Test\n+  public void whenDomainMakeRightCalled_domainProcessingStartedEventCreatedWithExpectedMessage() {\n+    makeRightOperation.execute();\n+\n+    assertThat(\"Event DOMAIN_PROCESSING_STARTED message\",\n+        containsEventWithMessage(getEvents(),\n+            DOMAIN_PROCESSING_STARTING_EVENT,\n+            String.format(DOMAIN_PROCESSING_STARTING_PATTERN, UID)),\n+            is(Boolean.TRUE));\n+  }\n+\n+  @Test\n+  public void whenDomainMakeRightCalled_domainProcessingStartedEventCreatedWithInvolvedObject()\n+      throws Exception {\n+    makeRightOperation.execute();\n+\n+    assertThat(\"Event involved object\",\n+        containsEventWithInvolvedObject(getEvents(), DOMAIN_PROCESSING_STARTING_EVENT, UID, NS),\n+        is(Boolean.TRUE));\n+  }\n+\n+  @Test\n+  public void whenDomainMakeRightCalled_domainProcessingStartedEventCreatedWithReportingComponent()\n+      throws Exception {\n+    makeRightOperation.execute();\n+\n+    assertThat(\"Event reporting component\",\n+        containsEventWithComponent(getEvents(), DOMAIN_PROCESSING_STARTING_EVENT),\n+        is(Boolean.TRUE));\n+  }\n+\n+  @Test\n+  public void whenDomainMakeRightCalled_domainProcessingStartedEventCreatedWithReportingInstance()\n+      throws Exception {\n+    String namespaceFromHelm = NamespaceHelper.getOperatorNamespace();\n+\n+    testSupport.runSteps(\n+        new EventHelper().createEventStep(\n+            new EventData(DOMAIN_PROCESSING_STARTING)\n+        ));\n+\n+    assertThat(\"Operator namespace \",\n+        namespaceFromHelm, equalTo(OP_NS));\n+\n+    assertThat(\"Event reporting instance\",\n+        containsEventWithInstance(getEvents(), DOMAIN_PROCESSING_STARTING_EVENT, OPERATOR_POD_NAME),\n+        is(Boolean.TRUE));\n+  }\n+\n+  @Test\n+  public void whenCreateEventStepCalled_domainProcessingSucceededEventCreated() {\n+    testSupport.runSteps(Step.chain(\n+        new EventHelper().createEventStep(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 168}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM3NTE5MzI1OnYy", "diffSide": "RIGHT", "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/DomainPresenceInfo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNzowMjowOVrOIAwyaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxNzowMjowOVrOIAwyaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzY3MDI1MQ==", "bodyText": "It looks like this is only called from getActiveDeadlineSeconds() in JobStepContext in same package and can be package protected instead of public.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r537670251", "createdAt": "2020-12-07T17:02:09Z", "author": {"login": "ankedia"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/DomainPresenceInfo.java", "diffHunk": "@@ -429,7 +429,7 @@ public int incrementAndGetFailureCount() {\n     return retryCount.incrementAndGet();\n   }\n \n-  int getRetryCount() {\n+  public int getRetryCount() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5343dd9fc5896c8bf3766dfe2d100b1a4003164d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4MTkwNzM0OnYy", "diffSide": "RIGHT", "path": "docs-source/content/userguide/managing-domains/domain-events.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxODoyMjo1OVrOIBvJfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxODoyMjo1OVrOIBvJfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY5MTk2NA==", "bodyText": "all events -> all the events", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2079#discussion_r538691964", "createdAt": "2020-12-08T18:22:59Z", "author": {"login": "rosemarymarano"}, "path": "docs-source/content/userguide/managing-domains/domain-events.md", "diffHunk": "@@ -97,6 +97,14 @@ To get all events that are generated by the operator, run:\n  $ kubectl get events -n [namespace] --selector=weblogic.createdByOperator=true\n ```\n \n+```\n+\n+To get all events that are generated by the operator for a particular domain resource, for example `sample-domain1`, run:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cd0c50d57f3138d706e60220f2143df51025edf"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3788, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}