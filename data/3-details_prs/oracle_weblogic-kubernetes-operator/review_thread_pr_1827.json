{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzOTE0Mjgy", "number": 1827, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjo1NjoyM1rOEQZndA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxOToxMDoxM1rOEQwoMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NjMyMzcyOnYy", "diffSide": "RIGHT", "path": "operator/src/main/resources/scripts/introspectDomain.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjo1NjoyM1rOG0iFRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjo1NjoyM1rOG0iFRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzczNzU0MQ==", "bodyText": "Implementation note: MAX_INTROSPECTOR_LOG_FILES is internal for now - there are no plans to document this env var.  Default is 10.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1827#discussion_r457737541", "createdAt": "2020-07-20T22:56:23Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/introspectDomain.sh", "diffHunk": "@@ -61,21 +68,68 @@ function createFolder {\n   fi\n }\n \n-trace \"Introspecting the domain\"\n+#\n+# setup MII functions in case this is a MII domain\n+#\n+\n+source ${SCRIPTPATH}/modelInImage.sh\n+[ $? -ne 0 ] && trace SEVERE \"Error sourcing ${SCRIPTPATH}/modelInImage.sh\" && exit 1\n+\n+#\n+# setup introspector log file\n+#\n+\n+traceDirs before LOG_HOME\n+\n+if [ ! -z \"${LOG_HOME}\" ] && [ ! -d \"${LOG_HOME}\" ]; then\n+  trace \"Creating log home directory: '${LOG_HOME}'\"\n+  createFolder ${LOG_HOME}\n+fi\n+\n+ilog_dir=\"${LOG_HOME:-/tmp}\"\n+ilog_timestamp=\"$(date --utc '+%Y-%m-%d_%H.%M.%S')\"\n+ilog_prefix=\"${ilog_dir}/introspector_script\"\n+ilog_file=\"${ilog_prefix}_${ilog_timestamp}_.out\"\n+ilog_max=${MAX_INTROSPECTOR_LOG_FILES:-10}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5f53b31f6783d714cd310db7d4178abf78d9bd1"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NjMyNjk2OnYy", "diffSide": "RIGHT", "path": "operator/src/main/resources/scripts/introspectDomain.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjo1Nzo0OVrOG0iHGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjo1Nzo0OVrOG0iHGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzczODAxMA==", "bodyText": "Implementation note: There are no plans to document INTROSPECTOR_LOG_FILE_MODE - default is 'tee'.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1827#discussion_r457738010", "createdAt": "2020-07-20T22:57:49Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/introspectDomain.sh", "diffHunk": "@@ -142,58 +189,78 @@ if [ ${DOMAIN_SOURCE_TYPE} == \"FromModel\" ]; then\n     createWLDomain || exit 1\n     created_domain=$DOMAIN_CREATED\n     trace \"Create domain return code = \" ${created_domain}\n-else\n+  else\n     created_domain=1\n-fi\n-\n-traceTiming \"INTROSPECTOR '${DOMAIN_UID}' MII CREATE DOMAIN END\" \n-\n+  fi\n \n-# check DOMAIN_HOME for a config/config.xml, reset DOMAIN_HOME if needed\n+  traceTiming \"INTROSPECTOR '${DOMAIN_UID}' MII CREATE DOMAIN END\" \n \n-exportEffectiveDomainHome || exit 1\n+  # check DOMAIN_HOME for a config/config.xml, reset DOMAIN_HOME if needed\n \n-# list potentially interesting env-vars and dirs after they're updated by export.*Homes\n+  exportEffectiveDomainHome || exit 1\n \n-traceEnv after\n-traceDirs after\n+  # list potentially interesting env-vars and dirs after they're updated by export.*Homes\n \n-# check if we're using a supported WebLogic version\n-# (the check  will log a message if it fails)\n+  traceEnv after\n+  traceDirs after DOMAIN_HOME DATA_HOME\n \n-checkWebLogicVersion || exit 1\n+  # check if we're using a supported WebLogic version\n+  # (the check  will log a message if it fails)\n \n-# start node manager\n-# run instrospector wlst script\n-if [ ${created_domain} -ne 0 ]; then\n+  checkWebLogicVersion || exit 1\n \n+  # start node manager\n+  # run instrospector wlst script\n+  if [ ${created_domain} -ne 0 ]; then\n     traceTiming \"INTROSPECTOR '${DOMAIN_UID}' MII NM START\" \n \n-    # start node manager -why ??\n+    # introspectDomain.py uses an NM to setup credentials for the server NMs\n+    #  (see 'nmConnect' in introspectDomain.py)\n     trace \"Starting node manager\"\n     ${SCRIPTPATH}/startNodeManager.sh || exit 1\n \n     traceTiming \"INTROSPECTOR '${DOMAIN_UID}' MII NM END\" \n-\n     traceTiming \"INTROSPECTOR '${DOMAIN_UID}' MII MD5 START\"\n-\n     traceTiming \"INTROSPECTOR '${DOMAIN_UID}' MII NM END\" \n-\n     traceTiming \"INTROSPECTOR '${DOMAIN_UID}' MII MD5 START\"\n \n     # put domain secret's md5 cksum in file '/tmp/DomainSecret.md5'\n     # the introspector wlst script and WL server pods will use this value\n     generateDomainSecretMD5File '/tmp/DomainSecret.md5' || exit 1\n \n     traceTiming \"INTROSPECTOR '${DOMAIN_UID}' MII MD5 END\"\n-\n     traceTiming \"INTROSPECTOR '${DOMAIN_UID}' INTROSPECT START\"\n \n     trace \"Running introspector WLST script ${SCRIPTPATH}/introspectDomain.py\"\n     ${SCRIPTPATH}/wlst.sh ${SCRIPTPATH}/introspectDomain.py || exit 1\n \n     traceTiming \"INTROSPECTOR '${DOMAIN_UID}' INTROSPECT END\"\n-fi\n-trace \"Domain introspection complete\"\n+  fi\n+  trace \"Domain introspection complete\"\n+}\n \n-exit 0\n+# we have different log file modes in case we need to revert 'tee' mode\n+\n+case \"${INTROSPECTOR_LOG_FILE_MODE:-tee}\" in", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5f53b31f6783d714cd310db7d4178abf78d9bd1"}, "originalPosition": 267}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NjM4NjQ0OnYy", "diffSide": "RIGHT", "path": "operator/src/main/resources/scripts/modelInImage.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMzoyNToyOVrOG0ip2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMzoyNToyOVrOG0ip2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc0NjkwNg==", "bodyText": "Implementation note:  When the introspector java parses out a SEVERE it includes everything after the SEVERE up to the next trace statement.  (So the 'cat' above is included in the SEVERE just before it.)", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1827#discussion_r457746906", "createdAt": "2020-07-20T23:25:29Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -532,8 +532,8 @@ function diff_model() {\n     org.python.util.jython \\\n     ${SCRIPTPATH}/model_diff.py $1 $2 > ${WDT_OUTPUT} 2>&1\n   if [ $? -ne 0 ] ; then\n-    trace SEVERE \"Failed to compare models. Check logs for error.\"\n-    trace SEVERE \"$(cat ${WDT_OUTPUT})\"\n+    trace SEVERE \"Failed to compare models. Check logs for error. Comparison output:\"\n+    cat ${WDT_OUTPUT}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4318ef0a31f921ef6c3ce6e73372a4c47bada40f"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NjM4OTYxOnYy", "diffSide": "RIGHT", "path": "operator/src/main/resources/scripts/modelInImage.sh", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMzoyNjo1MFrOG0irng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMzoyNjo1MFrOG0irng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc0NzM1OA==", "bodyText": "Implementation note: we no longer need to check if LOG_HOME is set and/or do the 'cp' because the calling script is now logging the entire output of this script.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1827#discussion_r457747358", "createdAt": "2020-07-20T23:26:50Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -648,11 +648,8 @@ function generateMergedModel() {\n     ${archive_list} ${variable_list}  -domain_type ${WDT_DOMAIN_TYPE}  > ${WDT_OUTPUT}\n   ret=$?\n   if [ $ret -ne 0 ]; then\n-    trace SEVERE \"WDT Failed: Validate Model Failed \"\n-    if [ -d ${LOG_HOME} ] && [ ! -z ${LOG_HOME} ] ; then\n-      cp  ${WDT_OUTPUT} ${LOG_HOME}/introspectJob_validateDomain.log\n-    fi\n-    trace SEVERE \"$(cat ${WDT_OUTPUT})\"\n+    trace SEVERE \"WDT Failed: Validate Model Failed:\"\n+    cat ${WDT_OUTPUT}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4318ef0a31f921ef6c3ce6e73372a4c47bada40f"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTY2ODU5OnYy", "diffSide": "RIGHT", "path": "operator/src/main/resources/scripts/introspectDomain.sh", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNzoxMjoyNVrOG1B15w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxODoyMzo1NlrOG1EeVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1Nzg5NQ==", "bodyText": "Is it the intention for the introspector logs to end with '_' before .out?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1827#discussion_r458257895", "createdAt": "2020-07-21T17:12:25Z", "author": {"login": "lennyphan"}, "path": "operator/src/main/resources/scripts/introspectDomain.sh", "diffHunk": "@@ -61,21 +68,68 @@ function createFolder {\n   fi\n }\n \n-trace \"Introspecting the domain\"\n+#\n+# setup MII functions in case this is a MII domain\n+#\n+\n+source ${SCRIPTPATH}/modelInImage.sh\n+[ $? -ne 0 ] && trace SEVERE \"Error sourcing ${SCRIPTPATH}/modelInImage.sh\" && exit 1\n+\n+#\n+# setup introspector log file\n+#\n+\n+traceDirs before LOG_HOME\n+\n+if [ ! -z \"${LOG_HOME}\" ] && [ ! -d \"${LOG_HOME}\" ]; then\n+  trace \"Creating log home directory: '${LOG_HOME}'\"\n+  createFolder ${LOG_HOME}\n+fi\n+\n+ilog_dir=\"${LOG_HOME:-/tmp}\"\n+ilog_timestamp=\"$(date --utc '+%Y-%m-%d_%H.%M.%S')\"\n+ilog_prefix=\"${ilog_dir}/introspector_script\"\n+ilog_file=\"${ilog_prefix}_${ilog_timestamp}_.out\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bafd971a22911b889614b0dc85f4137ef92d7668"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMwMTAxNA==", "bodyText": "Yes - I found it made the generated file name more readable.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1827#discussion_r458301014", "createdAt": "2020-07-21T18:23:56Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/introspectDomain.sh", "diffHunk": "@@ -61,21 +68,68 @@ function createFolder {\n   fi\n }\n \n-trace \"Introspecting the domain\"\n+#\n+# setup MII functions in case this is a MII domain\n+#\n+\n+source ${SCRIPTPATH}/modelInImage.sh\n+[ $? -ne 0 ] && trace SEVERE \"Error sourcing ${SCRIPTPATH}/modelInImage.sh\" && exit 1\n+\n+#\n+# setup introspector log file\n+#\n+\n+traceDirs before LOG_HOME\n+\n+if [ ! -z \"${LOG_HOME}\" ] && [ ! -d \"${LOG_HOME}\" ]; then\n+  trace \"Creating log home directory: '${LOG_HOME}'\"\n+  createFolder ${LOG_HOME}\n+fi\n+\n+ilog_dir=\"${LOG_HOME:-/tmp}\"\n+ilog_timestamp=\"$(date --utc '+%Y-%m-%d_%H.%M.%S')\"\n+ilog_prefix=\"${ilog_dir}/introspector_script\"\n+ilog_file=\"${ilog_prefix}_${ilog_timestamp}_.out\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1Nzg5NQ=="}, "originalCommit": {"oid": "bafd971a22911b889614b0dc85f4137ef92d7668"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTk0OTMzOnYy", "diffSide": "RIGHT", "path": "docs-source/content/samples/simple/domains/domain-home-in-image/_index.md", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxODoyODo1MlrOG1EpTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMDowNTo0OVrOG1H1zA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMwMzgyMw==", "bodyText": "introspector -> introspector out?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1827#discussion_r458303823", "createdAt": "2020-07-21T18:28:52Z", "author": {"login": "alai8"}, "path": "docs-source/content/samples/simple/domains/domain-home-in-image/_index.md", "diffHunk": "@@ -210,7 +210,7 @@ spec:\n   includeServerOutInPodLog: true\n   # Whether to enable log home\n   # logHomeEnabled: false\n-  # The in-pod location for domain log, server logs, server out, and Node Manager log files\n+  # The in-pod location for domain log, server logs, server out, introspector, and Node Manager log files", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ed4ce541e20821886f8133741253a7d5ad4f5ce"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMyNDc2Mw==", "bodyText": "missed this one on line 213.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1827#discussion_r458324763", "createdAt": "2020-07-21T19:06:08Z", "author": {"login": "lennyphan"}, "path": "docs-source/content/samples/simple/domains/domain-home-in-image/_index.md", "diffHunk": "@@ -210,7 +210,7 @@ spec:\n   includeServerOutInPodLog: true\n   # Whether to enable log home\n   # logHomeEnabled: false\n-  # The in-pod location for domain log, server logs, server out, and Node Manager log files\n+  # The in-pod location for domain log, server logs, server out, introspector, and Node Manager log files", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMwMzgyMw=="}, "originalCommit": {"oid": "0ed4ce541e20821886f8133741253a7d5ad4f5ce"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM1NjE3Mg==", "bodyText": "fixed", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1827#discussion_r458356172", "createdAt": "2020-07-21T20:05:49Z", "author": {"login": "tbarnes-us"}, "path": "docs-source/content/samples/simple/domains/domain-home-in-image/_index.md", "diffHunk": "@@ -210,7 +210,7 @@ spec:\n   includeServerOutInPodLog: true\n   # Whether to enable log home\n   # logHomeEnabled: false\n-  # The in-pod location for domain log, server logs, server out, and Node Manager log files\n+  # The in-pod location for domain log, server logs, server out, introspector, and Node Manager log files", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMwMzgyMw=="}, "originalCommit": {"oid": "0ed4ce541e20821886f8133741253a7d5ad4f5ce"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2MDA5Mzk1OnYy", "diffSide": "RIGHT", "path": "kubernetes/hands-on-lab/domain.yaml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxOToxMDoxM1rOG1GDsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMDowNjoyN1rOG1H2_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMyNjk2Mw==", "bodyText": ".out?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1827#discussion_r458326963", "createdAt": "2020-07-21T19:10:13Z", "author": {"login": "lennyphan"}, "path": "kubernetes/hands-on-lab/domain.yaml", "diffHunk": "@@ -47,8 +47,8 @@ spec:\n   # If you want to use a mounted volume as the log home, i.e. to persist logs outside the container, then\n   # uncomment this and set it to `true`:\n   # logHomeEnabled: false\n-  # The in-pod name of the directory to store the domain, node manager, server logs, and server .out\n-  # files in.\n+  # The in-pod name of the directory to store the domain, node manager, server logs, server .out,\n+  # and introspector out files in.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ed4ce541e20821886f8133741253a7d5ad4f5ce"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM1NjQ3OQ==", "bodyText": "fixed", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1827#discussion_r458356479", "createdAt": "2020-07-21T20:06:27Z", "author": {"login": "tbarnes-us"}, "path": "kubernetes/hands-on-lab/domain.yaml", "diffHunk": "@@ -47,8 +47,8 @@ spec:\n   # If you want to use a mounted volume as the log home, i.e. to persist logs outside the container, then\n   # uncomment this and set it to `true`:\n   # logHomeEnabled: false\n-  # The in-pod name of the directory to store the domain, node manager, server logs, and server .out\n-  # files in.\n+  # The in-pod name of the directory to store the domain, node manager, server logs, server .out,\n+  # and introspector out files in.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMyNjk2Mw=="}, "originalCommit": {"oid": "0ed4ce541e20821886f8133741253a7d5ad4f5ce"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4128, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}