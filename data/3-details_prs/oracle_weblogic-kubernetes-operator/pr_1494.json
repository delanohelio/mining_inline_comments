{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzMjkwODc4", "number": 1494, "title": "Debug it", "bodyText": "", "createdAt": "2020-03-24T22:39:50Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494", "merged": true, "mergeCommit": {"oid": "098309079091bff019ea7092941ad30a555a2adc"}, "closed": true, "closedAt": "2020-03-26T19:25:31Z", "author": {"login": "bhavaniravichandran"}, "timelineItems": {"totalCount": 33, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcK07DAgH2gAyMzkzMjkwODc4OjE0OGJmZmU2OWY2ZjNkZWIxNTAyNTRjMTQ4NWJjZWUxZWI5ZjNkNDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRhObIgFqTM4MjM0MzAwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "148bffe69f6f3deb150254c1485bcee1eb9f3d46", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/148bffe69f6f3deb150254c1485bcee1eb9f3d46", "committedDate": "2020-03-06T00:24:53Z", "message": "adding more debug msgs to check server/ingress state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d15d73d3c90290adb120a5b153a72b9d9530496f", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d15d73d3c90290adb120a5b153a72b9d9530496f", "committedDate": "2020-03-06T06:09:36Z", "message": "use execommand"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07f6e234d88fa281e6bb804bd129f612e0df6d90", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/07f6e234d88fa281e6bb804bd129f612e0df6d90", "committedDate": "2020-03-06T06:11:05Z", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into debug-it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0db31222c174bb8eda579b1a47c846c939f634b0", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0db31222c174bb8eda579b1a47c846c939f634b0", "committedDate": "2020-03-07T01:12:31Z", "message": "adding more debug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84612598b7e01d14b8b4e29a8f8cd8d4540054c7", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/84612598b7e01d14b8b4e29a8f8cd8d4540054c7", "committedDate": "2020-03-07T05:57:58Z", "message": "add get ingress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0efaa971fb932579eae9d361b83998ce65a9d91", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a0efaa971fb932579eae9d361b83998ce65a9d91", "committedDate": "2020-03-10T00:23:49Z", "message": "adding more debug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c9c3bb4795b69425c133c1d8fc66e9f7a3c84a6", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2c9c3bb4795b69425c133c1d8fc66e9f7a3c84a6", "committedDate": "2020-03-11T01:48:22Z", "message": "generate server pod logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61779fc229d78da9f1aa8e0b53844f7fa242af93", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/61779fc229d78da9f1aa8e0b53844f7fa242af93", "committedDate": "2020-03-11T03:18:11Z", "message": "generate server pod logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a307e50ac3e86a16b6f796a8127b556d8a880f09", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a307e50ac3e86a16b6f796a8127b556d8a880f09", "committedDate": "2020-03-11T22:48:40Z", "message": "fix kubectl logs command"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ac97c3df1691c9e15f6f5cc26cd7cbfe04a86d7", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7ac97c3df1691c9e15f6f5cc26cd7cbfe04a86d7", "committedDate": "2020-03-12T05:25:58Z", "message": "adding sleep time before deploying app"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9087bae36f14e15349da55bebd3d36462292eb3a", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9087bae36f14e15349da55bebd3d36462292eb3a", "committedDate": "2020-03-12T16:32:04Z", "message": "adding debug statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bbd7cfcb5d3612543c5fb7e6e1ff61bf47f8a81", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4bbd7cfcb5d3612543c5fb7e6e1ff61bf47f8a81", "committedDate": "2020-03-12T18:03:54Z", "message": "wait till the pods in the second cluster is running"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eee280aed7cbe01afa06d72d1203f4fbdc8aab0e", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/eee280aed7cbe01afa06d72d1203f4fbdc8aab0e", "committedDate": "2020-03-12T21:43:40Z", "message": "fixing error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "411c6dba9e6922ea00b0009d4ff5865ba17fd5bf", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/411c6dba9e6922ea00b0009d4ff5865ba17fd5bf", "committedDate": "2020-03-13T16:22:37Z", "message": "check if pod is ready"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b368087c56be444c250101a2c1151423edf2b41", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6b368087c56be444c250101a2c1151423edf2b41", "committedDate": "2020-03-15T02:25:46Z", "message": "restart the data cluster before deploying app"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "870ddb6252e5b2acd059ef85a019e7a7f887d363", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/870ddb6252e5b2acd059ef85a019e7a7f887d363", "committedDate": "2020-03-15T13:48:53Z", "message": "fix cluster name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd49ee386c5465f1765ef5334d571cac7d18409f", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/bd49ee386c5465f1765ef5334d571cac7d18409f", "committedDate": "2020-03-15T22:42:59Z", "message": "more debug statements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d03607bcec1ebb455d76b5ed61d668ed963a5d1", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3d03607bcec1ebb455d76b5ed61d668ed963a5d1", "committedDate": "2020-03-18T00:47:15Z", "message": "modify deploying via rest API to synchronous mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d5a180131214cc4762757d12f50ec6ade95316", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f7d5a180131214cc4762757d12f50ec6ade95316", "committedDate": "2020-03-18T01:11:18Z", "message": "commenting out restarting the cluster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38f35f61a9c5e4b1ef2e3535e06e7a3949b583aa", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/38f35f61a9c5e4b1ef2e3535e06e7a3949b583aa", "committedDate": "2020-03-18T23:53:08Z", "message": "remove some code added to debug failure in jenkins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "300cab0da112f033a1c2ba60c74eaf9497985043", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/300cab0da112f033a1c2ba60c74eaf9497985043", "committedDate": "2020-03-18T23:58:11Z", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into debug-it"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8dfc5ac6996d1c6cb3e140333b76e51e3aea56e5", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8dfc5ac6996d1c6cb3e140333b76e51e3aea56e5", "committedDate": "2020-03-19T13:33:08Z", "message": "undo an inadvertent change to build.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32a65cc4f899bd04f2628f08594fc827d3ae1f9b", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/32a65cc4f899bd04f2628f08594fc827d3ae1f9b", "committedDate": "2020-03-23T15:19:23Z", "message": "enabling deployment debug flags"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/85218205dbe569ab66947fcce3596ac00514a0ff", "committedDate": "2020-03-23T16:57:15Z", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into debug-it"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwODEwNjc0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#pullrequestreview-380810674", "createdAt": "2020-03-25T01:49:31Z", "commit": {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMTo0OTozMVrOF7JZYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMTo1NTo1OVrOF7JgTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NDI1OA==", "bodyText": "typo", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397564258", "createdAt": "2020-03-25T01:49:31Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItManagedCoherence.java", "diffHunk": "@@ -228,6 +243,12 @@ private void createDomainAndDeployApp(Map<String, Object> domainMap, String doma\n     domain = null;\n     domain = TestUtils.createDomain(domainMap);\n     domain.verifyDomainCreated();\n+ \n+    // The above command only tests that the pod from the 1st cluster is Running (1/1)\n+    // So, checking the MS pod of the other cluster inidvidually here.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NDM1Nw==", "bodyText": "does this need to be in a try/catch @rjeberhard ?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397564357", "createdAt": "2020-03-25T01:49:55Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItManagedCoherence.java", "diffHunk": "@@ -238,6 +259,13 @@ private void createDomainAndDeployApp(Map<String, Object> domainMap, String doma\n       domainUid + \"-new-managed-server2\",\n     };\n     verifyServersStatus(domain, pods, domainUid);\n+    Thread.sleep(60 * 1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NTAyMQ==", "bodyText": "feels like we should be checking the returned values in this block of code, not just printing them out", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397565021", "createdAt": "2020-03-25T01:52:18Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItManagedCoherence.java", "diffHunk": "@@ -373,4 +405,62 @@ private ExecResult clearCache() throws Exception {\n     return result;\n   }\n \n+  private void restartCluster(String domainUid) throws Exception {\n+    String podName = domainUid + \"-new-managed-server1\";\n+\n+    String restartTmpDir = getResultDir() + \"/restarttemp\";\n+    Files.createDirectories(Paths.get(restartTmpDir));\n+    \n+    LoggerHelper.getLocal().log(Level.INFO, \"created restart temp dir\");\n+\n+    String originalYaml =\n+            getUserProjectsDir()\n+                + \"/weblogic-domains/\"\n+                + domain.getDomainUid()\n+                + \"/domain.yaml\";\n+    \n+    // Modify the original domain yaml to include restartVersion in admin server node\n+    DomainCrd crd = new DomainCrd(originalYaml);\n+    Map<String, Object> cluster = new HashMap();\n+    cluster.put(\"restartVersion\", \"v1.1\");\n+    crd.addObjectNodeToCluster(\"dataCluster\", cluster);\n+    String modYaml = crd.getYamlTree();\n+    LoggerHelper.getLocal().log(Level.INFO, modYaml);\n+\n+    // Write the modified yaml to a new file\n+    Path path = Paths.get(restartTmpDir, \"restart.cluster.yaml\");\n+    LoggerHelper.getLocal().log(Level.INFO, \"Path of the modified domain.yaml :{0}\", path.toString());\n+    Charset charset = StandardCharsets.UTF_8;\n+    Files.write(path, modYaml.getBytes(charset));\n+\n+    // Apply the new yaml to update the domain crd\n+    LoggerHelper.getLocal().log(Level.INFO, \"kubectl apply -f {0}\", path.toString());\n+    ExecResult exec = TestUtils.exec(\"kubectl apply -f \" + path.toString());\n+    LoggerHelper.getLocal().log(Level.INFO, exec.stdout());\n+    LoggerHelper.getLocal().log(Level.INFO, \"Verifying if the cluster is restarted\");\n+\n+    TestUtils.checkPodReady(domainUid + \"-new-managed-server1\", domainNS1);\n+    TestUtils.checkPodReady(domainUid + \"-new-managed-server2\", domainNS1);\n+\n+  }\n+\n+  private void verifyServersIngressRunning() throws Exception {\n+    LoggerHelper.getLocal().log(Level.INFO, \"Verifying server status\");\n+    domain.verifyServersReady();\n+    LoggerHelper.getLocal().log(Level.INFO, \"Verifying traefik and ingress created for the domain\");\n+    LoggerHelper.getLocal().log(Level.INFO,\n+        TestUtils.exec(\"helm status traefik-operator\").stdout(), true);\n+    LoggerHelper.getLocal().log(Level.INFO,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff"}, "originalPosition": 170}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NTQ3MA==", "bodyText": "ok, but do you need to rename the others by one number less?? or are you just ignoring that value altogether, not removing it from the call?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397565470", "createdAt": "2020-03-25T01:53:59Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/resources/apps/buildDeployCoherenceAppInPod.sh", "diffHunk": "@@ -25,7 +25,7 @@ PORT=$2\n USER=${3:-weblogic}\n PASSWORD=${4:-welcome1}\n APP_DIR_INPOD=$5\n-//APP_NAME=$6 - ignore this for coherence since the dir name and the app name are different.\n+#APP_NAME=$6 - ignore this for coherence since the dir name and the app name are different.\n EAR_DEPLOY_TARGET=$7", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NTc4MA==", "bodyText": "the command printed out and the command being run are not the same - seems it would be better to put the command in a variable, print it and then exec it, to avoid this issue", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397565780", "createdAt": "2020-03-25T01:55:03Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/resources/apps/buildDeployCoherenceAppInPod.sh", "diffHunk": "@@ -62,24 +62,28 @@ cp ${APP_DIR_INPOD}/builddir/${APP_NAME}.gar ${APP_DIR_INPOD}/.\n cp ${APP_DIR_INPOD}/builddir/${APP_NAME}.ear ${APP_DIR_INPOD}/.\n \n echo \"Deploy ${APP_NAME} gar using curl:\"\n-echo -e \"curl --noproxy '*' --silent  --user ${USER}:${PASSWORD} -H X-Requested-By:MyClient -H Accept:application/json -H Content-Type:multipart/form-data -F \\\"model={ name: '${APP_NAME}GAR', targets: [ { identity: [ clusters, '${GAR_DEPLOY_TARGET}' ] } ] }\\\" -F \\\"sourcePath=@${ARCHIVE_FILE_GAR}\\\"  -H \\\"Prefer:respond-async\\\" -X POST http://${HOST}:${PORT}/management/weblogic/latest/edit/appDeployments -o ${APP_DIR_INPOD}/deployGAR.out\\n\"\n-curl --noproxy '*' --silent  --user ${USER}:${PASSWORD} -H X-Requested-By:MyClient -H Accept:application/json -H Content-Type:multipart/form-data -F \"model={ name: '${APP_NAME}GAR', targets: [ { identity: [ clusters, '${GAR_DEPLOY_TARGET}' ] } ] }\" -F \"sourcePath=@${ARCHIVE_FILE_GAR}\" -H \"Prefer:respond-async\" -X POST http://${HOST}:${PORT}/management/weblogic/latest/edit/appDeployments -o ${APP_DIR_INPOD}/deployGAR.out\n+\n+echo -e \"curl --noproxy '*' -v --user ${USER}:${PASSWORD} -H X-Requested-By:MyClient -H Accept:application/json -H Content-Type:multipart/form-data -F \\\"model={ name: '${APP_NAME}GAR', targets: [ { identity: [ clusters, '${GAR_DEPLOY_TARGET}' ] } ] }\\\" -F \\\"sourcePath=@${ARCHIVE_FILE_GAR}\\\"  -H \\\"Prefer:respond-async\\\" -X POST http://${HOST}:${PORT}/management/weblogic/latest/edit/appDeployments -o ${APP_DIR_INPOD}/deployGAR.out\\n\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NjAyOA==", "bodyText": "feels like a loop might be needed here instead of only checking once? unless we are sure it cannot possibly take more than 10 sec", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397566028", "createdAt": "2020-03-25T01:55:59Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/resources/apps/buildDeployCoherenceAppInPod.sh", "diffHunk": "@@ -62,24 +62,28 @@ cp ${APP_DIR_INPOD}/builddir/${APP_NAME}.gar ${APP_DIR_INPOD}/.\n cp ${APP_DIR_INPOD}/builddir/${APP_NAME}.ear ${APP_DIR_INPOD}/.\n \n echo \"Deploy ${APP_NAME} gar using curl:\"\n-echo -e \"curl --noproxy '*' --silent  --user ${USER}:${PASSWORD} -H X-Requested-By:MyClient -H Accept:application/json -H Content-Type:multipart/form-data -F \\\"model={ name: '${APP_NAME}GAR', targets: [ { identity: [ clusters, '${GAR_DEPLOY_TARGET}' ] } ] }\\\" -F \\\"sourcePath=@${ARCHIVE_FILE_GAR}\\\"  -H \\\"Prefer:respond-async\\\" -X POST http://${HOST}:${PORT}/management/weblogic/latest/edit/appDeployments -o ${APP_DIR_INPOD}/deployGAR.out\\n\"\n-curl --noproxy '*' --silent  --user ${USER}:${PASSWORD} -H X-Requested-By:MyClient -H Accept:application/json -H Content-Type:multipart/form-data -F \"model={ name: '${APP_NAME}GAR', targets: [ { identity: [ clusters, '${GAR_DEPLOY_TARGET}' ] } ] }\" -F \"sourcePath=@${ARCHIVE_FILE_GAR}\" -H \"Prefer:respond-async\" -X POST http://${HOST}:${PORT}/management/weblogic/latest/edit/appDeployments -o ${APP_DIR_INPOD}/deployGAR.out\n+\n+echo -e \"curl --noproxy '*' -v --user ${USER}:${PASSWORD} -H X-Requested-By:MyClient -H Accept:application/json -H Content-Type:multipart/form-data -F \\\"model={ name: '${APP_NAME}GAR', targets: [ { identity: [ clusters, '${GAR_DEPLOY_TARGET}' ] } ] }\\\" -F \\\"sourcePath=@${ARCHIVE_FILE_GAR}\\\"  -H \\\"Prefer:respond-async\\\" -X POST http://${HOST}:${PORT}/management/weblogic/latest/edit/appDeployments -o ${APP_DIR_INPOD}/deployGAR.out\\n\"\n+\n+curl --noproxy '*' -v --user ${USER}:${PASSWORD} -H X-Requested-By:MyClient -H Accept:application/json -H Content-Type:application/json -d \"{name: '${APP_NAME}GAR', sourcePath='${ARCHIVE_FILE_GAR}', targets: [ { identity: [ 'clusters', '${GAR_DEPLOY_TARGET}' ] } ] }\" -X POST http://${HOST}:${PORT}/management/weblogic/latest/edit/appDeployments -o ${APP_DIR_INPOD}/deployGAR.out\n sleep 10\n-grep -q \"STATE_RUNNING\" ${APP_DIR_INPOD}/deployGAR.out\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTg1OTgw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#pullrequestreview-381185980", "createdAt": "2020-03-25T14:13:17Z", "commit": {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDoxMzoxOFrOF7dAVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDoxMzoxOFrOF7dAVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg4NTUyNg==", "bodyText": "You could just make the list a set.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397885526", "createdAt": "2020-03-25T14:13:18Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -190,7 +190,12 @@ private String getKubernetesNamespaceToUpdate(String domainNamespace) throws Exc\n         String trimmed = debracketed.replaceAll(\"\\\\s+\", \"\");\n         // now have an ArrayList containing \"foo\", \"bar\" and \"baz\"\n         ArrayList<String> list = new ArrayList<String>(Arrays.asList(trimmed.split(\",\")));\n-        list.add(domainNamespace);\n+        if (!list.contains(domainNamespace)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTkwMDc5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#pullrequestreview-381190079", "createdAt": "2020-03-25T14:17:39Z", "commit": {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDoxNzozOVrOF7dM6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDoyNjo1NVrOF7dqfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg4ODc0NA==", "bodyText": "Is the sleep really needed here? If not remove or reduce? we usually don't put hard sleep's like this in test, instead wait for a condition in a loop with small sleep time.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397888744", "createdAt": "2020-03-25T14:17:39Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItManagedCoherence.java", "diffHunk": "@@ -238,6 +259,13 @@ private void createDomainAndDeployApp(Map<String, Object> domainMap, String doma\n       domainUid + \"-new-managed-server2\",\n     };\n     verifyServersStatus(domain, pods, domainUid);\n+    Thread.sleep(60 * 1000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NDM1Nw=="}, "originalCommit": {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg5MDg5NA==", "bodyText": "can you make this method generic, so that if we have to use from other test classes it can be used? does the other multi cluster test you are debugging needs to restart the cluster as well?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397890894", "createdAt": "2020-03-25T14:20:20Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItManagedCoherence.java", "diffHunk": "@@ -373,4 +405,62 @@ private ExecResult clearCache() throws Exception {\n     return result;\n   }\n \n+  private void restartCluster(String domainUid) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff"}, "originalPosition": 125}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg5NjMxNg==", "bodyText": "This method was added while I was debugging the test failure initially, later Bhavani took over the branch. It was not meant to get it merged as is.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397896316", "createdAt": "2020-03-25T14:26:55Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItManagedCoherence.java", "diffHunk": "@@ -373,4 +405,62 @@ private ExecResult clearCache() throws Exception {\n     return result;\n   }\n \n+  private void restartCluster(String domainUid) throws Exception {\n+    String podName = domainUid + \"-new-managed-server1\";\n+\n+    String restartTmpDir = getResultDir() + \"/restarttemp\";\n+    Files.createDirectories(Paths.get(restartTmpDir));\n+    \n+    LoggerHelper.getLocal().log(Level.INFO, \"created restart temp dir\");\n+\n+    String originalYaml =\n+            getUserProjectsDir()\n+                + \"/weblogic-domains/\"\n+                + domain.getDomainUid()\n+                + \"/domain.yaml\";\n+    \n+    // Modify the original domain yaml to include restartVersion in admin server node\n+    DomainCrd crd = new DomainCrd(originalYaml);\n+    Map<String, Object> cluster = new HashMap();\n+    cluster.put(\"restartVersion\", \"v1.1\");\n+    crd.addObjectNodeToCluster(\"dataCluster\", cluster);\n+    String modYaml = crd.getYamlTree();\n+    LoggerHelper.getLocal().log(Level.INFO, modYaml);\n+\n+    // Write the modified yaml to a new file\n+    Path path = Paths.get(restartTmpDir, \"restart.cluster.yaml\");\n+    LoggerHelper.getLocal().log(Level.INFO, \"Path of the modified domain.yaml :{0}\", path.toString());\n+    Charset charset = StandardCharsets.UTF_8;\n+    Files.write(path, modYaml.getBytes(charset));\n+\n+    // Apply the new yaml to update the domain crd\n+    LoggerHelper.getLocal().log(Level.INFO, \"kubectl apply -f {0}\", path.toString());\n+    ExecResult exec = TestUtils.exec(\"kubectl apply -f \" + path.toString());\n+    LoggerHelper.getLocal().log(Level.INFO, exec.stdout());\n+    LoggerHelper.getLocal().log(Level.INFO, \"Verifying if the cluster is restarted\");\n+\n+    TestUtils.checkPodReady(domainUid + \"-new-managed-server1\", domainNS1);\n+    TestUtils.checkPodReady(domainUid + \"-new-managed-server2\", domainNS1);\n+\n+  }\n+\n+  private void verifyServersIngressRunning() throws Exception {\n+    LoggerHelper.getLocal().log(Level.INFO, \"Verifying server status\");\n+    domain.verifyServersReady();\n+    LoggerHelper.getLocal().log(Level.INFO, \"Verifying traefik and ingress created for the domain\");\n+    LoggerHelper.getLocal().log(Level.INFO,\n+        TestUtils.exec(\"helm status traefik-operator\").stdout(), true);\n+    LoggerHelper.getLocal().log(Level.INFO,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NTAyMQ=="}, "originalCommit": {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff"}, "originalPosition": 170}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5f2f1063b4ee91ee90b5fd79e4dc26912543173", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b5f2f1063b4ee91ee90b5fd79e4dc26912543173", "committedDate": "2020-03-25T21:32:57Z", "message": "update based on review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNjAxNzUz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#pullrequestreview-381601753", "createdAt": "2020-03-25T23:09:30Z", "commit": {"oid": "b5f2f1063b4ee91ee90b5fd79e4dc26912543173"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMzowOTozMFrOF7xvyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMzowOTozMFrOF7xvyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyNTM1Mg==", "bodyText": "it is my strong preference that you do not duplicate this string (the command to be run) -- it will just lead to future mistakes or difficulty understanding the intent", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r398225352", "createdAt": "2020-03-25T23:09:30Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/resources/apps/buildDeployCoherenceAppInPod.sh", "diffHunk": "@@ -75,11 +74,11 @@ cres=$?\n \n echo \"Deploy ${APP_NAME} ear using curl:\"\n \n-echo -e \"curl --noproxy '*' --silent  --user ${USER}:${PASSWORD} -H X-Requested-By:MyClient -H Accept:application/json -H Content-Type:multipart/form-data -F \\\"model={ name: '${APP_NAME}', targets: [ { identity: [ clusters, '${EAR_DEPLOY_TARGET}' ] } ] }\\\" -F \\\"sourcePath=@${ARCHIVE_FILE_EAR}\\\" -H \\\"Prefer:respond-async\\\" -X POST http://${HOST}:${PORT}/management/weblogic/latest/edit/appDeployments -o ${APP_DIR_INPOD}/deployear.out\\n\"\n+echo -e \"curl --noproxy '*' -v --user ${USER}:${PASSWORD} -H X-Requested-By:MyClient -H Accept:application/json -H Content-Type:application/json -d \"{name: '${APP_NAME}', sourcePath='${ARCHIVE_FILE_EAR}', targets: [ { identity: [ 'clusters', '${EAR_DEPLOY_TARGET}' ] } ] }\" -X POST http://${HOST}:${PORT}/management/weblogic/latest/edit/appDeployments -o ${APP_DIR_INPOD}/deployear.out\\n\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5f2f1063b4ee91ee90b5fd79e4dc26912543173"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9d1d32c444cd1eb710b7117e3ab640c9e8bd745", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e9d1d32c444cd1eb710b7117e3ab640c9e8bd745", "committedDate": "2020-03-26T01:30:06Z", "message": "fix curl command"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNjU1OTcz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#pullrequestreview-381655973", "createdAt": "2020-03-26T02:05:00Z", "commit": {"oid": "e9d1d32c444cd1eb710b7117e3ab640c9e8bd745"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMDQyODA2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#pullrequestreview-382042806", "createdAt": "2020-03-26T14:07:19Z", "commit": {"oid": "e9d1d32c444cd1eb710b7117e3ab640c9e8bd745"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMzQzMDA3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#pullrequestreview-382343007", "createdAt": "2020-03-26T19:25:25Z", "commit": {"oid": "e9d1d32c444cd1eb710b7117e3ab640c9e8bd745"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4896, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}