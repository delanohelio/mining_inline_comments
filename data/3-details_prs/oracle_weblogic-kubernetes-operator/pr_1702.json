{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MTU0MTAx", "number": 1702, "title": "Correct affinity merging logic", "bodyText": "Without this change, I was seeing concurrent modification exceptions and duplicated elements in the merged data structures. It looks like we already had similar problems because I was able to use logic similar to what we have for other types in serverPod.", "createdAt": "2020-06-03T11:57:28Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1702", "merged": true, "mergeCommit": {"oid": "f4155ae80a8db8dd8aea0d6b473b592562b9dfb7"}, "closed": true, "closedAt": "2020-06-03T19:30:54Z", "author": {"login": "rjeberhard"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnc0uyAH2gAyNDI3MTU0MTAxOjE2MjlkNzA0YzNjNTY0NjdmYTdjZDM2YTJmOGIxMmVjNGVjZGY1NmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcntPUFgFqTQyMzc5Mzk2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1629d704c3c56467fa7cd36a2f8b12ec4ecdf56c", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1629d704c3c56467fa7cd36a2f8b12ec4ecdf56c", "committedDate": "2020-06-02T22:44:04Z", "message": "Correct affinity merging logic"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNzI2MTEx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1702#pullrequestreview-423726111", "createdAt": "2020-06-03T16:24:02Z", "commit": {"oid": "1629d704c3c56467fa7cd36a2f8b12ec4ecdf56c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNjoyNDowMlrOGejwjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNjoyNDowMlrOGejwjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDY5NjMzNA==", "bodyText": "If to.getPreferred..() was null, does the array preferredDuringSchedulingIgnoredDuringExecution contains element from from.getPreferred...()?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1702#discussion_r434696334", "createdAt": "2020-06-03T16:24:02Z", "author": {"login": "alai8"}, "path": "operator/src/main/java/oracle/kubernetes/weblogic/domain/model/ServerPod.java", "diffHunk": "@@ -307,12 +311,18 @@ private void copyValues(V1Affinity to, V1Affinity from) {\n   }\n \n   private void copyValues(V1NodeAffinity to, V1NodeAffinity from) {\n-    if (to.getPreferredDuringSchedulingIgnoredDuringExecution() == null) {\n-      to.setPreferredDuringSchedulingIgnoredDuringExecution(from.getPreferredDuringSchedulingIgnoredDuringExecution());\n-    } else if (from.getPreferredDuringSchedulingIgnoredDuringExecution() != null) {\n-      from.getPreferredDuringSchedulingIgnoredDuringExecution()\n-          .forEach(to::addPreferredDuringSchedulingIgnoredDuringExecutionItem);\n+    if (from.getPreferredDuringSchedulingIgnoredDuringExecution() != null) {\n+      List<V1PreferredSchedulingTerm> preferredDuringSchedulingIgnoredDuringExecution = new ArrayList<>();\n+      if (to.getPreferredDuringSchedulingIgnoredDuringExecution() != null) {\n+        preferredDuringSchedulingIgnoredDuringExecution =\n+            Stream.concat(to.getPreferredDuringSchedulingIgnoredDuringExecution().stream(),\n+                from.getPreferredDuringSchedulingIgnoredDuringExecution().stream())\n+                .distinct()\n+                .collect(Collectors.toList());\n+      }\n+      to.setPreferredDuringSchedulingIgnoredDuringExecution(preferredDuringSchedulingIgnoredDuringExecution);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1629d704c3c56467fa7cd36a2f8b12ec4ecdf56c"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNzI4MjI3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1702#pullrequestreview-423728227", "createdAt": "2020-06-03T16:26:34Z", "commit": {"oid": "1629d704c3c56467fa7cd36a2f8b12ec4ecdf56c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNjoyNjozNFrOGej3Og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNjoyNjozNFrOGej3Og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDY5ODA0Mg==", "bodyText": "do we need deep copy here?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1702#discussion_r434698042", "createdAt": "2020-06-03T16:26:34Z", "author": {"login": "alai8"}, "path": "operator/src/main/java/oracle/kubernetes/weblogic/domain/model/ServerPod.java", "diffHunk": "@@ -307,12 +311,18 @@ private void copyValues(V1Affinity to, V1Affinity from) {\n   }\n \n   private void copyValues(V1NodeAffinity to, V1NodeAffinity from) {\n-    if (to.getPreferredDuringSchedulingIgnoredDuringExecution() == null) {\n-      to.setPreferredDuringSchedulingIgnoredDuringExecution(from.getPreferredDuringSchedulingIgnoredDuringExecution());\n-    } else if (from.getPreferredDuringSchedulingIgnoredDuringExecution() != null) {\n-      from.getPreferredDuringSchedulingIgnoredDuringExecution()\n-          .forEach(to::addPreferredDuringSchedulingIgnoredDuringExecutionItem);\n+    if (from.getPreferredDuringSchedulingIgnoredDuringExecution() != null) {\n+      List<V1PreferredSchedulingTerm> preferredDuringSchedulingIgnoredDuringExecution = new ArrayList<>();\n+      if (to.getPreferredDuringSchedulingIgnoredDuringExecution() != null) {\n+        preferredDuringSchedulingIgnoredDuringExecution =\n+            Stream.concat(to.getPreferredDuringSchedulingIgnoredDuringExecution().stream(),\n+                from.getPreferredDuringSchedulingIgnoredDuringExecution().stream())\n+                .distinct()\n+                .collect(Collectors.toList());\n+      }\n+      to.setPreferredDuringSchedulingIgnoredDuringExecution(preferredDuringSchedulingIgnoredDuringExecution);\n     }\n+\n     if (to.getRequiredDuringSchedulingIgnoredDuringExecution() == null) {\n       to.setRequiredDuringSchedulingIgnoredDuringExecution(from.getRequiredDuringSchedulingIgnoredDuringExecution());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1629d704c3c56467fa7cd36a2f8b12ec4ecdf56c"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72615b07dcd264c06a652fb7fb76e3aeffbfdba1", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/72615b07dcd264c06a652fb7fb76e3aeffbfdba1", "committedDate": "2020-06-03T17:42:44Z", "message": "Address review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNzkzOTYz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1702#pullrequestreview-423793963", "createdAt": "2020-06-03T17:51:35Z", "commit": {"oid": "72615b07dcd264c06a652fb7fb76e3aeffbfdba1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4476, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}