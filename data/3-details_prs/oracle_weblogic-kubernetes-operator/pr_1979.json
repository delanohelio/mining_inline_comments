{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxODQ1MDYw", "number": 1979, "title": "OWLS-84881 better handle long domainUID", "bodyText": "Includes the following changes to better handle long domainUIDs and WebLogic cluster/server names to make sure that all operator-generated K8S resource names do not violate Kubernetes' restrictions.\n\nAdd a limit to the length of a domainUID.\nAdd domain validation to make sure that the generated introspector job name and service names are no more than 64 characters. This fails an invalid configuration sooner with a clear error message.\nShortened the default suffixes for introspector job name and external service name.\nAdd configurables to allow customers to specify custom suffixes for generated names. This also allows customer to restore old suffixes. There are helm validations to the new configurables.\nAdd use test cases for the product changes.\nModified integration test cases to match the new default suffixes.", "createdAt": "2020-10-12T22:05:28Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979", "merged": true, "mergeCommit": {"oid": "bf297e7da89bfbf1532effbe7ab97dd54a616f76"}, "closed": true, "closedAt": "2020-10-15T22:18:08Z", "author": {"login": "doxiao"}, "timelineItems": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPkY52gH2gAyNTAxODQ1MDYwOmE3ZjgwOGJjODQ2MjJiM2MyN2Y1NmY3ZTkxYTBkZWJlY2U2MDA1YWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdS5XYcAFqTUwOTg0NzQ0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a7f808bc84622b3c27f56f7e91a0debece6005aa", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a7f808bc84622b3c27f56f7e91a0debece6005aa", "committedDate": "2020-10-05T14:09:53Z", "message": "add limits to generated resource names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efc37f95f1374874a37f5a7b1ac1945595ecb6f7", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/efc37f95f1374874a37f5a7b1ac1945595ecb6f7", "committedDate": "2020-10-06T18:09:22Z", "message": "work in progress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba0b808ada4d5559e18925c785266ce6cd840922", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ba0b808ada4d5559e18925c785266ce6cd840922", "committedDate": "2020-10-07T21:33:07Z", "message": "get server and cluster info from introspector's results"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8f993facdd059ddd3ee725d2e5595dbaae53ffb", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a8f993facdd059ddd3ee725d2e5595dbaae53ffb", "committedDate": "2020-10-08T17:49:35Z", "message": "new configuration, validation, and unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f70ee23ae86de6988854bc1fa8ee29c9c3a41764", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f70ee23ae86de6988854bc1fa8ee29c9c3a41764", "committedDate": "2020-10-08T18:02:20Z", "message": "minor change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8eac0f086f6a708f27d0028566863f4bf81830bb", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8eac0f086f6a708f27d0028566863f4bf81830bb", "committedDate": "2020-10-08T18:17:58Z", "message": "Merge remote-tracking branch 'origin/develop' into OWLS-84661-long-domainUID\n\nConflicts:\n\toperator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92ba856e392b6e452d655cac3d79a494dd64d5ac", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/92ba856e392b6e452d655cac3d79a494dd64d5ac", "committedDate": "2020-10-09T02:22:34Z", "message": "fix operator chart validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cfb6ad699b26b9a101ba6afd3f15752016915c1", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6cfb6ad699b26b9a101ba6afd3f15752016915c1", "committedDate": "2020-10-09T15:02:47Z", "message": "fix chart validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c33dc78979371c90a0d46de3f2b9a6e99bc735d5", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c33dc78979371c90a0d46de3f2b9a6e99bc735d5", "committedDate": "2020-10-12T15:07:29Z", "message": "fix hard-coded external service name suffix in integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "356a9ea5012e356424275d1afaeceb267da0a0a9", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/356a9ea5012e356424275d1afaeceb267da0a0a9", "committedDate": "2020-10-12T19:48:20Z", "message": "fix more integration test failures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a7dd1fba5ad29fc6dc0254e51e7709c97bed7ff", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7a7dd1fba5ad29fc6dc0254e51e7709c97bed7ff", "committedDate": "2020-10-12T21:32:55Z", "message": "clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56b5656e82acd01c5602fc0293312b749258a7c4", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/56b5656e82acd01c5602fc0293312b749258a7c4", "committedDate": "2020-10-12T21:52:07Z", "message": "minor doc fixwq"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cc643f68223f1cbb62d7b31f8a44471f8635cf4", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8cc643f68223f1cbb62d7b31f8a44471f8635cf4", "committedDate": "2020-10-12T21:53:29Z", "message": "Revert \"minor doc fixwq\"\n\nThis reverts commit 56b5656e82acd01c5602fc0293312b749258a7c4."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b8ef85b6f45d3a2096bb8cf5538a7159a55f83a", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2b8ef85b6f45d3a2096bb8cf5538a7159a55f83a", "committedDate": "2020-10-12T21:56:01Z", "message": "minor doc fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "489b83ff066702f26cc79dfa9b384e52d77aed81", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/489b83ff066702f26cc79dfa9b384e52d77aed81", "committedDate": "2020-10-13T00:02:35Z", "message": "minor fix to test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ffb51f64f589e25491f47ea81179f661e5ddf01", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3ffb51f64f589e25491f47ea81179f661e5ddf01", "committedDate": "2020-10-13T00:06:31Z", "message": "clean up test constants"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3Mzg5Mjg5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#pullrequestreview-507389289", "createdAt": "2020-10-13T12:41:21Z", "commit": {"oid": "3ffb51f64f589e25491f47ea81179f661e5ddf01"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMjo0MToyMVrOHgkr0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxMjo0MzozMlrOHgkxdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkxNzUyMQ==", "bodyText": "the Kubernetes' limit -> the Kubernetes limit (no apostrophe needed)\nkubernetes appends additional 5 -> Kubernetes appends five additional", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r503917521", "createdAt": "2020-10-13T12:41:21Z", "author": {"login": "rosemarymarano"}, "path": "kubernetes/charts/weblogic-operator/values.yaml", "diffHunk": "@@ -167,3 +167,21 @@ externalDebugHttpPort: 30999\n # such as \"name, claimName, volumeName\", or leave it commented out to use \n # the default list of field names.\n # dns1123Fields: \"\"\n+\n+# introspectorJobNameSuffix overrides the default suffix that the operator uses\n+# to append to the domainUID to form the name of the domain introspector job name.\n+# Note that the resultant job name should not be more than 58 characters due to\n+# the Kubernetes' limit to the name of a job and kubernetes appends additional 5", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ffb51f64f589e25491f47ea81179f661e5ddf01"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkxODY0MQ==", "bodyText": "admin server name -> admin server name, (a comma helps the readability of this long sentence)", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r503918641", "createdAt": "2020-10-13T12:43:00Z", "author": {"login": "rosemarymarano"}, "path": "kubernetes/charts/weblogic-operator/values.yaml", "diffHunk": "@@ -167,3 +167,21 @@ externalDebugHttpPort: 30999\n # such as \"name, claimName, volumeName\", or leave it commented out to use \n # the default list of field names.\n # dns1123Fields: \"\"\n+\n+# introspectorJobNameSuffix overrides the default suffix that the operator uses\n+# to append to the domainUID to form the name of the domain introspector job name.\n+# Note that the resultant job name should not be more than 58 characters due to\n+# the Kubernetes' limit to the name of a job and kubernetes appends additional 5\n+# characters to the name of the pod that is created by the job controller.\n+# The default suffix is '-introspector'.\n+# The default suffix in pre-3.1.0 is \"-introspect-domain-job\"\n+# introspectorJobNameSuffix: \"-introspector\"\n+\n+# externalServiceNameSuffix overrides the default suffix that the operator uses\n+# to append to the domainUID and the WebLogic admin server name to form the name", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ffb51f64f589e25491f47ea81179f661e5ddf01"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzkxODk2NA==", "bodyText": "Kubernetes' -> Kubernetes", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r503918964", "createdAt": "2020-10-13T12:43:32Z", "author": {"login": "rosemarymarano"}, "path": "kubernetes/charts/weblogic-operator/values.yaml", "diffHunk": "@@ -167,3 +167,21 @@ externalDebugHttpPort: 30999\n # such as \"name, claimName, volumeName\", or leave it commented out to use \n # the default list of field names.\n # dns1123Fields: \"\"\n+\n+# introspectorJobNameSuffix overrides the default suffix that the operator uses\n+# to append to the domainUID to form the name of the domain introspector job name.\n+# Note that the resultant job name should not be more than 58 characters due to\n+# the Kubernetes' limit to the name of a job and kubernetes appends additional 5\n+# characters to the name of the pod that is created by the job controller.\n+# The default suffix is '-introspector'.\n+# The default suffix in pre-3.1.0 is \"-introspect-domain-job\"\n+# introspectorJobNameSuffix: \"-introspector\"\n+\n+# externalServiceNameSuffix overrides the default suffix that the operator uses\n+# to append to the domainUID and the WebLogic admin server name to form the name\n+# of the domain's admin server external service.\n+# Note that the resultant name should not be more than 63 characters due to\n+# the Kubernetes' limit to the name of a service.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ffb51f64f589e25491f47ea81179f661e5ddf01"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe5c03f4b03543c6358e194a97276af4ade1c898", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fe5c03f4b03543c6358e194a97276af4ade1c898", "committedDate": "2020-10-13T13:20:48Z", "message": "minor doc edits based on review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NDMxOTgy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#pullrequestreview-507431982", "createdAt": "2020-10-13T13:26:15Z", "commit": {"oid": "fe5c03f4b03543c6358e194a97276af4ade1c898"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NTU1MzM2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#pullrequestreview-507555336", "createdAt": "2020-10-13T15:22:21Z", "commit": {"oid": "fe5c03f4b03543c6358e194a97276af4ade1c898"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNToyMjoyMVrOHgsQ1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNToyMjoyMVrOHgsQ1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA0MTY4Nw==", "bodyText": "Minor nit: Would getIntrospectJobName would be more accurate? The runtime pod name is generated by k8s using a decoration of the JobName...", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504041687", "createdAt": "2020-10-13T15:22:21Z", "author": {"login": "tbarnes-us"}, "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItConfigDistributionStrategy.java", "diffHunk": "@@ -767,7 +768,7 @@ private void verifyPodsStateNotChanged() {\n   private void verifyIntrospectorRuns() {\n     //verify the introspector pod is created and runs\n     logger.info(\"Verifying introspector pod is created, runs and deleted\");\n-    String introspectPodName = domainUid + \"-\" + \"introspect-domain-job\";\n+    String introspectPodName = getIntrospectPodName(domainUid);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe5c03f4b03543c6358e194a97276af4ade1c898"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NjAzNDg0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#pullrequestreview-507603484", "createdAt": "2020-10-13T16:08:47Z", "commit": {"oid": "fe5c03f4b03543c6358e194a97276af4ade1c898"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjowODo0N1rOHgud6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjowODo0N1rOHgud6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA3NzgwMA==", "bodyText": "I think there's a significant risk that service names in a cluster may unexpectedly become too long when a WL cluster configuration is changed to allow more servers.  For example, from <9 to >9 servers, or from <99 to >100 servers...", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504077800", "createdAt": "2020-10-13T16:08:47Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/java/oracle/kubernetes/weblogic/domain/model/Domain.java", "diffHunk": "@@ -628,10 +653,65 @@ public boolean equals(Object other) {\n       verifyNoAlternateSecretNamespaceSpecified();\n       addMissingModelConfigMap(kubernetesResources);\n       verifyIstioExposingDefaultChannel();\n+      verifyIntrospectorJobName();\n \n       return failures;\n     }\n \n+    private void verifyIntrospectorJobName() {\n+      // K8S adds a 5 character suffix to an introspector job name\n+      if (LegalNames.toJobIntrospectorName(getDomainUid()).length()\n+          > LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH - 5) {\n+        failures.add(DomainValidationMessages.exceedMaxIntrospectorJobName(getDomainUid()));\n+      }\n+    }\n+\n+    private void verifyGeneratedResourceNames(WlsDomainConfig wlsDomainConfig) {\n+      checkGeneratedServerServiceName(wlsDomainConfig.getAdminServerName());\n+      if (isExternalServiceConfigured(getSpec())) {\n+        checkGeneratedExternalServiceName(wlsDomainConfig.getAdminServerName());\n+      }\n+\n+      // domain level serverConfigs do not contain servers in dynamic clusters\n+      wlsDomainConfig.getServerConfigs()\n+          .values()\n+          .stream()\n+          .map(WlsServerConfig::getName)\n+          .forEach(this::checkGeneratedServerServiceName);\n+      wlsDomainConfig.getClusterConfigs()\n+          .values()\n+          .iterator()\n+          .forEachRemaining(wlsClusterConfig\n+              // serverConfigs contains configured and dynamic servers in the cluster\n+              -> wlsClusterConfig.getServerConfigs().forEach(wlsServerConfig\n+                  -> this.checkGeneratedServerServiceName(wlsServerConfig.getName())));\n+      wlsDomainConfig.getClusterConfigs()\n+          .values()\n+          .iterator()\n+          .forEachRemaining(wlsClusterConfig -> this.checkGeneratedClusterServiceName(wlsClusterConfig.getName()));\n+    }\n+\n+    private void checkGeneratedExternalServiceName(String adminServerName) {\n+      if (LegalNames.toExternalServiceName(getDomainUid(), adminServerName).length()\n+          > LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH) {\n+        failures.add(DomainValidationMessages.exceedMaxExternalServiceName(getDomainUid(), adminServerName));\n+      }\n+    }\n+\n+    private void checkGeneratedServerServiceName(String serverName) {\n+      if (LegalNames.toServerServiceName(getDomainUid(), serverName).length()\n+          > LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH) {\n+        failures.add(DomainValidationMessages.exceedMaxServerServiceName(getDomainUid(), serverName));\n+      }\n+    }\n+\n+    private void checkGeneratedClusterServiceName(String clusterName) {\n+      if (LegalNames.toClusterServiceName(getDomainUid(), clusterName).length()\n+          > LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH) {\n+        failures.add(DomainValidationMessages.exceedMaxClusterServiceName(getDomainUid(), clusterName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe5c03f4b03543c6358e194a97276af4ade1c898"}, "originalPosition": 106}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NjA5NzYz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#pullrequestreview-507609763", "createdAt": "2020-10-13T16:15:50Z", "commit": {"oid": "fe5c03f4b03543c6358e194a97276af4ade1c898"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjoxNTo1MFrOHguwNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjoxNTo1MFrOHguwNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA4MjQ4Nw==", "bodyText": "For each of these, it might be helpful for the administrator to also include the maximum allowed length as well as the 'combination' that is exceeding the length.\nFor example:\nThe DomainUID ''{0}'' and cluster name ''{1}'' combination ''{2}'' exceeds maximum allowed length ''{3}''.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504082487", "createdAt": "2020-10-13T16:15:50Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/Operator.properties", "diffHunk": "@@ -208,6 +208,10 @@ exposing it.\n WLSDO-0014=The domain {0} introspect job failed, it will automatically retry in {1} seconds. Current number of  \\\n   retries = {2}\n WLSDO-0015=\"Retrying failed domain {0} introspect job, retry {1} of a maximum {2}.\"\n+WLSDO-0016=DomainUID ''{0}'' exceeds maximum allowed length.\n+WLSDO-0017=DomainUID ''{0}'' and cluster name ''{1}'' combination exceeds maximum allowed length.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fe5c03f4b03543c6358e194a97276af4ade1c898"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d305fc4c9258fa777b72bbf4cefc6c1ec9516761", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d305fc4c9258fa777b72bbf4cefc6c1ec9516761", "committedDate": "2020-10-13T19:39:13Z", "message": "improve error msg and remove hard-coded suffixes from doc and samples"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13f69bc770e69317b04de1090adc44d099e69b35", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/13f69bc770e69317b04de1090adc44d099e69b35", "committedDate": "2020-10-13T19:44:18Z", "message": "cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NzczMjU0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#pullrequestreview-507773254", "createdAt": "2020-10-13T19:46:32Z", "commit": {"oid": "d305fc4c9258fa777b72bbf4cefc6c1ec9516761"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOTo0NjozMlrOHg2uuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOTo0NjozMlrOHg2uuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIxMzE3OQ==", "bodyText": "This file looks like it was accidentally checked in.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504213179", "createdAt": "2020-10-13T19:46:32Z", "author": {"login": "tbarnes-us"}, "path": "docs-source/out", "diffHunk": "@@ -0,0 +1,351 @@\n+diff --git a/docs-source/content/faq/namespace-management.md b/docs-source/content/faq/namespace-management.md", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d305fc4c9258fa777b72bbf4cefc6c1ec9516761"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acdaef1ac256019bb4d99e0c2caa8e8227b6db1a", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/acdaef1ac256019bb4d99e0c2caa8e8227b6db1a", "committedDate": "2020-10-14T21:05:45Z", "message": "change the legal checks based on Ryan's suggestion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a61b85dbe0d1bd4a84096e4bf2d629f82f97d41", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2a61b85dbe0d1bd4a84096e4bf2d629f82f97d41", "committedDate": "2020-10-15T13:12:38Z", "message": "add cluster size padding validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19132586efc8d3d8b386bb12e7356058dd8ea56c", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/19132586efc8d3d8b386bb12e7356058dd8ea56c", "committedDate": "2020-10-15T15:28:37Z", "message": "minor changes to helm validation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NTI0NzAz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#pullrequestreview-509524703", "createdAt": "2020-10-15T15:48:26Z", "commit": {"oid": "19132586efc8d3d8b386bb12e7356058dd8ea56c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNTo0ODoyN1rOHiOftA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNTo0ODoyN1rOHiOftA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY1MTEyNA==", "bodyText": "The limit should not be adjusted downward for clusters greater than size 99.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r505651124", "createdAt": "2020-10-15T15:48:27Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/java/oracle/kubernetes/weblogic/domain/model/Domain.java", "diffHunk": "@@ -628,10 +654,84 @@ public boolean equals(Object other) {\n       verifyNoAlternateSecretNamespaceSpecified();\n       addMissingModelConfigMap(kubernetesResources);\n       verifyIstioExposingDefaultChannel();\n+      verifyIntrospectorJobName();\n \n       return failures;\n     }\n \n+    private void verifyIntrospectorJobName() {\n+      // K8S adds a 5 character suffix to an introspector job name\n+      if (LegalNames.toJobIntrospectorName(getDomainUid()).length()\n+          > LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH - 5) {\n+        failures.add(DomainValidationMessages.exceedMaxIntrospectorJobName(\n+            getDomainUid(),\n+            LegalNames.toJobIntrospectorName(getDomainUid()),\n+            LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH - 5));\n+      }\n+    }\n+\n+    private void verifyGeneratedResourceNames(WlsDomainConfig wlsDomainConfig) {\n+      checkGeneratedServerServiceName(wlsDomainConfig.getAdminServerName(), -1);\n+      if (isExternalServiceConfigured(getSpec())) {\n+        checkGeneratedExternalServiceName(wlsDomainConfig.getAdminServerName());\n+      }\n+\n+      // domain level serverConfigs do not contain servers in dynamic clusters\n+      wlsDomainConfig.getServerConfigs()\n+          .values()\n+          .stream()\n+          .map(WlsServerConfig::getName)\n+          .forEach(serverName -> checkGeneratedServerServiceName(serverName, -1));\n+      wlsDomainConfig.getClusterConfigs()\n+          .values()\n+          .iterator()\n+          .forEachRemaining(wlsClusterConfig\n+              // serverConfigs contains configured and dynamic servers in the cluster\n+              -> wlsClusterConfig.getServerConfigs().forEach(wlsServerConfig\n+                  -> this.checkGeneratedServerServiceName(\n+                      wlsServerConfig.getName(), wlsClusterConfig.getServerConfigs().size())));\n+      wlsDomainConfig.getClusterConfigs()\n+          .values()\n+          .iterator()\n+          .forEachRemaining(wlsClusterConfig -> this.checkGeneratedClusterServiceName(wlsClusterConfig.getName()));\n+    }\n+\n+    private void checkGeneratedExternalServiceName(String adminServerName) {\n+      if (LegalNames.toExternalServiceName(getDomainUid(), adminServerName).length()\n+          > LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH) {\n+        failures.add(DomainValidationMessages.exceedMaxExternalServiceName(\n+            getDomainUid(),\n+            adminServerName,\n+            LegalNames.toExternalServiceName(getDomainUid(), adminServerName),\n+            LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH));\n+      }\n+    }\n+\n+    private void checkGeneratedServerServiceName(String serverName, int clusterSize) {\n+      int limit = LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH;\n+      if (Main.Namespaces.isClusterSizePaddingValidation() && clusterSize > 0) {\n+        limit = clusterSize >= 10 ? limit - 1 : limit - 2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "19132586efc8d3d8b386bb12e7356058dd8ea56c"}, "originalPosition": 110}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6c0a9764f945fff552a6a52f07cc7f7963f760b", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a6c0a9764f945fff552a6a52f07cc7f7963f760b", "committedDate": "2020-10-15T16:09:22Z", "message": "only reserve spaces for cluster size wqsmaller than 100"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae8afad7713ee62fb0a2db81415112b6043aa806", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ae8afad7713ee62fb0a2db81415112b6043aa806", "committedDate": "2020-10-15T16:37:50Z", "message": "one more unit test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65b2bd1ea835265ad139d493cd2582b1ba1fd19e", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/65b2bd1ea835265ad139d493cd2582b1ba1fd19e", "committedDate": "2020-10-15T16:56:21Z", "message": "minor changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NTk5MzIz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#pullrequestreview-509599323", "createdAt": "2020-10-15T17:14:33Z", "commit": {"oid": "65b2bd1ea835265ad139d493cd2582b1ba1fd19e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e0686304f1b766bd77d4043e5686de5e068f1c2", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8e0686304f1b766bd77d4043e5686de5e068f1c2", "committedDate": "2020-10-15T17:33:02Z", "message": "Merge remote-tracking branch 'origin/develop' into OWLS-84661-long-domainUID"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20b6964f60240701b154c7c98d452ce3446610d1", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/20b6964f60240701b154c7c98d452ce3446610d1", "committedDate": "2020-10-15T17:45:15Z", "message": "minor doc change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb14ac4206fe8c1b262cf45112146291f2ecc85b", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/cb14ac4206fe8c1b262cf45112146291f2ecc85b", "committedDate": "2020-10-15T18:09:47Z", "message": "change a method name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5ODQ3NDQy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#pullrequestreview-509847442", "createdAt": "2020-10-15T22:18:00Z", "commit": {"oid": "cb14ac4206fe8c1b262cf45112146291f2ecc85b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4237, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}