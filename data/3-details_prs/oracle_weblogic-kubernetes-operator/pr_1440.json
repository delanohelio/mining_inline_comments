{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3MzY0MDk5", "number": 1440, "title": "OWLS 79243  :  Helm 3/2 support for Operator Integration Tests", "bodyText": "Added conditional Logic to support both Helm 3.x and Helm 2.x type of commands while running Operator Integration Tests.  Most of changes are around\n(a) helm install  (b) helm delete/uninstall   (c) helm list  (d) helm upgrade\nAll the command in Helm 3 need a Namespace explicit argument, (--name) has been removed in install command .\nRef :  https://itnext.io/breaking-changes-in-helm-3-and-how-to-fix-them-39fea23e06ff\nRemoved Helm Environment variable dependency from the Test. Now the BaseTest will determine the Helm Version)  automatically\nExternal Jenkin Job (passed) with an intermittent failure\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-quicktest/1049/\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-quicktest/1050/\nBased on composite results, the tests failures are not related to helm. So the PR is ready for review\nNew external Jenkin Run:  https://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-quicktest/1059/        ( one intermittent failure )", "createdAt": "2020-02-19T19:53:41Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440", "merged": true, "mergeCommit": {"oid": "59ee1e937693ec07b6a9950fdcc6d83e65546118"}, "closed": true, "closedAt": "2020-03-03T15:15:15Z", "author": {"login": "anpanigr"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFpkLwAH2gAyMzc3MzY0MDk5OmZkNWNlYzUyYTRiNmJjMzgxMDllZjc0MTZmMGIxZjhlNjM0ZTc3YmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKD29MAFqTM2ODA2NDMzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fd5cec52a4b6bc38109ef7416f0b1f8e634e77bd", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fd5cec52a4b6bc38109ef7416f0b1f8e634e77bd", "committedDate": "2020-02-18T22:21:20Z", "message": "Initial Change for Helm 2.x/3.x comptibility"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81d4ccc6f1231f221103aaa1328422ec83d254bd", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/81d4ccc6f1231f221103aaa1328422ec83d254bd", "committedDate": "2020-02-19T18:36:47Z", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into OWLS-79243"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/356b4a9b70207da0ac4b1aeb884afba654a6d795", "committedDate": "2020-02-20T16:08:55Z", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into OWLS-79243"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMTM5MzUx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#pullrequestreview-362139351", "createdAt": "2020-02-20T18:38:33Z", "commit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxODozODozM1rOFserOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxOTowMjowNVrOFsfbJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NDI1MQ==", "bodyText": "remove name from printed message", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382184251", "createdAt": "2020-02-20T18:38:33Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/BaseTest.java", "diffHunk": "@@ -82,6 +84,17 @@\n     QUICKTEST =\n         System.getenv(\"QUICKTEST\") != null && System.getenv(\"QUICKTEST\").equalsIgnoreCase(\"true\");\n \n+    HELM_VERSION = System.getenv(\"HELM_VERSION\");\n+    if (HELM_VERSION == null) {\n+      HELM_VERSION = \"V2\";\n+    }\n+ \n+    VOYAGER_VERSION = System.getenv(\"VOYAGER_VERSION\");\n+    if (VOYAGER_VERSION == null) {\n+      VOYAGER_VERSION = \"10.0.0\";\n+    }\n+\n+    System.out.println(\"(PANI) HELM VERSION IS \" + HELM_VERSION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NDc4MA==", "bodyText": "fix typo in --namespace", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382184780", "createdAt": "2020-02-20T18:39:38Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItUsabilityOperatorHelmChart.java", "diffHunk": "@@ -166,7 +167,13 @@ public void testCreateSecondOperatorUsingSameOperatorNsNegativeInstall() throws\n                 + \"does not report expected message \"\n                 + ex.getMessage());\n       }\n-      String cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      String cmdLb = \"\";\n+      if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+        cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      }\n+      if (BaseTest.HELM_VERSION.equals(\"V3\")) {\n+        cmdLb = \"helm list --failed --namesapce \" + opnamespace + \"  | grep \" + oprelease;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NTI1OA==", "bodyText": "fix typo", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382185258", "createdAt": "2020-02-20T18:40:33Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItUsabilityOperatorHelmChart.java", "diffHunk": "@@ -237,13 +244,20 @@ public void testNotPreexistedOpServiceAccountCreateOperatorNegativeInstall() thr\n             true,\n             RestCertType.SELF_SIGNED);\n     String oprelease = (String)(operator.getOperatorMap()).get(\"releaseName\");\n+    String opnamespace = (String)(operator.getOperatorMap()).get(\"namespace\");\n     try {\n       operator.callHelmInstall();\n       throw new RuntimeException(\n           \"FAILURE: Helm installs operator with not preexisted service account \");\n \n     } catch (Exception ex) {\n-      String cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      String cmdLb = \"\";\n+      if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+        cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      }\n+      if (BaseTest.HELM_VERSION.equals(\"V3\")) {\n+        cmdLb = \"helm list --failed --namesapce \" + opnamespace + \"  | grep \" + oprelease;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NTM0OA==", "bodyText": "fix typo", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382185348", "createdAt": "2020-02-20T18:40:45Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItUsabilityOperatorHelmChart.java", "diffHunk": "@@ -319,7 +334,13 @@ public void testSecondOpSharingSameTargetDomainsNsNegativeInstall() throws Excep\n                 + \"target domains namespaces does not report expected message \"\n                 + ex.getMessage());\n       }\n-      String cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      String cmdLb = \"\";\n+      if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+        cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      }\n+      if (BaseTest.HELM_VERSION.equals(\"V3\")) {\n+        cmdLb = \"helm list --failed --namesapce \" + opnamespace + \"  | grep \" + oprelease;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NTQ3MQ==", "bodyText": "fix typo", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382185471", "createdAt": "2020-02-20T18:40:58Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItUsabilityOperatorHelmChart.java", "diffHunk": "@@ -374,7 +396,13 @@ public void testTargetNsIsNotPreexistedNegativeInstall() throws Exception {\n                 + \"namespaces does not report expected message \"\n                 + ex.getMessage());\n       }\n-      String cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      String cmdLb = \"\";\n+      if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+        cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      }\n+      if (BaseTest.HELM_VERSION.equals(\"V3\")) {\n+        cmdLb = \"helm list --failed --namesapce \" + opnamespace + \"  | grep \" + oprelease;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NTc0Mg==", "bodyText": "fix typo in --namespace", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382185742", "createdAt": "2020-02-20T18:41:34Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItUsabilityOperatorHelmChart.java", "diffHunk": "@@ -430,7 +459,13 @@ public void testSecondOpSharingSameExternalRestPortNegativeInstall() throws Exce\n             \"FAILURE: Helm install operator with dublicated rest port number does not report expected message \"\n                 + ex.getMessage());\n       }\n-      String cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      String cmdLb = \"\";\n+      if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+        cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      }\n+      if (BaseTest.HELM_VERSION.equals(\"V3\")) {\n+        cmdLb = \"helm list --failed --namesapce \" + opnamespace + \"  | grep \" + oprelease;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NTg4Ng==", "bodyText": "fix typo in --namespace", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382185886", "createdAt": "2020-02-20T18:41:50Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItUsabilityOperatorHelmChart.java", "diffHunk": "@@ -481,7 +517,13 @@ public void testCreateWithUpperCaseTargetDomainNegativeInstall() throws Exceptio\n                 + \"domains namespace does not report expected message \"\n                 + ex.getMessage());\n       }\n-      String cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      String cmdLb = \"\";\n+      if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+        cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      }\n+      if (BaseTest.HELM_VERSION.equals(\"V3\")) {\n+        cmdLb = \"helm list --failed --namesapce \" + opnamespace + \"  | grep \" + oprelease;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4Nzk3Ng==", "bodyText": "code is duplicated in many places..write a small method may be callHelmList() and call that...", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382187976", "createdAt": "2020-02-20T18:45:58Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItUsabilityOperatorHelmChart.java", "diffHunk": "@@ -481,7 +517,13 @@ public void testCreateWithUpperCaseTargetDomainNegativeInstall() throws Exceptio\n                 + \"domains namespace does not report expected message \"\n                 + ex.getMessage());\n       }\n-      String cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      String cmdLb = \"\";\n+      if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+        cmdLb = \"helm list --failed \" + \"  | grep \" + oprelease;\n+      }\n+      if (BaseTest.HELM_VERSION.equals(\"V3\")) {\n+        cmdLb = \"helm list --failed --namesapce \" + opnamespace + \"  | grep \" + oprelease;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NTg4Ng=="}, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4OTM0Mg==", "bodyText": "should be \"\" or null, not \"Empty String\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382189342", "createdAt": "2020-02-20T18:48:40Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -36,7 +36,12 @@ public LoadBalancer(Map lbMap) throws Exception {\n         Paths.get(userProjectsDir + \"/load-balancers/\" + lbMap.get(\"domainUID\")));\n \n     if (lbMap.get(\"loadBalancer\").equals(\"TRAEFIK\")) {\n-      String cmdLb = \"helm list traefik-operator | grep DEPLOYED\";\n+      String cmdLb = \"Empty String\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5MDEzMA==", "bodyText": "this condition doesn't look correct, namespace is required for V3 ...can you check again", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382190130", "createdAt": "2020-02-20T18:50:12Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -36,7 +36,12 @@ public LoadBalancer(Map lbMap) throws Exception {\n         Paths.get(userProjectsDir + \"/load-balancers/\" + lbMap.get(\"domainUID\")));\n \n     if (lbMap.get(\"loadBalancer\").equals(\"TRAEFIK\")) {\n-      String cmdLb = \"helm list traefik-operator | grep DEPLOYED\";\n+      String cmdLb = \"Empty String\";\n+      if (! BaseTest.HELM_VERSION.equals(\"V2\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5MDI2OA==", "bodyText": "should be \"\" or null, not \"Empty String\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382190268", "createdAt": "2020-02-20T18:50:28Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -53,7 +58,12 @@ public LoadBalancer(Map lbMap) throws Exception {\n     }\n \n     if (lbMap.get(\"loadBalancer\").equals(\"VOYAGER\")) {\n-      String cmdLb = \"helm list voyager-operator | grep DEPLOYED\";\n+      String cmdLb = \"Empty String\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5MDM3NQ==", "bodyText": "check condition", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382190375", "createdAt": "2020-02-20T18:50:40Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -53,7 +58,12 @@ public LoadBalancer(Map lbMap) throws Exception {\n     }\n \n     if (lbMap.get(\"loadBalancer\").equals(\"VOYAGER\")) {\n-      String cmdLb = \"helm list voyager-operator | grep DEPLOYED\";\n+      String cmdLb = \"Empty String\";\n+      if (! BaseTest.HELM_VERSION.equals(\"V2\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5MjE3OA==", "bodyText": "you can just do\ncmd = cmd + \" --namespace traefik \";\n\nsame for initialization ...", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382192178", "createdAt": "2020-02-20T18:54:05Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -163,7 +171,11 @@ private void upgradeTraefikNamespace() throws Exception {\n    * @throws Exception when could not get values\n    */\n   private String getKubernetesNamespaceToUpdate(String domainNamespace) throws Exception {\n-    ExecResult result = TestUtils.exec(\"helm get values traefik-operator\", true);\n+    String cmd = new String(\"helm get values traefik-operator \");\n+    if (! BaseTest.HELM_VERSION.equals(\"V2\")) {\n+      cmd = cmd + new String(\" --namespace traefik \");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5NDg4Nw==", "bodyText": "have you tried using same command for both something like\n\"helm install \"+ name + \" ingress-per-domain\" or\n\"helm install --name \"+ name + \" ingress-per-domain\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382194887", "createdAt": "2020-02-20T18:59:09Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -189,23 +201,31 @@ private String getKubernetesNamespaceToUpdate(String domainNamespace) throws Exc\n \n   private void createTraefikIngress() throws Exception {\n \n-    String chartDir = BaseTest.getProjectRoot() + \"/integration-tests/src/test/resources/charts\";\n+    String chartDir = BaseTest.getProjectRoot() + \"/kubernetes/samples/charts\";\n \n     StringBuffer cmd = new StringBuffer(\"cd \");\n-    cmd.append(chartDir).append(\" && helm install ingress-per-domain \");\n-    cmd.append(\" --name \")\n-        .append(lbMap.get(\"name\"))\n-        .append(\" --namespace \")\n-        .append(lbMap.get(\"namespace\"))\n-        .append(\" --set \")\n-        .append(\"wlsDomain.domainUID=\")\n-        .append(lbMap.get(\"domainUID\"))\n-        .append(\" --set \")\n-        .append(\"wlsDomain.clusterName=\")\n-        .append(lbMap.get(\"clusterName\"))\n-        .append(\" --set \")\n-        .append(\"traefik.hostname=\")\n-        .append(lbMap.get(\"domainUID\"))\n+    cmd.append(chartDir).append(\" && \");\n+    \n+    if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+      cmd.append(\" helm install ingress-per-domain \")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5NTg5MA==", "bodyText": "fix initialization", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382195890", "createdAt": "2020-02-20T19:01:01Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -222,23 +242,11 @@ private void createTraefikIngress() throws Exception {\n    * @throws Exception on failure\n    */\n   public void createVoyagerLoadBalancer() throws Exception {\n-\n-    String cmd1 = \"helm repo add appscode https://charts.appscode.com/stable/\";\n-    LoggerHelper.getLocal().log(Level.INFO, \"Executing Add Appscode Chart Repository cmd \" + cmd1);\n-\n-    executeHelmCommand(cmd1);\n-\n-    String cmd2 = \"helm repo update\";\n-    LoggerHelper.getLocal().log(Level.INFO, \"Executing Appscode Chart Repository upgrade cmd \" + cmd2);\n-\n-    executeHelmCommand(cmd2);\n-\n-    String cmd3 =\n-        \"helm install appscode/voyager --name voyager-operator --version 7.4.0 --namespace voyager \"\n-            + \"--set cloudProvider=baremetal --set apiserver.enableValidatingWebhook=false\";\n-    LoggerHelper.getLocal().log(Level.INFO, \"Executing Install voyager operator cmd \" + cmd3);\n-\n-    executeHelmCommand(cmd3);\n+    String cmdLb = \"Empty String\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 148}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE5NjUxOQ==", "bodyText": "same comment as above", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382196519", "createdAt": "2020-02-20T19:02:05Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -294,23 +306,31 @@ private void upgradeVoyagerNamespace() throws Exception {\n   }\n \n   private void createVoyagerIngress() throws Exception {\n-    String chartDir = BaseTest.getProjectRoot() + \"/integration-tests/src/test/resources/charts\";\n+    String chartDir = BaseTest.getProjectRoot() + \"/kubernetes/samples/charts\";\n \n     StringBuffer cmd = new StringBuffer(\"cd \");\n-    cmd.append(chartDir).append(\" && helm install ingress-per-domain \");\n-    cmd.append(\" --name \")\n-        .append(lbMap.get(\"name\"))\n-        .append(\" --namespace \")\n-        .append(lbMap.get(\"namespace\"))\n-        .append(\" --set type=VOYAGER\")\n-        .append(\" --set \")\n-        .append(\"wlsDomain.domainUID=\")\n-        .append(lbMap.get(\"domainUID\"))\n-        .append(\" --set \")\n-        .append(\"wlsDomain.clusterName=\")\n-        .append(lbMap.get(\"clusterName\"))\n-        .append(\" --set \")\n-        .append(\"voyager.webPort=\")\n+    cmd.append(chartDir).append(\" && \");\n+\n+    if (BaseTest.HELM_VERSION.equals(\"V2\")) {\n+      cmd.append(\" helm install ingress-per-domain \")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "356b4a9b70207da0ac4b1aeb884afba654a6d795"}, "originalPosition": 210}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c0f737dbd43c75ecdac70f1235ff00a3814d0a8", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8c0f737dbd43c75ecdac70f1235ff00a3814d0a8", "committedDate": "2020-02-20T19:48:14Z", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into OWLS-79243"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9e1be19e1b09078982013281c63ba9be5ac2524", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d9e1be19e1b09078982013281c63ba9be5ac2524", "committedDate": "2020-02-20T20:17:49Z", "message": "Resolve review comment on PR"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMjE0NjQw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#pullrequestreview-362214640", "createdAt": "2020-02-20T20:35:32Z", "commit": {"oid": "d9e1be19e1b09078982013281c63ba9be5ac2524"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMDozNTozM1rOFsiRUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQyMDozNTozM1rOFsiRUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI0MzE1NQ==", "bodyText": "do this in the IT class in unprepare rather than having test specific code in common cleanup script", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#discussion_r382243155", "createdAt": "2020-02-20T20:35:33Z", "author": {"login": "vanajamukkara"}, "path": "src/integration-tests/bash/cleanup.sh", "diffHunk": "@@ -317,11 +317,30 @@ mkdir -p $TMP_DIR || fail No permision to create directory $TMP_DIR\n \n # first, if helm is installed, delete all installed helm charts\n if [ -x \"$(command -v helm)\" ]; then\n+  helm version --short --client  | grep v2\n+  [[ $? == 0 ]] && HELM_VERSION=V2\n+  [[ $? == 1 ]] && HELM_VERSION=V3\n+  echo \"Detected Helm Version [$(helm version --short --client)]\"\n   echo @@ Deleting installed helm charts\n-  helm list --short | while read helm_name; do\n-     helm delete --purge  $helm_name\n+  namespaces=`kubectl get ns | grep -v NAME | awk '{ print $1 }'`\n+  for ns in $namespaces\n+  do \n+     helm list --short --namespace $ns | while read helm_name; do\n+     if [ \"$HELM_VERSION\" == \"V2\" ]; then\n+       helm delete --purge  $helm_name\n+     else \n+      helm uninstall $helm_name -n $ns \n+     fi\n+     done\n   done\n \n+  # Remove namespace(s) from usablity Integration tests", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9e1be19e1b09078982013281c63ba9be5ac2524"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fff87075faf5ea220ec908c01b4747c8ef80c0ed", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fff87075faf5ea220ec908c01b4747c8ef80c0ed", "committedDate": "2020-02-20T23:34:02Z", "message": "Removed Helm Env varaiable dependency from the Test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a34d99e104961785edbe3606a463477c5d188a0", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3a34d99e104961785edbe3606a463477c5d188a0", "committedDate": "2020-02-21T21:50:11Z", "message": "Modified the helm scripts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35b1ac0be59ce34160b5c99e3a1e50fa80891bfc", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/35b1ac0be59ce34160b5c99e3a1e50fa80891bfc", "committedDate": "2020-02-26T01:34:05Z", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into OWLS-79243"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de16e10598b3903903cfce3f39334eb65cca4ee3", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/de16e10598b3903903cfce3f39334eb65cca4ee3", "committedDate": "2020-02-26T01:35:02Z", "message": "Modify helm command for Upgrade Test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1754a20817db2d2ad81992e1bc946e80f49162f8", "author": {"user": {"login": "anpanigr", "name": "Antaryami Panigrahi"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1754a20817db2d2ad81992e1bc946e80f49162f8", "committedDate": "2020-03-02T20:59:03Z", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into OWLS-79243"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4MDY0MzM5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1440#pullrequestreview-368064339", "createdAt": "2020-03-03T15:15:04Z", "commit": {"oid": "1754a20817db2d2ad81992e1bc946e80f49162f8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 97, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}