{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2NjgyNDY3", "number": 1746, "title": "Standardize behavior of introspectVersion and restartVersion", "bodyText": "As discussed, the intended behavior is now:\n\nOn restartVersion change, all affected pods are restarted in all modes\nOn introspectVersion change, introspection is redone in all modes. For model-in-image, if the introspection generates a new domain home then any running servers will be rolled to the new domain home.\nIntrospection will also occur if there is no current introspection-results config map or if the domain presently has zero server instances running and is now starting a server.\nFor model-in-image only, introspection will also run for every \u2018make-right\u2019 flow in which it is determined that a server pod must be updated. In particular, that entails rerunning from the start of the step chain, and this time running the introspector.\nIf introspection fails, the domain resource status must reflect the failure; however, the \u2018make-right\u2019 flow otherwise stops and any currently running pods are left intact.", "createdAt": "2020-06-18T18:10:28Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1746", "merged": true, "mergeCommit": {"oid": "10f8dcf6ee1d94607518764046543384e06010de"}, "closed": true, "closedAt": "2020-06-26T17:15:05Z", "author": {"login": "russgold"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsidnMAH2gAyNDM2NjgyNDY3OmE4ODU2ZjgzMTgzNzljNTI5NGM1ZDI2MjM0Y2ExYzBmNjZmYmU5NDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcvGgBoAH2gAyNDM2NjgyNDY3Ojc5ZTU0ZGJjNjE4NTUxMzQ0Y2E1YTliMGYzMzc1NDM1Y2JjNGQ4YzQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a8856f8318379c5294c5d26234ca1c0f66fbe943", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a8856f8318379c5294c5d26234ca1c0f66fbe943", "committedDate": "2020-06-18T18:07:52Z", "message": "Standardize behavior of introspectVersion and restartVersion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5af61143b6817c4c2621259296c26ee37756970e", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5af61143b6817c4c2621259296c26ee37756970e", "committedDate": "2020-06-18T23:21:02Z", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into owls_82785"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5640ae87fa56011e36403cd5f7d7f8de8e17495", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e5640ae87fa56011e36403cd5f7d7f8de8e17495", "committedDate": "2020-06-19T17:22:09Z", "message": "Fix MII md5 checks so that they ignore whitespace"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80f847163e224b154a3d42c1c1597a8b8f7fb30b", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/80f847163e224b154a3d42c1c1597a8b8f7fb30b", "committedDate": "2020-06-19T18:30:09Z", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into owls_82785"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3da9a69d07ce8f6a4feb67456370c7fda5fa561", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a3da9a69d07ce8f6a4feb67456370c7fda5fa561", "committedDate": "2020-06-24T19:02:02Z", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into owls_82785"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06d5a169655a1ad18264eed1388b87d3fd0d037b", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/06d5a169655a1ad18264eed1388b87d3fd0d037b", "committedDate": "2020-06-24T19:04:41Z", "message": "Force introspection to happen before updating or creating server pods"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2OTM2ODE4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1746#pullrequestreview-436936818", "createdAt": "2020-06-24T19:18:56Z", "commit": {"oid": "06d5a169655a1ad18264eed1388b87d3fd0d037b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOToxODo1NlrOGofwnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOToxODo1NlrOGofwnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTExNjU3Mg==", "bodyText": "checkstyle demanded that I add javadoc to this method, even though it is private. That doesn't seem right to me.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1746#discussion_r445116572", "createdAt": "2020-06-24T19:18:56Z", "author": {"login": "russgold"}, "path": "operator/src/main/java/oracle/kubernetes/operator/MakeRightDomainOperation.java", "diffHunk": "@@ -0,0 +1,70 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.kubernetes.operator;\n+\n+import java.util.Optional;\n+\n+import oracle.kubernetes.operator.helpers.DomainPresenceInfo;\n+import oracle.kubernetes.operator.work.Packet;\n+import oracle.kubernetes.operator.work.Step;\n+import oracle.kubernetes.weblogic.domain.model.Domain;\n+\n+import static oracle.kubernetes.operator.ProcessingConstants.MAKE_RIGHT_DOMAIN_OPERATION;\n+\n+/**\n+ * Defines the operation to bring a running domain into compliance with its domain resource and introspection result.\n+ */\n+public interface MakeRightDomainOperation {\n+\n+  /**\n+   * Defines the operation as pertaining to the deletion of a domain.\n+   */\n+  MakeRightDomainOperation forDeletion();\n+\n+  MakeRightDomainOperation withExplicitRecheck();\n+\n+  MakeRightDomainOperation withDeleting(boolean deleting);\n+\n+  MakeRightDomainOperation interrupt();\n+\n+  void execute();\n+\n+  Step createSteps();\n+\n+  void setInspectionRun();\n+\n+  boolean wasInspectionRun();\n+\n+  private static boolean wasInspectionRun(Packet packet) {\n+    return fromPacket(packet).map(MakeRightDomainOperation::wasInspectionRun).orElse(false);\n+  }\n+\n+  static void recordInspection(Packet packet) {\n+    fromPacket(packet).ifPresent(MakeRightDomainOperation::setInspectionRun);\n+  }\n+\n+  static boolean isInspectionRequired(Packet packet) {\n+    return domainRequiresIntrospectionInCurrentMakeRight(packet) && !wasInspectionRun(packet);\n+  }\n+\n+  /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06d5a169655a1ad18264eed1388b87d3fd0d037b"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2OTkxNzc4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1746#pullrequestreview-436991778", "createdAt": "2020-06-24T20:42:51Z", "commit": {"oid": "06d5a169655a1ad18264eed1388b87d3fd0d037b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a42ae3df6995add174fbe863a98738c1041e6cff", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a42ae3df6995add174fbe863a98738c1041e6cff", "committedDate": "2020-06-25T01:41:51Z", "message": "Update introspectVersion label even when introspect fails to produce any topology"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e7a40024d49883248893b6d8505f9f55e61713c", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8e7a40024d49883248893b6d8505f9f55e61713c", "committedDate": "2020-06-25T07:25:10Z", "message": "Add unit test for case of repeated introspect after pod-change-induced introspect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c83d531703da341b62311876194d135876c0b53a", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c83d531703da341b62311876194d135876c0b53a", "committedDate": "2020-06-25T17:45:41Z", "message": "Rename introspectLabel, use null for force"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20ca9b639b80ad294fe86fbe452a1c84cc7b7f81", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/20ca9b639b80ad294fe86fbe452a1c84cc7b7f81", "committedDate": "2020-06-25T19:48:19Z", "message": "Use null for force"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a54f36e868c1ae52ef1b1f530b49f8cdceed4213", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a54f36e868c1ae52ef1b1f530b49f8cdceed4213", "committedDate": "2020-06-25T19:48:51Z", "message": "Don't run introspection when scaling up if no other changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c44a3458c78cc0631de857db8be9007e6e1288b4", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c44a3458c78cc0631de857db8be9007e6e1288b4", "committedDate": "2020-06-25T20:25:48Z", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into owls_82785"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b3fbd82a764ddf3cee360f41769eefb051ca45d", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8b3fbd82a764ddf3cee360f41769eefb051ca45d", "committedDate": "2020-06-26T13:18:18Z", "message": "Owls 82147 (#1764)\n\n* Detect env var change during MII re-instrospect (MD5 check).\r\n\r\n* minor changes: change env var name, add comment\r\n\r\n* minor change: change method name\r\n\r\n* minor changes: unit test helper renames, etc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4Mzk3MjM5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1746#pullrequestreview-438397239", "createdAt": "2020-06-26T15:37:21Z", "commit": {"oid": "8b3fbd82a764ddf3cee360f41769eefb051ca45d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79e54dbc618551344ca5a9b0f3375435cbc4d8c4", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/79e54dbc618551344ca5a9b0f3375435cbc4d8c4", "committedDate": "2020-06-26T17:14:56Z", "message": "Merge branch 'develop' into owls_82785"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4559, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}