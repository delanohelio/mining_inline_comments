{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNTE2NjU4", "number": 1384, "title": "owls-77750 dedicated ns", "bodyText": "This PR contains the project for owls-77750.\nThe goal is to support a new mode where the operator runs in a dedicated namespace where all the domains that it manages are also running. The feature is turned on by a new helm chart setting \"dedicated\", which is false by default.\nIn the initial solution, the customer has to manually create the domain CRD object prior to install an operator.  We have generated a domain CRD yaml file in the directory kubernetes/charts/weblogic-domain directory for customer to use.", "createdAt": "2020-01-10T16:03:29Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384", "merged": true, "mergeCommit": {"oid": "a65e480195f1884dcc9287f51662bed0c572150e"}, "closed": true, "closedAt": "2020-01-28T04:22:30Z", "author": {"login": "doxiao"}, "timelineItems": {"totalCount": 38, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABbig1HcAH2gAyMzYxNTE2NjU4OjQzMDBjNjI4ZGRhMzI5N2M2NTAwOGFjNGMxZDY1NmUwMTExNzVlYjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-pidlgH2gAyMzYxNTE2NjU4OjQzMmNkNmFkMjY1Nzc5ZmIxMTNlYTg4ODgwOTU5MjIzOGZiNDhkNTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4300c628dda3297c65008ac4c1d656e011175eb2", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4300c628dda3297c65008ac4c1d656e011175eb2", "committedDate": "2019-11-01T18:23:20Z", "message": "Work in progress"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e9f5198bbb710a47f598ba40eaa63a2c64a05b5", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1e9f5198bbb710a47f598ba40eaa63a2c64a05b5", "committedDate": "2020-01-02T14:54:26Z", "message": "Merge remote-tracking branch 'origin/develop' into owls-77750-single-ns\n\nConflicts:\n\tdocs/charts/index.yaml\n\tdocs/charts/weblogic-operator-2.3.1.tgz"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fe594b9c7fa84b231ef9d4d10424ff1a02b77fd", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5fe594b9c7fa84b231ef9d4d10424ff1a02b77fd", "committedDate": "2020-01-02T14:56:08Z", "message": "More changes and merge with develop\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27ade04b55da6eae9b0273d94bbd6d79196ba6f9", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/27ade04b55da6eae9b0273d94bbd6d79196ba6f9", "committedDate": "2020-01-08T21:08:42Z", "message": "More changes\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7282cac4939ad3309c471a0fdd26967ddb7f48d6", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7282cac4939ad3309c471a0fdd26967ddb7f48d6", "committedDate": "2020-01-08T21:16:30Z", "message": "Merge remote-tracking branch 'origin/develop' into owls-77750-single-ns\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>\n\nConflicts:\n\toperator/src/main/java/oracle/kubernetes/operator/helpers/HealthCheckHelper.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d9e21a9c81225bc15e566a0f3eb0ce1af3eada1", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5d9e21a9c81225bc15e566a0f3eb0ce1af3eada1", "committedDate": "2020-01-09T18:35:25Z", "message": "Work around issues with CRD validation and fix an installation test failure\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "221a813cc184c25a85add2a3404307be018f8030", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/221a813cc184c25a85add2a3404307be018f8030", "committedDate": "2020-01-09T19:59:11Z", "message": "Merge remote-tracking branch 'origin/develop' into owls-77750-dedicated-ns"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "039480c322880d5000868e1f1c478f8878b9764c", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/039480c322880d5000868e1f1c478f8878b9764c", "committedDate": "2020-01-09T20:17:11Z", "message": "Fix installation test failure\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85676776f1b116875bdc7574eb6f9b66744c9e1b", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/85676776f1b116875bdc7574eb6f9b66744c9e1b", "committedDate": "2020-01-09T20:33:48Z", "message": "Fixing installation test failure in Jenkins\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "640f954826a27b304e8e353a99f6f318ba5fb3ee", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/640f954826a27b304e8e353a99f6f318ba5fb3ee", "committedDate": "2020-01-09T20:51:45Z", "message": "More change for dedicated in installation test\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4523ff0df2307ff45db21a491c809cd55931113a", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4523ff0df2307ff45db21a491c809cd55931113a", "committedDate": "2020-01-09T21:29:00Z", "message": "One more change\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6e00261d6539f068abd4ee245d75a78c6c75902", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f6e00261d6539f068abd4ee245d75a78c6c75902", "committedDate": "2020-01-09T21:52:48Z", "message": "Minor fix of nonresource security\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "635e84b7aa019fb6293166177c2eff3d0f09f68f", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/635e84b7aa019fb6293166177c2eff3d0f09f68f", "committedDate": "2020-01-10T02:48:28Z", "message": "update operator charts docs\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fceac0d46ff1ce6468da23d8337267e19bc71583", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fceac0d46ff1ce6468da23d8337267e19bc71583", "committedDate": "2020-01-10T15:41:01Z", "message": "Workaround generated CRD yaml issue\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b166cd9f8e0188fd68a7a82aa99b2f8022bb6ae", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0b166cd9f8e0188fd68a7a82aa99b2f8022bb6ae", "committedDate": "2020-01-10T17:13:12Z", "message": "Move the generated crd to a different location\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMzMzMTcy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#pullrequestreview-341333172", "createdAt": "2020-01-10T18:09:25Z", "commit": {"oid": "0b166cd9f8e0188fd68a7a82aa99b2f8022bb6ae"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f5a0d086c74b14da8113ab4cc39abc7bf8af370", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1f5a0d086c74b14da8113ab4cc39abc7bf8af370", "committedDate": "2020-01-10T22:39:34Z", "message": "Move generated crd\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "974c4bc8962cff66df9d64ea3c7091c3bbbba22e", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/974c4bc8962cff66df9d64ea3c7091c3bbbba22e", "committedDate": "2020-01-15T16:47:44Z", "message": "Fix podresets permission error\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61b629efe8241627fa67d8613c5c2a2387601e4b", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/61b629efe8241627fa67d8613c5c2a2387601e4b", "committedDate": "2020-01-15T21:33:48Z", "message": "Check and skip access to cluster level resources and update copyright\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e59dec595fd3a6d54743df4542df0eae673dd456", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e59dec595fd3a6d54743df4542df0eae673dd456", "committedDate": "2020-01-15T21:39:27Z", "message": "Merge remote-tracking branch 'origin/develop' into owls-77750-dedicated-ns\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>\n\nConflicts:\n\toperator/src/main/java/oracle/kubernetes/operator/helpers/CrdHelper.java\n\toperator/src/main/java/oracle/kubernetes/operator/steps/DeleteDomainStep.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80b5fbd07e976971a366914ac74976b42ce1f595", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/80b5fbd07e976971a366914ac74976b42ce1f595", "committedDate": "2020-01-16T04:10:48Z", "message": "Improve security check code\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39fd7244d9929a52ea8bf9dddf28c7b34c0cc101", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/39fd7244d9929a52ea8bf9dddf28c7b34c0cc101", "committedDate": "2020-01-16T20:32:28Z", "message": "Merge remote-tracking branch 'origin/develop' into owls-77750-dedicated-ns"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67305a2ca50288a29da8eac0ca16c13b06e8f961", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/67305a2ca50288a29da8eac0ca16c13b06e8f961", "committedDate": "2020-01-17T23:57:25Z", "message": "Cleanup cluster security checks and add log messages\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fb23cf703067efbb3af7d376cfd96bdbbffe708", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8fb23cf703067efbb3af7d376cfd96bdbbffe708", "committedDate": "2020-01-21T23:34:53Z", "message": "Update generated domain crd yaml and clean up logging\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2119f7b97511fb3e9dabd7ec01b67050e6a8083", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d2119f7b97511fb3e9dabd7ec01b67050e6a8083", "committedDate": "2020-01-23T02:06:15Z", "message": "Add more logging\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81766dc091521dd9327a346349c178ef631678de", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/81766dc091521dd9327a346349c178ef631678de", "committedDate": "2020-01-23T14:32:08Z", "message": "Add basic unit test cases for \"dedicated\"\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3c29306b9c29dcc1ea240d94df5df73bf55e6cf", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f3c29306b9c29dcc1ea240d94df5df73bf55e6cf", "committedDate": "2020-01-23T19:20:36Z", "message": "Add doc contents plus cleanup\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "126bc35fc777a6b25677597f01fb86799b183fb9", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/126bc35fc777a6b25677597f01fb86799b183fb9", "committedDate": "2020-01-23T23:27:31Z", "message": "Fix validation\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf049fce49bbe3c82cdccaf9bb8a50e3eb4519c1", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/cf049fce49bbe3c82cdccaf9bb8a50e3eb4519c1", "committedDate": "2020-01-24T02:14:07Z", "message": "Turn off verify boolen for dedicated value\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90388ebf08402b4d866984970e6f0d0d9d3a98fe", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/90388ebf08402b4d866984970e6f0d0d9d3a98fe", "committedDate": "2020-01-24T14:11:30Z", "message": "Merge remote-tracking branch 'origin/develop' into owls-77750-dedicated-ns"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008", "author": {"user": {"login": "russgold", "name": "Russell Gold"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/265e0a4d708501dbd34fde4aafab6cb9c60c0008", "committedDate": "2020-01-24T19:50:18Z", "message": "add unit tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4Mjg4OTg0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#pullrequestreview-348288984", "createdAt": "2020-01-25T00:14:30Z", "commit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNVQwMDoxNDozMVrOFhtj1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNVQwMDoyNjozN1rOFhtrPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5Mzc4MA==", "bodyText": "this sentence needs to be reworded to make it less confusing.  ClusterRole, etc., should be backticked", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370893780", "createdAt": "2020-01-25T00:14:31Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/security/rbac.md", "diffHunk": "@@ -132,17 +132,18 @@ the following `ClusterRoleBinding` entries are mapped to a `ClusterRole` grantin\n \n | Cluster Role Binding | Mapped to Cluster Role | Resource Access | Notes |\n | --- | --- | --- | --- |\n-| Operator `general` | Operator `general` | **Read**: namespaces | [^1] |\n+| Operator `general` | Operator `general` | **Read**: namespaces | [^3] |\n | | | **Edit**: customresourcedefinitions, ingresses, persistentvolumes | |\n | | | **Update**: domains (weblogic.oracle), domains/status | |\n | | | **Create**: tokenreviews, subjectaccessreviews, localsubjectaccessreviews, selfsubjectaccessreviews, selfsubjectrulesreviews | |\n | Operator `nonresource` | Operator `nonresource` | **Get**: /version/* | [^1] |\n-| Operator `discovery` | Kubernetes `system:discovery` | **See**: [Kubernetes Discovery Roles](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#discovery-roles) | [^1] |\n-| Operator `auth-delegator` | Kubernetes `system:auth-delegator` | **See**: [Kubernetes Component Roles](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#other-component-roles) | [^1] |\n+| Operator `discovery` | Kubernetes `system:discovery` | **See**: [Kubernetes Discovery Roles](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#discovery-roles) | [^3] |\n+| Operator `auth-delegator` | Kubernetes `system:auth-delegator` | **See**: [Kubernetes Component Roles](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#other-component-roles) | [^3] |\n \n \n [^1]: The binding is assigned to the operator `ServiceAccount`.\n [^2]: The binding is assigned to the operator `ServiceAccount`\n       in each namespace listed with the `domainNamespaces` setting.\n       The `domainNamespaces` setting contains the list of namespaces\n       that the operator is configured to manage.\n+[^3]: The binding is assigned to the operator `ServiceAccount`. In additional, by default (when the `dedicated` value is set to `false`), those are ClusterRole and ClusterRoleBindings. However, if the `dedicated` value is set to `true`,  those will become Roles and RoleBindings in the namespace of the operator.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5Mzg3NQ==", "bodyText": "as -> to", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370893875", "createdAt": "2020-01-25T00:15:10Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/userguide/managing-operators/using-the-operator/using-helm.md", "diffHunk": "@@ -94,6 +94,23 @@ Example:\n serviceAccount: \"weblogic-operator\"\n ```\n \n+##### `dedicated`\n+\n+Specifies if this operator will only manage WebLogic Domains in the same namespace in which the operator itself is deployed.  If set as `true`, then the `domainNamespaces` value below is ignored. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5Mzg5NA==", "bodyText": "remove \"below\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370893894", "createdAt": "2020-01-25T00:15:18Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/userguide/managing-operators/using-the-operator/using-helm.md", "diffHunk": "@@ -94,6 +94,23 @@ Example:\n serviceAccount: \"weblogic-operator\"\n ```\n \n+##### `dedicated`\n+\n+Specifies if this operator will only manage WebLogic Domains in the same namespace in which the operator itself is deployed.  If set as `true`, then the `domainNamespaces` value below is ignored. ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5Mzg3NQ=="}, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5Mzk3Nw==", "bodyText": "don't say \"will most likely not have\"\nsay \"does not require\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370893977", "createdAt": "2020-01-25T00:15:44Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/userguide/managing-operators/using-the-operator/using-helm.md", "diffHunk": "@@ -94,6 +94,23 @@ Example:\n serviceAccount: \"weblogic-operator\"\n ```\n \n+##### `dedicated`\n+\n+Specifies if this operator will only manage WebLogic Domains in the same namespace in which the operator itself is deployed.  If set as `true`, then the `domainNamespaces` value below is ignored. \n+\n+Defaults to `false`.\n+\n+Example:\n+```\n+dedicated: false\n+```\n+\n+In the `dedicated` mode, the operator will most likely not have permissions to access the cluster-scoped Kubernetes resources such as CustomResourceDefinitions, PersistentVolumes, and Namespaces. In those situations, the operator may skip some of its operations, such as verifying the WebLogic Domain CustomResoruceDefinition domains.weblogic.oracle (and creating it when it is absent), watching namespace events, and cleaning up PersistentVolumes as part of deleting a domain. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDAzMQ==", "bodyText": "backtick things like CustomResourceDefinitions", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370894031", "createdAt": "2020-01-25T00:16:01Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/userguide/managing-operators/using-the-operator/using-helm.md", "diffHunk": "@@ -94,6 +94,23 @@ Example:\n serviceAccount: \"weblogic-operator\"\n ```\n \n+##### `dedicated`\n+\n+Specifies if this operator will only manage WebLogic Domains in the same namespace in which the operator itself is deployed.  If set as `true`, then the `domainNamespaces` value below is ignored. \n+\n+Defaults to `false`.\n+\n+Example:\n+```\n+dedicated: false\n+```\n+\n+In the `dedicated` mode, the operator will most likely not have permissions to access the cluster-scoped Kubernetes resources such as CustomResourceDefinitions, PersistentVolumes, and Namespaces. In those situations, the operator may skip some of its operations, such as verifying the WebLogic Domain CustomResoruceDefinition domains.weblogic.oracle (and creating it when it is absent), watching namespace events, and cleaning up PersistentVolumes as part of deleting a domain. ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5Mzk3Nw=="}, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDExMQ==", "bodyText": "administrator singular", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370894111", "createdAt": "2020-01-25T00:16:25Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/userguide/managing-operators/using-the-operator/using-helm.md", "diffHunk": "@@ -94,6 +94,23 @@ Example:\n serviceAccount: \"weblogic-operator\"\n ```\n \n+##### `dedicated`\n+\n+Specifies if this operator will only manage WebLogic Domains in the same namespace in which the operator itself is deployed.  If set as `true`, then the `domainNamespaces` value below is ignored. \n+\n+Defaults to `false`.\n+\n+Example:\n+```\n+dedicated: false\n+```\n+\n+In the `dedicated` mode, the operator will most likely not have permissions to access the cluster-scoped Kubernetes resources such as CustomResourceDefinitions, PersistentVolumes, and Namespaces. In those situations, the operator may skip some of its operations, such as verifying the WebLogic Domain CustomResoruceDefinition domains.weblogic.oracle (and creating it when it is absent), watching namespace events, and cleaning up PersistentVolumes as part of deleting a domain. \n+\n+{{% notice note %}}\n+It is the responsibility of the administrators to make sure that the required CustomResourceDefinition domains.weblogic.oracle is deployed in the Kubernetes cluster before the operator is installed. A YAML file for the CRD (`domain-crd.yaml`) can be found in `kubernetes/crd` directory of the operator project.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDE0NQ==", "bodyText": "backtick names of objects", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370894145", "createdAt": "2020-01-25T00:16:36Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/userguide/managing-operators/using-the-operator/using-helm.md", "diffHunk": "@@ -94,6 +94,23 @@ Example:\n serviceAccount: \"weblogic-operator\"\n ```\n \n+##### `dedicated`\n+\n+Specifies if this operator will only manage WebLogic Domains in the same namespace in which the operator itself is deployed.  If set as `true`, then the `domainNamespaces` value below is ignored. \n+\n+Defaults to `false`.\n+\n+Example:\n+```\n+dedicated: false\n+```\n+\n+In the `dedicated` mode, the operator will most likely not have permissions to access the cluster-scoped Kubernetes resources such as CustomResourceDefinitions, PersistentVolumes, and Namespaces. In those situations, the operator may skip some of its operations, such as verifying the WebLogic Domain CustomResoruceDefinition domains.weblogic.oracle (and creating it when it is absent), watching namespace events, and cleaning up PersistentVolumes as part of deleting a domain. \n+\n+{{% notice note %}}\n+It is the responsibility of the administrators to make sure that the required CustomResourceDefinition domains.weblogic.oracle is deployed in the Kubernetes cluster before the operator is installed. A YAML file for the CRD (`domain-crd.yaml`) can be found in `kubernetes/crd` directory of the operator project.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDExMQ=="}, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDE4OQ==", "bodyText": "make a hyperlink to the actual file", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370894189", "createdAt": "2020-01-25T00:16:52Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/userguide/managing-operators/using-the-operator/using-helm.md", "diffHunk": "@@ -94,6 +94,23 @@ Example:\n serviceAccount: \"weblogic-operator\"\n ```\n \n+##### `dedicated`\n+\n+Specifies if this operator will only manage WebLogic Domains in the same namespace in which the operator itself is deployed.  If set as `true`, then the `domainNamespaces` value below is ignored. \n+\n+Defaults to `false`.\n+\n+Example:\n+```\n+dedicated: false\n+```\n+\n+In the `dedicated` mode, the operator will most likely not have permissions to access the cluster-scoped Kubernetes resources such as CustomResourceDefinitions, PersistentVolumes, and Namespaces. In those situations, the operator may skip some of its operations, such as verifying the WebLogic Domain CustomResoruceDefinition domains.weblogic.oracle (and creating it when it is absent), watching namespace events, and cleaning up PersistentVolumes as part of deleting a domain. \n+\n+{{% notice note %}}\n+It is the responsibility of the administrators to make sure that the required CustomResourceDefinition domains.weblogic.oracle is deployed in the Kubernetes cluster before the operator is installed. A YAML file for the CRD (`domain-crd.yaml`) can be found in `kubernetes/crd` directory of the operator project.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDExMQ=="}, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDI0Ng==", "bodyText": "why are you changing the old ones?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370894246", "createdAt": "2020-01-25T00:17:11Z", "author": {"login": "markxnelson"}, "path": "docs/charts/index.yaml", "diffHunk": "@@ -1,53 +1,53 @@\n apiVersion: v1\n entries:\n   weblogic-operator:\n-  - created: \"2019-11-15T20:34:35.377589-05:00\"\n+  - created: \"2020-01-15T20:11:19.500388682Z\"\n     description: Helm chart for configuring the WebLogic operator.\n-    digest: b36bd32083f67453a62d089a2c09ce38e6655d88ac8a7b38691230c55c40e672\n+    digest: d358882813647586f6137061de441c4b89c775dcda6653e8cc6e6cf2222cb48b\n     name: weblogic-operator\n     urls:\n     - https://oracle.github.io/weblogic-kubernetes-operator/charts/weblogic-operator-2.4.0.tgz\n     version: 2.4.0\n-  - created: \"2019-11-15T20:34:35.37493-05:00\"\n+  - created: \"2020-01-15T20:11:19.499534741Z\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDQ1MA==", "bodyText": "is this right? looks wrong", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370894450", "createdAt": "2020-01-25T00:18:20Z", "author": {"login": "markxnelson"}, "path": "kubernetes/charts/weblogic-operator/templates/_domain-namespaces.tpl", "diffHunk": "@@ -1,10 +1,17 @@\n-# Copyright (c) 2018, 2019, Oracle Corporation and/or its affiliates.  All rights reserved.\n+# Copyright (c) 2018, 2020, Oracle Corporation and/or its affiliates.  All rights reserved.\n # Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n \n {{- define \"operator.domainNamespaces\" }}\n+{{- if not .dedicated }}\n {{- $args := include \"utils.cloneDictionary\" . | fromYaml -}}\n {{- range $key := $args.domainNamespaces -}}\n {{-   $ignore := set $args \"domainNamespace\" $key -}}\n {{-   include \"operator.operatorRoleBindingNamespace\" $args -}}\n {{- end }}\n+{{- else }}\n+{{- $args := include \"utils.cloneDictionary\" . | fromYaml -}}\n+{{- $key := .Release.Namespace -}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDYxMA==", "bodyText": "as -> to", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370894610", "createdAt": "2020-01-25T00:19:15Z", "author": {"login": "markxnelson"}, "path": "kubernetes/charts/weblogic-operator/values.yaml", "diffHunk": "@@ -7,8 +7,13 @@\n # If not specified, the the operator will use the operator's namespace's 'default' service account.\n serviceAccount: \"default\"\n \n-# domainNamespaces specifies list of WebLogic Domain namespaces which the operator manages.\n-# The customer is responsible for creating these namespaces.\n+# dedicated specifies if this operator will manage WebLogic Domains only in the same namespace in\n+# which the operator itself is deployed.  If set as 'true', then the 'domainNamespaces' value below", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDYzMw==", "bodyText": "as -> to", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370894633", "createdAt": "2020-01-25T00:19:24Z", "author": {"login": "markxnelson"}, "path": "kubernetes/charts/weblogic-operator/values.yaml", "diffHunk": "@@ -7,8 +7,13 @@\n # If not specified, the the operator will use the operator's namespace's 'default' service account.\n serviceAccount: \"default\"\n \n-# domainNamespaces specifies list of WebLogic Domain namespaces which the operator manages.\n-# The customer is responsible for creating these namespaces.\n+# dedicated specifies if this operator will manage WebLogic Domains only in the same namespace in\n+# which the operator itself is deployed.  If set as 'true', then the 'domainNamespaces' value below\n+# is ignored.\n+dedicated: false\n+\n+# domainNamespaces specifies list of WebLogic Domain namespaces which the operator manages. This value\n+# is ignored if 'dedicated' is set as 'true'. The customer is responsible for creating these namespaces.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDY2Nw==", "bodyText": "customer -> administrator", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370894667", "createdAt": "2020-01-25T00:19:42Z", "author": {"login": "markxnelson"}, "path": "kubernetes/charts/weblogic-operator/values.yaml", "diffHunk": "@@ -7,8 +7,13 @@\n # If not specified, the the operator will use the operator's namespace's 'default' service account.\n serviceAccount: \"default\"\n \n-# domainNamespaces specifies list of WebLogic Domain namespaces which the operator manages.\n-# The customer is responsible for creating these namespaces.\n+# dedicated specifies if this operator will manage WebLogic Domains only in the same namespace in\n+# which the operator itself is deployed.  If set as 'true', then the 'domainNamespaces' value below\n+# is ignored.\n+dedicated: false\n+\n+# domainNamespaces specifies list of WebLogic Domain namespaces which the operator manages. This value\n+# is ignored if 'dedicated' is set as 'true'. The customer is responsible for creating these namespaces.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDYzMw=="}, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDcyMg==", "bodyText": "why all the empty lines?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370894722", "createdAt": "2020-01-25T00:20:05Z", "author": {"login": "markxnelson"}, "path": "kubernetes/src/test/java/oracle/kubernetes/operator/helm/HelmOperatorValuesTest.java", "diffHunk": "@@ -487,6 +487,50 @@ public void whenCreatedFromMapWithExternalDebugHttpPort_hasSpecifiedValue() {\n     assertThat(values.getExternalDebugHttpPort(), equalTo(stringValue));\n   }\n \n+  // --------------- dedicated\n+\n+  @Test\n+  public void whenDedicatedTrue_createdMapContainsValue() {\n+    operatorValues.dedicated(\"true\");\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDk0OQ==", "bodyText": "this line seems overly complicated and prone to future update errors", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370894949", "createdAt": "2020-01-25T00:21:34Z", "author": {"login": "markxnelson"}, "path": "operator/src/main/java/oracle/kubernetes/operator/Main.java", "diffHunk": "@@ -578,6 +595,17 @@ public NextAction apply(Packet packet) {\n     }\n   }\n \n+  /**\n+   * Adds the specified namespace to the list of started namespaces, returning true if it was not\n+   * already present.\n+   * @param ns the namespace name\n+   * @return false if the namespace had already been started\n+   */\n+  static boolean addStartedNamespace(String ns) {\n+    AtomicBoolean a = isNamespaceStarted.computeIfAbsent(ns, (key) -> new AtomicBoolean(false));\n+    return !a.getAndSet(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 157}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTAxMg==", "bodyText": "Do not include \"All rights reserved\" in any new files -- new rules....", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895012", "createdAt": "2020-01-25T00:21:51Z", "author": {"login": "markxnelson"}, "path": "operator/src/main/java/oracle/kubernetes/operator/StartupControl.java", "diffHunk": "@@ -0,0 +1,74 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.  All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTA1MA==", "bodyText": "javadoc???", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895050", "createdAt": "2020-01-25T00:22:08Z", "author": {"login": "markxnelson"}, "path": "operator/src/main/java/oracle/kubernetes/operator/StartupControl.java", "diffHunk": "@@ -0,0 +1,74 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.  All rights reserved.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.kubernetes.operator;\n+\n+import java.util.Optional;\n+import java.util.function.Function;\n+\n+import oracle.kubernetes.operator.helpers.AuthorizationProxy.Operation;\n+import oracle.kubernetes.operator.helpers.AuthorizationProxy.Resource;\n+import oracle.kubernetes.operator.helpers.CrdHelper;\n+import oracle.kubernetes.operator.helpers.HealthCheckHelper;\n+import oracle.kubernetes.operator.helpers.KubernetesVersion;\n+import oracle.kubernetes.operator.logging.LoggingFacade;\n+import oracle.kubernetes.operator.logging.LoggingFactory;\n+import oracle.kubernetes.operator.logging.MessageKeys;\n+import oracle.kubernetes.operator.work.Step;\n+\n+public class StartupControl {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTEzMQ==", "bodyText": "2020", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895131", "createdAt": "2020-01-25T00:22:46Z", "author": {"login": "markxnelson"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/CrdHelper.java", "diffHunk": "@@ -43,6 +52,31 @@\n   private CrdHelper() {\n   }\n \n+  /**\n+   * Used by build to generate crd-validation.yaml\n+   * @param args Arguments that must be one value giving file name to create\n+   */\n+  public static void main(String[] args) {\n+    if (args == null || args.length != 1) {\n+      throw new IllegalArgumentException();\n+    }\n+\n+    String outputFileName = args[0];\n+\n+    Path outputFilePath = Paths.get(outputFileName);\n+    CrdContext context = new CrdContext(null, null);\n+\n+    try (Writer writer = Files.newBufferedWriter(outputFilePath)) {\n+      writer.write(\n+          \"# Copyright (c) 2019, Oracle Corporation and/or its affiliates.  All rights reserved.\\n\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTIyNw==", "bodyText": "we don't support ABAC...", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895227", "createdAt": "2020-01-25T00:23:27Z", "author": {"login": "markxnelson"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/HealthCheckHelper.java", "diffHunk": "@@ -21,151 +26,190 @@\n \n   private static final LoggingFacade LOGGER = LoggingFactory.getLogger(\"Operator\", \"Operator\");\n \n-  private static final Map<AuthorizationProxy.Resource, AuthorizationProxy.Operation[]>\n+  private static final Map<Resource, Operation[]>\n       namespaceAccessChecks = new HashMap<>();\n-  private static final Map<AuthorizationProxy.Resource, AuthorizationProxy.Operation[]>\n+  private static final Map<Resource, Operation[]>\n       clusterAccessChecks = new HashMap<>();\n \n   // Note: this list should match the RBAC or ABAC policies contained in the YAML script", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTQ0Nw==", "bodyText": "remove \"one solution is to\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895447", "createdAt": "2020-01-25T00:25:04Z", "author": {"login": "markxnelson"}, "path": "operator/src/main/resources/Operator.properties", "diffHunk": "@@ -163,6 +163,15 @@ WLSKO-0154=Job {0} failed due to reason: DeadlineExceeded. \\\n WLSKO-0155=Unexpected exception, {0}, while parsing introspect job log [{1}].\n WLSKO-0156=Access denied for operator service account for operation {0} on resource {1} in namespace {2}.\n WLSKO-0157=Domain {0} is not valid: {1}\n+WLSKO-0158=Expected CustomResourceDefinition domains.weblogic.oracle not found. But the operator's service account \\\n+  does not have the permissions to {0}. One solution is to create or update the CRD and  \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTUwNA==", "bodyText": "the permissions -> permission", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895504", "createdAt": "2020-01-25T00:25:26Z", "author": {"login": "markxnelson"}, "path": "operator/src/main/resources/Operator.properties", "diffHunk": "@@ -163,6 +163,15 @@ WLSKO-0154=Job {0} failed due to reason: DeadlineExceeded. \\\n WLSKO-0155=Unexpected exception, {0}, while parsing introspect job log [{1}].\n WLSKO-0156=Access denied for operator service account for operation {0} on resource {1} in namespace {2}.\n WLSKO-0157=Domain {0} is not valid: {1}\n+WLSKO-0158=Expected CustomResourceDefinition domains.weblogic.oracle not found. But the operator's service account \\\n+  does not have the permissions to {0}. One solution is to create or update the CRD and  \\\n+  re-install the operator. \n+WLSKO-0159=Skipped the verification of the CustomResourceDefinition domains.weblogic.oracle because \\\n+  the operator's service account does not have the permissions to access the existing CustomResourceDefinition.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTUzNg==", "bodyText": "the permissions -> permission", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895536", "createdAt": "2020-01-25T00:25:42Z", "author": {"login": "markxnelson"}, "path": "operator/src/main/resources/Operator.properties", "diffHunk": "@@ -163,6 +163,15 @@ WLSKO-0154=Job {0} failed due to reason: DeadlineExceeded. \\\n WLSKO-0155=Unexpected exception, {0}, while parsing introspect job log [{1}].\n WLSKO-0156=Access denied for operator service account for operation {0} on resource {1} in namespace {2}.\n WLSKO-0157=Domain {0} is not valid: {1}\n+WLSKO-0158=Expected CustomResourceDefinition domains.weblogic.oracle not found. But the operator's service account \\\n+  does not have the permissions to {0}. One solution is to create or update the CRD and  \\\n+  re-install the operator. \n+WLSKO-0159=Skipped the verification of the CustomResourceDefinition domains.weblogic.oracle because \\\n+  the operator's service account does not have the permissions to access the existing CustomResourceDefinition.\n+WLSKO-0160=Verifying that operator service account can perform operation {1} on required resource {0}.\n+WLSKO-0161=Skipped the creation of the namespace watcher because the operator's service account \\\n+  does not have the permissions to access the namespaces in the Kubernetes cluster.\\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTU2OA==", "bodyText": "remove \"All rights reserved\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895568", "createdAt": "2020-01-25T00:25:53Z", "author": {"login": "markxnelson"}, "path": "operator/src/test/java/oracle/kubernetes/operator/StartupControlTest.java", "diffHunk": "@@ -0,0 +1,256 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.  All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTYxOA==", "bodyText": "1,8? seems old, should we update?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895618", "createdAt": "2020-01-25T00:26:18Z", "author": {"login": "markxnelson"}, "path": "operator/src/test/java/oracle/kubernetes/operator/StartupControlTest.java", "diffHunk": "@@ -0,0 +1,256 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.  All rights reserved.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.kubernetes.operator;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+import java.util.logging.LogRecord;\n+\n+import com.meterware.simplestub.Memento;\n+import com.meterware.simplestub.StaticStubSupport;\n+import io.kubernetes.client.openapi.models.V1ResourceRule;\n+import io.kubernetes.client.openapi.models.V1SelfSubjectRulesReview;\n+import io.kubernetes.client.openapi.models.V1SubjectRulesReviewStatus;\n+import oracle.kubernetes.operator.helpers.AuthorizationProxy.Operation;\n+import oracle.kubernetes.operator.helpers.AuthorizationProxy.Resource;\n+import oracle.kubernetes.operator.helpers.CrdHelper;\n+import oracle.kubernetes.operator.helpers.KubernetesTestSupport;\n+import oracle.kubernetes.operator.helpers.KubernetesVersion;\n+import oracle.kubernetes.operator.helpers.TuningParametersStub;\n+import oracle.kubernetes.operator.work.Step;\n+import oracle.kubernetes.operator.work.TerminalStep;\n+import oracle.kubernetes.utils.TestUtils;\n+import org.hamcrest.Description;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import static oracle.kubernetes.operator.StartupControlTest.StepPresenceMatcher.containsStep;\n+import static oracle.kubernetes.operator.logging.MessageKeys.CRD_NO_READ_ACCESS;\n+import static oracle.kubernetes.operator.logging.MessageKeys.NS_NO_READ_ACCESS;\n+import static oracle.kubernetes.utils.LogMatcher.containsWarning;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.not;\n+import static org.hamcrest.Matchers.sameInstance;\n+import static org.hamcrest.junit.MatcherAssert.assertThat;\n+\n+public class StartupControlTest {\n+  private static final KubernetesVersion VERSION = new KubernetesVersion(1, 8);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTY3Nw==", "bodyText": "why all the blank lines?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895677", "createdAt": "2020-01-25T00:26:37Z", "author": {"login": "markxnelson"}, "path": "operator/src/test/java/oracle/kubernetes/operator/StartupControlTest.java", "diffHunk": "@@ -0,0 +1,256 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.  All rights reserved.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.kubernetes.operator;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+import java.util.logging.LogRecord;\n+\n+import com.meterware.simplestub.Memento;\n+import com.meterware.simplestub.StaticStubSupport;\n+import io.kubernetes.client.openapi.models.V1ResourceRule;\n+import io.kubernetes.client.openapi.models.V1SelfSubjectRulesReview;\n+import io.kubernetes.client.openapi.models.V1SubjectRulesReviewStatus;\n+import oracle.kubernetes.operator.helpers.AuthorizationProxy.Operation;\n+import oracle.kubernetes.operator.helpers.AuthorizationProxy.Resource;\n+import oracle.kubernetes.operator.helpers.CrdHelper;\n+import oracle.kubernetes.operator.helpers.KubernetesTestSupport;\n+import oracle.kubernetes.operator.helpers.KubernetesVersion;\n+import oracle.kubernetes.operator.helpers.TuningParametersStub;\n+import oracle.kubernetes.operator.work.Step;\n+import oracle.kubernetes.operator.work.TerminalStep;\n+import oracle.kubernetes.utils.TestUtils;\n+import org.hamcrest.Description;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import static oracle.kubernetes.operator.StartupControlTest.StepPresenceMatcher.containsStep;\n+import static oracle.kubernetes.operator.logging.MessageKeys.CRD_NO_READ_ACCESS;\n+import static oracle.kubernetes.operator.logging.MessageKeys.NS_NO_READ_ACCESS;\n+import static oracle.kubernetes.utils.LogMatcher.containsWarning;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.not;\n+import static org.hamcrest.Matchers.sameInstance;\n+import static org.hamcrest.junit.MatcherAssert.assertThat;\n+\n+public class StartupControlTest {\n+  private static final KubernetesVersion VERSION = new KubernetesVersion(1, 8);\n+\n+  private KubernetesTestSupport testSupport = new KubernetesTestSupport();\n+  private Map<String,String> environmentVariables = new HashMap<>();\n+  private Function<String, String> getEnv = (name -> environmentVariables.get(name));\n+  private List<Memento> mementos = new ArrayList<>();\n+  private List<V1ResourceRule> rules = new ArrayList<>();\n+  private Step startStep = new TerminalStep();\n+  private Step namespaceStep = new TerminalStep();\n+  private StartupControl startupControl = new StartupControl(VERSION);\n+  private Collection<LogRecord> logRecords = new ArrayList<>();\n+  private TestUtils.ConsoleHandlerMemento loggerMemento;\n+\n+  @Before\n+  public void setUp() throws Exception {\n+    mementos.add(StaticStubSupport.install(StartupControl.class, \"getHelmVariable\", getEnv));\n+    mementos.add(TuningParametersStub.install());\n+    mementos.add(testSupport.install());\n+    mementos.add(loggerMemento = TestUtils.silenceOperatorLogger());\n+\n+    loggerMemento.collectLogMessages(logRecords, CRD_NO_READ_ACCESS, NS_NO_READ_ACCESS);\n+    testSupport.doOnCreate(KubernetesTestSupport.SELF_SUBJECT_RULES_REVIEW,\n+          (Consumer<V1SelfSubjectRulesReview>) this::populateSubjectRulesReview);\n+  }\n+\n+  @After\n+  public void tearDown() {\n+    mementos.forEach(Memento::revert);\n+  }\n+\n+  @Test\n+  public void whenOperatorDedicatedUndefined_isDedicatedReturnsFalse() {\n+    assertThat(startupControl.isDedicated(), is(false));\n+  }\n+\n+  @Test\n+  public void whenOperatorDedicatedEmptyString_isDedicatedReturnsFalse() {\n+    environmentVariables.put(StartupControl.OPERATOR_DEDICATED_ENV, \"\");\n+    \n+    assertThat(startupControl.isDedicated(), is(false));\n+  }\n+\n+  @Test\n+  public void whenOperatorDedicatedNotTrue_isDedicatedReturnsFalse() {\n+    environmentVariables.put(StartupControl.OPERATOR_DEDICATED_ENV, \"zork\");\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "originalPosition": 92}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4NTc3MDQ5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#pullrequestreview-348577049", "createdAt": "2020-01-27T10:54:55Z", "commit": {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "10828f7c5d852f28df64c785d4d46e3ee3006487", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/10828f7c5d852f28df64c785d4d46e3ee3006487", "committedDate": "2020-01-27T16:49:42Z", "message": "Address review comments from Mark\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4ODI4NzE4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#pullrequestreview-348828718", "createdAt": "2020-01-27T17:07:56Z", "commit": {"oid": "10828f7c5d852f28df64c785d4d46e3ee3006487"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzowNzo1NlrOFiKeCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNzoxNDoxMFrOFiKqig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2NzQzNQ==", "bodyText": "and all WebLogic -> and all the WebLogic\nFor more details of the -> For more details about the", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371367435", "createdAt": "2020-01-27T17:07:56Z", "author": {"login": "rosemarymarano"}, "path": "docs-source/content/security/openshift.md", "diffHunk": "@@ -44,3 +44,8 @@ spec:\n For additional information about OpenShift requirements and the operator,\n see the [OpenShift]({{<relref  \"/userguide/introduction/introduction.md#openshift\">}}) section in the User Guide.\n {{% /notice %}}\n+\n+#### Using a dedicated namespace\n+\n+When the user that installs an individual instance of the operator does not have the required privileges to create resources at the Kubernetes cluster level, a dedicated namespace can be used for the operator instance and all WebLogic domains that it manages. For more details of the `dedicated` setting, please refer to [Operator Helm configuration values]({{< relref \"/userguide/managing-operators/using-the-operator/using-helm.md#operator-helm-configuration-values\" >}}).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10828f7c5d852f28df64c785d4d46e3ee3006487"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2ODgwOQ==", "bodyText": "those will be created -> those resources will be created", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371368809", "createdAt": "2020-01-27T17:10:44Z", "author": {"login": "rosemarymarano"}, "path": "docs-source/content/security/rbac.md", "diffHunk": "@@ -132,17 +132,18 @@ the following `ClusterRoleBinding` entries are mapped to a `ClusterRole` grantin\n \n | Cluster Role Binding | Mapped to Cluster Role | Resource Access | Notes |\n | --- | --- | --- | --- |\n-| Operator `general` | Operator `general` | **Read**: namespaces | [^1] |\n+| Operator `general` | Operator `general` | **Read**: namespaces | [^3] |\n | | | **Edit**: customresourcedefinitions, ingresses, persistentvolumes | |\n | | | **Update**: domains (weblogic.oracle), domains/status | |\n | | | **Create**: tokenreviews, subjectaccessreviews, localsubjectaccessreviews, selfsubjectaccessreviews, selfsubjectrulesreviews | |\n | Operator `nonresource` | Operator `nonresource` | **Get**: /version/* | [^1] |\n-| Operator `discovery` | Kubernetes `system:discovery` | **See**: [Kubernetes Discovery Roles](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#discovery-roles) | [^1] |\n-| Operator `auth-delegator` | Kubernetes `system:auth-delegator` | **See**: [Kubernetes Component Roles](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#other-component-roles) | [^1] |\n+| Operator `discovery` | Kubernetes `system:discovery` | **See**: [Kubernetes Discovery Roles](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#discovery-roles) | [^3] |\n+| Operator `auth-delegator` | Kubernetes `system:auth-delegator` | **See**: [Kubernetes Component Roles](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#other-component-roles) | [^3] |\n \n \n [^1]: The binding is assigned to the operator `ServiceAccount`.\n [^2]: The binding is assigned to the operator `ServiceAccount`\n       in each namespace listed with the `domainNamespaces` setting.\n       The `domainNamespaces` setting contains the list of namespaces\n       that the operator is configured to manage.\n+[^3]: The binding is assigned to the operator `ServiceAccount`. In addition, the Kubernetes RBAC resources that the operator installation actually set up will be adjusted based on the value of the `dedicated` setting. By default,  the `dedicated` value is set to `false`, those security resources are created as `ClusterRole` and `ClusterRoleBindings`. If the `dedicated` value is set to `true`,  those will be created as `Roles` and `RoleBindings` in the namespace of the operator.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10828f7c5d852f28df64c785d4d46e3ee3006487"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2OTE4OA==", "bodyText": "WebLogic Domains -> WebLogic domains", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371369188", "createdAt": "2020-01-27T17:11:28Z", "author": {"login": "rosemarymarano"}, "path": "docs-source/content/userguide/managing-operators/using-the-operator/using-helm.md", "diffHunk": "@@ -94,6 +94,23 @@ Example:\n serviceAccount: \"weblogic-operator\"\n ```\n \n+##### `dedicated`\n+\n+Specifies if this operator will only manage WebLogic Domains in the same namespace in which the operator itself is deployed.  If set to `true`, then the `domainNamespaces` value is ignored. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10828f7c5d852f28df64c785d4d46e3ee3006487"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM3MDYzNA==", "bodyText": "cluster-scoped Kubernetes resources such as -> cluster-scoped Kubernetes resources, such as\nWebLogic Domain -> WebLogic domain", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371370634", "createdAt": "2020-01-27T17:14:10Z", "author": {"login": "rosemarymarano"}, "path": "docs-source/content/userguide/managing-operators/using-the-operator/using-helm.md", "diffHunk": "@@ -94,6 +94,23 @@ Example:\n serviceAccount: \"weblogic-operator\"\n ```\n \n+##### `dedicated`\n+\n+Specifies if this operator will only manage WebLogic Domains in the same namespace in which the operator itself is deployed.  If set to `true`, then the `domainNamespaces` value is ignored. \n+\n+Defaults to `false`.\n+\n+Example:\n+```\n+dedicated: false\n+```\n+\n+In the `dedicated` mode, the operator does not require permissions to access the cluster-scoped Kubernetes resources such as `CustomResourceDefinitions`, `PersistentVolumes`, and `Namespaces`. In those situations, the operator may skip some of its operations, such as verifying the WebLogic Domain `CustomResoruceDefinition` `domains.weblogic.oracle` (and creating it when it is absent), watching namespace events, and cleaning up `PersistentVolumes` as part of deleting a domain. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10828f7c5d852f28df64c785d4d46e3ee3006487"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "962d6ac4b538a070759fda26f952f6bd0a2e6ec0", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/962d6ac4b538a070759fda26f952f6bd0a2e6ec0", "committedDate": "2020-01-27T19:55:16Z", "message": "Address doc comments from Rosemary\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec56457bd14bdb983e99d68d8c611d095d8210f4", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ec56457bd14bdb983e99d68d8c611d095d8210f4", "committedDate": "2020-01-28T04:18:13Z", "message": "Rebuilt files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "432cd6ad265779fb113ea888809592238fb48d55", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/432cd6ad265779fb113ea888809592238fb48d55", "committedDate": "2020-01-28T04:21:59Z", "message": "Updated files, part deux"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 49, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}