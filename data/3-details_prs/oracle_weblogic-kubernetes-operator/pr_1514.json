{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1NDAzODIx", "number": 1514, "title": "K8s client api initial impl for feedback on usage", "bodyText": "PR for feedback to validate usage of Kubernetes client API is correct and that I'm on the same page as everyone else on direction.", "createdAt": "2020-03-30T04:52:29Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1514", "merged": true, "mergeCommit": {"oid": "adc49f761fc65e653227b11885ff837d55d343be"}, "closed": true, "closedAt": "2020-03-31T13:49:59Z", "author": {"login": "lennyphan"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSm8CGgH2gAyMzk1NDAzODIxOjZlZjNiNmRjYmM3ZDJjMGE2ZTAyMmMxMjAxZmEwY2Y3ODc1M2U4MTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTCxpigH2gAyMzk1NDAzODIxOmJiNWYwMTUxNDA0NWNmMjBlYmYxNzBjODkxODU3NjU2Njg0OWE2NzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6ef3b6dcbc7d2c0a6e022c1201fa0cf78753e812", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6ef3b6dcbc7d2c0a6e022c1201fa0cf78753e812", "committedDate": "2020-03-30T04:38:41Z", "message": "K8s client api initial impl for feedback on usage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzNzg5OTY5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1514#pullrequestreview-383789969", "createdAt": "2020-03-30T12:10:48Z", "commit": {"oid": "6ef3b6dcbc7d2c0a6e022c1201fa0cf78753e812"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMjoxMDo0OFrOF9mq9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxMjoxMzozMFrOF9mw8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0MTA0Ng==", "bodyText": "let's use log not sop", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1514#discussion_r400141046", "createdAt": "2020-03-30T12:10:48Z", "author": {"login": "markxnelson"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Kubernetes.java", "diffHunk": "@@ -32,7 +78,18 @@ public static List listDeployments() {\n     // --------------------------- namespaces -----------------------------------\n \n     public static boolean createNamespace(String name) {\n-        return true;\n+        V1ObjectMeta meta = new V1ObjectMeta();\n+        meta.name(name);\n+        V1Namespace namespace = new V1Namespace();\n+        namespace.metadata(meta);\n+        try {\n+            namespace = coreV1Api.createNamespace(namespace, pretty, null, null);\n+            System.out.println(\"Kubernetes.createNamespace namespace: \" + namespace);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ef3b6dcbc7d2c0a6e022c1201fa0cf78753e812"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0MTMwOA==", "bodyText": "probably a good idea to return the exception", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1514#discussion_r400141308", "createdAt": "2020-03-30T12:11:16Z", "author": {"login": "markxnelson"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Kubernetes.java", "diffHunk": "@@ -32,7 +78,18 @@ public static List listDeployments() {\n     // --------------------------- namespaces -----------------------------------\n \n     public static boolean createNamespace(String name) {\n-        return true;\n+        V1ObjectMeta meta = new V1ObjectMeta();\n+        meta.name(name);\n+        V1Namespace namespace = new V1Namespace();\n+        namespace.metadata(meta);\n+        try {\n+            namespace = coreV1Api.createNamespace(namespace, pretty, null, null);\n+            System.out.println(\"Kubernetes.createNamespace namespace: \" + namespace);\n+            return true;\n+        } catch (ApiException e) {\n+            e.printStackTrace();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ef3b6dcbc7d2c0a6e022c1201fa0cf78753e812"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0MjU3Ng==", "bodyText": "nit pick - put each param on a new line - maybe put a comment after them to say what they are, since the six nulls seem a bit magical :)", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1514#discussion_r400142576", "createdAt": "2020-03-30T12:13:30Z", "author": {"login": "markxnelson"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Kubernetes.java", "diffHunk": "@@ -54,4 +111,83 @@ public static String createUniqueNamespace() {\n         }\n     }\n \n+    public static List<String> listNamespaces() {\n+        ArrayList<String> nameSpaces = new ArrayList<>();\n+        try {\n+            V1NamespaceList namespaceList = coreV1Api.listNamespace(pretty, allowWatchBookmarks, null, null, null, null, resourceVersion, timeoutSeconds, false);\n+\n+            for (V1Namespace namespace : namespaceList.getItems()) {\n+                nameSpaces.add(namespace.getMetadata().getName());\n+            }\n+        } catch (ApiException e) {\n+            e.printStackTrace();\n+        }\n+\n+        return nameSpaces;\n+    }\n+\n+    public static boolean deleteNamespace(String name) {\n+        V1DeleteOptions deleteOptions = new V1DeleteOptions();\n+        try {\n+            V1Status status = coreV1Api.deleteNamespace(name, pretty, null, timeoutSeconds, false, \"Foreground\", deleteOptions);\n+            return true;\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+        }\n+        return false;\n+    }\n+\n+    // --------------------------- Custom Resource Domain -----------------------------------\n+\n+    public static boolean createDomain(String domainUID, String namespace, String domainYAML) {\n+        final String localVarPath =\n+                DOMAIN_PATH.replaceAll(\"\\\\{namespace\\\\}\", apiClient.escapeString(namespace));\n+\n+        Object json = null;\n+        try {\n+            json = convertYamlToJson(domainYAML);\n+            Object response = customObjectsApi.createClusterCustomObject(DOMAIN_GROUP, DOMAIN_VERSION, localVarPath, json, null);\n+            return true;\n+        } catch (ApiException | IOException e) {\n+            e.printStackTrace();\n+        }\n+        return false;\n+    }\n+\n+    private static Object convertYamlToJson(String yamlFile) throws IOException {\n+        ObjectMapper yamlReader = new ObjectMapper(new YAMLFactory());\n+        Object yamlObj = yamlReader.readValue(new File(yamlFile), Object.class);\n+        System.out.println(\"Kubernetes.convertYamlToJson yaml: \" + yamlObj);\n+\n+        ObjectMapper jsonWriter = new ObjectMapper();\n+        String writeValueAsString = jsonWriter.writeValueAsString(yamlObj);\n+        System.out.println(\"Kubernetes.convertYamlToJson writeValueAsString: \" + writeValueAsString);\n+        JsonNode root = new ObjectMapper().readTree(writeValueAsString);\n+        return root;\n+    }\n+\n+    public static List<String> listDomains(String namespace) {\n+        ArrayList<String> domains = new ArrayList<>();\n+        try {\n+            Map response = (Map) customObjectsApi.listNamespacedCustomObject(DOMAIN_GROUP, DOMAIN_VERSION, namespace, DOMAIN_PLURAL, null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ef3b6dcbc7d2c0a6e022c1201fa0cf78753e812"}, "originalPosition": 149}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzODkzNDEy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1514#pullrequestreview-383893412", "createdAt": "2020-03-30T14:10:25Z", "commit": {"oid": "6ef3b6dcbc7d2c0a6e022c1201fa0cf78753e812"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDoxMDoyNVrOF9rnRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxNDoxMDozOFrOF9roBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIyMjAyMA==", "bodyText": "Why did this get changed? The (c) is part of the check-style.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1514#discussion_r400222020", "createdAt": "2020-03-30T14:10:25Z", "author": {"login": "ddsharpe"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/Namespace.java", "diffHunk": "@@ -1,10 +1,12 @@\n-// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Copyright 2020, Oracle Corporation and/or its affiliates.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ef3b6dcbc7d2c0a6e022c1201fa0cf78753e812"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIyMjIxMg==", "bodyText": "same issue, (c)", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1514#discussion_r400222212", "createdAt": "2020-03-30T14:10:38Z", "author": {"login": "ddsharpe"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Kubernetes.java", "diffHunk": "@@ -1,10 +1,29 @@\n-// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Copyright 2020, Oracle Corporation and/or its affiliates.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ef3b6dcbc7d2c0a6e022c1201fa0cf78753e812"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "114ad731cdf52aa31231b83b9474b06e680848fd", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/114ad731cdf52aa31231b83b9474b06e680848fd", "committedDate": "2020-03-30T18:41:04Z", "message": "Changes based on initial feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MTM0NTY3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1514#pullrequestreview-384134567", "createdAt": "2020-03-30T18:47:39Z", "commit": {"oid": "114ad731cdf52aa31231b83b9474b06e680848fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxODo0NzozOVrOF93bgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxODo0NzozOVrOF93bgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNTYxNw==", "bodyText": "For the moment, updated the test to surround with try-catch until we learn how to handle exceptions with JUnit 5 assertions, as noted from Mark.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1514#discussion_r400415617", "createdAt": "2020-03-30T18:47:39Z", "author": {"login": "lennyphan"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItSimpleDomainValidation.java", "diffHunk": "@@ -30,8 +32,19 @@ public void testCreatingDomain() {\n         String domainYAML= \"something\";\n \n         // get a new unique namespace\n-        String namespace = createUniqueNamespace();\n-        logger.info(String.format(\"Got a new namespace called %s\", namespace));\n+        String namespace = null;\n+        try {\n+            namespace = createUniqueNamespace();\n+            logger.info(String.format(\"Got a new namespace called %s\", namespace));\n+        } catch (ApiException e) {\n+            // TODO: test in the calling method where we say something like\n+            //\n+            //  assert.DoesNotThrow(whatever(), ApiException.class, e,\n+            //    String.format(\"could not do whatever, got exception %s\", e))\n+            //\n+            //  so we have the exception and we can print out a meaningful error message\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114ad731cdf52aa31231b83b9474b06e680848fd"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MTM0ODMz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1514#pullrequestreview-384134833", "createdAt": "2020-03-30T18:48:00Z", "commit": {"oid": "114ad731cdf52aa31231b83b9474b06e680848fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxODo0ODowMFrOF93cUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQxODo0ODowMFrOF93cUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNTgyNg==", "bodyText": "Same as above comment.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1514#discussion_r400415826", "createdAt": "2020-03-30T18:48:00Z", "author": {"login": "lennyphan"}, "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItSimpleDomainValidation.java", "diffHunk": "@@ -53,6 +66,16 @@ public void testCreatingDomain() {\n \n         // wait for the managed servers to exist\n \n+        // Delete namespace\n+        try {\n+            deleteNamespace(namespace);\n+            logger.info(\"Deleted namespace: \" + namespace);\n+        } catch (Exception e) {\n+            // TODO: Fix as there is a known bug that delete can return either the object\n+            //  just deleted or a status.  We can workaround by either retrying or using\n+            //  the general GenericKubernetesApi client class and doing our own type checks\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "114ad731cdf52aa31231b83b9474b06e680848fd"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "124cf5c9f139e0680749f68af5deff55ae3aefc6", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/124cf5c9f139e0680749f68af5deff55ae3aefc6", "committedDate": "2020-03-30T20:11:51Z", "message": "Merged and resolved updates from mii-new-integration-tests branch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "261f4daddb558f3fef9478e3d36cbf7a65032a69", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/261f4daddb558f3fef9478e3d36cbf7a65032a69", "committedDate": "2020-03-30T23:20:19Z", "message": "implement delete PV/PVC, secrets, and config maps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "156ccdc41fc96aed5e0fec1d9665b5c034a45fc1", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/156ccdc41fc96aed5e0fec1d9665b5c034a45fc1", "committedDate": "2020-03-31T01:11:02Z", "message": "merge checkstyle changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ae760f6236bbdc75f094d47dfe02c54b7344c43", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0ae760f6236bbdc75f094d47dfe02c54b7344c43", "committedDate": "2020-03-31T04:56:01Z", "message": "create/delete domain custom resource"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c54f018d21eee330007eec8ac61f367fb0b9559e", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c54f018d21eee330007eec8ac61f367fb0b9559e", "committedDate": "2020-03-31T05:54:55Z", "message": "Updated javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0Njg4NjE4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1514#pullrequestreview-384688618", "createdAt": "2020-03-31T12:37:37Z", "commit": {"oid": "c54f018d21eee330007eec8ac61f367fb0b9559e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43cf0a83f7d9bf8feb8f56448e0fb18ce74eb5d0", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/43cf0a83f7d9bf8feb8f56448e0fb18ce74eb5d0", "committedDate": "2020-03-31T12:56:17Z", "message": "Use Assertions.assertDoesNotThrow() instead of try-catch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb5f01514045cf20ebf170c8918576566849a672", "author": {"user": {"login": "lennyphan", "name": "Lenny Phan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/bb5f01514045cf20ebf170c8918576566849a672", "committedDate": "2020-03-31T13:04:41Z", "message": "Use Assertions.assertDoesNotThrow()"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4935, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}