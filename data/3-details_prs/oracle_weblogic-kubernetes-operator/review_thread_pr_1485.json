{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxOTE4NzIz", "number": 1485, "reviewThreads": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDowODozN1rODqzsJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMzoxMjoxNVrODrbt5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjEzNjcxOnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDowODozN1rOF6x77g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMDo1Mjo1NVrOF8Z-aA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE3OTg4Ng==", "bodyText": "Why are we switching from Domain in Image to Domain in PV?  If we need to test Domain in PV here, we should ADD it (or add a copy of this test for PV), not remove Domain in Image.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397179886", "createdAt": "2020-03-24T14:08:37Z", "author": {"login": "ddsharpe"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -322,15 +272,11 @@ private void setupOperatorAndDomain(String operatorGitRelease, String operatorRe\n     domNs.add(DOM_NS);\n     operatorMap.put(\"domainNamespaces\", domNs);\n     operator = TestUtils.createOperator(operatorMap, Operator.RestCertType.LEGACY);\n-    // TestUtils.exec(\"kubectl get all --all-namespaces\", true);\n-\n-    // Map<String, Object> wlstDomainMap = TestUtils.loadYaml(DOMAININIMAGE_WLST_YAML);\n-    Map<String, Object> wlstDomainMap = createDomainInImageMap(getNewSuffixCount(), false, testClassName);\n+    Map<String, Object> wlstDomainMap = createDomainMap(getNewSuffixCount(),testClassName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 314}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE5MjI4Nw==", "bodyText": "The purpose of the Upgrade Usecase is to verify the ability of the Upgrade Operator to manage the existing Weblogic Domain. Will the upgrade process takes a different code path based on domain model used.\nAnother Reason :   I have modified the domain-in-image sample script  ( in develop) to skip the domain image creation if the image exits to reduce the test execution time.  But this change is not available in master ( 2.5.0 branch), so I can not use this  feature while creating domain in older release to start the Domain", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397192287", "createdAt": "2020-03-24T14:24:52Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -322,15 +272,11 @@ private void setupOperatorAndDomain(String operatorGitRelease, String operatorRe\n     domNs.add(DOM_NS);\n     operatorMap.put(\"domainNamespaces\", domNs);\n     operator = TestUtils.createOperator(operatorMap, Operator.RestCertType.LEGACY);\n-    // TestUtils.exec(\"kubectl get all --all-namespaces\", true);\n-\n-    // Map<String, Object> wlstDomainMap = TestUtils.loadYaml(DOMAININIMAGE_WLST_YAML);\n-    Map<String, Object> wlstDomainMap = createDomainInImageMap(getNewSuffixCount(), false, testClassName);\n+    Map<String, Object> wlstDomainMap = createDomainMap(getNewSuffixCount(),testClassName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE3OTg4Ng=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 314}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU1OTgzMg==", "bodyText": "@ddsharpe does this resolve your concern?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397559832", "createdAt": "2020-03-25T01:32:43Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -322,15 +272,11 @@ private void setupOperatorAndDomain(String operatorGitRelease, String operatorRe\n     domNs.add(DOM_NS);\n     operatorMap.put(\"domainNamespaces\", domNs);\n     operator = TestUtils.createOperator(operatorMap, Operator.RestCertType.LEGACY);\n-    // TestUtils.exec(\"kubectl get all --all-namespaces\", true);\n-\n-    // Map<String, Object> wlstDomainMap = TestUtils.loadYaml(DOMAININIMAGE_WLST_YAML);\n-    Map<String, Object> wlstDomainMap = createDomainInImageMap(getNewSuffixCount(), false, testClassName);\n+    Map<String, Object> wlstDomainMap = createDomainMap(getNewSuffixCount(),testClassName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE3OTg4Ng=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 314}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyNjU3Mw==", "bodyText": "@ddsharpe", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r398226573", "createdAt": "2020-03-25T23:13:15Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -322,15 +272,11 @@ private void setupOperatorAndDomain(String operatorGitRelease, String operatorRe\n     domNs.add(DOM_NS);\n     operatorMap.put(\"domainNamespaces\", domNs);\n     operator = TestUtils.createOperator(operatorMap, Operator.RestCertType.LEGACY);\n-    // TestUtils.exec(\"kubectl get all --all-namespaces\", true);\n-\n-    // Map<String, Object> wlstDomainMap = TestUtils.loadYaml(DOMAININIMAGE_WLST_YAML);\n-    Map<String, Object> wlstDomainMap = createDomainInImageMap(getNewSuffixCount(), false, testClassName);\n+    Map<String, Object> wlstDomainMap = createDomainMap(getNewSuffixCount(),testClassName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE3OTg4Ng=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 314}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg4NDQ1Ng==", "bodyText": "confirmed derek is ok with the response", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r398884456", "createdAt": "2020-03-26T20:52:55Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -322,15 +272,11 @@ private void setupOperatorAndDomain(String operatorGitRelease, String operatorRe\n     domNs.add(DOM_NS);\n     operatorMap.put(\"domainNamespaces\", domNs);\n     operator = TestUtils.createOperator(operatorMap, Operator.RestCertType.LEGACY);\n-    // TestUtils.exec(\"kubectl get all --all-namespaces\", true);\n-\n-    // Map<String, Object> wlstDomainMap = TestUtils.loadYaml(DOMAININIMAGE_WLST_YAML);\n-    Map<String, Object> wlstDomainMap = createDomainInImageMap(getNewSuffixCount(), false, testClassName);\n+    Map<String, Object> wlstDomainMap = createDomainMap(getNewSuffixCount(),testClassName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE3OTg4Ng=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 314}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjI1MzMyOnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDozMzowNlrOF6zF3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMzozMTo0NVrOF7G7bQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE5ODgxMw==", "bodyText": "the comment says we want to check they have not been restarted, but this just checks if they are running, not if they wer restarted.  is the comment wrong? or does the code need to be improved to check for restart?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397198813", "createdAt": "2020-03-24T14:33:06Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING \n+   * not restarted due to Operator Upgrade\n+   *\n+   * @throws Exception If restarted\n+   */\n+  private void checkDomainNotRestarted() throws Exception {\n+    TestUtils.checkPodReady(DUID + \"-\" + domain.getAdminServerName(), DOM_NS);\n+    for (int i = 2; i >= 1; i--) {\n+      LoggerHelper.getLocal().log(Level.INFO,\n+          \"Checking if managed server pod(\" + DUID + \"--managed-server\" + i + \") is RUNNING\");\n+      TestUtils.checkPodReady(DUID + \"-managed-server\" + i, DOM_NS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 300}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUyMzgyMQ==", "bodyText": "I added the logic to check the creationTimesamp before and after upgrade to make sure that the server pod has not been re-stared due to upgrade.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397523821", "createdAt": "2020-03-24T23:31:45Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING \n+   * not restarted due to Operator Upgrade\n+   *\n+   * @throws Exception If restarted\n+   */\n+  private void checkDomainNotRestarted() throws Exception {\n+    TestUtils.checkPodReady(DUID + \"-\" + domain.getAdminServerName(), DOM_NS);\n+    for (int i = 2; i >= 1; i--) {\n+      LoggerHelper.getLocal().log(Level.INFO,\n+          \"Checking if managed server pod(\" + DUID + \"--managed-server\" + i + \") is RUNNING\");\n+      TestUtils.checkPodReady(DUID + \"-managed-server\" + i, DOM_NS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE5ODgxMw=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 300}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjI1OTk2OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDozNDoyOVrOF6zKNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDo0NzowM1rOF6zxAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE5OTkyNA==", "bodyText": "didn't we discuss this and realize that the 15 minute wait was only needed for a domain to be updated?  and that we only need to check the CRD apiVersion is udpated, not a CR (instance)?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397199924", "createdAt": "2020-03-24T14:34:29Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n         \"Checking for the domain apiVersion \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < 120; i++) {\n       ExecResult exec =\n           TestUtils.exec(\n               \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n       if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+        int ttime = 10 * (i - 1); \n+        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected API Version after [\" + ttime + \"] Seconds\");\n+        result = true;\n+        break;\n+      }\n+      Thread.sleep(1000 * 10);\n+    }\n+    if (!result) {\n+      throw new RuntimeException(\"FAILURE: Didn't get the expected API Version\");\n+    }\n+  }\n+\n+  /**\n+   * Checks the expected Upgraded Version of CustomResourceDefintion (CRD) \n+   * in default NameSpace in a loop. \n+   *\n+   * @throws Exception when version does not match\n+   */\n+  private void checkCrdVersion() throws Exception {\n+    boolean result = false;\n+    LoggerHelper.getLocal().log(\n+        Level.INFO,\n+        \"Checking for the CRD Version \"\n+            + getDomainApiVersion()\n+            + \" in a loop for up to 15 minutes\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 267}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwOTA5Ng==", "bodyText": "@rjeberhard ^^ ?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397209096", "createdAt": "2020-03-24T14:46:04Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n         \"Checking for the domain apiVersion \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < 120; i++) {\n       ExecResult exec =\n           TestUtils.exec(\n               \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n       if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+        int ttime = 10 * (i - 1); \n+        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected API Version after [\" + ttime + \"] Seconds\");\n+        result = true;\n+        break;\n+      }\n+      Thread.sleep(1000 * 10);\n+    }\n+    if (!result) {\n+      throw new RuntimeException(\"FAILURE: Didn't get the expected API Version\");\n+    }\n+  }\n+\n+  /**\n+   * Checks the expected Upgraded Version of CustomResourceDefintion (CRD) \n+   * in default NameSpace in a loop. \n+   *\n+   * @throws Exception when version does not match\n+   */\n+  private void checkCrdVersion() throws Exception {\n+    boolean result = false;\n+    LoggerHelper.getLocal().log(\n+        Level.INFO,\n+        \"Checking for the CRD Version \"\n+            + getDomainApiVersion()\n+            + \" in a loop for up to 15 minutes\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE5OTkyNA=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 267}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwOTg1Nw==", "bodyText": "oh i see you removed the call on 148 to this method -- so can this method be deleted now? not needed?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397209857", "createdAt": "2020-03-24T14:47:03Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n         \"Checking for the domain apiVersion \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < 120; i++) {\n       ExecResult exec =\n           TestUtils.exec(\n               \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n       if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+        int ttime = 10 * (i - 1); \n+        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected API Version after [\" + ttime + \"] Seconds\");\n+        result = true;\n+        break;\n+      }\n+      Thread.sleep(1000 * 10);\n+    }\n+    if (!result) {\n+      throw new RuntimeException(\"FAILURE: Didn't get the expected API Version\");\n+    }\n+  }\n+\n+  /**\n+   * Checks the expected Upgraded Version of CustomResourceDefintion (CRD) \n+   * in default NameSpace in a loop. \n+   *\n+   * @throws Exception when version does not match\n+   */\n+  private void checkCrdVersion() throws Exception {\n+    boolean result = false;\n+    LoggerHelper.getLocal().log(\n+        Level.INFO,\n+        \"Checking for the CRD Version \"\n+            + getDomainApiVersion()\n+            + \" in a loop for up to 15 minutes\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE5OTkyNA=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 267}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjI2NDI0OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDozNTozMVrOF6zNJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMzozMzowOFrOF7G9VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMDY3Nw==", "bodyText": "does this need to be a RuntimeException? not just a regular Exception?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397200677", "createdAt": "2020-03-24T14:35:31Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n         \"Checking for the domain apiVersion \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < 120; i++) {\n       ExecResult exec =\n           TestUtils.exec(\n               \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n       if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+        int ttime = 10 * (i - 1); \n+        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected API Version after [\" + ttime + \"] Seconds\");\n+        result = true;\n+        break;\n+      }\n+      Thread.sleep(1000 * 10);\n+    }\n+    if (!result) {\n+      throw new RuntimeException(\"FAILURE: Didn't get the expected API Version\");\n+    }\n+  }\n+\n+  /**\n+   * Checks the expected Upgraded Version of CustomResourceDefintion (CRD) \n+   * in default NameSpace in a loop. \n+   *\n+   * @throws Exception when version does not match\n+   */\n+  private void checkCrdVersion() throws Exception {\n+    boolean result = false;\n+    LoggerHelper.getLocal().log(\n+        Level.INFO,\n+        \"Checking for the CRD Version \"\n+            + getDomainApiVersion()\n+            + \" in a loop for up to 15 minutes\");\n+    for (int i = 0; i < 900; i = i + 10) {\n+      ExecResult exec =\n+          TestUtils.exec(\n+              \"kubectl get crd domains.weblogic.oracle -o jsonpath='{.spec.versions[?(@.storage==true)].name}'\", true);\n+      if (exec.stdout().contains(getCrdVersion())) {\n+        LoggerHelper.getLocal().log(Level.INFO, \"Got expected CRD Version\");\n         result = true;\n         break;\n       }\n       Thread.sleep(1000 * 10);\n     }\n     if (!result) {\n-      throw new RuntimeException(\"FAILURE: Didn't get the expected operator version\");\n+      throw new RuntimeException(\"FAILURE: Didn't get expected CRD Version\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 281}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI3ODI5Nw==", "bodyText": "Modified as follows  ..\nthrow new Exception(\"FAILURE: Didn't get expected CRD Version\");", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397278297", "createdAt": "2020-03-24T16:13:03Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n         \"Checking for the domain apiVersion \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < 120; i++) {\n       ExecResult exec =\n           TestUtils.exec(\n               \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n       if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+        int ttime = 10 * (i - 1); \n+        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected API Version after [\" + ttime + \"] Seconds\");\n+        result = true;\n+        break;\n+      }\n+      Thread.sleep(1000 * 10);\n+    }\n+    if (!result) {\n+      throw new RuntimeException(\"FAILURE: Didn't get the expected API Version\");\n+    }\n+  }\n+\n+  /**\n+   * Checks the expected Upgraded Version of CustomResourceDefintion (CRD) \n+   * in default NameSpace in a loop. \n+   *\n+   * @throws Exception when version does not match\n+   */\n+  private void checkCrdVersion() throws Exception {\n+    boolean result = false;\n+    LoggerHelper.getLocal().log(\n+        Level.INFO,\n+        \"Checking for the CRD Version \"\n+            + getDomainApiVersion()\n+            + \" in a loop for up to 15 minutes\");\n+    for (int i = 0; i < 900; i = i + 10) {\n+      ExecResult exec =\n+          TestUtils.exec(\n+              \"kubectl get crd domains.weblogic.oracle -o jsonpath='{.spec.versions[?(@.storage==true)].name}'\", true);\n+      if (exec.stdout().contains(getCrdVersion())) {\n+        LoggerHelper.getLocal().log(Level.INFO, \"Got expected CRD Version\");\n         result = true;\n         break;\n       }\n       Thread.sleep(1000 * 10);\n     }\n     if (!result) {\n-      throw new RuntimeException(\"FAILURE: Didn't get the expected operator version\");\n+      throw new RuntimeException(\"FAILURE: Didn't get expected CRD Version\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMDY3Nw=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 281}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzMwMjE5Ng==", "bodyText": "well that's great that you changed it, but the question was does it need to be a RE?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397302196", "createdAt": "2020-03-24T16:43:44Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n         \"Checking for the domain apiVersion \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < 120; i++) {\n       ExecResult exec =\n           TestUtils.exec(\n               \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n       if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+        int ttime = 10 * (i - 1); \n+        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected API Version after [\" + ttime + \"] Seconds\");\n+        result = true;\n+        break;\n+      }\n+      Thread.sleep(1000 * 10);\n+    }\n+    if (!result) {\n+      throw new RuntimeException(\"FAILURE: Didn't get the expected API Version\");\n+    }\n+  }\n+\n+  /**\n+   * Checks the expected Upgraded Version of CustomResourceDefintion (CRD) \n+   * in default NameSpace in a loop. \n+   *\n+   * @throws Exception when version does not match\n+   */\n+  private void checkCrdVersion() throws Exception {\n+    boolean result = false;\n+    LoggerHelper.getLocal().log(\n+        Level.INFO,\n+        \"Checking for the CRD Version \"\n+            + getDomainApiVersion()\n+            + \" in a loop for up to 15 minutes\");\n+    for (int i = 0; i < 900; i = i + 10) {\n+      ExecResult exec =\n+          TestUtils.exec(\n+              \"kubectl get crd domains.weblogic.oracle -o jsonpath='{.spec.versions[?(@.storage==true)].name}'\", true);\n+      if (exec.stdout().contains(getCrdVersion())) {\n+        LoggerHelper.getLocal().log(Level.INFO, \"Got expected CRD Version\");\n         result = true;\n         break;\n       }\n       Thread.sleep(1000 * 10);\n     }\n     if (!result) {\n-      throw new RuntimeException(\"FAILURE: Didn't get the expected operator version\");\n+      throw new RuntimeException(\"FAILURE: Didn't get expected CRD Version\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMDY3Nw=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 281}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUyNDMwOQ==", "bodyText": "Junit fails when the method throws any Exception, it does not matter it is a RE or simple Exception.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397524309", "createdAt": "2020-03-24T23:33:08Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n         \"Checking for the domain apiVersion \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < 120; i++) {\n       ExecResult exec =\n           TestUtils.exec(\n               \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n       if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+        int ttime = 10 * (i - 1); \n+        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected API Version after [\" + ttime + \"] Seconds\");\n+        result = true;\n+        break;\n+      }\n+      Thread.sleep(1000 * 10);\n+    }\n+    if (!result) {\n+      throw new RuntimeException(\"FAILURE: Didn't get the expected API Version\");\n+    }\n+  }\n+\n+  /**\n+   * Checks the expected Upgraded Version of CustomResourceDefintion (CRD) \n+   * in default NameSpace in a loop. \n+   *\n+   * @throws Exception when version does not match\n+   */\n+  private void checkCrdVersion() throws Exception {\n+    boolean result = false;\n+    LoggerHelper.getLocal().log(\n+        Level.INFO,\n+        \"Checking for the CRD Version \"\n+            + getDomainApiVersion()\n+            + \" in a loop for up to 15 minutes\");\n+    for (int i = 0; i < 900; i = i + 10) {\n+      ExecResult exec =\n+          TestUtils.exec(\n+              \"kubectl get crd domains.weblogic.oracle -o jsonpath='{.spec.versions[?(@.storage==true)].name}'\", true);\n+      if (exec.stdout().contains(getCrdVersion())) {\n+        LoggerHelper.getLocal().log(Level.INFO, \"Got expected CRD Version\");\n         result = true;\n         break;\n       }\n       Thread.sleep(1000 * 10);\n     }\n     if (!result) {\n-      throw new RuntimeException(\"FAILURE: Didn't get the expected operator version\");\n+      throw new RuntimeException(\"FAILURE: Didn't get expected CRD Version\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMDY3Nw=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 281}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjI3MDU1OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/resources/OperatorIT.properties", "isResolved": true, "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDozNjo1NlrOF6zRUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNTozODoxMVrOF62Pdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMTc0NQ==", "bodyText": "can you get the version from develop crd instead of adding a property here, we will have to change this value for every release.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397201745", "createdAt": "2020-03-24T14:36:56Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/resources/OperatorIT.properties", "diffHunk": "@@ -16,6 +16,7 @@ oracledbImageTag = 12.2.0.1-slim\n oracledbImageName = container-registry.oracle.com/database/enterprise\n OCR_SERVER=container-registry.oracle.com\n DOMAIN_API_VERSION = weblogic.oracle/v7\n+CRD_VERSION = v7", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMzcxNA==", "bodyText": "Unless I start the domain in develop branch, is it possible to get the domain CRD offline.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397203714", "createdAt": "2020-03-24T14:39:29Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/resources/OperatorIT.properties", "diffHunk": "@@ -16,6 +16,7 @@ oracledbImageTag = 12.2.0.1-slim\n oracledbImageName = container-registry.oracle.com/database/enterprise\n OCR_SERVER=container-registry.oracle.com\n DOMAIN_API_VERSION = weblogic.oracle/v7\n+CRD_VERSION = v7", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMTc0NQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMDAwMw==", "bodyText": "I don't understand the question, Pani.  Vanaja, I'm okay with having a separate test value here so that the test code doesn't depend on symbols from the production code.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397210003", "createdAt": "2020-03-24T14:47:13Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/resources/OperatorIT.properties", "diffHunk": "@@ -16,6 +16,7 @@ oracledbImageTag = 12.2.0.1-slim\n oracledbImageName = container-registry.oracle.com/database/enterprise\n OCR_SERVER=container-registry.oracle.com\n DOMAIN_API_VERSION = weblogic.oracle/v7\n+CRD_VERSION = v7", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMTc0NQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMTQ4NA==", "bodyText": "Ryan, still the value here is whatever is used in production code right.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397211484", "createdAt": "2020-03-24T14:49:00Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/resources/OperatorIT.properties", "diffHunk": "@@ -16,6 +16,7 @@ oracledbImageTag = 12.2.0.1-slim\n oracledbImageName = container-registry.oracle.com/database/enterprise\n OCR_SERVER=container-registry.oracle.com\n DOMAIN_API_VERSION = weblogic.oracle/v7\n+CRD_VERSION = v7", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMTc0NQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMjc5OA==", "bodyText": "Yes, that's right.  They would need to be kept in sync.  Here's another option.  We make another module in maven with shared symbols like this that the operator runtime and integration tests could share.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397212798", "createdAt": "2020-03-24T14:50:34Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/resources/OperatorIT.properties", "diffHunk": "@@ -16,6 +16,7 @@ oracledbImageTag = 12.2.0.1-slim\n oracledbImageName = container-registry.oracle.com/database/enterprise\n OCR_SERVER=container-registry.oracle.com\n DOMAIN_API_VERSION = weblogic.oracle/v7\n+CRD_VERSION = v7", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMTc0NQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxNDI1MA==", "bodyText": "That's a good idea.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397214250", "createdAt": "2020-03-24T14:52:27Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/resources/OperatorIT.properties", "diffHunk": "@@ -16,6 +16,7 @@ oracledbImageTag = 12.2.0.1-slim\n oracledbImageName = container-registry.oracle.com/database/enterprise\n OCR_SERVER=container-registry.oracle.com\n DOMAIN_API_VERSION = weblogic.oracle/v7\n+CRD_VERSION = v7", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMTc0NQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIyOTEyOA==", "bodyText": "Okay, I can make that happen but not in the PR.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397229128", "createdAt": "2020-03-24T15:11:12Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/resources/OperatorIT.properties", "diffHunk": "@@ -16,6 +16,7 @@ oracledbImageTag = 12.2.0.1-slim\n oracledbImageName = container-registry.oracle.com/database/enterprise\n OCR_SERVER=container-registry.oracle.com\n DOMAIN_API_VERSION = weblogic.oracle/v7\n+CRD_VERSION = v7", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMTc0NQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzMTk0MA==", "bodyText": "Ok. should we leave it hard coded for now or get the value from develop crd?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397231940", "createdAt": "2020-03-24T15:14:50Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/resources/OperatorIT.properties", "diffHunk": "@@ -16,6 +16,7 @@ oracledbImageTag = 12.2.0.1-slim\n oracledbImageName = container-registry.oracle.com/database/enterprise\n OCR_SERVER=container-registry.oracle.com\n DOMAIN_API_VERSION = weblogic.oracle/v7\n+CRD_VERSION = v7", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMTc0NQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzNjE3Ng==", "bodyText": "Let's leave it hardcoded now please because I would strongly like to not have integration-test depend on the operator module.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397236176", "createdAt": "2020-03-24T15:20:08Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/resources/OperatorIT.properties", "diffHunk": "@@ -16,6 +16,7 @@ oracledbImageTag = 12.2.0.1-slim\n oracledbImageName = container-registry.oracle.com/database/enterprise\n OCR_SERVER=container-registry.oracle.com\n DOMAIN_API_VERSION = weblogic.oracle/v7\n+CRD_VERSION = v7", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMTc0NQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI0MDY5MQ==", "bodyText": "Will just starting the operator in develop branch create crd domains.weblogic.oracle?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397240691", "createdAt": "2020-03-24T15:25:54Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/resources/OperatorIT.properties", "diffHunk": "@@ -16,6 +16,7 @@ oracledbImageTag = 12.2.0.1-slim\n oracledbImageName = container-registry.oracle.com/database/enterprise\n OCR_SERVER=container-registry.oracle.com\n DOMAIN_API_VERSION = weblogic.oracle/v7\n+CRD_VERSION = v7", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMTc0NQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1MDQyMg==", "bodyText": "We will keep the value hard-coded till we get a shared module for crd version on the github repository", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397250422", "createdAt": "2020-03-24T15:38:11Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/resources/OperatorIT.properties", "diffHunk": "@@ -16,6 +16,7 @@ oracledbImageTag = 12.2.0.1-slim\n oracledbImageName = container-registry.oracle.com/database/enterprise\n OCR_SERVER=container-registry.oracle.com\n DOMAIN_API_VERSION = weblogic.oracle/v7\n+CRD_VERSION = v7", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMTc0NQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjI4NTQzOnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDo0MDoxMFrOF6zbBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxOToxMDo1N1rOF6_PUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwNDIzMA==", "bodyText": "remove this method as its not used", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397204230", "createdAt": "2020-03-24T14:40:10Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 229}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzNzI3OA==", "bodyText": "Keeping it if we can decrease the time by revisiting the product code in future.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397237278", "createdAt": "2020-03-24T15:21:33Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwNDIzMA=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 229}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzOTE2Mw==", "bodyText": "@rjeberhard confirmed we don't need to verify domain resource apiVersion, checking crd apiVersion is enough. Ryan, can you please confirm again.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397239163", "createdAt": "2020-03-24T15:24:00Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwNDIzMA=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 229}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI0MDk4NA==", "bodyText": "Yes, correct.  We do not need to confirm that the operator updates the .apiVersion of a Domain resource.  I'm just interested in the CRD version and then the checks that the pods don't roll and that the domain remains manageable.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397240984", "createdAt": "2020-03-24T15:26:16Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwNDIzMA=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 229}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1OTk1MQ==", "bodyText": "@anpanigr you can remove the method", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397259951", "createdAt": "2020-03-24T15:50:02Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwNDIzMA=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 229}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM5Nzg0MA==", "bodyText": "removed the method to check DomainApi version", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397397840", "createdAt": "2020-03-24T19:10:57Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwNDIzMA=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 229}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjMwNDc0OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDo0NDowMFrOF6znfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNToyMjowNFrOF61dkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwNzQyMQ==", "bodyText": "use BaseTest.getMaxIterationsPod() and BaseTest.getWaitTimePod() - these are controlled from properties file or env var. we use these across the tests if we check for something in loop.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397207421", "createdAt": "2020-03-24T14:44:00Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n         \"Checking for the domain apiVersion \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < 120; i++) {\n       ExecResult exec =\n           TestUtils.exec(\n               \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n       if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+        int ttime = 10 * (i - 1); \n+        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected API Version after [\" + ttime + \"] Seconds\");\n+        result = true;\n+        break;\n+      }\n+      Thread.sleep(1000 * 10);\n+    }\n+    if (!result) {\n+      throw new RuntimeException(\"FAILURE: Didn't get the expected API Version\");\n+    }\n+  }\n+\n+  /**\n+   * Checks the expected Upgraded Version of CustomResourceDefintion (CRD) \n+   * in default NameSpace in a loop. \n+   *\n+   * @throws Exception when version does not match\n+   */\n+  private void checkCrdVersion() throws Exception {\n+    boolean result = false;\n+    LoggerHelper.getLocal().log(\n+        Level.INFO,\n+        \"Checking for the CRD Version \"\n+            + getDomainApiVersion()\n+            + \" in a loop for up to 15 minutes\");\n+    for (int i = 0; i < 900; i = i + 10) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 268}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIzNzY1MQ==", "bodyText": "Done", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397237651", "createdAt": "2020-03-24T15:22:04Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n         \"Checking for the domain apiVersion \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < 120; i++) {\n       ExecResult exec =\n           TestUtils.exec(\n               \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n       if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+        int ttime = 10 * (i - 1); \n+        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected API Version after [\" + ttime + \"] Seconds\");\n+        result = true;\n+        break;\n+      }\n+      Thread.sleep(1000 * 10);\n+    }\n+    if (!result) {\n+      throw new RuntimeException(\"FAILURE: Didn't get the expected API Version\");\n+    }\n+  }\n+\n+  /**\n+   * Checks the expected Upgraded Version of CustomResourceDefintion (CRD) \n+   * in default NameSpace in a loop. \n+   *\n+   * @throws Exception when version does not match\n+   */\n+  private void checkCrdVersion() throws Exception {\n+    boolean result = false;\n+    LoggerHelper.getLocal().log(\n+        Level.INFO,\n+        \"Checking for the CRD Version \"\n+            + getDomainApiVersion()\n+            + \" in a loop for up to 15 minutes\");\n+    for (int i = 0; i < 900; i = i + 10) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwNzQyMQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 268}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjMxNDg5OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDo0NjowMFrOF6zt1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMzozMToxOFrOF7G6ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwOTA0NQ==", "bodyText": "if rolling restart is triggered, do u see it immediately or will there be little lag? checking once immediately is enough to make sure rolling restart is not triggered?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397209045", "createdAt": "2020-03-24T14:46:00Z", "author": {"login": "vanajamukkara"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING \n+   * not restarted due to Operator Upgrade\n+   *\n+   * @throws Exception If restarted\n+   */\n+  private void checkDomainNotRestarted() throws Exception {\n+    TestUtils.checkPodReady(DUID + \"-\" + domain.getAdminServerName(), DOM_NS);\n+    for (int i = 2; i >= 1; i--) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 297}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxNTg1Nw==", "bodyText": "Combining here since @markxnelson made the same comment below... Checking that the operator doesn't restart pods is a bit tricky.  The operator will respond very quickly to check all existing domains after it starts, so if the operator hasn't started the deletion of any pods within a few seconds then it isn't rolling the servers.  You can check if pods are in the process of being deleted by checking the .metadata.deletionTimestamp.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397215857", "createdAt": "2020-03-24T14:54:20Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING \n+   * not restarted due to Operator Upgrade\n+   *\n+   * @throws Exception If restarted\n+   */\n+  private void checkDomainNotRestarted() throws Exception {\n+    TestUtils.checkPodReady(DUID + \"-\" + domain.getAdminServerName(), DOM_NS);\n+    for (int i = 2; i >= 1; i--) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwOTA0NQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 297}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI5NTIyMw==", "bodyText": "Here should I expect a NULL value for {.metadata.deletionTimestamp}\n$ kubectl get po/operatordomain250-managed-server1 -n weblogic-domain250 -o  jsonpath={.metadata.deletionTimestamp}\nI get a NULL value while the pod are RUNNING\nOR I can compare the creationTimestamp before and after Upgrade.  Both MUST be same", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397295223", "createdAt": "2020-03-24T16:34:37Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING \n+   * not restarted due to Operator Upgrade\n+   *\n+   * @throws Exception If restarted\n+   */\n+  private void checkDomainNotRestarted() throws Exception {\n+    TestUtils.checkPodReady(DUID + \"-\" + domain.getAdminServerName(), DOM_NS);\n+    for (int i = 2; i >= 1; i--) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwOTA0NQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 297}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI5NzcxMA==", "bodyText": "Yes, that's right.  Oh, and for completeness you should check that the .metadata.creationTimesamp.  I don't think it's an or...", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397297710", "createdAt": "2020-03-24T16:37:53Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING \n+   * not restarted due to Operator Upgrade\n+   *\n+   * @throws Exception If restarted\n+   */\n+  private void checkDomainNotRestarted() throws Exception {\n+    TestUtils.checkPodReady(DUID + \"-\" + domain.getAdminServerName(), DOM_NS);\n+    for (int i = 2; i >= 1; i--) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwOTA0NQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 297}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUyMzY1MQ==", "bodyText": "I added the logic to check the creationTimesamp before and after upgrade to make sure that the server pod has not been re-stared due to upgrade.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397523651", "createdAt": "2020-03-24T23:31:18Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING \n+   * not restarted due to Operator Upgrade\n+   *\n+   * @throws Exception If restarted\n+   */\n+  private void checkDomainNotRestarted() throws Exception {\n+    TestUtils.checkPodReady(DUID + \"-\" + domain.getAdminServerName(), DOM_NS);\n+    for (int i = 2; i >= 1; i--) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwOTA0NQ=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 297}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjMyMjAwOnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDo0NzozNVrOF6zyqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNzowMDowOVrOF7lDAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMDI4Mg==", "bodyText": "none of the javadoc in this file is javadoc compliant.  can you please run javadoc and fix the errors?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397210282", "createdAt": "2020-03-24T14:47:35Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 290}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI3NDk3MA==", "bodyText": "Does the style check plugin does not check for javadoc compatibility. When I run \"javaoc  ItOperatorUpgrade.java\" It only complains about the missing package as follows ...\nItOperatorUpgrade.java:19: error: package org.junit.jupiter.api does not exist\nimport org.junit.jupiter.api.AfterEach;", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397274970", "createdAt": "2020-03-24T16:08:50Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMDI4Mg=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 290}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI5OTk1NQ==", "bodyText": "i get this error:\n/home/mark/jdk-11.0.6/bin/javadoc -private -splitindex -d /home/mark/operator/weblogic-kubernetes-operator/integration-tests/target/site @/tmp/javadoc_args\nLoading source file /home/mark/operator/weblogic-kubernetes-operator/integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java...\nConstructing Javadoc information...\nStandard Doclet version 11.0.6\nBuilding tree for all the packages and classes...\nGenerating /home/mark/operator/weblogic-kubernetes-operator/integration-tests/target/site/oracle/kubernetes/operator/ItOperatorUpgrade.html...\n/home/mark/operator/weblogic-kubernetes-operator/integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java:141: error: @param name not found\n   * @param restart boolean parameter used to determine if a restart of domain is checked\n            ^\n\nthe ide shows it too:", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397299955", "createdAt": "2020-03-24T16:40:50Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMDI4Mg=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 290}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzMwMDYzMA==", "bodyText": "", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397300630", "createdAt": "2020-03-24T16:41:49Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMDI4Mg=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 290}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MTkwNg==", "bodyText": "Please spell \"WebLogic\" right too", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397561906", "createdAt": "2020-03-25T01:40:05Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMDI4Mg=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 290}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU4OTE0OQ==", "bodyText": "Replaced  WebLogic --> Weblogic", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397589149", "createdAt": "2020-03-25T03:24:50Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMDI4Mg=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 290}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyMDg0NA==", "bodyText": "@anpanigr, the product name has the capital L.  The correct name is \"WebLogic\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397820844", "createdAt": "2020-03-25T12:37:59Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMDI4Mg=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 290}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzOTAxMQ==", "bodyText": "i cant see the update - still appears to say weblogic", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397939011", "createdAt": "2020-03-25T15:19:53Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMDI4Mg=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 290}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAxNzI4Mw==", "bodyText": "Modified in latest commit on March 25", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r398017283", "createdAt": "2020-03-25T17:00:09Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +229,20 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMDI4Mg=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 290}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjMyNjgzOnYy", "diffSide": "RIGHT", "path": "kubernetes/samples/scripts/create-weblogic-domain/domain-home-in-image/create-domain.sh", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDo0ODoyOVrOF6z1rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNjoyNTo0M1rOF64j_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMTA1NA==", "bodyText": "fix this sentence", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397211054", "createdAt": "2020-03-24T14:48:29Z", "author": {"login": "markxnelson"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/domain-home-in-image/create-domain.sh", "diffHunk": "@@ -34,6 +34,7 @@ function usage {\n   echo \"  -v Validate the existence of persistentVolumeClaim, optional.\"\n   echo \"  -k Keep what has been previously from cloned https://github.com/oracle/docker-images.git, optional. \"\n   echo \"     If not specified, this script will always remove existing project directory and clone again.\"\n+  echo \"  -s Skip the domain image build optional. \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI1NjMzOQ==", "bodyText": "I replicate the sentences from other existing parameters  such as\necho \"  -e Also create the resources in the generated YAML files, optional.\"\necho \"  -v Validate the existence of persistentVolumeClaim, optional.\"\nAny Suggestion like this\necho \"  -s Skip the domain image build  (optional)  \"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397256339", "createdAt": "2020-03-24T15:45:39Z", "author": {"login": "anpanigr"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/domain-home-in-image/create-domain.sh", "diffHunk": "@@ -34,6 +34,7 @@ function usage {\n   echo \"  -v Validate the existence of persistentVolumeClaim, optional.\"\n   echo \"  -k Keep what has been previously from cloned https://github.com/oracle/docker-images.git, optional. \"\n   echo \"     If not specified, this script will always remove existing project directory and clone again.\"\n+  echo \"  -s Skip the domain image build optional. \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMTA1NA=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI3NzU4Mw==", "bodyText": "comma or parens are ok - but the way it is now is not correct", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397277583", "createdAt": "2020-03-24T16:12:10Z", "author": {"login": "markxnelson"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/domain-home-in-image/create-domain.sh", "diffHunk": "@@ -34,6 +34,7 @@ function usage {\n   echo \"  -v Validate the existence of persistentVolumeClaim, optional.\"\n   echo \"  -k Keep what has been previously from cloned https://github.com/oracle/docker-images.git, optional. \"\n   echo \"     If not specified, this script will always remove existing project directory and clone again.\"\n+  echo \"  -s Skip the domain image build optional. \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMTA1NA=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzI4ODQ0Nw==", "bodyText": "I modified the sentence as follows with an additional comma\necho \"  -s Skip the domain image build, optional. \"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397288447", "createdAt": "2020-03-24T16:25:43Z", "author": {"login": "anpanigr"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/domain-home-in-image/create-domain.sh", "diffHunk": "@@ -34,6 +34,7 @@ function usage {\n   echo \"  -v Validate the existence of persistentVolumeClaim, optional.\"\n   echo \"  -k Keep what has been previously from cloned https://github.com/oracle/docker-images.git, optional. \"\n   echo \"     If not specified, this script will always remove existing project directory and clone again.\"\n+  echo \"  -s Skip the domain image build optional. \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMTA1NA=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjMyODYzOnYy", "diffSide": "RIGHT", "path": "kubernetes/samples/scripts/create-weblogic-domain/domain-home-in-image/create-domain.sh", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDo0ODo0N1rOF6z2ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDo0ODo0N1rOF6z2ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIxMTMyMg==", "bodyText": "typo", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397211322", "createdAt": "2020-03-24T14:48:47Z", "author": {"login": "markxnelson"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/domain-home-in-image/create-domain.sh", "diffHunk": "@@ -171,8 +175,13 @@ function getDockerSample {\n \n #\n # Function to build docker image and create WebLogic domain home\n-#\n+# Image build is skipped when -s option is specified OR image is not available\n+# e.g. If -s option is specified script will skip the image build only when \n+# image is available else build the image\n+# If -s option is NOT specified script will ALWYAS build the image", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjQwMDkwOnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNTowMzozMlrOF60lLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwNDoyMzozNlrOF7LuZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIyMzIxMg==", "bodyText": "should check this actually worked by trying to get the crd again", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397223212", "createdAt": "2020-03-24T15:03:32Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -89,145 +104,33 @@ public void cleanupOperatorAndDomain() throws Exception {\n         operator.destroy();\n       }\n       TestUtils.exec(\"rm -rf \" + Paths.get(opUpgradeTmpDir).toString());\n+      TestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUyNTEwMQ==", "bodyText": "This is the cleanup section, when we delete the CRD from default NameSpace after the test is completed, so that it will not interfere with other test", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397525101", "createdAt": "2020-03-24T23:35:24Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -89,145 +104,33 @@ public void cleanupOperatorAndDomain() throws Exception {\n         operator.destroy();\n       }\n       TestUtils.exec(\"rm -rf \" + Paths.get(opUpgradeTmpDir).toString());\n+      TestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIyMzIxMg=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MTQzMA==", "bodyText": "CRD's are not namespaced, they are at the cluster scope.  So deleting a CRD by definition would almost certainly interfere with other tests.\nThe original question stands though - you are no checking that it was deleted.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397561430", "createdAt": "2020-03-25T01:38:09Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -89,145 +104,33 @@ public void cleanupOperatorAndDomain() throws Exception {\n         operator.destroy();\n       }\n       TestUtils.exec(\"rm -rf \" + Paths.get(opUpgradeTmpDir).toString());\n+      TestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIyMzIxMg=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYwMjQwNg==", "bodyText": "Upgrade test will not be running in parallel with other Tests, so deleting a CRD will not affect any other tests.  I have added an Assertion to make sure CRD is deleted completely form K8s.\nTestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");\n// Make sure domain CRD is deleted form k8s\nExecResult result = TestUtils.exec(\"kubectl get crd domains.weblogic.oracle\");\nAssertions.assertEquals(1, result.exitValue());", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397602406", "createdAt": "2020-03-25T04:23:36Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -89,145 +104,33 @@ public void cleanupOperatorAndDomain() throws Exception {\n         operator.destroy();\n       }\n       TestUtils.exec(\"rm -rf \" + Paths.get(opUpgradeTmpDir).toString());\n+      TestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIyMzIxMg=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2MjQwMzg3OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNTowNDowOFrOF60nAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNTowNDowOFrOF60nAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIyMzY4Mw==", "bodyText": "there is not restart param in the method signature", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397223683", "createdAt": "2020-03-24T15:04:08Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 200}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NDQ5NDc1OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMTozNDoyMFrOF7JKLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMjo1NjowMFrOF7KdiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MDM2Nw==", "bodyText": "RuntimeException again?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397560367", "createdAt": "2020-03-25T01:34:20Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n         \"Checking for the domain apiVersion \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < 120; i++) {\n       ExecResult exec =\n           TestUtils.exec(\n               \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n       if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+        int ttime = 10 * (i - 1); \n+        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected API Version after [\" + ttime + \"] Seconds\");\n+        result = true;\n+        break;\n+      }\n+      Thread.sleep(1000 * 10);\n+    }\n+    if (!result) {\n+      throw new RuntimeException(\"FAILURE: Didn't get the expected API Version\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 251}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU4MTcwNA==", "bodyText": "$ grep RuntimeException  ItOperatorUpgrade.java\n$\nMay be something wring with Review board", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397581704", "createdAt": "2020-03-25T02:56:00Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n         \"Checking for the domain apiVersion \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < 120; i++) {\n       ExecResult exec =\n           TestUtils.exec(\n               \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n       if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+        int ttime = 10 * (i - 1); \n+        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected API Version after [\" + ttime + \"] Seconds\");\n+        result = true;\n+        break;\n+      }\n+      Thread.sleep(1000 * 10);\n+    }\n+    if (!result) {\n+      throw new RuntimeException(\"FAILURE: Didn't get the expected API Version\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MDM2Nw=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 251}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NDQ5NTk1OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMTozNToxMlrOF7JK8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwNDozNjo0M1rOF7L5Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MDU2Mw==", "bodyText": "i could be wrong, but i think a Thread.sleep() needs to be in a try { .. } catch (InterruptedException) {} \n@rjeberhard ?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397560563", "createdAt": "2020-03-25T01:35:12Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n         \"Checking for the domain apiVersion \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < 120; i++) {\n       ExecResult exec =\n           TestUtils.exec(\n               \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n       if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+        int ttime = 10 * (i - 1); \n+        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected API Version after [\" + ttime + \"] Seconds\");\n+        result = true;\n+        break;\n+      }\n+      Thread.sleep(1000 * 10);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 248}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYwNTE5MA==", "bodyText": "Added InterruptedException to the Thread.sleep\ntry {\nThread.sleep(BaseTest.getWaitTimePod() * 1000);\n} catch (InterruptedException e) {\nSystem.out.println(\"Got InterruptedException \" + e);\n}", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397605190", "createdAt": "2020-03-25T04:36:43Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -238,41 +141,74 @@ public void testOperatorUpgradeFrom2_3_0() throws Exception {\n    * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkDomainNotRestarted();\n+    checkCrdVersion();\n+    // checkDomainApiVersion(); Not Needed \n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks Expected/Upgraded ApiVersion of the Domain Object in a loop. \n+   * In Jenkins it takes nearly 8 minutes to show the updated value \n+   * \n+   * The .apiVersion of the domain will not be updated until the domain is \n+   * written again (e.g. by the operator when updating status)\n+   * This contributes to long time period. We can skip this check \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkDomainApiVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n         \"Checking for the domain apiVersion \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < 120; i++) {\n       ExecResult exec =\n           TestUtils.exec(\n               \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n       if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+        int ttime = 10 * (i - 1); \n+        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected API Version after [\" + ttime + \"] Seconds\");\n+        result = true;\n+        break;\n+      }\n+      Thread.sleep(1000 * 10);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MDU2Mw=="}, "originalCommit": {"oid": "89f9470e812ac564a0208f837bfc153e6ab53657"}, "originalPosition": 248}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NDUwMzE5OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMTozODo0NlrOF7JO5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMzoxMTozN1rOF7KtTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MTU3Mg==", "bodyText": "log? not sop?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397561572", "createdAt": "2020-03-25T01:38:46Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -89,190 +106,82 @@ public void cleanupOperatorAndDomain() throws Exception {\n         operator.destroy();\n       }\n       TestUtils.exec(\"rm -rf \" + Paths.get(opUpgradeTmpDir).toString());\n+      TestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");\n       //ExecResult result = cleanup();\n       LoggerHelper.getLocal().log(Level.INFO, \"+++++++++++++++Done AfterTest cleanup+++++++++++++++++++++\");\n     }\n   }\n \n   /**\n-   * Test for upgrading Operator from release 2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator20\";\n-    OP_DEP_NAME = \"operator-upgrade20\";\n-    OP_SA = \"operator-sa20\";\n-    DOM_NS = \"weblogic-domain20\";\n-    DUID = \"operatordomain20\";\n-    setupOperatorAndDomain(\"2.0\", \"2.0\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.0.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator201\";\n-    OP_DEP_NAME = \"operator-upgrade201\";\n-    OP_SA = \"operator-sa201\";\n-    DOM_NS = \"weblogic-domain201\";\n-    DUID = \"operatordomain201\";\n-    setupOperatorAndDomain(\"release/2.0.1\", \"2.0.1\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator21\";\n-    OP_DEP_NAME = \"operator-upgrade21\";\n-    OP_SA = \"operator-sa21\";\n-    DOM_NS = \"weblogic-domain21\";\n-    DUID = \"operatordomain21\";\n-    setupOperatorAndDomain(\"release/2.1\", \"2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator220\";\n-    OP_DEP_NAME = \"operator-upgrade220\";\n-    OP_SA = \"operator-sa220\";\n-    DOM_NS = \"weblogic-domain220\";\n-    DUID = \"operatordomain220\";\n-    setupOperatorAndDomain(\"release/2.2\", \"2.2.0\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator221\";\n-    OP_DEP_NAME = \"operator-upgrade221\";\n-    OP_SA = \"operator-sa221\";\n-    DOM_NS = \"weblogic-domain221\";\n-    DUID = \"operatordomain221\";\n-    setupOperatorAndDomain(\"release/2.2.1\", \"2.2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.3.0 to develop branch.\n+   * Test for upgrading Operator from release 2.5.0 to develop branch.\n    *\n    * @throws Exception when upgrade fails\n    */\n   @Test\n-  public void testOperatorUpgradeFrom2_3_0() throws Exception {\n+  public void testOperatorUpgradeFrom2_5_0() throws Exception {\n     Assumptions.assumeTrue(QUICKTEST);\n     testCompletedSuccessfully = false;\n     String testMethod = new Object() {\n     }.getClass().getEnclosingMethod().getName();\n     logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator230\";\n-    OP_DEP_NAME = \"operator-upgrade230\";\n-    OP_SA = \"operator-sa230\";\n-    DOM_NS = \"weblogic-domain230\";\n-    DUID = \"operatordomain230\";\n-    setupOperatorAndDomain(\"release/2.3.0\", \"2.3.0\");\n-    upgradeOperator(false);\n+    OP_NS = \"weblogic-operator250\";\n+    DOM_NS = \"weblogic-domain250\";\n+    namespaceList.append(OP_NS);\n+    namespaceList.append(\" \").append(DOM_NS);\n+    OP_DEP_NAME = \"operator-upgrade250\";\n+    OP_SA = \"operator-sa250\";\n+    DUID = \"operatordomain250\";\n+    setupOperatorAndDomain(\"release/2.5.0\", \"2.5.0\");\n+\n+    M1_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");\n+    M2_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server2\");\n+    ADMIN_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-admin-server\");\n+    upgradeOperator();\n     testCompletedSuccessfully = true;\n     LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n   }\n \n   /**\n    * Upgrades operator to develop branch by using the helm upgrade.\n    *\n-   * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkCrdVersion();\n+    System.out.println(\"Before Upgrade M1CTS[\" + M1_CTS + \"]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 236}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MzA3MQ==", "bodyText": "same comment as below - what does M1CTS mean to the person who has to read this log message?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397563071", "createdAt": "2020-03-25T01:44:54Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -89,190 +106,82 @@ public void cleanupOperatorAndDomain() throws Exception {\n         operator.destroy();\n       }\n       TestUtils.exec(\"rm -rf \" + Paths.get(opUpgradeTmpDir).toString());\n+      TestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");\n       //ExecResult result = cleanup();\n       LoggerHelper.getLocal().log(Level.INFO, \"+++++++++++++++Done AfterTest cleanup+++++++++++++++++++++\");\n     }\n   }\n \n   /**\n-   * Test for upgrading Operator from release 2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator20\";\n-    OP_DEP_NAME = \"operator-upgrade20\";\n-    OP_SA = \"operator-sa20\";\n-    DOM_NS = \"weblogic-domain20\";\n-    DUID = \"operatordomain20\";\n-    setupOperatorAndDomain(\"2.0\", \"2.0\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.0.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator201\";\n-    OP_DEP_NAME = \"operator-upgrade201\";\n-    OP_SA = \"operator-sa201\";\n-    DOM_NS = \"weblogic-domain201\";\n-    DUID = \"operatordomain201\";\n-    setupOperatorAndDomain(\"release/2.0.1\", \"2.0.1\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator21\";\n-    OP_DEP_NAME = \"operator-upgrade21\";\n-    OP_SA = \"operator-sa21\";\n-    DOM_NS = \"weblogic-domain21\";\n-    DUID = \"operatordomain21\";\n-    setupOperatorAndDomain(\"release/2.1\", \"2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator220\";\n-    OP_DEP_NAME = \"operator-upgrade220\";\n-    OP_SA = \"operator-sa220\";\n-    DOM_NS = \"weblogic-domain220\";\n-    DUID = \"operatordomain220\";\n-    setupOperatorAndDomain(\"release/2.2\", \"2.2.0\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator221\";\n-    OP_DEP_NAME = \"operator-upgrade221\";\n-    OP_SA = \"operator-sa221\";\n-    DOM_NS = \"weblogic-domain221\";\n-    DUID = \"operatordomain221\";\n-    setupOperatorAndDomain(\"release/2.2.1\", \"2.2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.3.0 to develop branch.\n+   * Test for upgrading Operator from release 2.5.0 to develop branch.\n    *\n    * @throws Exception when upgrade fails\n    */\n   @Test\n-  public void testOperatorUpgradeFrom2_3_0() throws Exception {\n+  public void testOperatorUpgradeFrom2_5_0() throws Exception {\n     Assumptions.assumeTrue(QUICKTEST);\n     testCompletedSuccessfully = false;\n     String testMethod = new Object() {\n     }.getClass().getEnclosingMethod().getName();\n     logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator230\";\n-    OP_DEP_NAME = \"operator-upgrade230\";\n-    OP_SA = \"operator-sa230\";\n-    DOM_NS = \"weblogic-domain230\";\n-    DUID = \"operatordomain230\";\n-    setupOperatorAndDomain(\"release/2.3.0\", \"2.3.0\");\n-    upgradeOperator(false);\n+    OP_NS = \"weblogic-operator250\";\n+    DOM_NS = \"weblogic-domain250\";\n+    namespaceList.append(OP_NS);\n+    namespaceList.append(\" \").append(DOM_NS);\n+    OP_DEP_NAME = \"operator-upgrade250\";\n+    OP_SA = \"operator-sa250\";\n+    DUID = \"operatordomain250\";\n+    setupOperatorAndDomain(\"release/2.5.0\", \"2.5.0\");\n+\n+    M1_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");\n+    M2_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server2\");\n+    ADMIN_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-admin-server\");\n+    upgradeOperator();\n     testCompletedSuccessfully = true;\n     LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n   }\n \n   /**\n    * Upgrades operator to develop branch by using the helm upgrade.\n    *\n-   * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkCrdVersion();\n+    System.out.println(\"Before Upgrade M1CTS[\" + M1_CTS + \"]\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MTU3Mg=="}, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 236}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU4NTc0Mw==", "bodyText": "Move the information to testOperatorUpgradeFrom2_5_0() with detail info\n// Save the CreateTimeStamp for the server pod(s) to compare with CreateTimeStamp after upgrade to make sure the pod(s) are not re-stated\nManaged1_CreateTimeStamp = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");\nManaged2_CreateTimeStamp = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server2\");\nAdmin_CreateTimeStamp = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-admin-server\");\nSystem.out.println(\"Before Upgrade CreateTimeStamp for managed-server1 pod [\" + Managed1_CreateTimeStamp + \"]\");\nSystem.out.println(\"Before Upgrade CreateTimeStamp for managed-server2 pod [\" + Managed2_CreateTimeStamp + \"]\");\nSystem.out.println(\"Before Upgrade CreateTimeStamp for admin-server pod [\" + Admin_CreateTimeStamp + \"]\");", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397585743", "createdAt": "2020-03-25T03:11:37Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -89,190 +106,82 @@ public void cleanupOperatorAndDomain() throws Exception {\n         operator.destroy();\n       }\n       TestUtils.exec(\"rm -rf \" + Paths.get(opUpgradeTmpDir).toString());\n+      TestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");\n       //ExecResult result = cleanup();\n       LoggerHelper.getLocal().log(Level.INFO, \"+++++++++++++++Done AfterTest cleanup+++++++++++++++++++++\");\n     }\n   }\n \n   /**\n-   * Test for upgrading Operator from release 2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator20\";\n-    OP_DEP_NAME = \"operator-upgrade20\";\n-    OP_SA = \"operator-sa20\";\n-    DOM_NS = \"weblogic-domain20\";\n-    DUID = \"operatordomain20\";\n-    setupOperatorAndDomain(\"2.0\", \"2.0\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.0.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator201\";\n-    OP_DEP_NAME = \"operator-upgrade201\";\n-    OP_SA = \"operator-sa201\";\n-    DOM_NS = \"weblogic-domain201\";\n-    DUID = \"operatordomain201\";\n-    setupOperatorAndDomain(\"release/2.0.1\", \"2.0.1\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator21\";\n-    OP_DEP_NAME = \"operator-upgrade21\";\n-    OP_SA = \"operator-sa21\";\n-    DOM_NS = \"weblogic-domain21\";\n-    DUID = \"operatordomain21\";\n-    setupOperatorAndDomain(\"release/2.1\", \"2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator220\";\n-    OP_DEP_NAME = \"operator-upgrade220\";\n-    OP_SA = \"operator-sa220\";\n-    DOM_NS = \"weblogic-domain220\";\n-    DUID = \"operatordomain220\";\n-    setupOperatorAndDomain(\"release/2.2\", \"2.2.0\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator221\";\n-    OP_DEP_NAME = \"operator-upgrade221\";\n-    OP_SA = \"operator-sa221\";\n-    DOM_NS = \"weblogic-domain221\";\n-    DUID = \"operatordomain221\";\n-    setupOperatorAndDomain(\"release/2.2.1\", \"2.2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.3.0 to develop branch.\n+   * Test for upgrading Operator from release 2.5.0 to develop branch.\n    *\n    * @throws Exception when upgrade fails\n    */\n   @Test\n-  public void testOperatorUpgradeFrom2_3_0() throws Exception {\n+  public void testOperatorUpgradeFrom2_5_0() throws Exception {\n     Assumptions.assumeTrue(QUICKTEST);\n     testCompletedSuccessfully = false;\n     String testMethod = new Object() {\n     }.getClass().getEnclosingMethod().getName();\n     logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator230\";\n-    OP_DEP_NAME = \"operator-upgrade230\";\n-    OP_SA = \"operator-sa230\";\n-    DOM_NS = \"weblogic-domain230\";\n-    DUID = \"operatordomain230\";\n-    setupOperatorAndDomain(\"release/2.3.0\", \"2.3.0\");\n-    upgradeOperator(false);\n+    OP_NS = \"weblogic-operator250\";\n+    DOM_NS = \"weblogic-domain250\";\n+    namespaceList.append(OP_NS);\n+    namespaceList.append(\" \").append(DOM_NS);\n+    OP_DEP_NAME = \"operator-upgrade250\";\n+    OP_SA = \"operator-sa250\";\n+    DUID = \"operatordomain250\";\n+    setupOperatorAndDomain(\"release/2.5.0\", \"2.5.0\");\n+\n+    M1_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");\n+    M2_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server2\");\n+    ADMIN_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-admin-server\");\n+    upgradeOperator();\n     testCompletedSuccessfully = true;\n     LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n   }\n \n   /**\n    * Upgrades operator to develop branch by using the helm upgrade.\n    *\n-   * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkCrdVersion();\n+    System.out.println(\"Before Upgrade M1CTS[\" + M1_CTS + \"]\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MTU3Mg=="}, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 236}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NDUwNDk2OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMTozOTo0NlrOF7JP6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwNDo0Nzo0OVrOF7MCPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MTgzMw==", "bodyText": "enclose in try? @rjeberhard ?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397561833", "createdAt": "2020-03-25T01:39:46Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -89,190 +106,82 @@ public void cleanupOperatorAndDomain() throws Exception {\n         operator.destroy();\n       }\n       TestUtils.exec(\"rm -rf \" + Paths.get(opUpgradeTmpDir).toString());\n+      TestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");\n       //ExecResult result = cleanup();\n       LoggerHelper.getLocal().log(Level.INFO, \"+++++++++++++++Done AfterTest cleanup+++++++++++++++++++++\");\n     }\n   }\n \n   /**\n-   * Test for upgrading Operator from release 2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator20\";\n-    OP_DEP_NAME = \"operator-upgrade20\";\n-    OP_SA = \"operator-sa20\";\n-    DOM_NS = \"weblogic-domain20\";\n-    DUID = \"operatordomain20\";\n-    setupOperatorAndDomain(\"2.0\", \"2.0\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.0.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator201\";\n-    OP_DEP_NAME = \"operator-upgrade201\";\n-    OP_SA = \"operator-sa201\";\n-    DOM_NS = \"weblogic-domain201\";\n-    DUID = \"operatordomain201\";\n-    setupOperatorAndDomain(\"release/2.0.1\", \"2.0.1\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator21\";\n-    OP_DEP_NAME = \"operator-upgrade21\";\n-    OP_SA = \"operator-sa21\";\n-    DOM_NS = \"weblogic-domain21\";\n-    DUID = \"operatordomain21\";\n-    setupOperatorAndDomain(\"release/2.1\", \"2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator220\";\n-    OP_DEP_NAME = \"operator-upgrade220\";\n-    OP_SA = \"operator-sa220\";\n-    DOM_NS = \"weblogic-domain220\";\n-    DUID = \"operatordomain220\";\n-    setupOperatorAndDomain(\"release/2.2\", \"2.2.0\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator221\";\n-    OP_DEP_NAME = \"operator-upgrade221\";\n-    OP_SA = \"operator-sa221\";\n-    DOM_NS = \"weblogic-domain221\";\n-    DUID = \"operatordomain221\";\n-    setupOperatorAndDomain(\"release/2.2.1\", \"2.2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.3.0 to develop branch.\n+   * Test for upgrading Operator from release 2.5.0 to develop branch.\n    *\n    * @throws Exception when upgrade fails\n    */\n   @Test\n-  public void testOperatorUpgradeFrom2_3_0() throws Exception {\n+  public void testOperatorUpgradeFrom2_5_0() throws Exception {\n     Assumptions.assumeTrue(QUICKTEST);\n     testCompletedSuccessfully = false;\n     String testMethod = new Object() {\n     }.getClass().getEnclosingMethod().getName();\n     logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator230\";\n-    OP_DEP_NAME = \"operator-upgrade230\";\n-    OP_SA = \"operator-sa230\";\n-    DOM_NS = \"weblogic-domain230\";\n-    DUID = \"operatordomain230\";\n-    setupOperatorAndDomain(\"release/2.3.0\", \"2.3.0\");\n-    upgradeOperator(false);\n+    OP_NS = \"weblogic-operator250\";\n+    DOM_NS = \"weblogic-domain250\";\n+    namespaceList.append(OP_NS);\n+    namespaceList.append(\" \").append(DOM_NS);\n+    OP_DEP_NAME = \"operator-upgrade250\";\n+    OP_SA = \"operator-sa250\";\n+    DUID = \"operatordomain250\";\n+    setupOperatorAndDomain(\"release/2.5.0\", \"2.5.0\");\n+\n+    M1_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");\n+    M2_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server2\");\n+    ADMIN_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-admin-server\");\n+    upgradeOperator();\n     testCompletedSuccessfully = true;\n     LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n   }\n \n   /**\n    * Upgrades operator to develop branch by using the helm upgrade.\n    *\n-   * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkCrdVersion();\n+    System.out.println(\"Before Upgrade M1CTS[\" + M1_CTS + \"]\");\n+    System.out.println(\"Before Upgrade M2CTS[\" + M2_CTS + \"]\");\n+    System.out.println(\"Before Upgrade ADMINCTS[\" + ADMIN_CTS + \"]\");\n+    checkDomainNotRestarted();\n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks the expected Upgraded Version of CustomResourceDefintion (CRD) \n+   * in default NameSpace in a loop. \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkCrdVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n-        \"Checking for the domain apiVersion \"\n+        \"Checking for the CRD Version \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < BaseTest.getMaxIterationsPod(); i++) {\n       ExecResult exec =\n           TestUtils.exec(\n-              \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n-      if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+              \"kubectl get crd domains.weblogic.oracle -o jsonpath='{.spec.versions[?(@.storage==true)].name}'\", true);\n+      if (exec.stdout().contains(getCrdVersion())) {\n+        LoggerHelper.getLocal().log(Level.INFO, \"Got expected CRD Version\");\n         result = true;\n         break;\n       }\n-      Thread.sleep(1000 * 10);\n+      Thread.sleep(BaseTest.getWaitTimePod() * 1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 274}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYwNzQ4NA==", "bodyText": "Added InterruptedException", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397607484", "createdAt": "2020-03-25T04:47:49Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -89,190 +106,82 @@ public void cleanupOperatorAndDomain() throws Exception {\n         operator.destroy();\n       }\n       TestUtils.exec(\"rm -rf \" + Paths.get(opUpgradeTmpDir).toString());\n+      TestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");\n       //ExecResult result = cleanup();\n       LoggerHelper.getLocal().log(Level.INFO, \"+++++++++++++++Done AfterTest cleanup+++++++++++++++++++++\");\n     }\n   }\n \n   /**\n-   * Test for upgrading Operator from release 2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator20\";\n-    OP_DEP_NAME = \"operator-upgrade20\";\n-    OP_SA = \"operator-sa20\";\n-    DOM_NS = \"weblogic-domain20\";\n-    DUID = \"operatordomain20\";\n-    setupOperatorAndDomain(\"2.0\", \"2.0\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.0.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator201\";\n-    OP_DEP_NAME = \"operator-upgrade201\";\n-    OP_SA = \"operator-sa201\";\n-    DOM_NS = \"weblogic-domain201\";\n-    DUID = \"operatordomain201\";\n-    setupOperatorAndDomain(\"release/2.0.1\", \"2.0.1\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator21\";\n-    OP_DEP_NAME = \"operator-upgrade21\";\n-    OP_SA = \"operator-sa21\";\n-    DOM_NS = \"weblogic-domain21\";\n-    DUID = \"operatordomain21\";\n-    setupOperatorAndDomain(\"release/2.1\", \"2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator220\";\n-    OP_DEP_NAME = \"operator-upgrade220\";\n-    OP_SA = \"operator-sa220\";\n-    DOM_NS = \"weblogic-domain220\";\n-    DUID = \"operatordomain220\";\n-    setupOperatorAndDomain(\"release/2.2\", \"2.2.0\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator221\";\n-    OP_DEP_NAME = \"operator-upgrade221\";\n-    OP_SA = \"operator-sa221\";\n-    DOM_NS = \"weblogic-domain221\";\n-    DUID = \"operatordomain221\";\n-    setupOperatorAndDomain(\"release/2.2.1\", \"2.2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.3.0 to develop branch.\n+   * Test for upgrading Operator from release 2.5.0 to develop branch.\n    *\n    * @throws Exception when upgrade fails\n    */\n   @Test\n-  public void testOperatorUpgradeFrom2_3_0() throws Exception {\n+  public void testOperatorUpgradeFrom2_5_0() throws Exception {\n     Assumptions.assumeTrue(QUICKTEST);\n     testCompletedSuccessfully = false;\n     String testMethod = new Object() {\n     }.getClass().getEnclosingMethod().getName();\n     logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator230\";\n-    OP_DEP_NAME = \"operator-upgrade230\";\n-    OP_SA = \"operator-sa230\";\n-    DOM_NS = \"weblogic-domain230\";\n-    DUID = \"operatordomain230\";\n-    setupOperatorAndDomain(\"release/2.3.0\", \"2.3.0\");\n-    upgradeOperator(false);\n+    OP_NS = \"weblogic-operator250\";\n+    DOM_NS = \"weblogic-domain250\";\n+    namespaceList.append(OP_NS);\n+    namespaceList.append(\" \").append(DOM_NS);\n+    OP_DEP_NAME = \"operator-upgrade250\";\n+    OP_SA = \"operator-sa250\";\n+    DUID = \"operatordomain250\";\n+    setupOperatorAndDomain(\"release/2.5.0\", \"2.5.0\");\n+\n+    M1_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");\n+    M2_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server2\");\n+    ADMIN_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-admin-server\");\n+    upgradeOperator();\n     testCompletedSuccessfully = true;\n     LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n   }\n \n   /**\n    * Upgrades operator to develop branch by using the helm upgrade.\n    *\n-   * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkCrdVersion();\n+    System.out.println(\"Before Upgrade M1CTS[\" + M1_CTS + \"]\");\n+    System.out.println(\"Before Upgrade M2CTS[\" + M2_CTS + \"]\");\n+    System.out.println(\"Before Upgrade ADMINCTS[\" + ADMIN_CTS + \"]\");\n+    checkDomainNotRestarted();\n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks the expected Upgraded Version of CustomResourceDefintion (CRD) \n+   * in default NameSpace in a loop. \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkCrdVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n-        \"Checking for the domain apiVersion \"\n+        \"Checking for the CRD Version \"\n             + getDomainApiVersion()\n             + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+    for (int i = 0; i < BaseTest.getMaxIterationsPod(); i++) {\n       ExecResult exec =\n           TestUtils.exec(\n-              \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n-      if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+              \"kubectl get crd domains.weblogic.oracle -o jsonpath='{.spec.versions[?(@.storage==true)].name}'\", true);\n+      if (exec.stdout().contains(getCrdVersion())) {\n+        LoggerHelper.getLocal().log(Level.INFO, \"Got expected CRD Version\");\n         result = true;\n         break;\n       }\n-      Thread.sleep(1000 * 10);\n+      Thread.sleep(BaseTest.getWaitTimePod() * 1000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MTgzMw=="}, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 274}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NDUwNjAyOnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMTo0MDozM1rOF7JQiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMzowNzoxNFrOF7KpBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MTk5NQ==", "bodyText": "log not sop?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397561995", "createdAt": "2020-03-25T01:40:33Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +202,29 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING \n+   * not restarted due to Operator Upgrade by comparing the creationTimestamp\n+   * before and after upgrade\n+   *\n+   * @throws Exception If restarted\n+   */\n+  private void checkDomainNotRestarted() throws Exception {\n+    TestUtils.checkPodReady(DUID + \"-\" + domain.getAdminServerName(), DOM_NS);\n+    for (int i = 2; i >= 1; i--) {\n+     TestUtils.checkPodReady(DUID + \"-managed-server\" + i, DOM_NS);\n+    }\n+    String m1 = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");\n+    String m2 = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server2\");\n+    String admin = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-admin-server\");\n+    System.out.println(\"After Upgrade M1CTS[\" + m1 + \"]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 301}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2Mjg4Mg==", "bodyText": "what's an M1CTS?  think of the person reading this log message, who is probably not you. how do they know what this means?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397562882", "createdAt": "2020-03-25T01:44:08Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +202,29 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING \n+   * not restarted due to Operator Upgrade by comparing the creationTimestamp\n+   * before and after upgrade\n+   *\n+   * @throws Exception If restarted\n+   */\n+  private void checkDomainNotRestarted() throws Exception {\n+    TestUtils.checkPodReady(DUID + \"-\" + domain.getAdminServerName(), DOM_NS);\n+    for (int i = 2; i >= 1; i--) {\n+     TestUtils.checkPodReady(DUID + \"-managed-server\" + i, DOM_NS);\n+    }\n+    String m1 = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");\n+    String m2 = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server2\");\n+    String admin = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-admin-server\");\n+    System.out.println(\"After Upgrade M1CTS[\" + m1 + \"]\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MTk5NQ=="}, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 301}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU4NDY0NQ==", "bodyText": "Modified the Log Message as follows ...\nprintln(\"After Upgrade CreateTimeStamp for managed-server1 pod [\" + m1 + \"]\");\nprintln (\"After Upgrade CreateTimeStamp for managed-server2 pod [\" + m2 + \"]\");\nprintln(\"After Upgrade CreateTimeStamp for admin-server pod [\" + admin + \"]\");", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397584645", "createdAt": "2020-03-25T03:07:14Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,6 +202,29 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING \n+   * not restarted due to Operator Upgrade by comparing the creationTimestamp\n+   * before and after upgrade\n+   *\n+   * @throws Exception If restarted\n+   */\n+  private void checkDomainNotRestarted() throws Exception {\n+    TestUtils.checkPodReady(DUID + \"-\" + domain.getAdminServerName(), DOM_NS);\n+    for (int i = 2; i >= 1; i--) {\n+     TestUtils.checkPodReady(DUID + \"-managed-server\" + i, DOM_NS);\n+    }\n+    String m1 = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");\n+    String m2 = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server2\");\n+    String admin = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-admin-server\");\n+    System.out.println(\"After Upgrade M1CTS[\" + m1 + \"]\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MTk5NQ=="}, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 301}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NDUwNzI3OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/TestUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMTo0MToyMVrOF7JRRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNToyMDo0N1rOF7gT3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MjE4MA==", "bodyText": "missing javadoc", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397562180", "createdAt": "2020-03-25T01:41:21Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/TestUtils.java", "diffHunk": "@@ -1980,4 +1980,36 @@ public static ExecResult kubectlpatch(String domainUid, String domainNS, String\n     return exec(cmd, true);\n   }\n \n+  /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzOTY3OQ==", "bodyText": "its still missing.....", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397939679", "createdAt": "2020-03-25T15:20:47Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/TestUtils.java", "diffHunk": "@@ -1980,4 +1980,36 @@ public static ExecResult kubectlpatch(String domainUid, String domainNS, String\n     return exec(cmd, true);\n   }\n \n+  /**", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MjE4MA=="}, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NDUwNzg2OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/TestUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMTo0MTozOVrOF7JRjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMzoxNToxMFrOF7KwqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MjI1NA==", "bodyText": "log not sop", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397562254", "createdAt": "2020-03-25T01:41:39Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/TestUtils.java", "diffHunk": "@@ -1980,4 +1980,36 @@ public static ExecResult kubectlpatch(String domainUid, String domainNS, String\n     return exec(cmd, true);\n   }\n \n+  /**\n+   * @param namesapce\n+   * @param pod name\n+   * @return creationTimestamp of the Pod \n+   * @throws Exception on failure\n+   */\n+  public static String getCreationTimeStamp(String namespace, String pod) throws Exception {\n+    String kcmd = \"kubectl get pod \"\n+              + pod \n+              + \" --namespace \"\n+              + namespace\n+              + \" -o jsonpath='{.metadata.creationTimestamp}'\";\n+    System.out.println(\"KUBECTL CMD \" + kcmd);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU4NjYwMA==", "bodyText": "Removed the Debug print statement.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397586600", "createdAt": "2020-03-25T03:15:10Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/TestUtils.java", "diffHunk": "@@ -1980,4 +1980,36 @@ public static ExecResult kubectlpatch(String domainUid, String domainNS, String\n     return exec(cmd, true);\n   }\n \n+  /**\n+   * @param namesapce\n+   * @param pod name\n+   * @return creationTimestamp of the Pod \n+   * @throws Exception on failure\n+   */\n+  public static String getCreationTimeStamp(String namespace, String pod) throws Exception {\n+    String kcmd = \"kubectl get pod \"\n+              + pod \n+              + \" --namespace \"\n+              + namespace\n+              + \" -o jsonpath='{.metadata.creationTimestamp}'\";\n+    System.out.println(\"KUBECTL CMD \" + kcmd);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MjI1NA=="}, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NDUwODQyOnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/TestUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMTo0MTo1NVrOF7JR1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMzoxOToyMVrOF7K1QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MjMyNg==", "bodyText": "missing javadoc.\ntypo in param name", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397562326", "createdAt": "2020-03-25T01:41:55Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/TestUtils.java", "diffHunk": "@@ -1980,4 +1980,36 @@ public static ExecResult kubectlpatch(String domainUid, String domainNS, String\n     return exec(cmd, true);\n   }\n \n+  /**\n+   * @param namesapce\n+   * @param pod name\n+   * @return creationTimestamp of the Pod \n+   * @throws Exception on failure\n+   */\n+  public static String getCreationTimeStamp(String namespace, String pod) throws Exception {\n+    String kcmd = \"kubectl get pod \"\n+              + pod \n+              + \" --namespace \"\n+              + namespace\n+              + \" -o jsonpath='{.metadata.creationTimestamp}'\";\n+    System.out.println(\"KUBECTL CMD \" + kcmd);\n+    ExecResult result = ExecCommand.exec(kcmd);\n+    return result.stdout().trim();\n+  }\n+\n+  /**\n+   * @param namesapce", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU4Nzc3Nw==", "bodyText": "fixed the typo", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397587777", "createdAt": "2020-03-25T03:19:21Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/TestUtils.java", "diffHunk": "@@ -1980,4 +1980,36 @@ public static ExecResult kubectlpatch(String domainUid, String domainNS, String\n     return exec(cmd, true);\n   }\n \n+  /**\n+   * @param namesapce\n+   * @param pod name\n+   * @return creationTimestamp of the Pod \n+   * @throws Exception on failure\n+   */\n+  public static String getCreationTimeStamp(String namespace, String pod) throws Exception {\n+    String kcmd = \"kubectl get pod \"\n+              + pod \n+              + \" --namespace \"\n+              + namespace\n+              + \" -o jsonpath='{.metadata.creationTimestamp}'\";\n+    System.out.println(\"KUBECTL CMD \" + kcmd);\n+    ExecResult result = ExecCommand.exec(kcmd);\n+    return result.stdout().trim();\n+  }\n+\n+  /**\n+   * @param namesapce", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MjMyNg=="}, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NDUxNDQ0OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMTo0NTozM1rOF7JVUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMzoxNDoxMFrOF7Kvyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MzIxNw==", "bodyText": "its kinda weird to get these here, and then print them in the upgradeOperator() method", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397563217", "createdAt": "2020-03-25T01:45:33Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -89,190 +106,82 @@ public void cleanupOperatorAndDomain() throws Exception {\n         operator.destroy();\n       }\n       TestUtils.exec(\"rm -rf \" + Paths.get(opUpgradeTmpDir).toString());\n+      TestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");\n       //ExecResult result = cleanup();\n       LoggerHelper.getLocal().log(Level.INFO, \"+++++++++++++++Done AfterTest cleanup+++++++++++++++++++++\");\n     }\n   }\n \n   /**\n-   * Test for upgrading Operator from release 2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator20\";\n-    OP_DEP_NAME = \"operator-upgrade20\";\n-    OP_SA = \"operator-sa20\";\n-    DOM_NS = \"weblogic-domain20\";\n-    DUID = \"operatordomain20\";\n-    setupOperatorAndDomain(\"2.0\", \"2.0\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.0.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator201\";\n-    OP_DEP_NAME = \"operator-upgrade201\";\n-    OP_SA = \"operator-sa201\";\n-    DOM_NS = \"weblogic-domain201\";\n-    DUID = \"operatordomain201\";\n-    setupOperatorAndDomain(\"release/2.0.1\", \"2.0.1\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator21\";\n-    OP_DEP_NAME = \"operator-upgrade21\";\n-    OP_SA = \"operator-sa21\";\n-    DOM_NS = \"weblogic-domain21\";\n-    DUID = \"operatordomain21\";\n-    setupOperatorAndDomain(\"release/2.1\", \"2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator220\";\n-    OP_DEP_NAME = \"operator-upgrade220\";\n-    OP_SA = \"operator-sa220\";\n-    DOM_NS = \"weblogic-domain220\";\n-    DUID = \"operatordomain220\";\n-    setupOperatorAndDomain(\"release/2.2\", \"2.2.0\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator221\";\n-    OP_DEP_NAME = \"operator-upgrade221\";\n-    OP_SA = \"operator-sa221\";\n-    DOM_NS = \"weblogic-domain221\";\n-    DUID = \"operatordomain221\";\n-    setupOperatorAndDomain(\"release/2.2.1\", \"2.2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.3.0 to develop branch.\n+   * Test for upgrading Operator from release 2.5.0 to develop branch.\n    *\n    * @throws Exception when upgrade fails\n    */\n   @Test\n-  public void testOperatorUpgradeFrom2_3_0() throws Exception {\n+  public void testOperatorUpgradeFrom2_5_0() throws Exception {\n     Assumptions.assumeTrue(QUICKTEST);\n     testCompletedSuccessfully = false;\n     String testMethod = new Object() {\n     }.getClass().getEnclosingMethod().getName();\n     logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator230\";\n-    OP_DEP_NAME = \"operator-upgrade230\";\n-    OP_SA = \"operator-sa230\";\n-    DOM_NS = \"weblogic-domain230\";\n-    DUID = \"operatordomain230\";\n-    setupOperatorAndDomain(\"release/2.3.0\", \"2.3.0\");\n-    upgradeOperator(false);\n+    OP_NS = \"weblogic-operator250\";\n+    DOM_NS = \"weblogic-domain250\";\n+    namespaceList.append(OP_NS);\n+    namespaceList.append(\" \").append(DOM_NS);\n+    OP_DEP_NAME = \"operator-upgrade250\";\n+    OP_SA = \"operator-sa250\";\n+    DUID = \"operatordomain250\";\n+    setupOperatorAndDomain(\"release/2.5.0\", \"2.5.0\");\n+\n+    M1_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 214}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU4NjM3OA==", "bodyText": "Move the CreateTimeStamp Info into @test Method", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397586378", "createdAt": "2020-03-25T03:14:10Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -89,190 +106,82 @@ public void cleanupOperatorAndDomain() throws Exception {\n         operator.destroy();\n       }\n       TestUtils.exec(\"rm -rf \" + Paths.get(opUpgradeTmpDir).toString());\n+      TestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");\n       //ExecResult result = cleanup();\n       LoggerHelper.getLocal().log(Level.INFO, \"+++++++++++++++Done AfterTest cleanup+++++++++++++++++++++\");\n     }\n   }\n \n   /**\n-   * Test for upgrading Operator from release 2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator20\";\n-    OP_DEP_NAME = \"operator-upgrade20\";\n-    OP_SA = \"operator-sa20\";\n-    DOM_NS = \"weblogic-domain20\";\n-    DUID = \"operatordomain20\";\n-    setupOperatorAndDomain(\"2.0\", \"2.0\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.0.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator201\";\n-    OP_DEP_NAME = \"operator-upgrade201\";\n-    OP_SA = \"operator-sa201\";\n-    DOM_NS = \"weblogic-domain201\";\n-    DUID = \"operatordomain201\";\n-    setupOperatorAndDomain(\"release/2.0.1\", \"2.0.1\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator21\";\n-    OP_DEP_NAME = \"operator-upgrade21\";\n-    OP_SA = \"operator-sa21\";\n-    DOM_NS = \"weblogic-domain21\";\n-    DUID = \"operatordomain21\";\n-    setupOperatorAndDomain(\"release/2.1\", \"2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator220\";\n-    OP_DEP_NAME = \"operator-upgrade220\";\n-    OP_SA = \"operator-sa220\";\n-    DOM_NS = \"weblogic-domain220\";\n-    DUID = \"operatordomain220\";\n-    setupOperatorAndDomain(\"release/2.2\", \"2.2.0\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator221\";\n-    OP_DEP_NAME = \"operator-upgrade221\";\n-    OP_SA = \"operator-sa221\";\n-    DOM_NS = \"weblogic-domain221\";\n-    DUID = \"operatordomain221\";\n-    setupOperatorAndDomain(\"release/2.2.1\", \"2.2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.3.0 to develop branch.\n+   * Test for upgrading Operator from release 2.5.0 to develop branch.\n    *\n    * @throws Exception when upgrade fails\n    */\n   @Test\n-  public void testOperatorUpgradeFrom2_3_0() throws Exception {\n+  public void testOperatorUpgradeFrom2_5_0() throws Exception {\n     Assumptions.assumeTrue(QUICKTEST);\n     testCompletedSuccessfully = false;\n     String testMethod = new Object() {\n     }.getClass().getEnclosingMethod().getName();\n     logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator230\";\n-    OP_DEP_NAME = \"operator-upgrade230\";\n-    OP_SA = \"operator-sa230\";\n-    DOM_NS = \"weblogic-domain230\";\n-    DUID = \"operatordomain230\";\n-    setupOperatorAndDomain(\"release/2.3.0\", \"2.3.0\");\n-    upgradeOperator(false);\n+    OP_NS = \"weblogic-operator250\";\n+    DOM_NS = \"weblogic-domain250\";\n+    namespaceList.append(OP_NS);\n+    namespaceList.append(\" \").append(DOM_NS);\n+    OP_DEP_NAME = \"operator-upgrade250\";\n+    OP_SA = \"operator-sa250\";\n+    DUID = \"operatordomain250\";\n+    setupOperatorAndDomain(\"release/2.5.0\", \"2.5.0\");\n+\n+    M1_CTS = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2MzIxNw=="}, "originalCommit": {"oid": "7ef1946602c5913a105db01fcd01b3ac9c5afa30"}, "originalPosition": 214}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NjkxMzg1OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNToyMDoyN1rOF7gS7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMDoxNjoyOVrOF7zD3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzOTQzNw==", "bodyText": "WebLogic spelled wrong", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397939437", "createdAt": "2020-03-25T15:20:27Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,9 +209,31 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING \n+   * not restarted due to Operator Upgrade by comparing the creationTimestamp\n+   * before and after upgrade\n+   *\n+   * @throws Exception If restarted\n+   */\n+  private void checkDomainNotRestarted() throws Exception {\n+    TestUtils.checkPodReady(DUID + \"-\" + domain.getAdminServerName(), DOM_NS);\n+    for (int i = 2; i >= 1; i--) {\n+      TestUtils.checkPodReady(DUID + \"-managed-server\" + i, DOM_NS);\n+    }\n+    String m1 = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");\n+    String m2 = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server2\");\n+    String admin = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-admin-server\");\n+    System.out.println(\"After Upgrade CreateTimeStamp for managed-server1 pod [\" + m1 + \"]\");\n+    System.out.println(\"After Upgrade CreateTimeStamp for managed-server2 pod [\" + m2 + \"]\");\n+    System.out.println(\"After Upgrade CreateTimeStamp for admin-server pod [\" + admin + \"]\");\n+    Assertions.assertEquals(Managed1_CreateTimeStamp, m1);\n+    Assertions.assertEquals(Managed2_CreateTimeStamp, m2);\n+    Assertions.assertEquals(Admin_CreateTimeStamp, admin);\n+  }\n \n   /**\n-   * Creates operator based on operatorRelease passed to it and then creates a WebLogic domain\n+   * Creates operator based on operatorRelease passed to it and then creates a Weblogic domain", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "780f714a8c454f54dab4fa5bd7253201f093bd08"}, "originalPosition": 328}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI0Njg3Ng==", "bodyText": "done", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r398246876", "createdAt": "2020-03-26T00:16:29Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -293,9 +209,31 @@ private void checkDomainRollingRestarted() throws Exception {\n     }\n   }\n \n+  /**\n+   * Check whether the weblogic server instances are still RUNNING \n+   * not restarted due to Operator Upgrade by comparing the creationTimestamp\n+   * before and after upgrade\n+   *\n+   * @throws Exception If restarted\n+   */\n+  private void checkDomainNotRestarted() throws Exception {\n+    TestUtils.checkPodReady(DUID + \"-\" + domain.getAdminServerName(), DOM_NS);\n+    for (int i = 2; i >= 1; i--) {\n+      TestUtils.checkPodReady(DUID + \"-managed-server\" + i, DOM_NS);\n+    }\n+    String m1 = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");\n+    String m2 = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server2\");\n+    String admin = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-admin-server\");\n+    System.out.println(\"After Upgrade CreateTimeStamp for managed-server1 pod [\" + m1 + \"]\");\n+    System.out.println(\"After Upgrade CreateTimeStamp for managed-server2 pod [\" + m2 + \"]\");\n+    System.out.println(\"After Upgrade CreateTimeStamp for admin-server pod [\" + admin + \"]\");\n+    Assertions.assertEquals(Managed1_CreateTimeStamp, m1);\n+    Assertions.assertEquals(Managed2_CreateTimeStamp, m2);\n+    Assertions.assertEquals(Admin_CreateTimeStamp, admin);\n+  }\n \n   /**\n-   * Creates operator based on operatorRelease passed to it and then creates a WebLogic domain\n+   * Creates operator based on operatorRelease passed to it and then creates a Weblogic domain", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzOTQzNw=="}, "originalCommit": {"oid": "780f714a8c454f54dab4fa5bd7253201f093bd08"}, "originalPosition": 328}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2NjkxNjE5OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/TestUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNToyMDo1N1rOF7gUeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMDoxNjoxN1rOF7zDoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzOTgzMg==", "bodyText": "write javadoc", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r397939832", "createdAt": "2020-03-25T15:20:57Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/TestUtils.java", "diffHunk": "@@ -1980,4 +1980,37 @@ public static ExecResult kubectlpatch(String domainUid, String domainNS, String\n     return exec(cmd, true);\n   }\n \n+  /**\n+   * @param namespace\n+   * @param pod \n+   *\n+   * @return creationTimestamp of the Pod \n+   * @throws Exception on failure\n+   */\n+  public static String getCreationTimeStamp(String namespace, String pod) throws Exception {\n+    String kcmd = \"kubectl get pod \"\n+              + pod \n+              + \" --namespace \"\n+              + namespace\n+              + \" -o jsonpath='{.metadata.creationTimestamp}'\";\n+    ExecResult result = ExecCommand.exec(kcmd);\n+    return result.stdout().trim();\n+  }\n+\n+  /**\n+   * @param namespace", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "780f714a8c454f54dab4fa5bd7253201f093bd08"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI0NjgxNg==", "bodyText": "done", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r398246816", "createdAt": "2020-03-26T00:16:17Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/TestUtils.java", "diffHunk": "@@ -1980,4 +1980,37 @@ public static ExecResult kubectlpatch(String domainUid, String domainNS, String\n     return exec(cmd, true);\n   }\n \n+  /**\n+   * @param namespace\n+   * @param pod \n+   *\n+   * @return creationTimestamp of the Pod \n+   * @throws Exception on failure\n+   */\n+  public static String getCreationTimeStamp(String namespace, String pod) throws Exception {\n+    String kcmd = \"kubectl get pod \"\n+              + pod \n+              + \" --namespace \"\n+              + namespace\n+              + \" -o jsonpath='{.metadata.creationTimestamp}'\";\n+    ExecResult result = ExecCommand.exec(kcmd);\n+    return result.stdout().trim();\n+  }\n+\n+  /**\n+   * @param namespace", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzOTgzMg=="}, "originalCommit": {"oid": "780f714a8c454f54dab4fa5bd7253201f093bd08"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2ODY5MTM2OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMzoxMDo0NFrOF7xxYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMDoxNTo0OFrOF7zDHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyNTc2Mg==", "bodyText": "yeah, i know it is an exception, you are meant to explain why", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r398225762", "createdAt": "2020-03-25T23:10:44Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -49,11 +54,24 @@\n    */\n   @BeforeAll\n   public static void staticPrepare() throws Exception {\n+    namespaceList = new StringBuffer();\n     testClassName = new Object() {\n     }.getClass().getEnclosingClass().getSimpleName();\n     initialize(APP_PROPS_FILE, testClassName);\n   }\n \n+  /**\n+   * Releases k8s cluster lease, archives result, pv directories.\n+   *\n+   * @throws Exception exception", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1b000ce2953ba9768c182d1765629a22ad52e80"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIzNjAxNw==", "bodyText": "This is standard junit lifecycle method being used across all test classes.   What you want me to explain more here.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r398236017", "createdAt": "2020-03-25T23:41:05Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -49,11 +54,24 @@\n    */\n   @BeforeAll\n   public static void staticPrepare() throws Exception {\n+    namespaceList = new StringBuffer();\n     testClassName = new Object() {\n     }.getClass().getEnclosingClass().getSimpleName();\n     initialize(APP_PROPS_FILE, testClassName);\n   }\n \n+  /**\n+   * Releases k8s cluster lease, archives result, pv directories.\n+   *\n+   * @throws Exception exception", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyNTc2Mg=="}, "originalCommit": {"oid": "a1b000ce2953ba9768c182d1765629a22ad52e80"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIzODMyMA==", "bodyText": "which is better:\n @throws Exception exception\nor\n @throws Exception if unable to collect diagnostics and clean up resources.\nJust because it is done wrong elsewhere, does not make it right to do it wrong here.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r398238320", "createdAt": "2020-03-25T23:48:18Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -49,11 +54,24 @@\n    */\n   @BeforeAll\n   public static void staticPrepare() throws Exception {\n+    namespaceList = new StringBuffer();\n     testClassName = new Object() {\n     }.getClass().getEnclosingClass().getSimpleName();\n     initialize(APP_PROPS_FILE, testClassName);\n   }\n \n+  /**\n+   * Releases k8s cluster lease, archives result, pv directories.\n+   *\n+   * @throws Exception exception", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyNTc2Mg=="}, "originalCommit": {"oid": "a1b000ce2953ba9768c182d1765629a22ad52e80"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIzOTc3Nw==", "bodyText": "or, you could just say\n   * @throws Exception if tearDown() fails\n   * @see BaseTest#tearDown\n\nwhich produces:", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r398239777", "createdAt": "2020-03-25T23:52:35Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -49,11 +54,24 @@\n    */\n   @BeforeAll\n   public static void staticPrepare() throws Exception {\n+    namespaceList = new StringBuffer();\n     testClassName = new Object() {\n     }.getClass().getEnclosingClass().getSimpleName();\n     initialize(APP_PROPS_FILE, testClassName);\n   }\n \n+  /**\n+   * Releases k8s cluster lease, archives result, pv directories.\n+   *\n+   * @throws Exception exception", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyNTc2Mg=="}, "originalCommit": {"oid": "a1b000ce2953ba9768c182d1765629a22ad52e80"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI0NjY4NQ==", "bodyText": "Added\n@throws Exception if tearDown() fails\n@see BaseTest#tearDown", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r398246685", "createdAt": "2020-03-26T00:15:48Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -49,11 +54,24 @@\n    */\n   @BeforeAll\n   public static void staticPrepare() throws Exception {\n+    namespaceList = new StringBuffer();\n     testClassName = new Object() {\n     }.getClass().getEnclosingClass().getSimpleName();\n     initialize(APP_PROPS_FILE, testClassName);\n   }\n \n+  /**\n+   * Releases k8s cluster lease, archives result, pv directories.\n+   *\n+   * @throws Exception exception", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyNTc2Mg=="}, "originalCommit": {"oid": "a1b000ce2953ba9768c182d1765629a22ad52e80"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2ODY5MzE5OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMzoxMTozNFrOF7xycQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMDoxNToxOFrOF7zCgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyNjAzMw==", "bodyText": "CRD's are not namespaced resoruces, so this doc is wrong.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r398226033", "createdAt": "2020-03-25T23:11:34Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -89,211 +106,110 @@ public void cleanupOperatorAndDomain() throws Exception {\n         operator.destroy();\n       }\n       TestUtils.exec(\"rm -rf \" + Paths.get(opUpgradeTmpDir).toString());\n-      //ExecResult result = cleanup();\n+      TestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");\n+      // Make sure domain CRD is deleted form k8s \n+      ExecResult result = ExecCommand.exec(\"kubectl get crd domains.weblogic.oracle\",true);\n+      Assertions.assertEquals(1, result.exitValue());\n       LoggerHelper.getLocal().log(Level.INFO, \"+++++++++++++++Done AfterTest cleanup+++++++++++++++++++++\");\n     }\n   }\n \n   /**\n-   * Test for upgrading Operator from release 2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator20\";\n-    OP_DEP_NAME = \"operator-upgrade20\";\n-    OP_SA = \"operator-sa20\";\n-    DOM_NS = \"weblogic-domain20\";\n-    DUID = \"operatordomain20\";\n-    setupOperatorAndDomain(\"2.0\", \"2.0\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.0.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator201\";\n-    OP_DEP_NAME = \"operator-upgrade201\";\n-    OP_SA = \"operator-sa201\";\n-    DOM_NS = \"weblogic-domain201\";\n-    DUID = \"operatordomain201\";\n-    setupOperatorAndDomain(\"release/2.0.1\", \"2.0.1\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator21\";\n-    OP_DEP_NAME = \"operator-upgrade21\";\n-    OP_SA = \"operator-sa21\";\n-    DOM_NS = \"weblogic-domain21\";\n-    DUID = \"operatordomain21\";\n-    setupOperatorAndDomain(\"release/2.1\", \"2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator220\";\n-    OP_DEP_NAME = \"operator-upgrade220\";\n-    OP_SA = \"operator-sa220\";\n-    DOM_NS = \"weblogic-domain220\";\n-    DUID = \"operatordomain220\";\n-    setupOperatorAndDomain(\"release/2.2\", \"2.2.0\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.1 to develop branch.\n+   * Test for upgrading Operator from release 2.5.0 to develop branch.\n    *\n    * @throws Exception when upgrade fails\n    */\n   @Test\n-  public void testOperatorUpgradeFrom2_2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator221\";\n-    OP_DEP_NAME = \"operator-upgrade221\";\n-    OP_SA = \"operator-sa221\";\n-    DOM_NS = \"weblogic-domain221\";\n-    DUID = \"operatordomain221\";\n-    setupOperatorAndDomain(\"release/2.2.1\", \"2.2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.3.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_3_0() throws Exception {\n+  public void testOperatorUpgradeFrom2_5_0() throws Exception {\n     Assumptions.assumeTrue(QUICKTEST);\n     testCompletedSuccessfully = false;\n     String testMethod = new Object() {\n     }.getClass().getEnclosingMethod().getName();\n     logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator230\";\n-    OP_DEP_NAME = \"operator-upgrade230\";\n-    OP_SA = \"operator-sa230\";\n-    DOM_NS = \"weblogic-domain230\";\n-    DUID = \"operatordomain230\";\n-    setupOperatorAndDomain(\"release/2.3.0\", \"2.3.0\");\n-    upgradeOperator(false);\n+    OP_NS = \"weblogic-operator250\";\n+    DOM_NS = \"weblogic-domain250\";\n+    namespaceList.append(OP_NS);\n+    namespaceList.append(\" \").append(DOM_NS);\n+    OP_DEP_NAME = \"operator-upgrade250\";\n+    OP_SA = \"operator-sa250\";\n+    DUID = \"operatordomain250\";\n+    setupOperatorAndDomain(\"release/2.5.0\", \"2.5.0\");\n+\n+    // Save the CreateTimeStamp for the server pod(s) to compare with \n+    // CreateTimeStamp after upgrade to make sure the pod(s) are not re-stated\n+    managed1CreateTimeStamp = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");\n+    managed2CreateTimeStamp = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server2\");\n+    adminCreateTimeStamp = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-admin-server\");\n+    upgradeOperator();\n     testCompletedSuccessfully = true;\n     LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n   }\n \n   /**\n    * Upgrades operator to develop branch by using the helm upgrade.\n    *\n-   * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkCrdVersion();\n+    checkDomainNotRestarted();\n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks the expected Upgraded Version of CustomResourceDefintion (CRD) ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1b000ce2953ba9768c182d1765629a22ad52e80"}, "originalPosition": 261}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI0NjUyOQ==", "bodyText": "Remove the line containing default ns", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r398246529", "createdAt": "2020-03-26T00:15:18Z", "author": {"login": "anpanigr"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -89,211 +106,110 @@ public void cleanupOperatorAndDomain() throws Exception {\n         operator.destroy();\n       }\n       TestUtils.exec(\"rm -rf \" + Paths.get(opUpgradeTmpDir).toString());\n-      //ExecResult result = cleanup();\n+      TestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");\n+      // Make sure domain CRD is deleted form k8s \n+      ExecResult result = ExecCommand.exec(\"kubectl get crd domains.weblogic.oracle\",true);\n+      Assertions.assertEquals(1, result.exitValue());\n       LoggerHelper.getLocal().log(Level.INFO, \"+++++++++++++++Done AfterTest cleanup+++++++++++++++++++++\");\n     }\n   }\n \n   /**\n-   * Test for upgrading Operator from release 2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator20\";\n-    OP_DEP_NAME = \"operator-upgrade20\";\n-    OP_SA = \"operator-sa20\";\n-    DOM_NS = \"weblogic-domain20\";\n-    DUID = \"operatordomain20\";\n-    setupOperatorAndDomain(\"2.0\", \"2.0\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.0.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator201\";\n-    OP_DEP_NAME = \"operator-upgrade201\";\n-    OP_SA = \"operator-sa201\";\n-    DOM_NS = \"weblogic-domain201\";\n-    DUID = \"operatordomain201\";\n-    setupOperatorAndDomain(\"release/2.0.1\", \"2.0.1\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator21\";\n-    OP_DEP_NAME = \"operator-upgrade21\";\n-    OP_SA = \"operator-sa21\";\n-    DOM_NS = \"weblogic-domain21\";\n-    DUID = \"operatordomain21\";\n-    setupOperatorAndDomain(\"release/2.1\", \"2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator220\";\n-    OP_DEP_NAME = \"operator-upgrade220\";\n-    OP_SA = \"operator-sa220\";\n-    DOM_NS = \"weblogic-domain220\";\n-    DUID = \"operatordomain220\";\n-    setupOperatorAndDomain(\"release/2.2\", \"2.2.0\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.1 to develop branch.\n+   * Test for upgrading Operator from release 2.5.0 to develop branch.\n    *\n    * @throws Exception when upgrade fails\n    */\n   @Test\n-  public void testOperatorUpgradeFrom2_2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator221\";\n-    OP_DEP_NAME = \"operator-upgrade221\";\n-    OP_SA = \"operator-sa221\";\n-    DOM_NS = \"weblogic-domain221\";\n-    DUID = \"operatordomain221\";\n-    setupOperatorAndDomain(\"release/2.2.1\", \"2.2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.3.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_3_0() throws Exception {\n+  public void testOperatorUpgradeFrom2_5_0() throws Exception {\n     Assumptions.assumeTrue(QUICKTEST);\n     testCompletedSuccessfully = false;\n     String testMethod = new Object() {\n     }.getClass().getEnclosingMethod().getName();\n     logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator230\";\n-    OP_DEP_NAME = \"operator-upgrade230\";\n-    OP_SA = \"operator-sa230\";\n-    DOM_NS = \"weblogic-domain230\";\n-    DUID = \"operatordomain230\";\n-    setupOperatorAndDomain(\"release/2.3.0\", \"2.3.0\");\n-    upgradeOperator(false);\n+    OP_NS = \"weblogic-operator250\";\n+    DOM_NS = \"weblogic-domain250\";\n+    namespaceList.append(OP_NS);\n+    namespaceList.append(\" \").append(DOM_NS);\n+    OP_DEP_NAME = \"operator-upgrade250\";\n+    OP_SA = \"operator-sa250\";\n+    DUID = \"operatordomain250\";\n+    setupOperatorAndDomain(\"release/2.5.0\", \"2.5.0\");\n+\n+    // Save the CreateTimeStamp for the server pod(s) to compare with \n+    // CreateTimeStamp after upgrade to make sure the pod(s) are not re-stated\n+    managed1CreateTimeStamp = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");\n+    managed2CreateTimeStamp = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server2\");\n+    adminCreateTimeStamp = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-admin-server\");\n+    upgradeOperator();\n     testCompletedSuccessfully = true;\n     LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n   }\n \n   /**\n    * Upgrades operator to develop branch by using the helm upgrade.\n    *\n-   * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkCrdVersion();\n+    checkDomainNotRestarted();\n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks the expected Upgraded Version of CustomResourceDefintion (CRD) ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyNjAzMw=="}, "originalCommit": {"oid": "a1b000ce2953ba9768c182d1765629a22ad52e80"}, "originalPosition": 261}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ2ODY5NDc2OnYy", "diffSide": "RIGHT", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMzoxMjoxNVrOF7xzWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMzoxMjoxNVrOF7xzWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyNjI2NQ==", "bodyText": "include in the message what you did get, and what you expected to get", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1485#discussion_r398226265", "createdAt": "2020-03-25T23:12:15Z", "author": {"login": "markxnelson"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItOperatorUpgrade.java", "diffHunk": "@@ -89,211 +106,110 @@ public void cleanupOperatorAndDomain() throws Exception {\n         operator.destroy();\n       }\n       TestUtils.exec(\"rm -rf \" + Paths.get(opUpgradeTmpDir).toString());\n-      //ExecResult result = cleanup();\n+      TestUtils.exec(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\");\n+      // Make sure domain CRD is deleted form k8s \n+      ExecResult result = ExecCommand.exec(\"kubectl get crd domains.weblogic.oracle\",true);\n+      Assertions.assertEquals(1, result.exitValue());\n       LoggerHelper.getLocal().log(Level.INFO, \"+++++++++++++++Done AfterTest cleanup+++++++++++++++++++++\");\n     }\n   }\n \n   /**\n-   * Test for upgrading Operator from release 2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator20\";\n-    OP_DEP_NAME = \"operator-upgrade20\";\n-    OP_SA = \"operator-sa20\";\n-    DOM_NS = \"weblogic-domain20\";\n-    DUID = \"operatordomain20\";\n-    setupOperatorAndDomain(\"2.0\", \"2.0\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.0.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_0_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator201\";\n-    OP_DEP_NAME = \"operator-upgrade201\";\n-    OP_SA = \"operator-sa201\";\n-    DOM_NS = \"weblogic-domain201\";\n-    DUID = \"operatordomain201\";\n-    setupOperatorAndDomain(\"release/2.0.1\", \"2.0.1\");\n-    upgradeOperator(true);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.1 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator21\";\n-    OP_DEP_NAME = \"operator-upgrade21\";\n-    OP_SA = \"operator-sa21\";\n-    DOM_NS = \"weblogic-domain21\";\n-    DUID = \"operatordomain21\";\n-    setupOperatorAndDomain(\"release/2.1\", \"2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_2_0() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator220\";\n-    OP_DEP_NAME = \"operator-upgrade220\";\n-    OP_SA = \"operator-sa220\";\n-    DOM_NS = \"weblogic-domain220\";\n-    DUID = \"operatordomain220\";\n-    setupOperatorAndDomain(\"release/2.2\", \"2.2.0\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.2.1 to develop branch.\n+   * Test for upgrading Operator from release 2.5.0 to develop branch.\n    *\n    * @throws Exception when upgrade fails\n    */\n   @Test\n-  public void testOperatorUpgradeFrom2_2_1() throws Exception {\n-    Assumptions.assumeTrue(FULLTEST);\n-    testCompletedSuccessfully = false;\n-    String testMethod = new Object() {\n-    }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator221\";\n-    OP_DEP_NAME = \"operator-upgrade221\";\n-    OP_SA = \"operator-sa221\";\n-    DOM_NS = \"weblogic-domain221\";\n-    DUID = \"operatordomain221\";\n-    setupOperatorAndDomain(\"release/2.2.1\", \"2.2.1\");\n-    upgradeOperator(false);\n-    testCompletedSuccessfully = true;\n-    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n-  }\n-\n-  /**\n-   * Test for upgrading Operator from release 2.3.0 to develop branch.\n-   *\n-   * @throws Exception when upgrade fails\n-   */\n-  @Test\n-  public void testOperatorUpgradeFrom2_3_0() throws Exception {\n+  public void testOperatorUpgradeFrom2_5_0() throws Exception {\n     Assumptions.assumeTrue(QUICKTEST);\n     testCompletedSuccessfully = false;\n     String testMethod = new Object() {\n     }.getClass().getEnclosingMethod().getName();\n     logTestBegin(testMethod);\n-    OP_NS = \"weblogic-operator230\";\n-    OP_DEP_NAME = \"operator-upgrade230\";\n-    OP_SA = \"operator-sa230\";\n-    DOM_NS = \"weblogic-domain230\";\n-    DUID = \"operatordomain230\";\n-    setupOperatorAndDomain(\"release/2.3.0\", \"2.3.0\");\n-    upgradeOperator(false);\n+    OP_NS = \"weblogic-operator250\";\n+    DOM_NS = \"weblogic-domain250\";\n+    namespaceList.append(OP_NS);\n+    namespaceList.append(\" \").append(DOM_NS);\n+    OP_DEP_NAME = \"operator-upgrade250\";\n+    OP_SA = \"operator-sa250\";\n+    DUID = \"operatordomain250\";\n+    setupOperatorAndDomain(\"release/2.5.0\", \"2.5.0\");\n+\n+    // Save the CreateTimeStamp for the server pod(s) to compare with \n+    // CreateTimeStamp after upgrade to make sure the pod(s) are not re-stated\n+    managed1CreateTimeStamp = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server1\");\n+    managed2CreateTimeStamp = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-managed-server2\");\n+    adminCreateTimeStamp = TestUtils.getCreationTimeStamp(DOM_NS,DUID + \"-admin-server\");\n+    upgradeOperator();\n     testCompletedSuccessfully = true;\n     LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethod);\n   }\n \n   /**\n    * Upgrades operator to develop branch by using the helm upgrade.\n    *\n-   * @param restart boolean parameter used to determine if a restart of domain is checked\n    * @throws Exception when upgrade fails or basic usecase testing or scaling fails.\n    */\n-  private void upgradeOperator(boolean restart) throws Exception {\n+  private void upgradeOperator() throws Exception {\n     operator.callHelmUpgrade(\"image=\" + OP_TARGET_RELEASE);\n-    if (restart) {\n-      checkDomainRollingRestarted();\n-    }\n-    checkOperatorVersion();\n+    checkCrdVersion();\n+    checkDomainNotRestarted();\n     testClusterScaling(operator, domain, false);\n   }\n \n   /**\n-   * checks the expected version of the upgraded operator in a loop. In Jenkins it takes nearly 8\n-   * minutes to show the updated value of the domain CRD.\n+   * Checks the expected Upgraded Version of CustomResourceDefintion (CRD) \n+   * in default NameSpace in a loop. \n    *\n    * @throws Exception when version does not match\n    */\n-  private void checkOperatorVersion() throws Exception {\n+  private void checkCrdVersion() throws Exception {\n     boolean result = false;\n     LoggerHelper.getLocal().log(\n         Level.INFO,\n-        \"Checking for the domain apiVersion \"\n-            + getDomainApiVersion()\n-            + \" in a loop for up to 15 minutes\");\n-    for (int i = 0; i < 900; i = i + 10) {\n+        \"Checking for the CRD Version \"\n+            + getCrdVersion()\n+            + \" in a loop \");\n+    for (int i = 0; i < BaseTest.getMaxIterationsPod(); i++) {\n       ExecResult exec =\n           TestUtils.exec(\n-              \"kubectl get domain -n \" + DOM_NS + \"  \" + DUID + \" -o jsonpath={.apiVersion}\", true);\n-      if (exec.stdout().contains(getDomainApiVersion())) {\n-        LoggerHelper.getLocal().log(Level.INFO, \"Got the expected apiVersion\");\n+              \"kubectl get crd domains.weblogic.oracle -o jsonpath='{.spec.versions[?(@.storage==true)].name}'\", true);\n+      if (exec.stdout().contains(getCrdVersion())) {\n+        LoggerHelper.getLocal().log(Level.INFO, \"Got expected CRD Version\");\n         result = true;\n         break;\n       }\n-      Thread.sleep(1000 * 10);\n+      try { \n+        Thread.sleep(BaseTest.getWaitTimePod() * 1000); \n+      } catch (InterruptedException e) {\n+        LoggerHelper.getLocal().log(Level.INFO,\"Got InterruptedException \" + e);\n+      } \n     }\n     if (!result) {\n-      throw new RuntimeException(\"FAILURE: Didn't get the expected operator version\");\n+      throw new Exception(\"FAILURE: Didn't get expected CRD Version\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1b000ce2953ba9768c182d1765629a22ad52e80"}, "originalPosition": 299}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4640, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}