{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4OTU3Mzk2", "number": 1902, "title": "Develop owls 84334", "bodyText": "This PR updates the domain introspection script to obtain the administration port in the context of the domain's secure mode,\nespecially when secure mode is turned on by default(planned for 14.1.2.0).\nTest results\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/1789/\nTest Result (3 failures / +3)\noracle.weblogic.kubernetes.ItConfigDistributionStrategy.oracle.weblogic.kubernetes.ItConfigDistributionStrategy\noracle.weblogic.kubernetes.ItCoherenceTests.testCohernceServerRollingRestart\noracle.weblogic.kubernetes.ItOperatorRestart.testOperatorRestartWhenPodRoll\nRan each of these failed tests individually and they all passed:\n\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/1793/testReport/oracle.weblogic.kubernetes/ItConfigDistributionStrategy/\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/1794/testReport/oracle.weblogic.kubernetes/ItCoherenceTests/\nhttps://build.weblogick8s.org:8443/job/weblogic-kubernetes-operator-kind-new/1799/testReport/oracle.weblogic.kubernetes/ItOperatorRestart/", "createdAt": "2020-09-03T21:00:32Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1902", "merged": true, "mergeCommit": {"oid": "f9f208b9eb58c964f83b7cae9fce480e825bd8b1"}, "closed": true, "closedAt": "2020-10-01T15:33:43Z", "author": {"login": "qvdang"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFAWi-gH2gAyNDc4OTU3Mzk2OjhhOGFhMDhkNmYzNDliMzg3NjAxMmRiZmVjMTI3Y2JiZDFlNGY1MDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdN97xmgFqTQ5OTUxMzI3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8a8aa08d6f349b3876012dbfec127cbbd1e4f507", "author": {"user": {"login": "qvdang", "name": "Quang Dang"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8a8aa08d6f349b3876012dbfec127cbbd1e4f507", "committedDate": "2020-09-02T18:31:29Z", "message": "support domain's secure mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04ad6919b395a9400146cefaa577ef2593aefc25", "author": {"user": {"login": "qvdang", "name": "Quang Dang"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/04ad6919b395a9400146cefaa577ef2593aefc25", "committedDate": "2020-09-03T13:37:07Z", "message": "Use the domain's administration port if the server's admin port is 0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47753da917aeac87f827d736f6e87a6a7b05040f", "author": {"user": {"login": "qvdang", "name": "Quang Dang"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/47753da917aeac87f827d736f6e87a6a7b05040f", "committedDate": "2020-09-03T13:39:59Z", "message": "Merge branch 'develop' into develop_OWLS-84334"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMjQ0NTg5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1902#pullrequestreview-482244589", "createdAt": "2020-09-03T22:28:49Z", "commit": {"oid": "47753da917aeac87f827d736f6e87a6a7b05040f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMjoyODo0OVrOHM5gMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMjoyODo0OVrOHM5gMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI4NzA5MA==", "bodyText": "I've found three additional attributes that this script checks, that have different default and secureValue fields, and that aren't included in this update:\n\nNetworkAccessPoint.getProtocol: t3 (default) --> t3s (secureValue) (search for \"getProtocol()\")\nServer[Template].isListenPortEnabled: true --> false (search for \"isListenPortEnabled()\")\nSSL.isEnabled: false --> true (search for \"isEnabled()\")\n\nI assume the script needs to be updated for them too?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1902#discussion_r483287090", "createdAt": "2020-09-03T22:28:49Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/introspectDomain.py", "diffHunk": "@@ -1664,6 +1662,50 @@ def getSSLOrNone(server):\n     ret = None\n   return ret\n \n+# Derive the default value for SecureMode of a domain\n+def isSecureModeEnabledForDomain(domain):\n+  secureModeEnabled = false\n+  if domain.getSecurityConfiguration().getSecureMode() != None:\n+    secureModeEnabled = domain.getSecurityConfiguration().getSecureMode().isSecureModeEnabled()\n+  else:\n+    secureModeEnabled = domain.isProductionModeEnabled() and not LegalHelper.versionEarlierThan(domain.getDomainVersion(), \"14.1.2.0\")\n+  return secureModeEnabled\n+\n+def isAdministrationPortEnabledForDomain(domain):\n+  administrationPortEnabled = false\n+  #\"if domain.isSet('AdministrationPortEnabled'):\" does not work in off-line WLST!\n+  # Go to the domain root\n+  cd('/')\n+  if isSet('AdministrationPortEnabled'):\n+    administrationPortEnabled = domain.isAdministrationPortEnabled()\n+  else:\n+    # AdministrationPortEnabled is not explicitly set so going with the default\n+    # Starting with 14.1.2.0, the domain's AdministrationPortEnabled default is derived from the domain's SecureMode\n+    administrationPortEnabled = isSecureModeEnabledForDomain(domain)\n+  return administrationPortEnabled\n+\n+def isAdministrationPortEnabledForServer(server, domain, isServerTemplate=False):\n+  administrationPortEnabled = false\n+  #\"if server.isSet('AdministrationPortEnabled'):\" does not work in off-line WLST!\n+  cd('/')\n+  if isServerTemplate:\n+    cd('ServerTemplate')\n+  else:\n+    cd('Server')\n+  cd(server.getName())\n+  if isSet('AdministrationPortEnabled'):\n+    administrationPortEnabled = server.isAdministrationPortEnabled()\n+  else:\n+    administrationPortEnabled = isAdministrationPortEnabledForDomain(domain)\n+  return administrationPortEnabled\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47753da917aeac87f827d736f6e87a6a7b05040f"}, "originalPosition": 107}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42932842f4fb13fd2ba7b6cdb9e0dff186bec90b", "author": {"user": {"login": "qvdang", "name": "Quang Dang"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/42932842f4fb13fd2ba7b6cdb9e0dff186bec90b", "committedDate": "2020-09-16T22:41:44Z", "message": "Merge branch 'develop' into develop_OWLS-84334"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7465ad8418d6271807065286c0c795bf485c168", "author": {"user": {"login": "qvdang", "name": "Quang Dang"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c7465ad8418d6271807065286c0c795bf485c168", "committedDate": "2020-09-22T22:15:19Z", "message": "Merge branch 'develop' into develop_OWLS-84334"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e968281795843efc4f9de81fd8951c6c110522a", "author": {"user": {"login": "qvdang", "name": "Quang Dang"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7e968281795843efc4f9de81fd8951c6c110522a", "committedDate": "2020-09-24T13:18:25Z", "message": "- Fix the NPE when the WLS pod's listen port passed to Prometheus annotations is null\n- Derive the defaults for a few other MBean attributes that depend on the domain secure mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d280ab2d639b40efdaa6d8a3be126490b262542", "author": {"user": {"login": "qvdang", "name": "Quang Dang"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3d280ab2d639b40efdaa6d8a3be126490b262542", "committedDate": "2020-09-25T18:06:50Z", "message": "Merge branch 'develop' into develop_OWLS-84334"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a412979205a9c8be373c8d006737474cae808f1", "author": {"user": {"login": "qvdang", "name": "Quang Dang"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5a412979205a9c8be373c8d006737474cae808f1", "committedDate": "2020-09-28T21:19:32Z", "message": "Merge branch 'develop' into develop_OWLS-84334"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "208450dad767697d9f42c2d4d0761c50922e971c", "author": {"user": {"login": "qvdang", "name": "Quang Dang"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/208450dad767697d9f42c2d4d0761c50922e971c", "committedDate": "2020-09-29T03:43:28Z", "message": "Fix error in getNAPProtocol for ServerTemplate"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NjYyNzAw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1902#pullrequestreview-498662700", "createdAt": "2020-09-29T16:18:14Z", "commit": {"oid": "208450dad767697d9f42c2d4d0761c50922e971c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNjoxODoxNFrOHZ2WrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNjoxODoxNFrOHZ2WrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg2Njk4OA==", "bodyText": "Do we need to make changes elsewhere to accommodate these extraScrapeConfigs? For instance, are there documentation or blogs that must now be updated?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1902#discussion_r496866988", "createdAt": "2020-09-29T16:18:14Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/PodStepContext.java", "diffHunk": "@@ -535,7 +551,9 @@ protected V1ObjectMeta createMetadata() {\n           .ifPresent(hash -> addHashLabel(metadata, LabelConstants.MODEL_IN_IMAGE_MODEL_SECRETS_HASH, hash));\n \n     // Add prometheus annotations. This will overwrite any custom annotations with same name.\n-    AnnotationHelper.annotateForPrometheus(metadata, getDefaultPort());\n+    // Prometheus does not support \"prometheus.io/scheme\".  The scheme(http/https) can be set\n+    // in the Prometheus Chart values yaml under the \"extraScrapeConfigs:\" section.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "208450dad767697d9f42c2d4d0761c50922e971c"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NjcwMDg3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1902#pullrequestreview-498670087", "createdAt": "2020-09-29T16:26:47Z", "commit": {"oid": "208450dad767697d9f42c2d4d0761c50922e971c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NTEzMjc1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1902#pullrequestreview-499513275", "createdAt": "2020-09-30T14:47:45Z", "commit": {"oid": "208450dad767697d9f42c2d4d0761c50922e971c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4111, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}