{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1OTc1Mzk0", "number": 1832, "title": "Changes for OWLS-82011 to reflect introspector status in domain status", "bodyText": "Changes for OWLS-82011 to reflect introspector status in domain status in below conditions -\n\nMissing image\nMissing PV/C mount\nIntrospector job timeout (deadline exceeded)", "createdAt": "2020-07-23T22:05:29Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1832", "merged": true, "mergeCommit": {"oid": "1ac45b232eb4b31354e7933d80ea96345c6c609c"}, "closed": true, "closedAt": "2020-07-29T20:51:20Z", "author": {"login": "ankedia"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc32k0CAH2gAyNDU1OTc1Mzk0OjgyNGVkODA0ZmNhNjk4N2ViNGQ4ZjY4MWVmNGYxNTQ4NjIwMjRiNjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5xX6dAFqTQ1Nzg4NzQxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "824ed804fca6987eb4d8f681ef4f154862024b65", "author": {"user": {"login": "ankedia", "name": "Anil Kedia"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/824ed804fca6987eb4d8f681ef4f154862024b65", "committedDate": "2020-07-23T21:47:00Z", "message": "Changes for OWLS-82011 to reflect introspector status in domain status"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16da37b2048e8fdcb6581d49cbe6e618c215d9c1", "author": {"user": {"login": "ankedia", "name": "Anil Kedia"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/16da37b2048e8fdcb6581d49cbe6e618c215d9c1", "committedDate": "2020-07-23T22:01:28Z", "message": "change method name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa56cae469d971dede5c1063dbcac706b635ac69", "author": {"user": {"login": "ankedia", "name": "Anil Kedia"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/aa56cae469d971dede5c1063dbcac706b635ac69", "committedDate": "2020-07-24T03:25:58Z", "message": "Code refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5ead73b926b9ea825d2b3c77631afefac9d27fc", "author": {"user": {"login": "ankedia", "name": "Anil Kedia"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e5ead73b926b9ea825d2b3c77631afefac9d27fc", "committedDate": "2020-07-24T03:35:17Z", "message": "cleanup debug message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53169c5b6a177556408073f0246c58b96ea60bc8", "author": {"user": {"login": "ankedia", "name": "Anil Kedia"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/53169c5b6a177556408073f0246c58b96ea60bc8", "committedDate": "2020-07-24T03:42:34Z", "message": "Remove unused method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0OTUyMDky", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1832#pullrequestreview-454952092", "createdAt": "2020-07-24T14:51:37Z", "commit": {"oid": "53169c5b6a177556408073f0246c58b96ea60bc8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxNDo1MTozN1rOG2yb6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxNDo1MTozN1rOG2yb6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDEwMjYzNQ==", "bodyText": "What do these statuses indicate? I'd have thought that once you selected a status, that indicated what had to be updated in the domain status - and yet this seems to do a fair bit of additional processing. Can you explain your approach?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1832#discussion_r460102635", "createdAt": "2020-07-24T14:51:37Z", "author": {"login": "russgold"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "diffHunk": "@@ -974,42 +980,86 @@ public NextAction apply(Packet packet) {\n   }\n \n   private static class DomainStatusUpdate {\n-    private final Domain domain;\n     private final V1Pod pod;\n     private final String domainUid;\n+    private DomainProcessorDelegate delegate = null;\n+    private DomainPresenceInfo info = null;\n+    private PodWatcher.PodStatus podStatus;\n \n-    DomainStatusUpdate(Domain domain, V1Pod pod, String domainUid) {\n-      this.domain = domain;\n+    DomainStatusUpdate(V1Pod pod, String domainUid, DomainProcessorDelegate delegate,\n+                       DomainPresenceInfo info, PodWatcher.PodStatus podStatus) {\n       this.pod = pod;\n       this.domainUid = domainUid;\n+      this.delegate = delegate;\n+      this.info = info;\n+      this.podStatus = podStatus;\n     }\n \n-    public void invoke() {\n-      Optional.ofNullable(getMatchingContainerStatus())\n-            .map(V1ContainerStatus::getState)\n-            .map(V1ContainerState::getWaiting)\n-            .ifPresent(waiting -> updateStatus(waiting.getReason(), waiting.getMessage()));\n-    }\n-\n-    private void updateStatus(String reason, String message) {\n-      if (reason == null || message == null) {\n-        return;\n+    private void invoke() {\n+      switch (podStatus) {\n+        case PHASE_FAILED:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "53169c5b6a177556408073f0246c58b96ea60bc8"}, "originalPosition": 87}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da40befb32a253fd195ebaa9ff4acdd636298501", "author": {"user": {"login": "ankedia", "name": "Anil Kedia"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/da40befb32a253fd195ebaa9ff4acdd636298501", "committedDate": "2020-07-24T23:04:46Z", "message": "Added check to terminate fiber when intro job fails with BackoffLimitExceeded (which happens when intro job times out due to DeadlineExceeded)."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MDY3OTU3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1832#pullrequestreview-456067957", "createdAt": "2020-07-27T19:22:52Z", "commit": {"oid": "da40befb32a253fd195ebaa9ff4acdd636298501"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxOToyMjo1MlrOG3wQjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxOToyMzo0MlrOG3wSFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTExNTUzNA==", "bodyText": "Is there some reason not to create this progressing state in the bringManagedServersUp method?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1832#discussion_r461115534", "createdAt": "2020-07-27T19:22:52Z", "author": {"login": "russgold"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "diffHunk": "@@ -784,12 +787,15 @@ public void onThrowable(Packet packet, Throwable throwable) {\n \n   Step createDomainUpPlan(DomainPresenceInfo info) {\n     Step managedServerStrategy =\n-        bringManagedServersUp(DomainStatusUpdater.createEndProgressingStep(new TailStep()));\n+        Step.chain(\n+            DomainStatusUpdater.createProgressingStep(MANAGED_SERVERS_STARTING_PROGRESS_REASON, true, null),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da40befb32a253fd195ebaa9ff4acdd636298501"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTExNTkyNQ==", "bodyText": "This branch creates the FailedStep. Where is it being run?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1832#discussion_r461115925", "createdAt": "2020-07-27T19:23:42Z", "author": {"login": "russgold"}, "path": "operator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "diffHunk": "@@ -974,42 +980,86 @@ public NextAction apply(Packet packet) {\n   }\n \n   private static class DomainStatusUpdate {\n-    private final Domain domain;\n     private final V1Pod pod;\n     private final String domainUid;\n+    private DomainProcessorDelegate delegate = null;\n+    private DomainPresenceInfo info = null;\n+    private PodWatcher.PodStatus podStatus;\n \n-    DomainStatusUpdate(Domain domain, V1Pod pod, String domainUid) {\n-      this.domain = domain;\n+    DomainStatusUpdate(V1Pod pod, String domainUid, DomainProcessorDelegate delegate,\n+                       DomainPresenceInfo info, PodWatcher.PodStatus podStatus) {\n       this.pod = pod;\n       this.domainUid = domainUid;\n+      this.delegate = delegate;\n+      this.info = info;\n+      this.podStatus = podStatus;\n     }\n \n-    public void invoke() {\n-      Optional.ofNullable(getMatchingContainerStatus())\n-            .map(V1ContainerStatus::getState)\n-            .map(V1ContainerState::getWaiting)\n-            .ifPresent(waiting -> updateStatus(waiting.getReason(), waiting.getMessage()));\n-    }\n-\n-    private void updateStatus(String reason, String message) {\n-      if (reason == null || message == null) {\n-        return;\n+    private void invoke() {\n+      switch (podStatus) {\n+        case PHASE_FAILED:\n+          DomainStatusUpdater.createFailedStep(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "da40befb32a253fd195ebaa9ff4acdd636298501"}, "originalPosition": 88}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MTAwODk2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1832#pullrequestreview-456100896", "createdAt": "2020-07-27T20:13:40Z", "commit": {"oid": "da40befb32a253fd195ebaa9ff4acdd636298501"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c2a486e3fda7b218b43ee97ff146d8a27dc5ef9", "author": {"user": {"login": "ankedia", "name": "Anil Kedia"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3c2a486e3fda7b218b43ee97ff146d8a27dc5ef9", "committedDate": "2020-07-27T21:34:01Z", "message": "implement review comment suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e36ed1de633ac306c91abf3a431ebca20e2a6195", "author": {"user": {"login": "ankedia", "name": "Anil Kedia"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e36ed1de633ac306c91abf3a431ebca20e2a6195", "committedDate": "2020-07-28T12:47:48Z", "message": "added unit test for introspector pod phase failed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NjY4NDc2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1832#pullrequestreview-456668476", "createdAt": "2020-07-28T14:08:03Z", "commit": {"oid": "e36ed1de633ac306c91abf3a431ebca20e2a6195"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2OTMyODE4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1832#pullrequestreview-456932818", "createdAt": "2020-07-28T19:15:58Z", "commit": {"oid": "e36ed1de633ac306c91abf3a431ebca20e2a6195"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3ODg3NDEw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1832#pullrequestreview-457887410", "createdAt": "2020-07-29T20:51:14Z", "commit": {"oid": "e36ed1de633ac306c91abf3a431ebca20e2a6195"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4326, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}