{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwMDMzNzk2", "number": 1478, "title": "Model in image support", "bodyText": "", "createdAt": "2020-03-17T19:29:22Z", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478", "merged": true, "mergeCommit": {"oid": "3f1cea8903e51c41d4f70283e1c8259bf016e3cf"}, "closed": true, "closedAt": "2020-04-10T15:47:01Z", "author": {"login": "rjeberhard"}, "timelineItems": {"totalCount": 354, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRKDg4gFqTM4MTMxODk1OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcWSfhKAH2gAyMzkwMDMzNzk2OjU1YmEwNzBhOGYxM2I1Y2RlMTVjNGZjYTllZjUyNzM1MjJmNGI4NGM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMzE4OTU4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381318958", "createdAt": "2020-03-25T16:25:41Z", "commit": {"oid": "5aed198290f7fbda117af521d1a5d712be660fd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNjoyNTo0MVrOF7jeXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNjoyNTo0MVrOF7jeXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk5MTUxNg==", "bodyText": "@jshum2479 Maybe for post V1:  Please consider renaming all MII-only variables so that they start with 'MII_\" or maybe \"MODEL_\" (your choice), and maybe also do this in the shell scripts too.  That'd help differentiate the globals that are specific to MII when reading through the code.  Similarly, if adding a MII only function/method, consider decorating it with 'model' or 'mii'...", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397991516", "createdAt": "2020-03-25T16:25:41Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/introspectDomain.py", "diffHunk": "@@ -118,13 +116,31 @@ def open(self):\n     self.CUSTOM_PREFIX_WLDF = 'Sit-Cfg-WLDF--'\n     self.CUSTOM_PREFIX_CFG  = 'Sit-Cfg-CFG--'\n \n-    self.INTROSPECT_HOME        = '/tmp/introspect/' + self.DOMAIN_UID\n-    self.TOPOLOGY_FILE          = self.INTROSPECT_HOME + '/topology.yaml'\n-    self.CM_FILE                = self.INTROSPECT_HOME + '/' + self.CUSTOM_PREFIX_CFG + 'introspector-situational-config.xml'\n-    self.BOOT_FILE              = self.INTROSPECT_HOME + '/boot.properties'\n-    self.USERCONFIG_FILE        = self.INTROSPECT_HOME + '/userConfigNodeManager.secure'\n-    self.USERKEY_FILE           = self.INTROSPECT_HOME + '/userKeyNodeManager.secure'\n-    self.DOMAIN_SECRET_MD5_FILE = '/tmp/DomainSecret.md5'\n+    self.INTROSPECT_HOME          = '/tmp/introspect/' + self.DOMAIN_UID\n+    self.TOPOLOGY_FILE            = self.INTROSPECT_HOME + '/topology.yaml'\n+    self.CM_FILE                  = self.INTROSPECT_HOME + '/' + self.CUSTOM_PREFIX_CFG + 'introspector-situational-config.xml'\n+    self.BOOT_FILE                = self.INTROSPECT_HOME + '/boot.properties'\n+    self.USERCONFIG_FILE          = self.INTROSPECT_HOME + '/userConfigNodeManager.secure'\n+    self.USERKEY_FILE             = self.INTROSPECT_HOME + '/userKeyNodeManager.secure'\n+\n+    # Model in image attributes\n+\n+    self.DOMAIN_SECRET_MD5_FILE   = '/tmp/DomainSecret.md5'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5aed198290f7fbda117af521d1a5d712be660fd4"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMzIwMjkz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381320293", "createdAt": "2020-03-25T16:27:11Z", "commit": {"oid": "5aed198290f7fbda117af521d1a5d712be660fd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNjoyNzoxMVrOF7jisQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNjoyNzoxMVrOF7jisQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk5MjYyNQ==", "bodyText": "Start name with MII_", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397992625", "createdAt": "2020-03-25T16:27:11Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/introspectDomain.py", "diffHunk": "@@ -1200,6 +1361,60 @@ def generateAndValidate(self):\n       gen.addGeneratedFile()\n \n \n+class WDTConfigIntrospector(SecretManager):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5aed198290f7fbda117af521d1a5d712be660fd4"}, "originalPosition": 252}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62c56ef60b39e04a56307f4ecdc3b3756bdbec7d", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/62c56ef60b39e04a56307f4ecdc3b3756bdbec7d", "committedDate": "2020-03-25T16:29:49Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea9dc9e2db65db8254da52355f83b6f2846a1efd", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ea9dc9e2db65db8254da52355f83b6f2846a1efd", "committedDate": "2020-03-25T16:46:38Z", "message": "doc update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMzI3OTM5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381327939", "createdAt": "2020-03-25T16:35:26Z", "commit": {"oid": "62c56ef60b39e04a56307f4ecdc3b3756bdbec7d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNjozNToyNlrOF7j7MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNjozNToyNlrOF7j7MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk5ODg5Ng==", "bodyText": "irrecoverably", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397998896", "createdAt": "2020-03-25T16:35:26Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/usage.md", "diffHunk": "@@ -0,0 +1,173 @@\n++++\n+title = \"Usage\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 20\n+pre = \"<b> </b>\"\n+description = \"Steps for creating and deploying Model in Image images and their associated domain resources.\"\n++++\n+\n+\n+#### Contents\n+\n+   - [WebLogic Kubernetes Operator](#1-weblogic-kubernetes-operator)\n+   - [WebLogic Server image](#2-weblogic-server-image)\n+   - [Optional WDT model config map](#3-optional-wdt-model-config-map)\n+   - [Required runtime encryption secret](#4-required-runtime-encryption-secret)\n+   - [Secrets for model macros](#5-secrets-for-model-macros)\n+   - [Domain resource attributes](#6-domain-resource-attributes)\n+   - [Prerequisites for JRF domain types](#7-prerequisites-for-jrf-domain-types)\n+\n+#### Requirements\n+\n+Here's what's needed to create and deploy a typical Model in Image domain. These items do not need to be created in order.\n+\n+#### 1. WebLogic Kubernetes Operator\n+\n+Deploy the operator and ensure that it is monitoring the desired namespace for your Model in Image domain. See [Manage operators]({{< relref \"/userguide/managing-operators/_index.md\" >}}) and [Quick Start]({{< relref \"/quickstart/_index.md\" >}}).\n+\n+#### 2. WebLogic Server image\n+\n+Model in Image requires creating a 'final' deployable image that has WebLogic Server and WDT installed, plus your model and application files.\n+\n+You can start with a WebLogic Server 12.2.1.3 or later pre-built base image obtained from [Docker Hub](https://github.com/oracle/docker-images/tree/master/OracleWebLogic) or similar, manually build your own base image as per [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}), or build a base image using the [WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool). Note that any 12.2.1.3 image must also include patch 29135930 (the pre-built images already contain this patch). For an example of the first approach for both WLS and JRF domains, see the [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample.\n+\n+After you have a base image, Model in Image requires layering the following directory structure for its (optional) WDT models artifacts and (required) WDT binaries:\n+\n+| Directory                | Contents                           | Extension   |\n+| ------------------------ | ---------------------------------- | ----------- |\n+| `/u01/wdt/models`         | Optional domain model YAML files   | .yaml       |\n+| `/u01/wdt/models`         | Optional model variable files      | .properties |\n+| `/u01/wdt/models`         | Optional application archives      | .zip        |\n+| `/u01/wdt/weblogic-deploy`| Unzipped WebLogic deploy install   |             |\n+\n+There are two methods for layering Model in Image artifacts on top of a base image:\n+\n+  - **Manual Image Creation**: Use Docker commands to layer the WDT artifacts from the above table on top of your base image into a new image.\n+\n+  - **WebLogic Image Tool**: Use the convenient [WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool). The WebLogic Image Tool (WIT) has built-in options for embedding WDT model files, WDT binaries, WebLogic Server binaries, and WebLogic Server patches in an image. The [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample uses the WIT approach. For an example, see the sample's `build_image_model.sh` file in the operator source's `kubernetes/samples/scripts/create-weblogic-domain/model-in-image` directory.\n+\n+For a discussion of model file syntax, see [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+#### 3. Optional WDT model config map\n+\n+You can create a WDT model config map that defines additional model `.yaml` and `.properties` files beyond what you've already supplied in your image, and then reference this config map using your domain resource's `configuration.model.configMap` attribute. This is optional if the supplied image already fully defines your model.\n+\n+WDT model config map files will be merged with the WDT files defined in your image at runtime before your domain home is created. The config map files can add to, remove from, or alter the model configuration that you supplied within your image.\n+\n+For example, place additional `.yaml` and `.properties` files in a directory called `/home/acmeuser/wdtoverride` and run the following commands:\n+\n+  ```\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    create configmap MY-DOMAINUID-my-wdt-config-map \\\n+    --from-file /home/acmeuser/wdtoverride\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    label  configmap MY-DOMAINUID-my-wdt-config-map \\\n+    weblogic.domainUID=MY-DOMAINUID\n+  ```\n+\n+See [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) for a discussion of model file syntax and loading order, and see [Runtime updates]({{< relref \"/userguide/managing-domains/model-in-image/runtime-updates.md\" >}}) for a discussion of using WDT model config maps to update the model configuration of a running domain.\n+\n+\n+#### 4. Required runtime encryption secret\n+\n+Model in Image requires a runtime encryption secret with a secure `password` key. This secret is used by the operator to encrypt model and domain home artifacts before it adds them to a runtime config map or log. The `password` that you set can safely change any time after you've fully shut down a domain but must remain the same for the life of a running domain. The runtime encryption secret that you create can be named anything but note that it is a best practice to name and label secrets with their domain UID to help ensure that cleanup scripts can find and delete them.\n+\n+**NOTE**: Because the runtime encryption password does not need to be shared and only needs to exist for the life of a domain, you may want to use a password generator.\n+\n+Example:\n+\n+  ```\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    create secret generic MY-DOMAINUID-runtime-encrypt-secret \\\n+    --from-literal=password=welcome1\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    label secret MY-DOMAINUID-runtime-encrypt-secret \\\n+    weblogic.domainUID=MY-DOMAINUID\n+  ```\n+\n+Corresponding domain resource snippet:\n+\n+  ```\n+  configuration:\n+    model:\n+      runtimeEncryptionSecret: MY-DOMAINUID-runtime-encrypt-secret\n+  ```\n+\n+#### 5. Secrets for model macros\n+\n+Create additional secrets as needed by macros in your model files. For example, these can store database URLs and credentials that are accessed using `@@SECRET` macros in your model that reference the secrets.  For a discussion of model macros, see [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+#### 6. Domain resource attributes\n+\n+The following domain resource attributes are specific to Model in Image domains.\n+\n+| Domain Resource Attribute                    |  Notes |\n+| -------------------------                    |  ------------------ |\n+| `domainHomeSourceType`                       |  Required. Set to `FromModel`. |\n+| `domainHome`                                 |  Must reference an empty or non-existent directory within your image. Do not include the mount path of any persistent volume. Note that Model in Image recreates the domain home for a WebLogic pod every time the pod restarts.|\n+| `configuration.model.configMap`             | Optional. Set if you have stored additional models in a config map as per [Optional WDT model config map](#3-optional-wdt-model-config-map). |\n+| `configuration.secrets`                      | Optional. Set this array if your image or config map models contain macros that reference custom Kubernetes secrets. For example, if your macros depend on secrets `my-secret` and `my-other-secret`, then set to `[my-secret, my-other-secret]`.|\n+| `configuration.model.runtimeEncryptionSecret`| Required. All Model in Image domains must specify a runtime encryption secret. See [Required runtime encryption secret](#4-required-runtime-encryption-secret). |\n+| `configuration.model.domainType`             | Set the type of domain. Valid values are `WLS`, `JRF`, and `RestrictedJRF` where `WLS` is the default. See [WDT Domain Types](https://github.com/oracle/weblogic-deploy-tooling/blob/master/site/type_def.md).|\n+\n+Notes:\n+\n+ - There are additional attributes that are common to all domain home source types, such as the `image` field. See the Domain Resource [schema](https://github.com/oracle/weblogic-kubernetes-operator/blob/master/docs/domains/Domain.md) and [documentation]({{< relref \"/userguide/managing-domains/domain-resource.md\" >}}) for a full list of domain resource fields.\n+\n+ - There are also additional fields that are specific to JRF domain types. For more information, see [Prerequisites for JRF domain types](#7-prerequisites-for-jrf-domain-types).\n+\n+ - Sample domain resource: For an example of a fully specified sample domain resource, see the the operator source's `kubernetes/samples/scripts/create-weblogic-domain/model-in-image/k8s-domain.yaml.template` file for the [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample. Note that the `@@` entries in this template are not processed by the operator; they need to replaced with actual values before the resource can be applied.\n+\n+#### 7. Prerequisites for JRF domain types\n+\n+{{% notice info %}} This section applies only for a `JRF` domain type. Skip it if your domain type is `WLS` or `RestrictedJRF`.\n+{{% /notice %}}\n+\n+A JRF domain requires an infrastructure database called an RCU database, initializing this database, and configuring your domain to access this database. All of these steps must occur before you first deploy your domain. When you first deploy your domain, the introspector job will initialize it's RCU schema tables in the database - a process that can take several minutes.\n+\n+Furthermore, if you want to safely ensure that a restarted JRF domain can access updates to the infrastructure database that the domain made at an earlier time, the original domain's wallet file must be safely saved as soon as practical, and the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain, as discussed in [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}).\n+\n+__Here are the required settings for Model in Image JRF domains:__\n+\n+- Set `configuration.model.domainType` to `JRF`.\n+\n+- Set `configuration.opss.walletPasswordSecret` to reference a secret that defines a `walletPassword` key. This is used to encrypt the domain's OPSS wallet file. This is a required field for JRF domains.\n+\n+- Set `configuration.opss.walletFileSecret` to reference a secret that contains your domain's OPSS wallet file in its `walletFile` key. This assumes you have an OPSS wallet file from a previous start of the same domain. It enables a restarted or migrated domain to access its RCU database information. For more information, see [Reusing an RCU database between domain deployments]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}). This is an optional field for JRF domains, but must always be set if you want a restarted or migrated domain to access its RCU database information.\n+\n+- Set the `configuration.introspectorJobActiveDeadlineSeconds` introspection job timeout to at least 300. This is in an optional field but is needed because domain home creation takes a considerable amount of time the first time a JRF domain is created (due to initializing the domain's RCU database tables), and because Model in Image creates your domain home for you using the introspection job.\n+\n+- Define an `RCUDbInfo` stanza in your model. Access to an RCU database requires defining a `RCUDbInfo` stanza in your model's `domainInfo` stanza with the necessary information for accessing the domain's schema within the database. Usually this information should be supplied using a secret that you deploy and reference in your domain resource's `configuration.secrets` field. Here's an example `RCUDbInfo` stanza:\n+\n+  ```\n+  domainInfo:\n+      RCUDbInfo:\n+          rcu_prefix:          '@@SECRET:sample-domain1-rcu-access/rcu_prefix@@'\n+          rcu_schema_password: '@@SECRET:sample-domain1-rcu-access/rcu_schema_password@@'\n+          rcu_db_conn_string:  '@@SECRET:sample-domain1-rcu-access/rcu_db_conn_string@@'\n+\n+  ```\n+\n+__Important instructions when changing an RCU schema password:__\n+\n+  {{% notice warning %}}\n+  Carefully follow these instructions in order to prevent unrecoverably locking up your RCU database schema account when changing your RCU schema password.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62c56ef60b39e04a56307f4ecdc3b3756bdbec7d"}, "originalPosition": 154}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "052184b0304ccd38cbce2ee30853df310456e698", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/052184b0304ccd38cbce2ee30853df310456e698", "committedDate": "2020-03-25T16:53:59Z", "message": "doc update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMzU5NjQ0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381359644", "createdAt": "2020-03-25T17:10:08Z", "commit": {"oid": "ea9dc9e2db65db8254da52355f83b6f2846a1efd"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNzoxMDowOFrOF7lgKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNzoxNDoyNlrOF7lszA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyNDc0Ng==", "bodyText": "so i read this, and it makes no sense to me - what is this file for? what are all these things in here? there is no explanation of what this is", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r398024746", "createdAt": "2020-03-25T17:10:08Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/model-files.md", "diffHunk": "@@ -0,0 +1,156 @@\n++++\n+title = \"Model files\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 30\n+pre = \"<b> </b>\"\n+description = \"Model file requirements, macros, and loading order.\"\n++++\n+\n+#### Contents\n+\n+ - [Introduction](#introduction)\n+ - [Sample model file](#sample-model-file)\n+ - [Important notes about Model in Image model files](#important-notes-about-model-in-image-model-files)\n+ - [Model file naming and loading order](#model-file-naming-and-loading-order)\n+ - [Model file macros](#model-file-macros)\n+   - [Using secrets in model files](#using-secrets-in-model-files)\n+   - [Using environment variables in model files](#using-environment-variables-in-model-files)\n+   - [Combining secrets and environment variables in model files](#combining-secrets-and-environment-variables-in-model-files)\n+\n+#### Introduction\n+\n+This document describes basic Model in Image model file syntax, naming, and macros. For additional information, see the [WebLogic Deploy Tool](https://github.com/oracle/weblogic-deploy-tooling) documentation.\n+\n+{{% notice tip %}} The WDT 'discover tool' is particularly useful for generating model files from an existing domain home.\n+{{% /notice %}}\n+\n+#### Sample model file\n+\n+Here's an example of a model `.yaml` file that defines a WebLogic Administration Server and dynamic cluster.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea9dc9e2db65db8254da52355f83b6f2846a1efd"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyNTQ3NQ==", "bodyText": "how do i know if i need that?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r398025475", "createdAt": "2020-03-25T17:11:00Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/model-files.md", "diffHunk": "@@ -0,0 +1,156 @@\n++++\n+title = \"Model files\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 30\n+pre = \"<b> </b>\"\n+description = \"Model file requirements, macros, and loading order.\"\n++++\n+\n+#### Contents\n+\n+ - [Introduction](#introduction)\n+ - [Sample model file](#sample-model-file)\n+ - [Important notes about Model in Image model files](#important-notes-about-model-in-image-model-files)\n+ - [Model file naming and loading order](#model-file-naming-and-loading-order)\n+ - [Model file macros](#model-file-macros)\n+   - [Using secrets in model files](#using-secrets-in-model-files)\n+   - [Using environment variables in model files](#using-environment-variables-in-model-files)\n+   - [Combining secrets and environment variables in model files](#combining-secrets-and-environment-variables-in-model-files)\n+\n+#### Introduction\n+\n+This document describes basic Model in Image model file syntax, naming, and macros. For additional information, see the [WebLogic Deploy Tool](https://github.com/oracle/weblogic-deploy-tooling) documentation.\n+\n+{{% notice tip %}} The WDT 'discover tool' is particularly useful for generating model files from an existing domain home.\n+{{% /notice %}}\n+\n+#### Sample model file\n+\n+Here's an example of a model `.yaml` file that defines a WebLogic Administration Server and dynamic cluster.\n+\n+```\n+domainInfo:\n+  AdminUserName: '@@SECRET:__weblogic-credentials__:username@@'\n+  AdminPassword: '@@SECRET:__weblogic-credentials__:password@@'\n+  ServerStartMode: 'prod'\n+\n+topology:\n+  Name: '@@ENV:DOMAIN_UID@@'\n+  AdminServerName: \"admin-server\"\n+  Cluster:\n+    \"cluster-1\":\n+      DynamicServers:\n+        ServerTemplate:  \"cluster-1-template\"\n+        ServerNamePrefix: \"managed-server\"\n+        DynamicClusterSize: 5\n+        MaxDynamicClusterSize: 5\n+        CalculatedListenPorts: false\n+  Server:\n+    \"admin-server\":\n+      ListenPort: 7001\n+  ServerTemplate:\n+    \"cluster-1-template\":\n+      Cluster: \"cluster-1\"\n+      ListenPort: 8001\n+```\n+\n+Some notes about the sample model file:\n+ - It includes a WebLogic credentials stanza that is required by Model in Image.\n+ - It derives its domain name from the pre-defined environment variable `DOMAIN_UID` but note that this is not required.\n+ - For a description of model file macro references to secrets and environment variables, see [Model file macros](#model-file-macros).\n+\n+#### Important notes about Model in Image model files\n+\n+- Understand when to use model macros.\n+\n+  - You can use model macros to reference arbitrary secrets from model files. This is recommended for handling mutable values such as database user names, passwords, and URLs. See **[Using secrets in model files](#using-secrets-in-model-files)**.\n+\n+    - All password fields in a model should use a secret macro. Passwords should not be directly included in property or model files because the files may appear in logs or debugging. \n+\n+    - Model files encrypted with the [WDT Encrypt Model Tool](https://github.com/oracle/weblogic-deploy-tooling/blob/master/site/encrypt.md) are not supported. Use secrets instead.\n+\n+  - You can use model macros to reference arbitrary environment variables from model files. This is useful for handling plain text mutable values that you can define using an `env` stanza in your domain resource, and is also useful for accessing the built in `DOMAIN_UID` environment variable. See [Using environment variables in model files](#using-environment-variables-in-model-files).\n+\n+  - For most models, it's useful to minimize or eliminate the usage of model variable files (also known as property files) and use secrets or environment variables instead.\n+\n+- A model __must__ contain a `domainInfo` stanza that references your WebLogic administrative credentials. You can use the `@@SECRET` macro with the reserved secret name `__weblogic-credentials__` to reference your domain resource's WebLogic credentials secret for this purpose. For example:\n+\n+    ```\n+    domainInfo:\n+      AdminUserName: '@@SECRET:__weblogic-credentials__:username@@'\n+      AdminPassword: '@@SECRET:__weblogic-credentials__:password@@'\n+    ```\n+- You can control the order that WDT uses to load your model files, see [Model file naming and loading order](#model-file-naming-and-loading-order).\n+\n+#### Model file naming and loading order\n+\n+Refer to this section if you need to control the order in which your model files are loaded.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea9dc9e2db65db8254da52355f83b6f2846a1efd"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyNjc1MQ==", "bodyText": "there is no such thing as \"an RCU database\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r398026751", "createdAt": "2020-03-25T17:12:46Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/reusing-rcu.md", "diffHunk": "@@ -0,0 +1,53 @@\n++++\n+title = \"Reusing an RCU database\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 70\n+pre = \"<b> </b>\"\n+description = \"Reusing an RCU database between deployments of a Model in Image JRF domain.\"\n++++\n+\n+#### Reusing an RCU database between JRF domain deployments", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "052184b0304ccd38cbce2ee30853df310456e698"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyNzI1Nw==", "bodyText": "the domain will add itself to its tables?\nawkward/confusing wording", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r398027257", "createdAt": "2020-03-25T17:13:29Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/reusing-rcu.md", "diffHunk": "@@ -0,0 +1,53 @@\n++++\n+title = \"Reusing an RCU database\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 70\n+pre = \"<b> </b>\"\n+description = \"Reusing an RCU database between deployments of a Model in Image JRF domain.\"\n++++\n+\n+#### Reusing an RCU database between JRF domain deployments\n+\n+{{% notice info %}} This section only applies for a JRF domain type. Skip it if your domain type is `WLS` or `Restricted JRF`.\n+{{% /notice %}}\n+\n+When you deploy a JRF domain for the first time, the domain will add itself to its RCU database tables, and also create a 'wallet' file in the domain's home directory that enables access to the domain's data in the RCU database. This wallet is encrypted using an OPSS key password that you supply to the domain using a secret.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "052184b0304ccd38cbce2ee30853df310456e698"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyNzc0Nw==", "bodyText": "you cant share the OPSS data between domains - not sure what this is talking about", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r398027747", "createdAt": "2020-03-25T17:14:07Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/reusing-rcu.md", "diffHunk": "@@ -0,0 +1,53 @@\n++++\n+title = \"Reusing an RCU database\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 70\n+pre = \"<b> </b>\"\n+description = \"Reusing an RCU database between deployments of a Model in Image JRF domain.\"\n++++\n+\n+#### Reusing an RCU database between JRF domain deployments\n+\n+{{% notice info %}} This section only applies for a JRF domain type. Skip it if your domain type is `WLS` or `Restricted JRF`.\n+{{% /notice %}}\n+\n+When you deploy a JRF domain for the first time, the domain will add itself to its RCU database tables, and also create a 'wallet' file in the domain's home directory that enables access to the domain's data in the RCU database. This wallet is encrypted using an OPSS key password that you supply to the domain using a secret.\n+\n+If it is important to reuse or share the same database and data between deployments of your domain, then it is also important locate and preserve its OPSS wallet password and wallet file. An OPSS wallet password and wallet file allows a JRF deployment to access a FMW infrastructure database that has already been initialized and used before.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "052184b0304ccd38cbce2ee30853df310456e698"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyNzk4MA==", "bodyText": "FMW Infrastructure has a capital I", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r398027980", "createdAt": "2020-03-25T17:14:26Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/reusing-rcu.md", "diffHunk": "@@ -0,0 +1,53 @@\n++++\n+title = \"Reusing an RCU database\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 70\n+pre = \"<b> </b>\"\n+description = \"Reusing an RCU database between deployments of a Model in Image JRF domain.\"\n++++\n+\n+#### Reusing an RCU database between JRF domain deployments\n+\n+{{% notice info %}} This section only applies for a JRF domain type. Skip it if your domain type is `WLS` or `Restricted JRF`.\n+{{% /notice %}}\n+\n+When you deploy a JRF domain for the first time, the domain will add itself to its RCU database tables, and also create a 'wallet' file in the domain's home directory that enables access to the domain's data in the RCU database. This wallet is encrypted using an OPSS key password that you supply to the domain using a secret.\n+\n+If it is important to reuse or share the same database and data between deployments of your domain, then it is also important locate and preserve its OPSS wallet password and wallet file. An OPSS wallet password and wallet file allows a JRF deployment to access a FMW infrastructure database that has already been initialized and used before.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAyNzc0Nw=="}, "originalCommit": {"oid": "052184b0304ccd38cbce2ee30853df310456e698"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a9e06aa840d5a65c26d91380586b547d566c876", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5a9e06aa840d5a65c26d91380586b547d566c876", "committedDate": "2020-03-25T17:37:11Z", "message": "add usage and friendlier syntax error reporting to MII sample create_secret.sh + create_configmap.sh, correct the usage text in opss_wallet_util.sh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04e242c66ffb7a2f94128ed709e6a1458553e02e", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/04e242c66ffb7a2f94128ed709e6a1458553e02e", "committedDate": "2020-03-25T17:37:23Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4530c8b7388ffc3eb88c08e74382503e743d89a4", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4530c8b7388ffc3eb88c08e74382503e743d89a4", "committedDate": "2020-03-25T17:52:12Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d391f06a731ab2b47409a4764044b0b3bb7893d", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4d391f06a731ab2b47409a4764044b0b3bb7893d", "committedDate": "2020-03-25T17:55:50Z", "message": "doc update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMzY3NzYz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381367763", "createdAt": "2020-03-25T17:19:11Z", "commit": {"oid": "052184b0304ccd38cbce2ee30853df310456e698"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNzoxOToxMVrOF7l6_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNzo1NjowOFrOF7nerA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAzMTYxMw==", "bodyText": "reading this, i was thinking \"and why would i do these things?\"\nseems to be a sentence missing above to provide context", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r398031613", "createdAt": "2020-03-25T17:19:11Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,558 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic Server Console](#optionally-access-the-weblogic-server-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and the model for a WebLogic domain configuration defined using a WDT model file.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "052184b0304ccd38cbce2ee30853df310456e698"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAzMjIxNw==", "bodyText": "10g should probably be 10 GB @rosemarymarano ?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r398032217", "createdAt": "2020-03-25T17:20:04Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3MzQ5Nw=="}, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA1NjA0NQ==", "bodyText": "dies -- ```$ p $SAMPLEDIR/run_domain.sh\n@@ Info: Running 'run_domain.sh'.\n@@ Info: WORKDIR='/home/mark/operator/mii/work'.\n@@ Info: Deleting weblogic domain 'sample-domain1' if it already exists\n\nkubectl -n sample-domain1-ns delete domain sample-domain1 --ignore-not-found\n@@ Info: Creating weblogic domain secret\nError from server (NotFound): namespaces \"sample-domain1-ns\" not found", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r398056045", "createdAt": "2020-03-25T17:54:37Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,558 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic Server Console](#optionally-access-the-weblogic-server-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and the model for a WebLogic domain configuration defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   We will refer to this environment variable later in this document.\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+   We will refer to this environment variable later in this document.\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+   We will refer to this environment variable later in this document, and it is used by the sample scripts. If you do not set this environement variable, then the sample scripts will default to `/tmp/$USER/model-in-image-sample-work-dir` where `$USER` is your user name.\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__\n+\n+     Set up access to this sample's base WebLogic image at the [Oracle Container Registry](http://container-registry.oracle.com):\n+\n+     a. Use a browser to access [Oracle Container Registry](http://container-registry.oracle.com).\n+\n+     b. Choose an image location:\n+       - For `JRF` and `RestrictedJRF` domains, select `Middleware`, then `fmw-infrastructure`.\n+       - For `WLS` domains, select `Middleware`, then `weblogic`.\n+\n+     c. Select Sign In and accept the license agreement.\n+\n+     d. Use your terminal to locally log in to Docker: `docker login container-registry.oracle.com`.\n+\n+     e. Later, when you run the sample, it will call `docker pull` for your base image based on the domain type.\n+       - For `JRF` and `RestrictedJRF`, it will pull `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4`.\n+       - For `WLS`, it will pull `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n+\n+   - __Option 2, create your own WebLogic base image.__\n+\n+     Alternatively, you can create your own base image and override the sample's default base image name and tag by exporting the `BASE_IMAGE_NAME` and `BASE_IMAGE_TAG` environment variables prior to running the sample scripts. If you want to create your own base image, see [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}).\n+\n+8. If you are using a `JRF` domain type, then it requires an RCU infrastructure database. See [Prerequisites for JRF Domains](#prerequisites-for-jrf-domains).\n+\n+> __NOTE__: Skip to section [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if you're not using a `JRF` domain type.\n+\n+### Prerequisites for JRF domains\n+\n+> __NOTE__: This section is only required for demonstrating a `JRF` domain type. Skip this section and proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if your domain type is `WLS` or `RestrictedJRF`.\n+\n+A JRF domain requires an infrastructure database called an RCU database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain.\n+\n+The following steps demonstrate how to set up an infrastructure database that will work with this sample:\n+\n+  1. [Set up and initialize an RCU database](#set-up-and-initialize-an-rcu-database).\n+  2. [Increase introspection job timeout](#increase-introspection-job-timeout).\n+  3. [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets).\n+  4. [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables).\n+\n+\n+\n+##### Set up and initialize an RCU database\n+\n+A JRF domain requires an infrastructure database and also requires initializing this database with a schema and a set of tables. The following example shows how to set up a sample RCU database and use the RCU tool to create the infrastructure schema for a JRF domain. The RCU database is set up with the following attributes:\n+\n+| Attribute | Value |\n+| --------- | ----- |\n+| database Kubernetes namespace | `default` |\n+| database Kubernetes pod | `oracle-db` |\n+| database image | `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` |\n+| database password | `Oradoc_db1` |\n+| infrastructure schema prefix | `FMW1` |\n+| infrastructure schema password | `Oradoc_db1` |\n+| database URL | `oracle-db.default.svc.cluster.local:1521/devpdb.k8s` |\n+\n+\n+1. Ensure you have access to the database image, and then deploy it:\n+\n+   - Use a browser to log in to `https://container-registry.oracle.com`, select `database->enterprise` and accept the license agreement.\n+\n+   - Get the database image:\n+     - In the local shell, `docker login container-registry.oracle.com`.\n+     - In the local shell, `docker pull container-registry.oracle.com/database/enterprise:12.2.0.1-slim`.\n+\n+\n+       {{% notice note %}} If a local Docker login and manual pull of `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` is not sufficient (for example, if you are using a remote Kubernetes cluster), then uncomment the `imagePullSecrets` stanza in `$WORKDIR/k8s-db-slim.yaml` and create the image pull secret as follows:\n+\n+              ```\n+              kubectl create secret docker-registry regsecret \\\n+                --docker-server=container-registry.oracle.com \\\n+                --docker-username=your.email@some.com \\\n+                --docker-password=your-password \\\n+                --docker-email=your.email@some.com\n+              ```\n+       {{% /notice %}}\n+\n+\n+   - Use the sample script in `$SRCDIR/kubernetes/samples/scripts/create-oracle-db-service` to create an Oracle database running in the pod, `oracle-db`.\n+\n+      **NOTE**: If your database image access requires the `regsecret` image pull secret that you optionally created above, then pass `-s regsecret` to the `start-db-service.sh` command line.\n+\n+     ```\n+     cd $SRCDIR/kubernetes/samples/scripts/create-oracle-db-service\n+     start-db-service.sh\n+     ```\n+\n+     This script will deploy a database with the URL, `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`, and administration password, `Oradoc_db1`.\n+\n+     {{% notice warning %}} The Oracle Database Docker images are supported only for non-production use. For more details, see My Oracle Support note: Oracle Support for Database Running on Docker (Doc ID 2216342.1) : All the data is gone when the database is restarted.\n+     {{% /notice %}}\n+\n+     **NOTE**: This step is based on the steps documented in [Run a Database](https://oracle.github.io/weblogic-kubernetes-operator/userguide/overview/database/).\n+\n+2. Use the sample script in `SRCDIR/kubernetes/samples/scripts/create-rcu-schema` to create the RCU schema with the schema prefix `FMW1`.\n+\n+   Note that this script assumes `Oradoc_db1` is the DBA password, `Oradoc_db1` is the schema password, and that the database URL is `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`.\n+\n+   ```\n+   cd $SRCDIR/kubernetes/samples/scripts/create-rcu-schema\n+   ./create-rcu-schema.sh -s FMW1 -i container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4\n+   ```\n+\n+   __NOTE__:  If you need to drop the repository, use this command:\n+\n+   ```\n+   drop-rcu-schema.sh -s FMW1\n+   ```\n+\n+\n+##### Increase introspection job timeout\n+\n+Because JRF domain home creation takes a considerable amount of time the first time it is created, and because Model in Image creates your domain home for you using the introspection job, you should increase the timeout for the introspection job. Use the `configuration.introspectorJobActiveDeadlineSeconds` in `k8s-domain.yaml.template` to override the default with a value of at least 300 seconds (the default is 120 seconds).  \n+\n+##### Set up RCU model attributes, domain resource attributes, and secrets\n+\n+To allow Model in Image to access the RCU database and OPSS wallet, it's necessary to set up an RCU access secret and an OPSS secret before deploying your domain. It's also necessary to define an `RCUDbInfo` stanza in your model. The sample already sets up all of these for you.  See:\n+\n+| Sample file | Description |\n+| --------- | ----- |\n+| `run_domain.sh` | Defines secret, `sample-domain1-opss-wallet-password-secret`, with `password=welcome1`. |\n+| `run_domain.sh` | Defines secret, `sample-domain1-rcu-access`, with appropriate values for attributes `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string`. |\n+| `model1.yaml.jrf` | Populates the `domainInfo -> RCUDbInfo` stanza `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string` attributes by referencing their locations in the `sample-domain1-rcu-access` secret. The `build.sh` script uses this model instead of `model.yaml.wls` when the source domain type is `JRF`. |\n+| `k8s-domain.yaml.template` | Ensures that the domain mounts the OPSS key secret by setting the domain resource `configuration.opss.walletPasswordSecret` attribute to `sample-domain1-opss-wallet-password-secret`, and ensures the domain mounts the RCU access secret, `sample-domain1-rcu-access`, for reference by WDT model macros by setting the domain resource `configuration.secrets` attribute. |\n+| `k8s-domain.yaml.template` | Set `configuration.introspectorJobActiveDeadlineSeconds` to 300; see [Increase introspection job timeout](#increase-introspection-job-timeout). |\n+\n+ **NOTE**: This step is for information purposes only. Do not run the above sample files directly. The sample's main build and run scripts will run them for you.\n+\n+##### Reusing or sharing RCU tables\n+\n+Note that when you succesfully deploy your JRF domain resource for the first time, the introspector job will initialize the RCU tables for the domain using the `domainInfo -> RCUDbInfo` stanza in the WDT model plus the `configuration.opss.walletPasswordSecret` specified in the domain resource. The job will also create a new domain home. Finally, the operator will also capture an OPSS wallet file from the new domain's local directory and place this file in a new Kubernetes config map.\n+\n+There are scenarios when the domain needs to be re-created between updates such as WebLogic credentials are changed, security roles defined in the WDT model have been changed or you want to share the same RCU tables with different domains.  Under these scenarios, the operator needs the `walletPasswordSecret` as well as the OPSS wallet file, together with the exact information in `domainInfo -> RCUDbInfo` so that the domain can be re-created and access the same set of RCU tables.  Without the wallet file and wallet password, you will not be able to re-create a domain accessing the same set of RCU tables, therefore it is highly recommended to backup the wallet file.\n+\n+To recover a domain's RCU tables between domain restarts or to share an RCU schema between different domains, it is necessary to extract this wallet file from the config map and save the OPSS wallet password secret that was used for the original domain. The wallet password and wallet file are needed again when you recreate the domain or share the database with other domains.\n+\n+To save the wallet file:\n+\n+```\n+    opss_wallet_util.sh -s [-wf <name of the wallet file. Default ./ewallet.p12>]\n+```\n+\n+You should back up this file to a safe location that can be retrieved later.\n+\n+To reuse the wallet for subsequent redeployments or share the RCU tables between different domains:\n+\n+1. Store the wallet in a secret:\n+\n+```\n+    opss_wallet_util.sh -r [-wf <name of the wallet file. Default ./ewallet.p12>] [-ws <name of the secret. Default DOMAIN_UID-opss-walletfile-secret> ]\n+\n+```\n+\n+2. Modify the domain resource YAML file to provide the secret names:\n+\n+```\n+  configuration:\n+    opss:\n+      # Name of secret with walletPassword for extracting the wallet\n+      walletPasswordSecret: sample-domain1-opss-wallet-password-secret      \n+      # Name of secret with walletFile containing base64 encoded opss wallet\n+      walletFileSecret: sample-domain1-opss-walletfile-secret\n+\n+```\n+\n+See [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}) for instructions.\n+\n+### Use the WebLogic Image Tool to create an image\n+\n+A Model in Image image must contain a WebLogic install, a WebLogic Deploy Tool install, and your WDT model files. You can use the sample `./build.sh` script to build this image, which will perform the following steps for you:\n+\n+  - Uses `docker pull` to obtain a base image which already contains a WebLogic install. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types) to set up access to the base image.)\n+  - Downloads the latest WebLogic Image Tool and WebLogic Deploy Tool to `WORKDIR`.\n+  - Creates and populates a staging directory `$WORKDIR/models` that contains your WDT model files and WDT application archive.\n+    - Builds  a simple servlet application in `$SAMPLEDIR/sample_app` into a WDT model application archive `$WORKDIR/models/archive1.zip`.\n+    - Copies sample model files from `$SAMPLEDIR/model-in-image` to `$WORKDIR/models`. This uses a model file that is appropriate to the domain type (for example, the `JRF` domain model includes database access configuration).\n+  - Uses the WebLogic Image Tool and the `$WORKDIR/models` staging directory to create a final image named `model-in-image:v1` that layers on the base image. Specifically, it runs the WebLogic Image Tool with its `update` option, which:\n+    - Builds the final image as a layer on the base image.\n+    - Puts a WDT install in image location, `/u01/wdt/weblogic-deploy`.\n+    - Copies the WDT model, properties, and application archive from `$WORDKIR/models` to image location, `/u01/wdt/models`.\n+\n+The script expects `JAVA_HOME`, `WDT_DOMAIN_TYPE`, and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/build.sh\n+  ```\n+\n+If you intend to use a remote Docker registry, you need to tag and push the image to the remote Docker registry.\n+\n+1.  Tag the image for the remote Docker registry, for example:\n+\n+```\n+docker tag model-in-image:v1 my.remote.registry.com/model-in-image:v1\n+```\n+\n+2.  Push the image to the remote Docker registry, for example:\n+\n+```\n+docker push my.remote.registry.com/model-in-image:v1\n+```\n+\n+3. Create the pull secret for the remote Docker registry:\n+\n+```\n+ kubectl -n <domain namespace> create secret docker-registry <secret name> \\\n+     --docker-server=my.remote.registry.com \\\n+     --docker-username=your.email@some.com \\\n+     --docker-password=your-password \\\n+     --docker-email=your.email@some.com\n+\n+```\n+\n+4. Update the domain template file `$SAMPLEDIR/k8s-domain.yaml.template` to provide the `imagePullSecrets`:\n+\n+```\n+  imagePullSecrets:\n+  - name: <secret name>\n+\n+```\n+\n+This domain template file will be used in the next step ([Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)) when it creates your final domain resource file.\n+\n+5. Export the environment variables for the image name and tag using the same values in step 1:\n+\n+```\n+export MODEL_IMAGE_NAME=\"my.remote.registry.com/model-in-image\"\n+export MODEL_IMAGE_TAG=\"v1\"\n+```\n+\n+These environment variables will be used in the next step ([Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)) when it creates your final domain resource file.\n+\n+### Create and deploy your Kubernetes resources\n+\n+To deploy the sample operator domain and its required Kubernetes resources, use the sample script, `$SAMPLEDIR/run_domain.sh`, which will perform the following steps for you:\n+\n+  - Deletes the domain with a `DomainUID` of `domain1` in the namespace, `sample-domain1-ns`, if it already exists.\n+  - Creates a secret containing your WebLogic administrator user name and password.\n+  - Creates a secret containing your Model in Image runtime encryption password:\n+    - All model-in-image domains must supply a runtime encryption secret with a `password` value.\n+    - It is used to encrypt configuration that is passed around internally by the Operator.\n+    - The value must be kept private but can be arbitrary: you can optionally supply a different secret value every time you restart the domain.\n+  - Creates secrets containing your RCU access URL, credentials, and prefix (these are unused unless the domain type is `JRF`).\n+  - Creates a config map containing an additional WDT model properties file, `$SAMPLEDIR/model1.20.properties`.\n+  - Generates a domain resource YAML file, `$WORKDIR/k8s-domain.yaml`, using `$SAMPLEDIR/k8s-domain.yaml.template`.\n+  - Deploys `k8s-domain.yaml`.\n+  - Displays the status of the domain pods.\n+\n+The script expects `WDT_DOMAIN_TYPE` and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/run_domain.sh\n+  ```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "052184b0304ccd38cbce2ee30853df310456e698"}, "originalPosition": 354}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA1NjQ3NQ==", "bodyText": "i had to create the ns first", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r398056475", "createdAt": "2020-03-25T17:55:13Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,558 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic Server Console](#optionally-access-the-weblogic-server-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and the model for a WebLogic domain configuration defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   We will refer to this environment variable later in this document.\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+   We will refer to this environment variable later in this document.\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+   We will refer to this environment variable later in this document, and it is used by the sample scripts. If you do not set this environement variable, then the sample scripts will default to `/tmp/$USER/model-in-image-sample-work-dir` where `$USER` is your user name.\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__\n+\n+     Set up access to this sample's base WebLogic image at the [Oracle Container Registry](http://container-registry.oracle.com):\n+\n+     a. Use a browser to access [Oracle Container Registry](http://container-registry.oracle.com).\n+\n+     b. Choose an image location:\n+       - For `JRF` and `RestrictedJRF` domains, select `Middleware`, then `fmw-infrastructure`.\n+       - For `WLS` domains, select `Middleware`, then `weblogic`.\n+\n+     c. Select Sign In and accept the license agreement.\n+\n+     d. Use your terminal to locally log in to Docker: `docker login container-registry.oracle.com`.\n+\n+     e. Later, when you run the sample, it will call `docker pull` for your base image based on the domain type.\n+       - For `JRF` and `RestrictedJRF`, it will pull `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4`.\n+       - For `WLS`, it will pull `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n+\n+   - __Option 2, create your own WebLogic base image.__\n+\n+     Alternatively, you can create your own base image and override the sample's default base image name and tag by exporting the `BASE_IMAGE_NAME` and `BASE_IMAGE_TAG` environment variables prior to running the sample scripts. If you want to create your own base image, see [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}).\n+\n+8. If you are using a `JRF` domain type, then it requires an RCU infrastructure database. See [Prerequisites for JRF Domains](#prerequisites-for-jrf-domains).\n+\n+> __NOTE__: Skip to section [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if you're not using a `JRF` domain type.\n+\n+### Prerequisites for JRF domains\n+\n+> __NOTE__: This section is only required for demonstrating a `JRF` domain type. Skip this section and proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if your domain type is `WLS` or `RestrictedJRF`.\n+\n+A JRF domain requires an infrastructure database called an RCU database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain.\n+\n+The following steps demonstrate how to set up an infrastructure database that will work with this sample:\n+\n+  1. [Set up and initialize an RCU database](#set-up-and-initialize-an-rcu-database).\n+  2. [Increase introspection job timeout](#increase-introspection-job-timeout).\n+  3. [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets).\n+  4. [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables).\n+\n+\n+\n+##### Set up and initialize an RCU database\n+\n+A JRF domain requires an infrastructure database and also requires initializing this database with a schema and a set of tables. The following example shows how to set up a sample RCU database and use the RCU tool to create the infrastructure schema for a JRF domain. The RCU database is set up with the following attributes:\n+\n+| Attribute | Value |\n+| --------- | ----- |\n+| database Kubernetes namespace | `default` |\n+| database Kubernetes pod | `oracle-db` |\n+| database image | `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` |\n+| database password | `Oradoc_db1` |\n+| infrastructure schema prefix | `FMW1` |\n+| infrastructure schema password | `Oradoc_db1` |\n+| database URL | `oracle-db.default.svc.cluster.local:1521/devpdb.k8s` |\n+\n+\n+1. Ensure you have access to the database image, and then deploy it:\n+\n+   - Use a browser to log in to `https://container-registry.oracle.com`, select `database->enterprise` and accept the license agreement.\n+\n+   - Get the database image:\n+     - In the local shell, `docker login container-registry.oracle.com`.\n+     - In the local shell, `docker pull container-registry.oracle.com/database/enterprise:12.2.0.1-slim`.\n+\n+\n+       {{% notice note %}} If a local Docker login and manual pull of `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` is not sufficient (for example, if you are using a remote Kubernetes cluster), then uncomment the `imagePullSecrets` stanza in `$WORKDIR/k8s-db-slim.yaml` and create the image pull secret as follows:\n+\n+              ```\n+              kubectl create secret docker-registry regsecret \\\n+                --docker-server=container-registry.oracle.com \\\n+                --docker-username=your.email@some.com \\\n+                --docker-password=your-password \\\n+                --docker-email=your.email@some.com\n+              ```\n+       {{% /notice %}}\n+\n+\n+   - Use the sample script in `$SRCDIR/kubernetes/samples/scripts/create-oracle-db-service` to create an Oracle database running in the pod, `oracle-db`.\n+\n+      **NOTE**: If your database image access requires the `regsecret` image pull secret that you optionally created above, then pass `-s regsecret` to the `start-db-service.sh` command line.\n+\n+     ```\n+     cd $SRCDIR/kubernetes/samples/scripts/create-oracle-db-service\n+     start-db-service.sh\n+     ```\n+\n+     This script will deploy a database with the URL, `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`, and administration password, `Oradoc_db1`.\n+\n+     {{% notice warning %}} The Oracle Database Docker images are supported only for non-production use. For more details, see My Oracle Support note: Oracle Support for Database Running on Docker (Doc ID 2216342.1) : All the data is gone when the database is restarted.\n+     {{% /notice %}}\n+\n+     **NOTE**: This step is based on the steps documented in [Run a Database](https://oracle.github.io/weblogic-kubernetes-operator/userguide/overview/database/).\n+\n+2. Use the sample script in `SRCDIR/kubernetes/samples/scripts/create-rcu-schema` to create the RCU schema with the schema prefix `FMW1`.\n+\n+   Note that this script assumes `Oradoc_db1` is the DBA password, `Oradoc_db1` is the schema password, and that the database URL is `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`.\n+\n+   ```\n+   cd $SRCDIR/kubernetes/samples/scripts/create-rcu-schema\n+   ./create-rcu-schema.sh -s FMW1 -i container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4\n+   ```\n+\n+   __NOTE__:  If you need to drop the repository, use this command:\n+\n+   ```\n+   drop-rcu-schema.sh -s FMW1\n+   ```\n+\n+\n+##### Increase introspection job timeout\n+\n+Because JRF domain home creation takes a considerable amount of time the first time it is created, and because Model in Image creates your domain home for you using the introspection job, you should increase the timeout for the introspection job. Use the `configuration.introspectorJobActiveDeadlineSeconds` in `k8s-domain.yaml.template` to override the default with a value of at least 300 seconds (the default is 120 seconds).  \n+\n+##### Set up RCU model attributes, domain resource attributes, and secrets\n+\n+To allow Model in Image to access the RCU database and OPSS wallet, it's necessary to set up an RCU access secret and an OPSS secret before deploying your domain. It's also necessary to define an `RCUDbInfo` stanza in your model. The sample already sets up all of these for you.  See:\n+\n+| Sample file | Description |\n+| --------- | ----- |\n+| `run_domain.sh` | Defines secret, `sample-domain1-opss-wallet-password-secret`, with `password=welcome1`. |\n+| `run_domain.sh` | Defines secret, `sample-domain1-rcu-access`, with appropriate values for attributes `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string`. |\n+| `model1.yaml.jrf` | Populates the `domainInfo -> RCUDbInfo` stanza `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string` attributes by referencing their locations in the `sample-domain1-rcu-access` secret. The `build.sh` script uses this model instead of `model.yaml.wls` when the source domain type is `JRF`. |\n+| `k8s-domain.yaml.template` | Ensures that the domain mounts the OPSS key secret by setting the domain resource `configuration.opss.walletPasswordSecret` attribute to `sample-domain1-opss-wallet-password-secret`, and ensures the domain mounts the RCU access secret, `sample-domain1-rcu-access`, for reference by WDT model macros by setting the domain resource `configuration.secrets` attribute. |\n+| `k8s-domain.yaml.template` | Set `configuration.introspectorJobActiveDeadlineSeconds` to 300; see [Increase introspection job timeout](#increase-introspection-job-timeout). |\n+\n+ **NOTE**: This step is for information purposes only. Do not run the above sample files directly. The sample's main build and run scripts will run them for you.\n+\n+##### Reusing or sharing RCU tables\n+\n+Note that when you succesfully deploy your JRF domain resource for the first time, the introspector job will initialize the RCU tables for the domain using the `domainInfo -> RCUDbInfo` stanza in the WDT model plus the `configuration.opss.walletPasswordSecret` specified in the domain resource. The job will also create a new domain home. Finally, the operator will also capture an OPSS wallet file from the new domain's local directory and place this file in a new Kubernetes config map.\n+\n+There are scenarios when the domain needs to be re-created between updates such as WebLogic credentials are changed, security roles defined in the WDT model have been changed or you want to share the same RCU tables with different domains.  Under these scenarios, the operator needs the `walletPasswordSecret` as well as the OPSS wallet file, together with the exact information in `domainInfo -> RCUDbInfo` so that the domain can be re-created and access the same set of RCU tables.  Without the wallet file and wallet password, you will not be able to re-create a domain accessing the same set of RCU tables, therefore it is highly recommended to backup the wallet file.\n+\n+To recover a domain's RCU tables between domain restarts or to share an RCU schema between different domains, it is necessary to extract this wallet file from the config map and save the OPSS wallet password secret that was used for the original domain. The wallet password and wallet file are needed again when you recreate the domain or share the database with other domains.\n+\n+To save the wallet file:\n+\n+```\n+    opss_wallet_util.sh -s [-wf <name of the wallet file. Default ./ewallet.p12>]\n+```\n+\n+You should back up this file to a safe location that can be retrieved later.\n+\n+To reuse the wallet for subsequent redeployments or share the RCU tables between different domains:\n+\n+1. Store the wallet in a secret:\n+\n+```\n+    opss_wallet_util.sh -r [-wf <name of the wallet file. Default ./ewallet.p12>] [-ws <name of the secret. Default DOMAIN_UID-opss-walletfile-secret> ]\n+\n+```\n+\n+2. Modify the domain resource YAML file to provide the secret names:\n+\n+```\n+  configuration:\n+    opss:\n+      # Name of secret with walletPassword for extracting the wallet\n+      walletPasswordSecret: sample-domain1-opss-wallet-password-secret      \n+      # Name of secret with walletFile containing base64 encoded opss wallet\n+      walletFileSecret: sample-domain1-opss-walletfile-secret\n+\n+```\n+\n+See [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}) for instructions.\n+\n+### Use the WebLogic Image Tool to create an image\n+\n+A Model in Image image must contain a WebLogic install, a WebLogic Deploy Tool install, and your WDT model files. You can use the sample `./build.sh` script to build this image, which will perform the following steps for you:\n+\n+  - Uses `docker pull` to obtain a base image which already contains a WebLogic install. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types) to set up access to the base image.)\n+  - Downloads the latest WebLogic Image Tool and WebLogic Deploy Tool to `WORKDIR`.\n+  - Creates and populates a staging directory `$WORKDIR/models` that contains your WDT model files and WDT application archive.\n+    - Builds  a simple servlet application in `$SAMPLEDIR/sample_app` into a WDT model application archive `$WORKDIR/models/archive1.zip`.\n+    - Copies sample model files from `$SAMPLEDIR/model-in-image` to `$WORKDIR/models`. This uses a model file that is appropriate to the domain type (for example, the `JRF` domain model includes database access configuration).\n+  - Uses the WebLogic Image Tool and the `$WORKDIR/models` staging directory to create a final image named `model-in-image:v1` that layers on the base image. Specifically, it runs the WebLogic Image Tool with its `update` option, which:\n+    - Builds the final image as a layer on the base image.\n+    - Puts a WDT install in image location, `/u01/wdt/weblogic-deploy`.\n+    - Copies the WDT model, properties, and application archive from `$WORDKIR/models` to image location, `/u01/wdt/models`.\n+\n+The script expects `JAVA_HOME`, `WDT_DOMAIN_TYPE`, and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/build.sh\n+  ```\n+\n+If you intend to use a remote Docker registry, you need to tag and push the image to the remote Docker registry.\n+\n+1.  Tag the image for the remote Docker registry, for example:\n+\n+```\n+docker tag model-in-image:v1 my.remote.registry.com/model-in-image:v1\n+```\n+\n+2.  Push the image to the remote Docker registry, for example:\n+\n+```\n+docker push my.remote.registry.com/model-in-image:v1\n+```\n+\n+3. Create the pull secret for the remote Docker registry:\n+\n+```\n+ kubectl -n <domain namespace> create secret docker-registry <secret name> \\\n+     --docker-server=my.remote.registry.com \\\n+     --docker-username=your.email@some.com \\\n+     --docker-password=your-password \\\n+     --docker-email=your.email@some.com\n+\n+```\n+\n+4. Update the domain template file `$SAMPLEDIR/k8s-domain.yaml.template` to provide the `imagePullSecrets`:\n+\n+```\n+  imagePullSecrets:\n+  - name: <secret name>\n+\n+```\n+\n+This domain template file will be used in the next step ([Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)) when it creates your final domain resource file.\n+\n+5. Export the environment variables for the image name and tag using the same values in step 1:\n+\n+```\n+export MODEL_IMAGE_NAME=\"my.remote.registry.com/model-in-image\"\n+export MODEL_IMAGE_TAG=\"v1\"\n+```\n+\n+These environment variables will be used in the next step ([Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)) when it creates your final domain resource file.\n+\n+### Create and deploy your Kubernetes resources\n+\n+To deploy the sample operator domain and its required Kubernetes resources, use the sample script, `$SAMPLEDIR/run_domain.sh`, which will perform the following steps for you:\n+\n+  - Deletes the domain with a `DomainUID` of `domain1` in the namespace, `sample-domain1-ns`, if it already exists.\n+  - Creates a secret containing your WebLogic administrator user name and password.\n+  - Creates a secret containing your Model in Image runtime encryption password:\n+    - All model-in-image domains must supply a runtime encryption secret with a `password` value.\n+    - It is used to encrypt configuration that is passed around internally by the Operator.\n+    - The value must be kept private but can be arbitrary: you can optionally supply a different secret value every time you restart the domain.\n+  - Creates secrets containing your RCU access URL, credentials, and prefix (these are unused unless the domain type is `JRF`).\n+  - Creates a config map containing an additional WDT model properties file, `$SAMPLEDIR/model1.20.properties`.\n+  - Generates a domain resource YAML file, `$WORKDIR/k8s-domain.yaml`, using `$SAMPLEDIR/k8s-domain.yaml.template`.\n+  - Deploys `k8s-domain.yaml`.\n+  - Displays the status of the domain pods.\n+\n+The script expects `WDT_DOMAIN_TYPE` and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/run_domain.sh\n+  ```", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA1NjA0NQ=="}, "originalCommit": {"oid": "052184b0304ccd38cbce2ee30853df310456e698"}, "originalPosition": 354}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA1NzEzMg==", "bodyText": "after that it failes with this:\n@@ Info: Running 'create_domain.sh'.\n@@ Info: WORKDIR='/home/mark/operator/mii/work'.\n@@ Info: Creating domain resource file '/home/mark/operator/mii/work/k8s-domain.yaml' from '/home/mark/operator/mii/weblogic-kubernetes-operator/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/k8s-domain.yaml.template'\nsed: -e expression #1, char 36: unknown option to `s'", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r398057132", "createdAt": "2020-03-25T17:56:08Z", "author": {"login": "markxnelson"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,558 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic Server Console](#optionally-access-the-weblogic-server-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and the model for a WebLogic domain configuration defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   We will refer to this environment variable later in this document.\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+   We will refer to this environment variable later in this document.\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+   We will refer to this environment variable later in this document, and it is used by the sample scripts. If you do not set this environement variable, then the sample scripts will default to `/tmp/$USER/model-in-image-sample-work-dir` where `$USER` is your user name.\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__\n+\n+     Set up access to this sample's base WebLogic image at the [Oracle Container Registry](http://container-registry.oracle.com):\n+\n+     a. Use a browser to access [Oracle Container Registry](http://container-registry.oracle.com).\n+\n+     b. Choose an image location:\n+       - For `JRF` and `RestrictedJRF` domains, select `Middleware`, then `fmw-infrastructure`.\n+       - For `WLS` domains, select `Middleware`, then `weblogic`.\n+\n+     c. Select Sign In and accept the license agreement.\n+\n+     d. Use your terminal to locally log in to Docker: `docker login container-registry.oracle.com`.\n+\n+     e. Later, when you run the sample, it will call `docker pull` for your base image based on the domain type.\n+       - For `JRF` and `RestrictedJRF`, it will pull `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4`.\n+       - For `WLS`, it will pull `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n+\n+   - __Option 2, create your own WebLogic base image.__\n+\n+     Alternatively, you can create your own base image and override the sample's default base image name and tag by exporting the `BASE_IMAGE_NAME` and `BASE_IMAGE_TAG` environment variables prior to running the sample scripts. If you want to create your own base image, see [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}).\n+\n+8. If you are using a `JRF` domain type, then it requires an RCU infrastructure database. See [Prerequisites for JRF Domains](#prerequisites-for-jrf-domains).\n+\n+> __NOTE__: Skip to section [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if you're not using a `JRF` domain type.\n+\n+### Prerequisites for JRF domains\n+\n+> __NOTE__: This section is only required for demonstrating a `JRF` domain type. Skip this section and proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if your domain type is `WLS` or `RestrictedJRF`.\n+\n+A JRF domain requires an infrastructure database called an RCU database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain.\n+\n+The following steps demonstrate how to set up an infrastructure database that will work with this sample:\n+\n+  1. [Set up and initialize an RCU database](#set-up-and-initialize-an-rcu-database).\n+  2. [Increase introspection job timeout](#increase-introspection-job-timeout).\n+  3. [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets).\n+  4. [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables).\n+\n+\n+\n+##### Set up and initialize an RCU database\n+\n+A JRF domain requires an infrastructure database and also requires initializing this database with a schema and a set of tables. The following example shows how to set up a sample RCU database and use the RCU tool to create the infrastructure schema for a JRF domain. The RCU database is set up with the following attributes:\n+\n+| Attribute | Value |\n+| --------- | ----- |\n+| database Kubernetes namespace | `default` |\n+| database Kubernetes pod | `oracle-db` |\n+| database image | `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` |\n+| database password | `Oradoc_db1` |\n+| infrastructure schema prefix | `FMW1` |\n+| infrastructure schema password | `Oradoc_db1` |\n+| database URL | `oracle-db.default.svc.cluster.local:1521/devpdb.k8s` |\n+\n+\n+1. Ensure you have access to the database image, and then deploy it:\n+\n+   - Use a browser to log in to `https://container-registry.oracle.com`, select `database->enterprise` and accept the license agreement.\n+\n+   - Get the database image:\n+     - In the local shell, `docker login container-registry.oracle.com`.\n+     - In the local shell, `docker pull container-registry.oracle.com/database/enterprise:12.2.0.1-slim`.\n+\n+\n+       {{% notice note %}} If a local Docker login and manual pull of `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` is not sufficient (for example, if you are using a remote Kubernetes cluster), then uncomment the `imagePullSecrets` stanza in `$WORKDIR/k8s-db-slim.yaml` and create the image pull secret as follows:\n+\n+              ```\n+              kubectl create secret docker-registry regsecret \\\n+                --docker-server=container-registry.oracle.com \\\n+                --docker-username=your.email@some.com \\\n+                --docker-password=your-password \\\n+                --docker-email=your.email@some.com\n+              ```\n+       {{% /notice %}}\n+\n+\n+   - Use the sample script in `$SRCDIR/kubernetes/samples/scripts/create-oracle-db-service` to create an Oracle database running in the pod, `oracle-db`.\n+\n+      **NOTE**: If your database image access requires the `regsecret` image pull secret that you optionally created above, then pass `-s regsecret` to the `start-db-service.sh` command line.\n+\n+     ```\n+     cd $SRCDIR/kubernetes/samples/scripts/create-oracle-db-service\n+     start-db-service.sh\n+     ```\n+\n+     This script will deploy a database with the URL, `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`, and administration password, `Oradoc_db1`.\n+\n+     {{% notice warning %}} The Oracle Database Docker images are supported only for non-production use. For more details, see My Oracle Support note: Oracle Support for Database Running on Docker (Doc ID 2216342.1) : All the data is gone when the database is restarted.\n+     {{% /notice %}}\n+\n+     **NOTE**: This step is based on the steps documented in [Run a Database](https://oracle.github.io/weblogic-kubernetes-operator/userguide/overview/database/).\n+\n+2. Use the sample script in `SRCDIR/kubernetes/samples/scripts/create-rcu-schema` to create the RCU schema with the schema prefix `FMW1`.\n+\n+   Note that this script assumes `Oradoc_db1` is the DBA password, `Oradoc_db1` is the schema password, and that the database URL is `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`.\n+\n+   ```\n+   cd $SRCDIR/kubernetes/samples/scripts/create-rcu-schema\n+   ./create-rcu-schema.sh -s FMW1 -i container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4\n+   ```\n+\n+   __NOTE__:  If you need to drop the repository, use this command:\n+\n+   ```\n+   drop-rcu-schema.sh -s FMW1\n+   ```\n+\n+\n+##### Increase introspection job timeout\n+\n+Because JRF domain home creation takes a considerable amount of time the first time it is created, and because Model in Image creates your domain home for you using the introspection job, you should increase the timeout for the introspection job. Use the `configuration.introspectorJobActiveDeadlineSeconds` in `k8s-domain.yaml.template` to override the default with a value of at least 300 seconds (the default is 120 seconds).  \n+\n+##### Set up RCU model attributes, domain resource attributes, and secrets\n+\n+To allow Model in Image to access the RCU database and OPSS wallet, it's necessary to set up an RCU access secret and an OPSS secret before deploying your domain. It's also necessary to define an `RCUDbInfo` stanza in your model. The sample already sets up all of these for you.  See:\n+\n+| Sample file | Description |\n+| --------- | ----- |\n+| `run_domain.sh` | Defines secret, `sample-domain1-opss-wallet-password-secret`, with `password=welcome1`. |\n+| `run_domain.sh` | Defines secret, `sample-domain1-rcu-access`, with appropriate values for attributes `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string`. |\n+| `model1.yaml.jrf` | Populates the `domainInfo -> RCUDbInfo` stanza `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string` attributes by referencing their locations in the `sample-domain1-rcu-access` secret. The `build.sh` script uses this model instead of `model.yaml.wls` when the source domain type is `JRF`. |\n+| `k8s-domain.yaml.template` | Ensures that the domain mounts the OPSS key secret by setting the domain resource `configuration.opss.walletPasswordSecret` attribute to `sample-domain1-opss-wallet-password-secret`, and ensures the domain mounts the RCU access secret, `sample-domain1-rcu-access`, for reference by WDT model macros by setting the domain resource `configuration.secrets` attribute. |\n+| `k8s-domain.yaml.template` | Set `configuration.introspectorJobActiveDeadlineSeconds` to 300; see [Increase introspection job timeout](#increase-introspection-job-timeout). |\n+\n+ **NOTE**: This step is for information purposes only. Do not run the above sample files directly. The sample's main build and run scripts will run them for you.\n+\n+##### Reusing or sharing RCU tables\n+\n+Note that when you succesfully deploy your JRF domain resource for the first time, the introspector job will initialize the RCU tables for the domain using the `domainInfo -> RCUDbInfo` stanza in the WDT model plus the `configuration.opss.walletPasswordSecret` specified in the domain resource. The job will also create a new domain home. Finally, the operator will also capture an OPSS wallet file from the new domain's local directory and place this file in a new Kubernetes config map.\n+\n+There are scenarios when the domain needs to be re-created between updates such as WebLogic credentials are changed, security roles defined in the WDT model have been changed or you want to share the same RCU tables with different domains.  Under these scenarios, the operator needs the `walletPasswordSecret` as well as the OPSS wallet file, together with the exact information in `domainInfo -> RCUDbInfo` so that the domain can be re-created and access the same set of RCU tables.  Without the wallet file and wallet password, you will not be able to re-create a domain accessing the same set of RCU tables, therefore it is highly recommended to backup the wallet file.\n+\n+To recover a domain's RCU tables between domain restarts or to share an RCU schema between different domains, it is necessary to extract this wallet file from the config map and save the OPSS wallet password secret that was used for the original domain. The wallet password and wallet file are needed again when you recreate the domain or share the database with other domains.\n+\n+To save the wallet file:\n+\n+```\n+    opss_wallet_util.sh -s [-wf <name of the wallet file. Default ./ewallet.p12>]\n+```\n+\n+You should back up this file to a safe location that can be retrieved later.\n+\n+To reuse the wallet for subsequent redeployments or share the RCU tables between different domains:\n+\n+1. Store the wallet in a secret:\n+\n+```\n+    opss_wallet_util.sh -r [-wf <name of the wallet file. Default ./ewallet.p12>] [-ws <name of the secret. Default DOMAIN_UID-opss-walletfile-secret> ]\n+\n+```\n+\n+2. Modify the domain resource YAML file to provide the secret names:\n+\n+```\n+  configuration:\n+    opss:\n+      # Name of secret with walletPassword for extracting the wallet\n+      walletPasswordSecret: sample-domain1-opss-wallet-password-secret      \n+      # Name of secret with walletFile containing base64 encoded opss wallet\n+      walletFileSecret: sample-domain1-opss-walletfile-secret\n+\n+```\n+\n+See [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}) for instructions.\n+\n+### Use the WebLogic Image Tool to create an image\n+\n+A Model in Image image must contain a WebLogic install, a WebLogic Deploy Tool install, and your WDT model files. You can use the sample `./build.sh` script to build this image, which will perform the following steps for you:\n+\n+  - Uses `docker pull` to obtain a base image which already contains a WebLogic install. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types) to set up access to the base image.)\n+  - Downloads the latest WebLogic Image Tool and WebLogic Deploy Tool to `WORKDIR`.\n+  - Creates and populates a staging directory `$WORKDIR/models` that contains your WDT model files and WDT application archive.\n+    - Builds  a simple servlet application in `$SAMPLEDIR/sample_app` into a WDT model application archive `$WORKDIR/models/archive1.zip`.\n+    - Copies sample model files from `$SAMPLEDIR/model-in-image` to `$WORKDIR/models`. This uses a model file that is appropriate to the domain type (for example, the `JRF` domain model includes database access configuration).\n+  - Uses the WebLogic Image Tool and the `$WORKDIR/models` staging directory to create a final image named `model-in-image:v1` that layers on the base image. Specifically, it runs the WebLogic Image Tool with its `update` option, which:\n+    - Builds the final image as a layer on the base image.\n+    - Puts a WDT install in image location, `/u01/wdt/weblogic-deploy`.\n+    - Copies the WDT model, properties, and application archive from `$WORDKIR/models` to image location, `/u01/wdt/models`.\n+\n+The script expects `JAVA_HOME`, `WDT_DOMAIN_TYPE`, and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/build.sh\n+  ```\n+\n+If you intend to use a remote Docker registry, you need to tag and push the image to the remote Docker registry.\n+\n+1.  Tag the image for the remote Docker registry, for example:\n+\n+```\n+docker tag model-in-image:v1 my.remote.registry.com/model-in-image:v1\n+```\n+\n+2.  Push the image to the remote Docker registry, for example:\n+\n+```\n+docker push my.remote.registry.com/model-in-image:v1\n+```\n+\n+3. Create the pull secret for the remote Docker registry:\n+\n+```\n+ kubectl -n <domain namespace> create secret docker-registry <secret name> \\\n+     --docker-server=my.remote.registry.com \\\n+     --docker-username=your.email@some.com \\\n+     --docker-password=your-password \\\n+     --docker-email=your.email@some.com\n+\n+```\n+\n+4. Update the domain template file `$SAMPLEDIR/k8s-domain.yaml.template` to provide the `imagePullSecrets`:\n+\n+```\n+  imagePullSecrets:\n+  - name: <secret name>\n+\n+```\n+\n+This domain template file will be used in the next step ([Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)) when it creates your final domain resource file.\n+\n+5. Export the environment variables for the image name and tag using the same values in step 1:\n+\n+```\n+export MODEL_IMAGE_NAME=\"my.remote.registry.com/model-in-image\"\n+export MODEL_IMAGE_TAG=\"v1\"\n+```\n+\n+These environment variables will be used in the next step ([Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)) when it creates your final domain resource file.\n+\n+### Create and deploy your Kubernetes resources\n+\n+To deploy the sample operator domain and its required Kubernetes resources, use the sample script, `$SAMPLEDIR/run_domain.sh`, which will perform the following steps for you:\n+\n+  - Deletes the domain with a `DomainUID` of `domain1` in the namespace, `sample-domain1-ns`, if it already exists.\n+  - Creates a secret containing your WebLogic administrator user name and password.\n+  - Creates a secret containing your Model in Image runtime encryption password:\n+    - All model-in-image domains must supply a runtime encryption secret with a `password` value.\n+    - It is used to encrypt configuration that is passed around internally by the Operator.\n+    - The value must be kept private but can be arbitrary: you can optionally supply a different secret value every time you restart the domain.\n+  - Creates secrets containing your RCU access URL, credentials, and prefix (these are unused unless the domain type is `JRF`).\n+  - Creates a config map containing an additional WDT model properties file, `$SAMPLEDIR/model1.20.properties`.\n+  - Generates a domain resource YAML file, `$WORKDIR/k8s-domain.yaml`, using `$SAMPLEDIR/k8s-domain.yaml.template`.\n+  - Deploys `k8s-domain.yaml`.\n+  - Displays the status of the domain pods.\n+\n+The script expects `WDT_DOMAIN_TYPE` and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/run_domain.sh\n+  ```", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA1NjA0NQ=="}, "originalCommit": {"oid": "052184b0304ccd38cbce2ee30853df310456e698"}, "originalPosition": 354}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "effa05a219d187168288e72d9c5475f18d115efe", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/effa05a219d187168288e72d9c5475f18d115efe", "committedDate": "2020-03-25T18:50:36Z", "message": "fix to handle image names with '/' in them in create_domain.sh sample script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e15eefd1a0a24919416d0e8950fa1785a628d040", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e15eefd1a0a24919416d0e8950fa1785a628d040", "committedDate": "2020-03-25T19:25:39Z", "message": "remove mention of unused var from build_image_model.sh sample script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87a0f1f29796898d9c6ecd6a39f0fba28fe8f5a8", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/87a0f1f29796898d9c6ecd6a39f0fba28fe8f5a8", "committedDate": "2020-03-25T20:22:00Z", "message": "Fix help text in create_configmap.sh helper script."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a38367da0a7460ca107c3d376c6a1c51ed9f826", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2a38367da0a7460ca107c3d376c6a1c51ed9f826", "committedDate": "2020-03-25T20:50:42Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a673eb04eda35524c4edc146ae9608d71837909", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1a673eb04eda35524c4edc146ae9608d71837909", "committedDate": "2020-03-25T20:54:24Z", "message": "Put the domain name back if present"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "493ccafaf8069be6bd3a13cad35f0521c9d4d0da", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/493ccafaf8069be6bd3a13cad35f0521c9d4d0da", "committedDate": "2020-03-25T20:55:09Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e6769eb6d5297b711f54c4edfb3a22c82ba4348", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8e6769eb6d5297b711f54c4edfb3a22c82ba4348", "committedDate": "2020-03-25T20:55:52Z", "message": "remove printing the model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92dc7bd2cb10529455e6c79c0c56ce2c3bc75b33", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/92dc7bd2cb10529455e6c79c0c56ce2c3bc75b33", "committedDate": "2020-03-26T17:06:08Z", "message": "Correct configmap data is not inserted into the flow after it's read."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "397a65de0a3ae8b8a380003dda866a7bbee80796", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/397a65de0a3ae8b8a380003dda866a7bbee80796", "committedDate": "2020-03-26T17:58:39Z", "message": "Minor change to Operator.properties\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f22f97c2ed7ad25f34b38a75d0ca1912317bb53", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1f22f97c2ed7ad25f34b38a75d0ca1912317bb53", "committedDate": "2020-03-26T19:38:39Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6266991c26ea38adbc777dfa98b69fac6743ce8", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a6266991c26ea38adbc777dfa98b69fac6743ce8", "committedDate": "2020-03-26T19:47:42Z", "message": "remove debug code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "192939b3b39521734257dc61f98289b864c5a71b", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/192939b3b39521734257dc61f98289b864c5a71b", "committedDate": "2020-03-27T00:21:10Z", "message": "minor help text correction for create_configmap.sh sample script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bcd9cefb852057d0ecb6291b30fef40b0c97849", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2bcd9cefb852057d0ecb6291b30fef40b0c97849", "committedDate": "2020-03-27T00:21:27Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98353983987192325498f6a3ffdc8a786f65490c", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/98353983987192325498f6a3ffdc8a786f65490c", "committedDate": "2020-03-27T21:45:26Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd90f050704c251bf41e239a99a484dc09bb2365", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/cd90f050704c251bf41e239a99a484dc09bb2365", "committedDate": "2020-03-27T21:49:17Z", "message": "doc update (#1509)\n\n* doc update\r\n\r\n* doc update\r\n\r\n* doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90a8c4e3dd0f8f382bf88bdf9a6e6fdc7102a668", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/90a8c4e3dd0f8f382bf88bdf9a6e6fdc7102a668", "committedDate": "2020-03-27T21:50:10Z", "message": "MII: avoid deploying/referencing JRF secrets for non-JRF domain types, it's too confusing (#1507)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf5ffc4a58b6c3df685f752ab5791cc912233eca", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/cf5ffc4a58b6c3df685f752ab5791cc912233eca", "committedDate": "2020-03-27T21:51:15Z", "message": "doc update (#1510)\n\n* doc update\r\n\r\n* doc update\r\n\r\n* doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06a91867b90c54a2e5844dce43892bad067bf14c", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/06a91867b90c54a2e5844dce43892bad067bf14c", "committedDate": "2020-03-27T21:52:28Z", "message": "update ci/cd doc for mii (#1502)\n\n* update ci/cd doc for mii\r\n\r\n* first pass edits\r\n\r\n* doc update\r\n\r\n* doc update\r\n\r\nCo-authored-by: Rosemary Marano <rosemary.marano@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b23e490cdf956acdcafa59f0288d573ffc9cd5c", "author": {"user": {"login": "markxnelson", "name": "Mark Nelson"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3b23e490cdf956acdcafa59f0288d573ffc9cd5c", "committedDate": "2020-03-31T00:50:08Z", "message": "cherry pick 1517 from develop"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "867c5287ac0eabf6cf78319ad39b804e172b28ac", "author": {"user": {"login": "hzhao-github", "name": "Huiling Zhao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/867c5287ac0eabf6cf78319ad39b804e172b28ac", "committedDate": "2020-03-31T19:13:44Z", "message": "two automated test case for Wdt Config Update w single Model File jenkins-ignore (#1495)\n\n* The first test case for OWLS-80444 Automate Wdt Config Override with single Model File jenkins-ignore\r\n\r\n* Modified TestUtils.java jenkins-ignore\r\n\r\n* Added python file to verify JDBC DS prop in server pod jenkins-ignore\r\n\r\n* Changes b ased on the comments jenkins-ignore\r\n\r\n* Added the 2nd test case jenkins-ignore\r\n\r\n* Used patch domain to restart domain jenkins-ignore\r\n\r\n* Changed test case names jenkins-ignore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cdd5cd60d6b5349895630c10c5f840b3634bcf56", "author": {"user": {"login": "sankarpn", "name": "Sankar Periyathambi Neelakandan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/cdd5cd60d6b5349895630c10c5f840b3634bcf56", "committedDate": "2020-04-01T13:17:44Z", "message": "adding config delete and app delete tests using mode file (#1521)\n\n* adding config update tests\r\n\r\n* add config and app delete tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "193c4f30fa7eaa6a474b42414e1cb49c609b8c5f", "author": {"user": {"login": "jshum2479", "name": "Johnny Shum"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/193c4f30fa7eaa6a474b42414e1cb49c609b8c5f", "committedDate": "2020-04-03T13:51:56Z", "message": "Model in image namefixes (#1515)\n\n* Fix for PR1478\r\n\r\n* add more traces and minor update\r\n\r\nCo-authored-by: Johnny Shum <cbdream99@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2723ab2208945cdf4cb8275c34d6996843bf1250", "author": {"user": {"login": "jshum2479", "name": "Johnny Shum"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2723ab2208945cdf4cb8275c34d6996843bf1250", "committedDate": "2020-04-03T13:52:12Z", "message": "Missing secret dir fix (#1525)\n\n* Add temporary work around for WDT return non-zero rc if secret directory doesn't exist.\r\n\r\n* Change per WDT fix for no more default for custom secrets mount\r\n\r\nCo-authored-by: Johnny Shum <cbdream99@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f9225247231add8fca45faf2ed746a03daa4586", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8f9225247231add8fca45faf2ed746a03daa4586", "committedDate": "2020-04-03T16:24:16Z", "message": "Merge remote-tracking branch 'origin/develop' into develop-mii-merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bcd53d66efab573f0302382fe5a44248bb1bf66", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7bcd53d66efab573f0302382fe5a44248bb1bf66", "committedDate": "2020-04-03T18:57:29Z", "message": "Update rest_domainqualtrue.yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fba26b44cac5faa1670ea2f4cb3341031de8765", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1fba26b44cac5faa1670ea2f4cb3341031de8765", "committedDate": "2020-04-03T18:58:54Z", "message": "Update OperatorUtils.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47b3a69883f9c734dde8558040b362830c2ca87b", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/47b3a69883f9c734dde8558040b362830c2ca87b", "committedDate": "2020-04-03T19:00:13Z", "message": "Update OperatorUtils.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "099ec582c55dbede5d11d8ed329b433a5d735d41", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/099ec582c55dbede5d11d8ed329b433a5d735d41", "committedDate": "2020-04-03T21:17:54Z", "message": "removing commented/incomplete test code (#1533)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d85da51c9f15d3b5e25cf4637e87f925f0b70af", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7d85da51c9f15d3b5e25cf4637e87f925f0b70af", "committedDate": "2020-04-03T22:09:08Z", "message": "Merge from develop to model-in-image with conflict resolution (#1531)\n\n* OWLS-80522 Domain status ordering, OWLS-80144 Ordered rolling upgrade (#1503)\r\n\r\n* Domain.getServers() should return servers in order\r\n\r\n* ordered rolling upgrade\r\n\r\n* minor test fix\r\n\r\n* new RollingHelperTest\r\n\r\n* update getSortingString to handle up to 20 digits\r\n\r\n* rolling upgrade clusters sorted by cluster names\r\n\r\n* add isAdminServer to ServerStatus\r\n\r\n* ServerStatus isAdminServer excluded from json schema\r\n\r\n* ClusterStatus sorted by sorting name\r\n\r\n* getClusters returning sorted clusters\r\n\r\n* add unit tests\r\n\r\n* handle null map\r\n\r\n* Enhance Helm chart deletion Logic in cleanup.sh Script   (#1517)\r\n\r\n* Enhance the clean up Script to support Helm 2/3\r\n\r\n* Addressed the review comment\r\n\r\nCo-authored-by: ANTARYAMI.PANIGRAHI@ORACLE.COM <anpanigr@anpanigr-1.subnet1ad2phx.devweblogicphx.oraclevcn.com>\r\n\r\n* Added test for domainQualifier=true, added cleanup for intermittent failures (#1513)\r\n\r\n* added support for helm 3.0\r\n\r\n* added check for repo\r\n\r\n* moved from monitoring ns\r\n\r\n* added the test\r\n\r\n* fixed style\r\n\r\n* added missed file\r\n\r\n* added condition for ver\r\n\r\n* rework to avoid interm failures\r\n\r\n* fixed docs\r\n\r\n* updated version of MonExp\r\n\r\n* Stub the ApiClient in tests that get connections but where this was not already done. (#1519)\r\n\r\n* Enhance the cleanup script to include deletion of few namesapce(s) created by Integration Tests (#1523)\r\n\r\nCo-authored-by: ANTARYAMI.PANIGRAHI@ORACLE.COM <anpanigr@anpanigr-1.subnet1ad2phx.devweblogicphx.oraclevcn.com>\r\n\r\n* overall doc edits (#1518)\r\n\r\n* overall doc edits\r\n\r\n* fix a mistake I created\r\n\r\n* update Kubernetes prereqs\r\n\r\n* incorporate edits from Ryan and Mark\r\n\r\n* fix typo\r\n\r\n* fix my mistake\r\n\r\n* minor fixes\r\n\r\n* Disable preserveUnknownFields\r\n\r\n* Update rest_domainqualtrue.yml\r\n\r\n* Update OperatorUtils.java\r\n\r\n* Update OperatorUtils.java\r\n\r\nCo-authored-by: Anthony Lai <anthony.lai@oracle.com>\r\nCo-authored-by: Antaryami Panigrahi <31135902+anpanigr@users.noreply.github.com>\r\nCo-authored-by: ANTARYAMI.PANIGRAHI@ORACLE.COM <anpanigr@anpanigr-1.subnet1ad2phx.devweblogicphx.oraclevcn.com>\r\nCo-authored-by: Marina Kogan <marina.kogan@oracle.com>\r\nCo-authored-by: Rosemary Marano <rosemary.marano@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53e1fc3154785e97feed965076f03c3319b2be77", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/53e1fc3154785e97feed965076f03c3319b2be77", "committedDate": "2020-04-03T22:11:06Z", "message": "Merge remote-tracking branch 'origin/develop-mii-merge' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "754c924a17b69ccc8fa8357f78d4a09a0ea1373b", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/754c924a17b69ccc8fa8357f78d4a09a0ea1373b", "committedDate": "2020-04-03T22:11:31Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f2886948f25cda604186f3bd73bda120fc3e30b", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9f2886948f25cda604186f3bd73bda120fc3e30b", "committedDate": "2020-04-03T22:18:00Z", "message": "Fix javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c5fb5ae3b29686cb2ee3278a8f455963e1c1053", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9c5fb5ae3b29686cb2ee3278a8f455963e1c1053", "committedDate": "2020-04-04T19:16:13Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "617bf2ba9544174d7b6b5500a7501c5cb15b4654", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/617bf2ba9544174d7b6b5500a7501c5cb15b4654", "committedDate": "2020-04-06T14:46:58Z", "message": "fix broken anchor links (#1540)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c43d74fd57f7eed4e46fb9e678194b26ae136e18", "author": {"user": {"login": "anpanigr", "name": "Antaryami Panigrahi"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c43d74fd57f7eed4e46fb9e678194b26ae136e18", "committedDate": "2020-04-06T18:53:07Z", "message": "Updated model files to user @@SECRET macro; added sparce jms/wldf mod\u2026 (#1529)\n\n* Updated model files to user @@SECRET macro; added sparce jms/wldf model files\r\n\r\n* Added Copyright Statements\r\n\r\n* Missing CopyRight\r\n\r\n* Resync the branch and removed work-around\r\n\r\n* Addressed review comment\r\n\r\nCo-authored-by: ANTARYAMI.PANIGRAHI@ORACLE.COM <anpanigr@anpanigr-1.subnet1ad2phx.devweblogicphx.oraclevcn.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00062d88fb18318622d13f29a0a02e8df19f089d", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/00062d88fb18318622d13f29a0a02e8df19f089d", "committedDate": "2020-04-06T21:57:44Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1b8fded1b8cfa38d019c524e79947eb88c1e416", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a1b8fded1b8cfa38d019c524e79947eb88c1e416", "committedDate": "2020-04-07T21:21:52Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d51cdd4aadda47d45f614d08748d0ea6f010a65", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9d51cdd4aadda47d45f614d08748d0ea6f010a65", "committedDate": "2020-04-08T17:09:03Z", "message": "Correct merge of cleanup.sh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e07c5d45d42208df3058f5e07565e8b1f35687ea", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e07c5d45d42208df3058f5e07565e8b1f35687ea", "committedDate": "2020-04-10T13:38:34Z", "message": "entire site doc edits (#1551)\n\n* entire site doc edits\r\n\r\n* sentence perfection"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6465266ecd02c89330ef3bb1dbd19d1e55a639ad", "author": {"user": {"login": "hzhao-github", "name": "Huiling Zhao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6465266ecd02c89330ef3bb1dbd19d1e55a639ad", "committedDate": "2020-04-10T14:00:08Z", "message": "Added two more tests to cover config update by creating an image w a new tag  (#1528)\n\n* Added two more tests to cover config update by creating an image with a new tag jenkins-ignore\r\n\r\n* Changes for the comments jenkins-ignore\r\n\r\n* Changed logs jenkins-ignore"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6e6a7655b26576a88bd6aa3320b788b1aa48b5d", "author": {"user": {"login": "jshum2479", "name": "Johnny Shum"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d6e6a7655b26576a88bd6aa3320b788b1aa48b5d", "committedDate": "2020-04-10T14:27:34Z", "message": "Mii introspect test (#1530)\n\n* for mii\r\n\r\n* MII updates\r\n\r\n* add wdt configmap mount\r\n\r\n* remove image and wdt configmap first\r\n\r\n* correct script error\r\n\r\n* update model values\r\n\r\n* update properties value\r\n\r\n* template the mii mount and make it optional\r\n\r\n* Making override cm optional\r\n\r\n* revert\r\n\r\n* update the models\r\n\r\n* remove introspectMIITest.sh\r\n\r\n* update secret key\r\n\r\n* clean up\r\n\r\n* clean up workdir\r\n\r\n* Fix missing secret and cleanup\r\n\r\n* Incorporate Tom's changes\r\n\r\n* refresh from model-in-image\r\n\r\n* various changes for the PR\r\n\r\n* fix zip output\r\n\r\n* fix script error\r\n\r\n* correct archive location\r\n\r\n* push no-effect change\r\n\r\n* move WDT_DOMAIN_TYPE to yamlt\r\n\r\n* update for PR\r\n\r\n* fix test for MII\r\n\r\n* Remove custom overrides and adjust overrides test.\r\n\r\n* Update script and readme\r\n\r\n* minor fixes\r\n\r\n* hide k8s output\r\n\r\n* Fix copyright\r\n\r\n* Fix copyright\r\n\r\n* Fix copyright\r\n\r\n* Fix copyright\r\n\r\n* updated copyrights\r\n\r\n* Add copyrights\r\n\r\n* update from model-in-image\r\n\r\nCo-authored-by: Johnny Shum <cbdream99@gmail.com>\r\nCo-authored-by: Ryan Eberhard <ryan.eberhard@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55ba070a8f13b5cde15c4fca9ef5273522f4b84c", "author": {"user": {"login": "markxnelson", "name": "Mark Nelson"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/55ba070a8f13b5cde15c4fca9ef5273522f4b84c", "committedDate": "2020-04-10T15:05:08Z", "message": "fix log format (#1553)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNTk4ODcx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-380598871", "createdAt": "2020-03-24T18:43:19Z", "commit": {"oid": "03cfb0b64df7a60893e19bb0a11fc80286351290"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxODo0MzoyMFrOF6-Q6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxODo0MzoyMFrOF6-Q6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzM4MTg2NQ==", "bodyText": "Okay, this is the wrong spot for this.  Reminder to myself to relocate as a property.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397381865", "createdAt": "2020-03-24T18:43:20Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/java/oracle/kubernetes/operator/work/Packet.java", "diffHunk": "@@ -15,6 +15,7 @@\n   private final ConcurrentMap<String, Component> components =\n       new ConcurrentHashMap<String, Component>();\n   private final ConcurrentMap<String, Object> delegate = new ConcurrentHashMap<String, Object>();\n+  private boolean isDynamicUpdate = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03cfb0b64df7a60893e19bb0a11fc80286351290"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9432fba0794d460069fe8a92d7fd57d9d207b57", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c9432fba0794d460069fe8a92d7fd57d9d207b57", "committedDate": "2020-03-24T19:42:06Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceffd5d5373bb40ceb5cafd70dbdaa7b7b4adf7b", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ceffd5d5373bb40ceb5cafd70dbdaa7b7b4adf7b", "committedDate": "2020-03-24T19:45:02Z", "message": "clean up sample descriptor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1d82b208e369ad5fa6d6b7c4c3e437141567cb4", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a1d82b208e369ad5fa6d6b7c4c3e437141567cb4", "committedDate": "2020-03-24T19:47:35Z", "message": "Update Operator.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0010e11e4d00918e9b22d2725ca7341e6da5a051", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0010e11e4d00918e9b22d2725ca7341e6da5a051", "committedDate": "2020-03-24T20:00:56Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1aeb3d5f08198fbae7f97381795e8abd80fcb25d", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1aeb3d5f08198fbae7f97381795e8abd80fcb25d", "committedDate": "2020-03-24T20:01:06Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59e829314113917c3c9ba8d95422c8ea8f095355", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/59e829314113917c3c9ba8d95422c8ea8f095355", "committedDate": "2020-03-24T20:01:26Z", "message": "Removed unused field"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed4ac9415084fda37ac6f6a3e547ae9aa7d4f3d3", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ed4ac9415084fda37ac6f6a3e547ae9aa7d4f3d3", "committedDate": "2020-03-24T20:01:35Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d986b3e00490d255b9e7b741c9c2128b5b71d6b", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5d986b3e00490d255b9e7b741c9c2128b5b71d6b", "committedDate": "2020-03-24T20:09:26Z", "message": "edit new choose a model doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1f8dbbe58aef46fb4fd330f1d6eca1f34ed930e", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d1f8dbbe58aef46fb4fd330f1d6eca1f34ed930e", "committedDate": "2020-03-24T20:09:50Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjYzOTk4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-380663998", "createdAt": "2020-03-24T20:17:55Z", "commit": {"oid": "5d986b3e00490d255b9e7b741c9c2128b5b71d6b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDoxNzo1NVrOF7BdHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDoxNzo1NVrOF7BdHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQzNDE0Mg==", "bodyText": "@tbarnes-us I used your title suggestion but it seems a bit clunky to me. If \"Choose a Model\" is no longer accurate, would \"Choose a domain home type\" or \"Choose a domain home source\" work?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397434142", "createdAt": "2020-03-24T20:17:55Z", "author": {"login": "rosemarymarano"}, "path": "docs-source/content/userguide/managing-domains/choosing-a-model/_index.md", "diffHunk": "@@ -1,5 +1,5 @@\n +++\n-title = \"Choose a model\"\n+title = \"Choose a domain home source type\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d986b3e00490d255b9e7b741c9c2128b5b71d6b"}, "originalPosition": 3}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjY0MDcx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-380664071", "createdAt": "2020-03-24T20:18:02Z", "commit": {"oid": "d1f8dbbe58aef46fb4fd330f1d6eca1f34ed930e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDoxODowMlrOF7BdWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDoxODowMlrOF7BdWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQzNDIwMg==", "bodyText": "Copyright is incorrect -- No more \"All rights reserved.\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397434202", "createdAt": "2020-03-24T20:18:02Z", "author": {"login": "rjeberhard"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/model-in-image/build.sh", "diffHunk": "@@ -0,0 +1,37 @@\n+#!/bin/bash\n+# Copyright (c) 2019, 2020, Oracle Corporation and/or its affiliates. All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1f8dbbe58aef46fb4fd330f1d6eca1f34ed930e"}, "originalPosition": 2}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb5f89eda50a85f5d6797c0fce0bbb572344399c", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/bb5f89eda50a85f5d6797c0fce0bbb572344399c", "committedDate": "2020-03-24T20:47:22Z", "message": "Minor doc fix - address review comment\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1221bf5084a9305f341625e33f748e97a300b5f9", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1221bf5084a9305f341625e33f748e97a300b5f9", "committedDate": "2020-03-24T20:49:02Z", "message": "Fix copyrights"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "336d597545f5fb98aef48a856778050938888ff8", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/336d597545f5fb98aef48a856778050938888ff8", "committedDate": "2020-03-24T20:49:12Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjkxMzUx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-380691351", "createdAt": "2020-03-24T20:58:38Z", "commit": {"oid": "336d597545f5fb98aef48a856778050938888ff8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDo1ODozOFrOF7C1Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMDo1ODozOFrOF7C1Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ1NjY1NQ==", "bodyText": "Typo - \"Let's you\".", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397456655", "createdAt": "2020-03-24T20:58:38Z", "author": {"login": "doxiao"}, "path": "docs-source/content/userguide/managing-domains/choosing-a-model/_index.md", "diffHunk": "@@ -1,23 +1,31 @@\n +++\n-title = \"Choose a model\"\n+title = \"Choose a domain home source type\"\n date = 2019-02-23T16:44:54-05:00\n weight = 1\n pre = \"<b> </b>\"\n +++\n \n-When using the operator, a WebLogic domain can be located either in a persistent volume (PV) or in a Docker image.\n-There are advantages to both approaches, and there are sometimes technical limitations of various\n-cloud providers that may make one approach better suited to your needs.\n-You can also mix and match on a domain-by-domain basis.\n+> TBD/WIP: This is a work in progress. Please do not post review comments here.\n \n-| Domain on a persistent volume | Domain in a Docker image |\n-| --- | --- |\n-| Let's you use the same standard read-only Docker image for every server in every domain. | Requires a different image for each domain, but all servers in that domain use the same image. |\n-| No state is kept in Docker images making them completely throw away (cattle not pets). | Runtime state should not be kept in the images, but applications and configuration are. |\n-| The domain is long-lived, so you can mutate the configuration or deploy new applications using standard methods (Administration Console, WLST, and such). | If you want to mutate the domain configuration or deploy application updates, you must create a new image. |\n-| Logs are automatically placed on persistent storage.  | Logs are kept in the images, and sent to the pod's log (stdout) unless you manually place them on persistent storage.  |\n-| Patches can be applied by simply changing the image and rolling the domain.  | To apply patches, you must create a new domain-specific image and then roll the domain.  |\n-| Many cloud providers do not provide persistent volumes that are shared across availability zones, so you may not be able to use a single persistent volume.  You may need to use some kind of volume replication technology or a clustered file system. | You do not have to worry about volume replication across availability zones since each pod has its own copy of the domain.  WebLogic replication will handle propagation of any online configuration changes.  |\n-| CI/CD pipelines may be more complicated because you would probably need to run WLST against the live domain directory to effect changes.  | CI/CD pipelines are simpler because you can create the whole domain in the image and don't have to worry about a persistent copy of the domain.  |\n-| There are less images to manage and store, which could provide significant storage and network savings.  |  There are more images to manage and store in this approach. |\n-| You may be able to use standard Oracle-provided images or, at least, a very small number of self-built images, for example, with patches installed. | You may need to do more work to set up processes to build and maintain your images. |\n+> TBD/WIP: Change 'configuration overrides' to a link throughout. Anything else need links?\n+\n+When using the operator to deploy a WebLogic domain, you have the choice of the following WebLogic domain home source types:\n+\n+ - **Domain in PV**: Supply your domain home configuration in a persistent volume (Domain in PV).\n+ - **Domain in Image**: Supply your domain home in a Docker image (Domain in Image).\n+ - **Model in Image**: Supply a WebLogic Deployment Tool model file in a Docker image (Model in Image).\n+\n+There are advantages to all approaches, and there are sometimes technical limitations of various cloud providers that may make one approach better suited to your needs.  You can also mix and match on a domain-by-domain basis.\n+\n+| Domain in PV | Domain in Image | Model in Image |\n+| --- | --- | --- |\n+| Let's you use the same standard read-only Docker image for every server in every domain. | Requires a different image for each domain, but all servers in that domain use the same image. | Same as Domain in Image. |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "336d597545f5fb98aef48a856778050938888ff8"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzAzMTg2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-380703186", "createdAt": "2020-03-24T21:17:08Z", "commit": {"oid": "336d597545f5fb98aef48a856778050938888ff8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMToxNzowOVrOF7DbXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMToxNzowOVrOF7DbXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ2NjQ2Mg==", "bodyText": "In other samples (on-pv and in-image samples), the script that generates the domain resource is create-domain.sh. The doc area that is general to all domain source types refers to create-domain.sh (see  > User Guide > Manage WebLogic domains > Domain resource). But for MII samples, the script file is named as create_domain.sh. Not sure if it is critical to make it consistent with other samples.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397466462", "createdAt": "2020-03-24T21:17:09Z", "author": {"login": "doxiao"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/model-in-image/create_domain.sh", "diffHunk": "@@ -0,0 +1,63 @@\n+#!/bin/bash", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "336d597545f5fb98aef48a856778050938888ff8"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzA0NzU1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-380704755", "createdAt": "2020-03-24T21:19:41Z", "commit": {"oid": "336d597545f5fb98aef48a856778050938888ff8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMToxOTo0MVrOF7DgYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMToxOTo0MVrOF7DgYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ2Nzc0NA==", "bodyText": "The new introspectorJobActiveDeadlineSecodns is missing under configuration.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397467744", "createdAt": "2020-03-24T21:19:41Z", "author": {"login": "doxiao"}, "path": "docs-source/content/userguide/managing-domains/domain-resource.md", "diffHunk": "@@ -86,8 +86,9 @@ Elements related to domain [startup and shutdown]({{< relref \"/userguide/managin\n \n Elements related to overriding WebLogic domain configuration:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "336d597545f5fb98aef48a856778050938888ff8"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzEzNDk1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-380713495", "createdAt": "2020-03-24T21:33:58Z", "commit": {"oid": "336d597545f5fb98aef48a856778050938888ff8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMTozMzo1OVrOF7D8pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMTozMzo1OVrOF7D8pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ3NDk4Mw==", "bodyText": "This doc discusses the domain resource in general. Feels like we need to cover the new elements in the latest schema here, for example, things under configuration.model and configuration.opss. Thoughts? @rjeberhard @tbarnes-us @jshum2479.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397474983", "createdAt": "2020-03-24T21:33:59Z", "author": {"login": "doxiao"}, "path": "docs-source/content/userguide/managing-domains/domain-resource.md", "diffHunk": "@@ -86,8 +86,9 @@ Elements related to domain [startup and shutdown]({{< relref \"/userguide/managin\n \n Elements related to overriding WebLogic domain configuration:\n \n-* `configOverrides`: The name of the config map for optional WebLogic configuration overrides.\n-* `configOverrideSecrets`: A list of names of the secrets for optional WebLogic configuration overrides.\n+These elements are under `configuration`.\n+* `overridesConfigMap`: The name of the config map for optional WebLogic configuration overrides. The value should be empty/unset, if the `domainHomeSourceType` is set to `FromModel`.\n+* `secrets`: A list of names of the secrets for optional WebLogic configuration overrides or model.\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "336d597545f5fb98aef48a856778050938888ff8"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6b0193d0a04eb86861339561c10ed23a4c2b80c", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d6b0193d0a04eb86861339561c10ed23a4c2b80c", "committedDate": "2020-03-24T21:42:00Z", "message": "Add support for defaulting the MII sample's WORKDIR. Default is '/tmp/tbarnes/model-in-image-sample-work-dir'."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec1b69864973ac45d245b70c84cd6e03c42f4958", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ec1b69864973ac45d245b70c84cd6e03c42f4958", "committedDate": "2020-03-24T21:42:08Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzIyMDIw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-380722020", "createdAt": "2020-03-24T21:48:54Z", "commit": {"oid": "336d597545f5fb98aef48a856778050938888ff8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMTo0ODo1NFrOF7EZtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMTo0ODo1NFrOF7EZtw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ4MjQyMw==", "bodyText": "@vanajamukkara @tbarnes-us @jshum2479 @mriccell @ddsharpe @markxnelson Obviously, we've all been reviewing doc, code, and scripts, but I'm thinking that the tests need a lot more attention.  There are only two tests here (since one is commented out).  I don't think we can release without substantially more tests.  I knew that we were going to rely on some amount of manual testing -- in hindsight, that may be an incorrect choice, since there needs to be more here.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397482423", "createdAt": "2020-03-24T21:48:54Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItModelInImage.java", "diffHunk": "@@ -0,0 +1,227 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "336d597545f5fb98aef48a856778050938888ff8"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzI1ODY0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-380725864", "createdAt": "2020-03-24T21:55:50Z", "commit": {"oid": "ec1b69864973ac45d245b70c84cd6e03c42f4958"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMTo1NTo1MFrOF7EmZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMTo1NTo1MFrOF7EmZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ4NTY2OA==", "bodyText": "Change \"configuration.model.wdtConfigMap\" to \"configuration.model.configMap\"?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397485668", "createdAt": "2020-03-24T21:55:50Z", "author": {"login": "doxiao"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/usage.md", "diffHunk": "@@ -0,0 +1,155 @@\n++++\n+title = \"Usage\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 20\n+pre = \"<b> </b>\"\n+description = \"Steps for creating and deploying Model in Image images and their associated domain resources.\"\n++++\n+\n+\n+#### Contents\n+\n+   - [WebLogic operator](#1-weblogic-operator)\n+   - [WebLogic image](#2-weblogic-image)\n+   - [Optional WDT model config map](#3-optional-wdt-model-config-map)\n+   - [Required runtime encryption secret](#4-required-runtime-encryption-secret)\n+   - [Secrets for model macros](#5-secrets-for-model-macros)\n+   - [Domain resource attributes](#6-domain-resource-attributes)\n+   - [Prerequisites for JRF domain types](#7-prerequisites-for-jrf-domain-types)\n+\n+#### Requirements\n+\n+Here's what's needed to create and deploy a typical Model in Image domain. These items do not need to be created in order.\n+\n+#### 1. WebLogic operator\n+\n+Deploy a WebLogic operator and ensure that it is monitoring the desired namespace for your Model in Image domain. See [Manage operators]({{< relref \"/userguide/managing-operators/_index.md\" >}}) and [Quick Start]({{< relref \"/quickstart/_index.md\" >}}).\n+\n+#### 2. WebLogic image\n+\n+Model in Image requires creating a 'final' deployable image that has WebLogic Server and WDT installed, plus your model and application files.\n+\n+You can start with a WebLogic 12.2.1.3 or later pre-built base image obtained from [Docker Hub](https://github.com/oracle/docker-images/tree/master/OracleWebLogic) or similar, manually build your own base image as per [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}), or build a base image using the [WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool). Note that any 12.2.1.3 image must also include patch 29135930 (the pre-built images already contain this patch). For an example of the first approach for both WLS and JRF domains, see the [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample.\n+\n+After you have a base image, Model in Image requires layering the following directory structure for its (optional) WDT models artifacts and (required) WDT binaries:\n+\n+| Directory                | Contents                           | Extension   |\n+| ------------------------ | ---------------------------------- | ----------- |\n+| `/u01/wdt/models`         | Optional domain model YAML files   | .yaml       |\n+| `/u01/wdt/models`         | Optional model variable files      | .properties |\n+| `/u01/wdt/models`         | Optional application archives      | .zip        |\n+| `/u01/wdt/weblogic-deploy`| Unzipped WebLogic deploy install   |             |\n+\n+There are two methods for layering Model in Image artifacts on top of a base image:\n+\n+  - **Manual Image Creation**: Use Docker commands to layer the WDT artifacts from the above table on top of your base image into a new image.\n+\n+  - **WebLogic Image Tool**: Use the convenient [WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool). The WebLogic Image Tool (WIT) has built-in options for embedding WDT model files, WDT binaries, WebLogic Server binaries, and WebLogic Server patches in an image. The [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample uses the WIT approach. For an example, see the sample's `build_image_model.sh` file in the operator source's `kubernetes/samples/scripts/create-weblogic-domain/model-in-image` directory.\n+\n+For a discussion of model file syntax, see [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+#### 3. Optional WDT model config map\n+\n+You can create a WDT model config map that defines additional model `.yaml` and `.properties` files beyond what you've already supplied in your image, and then reference this config map using your domain resource's `configuration.model.configMap` attribute. This is optional if the supplied image already fully defines your model.\n+\n+WDT model config map files will be merged with the WDT files defined in your image at runtime before your domain home is created. The config map files can add to, remove from, or alter the model configuration that you supplied within your image.\n+\n+For example, place additional `.yaml` and `.properties` files in a directory called `/home/acmeuser/wdtoverride` and run the following commands:\n+\n+  ```\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    create configmap MY-DOMAINUID-my-wdt-config-map \\\n+    --from-file /home/acmeuser/wdtoverride\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    label  configmap MY-DOMAINUID-my-wdt-config-map \\\n+    weblogic.domainUID=MY-DOMAINUID\n+  ```\n+\n+See [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) for a discussion of model file syntax and loading order, and see [Runtime updates]({{< relref \"/userguide/managing-domains/model-in-image/runtime-updates.md\" >}}) for a discussion of using WDT model config maps to update the model configuration of a running domain.\n+\n+\n+#### 4. Required runtime encryption secret\n+\n+Model in Image requires a runtime encryption secret with a secure `password` key. This secret is used by the operator to encrypt model and domain home artifacts before it adds them to a runtime config map or log. The `password` that you set can safely change any time after you've fully shut down a domain but must remain the same for the life of a running domain. The runtime encryption secret that you create can be named anything but note that it is a best practice to name and label secrets with their domain UID to help ensure that cleanup scripts can find and delete them.\n+\n+**NOTE**: Because the runtime encryption password does not need to be shared and only needs to exist for the life of a domain, you may want to use a password generator.\n+\n+Example:\n+\n+  ```\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    create secret generic MY-DOMAINUID-runtime-encrypt-secret \\\n+    --from-literal=password=welcome1\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    label secret MY-DOMAINUID-runtime-encrypt-secret \\\n+    weblogic.domainUID=MY-DOMAINUID\n+  ```\n+\n+Corresponding domain resource snippet:\n+\n+  ```\n+  configuration:\n+    model:\n+      runtimeEncryptionSecret: MY-DOMAINUID-runtime-encrypt-secret\n+  ```\n+\n+#### 5. Secrets for model macros\n+\n+Create additional secrets as needed by macros in your model files. For example, these can store database URLs and credentials that are accessed using `@@SECRET` macros in your model that reference the secrets.  For a discussion of model macros, see [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+#### 6. Domain resource attributes\n+\n+The following domain resource attributes are specific to Model in Image domains.\n+\n+| Domain Resource Attribute                    |  Notes |\n+| -------------------------                    |  ------------------ |\n+| `domainHomeSourceType`                       |  Required. Set to `FromModel`. |\n+| `domainHome`                                 |  Must reference an empty or non-existent directory within your image. Do not include the mount path of any persistent volume. Note that Model in Image recreates the domain home for a WebLogic pod every time the pod restarts.|\n+| `configuration.model.wdtConfigMap`           | Optional. Set if you have stored additional models in a config map as per [Optional WDT model config map](#3-optional-wdt-model-config-map). |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1b69864973ac45d245b70c84cd6e03c42f4958"}, "originalPosition": 108}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzI3MjU0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-380727254", "createdAt": "2020-03-24T21:58:25Z", "commit": {"oid": "ec1b69864973ac45d245b70c84cd6e03c42f4958"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMTo1ODoyNVrOF7ErLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQyMTo1ODoyNVrOF7ErLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ4Njg5Mw==", "bodyText": "There is no \"configuration.model.secrets\"; model does not have \"secrets\", but configuration does.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397486893", "createdAt": "2020-03-24T21:58:25Z", "author": {"login": "doxiao"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/usage.md", "diffHunk": "@@ -0,0 +1,155 @@\n++++\n+title = \"Usage\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 20\n+pre = \"<b> </b>\"\n+description = \"Steps for creating and deploying Model in Image images and their associated domain resources.\"\n++++\n+\n+\n+#### Contents\n+\n+   - [WebLogic operator](#1-weblogic-operator)\n+   - [WebLogic image](#2-weblogic-image)\n+   - [Optional WDT model config map](#3-optional-wdt-model-config-map)\n+   - [Required runtime encryption secret](#4-required-runtime-encryption-secret)\n+   - [Secrets for model macros](#5-secrets-for-model-macros)\n+   - [Domain resource attributes](#6-domain-resource-attributes)\n+   - [Prerequisites for JRF domain types](#7-prerequisites-for-jrf-domain-types)\n+\n+#### Requirements\n+\n+Here's what's needed to create and deploy a typical Model in Image domain. These items do not need to be created in order.\n+\n+#### 1. WebLogic operator\n+\n+Deploy a WebLogic operator and ensure that it is monitoring the desired namespace for your Model in Image domain. See [Manage operators]({{< relref \"/userguide/managing-operators/_index.md\" >}}) and [Quick Start]({{< relref \"/quickstart/_index.md\" >}}).\n+\n+#### 2. WebLogic image\n+\n+Model in Image requires creating a 'final' deployable image that has WebLogic Server and WDT installed, plus your model and application files.\n+\n+You can start with a WebLogic 12.2.1.3 or later pre-built base image obtained from [Docker Hub](https://github.com/oracle/docker-images/tree/master/OracleWebLogic) or similar, manually build your own base image as per [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}), or build a base image using the [WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool). Note that any 12.2.1.3 image must also include patch 29135930 (the pre-built images already contain this patch). For an example of the first approach for both WLS and JRF domains, see the [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample.\n+\n+After you have a base image, Model in Image requires layering the following directory structure for its (optional) WDT models artifacts and (required) WDT binaries:\n+\n+| Directory                | Contents                           | Extension   |\n+| ------------------------ | ---------------------------------- | ----------- |\n+| `/u01/wdt/models`         | Optional domain model YAML files   | .yaml       |\n+| `/u01/wdt/models`         | Optional model variable files      | .properties |\n+| `/u01/wdt/models`         | Optional application archives      | .zip        |\n+| `/u01/wdt/weblogic-deploy`| Unzipped WebLogic deploy install   |             |\n+\n+There are two methods for layering Model in Image artifacts on top of a base image:\n+\n+  - **Manual Image Creation**: Use Docker commands to layer the WDT artifacts from the above table on top of your base image into a new image.\n+\n+  - **WebLogic Image Tool**: Use the convenient [WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool). The WebLogic Image Tool (WIT) has built-in options for embedding WDT model files, WDT binaries, WebLogic Server binaries, and WebLogic Server patches in an image. The [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample uses the WIT approach. For an example, see the sample's `build_image_model.sh` file in the operator source's `kubernetes/samples/scripts/create-weblogic-domain/model-in-image` directory.\n+\n+For a discussion of model file syntax, see [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+#### 3. Optional WDT model config map\n+\n+You can create a WDT model config map that defines additional model `.yaml` and `.properties` files beyond what you've already supplied in your image, and then reference this config map using your domain resource's `configuration.model.configMap` attribute. This is optional if the supplied image already fully defines your model.\n+\n+WDT model config map files will be merged with the WDT files defined in your image at runtime before your domain home is created. The config map files can add to, remove from, or alter the model configuration that you supplied within your image.\n+\n+For example, place additional `.yaml` and `.properties` files in a directory called `/home/acmeuser/wdtoverride` and run the following commands:\n+\n+  ```\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    create configmap MY-DOMAINUID-my-wdt-config-map \\\n+    --from-file /home/acmeuser/wdtoverride\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    label  configmap MY-DOMAINUID-my-wdt-config-map \\\n+    weblogic.domainUID=MY-DOMAINUID\n+  ```\n+\n+See [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) for a discussion of model file syntax and loading order, and see [Runtime updates]({{< relref \"/userguide/managing-domains/model-in-image/runtime-updates.md\" >}}) for a discussion of using WDT model config maps to update the model configuration of a running domain.\n+\n+\n+#### 4. Required runtime encryption secret\n+\n+Model in Image requires a runtime encryption secret with a secure `password` key. This secret is used by the operator to encrypt model and domain home artifacts before it adds them to a runtime config map or log. The `password` that you set can safely change any time after you've fully shut down a domain but must remain the same for the life of a running domain. The runtime encryption secret that you create can be named anything but note that it is a best practice to name and label secrets with their domain UID to help ensure that cleanup scripts can find and delete them.\n+\n+**NOTE**: Because the runtime encryption password does not need to be shared and only needs to exist for the life of a domain, you may want to use a password generator.\n+\n+Example:\n+\n+  ```\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    create secret generic MY-DOMAINUID-runtime-encrypt-secret \\\n+    --from-literal=password=welcome1\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    label secret MY-DOMAINUID-runtime-encrypt-secret \\\n+    weblogic.domainUID=MY-DOMAINUID\n+  ```\n+\n+Corresponding domain resource snippet:\n+\n+  ```\n+  configuration:\n+    model:\n+      runtimeEncryptionSecret: MY-DOMAINUID-runtime-encrypt-secret\n+  ```\n+\n+#### 5. Secrets for model macros\n+\n+Create additional secrets as needed by macros in your model files. For example, these can store database URLs and credentials that are accessed using `@@SECRET` macros in your model that reference the secrets.  For a discussion of model macros, see [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+#### 6. Domain resource attributes\n+\n+The following domain resource attributes are specific to Model in Image domains.\n+\n+| Domain Resource Attribute                    |  Notes |\n+| -------------------------                    |  ------------------ |\n+| `domainHomeSourceType`                       |  Required. Set to `FromModel`. |\n+| `domainHome`                                 |  Must reference an empty or non-existent directory within your image. Do not include the mount path of any persistent volume. Note that Model in Image recreates the domain home for a WebLogic pod every time the pod restarts.|\n+| `configuration.model.wdtConfigMap`           | Optional. Set if you have stored additional models in a config map as per [Optional WDT model config map](#3-optional-wdt-model-config-map). |\n+| `configuration.model.secrets`                | Optional. Set this array if your image or config map models contain macros that reference custom Kubernetes secrets. For example, if your macros depend on secrets `my-secret` and `my-other-secret`, then set to `[my-secret, my-other-secret]`.|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1b69864973ac45d245b70c84cd6e03c42f4958"}, "originalPosition": 109}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57d73bf8e73f68a0456c3b9276612a10b5f4eeac", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/57d73bf8e73f68a0456c3b9276612a10b5f4eeac", "committedDate": "2020-03-24T22:22:16Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6061ede98790cc8840ae8df78838db67cd2a027", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c6061ede98790cc8840ae8df78838db67cd2a027", "committedDate": "2020-03-24T22:45:26Z", "message": "sample update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d4477d1cc26b7250c0a0a5896980bc4d7ce8910", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9d4477d1cc26b7250c0a0a5896980bc4d7ce8910", "committedDate": "2020-03-24T22:59:48Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58c7fc3a1f4162deaa6eaee61088ffc0da343aab", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/58c7fc3a1f4162deaa6eaee61088ffc0da343aab", "committedDate": "2020-03-24T23:05:09Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "118777b9d469e2fef8c236ea8758afa6b02acdec", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/118777b9d469e2fef8c236ea8758afa6b02acdec", "committedDate": "2020-03-24T23:10:22Z", "message": "fix for MII sample script opss_wallet_util.sh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8545d44c6f9f72c593185be785016cf9a23c9c4", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e8545d44c6f9f72c593185be785016cf9a23c9c4", "committedDate": "2020-03-24T23:17:16Z", "message": "remove mention of helm 2.x syntax from MII sample"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23820baeef6d6e27baa6bfbb5cf63c99ec89eb0f", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/23820baeef6d6e27baa6bfbb5cf63c99ec89eb0f", "committedDate": "2020-03-24T23:21:05Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b90b11f5ae67cb0e5903df4120ed6a783f3a167", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3b90b11f5ae67cb0e5903df4120ed6a783f3a167", "committedDate": "2020-03-24T23:31:34Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70e95ea5023a69212536acdc08858d364801079d", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/70e95ea5023a69212536acdc08858d364801079d", "committedDate": "2020-03-24T23:36:59Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99d7439ac29de1b07a1c0f6ba95eec359ce2355a", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/99d7439ac29de1b07a1c0f6ba95eec359ce2355a", "committedDate": "2020-03-24T23:58:36Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5649f2519cdc49c2e216ea8c4109f7ed40724dc", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e5649f2519cdc49c2e216ea8c4109f7ed40724dc", "committedDate": "2020-03-25T00:04:25Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2a9763ed28d550f39dcce02dfb256796b1db58e", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b2a9763ed28d550f39dcce02dfb256796b1db58e", "committedDate": "2020-03-25T00:06:26Z", "message": "doc update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzgxMTEw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-380781110", "createdAt": "2020-03-25T00:09:53Z", "commit": {"oid": "ec1b69864973ac45d245b70c84cd6e03c42f4958"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMDowOTo1M1rOF7HsVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMDowOTo1M1rOF7HsVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUzNjM0MA==", "bodyText": "I thought introspectVersion was removed.  Why is it showing up here?\n@jshum2479", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397536340", "createdAt": "2020-03-25T00:09:53Z", "author": {"login": "tbarnes-us"}, "path": "docs/domains/Domain.json", "diffHunk": "@@ -271,59 +345,33 @@\n           \"description\": \"If present, every time this value is updated the operator will restart the required servers.\",\n           \"type\": \"string\"\n         },\n+        \"introspectVersion\": {\n+          \"description\": \"If present, every time this value is updated, the operator will start introspect domain job\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1b69864973ac45d245b70c84cd6e03c42f4958"}, "originalPosition": 160}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzgxODEz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-380781813", "createdAt": "2020-03-25T00:11:57Z", "commit": {"oid": "ec1b69864973ac45d245b70c84cd6e03c42f4958"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMDoxMTo1N1rOF7Hu7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwMDoxMTo1N1rOF7Hu7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUzNzAwNQ==", "bodyText": "Shouldn't 'introspectVersion' be gone? @jshum2479", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397537005", "createdAt": "2020-03-25T00:11:57Z", "author": {"login": "tbarnes-us"}, "path": "docs/domains/index.html", "diffHunk": "@@ -1191,59 +1265,33 @@\n           \"description\": \"If present, every time this value is updated the operator will restart the required servers.\",\n           \"type\": \"string\"\n         },\n+        \"introspectVersion\": {\n+          \"description\": \"If present, every time this value is updated, the operator will start introspect domain job\",\n+          \"type\": \"string\"\n+        },", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1b69864973ac45d245b70c84cd6e03c42f4958"}, "originalPosition": 162}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99f2f8a58a98b61787718bfe9f3960e88139acbe", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/99f2f8a58a98b61787718bfe9f3960e88139acbe", "committedDate": "2020-03-25T03:16:45Z", "message": "Update the wallet in the primordial domain if the rcu schema password changed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2b41665e85c37e19e8c09319cfb791210d477c1", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b2b41665e85c37e19e8c09319cfb791210d477c1", "committedDate": "2020-03-25T04:10:51Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9cd848bfd5e26220b7e1fb87a7fba8a1f5b19262", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9cd848bfd5e26220b7e1fb87a7fba8a1f5b19262", "committedDate": "2020-03-25T04:10:59Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fe5255d547855735b38e7cca8cf29e3ceb2086c", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0fe5255d547855735b38e7cca8cf29e3ceb2086c", "committedDate": "2020-03-25T04:26:56Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c2ac7f5b44fda06793181c2b7dbb692af7960bd", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6c2ac7f5b44fda06793181c2b7dbb692af7960bd", "committedDate": "2020-03-25T05:01:11Z", "message": "add error checking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2537871e2c934f026528a2e28072f792d2c1dfc5", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2537871e2c934f026528a2e28072f792d2c1dfc5", "committedDate": "2020-03-25T05:57:20Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab17543b0b6748e49b0c4ff4b4a80505ada12e0d", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ab17543b0b6748e49b0c4ff4b4a80505ada12e0d", "committedDate": "2020-03-25T05:57:39Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e54bd8ee74d94e324fb9d3fc5f25b0d57047b12", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0e54bd8ee74d94e324fb9d3fc5f25b0d57047b12", "committedDate": "2020-03-25T06:44:00Z", "message": "doc update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwODk1MjI3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-380895227", "createdAt": "2020-03-25T07:01:54Z", "commit": {"oid": "0e54bd8ee74d94e324fb9d3fc5f25b0d57047b12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwNzowMTo1NFrOF7OKuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwNzowMTo1NFrOF7OKuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY0MjQyNw==", "bodyText": "This is not entirely correct.  The operator keeps a copy of the wallet file in the introspector configmap.  The wallet file is only required if you want to share the database with other domains or if the domain is deleted and recreated (essentially sharing with another domain).  The reason for this is - we split into primordial domain and then update with the rest of the config.  The primordial jrf domain has all the wallet and all the default JRF apps/resources info. In order to re-create another domain to share the rcu database,  the wallet+password must be provided.  We only re-create the primordial domain if there is a security info change (e.g. wls credentials and security roles) and for the same domain if the walletFile is not provided, it will reuse the one in the introspect configmap.\nHowever, for safety and best practice, user should save , backup and use the walletFile in the domain resource yaml - such as the case when the domain is deleted by accident.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397642427", "createdAt": "2020-03-25T07:01:54Z", "author": {"login": "jshum2479"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/usage.md", "diffHunk": "@@ -0,0 +1,173 @@\n++++\n+title = \"Usage\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 20\n+pre = \"<b> </b>\"\n+description = \"Steps for creating and deploying Model in Image images and their associated domain resources.\"\n++++\n+\n+\n+#### Contents\n+\n+   - [WebLogic operator](#1-weblogic-operator)\n+   - [WebLogic image](#2-weblogic-image)\n+   - [Optional WDT model config map](#3-optional-wdt-model-config-map)\n+   - [Required runtime encryption secret](#4-required-runtime-encryption-secret)\n+   - [Secrets for model macros](#5-secrets-for-model-macros)\n+   - [Domain resource attributes](#6-domain-resource-attributes)\n+   - [Prerequisites for JRF domain types](#7-prerequisites-for-jrf-domain-types)\n+\n+#### Requirements\n+\n+Here's what's needed to create and deploy a typical Model in Image domain. These items do not need to be created in order.\n+\n+#### 1. WebLogic operator\n+\n+Deploy a WebLogic operator and ensure that it is monitoring the desired namespace for your Model in Image domain. See [Manage operators]({{< relref \"/userguide/managing-operators/_index.md\" >}}) and [Quick Start]({{< relref \"/quickstart/_index.md\" >}}).\n+\n+#### 2. WebLogic image\n+\n+Model in Image requires creating a 'final' deployable image that has WebLogic Server and WDT installed, plus your model and application files.\n+\n+You can start with a WebLogic 12.2.1.3 or later pre-built base image obtained from [Docker Hub](https://github.com/oracle/docker-images/tree/master/OracleWebLogic) or similar, manually build your own base image as per [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}), or build a base image using the [WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool). Note that any 12.2.1.3 image must also include patch 29135930 (the pre-built images already contain this patch). For an example of the first approach for both WLS and JRF domains, see the [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample.\n+\n+After you have a base image, Model in Image requires layering the following directory structure for its (optional) WDT models artifacts and (required) WDT binaries:\n+\n+| Directory                | Contents                           | Extension   |\n+| ------------------------ | ---------------------------------- | ----------- |\n+| `/u01/wdt/models`         | Optional domain model YAML files   | .yaml       |\n+| `/u01/wdt/models`         | Optional model variable files      | .properties |\n+| `/u01/wdt/models`         | Optional application archives      | .zip        |\n+| `/u01/wdt/weblogic-deploy`| Unzipped WebLogic deploy install   |             |\n+\n+There are two methods for layering Model in Image artifacts on top of a base image:\n+\n+  - **Manual Image Creation**: Use Docker commands to layer the WDT artifacts from the above table on top of your base image into a new image.\n+\n+  - **WebLogic Image Tool**: Use the convenient [WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool). The WebLogic Image Tool (WIT) has built-in options for embedding WDT model files, WDT binaries, WebLogic Server binaries, and WebLogic Server patches in an image. The [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample uses the WIT approach. For an example, see the sample's `build_image_model.sh` file in the operator source's `kubernetes/samples/scripts/create-weblogic-domain/model-in-image` directory.\n+\n+For a discussion of model file syntax, see [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+#### 3. Optional WDT model config map\n+\n+You can create a WDT model config map that defines additional model `.yaml` and `.properties` files beyond what you've already supplied in your image, and then reference this config map using your domain resource's `configuration.model.configMap` attribute. This is optional if the supplied image already fully defines your model.\n+\n+WDT model config map files will be merged with the WDT files defined in your image at runtime before your domain home is created. The config map files can add to, remove from, or alter the model configuration that you supplied within your image.\n+\n+For example, place additional `.yaml` and `.properties` files in a directory called `/home/acmeuser/wdtoverride` and run the following commands:\n+\n+  ```\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    create configmap MY-DOMAINUID-my-wdt-config-map \\\n+    --from-file /home/acmeuser/wdtoverride\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    label  configmap MY-DOMAINUID-my-wdt-config-map \\\n+    weblogic.domainUID=MY-DOMAINUID\n+  ```\n+\n+See [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) for a discussion of model file syntax and loading order, and see [Runtime updates]({{< relref \"/userguide/managing-domains/model-in-image/runtime-updates.md\" >}}) for a discussion of using WDT model config maps to update the model configuration of a running domain.\n+\n+\n+#### 4. Required runtime encryption secret\n+\n+Model in Image requires a runtime encryption secret with a secure `password` key. This secret is used by the operator to encrypt model and domain home artifacts before it adds them to a runtime config map or log. The `password` that you set can safely change any time after you've fully shut down a domain but must remain the same for the life of a running domain. The runtime encryption secret that you create can be named anything but note that it is a best practice to name and label secrets with their domain UID to help ensure that cleanup scripts can find and delete them.\n+\n+**NOTE**: Because the runtime encryption password does not need to be shared and only needs to exist for the life of a domain, you may want to use a password generator.\n+\n+Example:\n+\n+  ```\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    create secret generic MY-DOMAINUID-runtime-encrypt-secret \\\n+    --from-literal=password=welcome1\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    label secret MY-DOMAINUID-runtime-encrypt-secret \\\n+    weblogic.domainUID=MY-DOMAINUID\n+  ```\n+\n+Corresponding domain resource snippet:\n+\n+  ```\n+  configuration:\n+    model:\n+      runtimeEncryptionSecret: MY-DOMAINUID-runtime-encrypt-secret\n+  ```\n+\n+#### 5. Secrets for model macros\n+\n+Create additional secrets as needed by macros in your model files. For example, these can store database URLs and credentials that are accessed using `@@SECRET` macros in your model that reference the secrets.  For a discussion of model macros, see [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+#### 6. Domain resource attributes\n+\n+The following domain resource attributes are specific to Model in Image domains.\n+\n+| Domain Resource Attribute                    |  Notes |\n+| -------------------------                    |  ------------------ |\n+| `domainHomeSourceType`                       |  Required. Set to `FromModel`. |\n+| `domainHome`                                 |  Must reference an empty or non-existent directory within your image. Do not include the mount path of any persistent volume. Note that Model in Image recreates the domain home for a WebLogic pod every time the pod restarts.|\n+| `configuration.model.configMap`             | Optional. Set if you have stored additional models in a config map as per [Optional WDT model config map](#3-optional-wdt-model-config-map). |\n+| `configuration.secrets`                      | Optional. Set this array if your image or config map models contain macros that reference custom Kubernetes secrets. For example, if your macros depend on secrets `my-secret` and `my-other-secret`, then set to `[my-secret, my-other-secret]`.|\n+| `configuration.model.RuntimeEncryptionSecret`| Required. All Model in Image domains must specify a runtime encryption secret. See [Required runtime encryption secret](#4-required-runtime-encryption-secret). |\n+| `configuration.model.domainType`             | Set the type of domain. Valid values are `WLS`, `JRF`, and `RestrictedJRF` where `WLS` is the default. See [WDT Domain Types](https://github.com/oracle/weblogic-deploy-tooling/blob/master/site/type_def.md).|\n+\n+Notes:\n+\n+ - There are additional attributes that are common to all domain home source types, such as the `image` field. See the Domain Resource [schema](https://github.com/oracle/weblogic-kubernetes-operator/blob/master/docs/domains/Domain.md) and [documentation]({{< relref \"/userguide/managing-domains/domain-resource.md\" >}}) for a full list of domain resource fields.\n+\n+ - There are also additional fields that are specific to JRF domain types. For more information, see [Prerequisites for JRF domain types](#7-prerequisites-for-jrf-domain-types).\n+\n+ - Sample domain resource: For an example of a fully specified sample domain resource, see the the operator source's `kubernetes/samples/scripts/create-weblogic-domain/model-in-image/k8s-domain.yaml.template` file for the [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample. Note that the `@@` entries in this template are not processed by the operator; they need to replaced with actual values before the resource can be applied.\n+\n+#### 7. Prerequisites for JRF domain types\n+\n+{{% notice info %}} This section applies only for a `JRF` domain type. Skip it if your domain type is `WLS` or `RestrictedJRF`.\n+{{% /notice %}}\n+\n+A JRF domain requires an infrastructure database called an RCU database, initializing this database, and configuring your domain to access this database. All of these steps must occur before you first deploy your domain. When you first deploy your domain, the introspector job will initialize it's RCU schema tables in the database - a process that can take several minutes.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e54bd8ee74d94e324fb9d3fc5f25b0d57047b12"}, "originalPosition": 126}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/babb50a8da98a0cb6bed089db00fdda9f49e4516", "committedDate": "2020-03-25T07:15:45Z", "message": "doc update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDU0OTYy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381054962", "createdAt": "2020-03-25T11:17:26Z", "commit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMToxNzoyNlrOF7Wbrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMToxNzoyNlrOF7Wbrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc3NzgzOA==", "bodyText": "\"Domain type\" -> \"Domain source type\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397777838", "createdAt": "2020-03-25T11:17:26Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/resources/scripts/startServer.sh", "diffHunk": "@@ -126,11 +147,95 @@ function copySitCfg() {\n   fi\n }\n \n+# prepare mii server\n+\n+function prepareMIIServer() {\n+\n+  trace \"Model-in-Image: Creating domain home.\"\n+\n+  # primordial domain contain the basic structures, security and other fmwconfig templated info\n+  # domainzip only contains the domain configuration (config.xml jdbc/ jms/)\n+  # Both are needed for the complete domain reconstruction\n+\n+  if [ ! -f /weblogic-operator/introspector/primordial_domainzip.secure ] ; then\n+    trace \"Domain Source Type is FromModel, the primordial model archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  if [ ! -f /weblogic-operator/introspector/domainzip.secure ] ; then\n+    trace \"Domain type is FromModel, the domain configuration archive is missing, cannot start server\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516"}, "originalPosition": 77}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDU1NzYx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381055761", "createdAt": "2020-03-25T11:18:40Z", "commit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMToxODo0MFrOF7WehQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMToxODo0MFrOF7WehQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc3ODU2NQ==", "bodyText": "Is the \"cd /\" necessary given that all the paths are absolute?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397778565", "createdAt": "2020-03-25T11:18:40Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/resources/scripts/startServer.sh", "diffHunk": "@@ -126,11 +147,95 @@ function copySitCfg() {\n   fi\n }\n \n+# prepare mii server\n+\n+function prepareMIIServer() {\n+\n+  trace \"Model-in-Image: Creating domain home.\"\n+\n+  # primordial domain contain the basic structures, security and other fmwconfig templated info\n+  # domainzip only contains the domain configuration (config.xml jdbc/ jms/)\n+  # Both are needed for the complete domain reconstruction\n+\n+  if [ ! -f /weblogic-operator/introspector/primordial_domainzip.secure ] ; then\n+    trace \"Domain Source Type is FromModel, the primordial model archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  if [ ! -f /weblogic-operator/introspector/domainzip.secure ] ; then\n+    trace \"Domain type is FromModel, the domain configuration archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  cd / && base64 -d /weblogic-operator/introspector/primordial_domainzip.secure > /tmp/domain.tar.gz && \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516"}, "originalPosition": 81}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDU2NTEw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381056510", "createdAt": "2020-03-25T11:19:48Z", "commit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMToxOTo0OFrOF7Wg4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMToxOTo0OFrOF7Wg4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc3OTE3MQ==", "bodyText": "Similar... \"Domain source type\" and \"trace SEVERE\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397779171", "createdAt": "2020-03-25T11:19:48Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/resources/scripts/startServer.sh", "diffHunk": "@@ -126,11 +147,95 @@ function copySitCfg() {\n   fi\n }\n \n+# prepare mii server\n+\n+function prepareMIIServer() {\n+\n+  trace \"Model-in-Image: Creating domain home.\"\n+\n+  # primordial domain contain the basic structures, security and other fmwconfig templated info\n+  # domainzip only contains the domain configuration (config.xml jdbc/ jms/)\n+  # Both are needed for the complete domain reconstruction\n+\n+  if [ ! -f /weblogic-operator/introspector/primordial_domainzip.secure ] ; then\n+    trace \"Domain Source Type is FromModel, the primordial model archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  if [ ! -f /weblogic-operator/introspector/domainzip.secure ] ; then\n+    trace \"Domain type is FromModel, the domain configuration archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  cd / && base64 -d /weblogic-operator/introspector/primordial_domainzip.secure > /tmp/domain.tar.gz && \\\n+   tar -xzf /tmp/domain.tar.gz\n+\n+  # decrypt the SerializedSystemIni first\n+  if [ -f ${RUNTIME_ENCRYPTION_SECRET_PASSWORD} ] ; then\n+    MII_PASSPHRASE=$(cat ${RUNTIME_ENCRYPTION_SECRET_PASSWORD})\n+  else\n+    trace SEVERE \"Domain Source Type is 'FromModel' which requires specifying a runtimeEncryptionSecret \" \\\n+    \"in your domain resource and deploying this secret with a 'password' key, but the secret does not have this key.\"\n+    exit 1\n+  fi\n+  encrypt_decrypt_domain_secret \"decrypt\" ${DOMAIN_HOME} ${MII_PASSPHRASE}\n+\n+  # restore the config zip\n+  #\n+  cd / && base64 -d /weblogic-operator/introspector/domainzip.secure > /tmp/domain.tar.gz && \\\n+    tar -xzf /tmp/domain.tar.gz\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh\n+\n+  # restore the archive apps and libraries\n+  #\n+  trace \"Model-in-Image: Deploying libraries.\"\n+\n+  mkdir -p ${DOMAIN_HOME}/lib\n+  if [ $? -ne 0 ] ; then\n+    trace \"Domain type is FromModel, cannot create ${DOMAIN_HOME}/lib \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516"}, "originalPosition": 106}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDU2Njk2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381056696", "createdAt": "2020-03-25T11:20:06Z", "commit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMToyMDowN1rOF7WhfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMToyMDowN1rOF7WhfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc3OTMyNQ==", "bodyText": "Same.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397779325", "createdAt": "2020-03-25T11:20:07Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/resources/scripts/startServer.sh", "diffHunk": "@@ -126,11 +147,95 @@ function copySitCfg() {\n   fi\n }\n \n+# prepare mii server\n+\n+function prepareMIIServer() {\n+\n+  trace \"Model-in-Image: Creating domain home.\"\n+\n+  # primordial domain contain the basic structures, security and other fmwconfig templated info\n+  # domainzip only contains the domain configuration (config.xml jdbc/ jms/)\n+  # Both are needed for the complete domain reconstruction\n+\n+  if [ ! -f /weblogic-operator/introspector/primordial_domainzip.secure ] ; then\n+    trace \"Domain Source Type is FromModel, the primordial model archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  if [ ! -f /weblogic-operator/introspector/domainzip.secure ] ; then\n+    trace \"Domain type is FromModel, the domain configuration archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  cd / && base64 -d /weblogic-operator/introspector/primordial_domainzip.secure > /tmp/domain.tar.gz && \\\n+   tar -xzf /tmp/domain.tar.gz\n+\n+  # decrypt the SerializedSystemIni first\n+  if [ -f ${RUNTIME_ENCRYPTION_SECRET_PASSWORD} ] ; then\n+    MII_PASSPHRASE=$(cat ${RUNTIME_ENCRYPTION_SECRET_PASSWORD})\n+  else\n+    trace SEVERE \"Domain Source Type is 'FromModel' which requires specifying a runtimeEncryptionSecret \" \\\n+    \"in your domain resource and deploying this secret with a 'password' key, but the secret does not have this key.\"\n+    exit 1\n+  fi\n+  encrypt_decrypt_domain_secret \"decrypt\" ${DOMAIN_HOME} ${MII_PASSPHRASE}\n+\n+  # restore the config zip\n+  #\n+  cd / && base64 -d /weblogic-operator/introspector/domainzip.secure > /tmp/domain.tar.gz && \\\n+    tar -xzf /tmp/domain.tar.gz\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh\n+\n+  # restore the archive apps and libraries\n+  #\n+  trace \"Model-in-Image: Deploying libraries.\"\n+\n+  mkdir -p ${DOMAIN_HOME}/lib\n+  if [ $? -ne 0 ] ; then\n+    trace \"Domain type is FromModel, cannot create ${DOMAIN_HOME}/lib \"\n+    exit 1\n+  fi\n+\n+  for file in $(sort_files ${IMG_ARCHIVES_ROOTDIR} \"*.zip\")\n+    do\n+        # expand the archive domain libraries to the domain lib\n+        cd ${DOMAIN_HOME}/lib  || exit 1\n+        jar xf ${IMG_ARCHIVES_ROOTDIR}/${file} wlsdeploy/domainLibraries/\n+\n+        if [ $? -ne 0 ] ; then\n+          trace \"Domain type is FromModel, error in extracting application archive ${IMG_ARCHIVES_ROOTDIR}/${file}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516"}, "originalPosition": 117}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDU2OTc5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381056979", "createdAt": "2020-03-25T11:20:34Z", "commit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMToyMDozNFrOF7WiZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMToyMDozNFrOF7WiZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc3OTU1Ng==", "bodyText": "Are we guaranteed that jar will be on the path or should we use $JAVA_HOME?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397779556", "createdAt": "2020-03-25T11:20:34Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/resources/scripts/startServer.sh", "diffHunk": "@@ -126,11 +147,95 @@ function copySitCfg() {\n   fi\n }\n \n+# prepare mii server\n+\n+function prepareMIIServer() {\n+\n+  trace \"Model-in-Image: Creating domain home.\"\n+\n+  # primordial domain contain the basic structures, security and other fmwconfig templated info\n+  # domainzip only contains the domain configuration (config.xml jdbc/ jms/)\n+  # Both are needed for the complete domain reconstruction\n+\n+  if [ ! -f /weblogic-operator/introspector/primordial_domainzip.secure ] ; then\n+    trace \"Domain Source Type is FromModel, the primordial model archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  if [ ! -f /weblogic-operator/introspector/domainzip.secure ] ; then\n+    trace \"Domain type is FromModel, the domain configuration archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  cd / && base64 -d /weblogic-operator/introspector/primordial_domainzip.secure > /tmp/domain.tar.gz && \\\n+   tar -xzf /tmp/domain.tar.gz\n+\n+  # decrypt the SerializedSystemIni first\n+  if [ -f ${RUNTIME_ENCRYPTION_SECRET_PASSWORD} ] ; then\n+    MII_PASSPHRASE=$(cat ${RUNTIME_ENCRYPTION_SECRET_PASSWORD})\n+  else\n+    trace SEVERE \"Domain Source Type is 'FromModel' which requires specifying a runtimeEncryptionSecret \" \\\n+    \"in your domain resource and deploying this secret with a 'password' key, but the secret does not have this key.\"\n+    exit 1\n+  fi\n+  encrypt_decrypt_domain_secret \"decrypt\" ${DOMAIN_HOME} ${MII_PASSPHRASE}\n+\n+  # restore the config zip\n+  #\n+  cd / && base64 -d /weblogic-operator/introspector/domainzip.secure > /tmp/domain.tar.gz && \\\n+    tar -xzf /tmp/domain.tar.gz\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh\n+\n+  # restore the archive apps and libraries\n+  #\n+  trace \"Model-in-Image: Deploying libraries.\"\n+\n+  mkdir -p ${DOMAIN_HOME}/lib\n+  if [ $? -ne 0 ] ; then\n+    trace \"Domain type is FromModel, cannot create ${DOMAIN_HOME}/lib \"\n+    exit 1\n+  fi\n+\n+  for file in $(sort_files ${IMG_ARCHIVES_ROOTDIR} \"*.zip\")\n+    do\n+        # expand the archive domain libraries to the domain lib\n+        cd ${DOMAIN_HOME}/lib  || exit 1\n+        jar xf ${IMG_ARCHIVES_ROOTDIR}/${file} wlsdeploy/domainLibraries/\n+\n+        if [ $? -ne 0 ] ; then\n+          trace \"Domain type is FromModel, error in extracting application archive ${IMG_ARCHIVES_ROOTDIR}/${file}\"\n+          exit 1\n+        fi\n+\n+        # expand the archive apps and shared lib to the wlsdeploy/* directories\n+        # the config.xml is referencing them from that path\n+\n+        cd ${DOMAIN_HOME} || exit 1\n+        jar xf ${IMG_ARCHIVES_ROOTDIR}/${file} wlsdeploy/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516"}, "originalPosition": 125}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDU3MTM3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381057137", "createdAt": "2020-03-25T11:20:50Z", "commit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMToyMDo1MVrOF7Wi9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMToyMDo1MVrOF7Wi9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc3OTcwMg==", "bodyText": "Same", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397779702", "createdAt": "2020-03-25T11:20:51Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/resources/scripts/startServer.sh", "diffHunk": "@@ -126,11 +147,95 @@ function copySitCfg() {\n   fi\n }\n \n+# prepare mii server\n+\n+function prepareMIIServer() {\n+\n+  trace \"Model-in-Image: Creating domain home.\"\n+\n+  # primordial domain contain the basic structures, security and other fmwconfig templated info\n+  # domainzip only contains the domain configuration (config.xml jdbc/ jms/)\n+  # Both are needed for the complete domain reconstruction\n+\n+  if [ ! -f /weblogic-operator/introspector/primordial_domainzip.secure ] ; then\n+    trace \"Domain Source Type is FromModel, the primordial model archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  if [ ! -f /weblogic-operator/introspector/domainzip.secure ] ; then\n+    trace \"Domain type is FromModel, the domain configuration archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  cd / && base64 -d /weblogic-operator/introspector/primordial_domainzip.secure > /tmp/domain.tar.gz && \\\n+   tar -xzf /tmp/domain.tar.gz\n+\n+  # decrypt the SerializedSystemIni first\n+  if [ -f ${RUNTIME_ENCRYPTION_SECRET_PASSWORD} ] ; then\n+    MII_PASSPHRASE=$(cat ${RUNTIME_ENCRYPTION_SECRET_PASSWORD})\n+  else\n+    trace SEVERE \"Domain Source Type is 'FromModel' which requires specifying a runtimeEncryptionSecret \" \\\n+    \"in your domain resource and deploying this secret with a 'password' key, but the secret does not have this key.\"\n+    exit 1\n+  fi\n+  encrypt_decrypt_domain_secret \"decrypt\" ${DOMAIN_HOME} ${MII_PASSPHRASE}\n+\n+  # restore the config zip\n+  #\n+  cd / && base64 -d /weblogic-operator/introspector/domainzip.secure > /tmp/domain.tar.gz && \\\n+    tar -xzf /tmp/domain.tar.gz\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh\n+\n+  # restore the archive apps and libraries\n+  #\n+  trace \"Model-in-Image: Deploying libraries.\"\n+\n+  mkdir -p ${DOMAIN_HOME}/lib\n+  if [ $? -ne 0 ] ; then\n+    trace \"Domain type is FromModel, cannot create ${DOMAIN_HOME}/lib \"\n+    exit 1\n+  fi\n+\n+  for file in $(sort_files ${IMG_ARCHIVES_ROOTDIR} \"*.zip\")\n+    do\n+        # expand the archive domain libraries to the domain lib\n+        cd ${DOMAIN_HOME}/lib  || exit 1\n+        jar xf ${IMG_ARCHIVES_ROOTDIR}/${file} wlsdeploy/domainLibraries/\n+\n+        if [ $? -ne 0 ] ; then\n+          trace \"Domain type is FromModel, error in extracting application archive ${IMG_ARCHIVES_ROOTDIR}/${file}\"\n+          exit 1\n+        fi\n+\n+        # expand the archive apps and shared lib to the wlsdeploy/* directories\n+        # the config.xml is referencing them from that path\n+\n+        cd ${DOMAIN_HOME} || exit 1\n+        jar xf ${IMG_ARCHIVES_ROOTDIR}/${file} wlsdeploy/\n+\n+        if [ $? -ne 0 ] ; then\n+          trace \"Domain type is FromModel, error in extracting application archive ${IMG_ARCHIVES_ROOTDIR}/${file}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516"}, "originalPosition": 128}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDU3NDg5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381057489", "createdAt": "2020-03-25T11:21:23Z", "commit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMToyMToyM1rOF7WkFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMToyMToyM1rOF7WkFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc3OTk4OQ==", "bodyText": "If we don't need it then we should remove.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397779989", "createdAt": "2020-03-25T11:21:23Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/resources/scripts/startServer.sh", "diffHunk": "@@ -126,11 +147,95 @@ function copySitCfg() {\n   fi\n }\n \n+# prepare mii server\n+\n+function prepareMIIServer() {\n+\n+  trace \"Model-in-Image: Creating domain home.\"\n+\n+  # primordial domain contain the basic structures, security and other fmwconfig templated info\n+  # domainzip only contains the domain configuration (config.xml jdbc/ jms/)\n+  # Both are needed for the complete domain reconstruction\n+\n+  if [ ! -f /weblogic-operator/introspector/primordial_domainzip.secure ] ; then\n+    trace \"Domain Source Type is FromModel, the primordial model archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  if [ ! -f /weblogic-operator/introspector/domainzip.secure ] ; then\n+    trace \"Domain type is FromModel, the domain configuration archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  cd / && base64 -d /weblogic-operator/introspector/primordial_domainzip.secure > /tmp/domain.tar.gz && \\\n+   tar -xzf /tmp/domain.tar.gz\n+\n+  # decrypt the SerializedSystemIni first\n+  if [ -f ${RUNTIME_ENCRYPTION_SECRET_PASSWORD} ] ; then\n+    MII_PASSPHRASE=$(cat ${RUNTIME_ENCRYPTION_SECRET_PASSWORD})\n+  else\n+    trace SEVERE \"Domain Source Type is 'FromModel' which requires specifying a runtimeEncryptionSecret \" \\\n+    \"in your domain resource and deploying this secret with a 'password' key, but the secret does not have this key.\"\n+    exit 1\n+  fi\n+  encrypt_decrypt_domain_secret \"decrypt\" ${DOMAIN_HOME} ${MII_PASSPHRASE}\n+\n+  # restore the config zip\n+  #\n+  cd / && base64 -d /weblogic-operator/introspector/domainzip.secure > /tmp/domain.tar.gz && \\\n+    tar -xzf /tmp/domain.tar.gz\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh\n+\n+  # restore the archive apps and libraries\n+  #\n+  trace \"Model-in-Image: Deploying libraries.\"\n+\n+  mkdir -p ${DOMAIN_HOME}/lib\n+  if [ $? -ne 0 ] ; then\n+    trace \"Domain type is FromModel, cannot create ${DOMAIN_HOME}/lib \"\n+    exit 1\n+  fi\n+\n+  for file in $(sort_files ${IMG_ARCHIVES_ROOTDIR} \"*.zip\")\n+    do\n+        # expand the archive domain libraries to the domain lib\n+        cd ${DOMAIN_HOME}/lib  || exit 1\n+        jar xf ${IMG_ARCHIVES_ROOTDIR}/${file} wlsdeploy/domainLibraries/\n+\n+        if [ $? -ne 0 ] ; then\n+          trace \"Domain type is FromModel, error in extracting application archive ${IMG_ARCHIVES_ROOTDIR}/${file}\"\n+          exit 1\n+        fi\n+\n+        # expand the archive apps and shared lib to the wlsdeploy/* directories\n+        # the config.xml is referencing them from that path\n+\n+        cd ${DOMAIN_HOME} || exit 1\n+        jar xf ${IMG_ARCHIVES_ROOTDIR}/${file} wlsdeploy/\n+\n+        if [ $? -ne 0 ] ; then\n+          trace \"Domain type is FromModel, error in extracting application archive ${IMG_ARCHIVES_ROOTDIR}/${file}\"\n+          exit 1\n+        fi\n+        # no need we are not expanding to it", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "babb50a8da98a0cb6bed089db00fdda9f49e4516"}, "originalPosition": 131}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "932021a42bfc0fa72ba18f6c62e54f8f29feee2e", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/932021a42bfc0fa72ba18f6c62e54f8f29feee2e", "committedDate": "2020-03-25T11:41:05Z", "message": "Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "568041d718b6fcd25ca6440535bbbb367507829c", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/568041d718b6fcd25ca6440535bbbb367507829c", "committedDate": "2020-03-25T11:41:13Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDcyMjc1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381072275", "createdAt": "2020-03-25T11:44:29Z", "commit": {"oid": "568041d718b6fcd25ca6440535bbbb367507829c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMTo0NDoyOVrOF7XUeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMTo0NDoyOVrOF7XUeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc5MjM3Nw==", "bodyText": "Return value of replaceAll is ignored.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397792377", "createdAt": "2020-03-25T11:44:29Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/MiiBaseTest.java", "diffHunk": "@@ -0,0 +1,119 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.kubernetes.operator;\n+\n+import java.nio.charset.Charset;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.logging.Level;\n+\n+import oracle.kubernetes.operator.utils.Domain;\n+import oracle.kubernetes.operator.utils.DomainCrd;\n+import oracle.kubernetes.operator.utils.ExecResult;\n+import oracle.kubernetes.operator.utils.LoggerHelper;\n+import oracle.kubernetes.operator.utils.TestUtils;\n+\n+public class MiiBaseTest extends BaseTest {\n+  /**\n+   * Creates a map with customized domain input attributes using suffixCount and prefix\n+   * to make the namespaces and ports unique for model in image.\n+   *\n+   * @param suffixCount unique numeric value\n+   * @param prefix      prefix for the artifact names\n+   * @return map with domain input attributes\n+   */\n+  public Map<String, Object> createModelInImageMap(\n+      int suffixCount, String prefix) {\n+    Map<String, Object> domainMap = createDomainMap(suffixCount, prefix);\n+    domainMap.put(\"domainHomeSourceType\", \"FromModel\");\n+    domainMap.put(\"domainHomeImageBase\",\n+        getWeblogicImageName() + \":\" + getWeblogicImageTag());\n+    domainMap.put(\"logHomeOnPV\", \"true\");\n+    //domainMap.put(\"wdtDomainType\", \"WLS\");\n+\n+    if (prefix != null && !prefix.trim().equals(\"\")) {\n+      domainMap.put(\"image\", prefix.toLowerCase() + \"-modelinimage-\" + suffixCount + \":latest\");\n+    } else {\n+      domainMap.put(\"image\", \"modelinimage-\" + suffixCount + \":latest\");\n+    }\n+    return domainMap;\n+  }\n+\n+  /**\n+   * Create domain using model in image.\n+   * @param domainUidPrefix domain UID prefix\n+   * @param domainNS domain namespace\n+   * @param wdtModelFile file should be under test/resouces/model-in-image dir,\n+   *                     value can be ./model.wls.yaml\n+   * @param wdtModelPropertiesFile file should be under test/resouces/model-in-image dir,\n+   *                               value can be ./model.empty.properties\n+   * @param cmFile creates configmap from this file or dir\n+   */\n+  public Domain createMiiDomainWithConfigMap(String domainUidPrefix,\n+                                             String domainNS, String wdtModelFile, String wdtModelPropertiesFile,\n+                                             String cmFile, String wdtDomainType) throws Exception {\n+    Map<String, Object> domainMap =\n+        createModelInImageMap(getNewSuffixCount(), domainUidPrefix);\n+    // config map before deploying domain crd\n+    String cmName = domainMap.get(\"domainUID\") + \"-mii-config-map\";\n+\n+    domainMap.put(\"namespace\", domainNS);\n+    domainMap.put(\"wdtModelFile\", wdtModelFile);\n+    domainMap.put(\"wdtModelPropertiesFile\", wdtModelPropertiesFile);\n+    domainMap.put(\"wdtDomainType\", wdtDomainType);\n+\n+    domainMap.put(\"miiConfigMap\", cmName);\n+    domainMap.put(\"miiConfigMapFileOrDir\", cmFile);\n+\n+    Domain domain = TestUtils.createDomain(domainMap);\n+    // domain = new Domain(domainMap, true, false);\n+    domain.verifyDomainCreated();\n+    return domain;\n+  }\n+\n+  /**\n+   * Modify the domain yaml to add reference to config map and change domain-level restart version.\n+   * @param cmName Config map name\n+   * @param domain the domain\n+   * @throws Exception on failure\n+   */\n+  public void modifyDomainYamlWithNewConfigMapAndDomainRestartVersion(\n+      String cmName, Domain domain)\n+      throws Exception {\n+    String originalYaml =\n+        getUserProjectsDir()\n+            + \"/weblogic-domains/\"\n+            + domain.getDomainUid()\n+            + \"/domain.yaml\";\n+\n+    // Modify the original domain yaml to include restartVersion in admin server node\n+    DomainCrd crd = new DomainCrd(originalYaml);\n+    Map<String, String> objectNode = new HashMap<>();\n+    objectNode.put(\"restartVersion\", \"v1.1\");\n+    crd.addObjectNodeToDomain(objectNode);\n+    String modYaml = crd.getYamlTree();\n+    LoggerHelper.getLocal().log(Level.INFO, modYaml);\n+\n+    //change config map name to new config map\n+    modYaml.replaceAll((String)domain.getDomainMap().get(\"miiConfigMap\"), cmName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568041d718b6fcd25ca6440535bbbb367507829c"}, "originalPosition": 103}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDc0MDYx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381074061", "createdAt": "2020-03-25T11:47:26Z", "commit": {"oid": "568041d718b6fcd25ca6440535bbbb367507829c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMTo0NzoyNlrOF7Xaxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMTo0NzoyNlrOF7Xaxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc5Mzk5MQ==", "bodyText": "lowercase \"Operator\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397793991", "createdAt": "2020-03-25T11:47:26Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/userguide/managing-domains/domain-lifecycle/restarting.md", "diffHunk": "@@ -52,6 +53,18 @@ For domain home in image, any changes (dynamic or non-dynamic) to the WebLogic c\n     * If you create a new image with a new name, then you must avoid a rolling restart, which can cause unexpected behavior for the running domain due to configuration inconsistencies as seen by the various servers, by following the steps in [Avoiding a rolling restart when changing image property on a domain resource](#avoiding-a-rolling-restart-when-changing-image-property-on-a-domain-resource).\n     * If you create a new image with the same name, then you must manually initiate a full domain restart. See [Full domain restarts]({{< relref \"/userguide/managing-domains/domain-lifecycle/startup/_index.md#full-domain-restarts\" >}}) in Starting, stopping, and restarting servers.\n \n+* **Model in image:**\n+\n+    * For Model in Image, any image that supplies configuration changes that are incompatible with the current running domain require a full shutdown before changing the domain resource image setting instead of a rolling restart. Consult [Supported and unsupported updates]({{< relref \"/userguide/managing-domains/model-in-image/runtime-updates/_index.md#supported-and-unsupported-updates\" >}}) in Model in Image Runtime Updates for changes that support a rolling restart.\n+\n+    * If you create a new image with a new name, and you want to avoid a rolling restart, see [Avoiding a rolling restart when changing image property on a domain resource](#avoiding-a-rolling-restart-when-changing-image-property-on-a-domain-resource).\n+\n+    * If you create a new image with the same name, then you must manually initiate either a full domain restart or rolling restart for Pods to run with the new image. To initiate a full restart, see [Full domain restarts]({{< relref \"/userguide/managing-domains/domain-lifecycle/startup/_index.md#full-domain-restarts\" >}}) in Starting, stopping, and restarting servers. To initiate a rolling restart, change the value of your domain resource `restartVersion` field.  See [Restarting Servers]({{< relref \"/userguide/managing-domains/domain-lifecycle/startup/_index.md#restarting-servers\" >}}) and [Rolling Restarts]({{< relref \"/userguide/managing-domains/domain-lifecycle/startup/_index.md#rolling-restarts\" >}}) in Starting, stopping, and restarting servers\n+\n+    * If you are supplying updated models or secrets for a running domain, and you want the configuration updates to take effect using a rolling restart: \n+      * You must either supply a new image name in the domain resource or change the domain resource's `restartVersion` in order to force the Operator to reload the configuration. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "568041d718b6fcd25ca6440535bbbb367507829c"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2c5250c4901dd2b4c892cb9a29714a0a3dfc4f3", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d2c5250c4901dd2b4c892cb9a29714a0a3dfc4f3", "committedDate": "2020-03-25T11:50:50Z", "message": "Update restarting.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9190d5ed90dfddfb6d2576d5c6ca0628e28d409e", "committedDate": "2020-03-25T11:54:49Z", "message": "Update usage.md"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDg0Mjc5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381084279", "createdAt": "2020-03-25T12:03:50Z", "commit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjowMzo1MFrOF7X8TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjowMzo1MFrOF7X8TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgwMjU3Mg==", "bodyText": "@mriccell @vanajamukkara @tbarnes-us @ddsharpe  This is a big script to be part of tests.  It looks like product code.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397802572", "createdAt": "2020-03-25T12:03:50Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/resources/model-in-image/create-domain.sh", "diffHunk": "@@ -0,0 +1,291 @@\n+#!/usr/bin/env bash", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDg4NTAz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381088503", "createdAt": "2020-03-25T12:10:47Z", "commit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjoxMDo0N1rOF7YKAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjoxMDo0N1rOF7YKAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgwNjA4MA==", "bodyText": "This is not a useful error message.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397806080", "createdAt": "2020-03-25T12:10:47Z", "author": {"login": "rjeberhard"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/model-in-image/create_secret.sh", "diffHunk": "@@ -0,0 +1,60 @@\n+# !/bin/sh\n+# Copyright (c) 2019, 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+#\n+# Helper script for creating and labeling a Kubernetes secret.  The secret\n+# is labeled with the specified domain-uid.\n+#\n+# Usage:\n+#\n+# ./create_secret.sh [-n mynamespace] [-d mydomainuid] -s mysecretname [-l key1=val1] [-l key2=val2] [-f key=fileloc ]...\n+# \n+# -d <domain_uid>     : Defaults to $DOMAIN_UID if DOMAIN_UID is set, 'sample-domain1' otherwise.\n+# -n <namespace>      : Defaults to $DOMAIN_NAMESPACE if DOMAIN_NAMESPACE is set, 'DOMAIN_UID-ns' otherwise.\n+# -s <secret-name>    : Name of secret. Required.\n+# -l <key-value-pair> : Secret 'literal' key/value pair, for example '-l password=abc123'.\n+#                       Can be specified more than once. \n+#                       This script doesn't support spaces in the key/value pair.\n+# -f <key-value-pair> : Secret 'file-name' key/file pair, for example '-l walletFile=./ewallet.p12'.\n+#                       Can be specified more than once. \n+#                       This script doesn't support spaces in the key/file pair.\n+#\n+\n+set -e\n+\n+DOMAIN_UID=\"${DOMAIN_UID:-sample-domain1}\"\n+NAMESPACE=\"${DOMAIN_NAMESPACE:-${DOMAIN_UID}-ns}\"\n+SECRET_NAME=\"\"\n+LITERALS=\"\"\n+FILENAMES=\"\"\n+\n+while [ ! \"$1\" = \"\" ]; do\n+  if [ \"$2\" = \"\" ]; then\n+    echo Syntax Error", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDkwNjE4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381090618", "createdAt": "2020-03-25T12:14:04Z", "commit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjoxNDowNFrOF7YQ7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjoxNDowNFrOF7YQ7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgwNzg1Mg==", "bodyText": "What about other data that is input to the domain home generation?  @jshum2479, remind me how this will be used.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397807852", "createdAt": "2020-03-25T12:14:04Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/ConfigMapHelper.java", "diffHunk": "@@ -137,6 +144,17 @@ static String extractFilename(String line) {\n     return fname;\n   }\n \n+  /**\n+   * getModelInImageSpecHash returns the hash for the fields that should be compared for changes.\n+   *\n+   * @return int hash value of the fields\n+   */\n+  public static int getModelInImageSpecHash(String imageName) {\n+    return new HashCodeBuilder(17, 37)\n+        .append(imageName)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDkxMTkz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381091193", "createdAt": "2020-03-25T12:14:53Z", "commit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjoxNDo1NFrOF7YSvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjoxNDo1NFrOF7YSvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgwODMxOA==", "bodyText": "Odd... duplicated code lines", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397808318", "createdAt": "2020-03-25T12:14:54Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/ConfigMapHelper.java", "diffHunk": "@@ -380,6 +400,27 @@ public NextAction apply(Packet packet) {\n         ScanCache.INSTANCE.registerScan(\n             info.getNamespace(), info.getDomainUid(), new Scan(wlsDomainConfig, new DateTime()));\n         packet.put(ProcessingConstants.DOMAIN_TOPOLOGY, wlsDomainConfig);\n+        if (miiDomainZipHash != null) {\n+          packet.put(ProcessingConstants.DOMAIN_HASH, miiDomainZipHash);\n+        }\n+        if (miiModelSecretsHash != null) {\n+          packet.put(ProcessingConstants.SECRETS_HASH, miiModelSecretsHash);\n+        }\n+        String domainRestartVersion = info.getDomain().getRestartVersion();\n+        String domainIntrospectVersion = info.getDomain().getIntrospectVersion();\n+        int modelInImageSpecHash =  ConfigMapHelper.getModelInImageSpecHash(info.getDomain().getSpec().getImage());\n+        if (domainRestartVersion != null) {\n+          packet.put(ProcessingConstants.DOMAIN_RESTART_VERSION, domainRestartVersion);\n+          data.put(ProcessingConstants.DOMAIN_RESTART_VERSION, domainRestartVersion);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDkxMzY5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381091369", "createdAt": "2020-03-25T12:15:08Z", "commit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjoxNTowOFrOF7YTRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjoxNTowOFrOF7YTRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgwODQ1NQ==", "bodyText": "Same... very odd.  Duplicated line.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397808455", "createdAt": "2020-03-25T12:15:08Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/ConfigMapHelper.java", "diffHunk": "@@ -380,6 +400,27 @@ public NextAction apply(Packet packet) {\n         ScanCache.INSTANCE.registerScan(\n             info.getNamespace(), info.getDomainUid(), new Scan(wlsDomainConfig, new DateTime()));\n         packet.put(ProcessingConstants.DOMAIN_TOPOLOGY, wlsDomainConfig);\n+        if (miiDomainZipHash != null) {\n+          packet.put(ProcessingConstants.DOMAIN_HASH, miiDomainZipHash);\n+        }\n+        if (miiModelSecretsHash != null) {\n+          packet.put(ProcessingConstants.SECRETS_HASH, miiModelSecretsHash);\n+        }\n+        String domainRestartVersion = info.getDomain().getRestartVersion();\n+        String domainIntrospectVersion = info.getDomain().getIntrospectVersion();\n+        int modelInImageSpecHash =  ConfigMapHelper.getModelInImageSpecHash(info.getDomain().getSpec().getImage());\n+        if (domainRestartVersion != null) {\n+          packet.put(ProcessingConstants.DOMAIN_RESTART_VERSION, domainRestartVersion);\n+          data.put(ProcessingConstants.DOMAIN_RESTART_VERSION, domainRestartVersion);\n+        }\n+        if (domainIntrospectVersion != null) {\n+          packet.put(ProcessingConstants.DOMAIN_INTROSPECT_VERSION, domainIntrospectVersion);\n+          data.put(ProcessingConstants.DOMAIN_INTROSPECT_VERSION, domainIntrospectVersion);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDkxNzU3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381091757", "createdAt": "2020-03-25T12:15:45Z", "commit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjoxNTo0NVrOF7YUgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjoxNTo0NVrOF7YUgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgwODc2OQ==", "bodyText": "less chance for NPE if you reverse the equals check and start with the constant.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397808769", "createdAt": "2020-03-25T12:15:45Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/ConfigMapHelper.java", "diffHunk": "@@ -380,6 +400,27 @@ public NextAction apply(Packet packet) {\n         ScanCache.INSTANCE.registerScan(\n             info.getNamespace(), info.getDomainUid(), new Scan(wlsDomainConfig, new DateTime()));\n         packet.put(ProcessingConstants.DOMAIN_TOPOLOGY, wlsDomainConfig);\n+        if (miiDomainZipHash != null) {\n+          packet.put(ProcessingConstants.DOMAIN_HASH, miiDomainZipHash);\n+        }\n+        if (miiModelSecretsHash != null) {\n+          packet.put(ProcessingConstants.SECRETS_HASH, miiModelSecretsHash);\n+        }\n+        String domainRestartVersion = info.getDomain().getRestartVersion();\n+        String domainIntrospectVersion = info.getDomain().getIntrospectVersion();\n+        int modelInImageSpecHash =  ConfigMapHelper.getModelInImageSpecHash(info.getDomain().getSpec().getImage());\n+        if (domainRestartVersion != null) {\n+          packet.put(ProcessingConstants.DOMAIN_RESTART_VERSION, domainRestartVersion);\n+          data.put(ProcessingConstants.DOMAIN_RESTART_VERSION, domainRestartVersion);\n+        }\n+        if (domainIntrospectVersion != null) {\n+          packet.put(ProcessingConstants.DOMAIN_INTROSPECT_VERSION, domainIntrospectVersion);\n+          data.put(ProcessingConstants.DOMAIN_INTROSPECT_VERSION, domainIntrospectVersion);\n+        }\n+        if (info.getDomain().getDomainHomeSourceType().equals(\"FromModel\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDkxOTY3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381091967", "createdAt": "2020-03-25T12:16:02Z", "commit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjoxNjowMlrOF7YVIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjoxNjowMlrOF7YVIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgwODkyOA==", "bodyText": "I wonder if this is some sort of merge problem?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397808928", "createdAt": "2020-03-25T12:16:02Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/ConfigMapHelper.java", "diffHunk": "@@ -380,6 +400,27 @@ public NextAction apply(Packet packet) {\n         ScanCache.INSTANCE.registerScan(\n             info.getNamespace(), info.getDomainUid(), new Scan(wlsDomainConfig, new DateTime()));\n         packet.put(ProcessingConstants.DOMAIN_TOPOLOGY, wlsDomainConfig);\n+        if (miiDomainZipHash != null) {\n+          packet.put(ProcessingConstants.DOMAIN_HASH, miiDomainZipHash);\n+        }\n+        if (miiModelSecretsHash != null) {\n+          packet.put(ProcessingConstants.SECRETS_HASH, miiModelSecretsHash);\n+        }\n+        String domainRestartVersion = info.getDomain().getRestartVersion();\n+        String domainIntrospectVersion = info.getDomain().getIntrospectVersion();\n+        int modelInImageSpecHash =  ConfigMapHelper.getModelInImageSpecHash(info.getDomain().getSpec().getImage());\n+        if (domainRestartVersion != null) {\n+          packet.put(ProcessingConstants.DOMAIN_RESTART_VERSION, domainRestartVersion);\n+          data.put(ProcessingConstants.DOMAIN_RESTART_VERSION, domainRestartVersion);\n+        }\n+        if (domainIntrospectVersion != null) {\n+          packet.put(ProcessingConstants.DOMAIN_INTROSPECT_VERSION, domainIntrospectVersion);\n+          data.put(ProcessingConstants.DOMAIN_INTROSPECT_VERSION, domainIntrospectVersion);\n+        }\n+        if (info.getDomain().getDomainHomeSourceType().equals(\"FromModel\")) {\n+          packet.put(ProcessingConstants.DOMAIN_INPUTS_HASH, String.valueOf(modelInImageSpecHash));\n+          data.put(ProcessingConstants.DOMAIN_INPUTS_HASH, String.valueOf(modelInImageSpecHash));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9190d5ed90dfddfb6d2576d5c6ca0628e28d409e"}, "originalPosition": 77}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d569874b6d6dbcdfc52f0e7729f2b2d8c810e0e", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8d569874b6d6dbcdfc52f0e7729f2b2d8c810e0e", "committedDate": "2020-03-25T12:25:05Z", "message": "Code review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef274f02858327b733f9c1b91bd0bbb9dea57ed0", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ef274f02858327b733f9c1b91bd0bbb9dea57ed0", "committedDate": "2020-03-25T12:26:05Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11e9b3fd00e2913ac9e68a80695bd4c44e16831d", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/11e9b3fd00e2913ac9e68a80695bd4c44e16831d", "committedDate": "2020-03-25T12:58:14Z", "message": "remove unnecessary comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTIxODMw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381121830", "createdAt": "2020-03-25T12:59:38Z", "commit": {"oid": "ef274f02858327b733f9c1b91bd0bbb9dea57ed0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjo1OTozOFrOF7Z0iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMjo1OTozOFrOF7Z0iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgzMzM1Mw==", "bodyText": "Shall we explain how customers can mix-and-match those types? I assume they can only mix-and-match some sub-features, and we probably need to point those out.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397833353", "createdAt": "2020-03-25T12:59:38Z", "author": {"login": "doxiao"}, "path": "docs-source/content/userguide/managing-domains/choosing-a-model/_index.md", "diffHunk": "@@ -1,23 +1,27 @@\n +++\n-title = \"Choose a model\"\n+title = \"Choose a domain home source type\"\n date = 2019-02-23T16:44:54-05:00\n weight = 1\n pre = \"<b> </b>\"\n +++\n \n-When using the operator, a WebLogic domain can be located either in a persistent volume (PV) or in a Docker image.\n-There are advantages to both approaches, and there are sometimes technical limitations of various\n-cloud providers that may make one approach better suited to your needs.\n-You can also mix and match on a domain-by-domain basis.\n+When using the operator to deploy a WebLogic domain, you have the choice of the following WebLogic domain home source types:\n \n-| Domain on a persistent volume | Domain in a Docker image |\n-| --- | --- |\n-| Let's you use the same standard read-only Docker image for every server in every domain. | Requires a different image for each domain, but all servers in that domain use the same image. |\n-| No state is kept in Docker images making them completely throw away (cattle not pets). | Runtime state should not be kept in the images, but applications and configuration are. |\n-| The domain is long-lived, so you can mutate the configuration or deploy new applications using standard methods (Administration Console, WLST, and such). | If you want to mutate the domain configuration or deploy application updates, you must create a new image. |\n-| Logs are automatically placed on persistent storage.  | Logs are kept in the images, and sent to the pod's log (stdout) unless you manually place them on persistent storage.  |\n-| Patches can be applied by simply changing the image and rolling the domain.  | To apply patches, you must create a new domain-specific image and then roll the domain.  |\n-| Many cloud providers do not provide persistent volumes that are shared across availability zones, so you may not be able to use a single persistent volume.  You may need to use some kind of volume replication technology or a clustered file system. | You do not have to worry about volume replication across availability zones since each pod has its own copy of the domain.  WebLogic replication will handle propagation of any online configuration changes.  |\n-| CI/CD pipelines may be more complicated because you would probably need to run WLST against the live domain directory to effect changes.  | CI/CD pipelines are simpler because you can create the whole domain in the image and don't have to worry about a persistent copy of the domain.  |\n-| There are less images to manage and store, which could provide significant storage and network savings.  |  There are more images to manage and store in this approach. |\n-| You may be able to use standard Oracle-provided images or, at least, a very small number of self-built images, for example, with patches installed. | You may need to do more work to set up processes to build and maintain your images. |\n+ - **Domain in PV**: Supply your domain home configuration in a persistent volume.\n+ - **Domain in Image**: Supply your domain home in a Docker image.\n+ - **Model in Image**: Supply a WebLogic Deployment Tool model file in a Docker image.\n+\n+There are advantages to all approaches, and there are sometimes technical limitations of various cloud providers that may make one approach better suited to your needs.  You can also mix and match on a domain-by-domain basis.\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef274f02858327b733f9c1b91bd0bbb9dea57ed0"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6399abe246ba77a04812a2904f8491d72e7e5a31", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6399abe246ba77a04812a2904f8491d72e7e5a31", "committedDate": "2020-03-25T13:13:17Z", "message": "minor edit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d355613cda9674ce06a0cf9724342ea6905398b", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5d355613cda9674ce06a0cf9724342ea6905398b", "committedDate": "2020-03-25T13:14:40Z", "message": "minor edit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3747945367d8af0743083b3c7193ff454b004c20", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3747945367d8af0743083b3c7193ff454b004c20", "committedDate": "2020-03-25T13:43:15Z", "message": "Minor doc changes\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13a015a6ef0ca43b3197b3f9591423e47371cfde", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/13a015a6ef0ca43b3197b3f9591423e47371cfde", "committedDate": "2020-03-25T13:46:07Z", "message": "Revert one doc change\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTY4NDk5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381168499", "createdAt": "2020-03-25T13:54:43Z", "commit": {"oid": "13a015a6ef0ca43b3197b3f9591423e47371cfde"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMzo1NDo0M1rOF7cJWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMzo1NDo0M1rOF7cJWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg3MTQ1MQ==", "bodyText": "The paragraph above needs to mention the new option/approach - Molde-in-Image - too.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397871451", "createdAt": "2020-03-25T13:54:43Z", "author": {"login": "doxiao"}, "path": "docs-source/content/userguide/cicd/_index.md", "diffHunk": "@@ -56,7 +56,7 @@ outside of the image.  The second approach puts the JDK, WebLogic binaries\n and the domain all in the Docker image.  Both of these approaches are perfectly\n valid (and fully supported) and they have various advantages and disadvantages.\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13a015a6ef0ca43b3197b3f9591423e47371cfde"}, "originalPosition": 3}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d705d039bb6d9dc20b378d87d0c26ada93b90d40", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d705d039bb6d9dc20b378d87d0c26ada93b90d40", "committedDate": "2020-03-25T14:00:37Z", "message": "Javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb9639063de38b4455da62833c82b8b8bb07a094", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/cb9639063de38b4455da62833c82b8b8bb07a094", "committedDate": "2020-03-25T14:00:43Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTc5MzEy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381179312", "createdAt": "2020-03-25T14:06:07Z", "commit": {"oid": "13a015a6ef0ca43b3197b3f9591423e47371cfde"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDowNjowN1rOF7cr3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDowNjowN1rOF7cr3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg4MDI4NQ==", "bodyText": "I thought config overrides are not supported for Model in Image. Typo? \"Model in Image\" -> \"Domain in Image\"?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397880285", "createdAt": "2020-03-25T14:06:07Z", "author": {"login": "doxiao"}, "path": "docs-source/content/userguide/managing-domains/configoverrides/_index.md", "diffHunk": "@@ -24,7 +24,11 @@ pre = \"<b> </b>\"\n ---\n ### Overview\n \n-Use configuration overrides (also called _situational configuration_) to customize a WebLogic domain home configuration without modifying the domain's actual `config.xml` or system resource files. For example, you may want to override a JDBC data source XML module user name, password, and URL so that it references a local database.\n+{{% notice note %}}\n+Configuration overrides can only be used in combination with Domain in Image and Domain in PV domains. For Model in Image domains, use [Model in Image Runtime Updates]({{< relref \"/userguide/managing-domains/model-in-image/runtime-updates.md\" >}}) instead.\n+{{% /notice %}}\n+\n+Use configuration overrides (also called _situational configuration_) to customize a Model in Image or Domain in PV domain's WebLogic domain home configuration without modifying the domain's actual `config.xml` or system resource files. For example, you may want to override a JDBC data source XML module user name, password, and URL so that it references a local database.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13a015a6ef0ca43b3197b3f9591423e47371cfde"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTg3NDMz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381187433", "createdAt": "2020-03-25T14:14:52Z", "commit": {"oid": "cb9639063de38b4455da62833c82b8b8bb07a094"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDoxNDo1MlrOF7dE-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDoxNDo1MlrOF7dE-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg4NjcxMg==", "bodyText": "A similar statement exists in the beginning of this doc as a notice (see Overview section above). It is okay if the repetition is intentional and we would like to emphasize this.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397886712", "createdAt": "2020-03-25T14:14:52Z", "author": {"login": "doxiao"}, "path": "docs-source/content/userguide/managing-domains/configoverrides/_index.md", "diffHunk": "@@ -59,6 +63,8 @@ For a detailed walk-through of the runtime flow, see the [Internal design flow](\n ---\n ### Prerequisites\n \n+* Configuration overrides can only be used in combination with Domain in Image and Domain in PV domains (the `domainHomeSourceType` must be either `PersistentVolume` or `Image`). For Model in Image domains (`domainHomeSourceType` is `FromModel`), use [Model in Image Runtime Updates]({{< relref \"/userguide/managing-domains/model-in-image/runtime-updates.md\" >}}) instead.\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb9639063de38b4455da62833c82b8b8bb07a094"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b45bfbf2ef6d7f1808106b6e065a480d634a3fb6", "author": {"user": {"login": "sankarpn", "name": "Sankar Periyathambi Neelakandan"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b45bfbf2ef6d7f1808106b6e065a480d634a3fb6", "committedDate": "2020-03-25T14:21:46Z", "message": "Adding weblogic credentials change test (#1493)\n\n* Adding testCredentialsChange\r\n\r\n* fix import\r\n\r\n* Add utility method to replace runtimeEncryptionSecret\r\n\r\n* modify the secret\r\n\r\n* fix formatting\r\n\r\n* fix formatting\r\n\r\n* remove unwanted code\r\n\r\n* cleanup\r\n\r\n* cleanup\r\n\r\n* cleanup\r\n\r\n* fix indendation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTk3ODU1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381197855", "createdAt": "2020-03-25T14:25:19Z", "commit": {"oid": "cb9639063de38b4455da62833c82b8b8bb07a094"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDoyNToxOVrOF7dlFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDoyNToxOVrOF7dlFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg5NDkzMw==", "bodyText": "This title needs to be changed since the section applies to both domain home in image and model in image. The content has been changed already to cover the model-in-image use case.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397894933", "createdAt": "2020-03-25T14:25:19Z", "author": {"login": "doxiao"}, "path": "docs-source/content/userguide/managing-domains/domain-lifecycle/restarting.md", "diffHunk": "@@ -122,7 +135,7 @@ With patches that are not rolling compatible:\n #### Updating deployed applications for domain home in image", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb9639063de38b4455da62833c82b8b8bb07a094"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMjM4MDE0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381238014", "createdAt": "2020-03-25T15:04:31Z", "commit": {"oid": "b45bfbf2ef6d7f1808106b6e065a480d634a3fb6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTowNDozMVrOF7fiAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTowNDozMVrOF7fiAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkyNjkxNQ==", "bodyText": "Call 'exitOrLoop' instead of just exit 1 throughout.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397926915", "createdAt": "2020-03-25T15:04:31Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/startServer.sh", "diffHunk": "@@ -126,11 +147,93 @@ function copySitCfg() {\n   fi\n }\n \n+# prepare mii server\n+\n+function prepareMIIServer() {\n+\n+  trace \"Model-in-Image: Creating domain home.\"\n+\n+  # primordial domain contain the basic structures, security and other fmwconfig templated info\n+  # domainzip only contains the domain configuration (config.xml jdbc/ jms/)\n+  # Both are needed for the complete domain reconstruction\n+\n+  if [ ! -f /weblogic-operator/introspector/primordial_domainzip.secure ] ; then\n+    trace \"Domain Source Type is FromModel, the primordial model archive is missing, cannot start server\"\n+    exit 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b45bfbf2ef6d7f1808106b6e065a480d634a3fb6"}, "originalPosition": 73}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8de8af31194f5ac690c7c28e77357acfd7632491", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8de8af31194f5ac690c7c28e77357acfd7632491", "committedDate": "2020-03-25T15:06:16Z", "message": "doc updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7057f19954bd59eff7aa7b04a498f41d72ad9618", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7057f19954bd59eff7aa7b04a498f41d72ad9618", "committedDate": "2020-03-25T15:06:27Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMjQwNzg2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381240786", "createdAt": "2020-03-25T15:07:19Z", "commit": {"oid": "b45bfbf2ef6d7f1808106b6e065a480d634a3fb6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTowNzoyMFrOF7fqSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTowNzoyMFrOF7fqSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkyOTAzMw==", "bodyText": "add || exitOrLoop  (similar advice applies to all major calls that may fail)", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397929033", "createdAt": "2020-03-25T15:07:20Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/startServer.sh", "diffHunk": "@@ -126,11 +147,93 @@ function copySitCfg() {\n   fi\n }\n \n+# prepare mii server\n+\n+function prepareMIIServer() {\n+\n+  trace \"Model-in-Image: Creating domain home.\"\n+\n+  # primordial domain contain the basic structures, security and other fmwconfig templated info\n+  # domainzip only contains the domain configuration (config.xml jdbc/ jms/)\n+  # Both are needed for the complete domain reconstruction\n+\n+  if [ ! -f /weblogic-operator/introspector/primordial_domainzip.secure ] ; then\n+    trace \"Domain Source Type is FromModel, the primordial model archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  if [ ! -f /weblogic-operator/introspector/domainzip.secure ] ; then\n+    trace \"Domain type is FromModel, the domain configuration archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  cd / && base64 -d /weblogic-operator/introspector/primordial_domainzip.secure > /tmp/domain.tar.gz && \\\n+   tar -xzf /tmp/domain.tar.gz", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b45bfbf2ef6d7f1808106b6e065a480d634a3fb6"}, "originalPosition": 82}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMjQxODA4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381241808", "createdAt": "2020-03-25T15:08:19Z", "commit": {"oid": "b45bfbf2ef6d7f1808106b6e065a480d634a3fb6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTowODoxOVrOF7ftLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTowODoxOVrOF7ftLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkyOTc3Mg==", "bodyText": "Break this down and add error checks...  (Ditto for other chains like this.)", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397929772", "createdAt": "2020-03-25T15:08:19Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/startServer.sh", "diffHunk": "@@ -126,11 +147,93 @@ function copySitCfg() {\n   fi\n }\n \n+# prepare mii server\n+\n+function prepareMIIServer() {\n+\n+  trace \"Model-in-Image: Creating domain home.\"\n+\n+  # primordial domain contain the basic structures, security and other fmwconfig templated info\n+  # domainzip only contains the domain configuration (config.xml jdbc/ jms/)\n+  # Both are needed for the complete domain reconstruction\n+\n+  if [ ! -f /weblogic-operator/introspector/primordial_domainzip.secure ] ; then\n+    trace \"Domain Source Type is FromModel, the primordial model archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  if [ ! -f /weblogic-operator/introspector/domainzip.secure ] ; then\n+    trace \"Domain type is FromModel, the domain configuration archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  cd / && base64 -d /weblogic-operator/introspector/primordial_domainzip.secure > /tmp/domain.tar.gz && \\\n+   tar -xzf /tmp/domain.tar.gz\n+\n+  # decrypt the SerializedSystemIni first\n+  if [ -f ${RUNTIME_ENCRYPTION_SECRET_PASSWORD} ] ; then\n+    MII_PASSPHRASE=$(cat ${RUNTIME_ENCRYPTION_SECRET_PASSWORD})\n+  else\n+    trace SEVERE \"Domain Source Type is 'FromModel' which requires specifying a runtimeEncryptionSecret \" \\\n+    \"in your domain resource and deploying this secret with a 'password' key, but the secret does not have this key.\"\n+    exit 1\n+  fi\n+  encrypt_decrypt_domain_secret \"decrypt\" ${DOMAIN_HOME} ${MII_PASSPHRASE}\n+\n+  # restore the config zip\n+  #\n+  cd / && base64 -d /weblogic-operator/introspector/domainzip.secure > /tmp/domain.tar.gz && \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b45bfbf2ef6d7f1808106b6e065a480d634a3fb6"}, "originalPosition": 96}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMjQyNzQ0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381242744", "createdAt": "2020-03-25T15:09:15Z", "commit": {"oid": "b45bfbf2ef6d7f1808106b6e065a480d634a3fb6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTowOToxNVrOF7fwFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTowOToxNVrOF7fwFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzMDUxOQ==", "bodyText": "What if above call fails?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397930519", "createdAt": "2020-03-25T15:09:15Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/startServer.sh", "diffHunk": "@@ -126,11 +147,93 @@ function copySitCfg() {\n   fi\n }\n \n+# prepare mii server\n+\n+function prepareMIIServer() {\n+\n+  trace \"Model-in-Image: Creating domain home.\"\n+\n+  # primordial domain contain the basic structures, security and other fmwconfig templated info\n+  # domainzip only contains the domain configuration (config.xml jdbc/ jms/)\n+  # Both are needed for the complete domain reconstruction\n+\n+  if [ ! -f /weblogic-operator/introspector/primordial_domainzip.secure ] ; then\n+    trace \"Domain Source Type is FromModel, the primordial model archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  if [ ! -f /weblogic-operator/introspector/domainzip.secure ] ; then\n+    trace \"Domain type is FromModel, the domain configuration archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  cd / && base64 -d /weblogic-operator/introspector/primordial_domainzip.secure > /tmp/domain.tar.gz && \\\n+   tar -xzf /tmp/domain.tar.gz\n+\n+  # decrypt the SerializedSystemIni first\n+  if [ -f ${RUNTIME_ENCRYPTION_SECRET_PASSWORD} ] ; then\n+    MII_PASSPHRASE=$(cat ${RUNTIME_ENCRYPTION_SECRET_PASSWORD})\n+  else\n+    trace SEVERE \"Domain Source Type is 'FromModel' which requires specifying a runtimeEncryptionSecret \" \\\n+    \"in your domain resource and deploying this secret with a 'password' key, but the secret does not have this key.\"\n+    exit 1\n+  fi\n+  encrypt_decrypt_domain_secret \"decrypt\" ${DOMAIN_HOME} ${MII_PASSPHRASE}\n+\n+  # restore the config zip\n+  #\n+  cd / && base64 -d /weblogic-operator/introspector/domainzip.secure > /tmp/domain.tar.gz && \\\n+    tar -xzf /tmp/domain.tar.gz\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh\n+\n+  # restore the archive apps and libraries\n+  #\n+  trace \"Model-in-Image: Deploying libraries.\"\n+\n+  mkdir -p ${DOMAIN_HOME}/lib\n+  if [ $? -ne 0 ] ; then\n+    trace  SEVERE \"Domain Source Type is FromModel, cannot create ${DOMAIN_HOME}/lib \"\n+    exit 1\n+  fi\n+\n+  for file in $(sort_files ${IMG_ARCHIVES_ROOTDIR} \"*.zip\")\n+    do\n+        # expand the archive domain libraries to the domain lib\n+        cd ${DOMAIN_HOME}/lib  || exit 1\n+        ${JAVA_HOME}/bin/jar xf ${IMG_ARCHIVES_ROOTDIR}/${file} wlsdeploy/domainLibraries/\n+\n+        if [ $? -ne 0 ] ; then\n+          trace SEVERE  \"Domain Source Type is FromModel, error in extracting application archive ${IMG_ARCHIVES_ROOTDIR}/${file}\"\n+          exit 1\n+        fi\n+\n+        # expand the archive apps and shared lib to the wlsdeploy/* directories\n+        # the config.xml is referencing them from that path\n+\n+        cd ${DOMAIN_HOME} || exit 1\n+        ${JAVA_HOME}/bin/jar xf ${IMG_ARCHIVES_ROOTDIR}/${file} wlsdeploy/\n+\n+        if [ $? -ne 0 ] ; then\n+          trace SEVERE \"Domain Source Type is FromModel, error in extracting application archive ${IMG_ARCHIVES_ROOTDIR}/${file}\"\n+          exit 1\n+        fi\n+    done\n+\n+}\n+\n # trace env vars and dirs before export.*Home calls\n \n traceEnv before\n traceDirs before\n \n+traceTiming \"POD '${SERVICE_NAME}' MII UNZIP START\"\n+\n+if [ -f /weblogic-operator/introspector/domainzip.secure ]; then\n+  prepareMIIServer", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b45bfbf2ef6d7f1808106b6e065a480d634a3fb6"}, "originalPosition": 143}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMjQ3Mjgy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381247282", "createdAt": "2020-03-25T15:13:36Z", "commit": {"oid": "7057f19954bd59eff7aa7b04a498f41d72ad9618"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNToxMzozNlrOF7f94A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNToxMzozNlrOF7f94A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzNDA0OA==", "bodyText": "It would be helpful to add cross-references between this section and  \"> User Guide > Manage FMW Domains > Manage FMW Infrastructure domains\" section.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397934048", "createdAt": "2020-03-25T15:13:36Z", "author": {"login": "doxiao"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/usage.md", "diffHunk": "@@ -0,0 +1,173 @@\n++++\n+title = \"Usage\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 20\n+pre = \"<b> </b>\"\n+description = \"Steps for creating and deploying Model in Image images and their associated domain resources.\"\n++++\n+\n+\n+#### Contents\n+\n+   - [WebLogic Kubernetes Operator](#1-weblogic-kubernetes-operator)\n+   - [WebLogic Server image](#2-weblogic-server-image)\n+   - [Optional WDT model config map](#3-optional-wdt-model-config-map)\n+   - [Required runtime encryption secret](#4-required-runtime-encryption-secret)\n+   - [Secrets for model macros](#5-secrets-for-model-macros)\n+   - [Domain resource attributes](#6-domain-resource-attributes)\n+   - [Prerequisites for JRF domain types](#7-prerequisites-for-jrf-domain-types)\n+\n+#### Requirements\n+\n+Here's what's needed to create and deploy a typical Model in Image domain. These items do not need to be created in order.\n+\n+#### 1. WebLogic Kubernetes Operator\n+\n+Deploy the operator and ensure that it is monitoring the desired namespace for your Model in Image domain. See [Manage operators]({{< relref \"/userguide/managing-operators/_index.md\" >}}) and [Quick Start]({{< relref \"/quickstart/_index.md\" >}}).\n+\n+#### 2. WebLogic Server image\n+\n+Model in Image requires creating a 'final' deployable image that has WebLogic Server and WDT installed, plus your model and application files.\n+\n+You can start with a WebLogic Server 12.2.1.3 or later pre-built base image obtained from [Docker Hub](https://github.com/oracle/docker-images/tree/master/OracleWebLogic) or similar, manually build your own base image as per [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}), or build a base image using the [WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool). Note that any 12.2.1.3 image must also include patch 29135930 (the pre-built images already contain this patch). For an example of the first approach for both WLS and JRF domains, see the [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample.\n+\n+After you have a base image, Model in Image requires layering the following directory structure for its (optional) WDT models artifacts and (required) WDT binaries:\n+\n+| Directory                | Contents                           | Extension   |\n+| ------------------------ | ---------------------------------- | ----------- |\n+| `/u01/wdt/models`         | Optional domain model YAML files   | .yaml       |\n+| `/u01/wdt/models`         | Optional model variable files      | .properties |\n+| `/u01/wdt/models`         | Optional application archives      | .zip        |\n+| `/u01/wdt/weblogic-deploy`| Unzipped WebLogic deploy install   |             |\n+\n+There are two methods for layering Model in Image artifacts on top of a base image:\n+\n+  - **Manual Image Creation**: Use Docker commands to layer the WDT artifacts from the above table on top of your base image into a new image.\n+\n+  - **WebLogic Image Tool**: Use the convenient [WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool). The WebLogic Image Tool (WIT) has built-in options for embedding WDT model files, WDT binaries, WebLogic Server binaries, and WebLogic Server patches in an image. The [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample uses the WIT approach. For an example, see the sample's `build_image_model.sh` file in the operator source's `kubernetes/samples/scripts/create-weblogic-domain/model-in-image` directory.\n+\n+For a discussion of model file syntax, see [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+#### 3. Optional WDT model config map\n+\n+You can create a WDT model config map that defines additional model `.yaml` and `.properties` files beyond what you've already supplied in your image, and then reference this config map using your domain resource's `configuration.model.configMap` attribute. This is optional if the supplied image already fully defines your model.\n+\n+WDT model config map files will be merged with the WDT files defined in your image at runtime before your domain home is created. The config map files can add to, remove from, or alter the model configuration that you supplied within your image.\n+\n+For example, place additional `.yaml` and `.properties` files in a directory called `/home/acmeuser/wdtoverride` and run the following commands:\n+\n+  ```\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    create configmap MY-DOMAINUID-my-wdt-config-map \\\n+    --from-file /home/acmeuser/wdtoverride\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    label  configmap MY-DOMAINUID-my-wdt-config-map \\\n+    weblogic.domainUID=MY-DOMAINUID\n+  ```\n+\n+See [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) for a discussion of model file syntax and loading order, and see [Runtime updates]({{< relref \"/userguide/managing-domains/model-in-image/runtime-updates.md\" >}}) for a discussion of using WDT model config maps to update the model configuration of a running domain.\n+\n+\n+#### 4. Required runtime encryption secret\n+\n+Model in Image requires a runtime encryption secret with a secure `password` key. This secret is used by the operator to encrypt model and domain home artifacts before it adds them to a runtime config map or log. The `password` that you set can safely change any time after you've fully shut down a domain but must remain the same for the life of a running domain. The runtime encryption secret that you create can be named anything but note that it is a best practice to name and label secrets with their domain UID to help ensure that cleanup scripts can find and delete them.\n+\n+**NOTE**: Because the runtime encryption password does not need to be shared and only needs to exist for the life of a domain, you may want to use a password generator.\n+\n+Example:\n+\n+  ```\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    create secret generic MY-DOMAINUID-runtime-encrypt-secret \\\n+    --from-literal=password=welcome1\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    label secret MY-DOMAINUID-runtime-encrypt-secret \\\n+    weblogic.domainUID=MY-DOMAINUID\n+  ```\n+\n+Corresponding domain resource snippet:\n+\n+  ```\n+  configuration:\n+    model:\n+      runtimeEncryptionSecret: MY-DOMAINUID-runtime-encrypt-secret\n+  ```\n+\n+#### 5. Secrets for model macros\n+\n+Create additional secrets as needed by macros in your model files. For example, these can store database URLs and credentials that are accessed using `@@SECRET` macros in your model that reference the secrets.  For a discussion of model macros, see [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+#### 6. Domain resource attributes\n+\n+The following domain resource attributes are specific to Model in Image domains.\n+\n+| Domain Resource Attribute                    |  Notes |\n+| -------------------------                    |  ------------------ |\n+| `domainHomeSourceType`                       |  Required. Set to `FromModel`. |\n+| `domainHome`                                 |  Must reference an empty or non-existent directory within your image. Do not include the mount path of any persistent volume. Note that Model in Image recreates the domain home for a WebLogic pod every time the pod restarts.|\n+| `configuration.model.configMap`             | Optional. Set if you have stored additional models in a config map as per [Optional WDT model config map](#3-optional-wdt-model-config-map). |\n+| `configuration.secrets`                      | Optional. Set this array if your image or config map models contain macros that reference custom Kubernetes secrets. For example, if your macros depend on secrets `my-secret` and `my-other-secret`, then set to `[my-secret, my-other-secret]`.|\n+| `configuration.model.runtimeEncryptionSecret`| Required. All Model in Image domains must specify a runtime encryption secret. See [Required runtime encryption secret](#4-required-runtime-encryption-secret). |\n+| `configuration.model.domainType`             | Set the type of domain. Valid values are `WLS`, `JRF`, and `RestrictedJRF` where `WLS` is the default. See [WDT Domain Types](https://github.com/oracle/weblogic-deploy-tooling/blob/master/site/type_def.md).|\n+\n+Notes:\n+\n+ - There are additional attributes that are common to all domain home source types, such as the `image` field. See the Domain Resource [schema](https://github.com/oracle/weblogic-kubernetes-operator/blob/master/docs/domains/Domain.md) and [documentation]({{< relref \"/userguide/managing-domains/domain-resource.md\" >}}) for a full list of domain resource fields.\n+\n+ - There are also additional fields that are specific to JRF domain types. For more information, see [Prerequisites for JRF domain types](#7-prerequisites-for-jrf-domain-types).\n+\n+ - Sample domain resource: For an example of a fully specified sample domain resource, see the the operator source's `kubernetes/samples/scripts/create-weblogic-domain/model-in-image/k8s-domain.yaml.template` file for the [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample. Note that the `@@` entries in this template are not processed by the operator; they need to replaced with actual values before the resource can be applied.\n+\n+#### 7. Prerequisites for JRF domain types\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7057f19954bd59eff7aa7b04a498f41d72ad9618"}, "originalPosition": 122}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMjUwMzgx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381250381", "createdAt": "2020-03-25T15:16:36Z", "commit": {"oid": "b45bfbf2ef6d7f1808106b6e065a480d634a3fb6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNToxNjozN1rOF7gHIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNToxNjozN1rOF7gHIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzNjQxNg==", "bodyText": "It looks like 'exportEffectiveDomainHome' further below may be called too late?  Doesn't the above depend on the domain home to be correct?\nThe problem is that an 'empty' domain home may actually mean the domain home is not in the expected location - which is what export effective domain home corrects.   A bit of a chicken-and-the-egg problem, but it needs to be solved, as the 'default domain home' is actually a dynamic calculation.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397936416", "createdAt": "2020-03-25T15:16:37Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/startServer.sh", "diffHunk": "@@ -126,11 +147,93 @@ function copySitCfg() {\n   fi\n }\n \n+# prepare mii server\n+\n+function prepareMIIServer() {\n+\n+  trace \"Model-in-Image: Creating domain home.\"\n+\n+  # primordial domain contain the basic structures, security and other fmwconfig templated info\n+  # domainzip only contains the domain configuration (config.xml jdbc/ jms/)\n+  # Both are needed for the complete domain reconstruction\n+\n+  if [ ! -f /weblogic-operator/introspector/primordial_domainzip.secure ] ; then\n+    trace \"Domain Source Type is FromModel, the primordial model archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  if [ ! -f /weblogic-operator/introspector/domainzip.secure ] ; then\n+    trace \"Domain type is FromModel, the domain configuration archive is missing, cannot start server\"\n+    exit 1\n+  fi\n+\n+  cd / && base64 -d /weblogic-operator/introspector/primordial_domainzip.secure > /tmp/domain.tar.gz && \\\n+   tar -xzf /tmp/domain.tar.gz\n+\n+  # decrypt the SerializedSystemIni first\n+  if [ -f ${RUNTIME_ENCRYPTION_SECRET_PASSWORD} ] ; then\n+    MII_PASSPHRASE=$(cat ${RUNTIME_ENCRYPTION_SECRET_PASSWORD})\n+  else\n+    trace SEVERE \"Domain Source Type is 'FromModel' which requires specifying a runtimeEncryptionSecret \" \\\n+    \"in your domain resource and deploying this secret with a 'password' key, but the secret does not have this key.\"\n+    exit 1\n+  fi\n+  encrypt_decrypt_domain_secret \"decrypt\" ${DOMAIN_HOME} ${MII_PASSPHRASE}\n+\n+  # restore the config zip\n+  #\n+  cd / && base64 -d /weblogic-operator/introspector/domainzip.secure > /tmp/domain.tar.gz && \\\n+    tar -xzf /tmp/domain.tar.gz\n+  chmod +x ${DOMAIN_HOME}/bin/*.sh ${DOMAIN_HOME}/*.sh\n+\n+  # restore the archive apps and libraries\n+  #\n+  trace \"Model-in-Image: Deploying libraries.\"\n+\n+  mkdir -p ${DOMAIN_HOME}/lib\n+  if [ $? -ne 0 ] ; then\n+    trace  SEVERE \"Domain Source Type is FromModel, cannot create ${DOMAIN_HOME}/lib \"\n+    exit 1\n+  fi\n+\n+  for file in $(sort_files ${IMG_ARCHIVES_ROOTDIR} \"*.zip\")\n+    do\n+        # expand the archive domain libraries to the domain lib\n+        cd ${DOMAIN_HOME}/lib  || exit 1\n+        ${JAVA_HOME}/bin/jar xf ${IMG_ARCHIVES_ROOTDIR}/${file} wlsdeploy/domainLibraries/\n+\n+        if [ $? -ne 0 ] ; then\n+          trace SEVERE  \"Domain Source Type is FromModel, error in extracting application archive ${IMG_ARCHIVES_ROOTDIR}/${file}\"\n+          exit 1\n+        fi\n+\n+        # expand the archive apps and shared lib to the wlsdeploy/* directories\n+        # the config.xml is referencing them from that path\n+\n+        cd ${DOMAIN_HOME} || exit 1\n+        ${JAVA_HOME}/bin/jar xf ${IMG_ARCHIVES_ROOTDIR}/${file} wlsdeploy/\n+\n+        if [ $? -ne 0 ] ; then\n+          trace SEVERE \"Domain Source Type is FromModel, error in extracting application archive ${IMG_ARCHIVES_ROOTDIR}/${file}\"\n+          exit 1\n+        fi\n+    done\n+\n+}\n+\n # trace env vars and dirs before export.*Home calls\n \n traceEnv before\n traceDirs before\n \n+traceTiming \"POD '${SERVICE_NAME}' MII UNZIP START\"\n+\n+if [ -f /weblogic-operator/introspector/domainzip.secure ]; then\n+  prepareMIIServer\n+fi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b45bfbf2ef6d7f1808106b6e065a480d634a3fb6"}, "originalPosition": 144}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e86d407e248d39af2757f7f77ca6280830ec5bd2", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e86d407e248d39af2757f7f77ca6280830ec5bd2", "committedDate": "2020-03-25T15:20:36Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "341facd920a2ca32e678c1ea3681586becce33d0", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/341facd920a2ca32e678c1ea3681586becce33d0", "committedDate": "2020-03-25T15:20:45Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99d9dc72b0bf631e0659b532036af45069958ad1", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/99d9dc72b0bf631e0659b532036af45069958ad1", "committedDate": "2020-03-25T15:46:08Z", "message": "doc update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMjg3OTU0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381287954", "createdAt": "2020-03-25T15:53:32Z", "commit": {"oid": "341facd920a2ca32e678c1ea3681586becce33d0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTo1MzozMlrOF7h8aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTo1MzozMlrOF7h8aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk2NjQ0MQ==", "bodyText": "Consider renaming to 'model_encryption_util.py' so that it sorts next to the other model scripts.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397966441", "createdAt": "2020-03-25T15:53:32Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/encryption_util.py", "diffHunk": "@@ -0,0 +1,57 @@\n+# Copyright (c) 2019, 2020, Oracle Corporation and/or its affiliates.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "341facd920a2ca32e678c1ea3681586becce33d0"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceb783b877b98aaa50d9a5946860dbeef9468a68", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ceb783b877b98aaa50d9a5946860dbeef9468a68", "committedDate": "2020-03-25T15:54:09Z", "message": "Minor doc fix\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMjg4OTg0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381288984", "createdAt": "2020-03-25T15:54:35Z", "commit": {"oid": "99d9dc72b0bf631e0659b532036af45069958ad1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTo1NDozNVrOF7h_xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTo1NDozNVrOF7h_xQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk2NzMwMQ==", "bodyText": "@rosemarymarano, this list using (a), (b), (c) gets parsed strangely in markdown because (c) becomes the copyright symbol.  How should we organize this?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397967301", "createdAt": "2020-03-25T15:54:35Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/overview.md", "diffHunk": "@@ -0,0 +1,59 @@\n++++\n+title = \"Overview\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 10\n+pre = \"<b> </b>\"\n+description = \"Introduction to Model in Image, description of its runtime behavior, and references.\"\n++++\n+\n+#### Content\n+\n+ - [Introduction](#introduction)\n+ - [Runtime behavior overview](#runtime-behavior-overview)\n+ - [Runtime updates overview](#runtime-updates-overview)\n+ - [References](#references)\n+\n+#### Introduction\n+\n+Model in Image is an alternative to the operator's Domain in Image and Domain on PV domain types. See [Choose a domain home source type]({{< relref \"/userguide/managing-domains/choosing-a-model/_index.md\" >}}) for a comparison of operator domain types.\n+\n+Unlike Domain in PV and Domain in Image, Model in Image eliminates the need to pre-create your WebLogic domain home prior to deploying your domain resource.\n+\n+It enables:\n+\n+ - Defining a WebLogic domain home configuration using WebLogic Deploy Tool (WDT) model files and application archives.\n+ - Embedding model files and archives in a custom Docker image, and using the WebLogic Image Tool (WIT) to generate this image.\n+ - Supplying additional model files using a Kubernetes config map.\n+ - Supplying Kubernetes secrets that resolve macro references within the models. For example, a secret can be used to supply a database credential.\n+ - Updating WDT model files at runtime. For example, you can add a data source to a running domain. Note that all such updates currently cause the domain to 'roll' in order to take effect.\n+ - Deploying standard WLS domains, Restricted JRF domains, or JRF domains.\n+\n+WDT models are a convenient and simple alternative to WebLogic WLST configuration scripts and templates. They compactly define a WebLogic domain using YAML files and support including application archives in a ZIP file.  The WDT model format is described in the open source [WebLogic Deploy Tool](https://github.com/oracle/weblogic-deploy-tooling) GitHub project.\n+\n+For JRF domains, Model in Image provides additional support for (a) initializing the RCU database for a domain when a domain is started for first time, (b) supplying an RCU password, and finally (c) obtaining an RCU wallet for re-use in subsequent restarts of the same domain. See [Prerequisites for JRF domain types]({{< relref \"/userguide/managing-domains/model-in-image/usage/_index.md#7-prerequisites-for-jrf-domain-types\" >}}) and [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99d9dc72b0bf631e0659b532036af45069958ad1"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5aed198290f7fbda117af521d1a5d712be660fd4", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5aed198290f7fbda117af521d1a5d712be660fd4", "committedDate": "2020-03-25T15:55:06Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMjkwMTY1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381290165", "createdAt": "2020-03-25T15:55:47Z", "commit": {"oid": "341facd920a2ca32e678c1ea3681586becce33d0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTo1NTo0N1rOF7iDVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNTo1NTo0N1rOF7iDVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk2ODIxMw==", "bodyText": "Missing copyright.\nMissing code comments with a description.\nConsider renaming to 'model_create_filter.py' so it sorts next to the other model related scripts.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397968213", "createdAt": "2020-03-25T15:55:47Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/wdt_create_filter.py", "diffHunk": "@@ -0,0 +1,23 @@\n+def filter_model(model):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "341facd920a2ca32e678c1ea3681586becce33d0"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMzAyMjA4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-381302208", "createdAt": "2020-03-25T16:08:02Z", "commit": {"oid": "341facd920a2ca32e678c1ea3681586becce33d0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNjowODowMlrOF7ipEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNjowODowMlrOF7ipEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk3Nzg3Mg==", "bodyText": "Since this is sourced into 'startServer.sh' is should be calling the equivalent of the startServer.sh 'exitOrLoop' instead of 'exit 1' throughout.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r397977872", "createdAt": "2020-03-25T16:08:02Z", "author": {"login": "tbarnes-us"}, "path": "operator/src/main/resources/scripts/modelInImage.sh", "diffHunk": "@@ -0,0 +1,794 @@\n+#!/usr/bin/env bash", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "341facd920a2ca32e678c1ea3681586becce33d0"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MDI2NTY1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-378026565", "createdAt": "2020-03-19T19:24:45Z", "commit": {"oid": "a87ee762d639570e75e225ff41023fecafc935a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxOToyNDo0NVrOF49K9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxOToyNDo0NVrOF49K9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTI2NjgwNQ==", "bodyText": "update copyright.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395266805", "createdAt": "2020-03-19T19:24:45Z", "author": {"login": "doxiao"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/model-in-image/build.sh", "diffHunk": "@@ -0,0 +1,37 @@\n+#!/bin/bash\n+# Copyright 2019, Oracle Corporation and/or its affiliates. All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a87ee762d639570e75e225ff41023fecafc935a9"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MDI3MzQy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-378027342", "createdAt": "2020-03-19T19:25:58Z", "commit": {"oid": "a87ee762d639570e75e225ff41023fecafc935a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxOToyNTo1OFrOF49NcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxOToyNTo1OFrOF49NcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTI2NzQ0MQ==", "bodyText": "update copyright", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395267441", "createdAt": "2020-03-19T19:25:58Z", "author": {"login": "doxiao"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/model-in-image/build_download.sh", "diffHunk": "@@ -0,0 +1,81 @@\n+#!/bin/bash\n+# Copyright 2019, Oracle Corporation and/or its affiliates. All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a87ee762d639570e75e225ff41023fecafc935a9"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MDgwMTAz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-378080103", "createdAt": "2020-03-19T20:45:11Z", "commit": {"oid": "a87ee762d639570e75e225ff41023fecafc935a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMDo0NToxMVrOF4_wxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQyMDo0NToxMVrOF4_wxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTMwOTI1NQ==", "bodyText": "The three new methods here are for integration test only.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395309255", "createdAt": "2020-03-19T20:45:11Z", "author": {"login": "doxiao"}, "path": "kubernetes/samples/scripts/common/validate.sh", "diffHunk": "@@ -409,3 +412,51 @@ function validateDomainPVC {\n   failIfValidationErrors\n }\n \n+#\n+# Function to validate the WDT model file exists\n+#\n+function validateWdtModelFile {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a87ee762d639570e75e225ff41023fecafc935a9"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f2f0c8bef89c7a1b0ab438d0699098b74f61725", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0f2f0c8bef89c7a1b0ab438d0699098b74f61725", "committedDate": "2020-03-20T00:14:55Z", "message": "add real blank lines between appending variable files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c6345720d6cbc7473049a36d178782ad5c6409f", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8c6345720d6cbc7473049a36d178782ad5c6409f", "committedDate": "2020-03-20T04:00:57Z", "message": "change wdt secret key to password"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a653acd9b75e15444ff7896b720d52427bd35ed", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4a653acd9b75e15444ff7896b720d52427bd35ed", "committedDate": "2020-03-20T05:58:15Z", "message": "Model in image main hugo doc - first check-in."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NjAyODY5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-378602869", "createdAt": "2020-03-20T15:51:13Z", "commit": {"oid": "4a653acd9b75e15444ff7896b720d52427bd35ed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNTo1MToxNFrOF5ZXww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNTo1MToxNFrOF5ZXww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcyODgzNQ==", "bodyText": "rcu_admin_password is not a required attribute since we are not supporting creation of rcu schema on the fly by WDT.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395728835", "createdAt": "2020-03-20T15:51:14Z", "author": {"login": "jshum2479"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/model-in-image/model1.yaml.jrf", "diffHunk": "@@ -0,0 +1,35 @@\n+domainInfo:\n+    AdminUserName: '@@FILE:/weblogic-operator/secrets/username@@'\n+    AdminPassword: '@@FILE:/weblogic-operator/secrets/password@@'\n+    ServerStartMode: 'prod'\n+    RCUDbInfo:\n+        rcu_prefix: '@@FILE:/weblogic-operator/config-overrides-secrets/sample-domain1-rcu-access/rcu_prefix@@'\n+        rcu_schema_password: '@@FILE:/weblogic-operator/config-overrides-secrets/sample-domain1-rcu-access/rcu_schema_password@@'\n+        rcu_admin_password: '@@FILE:/weblogic-operator/config-overrides-secrets/sample-domain1-rcu-access/rcu_admin_password@@'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a653acd9b75e15444ff7896b720d52427bd35ed"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc785d88a3a645d6f161033897c8598c068d071c", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/dc785d88a3a645d6f161033897c8598c068d071c", "committedDate": "2020-03-20T16:18:28Z", "message": "Remove rcu_admin_password - not required at this point"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9b2199b179f4b07e4234c7fb0293e03450860d8", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c9b2199b179f4b07e4234c7fb0293e03450860d8", "committedDate": "2020-03-20T17:13:30Z", "message": "MII sample updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53668f2f8c4d4f45c2b3e528d5d9bce9a9603f1b", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/53668f2f8c4d4f45c2b3e528d5d9bce9a9603f1b", "committedDate": "2020-03-20T17:15:22Z", "message": "MII sample updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d35a88641d150f9a58391b060826ed158972a7fe", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d35a88641d150f9a58391b060826ed158972a7fe", "committedDate": "2020-03-20T17:25:23Z", "message": "Update copyright\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf9d03a39564c020304b6776b218ad8490b1a4b7", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/bf9d03a39564c020304b6776b218ad8490b1a4b7", "committedDate": "2020-03-20T17:26:49Z", "message": "Add introspectorJobActiveDeadlineSeconds in toString(), hashCode() and equals() calculation\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e3850fe4c9fdd1ed296c878d460ce61405194b8", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9e3850fe4c9fdd1ed296c878d460ce61405194b8", "committedDate": "2020-03-20T17:27:08Z", "message": "MII Sample README update."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c33c404569e7bedceda28609b98efc0de4dcee84", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c33c404569e7bedceda28609b98efc0de4dcee84", "committedDate": "2020-03-20T17:34:22Z", "message": "MII Sample - remove mention of rcu admin password in sample doc."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d091a973b87019cb62db6e69edb28afaa276bfd7", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d091a973b87019cb62db6e69edb28afaa276bfd7", "committedDate": "2020-03-20T17:36:30Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>\n\nConflicts:\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/build.sh\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/build_download.sh\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/build_image_base.sh\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/build_image_model.sh\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/build_model.sh\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/create_configmap.sh\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/create_domain.sh\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/create_secret.sh\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/run_domain.sh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81623b1d513bbbfa1f2ca588a8d757daf2e38202", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/81623b1d513bbbfa1f2ca588a8d757daf2e38202", "committedDate": "2020-03-20T17:37:15Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a14f1a4621ff9576c1aa03437dbd84dcd0e466db", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a14f1a4621ff9576c1aa03437dbd84dcd0e466db", "committedDate": "2020-03-20T18:45:16Z", "message": "first pass edits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NzYwMzgx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-378760381", "createdAt": "2020-03-20T19:32:34Z", "commit": {"oid": "81623b1d513bbbfa1f2ca588a8d757daf2e38202"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxOTozMjozNFrOF5gxsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxOTozMjozNFrOF5gxsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg1MDE2Mw==", "bodyText": "In the old code, if logHomeEnabled is not set, and the domain is on PV, the logHomeEnabled will be set to true. This is missing in the new code. Is this intentional.  The doc seems to indicate that the old logic remains; so the doc and the code does not match.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395850163", "createdAt": "2020-03-20T19:32:34Z", "author": {"login": "doxiao"}, "path": "operator/src/main/java/oracle/kubernetes/weblogic/domain/model/DomainSpec.java", "diffHunk": "@@ -401,8 +437,8 @@ private String validatePath(String s) {\n    * @since 2.0\n    * @return log home enabled\n    */\n-  boolean isLogHomeEnabled() {\n-    return Optional.ofNullable(logHomeEnabled).orElse(!isDomainHomeInImage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81623b1d513bbbfa1f2ca588a8d757daf2e38202"}, "originalPosition": 140}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "923c3709b8cb29f88c114e749917bddaae827ff7", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/923c3709b8cb29f88c114e749917bddaae827ff7", "committedDate": "2020-03-20T19:34:41Z", "message": "Remove wdtEncryptionSecret from the schema and code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d859f89b9a45ef9ff086fae9497948acae75879", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8d859f89b9a45ef9ff086fae9497948acae75879", "committedDate": "2020-03-20T20:08:32Z", "message": "fix two broken links"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e50ab70fb2de1b488b7c28bf3dc6652fe392447", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8e50ab70fb2de1b488b7c28bf3dc6652fe392447", "committedDate": "2020-03-20T20:20:05Z", "message": "Merge pull request #1483 from oracle/rmarano\n\nuser guide edits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8bc12b12102add4c7bf908d569ea6958a169d2f", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a8bc12b12102add4c7bf908d569ea6958a169d2f", "committedDate": "2020-03-20T21:14:59Z", "message": "Clean up after WDT encryption secret related code is removed\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NjA2MjE1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-378606215", "createdAt": "2020-03-20T15:54:39Z", "commit": {"oid": "4a653acd9b75e15444ff7896b720d52427bd35ed"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNTo1NDozOVrOF5ZgjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNTo1NTo1MVrOF5Zjqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTczMTA4NQ==", "bodyText": "This is a required attribute", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395731085", "createdAt": "2020-03-20T15:54:39Z", "author": {"login": "jshum2479"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/usage.md", "diffHunk": "@@ -0,0 +1,176 @@\n++++\n+title = \"Usage\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 20\n+pre = \"<b> </b>\"\n+description = \"Steps for creating and deploying Model in Image images and their associated domain resourcess.\"\n++++\n+\n+\n+### Contents\n+\n+   - [(1) WebLogic operator.](#1-weblogic-operator)\n+   - [(2) WebLogic image.](#2-weblogic-image)\n+   - [(3) Optional WDT model config map.](#3-optional-wdt-model-config-map)\n+   - [(4) Optional WDT encryption secret.](#4-optional-wdt-encryption-secret)\n+   - [(5) Required runtime encryption secret.](#5-required-runtime-encryption-secret)\n+   - [(6) Secrets for model macros.](#6-secrets-for-model-macros)\n+   - [(7) Domain resource attributes.](#7-domain-resource-attributes)\n+   - [(8) Prerequisites for JRF domain types.](#8-prerequisites-for-jrf-domain-types)\n+\n+### Requirements\n+\n+Here's what's needed to create and deploy a typical Model in Image domain:\n+\n+#### (1) WebLogic operator.\n+\n+Deploy a WebLogic operator and ensure that it is monitoring the desired namespace for your Model in Image domain. See [Manage operators]({{< relref \"/userguide/managing-operators/_index.md\" >}}) and [Quick Start]({{< relref \"/quickstart/_index.md\" >}}).\n+\n+#### (2) WebLogic image.\n+\n+Model in Image requires creating a 'final' deployable image that has WebLogic Server and WDT installed, plus your model and application files. \n+\n+You can start with a WebLogic 12.2.1.3 or later pre-built base image obtained from [Docker Hub](https://github.com/oracle/docker-images/tree/master/OracleWebLogic) or similar, manually build your own base image as per [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}), or build a base image using the WebLogic Image Tool [WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool). Note that any 12.2.1.3 image must also include patch 29135930 (the pre-built images already contain this patch). For an example of the first approach for both WLS and JRF domains, see the [Model in Image Sample]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}).\n+\n+Once you have a base image, Model in Image requires layering the following directory structure for its (optional) WDT models artifacts and (required) WDT binaries:\n+\n+| Directory                | Contents                           | Extension   |\n+| ------------------------ | ---------------------------------- | ----------- |\n+| /u01/wdt/models          | optional domain model yaml files   | .yaml       |\n+| /u01/wdt/models          | optional model variable files      | .properties |\n+| /u01/wdt/models          | optional application archives      | .zip        |\n+| /u01/wdt/weblogic-deploy | unzipped weblogic deploy install   |             |\n+\n+There are two methods for layering a Model in Image artifacts on top of a base image:\n+\n+  - __Method 1: Manual Image Creation__: Use docker commands to layer the WDT artifacts from the above table on top of your base image into a new image.\n+\n+  - __Method 2: WebLogic Image Tool__: Use the convenient [WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool). The WebLogic Image Tool (WIT) has built-in options for embedding WDT model files, WDT binaries, WebLogic binaries install, and WebLogic patches in an image. The [Model in Image sample]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) takes the WIT approach, see the sample's `build_image_model.sh` in the operator source's `kubernetes/samples/scripts/create-weblogic-domain/model-in-image` directory for an example.\n+\n+See [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) for a discussion of model file syntax.\n+\n+#### (3) Optional WDT model config map.\n+\n+You can create a WDT model config map that defines additional model `.yaml` and `.properties` files beyond what you've already supplied in your image, and then reference this config map using your domain resource's `configuration.model.configMap` attribute. This is optional if the supplied image already fully defines your model. \n+\n+WDT model config map files will be merged with the WDT files defined in your image at runtime before your domain home is created. The config map files can add to, remove from, or alter the model configuration that you supplied within your image.\n+\n+For example, place additional `.yaml` and `.properties` files in a directory called `/home/acmeuser/wdtoverride` and run the following commands:\n+\n+  ```\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    create configmap MY-DOMAINUID-my-wdt-config-map \\\n+    --from-file /home/acmeuser/wdtoverride\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    label  configmap MY-DOMAINUID-my-wdt-config-map \\\n+    weblogic.domainUID=MY-DOMAINUID\n+  ```\n+\n+See [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) for a discussion of model file syntax and loading order, and see [Runtime updates]({{< relref \"/userguide/managing-domains/model-in-image/runtime-updates.md\" >}}) for a discussion of using WDT model config maps to update the model configuration of a running domain.\n+\n+\n+#### (4) Optional WDT encryption secret.\n+\n+> NOTE: Oracle strongly recommends storing sensitive information using Kubernetes secrets when practical instead of relying on this option. See [(6) Secrets for model macros.](#6-secrets-for-model-macros).\n+\n+The WDT encryption option is an alternative to using secrets for encrypting sensitive information stored in a model. The WDT encryption option requires:\n+ - Using WDT tooling to encrypt your model files prior to putting them in a Model in Image image or a Model in Image WDT config map.\n+ - Supplying a WDT encryption `password` via a Kubernetes secret so that Model in Image can decrypt the model at runtime. The secret can be named anything, but it must contain a key named `password`. Example WDT encryption secret creation:\n+   ```\n+   kubectl -n MY-DOMAIN-NAMESPACE \\\n+     create secret generic MY-DOMAINUID-wdt-encrypt-secret \\\n+     --from-literal=password=welcome1\n+   kubectl -n MY-DOMAIN-NAMESPACE \\\n+     label secret MY-DOMAINUID-wdt-encrypt-secret \\\n+     weblogic.domainUID=MY-DOMAINUID\n+   ```\n+ - Setting the domain resource `config.model.wdtEncryptionSecret` field to the name of the secret.\n+\n+For more information see the [WDT Deploy Tool Encrypt Documentation](https://github.com/oracle/weblogic-deploy-tooling/blob/master/site/encrypt.md).\n+\n+#### (5) Required runtime encryption secret.\n+\n+Model in Image requires a runtime encryption secret with a secure `password` key. This secret is used by the Operator to encrypt model and domain home artifacts before it adds them to a runtime config map or log. The `password` that you set can safely change any time after you've fully shutdown a domain but must remain the same for the life of a running domain. The runtime encryption secret that you create can be named anything but note that it is a best practice to name and label secrets with their domain UID to help ensure that cleanup scripts can find and delete them.\n+\n+> NOTE: Because the runtime encryption password does not need to be shared and only needs to exist for the life of a domain, you may want to use a password generator.\n+\n+Example:\n+\n+  ```\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    create secret generic MY-DOMAINUID-runtime-encrypt-secret \\\n+    --from-literal=password=welcome1\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    label secret MY-DOMAINUID-runtime-encrypt-secret \\\n+    weblogic.domainUID=MY-DOMAINUID\n+  ```\n+\n+Corresponding domain resource snippet:\n+\n+  ```\n+  configuration:\n+    model:\n+      runtimeEncryptionSecret: MY-DOMAINUID-runtime-encrypt-secret\n+  ```\n+\n+#### (6) Secrets for model macros.\n+\n+Create additional secrets as needed by macros in your model files. For example, these can store database URLs and credentials that are accessed via `@@FILE` macros in your model that reference the secrets.  See [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) for a discusion of model macros.\n+\n+#### (7) Domain resource attributes.\n+\n+The following domain resource attributes are specific to Model in Image domains.\n+\n+| Domain Resource Attribute                    |  Notes |\n+| -------------------------                    |  ------------------ |\n+| `domainHomeSourceType`                       |  Required. Set to `FromModel` |\n+| `domainHome`                                 |  Must reference an empty or non-existent directory within your image. Do not include the mount the path of any persistent volume. Note that Model in Image recreates the domain home for a WebLogic pod every time the pod restarts.|\n+| `configuration.model.wdtConfigMap`           | Optional. Set if you have stored additional models in a config map as per [(3) Optional WDT model config map.](#3-optional-wdt-model-config-map). |\n+| `configuration.model.secrets`                | Optional. Set this array if your image or config map models contain macros that reference custom Kubernetes secrets. For example, if your macros depend on secrets `my-secret` and `my-other-secret` then set to `[my-secret, my-other-secret]`.|\n+| `configuration.model.RuntimeEncryptionSecret`| Required. All Model in Image domain's must specify a runtime encryption secret. See [(5) Required runtime encryption secret.](#5-required-runtime-encryption-secret). |\n+| `configuration.model.wdtEncryptionSecret`    | Rarely used. Set if your using wdt model encryption as per [(4) Optional WDT encryption secret.](#4-optional-wdt-encryption-secret).|\n+| `configuration.model.domainType`             | Set the type of domain. Valid values are `WLS`, `JRF`, and `RestrictedJRF` where `WLS` is the default. See [WDT Domain Types](https://github.com/oracle/weblogic-deploy-tooling/blob/master/site/type_def.md).|\n+\n+Notes:\n+\n+ - There are additional attributes that are common to all domain home source types, such as the `image` field, etc. See the Domain Resource [Schema](https://github.com/oracle/weblogic-kubernetes-operator/blob/master/docs/domains/Domain.md) and [Doc]({{< relref \"/userguide/managing-domains/domain-resource.md\" >}}) for a full list of domain resource fields.\n+\n+ - There are also additional fields that are specific to JRF domain types. See [(8) Prerequisites for JRF domain types.](#8-prerequisites-for-jrf-domain-types) below for more information.\n+\n+ - __Sample domain resource__: For an example of a fully specified sample domain resource, see the the operator source's `kubernetes/samples/scripts/create-weblogic-domain/model-in-image/k8s-domain.yaml.template` file for the [Model in Image sample]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}). Note that the '@@' entries in this template are not processed by the Operator -- they need to replaced with actual values before the resource can be applied. \n+\n+#### (8) Prerequisites for JRF domain types.\n+\n+> __IMPORTANT__: This section only applies for a `JRF` domain type. Skip it if your domain type is simply a `WLS` or a `RestrictedJRF` domain.\n+\n+A JRF domain requires an infrastructure database called an RCU Database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain. When you first deploy your domain, the introspector job will initialize it's RCU schema tables in the database - a process that can take several minutes.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain as discussed in [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}). \n+\n+Assuming you have an RCU database that's running and initialized, here are the specific Model in Image requirements:\n+\n+- Set `configuration.model.domainType` to `JRF`.\n+\n+- Set `configuration.opss.walletPasswordSecret` to reference a secret that defines a `walletPassword` key. This is used to encrypt the domain's OPSS wallet file.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a653acd9b75e15444ff7896b720d52427bd35ed"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTczMTg4Mg==", "bodyText": "We should remove the rcu_admin_password attribute. It's not really required for now since we do not support create rcu schema on the fly using WDT.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395731882", "createdAt": "2020-03-20T15:55:51Z", "author": {"login": "jshum2479"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/usage.md", "diffHunk": "@@ -0,0 +1,176 @@\n++++\n+title = \"Usage\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 20\n+pre = \"<b> </b>\"\n+description = \"Steps for creating and deploying Model in Image images and their associated domain resourcess.\"\n++++\n+\n+\n+### Contents\n+\n+   - [(1) WebLogic operator.](#1-weblogic-operator)\n+   - [(2) WebLogic image.](#2-weblogic-image)\n+   - [(3) Optional WDT model config map.](#3-optional-wdt-model-config-map)\n+   - [(4) Optional WDT encryption secret.](#4-optional-wdt-encryption-secret)\n+   - [(5) Required runtime encryption secret.](#5-required-runtime-encryption-secret)\n+   - [(6) Secrets for model macros.](#6-secrets-for-model-macros)\n+   - [(7) Domain resource attributes.](#7-domain-resource-attributes)\n+   - [(8) Prerequisites for JRF domain types.](#8-prerequisites-for-jrf-domain-types)\n+\n+### Requirements\n+\n+Here's what's needed to create and deploy a typical Model in Image domain:\n+\n+#### (1) WebLogic operator.\n+\n+Deploy a WebLogic operator and ensure that it is monitoring the desired namespace for your Model in Image domain. See [Manage operators]({{< relref \"/userguide/managing-operators/_index.md\" >}}) and [Quick Start]({{< relref \"/quickstart/_index.md\" >}}).\n+\n+#### (2) WebLogic image.\n+\n+Model in Image requires creating a 'final' deployable image that has WebLogic Server and WDT installed, plus your model and application files. \n+\n+You can start with a WebLogic 12.2.1.3 or later pre-built base image obtained from [Docker Hub](https://github.com/oracle/docker-images/tree/master/OracleWebLogic) or similar, manually build your own base image as per [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}), or build a base image using the WebLogic Image Tool [WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool). Note that any 12.2.1.3 image must also include patch 29135930 (the pre-built images already contain this patch). For an example of the first approach for both WLS and JRF domains, see the [Model in Image Sample]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}).\n+\n+Once you have a base image, Model in Image requires layering the following directory structure for its (optional) WDT models artifacts and (required) WDT binaries:\n+\n+| Directory                | Contents                           | Extension   |\n+| ------------------------ | ---------------------------------- | ----------- |\n+| /u01/wdt/models          | optional domain model yaml files   | .yaml       |\n+| /u01/wdt/models          | optional model variable files      | .properties |\n+| /u01/wdt/models          | optional application archives      | .zip        |\n+| /u01/wdt/weblogic-deploy | unzipped weblogic deploy install   |             |\n+\n+There are two methods for layering a Model in Image artifacts on top of a base image:\n+\n+  - __Method 1: Manual Image Creation__: Use docker commands to layer the WDT artifacts from the above table on top of your base image into a new image.\n+\n+  - __Method 2: WebLogic Image Tool__: Use the convenient [WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool). The WebLogic Image Tool (WIT) has built-in options for embedding WDT model files, WDT binaries, WebLogic binaries install, and WebLogic patches in an image. The [Model in Image sample]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) takes the WIT approach, see the sample's `build_image_model.sh` in the operator source's `kubernetes/samples/scripts/create-weblogic-domain/model-in-image` directory for an example.\n+\n+See [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) for a discussion of model file syntax.\n+\n+#### (3) Optional WDT model config map.\n+\n+You can create a WDT model config map that defines additional model `.yaml` and `.properties` files beyond what you've already supplied in your image, and then reference this config map using your domain resource's `configuration.model.configMap` attribute. This is optional if the supplied image already fully defines your model. \n+\n+WDT model config map files will be merged with the WDT files defined in your image at runtime before your domain home is created. The config map files can add to, remove from, or alter the model configuration that you supplied within your image.\n+\n+For example, place additional `.yaml` and `.properties` files in a directory called `/home/acmeuser/wdtoverride` and run the following commands:\n+\n+  ```\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    create configmap MY-DOMAINUID-my-wdt-config-map \\\n+    --from-file /home/acmeuser/wdtoverride\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    label  configmap MY-DOMAINUID-my-wdt-config-map \\\n+    weblogic.domainUID=MY-DOMAINUID\n+  ```\n+\n+See [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) for a discussion of model file syntax and loading order, and see [Runtime updates]({{< relref \"/userguide/managing-domains/model-in-image/runtime-updates.md\" >}}) for a discussion of using WDT model config maps to update the model configuration of a running domain.\n+\n+\n+#### (4) Optional WDT encryption secret.\n+\n+> NOTE: Oracle strongly recommends storing sensitive information using Kubernetes secrets when practical instead of relying on this option. See [(6) Secrets for model macros.](#6-secrets-for-model-macros).\n+\n+The WDT encryption option is an alternative to using secrets for encrypting sensitive information stored in a model. The WDT encryption option requires:\n+ - Using WDT tooling to encrypt your model files prior to putting them in a Model in Image image or a Model in Image WDT config map.\n+ - Supplying a WDT encryption `password` via a Kubernetes secret so that Model in Image can decrypt the model at runtime. The secret can be named anything, but it must contain a key named `password`. Example WDT encryption secret creation:\n+   ```\n+   kubectl -n MY-DOMAIN-NAMESPACE \\\n+     create secret generic MY-DOMAINUID-wdt-encrypt-secret \\\n+     --from-literal=password=welcome1\n+   kubectl -n MY-DOMAIN-NAMESPACE \\\n+     label secret MY-DOMAINUID-wdt-encrypt-secret \\\n+     weblogic.domainUID=MY-DOMAINUID\n+   ```\n+ - Setting the domain resource `config.model.wdtEncryptionSecret` field to the name of the secret.\n+\n+For more information see the [WDT Deploy Tool Encrypt Documentation](https://github.com/oracle/weblogic-deploy-tooling/blob/master/site/encrypt.md).\n+\n+#### (5) Required runtime encryption secret.\n+\n+Model in Image requires a runtime encryption secret with a secure `password` key. This secret is used by the Operator to encrypt model and domain home artifacts before it adds them to a runtime config map or log. The `password` that you set can safely change any time after you've fully shutdown a domain but must remain the same for the life of a running domain. The runtime encryption secret that you create can be named anything but note that it is a best practice to name and label secrets with their domain UID to help ensure that cleanup scripts can find and delete them.\n+\n+> NOTE: Because the runtime encryption password does not need to be shared and only needs to exist for the life of a domain, you may want to use a password generator.\n+\n+Example:\n+\n+  ```\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    create secret generic MY-DOMAINUID-runtime-encrypt-secret \\\n+    --from-literal=password=welcome1\n+  kubectl -n MY-DOMAIN-NAMESPACE \\\n+    label secret MY-DOMAINUID-runtime-encrypt-secret \\\n+    weblogic.domainUID=MY-DOMAINUID\n+  ```\n+\n+Corresponding domain resource snippet:\n+\n+  ```\n+  configuration:\n+    model:\n+      runtimeEncryptionSecret: MY-DOMAINUID-runtime-encrypt-secret\n+  ```\n+\n+#### (6) Secrets for model macros.\n+\n+Create additional secrets as needed by macros in your model files. For example, these can store database URLs and credentials that are accessed via `@@FILE` macros in your model that reference the secrets.  See [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}) for a discusion of model macros.\n+\n+#### (7) Domain resource attributes.\n+\n+The following domain resource attributes are specific to Model in Image domains.\n+\n+| Domain Resource Attribute                    |  Notes |\n+| -------------------------                    |  ------------------ |\n+| `domainHomeSourceType`                       |  Required. Set to `FromModel` |\n+| `domainHome`                                 |  Must reference an empty or non-existent directory within your image. Do not include the mount the path of any persistent volume. Note that Model in Image recreates the domain home for a WebLogic pod every time the pod restarts.|\n+| `configuration.model.wdtConfigMap`           | Optional. Set if you have stored additional models in a config map as per [(3) Optional WDT model config map.](#3-optional-wdt-model-config-map). |\n+| `configuration.model.secrets`                | Optional. Set this array if your image or config map models contain macros that reference custom Kubernetes secrets. For example, if your macros depend on secrets `my-secret` and `my-other-secret` then set to `[my-secret, my-other-secret]`.|\n+| `configuration.model.RuntimeEncryptionSecret`| Required. All Model in Image domain's must specify a runtime encryption secret. See [(5) Required runtime encryption secret.](#5-required-runtime-encryption-secret). |\n+| `configuration.model.wdtEncryptionSecret`    | Rarely used. Set if your using wdt model encryption as per [(4) Optional WDT encryption secret.](#4-optional-wdt-encryption-secret).|\n+| `configuration.model.domainType`             | Set the type of domain. Valid values are `WLS`, `JRF`, and `RestrictedJRF` where `WLS` is the default. See [WDT Domain Types](https://github.com/oracle/weblogic-deploy-tooling/blob/master/site/type_def.md).|\n+\n+Notes:\n+\n+ - There are additional attributes that are common to all domain home source types, such as the `image` field, etc. See the Domain Resource [Schema](https://github.com/oracle/weblogic-kubernetes-operator/blob/master/docs/domains/Domain.md) and [Doc]({{< relref \"/userguide/managing-domains/domain-resource.md\" >}}) for a full list of domain resource fields.\n+\n+ - There are also additional fields that are specific to JRF domain types. See [(8) Prerequisites for JRF domain types.](#8-prerequisites-for-jrf-domain-types) below for more information.\n+\n+ - __Sample domain resource__: For an example of a fully specified sample domain resource, see the the operator source's `kubernetes/samples/scripts/create-weblogic-domain/model-in-image/k8s-domain.yaml.template` file for the [Model in Image sample]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}). Note that the '@@' entries in this template are not processed by the Operator -- they need to replaced with actual values before the resource can be applied. \n+\n+#### (8) Prerequisites for JRF domain types.\n+\n+> __IMPORTANT__: This section only applies for a `JRF` domain type. Skip it if your domain type is simply a `WLS` or a `RestrictedJRF` domain.\n+\n+A JRF domain requires an infrastructure database called an RCU Database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain. When you first deploy your domain, the introspector job will initialize it's RCU schema tables in the database - a process that can take several minutes.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain as discussed in [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}). \n+\n+Assuming you have an RCU database that's running and initialized, here are the specific Model in Image requirements:\n+\n+- Set `configuration.model.domainType` to `JRF`.\n+\n+- Set `configuration.opss.walletPasswordSecret` to reference a secret that defines a `walletPassword` key. This is used to encrypt the domain's OPSS wallet file.\n+\n+- Set `configuration.opss.walletFileSecret` to reference a secret that contains your domain's OPSS wallet file in its `walletFile` key. This assumes you have an OPSS wallet file from a previous start of the same domain. It enables a restarted or migrated domain to access its RCU database information. For more information, see [Reusing an RCU database between domain deployments](#reusing-an-rcu-database-between-domain-deployments).\n+\n+- Set `configuration.introspectorJobActiveDeadlineSeconds` introspection job timeout to at least 300. This is needed because domain home creation takes a considerable amount of time the first time a JRF domain is created (due to initializing the domain's RCU database tables), and because Model in Image creates your domain home for you using the introspection job. \n+\n+- Define an `RCUDbInfo` stanza in your model. Access to an RCU database requires defining a `RCUDbInfo` stanza in your model's `domainInfo` stanza with the necessary information for accessing the domain's schema within the database. Usually this information should be supplied via a secret that you deploy and reference in your domain resource's 'configuration.secrets' field. Here's an example `RCUDbInfo` stanza:\n+\n+  ```\n+  domainInfo:\n+      RCUDbInfo:\n+          rcu_prefix: '@@FILE:/weblogic-operator/config-overrides-secrets/sample-domain1-rcu-access/rcu_prefix@@'\n+          rcu_schema_password: '@@FILE:/weblogic-operator/config-overrides-secrets/sample-domain1-rcu-access/rcu_schema_password@@'\n+          rcu_admin_password: '@@FILE:/weblogic-operator/config-overrides-secrets/sample-domain1-rcu-access/rcu_admin_password@@'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a653acd9b75e15444ff7896b720d52427bd35ed"}, "originalPosition": 167}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "732cd7e018e3169ab65449ffbbcc49fb56d549cc", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/732cd7e018e3169ab65449ffbbcc49fb56d549cc", "committedDate": "2020-03-20T22:07:38Z", "message": "Fix doc\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b33c660bbf6c903063c94f308a0d5d695613964", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7b33c660bbf6c903063c94f308a0d5d695613964", "committedDate": "2020-03-20T22:17:28Z", "message": "Fix doc links\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f3fec42ac32ffcb4e124c7c035a6c036c8f0cec", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9f3fec42ac32ffcb4e124c7c035a6c036c8f0cec", "committedDate": "2020-03-20T22:50:18Z", "message": "remove wdt encryption passphrase logic from introspector job scripts since it no longer supported in the schema"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "033420a40ef6839eb917300a8a5649cecbe8d0ef", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/033420a40ef6839eb917300a8a5649cecbe8d0ef", "committedDate": "2020-03-20T22:50:47Z", "message": "update MII doc to mention wdt encryption isn't supported"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "faf27ab7657f36ca0b64d10f2a9f36b8ab8236d9", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/faf27ab7657f36ca0b64d10f2a9f36b8ab8236d9", "committedDate": "2020-03-20T22:51:01Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d1cb525a3b0f433b396bc85e7375c2a9216ad84", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1d1cb525a3b0f433b396bc85e7375c2a9216ad84", "committedDate": "2020-03-20T23:15:20Z", "message": "update error message in modelInImage.sh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7a1c52c69582021aa843a9dd5fd64090be18f46", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f7a1c52c69582021aa843a9dd5fd64090be18f46", "committedDate": "2020-03-21T00:49:03Z", "message": "Enable updateRCUSchemaPassword and add special env variables for macro expansion in modelInImage.sh script"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3OTU3Mjc0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-377957274", "createdAt": "2020-03-19T17:48:42Z", "commit": {"oid": "c489a66d68e1a760da358ae37797be87bb66b451"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNzo0ODo0MlrOF45zlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMjowODowMlrOF5m9mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIxMTY2OA==", "bodyText": "What are the values ?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395211668", "createdAt": "2020-03-19T17:48:42Z", "author": {"login": "mriccell"}, "path": "docs-source/content/samples/simple/domains/domain-home-in-image/_index.md", "diffHunk": "@@ -194,9 +194,9 @@ spec:\n   # The WebLogic Domain Home\n   domainHome: /u01/oracle/user_projects/domains/domain1\n   # If the domain home is in the image\n-  domainHomeInImage: true\n+  domainHomeSourceType: Image", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c489a66d68e1a760da358ae37797be87bb66b451"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIxMzQwMg==", "bodyText": "What are the different types?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395213402", "createdAt": "2020-03-19T17:51:42Z", "author": {"login": "mriccell"}, "path": "docs-source/content/userguide/managing-domains/_index.md", "diffHunk": "@@ -33,9 +34,9 @@ Please be aware of the following important considerations for WebLogic domains r\n   in the ***Security*** section.\n   {{% /notice %}}\n \n-* _Log File Locations:_ The operator can automatically override WebLogic domain and server log locations using situational\n+* _Log File Locations:_ The operator can automatically override WebLogic domain and server log locations using\n   configuration overrides.  This occurs if the domain resource `logHomeEnabled` field is explicitly set to `true`, or if `logHomeEnabled` isn't set\n-  and `domainHomeInImage` is explicitly set to `false`.   When overriding, the log location will be the location specified by the `logHome` setting.\n+  and `domainHomeSourceType` is set to `PersistentVolume`.  When overriding, the log location will be the location specified by the `logHome` setting.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c489a66d68e1a760da358ae37797be87bb66b451"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk0OTQ2OA==", "bodyText": "Today only SOA and OSB are supported please fo not mention FA which is not supported nor will it never be supported with our Operator.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395949468", "createdAt": "2020-03-21T01:43:02Z", "author": {"login": "mriccell"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA, OSB, and FA. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81623b1d513bbbfa1f2ca588a8d757daf2e38202"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk0OTU1Ng==", "bodyText": "JDK8 -> JDK 8", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395949556", "createdAt": "2020-03-21T01:44:00Z", "author": {"login": "mriccell"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA, OSB, and FA. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81623b1d513bbbfa1f2ca588a8d757daf2e38202"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk0OTk1Mw==", "bodyText": "When you use WIT create instead of Update the resulting image is of smaller size.  I would make a note that explains this.  Option 2 should point to https://oracle.github.io/weblogic-kubernetes-operator/userguide/managing-domains/domain-in-image/base-images/#creating-a-custom-image-with-patches-applied", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395949953", "createdAt": "2020-03-21T01:48:35Z", "author": {"login": "mriccell"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA, OSB, and FA. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81623b1d513bbbfa1f2ca588a8d757daf2e38202"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MDQ1NA==", "bodyText": "Can we add a link to go straight to the ### Use the WebLogic Image Tool to create an image when not creating a JRF domain", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395950454", "createdAt": "2020-03-21T01:54:55Z", "author": {"login": "mriccell"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA, OSB, and FA. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__\n+\n+     Set up access to this sample's base WebLogic image at the [Oracle Container Registry](http://container-registry.oracle.com):\n+\n+     a. Use a browser to access [Oracle Container Registry](http://container-registry.oracle.com).\n+\n+     b. Choose an image location:\n+       - For `JRF` and `RestrictedJRF` domains, select `Middleware`, then `fmw-infrastructure`.\n+       - For `WLS` domains, select `Middleware`, then `weblogic`.\n+\n+     c. Select Sign In and accept the license agreement.\n+\n+     d. Use your terminal to locally log in to Docker: `docker login container-registry.oracle.com`.\n+\n+     e. Later, when you run the sample, it will call `docker pull` for your base image based on the domain type.\n+       - For `JRF` and `RestrictedJRF`, it will pull `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4`.\n+       - For `WLS`, it will pull `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n+\n+   - __Option 2, create your own WebLogic base image.__\n+\n+     Alternatively, you can create your own base image and override the sample's default base image name and tag by exporting the `BASE_IMAGE_NAME` and `BASE_IMAGE_TAG` environment variables prior to running the sample scripts. If you want to create your own base image, see [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}).\n+\n+8. If you are using a `JRF` domain type, then it requires an RCU infrastructure database. See [Prerequisites for JRF Domains](#prerequisites-for-jrf-domains). You can do this step before or after you create your final image. If you're not using a `JRF` domain type, proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image).\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81623b1d513bbbfa1f2ca588a8d757daf2e38202"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MDU1Mw==", "bodyText": "A base image is an image with the WebLogic binaries?  Can we clarify", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395950553", "createdAt": "2020-03-21T01:56:16Z", "author": {"login": "mriccell"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA, OSB, and FA. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__\n+\n+     Set up access to this sample's base WebLogic image at the [Oracle Container Registry](http://container-registry.oracle.com):\n+\n+     a. Use a browser to access [Oracle Container Registry](http://container-registry.oracle.com).\n+\n+     b. Choose an image location:\n+       - For `JRF` and `RestrictedJRF` domains, select `Middleware`, then `fmw-infrastructure`.\n+       - For `WLS` domains, select `Middleware`, then `weblogic`.\n+\n+     c. Select Sign In and accept the license agreement.\n+\n+     d. Use your terminal to locally log in to Docker: `docker login container-registry.oracle.com`.\n+\n+     e. Later, when you run the sample, it will call `docker pull` for your base image based on the domain type.\n+       - For `JRF` and `RestrictedJRF`, it will pull `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4`.\n+       - For `WLS`, it will pull `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n+\n+   - __Option 2, create your own WebLogic base image.__\n+\n+     Alternatively, you can create your own base image and override the sample's default base image name and tag by exporting the `BASE_IMAGE_NAME` and `BASE_IMAGE_TAG` environment variables prior to running the sample scripts. If you want to create your own base image, see [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}).\n+\n+8. If you are using a `JRF` domain type, then it requires an RCU infrastructure database. See [Prerequisites for JRF Domains](#prerequisites-for-jrf-domains). You can do this step before or after you create your final image. If you're not using a `JRF` domain type, proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image).\n+\n+### Prerequisites for JRF domains\n+\n+> __NOTE__: This section is only required for demonstrating a `JRF` domain type. Skip this section and proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if your domain type is `WLS` or `RestrictedJRF`.\n+\n+A JRF domain requires an infrastructure database called an RCU database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain.\n+\n+The following steps demonstrate how to set up an infrastructure database that will work with this sample:\n+\n+  1. [Set up and initialize an RCU database](#set-up-and-initialize-an-rcu-database).\n+  2. [Increase introspection job timeout](#increase-introspection-job-timeout).\n+  3. [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets).\n+  4. [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables).\n+\n+\n+\n+##### Set up and initialize an RCU database\n+\n+A JRF domain requires an infrastructure database and also requires initializing this database with a schema and a set of tables. The following example shows how to set up a sample RCU database and use the RCU tool to create the infrastructure schema for a JRF domain. The RCU database is set up with the following attributes:\n+\n+| Attribute | Value |\n+| --------- | ----- |\n+| database Kubernetes namespace | `default` |\n+| database Kubernetes pod | `oracle-db` |\n+| database image | `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` |\n+| database password | `Oradoc_db1` |\n+| infrastructure schema prefix | `FMW1` |\n+| infrastructure schema password | `Oradoc_db1` |\n+| database URL | `oracle-db.default.svc.cluster.local:1521/devpdb.k8s` |\n+\n+\n+1. Ensure you have access to the database image, and then deploy it:\n+\n+   - Use a browser to log in to `https://container-registry.oracle.com`, select `database->enterprise` and accept the license agreement.\n+\n+   - Get the database image:\n+     - In the local shell, `docker login container-registry.oracle.com`.\n+     - In the local shell, `docker pull container-registry.oracle.com/database/enterprise:12.2.0.1-slim`.\n+\n+\n+       {{% notice note %}} If a local Docker login and manual pull of `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` is not sufficient (for example, if you are using a remote Kubernetes cluster), then uncomment the `imagePullSecrets` stanza in `$WORKDIR/k8s-db-slim.yaml` and create the image pull secret as follows:\n+\n+              ```\n+              kubectl create secret docker-registry regsecret \\\n+                --docker-server=container-registry.oracle.com \\\n+                --docker-username=your.email@some.com \\\n+                --docker-password=your-password \\\n+                --docker-email=your.email@some.com\n+              ```\n+       {{% /notice %}}\n+\n+\n+   - Use the sample script in `$SRCDIR/kubernetes/samples/scripts/create-oracle-db-service` to create an Oracle database running in the pod, `oracle-db`.\n+\n+      **NOTE**: If your database image access requires the `regsecret` image pull secret that you optionally created above, then pass `-s regsecret` to the `start-db-service.sh` command line.\n+\n+     ```\n+     cd $SRCDIR/kubernetes/samples/scripts/create-oracle-db-service\n+     start-db-service.sh\n+     ```\n+\n+     This script will deploy a database with the URL, `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`, and administration password, `Oradoc_db1`.\n+\n+     {{% notice warning %}} The Oracle database Docker images are supported only for non-production use. For more details, see My Oracle Support note: Oracle Support for Database Running on Docker (Doc ID 2216342.1) : All the data is gone when the database is restarted.\n+     {{% /notice %}}\n+\n+     **NOTE**: This step is based on the steps documented in [Run a Database](https://oracle.github.io/weblogic-kubernetes-operator/userguide/overview/database/).\n+\n+2. Use the sample script in `SRCDIR/kubernetes/samples/scripts/create-rcu-schema` to create the RCU schema with the schema prefix `FMW1`.\n+\n+   Note that this script assumes `Oradoc_db1` is the DBA password, `Oradoc_db1` is the schema password, and that the database URL is `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`.\n+\n+   ```\n+   cd $SRCDIR/kubernetes/samples/scripts/create-rcu-schema\n+   ./create-rcu-schema.sh -s FMW1 -i container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4\n+   ```\n+\n+   __NOTE__:  If you need to drop the repository, use this command:\n+\n+   ```\n+   drop-rcu-schema.sh -s FMW1\n+   ```\n+\n+\n+##### Increase introspection job timeout\n+\n+Because JRF domain home creation takes a considerable amount of time the first time it is created, and because Model in Image creates your domain home for you using the introspection job, you should increase the timeout for the introspection job. Use the `configuration.introspectorJobActiveDeadlineSeconds` in `k8s-domain.yaml.template` to override the default with a value of at least 300 seconds (the default is 120 seconds).  \n+\n+##### Set up RCU model attributes, domain resource attributes, and secrets\n+\n+To allow Model in Image to access the RCU database and OPSS wallet, it's necessary to set up an RCU access secret and an OPSS secret before deploying your domain. It's also necessary to define an `RCUDbInfo` stanza in your model. The sample already sets up all of these for you.  See:\n+\n+| Sample file | Description |\n+| --------- | ----- |\n+| `run_domain.sh` | Defines secret, `sample-domain1-opss-wallet-password-secret`, with `password=welcome1`. |\n+| `run_domain.sh` | Defines secret, `sample-domain1-rcu-access`, with appropriate values for attributes `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string`. |\n+| `model1.yaml.jrf` | Populates the `domainInfo -> RCUDbInfo` stanza `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string` attributes by referencing their locations in the `sample-domain1-rcu-access` secret. The `build.sh` script uses this model instead of `model.yaml.wls` when the source domain type is `JRF`. |\n+| `k8s-domain.yaml.template` | Ensures that the domain mounts the OPSS key secret by setting the domain resource `configuration.opss.walletPasswordSecret` attribute to `sample-domain1-opss-wallet-password-secret`, and ensures the domain mounts the RCU access secret, `sample-domain1-rcu-access`, for reference by WDT model macros by setting the domain resource `configuration.secrets` attribute. Use configuration.introspectorJobActiveDeadlineSeconds to increase the timeout value of the introspector job; see [Increase introspection job timeout](#increase-introspection-job-timeout). |\n+\n+ **NOTE**: This step is for information purposes only. Do not run the above sample files directly. The sample's main build and run scripts will run them for you.\n+\n+##### Reusing or sharing RCU tables\n+\n+Note that when you succesfully deploy your JRF domain resource for the first time, the introspector job will initialize the RCU tables for the domain using the `domainInfo -> RCUDbInfo` stanza in the WDT model plus the `configuration.opss.walletPasswordSecret` specified in the domain resource. The job will also create a new domain home. Finally, the operator will also capture an OPSS wallet file from the new domain's local directory and place this file in a new Kubernetes config map.\n+\n+There are scenarios when the domain needs to be re-created between updates such as WebLogic credentials are changed, security roles defined in the WDT model have been changed or you want to share the same RCU tables with different domains.  Under these scenarios, the operator needs the `walletPasswordSecret` as well as the OPSS wallet file, together with the exact information in `domainInfo -> RCUDbInfo` so that the domain can be re-created and access the same set of RCU tables.  Without the wallet file and wallet password, you will not be able to re-create a domain accessing the same set of RCU tables, therefore it is highly recommended to backup the wallet file.\n+\n+To recover a domain's RCU tables between domain restarts or to share an RCU schema between different domains, it is necessary to extract this wallet file from the config map and save the OPSS wallet password secret that was used for the original domain. The wallet password and wallet file are needed again when you recreate the domain or share the database with other domains.\n+\n+To save the wallet file:\n+\n+```\n+    opss_wallet_util.sh -s [-wf <name of the wallet file. Default ./ewallet.p12>]\n+```\n+\n+You should back up this file to a safe location that can be retrieved later.\n+\n+To reuse the wallet for subsequent redeployments or share the RCU tables between different domains:\n+\n+1. Store the wallet in a secret:\n+\n+```\n+    opss_wallet_util.sh -r [-wf <name of the wallet file. Default ./ewallet.p12>] [-ws <name of the secret. Default DOMAIN_UID-opss-walletfile-secret> ]\n+\n+```\n+\n+2. Modify the domain resource YAML file to provide the secret names:\n+\n+```\n+  configuration:\n+    opss:\n+      # Name of secret with walletPassword for extracting the wallet\n+      walletPasswordSecret: sample-domain1-opss-wallet-password-secret      \n+      # Name of secret with walletFile containing base64 encoded opss wallet\n+      walletFileSecret: sample-domain1-opss-walletfile-secret\n+\n+```\n+\n+See [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}) for instructions.\n+\n+### Use the WebLogic Image Tool to create an image\n+\n+Model in Image must contain a WebLogic install, a WebLogic Deploy Tool install, and your WDT model files. You can use the sample `./build.sh` script to build this image, which will perform the following steps for you:\n+\n+  - Uses `docker pull` to obtain a base image. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types) to set up access to the base image.)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81623b1d513bbbfa1f2ca588a8d757daf2e38202"}, "originalPosition": 261}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MTI0MQ==", "bodyText": "These instructions are to push the image to a registry in OCI why?  Other samples in domain-home-in-image call the image \"domain-home-in-image:12.2.1.3\" we should call our image a generic name \"domain-model-in-image:12.2.1.4\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395951241", "createdAt": "2020-03-21T02:04:38Z", "author": {"login": "mriccell"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA, OSB, and FA. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__\n+\n+     Set up access to this sample's base WebLogic image at the [Oracle Container Registry](http://container-registry.oracle.com):\n+\n+     a. Use a browser to access [Oracle Container Registry](http://container-registry.oracle.com).\n+\n+     b. Choose an image location:\n+       - For `JRF` and `RestrictedJRF` domains, select `Middleware`, then `fmw-infrastructure`.\n+       - For `WLS` domains, select `Middleware`, then `weblogic`.\n+\n+     c. Select Sign In and accept the license agreement.\n+\n+     d. Use your terminal to locally log in to Docker: `docker login container-registry.oracle.com`.\n+\n+     e. Later, when you run the sample, it will call `docker pull` for your base image based on the domain type.\n+       - For `JRF` and `RestrictedJRF`, it will pull `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4`.\n+       - For `WLS`, it will pull `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n+\n+   - __Option 2, create your own WebLogic base image.__\n+\n+     Alternatively, you can create your own base image and override the sample's default base image name and tag by exporting the `BASE_IMAGE_NAME` and `BASE_IMAGE_TAG` environment variables prior to running the sample scripts. If you want to create your own base image, see [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}).\n+\n+8. If you are using a `JRF` domain type, then it requires an RCU infrastructure database. See [Prerequisites for JRF Domains](#prerequisites-for-jrf-domains). You can do this step before or after you create your final image. If you're not using a `JRF` domain type, proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image).\n+\n+### Prerequisites for JRF domains\n+\n+> __NOTE__: This section is only required for demonstrating a `JRF` domain type. Skip this section and proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if your domain type is `WLS` or `RestrictedJRF`.\n+\n+A JRF domain requires an infrastructure database called an RCU database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain.\n+\n+The following steps demonstrate how to set up an infrastructure database that will work with this sample:\n+\n+  1. [Set up and initialize an RCU database](#set-up-and-initialize-an-rcu-database).\n+  2. [Increase introspection job timeout](#increase-introspection-job-timeout).\n+  3. [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets).\n+  4. [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables).\n+\n+\n+\n+##### Set up and initialize an RCU database\n+\n+A JRF domain requires an infrastructure database and also requires initializing this database with a schema and a set of tables. The following example shows how to set up a sample RCU database and use the RCU tool to create the infrastructure schema for a JRF domain. The RCU database is set up with the following attributes:\n+\n+| Attribute | Value |\n+| --------- | ----- |\n+| database Kubernetes namespace | `default` |\n+| database Kubernetes pod | `oracle-db` |\n+| database image | `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` |\n+| database password | `Oradoc_db1` |\n+| infrastructure schema prefix | `FMW1` |\n+| infrastructure schema password | `Oradoc_db1` |\n+| database URL | `oracle-db.default.svc.cluster.local:1521/devpdb.k8s` |\n+\n+\n+1. Ensure you have access to the database image, and then deploy it:\n+\n+   - Use a browser to log in to `https://container-registry.oracle.com`, select `database->enterprise` and accept the license agreement.\n+\n+   - Get the database image:\n+     - In the local shell, `docker login container-registry.oracle.com`.\n+     - In the local shell, `docker pull container-registry.oracle.com/database/enterprise:12.2.0.1-slim`.\n+\n+\n+       {{% notice note %}} If a local Docker login and manual pull of `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` is not sufficient (for example, if you are using a remote Kubernetes cluster), then uncomment the `imagePullSecrets` stanza in `$WORKDIR/k8s-db-slim.yaml` and create the image pull secret as follows:\n+\n+              ```\n+              kubectl create secret docker-registry regsecret \\\n+                --docker-server=container-registry.oracle.com \\\n+                --docker-username=your.email@some.com \\\n+                --docker-password=your-password \\\n+                --docker-email=your.email@some.com\n+              ```\n+       {{% /notice %}}\n+\n+\n+   - Use the sample script in `$SRCDIR/kubernetes/samples/scripts/create-oracle-db-service` to create an Oracle database running in the pod, `oracle-db`.\n+\n+      **NOTE**: If your database image access requires the `regsecret` image pull secret that you optionally created above, then pass `-s regsecret` to the `start-db-service.sh` command line.\n+\n+     ```\n+     cd $SRCDIR/kubernetes/samples/scripts/create-oracle-db-service\n+     start-db-service.sh\n+     ```\n+\n+     This script will deploy a database with the URL, `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`, and administration password, `Oradoc_db1`.\n+\n+     {{% notice warning %}} The Oracle database Docker images are supported only for non-production use. For more details, see My Oracle Support note: Oracle Support for Database Running on Docker (Doc ID 2216342.1) : All the data is gone when the database is restarted.\n+     {{% /notice %}}\n+\n+     **NOTE**: This step is based on the steps documented in [Run a Database](https://oracle.github.io/weblogic-kubernetes-operator/userguide/overview/database/).\n+\n+2. Use the sample script in `SRCDIR/kubernetes/samples/scripts/create-rcu-schema` to create the RCU schema with the schema prefix `FMW1`.\n+\n+   Note that this script assumes `Oradoc_db1` is the DBA password, `Oradoc_db1` is the schema password, and that the database URL is `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`.\n+\n+   ```\n+   cd $SRCDIR/kubernetes/samples/scripts/create-rcu-schema\n+   ./create-rcu-schema.sh -s FMW1 -i container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4\n+   ```\n+\n+   __NOTE__:  If you need to drop the repository, use this command:\n+\n+   ```\n+   drop-rcu-schema.sh -s FMW1\n+   ```\n+\n+\n+##### Increase introspection job timeout\n+\n+Because JRF domain home creation takes a considerable amount of time the first time it is created, and because Model in Image creates your domain home for you using the introspection job, you should increase the timeout for the introspection job. Use the `configuration.introspectorJobActiveDeadlineSeconds` in `k8s-domain.yaml.template` to override the default with a value of at least 300 seconds (the default is 120 seconds).  \n+\n+##### Set up RCU model attributes, domain resource attributes, and secrets\n+\n+To allow Model in Image to access the RCU database and OPSS wallet, it's necessary to set up an RCU access secret and an OPSS secret before deploying your domain. It's also necessary to define an `RCUDbInfo` stanza in your model. The sample already sets up all of these for you.  See:\n+\n+| Sample file | Description |\n+| --------- | ----- |\n+| `run_domain.sh` | Defines secret, `sample-domain1-opss-wallet-password-secret`, with `password=welcome1`. |\n+| `run_domain.sh` | Defines secret, `sample-domain1-rcu-access`, with appropriate values for attributes `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string`. |\n+| `model1.yaml.jrf` | Populates the `domainInfo -> RCUDbInfo` stanza `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string` attributes by referencing their locations in the `sample-domain1-rcu-access` secret. The `build.sh` script uses this model instead of `model.yaml.wls` when the source domain type is `JRF`. |\n+| `k8s-domain.yaml.template` | Ensures that the domain mounts the OPSS key secret by setting the domain resource `configuration.opss.walletPasswordSecret` attribute to `sample-domain1-opss-wallet-password-secret`, and ensures the domain mounts the RCU access secret, `sample-domain1-rcu-access`, for reference by WDT model macros by setting the domain resource `configuration.secrets` attribute. Use configuration.introspectorJobActiveDeadlineSeconds to increase the timeout value of the introspector job; see [Increase introspection job timeout](#increase-introspection-job-timeout). |\n+\n+ **NOTE**: This step is for information purposes only. Do not run the above sample files directly. The sample's main build and run scripts will run them for you.\n+\n+##### Reusing or sharing RCU tables\n+\n+Note that when you succesfully deploy your JRF domain resource for the first time, the introspector job will initialize the RCU tables for the domain using the `domainInfo -> RCUDbInfo` stanza in the WDT model plus the `configuration.opss.walletPasswordSecret` specified in the domain resource. The job will also create a new domain home. Finally, the operator will also capture an OPSS wallet file from the new domain's local directory and place this file in a new Kubernetes config map.\n+\n+There are scenarios when the domain needs to be re-created between updates such as WebLogic credentials are changed, security roles defined in the WDT model have been changed or you want to share the same RCU tables with different domains.  Under these scenarios, the operator needs the `walletPasswordSecret` as well as the OPSS wallet file, together with the exact information in `domainInfo -> RCUDbInfo` so that the domain can be re-created and access the same set of RCU tables.  Without the wallet file and wallet password, you will not be able to re-create a domain accessing the same set of RCU tables, therefore it is highly recommended to backup the wallet file.\n+\n+To recover a domain's RCU tables between domain restarts or to share an RCU schema between different domains, it is necessary to extract this wallet file from the config map and save the OPSS wallet password secret that was used for the original domain. The wallet password and wallet file are needed again when you recreate the domain or share the database with other domains.\n+\n+To save the wallet file:\n+\n+```\n+    opss_wallet_util.sh -s [-wf <name of the wallet file. Default ./ewallet.p12>]\n+```\n+\n+You should back up this file to a safe location that can be retrieved later.\n+\n+To reuse the wallet for subsequent redeployments or share the RCU tables between different domains:\n+\n+1. Store the wallet in a secret:\n+\n+```\n+    opss_wallet_util.sh -r [-wf <name of the wallet file. Default ./ewallet.p12>] [-ws <name of the secret. Default DOMAIN_UID-opss-walletfile-secret> ]\n+\n+```\n+\n+2. Modify the domain resource YAML file to provide the secret names:\n+\n+```\n+  configuration:\n+    opss:\n+      # Name of secret with walletPassword for extracting the wallet\n+      walletPasswordSecret: sample-domain1-opss-wallet-password-secret      \n+      # Name of secret with walletFile containing base64 encoded opss wallet\n+      walletFileSecret: sample-domain1-opss-walletfile-secret\n+\n+```\n+\n+See [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}) for instructions.\n+\n+### Use the WebLogic Image Tool to create an image\n+\n+Model in Image must contain a WebLogic install, a WebLogic Deploy Tool install, and your WDT model files. You can use the sample `./build.sh` script to build this image, which will perform the following steps for you:\n+\n+  - Uses `docker pull` to obtain a base image. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types) to set up access to the base image.)\n+  - Downloads the latest WebLogic Image Tool and WebLogic Deploy Tool to `WORKDIR`.\n+  - Creates and populates a staging directory `$WORKDIR/models` that contains your WDT model files and WDT application archive.\n+    - Builds  a simple servlet application in `$SAMPLEDIR/sample_app` into a WDT model application archive `$WORKDIR/models/archive1.zip`.\n+    - Copies sample model files from `$SAMPLEDIR/model-in-image` to `$WORKDIR/models`. This uses a model file that is appropriate to the domain type (for example, the `JRF` domain model includes database access configuration).\n+  - Uses the WebLogic Image Tool and the `$WORKDIR/models` staging directory to create a final image named `model-in-image:v1` that layers on the base image. Specifically, it runs the WebLogic Image Tool with its `update` option, which:\n+    - Builds the final image as a layer on the base image.\n+    - Puts a WDT install in image location, `/u01/wdt/weblogic-deploy`.\n+    - Copies the WDT model, properties, and application archive from `$WORDKIR/models` to image location, `/u01/wdt/models`.\n+\n+The script expects `JAVA_HOME`, `WDT_DOMAIN_TYPE`, and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/build.sh\n+  ```\n+\n+If you intend to use a remote Docker registry, you need to tag and push the image to the remote Docker registry.\n+\n+1.  Tag the image for the remote Docker registry, for example:\n+\n+```\n+docker tag <image-name>:<tag> <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81623b1d513bbbfa1f2ca588a8d757daf2e38202"}, "originalPosition": 284}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MTMyMg==", "bodyText": "The sample should not be based on OKE it should be based on a generic Kubernetes cluster similar to our other samples", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395951322", "createdAt": "2020-03-21T02:05:36Z", "author": {"login": "mriccell"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA, OSB, and FA. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__\n+\n+     Set up access to this sample's base WebLogic image at the [Oracle Container Registry](http://container-registry.oracle.com):\n+\n+     a. Use a browser to access [Oracle Container Registry](http://container-registry.oracle.com).\n+\n+     b. Choose an image location:\n+       - For `JRF` and `RestrictedJRF` domains, select `Middleware`, then `fmw-infrastructure`.\n+       - For `WLS` domains, select `Middleware`, then `weblogic`.\n+\n+     c. Select Sign In and accept the license agreement.\n+\n+     d. Use your terminal to locally log in to Docker: `docker login container-registry.oracle.com`.\n+\n+     e. Later, when you run the sample, it will call `docker pull` for your base image based on the domain type.\n+       - For `JRF` and `RestrictedJRF`, it will pull `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4`.\n+       - For `WLS`, it will pull `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n+\n+   - __Option 2, create your own WebLogic base image.__\n+\n+     Alternatively, you can create your own base image and override the sample's default base image name and tag by exporting the `BASE_IMAGE_NAME` and `BASE_IMAGE_TAG` environment variables prior to running the sample scripts. If you want to create your own base image, see [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}).\n+\n+8. If you are using a `JRF` domain type, then it requires an RCU infrastructure database. See [Prerequisites for JRF Domains](#prerequisites-for-jrf-domains). You can do this step before or after you create your final image. If you're not using a `JRF` domain type, proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image).\n+\n+### Prerequisites for JRF domains\n+\n+> __NOTE__: This section is only required for demonstrating a `JRF` domain type. Skip this section and proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if your domain type is `WLS` or `RestrictedJRF`.\n+\n+A JRF domain requires an infrastructure database called an RCU database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain.\n+\n+The following steps demonstrate how to set up an infrastructure database that will work with this sample:\n+\n+  1. [Set up and initialize an RCU database](#set-up-and-initialize-an-rcu-database).\n+  2. [Increase introspection job timeout](#increase-introspection-job-timeout).\n+  3. [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets).\n+  4. [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables).\n+\n+\n+\n+##### Set up and initialize an RCU database\n+\n+A JRF domain requires an infrastructure database and also requires initializing this database with a schema and a set of tables. The following example shows how to set up a sample RCU database and use the RCU tool to create the infrastructure schema for a JRF domain. The RCU database is set up with the following attributes:\n+\n+| Attribute | Value |\n+| --------- | ----- |\n+| database Kubernetes namespace | `default` |\n+| database Kubernetes pod | `oracle-db` |\n+| database image | `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` |\n+| database password | `Oradoc_db1` |\n+| infrastructure schema prefix | `FMW1` |\n+| infrastructure schema password | `Oradoc_db1` |\n+| database URL | `oracle-db.default.svc.cluster.local:1521/devpdb.k8s` |\n+\n+\n+1. Ensure you have access to the database image, and then deploy it:\n+\n+   - Use a browser to log in to `https://container-registry.oracle.com`, select `database->enterprise` and accept the license agreement.\n+\n+   - Get the database image:\n+     - In the local shell, `docker login container-registry.oracle.com`.\n+     - In the local shell, `docker pull container-registry.oracle.com/database/enterprise:12.2.0.1-slim`.\n+\n+\n+       {{% notice note %}} If a local Docker login and manual pull of `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` is not sufficient (for example, if you are using a remote Kubernetes cluster), then uncomment the `imagePullSecrets` stanza in `$WORKDIR/k8s-db-slim.yaml` and create the image pull secret as follows:\n+\n+              ```\n+              kubectl create secret docker-registry regsecret \\\n+                --docker-server=container-registry.oracle.com \\\n+                --docker-username=your.email@some.com \\\n+                --docker-password=your-password \\\n+                --docker-email=your.email@some.com\n+              ```\n+       {{% /notice %}}\n+\n+\n+   - Use the sample script in `$SRCDIR/kubernetes/samples/scripts/create-oracle-db-service` to create an Oracle database running in the pod, `oracle-db`.\n+\n+      **NOTE**: If your database image access requires the `regsecret` image pull secret that you optionally created above, then pass `-s regsecret` to the `start-db-service.sh` command line.\n+\n+     ```\n+     cd $SRCDIR/kubernetes/samples/scripts/create-oracle-db-service\n+     start-db-service.sh\n+     ```\n+\n+     This script will deploy a database with the URL, `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`, and administration password, `Oradoc_db1`.\n+\n+     {{% notice warning %}} The Oracle database Docker images are supported only for non-production use. For more details, see My Oracle Support note: Oracle Support for Database Running on Docker (Doc ID 2216342.1) : All the data is gone when the database is restarted.\n+     {{% /notice %}}\n+\n+     **NOTE**: This step is based on the steps documented in [Run a Database](https://oracle.github.io/weblogic-kubernetes-operator/userguide/overview/database/).\n+\n+2. Use the sample script in `SRCDIR/kubernetes/samples/scripts/create-rcu-schema` to create the RCU schema with the schema prefix `FMW1`.\n+\n+   Note that this script assumes `Oradoc_db1` is the DBA password, `Oradoc_db1` is the schema password, and that the database URL is `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`.\n+\n+   ```\n+   cd $SRCDIR/kubernetes/samples/scripts/create-rcu-schema\n+   ./create-rcu-schema.sh -s FMW1 -i container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4\n+   ```\n+\n+   __NOTE__:  If you need to drop the repository, use this command:\n+\n+   ```\n+   drop-rcu-schema.sh -s FMW1\n+   ```\n+\n+\n+##### Increase introspection job timeout\n+\n+Because JRF domain home creation takes a considerable amount of time the first time it is created, and because Model in Image creates your domain home for you using the introspection job, you should increase the timeout for the introspection job. Use the `configuration.introspectorJobActiveDeadlineSeconds` in `k8s-domain.yaml.template` to override the default with a value of at least 300 seconds (the default is 120 seconds).  \n+\n+##### Set up RCU model attributes, domain resource attributes, and secrets\n+\n+To allow Model in Image to access the RCU database and OPSS wallet, it's necessary to set up an RCU access secret and an OPSS secret before deploying your domain. It's also necessary to define an `RCUDbInfo` stanza in your model. The sample already sets up all of these for you.  See:\n+\n+| Sample file | Description |\n+| --------- | ----- |\n+| `run_domain.sh` | Defines secret, `sample-domain1-opss-wallet-password-secret`, with `password=welcome1`. |\n+| `run_domain.sh` | Defines secret, `sample-domain1-rcu-access`, with appropriate values for attributes `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string`. |\n+| `model1.yaml.jrf` | Populates the `domainInfo -> RCUDbInfo` stanza `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string` attributes by referencing their locations in the `sample-domain1-rcu-access` secret. The `build.sh` script uses this model instead of `model.yaml.wls` when the source domain type is `JRF`. |\n+| `k8s-domain.yaml.template` | Ensures that the domain mounts the OPSS key secret by setting the domain resource `configuration.opss.walletPasswordSecret` attribute to `sample-domain1-opss-wallet-password-secret`, and ensures the domain mounts the RCU access secret, `sample-domain1-rcu-access`, for reference by WDT model macros by setting the domain resource `configuration.secrets` attribute. Use configuration.introspectorJobActiveDeadlineSeconds to increase the timeout value of the introspector job; see [Increase introspection job timeout](#increase-introspection-job-timeout). |\n+\n+ **NOTE**: This step is for information purposes only. Do not run the above sample files directly. The sample's main build and run scripts will run them for you.\n+\n+##### Reusing or sharing RCU tables\n+\n+Note that when you succesfully deploy your JRF domain resource for the first time, the introspector job will initialize the RCU tables for the domain using the `domainInfo -> RCUDbInfo` stanza in the WDT model plus the `configuration.opss.walletPasswordSecret` specified in the domain resource. The job will also create a new domain home. Finally, the operator will also capture an OPSS wallet file from the new domain's local directory and place this file in a new Kubernetes config map.\n+\n+There are scenarios when the domain needs to be re-created between updates such as WebLogic credentials are changed, security roles defined in the WDT model have been changed or you want to share the same RCU tables with different domains.  Under these scenarios, the operator needs the `walletPasswordSecret` as well as the OPSS wallet file, together with the exact information in `domainInfo -> RCUDbInfo` so that the domain can be re-created and access the same set of RCU tables.  Without the wallet file and wallet password, you will not be able to re-create a domain accessing the same set of RCU tables, therefore it is highly recommended to backup the wallet file.\n+\n+To recover a domain's RCU tables between domain restarts or to share an RCU schema between different domains, it is necessary to extract this wallet file from the config map and save the OPSS wallet password secret that was used for the original domain. The wallet password and wallet file are needed again when you recreate the domain or share the database with other domains.\n+\n+To save the wallet file:\n+\n+```\n+    opss_wallet_util.sh -s [-wf <name of the wallet file. Default ./ewallet.p12>]\n+```\n+\n+You should back up this file to a safe location that can be retrieved later.\n+\n+To reuse the wallet for subsequent redeployments or share the RCU tables between different domains:\n+\n+1. Store the wallet in a secret:\n+\n+```\n+    opss_wallet_util.sh -r [-wf <name of the wallet file. Default ./ewallet.p12>] [-ws <name of the secret. Default DOMAIN_UID-opss-walletfile-secret> ]\n+\n+```\n+\n+2. Modify the domain resource YAML file to provide the secret names:\n+\n+```\n+  configuration:\n+    opss:\n+      # Name of secret with walletPassword for extracting the wallet\n+      walletPasswordSecret: sample-domain1-opss-wallet-password-secret      \n+      # Name of secret with walletFile containing base64 encoded opss wallet\n+      walletFileSecret: sample-domain1-opss-walletfile-secret\n+\n+```\n+\n+See [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}) for instructions.\n+\n+### Use the WebLogic Image Tool to create an image\n+\n+Model in Image must contain a WebLogic install, a WebLogic Deploy Tool install, and your WDT model files. You can use the sample `./build.sh` script to build this image, which will perform the following steps for you:\n+\n+  - Uses `docker pull` to obtain a base image. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types) to set up access to the base image.)\n+  - Downloads the latest WebLogic Image Tool and WebLogic Deploy Tool to `WORKDIR`.\n+  - Creates and populates a staging directory `$WORKDIR/models` that contains your WDT model files and WDT application archive.\n+    - Builds  a simple servlet application in `$SAMPLEDIR/sample_app` into a WDT model application archive `$WORKDIR/models/archive1.zip`.\n+    - Copies sample model files from `$SAMPLEDIR/model-in-image` to `$WORKDIR/models`. This uses a model file that is appropriate to the domain type (for example, the `JRF` domain model includes database access configuration).\n+  - Uses the WebLogic Image Tool and the `$WORKDIR/models` staging directory to create a final image named `model-in-image:v1` that layers on the base image. Specifically, it runs the WebLogic Image Tool with its `update` option, which:\n+    - Builds the final image as a layer on the base image.\n+    - Puts a WDT install in image location, `/u01/wdt/weblogic-deploy`.\n+    - Copies the WDT model, properties, and application archive from `$WORDKIR/models` to image location, `/u01/wdt/models`.\n+\n+The script expects `JAVA_HOME`, `WDT_DOMAIN_TYPE`, and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/build.sh\n+  ```\n+\n+If you intend to use a remote Docker registry, you need to tag and push the image to the remote Docker registry.\n+\n+1.  Tag the image for the remote Docker registry, for example:\n+\n+```\n+docker tag <image-name>:<tag> <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>\n+```\n+\n+2.  Push the image to the remote Docker registry, for example:\n+\n+```\n+docker push <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>\n+```\n+\n+3. Create the pull secret for the remote Docker registry:\n+\n+```\n+ kubectl -n <domain namespace> create secret docker-registry <secret name> \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81623b1d513bbbfa1f2ca588a8d757daf2e38202"}, "originalPosition": 296}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MTUxNQ==", "bodyText": "The sample should not be based on OKE it should be based on a generic Kubernetes cluster similar to our other samples", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395951515", "createdAt": "2020-03-21T02:08:02Z", "author": {"login": "mriccell"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA, OSB, and FA. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__\n+\n+     Set up access to this sample's base WebLogic image at the [Oracle Container Registry](http://container-registry.oracle.com):\n+\n+     a. Use a browser to access [Oracle Container Registry](http://container-registry.oracle.com).\n+\n+     b. Choose an image location:\n+       - For `JRF` and `RestrictedJRF` domains, select `Middleware`, then `fmw-infrastructure`.\n+       - For `WLS` domains, select `Middleware`, then `weblogic`.\n+\n+     c. Select Sign In and accept the license agreement.\n+\n+     d. Use your terminal to locally log in to Docker: `docker login container-registry.oracle.com`.\n+\n+     e. Later, when you run the sample, it will call `docker pull` for your base image based on the domain type.\n+       - For `JRF` and `RestrictedJRF`, it will pull `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4`.\n+       - For `WLS`, it will pull `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n+\n+   - __Option 2, create your own WebLogic base image.__\n+\n+     Alternatively, you can create your own base image and override the sample's default base image name and tag by exporting the `BASE_IMAGE_NAME` and `BASE_IMAGE_TAG` environment variables prior to running the sample scripts. If you want to create your own base image, see [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}).\n+\n+8. If you are using a `JRF` domain type, then it requires an RCU infrastructure database. See [Prerequisites for JRF Domains](#prerequisites-for-jrf-domains). You can do this step before or after you create your final image. If you're not using a `JRF` domain type, proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image).\n+\n+### Prerequisites for JRF domains\n+\n+> __NOTE__: This section is only required for demonstrating a `JRF` domain type. Skip this section and proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if your domain type is `WLS` or `RestrictedJRF`.\n+\n+A JRF domain requires an infrastructure database called an RCU database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain.\n+\n+The following steps demonstrate how to set up an infrastructure database that will work with this sample:\n+\n+  1. [Set up and initialize an RCU database](#set-up-and-initialize-an-rcu-database).\n+  2. [Increase introspection job timeout](#increase-introspection-job-timeout).\n+  3. [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets).\n+  4. [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables).\n+\n+\n+\n+##### Set up and initialize an RCU database\n+\n+A JRF domain requires an infrastructure database and also requires initializing this database with a schema and a set of tables. The following example shows how to set up a sample RCU database and use the RCU tool to create the infrastructure schema for a JRF domain. The RCU database is set up with the following attributes:\n+\n+| Attribute | Value |\n+| --------- | ----- |\n+| database Kubernetes namespace | `default` |\n+| database Kubernetes pod | `oracle-db` |\n+| database image | `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` |\n+| database password | `Oradoc_db1` |\n+| infrastructure schema prefix | `FMW1` |\n+| infrastructure schema password | `Oradoc_db1` |\n+| database URL | `oracle-db.default.svc.cluster.local:1521/devpdb.k8s` |\n+\n+\n+1. Ensure you have access to the database image, and then deploy it:\n+\n+   - Use a browser to log in to `https://container-registry.oracle.com`, select `database->enterprise` and accept the license agreement.\n+\n+   - Get the database image:\n+     - In the local shell, `docker login container-registry.oracle.com`.\n+     - In the local shell, `docker pull container-registry.oracle.com/database/enterprise:12.2.0.1-slim`.\n+\n+\n+       {{% notice note %}} If a local Docker login and manual pull of `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` is not sufficient (for example, if you are using a remote Kubernetes cluster), then uncomment the `imagePullSecrets` stanza in `$WORKDIR/k8s-db-slim.yaml` and create the image pull secret as follows:\n+\n+              ```\n+              kubectl create secret docker-registry regsecret \\\n+                --docker-server=container-registry.oracle.com \\\n+                --docker-username=your.email@some.com \\\n+                --docker-password=your-password \\\n+                --docker-email=your.email@some.com\n+              ```\n+       {{% /notice %}}\n+\n+\n+   - Use the sample script in `$SRCDIR/kubernetes/samples/scripts/create-oracle-db-service` to create an Oracle database running in the pod, `oracle-db`.\n+\n+      **NOTE**: If your database image access requires the `regsecret` image pull secret that you optionally created above, then pass `-s regsecret` to the `start-db-service.sh` command line.\n+\n+     ```\n+     cd $SRCDIR/kubernetes/samples/scripts/create-oracle-db-service\n+     start-db-service.sh\n+     ```\n+\n+     This script will deploy a database with the URL, `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`, and administration password, `Oradoc_db1`.\n+\n+     {{% notice warning %}} The Oracle database Docker images are supported only for non-production use. For more details, see My Oracle Support note: Oracle Support for Database Running on Docker (Doc ID 2216342.1) : All the data is gone when the database is restarted.\n+     {{% /notice %}}\n+\n+     **NOTE**: This step is based on the steps documented in [Run a Database](https://oracle.github.io/weblogic-kubernetes-operator/userguide/overview/database/).\n+\n+2. Use the sample script in `SRCDIR/kubernetes/samples/scripts/create-rcu-schema` to create the RCU schema with the schema prefix `FMW1`.\n+\n+   Note that this script assumes `Oradoc_db1` is the DBA password, `Oradoc_db1` is the schema password, and that the database URL is `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`.\n+\n+   ```\n+   cd $SRCDIR/kubernetes/samples/scripts/create-rcu-schema\n+   ./create-rcu-schema.sh -s FMW1 -i container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4\n+   ```\n+\n+   __NOTE__:  If you need to drop the repository, use this command:\n+\n+   ```\n+   drop-rcu-schema.sh -s FMW1\n+   ```\n+\n+\n+##### Increase introspection job timeout\n+\n+Because JRF domain home creation takes a considerable amount of time the first time it is created, and because Model in Image creates your domain home for you using the introspection job, you should increase the timeout for the introspection job. Use the `configuration.introspectorJobActiveDeadlineSeconds` in `k8s-domain.yaml.template` to override the default with a value of at least 300 seconds (the default is 120 seconds).  \n+\n+##### Set up RCU model attributes, domain resource attributes, and secrets\n+\n+To allow Model in Image to access the RCU database and OPSS wallet, it's necessary to set up an RCU access secret and an OPSS secret before deploying your domain. It's also necessary to define an `RCUDbInfo` stanza in your model. The sample already sets up all of these for you.  See:\n+\n+| Sample file | Description |\n+| --------- | ----- |\n+| `run_domain.sh` | Defines secret, `sample-domain1-opss-wallet-password-secret`, with `password=welcome1`. |\n+| `run_domain.sh` | Defines secret, `sample-domain1-rcu-access`, with appropriate values for attributes `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string`. |\n+| `model1.yaml.jrf` | Populates the `domainInfo -> RCUDbInfo` stanza `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string` attributes by referencing their locations in the `sample-domain1-rcu-access` secret. The `build.sh` script uses this model instead of `model.yaml.wls` when the source domain type is `JRF`. |\n+| `k8s-domain.yaml.template` | Ensures that the domain mounts the OPSS key secret by setting the domain resource `configuration.opss.walletPasswordSecret` attribute to `sample-domain1-opss-wallet-password-secret`, and ensures the domain mounts the RCU access secret, `sample-domain1-rcu-access`, for reference by WDT model macros by setting the domain resource `configuration.secrets` attribute. Use configuration.introspectorJobActiveDeadlineSeconds to increase the timeout value of the introspector job; see [Increase introspection job timeout](#increase-introspection-job-timeout). |\n+\n+ **NOTE**: This step is for information purposes only. Do not run the above sample files directly. The sample's main build and run scripts will run them for you.\n+\n+##### Reusing or sharing RCU tables\n+\n+Note that when you succesfully deploy your JRF domain resource for the first time, the introspector job will initialize the RCU tables for the domain using the `domainInfo -> RCUDbInfo` stanza in the WDT model plus the `configuration.opss.walletPasswordSecret` specified in the domain resource. The job will also create a new domain home. Finally, the operator will also capture an OPSS wallet file from the new domain's local directory and place this file in a new Kubernetes config map.\n+\n+There are scenarios when the domain needs to be re-created between updates such as WebLogic credentials are changed, security roles defined in the WDT model have been changed or you want to share the same RCU tables with different domains.  Under these scenarios, the operator needs the `walletPasswordSecret` as well as the OPSS wallet file, together with the exact information in `domainInfo -> RCUDbInfo` so that the domain can be re-created and access the same set of RCU tables.  Without the wallet file and wallet password, you will not be able to re-create a domain accessing the same set of RCU tables, therefore it is highly recommended to backup the wallet file.\n+\n+To recover a domain's RCU tables between domain restarts or to share an RCU schema between different domains, it is necessary to extract this wallet file from the config map and save the OPSS wallet password secret that was used for the original domain. The wallet password and wallet file are needed again when you recreate the domain or share the database with other domains.\n+\n+To save the wallet file:\n+\n+```\n+    opss_wallet_util.sh -s [-wf <name of the wallet file. Default ./ewallet.p12>]\n+```\n+\n+You should back up this file to a safe location that can be retrieved later.\n+\n+To reuse the wallet for subsequent redeployments or share the RCU tables between different domains:\n+\n+1. Store the wallet in a secret:\n+\n+```\n+    opss_wallet_util.sh -r [-wf <name of the wallet file. Default ./ewallet.p12>] [-ws <name of the secret. Default DOMAIN_UID-opss-walletfile-secret> ]\n+\n+```\n+\n+2. Modify the domain resource YAML file to provide the secret names:\n+\n+```\n+  configuration:\n+    opss:\n+      # Name of secret with walletPassword for extracting the wallet\n+      walletPasswordSecret: sample-domain1-opss-wallet-password-secret      \n+      # Name of secret with walletFile containing base64 encoded opss wallet\n+      walletFileSecret: sample-domain1-opss-walletfile-secret\n+\n+```\n+\n+See [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}) for instructions.\n+\n+### Use the WebLogic Image Tool to create an image\n+\n+Model in Image must contain a WebLogic install, a WebLogic Deploy Tool install, and your WDT model files. You can use the sample `./build.sh` script to build this image, which will perform the following steps for you:\n+\n+  - Uses `docker pull` to obtain a base image. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types) to set up access to the base image.)\n+  - Downloads the latest WebLogic Image Tool and WebLogic Deploy Tool to `WORKDIR`.\n+  - Creates and populates a staging directory `$WORKDIR/models` that contains your WDT model files and WDT application archive.\n+    - Builds  a simple servlet application in `$SAMPLEDIR/sample_app` into a WDT model application archive `$WORKDIR/models/archive1.zip`.\n+    - Copies sample model files from `$SAMPLEDIR/model-in-image` to `$WORKDIR/models`. This uses a model file that is appropriate to the domain type (for example, the `JRF` domain model includes database access configuration).\n+  - Uses the WebLogic Image Tool and the `$WORKDIR/models` staging directory to create a final image named `model-in-image:v1` that layers on the base image. Specifically, it runs the WebLogic Image Tool with its `update` option, which:\n+    - Builds the final image as a layer on the base image.\n+    - Puts a WDT install in image location, `/u01/wdt/weblogic-deploy`.\n+    - Copies the WDT model, properties, and application archive from `$WORDKIR/models` to image location, `/u01/wdt/models`.\n+\n+The script expects `JAVA_HOME`, `WDT_DOMAIN_TYPE`, and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/build.sh\n+  ```\n+\n+If you intend to use a remote Docker registry, you need to tag and push the image to the remote Docker registry.\n+\n+1.  Tag the image for the remote Docker registry, for example:\n+\n+```\n+docker tag <image-name>:<tag> <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>\n+```\n+\n+2.  Push the image to the remote Docker registry, for example:\n+\n+```\n+docker push <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>\n+```\n+\n+3. Create the pull secret for the remote Docker registry:\n+\n+```\n+ kubectl -n <domain namespace> create secret docker-registry <secret name> \\\n+     --docker-server=<region-key>.ocir.io/<tenancy-namespace>/<repo-name> \\\n+     --docker-username=your.email@some.com \\\n+     --docker-password=your-password \\\n+     --docker-email=your.email@some.com\n+\n+```\n+\n+4. Update the domain template file `$SAMPLEDIR/k8s-domain.yaml.template` to provide the `imagePullSecrets`:\n+\n+```\n+  imagePullSecrets:\n+  - name: <secret name>\n+\n+```\n+\n+5. Export the environment variables for the image name and tag using the same values in step 1:\n+\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81623b1d513bbbfa1f2ca588a8d757daf2e38202"}, "originalPosition": 314}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4ODgzNjMy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-378883632", "createdAt": "2020-03-21T02:13:03Z", "commit": {"oid": "f7a1c52c69582021aa843a9dd5fd64090be18f46"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMjoxMzowM1rOF5m_Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwMjoxMzo0M1rOF5m_UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MTg5OQ==", "bodyText": "Instructions should be based on pulling the image from the oracle container registry and not the Docker Store", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395951899", "createdAt": "2020-03-21T02:13:03Z", "author": {"login": "mriccell"}, "path": "docs-source/content/samples/simple/domains/fmw-domain/_index.md", "diffHunk": "@@ -115,7 +115,7 @@ The following parameters can be provided in the inputs file.\n | `domainUID` | Unique ID that will be used to identify this particular domain. Used as the name of the generated WebLogic domain as well as the name of the Kubernetes domain resource. This ID must be unique across all domains in a Kubernetes cluster. This ID cannot contain any character that is not valid in a Kubernetes service name. | `domain1` |\n | `exposeAdminNodePort` | Boolean indicating if the Administration Server is exposed outside of the Kubernetes cluster. | `false` |\n | `exposeAdminT3Channel` | Boolean indicating if the T3 administrative channel is exposed outside the Kubernetes cluster. | `false` |\n-| `image` | WebLogic Docker image. The operator requires FMW Infrastructure 12.2.1.3.0 with patch 29135930 applied. Refer to [FMW Infrastructure domains]({{< relref \"/userguide/managing-fmw-domains/fmw-infra/_index.md#obtaining-the-fmw-infrastructure-docker-image\" >}}) for details on how to obtain or create the image. | `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.3` |\n+| `image` | WebLogic Docker image. The operator requires FMW Infrastructure 12.2.1.3.0 with patch 29135930 applied or FMW Infrastructure 12.2.1.4.0. Refer to [FMW Infrastructure domains]({{< relref \"/userguide/managing-fmw-domains/fmw-infra/_index.md#obtaining-the-fmw-infrastructure-docker-image\" >}}) for details on how to obtain or create the image. | `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.3` |\n | `imagePullPolicy` | WebLogic Docker image pull policy. Legal values are `IfNotPresent`, `Always`, or `Never` | `IfNotPresent` |\n | `imagePullSecretName` | Name of the Kubernetes secret to access the Docker Store to pull the WebLogic Server Docker image. The presence of the secret will be validated when this parameter is specified. |  |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7a1c52c69582021aa843a9dd5fd64090be18f46"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk1MTk1Mg==", "bodyText": "Change 12.2.1.3 to 12.2.1.4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395951952", "createdAt": "2020-03-21T02:13:43Z", "author": {"login": "mriccell"}, "path": "docs-source/content/samples/simple/domains/fmw-domain/_index.md", "diffHunk": "@@ -20,7 +20,7 @@ Before you begin, read this document, [Domain resource]({{< relref \"/userguide/m\n The following prerequisites must be handled prior to running the create domain script:\n \n * Make sure the WebLogic Kubernetes Operator is running.\n-* The operator requires FMW Infrastructure 12.2.1.3.0 with patch 29135930 applied. For details on how to obtain or create the image, refer to [FMW Infrastructure domains]({{< relref \"/userguide/managing-domains/fmw-infra/_index.md#obtaining-the-fmw-infrastructure-docker-image\" >}}).\n+* The operator requires FMW Infrastructure 12.2.1.3.0 with patch 29135930 applied or FMW Infrastructure 12.2.1.4.0. For details on how to obtain or create the image, refer to [FMW Infrastructure domains]({{< relref \"/userguide/managing-domains/fmw-infra/_index.md#obtaining-the-fmw-infrastructure-docker-image\" >}}).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7a1c52c69582021aa843a9dd5fd64090be18f46"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f767a29ea18e90d32a4567d95a4544ab90a85b5", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7f767a29ea18e90d32a4567d95a4544ab90a85b5", "committedDate": "2020-03-22T02:50:45Z", "message": "Add @@SECRET and @@ENV support to MII sample/doc."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e61ac20f625272af1a6d44dbd593b1ba2ac932e9", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e61ac20f625272af1a6d44dbd593b1ba2ac932e9", "committedDate": "2020-03-22T23:44:52Z", "message": "Add utility methods for model in image tests (#1481)\n\n* adding mii utility methods\r\n\r\n* adding mii utility methods\r\n\r\n* adding wdtDomainType and use of properties for weblogic base image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MTI2MTU2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379126156", "createdAt": "2020-03-23T04:27:07Z", "commit": {"oid": "f7a1c52c69582021aa843a9dd5fd64090be18f46"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwNDoyNzowN1rOF52l3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QwNDoyNzowN1rOF52l3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIwNzU4Mw==", "bodyText": "This is a strange way of using WDT discover, why would you need to discover a domain running in the pod?  Most users will version control their models and domain.yamls.  To make updates to a running domain you can use a WDT sparse model as the following sample shows.\nIf the intent of this sample is to compare old and new models or recover a lost model then that is what the description should say.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396207583", "createdAt": "2020-03-23T04:27:07Z", "author": {"login": "mriccell"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/runtime-updates.md", "diffHunk": "@@ -0,0 +1,325 @@\n++++\n+title = \"Runtime updates\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 50\n+pre = \"<b> </b>\"\n+description = \"Updating a running Model in Image domain's images and model files.\"\n++++\n+\n+#### Contents\n+\n+ - [Overview](#overview)\n+ - [Important notes](#important-notes)\n+ - [Frequently asked questions](#frequently-asked-questions)\n+ - [Supported and unsupported updates](#supported-and-unsupported-updates)\n+ - [Changing a domain resource 'restartVersion'](#changing-a-domain-resource-restartversion)\n+ - [Using the WDT Discover Domain Tool](#using-the-wdt-discover-domain-tool)\n+ - [Example of adding a data source](#example-of-adding-a-data-source)\n+\n+#### Overview\n+\n+If you want to make a WebLogic domain home configuration change to a running Model in Image domain, and you want the change to survive WebLogic pod restarts, then you can modify your existing model by one or more the following approaches:\n+\n+  - Changing secrets or environment variables that are referenced by macros in your model files.\n+\n+  - Specifying a new or updated WDT config map that contains model files and use your domain resource `configuration.model.configMap` field to reference the map.\n+\n+  - Supplying a new image with new and/or changed model files.\n+\n+After changes are in place, you can tell the operator to load the changes and propagate them to a running domain by altering the domain resource's `image` or `restartVersion` attribute.\n+\n+#### Important notes\n+\n+ - Check for [Supported and unsupported updates](#supported-and-unsupported-updates).\n+\n+ - If you specify multiple model files in your image or WDT config map, the order in which they're loaded and merged is determined as described in [Model file naming and loading order]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md#model-file-naming-and-loading-order\" >}}).\n+\n+ - You can use the WDT Discover Domain Tool to help generate your model file updates. See [Using the WDT Discover Domain Tool](#using-the-wdt-discover-tool).\n+\n+ - For simple ways to change `restartVersion`, see [Changing a domain resource 'restartVersion'](#changing-a-domain-resource-restartversion).\n+\n+ - For a sample of adding a data source to a running domain, see [Example of adding a data source](#example-of-adding-a-data-source).\n+\n+ - For a discussion of model file syntax, see the [WebLogic Deploy Tool](https://github.com/oracle/weblogic-deploy-tooling) documentation and [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+ - If the introspector job reports a failure, see [Debugging]({{< relref \"/userguide/managing-domains/model-in-image/debugging.md\" >}}) for debugging advice.\n+\n+#### Frequently asked questions\n+\n+_Why is it necessary to specify updates using model files?_\n+\n+Similar to Domain in Image, if you make a direct runtime WebLogic configuration update of a Model in Image domain using the WebLogic console or WLST scripts, then the update is ephemeral. This is because the domain home is stored in an image directory which will not survive the restart of the owning pod.\n+\n+_How do Model in Image updates work during runtime?_\n+\n+After you make a change to your domain resource `restartVersion` or `image` attribute, the operator will rerun the domain's introspector job. This job will reload all of your secrets and environment variables, merge all of your model files, and generate a new domain home. If the job succeeds, then the operator will make the updated domain home available to pods using a config map named `DOMAIN_UID-weblogic-domain-introspect-cm`. Finally, the operator will subsequently roll (restart) each running WebLogic Server pod in the domain so that it can load the new configuration. A domain roll begins by restarting the domain's Administration Server and then proceeds to restart each Manager Server in the domain.\n+\n+_Can we use custom configuration overrides to do the updates instead?_\n+\n+No. Custom configuration overrides, which are WebLogic configuration overrides specified using a domain resource `configuration.overridesConfigMap`, as described in [Configuration overrides]({{< relref \"/userguide/managing-domains/configoverrides/_index.md\" >}}), aren't supported in combination with Model in Image. Model in Image will generate an error if custom overrides are specified. This should not be a concern because model file, secret, and/or model image updates are simpler and more flexible than custom configuration override updates. Unlike configuration overrides, the syntax for a model file update exactly matches the syntax for specifying your model file in the first place.\n+\n+\n+#### Supported and unsupported updates\n+\n+ - You can add new MBeans or resources simply by specifying their corresponding model file YAML snippet along with their parent bean hierarchy. See [Example of adding a data source](#example-of-adding-a-datasource).\n+\n+ - You can recreate, change, or add secrets that your model depends on. For example, you can change a database password secret.\n+\n+ - You can change or add environment variables that your model macros may depend on (macros that use the `@@ENV:myenvvar@@` syntax).\n+\n+ - You can remove a named MBean or resource by specifying a model file with a `!` symbol just before the bean or resource name. For example, if you have a data source named `mynewdatasource` defined in your model, it can be removed by specifying a small model file that loads after the model file that defines the data source, where the small model file looks like this:\n+\n+  ```\n+  resources:\n+    JDBCSystemResource:\n+      !mynewdatasource:\n+  ```\n+\n+  For more information, see [Declaring Named MBeans to Delete](https://github.com/oracle/weblogic-deploy-tooling#declaring-named-mbeans-to-delete) in the WebLogic Deploying Tooling documentation.\n+\n+ - You can add or alter an MBean attribute by specifying a YAML snippet along with its parent bean hierarchy that references an existing MBean and the attribute. For example, to add or alter the max capacity of a data source named `mynewdatasource`:\n+\n+  ```\n+  resources:\n+    JDBCSystemResource:\n+      mynewdatasource:\n+        JdbcResource:\n+          JDBCConnectionPoolParams:\n+            MaxCapacity: 5\n+  ```\n+\n+  For more information, see [Using Multiple Models](https://github.com/oracle/weblogic-deploy-tooling#using-multiple-models) in the WebLogic Deploy Tooling documentation.\n+\n+ - There is no way to directly delete an attribute from an MBean that's already been specified by a model file. The work-around is to do this using two model files: (a) add a model file that deletes the named bean/resource that is a parent to the attribute you want to delete, and (b) add another  subsequent model file that fully defines the named bean/resource but without the attribute you want to delete.\n+\n+ - The following runtime updates haven't been tested and are _not_ supported in the first release of Model in Image. If you need to make these kinds of updates, consider shutting down your domain entirely before making the change:\n+   - Adding, removing, or altering the network configuration of an existing Managed Server. This includes, but isn't limited to network channels, ports, and cluster addresses.\n+   - Adding a Managed Server to an existing configured cluster.\n+   - Altering the `cluster-size` or `max-cluster-size` of an existing dynamic cluster.\n+   - TBD This needs some research. Check with QA, etc.\n+\n+#### Changing a domain resource 'restartVersion'\n+\n+As was mentioned in the [overview](#overview), one way to tell the operator to apply your configuration changes to a running domain is by altering the domain resource `restartVersion`. Here are some common ways to do this:\n+\n+ - You can alter `restartVersion` interactively using `kubectl edit -n MY_NAMESPACE domain MY_DOMAINUID`.\n+\n+ - If you have your domain's resource file, then you can alter this file and call `kubectl apply -f` on the file.\n+\n+ - You can use the Kubernetes `get` and `patch` commands. Here's a sample automation script:\n+\n+   ```\n+   #!/bin/bash\n+   NAMESPACE=${1:-sample-domain1-ns}\n+   DOMAINUID=${2:-sample-domain1}\n+   currentRV=$(kubectl -n ${NAMESPACE} get domain ${DOMAINUID} -o=jsonpath='{.spec.restartVersion}')\n+   if [ $? = 0 ]; then\n+     # we enter here only if the previous command succeeded\n+\n+     nextRV=$((currentRV + 1))\n+\n+     echo \"@@ Info: Rolling domain '${DOMAINUID}' in namespace '${NAMESPACE}' from restartVersion='${currentRV}' to restartVersion='${nextRV}'.\"\n+\n+     kubectl -n ${NAMESPACE} patch domain ${DOMAINUID} --type='json' \\\n+       -p='[{\"op\": \"replace\", \"path\": \"/spec/restartVersion\", \"value\": \"'${nextRV}'\" }]'\n+   fi\n+   ```\n+\n+#### Using the WDT Discover Domain Tool", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7a1c52c69582021aa843a9dd5fd64090be18f46"}, "originalPosition": 128}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "486fe1fd4d891b187606d5fb3b5bc10a735091fc", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/486fe1fd4d891b187606d5fb3b5bc10a735091fc", "committedDate": "2020-03-23T12:14:07Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e90fa01b816193532fbe25d54d75378892afa22", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9e90fa01b816193532fbe25d54d75378892afa22", "committedDate": "2020-03-23T13:30:58Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2394548fa2ecd3ba6fb497f5f838a7296df1df5", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c2394548fa2ecd3ba6fb497f5f838a7296df1df5", "committedDate": "2020-03-23T16:16:37Z", "message": "minor doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3abf4b6ce7ae5a15cbdee9926c6644032c75f1af", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3abf4b6ce7ae5a15cbdee9926c6644032c75f1af", "committedDate": "2020-03-23T16:52:43Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f15c10d5bf9e631d8abcd9f1689d8d70476bae4", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9f15c10d5bf9e631d8abcd9f1689d8d70476bae4", "committedDate": "2020-03-23T16:58:10Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c37dd7d18852b339cdff65934d21ae883540b925", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c37dd7d18852b339cdff65934d21ae883540b925", "committedDate": "2020-03-23T17:05:10Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24abe59d2fab3b421b07fe3bd38181514ec2b12c", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/24abe59d2fab3b421b07fe3bd38181514ec2b12c", "committedDate": "2020-03-23T17:31:42Z", "message": "doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3f46823be21e32c4b54a101d5590aeb40dbcdb15", "committedDate": "2020-03-23T17:41:55Z", "message": "doc update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzA5NjM3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379709637", "createdAt": "2020-03-23T18:30:17Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozMDoxN1rOF6SxTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozMDoxN1rOF6SxTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY2OTI2MA==", "bodyText": "\"WebLogic domain that's defined using a WDT model file\"... this is confusing because it specifically doesn't include a WebLogic domain.  Let's say instead, \"and the model for a WebLogic domain configuration defined using a WDT model file.\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396669260", "createdAt": "2020-03-23T18:30:17Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzExMjgx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379711281", "createdAt": "2020-03-23T18:32:29Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozMjoyOVrOF6S2QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozMjoyOVrOF6S2QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3MDUyOA==", "bodyText": "extra space \"be  used\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396670528", "createdAt": "2020-03-23T18:32:29Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzEyMjY5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379712269", "createdAt": "2020-03-23T18:33:47Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozMzo0N1rOF6S5lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozMzo0N1rOF6S5lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3MTM4Mg==", "bodyText": "Curious why it needs to be JDK 8?  We should be able to target JDK 8 even with JDK 11.  Also, WebLogic 14.1.1 is coming....", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396671382", "createdAt": "2020-03-23T18:33:47Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 51}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzEzMDUy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379713052", "createdAt": "2020-03-23T18:34:52Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozNDo1M1rOF6S8Nw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozNDo1M1rOF6S8Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3MjA1NQ==", "bodyText": "This ought to default", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396672055", "createdAt": "2020-03-23T18:34:53Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzEzNDIz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379713423", "createdAt": "2020-03-23T18:35:23Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozNToyM1rOF6S9dA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozNToyM1rOF6S9dA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3MjM3Mg==", "bodyText": "Does this default? ;)", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396672372", "createdAt": "2020-03-23T18:35:23Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzE0MDky", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379714092", "createdAt": "2020-03-23T18:36:21Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozNjoyMVrOF6S_mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozNjoyMVrOF6S_mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3MjkyMw==", "bodyText": "Any reason it won't work?  I believe QA has tested adding cluster.  The thing I don't see here is some of these changes may require changing the domain resource yaml.   The primordial domain only has admin server and each update including the first deployment, then the python will do the scan and pass back control to operator.  So, if a new cluster is added, then the domain resource need to have a new element for it.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396672923", "createdAt": "2020-03-23T18:36:21Z", "author": {"login": "jshum2479"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/runtime-updates.md", "diffHunk": "@@ -0,0 +1,325 @@\n++++\n+title = \"Runtime updates\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 50\n+pre = \"<b> </b>\"\n+description = \"Updating a running Model in Image domain's images and model files.\"\n++++\n+\n+#### Contents\n+\n+ - [Overview](#overview)\n+ - [Important notes](#important-notes)\n+ - [Frequently asked questions](#frequently-asked-questions)\n+ - [Supported and unsupported updates](#supported-and-unsupported-updates)\n+ - [Changing a domain resource 'restartVersion'](#changing-a-domain-resource-restartversion)\n+ - [Using the WDT Discover Domain Tool](#using-the-wdt-discover-domain-tool)\n+ - [Example of adding a data source](#example-of-adding-a-data-source)\n+\n+#### Overview\n+\n+If you want to make a WebLogic domain home configuration change to a running Model in Image domain, and you want the change to survive WebLogic pod restarts, then you can modify your existing model by one or more the following approaches:\n+\n+  - Changing secrets or environment variables that are referenced by macros in your model files.\n+\n+  - Specifying a new or updated WDT config map that contains model files and use your domain resource `configuration.model.configMap` field to reference the map.\n+\n+  - Supplying a new image with new and/or changed model files.\n+\n+After changes are in place, you can tell the operator to load the changes and propagate them to a running domain by altering the domain resource's `image` or `restartVersion` attribute.\n+\n+#### Important notes\n+\n+ - Check for [Supported and unsupported updates](#supported-and-unsupported-updates).\n+\n+ - If you specify multiple model files in your image or WDT config map, the order in which they're loaded and merged is determined as described in [Model file naming and loading order]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md#model-file-naming-and-loading-order\" >}}).\n+\n+ - You can use the WDT Discover Domain Tool to help generate your model file updates. See [Using the WDT Discover Domain Tool](#using-the-wdt-discover-tool).\n+\n+ - For simple ways to change `restartVersion`, see [Changing a domain resource 'restartVersion'](#changing-a-domain-resource-restartversion).\n+\n+ - For a sample of adding a data source to a running domain, see [Example of adding a data source](#example-of-adding-a-data-source).\n+\n+ - For a discussion of model file syntax, see the [WebLogic Deploy Tool](https://github.com/oracle/weblogic-deploy-tooling) documentation and [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+ - If the introspector job reports a failure, see [Debugging]({{< relref \"/userguide/managing-domains/model-in-image/debugging.md\" >}}) for debugging advice.\n+\n+#### Frequently asked questions\n+\n+_Why is it necessary to specify updates using model files?_\n+\n+Similar to Domain in Image, if you make a direct runtime WebLogic configuration update of a Model in Image domain using the WebLogic console or WLST scripts, then the update is ephemeral. This is because the domain home is stored in an image directory which will not survive the restart of the owning pod.\n+\n+_How do Model in Image updates work during runtime?_\n+\n+After you make a change to your domain resource `restartVersion` or `image` attribute, the operator will rerun the domain's introspector job. This job will reload all of your secrets and environment variables, merge all of your model files, and generate a new domain home. If the job succeeds, then the operator will make the updated domain home available to pods using a config map named `DOMAIN_UID-weblogic-domain-introspect-cm`. Finally, the operator will subsequently roll (restart) each running WebLogic Server pod in the domain so that it can load the new configuration. A domain roll begins by restarting the domain's Administration Server and then proceeds to restart each Manager Server in the domain.\n+\n+_Can we use custom configuration overrides to do the updates instead?_\n+\n+No. Custom configuration overrides, which are WebLogic configuration overrides specified using a domain resource `configuration.overridesConfigMap`, as described in [Configuration overrides]({{< relref \"/userguide/managing-domains/configoverrides/_index.md\" >}}), aren't supported in combination with Model in Image. Model in Image will generate an error if custom overrides are specified. This should not be a concern because model file, secret, and/or model image updates are simpler and more flexible than custom configuration override updates. Unlike configuration overrides, the syntax for a model file update exactly matches the syntax for specifying your model file in the first place.\n+\n+\n+#### Supported and unsupported updates\n+\n+ - You can add new MBeans or resources simply by specifying their corresponding model file YAML snippet along with their parent bean hierarchy. See [Example of adding a data source](#example-of-adding-a-datasource).\n+\n+ - You can recreate, change, or add secrets that your model depends on. For example, you can change a database password secret.\n+\n+ - You can change or add environment variables that your model macros may depend on (macros that use the `@@ENV:myenvvar@@` syntax).\n+\n+ - You can remove a named MBean or resource by specifying a model file with a `!` symbol just before the bean or resource name. For example, if you have a data source named `mynewdatasource` defined in your model, it can be removed by specifying a small model file that loads after the model file that defines the data source, where the small model file looks like this:\n+\n+  ```\n+  resources:\n+    JDBCSystemResource:\n+      !mynewdatasource:\n+  ```\n+\n+  For more information, see [Declaring Named MBeans to Delete](https://github.com/oracle/weblogic-deploy-tooling#declaring-named-mbeans-to-delete) in the WebLogic Deploying Tooling documentation.\n+\n+ - You can add or alter an MBean attribute by specifying a YAML snippet along with its parent bean hierarchy that references an existing MBean and the attribute. For example, to add or alter the max capacity of a data source named `mynewdatasource`:\n+\n+  ```\n+  resources:\n+    JDBCSystemResource:\n+      mynewdatasource:\n+        JdbcResource:\n+          JDBCConnectionPoolParams:\n+            MaxCapacity: 5\n+  ```\n+\n+  For more information, see [Using Multiple Models](https://github.com/oracle/weblogic-deploy-tooling#using-multiple-models) in the WebLogic Deploy Tooling documentation.\n+\n+ - There is no way to directly delete an attribute from an MBean that's already been specified by a model file. The work-around is to do this using two model files: (a) add a model file that deletes the named bean/resource that is a parent to the attribute you want to delete, and (b) add another  subsequent model file that fully defines the named bean/resource but without the attribute you want to delete.\n+\n+ - The following runtime updates haven't been tested and are _not_ supported in the first release of Model in Image. If you need to make these kinds of updates, consider shutting down your domain entirely before making the change:\n+   - Adding, removing, or altering the network configuration of an existing Managed Server. This includes, but isn't limited to network channels, ports, and cluster addresses.\n+   - Adding a Managed Server to an existing configured cluster.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 97}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzE0NzYw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379714760", "createdAt": "2020-03-23T18:37:09Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozNzowOVrOF6TB2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozNzowOVrOF6TB2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3MzQ5Nw==", "bodyText": "Broken record... I've found setting up these values to feel unnecessary.  I really like that I can set them.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396673497", "createdAt": "2020-03-23T18:37:09Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzE1MDI3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379715027", "createdAt": "2020-03-23T18:37:32Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozNzozMlrOF6TCuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozNzozMlrOF6TCuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3MzcyMA==", "bodyText": "Do we want to spell out deploying new application/archives use case (technically a mbean)?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396673720", "createdAt": "2020-03-23T18:37:32Z", "author": {"login": "jshum2479"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/runtime-updates.md", "diffHunk": "@@ -0,0 +1,325 @@\n++++\n+title = \"Runtime updates\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 50\n+pre = \"<b> </b>\"\n+description = \"Updating a running Model in Image domain's images and model files.\"\n++++\n+\n+#### Contents\n+\n+ - [Overview](#overview)\n+ - [Important notes](#important-notes)\n+ - [Frequently asked questions](#frequently-asked-questions)\n+ - [Supported and unsupported updates](#supported-and-unsupported-updates)\n+ - [Changing a domain resource 'restartVersion'](#changing-a-domain-resource-restartversion)\n+ - [Using the WDT Discover Domain Tool](#using-the-wdt-discover-domain-tool)\n+ - [Example of adding a data source](#example-of-adding-a-data-source)\n+\n+#### Overview\n+\n+If you want to make a WebLogic domain home configuration change to a running Model in Image domain, and you want the change to survive WebLogic pod restarts, then you can modify your existing model by one or more the following approaches:\n+\n+  - Changing secrets or environment variables that are referenced by macros in your model files.\n+\n+  - Specifying a new or updated WDT config map that contains model files and use your domain resource `configuration.model.configMap` field to reference the map.\n+\n+  - Supplying a new image with new and/or changed model files.\n+\n+After changes are in place, you can tell the operator to load the changes and propagate them to a running domain by altering the domain resource's `image` or `restartVersion` attribute.\n+\n+#### Important notes\n+\n+ - Check for [Supported and unsupported updates](#supported-and-unsupported-updates).\n+\n+ - If you specify multiple model files in your image or WDT config map, the order in which they're loaded and merged is determined as described in [Model file naming and loading order]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md#model-file-naming-and-loading-order\" >}}).\n+\n+ - You can use the WDT Discover Domain Tool to help generate your model file updates. See [Using the WDT Discover Domain Tool](#using-the-wdt-discover-tool).\n+\n+ - For simple ways to change `restartVersion`, see [Changing a domain resource 'restartVersion'](#changing-a-domain-resource-restartversion).\n+\n+ - For a sample of adding a data source to a running domain, see [Example of adding a data source](#example-of-adding-a-data-source).\n+\n+ - For a discussion of model file syntax, see the [WebLogic Deploy Tool](https://github.com/oracle/weblogic-deploy-tooling) documentation and [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+ - If the introspector job reports a failure, see [Debugging]({{< relref \"/userguide/managing-domains/model-in-image/debugging.md\" >}}) for debugging advice.\n+\n+#### Frequently asked questions\n+\n+_Why is it necessary to specify updates using model files?_\n+\n+Similar to Domain in Image, if you make a direct runtime WebLogic configuration update of a Model in Image domain using the WebLogic console or WLST scripts, then the update is ephemeral. This is because the domain home is stored in an image directory which will not survive the restart of the owning pod.\n+\n+_How do Model in Image updates work during runtime?_\n+\n+After you make a change to your domain resource `restartVersion` or `image` attribute, the operator will rerun the domain's introspector job. This job will reload all of your secrets and environment variables, merge all of your model files, and generate a new domain home. If the job succeeds, then the operator will make the updated domain home available to pods using a config map named `DOMAIN_UID-weblogic-domain-introspect-cm`. Finally, the operator will subsequently roll (restart) each running WebLogic Server pod in the domain so that it can load the new configuration. A domain roll begins by restarting the domain's Administration Server and then proceeds to restart each Manager Server in the domain.\n+\n+_Can we use custom configuration overrides to do the updates instead?_\n+\n+No. Custom configuration overrides, which are WebLogic configuration overrides specified using a domain resource `configuration.overridesConfigMap`, as described in [Configuration overrides]({{< relref \"/userguide/managing-domains/configoverrides/_index.md\" >}}), aren't supported in combination with Model in Image. Model in Image will generate an error if custom overrides are specified. This should not be a concern because model file, secret, and/or model image updates are simpler and more flexible than custom configuration override updates. Unlike configuration overrides, the syntax for a model file update exactly matches the syntax for specifying your model file in the first place.\n+\n+\n+#### Supported and unsupported updates\n+\n+ - You can add new MBeans or resources simply by specifying their corresponding model file YAML snippet along with their parent bean hierarchy. See [Example of adding a data source](#example-of-adding-a-datasource).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzE1OTA5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379715909", "createdAt": "2020-03-23T18:38:49Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozODo0OVrOF6TFvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODozODo0OVrOF6TFvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3NDQ5NQ==", "bodyText": "Does it have to be sample-domain1-ns?  It's hard to balance usefulness vs. sample code, but the hard-coded values ought to be configurable.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396674495", "createdAt": "2020-03-23T18:38:49Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 77}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzE4OTk4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379718998", "createdAt": "2020-03-23T18:43:05Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo0MzowNVrOF6TPTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo0MzowNVrOF6TPTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3Njk0MQ==", "bodyText": "\"Oracle Database Docker images\".... capitalize Database.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396676941", "createdAt": "2020-03-23T18:43:05Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__\n+\n+     Set up access to this sample's base WebLogic image at the [Oracle Container Registry](http://container-registry.oracle.com):\n+\n+     a. Use a browser to access [Oracle Container Registry](http://container-registry.oracle.com).\n+\n+     b. Choose an image location:\n+       - For `JRF` and `RestrictedJRF` domains, select `Middleware`, then `fmw-infrastructure`.\n+       - For `WLS` domains, select `Middleware`, then `weblogic`.\n+\n+     c. Select Sign In and accept the license agreement.\n+\n+     d. Use your terminal to locally log in to Docker: `docker login container-registry.oracle.com`.\n+\n+     e. Later, when you run the sample, it will call `docker pull` for your base image based on the domain type.\n+       - For `JRF` and `RestrictedJRF`, it will pull `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4`.\n+       - For `WLS`, it will pull `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n+\n+   - __Option 2, create your own WebLogic base image.__\n+\n+     Alternatively, you can create your own base image and override the sample's default base image name and tag by exporting the `BASE_IMAGE_NAME` and `BASE_IMAGE_TAG` environment variables prior to running the sample scripts. If you want to create your own base image, see [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}).\n+\n+8. If you are using a `JRF` domain type, then it requires an RCU infrastructure database. See [Prerequisites for JRF Domains](#prerequisites-for-jrf-domains). You can do this step before or after you create your final image. If you're not using a `JRF` domain type, proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image).\n+\n+### Prerequisites for JRF domains\n+\n+> __NOTE__: This section is only required for demonstrating a `JRF` domain type. Skip this section and proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if your domain type is `WLS` or `RestrictedJRF`.\n+\n+A JRF domain requires an infrastructure database called an RCU database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain.\n+\n+The following steps demonstrate how to set up an infrastructure database that will work with this sample:\n+\n+  1. [Set up and initialize an RCU database](#set-up-and-initialize-an-rcu-database).\n+  2. [Increase introspection job timeout](#increase-introspection-job-timeout).\n+  3. [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets).\n+  4. [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables).\n+\n+\n+\n+##### Set up and initialize an RCU database\n+\n+A JRF domain requires an infrastructure database and also requires initializing this database with a schema and a set of tables. The following example shows how to set up a sample RCU database and use the RCU tool to create the infrastructure schema for a JRF domain. The RCU database is set up with the following attributes:\n+\n+| Attribute | Value |\n+| --------- | ----- |\n+| database Kubernetes namespace | `default` |\n+| database Kubernetes pod | `oracle-db` |\n+| database image | `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` |\n+| database password | `Oradoc_db1` |\n+| infrastructure schema prefix | `FMW1` |\n+| infrastructure schema password | `Oradoc_db1` |\n+| database URL | `oracle-db.default.svc.cluster.local:1521/devpdb.k8s` |\n+\n+\n+1. Ensure you have access to the database image, and then deploy it:\n+\n+   - Use a browser to log in to `https://container-registry.oracle.com`, select `database->enterprise` and accept the license agreement.\n+\n+   - Get the database image:\n+     - In the local shell, `docker login container-registry.oracle.com`.\n+     - In the local shell, `docker pull container-registry.oracle.com/database/enterprise:12.2.0.1-slim`.\n+\n+\n+       {{% notice note %}} If a local Docker login and manual pull of `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` is not sufficient (for example, if you are using a remote Kubernetes cluster), then uncomment the `imagePullSecrets` stanza in `$WORKDIR/k8s-db-slim.yaml` and create the image pull secret as follows:\n+\n+              ```\n+              kubectl create secret docker-registry regsecret \\\n+                --docker-server=container-registry.oracle.com \\\n+                --docker-username=your.email@some.com \\\n+                --docker-password=your-password \\\n+                --docker-email=your.email@some.com\n+              ```\n+       {{% /notice %}}\n+\n+\n+   - Use the sample script in `$SRCDIR/kubernetes/samples/scripts/create-oracle-db-service` to create an Oracle database running in the pod, `oracle-db`.\n+\n+      **NOTE**: If your database image access requires the `regsecret` image pull secret that you optionally created above, then pass `-s regsecret` to the `start-db-service.sh` command line.\n+\n+     ```\n+     cd $SRCDIR/kubernetes/samples/scripts/create-oracle-db-service\n+     start-db-service.sh\n+     ```\n+\n+     This script will deploy a database with the URL, `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`, and administration password, `Oradoc_db1`.\n+\n+     {{% notice warning %}} The Oracle database Docker images are supported only for non-production use. For more details, see My Oracle Support note: Oracle Support for Database Running on Docker (Doc ID 2216342.1) : All the data is gone when the database is restarted.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 180}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzI1MzA1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379725305", "createdAt": "2020-03-23T18:51:53Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo1MTo1NFrOF6TjSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo1MTo1NFrOF6TjSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4MjA1OA==", "bodyText": "The use of ctrl-c is odd, but I'll try and comment on this in the sample scripts.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396682058", "createdAt": "2020-03-23T18:51:54Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__\n+\n+     Set up access to this sample's base WebLogic image at the [Oracle Container Registry](http://container-registry.oracle.com):\n+\n+     a. Use a browser to access [Oracle Container Registry](http://container-registry.oracle.com).\n+\n+     b. Choose an image location:\n+       - For `JRF` and `RestrictedJRF` domains, select `Middleware`, then `fmw-infrastructure`.\n+       - For `WLS` domains, select `Middleware`, then `weblogic`.\n+\n+     c. Select Sign In and accept the license agreement.\n+\n+     d. Use your terminal to locally log in to Docker: `docker login container-registry.oracle.com`.\n+\n+     e. Later, when you run the sample, it will call `docker pull` for your base image based on the domain type.\n+       - For `JRF` and `RestrictedJRF`, it will pull `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4`.\n+       - For `WLS`, it will pull `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n+\n+   - __Option 2, create your own WebLogic base image.__\n+\n+     Alternatively, you can create your own base image and override the sample's default base image name and tag by exporting the `BASE_IMAGE_NAME` and `BASE_IMAGE_TAG` environment variables prior to running the sample scripts. If you want to create your own base image, see [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}).\n+\n+8. If you are using a `JRF` domain type, then it requires an RCU infrastructure database. See [Prerequisites for JRF Domains](#prerequisites-for-jrf-domains). You can do this step before or after you create your final image. If you're not using a `JRF` domain type, proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image).\n+\n+### Prerequisites for JRF domains\n+\n+> __NOTE__: This section is only required for demonstrating a `JRF` domain type. Skip this section and proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if your domain type is `WLS` or `RestrictedJRF`.\n+\n+A JRF domain requires an infrastructure database called an RCU database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain.\n+\n+The following steps demonstrate how to set up an infrastructure database that will work with this sample:\n+\n+  1. [Set up and initialize an RCU database](#set-up-and-initialize-an-rcu-database).\n+  2. [Increase introspection job timeout](#increase-introspection-job-timeout).\n+  3. [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets).\n+  4. [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables).\n+\n+\n+\n+##### Set up and initialize an RCU database\n+\n+A JRF domain requires an infrastructure database and also requires initializing this database with a schema and a set of tables. The following example shows how to set up a sample RCU database and use the RCU tool to create the infrastructure schema for a JRF domain. The RCU database is set up with the following attributes:\n+\n+| Attribute | Value |\n+| --------- | ----- |\n+| database Kubernetes namespace | `default` |\n+| database Kubernetes pod | `oracle-db` |\n+| database image | `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` |\n+| database password | `Oradoc_db1` |\n+| infrastructure schema prefix | `FMW1` |\n+| infrastructure schema password | `Oradoc_db1` |\n+| database URL | `oracle-db.default.svc.cluster.local:1521/devpdb.k8s` |\n+\n+\n+1. Ensure you have access to the database image, and then deploy it:\n+\n+   - Use a browser to log in to `https://container-registry.oracle.com`, select `database->enterprise` and accept the license agreement.\n+\n+   - Get the database image:\n+     - In the local shell, `docker login container-registry.oracle.com`.\n+     - In the local shell, `docker pull container-registry.oracle.com/database/enterprise:12.2.0.1-slim`.\n+\n+\n+       {{% notice note %}} If a local Docker login and manual pull of `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` is not sufficient (for example, if you are using a remote Kubernetes cluster), then uncomment the `imagePullSecrets` stanza in `$WORKDIR/k8s-db-slim.yaml` and create the image pull secret as follows:\n+\n+              ```\n+              kubectl create secret docker-registry regsecret \\\n+                --docker-server=container-registry.oracle.com \\\n+                --docker-username=your.email@some.com \\\n+                --docker-password=your-password \\\n+                --docker-email=your.email@some.com\n+              ```\n+       {{% /notice %}}\n+\n+\n+   - Use the sample script in `$SRCDIR/kubernetes/samples/scripts/create-oracle-db-service` to create an Oracle database running in the pod, `oracle-db`.\n+\n+      **NOTE**: If your database image access requires the `regsecret` image pull secret that you optionally created above, then pass `-s regsecret` to the `start-db-service.sh` command line.\n+\n+     ```\n+     cd $SRCDIR/kubernetes/samples/scripts/create-oracle-db-service\n+     start-db-service.sh\n+     ```\n+\n+     This script will deploy a database with the URL, `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`, and administration password, `Oradoc_db1`.\n+\n+     {{% notice warning %}} The Oracle database Docker images are supported only for non-production use. For more details, see My Oracle Support note: Oracle Support for Database Running on Docker (Doc ID 2216342.1) : All the data is gone when the database is restarted.\n+     {{% /notice %}}\n+\n+     **NOTE**: This step is based on the steps documented in [Run a Database](https://oracle.github.io/weblogic-kubernetes-operator/userguide/overview/database/).\n+\n+2. Use the sample script in `SRCDIR/kubernetes/samples/scripts/create-rcu-schema` to create the RCU schema with the schema prefix `FMW1`.\n+\n+   Note that this script assumes `Oradoc_db1` is the DBA password, `Oradoc_db1` is the schema password, and that the database URL is `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`.\n+\n+   ```\n+   cd $SRCDIR/kubernetes/samples/scripts/create-rcu-schema\n+   ./create-rcu-schema.sh -s FMW1 -i container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4\n+   ```\n+\n+   __NOTE__:  If you need to drop the repository, use this command:\n+\n+   ```\n+   drop-rcu-schema.sh -s FMW1\n+   ```\n+\n+\n+##### Increase introspection job timeout\n+\n+Because JRF domain home creation takes a considerable amount of time the first time it is created, and because Model in Image creates your domain home for you using the introspection job, you should increase the timeout for the introspection job. Use the `configuration.introspectorJobActiveDeadlineSeconds` in `k8s-domain.yaml.template` to override the default with a value of at least 300 seconds (the default is 120 seconds).  \n+\n+##### Set up RCU model attributes, domain resource attributes, and secrets\n+\n+To allow Model in Image to access the RCU database and OPSS wallet, it's necessary to set up an RCU access secret and an OPSS secret before deploying your domain. It's also necessary to define an `RCUDbInfo` stanza in your model. The sample already sets up all of these for you.  See:\n+\n+| Sample file | Description |\n+| --------- | ----- |\n+| `run_domain.sh` | Defines secret, `sample-domain1-opss-wallet-password-secret`, with `password=welcome1`. |\n+| `run_domain.sh` | Defines secret, `sample-domain1-rcu-access`, with appropriate values for attributes `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string`. |\n+| `model1.yaml.jrf` | Populates the `domainInfo -> RCUDbInfo` stanza `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string` attributes by referencing their locations in the `sample-domain1-rcu-access` secret. The `build.sh` script uses this model instead of `model.yaml.wls` when the source domain type is `JRF`. |\n+| `k8s-domain.yaml.template` | Ensures that the domain mounts the OPSS key secret by setting the domain resource `configuration.opss.walletPasswordSecret` attribute to `sample-domain1-opss-wallet-password-secret`, and ensures the domain mounts the RCU access secret, `sample-domain1-rcu-access`, for reference by WDT model macros by setting the domain resource `configuration.secrets` attribute. Use configuration.introspectorJobActiveDeadlineSeconds to increase the timeout value of the introspector job; see [Increase introspection job timeout](#increase-introspection-job-timeout). |\n+\n+ **NOTE**: This step is for information purposes only. Do not run the above sample files directly. The sample's main build and run scripts will run them for you.\n+\n+##### Reusing or sharing RCU tables\n+\n+Note that when you succesfully deploy your JRF domain resource for the first time, the introspector job will initialize the RCU tables for the domain using the `domainInfo -> RCUDbInfo` stanza in the WDT model plus the `configuration.opss.walletPasswordSecret` specified in the domain resource. The job will also create a new domain home. Finally, the operator will also capture an OPSS wallet file from the new domain's local directory and place this file in a new Kubernetes config map.\n+\n+There are scenarios when the domain needs to be re-created between updates such as WebLogic credentials are changed, security roles defined in the WDT model have been changed or you want to share the same RCU tables with different domains.  Under these scenarios, the operator needs the `walletPasswordSecret` as well as the OPSS wallet file, together with the exact information in `domainInfo -> RCUDbInfo` so that the domain can be re-created and access the same set of RCU tables.  Without the wallet file and wallet password, you will not be able to re-create a domain accessing the same set of RCU tables, therefore it is highly recommended to backup the wallet file.\n+\n+To recover a domain's RCU tables between domain restarts or to share an RCU schema between different domains, it is necessary to extract this wallet file from the config map and save the OPSS wallet password secret that was used for the original domain. The wallet password and wallet file are needed again when you recreate the domain or share the database with other domains.\n+\n+To save the wallet file:\n+\n+```\n+    opss_wallet_util.sh -s [-wf <name of the wallet file. Default ./ewallet.p12>]\n+```\n+\n+You should back up this file to a safe location that can be retrieved later.\n+\n+To reuse the wallet for subsequent redeployments or share the RCU tables between different domains:\n+\n+1. Store the wallet in a secret:\n+\n+```\n+    opss_wallet_util.sh -r [-wf <name of the wallet file. Default ./ewallet.p12>] [-ws <name of the secret. Default DOMAIN_UID-opss-walletfile-secret> ]\n+\n+```\n+\n+2. Modify the domain resource YAML file to provide the secret names:\n+\n+```\n+  configuration:\n+    opss:\n+      # Name of secret with walletPassword for extracting the wallet\n+      walletPasswordSecret: sample-domain1-opss-wallet-password-secret      \n+      # Name of secret with walletFile containing base64 encoded opss wallet\n+      walletFileSecret: sample-domain1-opss-walletfile-secret\n+\n+```\n+\n+See [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}) for instructions.\n+\n+### Use the WebLogic Image Tool to create an image\n+\n+Model in Image must contain a WebLogic install, a WebLogic Deploy Tool install, and your WDT model files. You can use the sample `./build.sh` script to build this image, which will perform the following steps for you:\n+\n+  - Uses `docker pull` to obtain a base image. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types) to set up access to the base image.)\n+  - Downloads the latest WebLogic Image Tool and WebLogic Deploy Tool to `WORKDIR`.\n+  - Creates and populates a staging directory `$WORKDIR/models` that contains your WDT model files and WDT application archive.\n+    - Builds  a simple servlet application in `$SAMPLEDIR/sample_app` into a WDT model application archive `$WORKDIR/models/archive1.zip`.\n+    - Copies sample model files from `$SAMPLEDIR/model-in-image` to `$WORKDIR/models`. This uses a model file that is appropriate to the domain type (for example, the `JRF` domain model includes database access configuration).\n+  - Uses the WebLogic Image Tool and the `$WORKDIR/models` staging directory to create a final image named `model-in-image:v1` that layers on the base image. Specifically, it runs the WebLogic Image Tool with its `update` option, which:\n+    - Builds the final image as a layer on the base image.\n+    - Puts a WDT install in image location, `/u01/wdt/weblogic-deploy`.\n+    - Copies the WDT model, properties, and application archive from `$WORDKIR/models` to image location, `/u01/wdt/models`.\n+\n+The script expects `JAVA_HOME`, `WDT_DOMAIN_TYPE`, and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/build.sh\n+  ```\n+\n+If you intend to use a remote Docker registry, you need to tag and push the image to the remote Docker registry.\n+\n+1.  Tag the image for the remote Docker registry, for example:\n+\n+```\n+docker tag <image-name>:<tag> <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>\n+```\n+\n+2.  Push the image to the remote Docker registry, for example:\n+\n+```\n+docker push <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>\n+```\n+\n+3. Create the pull secret for the remote Docker registry:\n+\n+```\n+ kubectl -n <domain namespace> create secret docker-registry <secret name> \\\n+     --docker-server=<region-key>.ocir.io/<tenancy-namespace>/<repo-name> \\\n+     --docker-username=your.email@some.com \\\n+     --docker-password=your-password \\\n+     --docker-email=your.email@some.com\n+\n+```\n+\n+4. Update the domain template file `$SAMPLEDIR/k8s-domain.yaml.template` to provide the `imagePullSecrets`:\n+\n+```\n+  imagePullSecrets:\n+  - name: <secret name>\n+\n+```\n+\n+5. Export the environment variables for the image name and tag using the same values in step 1:\n+\n+```\n+export MODEL_IMAGE_NAME=\"<region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>\"\n+export MODEL_IMAGE_TAG=\"<tag>\"\n+```\n+\n+### Create and deploy your Kubernetes resources\n+\n+To deploy the sample operator domain and its required Kubernetes resources, use the sample script, `$SAMPLEDIR/run_domain.sh`, which will perform the following steps for you:\n+\n+  - Deletes the domain with a `DomainUID` of `domain1` in the namespace, `sample-domain1-ns`, if it already exists.\n+  - Creates a secret containing your WebLogic administrator user name and password.\n+  - Creates a secret containing your Model in Image runtime encryption password:\n+    - All model-in-image domains must supply a runtime encryption secret with a `password` value.\n+    - It is used to encrypt configuration that is passed around internally by the Operator.\n+    - The value must be kept private but can be arbitrary: you can optionally supply a different secret value every time you restart the domain.\n+  - Creates secrets containing your RCU access URL, credentials, and prefix (these are unused unless the domain type is `JRF`).\n+  - Creates a config map containing an additional WDT model properties file, `$SAMPLEDIR/model1.20.properties`.\n+  - Generates a domain resource YAML file, `$WORKDIR/k8s-domain.yaml`, using `$SAMPLEDIR/k8s-domain.yaml.template`.\n+  - Deploys `k8s-domain.yaml`.\n+  - Displays the status of the domain pods.\n+\n+The script expects `WDT_DOMAIN_TYPE` and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/run_domain.sh\n+  ```\n+\n+At the end, you will see the message `Getting pod status - ctrl-c when all is running and ready to exit`. Then you should see a WebLogic Administration Server and two Managed Server pods start. After all the pods are up, you can use `ctrl-c` to exit the build script.\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 344}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzI1ODcx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379725871", "createdAt": "2020-03-23T18:52:37Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo1MjozN1rOF6Tk6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo1MjozN1rOF6Tk6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4MjQ3Mg==", "bodyText": "We're not going to support Helm 2.x with operator 3.0.0.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396682472", "createdAt": "2020-03-23T18:52:37Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__\n+\n+     Set up access to this sample's base WebLogic image at the [Oracle Container Registry](http://container-registry.oracle.com):\n+\n+     a. Use a browser to access [Oracle Container Registry](http://container-registry.oracle.com).\n+\n+     b. Choose an image location:\n+       - For `JRF` and `RestrictedJRF` domains, select `Middleware`, then `fmw-infrastructure`.\n+       - For `WLS` domains, select `Middleware`, then `weblogic`.\n+\n+     c. Select Sign In and accept the license agreement.\n+\n+     d. Use your terminal to locally log in to Docker: `docker login container-registry.oracle.com`.\n+\n+     e. Later, when you run the sample, it will call `docker pull` for your base image based on the domain type.\n+       - For `JRF` and `RestrictedJRF`, it will pull `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4`.\n+       - For `WLS`, it will pull `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n+\n+   - __Option 2, create your own WebLogic base image.__\n+\n+     Alternatively, you can create your own base image and override the sample's default base image name and tag by exporting the `BASE_IMAGE_NAME` and `BASE_IMAGE_TAG` environment variables prior to running the sample scripts. If you want to create your own base image, see [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}).\n+\n+8. If you are using a `JRF` domain type, then it requires an RCU infrastructure database. See [Prerequisites for JRF Domains](#prerequisites-for-jrf-domains). You can do this step before or after you create your final image. If you're not using a `JRF` domain type, proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image).\n+\n+### Prerequisites for JRF domains\n+\n+> __NOTE__: This section is only required for demonstrating a `JRF` domain type. Skip this section and proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if your domain type is `WLS` or `RestrictedJRF`.\n+\n+A JRF domain requires an infrastructure database called an RCU database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain.\n+\n+The following steps demonstrate how to set up an infrastructure database that will work with this sample:\n+\n+  1. [Set up and initialize an RCU database](#set-up-and-initialize-an-rcu-database).\n+  2. [Increase introspection job timeout](#increase-introspection-job-timeout).\n+  3. [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets).\n+  4. [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables).\n+\n+\n+\n+##### Set up and initialize an RCU database\n+\n+A JRF domain requires an infrastructure database and also requires initializing this database with a schema and a set of tables. The following example shows how to set up a sample RCU database and use the RCU tool to create the infrastructure schema for a JRF domain. The RCU database is set up with the following attributes:\n+\n+| Attribute | Value |\n+| --------- | ----- |\n+| database Kubernetes namespace | `default` |\n+| database Kubernetes pod | `oracle-db` |\n+| database image | `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` |\n+| database password | `Oradoc_db1` |\n+| infrastructure schema prefix | `FMW1` |\n+| infrastructure schema password | `Oradoc_db1` |\n+| database URL | `oracle-db.default.svc.cluster.local:1521/devpdb.k8s` |\n+\n+\n+1. Ensure you have access to the database image, and then deploy it:\n+\n+   - Use a browser to log in to `https://container-registry.oracle.com`, select `database->enterprise` and accept the license agreement.\n+\n+   - Get the database image:\n+     - In the local shell, `docker login container-registry.oracle.com`.\n+     - In the local shell, `docker pull container-registry.oracle.com/database/enterprise:12.2.0.1-slim`.\n+\n+\n+       {{% notice note %}} If a local Docker login and manual pull of `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` is not sufficient (for example, if you are using a remote Kubernetes cluster), then uncomment the `imagePullSecrets` stanza in `$WORKDIR/k8s-db-slim.yaml` and create the image pull secret as follows:\n+\n+              ```\n+              kubectl create secret docker-registry regsecret \\\n+                --docker-server=container-registry.oracle.com \\\n+                --docker-username=your.email@some.com \\\n+                --docker-password=your-password \\\n+                --docker-email=your.email@some.com\n+              ```\n+       {{% /notice %}}\n+\n+\n+   - Use the sample script in `$SRCDIR/kubernetes/samples/scripts/create-oracle-db-service` to create an Oracle database running in the pod, `oracle-db`.\n+\n+      **NOTE**: If your database image access requires the `regsecret` image pull secret that you optionally created above, then pass `-s regsecret` to the `start-db-service.sh` command line.\n+\n+     ```\n+     cd $SRCDIR/kubernetes/samples/scripts/create-oracle-db-service\n+     start-db-service.sh\n+     ```\n+\n+     This script will deploy a database with the URL, `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`, and administration password, `Oradoc_db1`.\n+\n+     {{% notice warning %}} The Oracle database Docker images are supported only for non-production use. For more details, see My Oracle Support note: Oracle Support for Database Running on Docker (Doc ID 2216342.1) : All the data is gone when the database is restarted.\n+     {{% /notice %}}\n+\n+     **NOTE**: This step is based on the steps documented in [Run a Database](https://oracle.github.io/weblogic-kubernetes-operator/userguide/overview/database/).\n+\n+2. Use the sample script in `SRCDIR/kubernetes/samples/scripts/create-rcu-schema` to create the RCU schema with the schema prefix `FMW1`.\n+\n+   Note that this script assumes `Oradoc_db1` is the DBA password, `Oradoc_db1` is the schema password, and that the database URL is `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`.\n+\n+   ```\n+   cd $SRCDIR/kubernetes/samples/scripts/create-rcu-schema\n+   ./create-rcu-schema.sh -s FMW1 -i container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4\n+   ```\n+\n+   __NOTE__:  If you need to drop the repository, use this command:\n+\n+   ```\n+   drop-rcu-schema.sh -s FMW1\n+   ```\n+\n+\n+##### Increase introspection job timeout\n+\n+Because JRF domain home creation takes a considerable amount of time the first time it is created, and because Model in Image creates your domain home for you using the introspection job, you should increase the timeout for the introspection job. Use the `configuration.introspectorJobActiveDeadlineSeconds` in `k8s-domain.yaml.template` to override the default with a value of at least 300 seconds (the default is 120 seconds).  \n+\n+##### Set up RCU model attributes, domain resource attributes, and secrets\n+\n+To allow Model in Image to access the RCU database and OPSS wallet, it's necessary to set up an RCU access secret and an OPSS secret before deploying your domain. It's also necessary to define an `RCUDbInfo` stanza in your model. The sample already sets up all of these for you.  See:\n+\n+| Sample file | Description |\n+| --------- | ----- |\n+| `run_domain.sh` | Defines secret, `sample-domain1-opss-wallet-password-secret`, with `password=welcome1`. |\n+| `run_domain.sh` | Defines secret, `sample-domain1-rcu-access`, with appropriate values for attributes `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string`. |\n+| `model1.yaml.jrf` | Populates the `domainInfo -> RCUDbInfo` stanza `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string` attributes by referencing their locations in the `sample-domain1-rcu-access` secret. The `build.sh` script uses this model instead of `model.yaml.wls` when the source domain type is `JRF`. |\n+| `k8s-domain.yaml.template` | Ensures that the domain mounts the OPSS key secret by setting the domain resource `configuration.opss.walletPasswordSecret` attribute to `sample-domain1-opss-wallet-password-secret`, and ensures the domain mounts the RCU access secret, `sample-domain1-rcu-access`, for reference by WDT model macros by setting the domain resource `configuration.secrets` attribute. Use configuration.introspectorJobActiveDeadlineSeconds to increase the timeout value of the introspector job; see [Increase introspection job timeout](#increase-introspection-job-timeout). |\n+\n+ **NOTE**: This step is for information purposes only. Do not run the above sample files directly. The sample's main build and run scripts will run them for you.\n+\n+##### Reusing or sharing RCU tables\n+\n+Note that when you succesfully deploy your JRF domain resource for the first time, the introspector job will initialize the RCU tables for the domain using the `domainInfo -> RCUDbInfo` stanza in the WDT model plus the `configuration.opss.walletPasswordSecret` specified in the domain resource. The job will also create a new domain home. Finally, the operator will also capture an OPSS wallet file from the new domain's local directory and place this file in a new Kubernetes config map.\n+\n+There are scenarios when the domain needs to be re-created between updates such as WebLogic credentials are changed, security roles defined in the WDT model have been changed or you want to share the same RCU tables with different domains.  Under these scenarios, the operator needs the `walletPasswordSecret` as well as the OPSS wallet file, together with the exact information in `domainInfo -> RCUDbInfo` so that the domain can be re-created and access the same set of RCU tables.  Without the wallet file and wallet password, you will not be able to re-create a domain accessing the same set of RCU tables, therefore it is highly recommended to backup the wallet file.\n+\n+To recover a domain's RCU tables between domain restarts or to share an RCU schema between different domains, it is necessary to extract this wallet file from the config map and save the OPSS wallet password secret that was used for the original domain. The wallet password and wallet file are needed again when you recreate the domain or share the database with other domains.\n+\n+To save the wallet file:\n+\n+```\n+    opss_wallet_util.sh -s [-wf <name of the wallet file. Default ./ewallet.p12>]\n+```\n+\n+You should back up this file to a safe location that can be retrieved later.\n+\n+To reuse the wallet for subsequent redeployments or share the RCU tables between different domains:\n+\n+1. Store the wallet in a secret:\n+\n+```\n+    opss_wallet_util.sh -r [-wf <name of the wallet file. Default ./ewallet.p12>] [-ws <name of the secret. Default DOMAIN_UID-opss-walletfile-secret> ]\n+\n+```\n+\n+2. Modify the domain resource YAML file to provide the secret names:\n+\n+```\n+  configuration:\n+    opss:\n+      # Name of secret with walletPassword for extracting the wallet\n+      walletPasswordSecret: sample-domain1-opss-wallet-password-secret      \n+      # Name of secret with walletFile containing base64 encoded opss wallet\n+      walletFileSecret: sample-domain1-opss-walletfile-secret\n+\n+```\n+\n+See [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}) for instructions.\n+\n+### Use the WebLogic Image Tool to create an image\n+\n+Model in Image must contain a WebLogic install, a WebLogic Deploy Tool install, and your WDT model files. You can use the sample `./build.sh` script to build this image, which will perform the following steps for you:\n+\n+  - Uses `docker pull` to obtain a base image. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types) to set up access to the base image.)\n+  - Downloads the latest WebLogic Image Tool and WebLogic Deploy Tool to `WORKDIR`.\n+  - Creates and populates a staging directory `$WORKDIR/models` that contains your WDT model files and WDT application archive.\n+    - Builds  a simple servlet application in `$SAMPLEDIR/sample_app` into a WDT model application archive `$WORKDIR/models/archive1.zip`.\n+    - Copies sample model files from `$SAMPLEDIR/model-in-image` to `$WORKDIR/models`. This uses a model file that is appropriate to the domain type (for example, the `JRF` domain model includes database access configuration).\n+  - Uses the WebLogic Image Tool and the `$WORKDIR/models` staging directory to create a final image named `model-in-image:v1` that layers on the base image. Specifically, it runs the WebLogic Image Tool with its `update` option, which:\n+    - Builds the final image as a layer on the base image.\n+    - Puts a WDT install in image location, `/u01/wdt/weblogic-deploy`.\n+    - Copies the WDT model, properties, and application archive from `$WORDKIR/models` to image location, `/u01/wdt/models`.\n+\n+The script expects `JAVA_HOME`, `WDT_DOMAIN_TYPE`, and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/build.sh\n+  ```\n+\n+If you intend to use a remote Docker registry, you need to tag and push the image to the remote Docker registry.\n+\n+1.  Tag the image for the remote Docker registry, for example:\n+\n+```\n+docker tag <image-name>:<tag> <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>\n+```\n+\n+2.  Push the image to the remote Docker registry, for example:\n+\n+```\n+docker push <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>\n+```\n+\n+3. Create the pull secret for the remote Docker registry:\n+\n+```\n+ kubectl -n <domain namespace> create secret docker-registry <secret name> \\\n+     --docker-server=<region-key>.ocir.io/<tenancy-namespace>/<repo-name> \\\n+     --docker-username=your.email@some.com \\\n+     --docker-password=your-password \\\n+     --docker-email=your.email@some.com\n+\n+```\n+\n+4. Update the domain template file `$SAMPLEDIR/k8s-domain.yaml.template` to provide the `imagePullSecrets`:\n+\n+```\n+  imagePullSecrets:\n+  - name: <secret name>\n+\n+```\n+\n+5. Export the environment variables for the image name and tag using the same values in step 1:\n+\n+```\n+export MODEL_IMAGE_NAME=\"<region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>\"\n+export MODEL_IMAGE_TAG=\"<tag>\"\n+```\n+\n+### Create and deploy your Kubernetes resources\n+\n+To deploy the sample operator domain and its required Kubernetes resources, use the sample script, `$SAMPLEDIR/run_domain.sh`, which will perform the following steps for you:\n+\n+  - Deletes the domain with a `DomainUID` of `domain1` in the namespace, `sample-domain1-ns`, if it already exists.\n+  - Creates a secret containing your WebLogic administrator user name and password.\n+  - Creates a secret containing your Model in Image runtime encryption password:\n+    - All model-in-image domains must supply a runtime encryption secret with a `password` value.\n+    - It is used to encrypt configuration that is passed around internally by the Operator.\n+    - The value must be kept private but can be arbitrary: you can optionally supply a different secret value every time you restart the domain.\n+  - Creates secrets containing your RCU access URL, credentials, and prefix (these are unused unless the domain type is `JRF`).\n+  - Creates a config map containing an additional WDT model properties file, `$SAMPLEDIR/model1.20.properties`.\n+  - Generates a domain resource YAML file, `$WORKDIR/k8s-domain.yaml`, using `$SAMPLEDIR/k8s-domain.yaml.template`.\n+  - Deploys `k8s-domain.yaml`.\n+  - Displays the status of the domain pods.\n+\n+The script expects `WDT_DOMAIN_TYPE` and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/run_domain.sh\n+  ```\n+\n+At the end, you will see the message `Getting pod status - ctrl-c when all is running and ready to exit`. Then you should see a WebLogic Administration Server and two Managed Server pods start. After all the pods are up, you can use `ctrl-c` to exit the build script.\n+\n+\n+### Optionally test the sample application\n+\n+1. Ensure Traefik has been installed and is servicing external port 30305, as per [Prerequisites for all domain types](#prerequisites-for-all-domain-types).\n+\n+2. Create a Kubernetes Ingress for the domain's WebLogic cluster in the domain's namespace by using the sample Helm chart:\n+\n+   For Helm 2.x:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 352}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzI4MTEy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379728112", "createdAt": "2020-03-23T18:55:33Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo1NTozNFrOF6Tr2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo1NTozNFrOF6Tr2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4NDI1MQ==", "bodyText": "browser", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396684251", "createdAt": "2020-03-23T18:55:34Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__\n+\n+     Set up access to this sample's base WebLogic image at the [Oracle Container Registry](http://container-registry.oracle.com):\n+\n+     a. Use a browser to access [Oracle Container Registry](http://container-registry.oracle.com).\n+\n+     b. Choose an image location:\n+       - For `JRF` and `RestrictedJRF` domains, select `Middleware`, then `fmw-infrastructure`.\n+       - For `WLS` domains, select `Middleware`, then `weblogic`.\n+\n+     c. Select Sign In and accept the license agreement.\n+\n+     d. Use your terminal to locally log in to Docker: `docker login container-registry.oracle.com`.\n+\n+     e. Later, when you run the sample, it will call `docker pull` for your base image based on the domain type.\n+       - For `JRF` and `RestrictedJRF`, it will pull `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4`.\n+       - For `WLS`, it will pull `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n+\n+   - __Option 2, create your own WebLogic base image.__\n+\n+     Alternatively, you can create your own base image and override the sample's default base image name and tag by exporting the `BASE_IMAGE_NAME` and `BASE_IMAGE_TAG` environment variables prior to running the sample scripts. If you want to create your own base image, see [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}).\n+\n+8. If you are using a `JRF` domain type, then it requires an RCU infrastructure database. See [Prerequisites for JRF Domains](#prerequisites-for-jrf-domains). You can do this step before or after you create your final image. If you're not using a `JRF` domain type, proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image).\n+\n+### Prerequisites for JRF domains\n+\n+> __NOTE__: This section is only required for demonstrating a `JRF` domain type. Skip this section and proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if your domain type is `WLS` or `RestrictedJRF`.\n+\n+A JRF domain requires an infrastructure database called an RCU database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain.\n+\n+The following steps demonstrate how to set up an infrastructure database that will work with this sample:\n+\n+  1. [Set up and initialize an RCU database](#set-up-and-initialize-an-rcu-database).\n+  2. [Increase introspection job timeout](#increase-introspection-job-timeout).\n+  3. [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets).\n+  4. [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables).\n+\n+\n+\n+##### Set up and initialize an RCU database\n+\n+A JRF domain requires an infrastructure database and also requires initializing this database with a schema and a set of tables. The following example shows how to set up a sample RCU database and use the RCU tool to create the infrastructure schema for a JRF domain. The RCU database is set up with the following attributes:\n+\n+| Attribute | Value |\n+| --------- | ----- |\n+| database Kubernetes namespace | `default` |\n+| database Kubernetes pod | `oracle-db` |\n+| database image | `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` |\n+| database password | `Oradoc_db1` |\n+| infrastructure schema prefix | `FMW1` |\n+| infrastructure schema password | `Oradoc_db1` |\n+| database URL | `oracle-db.default.svc.cluster.local:1521/devpdb.k8s` |\n+\n+\n+1. Ensure you have access to the database image, and then deploy it:\n+\n+   - Use a browser to log in to `https://container-registry.oracle.com`, select `database->enterprise` and accept the license agreement.\n+\n+   - Get the database image:\n+     - In the local shell, `docker login container-registry.oracle.com`.\n+     - In the local shell, `docker pull container-registry.oracle.com/database/enterprise:12.2.0.1-slim`.\n+\n+\n+       {{% notice note %}} If a local Docker login and manual pull of `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` is not sufficient (for example, if you are using a remote Kubernetes cluster), then uncomment the `imagePullSecrets` stanza in `$WORKDIR/k8s-db-slim.yaml` and create the image pull secret as follows:\n+\n+              ```\n+              kubectl create secret docker-registry regsecret \\\n+                --docker-server=container-registry.oracle.com \\\n+                --docker-username=your.email@some.com \\\n+                --docker-password=your-password \\\n+                --docker-email=your.email@some.com\n+              ```\n+       {{% /notice %}}\n+\n+\n+   - Use the sample script in `$SRCDIR/kubernetes/samples/scripts/create-oracle-db-service` to create an Oracle database running in the pod, `oracle-db`.\n+\n+      **NOTE**: If your database image access requires the `regsecret` image pull secret that you optionally created above, then pass `-s regsecret` to the `start-db-service.sh` command line.\n+\n+     ```\n+     cd $SRCDIR/kubernetes/samples/scripts/create-oracle-db-service\n+     start-db-service.sh\n+     ```\n+\n+     This script will deploy a database with the URL, `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`, and administration password, `Oradoc_db1`.\n+\n+     {{% notice warning %}} The Oracle database Docker images are supported only for non-production use. For more details, see My Oracle Support note: Oracle Support for Database Running on Docker (Doc ID 2216342.1) : All the data is gone when the database is restarted.\n+     {{% /notice %}}\n+\n+     **NOTE**: This step is based on the steps documented in [Run a Database](https://oracle.github.io/weblogic-kubernetes-operator/userguide/overview/database/).\n+\n+2. Use the sample script in `SRCDIR/kubernetes/samples/scripts/create-rcu-schema` to create the RCU schema with the schema prefix `FMW1`.\n+\n+   Note that this script assumes `Oradoc_db1` is the DBA password, `Oradoc_db1` is the schema password, and that the database URL is `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`.\n+\n+   ```\n+   cd $SRCDIR/kubernetes/samples/scripts/create-rcu-schema\n+   ./create-rcu-schema.sh -s FMW1 -i container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4\n+   ```\n+\n+   __NOTE__:  If you need to drop the repository, use this command:\n+\n+   ```\n+   drop-rcu-schema.sh -s FMW1\n+   ```\n+\n+\n+##### Increase introspection job timeout\n+\n+Because JRF domain home creation takes a considerable amount of time the first time it is created, and because Model in Image creates your domain home for you using the introspection job, you should increase the timeout for the introspection job. Use the `configuration.introspectorJobActiveDeadlineSeconds` in `k8s-domain.yaml.template` to override the default with a value of at least 300 seconds (the default is 120 seconds).  \n+\n+##### Set up RCU model attributes, domain resource attributes, and secrets\n+\n+To allow Model in Image to access the RCU database and OPSS wallet, it's necessary to set up an RCU access secret and an OPSS secret before deploying your domain. It's also necessary to define an `RCUDbInfo` stanza in your model. The sample already sets up all of these for you.  See:\n+\n+| Sample file | Description |\n+| --------- | ----- |\n+| `run_domain.sh` | Defines secret, `sample-domain1-opss-wallet-password-secret`, with `password=welcome1`. |\n+| `run_domain.sh` | Defines secret, `sample-domain1-rcu-access`, with appropriate values for attributes `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string`. |\n+| `model1.yaml.jrf` | Populates the `domainInfo -> RCUDbInfo` stanza `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string` attributes by referencing their locations in the `sample-domain1-rcu-access` secret. The `build.sh` script uses this model instead of `model.yaml.wls` when the source domain type is `JRF`. |\n+| `k8s-domain.yaml.template` | Ensures that the domain mounts the OPSS key secret by setting the domain resource `configuration.opss.walletPasswordSecret` attribute to `sample-domain1-opss-wallet-password-secret`, and ensures the domain mounts the RCU access secret, `sample-domain1-rcu-access`, for reference by WDT model macros by setting the domain resource `configuration.secrets` attribute. Use configuration.introspectorJobActiveDeadlineSeconds to increase the timeout value of the introspector job; see [Increase introspection job timeout](#increase-introspection-job-timeout). |\n+\n+ **NOTE**: This step is for information purposes only. Do not run the above sample files directly. The sample's main build and run scripts will run them for you.\n+\n+##### Reusing or sharing RCU tables\n+\n+Note that when you succesfully deploy your JRF domain resource for the first time, the introspector job will initialize the RCU tables for the domain using the `domainInfo -> RCUDbInfo` stanza in the WDT model plus the `configuration.opss.walletPasswordSecret` specified in the domain resource. The job will also create a new domain home. Finally, the operator will also capture an OPSS wallet file from the new domain's local directory and place this file in a new Kubernetes config map.\n+\n+There are scenarios when the domain needs to be re-created between updates such as WebLogic credentials are changed, security roles defined in the WDT model have been changed or you want to share the same RCU tables with different domains.  Under these scenarios, the operator needs the `walletPasswordSecret` as well as the OPSS wallet file, together with the exact information in `domainInfo -> RCUDbInfo` so that the domain can be re-created and access the same set of RCU tables.  Without the wallet file and wallet password, you will not be able to re-create a domain accessing the same set of RCU tables, therefore it is highly recommended to backup the wallet file.\n+\n+To recover a domain's RCU tables between domain restarts or to share an RCU schema between different domains, it is necessary to extract this wallet file from the config map and save the OPSS wallet password secret that was used for the original domain. The wallet password and wallet file are needed again when you recreate the domain or share the database with other domains.\n+\n+To save the wallet file:\n+\n+```\n+    opss_wallet_util.sh -s [-wf <name of the wallet file. Default ./ewallet.p12>]\n+```\n+\n+You should back up this file to a safe location that can be retrieved later.\n+\n+To reuse the wallet for subsequent redeployments or share the RCU tables between different domains:\n+\n+1. Store the wallet in a secret:\n+\n+```\n+    opss_wallet_util.sh -r [-wf <name of the wallet file. Default ./ewallet.p12>] [-ws <name of the secret. Default DOMAIN_UID-opss-walletfile-secret> ]\n+\n+```\n+\n+2. Modify the domain resource YAML file to provide the secret names:\n+\n+```\n+  configuration:\n+    opss:\n+      # Name of secret with walletPassword for extracting the wallet\n+      walletPasswordSecret: sample-domain1-opss-wallet-password-secret      \n+      # Name of secret with walletFile containing base64 encoded opss wallet\n+      walletFileSecret: sample-domain1-opss-walletfile-secret\n+\n+```\n+\n+See [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}) for instructions.\n+\n+### Use the WebLogic Image Tool to create an image\n+\n+Model in Image must contain a WebLogic install, a WebLogic Deploy Tool install, and your WDT model files. You can use the sample `./build.sh` script to build this image, which will perform the following steps for you:\n+\n+  - Uses `docker pull` to obtain a base image. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types) to set up access to the base image.)\n+  - Downloads the latest WebLogic Image Tool and WebLogic Deploy Tool to `WORKDIR`.\n+  - Creates and populates a staging directory `$WORKDIR/models` that contains your WDT model files and WDT application archive.\n+    - Builds  a simple servlet application in `$SAMPLEDIR/sample_app` into a WDT model application archive `$WORKDIR/models/archive1.zip`.\n+    - Copies sample model files from `$SAMPLEDIR/model-in-image` to `$WORKDIR/models`. This uses a model file that is appropriate to the domain type (for example, the `JRF` domain model includes database access configuration).\n+  - Uses the WebLogic Image Tool and the `$WORKDIR/models` staging directory to create a final image named `model-in-image:v1` that layers on the base image. Specifically, it runs the WebLogic Image Tool with its `update` option, which:\n+    - Builds the final image as a layer on the base image.\n+    - Puts a WDT install in image location, `/u01/wdt/weblogic-deploy`.\n+    - Copies the WDT model, properties, and application archive from `$WORDKIR/models` to image location, `/u01/wdt/models`.\n+\n+The script expects `JAVA_HOME`, `WDT_DOMAIN_TYPE`, and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/build.sh\n+  ```\n+\n+If you intend to use a remote Docker registry, you need to tag and push the image to the remote Docker registry.\n+\n+1.  Tag the image for the remote Docker registry, for example:\n+\n+```\n+docker tag <image-name>:<tag> <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>\n+```\n+\n+2.  Push the image to the remote Docker registry, for example:\n+\n+```\n+docker push <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>\n+```\n+\n+3. Create the pull secret for the remote Docker registry:\n+\n+```\n+ kubectl -n <domain namespace> create secret docker-registry <secret name> \\\n+     --docker-server=<region-key>.ocir.io/<tenancy-namespace>/<repo-name> \\\n+     --docker-username=your.email@some.com \\\n+     --docker-password=your-password \\\n+     --docker-email=your.email@some.com\n+\n+```\n+\n+4. Update the domain template file `$SAMPLEDIR/k8s-domain.yaml.template` to provide the `imagePullSecrets`:\n+\n+```\n+  imagePullSecrets:\n+  - name: <secret name>\n+\n+```\n+\n+5. Export the environment variables for the image name and tag using the same values in step 1:\n+\n+```\n+export MODEL_IMAGE_NAME=\"<region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>\"\n+export MODEL_IMAGE_TAG=\"<tag>\"\n+```\n+\n+### Create and deploy your Kubernetes resources\n+\n+To deploy the sample operator domain and its required Kubernetes resources, use the sample script, `$SAMPLEDIR/run_domain.sh`, which will perform the following steps for you:\n+\n+  - Deletes the domain with a `DomainUID` of `domain1` in the namespace, `sample-domain1-ns`, if it already exists.\n+  - Creates a secret containing your WebLogic administrator user name and password.\n+  - Creates a secret containing your Model in Image runtime encryption password:\n+    - All model-in-image domains must supply a runtime encryption secret with a `password` value.\n+    - It is used to encrypt configuration that is passed around internally by the Operator.\n+    - The value must be kept private but can be arbitrary: you can optionally supply a different secret value every time you restart the domain.\n+  - Creates secrets containing your RCU access URL, credentials, and prefix (these are unused unless the domain type is `JRF`).\n+  - Creates a config map containing an additional WDT model properties file, `$SAMPLEDIR/model1.20.properties`.\n+  - Generates a domain resource YAML file, `$WORKDIR/k8s-domain.yaml`, using `$SAMPLEDIR/k8s-domain.yaml.template`.\n+  - Deploys `k8s-domain.yaml`.\n+  - Displays the status of the domain pods.\n+\n+The script expects `WDT_DOMAIN_TYPE` and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/run_domain.sh\n+  ```\n+\n+At the end, you will see the message `Getting pod status - ctrl-c when all is running and ready to exit`. Then you should see a WebLogic Administration Server and two Managed Server pods start. After all the pods are up, you can use `ctrl-c` to exit the build script.\n+\n+\n+### Optionally test the sample application\n+\n+1. Ensure Traefik has been installed and is servicing external port 30305, as per [Prerequisites for all domain types](#prerequisites-for-all-domain-types).\n+\n+2. Create a Kubernetes Ingress for the domain's WebLogic cluster in the domain's namespace by using the sample Helm chart:\n+\n+   For Helm 2.x:\n+\n+   ```\n+   cd $SRCDIR\n+   $ helm install kubernetes/samples/charts/ingress-per-domain \\\n+     --name sample-domain1-ingress \\\n+     --namespace sample-domain1-ns \\\n+     --set wlsDomain.domainUID=sample-domain1 \\\n+     --set traefik.hostname=sample-domain1.org\n+   ```\n+\n+   For Helm 3.x:\n+\n+   ```\n+   cd $SRCDIR\n+   helm install sample-domain1-ingress kubernetes/samples/charts/ingress-per-domain \\\n+    --namespace sample-domain1-ns \\\n+    --set wlsDomain.domainUID=sample-domain1 \\\n+    --set traefik.hostname=sample-domain1.org\n+   ```\n+\n+   This creates an Kubernetes Ingress that helps route HTTP traffic from the Traefik load balancer's external port 30305 to the WebLogic domain's `cluster-1` 8001 port. Note that the WDT config map in this sample changes the cluster's port from 9001 to 8001 (9001 is the original port configured using the WDT model defined within in the image).\n+\n+3. Send a web application request to the load balancer:\n+\n+   ```\n+   curl -H 'host: sample-domain1.org' http://$(hostname).$(dnsdomainname):30305/sample_war/index.jsp\n+   ```\n+\n+   You should see something like the following:\n+\n+   ```\n+   Hello World, you have reached server managed-server1\n+   ```\n+\n+   **Note**: If you're running on a remote Kubernetes cluster, then substitute `$(hostname).$(dnsdomainname)` with an external address suitable for contacting the cluster.\n+\n+4. Send a ReadyApp request to the load balancer (ReadyApp is a built-in WebLogic Server application):\n+\n+   ```\n+   curl -v -H 'host: sample-domain1.org' http://$(hostname).$(dnsdomainname):30305/weblogic/ready\n+   ```\n+\n+   You should see something like the following:\n+\n+\n+   ```\n+   * About to connect() to myhost.my.dns.domain.name port 30305 (#0)\n+   *   Trying 100.111.142.32...\n+   * Connected to myhost.my.dns.domain.name (100.111.142.32) port 30305 (#0)\n+   > GET /weblogic/ready HTTP/1.1\n+   > User-Agent: curl/7.29.0\n+   > Accept: */*\n+   > host: sample-domain1.org\n+   >\n+   < HTTP/1.1 200 OK\n+   < Content-Length: 0\n+   < Date: Mon, 09 Mar 2020 20:40:37 GMT\n+   < Vary: Accept-Encoding\n+   <\n+   * Connection #0 to host myhost.my.dns.domain.name left intact\n+   ```\n+\n+   **Note**: If you're running on a remote Kubernetes cluster, then substitute `$(hostname).$(dnsdomainname)` with an external address suitable for contacting the cluster.\n+\n+### Optionally access the WebLogic console\n+\n+You can add an ingress rule to access the WebLogic Console from your local browser\n+\n+1. Find out the service name of the admin server and service port number.\n+\n+The name follows the pattern <Domain UID>-<admin server name> all lower case and the port number will be described in your \n+WDT model's admin server `listenPort`.\n+\n+You can also find the information by:\n+\n+```\n+kubectl -n sample-domain1-ns get services\n+```\n+\n+```\n+NAME                               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE\n+sample-domain1-admin-server        ClusterIP   None           <none>        7001/TCP   48m\n+```\n+\n+This shows the admin service name is `sample-domain1-admin-server` and the port for the console is `7001`\n+\n+2. Create an ingress rule for the WebLogic console\n+\n+Create the following file and call it `console-ingress.yaml` in your `$WORKDIR`.\n+\n+```\n+apiVersion: extensions/v1beta1\n+kind: Ingress\n+metadata:\n+  name: sample-domain1-console-ingress\n+  namespace: sample-domain1-ns\n+  annotations:\n+    kubernetes.io/ingress.class: traefik\n+spec:\n+  rules:\n+  - host:\n+    http:\n+      paths:\n+      - path: /console\n+        backend:\n+          serviceName: sample-domain1-admin-server\n+          servicePort: 7001\n+\n+```\n+\n+This will route the request path `/console` to the admin service port `7001` at pod `sample-domain1-admin-server` in the `sample-domain1-ns` namespace.\n+\n+3.  Apply the ingress rule resource\n+\n+```\n+kubectl apply -f $WORKDIR/console-ingress.yaml\n+```\n+\n+4.  Access the WebLogic console from the brower", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 471}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzI4NDMz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379728433", "createdAt": "2020-03-23T18:56:00Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo1NjowMFrOF6Ts8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo1NjowMFrOF6Ts8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4NDUzMQ==", "bodyText": "\"running on the same machine\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396684531", "createdAt": "2020-03-23T18:56:00Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__\n+\n+     Set up access to this sample's base WebLogic image at the [Oracle Container Registry](http://container-registry.oracle.com):\n+\n+     a. Use a browser to access [Oracle Container Registry](http://container-registry.oracle.com).\n+\n+     b. Choose an image location:\n+       - For `JRF` and `RestrictedJRF` domains, select `Middleware`, then `fmw-infrastructure`.\n+       - For `WLS` domains, select `Middleware`, then `weblogic`.\n+\n+     c. Select Sign In and accept the license agreement.\n+\n+     d. Use your terminal to locally log in to Docker: `docker login container-registry.oracle.com`.\n+\n+     e. Later, when you run the sample, it will call `docker pull` for your base image based on the domain type.\n+       - For `JRF` and `RestrictedJRF`, it will pull `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4`.\n+       - For `WLS`, it will pull `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n+\n+   - __Option 2, create your own WebLogic base image.__\n+\n+     Alternatively, you can create your own base image and override the sample's default base image name and tag by exporting the `BASE_IMAGE_NAME` and `BASE_IMAGE_TAG` environment variables prior to running the sample scripts. If you want to create your own base image, see [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}).\n+\n+8. If you are using a `JRF` domain type, then it requires an RCU infrastructure database. See [Prerequisites for JRF Domains](#prerequisites-for-jrf-domains). You can do this step before or after you create your final image. If you're not using a `JRF` domain type, proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image).\n+\n+### Prerequisites for JRF domains\n+\n+> __NOTE__: This section is only required for demonstrating a `JRF` domain type. Skip this section and proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if your domain type is `WLS` or `RestrictedJRF`.\n+\n+A JRF domain requires an infrastructure database called an RCU database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain.\n+\n+The following steps demonstrate how to set up an infrastructure database that will work with this sample:\n+\n+  1. [Set up and initialize an RCU database](#set-up-and-initialize-an-rcu-database).\n+  2. [Increase introspection job timeout](#increase-introspection-job-timeout).\n+  3. [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets).\n+  4. [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables).\n+\n+\n+\n+##### Set up and initialize an RCU database\n+\n+A JRF domain requires an infrastructure database and also requires initializing this database with a schema and a set of tables. The following example shows how to set up a sample RCU database and use the RCU tool to create the infrastructure schema for a JRF domain. The RCU database is set up with the following attributes:\n+\n+| Attribute | Value |\n+| --------- | ----- |\n+| database Kubernetes namespace | `default` |\n+| database Kubernetes pod | `oracle-db` |\n+| database image | `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` |\n+| database password | `Oradoc_db1` |\n+| infrastructure schema prefix | `FMW1` |\n+| infrastructure schema password | `Oradoc_db1` |\n+| database URL | `oracle-db.default.svc.cluster.local:1521/devpdb.k8s` |\n+\n+\n+1. Ensure you have access to the database image, and then deploy it:\n+\n+   - Use a browser to log in to `https://container-registry.oracle.com`, select `database->enterprise` and accept the license agreement.\n+\n+   - Get the database image:\n+     - In the local shell, `docker login container-registry.oracle.com`.\n+     - In the local shell, `docker pull container-registry.oracle.com/database/enterprise:12.2.0.1-slim`.\n+\n+\n+       {{% notice note %}} If a local Docker login and manual pull of `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` is not sufficient (for example, if you are using a remote Kubernetes cluster), then uncomment the `imagePullSecrets` stanza in `$WORKDIR/k8s-db-slim.yaml` and create the image pull secret as follows:\n+\n+              ```\n+              kubectl create secret docker-registry regsecret \\\n+                --docker-server=container-registry.oracle.com \\\n+                --docker-username=your.email@some.com \\\n+                --docker-password=your-password \\\n+                --docker-email=your.email@some.com\n+              ```\n+       {{% /notice %}}\n+\n+\n+   - Use the sample script in `$SRCDIR/kubernetes/samples/scripts/create-oracle-db-service` to create an Oracle database running in the pod, `oracle-db`.\n+\n+      **NOTE**: If your database image access requires the `regsecret` image pull secret that you optionally created above, then pass `-s regsecret` to the `start-db-service.sh` command line.\n+\n+     ```\n+     cd $SRCDIR/kubernetes/samples/scripts/create-oracle-db-service\n+     start-db-service.sh\n+     ```\n+\n+     This script will deploy a database with the URL, `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`, and administration password, `Oradoc_db1`.\n+\n+     {{% notice warning %}} The Oracle database Docker images are supported only for non-production use. For more details, see My Oracle Support note: Oracle Support for Database Running on Docker (Doc ID 2216342.1) : All the data is gone when the database is restarted.\n+     {{% /notice %}}\n+\n+     **NOTE**: This step is based on the steps documented in [Run a Database](https://oracle.github.io/weblogic-kubernetes-operator/userguide/overview/database/).\n+\n+2. Use the sample script in `SRCDIR/kubernetes/samples/scripts/create-rcu-schema` to create the RCU schema with the schema prefix `FMW1`.\n+\n+   Note that this script assumes `Oradoc_db1` is the DBA password, `Oradoc_db1` is the schema password, and that the database URL is `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`.\n+\n+   ```\n+   cd $SRCDIR/kubernetes/samples/scripts/create-rcu-schema\n+   ./create-rcu-schema.sh -s FMW1 -i container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4\n+   ```\n+\n+   __NOTE__:  If you need to drop the repository, use this command:\n+\n+   ```\n+   drop-rcu-schema.sh -s FMW1\n+   ```\n+\n+\n+##### Increase introspection job timeout\n+\n+Because JRF domain home creation takes a considerable amount of time the first time it is created, and because Model in Image creates your domain home for you using the introspection job, you should increase the timeout for the introspection job. Use the `configuration.introspectorJobActiveDeadlineSeconds` in `k8s-domain.yaml.template` to override the default with a value of at least 300 seconds (the default is 120 seconds).  \n+\n+##### Set up RCU model attributes, domain resource attributes, and secrets\n+\n+To allow Model in Image to access the RCU database and OPSS wallet, it's necessary to set up an RCU access secret and an OPSS secret before deploying your domain. It's also necessary to define an `RCUDbInfo` stanza in your model. The sample already sets up all of these for you.  See:\n+\n+| Sample file | Description |\n+| --------- | ----- |\n+| `run_domain.sh` | Defines secret, `sample-domain1-opss-wallet-password-secret`, with `password=welcome1`. |\n+| `run_domain.sh` | Defines secret, `sample-domain1-rcu-access`, with appropriate values for attributes `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string`. |\n+| `model1.yaml.jrf` | Populates the `domainInfo -> RCUDbInfo` stanza `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string` attributes by referencing their locations in the `sample-domain1-rcu-access` secret. The `build.sh` script uses this model instead of `model.yaml.wls` when the source domain type is `JRF`. |\n+| `k8s-domain.yaml.template` | Ensures that the domain mounts the OPSS key secret by setting the domain resource `configuration.opss.walletPasswordSecret` attribute to `sample-domain1-opss-wallet-password-secret`, and ensures the domain mounts the RCU access secret, `sample-domain1-rcu-access`, for reference by WDT model macros by setting the domain resource `configuration.secrets` attribute. Use configuration.introspectorJobActiveDeadlineSeconds to increase the timeout value of the introspector job; see [Increase introspection job timeout](#increase-introspection-job-timeout). |\n+\n+ **NOTE**: This step is for information purposes only. Do not run the above sample files directly. The sample's main build and run scripts will run them for you.\n+\n+##### Reusing or sharing RCU tables\n+\n+Note that when you succesfully deploy your JRF domain resource for the first time, the introspector job will initialize the RCU tables for the domain using the `domainInfo -> RCUDbInfo` stanza in the WDT model plus the `configuration.opss.walletPasswordSecret` specified in the domain resource. The job will also create a new domain home. Finally, the operator will also capture an OPSS wallet file from the new domain's local directory and place this file in a new Kubernetes config map.\n+\n+There are scenarios when the domain needs to be re-created between updates such as WebLogic credentials are changed, security roles defined in the WDT model have been changed or you want to share the same RCU tables with different domains.  Under these scenarios, the operator needs the `walletPasswordSecret` as well as the OPSS wallet file, together with the exact information in `domainInfo -> RCUDbInfo` so that the domain can be re-created and access the same set of RCU tables.  Without the wallet file and wallet password, you will not be able to re-create a domain accessing the same set of RCU tables, therefore it is highly recommended to backup the wallet file.\n+\n+To recover a domain's RCU tables between domain restarts or to share an RCU schema between different domains, it is necessary to extract this wallet file from the config map and save the OPSS wallet password secret that was used for the original domain. The wallet password and wallet file are needed again when you recreate the domain or share the database with other domains.\n+\n+To save the wallet file:\n+\n+```\n+    opss_wallet_util.sh -s [-wf <name of the wallet file. Default ./ewallet.p12>]\n+```\n+\n+You should back up this file to a safe location that can be retrieved later.\n+\n+To reuse the wallet for subsequent redeployments or share the RCU tables between different domains:\n+\n+1. Store the wallet in a secret:\n+\n+```\n+    opss_wallet_util.sh -r [-wf <name of the wallet file. Default ./ewallet.p12>] [-ws <name of the secret. Default DOMAIN_UID-opss-walletfile-secret> ]\n+\n+```\n+\n+2. Modify the domain resource YAML file to provide the secret names:\n+\n+```\n+  configuration:\n+    opss:\n+      # Name of secret with walletPassword for extracting the wallet\n+      walletPasswordSecret: sample-domain1-opss-wallet-password-secret      \n+      # Name of secret with walletFile containing base64 encoded opss wallet\n+      walletFileSecret: sample-domain1-opss-walletfile-secret\n+\n+```\n+\n+See [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}) for instructions.\n+\n+### Use the WebLogic Image Tool to create an image\n+\n+Model in Image must contain a WebLogic install, a WebLogic Deploy Tool install, and your WDT model files. You can use the sample `./build.sh` script to build this image, which will perform the following steps for you:\n+\n+  - Uses `docker pull` to obtain a base image. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types) to set up access to the base image.)\n+  - Downloads the latest WebLogic Image Tool and WebLogic Deploy Tool to `WORKDIR`.\n+  - Creates and populates a staging directory `$WORKDIR/models` that contains your WDT model files and WDT application archive.\n+    - Builds  a simple servlet application in `$SAMPLEDIR/sample_app` into a WDT model application archive `$WORKDIR/models/archive1.zip`.\n+    - Copies sample model files from `$SAMPLEDIR/model-in-image` to `$WORKDIR/models`. This uses a model file that is appropriate to the domain type (for example, the `JRF` domain model includes database access configuration).\n+  - Uses the WebLogic Image Tool and the `$WORKDIR/models` staging directory to create a final image named `model-in-image:v1` that layers on the base image. Specifically, it runs the WebLogic Image Tool with its `update` option, which:\n+    - Builds the final image as a layer on the base image.\n+    - Puts a WDT install in image location, `/u01/wdt/weblogic-deploy`.\n+    - Copies the WDT model, properties, and application archive from `$WORDKIR/models` to image location, `/u01/wdt/models`.\n+\n+The script expects `JAVA_HOME`, `WDT_DOMAIN_TYPE`, and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/build.sh\n+  ```\n+\n+If you intend to use a remote Docker registry, you need to tag and push the image to the remote Docker registry.\n+\n+1.  Tag the image for the remote Docker registry, for example:\n+\n+```\n+docker tag <image-name>:<tag> <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>\n+```\n+\n+2.  Push the image to the remote Docker registry, for example:\n+\n+```\n+docker push <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>\n+```\n+\n+3. Create the pull secret for the remote Docker registry:\n+\n+```\n+ kubectl -n <domain namespace> create secret docker-registry <secret name> \\\n+     --docker-server=<region-key>.ocir.io/<tenancy-namespace>/<repo-name> \\\n+     --docker-username=your.email@some.com \\\n+     --docker-password=your-password \\\n+     --docker-email=your.email@some.com\n+\n+```\n+\n+4. Update the domain template file `$SAMPLEDIR/k8s-domain.yaml.template` to provide the `imagePullSecrets`:\n+\n+```\n+  imagePullSecrets:\n+  - name: <secret name>\n+\n+```\n+\n+5. Export the environment variables for the image name and tag using the same values in step 1:\n+\n+```\n+export MODEL_IMAGE_NAME=\"<region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>\"\n+export MODEL_IMAGE_TAG=\"<tag>\"\n+```\n+\n+### Create and deploy your Kubernetes resources\n+\n+To deploy the sample operator domain and its required Kubernetes resources, use the sample script, `$SAMPLEDIR/run_domain.sh`, which will perform the following steps for you:\n+\n+  - Deletes the domain with a `DomainUID` of `domain1` in the namespace, `sample-domain1-ns`, if it already exists.\n+  - Creates a secret containing your WebLogic administrator user name and password.\n+  - Creates a secret containing your Model in Image runtime encryption password:\n+    - All model-in-image domains must supply a runtime encryption secret with a `password` value.\n+    - It is used to encrypt configuration that is passed around internally by the Operator.\n+    - The value must be kept private but can be arbitrary: you can optionally supply a different secret value every time you restart the domain.\n+  - Creates secrets containing your RCU access URL, credentials, and prefix (these are unused unless the domain type is `JRF`).\n+  - Creates a config map containing an additional WDT model properties file, `$SAMPLEDIR/model1.20.properties`.\n+  - Generates a domain resource YAML file, `$WORKDIR/k8s-domain.yaml`, using `$SAMPLEDIR/k8s-domain.yaml.template`.\n+  - Deploys `k8s-domain.yaml`.\n+  - Displays the status of the domain pods.\n+\n+The script expects `WDT_DOMAIN_TYPE` and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/run_domain.sh\n+  ```\n+\n+At the end, you will see the message `Getting pod status - ctrl-c when all is running and ready to exit`. Then you should see a WebLogic Administration Server and two Managed Server pods start. After all the pods are up, you can use `ctrl-c` to exit the build script.\n+\n+\n+### Optionally test the sample application\n+\n+1. Ensure Traefik has been installed and is servicing external port 30305, as per [Prerequisites for all domain types](#prerequisites-for-all-domain-types).\n+\n+2. Create a Kubernetes Ingress for the domain's WebLogic cluster in the domain's namespace by using the sample Helm chart:\n+\n+   For Helm 2.x:\n+\n+   ```\n+   cd $SRCDIR\n+   $ helm install kubernetes/samples/charts/ingress-per-domain \\\n+     --name sample-domain1-ingress \\\n+     --namespace sample-domain1-ns \\\n+     --set wlsDomain.domainUID=sample-domain1 \\\n+     --set traefik.hostname=sample-domain1.org\n+   ```\n+\n+   For Helm 3.x:\n+\n+   ```\n+   cd $SRCDIR\n+   helm install sample-domain1-ingress kubernetes/samples/charts/ingress-per-domain \\\n+    --namespace sample-domain1-ns \\\n+    --set wlsDomain.domainUID=sample-domain1 \\\n+    --set traefik.hostname=sample-domain1.org\n+   ```\n+\n+   This creates an Kubernetes Ingress that helps route HTTP traffic from the Traefik load balancer's external port 30305 to the WebLogic domain's `cluster-1` 8001 port. Note that the WDT config map in this sample changes the cluster's port from 9001 to 8001 (9001 is the original port configured using the WDT model defined within in the image).\n+\n+3. Send a web application request to the load balancer:\n+\n+   ```\n+   curl -H 'host: sample-domain1.org' http://$(hostname).$(dnsdomainname):30305/sample_war/index.jsp\n+   ```\n+\n+   You should see something like the following:\n+\n+   ```\n+   Hello World, you have reached server managed-server1\n+   ```\n+\n+   **Note**: If you're running on a remote Kubernetes cluster, then substitute `$(hostname).$(dnsdomainname)` with an external address suitable for contacting the cluster.\n+\n+4. Send a ReadyApp request to the load balancer (ReadyApp is a built-in WebLogic Server application):\n+\n+   ```\n+   curl -v -H 'host: sample-domain1.org' http://$(hostname).$(dnsdomainname):30305/weblogic/ready\n+   ```\n+\n+   You should see something like the following:\n+\n+\n+   ```\n+   * About to connect() to myhost.my.dns.domain.name port 30305 (#0)\n+   *   Trying 100.111.142.32...\n+   * Connected to myhost.my.dns.domain.name (100.111.142.32) port 30305 (#0)\n+   > GET /weblogic/ready HTTP/1.1\n+   > User-Agent: curl/7.29.0\n+   > Accept: */*\n+   > host: sample-domain1.org\n+   >\n+   < HTTP/1.1 200 OK\n+   < Content-Length: 0\n+   < Date: Mon, 09 Mar 2020 20:40:37 GMT\n+   < Vary: Accept-Encoding\n+   <\n+   * Connection #0 to host myhost.my.dns.domain.name left intact\n+   ```\n+\n+   **Note**: If you're running on a remote Kubernetes cluster, then substitute `$(hostname).$(dnsdomainname)` with an external address suitable for contacting the cluster.\n+\n+### Optionally access the WebLogic console\n+\n+You can add an ingress rule to access the WebLogic Console from your local browser\n+\n+1. Find out the service name of the admin server and service port number.\n+\n+The name follows the pattern <Domain UID>-<admin server name> all lower case and the port number will be described in your \n+WDT model's admin server `listenPort`.\n+\n+You can also find the information by:\n+\n+```\n+kubectl -n sample-domain1-ns get services\n+```\n+\n+```\n+NAME                               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE\n+sample-domain1-admin-server        ClusterIP   None           <none>        7001/TCP   48m\n+```\n+\n+This shows the admin service name is `sample-domain1-admin-server` and the port for the console is `7001`\n+\n+2. Create an ingress rule for the WebLogic console\n+\n+Create the following file and call it `console-ingress.yaml` in your `$WORKDIR`.\n+\n+```\n+apiVersion: extensions/v1beta1\n+kind: Ingress\n+metadata:\n+  name: sample-domain1-console-ingress\n+  namespace: sample-domain1-ns\n+  annotations:\n+    kubernetes.io/ingress.class: traefik\n+spec:\n+  rules:\n+  - host:\n+    http:\n+      paths:\n+      - path: /console\n+        backend:\n+          serviceName: sample-domain1-admin-server\n+          servicePort: 7001\n+\n+```\n+\n+This will route the request path `/console` to the admin service port `7001` at pod `sample-domain1-admin-server` in the `sample-domain1-ns` namespace.\n+\n+3.  Apply the ingress rule resource\n+\n+```\n+kubectl apply -f $WORKDIR/console-ingress.yaml\n+```\n+\n+4.  Access the WebLogic console from the brower\n+\n+\n+```\n+# If the domain and your browser are running the same machine:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 475}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzMwMDI1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379730025", "createdAt": "2020-03-23T18:58:08Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo1ODowOFrOF6Tx2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxODo1ODowOFrOF6Tx2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4NTc4NQ==", "bodyText": "Whoops... this one is on me... I got carried away with putting in 12.2.1.4, but it's just 12.2.1.3 for SOA Suite.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396685785", "createdAt": "2020-03-23T18:58:08Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/samples/simple/domains/soa-domain/_index.md", "diffHunk": "@@ -98,7 +98,7 @@ The following parameters can be provided in the inputs file.\n | `domainType` | Type of the domain. Mandatory input for SOA Suite domains. You must provide one of the supported domain type values: `soa` (deploys a SOA domain),`osb` (deploys an OSB (Oracle Service Bus) domain),`soaess` (deploys a SOA domain with Enterprise Scheduler (ESS)),`soaosb` (deploys a domain with SOA and OSB), and `soaessosb` (deploys a domain with SOA, OSB, and ESS). | `soa`\n | `exposeAdminNodePort` | Boolean indicating if the Administration Server is exposed outside of the Kubernetes cluster. | `false` |\n | `exposeAdminT3Channel` | Boolean indicating if the T3 administrative channel is exposed outside the Kubernetes cluster. | `false` |\n-| `image` | SOA Suite Docker image. The operator requires SOA Suite 12.2.1.3.0 with patch 29135930 applied. Refer to [SOA domains]({{< relref \"/userguide/managing-fmw-domains/soa-suite/_index.md#obtaining-the-soa-suite-docker-image\" >}}) for details on how to obtain or create the image. | `container-registry.oracle.com/middleware/soasuite:12.2.1.3` |\n+| `image` | SOA Suite Docker image. The operator requires SOA Suite 12.2.1.3.0 with patch 29135930 applied or SOA Suite 12.2.1.4.0. Refer to [SOA domains]({{< relref \"/userguide/managing-fmw-domains/soa-suite/_index.md#obtaining-the-soa-suite-docker-image\" >}}) for details on how to obtain or create the image. | `container-registry.oracle.com/middleware/soasuite:12.2.1.3` |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzM2ODg0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379736884", "createdAt": "2020-03-23T19:07:47Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTowNzo0OFrOF6UHWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTowNzo0OFrOF6UHWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5MTI4OQ==", "bodyText": "Does \"secret macro\" mean the @@SECRET pattern above?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396691289", "createdAt": "2020-03-23T19:07:48Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/model-files.md", "diffHunk": "@@ -0,0 +1,156 @@\n++++\n+title = \"Model files\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 30\n+pre = \"<b> </b>\"\n+description = \"Model file requirements, macros, and loading order.\"\n++++\n+\n+#### Contents\n+\n+ - [Introduction](#introduction)\n+ - [Sample model file](#sample-model-file)\n+ - [Important notes about Model in Image model files](#important-notes-about-model-in-image-model-files)\n+ - [Model file naming and loading order](#model-file-naming-and-loading-order)\n+ - [Model file macros](#model-file-macros)\n+   - [Using secrets in model files](#using-secrets-in-model-files)\n+   - [Using environment variables in model files](#using-environment-variables-in-model-files)\n+   - [Combining secrets and environment variables in model files](#combining-secrets-and-environment-variables-in-model-files)\n+\n+#### Introduction\n+\n+This document describes basic Model in Image model file syntax, naming, and macros. For additional information, see the [WebLogic Deploy Tool](https://github.com/oracle/weblogic-deploy-tooling) documentation.\n+\n+{{% notice tip %}} The WDT 'discover tool' is particularly useful for generating model files from an existing domain home.\n+{{% /notice %}}\n+\n+#### Sample model file\n+\n+Here's an example of a model `.yaml` file that defines a WebLogic Administration Server and dynamic cluster.\n+\n+```\n+domainInfo:\n+  AdminUserName: '@@SECRET:__weblogic-credentials__:username@@'\n+  AdminPassword: '@@SECRET:__weblogic-credentials__:password@@'\n+  ServerStartMode: 'prod'\n+\n+topology:\n+  Name: '@@ENV:DOMAIN_UID@@'\n+  AdminServerName: \"admin-server\"\n+  Cluster:\n+    \"cluster-1\":\n+      DynamicServers:\n+        ServerTemplate:  \"cluster-1-template\"\n+        ServerNamePrefix: \"managed-server\"\n+        DynamicClusterSize: 5\n+        MaxDynamicClusterSize: 5\n+        CalculatedListenPorts: false\n+  Server:\n+    \"admin-server\":\n+      ListenPort: 7001\n+  ServerTemplate:\n+    \"cluster-1-template\":\n+      Cluster: \"cluster-1\"\n+      ListenPort: 8001\n+```\n+\n+Some notes about the sample model file:\n+ - It includes a WebLogic credentials stanza that is required by Model in Image.\n+ - It derives its domain name from the pre-defined environment variable `DOMAIN_UID` but note that this is not required.\n+ - For a description of model file macro references to secrets and environment variables, see [Model file macros](#model-file-macros).\n+\n+#### Important notes about Model in Image model files\n+\n+- Understand when to use model macros.\n+\n+  - You can use model macros to reference arbitrary secrets from model files. This is recommended for handling mutable values such as database user names, passwords, and URLs. See [Using secrets in model files](#using-secrets-in-model-files).\n+\n+    - All password fields in a model should use secret macro. Passwords should not be directly included in property or model files because the files may appear in logs or debugging. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e2cd577c5946a45fad51e663e41f9e5f0bd9905", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8e2cd577c5946a45fad51e663e41f9e5f0bd9905", "committedDate": "2020-03-23T19:17:45Z", "message": "add script comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzQzNzM3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379743737", "createdAt": "2020-03-23T19:17:56Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToxNzo1NlrOF6Uc1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToxNzo1NlrOF6Uc1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5Njc4OA==", "bodyText": "\"domain types\"?  Unfortunately, we used to call this, \"models\".  Note that link is choose a model.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396696788", "createdAt": "2020-03-23T19:17:56Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/overview.md", "diffHunk": "@@ -0,0 +1,57 @@\n++++\n+title = \"Overview\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 10\n+pre = \"<b> </b>\"\n+description = \"Introduction to Model in Image, description of its runtime behavior, and references.\"\n++++\n+\n+#### Content\n+\n+ - [Introduction](#introduction)\n+ - [Runtime behavior overview](#runtime-behavior-overview)\n+ - [Runtime updates overview](#runtime-updates-overview)\n+ - [References](#references)\n+\n+#### Introduction\n+\n+Model in Image is an alternative to the operator's Domain in Image and Domain on PV domain types. See [Choose a Model]({{< relref \"/userguide/managing-domains/choosing-a-model/_index.md\" >}}) for a comparison of operator domain types.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzQ1MTkx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379745191", "createdAt": "2020-03-23T19:19:54Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToxOTo1NFrOF6UhWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToxOTo1NFrOF6UhWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5Nzk0NQ==", "bodyText": "Need a @rosemarymarano here on this sentence. :). The \"plus support\" phrase seems awkward.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396697945", "createdAt": "2020-03-23T19:19:54Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/overview.md", "diffHunk": "@@ -0,0 +1,57 @@\n++++\n+title = \"Overview\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 10\n+pre = \"<b> </b>\"\n+description = \"Introduction to Model in Image, description of its runtime behavior, and references.\"\n++++\n+\n+#### Content\n+\n+ - [Introduction](#introduction)\n+ - [Runtime behavior overview](#runtime-behavior-overview)\n+ - [Runtime updates overview](#runtime-updates-overview)\n+ - [References](#references)\n+\n+#### Introduction\n+\n+Model in Image is an alternative to the operator's Domain in Image and Domain on PV domain types. See [Choose a Model]({{< relref \"/userguide/managing-domains/choosing-a-model/_index.md\" >}}) for a comparison of operator domain types.\n+\n+Unlike Domain in PV and Domain in Image, Model in Image eliminates the need to pre-create your WebLogic domain home prior to deploying your domain resource.\n+\n+It enables:\n+\n+ - Defining a WebLogic domain home configuration using WebLogic Deploy Tool (WDT) model files and application archives.\n+ - Embedding model files and archives in a custom Docker image, and using the WebLogic Image Tool (WIT) to generate this image.\n+ - Supplying additional model files using a Kubernetes config map.\n+ - Supplying Kubernetes secrets that resolve macro references within the models. For example, a secret can be used to supply a database credential.\n+ - Updating WDT model files at runtime. For example, you can add a data source to a running domain. Note that all such updates currently cause the domain to 'roll' in order to take effect.\n+ - Deploying standard WLS domains, Restricted JRF domains, or JRF domains.\n+\n+WDT models are a convenient and simple alternative to WebLogic WLST configuration scripts and templates. They compactly define a WebLogic domain using YAML files, plus support including application archives in a ZIP file. The WDT model format is described in the open source [WebLogic Deploy Tool](https://github.com/oracle/weblogic-deploy-tooling) GitHub project.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzQ1NzQw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379745740", "createdAt": "2020-03-23T19:20:42Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToyMDo0MlrOF6Ui-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToyMDo0MlrOF6Ui-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5ODM2Mw==", "bodyText": "Just curious... do these have to be zips or are they tar files.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396698363", "createdAt": "2020-03-23T19:20:42Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/overview.md", "diffHunk": "@@ -0,0 +1,57 @@\n++++\n+title = \"Overview\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 10\n+pre = \"<b> </b>\"\n+description = \"Introduction to Model in Image, description of its runtime behavior, and references.\"\n++++\n+\n+#### Content\n+\n+ - [Introduction](#introduction)\n+ - [Runtime behavior overview](#runtime-behavior-overview)\n+ - [Runtime updates overview](#runtime-updates-overview)\n+ - [References](#references)\n+\n+#### Introduction\n+\n+Model in Image is an alternative to the operator's Domain in Image and Domain on PV domain types. See [Choose a Model]({{< relref \"/userguide/managing-domains/choosing-a-model/_index.md\" >}}) for a comparison of operator domain types.\n+\n+Unlike Domain in PV and Domain in Image, Model in Image eliminates the need to pre-create your WebLogic domain home prior to deploying your domain resource.\n+\n+It enables:\n+\n+ - Defining a WebLogic domain home configuration using WebLogic Deploy Tool (WDT) model files and application archives.\n+ - Embedding model files and archives in a custom Docker image, and using the WebLogic Image Tool (WIT) to generate this image.\n+ - Supplying additional model files using a Kubernetes config map.\n+ - Supplying Kubernetes secrets that resolve macro references within the models. For example, a secret can be used to supply a database credential.\n+ - Updating WDT model files at runtime. For example, you can add a data source to a running domain. Note that all such updates currently cause the domain to 'roll' in order to take effect.\n+ - Deploying standard WLS domains, Restricted JRF domains, or JRF domains.\n+\n+WDT models are a convenient and simple alternative to WebLogic WLST configuration scripts and templates. They compactly define a WebLogic domain using YAML files, plus support including application archives in a ZIP file. The WDT model format is described in the open source [WebLogic Deploy Tool](https://github.com/oracle/weblogic-deploy-tooling) GitHub project.\n+\n+For JRF domains, Model in Image provides additional support for (a) initializing the RCU database for a domain when a domain is started for first time, (b) supplying an RCU password, and finally (c) obtaining an RCU wallet for re-use in subsequent restarts of the same domain. See [Prerequisites for JRF domain types]({{< relref \"/userguide/managing-domains/model-in-image/usage.md#7-prerequisites-for-jrf-domain-types\" >}}) and [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}).\n+\n+\n+#### Runtime behavior overview\n+\n+When you deploy a Model in Image domain resource, the operator will run a Kubernetes job called the 'introspector job' that:\n+\n+  - Merges your WDT artifacts.\n+  - Runs WDT tooling to generate a domain home.\n+  - Zips up the domain home.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzQ2ODE3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379746817", "createdAt": "2020-03-23T19:22:19Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToyMjoxOVrOF6UmWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToyMjoxOVrOF6UmWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY5OTIyNw==", "bodyText": "Is this the first time we are referring to the output config map?  If so, we either need a picture of the moving parts or just avoid discussing how we are injecting the domain home.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396699227", "createdAt": "2020-03-23T19:22:19Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/overview.md", "diffHunk": "@@ -0,0 +1,57 @@\n++++\n+title = \"Overview\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 10\n+pre = \"<b> </b>\"\n+description = \"Introduction to Model in Image, description of its runtime behavior, and references.\"\n++++\n+\n+#### Content\n+\n+ - [Introduction](#introduction)\n+ - [Runtime behavior overview](#runtime-behavior-overview)\n+ - [Runtime updates overview](#runtime-updates-overview)\n+ - [References](#references)\n+\n+#### Introduction\n+\n+Model in Image is an alternative to the operator's Domain in Image and Domain on PV domain types. See [Choose a Model]({{< relref \"/userguide/managing-domains/choosing-a-model/_index.md\" >}}) for a comparison of operator domain types.\n+\n+Unlike Domain in PV and Domain in Image, Model in Image eliminates the need to pre-create your WebLogic domain home prior to deploying your domain resource.\n+\n+It enables:\n+\n+ - Defining a WebLogic domain home configuration using WebLogic Deploy Tool (WDT) model files and application archives.\n+ - Embedding model files and archives in a custom Docker image, and using the WebLogic Image Tool (WIT) to generate this image.\n+ - Supplying additional model files using a Kubernetes config map.\n+ - Supplying Kubernetes secrets that resolve macro references within the models. For example, a secret can be used to supply a database credential.\n+ - Updating WDT model files at runtime. For example, you can add a data source to a running domain. Note that all such updates currently cause the domain to 'roll' in order to take effect.\n+ - Deploying standard WLS domains, Restricted JRF domains, or JRF domains.\n+\n+WDT models are a convenient and simple alternative to WebLogic WLST configuration scripts and templates. They compactly define a WebLogic domain using YAML files, plus support including application archives in a ZIP file. The WDT model format is described in the open source [WebLogic Deploy Tool](https://github.com/oracle/weblogic-deploy-tooling) GitHub project.\n+\n+For JRF domains, Model in Image provides additional support for (a) initializing the RCU database for a domain when a domain is started for first time, (b) supplying an RCU password, and finally (c) obtaining an RCU wallet for re-use in subsequent restarts of the same domain. See [Prerequisites for JRF domain types]({{< relref \"/userguide/managing-domains/model-in-image/usage.md#7-prerequisites-for-jrf-domain-types\" >}}) and [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}).\n+\n+\n+#### Runtime behavior overview\n+\n+When you deploy a Model in Image domain resource, the operator will run a Kubernetes job called the 'introspector job' that:\n+\n+  - Merges your WDT artifacts.\n+  - Runs WDT tooling to generate a domain home.\n+  - Zips up the domain home.\n+  - Puts the ZIP file in an output Kubernetes config map named `DOMAIN_UID-weblogic-domain-introspect-cm`.\n+\n+After the introspector job completes, the operator subsequently boots your domain's WebLogic pods, and the pods will obtain their domain home from the introspector's output config map.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzU0OTkz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379754993", "createdAt": "2020-03-23T19:30:59Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTozMDo1OVrOF6U5ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTozMDo1OVrOF6U5ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcwNDEzOA==", "bodyText": "extra space \"another  subsequent\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396704138", "createdAt": "2020-03-23T19:30:59Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/runtime-updates.md", "diffHunk": "@@ -0,0 +1,325 @@\n++++\n+title = \"Runtime updates\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 50\n+pre = \"<b> </b>\"\n+description = \"Updating a running Model in Image domain's images and model files.\"\n++++\n+\n+#### Contents\n+\n+ - [Overview](#overview)\n+ - [Important notes](#important-notes)\n+ - [Frequently asked questions](#frequently-asked-questions)\n+ - [Supported and unsupported updates](#supported-and-unsupported-updates)\n+ - [Changing a domain resource 'restartVersion'](#changing-a-domain-resource-restartversion)\n+ - [Using the WDT Discover Domain Tool](#using-the-wdt-discover-domain-tool)\n+ - [Example of adding a data source](#example-of-adding-a-data-source)\n+\n+#### Overview\n+\n+If you want to make a WebLogic domain home configuration change to a running Model in Image domain, and you want the change to survive WebLogic pod restarts, then you can modify your existing model by one or more the following approaches:\n+\n+  - Changing secrets or environment variables that are referenced by macros in your model files.\n+\n+  - Specifying a new or updated WDT config map that contains model files and use your domain resource `configuration.model.configMap` field to reference the map.\n+\n+  - Supplying a new image with new and/or changed model files.\n+\n+After changes are in place, you can tell the operator to load the changes and propagate them to a running domain by altering the domain resource's `image` or `restartVersion` attribute.\n+\n+#### Important notes\n+\n+ - Check for [Supported and unsupported updates](#supported-and-unsupported-updates).\n+\n+ - If you specify multiple model files in your image or WDT config map, the order in which they're loaded and merged is determined as described in [Model file naming and loading order]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md#model-file-naming-and-loading-order\" >}}).\n+\n+ - You can use the WDT Discover Domain Tool to help generate your model file updates. See [Using the WDT Discover Domain Tool](#using-the-wdt-discover-tool).\n+\n+ - For simple ways to change `restartVersion`, see [Changing a domain resource 'restartVersion'](#changing-a-domain-resource-restartversion).\n+\n+ - For a sample of adding a data source to a running domain, see [Example of adding a data source](#example-of-adding-a-data-source).\n+\n+ - For a discussion of model file syntax, see the [WebLogic Deploy Tool](https://github.com/oracle/weblogic-deploy-tooling) documentation and [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+ - If the introspector job reports a failure, see [Debugging]({{< relref \"/userguide/managing-domains/model-in-image/debugging.md\" >}}) for debugging advice.\n+\n+#### Frequently asked questions\n+\n+_Why is it necessary to specify updates using model files?_\n+\n+Similar to Domain in Image, if you make a direct runtime WebLogic configuration update of a Model in Image domain using the WebLogic console or WLST scripts, then the update is ephemeral. This is because the domain home is stored in an image directory which will not survive the restart of the owning pod.\n+\n+_How do Model in Image updates work during runtime?_\n+\n+After you make a change to your domain resource `restartVersion` or `image` attribute, the operator will rerun the domain's introspector job. This job will reload all of your secrets and environment variables, merge all of your model files, and generate a new domain home. If the job succeeds, then the operator will make the updated domain home available to pods using a config map named `DOMAIN_UID-weblogic-domain-introspect-cm`. Finally, the operator will subsequently roll (restart) each running WebLogic Server pod in the domain so that it can load the new configuration. A domain roll begins by restarting the domain's Administration Server and then proceeds to restart each Manager Server in the domain.\n+\n+_Can we use custom configuration overrides to do the updates instead?_\n+\n+No. Custom configuration overrides, which are WebLogic configuration overrides specified using a domain resource `configuration.overridesConfigMap`, as described in [Configuration overrides]({{< relref \"/userguide/managing-domains/configoverrides/_index.md\" >}}), aren't supported in combination with Model in Image. Model in Image will generate an error if custom overrides are specified. This should not be a concern because model file, secret, and/or model image updates are simpler and more flexible than custom configuration override updates. Unlike configuration overrides, the syntax for a model file update exactly matches the syntax for specifying your model file in the first place.\n+\n+\n+#### Supported and unsupported updates\n+\n+ - You can add new MBeans or resources simply by specifying their corresponding model file YAML snippet along with their parent bean hierarchy. See [Example of adding a data source](#example-of-adding-a-datasource).\n+\n+ - You can recreate, change, or add secrets that your model depends on. For example, you can change a database password secret.\n+\n+ - You can change or add environment variables that your model macros may depend on (macros that use the `@@ENV:myenvvar@@` syntax).\n+\n+ - You can remove a named MBean or resource by specifying a model file with a `!` symbol just before the bean or resource name. For example, if you have a data source named `mynewdatasource` defined in your model, it can be removed by specifying a small model file that loads after the model file that defines the data source, where the small model file looks like this:\n+\n+  ```\n+  resources:\n+    JDBCSystemResource:\n+      !mynewdatasource:\n+  ```\n+\n+  For more information, see [Declaring Named MBeans to Delete](https://github.com/oracle/weblogic-deploy-tooling#declaring-named-mbeans-to-delete) in the WebLogic Deploying Tooling documentation.\n+\n+ - You can add or alter an MBean attribute by specifying a YAML snippet along with its parent bean hierarchy that references an existing MBean and the attribute. For example, to add or alter the max capacity of a data source named `mynewdatasource`:\n+\n+  ```\n+  resources:\n+    JDBCSystemResource:\n+      mynewdatasource:\n+        JdbcResource:\n+          JDBCConnectionPoolParams:\n+            MaxCapacity: 5\n+  ```\n+\n+  For more information, see [Using Multiple Models](https://github.com/oracle/weblogic-deploy-tooling#using-multiple-models) in the WebLogic Deploy Tooling documentation.\n+\n+ - There is no way to directly delete an attribute from an MBean that's already been specified by a model file. The work-around is to do this using two model files: (a) add a model file that deletes the named bean/resource that is a parent to the attribute you want to delete, and (b) add another  subsequent model file that fully defines the named bean/resource but without the attribute you want to delete.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 93}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzYzNjc1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379763675", "createdAt": "2020-03-23T19:38:56Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTozODo1N1rOF6VKpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTozODo1N1rOF6VKpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcwODUxNw==", "bodyText": "What is \"This is a comment\" for? :)", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396708517", "createdAt": "2020-03-23T19:38:57Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/runtime-updates.md", "diffHunk": "@@ -0,0 +1,325 @@\n++++\n+title = \"Runtime updates\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 50\n+pre = \"<b> </b>\"\n+description = \"Updating a running Model in Image domain's images and model files.\"\n++++\n+\n+#### Contents\n+\n+ - [Overview](#overview)\n+ - [Important notes](#important-notes)\n+ - [Frequently asked questions](#frequently-asked-questions)\n+ - [Supported and unsupported updates](#supported-and-unsupported-updates)\n+ - [Changing a domain resource 'restartVersion'](#changing-a-domain-resource-restartversion)\n+ - [Using the WDT Discover Domain Tool](#using-the-wdt-discover-domain-tool)\n+ - [Example of adding a data source](#example-of-adding-a-data-source)\n+\n+#### Overview\n+\n+If you want to make a WebLogic domain home configuration change to a running Model in Image domain, and you want the change to survive WebLogic pod restarts, then you can modify your existing model by one or more the following approaches:\n+\n+  - Changing secrets or environment variables that are referenced by macros in your model files.\n+\n+  - Specifying a new or updated WDT config map that contains model files and use your domain resource `configuration.model.configMap` field to reference the map.\n+\n+  - Supplying a new image with new and/or changed model files.\n+\n+After changes are in place, you can tell the operator to load the changes and propagate them to a running domain by altering the domain resource's `image` or `restartVersion` attribute.\n+\n+#### Important notes\n+\n+ - Check for [Supported and unsupported updates](#supported-and-unsupported-updates).\n+\n+ - If you specify multiple model files in your image or WDT config map, the order in which they're loaded and merged is determined as described in [Model file naming and loading order]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md#model-file-naming-and-loading-order\" >}}).\n+\n+ - You can use the WDT Discover Domain Tool to help generate your model file updates. See [Using the WDT Discover Domain Tool](#using-the-wdt-discover-tool).\n+\n+ - For simple ways to change `restartVersion`, see [Changing a domain resource 'restartVersion'](#changing-a-domain-resource-restartversion).\n+\n+ - For a sample of adding a data source to a running domain, see [Example of adding a data source](#example-of-adding-a-data-source).\n+\n+ - For a discussion of model file syntax, see the [WebLogic Deploy Tool](https://github.com/oracle/weblogic-deploy-tooling) documentation and [Model files]({{< relref \"/userguide/managing-domains/model-in-image/model-files.md\" >}}).\n+\n+ - If the introspector job reports a failure, see [Debugging]({{< relref \"/userguide/managing-domains/model-in-image/debugging.md\" >}}) for debugging advice.\n+\n+#### Frequently asked questions\n+\n+_Why is it necessary to specify updates using model files?_\n+\n+Similar to Domain in Image, if you make a direct runtime WebLogic configuration update of a Model in Image domain using the WebLogic console or WLST scripts, then the update is ephemeral. This is because the domain home is stored in an image directory which will not survive the restart of the owning pod.\n+\n+_How do Model in Image updates work during runtime?_\n+\n+After you make a change to your domain resource `restartVersion` or `image` attribute, the operator will rerun the domain's introspector job. This job will reload all of your secrets and environment variables, merge all of your model files, and generate a new domain home. If the job succeeds, then the operator will make the updated domain home available to pods using a config map named `DOMAIN_UID-weblogic-domain-introspect-cm`. Finally, the operator will subsequently roll (restart) each running WebLogic Server pod in the domain so that it can load the new configuration. A domain roll begins by restarting the domain's Administration Server and then proceeds to restart each Manager Server in the domain.\n+\n+_Can we use custom configuration overrides to do the updates instead?_\n+\n+No. Custom configuration overrides, which are WebLogic configuration overrides specified using a domain resource `configuration.overridesConfigMap`, as described in [Configuration overrides]({{< relref \"/userguide/managing-domains/configoverrides/_index.md\" >}}), aren't supported in combination with Model in Image. Model in Image will generate an error if custom overrides are specified. This should not be a concern because model file, secret, and/or model image updates are simpler and more flexible than custom configuration override updates. Unlike configuration overrides, the syntax for a model file update exactly matches the syntax for specifying your model file in the first place.\n+\n+\n+#### Supported and unsupported updates\n+\n+ - You can add new MBeans or resources simply by specifying their corresponding model file YAML snippet along with their parent bean hierarchy. See [Example of adding a data source](#example-of-adding-a-datasource).\n+\n+ - You can recreate, change, or add secrets that your model depends on. For example, you can change a database password secret.\n+\n+ - You can change or add environment variables that your model macros may depend on (macros that use the `@@ENV:myenvvar@@` syntax).\n+\n+ - You can remove a named MBean or resource by specifying a model file with a `!` symbol just before the bean or resource name. For example, if you have a data source named `mynewdatasource` defined in your model, it can be removed by specifying a small model file that loads after the model file that defines the data source, where the small model file looks like this:\n+\n+  ```\n+  resources:\n+    JDBCSystemResource:\n+      !mynewdatasource:\n+  ```\n+\n+  For more information, see [Declaring Named MBeans to Delete](https://github.com/oracle/weblogic-deploy-tooling#declaring-named-mbeans-to-delete) in the WebLogic Deploying Tooling documentation.\n+\n+ - You can add or alter an MBean attribute by specifying a YAML snippet along with its parent bean hierarchy that references an existing MBean and the attribute. For example, to add or alter the max capacity of a data source named `mynewdatasource`:\n+\n+  ```\n+  resources:\n+    JDBCSystemResource:\n+      mynewdatasource:\n+        JdbcResource:\n+          JDBCConnectionPoolParams:\n+            MaxCapacity: 5\n+  ```\n+\n+  For more information, see [Using Multiple Models](https://github.com/oracle/weblogic-deploy-tooling#using-multiple-models) in the WebLogic Deploy Tooling documentation.\n+\n+ - There is no way to directly delete an attribute from an MBean that's already been specified by a model file. The work-around is to do this using two model files: (a) add a model file that deletes the named bean/resource that is a parent to the attribute you want to delete, and (b) add another  subsequent model file that fully defines the named bean/resource but without the attribute you want to delete.\n+\n+ - The following runtime updates haven't been tested and are _not_ supported in the first release of Model in Image. If you need to make these kinds of updates, consider shutting down your domain entirely before making the change:\n+   - Adding, removing, or altering the network configuration of an existing Managed Server. This includes, but isn't limited to network channels, ports, and cluster addresses.\n+   - Adding a Managed Server to an existing configured cluster.\n+   - Altering the `cluster-size` or `max-cluster-size` of an existing dynamic cluster.\n+   - TBD This needs some research. Check with QA, etc.\n+\n+#### Changing a domain resource 'restartVersion'\n+\n+As was mentioned in the [overview](#overview), one way to tell the operator to apply your configuration changes to a running domain is by altering the domain resource `restartVersion`. Here are some common ways to do this:\n+\n+ - You can alter `restartVersion` interactively using `kubectl edit -n MY_NAMESPACE domain MY_DOMAINUID`.\n+\n+ - If you have your domain's resource file, then you can alter this file and call `kubectl apply -f` on the file.\n+\n+ - You can use the Kubernetes `get` and `patch` commands. Here's a sample automation script:\n+\n+   ```\n+   #!/bin/bash\n+   NAMESPACE=${1:-sample-domain1-ns}\n+   DOMAINUID=${2:-sample-domain1}\n+   currentRV=$(kubectl -n ${NAMESPACE} get domain ${DOMAINUID} -o=jsonpath='{.spec.restartVersion}')\n+   if [ $? = 0 ]; then\n+     # we enter here only if the previous command succeeded\n+\n+     nextRV=$((currentRV + 1))\n+\n+     echo \"@@ Info: Rolling domain '${DOMAINUID}' in namespace '${NAMESPACE}' from restartVersion='${currentRV}' to restartVersion='${nextRV}'.\"\n+\n+     kubectl -n ${NAMESPACE} patch domain ${DOMAINUID} --type='json' \\\n+       -p='[{\"op\": \"replace\", \"path\": \"/spec/restartVersion\", \"value\": \"'${nextRV}'\" }]'\n+   fi\n+   ```\n+\n+#### Using the WDT Discover Domain Tool\n+\n+The WebLogic Deploy Tooling [Discover Domain Tool](https://github.com/oracle/weblogic-deploy-tooling/blob/master/site/discover.md) generates model files from an existing domain home. You can use this tool to help determine the model file contents you would need to supply to update an existing model.\n+\n+For example, if you already have a running Model in Image domain in `sample-domain1-ns` with an Administration Server pod, `sample-domain1-admin-server`, you can do the following:\n+\n+  ```\n+  # (1) get a bash prompt in your admin server pod\n+  kubectl -n sample-domain1-ns \\\n+    exec -it sample-domain1-admin-server /bin/bash\n+\n+  # (2) In the pod, use the image's WDT discover script to\n+  # get the original WDT configuration. Notes:\n+  #  - WebLogic pods define ORACLE_HOME and DOMAIN_HOME\n+  #    for you.\n+  #  - A Model in Image image will already have WDT binaries\n+  #    in '/u01/wdt/weblogic-deploy/bin'.\n+  #  - Set 'domain_type' to one of WLS, JRF, or\n+  #    RestrictedJRF.\n+\n+  /u01/wdt/weblogic-deploy/bin/discoverDomain.sh \\\n+    -oracle_home $ORACLE_HOME \\\n+    -domain_home $DOMAIN_HOME \\\n+    -domain_type WLS \\\n+    -archive_file old.zip \\\n+    -model_file old.yaml \\\n+    -variable_file old.properties\n+\n+  # (3) Now make some WebLogic config changes via the console or WLST.\n+\n+  # (4) In the pod, use the image's WDT discover script to\n+  # get the latest WDT configuration after your changes. Notes:\n+  #  - Set 'domain_type' to one of WLS, JRF, or\n+  #    RestrictedJRF.\n+\n+  /u01/wdt/weblogic-deploy/bin/discoverDomain.sh \\\n+    -oracle_home $ORACLE_HOME \\\n+    -domain_home $DOMAIN_HOME \\\n+    -domain_type WLS \\\n+    -archive_file new.zip \\\n+    -model_file new.yaml \\\n+    -variable_file new.properties\n+\n+  # (5) In the pod, compare your old and new yaml to see what\n+  # changed.\n+\n+  diff new.yaml old.yaml\n+  ```\n+\n+#### Example of adding a data source\n+\n+Here's an example script for adding a data source to a WebLogic cluster named `cluster-1` for a domain resource in namespace, `sample-domain1-ns`, with domain UID, `sample-domain1`. This example is designed to work on top of the [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample.\n+\n+This example references a database running in the `default` namespace that is accessed with the URL `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`, user `sys as dba`, and password `Oradoc_db1`. Note that you can still add this data source even if there's no database running at this location.\n+\n+{{% notice note %}} If you already have a WDT config map deployed for your running domain, as is true for the [Model in Image]({{< relref \"/samples/simple/domains/model-in-image/_index.md\" >}}) sample, then you should ensure that it includes any other needed files that were in the original WDT config map, in addition to the new data source YAML file. For example, the Model in Image sample puts file(s) in a directory that it uses to stage its config map in `$WORKDIR/wdtconfigmap`.\n+{{% /notice %}}\n+\n+\n+  ```\n+  #!/bin/bash\n+\n+  set -eu\n+\n+  # Assume SAMPLEDIR references the 'kubernetes/samples/scripts/create-weblogic-domain/model-in-image' directory within the operator source.\n+\n+  # Assume the DB is running in the following namespace\n+\n+  DB_NAMESPACE=\"default\"\n+\n+  # Assume DOMAIN_UID is the following\n+\n+  DOMAIN_UID=sample-domain1\n+\n+  # Assume DOMAIN_NAMESPACE is the following\n+\n+  DOMAIN_NAMESPACE=sample-domain1-ns\n+\n+  # Assume the DB URL and password are defined in a secret as follows\n+\n+  $SAMPLEDIR/create_secret.sh \\\n+    -n ${DOMAIN_NAMESPACE} \\\n+    -s ${DOMAIN_UID}-new-db-access-secret \\\n+    -l password=Oradoc_db1 \\\n+    -l url=oracle-db.${DB_NAMESPACE}.svc.cluster.local:1521/devpdb.k8s\n+\n+  # Assume WORKDIR is your working directory\n+\n+  cd $WORKDIR\n+\n+  # Create a WDT configmap with the datasource WDT yaml snippet\n+\n+  mkdir -p ./wdtconfigmap\n+\n+  cat << EOF > wdtconfigmap/datasource.yaml\n+  resources:\n+    JDBCSystemResource:\n+      mynewdatasource:\n+        Target: 'cluster-1'\n+        JdbcResource:\n+          JDBCDataSourceParams:\n+            JNDIName: [\n+              jdbc/generic2,\n+              jdbc/special2\n+            ]\n+            GlobalTransactionsProtocol: TwoPhaseCommit\n+          JDBCDriverParams:\n+            DriverName: oracle.jdbc.xa.client.OracleXADataSource\n+            URL:               '@@SECRET:@@ENV:DOMAIN_UID@@-new-db-access-secret/url@@'\n+            PasswordEncrypted: '@@SECRET:@@ENV:DOMAIN_UID@@-new-db-access-secret/password@@'\n+            Properties:\n+              user:\n+                Value: 'sys as sysdba'\n+              oracle.net.CONNECT_TIMEOUT:\n+                Value: 5000\n+              oracle.jdbc.ReadTimeout:\n+                Value: 30000\n+          JDBCConnectionPoolParams:\n+              InitialCapacity: 0\n+              MaxCapacity: 1                   # This is a comment", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 247}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzY1MzMz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379765333", "createdAt": "2020-03-23T19:41:19Z", "commit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTo0MToyMFrOF6VR2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOTo0MToyMFrOF6VR2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcxMDM2MQ==", "bodyText": "The parenthetical is a bit confusing.  It might be clearer to just have a second sentence saying, \"These items do not need to be created in order.\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396710361", "createdAt": "2020-03-23T19:41:20Z", "author": {"login": "rjeberhard"}, "path": "docs-source/content/userguide/managing-domains/model-in-image/usage.md", "diffHunk": "@@ -0,0 +1,155 @@\n++++\n+title = \"Usage\"\n+date = 2020-03-11T16:45:16-05:00\n+weight = 20\n+pre = \"<b> </b>\"\n+description = \"Steps for creating and deploying Model in Image images and their associated domain resources.\"\n++++\n+\n+\n+#### Contents\n+\n+   - [WebLogic operator](#1-weblogic-operator)\n+   - [WebLogic image](#2-weblogic-image)\n+   - [Optional WDT model config map](#3-optional-wdt-model-config-map)\n+   - [Required runtime encryption secret](#4-required-runtime-encryption-secret)\n+   - [Secrets for model macros](#5-secrets-for-model-macros)\n+   - [Domain resource attributes](#6-domain-resource-attributes)\n+   - [Prerequisites for JRF domain types](#7-prerequisites-for-jrf-domain-types)\n+\n+#### Requirements\n+\n+Here's what's needed to create and deploy a typical Model in Image domain (though enumerated, you need not supply them in order):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f46823be21e32c4b54a101d5590aeb40dbcdb15"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b42d4a5a8538feebae7f9446eb324995d3c49a3", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8b42d4a5a8538feebae7f9446eb324995d3c49a3", "committedDate": "2020-03-23T19:57:30Z", "message": "Add introspectorJobActiveDeadlinSeconds to the samples\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2b01c3744a72e136023f270c573a225024a3a128", "committedDate": "2020-03-23T20:02:57Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5Nzg2MzYw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379786360", "createdAt": "2020-03-23T20:12:31Z", "commit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDoxMjozMVrOF6WYUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDoxMjozMVrOF6WYUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcyODQwMg==", "bodyText": "Do we have PV directories for model-in-image tests?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396728402", "createdAt": "2020-03-23T20:12:31Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItModelInImage.java", "diffHunk": "@@ -0,0 +1,227 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.kubernetes.operator;\n+\n+import java.util.ArrayList;\n+import java.util.Map;\n+import java.util.logging.Level;\n+\n+import oracle.kubernetes.operator.utils.Domain;\n+import oracle.kubernetes.operator.utils.LoggerHelper;\n+import oracle.kubernetes.operator.utils.Operator;\n+import oracle.kubernetes.operator.utils.Operator.RestCertType;\n+import oracle.kubernetes.operator.utils.TestUtils;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Assumptions;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+/**\n+ * Simple JUnit test file used for testing Model in Image.\n+ *\n+ * <p>This test is used for creating domain using model in image.\n+ */\n+\n+public class ItModelInImage extends MiiBaseTest {\n+  private static Operator operator;\n+  private static String domainNS;\n+  private static String testClassName;\n+  private static StringBuffer namespaceList;\n+\n+  /**\n+   * This method gets called only once before any of the test methods are executed. It does the\n+   * initialization of the integration test properties defined in OperatorIT.properties and setting\n+   * the resultRoot, pvRoot and projectRoot attributes.\n+   *\n+   * @throws Exception exception\n+   */\n+  @BeforeAll\n+  public static void staticPrepare() throws Exception {\n+    namespaceList = new StringBuffer();\n+    testClassName = new Object() {\n+    }.getClass().getEnclosingClass().getSimpleName();\n+    // initialize test properties and create the directories\n+    initialize(APP_PROPS_FILE, testClassName);\n+  }\n+\n+  /**\n+   * This method gets called before every test. It creates the result/pv root directories\n+   * for the test. Creates the operator and domain if its not running.\n+   *\n+   * @throws Exception exception if result/pv/operator/domain creation fails\n+   */\n+  @BeforeEach\n+  public void prepare() throws Exception {\n+\n+    createResultAndPvDirs(testClassName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzkyNjgx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379792681", "createdAt": "2020-03-23T20:22:12Z", "commit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDoyMjoxMlrOF6WrAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDoyMjoxMlrOF6WrAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjczMzE4NA==", "bodyText": "Why is @Test commented out?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396733184", "createdAt": "2020-03-23T20:22:12Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItModelInImage.java", "diffHunk": "@@ -0,0 +1,227 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.kubernetes.operator;\n+\n+import java.util.ArrayList;\n+import java.util.Map;\n+import java.util.logging.Level;\n+\n+import oracle.kubernetes.operator.utils.Domain;\n+import oracle.kubernetes.operator.utils.LoggerHelper;\n+import oracle.kubernetes.operator.utils.Operator;\n+import oracle.kubernetes.operator.utils.Operator.RestCertType;\n+import oracle.kubernetes.operator.utils.TestUtils;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Assumptions;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+/**\n+ * Simple JUnit test file used for testing Model in Image.\n+ *\n+ * <p>This test is used for creating domain using model in image.\n+ */\n+\n+public class ItModelInImage extends MiiBaseTest {\n+  private static Operator operator;\n+  private static String domainNS;\n+  private static String testClassName;\n+  private static StringBuffer namespaceList;\n+\n+  /**\n+   * This method gets called only once before any of the test methods are executed. It does the\n+   * initialization of the integration test properties defined in OperatorIT.properties and setting\n+   * the resultRoot, pvRoot and projectRoot attributes.\n+   *\n+   * @throws Exception exception\n+   */\n+  @BeforeAll\n+  public static void staticPrepare() throws Exception {\n+    namespaceList = new StringBuffer();\n+    testClassName = new Object() {\n+    }.getClass().getEnclosingClass().getSimpleName();\n+    // initialize test properties and create the directories\n+    initialize(APP_PROPS_FILE, testClassName);\n+  }\n+\n+  /**\n+   * This method gets called before every test. It creates the result/pv root directories\n+   * for the test. Creates the operator and domain if its not running.\n+   *\n+   * @throws Exception exception if result/pv/operator/domain creation fails\n+   */\n+  @BeforeEach\n+  public void prepare() throws Exception {\n+\n+    createResultAndPvDirs(testClassName);\n+\n+    // create operator1\n+    if (operator == null) {\n+      Map<String, Object> operatorMap = createOperatorMap(getNewSuffixCount(),\n+          true, testClassName);\n+      operator = TestUtils.createOperator(operatorMap, RestCertType.SELF_SIGNED);\n+      Assertions.assertNotNull(operator);\n+      domainNS = ((ArrayList<String>) operatorMap.get(\"domainNamespaces\")).get(0);\n+      namespaceList.append((String)operatorMap.get(\"namespace\"));\n+      namespaceList.append(\" \").append(domainNS);\n+    }\n+  }\n+\n+  /**\n+   * Releases k8s cluster lease, archives result, pv directories.\n+   *\n+   * @throws Exception exception\n+   */\n+  @AfterAll\n+  public static void staticUnPrepare() throws Exception {\n+    tearDown(new Object() {\n+    }.getClass().getEnclosingClass().getSimpleName(), namespaceList.toString());\n+\n+    LoggerHelper.getLocal().info(\"SUCCESS\");\n+  }\n+\n+  /**\n+   * Create a domain using model in image with model yaml and model properties\n+   * file in the image. Deploy the domain, verify the running domain has\n+   * the correct configuration as given in the image.\n+   *\n+   * @throws Exception exception\n+   */\n+  @Test\n+  public void testMiiWithNoConfigMap() throws Exception {\n+    Assumptions.assumeTrue(QUICKTEST);\n+    String testMethodName = new Object() {\n+    }.getClass().getEnclosingMethod().getName();\n+    logTestBegin(testMethodName);\n+    LoggerHelper.getLocal().log(Level.INFO,\n+        \"Creating Domain & waiting for the script to complete execution\");\n+    Domain domain = null;\n+    boolean testCompletedSuccessfully = false;\n+    try {\n+      Map<String, Object> domainMap =\n+          createModelInImageMap(getNewSuffixCount(), testClassName);\n+      domainMap.put(\"namespace\", domainNS);\n+      domainMap.put(\"wdtModelFile\", \"./model.wls.yaml\");\n+      domainMap.put(\"wdtModelPropertiesFile\", \"./model.properties\");\n+\n+      domain = TestUtils.createDomain(domainMap);\n+      // domain = new Domain(domainMap, true, false);\n+      domain.verifyDomainCreated();\n+      testCompletedSuccessfully = true;\n+    } finally {\n+      if (domain != null && (JENKINS || testCompletedSuccessfully)) {\n+        TestUtils.deleteWeblogicDomainResources(domain.getDomainUid());\n+      }\n+    }\n+\n+    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethodName);\n+  }\n+\n+  /**\n+   * Create a domain using model in image and having configmap in the domain.yaml\n+   * before deploying the domain. After deploying the domain crd, create a new\n+   * config map and update the domain crd to new config map and change domain\n+   * restartVersion to reload the model, generate new config and initiate a\n+   * rolling restart.\n+   * @throws Exception exception\n+   */\n+  @Test\n+  public void testMiiWithConfigMapBothBeforeAndAfterDeployingDomain() throws Exception {\n+    Assumptions.assumeTrue(QUICKTEST);\n+    String testMethodName = new Object() {\n+    }.getClass().getEnclosingMethod().getName();\n+    logTestBegin(testMethodName);\n+    LoggerHelper.getLocal().log(Level.INFO,\n+        \"Creating Domain & waiting for the script to complete execution\");\n+    Domain domain = null;\n+    boolean testCompletedSuccessfully = false;\n+    try {\n+\n+      domain = createMIIDomainWithConfigMap(testClassName, domainNS, \"./model.wls.yaml\",\n+          \"./model.empty.properties\", \"./model.properties\", \"WLS\");\n+      Map<String, Object> domainMap = domain.getDomainMap();\n+      //ToDo: access MS using port given in the configmap props\n+\n+      // config map after deploying domain crd\n+      String cmName = domainMap.get(\"domainUID\") + \"-mii-config-map2\";\n+      String cmFile = getResultDir() + \"/samples/model-in-image/model.cm.properties\";\n+      TestUtils.createConfigMap(cmName, cmFile, domainNS,\n+          \" weblogic.domainUID=\" + domainMap.get(\"domainUID\"));\n+\n+      // update domain yaml with new config map, restartVersion and\n+      // apply the domain yaml, verify domain restarted\n+      modifyDomainYamlWithNewConfigMapAndDomainRestartVersion(\n+          cmName, domain);\n+      LoggerHelper.getLocal().log(Level.INFO, \"Verifying if the domain is restarted\");\n+      domain.verifyDomainRestarted();\n+      //ToDo: access MS using port given in the new configmap props\n+      testCompletedSuccessfully = true;\n+    } finally {\n+      if (domain != null && (JENKINS || testCompletedSuccessfully)) {\n+        TestUtils.deleteWeblogicDomainResources(domain.getDomainUid());\n+      }\n+    }\n+\n+    LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethodName);\n+  }\n+\n+  /**\n+   * Negative test. overridesConfigMap should fail with model in image domain.\n+   * Create a domain using model in image and deploy the domain.\n+   * After deploying the domain, update domain crd with overrides configmap and\n+   * apply the crd.\n+   * Verify that the domain deployment fails with proper error in the operator log.\n+   *\n+   * @throws Exception exception\n+   */\n+  //@Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "originalPosition": 180}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5Nzk3MDUz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379797053", "createdAt": "2020-03-23T20:28:49Z", "commit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDoyODo0OVrOF6W4Ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDoyODo0OVrOF6W4Ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjczNjYwMw==", "bodyText": "What will be the content of this config map?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396736603", "createdAt": "2020-03-23T20:28:49Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/TestUtils.java", "diffHunk": "@@ -1980,4 +1980,28 @@ public static ExecResult kubectlpatch(String domainUid, String domainNS, String\n     return exec(cmd, true);\n   }\n \n+  /**\n+   * create configmap in the given namespace. Also creates label.\n+   * @param cmName\n+   * @param fileOrDirPath\n+   * @param namespace\n+   * @throws Exception\n+   */\n+  public static void createConfigMap(String cmName, String fileOrDirPath,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5Nzk4MTcx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379798171", "createdAt": "2020-03-23T20:30:21Z", "commit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDozMDoyMVrOF6W7ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDozMDoyMVrOF6W7ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjczNzQ3NQ==", "bodyText": "What is model-in-image using PV mount for?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396737475", "createdAt": "2020-03-23T20:30:21Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/resources/model-in-image/create-domain-inputs.yaml", "diffHunk": "@@ -0,0 +1,167 @@\n+# Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+# The version of this inputs file.  Do not modify.\n+version: create-weblogic-sample-domain-inputs-v1\n+\n+# Port number for admin server\n+adminPort: 7001\n+\n+# Name of the Admin Server\n+adminServerName: admin-server\n+\n+# Unique ID identifying a domain.\n+# This ID must not contain an underscope (\"_\"), and must be lowercase and unique across all domains\n+# in a Kubernetes cluster.\n+domainUID: domain1\n+\n+# Determines which WebLogic Servers the operator will start up\n+# Legal values are \"NEVER\", \"IF_NEEDED\", or \"ADMIN_ONLY\"\n+serverStartPolicy: IF_NEEDED\n+\n+# Cluster name\n+clusterName: cluster-1\n+\n+# Number of managed servers to generate for the domain\n+configuredManagedServerCount: 5\n+\n+# Number of managed servers to initially start for the domain\n+initialManagedServerReplicas: 2\n+\n+# Base string used to generate managed server names\n+managedServerNameBase: managed-server\n+\n+# Port number for each managed server\n+managedServerPort: 8001\n+\n+# Boolean indicating if production mode is enabled for the domain\n+productionModeEnabled: true\n+\n+# Name of the image for the created model in image. With Model In Image, WDT models, WDT\n+# archives and WDT install can be included in the image. Additional models and variable\n+# files can be provided using kubernetes config map.\n+# If this property is set, the create domain scripts will use the value specified, instead of the\n+# default value, to tag the generated image and set the `image` in the domain YAML file.\n+#\n+# A unique value is required for each domain that is created using the scripts.\n+#\n+# If you are running the sample scripts from a machine that is remote to the Kubernetes cluster where\n+# the domain is going to be running, you need to set this property to the image name that is intended\n+# to be used in a registry local to that Kubernetes cluster. You also need to push the `image` to\n+# that registry before starting the domain using the `kubectl create -f` or `kubectl apply -f` command.\n+# See README.md for more help.\n+image: model-in-image:v1\n+\n+# Image pull policy\n+# Legal values are \"IfNotPresent\", \"Always\", or \"Never\"\n+imagePullPolicy: IfNotPresent\n+\n+# Name of the Kubernetes secret to access the Docker Store to pull the WebLogic Server Docker image\n+# The presence of the secret will be validated when this parameter is enabled.\n+#imagePullSecretName:\n+\n+# Name of the Kubernetes secret for the Admin Server's username and password\n+# The name must be lowercase.\n+# If not specified, the value is derived from the domainUID as <domainUID>-weblogic-credentials\n+weblogicCredentialsSecretName: domain1-weblogic-credentials\n+\n+# Whether to include server .out to the pod's stdout.\n+# The default is true.\n+includeServerOutInPodLog: true\n+\n+# Specifies whether the log home is stored on the persistent volume.\n+# If set to true, then you must specify the 'logHome', 'persistentVolumeClaimName'\n+# and 'domainPVMountPath' properties.\n+# The default is false.\n+logHomeOnPV: false\n+\n+# The in-pod location for domain log, server logs, server out, and node manager log files\n+# If not specified, the value is derived from the domainUID as /shared/logs/<domainUID>\n+# This parameter is required if 'logHomeOnPV' is true.\n+# Otherwise, it is ignored.\n+logHome: /shared/logs/domain1\n+\n+# An (optional) in-pod location for data storage of default and custom file stores.\n+# If not specified or the value is either not set or empty (e.g. dataHome: \"\") then the\n+# data storage directories are determined from the WebLogic domain home configuration.\n+#dataHome:\n+\n+# Port for the T3Channel of the NetworkAccessPoint\n+t3ChannelPort: 30012\n+\n+# Public address for T3Channel of the NetworkAccessPoint.  This value should be set to the\n+# kubernetes server address, which you can get by running \"kubectl cluster-info\".  If this\n+# value is not set to that address, WLST will not be able to connect from outside the\n+# kubernetes cluster.\n+#t3PublicAddress: \n+\n+# Boolean to indicate if the channel should be exposed as a service\n+exposeAdminT3Channel: false\n+\n+# NodePort to expose for the admin server\n+adminNodePort: 30701\n+\n+# Boolean to indicate if the adminNodePort will be exposed\n+exposeAdminNodePort: false\n+\n+# Name of the domain namespace\n+namespace: default\n+\n+# Java Option for WebLogic Server\n+javaOptions: -Dweblogic.StdoutDebugEnabled=false\n+\n+# Name of the persistent volume claim\n+# If not specified, the value is derived from the domainUID as <domainUID>-weblogic-sample-pvc\n+# This parameter is required if 'logHomeOnPV' is true.\n+# Otherwise, it is ignored.\n+persistentVolumeClaimName: domain1-weblogic-sample-pvc\n+\n+# Mount path of the domain persistent volume.\n+# This parameter is required if 'logHomeOnPV' is true.\n+# Otherwise, it is ignored.\n+domainPVMountPath: /shared", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "originalPosition": 122}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODAwMzMx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379800331", "createdAt": "2020-03-23T20:33:30Z", "commit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDozMzozMFrOF6XCkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDozMzozMFrOF6XCkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjczOTIxOQ==", "bodyText": "Not a comment on this file... What is model.empty.properties below?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396739219", "createdAt": "2020-03-23T20:33:30Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/resources/model-in-image/model.cm.properties", "diffHunk": "@@ -0,0 +1,5 @@\n+# Copyright 2019, Oracle Corporation and/or its affiliates. All rights reserved.\n+# Licensed under the Universal Permissive License v 1.0 as shown at http://oss.oracle.com/licenses/upl.\n+#\n+\n+MANSVR_PORT=9001", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODAxMzkw", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379801390", "createdAt": "2020-03-23T20:35:08Z", "commit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDozNTowOFrOF6XF-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDozNTowOFrOF6XF-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc0MDA4OA==", "bodyText": "Why is this commented out?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396740088", "createdAt": "2020-03-23T20:35:08Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/resources/model-in-image/sample_app/wlsdeploy/applications/sample_war/WEB-INF/web.xml", "diffHunk": "@@ -0,0 +1,34 @@\n+<web-app xmlns=\"http://java.sun.com/xml/ns/j2ee\" version=\"2.4\">\r\n+\r\n+<!--\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "originalPosition": 3}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODAxNjIx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379801621", "createdAt": "2020-03-23T20:35:27Z", "commit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDozNToyOFrOF6XGoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDozNToyOFrOF6XGoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc0MDI1Nw==", "bodyText": "Same.  Why is this commented out?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396740257", "createdAt": "2020-03-23T20:35:28Z", "author": {"login": "rjeberhard"}, "path": "integration-tests/src/test/resources/model-in-image/sample_app/wlsdeploy/applications/sample_war/WEB-INF/weblogic.xml", "diffHunk": "@@ -0,0 +1,30 @@\n+<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\r\n+\r\n+<weblogic-web-app xmlns=\"http://www.bea.com/ns/weblogic/90\">\r\n+  <session-descriptor>\r\n+     <timeout-secs>15</timeout-secs>\r\n+     <invalidation-interval-secs>60</invalidation-interval-secs>\r\n+  </session-descriptor>\r\n+  <jsp-descriptor>\r\n+    <page-check-seconds>1</page-check-seconds>\r\n+    <verbose>true</verbose>\r\n+  </jsp-descriptor>\r\n+    <!--\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODA0MzQz", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379804343", "createdAt": "2020-03-23T20:39:28Z", "commit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDozOToyOFrOF6XPDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDozOToyOFrOF6XPDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc0MjQxMg==", "bodyText": "I think there is a paradigm for relative links I saw earlier... Might be less cumbersome than this.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396742412", "createdAt": "2020-03-23T20:39:28Z", "author": {"login": "rjeberhard"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/model-in-image/README.md", "diffHunk": "@@ -0,0 +1,9 @@\n+# Model in Image Sample\n+\n+This sample demonstrates the WebLogic Kubernetes Operator \"Model in Image\" feature. Model in Image allows you to supply a Weblogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime. This eliminates the need to pre-create a WebLogic domain home prior to deploying your domain resource.\n+\n+# References\n+\n+- Sample doc: [source](../../../../../docs-source/content/samples/simple/domains/model-in-image/_index.md), [latest public](https://oracle.github.io/weblogic-kubernetes-operator/samples/simple/domains/model-in-image).", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODA3Mzkx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379807391", "createdAt": "2020-03-23T20:44:10Z", "commit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDo0NDoxMFrOF6XYmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDo0NDoxMFrOF6XYmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc0NDg1OQ==", "bodyText": "Conflicted... latest is good for a sample, but I'd really like to specify my versions more easily.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396744859", "createdAt": "2020-03-23T20:44:10Z", "author": {"login": "rjeberhard"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/model-in-image/build_download.sh", "diffHunk": "@@ -0,0 +1,81 @@\n+#!/bin/bash\n+# Copyright (c) 2019, 2020, Oracle Corporation and/or its affiliates. All rights reserved.\n+# Licensed under the Universal Permissive License v 1.0 as shown at http://oss.oracle.com/licenses/upl.\n+\n+#\n+# This script downloads the latest WebLogic Deploy Tool and WebLogic Image Tool \n+# to the WORKDIR directory.\n+#\n+# Expects the following env vars to already be set:\n+#    \n+#    WORKDIR \n+#      working directory for the sample with at least 10g of space\n+#\n+# Optional env vars:\n+#    http_proxy https_proxy\n+#      If running behind a proxy, then set as needed to allow curl access to github.com.\n+#\n+#    DOWNLOAD_WDT DOWNLOAD_WIT\n+#      Default to 'when-missing'. Set to 'always' to force download even\n+#      if local installer zip is missing.\n+#\n+#    WDT_INSTALLER_URL WIT_INSTALLER_URL\n+#      Defaults to 'https://github.com/oracle/weblogic-deploy-tooling/releases/latest'\n+#      and 'https://github.com/oracle/weblogic-image-tool/releases/latest' respectively.\n+#\n+#      To override an installer URL, export the URL env to point to a specific zip file, for example:\n+#      export WDT_INSTALLER_URL=https://github.com/oracle/weblogic-deploy-tooling/releases/download/weblogic-deploy-tooling-1.7.0/weblogic-deploy.zip\n+#\n+\n+set -o pipefail\n+\n+set -eu\n+\n+SCRIPTDIR=\"$( cd \"$(dirname \"$0\")\" > /dev/null 2>&1 ; pwd -P )\"\n+echo \"@@ Info: Running '$(basename \"$0\")'.\"\n+\n+cd ${WORKDIR}\n+\n+DOWNLOAD_WIT=${DOWNLOAD_WIT:-when-missing}\n+DOWNLOAD_WDT=${DOWNLOAD_WDT:-when-missing}\n+WDT_INSTALLER_URL=${WDT_INSTALLER_URL:-https://github.com/oracle/weblogic-deploy-tooling/releases/latest}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODA4NDU0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379808454", "createdAt": "2020-03-23T20:45:46Z", "commit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDo0NTo0NlrOF6XbtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDo0NTo0NlrOF6XbtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc0NTY1Mg==", "bodyText": "docker -> Docker", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396745652", "createdAt": "2020-03-23T20:45:46Z", "author": {"login": "rjeberhard"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/model-in-image/build_image_model.sh", "diffHunk": "@@ -0,0 +1,133 @@\n+#!/bin/bash\n+# Copyright (c) 2019, 2020, Oracle Corporation and/or its affiliates. All rights reserved.\n+# Licensed under the Universal Permissive License v 1.0 as shown at http://oss.oracle.com/licenses/upl.\n+\n+#  This script uses the WebLogic Image Tool to build a docker image with model in image", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODA4OTI4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379808928", "createdAt": "2020-03-23T20:46:31Z", "commit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDo0NjozMVrOF6XdDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDo0NjozMVrOF6XdDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc0NTk5OA==", "bodyText": "Add a comma, \"Optionally,\"", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396745998", "createdAt": "2020-03-23T20:46:31Z", "author": {"login": "rjeberhard"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/model-in-image/build_image_model.sh", "diffHunk": "@@ -0,0 +1,133 @@\n+#!/bin/bash\n+# Copyright (c) 2019, 2020, Oracle Corporation and/or its affiliates. All rights reserved.\n+# Licensed under the Universal Permissive License v 1.0 as shown at http://oss.oracle.com/licenses/upl.\n+\n+#  This script uses the WebLogic Image Tool to build a docker image with model in image\n+#  artifacts. By default, it uses the base image obtained earlier with build_image_base.sh,\n+#  and it gets model files from the WORKDIR/models directory that was setup by the build_model.sh script.\n+#\n+#  The model image is named MODEL_IMAGE_NAME:MODEL_IMAGE_TAG.  See build_init_image.sh for\n+#  the defaults for these values.\n+#  \n+#  Assumptions:\n+#\n+#    This script should be called by build.sh.  \n+#    The WebLogic Image Tool is downloaded to WORKDIR/weblogic-image-tool.zip (see ./build_download.sh).\n+#    The WebLogic Deploy Tool is downloaded to WORKDIR/weblogic-deploy-tooling.zip (see ./build_download.sh).\n+#    Model files have been staged in the \"WORKDIR/models\" directory (see ./build_model.sh) or\n+#    MODEL_DIR has been explicitly set to point to a different location.\n+#\n+#  Required environment variables:\n+#\n+#    WORKDIR - working directory for the sample with at least 10g of space\n+#\n+#  Optional environment variables:\n+#\n+#    MODEL_DIR:\n+#      Location of the model .zip, .properties, and .yaml files\n+#      that will be copied in to the image.  Default is 'WORKDIR/models'\n+#      which is populated by the ./build_model.sh script.\n+#\n+#    MODEL_YAML_FILES, MODEL_ARCHIVE_FILES, MODEL_VARIABLES_FILES:\n+#      Optionally set one or more of these with comma-separated lists of file", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b01c3744a72e136023f270c573a225024a3a128"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fba221ce914a4203a00686a377dd8e9ba04b2ee", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2fba221ce914a4203a00686a377dd8e9ba04b2ee", "committedDate": "2020-03-23T20:48:12Z", "message": "first draft update of 'choosing a model' doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb00e30046ed7f08cd6847a6810ebe7cae7e3086", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fb00e30046ed7f08cd6847a6810ebe7cae7e3086", "committedDate": "2020-03-23T20:48:32Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89880074649148f0d832e0b96163913ef9baf5f9", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/89880074649148f0d832e0b96163913ef9baf5f9", "committedDate": "2020-03-23T20:52:20Z", "message": "first draft update of 'choosing a model' doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODE3NDI3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379817427", "createdAt": "2020-03-23T20:59:05Z", "commit": {"oid": "89880074649148f0d832e0b96163913ef9baf5f9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDo1OTowNlrOF6X3LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDo1OTowNlrOF6X3LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc1MjY4NQ==", "bodyText": "Why is this commented?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396752685", "createdAt": "2020-03-23T20:59:06Z", "author": {"login": "rjeberhard"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/model-in-image/sample_app/wlsdeploy/applications/sample_war/WEB-INF/web.xml", "diffHunk": "@@ -0,0 +1,34 @@\n+<web-app xmlns=\"http://java.sun.com/xml/ns/j2ee\" version=\"2.4\">\r\n+\r\n+<!--\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89880074649148f0d832e0b96163913ef9baf5f9"}, "originalPosition": 3}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODE3NjE0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379817614", "createdAt": "2020-03-23T20:59:22Z", "commit": {"oid": "89880074649148f0d832e0b96163913ef9baf5f9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDo1OToyMlrOF6X3yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDo1OToyMlrOF6X3yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc1Mjg0Mw==", "bodyText": "Why is this commented?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396752843", "createdAt": "2020-03-23T20:59:22Z", "author": {"login": "rjeberhard"}, "path": "kubernetes/samples/scripts/create-weblogic-domain/model-in-image/sample_app/wlsdeploy/applications/sample_war/WEB-INF/weblogic.xml", "diffHunk": "@@ -0,0 +1,30 @@\n+<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\r\n+\r\n+<weblogic-web-app xmlns=\"http://www.bea.com/ns/weblogic/90\">\r\n+  <session-descriptor>\r\n+     <timeout-secs>15</timeout-secs>\r\n+     <invalidation-interval-secs>60</invalidation-interval-secs>\r\n+  </session-descriptor>\r\n+  <jsp-descriptor>\r\n+    <page-check-seconds>1</page-check-seconds>\r\n+    <verbose>true</verbose>\r\n+  </jsp-descriptor>\r\n+    <!--\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89880074649148f0d832e0b96163913ef9baf5f9"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODIzMzEy", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379823312", "createdAt": "2020-03-23T21:07:53Z", "commit": {"oid": "89880074649148f0d832e0b96163913ef9baf5f9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTowNzo1NFrOF6YJ0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTowNzo1NFrOF6YJ0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc1NzQ1Ng==", "bodyText": "Don't use getAdminServerSpec().  This could be info.getDomain().getSpec().getRestartVersion();", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396757456", "createdAt": "2020-03-23T21:07:54Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/ConfigMapHelper.java", "diffHunk": "@@ -380,6 +401,27 @@ public NextAction apply(Packet packet) {\n         ScanCache.INSTANCE.registerScan(\n             info.getNamespace(), info.getDomainUid(), new Scan(wlsDomainConfig, new DateTime()));\n         packet.put(ProcessingConstants.DOMAIN_TOPOLOGY, wlsDomainConfig);\n+        if (miiDomainZipHash != null) {\n+          packet.put(ProcessingConstants.DOMAIN_HASH, miiDomainZipHash);\n+        }\n+        if (miiModelSecretsHash != null) {\n+          packet.put(ProcessingConstants.SECRETS_HASH, miiModelSecretsHash);\n+        }\n+        String domainRestartVersion = info.getDomain().getAdminServerSpec().getDomainRestartVersion();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89880074649148f0d832e0b96163913ef9baf5f9"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODI0MTg1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379824185", "createdAt": "2020-03-23T21:09:18Z", "commit": {"oid": "89880074649148f0d832e0b96163913ef9baf5f9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTowOToxOFrOF6YMlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTowOToxOFrOF6YMlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc1ODE2Nw==", "bodyText": "I don't understand this logic.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396758167", "createdAt": "2020-03-23T21:09:18Z", "author": {"login": "rjeberhard"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/ConfigMapHelper.java", "diffHunk": "@@ -388,9 +430,29 @@ public NextAction apply(Packet packet) {\n             new SitConfigMapContext(\n                 this, info.getDomainUid(), getOperatorNamespace(), info.getNamespace(), data);\n \n+        // Cannot short circuit here\n+        //\n+        if (updateDomainResult != null) {\n+          LOGGER.fine(\"ConfigMapHelper:updateDomainResult \" + updateDomainResult);\n+          if (updateDomainResult.equals(\"0\")) {\n+            LOGGER.fine(\"ConfigMapHelper apply: short circuit finished online update\");\n+            packet.setDynamicUpdate(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89880074649148f0d832e0b96163913ef9baf5f9"}, "originalPosition": 93}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7967bdeabeb5e6379e3b3b14603944f0cd5adacb", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7967bdeabeb5e6379e3b3b14603944f0cd5adacb", "committedDate": "2020-03-23T21:33:09Z", "message": "Remove updateDomainResult - dynamic update code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcad13b588791c61f93fbce6f9fada5f22dab504", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fcad13b588791c61f93fbce6f9fada5f22dab504", "committedDate": "2020-03-23T21:54:32Z", "message": "doc updated"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODU5ODY5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-379859869", "createdAt": "2020-03-23T22:11:22Z", "commit": {"oid": "89880074649148f0d832e0b96163913ef9baf5f9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMjoxMToyM1rOF6Z-uQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMjoxMToyM1rOF6Z-uQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4NzM4NQ==", "bodyText": "Tom: Add the usual warnings about exposing the console.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r396787385", "createdAt": "2020-03-23T22:11:23Z", "author": {"login": "tbarnes-us"}, "path": "docs-source/content/samples/simple/domains/model-in-image/_index.md", "diffHunk": "@@ -0,0 +1,520 @@\n+---\n+title: \"Model in image\"\n+date: 2019-02-23T17:32:31-05:00\n+weight: 4\n+description: \"Sample for supplying a WebLogic Deploy Tool (WDT) model that the operator automatically expands into a full domain home during runtime.\"\n+---\n+\n+### Contents\n+\n+  - [Introduction](#introduction)\n+  - [References](#references)\n+  - [Prerequisites for all domain types](#prerequisites-for-all-domain-types)\n+  - [Prerequisites for JRF domains](#prerequisites-for-jrf-domains)\n+    - [Set Up and Initialize an RCU Database](#set-up-and-initialize-an-rcu-database)\n+    - [Increase introspection job timeout](#increase-introspection-job-timeout)\n+    - [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets)\n+    - [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables)\n+  - [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image)\n+  - [Create and deploy your Kubernetes resources](#create-and-deploy-your-kubernetes-resources)\n+  - [Optionally test the sample application](#optionally-test-the-sample-application)\n+  - [Optionally access the WebLogic console](#optionally-access-the-weblogic-console)\n+  - [Cleanup](#cleanup)\n+\n+### Introduction\n+\n+This sample demonstrates:\n+\n+  - Using the WebLogic Image Tool to create a Docker image that contains a WebLogic install, a WebLogic Deploy Tool (WDT) install, a Java EE servlet application contained within a WDT archive, and a WebLogic domain that's defined using a WDT model file.\n+  - Modifying the WDT model that's embedded within the Docker image using a WDT model file that's supplied using a Kubernetes config map.\n+  - Defining a `domainHomeSourceType: FromModel` domain resource that references the WDT model image and the WDT config map.\n+  - Deploying the model image, domain resource, model config map, and associated secrets that define user names, passwords, and URL values for the model and its domain resource.\n+  - Deploying and accessing a Traefik load balancer that redirects HTTP protocol calls to its Java EE servlet application.\n+\n+Supported domain types:\n+\n+There are three types of domains supported by Model in Image: a standard `WLS` domain, an Oracle Fusion Middleware Infrastructure Java Required Files (`JRF`) domain, or a `RestrictedJRF` domain.\n+\n+The `JRF` domain path through the sample includes additional steps for deploying an infrastructure database and initializing the database using the Repository Creation Utility (RCU) tool. `JRF` domains may be  used by Oracle products that layer on top of WebLogic Server such as SOA and OSB. Similarly, `RestrictedJRF` domains may be used by Oracle layered products such as Oracle Communications products.\n+\n+### References\n+\n+To reference the relevant user documentation, see:\n+ - [Model in Image User Guide]({{< relref \"/userguide/managing-domains/model-in-image/_index.md\" >}}) user documentation\n+ - [Oracle WebLogic Server Deploy Tooling](https://github.com/oracle/weblogic-deploy-tooling)\n+ - [Oracle WebLogic Image Tool](https://github.com/oracle/weblogic-image-tool)\n+\n+\n+\n+### Prerequisites for all domain types\n+\n+1. The `JAVA_HOME` environment variable must be set and must reference a valid JDK 8 installation. (`JAVA_HOME` is used by the WebLogic Image Tool.)\n+\n+2. Set a source directory environment variable `SRCDIR` that references the parent of the operator source tree. For example:\n+\n+   ```\n+   mkdir ~/wlopsrc\n+   cd ~/wlopsrc\n+   git clone https://github.com/oracle/weblogic-kubernetes-operator.git\n+   export SRCDIR=$(pwd)/weblogic-kubernetes-operator\n+   ```\n+\n+   For additional information about obtaining the operator source, see the [Developer Guide Requirements](https://oracle.github.io/weblogic-kubernetes-operator/developerguide/requirements/).\n+\n+3. Create a sample directory environment variable `SAMPLEDIR` that references this sample's directory:\n+\n+   ```\n+   export SAMPLEDIR=${SRCDIR}/kubernetes/samples/scripts/create-weblogic-domain/model-in-image/\n+   ```\n+\n+4. Create an empty, temporary working directory with 10g of space, and store its location in the `WORKDIR` environment variable. For example:\n+\n+   ```\n+   cd <location of empty temporary directory with 10g of space>\n+   export WORKDIR=$(pwd)\n+   ```\n+\n+5. Deploy the operator and set up the operator to manage the namespace, `sample-domain1-ns`. Optionally, deploy a Traefik load balancer that manages the same namespace. For example, follow the same steps as the [Quick Start](https://oracle.github.io/weblogic-kubernetes-operator/quickstart/), up through the [Prepare for a domain]({{< relref \"/quickstart/prepare.md\" >}}) step.\n+\n+   Note that:\n+   - Deploying the Traefik load balancer is optional, but is a prerequisite for testing the web application that's deployed to WebLogic as part of this sample.\n+   - You can skip the Quick Start steps for obtaining a WebLogic image because you will be creating your own Docker image.\n+\n+\n+6. Choose the type of domain you're going to create: `WLS`, `JRF`, or `RestrictedJRF`, and set the environment variable, `WDT_DOMAIN_TYPE`, accordingly. The default is `WLS`.\n+\n+   ```\n+   export WDT_DOMAIN_TYPE=<one of WLS, JRF, or RestrictedJRF>\n+   ```\n+\n+7. Set up access to a base image for this sample that will be used as the base image for creating the final image. Do one of the following:\n+\n+   - __Option 1, download an existing WebLogic image.__\n+\n+     Set up access to this sample's base WebLogic image at the [Oracle Container Registry](http://container-registry.oracle.com):\n+\n+     a. Use a browser to access [Oracle Container Registry](http://container-registry.oracle.com).\n+\n+     b. Choose an image location:\n+       - For `JRF` and `RestrictedJRF` domains, select `Middleware`, then `fmw-infrastructure`.\n+       - For `WLS` domains, select `Middleware`, then `weblogic`.\n+\n+     c. Select Sign In and accept the license agreement.\n+\n+     d. Use your terminal to locally log in to Docker: `docker login container-registry.oracle.com`.\n+\n+     e. Later, when you run the sample, it will call `docker pull` for your base image based on the domain type.\n+       - For `JRF` and `RestrictedJRF`, it will pull `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4`.\n+       - For `WLS`, it will pull `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n+\n+   - __Option 2, create your own WebLogic base image.__\n+\n+     Alternatively, you can create your own base image and override the sample's default base image name and tag by exporting the `BASE_IMAGE_NAME` and `BASE_IMAGE_TAG` environment variables prior to running the sample scripts. If you want to create your own base image, see [Preparing a Base Image]({{< relref \"/userguide/managing-domains/domain-in-image/base-images/_index.md\" >}}).\n+\n+8. If you are using a `JRF` domain type, then it requires an RCU infrastructure database. See [Prerequisites for JRF Domains](#prerequisites-for-jrf-domains). You can do this step before or after you create your final image. If you're not using a `JRF` domain type, proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image).\n+\n+### Prerequisites for JRF domains\n+\n+> __NOTE__: This section is only required for demonstrating a `JRF` domain type. Skip this section and proceed to [Use the WebLogic Image Tool to create an image](#use-the-weblogic-image-tool-to-create-an-image) if your domain type is `WLS` or `RestrictedJRF`.\n+\n+A JRF domain requires an infrastructure database called an RCU database, requires initializing this database, and requires configuring your domain to access this database. All of these steps must occur before you first deploy your domain.\n+\n+Furthermore, if you want to have a restarted JRF domain access updates to the infrastructure database that the domain made at an earlier time, the restarted domain must be supplied a wallet file that was obtained from a previous run of the domain.\n+\n+The following steps demonstrate how to set up an infrastructure database that will work with this sample:\n+\n+  1. [Set up and initialize an RCU database](#set-up-and-initialize-an-rcu-database).\n+  2. [Increase introspection job timeout](#increase-introspection-job-timeout).\n+  3. [Set up RCU model attributes, domain resource attributes, and secrets](#set-up-rcu-model-attributes-domain-resource-attributes-and-secrets).\n+  4. [Reusing or sharing RCU tables](#reusing-or-sharing-rcu-tables).\n+\n+\n+\n+##### Set up and initialize an RCU database\n+\n+A JRF domain requires an infrastructure database and also requires initializing this database with a schema and a set of tables. The following example shows how to set up a sample RCU database and use the RCU tool to create the infrastructure schema for a JRF domain. The RCU database is set up with the following attributes:\n+\n+| Attribute | Value |\n+| --------- | ----- |\n+| database Kubernetes namespace | `default` |\n+| database Kubernetes pod | `oracle-db` |\n+| database image | `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` |\n+| database password | `Oradoc_db1` |\n+| infrastructure schema prefix | `FMW1` |\n+| infrastructure schema password | `Oradoc_db1` |\n+| database URL | `oracle-db.default.svc.cluster.local:1521/devpdb.k8s` |\n+\n+\n+1. Ensure you have access to the database image, and then deploy it:\n+\n+   - Use a browser to log in to `https://container-registry.oracle.com`, select `database->enterprise` and accept the license agreement.\n+\n+   - Get the database image:\n+     - In the local shell, `docker login container-registry.oracle.com`.\n+     - In the local shell, `docker pull container-registry.oracle.com/database/enterprise:12.2.0.1-slim`.\n+\n+\n+       {{% notice note %}} If a local Docker login and manual pull of `container-registry.oracle.com/database/enterprise:12.2.0.1-slim` is not sufficient (for example, if you are using a remote Kubernetes cluster), then uncomment the `imagePullSecrets` stanza in `$WORKDIR/k8s-db-slim.yaml` and create the image pull secret as follows:\n+\n+              ```\n+              kubectl create secret docker-registry regsecret \\\n+                --docker-server=container-registry.oracle.com \\\n+                --docker-username=your.email@some.com \\\n+                --docker-password=your-password \\\n+                --docker-email=your.email@some.com\n+              ```\n+       {{% /notice %}}\n+\n+\n+   - Use the sample script in `$SRCDIR/kubernetes/samples/scripts/create-oracle-db-service` to create an Oracle database running in the pod, `oracle-db`.\n+\n+      **NOTE**: If your database image access requires the `regsecret` image pull secret that you optionally created above, then pass `-s regsecret` to the `start-db-service.sh` command line.\n+\n+     ```\n+     cd $SRCDIR/kubernetes/samples/scripts/create-oracle-db-service\n+     start-db-service.sh\n+     ```\n+\n+     This script will deploy a database with the URL, `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`, and administration password, `Oradoc_db1`.\n+\n+     {{% notice warning %}} The Oracle database Docker images are supported only for non-production use. For more details, see My Oracle Support note: Oracle Support for Database Running on Docker (Doc ID 2216342.1) : All the data is gone when the database is restarted.\n+     {{% /notice %}}\n+\n+     **NOTE**: This step is based on the steps documented in [Run a Database](https://oracle.github.io/weblogic-kubernetes-operator/userguide/overview/database/).\n+\n+2. Use the sample script in `SRCDIR/kubernetes/samples/scripts/create-rcu-schema` to create the RCU schema with the schema prefix `FMW1`.\n+\n+   Note that this script assumes `Oradoc_db1` is the DBA password, `Oradoc_db1` is the schema password, and that the database URL is `oracle-db.default.svc.cluster.local:1521/devpdb.k8s`.\n+\n+   ```\n+   cd $SRCDIR/kubernetes/samples/scripts/create-rcu-schema\n+   ./create-rcu-schema.sh -s FMW1 -i container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.4\n+   ```\n+\n+   __NOTE__:  If you need to drop the repository, use this command:\n+\n+   ```\n+   drop-rcu-schema.sh -s FMW1\n+   ```\n+\n+\n+##### Increase introspection job timeout\n+\n+Because JRF domain home creation takes a considerable amount of time the first time it is created, and because Model in Image creates your domain home for you using the introspection job, you should increase the timeout for the introspection job. Use the `configuration.introspectorJobActiveDeadlineSeconds` in `k8s-domain.yaml.template` to override the default with a value of at least 300 seconds (the default is 120 seconds).  \n+\n+##### Set up RCU model attributes, domain resource attributes, and secrets\n+\n+To allow Model in Image to access the RCU database and OPSS wallet, it's necessary to set up an RCU access secret and an OPSS secret before deploying your domain. It's also necessary to define an `RCUDbInfo` stanza in your model. The sample already sets up all of these for you.  See:\n+\n+| Sample file | Description |\n+| --------- | ----- |\n+| `run_domain.sh` | Defines secret, `sample-domain1-opss-wallet-password-secret`, with `password=welcome1`. |\n+| `run_domain.sh` | Defines secret, `sample-domain1-rcu-access`, with appropriate values for attributes `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string`. |\n+| `model1.yaml.jrf` | Populates the `domainInfo -> RCUDbInfo` stanza `rcu_prefix`, `rcu_schema_password`, and `rcu_db_conn_string` attributes by referencing their locations in the `sample-domain1-rcu-access` secret. The `build.sh` script uses this model instead of `model.yaml.wls` when the source domain type is `JRF`. |\n+| `k8s-domain.yaml.template` | Ensures that the domain mounts the OPSS key secret by setting the domain resource `configuration.opss.walletPasswordSecret` attribute to `sample-domain1-opss-wallet-password-secret`, and ensures the domain mounts the RCU access secret, `sample-domain1-rcu-access`, for reference by WDT model macros by setting the domain resource `configuration.secrets` attribute. Use configuration.introspectorJobActiveDeadlineSeconds to increase the timeout value of the introspector job; see [Increase introspection job timeout](#increase-introspection-job-timeout). |\n+\n+ **NOTE**: This step is for information purposes only. Do not run the above sample files directly. The sample's main build and run scripts will run them for you.\n+\n+##### Reusing or sharing RCU tables\n+\n+Note that when you succesfully deploy your JRF domain resource for the first time, the introspector job will initialize the RCU tables for the domain using the `domainInfo -> RCUDbInfo` stanza in the WDT model plus the `configuration.opss.walletPasswordSecret` specified in the domain resource. The job will also create a new domain home. Finally, the operator will also capture an OPSS wallet file from the new domain's local directory and place this file in a new Kubernetes config map.\n+\n+There are scenarios when the domain needs to be re-created between updates such as WebLogic credentials are changed, security roles defined in the WDT model have been changed or you want to share the same RCU tables with different domains.  Under these scenarios, the operator needs the `walletPasswordSecret` as well as the OPSS wallet file, together with the exact information in `domainInfo -> RCUDbInfo` so that the domain can be re-created and access the same set of RCU tables.  Without the wallet file and wallet password, you will not be able to re-create a domain accessing the same set of RCU tables, therefore it is highly recommended to backup the wallet file.\n+\n+To recover a domain's RCU tables between domain restarts or to share an RCU schema between different domains, it is necessary to extract this wallet file from the config map and save the OPSS wallet password secret that was used for the original domain. The wallet password and wallet file are needed again when you recreate the domain or share the database with other domains.\n+\n+To save the wallet file:\n+\n+```\n+    opss_wallet_util.sh -s [-wf <name of the wallet file. Default ./ewallet.p12>]\n+```\n+\n+You should back up this file to a safe location that can be retrieved later.\n+\n+To reuse the wallet for subsequent redeployments or share the RCU tables between different domains:\n+\n+1. Store the wallet in a secret:\n+\n+```\n+    opss_wallet_util.sh -r [-wf <name of the wallet file. Default ./ewallet.p12>] [-ws <name of the secret. Default DOMAIN_UID-opss-walletfile-secret> ]\n+\n+```\n+\n+2. Modify the domain resource YAML file to provide the secret names:\n+\n+```\n+  configuration:\n+    opss:\n+      # Name of secret with walletPassword for extracting the wallet\n+      walletPasswordSecret: sample-domain1-opss-wallet-password-secret      \n+      # Name of secret with walletFile containing base64 encoded opss wallet\n+      walletFileSecret: sample-domain1-opss-walletfile-secret\n+\n+```\n+\n+See [Reusing an RCU database]({{< relref \"/userguide/managing-domains/model-in-image/reusing-rcu.md\" >}}) for instructions.\n+\n+### Use the WebLogic Image Tool to create an image\n+\n+Model in Image must contain a WebLogic install, a WebLogic Deploy Tool install, and your WDT model files. You can use the sample `./build.sh` script to build this image, which will perform the following steps for you:\n+\n+  - Uses `docker pull` to obtain a base image. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types) to set up access to the base image.)\n+  - Downloads the latest WebLogic Image Tool and WebLogic Deploy Tool to `WORKDIR`.\n+  - Creates and populates a staging directory `$WORKDIR/models` that contains your WDT model files and WDT application archive.\n+    - Builds  a simple servlet application in `$SAMPLEDIR/sample_app` into a WDT model application archive `$WORKDIR/models/archive1.zip`.\n+    - Copies sample model files from `$SAMPLEDIR/model-in-image` to `$WORKDIR/models`. This uses a model file that is appropriate to the domain type (for example, the `JRF` domain model includes database access configuration).\n+  - Uses the WebLogic Image Tool and the `$WORKDIR/models` staging directory to create a final image named `model-in-image:v1` that layers on the base image. Specifically, it runs the WebLogic Image Tool with its `update` option, which:\n+    - Builds the final image as a layer on the base image.\n+    - Puts a WDT install in image location, `/u01/wdt/weblogic-deploy`.\n+    - Copies the WDT model, properties, and application archive from `$WORDKIR/models` to image location, `/u01/wdt/models`.\n+\n+The script expects `JAVA_HOME`, `WDT_DOMAIN_TYPE`, and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/build.sh\n+  ```\n+\n+If you intend to use a remote Docker registry, you need to tag and push the image to the remote Docker registry.\n+\n+1.  Tag the image for the remote Docker registry, for example:\n+\n+```\n+docker tag <image-name>:<tag> <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>\n+```\n+\n+2.  Push the image to the remote Docker registry, for example:\n+\n+```\n+docker push <region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>:<tag>\n+```\n+\n+3. Create the pull secret for the remote Docker registry:\n+\n+```\n+ kubectl -n <domain namespace> create secret docker-registry <secret name> \\\n+     --docker-server=<region-key>.ocir.io/<tenancy-namespace>/<repo-name> \\\n+     --docker-username=your.email@some.com \\\n+     --docker-password=your-password \\\n+     --docker-email=your.email@some.com\n+\n+```\n+\n+4. Update the domain template file `$SAMPLEDIR/k8s-domain.yaml.template` to provide the `imagePullSecrets`:\n+\n+```\n+  imagePullSecrets:\n+  - name: <secret name>\n+\n+```\n+\n+5. Export the environment variables for the image name and tag using the same values in step 1:\n+\n+```\n+export MODEL_IMAGE_NAME=\"<region-key>.ocir.io/<tenancy-namespace>/<repo-name>/<image-name>\"\n+export MODEL_IMAGE_TAG=\"<tag>\"\n+```\n+\n+### Create and deploy your Kubernetes resources\n+\n+To deploy the sample operator domain and its required Kubernetes resources, use the sample script, `$SAMPLEDIR/run_domain.sh`, which will perform the following steps for you:\n+\n+  - Deletes the domain with a `DomainUID` of `domain1` in the namespace, `sample-domain1-ns`, if it already exists.\n+  - Creates a secret containing your WebLogic administrator user name and password.\n+  - Creates a secret containing your Model in Image runtime encryption password:\n+    - All model-in-image domains must supply a runtime encryption secret with a `password` value.\n+    - It is used to encrypt configuration that is passed around internally by the Operator.\n+    - The value must be kept private but can be arbitrary: you can optionally supply a different secret value every time you restart the domain.\n+  - Creates secrets containing your RCU access URL, credentials, and prefix (these are unused unless the domain type is `JRF`).\n+  - Creates a config map containing an additional WDT model properties file, `$SAMPLEDIR/model1.20.properties`.\n+  - Generates a domain resource YAML file, `$WORKDIR/k8s-domain.yaml`, using `$SAMPLEDIR/k8s-domain.yaml.template`.\n+  - Deploys `k8s-domain.yaml`.\n+  - Displays the status of the domain pods.\n+\n+The script expects `WDT_DOMAIN_TYPE` and `WORKDIR` to already be initialized. (See [Prerequisites for all domain types](#prerequisites-for-all-domain-types).)\n+\n+Run the script:\n+\n+  ```\n+  $SAMPLEDIR/run_domain.sh\n+  ```\n+\n+At the end, you will see the message `Getting pod status - ctrl-c when all is running and ready to exit`. Then you should see a WebLogic Administration Server and two Managed Server pods start. After all the pods are up, you can use `ctrl-c` to exit the build script.\n+\n+\n+### Optionally test the sample application\n+\n+1. Ensure Traefik has been installed and is servicing external port 30305, as per [Prerequisites for all domain types](#prerequisites-for-all-domain-types).\n+\n+2. Create a Kubernetes Ingress for the domain's WebLogic cluster in the domain's namespace by using the sample Helm chart:\n+\n+   For Helm 2.x:\n+\n+   ```\n+   cd $SRCDIR\n+   $ helm install kubernetes/samples/charts/ingress-per-domain \\\n+     --name sample-domain1-ingress \\\n+     --namespace sample-domain1-ns \\\n+     --set wlsDomain.domainUID=sample-domain1 \\\n+     --set traefik.hostname=sample-domain1.org\n+   ```\n+\n+   For Helm 3.x:\n+\n+   ```\n+   cd $SRCDIR\n+   helm install sample-domain1-ingress kubernetes/samples/charts/ingress-per-domain \\\n+    --namespace sample-domain1-ns \\\n+    --set wlsDomain.domainUID=sample-domain1 \\\n+    --set traefik.hostname=sample-domain1.org\n+   ```\n+\n+   This creates an Kubernetes Ingress that helps route HTTP traffic from the Traefik load balancer's external port 30305 to the WebLogic domain's `cluster-1` 8001 port. Note that the WDT config map in this sample changes the cluster's port from 9001 to 8001 (9001 is the original port configured using the WDT model defined within in the image).\n+\n+3. Send a web application request to the load balancer:\n+\n+   ```\n+   curl -H 'host: sample-domain1.org' http://$(hostname).$(dnsdomainname):30305/sample_war/index.jsp\n+   ```\n+\n+   You should see something like the following:\n+\n+   ```\n+   Hello World, you have reached server managed-server1\n+   ```\n+\n+   **Note**: If you're running on a remote Kubernetes cluster, then substitute `$(hostname).$(dnsdomainname)` with an external address suitable for contacting the cluster.\n+\n+4. Send a ReadyApp request to the load balancer (ReadyApp is a built-in WebLogic Server application):\n+\n+   ```\n+   curl -v -H 'host: sample-domain1.org' http://$(hostname).$(dnsdomainname):30305/weblogic/ready\n+   ```\n+\n+   You should see something like the following:\n+\n+\n+   ```\n+   * About to connect() to myhost.my.dns.domain.name port 30305 (#0)\n+   *   Trying 100.111.142.32...\n+   * Connected to myhost.my.dns.domain.name (100.111.142.32) port 30305 (#0)\n+   > GET /weblogic/ready HTTP/1.1\n+   > User-Agent: curl/7.29.0\n+   > Accept: */*\n+   > host: sample-domain1.org\n+   >\n+   < HTTP/1.1 200 OK\n+   < Content-Length: 0\n+   < Date: Mon, 09 Mar 2020 20:40:37 GMT\n+   < Vary: Accept-Encoding\n+   <\n+   * Connection #0 to host myhost.my.dns.domain.name left intact\n+   ```\n+\n+   **Note**: If you're running on a remote Kubernetes cluster, then substitute `$(hostname).$(dnsdomainname)` with an external address suitable for contacting the cluster.\n+\n+### Optionally access the WebLogic console", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89880074649148f0d832e0b96163913ef9baf5f9"}, "originalPosition": 417}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90de5ca4e8776724d76f719279e18af952281e3a", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/90de5ca4e8776724d76f719279e18af952281e3a", "committedDate": "2020-03-23T22:31:57Z", "message": "Doc update."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d59250308b0c502ac901eae564e357db349aeaa9", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d59250308b0c502ac901eae564e357db349aeaa9", "committedDate": "2020-03-24T14:06:12Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b9f67cbe454cc7e40b96eace6eb778b9314384a", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9b9f67cbe454cc7e40b96eace6eb778b9314384a", "committedDate": "2020-03-24T15:11:29Z", "message": "doc edits from Ryan"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e5b2dcb5e9f465838d2517a6d6d0227ff4db9fb", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2e5b2dcb5e9f465838d2517a6d6d0227ff4db9fb", "committedDate": "2020-03-24T15:12:23Z", "message": "clean up sample descriptor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79d85e037ba57344e1f53e6038c66bf8b99a59c3", "author": {"user": {"login": "vanajamukkara", "name": "Vanajakshi Mukkara"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/79d85e037ba57344e1f53e6038c66bf8b99a59c3", "committedDate": "2020-03-24T15:21:22Z", "message": "Remove mii section from samples domain-template.yaml (#1491)\n\n* undo changes in domain-template.yaml\r\n\r\n* adding mii config file\r\n\r\n* resolve comment merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88a5e69e8ae21f94232ea3bd12592ea17c36f7f0", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/88a5e69e8ae21f94232ea3bd12592ea17c36f7f0", "committedDate": "2020-03-24T15:51:19Z", "message": "Move introspectVersion to spec level only"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07a63758aae716d0ce2868676ddb7dc6ffe18c76", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/07a63758aae716d0ce2868676ddb7dc6ffe18c76", "committedDate": "2020-03-24T16:24:50Z", "message": "Update _index.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd8bad94b5633d925fb66a46537ce977be1187a6", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/cd8bad94b5633d925fb66a46537ce977be1187a6", "committedDate": "2020-03-24T16:25:52Z", "message": "Fix inadvertent change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6086c18bbe83dde3aa5723952e42c8f7bb3ff8ae", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6086c18bbe83dde3aa5723952e42c8f7bb3ff8ae", "committedDate": "2020-03-24T17:04:20Z", "message": "Update sample doc for introspectorJobActiveDeadlineSeconds and runtimeEncryptionSecret\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03cfb0b64df7a60893e19bb0a11fc80286351290", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/03cfb0b64df7a60893e19bb0a11fc80286351290", "committedDate": "2020-03-24T17:24:27Z", "message": "More sample doc update\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eae6a8f7792fa5a7709c8aa17f96347b395fde63", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/eae6a8f7792fa5a7709c8aa17f96347b395fde63", "committedDate": "2020-03-10T15:09:11Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bca3faa35908174b6ecd1b44c4490ae4558bc86", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7bca3faa35908174b6ecd1b44c4490ae4558bc86", "committedDate": "2020-03-10T15:16:31Z", "message": "Merge remote-tracking branch 'origin' into model-in-image-security"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94e50d5034a5652740da7d8dcacd13fd15b37dda", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/94e50d5034a5652740da7d8dcacd13fd15b37dda", "committedDate": "2020-03-10T16:16:42Z", "message": "minor README update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d96e2c9d85739b2b903fd65bccc4deeb60705f8", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3d96e2c9d85739b2b903fd65bccc4deeb60705f8", "committedDate": "2020-03-10T16:16:50Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f20bb4358ac6a6ccb184736494efe0776faac74a", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f20bb4358ac6a6ccb184736494efe0776faac74a", "committedDate": "2020-03-10T16:46:42Z", "message": "hugo FAQ link fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "868e59f7cac44d0e8044b0ca9fdd560ecc0564a0", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/868e59f7cac44d0e8044b0ca9fdd560ecc0564a0", "committedDate": "2020-03-10T17:29:09Z", "message": "refactor save wallet script 1."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80c723f617c027038c30c386143809724819e65b", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/80c723f617c027038c30c386143809724819e65b", "committedDate": "2020-03-10T17:33:53Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efb2e52edf199097c796454700cf1a0168ff1d26", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/efb2e52edf199097c796454700cf1a0168ff1d26", "committedDate": "2020-03-10T18:52:14Z", "message": "Merge remote-tracking branch 'origin' into model-in-image-security"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cb3d3e60925ac57a19e261d94fe840640efeab7", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5cb3d3e60925ac57a19e261d94fe840640efeab7", "committedDate": "2020-03-11T16:12:05Z", "message": "Model in image scripts fixes to work on MacOS (#1465)\n\n* Make scripts run on MacOS\r\n\r\n* Remove unnintentional adds"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd634702758455c61a0d270db8c180046f67263d", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/bd634702758455c61a0d270db8c180046f67263d", "committedDate": "2020-03-11T16:52:03Z", "message": "rename key for secrets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7eb8af52e3a7b51c93e9e18188085636466cd1c6", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7eb8af52e3a7b51c93e9e18188085636466cd1c6", "committedDate": "2020-03-11T17:08:10Z", "message": "MII Sample: remove vestigal nginx"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9334288370df68780bd1e0badfd7644f6b9155d5", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9334288370df68780bd1e0badfd7644f6b9155d5", "committedDate": "2020-03-11T17:32:28Z", "message": "Fix template and script error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bf56886250800a1cc848a7090d0d349200f3baf", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1bf56886250800a1cc848a7090d0d349200f3baf", "committedDate": "2020-03-11T17:54:58Z", "message": "Edit due to key changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4699fe637afec679c5f5ed965cc1fc18eaaab9d", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b4699fe637afec679c5f5ed965cc1fc18eaaab9d", "committedDate": "2020-03-11T18:07:06Z", "message": "placeholders for MII"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f39edaed58303086cee85b3162406b35b9ff74f5", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f39edaed58303086cee85b3162406b35b9ff74f5", "committedDate": "2020-03-11T18:08:07Z", "message": "Merge branch 'model-in-image' of\nhttps://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25d2b6148d1c46fd3b133c0e6e89f40efc1c96bb", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/25d2b6148d1c46fd3b133c0e6e89f40efc1c96bb", "committedDate": "2020-03-11T18:24:11Z", "message": "sample fodder for rosemary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdfcd300beb0273a7da46f25300d9bbd0d013bc3", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/bdfcd300beb0273a7da46f25300d9bbd0d013bc3", "committedDate": "2020-03-11T19:32:27Z", "message": "Add for debugging merged model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c5ab17ffa3e2e53546703aa169980d445bbb6ed", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6c5ab17ffa3e2e53546703aa169980d445bbb6ed", "committedDate": "2020-03-11T20:42:08Z", "message": "first pass on MII sample content"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad81cc3e2d33dbeb6466e36c0b07b44568e43155", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ad81cc3e2d33dbeb6466e36c0b07b44568e43155", "committedDate": "2020-03-11T20:59:14Z", "message": "name reconciliation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce6e505202959bab1e078472e3e5f80fc6359b0d", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ce6e505202959bab1e078472e3e5f80fc6359b0d", "committedDate": "2020-03-11T23:00:39Z", "message": "update from model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12de24541d951e47f7bd57f777f7d32f0f983064", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/12de24541d951e47f7bd57f777f7d32f0f983064", "committedDate": "2020-03-11T23:04:28Z", "message": "revert accidental changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc37556398e7da1a5aa1943992d474fa74397e14", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fc37556398e7da1a5aa1943992d474fa74397e14", "committedDate": "2020-03-11T23:22:06Z", "message": "mii sample doc edits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a0e3e3b9a2029c9af64c02cd47b0abcef05759e", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3a0e3e3b9a2029c9af64c02cd47b0abcef05759e", "committedDate": "2020-03-12T11:59:58Z", "message": "second round edits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4a355279f145d0a520807c4ec5095937efcf68c", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e4a355279f145d0a520807c4ec5095937efcf68c", "committedDate": "2020-03-12T13:05:14Z", "message": "Update script"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fba4e2731774002650dd936dec9986c787106eda", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fba4e2731774002650dd936dec9986c787106eda", "committedDate": "2020-03-12T19:03:09Z", "message": "Add validation, volume and volume mount for runtime encryption secret\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c2bfa85bc72fae074d5ad71bb4ca1c72bd0b8d9", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0c2bfa85bc72fae074d5ad71bb4ca1c72bd0b8d9", "committedDate": "2020-03-12T19:04:16Z", "message": "Merge branch 'model-in-image-security' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image-security"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d775cc40b97ae95033fd45aacbec0dc5358ad7e4", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d775cc40b97ae95033fd45aacbec0dc5358ad7e4", "committedDate": "2020-03-12T19:05:58Z", "message": "Merge remote-tracking branch 'origin' into owls-80253-secret-validation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96890a18f70945c25bb3609366ce2a5bd3b21c5f", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/96890a18f70945c25bb3609366ce2a5bd3b21c5f", "committedDate": "2020-03-12T21:15:07Z", "message": "Merge branch 'model-in-image-security' into owls-80253-secret-validation\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>\n\nConflicts:\n\tkubernetes/crd/domain-crd.yaml\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/README.md\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/k8s-domain.yaml.template\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/model1.10.properties\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/run_domain.sh\n\toperator/src/main/java/oracle/kubernetes/operator/helpers/JobStepContext.java\n\toperator/src/main/java/oracle/kubernetes/weblogic/domain/model/Domain.java\n\toperator/src/main/java/oracle/kubernetes/weblogic/domain/model/Model.java\n\toperator/src/main/resources/scripts/startServer.sh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33a6ec97cce2fbcb7ce5abf295dee72e4abbb75e", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/33a6ec97cce2fbcb7ce5abf295dee72e4abbb75e", "committedDate": "2020-03-12T22:17:13Z", "message": "Fix an issue after merge with model-in-image-security\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a40edee4201a17de9c8114bac7c3bee37ab66b3c", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a40edee4201a17de9c8114bac7c3bee37ab66b3c", "committedDate": "2020-03-12T23:54:08Z", "message": "Add part of the changes for runtime secret validation and mount\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7143974f715c01e8c343a0cdaf9b0d33afbfd5bf", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7143974f715c01e8c343a0cdaf9b0d33afbfd5bf", "committedDate": "2020-03-13T00:29:31Z", "message": "Second part of the change\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8842d00ccf3f636d780d03780c9073380cbd1af3", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8842d00ccf3f636d780d03780c9073380cbd1af3", "committedDate": "2020-03-13T00:37:22Z", "message": "Change the sample\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c743072c3d513dffa6505bc11334c7179ec39f38", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c743072c3d513dffa6505bc11334c7179ec39f38", "committedDate": "2020-03-13T00:52:38Z", "message": "Modify the sample to use the right secret\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9cc1ca8ed9829ada33b3c3eadde7385a2125217", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a9cc1ca8ed9829ada33b3c3eadde7385a2125217", "committedDate": "2020-03-13T01:07:11Z", "message": "Fix a typo\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ef8312068a86fe1372cfc2678de86401061290a", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3ef8312068a86fe1372cfc2678de86401061290a", "committedDate": "2020-03-13T01:21:50Z", "message": "Minor fix\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dc738329a8d1db51e6fd2acd3d3710ffcbbdaff", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6dc738329a8d1db51e6fd2acd3d3710ffcbbdaff", "committedDate": "2020-03-13T01:25:49Z", "message": "Fix generated files\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f950f052fffe8b1c5b12ae2f40957f042221f248", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f950f052fffe8b1c5b12ae2f40957f042221f248", "committedDate": "2020-03-13T19:19:27Z", "message": "pickup changes from model-in-image-security"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e717d81b9411a230232482e9f5c8513180f62aa", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8e717d81b9411a230232482e9f5c8513180f62aa", "committedDate": "2020-03-13T19:23:48Z", "message": "Fixing error message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "362936223cdc0cab435cf98f87996ea7cea320b6", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/362936223cdc0cab435cf98f87996ea7cea320b6", "committedDate": "2020-03-13T19:39:08Z", "message": "Fix TBD"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d08be4160e1d4ca3c6493b44c1f9ee71ff3905f2", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d08be4160e1d4ca3c6493b44c1f9ee71ff3905f2", "committedDate": "2020-03-13T19:46:49Z", "message": "remove comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cf6e43a0fa6b6aac30e1228a2b1fc49376e9a7a", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0cf6e43a0fa6b6aac30e1228a2b1fc49376e9a7a", "committedDate": "2020-03-13T19:50:02Z", "message": "mark README.md as outdated (will remove later)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc81bc984bf7cb24fb6f9c3df0451dd2639c3016", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/dc81bc984bf7cb24fb6f9c3df0451dd2639c3016", "committedDate": "2020-03-13T19:50:17Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1cfb7017a659a1f68c96fc857ef91b6d3620be5", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a1cfb7017a659a1f68c96fc857ef91b6d3620be5", "committedDate": "2020-03-13T20:05:25Z", "message": "final round edits on sample doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f2ecc4778e4049a86e2e2ab97a4b15bcdb1cb66", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8f2ecc4778e4049a86e2e2ab97a4b15bcdb1cb66", "committedDate": "2020-03-13T20:09:06Z", "message": "Add validation checks for OPSS secret\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bcd010604d578a0f5745dd463b9891dc633493c", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7bcd010604d578a0f5745dd463b9891dc633493c", "committedDate": "2020-03-13T22:18:22Z", "message": "Merge remote-tracking branch 'origin/model-in-image' into owls-80253-secret-valid-mount\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>\n\nConflicts:\n\tkubernetes/crd/domain-crd.yaml\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/README.md\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/k8s-domain.yaml.template\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/model1.10.properties\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/run_domain.sh\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/save_ewallet.sh\n\toperator/src/main/java/oracle/kubernetes/operator/helpers/JobStepContext.java\n\toperator/src/main/java/oracle/kubernetes/operator/helpers/StepContextConstants.java\n\toperator/src/main/java/oracle/kubernetes/operator/logging/MessageKeys.java\n\toperator/src/main/java/oracle/kubernetes/weblogic/domain/DomainConfigurator.java\n\toperator/src/main/java/oracle/kubernetes/weblogic/domain/model/Domain.java\n\toperator/src/main/java/oracle/kubernetes/weblogic/domain/model/DomainCommonConfigurator.java\n\toperator/src/main/java/oracle/kubernetes/weblogic/domain/model/Model.java\n\toperator/src/main/resources/Operator.properties\n\toperator/src/main/resources/scripts/introspectDomain.sh\n\toperator/src/main/resources/scripts/modelInImage.sh\n\toperator/src/main/resources/scripts/startServer.sh\n\toperator/src/test/java/oracle/kubernetes/weblogic/domain/model/DomainValidationTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d511984a04d171d0e1fa608b43d217e9c00bf660", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d511984a04d171d0e1fa608b43d217e9c00bf660", "committedDate": "2020-03-15T20:40:29Z", "message": "Minor javadoc fix\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a684fb89742b0847e1140bf29fd1a2334e06c65f", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a684fb89742b0847e1140bf29fd1a2334e06c65f", "committedDate": "2020-03-16T13:36:43Z", "message": "refacto startServer.sh"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "158aee8ad6c6bd85780e6506cb0d0ab79796fe89", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/158aee8ad6c6bd85780e6506cb0d0ab79796fe89", "committedDate": "2020-03-16T14:21:11Z", "message": "update script and doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3da91c47e7c050f3bb603fec49f976cd96c0e542", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3da91c47e7c050f3bb603fec49f976cd96c0e542", "committedDate": "2020-03-16T15:40:22Z", "message": "More javadoc changes\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a87ecb3a36cef20234c5919af2cbccfb7117c35c", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a87ecb3a36cef20234c5919af2cbccfb7117c35c", "committedDate": "2020-03-16T15:42:19Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a8f4312160f1fc4224c40ee06a57b8eb23ddd00", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0a8f4312160f1fc4224c40ee06a57b8eb23ddd00", "committedDate": "2020-03-16T15:52:00Z", "message": "MII sample doc update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01413620bb1645cd0e6a2ecae06bb54da6684c5c", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/01413620bb1645cd0e6a2ecae06bb54da6684c5c", "committedDate": "2020-03-16T15:52:18Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f08f23931eb2197ea641af11f9d2d81d06e2e75", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9f08f23931eb2197ea641af11f9d2d81d06e2e75", "committedDate": "2020-03-16T16:44:31Z", "message": "Fix a merge issue that caused duplicate configuration\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90a22c316db347c01feef74220f7a4c7eef42d8d", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/90a22c316db347c01feef74220f7a4c7eef42d8d", "committedDate": "2020-03-16T16:46:31Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5521af7dac2b19f7b57f5ffd7a815f9944732d18", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5521af7dac2b19f7b57f5ffd7a815f9944732d18", "committedDate": "2020-03-16T17:23:09Z", "message": "MII sample script update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "663273f47103576537d3897f48654ed9fbdd4976", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/663273f47103576537d3897f48654ed9fbdd4976", "committedDate": "2020-03-16T17:23:20Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be9bfd06356a29a54eec419a518b4227a5ef6c25", "author": {"user": {"login": "tbarnes-us", "name": "Tom Barnes"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/be9bfd06356a29a54eec419a518b4227a5ef6c25", "committedDate": "2020-03-16T18:04:57Z", "message": "MII sample script update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b614f510b69abedae394ea3d798b5eff49678260", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b614f510b69abedae394ea3d798b5eff49678260", "committedDate": "2020-03-16T18:14:14Z", "message": "update doc for saving wallet and remote docker registry instructions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afc8237619c260379570cd0f13ba1aeacb39c08f", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/afc8237619c260379570cd0f13ba1aeacb39c08f", "committedDate": "2020-03-16T19:09:34Z", "message": "update doc for script name changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccd0e8265d27685a4811fc43c852921c9d7bc232", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ccd0e8265d27685a4811fc43c852921c9d7bc232", "committedDate": "2020-03-16T20:17:05Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7723a2bc9657b642359eb430b454a5f7add06146", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7723a2bc9657b642359eb430b454a5f7add06146", "committedDate": "2020-03-16T20:36:26Z", "message": "Add unit test cases\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dba57283287cc0a3d6223c3aa83ab0cc7dc1c42f", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/dba57283287cc0a3d6223c3aa83ab0cc7dc1c42f", "committedDate": "2020-03-16T21:13:14Z", "message": "Shorten suffix names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "accdc77f5798cb7910d0f630fa6dfb3d46cced83", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/accdc77f5798cb7910d0f630fa6dfb3d46cced83", "committedDate": "2020-03-16T21:18:09Z", "message": "Merge remote-tracking branch 'origin/model-in-image' into owls-80353-opss-secret-valid\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>\n\nConflicts:\n\tdocs/domains/Domain.json\n\tdocs/domains/Domain.md\n\tdocs/domains/index.html\n\tkubernetes/crd/domain-crd.yaml\n\tkubernetes/samples/scripts/create-weblogic-domain/model-in-image/run_domain.sh\n\toperator/src/main/java/oracle/kubernetes/operator/helpers/JobStepContext.java\n\toperator/src/main/java/oracle/kubernetes/operator/helpers/SecretType.java\n\toperator/src/main/java/oracle/kubernetes/operator/logging/MessageKeys.java\n\toperator/src/main/java/oracle/kubernetes/weblogic/domain/DomainConfigurator.java\n\toperator/src/main/java/oracle/kubernetes/weblogic/domain/model/Domain.java\n\toperator/src/main/java/oracle/kubernetes/weblogic/domain/model/DomainCommonConfigurator.java\n\toperator/src/main/java/oracle/kubernetes/weblogic/domain/model/DomainValidationMessages.java\n\toperator/src/main/java/oracle/kubernetes/weblogic/domain/model/Model.java\n\toperator/src/main/resources/Operator.properties\n\toperator/src/main/resources/scripts/startServer.sh\n\toperator/src/test/java/oracle/kubernetes/weblogic/domain/model/DomainValidationTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c416e143779352a2f833e694bb4429d781e9ed77", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c416e143779352a2f833e694bb4429d781e9ed77", "committedDate": "2020-03-16T21:30:04Z", "message": "Fix merge issues\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "105f114f91f56119e91d8239ac62a3bdd1940db9", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/105f114f91f56119e91d8239ac62a3bdd1940db9", "committedDate": "2020-03-16T21:38:55Z", "message": "Fix duplicate lines\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd660e80d41615a2d29568284ba1873de2a28759", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fd660e80d41615a2d29568284ba1873de2a28759", "committedDate": "2020-03-16T21:40:50Z", "message": "Fix generated files\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7f78aa70622797ffc2b6f936c8af3b4583c1cc3", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d7f78aa70622797ffc2b6f936c8af3b4583c1cc3", "committedDate": "2020-03-16T21:46:40Z", "message": "Merge remote-tracking branch 'origin/model-in-image' into owls-80353-opss-secret-valid"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa32b4fbefb5cb8573460a58480037e5ab7bd02d", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/aa32b4fbefb5cb8573460a58480037e5ab7bd02d", "committedDate": "2020-03-16T22:55:23Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f84626bb34a870cd98eafbc0c2d5b98ed3339a2", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9f84626bb34a870cd98eafbc0c2d5b98ed3339a2", "committedDate": "2020-03-16T22:55:32Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e85adceadcaab4a7b9c776ebdf93c134a8aff788", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e85adceadcaab4a7b9c776ebdf93c134a8aff788", "committedDate": "2020-03-16T23:47:45Z", "message": "refactor and remove prepending the domain name to configmap/secrets volumes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fa73acf8f56c9cbef43cb24b82e89744b1ee71b", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9fa73acf8f56c9cbef43cb24b82e89744b1ee71b", "committedDate": "2020-03-17T00:39:34Z", "message": "Merge remote-tracking branch 'origin/model-in-image' into owls-80353-opss-secret-valid"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04f7a877083a67979b120a7f200d074d39dc4f54", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/04f7a877083a67979b120a7f200d074d39dc4f54", "committedDate": "2020-03-17T04:26:16Z", "message": "add back the mounting for existing introspect configmap source for life-cycle update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fac7ea60344ac6b5ded8512e51e0615570aa9296", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fac7ea60344ac6b5ded8512e51e0615570aa9296", "committedDate": "2020-03-17T13:08:35Z", "message": "minor edit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22e41079723f4ed53bcf29b02ea9031173ad69f9", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/22e41079723f4ed53bcf29b02ea9031173ad69f9", "committedDate": "2020-03-17T13:46:17Z", "message": "Merge remote-tracking branch 'origin/model-in-image' into owls-80353-opss-secret-valid"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a8080c80cee1aa80f63a4e99d1fcb9ebf12e002", "author": {"user": {"login": "rosemarymarano", "name": "Rosemary Marano"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5a8080c80cee1aa80f63a4e99d1fcb9ebf12e002", "committedDate": "2020-03-17T15:41:04Z", "message": "additional edits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8170bb5a868d7beaacf7c75002810004b7200a8", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f8170bb5a868d7beaacf7c75002810004b7200a8", "committedDate": "2020-03-17T16:54:03Z", "message": "add traefix instructions for console"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d1ee013a027fcc0b1bd0f82f0cb46688b451395", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9d1ee013a027fcc0b1bd0f82f0cb46688b451395", "committedDate": "2020-03-17T19:16:17Z", "message": "Update doc for introspectorJobActiveDeadlineSeconds\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d623aeb1477ef91f41bdcd47a52fa47f6460105d", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d623aeb1477ef91f41bdcd47a52fa47f6460105d", "committedDate": "2020-03-17T19:28:30Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edb7f68c724fe3ef0f440d9dc3579c59b2db4602", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/edb7f68c724fe3ef0f440d9dc3579c59b2db4602", "committedDate": "2020-03-17T19:33:52Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65111e65854c485135132c4c06a5578ca1d4a579", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/65111e65854c485135132c4c06a5578ca1d4a579", "committedDate": "2020-03-17T21:19:02Z", "message": "update doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81c860658b3b7db64fa3b1e8eeca311588060956", "author": {"user": {"login": "anpanigr", "name": "Antaryami Panigrahi"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/81c860658b3b7db64fa3b1e8eeca311588060956", "committedDate": "2020-03-17T21:29:33Z", "message": "QA infra change to support new secret (#1474)\n\nCo-authored-by: ANTARYAMI.PANIGRAHI@ORACLE.COM <anpanigr@anpanigr-1.subnet1ad2phx.devweblogicphx.oraclevcn.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a809d0cf3ea50e32786988e4c974f62ca5cb0c01", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a809d0cf3ea50e32786988e4c974f62ca5cb0c01", "committedDate": "2020-03-17T21:57:52Z", "message": "update doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0c74a0784d280eb221cb586df8a9c55e0029fd4", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c0c74a0784d280eb221cb586df8a9c55e0029fd4", "committedDate": "2020-03-18T13:25:46Z", "message": "Fix a typo\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "656371faf0ed6c121979a3f1c8844edd4562f892", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/656371faf0ed6c121979a3f1c8844edd4562f892", "committedDate": "2020-03-18T13:27:30Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a4458c82bc89eee061a986dade32c7f828cb3e0", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0a4458c82bc89eee061a986dade32c7f828cb3e0", "committedDate": "2020-03-18T16:33:51Z", "message": "Use 12.2.1.4 everywhere possible (#1475)\n\n* Use 12.2.1.4 everywhere possible\r\n\r\n* Back to soasuite:12.2.1.3\r\n\r\n* Correct some 12.2.1.3 vs. 12.2.1.4 confusion\r\n\r\n* Correct word choice"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46d956270c8c7947f04f654ede7e0aa8b082a2e8", "author": {"user": {"login": "rjeberhard", "name": "Ryan Eberhard"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/46d956270c8c7947f04f654ede7e0aa8b082a2e8", "committedDate": "2020-03-18T18:16:05Z", "message": "Merge remote-tracking branch 'origin/develop' into model-in-image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe8550a34d987e4cb976118113dc7bf5705a2bf9", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fe8550a34d987e4cb976118113dc7bf5705a2bf9", "committedDate": "2020-03-18T18:37:23Z", "message": "fix to use different separator, '.' is a valid key name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MTg4NDQx", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-377188441", "createdAt": "2020-03-18T19:54:08Z", "commit": {"oid": "46d956270c8c7947f04f654ede7e0aa8b082a2e8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTo1NDowOVrOF4UnQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxOTo1NDowOVrOF4UnQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDYwMjMwNw==", "bodyText": "I may have missed something, but this comparison looks wrong to me.\n\nThe configMapDomainName is the string value of the hashcode of the image name in the domain spec. See line #83 in this class, line#400 and #410 in ConfigMapHelper, and the getModelInImageSpecHash() method in DomainPresenceInfo. But we are comparing it with the current image name itself.\nPotentially we may add more domain spec attributes into getModelInImageSpecHash() calculation. Once we do that, comparing a hashCode of a set of attributes with one attribute (or its hashcode) alone may not be correct.\n\nMaybe we want to use the hashcode of the current spec, instead the image name, to do the comparison(?).", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r394602307", "createdAt": "2020-03-18T19:54:09Z", "author": {"login": "doxiao"}, "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/JobHelper.java", "diffHunk": "@@ -66,13 +66,58 @@ private static boolean runIntrospector(Packet packet, DomainPresenceInfo info) {\n     LOGGER.fine(\"runIntrospector topology: \" + topology);\n     LOGGER.fine(\"runningServersCount: \" + runningServersCount(info));\n     LOGGER.fine(\"creatingServers: \" + creatingServers(info));\n-    return topology == null || isBringingUpNewDomain(info);\n+    return topology == null || isBringingUpNewDomain(info) || isModelInImageUpdate(packet, info);\n   }\n \n   private static boolean isBringingUpNewDomain(DomainPresenceInfo info) {\n     return runningServersCount(info) == 0 && creatingServers(info);\n   }\n \n+  private static boolean isModelInImageUpdate(Packet packet, DomainPresenceInfo info) {\n+    if (info.getDomain().getDomainHomeSourceType().equals(\"FromModel\")) {\n+\n+      String currentPodRestartVersion = info.getDomain().getAdminServerSpec().getDomainRestartVersion();\n+      String currentPodIntrospectVersion = info.getDomain().getAdminServerSpec().getDomainIntrospectVersion();\n+      String configMapRestartVersion = (String)packet.get(ProcessingConstants.DOMAIN_RESTART_VERSION);\n+      String configMapIntrospectVersion = (String)packet.get(ProcessingConstants.DOMAIN_INTROSPECT_VERSION);\n+      String configMapDomainName = (String)packet.get(ProcessingConstants.DOMAIN_INPUTS_HASH);\n+      String currentImageName = info.getDomain().getSpec().getImage();\n+\n+      LOGGER.finest(\"JobHelper.isModelInImageUpdate currentPodRestartVersion \" + currentPodRestartVersion);\n+      LOGGER.finest(\"JobHelper.isModelInImageUpdate currentPodIntrospectVersion \" + currentPodIntrospectVersion);\n+      LOGGER.finest(\"JobHelper.isModelInImageUpdate configMapRestartVersion \" + configMapRestartVersion);\n+      LOGGER.finest(\"JobHelper.isModelInImageUpdate configMapIntrospectVersion \" + configMapIntrospectVersion);\n+\n+      // If either one is set, check for differences and decide to run intropsect job\n+\n+      if (currentPodIntrospectVersion != null\n+            && !currentPodIntrospectVersion.equals(configMapIntrospectVersion)) {\n+        return true;\n+      }\n+\n+      if (currentPodRestartVersion != null\n+            && !currentPodRestartVersion.equals(configMapRestartVersion)) {\n+        return true;\n+      }\n+\n+      if (configMapRestartVersion != null\n+          && !configMapRestartVersion.equals(currentPodRestartVersion)) {\n+        return true;\n+      }\n+\n+      if (configMapIntrospectVersion != null\n+          && !configMapIntrospectVersion.equals(currentPodIntrospectVersion)) {\n+        return true;\n+      }\n+\n+      if (!currentImageName.equals(configMapDomainName)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46d956270c8c7947f04f654ede7e0aa8b082a2e8"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94d603a74812889e160c54de7a2c319c0fd77316", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/94d603a74812889e160c54de7a2c319c0fd77316", "committedDate": "2020-03-18T21:43:29Z", "message": "Refactor getModelInImageSpecHash and fix logic; correct minor script error in encryption_util"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b09d2f2a3e8d586a104d22af9dea11e5b3dee239", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b09d2f2a3e8d586a104d22af9dea11e5b3dee239", "committedDate": "2020-03-18T21:50:33Z", "message": "check in for now waiting for WDT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c4f9ce869248d37ac32766f6f7fb828dcae1d77", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8c4f9ce869248d37ac32766f6f7fb828dcae1d77", "committedDate": "2020-03-18T21:50:49Z", "message": "Make the runtime encryption secret volume source \"optional\"\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c489a66d68e1a760da358ae37797be87bb66b451", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c489a66d68e1a760da358ae37797be87bb66b451", "committedDate": "2020-03-18T21:52:08Z", "message": "Merge branch 'model-in-image' of https://github.com/oracle/weblogic-kubernetes-operator into model-in-image"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NzA5Mzg1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-377709385", "createdAt": "2020-03-19T13:19:32Z", "commit": {"oid": "c489a66d68e1a760da358ae37797be87bb66b451"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMzoxOTozMlrOF4t_Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMzoxOTozMlrOF4t_Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTAxNzk5MQ==", "bodyText": "Shall we change the default in the table to 12.2.1.4?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395017991", "createdAt": "2020-03-19T13:19:32Z", "author": {"login": "doxiao"}, "path": "docs-source/content/samples/simple/domains/fmw-domain/_index.md", "diffHunk": "@@ -115,7 +115,7 @@ The following parameters can be provided in the inputs file.\n | `domainUID` | Unique ID that will be used to identify this particular domain. Used as the name of the generated WebLogic domain as well as the name of the Kubernetes domain resource. This ID must be unique across all domains in a Kubernetes cluster. This ID cannot contain any character that is not valid in a Kubernetes service name. | `domain1` |\n | `exposeAdminNodePort` | Boolean indicating if the Administration Server is exposed outside of the Kubernetes cluster. | `false` |\n | `exposeAdminT3Channel` | Boolean indicating if the T3 administrative channel is exposed outside the Kubernetes cluster. | `false` |\n-| `image` | WebLogic Docker image. The operator requires FMW Infrastructure 12.2.1.3.0 with patch 29135930 applied. Refer to [FMW Infrastructure domains]({{< relref \"/userguide/managing-fmw-domains/fmw-infra/_index.md#obtaining-the-fmw-infrastructure-docker-image\" >}}) for details on how to obtain or create the image. | `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.3` |\n+| `image` | WebLogic Docker image. The operator requires FMW Infrastructure 12.2.1.3.0 with patch 29135930 applied or FMW Infrastructure 12.2.1.4.0. Refer to [FMW Infrastructure domains]({{< relref \"/userguide/managing-fmw-domains/fmw-infra/_index.md#obtaining-the-fmw-infrastructure-docker-image\" >}}) for details on how to obtain or create the image. | `container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.3` |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c489a66d68e1a760da358ae37797be87bb66b451"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NzI1MDg0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-377725084", "createdAt": "2020-03-19T13:37:37Z", "commit": {"oid": "c489a66d68e1a760da358ae37797be87bb66b451"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMzozNzozN1rOF4utOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxMzozNzozN1rOF4utOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTAyOTgxOA==", "bodyText": "This bullet becomes too crowded.  Using sub-bullets or a table may help.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395029818", "createdAt": "2020-03-19T13:37:37Z", "author": {"login": "doxiao"}, "path": "docs-source/content/userguide/managing-domains/_index.md", "diffHunk": "@@ -18,11 +18,12 @@ description: \"Important considerations for WebLogic domains in Kubernetes.\"\n \n Please be aware of the following important considerations for WebLogic domains running in Kubernetes:\n \n-* _Domain Home Location:_ The WebLogic domain home location is determined by the domain resource `domainHome` if set; otherwise, a default location is determined by the `domainHomeInImage` setting. If a domain resource `domainHome` field is not set\n-  and `domainHomeInImage` is `true` (the default), then the operator will\n+* _Domain Home Location:_ The WebLogic domain home location is determined by the domain resource `domainHome`, if specified; otherwise, a default location is determined by the `domainHomeSourceType` setting. If the domain resource `domainHome` field is not specified", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c489a66d68e1a760da358ae37797be87bb66b451"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NzQ3NTA2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-377747506", "createdAt": "2020-03-19T14:02:00Z", "commit": {"oid": "c489a66d68e1a760da358ae37797be87bb66b451"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNDowMjowMFrOF4vyiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNDowMjowMFrOF4vyiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA0NzU2MQ==", "bodyText": "What is the default for other domainHomeSourceType values? How does this sound - \"Defaults to false unless domainHomeSourceType is PersistentVolume\"?", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395047561", "createdAt": "2020-03-19T14:02:00Z", "author": {"login": "doxiao"}, "path": "docs-source/content/userguide/managing-domains/domain-resource.md", "diffHunk": "@@ -61,17 +61,17 @@ The domain resource `spec` section contains elements for configuring the domain\n Elements related to domain identification, Docker image, and domain home:\n \n * `domainUID`: The domain unique identifier. Must be unique across the Kubernetes cluster. Not required. Defaults to the value of `metadata.name`.\n-* `image`: The WebLogic Docker image. Required when `domainHomeInImage` is true; otherwise, defaults to `container-registry.oracle.com/middleware/weblogic:12.2.1.3`.\n+* `image`: The WebLogic Docker image. Required when `domainHomeSourceType` is `Image`; otherwise, defaults to `container-registry.oracle.com/middleware/weblogic:12.2.1.4`.\n * `imagePullPolicy`: The image pull policy for the WebLogic Docker image. Legal values are `Always`, `Never` and `IfNotPresent`. Defaults to `Always` if image ends in `:latest`; `IfNotPresent` otherwise.\n * `imagePullSecrets`: A list of image pull secrets for the WebLogic Docker image.\n-* `domainHome`: The folder for the WebLogic domain. Not required. Defaults to `/shared/domains/domains/domainUID` if `domainHomeInImage` is false. Defaults to `/u01/oracle/user_projects/domains/` if `domainHomeInImage` is true.\n-* `domainHomeInImage`: True if this domain's home is defined in the Docker image for the domain. Defaults to true.\n+* `domainHome`: The folder for the WebLogic domain. Not required. Defaults to `/shared/domains/domains/domainUID` if `domainHomeSourceType` is `PersistentVolume`. Defaults to `/u01/oracle/user_projects/domains/` if `domainHomeSourceType` is `Image`. Defaults to `/u01/domains/domainUID` if `domainHomeSourceType` is `FromModel`.\n+* `domainHomeSourceType`: The source for the domain home. Legal values are `Image`, `PersistentVolume`, and `FromModel`. Defaults to `Image`.\n \n Elements related to logging:\n \n * `includeServerOutInPodLog`: If true (the default), the server `.out` file will be included in the pod's stdout.\n-* `logHome`: The in-pod name of the directory in which to store the domain, Node Manager, server logs, and server `.out` files.\n-* `logHomeEnabled`: Specifies whether the log home folder is enabled. Not required. Defaults to true if `domainHomeInImage` is false. Defaults to false if `domainHomeInImage` is true.\n+* `logHome`: The in-pod name of the directory in which to store the domain, Node Manager, server logs, and server `.out` files. Defaults to `/shared/logs/<domainUID>`. Ignored if `logHomeEnabled` is `false`.\n+* `logHomeEnabled`: Specifies whether the log home folder is enabled. Not required. Defaults to true if `domainHomeSourceType` is `PersistentVolume`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c489a66d68e1a760da358ae37797be87bb66b451"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3NzU2MTQ3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-377756147", "createdAt": "2020-03-19T14:11:30Z", "commit": {"oid": "c489a66d68e1a760da358ae37797be87bb66b451"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNDoxMTozMFrOF4wM7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxNDoxMTozMFrOF4wM7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA1NDMxOQ==", "bodyText": "I am wondering if the  soa-suite doc also needs to be updated to use fmw-infrastructure:12.2.1.4 image now.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395054319", "createdAt": "2020-03-19T14:11:30Z", "author": {"login": "doxiao"}, "path": "docs-source/content/userguide/managing-fmw-domains/soa-suite/_index.md", "diffHunk": "@@ -110,8 +110,8 @@ For the Fusion Middleware Infrastructure image, you must install the [required p\n \n \n   ```bash\n-    $ docker pull container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.3-200109\n-    $ docker tag container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.3-200109  oracle/fmw-infrastructure:12.2.1.3\n+    $ docker pull container-registry.oracle.com/middleware/fmw-infrastructure:12.2.1.3-200316", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c489a66d68e1a760da358ae37797be87bb66b451"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a87ee762d639570e75e225ff41023fecafc935a9", "author": {"user": {"login": "doxiao", "name": "Dongbo Xiao"}}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a87ee762d639570e75e225ff41023fecafc935a9", "committedDate": "2020-03-19T18:06:24Z", "message": "Minor doc changes for introspectorJobActiveDeadlineSeconds\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MDA3MzA2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-378007306", "createdAt": "2020-03-19T18:56:30Z", "commit": {"oid": "a87ee762d639570e75e225ff41023fecafc935a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxODo1NjozMFrOF48N8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxODo1NjozMFrOF48N8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTI1MTE4NA==", "bodyText": "Shall we use a prefix to control the OPSS part of the configuration? The prefix can be determined by the value of domainHomeSourceType and domainType, I assume.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395251184", "createdAt": "2020-03-19T18:56:30Z", "author": {"login": "doxiao"}, "path": "kubernetes/samples/scripts/common/domain-template.yaml", "diffHunk": "@@ -98,3 +98,29 @@ spec:\n   # The number of managed servers to start for unlisted clusters\n   # replicas: 1\n \n+  %MII_PREFIX%configuration:\n+    # secrets: [ %DOMAIN_UID%-rcu-access ]\n+\n+  %MII_PREFIX%  model:\n+      #\n+      # Optional configmap for additional models and variable files\n+      #\n+  %MII_CONFIG_MAP_PREFIX%    configMap: %MII_CONFIG_MAP%\n+\n+      #\n+      # wdt domain type for model in image case\n+      # Valid WDT_DOMAIN_TYPE_VALUES are 'WLS', 'JRF', and 'RestrictedJRF'\n+      #\n+  %MII_PREFIX%    domainType: %WDT_DOMAIN_TYPE%\n+  %MII_PREFIX%    runtimeEncryptionSecret: %WEBLOGIC_CREDENTIALS_SECRET_NAME%\n+\n+    #opss:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a87ee762d639570e75e225ff41023fecafc935a9"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fed14ab2742d0c35d5028ffdb64a93cfbcd9c87", "author": {"user": null}, "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5fed14ab2742d0c35d5028ffdb64a93cfbcd9c87", "committedDate": "2020-03-19T19:06:50Z", "message": "Add extra line between merging properties file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MDIzMzk4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#pullrequestreview-378023398", "createdAt": "2020-03-19T19:20:16Z", "commit": {"oid": "a87ee762d639570e75e225ff41023fecafc935a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxOToyMDoxNlrOF49AUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQxOToyMDoxNlrOF49AUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTI2NDA4Mg==", "bodyText": "This util script is only used in the domain home on pv or in image samples. Do we support the input file for those use case to have domainHomeSourceType? This line here indicates that the answer is yes, and if this input is specified, we only honor it when the value is 'FromModel', and we ignore the input setting otherwise and honor the old attribute domainHomeInImage. This can cause confusion; the customer may not have other things configured for 'FromModel' using the non-MII samples. We should not allow this in my opinion.", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1478#discussion_r395264082", "createdAt": "2020-03-19T19:20:16Z", "author": {"login": "doxiao"}, "path": "kubernetes/samples/scripts/common/utility.sh", "diffHunk": "@@ -439,13 +452,22 @@ function createFiles {\n     sed -i -e \"s:%DOMAIN_ROOT_DIR%:${domainPVMountPath}:g\" ${deleteJobOutput}\n   fi\n \n-  if [ \"${domainHomeInImage}\" == \"true\" ]; then\n+  if [ \"${domainHomeSourceType}\" == \"FromModel\" ]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a87ee762d639570e75e225ff41023fecafc935a9"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4863, "cost": 1, "resetAt": "2021-11-01T16:19:10Z"}}}