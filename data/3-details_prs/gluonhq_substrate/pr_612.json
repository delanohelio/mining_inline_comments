{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMjcwNjQx", "number": 612, "title": "Use official Android Gradle plugin", "bodyText": "This PR:\n\n\nChanges package phase, so that it generates Gradle Android project using official plugin in /target/client/aarch64-android/gvm/android_project and delegates apk building/signing/deployment to it. This results in much faster package/install phases, enables usage of android specific libraries and enables importing in Android Studio.\n\n\nSets ARM64 backend for Android building as default which should significantly speed up compilation, and use less peak memory.", "createdAt": "2020-05-23T12:52:34Z", "url": "https://github.com/gluonhq/substrate/pull/612", "merged": true, "mergeCommit": {"oid": "8fa43fd40397c3c422ef6f3a42a4ce40477544ba"}, "closed": true, "closedAt": "2020-05-26T18:45:11Z", "author": {"login": "lazar-mitrovic"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckIUscAFqTQxNzI3OTI1OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABclJJ5RABqjMzNzQ4ODMzNjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3Mjc5MjU4", "url": "https://github.com/gluonhq/substrate/pull/612#pullrequestreview-417279258", "createdAt": "2020-05-23T13:33:32Z", "commit": {"oid": "0817893584bb76d3ca6c3bf2e1f50273cb8ee079"}, "state": "COMMENTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxMzozMzozMlrOGZpcyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxNTowMzo0OFrOGZp3Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU0NjY5Nw==", "bodyText": "If projectLibsLocation doesn't exist, the folder is not created.\nThis fixes it:\nif (!Files.exists(projectLibsLocation)) {\n        Files.createDirectories(projectLibsLocation);\n}", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429546697", "createdAt": "2020-05-23T13:33:32Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -407,122 +300,27 @@ private void copyOtherDalvikClasses() throws IOException, InterruptedException {\n                 throw new IOException(\"Error processing dalvik classes from jar: \" + jar + \": \" + e.getMessage() + \", \" + Arrays.toString(e.getSuppressed()));\n             }\n         }\n-    }\n-\n-    private void copyAndroidManifest(Path androidPath) throws IOException {\n-        Path androidManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n-        if (!Files.exists(androidManifest)) {\n-            throw new IOException(\"File \" + androidManifest.toString() + \" not found\");\n-        }\n-        Path androidManifestPath = getApkPath().resolve(\"AndroidManifest.xml\");\n-        FileOps.copyFile(androidManifest, androidManifestPath);\n-    }\n-\n-    private void copyAssets(Path androidPath) throws IOException {\n-        for (String iconFolder : iconFolders) {\n-            Path iconPath = androidPath.resolve(\"res\").resolve(iconFolder).resolve(\"ic_launcher.png\");\n-            if (!Files.exists(iconPath)) {\n-                throw new IOException(\"File \" + iconPath.toString() + \" not found\");\n-            }\n-        }\n-        FileOps.copyDirectory(androidPath.resolve(Constants.ANDROID_RES_FOLDER),  getApkPath().resolve(Constants.ANDROID_RES_FOLDER));\n-    }\n-\n-    private int dx(Path buildToolsPath) throws IOException, InterruptedException {\n-        String dxCmd = buildToolsPath.resolve(\"dx\").toString();\n-\n-        ProcessRunner dx = new ProcessRunner(dxCmd, \"--dex\",\n-                \"--output=\" + getApkBinPath().resolve(\"classes.dex\"),\n-                getApkClassesPath().toString());\n-        return dx.runProcess(\"dx\");\n-    }\n-\n-    private int aapt(Path buildToolsPath, String unalignedApk, String androidJar) throws IOException, InterruptedException {\n-        int processResult = aaptPackage(buildToolsPath, unalignedApk, androidJar);\n-        if (processResult != 0) {\n-            return processResult;\n-        }\n-\n-        processResult = aaptAddDxClasses(buildToolsPath, unalignedApk);\n-        if (processResult != 0) {\n-            return processResult;\n-        }\n+        ProcessRunner createJar = new ProcessRunner(\n+                projectConfiguration.getGraalPath().resolve(\"bin\").resolve(\"jar\").toString(),\n+                \"-cvf\", \"../attach.jar\", \".\");\n \n-        return aaptAddNativeLibs(buildToolsPath, unalignedApk);\n+        createJar.runProcess(\"merge-dalvik-classes\", targetFolder.toFile());\n+        FileOps.deleteDirectory(targetFolder);\n     }\n \n-    private int aaptPackage(Path buildToolsPath, String unalignedApk, String androidJar) throws IOException, InterruptedException {\n-        String aaptCmd = buildToolsPath.resolve(\"aapt\").toString();\n-        Path androidManifestPath = getApkPath().resolve(\"AndroidManifest.xml\");\n-        Path apkResPath = getApkPath().resolve(Constants.ANDROID_RES_FOLDER);\n-        ProcessRunner aaptpackage = new ProcessRunner(aaptCmd, \"package\",\n-                \"-f\", \"-m\", \"-F\", unalignedApk,\n-                \"-M\", androidManifestPath.toString(),\n-                \"-S\", apkResPath.toString(),\n-                \"-I\", androidJar);\n-        return aaptpackage.runProcess(\"aaptPackage\");\n-    }\n-\n-    private int aaptAddDxClasses(Path buildToolsPath, String unalignedApk) throws IOException, InterruptedException {\n-        String aaptCmd = buildToolsPath.resolve(\"aapt\").toString();\n-        ProcessRunner aaptAddClass = new ProcessRunner(aaptCmd, \"add\", unalignedApk, \"classes.dex\");\n-        return aaptAddClass.runProcess(\"aaptAddDxClasses\", getApkBinPath().toFile());\n-    }\n-\n-    private int aaptAddNativeLibs(Path buildToolsPath, String unalignedApk) throws IOException, InterruptedException {\n-        String aaptCmd = buildToolsPath.resolve(\"aapt\").toString();\n-\n-        Path libPath = paths.getAppPath().resolve(getLinkOutputName());\n-        Path substrateLibPath = getApkLibArm64Path().resolve(\"libsubstrate.so\");\n-        Files.copy(libPath, substrateLibPath, StandardCopyOption.REPLACE_EXISTING);\n-\n-        List<String> aaptAddLibsArgs = new ArrayList<>(Arrays.asList(aaptCmd, \"add\", unalignedApk, \"lib/arm64-v8a/libsubstrate.so\"));\n-\n+    /*\n+     * Copies native libraries to android project\n+     */\n+    private void copySubstrateLibraries() throws IOException {\n+        Path projectLibsLocation = getAndroidProjectMainPath().resolve(\"jniLibs\").resolve(\"arm64-v8a\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0817893584bb76d3ca6c3bf2e1f50273cb8ee079"}, "originalPosition": 396}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU0ODI3Mw==", "bodyText": "If targetFolder doesn't exist, the folder is not created.\nThis fixes it:\nif (!Files.exists(targetFolder)) {\n        Files.createDirectories(targetFolder);\n}", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429548273", "createdAt": "2020-05-23T13:55:38Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -300,94 +263,24 @@ boolean useGraalVMJavaStaticLibraries() {\n         return false;\n     }\n \n-    private Path getApkPath() {\n-        return paths.getGvmPath().resolve(Constants.APK_PATH);\n-    }\n-\n-    private Path getApkBinPath() {\n-        return getApkPath().resolve(\"bin\");\n-    }\n-\n-    private Path getApkClassesPath() {\n-        return getApkPath().resolve(\"classes\");\n-    }\n-\n-    private Path getApkLibPath() {\n-        return getApkPath().resolve(\"lib\");\n-    }\n-\n-    private Path getApkLibArm64Path() {\n-        return getApkLibPath().resolve(\"arm64-v8a\");\n-    }\n-\n-    private Path getApkAndroidSourcePath() {\n-        return getApkPath().resolve(\"android-source\");\n+    Path getAndroidProjectPath() {\n+        return paths.getGvmPath().resolve(\"android_project\");\n     }\n \n-    private void ensureApkOutputDirectoriesExist() throws IOException {\n-        Files.createDirectories(getApkPath());\n-        Files.createDirectories(getApkBinPath());\n-        Files.createDirectories(getApkClassesPath());\n-        Files.createDirectories(getApkLibPath());\n-        Files.createDirectories(getApkLibArm64Path());\n-    }\n-\n-    private boolean processPrecompiledClasses(String androidJar) throws IOException, InterruptedException {\n-        String androidCodeLocation = \"/native/android/dalvik\";\n-\n-        copyOtherDalvikClasses();\n-        if (projectConfiguration.isUsePrecompiledCode()) {\n-            copyPrecompiledClasses(androidCodeLocation + DALVIK_PRECOMPILED_CLASSES);\n-        } else {\n-            return compileDalvikCode(androidCodeLocation + \"/source/\", androidJar) == 0;\n-        }\n-\n-        return true;\n-    }\n-\n-    private void copyPrecompiledClasses(String androidPrecompiled) throws IOException {\n-        for (String classFile : compiledGlueCodeActivity) {\n-            FileOps.copyResource(androidPrecompiled + DALVIK_ACTIVITY_PACKAGE + classFile + \".class\",\n-                    getApkClassesPath().resolve(DALVIK_ACTIVITY_PACKAGE + classFile + \".class\"));\n-        }\n-        for (String classFile : compiledGlueCodeJavaFX) {\n-            FileOps.copyResource(androidPrecompiled + DALVIK_JAVAFX_PACKAGE + classFile + \".class\",\n-                    getApkClassesPath().resolve(DALVIK_JAVAFX_PACKAGE + classFile + \".class\"));\n-        }\n-    }\n-\n-    private int compileDalvikCode(String androidSrc, String androidJar) throws IOException, InterruptedException {\n-        Files.createDirectories(getApkAndroidSourcePath());\n-\n-        for (String srcFile : sourceGlueCode) {\n-            FileOps.copyResource(androidSrc + srcFile + \".java\", getApkAndroidSourcePath().resolve(srcFile + \".java\"));\n-        }\n-\n-        List<String> sources = new ArrayList<>();\n-\n-        for (String srcFile : sourceGlueCode) {\n-            sources.add(getApkAndroidSourcePath().resolve(srcFile + \".java\").toString());\n-        }\n-\n-        ProcessRunner processRunner = new ProcessRunner(projectConfiguration.getGraalPath().resolve(\"bin\").resolve(\"javac\").toString(),\n-                \"-d\", getApkClassesPath().toString(),\n-                \"-source\", \"1.7\", \"-target\", \"1.7\",\n-                \"-cp\", getApkAndroidSourcePath().toString() + File.pathSeparator + getApkClassesPath().toString(),\n-                \"-bootclasspath\", androidJar);\n-        processRunner.addArgs(sources);\n-        return processRunner.runProcess(\"dalvikCompilation\");\n+    Path getAndroidProjectMainPath() {\n+        return getAndroidProjectPath().resolve(\"app\").resolve(\"src\").resolve(\"main\");\n     }\n \n     /**\n      * Walks through the jars in the classpath, excluding the JavaFX ones,\n      * and looks for META-INF/substrate/dalvik/*.class files.\n      *\n-     * The method will copy all the class files found into the target folder\n+     * The method will copy all the class files found into jar in the target folder\n      *\n      * @throws IOException\n      */\n     private void copyOtherDalvikClasses() throws IOException, InterruptedException {\n-        Path targetFolder = getApkClassesPath();\n+        Path targetFolder = getAndroidProjectPath().resolve(\"libs\").resolve(\"tmp\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0817893584bb76d3ca6c3bf2e1f50273cb8ee079"}, "originalPosition": 308}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU0ODY0Ng==", "bodyText": "Any reason to stick to an old distribution?", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429548646", "createdAt": "2020-05-23T14:00:41Z", "author": {"login": "jperedadnr"}, "path": "src/main/resources/native/android/android_project/gradle/wrapper/gradle-wrapper.properties", "diffHunk": "@@ -0,0 +1,5 @@\n+distributionBase=GRADLE_USER_HOME\n+distributionPath=wrapper/dists\n+zipStoreBase=GRADLE_USER_HOME\n+zipStorePath=wrapper/dists\n+distributionUrl=https\\://services.gradle.org/distributions/gradle-5.6.4-all.zip", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0817893584bb76d3ca6c3bf2e1f50273cb8ee079"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MDc0Ng==", "bodyText": "Once you have a path to the source, can't you use FileOps::copyDirectory?", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429550746", "createdAt": "2020-05-23T14:28:53Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/util/FileOps.java", "diffHunk": "@@ -141,6 +148,44 @@ public static Path copyResource(String resource, Path destination) throws IOExce\n         return copyStream(is, destination);\n     }\n \n+    /**\n+     * Copies directory from resources into destination path\n+     * @param source\n+     * @param target\n+     * @throws IOException\n+     */\n+    public static void copyDirectoryFromResources(String source, final Path target) throws IOException {\n+        // https://stackoverflow.com/a/24316335\n+        FileSystem fileSystem;\n+        try {\n+            URI resource = SubstrateDispatcher.class.getResource(\"\").toURI();\n+            fileSystem = FileSystems.newFileSystem(resource, Collections.<String, String>emptyMap());\n+        } catch(URISyntaxException e) {\n+            throw new IOException(e.toString());\n+        }\n+\n+        final Path jarPath = fileSystem.getPath(source);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0817893584bb76d3ca6c3bf2e1f50273cb8ee079"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MDk5OA==", "bodyText": "can you use a different line for each operation?", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429550998", "createdAt": "2020-05-23T14:31:05Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/util/FileOps.java", "diffHunk": "@@ -264,6 +309,28 @@ public static void copyDirectory(Path source, Path destination) throws IOExcepti\n             copyFile(source, destination);\n     }\n \n+    /**\n+     * Recursively list files with spectified extension from directory\n+     * @param directory directory to be searched\n+     * @param extension extension by which to filter files\n+     * @throws IOException if an exception happens when listing the content\n+     */\n+    public static List<String> listFilesWithExtensionInDirectory(Path directory, String extension) throws IOException {\n+        try (Stream<Path> walk = Files.walk(directory)) {\n+            return walk.filter(Files::isRegularFile).map(x -> x.toString())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0817893584bb76d3ca6c3bf2e1f50273cb8ee079"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MjEwOA==", "bodyText": "Maybe you can use projectConfiguration.isUseLLVM(). So far, backend is not set, but gives the possibility to change that if needed.", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429552108", "createdAt": "2020-05-23T14:45:26Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -221,22 +173,33 @@ public boolean runUntilEnd() throws IOException, InterruptedException {\n         return processResult == 0;\n     }\n \n+    boolean useLLVM = false;\n     @Override\n     List<String> getTargetSpecificAOTCompileFlags() throws IOException {\n-        return Arrays.asList(\"-H:CompilerBackend=\" + Constants.BACKEND_LLVM,\n+        ArrayList<String> flags = new ArrayList<String>(Arrays.asList(\n                 \"-H:-SpawnIsolates\",\n                 \"-Dsvm.targetArch=\" + projectConfiguration.getTargetTriplet().getArch(),\n                 \"-H:+UseOnlyWritableBootImageHeap\",\n                 \"-H:+UseCAPCache\",\n                 \"-H:CAPCacheDir=\" + getCapCacheDir().toAbsolutePath().toString(),\n-                \"-H:CustomLD=\" + ldlld.toAbsolutePath().toString());\n+                \"-H:+UseBionicC\"));\n+        if (useLLVM) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0817893584bb76d3ca6c3bf2e1f50273cb8ee079"}, "originalPosition": 188}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MjEzNg==", "bodyText": "Same here", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429552136", "createdAt": "2020-05-23T14:45:34Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -221,22 +173,33 @@ public boolean runUntilEnd() throws IOException, InterruptedException {\n         return processResult == 0;\n     }\n \n+    boolean useLLVM = false;\n     @Override\n     List<String> getTargetSpecificAOTCompileFlags() throws IOException {\n-        return Arrays.asList(\"-H:CompilerBackend=\" + Constants.BACKEND_LLVM,\n+        ArrayList<String> flags = new ArrayList<String>(Arrays.asList(\n                 \"-H:-SpawnIsolates\",\n                 \"-Dsvm.targetArch=\" + projectConfiguration.getTargetTriplet().getArch(),\n                 \"-H:+UseOnlyWritableBootImageHeap\",\n                 \"-H:+UseCAPCache\",\n                 \"-H:CAPCacheDir=\" + getCapCacheDir().toAbsolutePath().toString(),\n-                \"-H:CustomLD=\" + ldlld.toAbsolutePath().toString());\n+                \"-H:+UseBionicC\"));\n+        if (useLLVM) {\n+            flags.add(\"-H:CompilerBackend=\" + Constants.BACKEND_LLVM);\n+            flags.add(\"-H:CustomLD=\" + ldlld.toAbsolutePath().toString());\n+        }\n+        return flags;\n     }\n \n     @Override\n     List<String> getTargetSpecificObjectFiles() throws IOException {\n-        return FileOps.findFile( paths.getGvmPath(), \"llvm.o\").map( objectFile ->\n-                Collections.singletonList(objectFile.toAbsolutePath().toString())\n-        ).orElseThrow();\n+        if (useLLVM) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0817893584bb76d3ca6c3bf2e1f50273cb8ee079"}, "originalPosition": 200}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MjQ3Nw==", "bodyText": "this jar will contain dalvik classes found in the classpath, so far probably only from Attach. However probably better give it another name?", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429552477", "createdAt": "2020-05-23T14:49:56Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -407,122 +300,27 @@ private void copyOtherDalvikClasses() throws IOException, InterruptedException {\n                 throw new IOException(\"Error processing dalvik classes from jar: \" + jar + \": \" + e.getMessage() + \", \" + Arrays.toString(e.getSuppressed()));\n             }\n         }\n-    }\n-\n-    private void copyAndroidManifest(Path androidPath) throws IOException {\n-        Path androidManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n-        if (!Files.exists(androidManifest)) {\n-            throw new IOException(\"File \" + androidManifest.toString() + \" not found\");\n-        }\n-        Path androidManifestPath = getApkPath().resolve(\"AndroidManifest.xml\");\n-        FileOps.copyFile(androidManifest, androidManifestPath);\n-    }\n-\n-    private void copyAssets(Path androidPath) throws IOException {\n-        for (String iconFolder : iconFolders) {\n-            Path iconPath = androidPath.resolve(\"res\").resolve(iconFolder).resolve(\"ic_launcher.png\");\n-            if (!Files.exists(iconPath)) {\n-                throw new IOException(\"File \" + iconPath.toString() + \" not found\");\n-            }\n-        }\n-        FileOps.copyDirectory(androidPath.resolve(Constants.ANDROID_RES_FOLDER),  getApkPath().resolve(Constants.ANDROID_RES_FOLDER));\n-    }\n-\n-    private int dx(Path buildToolsPath) throws IOException, InterruptedException {\n-        String dxCmd = buildToolsPath.resolve(\"dx\").toString();\n-\n-        ProcessRunner dx = new ProcessRunner(dxCmd, \"--dex\",\n-                \"--output=\" + getApkBinPath().resolve(\"classes.dex\"),\n-                getApkClassesPath().toString());\n-        return dx.runProcess(\"dx\");\n-    }\n-\n-    private int aapt(Path buildToolsPath, String unalignedApk, String androidJar) throws IOException, InterruptedException {\n-        int processResult = aaptPackage(buildToolsPath, unalignedApk, androidJar);\n-        if (processResult != 0) {\n-            return processResult;\n-        }\n-\n-        processResult = aaptAddDxClasses(buildToolsPath, unalignedApk);\n-        if (processResult != 0) {\n-            return processResult;\n-        }\n+        ProcessRunner createJar = new ProcessRunner(\n+                projectConfiguration.getGraalPath().resolve(\"bin\").resolve(\"jar\").toString(),\n+                \"-cvf\", \"../attach.jar\", \".\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0817893584bb76d3ca6c3bf2e1f50273cb8ee079"}, "originalPosition": 358}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MzA4MQ==", "bodyText": "So gensrc is not used anymore? The developer still can pick the manifest to perform further changes if needed from the new folder, of course, but this changes the idea of having this intermediate location.", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429553081", "createdAt": "2020-05-23T14:58:04Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -532,86 +330,58 @@ private int sign(Path buildToolsPath, String alignedApk) throws IOException, Int\n     private Path getCapCacheDir() throws IOException {\n         Path capPath = paths.getGvmPath().resolve(\"capcache\");\n         if (!Files.exists(capPath)) {\n-            Files.createDirectory(capPath);\n-        }\n-        for (String cap : capFiles) {\n-            FileOps.copyResource(capLocation+cap, capPath.resolve(cap));\n+            FileOps.copyDirectoryFromResources(capLocation, capPath);\n         }\n         return capPath;\n     }\n \n-    private Path createDevelopKeystore() throws IOException, InterruptedException {\n-        Path keystore = Constants.USER_SUBSTRATE_PATH.resolve(Constants.ANDROID_KEYSTORE);\n-\n-        if (Files.exists(keystore)) {\n-            Logger.logDebug(\"The \" + Constants.ANDROID_KEYSTORE + \" file already exists, skipping\");\n-            return keystore;\n-        }\n-\n-        int processResult;\n-\n-        ProcessRunner generateTestKey = new ProcessRunner(\"keytool\", \"-genkey\", \"-v\", \"-keystore\", keystore.toString(), \"-storepass\",\n-                DEFAULT_DEBUG_KEY_STORE_PASSWORD, \"-alias\", DEFAULT_DEBUG_KEY_ALIAS, \"-keypass\", DEFAULT_DEBUG_KEY_ALIAS_PASSWORD, \"-keyalg\", \"RSA\", \"-keysize\", \"2048\", \"-validity\", \"10000\", \"-dname\", \"CN=Android Debug,O=Android,C=US\", \"-noprompt\");\n-        processResult = generateTestKey.runProcess(\"generateTestKey\");\n-        if (processResult != 0) {\n-            throw new IllegalArgumentException(\"fatal, can not create a keystore\");\n-        }\n-\n-        Logger.logDebug(\"Done creating \" + Constants.ANDROID_KEYSTORE);\n-        return keystore;\n-    }\n-\n-    private String findLatestBuildTool(Path sdkPath) throws IOException {\n-        Objects.requireNonNull(sdkPath);\n-        Path buildToolsPath = sdkPath.resolve(\"build-tools\");\n-        if (Files.exists(buildToolsPath)) {\n-            return Files.walk(buildToolsPath, 1)\n-                    .filter(file -> Files.isDirectory(file) && !file.equals(buildToolsPath))\n-                    .map(file -> new Version(file.getFileName().toString()))\n-                    .max(Version::compareTo)\n-                    .map(Version::toString)\n-                    .orElseThrow(BuildToolNotFoundException::new);\n+    /*\n+     * Copies the Android project from the jar resource and stores it in\n+     * a directory. Return that directory\n+     */\n+    private Path prepareAndroidProject() throws IOException {\n+        Path androidProject = getAndroidProjectPath();\n+        if (!Files.exists(androidProject)) {\n+            FileOps.copyDirectoryFromResources(\"/native/android/android_project\", androidProject);\n         }\n-        throw new BuildToolNotFoundException();\n+        getAndroidProjectPath().resolve(\"gradlew\").toFile().setExecutable(true);\n+        return androidProject;\n     }\n \n     /**\n-     * If android manifest is present in src/android, then, this\n-     * path will be returned.\n+     * If android manifest is present in src/android, it will be copied to\n+     * android project.\n      *\n-     * Else, default android manifest is copied into gvm/genSrc/android and\n-     * this path is returned\n+     * Else, default android manifest is adjusted and used in project", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0817893584bb76d3ca6c3bf2e1f50273cb8ee079"}, "originalPosition": 514}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU1MzQ5MQ==", "bodyText": "I take that assembleDebug will sign internally the apk for debug, and the debug.keystore we created is no longer required, right?\nWhat about signing for release? I see that you have removed the sign method. What is the alternative? Could we create the signing configuration in the build.gradle file, with the release data?", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429553491", "createdAt": "2020-05-23T15:03:48Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -124,80 +106,50 @@ public boolean compile() throws IOException, InterruptedException {\n     public boolean link() throws IOException, InterruptedException {\n         // we override link as we need to do some checks first. If we have no clang in android_ndk, we should not start linking\n         if (ndk == null) throw new IOException (\"Can't find an Android NDK on your system. Set the environment property ANDROID_NDK\");\n-        if (clang == null) throw new IOException (\"You specified an android ndk, but it doesn't contain \"+ndk+\"/toolchains/llvm/prebuilt/\"+hostPlatformFolder+\"/bin/clang\");\n+        if (clang == null) throw new IOException (\"You specified an android NDK, but it doesn't contain \"+ndk+\"/toolchains/llvm/prebuilt/\"+hostPlatformFolder+\"/bin/clang\");\n         if (sdk == null) throw new IOException (\"Can't find an Android SDK on your system. Set the environment property ANDROID_SDK\");\n \n         return super.link();\n     }\n \n     @Override\n     public boolean packageApp() throws IOException, InterruptedException {\n-        Path androidPathForManifest = prepareAndroidManifest();\n-        Path androidPathForRes = prepareAndroidResources();\n-\n-        ensureApkOutputDirectoriesExist();\n-\n-        Path sdkPath = Paths.get(sdk);\n-        Path buildToolsPath = sdkPath.resolve(\"build-tools\").resolve(findLatestBuildTool(sdkPath));\n-        String androidJar = sdkPath.resolve(\"platforms\").resolve(\"android-27\").resolve(\"android.jar\").toString();\n-\n-        String unalignedApk = getApkBinPath().resolve(projectConfiguration.getAppName() + \".unaligned.apk\").toString();\n-        String alignedApk = getApkBinPath().resolve(projectConfiguration.getAppName() + \".apk\").toString();\n-\n-        if (!processPrecompiledClasses(androidJar)) {\n-            return false;\n-        }\n-\n-        copyAndroidManifest(androidPathForManifest);\n-        copyAssets(androidPathForRes);\n-\n-        int processResult = dx(buildToolsPath);\n-        if (processResult != 0) {\n-            return false;\n-        }\n-\n-        processResult = aapt(buildToolsPath, unalignedApk, androidJar);\n-        if (processResult != 0) {\n-            return false;\n-        }\n-\n-        processResult = zipAlign(buildToolsPath, unalignedApk, alignedApk);\n-        if (processResult != 0) {\n-            return false;\n-        }\n+        prepareAndroidProject();\n+        prepareAndroidManifest();\n+        prepareAndroidResources();\n+        copyOtherDalvikClasses();\n+        copySubstrateLibraries();\n \n-        processResult = sign(buildToolsPath, alignedApk);\n-        return processResult == 0;\n+        ProcessRunner assembleDebug = new ProcessRunner(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0817893584bb76d3ca6c3bf2e1f50273cb8ee079"}, "originalPosition": 115}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3Mjk5NTgx", "url": "https://github.com/gluonhq/substrate/pull/612#pullrequestreview-417299581", "createdAt": "2020-05-23T18:39:38Z", "commit": {"oid": "59caa0438b68e980a686ad2e075de9d4a1e1d41d"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxODozOTozOFrOGZqypA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxOToyNDoyNlrOGZq-SQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2ODY3Ng==", "bodyText": "This is public API (that can be accessed by the client plugins). However we already have private API: https://github.com/gluonhq/substrate/blob/master/src/main/java/com/gluonhq/substrate/model/InternalProjectConfiguration.java#L299\nSo far I don't think we need this.", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429568676", "createdAt": "2020-05-23T18:39:38Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/ProjectConfiguration.java", "diffHunk": "@@ -46,6 +46,7 @@\n     private String javafxStaticSdkVersion;\n     private String javaStaticSdkVersion;\n \n+    private boolean useLLVM = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59caa0438b68e980a686ad2e075de9d4a1e1d41d"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2ODgyOA==", "bodyText": "This is correct, as it points to https://github.com/gluonhq/substrate/blob/master/src/main/java/com/gluonhq/substrate/target/AbstractTargetConfiguration.java#L100", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429568828", "createdAt": "2020-05-23T18:41:48Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -183,7 +182,7 @@ public boolean runUntilEnd() throws IOException, InterruptedException {\n                 \"-H:+UseCAPCache\",\n                 \"-H:CAPCacheDir=\" + getCapCacheDir().toAbsolutePath().toString(),\n                 \"-H:+UseBionicC\"));\n-        if (useLLVM) {\n+        if (projectConfiguration.isUseLLVM()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59caa0438b68e980a686ad2e075de9d4a1e1d41d"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MDA1Ng==", "bodyText": "probably this should be 28?", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429570056", "createdAt": "2020-05-23T18:59:52Z", "author": {"login": "jperedadnr"}, "path": "src/main/resources/native/android/android_project/app/build.gradle", "diffHunk": "@@ -2,15 +2,14 @@ apply plugin: 'com.android.application'\n \n android {\n     compileSdkVersion 27\n-    buildToolsVersion \"27.0.3\"\n \n     defaultConfig {\n         minSdkVersion 21\n         targetSdkVersion 27", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59caa0438b68e980a686ad2e075de9d4a1e1d41d"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MTY1Nw==", "bodyText": "I get this warning at the end of the package task:\nWARNING: No version of NDK matched the required version 21.1.6352462. Versions available locally: \n\nI have installed the ndk-bundle, but somehow it doesn't find it. Not sure if this is an issue?", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429571657", "createdAt": "2020-05-23T19:24:26Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/util/FileDeps.java", "diffHunk": "@@ -75,7 +75,7 @@\n \n     private static final String ANDROID_KEY = \"24333f8a63b6825ea9c5514f83c2829b004d1fee\";\n     private static final String[] ANDROID_SDK_PACKAGES = {\n-            \"platforms;android-27\", \"build-tools;27.0.3\", \"platform-tools\", \n+            \"platforms;android-27\", \"build-tools;29.0.2\", \"platform-tools\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "59caa0438b68e980a686ad2e075de9d4a1e1d41d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzA3MDk1", "url": "https://github.com/gluonhq/substrate/pull/612#pullrequestreview-417307095", "createdAt": "2020-05-23T20:34:20Z", "commit": {"oid": "a7b459c05e09575f6990687659f7dcf7485b56d3"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QyMDozNDoyMVrOGZrQkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QyMDo1Mjo1NFrOGZrVFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3NjMzNw==", "bodyText": "This is missing?\nbuildTypes {\n        release {\n            signingConfig signingConfigs.release\n        }\n    }", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429576337", "createdAt": "2020-05-23T20:34:21Z", "author": {"login": "jperedadnr"}, "path": "src/main/resources/native/android/android_project/app/build.gradle", "diffHunk": "@@ -12,4 +12,13 @@ android {\n         implementation 'com.android.support:support-v4:27.1.1'\n         api fileTree(dir: '../libs', include: '*.jar')\n     }\n+\n+    signingConfigs {\n+        release {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7b459c05e09575f6990687659f7dcf7485b56d3"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3NzQ5Mg==", "bodyText": "I'm not fond of adding the passwords to the file. I'd rather have them in a gradle.properties file, that can be global or local to the project.\nlike:\nSTOREPASS=real_store_password\n...\n\nThese properties can be also set by the client maven plugin, like:\n<providedKeyStorePassword>STOREPASS</providedKeyStorePassword >\n...", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429577492", "createdAt": "2020-05-23T20:52:54Z", "author": {"login": "jperedadnr"}, "path": "src/main/resources/native/android/android_project/app/build.gradle", "diffHunk": "@@ -12,4 +12,13 @@ android {\n         implementation 'com.android.support:support-v4:27.1.1'\n         api fileTree(dir: '../libs', include: '*.jar')\n     }\n+\n+    signingConfigs {\n+        release {\n+            storeFile file(\"KEYSTORE_FILE\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7b459c05e09575f6990687659f7dcf7485b56d3"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NTU2NDA0", "url": "https://github.com/gluonhq/substrate/pull/612#pullrequestreview-417556404", "createdAt": "2020-05-25T08:44:51Z", "commit": {"oid": "a7b459c05e09575f6990687659f7dcf7485b56d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwODo0NDo1MVrOGZ5nIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwODo0NDo1MVrOGZ5nIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgxMTQ5MQ==", "bodyText": "This fails on GraalVM 20.1\nCan we make this optional until there is a GraalVM release that has this flag?", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429811491", "createdAt": "2020-05-25T08:44:51Z", "author": {"login": "johanvos"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -223,20 +182,30 @@ public boolean runUntilEnd() throws IOException, InterruptedException {\n \n     @Override\n     List<String> getTargetSpecificAOTCompileFlags() throws IOException {\n-        return Arrays.asList(\"-H:CompilerBackend=\" + Constants.BACKEND_LLVM,\n+        ArrayList<String> flags = new ArrayList<String>(Arrays.asList(\n                 \"-H:-SpawnIsolates\",\n                 \"-Dsvm.targetArch=\" + projectConfiguration.getTargetTriplet().getArch(),\n                 \"-H:+UseOnlyWritableBootImageHeap\",\n                 \"-H:+UseCAPCache\",\n                 \"-H:CAPCacheDir=\" + getCapCacheDir().toAbsolutePath().toString(),\n-                \"-H:CustomLD=\" + ldlld.toAbsolutePath().toString());\n+                \"-H:+UseBionicC\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7b459c05e09575f6990687659f7dcf7485b56d3"}, "originalPosition": 194}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NTU4ODcx", "url": "https://github.com/gluonhq/substrate/pull/612#pullrequestreview-417558871", "createdAt": "2020-05-25T08:48:45Z", "commit": {"oid": "a7b459c05e09575f6990687659f7dcf7485b56d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwODo0ODo0NlrOGZ5u-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQwODo0ODo0NlrOGZ5u-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgxMzQ5Nw==", "bodyText": "This won't work on 20.1, as it requires oracle/graal@879a752", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429813497", "createdAt": "2020-05-25T08:48:46Z", "author": {"login": "johanvos"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -108,14 +94,16 @@ public AndroidTargetConfiguration( ProcessPaths paths, InternalProjectConfigurat\n \n         Path clangguess = Paths.get(this.ndk, \"toolchains\", \"llvm\", \"prebuilt\", hostPlatformFolder, \"bin\", \"clang\");\n         this.clang = Files.exists(clangguess) ? clangguess : null;\n+\n+        projectConfiguration.setBackend(Constants.BACKEND_AARCH64);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7b459c05e09575f6990687659f7dcf7485b56d3"}, "originalPosition": 56}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2e2fbc326a61fff6aaec8ecbad6de56099ec0484", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/2e2fbc326a61fff6aaec8ecbad6de56099ec0484", "committedDate": "2020-05-25T13:57:44Z", "message": "Keystore config file, target sdk, generated resources"}, "afterCommit": {"oid": "c15f85adefb26c101516f8e4a49a7dd92f238c2e", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/c15f85adefb26c101516f8e4a49a7dd92f238c2e", "committedDate": "2020-05-25T13:58:45Z", "message": "Use official gradle wrapper for Android building\n\nUse `+UseBionicC` flag\n\nUse `-H:+RemoveSaturatedTypeFlows` flag\n\nUse ARM64 backend\n\n\n\n\nTools version bump, create missing directories\n\nNewer build tools version\n\n\nUnused import\n\n\nGenerate release signing configuration\n\n\nOld typo\n\n\nUse internal api for backend lookup\n\n\nKeystore config file, target sdk, generated resources"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "837569e101679ff48573710706f0427bb1231e8e", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/837569e101679ff48573710706f0427bb1231e8e", "committedDate": "2020-05-25T14:12:29Z", "message": "Keystore template"}, "afterCommit": {"oid": "202c81cbcf190544df670692146bd9b1cd182814", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/202c81cbcf190544df670692146bd9b1cd182814", "committedDate": "2020-05-25T14:12:50Z", "message": "Use official gradle wrapper for Android building\n\nUse `+UseBionicC` flag\n\nUse `-H:+RemoveSaturatedTypeFlows` flag\n\nUse ARM64 backend\n\n\n\n\nTools version bump, create missing directories\n\nNewer build tools version\n\n\nUnused import\n\n\nGenerate release signing configuration\n\n\nOld typo\n\n\nUse internal api for backend lookup\n\n\nKeystore config file, target sdk, generated resources\n\n\nKeystore template"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NzU0MjM4", "url": "https://github.com/gluonhq/substrate/pull/612#pullrequestreview-417754238", "createdAt": "2020-05-25T14:41:29Z", "commit": {"oid": "202c81cbcf190544df670692146bd9b1cd182814"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxNDo0MToyOVrOGaDSug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxNDo0MToyOVrOGaDSug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk3MDEwNg==", "bodyText": "The file is not created, is it?", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r429970106", "createdAt": "2020-05-25T14:41:29Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -407,95 +311,41 @@ private void copyOtherDalvikClasses() throws IOException, InterruptedException {\n                 throw new IOException(\"Error processing dalvik classes from jar: \" + jar + \": \" + e.getMessage() + \", \" + Arrays.toString(e.getSuppressed()));\n             }\n         }\n-    }\n-\n-    private void copyAndroidManifest(Path androidPath) throws IOException {\n-        Path androidManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n-        if (!Files.exists(androidManifest)) {\n-            throw new IOException(\"File \" + androidManifest.toString() + \" not found\");\n-        }\n-        Path androidManifestPath = getApkPath().resolve(\"AndroidManifest.xml\");\n-        FileOps.copyFile(androidManifest, androidManifestPath);\n-    }\n-\n-    private void copyAssets(Path androidPath) throws IOException {\n-        for (String iconFolder : iconFolders) {\n-            Path iconPath = androidPath.resolve(\"res\").resolve(iconFolder).resolve(\"ic_launcher.png\");\n-            if (!Files.exists(iconPath)) {\n-                throw new IOException(\"File \" + iconPath.toString() + \" not found\");\n-            }\n-        }\n-        FileOps.copyDirectory(androidPath.resolve(Constants.ANDROID_RES_FOLDER),  getApkPath().resolve(Constants.ANDROID_RES_FOLDER));\n-    }\n-\n-    private int dx(Path buildToolsPath) throws IOException, InterruptedException {\n-        String dxCmd = buildToolsPath.resolve(\"dx\").toString();\n+        ProcessRunner createJar = new ProcessRunner(\n+                projectConfiguration.getGraalPath().resolve(\"bin\").resolve(\"jar\").toString(),\n+                \"-cvf\", \"../additional_classes.jar\", \".\");\n \n-        ProcessRunner dx = new ProcessRunner(dxCmd, \"--dex\",\n-                \"--output=\" + getApkBinPath().resolve(\"classes.dex\"),\n-                getApkClassesPath().toString());\n-        return dx.runProcess(\"dx\");\n+        createJar.runProcess(\"merge-dalvik-classes\", targetFolder.toFile());\n+        FileOps.deleteDirectory(targetFolder);\n     }\n \n-    private int aapt(Path buildToolsPath, String unalignedApk, String androidJar) throws IOException, InterruptedException {\n-        int processResult = aaptPackage(buildToolsPath, unalignedApk, androidJar);\n-        if (processResult != 0) {\n-            return processResult;\n-        }\n+    /*\n+     * Copies native libraries to android project\n+     */\n+    private void copySubstrateLibraries() throws IOException {\n+        Path projectLibsLocation = getAndroidProjectMainPath().resolve(\"jniLibs\").resolve(\"arm64-v8a\");\n \n-        processResult = aaptAddDxClasses(buildToolsPath, unalignedApk);\n-        if (processResult != 0) {\n-            return processResult;\n+        if (!Files.exists(projectLibsLocation)) {\n+            Files.createDirectories(projectLibsLocation);\n         }\n \n-        return aaptAddNativeLibs(buildToolsPath, unalignedApk);\n-    }\n-\n-    private int aaptPackage(Path buildToolsPath, String unalignedApk, String androidJar) throws IOException, InterruptedException {\n-        String aaptCmd = buildToolsPath.resolve(\"aapt\").toString();\n-        Path androidManifestPath = getApkPath().resolve(\"AndroidManifest.xml\");\n-        Path apkResPath = getApkPath().resolve(Constants.ANDROID_RES_FOLDER);\n-        ProcessRunner aaptpackage = new ProcessRunner(aaptCmd, \"package\",\n-                \"-f\", \"-m\", \"-F\", unalignedApk,\n-                \"-M\", androidManifestPath.toString(),\n-                \"-S\", apkResPath.toString(),\n-                \"-I\", androidJar);\n-        return aaptpackage.runProcess(\"aaptPackage\");\n-    }\n-\n-    private int aaptAddDxClasses(Path buildToolsPath, String unalignedApk) throws IOException, InterruptedException {\n-        String aaptCmd = buildToolsPath.resolve(\"aapt\").toString();\n-        ProcessRunner aaptAddClass = new ProcessRunner(aaptCmd, \"add\", unalignedApk, \"classes.dex\");\n-        return aaptAddClass.runProcess(\"aaptAddDxClasses\", getApkBinPath().toFile());\n-    }\n-\n-    private int aaptAddNativeLibs(Path buildToolsPath, String unalignedApk) throws IOException, InterruptedException {\n-        String aaptCmd = buildToolsPath.resolve(\"aapt\").toString();\n-\n-        Path libPath = paths.getAppPath().resolve(getLinkOutputName());\n-        Path substrateLibPath = getApkLibArm64Path().resolve(\"libsubstrate.so\");\n-        Files.copy(libPath, substrateLibPath, StandardCopyOption.REPLACE_EXISTING);\n-\n-        List<String> aaptAddLibsArgs = new ArrayList<>(Arrays.asList(aaptCmd, \"add\", unalignedApk, \"lib/arm64-v8a/libsubstrate.so\"));\n-\n         if (projectConfiguration.isUseJavaFX()) {\n             Path javafxFreetypeLibPath = fileDeps.getJavaFXSDKLibsPath().resolve(\"libfreetype.so\");\n-            Path freetypeLibPath = getApkLibArm64Path().resolve(\"libfreetype.so\");\n+            Path freetypeLibPath = projectLibsLocation.resolve(\"libfreetype.so\");\n             Files.copy(javafxFreetypeLibPath, freetypeLibPath, StandardCopyOption.REPLACE_EXISTING);\n-            aaptAddLibsArgs.add(\"lib/arm64-v8a/libfreetype.so\");\n         }\n \n-        ProcessRunner aaptAddLibs = new ProcessRunner(aaptAddLibsArgs.toArray(String[]::new));\n-        return aaptAddLibs.runProcess(\"aaptAddNativeLibs\", getApkPath().toFile());\n+        Path libsubstrate = paths.getAppPath().resolve(getLinkOutputName());\n+        Files.copy(libsubstrate, projectLibsLocation.resolve(\"libsubstrate.so\"), StandardCopyOption.REPLACE_EXISTING);\n     }\n \n-    private int zipAlign(Path buildToolsPath, String unalignedApk, String alignedApk) throws IOException, InterruptedException {\n-        String zipAlignCmd = buildToolsPath.resolve(\"zipalign\").toString();\n-        ProcessRunner zipAlign = new ProcessRunner(zipAlignCmd, \"-f\", \"4\", unalignedApk, alignedApk);\n-        return zipAlign.runProcess(\"zipalign\");\n-    }\n+    /*\n+     * Generates release signing configuration if\n+     * keystore is provided\n+     */\n+    private void generateSigningConfiguration() throws IOException {\n+        Path settingsFile = getAndroidProjectPath().resolve(\"keystore.properties\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "202c81cbcf190544df670692146bd9b1cd182814"}, "originalPosition": 435}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "202c81cbcf190544df670692146bd9b1cd182814", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/202c81cbcf190544df670692146bd9b1cd182814", "committedDate": "2020-05-25T14:12:50Z", "message": "Use official gradle wrapper for Android building\n\nUse `+UseBionicC` flag\n\nUse `-H:+RemoveSaturatedTypeFlows` flag\n\nUse ARM64 backend\n\n\n\n\nTools version bump, create missing directories\n\nNewer build tools version\n\n\nUnused import\n\n\nGenerate release signing configuration\n\n\nOld typo\n\n\nUse internal api for backend lookup\n\n\nKeystore config file, target sdk, generated resources\n\n\nKeystore template"}, "afterCommit": {"oid": "12fe324a2336c5cbea8aefb29ddcf834001e012a", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/12fe324a2336c5cbea8aefb29ddcf834001e012a", "committedDate": "2020-05-25T15:54:46Z", "message": "Use official gradle wrapper for Android building\n\nUse `+UseBionicC` flag\n\nUse `-H:+RemoveSaturatedTypeFlows` flag\n\nUse ARM64 backend\n\n\n\n\nTools version bump, create missing directories\n\nNewer build tools version\n\n\nUnused import\n\n\nGenerate release signing configuration\n\n\nOld typo\n\n\nUse internal api for backend lookup\n\n\nKeystore config file, target sdk, generated resources\n\n\nKeystore template\n\n\nDetect GraalVM version"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12fe324a2336c5cbea8aefb29ddcf834001e012a", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/12fe324a2336c5cbea8aefb29ddcf834001e012a", "committedDate": "2020-05-25T15:54:46Z", "message": "Use official gradle wrapper for Android building\n\nUse `+UseBionicC` flag\n\nUse `-H:+RemoveSaturatedTypeFlows` flag\n\nUse ARM64 backend\n\n\n\n\nTools version bump, create missing directories\n\nNewer build tools version\n\n\nUnused import\n\n\nGenerate release signing configuration\n\n\nOld typo\n\n\nUse internal api for backend lookup\n\n\nKeystore config file, target sdk, generated resources\n\n\nKeystore template\n\n\nDetect GraalVM version"}, "afterCommit": {"oid": "0fb238bbebadaed07078da7a3efa27bbd2e032e0", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/0fb238bbebadaed07078da7a3efa27bbd2e032e0", "committedDate": "2020-05-25T16:05:53Z", "message": "Use official gradle wrapper for Android building\n\nUse `+UseBionicC` flag\n\nUse `-H:+RemoveSaturatedTypeFlows` flag\n\nUse ARM64 backend\n\n\n\n\nTools version bump, create missing directories\n\nNewer build tools version\n\n\nUnused import\n\n\nGenerate release signing configuration\n\n\nOld typo\n\n\nUse internal api for backend lookup\n\n\nKeystore config file, target sdk, generated resources\n\n\nKeystore template\n\n\nDetect GraalVM version\n\n\nCodacy fixes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0fb238bbebadaed07078da7a3efa27bbd2e032e0", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/0fb238bbebadaed07078da7a3efa27bbd2e032e0", "committedDate": "2020-05-25T16:05:53Z", "message": "Use official gradle wrapper for Android building\n\nUse `+UseBionicC` flag\n\nUse `-H:+RemoveSaturatedTypeFlows` flag\n\nUse ARM64 backend\n\n\n\n\nTools version bump, create missing directories\n\nNewer build tools version\n\n\nUnused import\n\n\nGenerate release signing configuration\n\n\nOld typo\n\n\nUse internal api for backend lookup\n\n\nKeystore config file, target sdk, generated resources\n\n\nKeystore template\n\n\nDetect GraalVM version\n\n\nCodacy fixes"}, "afterCommit": {"oid": "9757e9ba5cc93cc8fa0232d173aa3d9b17afc494", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/9757e9ba5cc93cc8fa0232d173aa3d9b17afc494", "committedDate": "2020-05-25T16:07:10Z", "message": "Use official gradle wrapper for Android building\n\nUse `+UseBionicC` flag\n\nUse `-H:+RemoveSaturatedTypeFlows` flag\n\nUse ARM64 backend\n\nTools version bump, create missing directories\n\nNewer build tools version\n\nUnused import\n\nGenerate release signing configuration\n\nOld typo\n\nUse internal api for backend lookup\n\nKeystore config file, target sdk, generated resources\n\nKeystore template\n\nDetect GraalVM version\n\nCodacy fixes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9757e9ba5cc93cc8fa0232d173aa3d9b17afc494", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/9757e9ba5cc93cc8fa0232d173aa3d9b17afc494", "committedDate": "2020-05-25T16:07:10Z", "message": "Use official gradle wrapper for Android building\n\nUse `+UseBionicC` flag\n\nUse `-H:+RemoveSaturatedTypeFlows` flag\n\nUse ARM64 backend\n\nTools version bump, create missing directories\n\nNewer build tools version\n\nUnused import\n\nGenerate release signing configuration\n\nOld typo\n\nUse internal api for backend lookup\n\nKeystore config file, target sdk, generated resources\n\nKeystore template\n\nDetect GraalVM version\n\nCodacy fixes"}, "afterCommit": {"oid": "0151ffbd7da92195627c14a4ffb7847bdd45aa92", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/0151ffbd7da92195627c14a4ffb7847bdd45aa92", "committedDate": "2020-05-25T16:35:59Z", "message": "Use official gradle wrapper for Android building\n\nUse `+UseBionicC` flag\n\nUse `-H:+RemoveSaturatedTypeFlows` flag\n\nUse ARM64 backend\n\nTools version bump, create missing directories\n\nNewer build tools version\n\nUnused import\n\nGenerate release signing configuration\n\nOld typo\n\nUse internal api for backend lookup\n\nKeystore config file, target sdk, generated resources\n\nKeystore template\n\nDetect GraalVM version\n\nCodacy fixes\n\nFix GraalVM version detection"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3ODE2NzUz", "url": "https://github.com/gluonhq/substrate/pull/612#pullrequestreview-417816753", "createdAt": "2020-05-25T17:10:40Z", "commit": {"oid": "0151ffbd7da92195627c14a4ffb7847bdd45aa92"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxNzoxMDo0MFrOGaGgLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxNzoxMDo0MFrOGaGgLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAyMjcwMA==", "bodyText": "This fails for me, as I have installed graalvm-ce-java11-20.2.0-dev, and that produces  GraalVM CE 20.2.0-dev, that doesn't follow the current pattern (but this is a different issue though, I filed #617 for it).", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r430022700", "createdAt": "2020-05-25T17:10:40Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -108,14 +95,17 @@ public AndroidTargetConfiguration( ProcessPaths paths, InternalProjectConfigurat\n \n         Path clangguess = Paths.get(this.ndk, \"toolchains\", \"llvm\", \"prebuilt\", hostPlatformFolder, \"bin\", \"clang\");\n         this.clang = Files.exists(clangguess) ? clangguess : null;\n+        if (projectConfiguration.getGraalVersion().compareTo(new Version(\"20.1.0\")) > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0151ffbd7da92195627c14a4ffb7847bdd45aa92"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3ODQ3MjMw", "url": "https://github.com/gluonhq/substrate/pull/612#pullrequestreview-417847230", "createdAt": "2020-05-25T19:04:11Z", "commit": {"oid": "c1189f8571bad4400efbf4651f2255aa2789667a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxOTowNDoxMlrOGaIJSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxOTowNDoxMlrOGaIJSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0OTYwOQ==", "bodyText": "Use toLowerCase(Locale.ROOT).\nCan you also check if Files.exists(generatedApk) before copying it to gvm? In case, for any reason, the process ends successfully but the apk file is not found?", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r430049609", "createdAt": "2020-05-25T19:04:12Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -127,23 +123,32 @@ public boolean packageApp() throws IOException, InterruptedException {\n         prepareAndroidResources();\n         copyOtherDalvikClasses();\n         copySubstrateLibraries();\n-        generateSigningConfiguration();\n+        String configuration = generateSigningConfiguration();\n \n         ProcessRunner assembleDebug = new ProcessRunner(\n                             getAndroidProjectPath().resolve(\"gradlew\").toString(),\n                             \"-p\", getAndroidProjectPath().toString(),\n-                            \"assembleDebug\");\n+                            \"assemble\" + configuration);\n         assembleDebug.addToEnv(\"ANDROID_HOME\", sdk);\n         assembleDebug.addToEnv(\"JAVA_HOME\", projectConfiguration.getGraalPath().toString());\n-        return assembleDebug.runProcess(\"package-task\") == 0;\n+        if (assembleDebug.runProcess(\"package-task\") != 0) {\n+            return false;\n+        }\n+        Path generatedApk = getAndroidProjectPath().resolve(\"app\").resolve(\"build\")\n+                            .resolve(\"outputs\").resolve(\"apk\").resolve(configuration.toLowerCase())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1189f8571bad4400efbf4651f2255aa2789667a"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MDE5NDI5", "url": "https://github.com/gluonhq/substrate/pull/612#pullrequestreview-418019429", "createdAt": "2020-05-26T07:01:41Z", "commit": {"oid": "02f22bb09f553a9731e54ddff1fa88a8660cb389"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNzowMTo0MVrOGaREgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNzowMTo0MVrOGaREgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE5NTg0MA==", "bodyText": "This would be better in a separate PR, as it affects all platforms.", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r430195840", "createdAt": "2020-05-26T07:01:41Z", "author": {"login": "johanvos"}, "path": "src/main/java/com/gluonhq/substrate/target/AbstractTargetConfiguration.java", "diffHunk": "@@ -89,7 +89,8 @@\n             \"-H:+AddAllCharsets\",\n             \"-H:+ReportExceptionStackTraces\",\n             \"-H:-DeadlockWatchdogExitOnTimeout\",\n-            \"-H:DeadlockWatchdogInterval=0\"\n+            \"-H:DeadlockWatchdogInterval=0\",\n+            \"-H:+RemoveSaturatedTypeFlows\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02f22bb09f553a9731e54ddff1fa88a8660cb389"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MDIxNDIz", "url": "https://github.com/gluonhq/substrate/pull/612#pullrequestreview-418021423", "createdAt": "2020-05-26T07:05:09Z", "commit": {"oid": "02f22bb09f553a9731e54ddff1fa88a8660cb389"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNzowNTowOVrOGaRKkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQwNzowNTowOVrOGaRKkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE5NzM5NA==", "bodyText": "/native/android/android_project can be a constant (error-prone to spell it)", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r430197394", "createdAt": "2020-05-26T07:05:09Z", "author": {"login": "johanvos"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -532,86 +389,61 @@ private int sign(Path buildToolsPath, String alignedApk) throws IOException, Int\n     private Path getCapCacheDir() throws IOException {\n         Path capPath = paths.getGvmPath().resolve(\"capcache\");\n         if (!Files.exists(capPath)) {\n-            Files.createDirectory(capPath);\n-        }\n-        for (String cap : capFiles) {\n-            FileOps.copyResource(capLocation+cap, capPath.resolve(cap));\n+            FileOps.copyDirectoryFromResources(capLocation, capPath);\n         }\n         return capPath;\n     }\n \n-    private Path createDevelopKeystore() throws IOException, InterruptedException {\n-        Path keystore = Constants.USER_SUBSTRATE_PATH.resolve(Constants.ANDROID_KEYSTORE);\n-\n-        if (Files.exists(keystore)) {\n-            Logger.logDebug(\"The \" + Constants.ANDROID_KEYSTORE + \" file already exists, skipping\");\n-            return keystore;\n-        }\n-\n-        int processResult;\n-\n-        ProcessRunner generateTestKey = new ProcessRunner(\"keytool\", \"-genkey\", \"-v\", \"-keystore\", keystore.toString(), \"-storepass\",\n-                DEFAULT_DEBUG_KEY_STORE_PASSWORD, \"-alias\", DEFAULT_DEBUG_KEY_ALIAS, \"-keypass\", DEFAULT_DEBUG_KEY_ALIAS_PASSWORD, \"-keyalg\", \"RSA\", \"-keysize\", \"2048\", \"-validity\", \"10000\", \"-dname\", \"CN=Android Debug,O=Android,C=US\", \"-noprompt\");\n-        processResult = generateTestKey.runProcess(\"generateTestKey\");\n-        if (processResult != 0) {\n-            throw new IllegalArgumentException(\"fatal, can not create a keystore\");\n-        }\n-\n-        Logger.logDebug(\"Done creating \" + Constants.ANDROID_KEYSTORE);\n-        return keystore;\n-    }\n-\n-    private String findLatestBuildTool(Path sdkPath) throws IOException {\n-        Objects.requireNonNull(sdkPath);\n-        Path buildToolsPath = sdkPath.resolve(\"build-tools\");\n-        if (Files.exists(buildToolsPath)) {\n-            return Files.walk(buildToolsPath, 1)\n-                    .filter(file -> Files.isDirectory(file) && !file.equals(buildToolsPath))\n-                    .map(file -> new Version(file.getFileName().toString()))\n-                    .max(Version::compareTo)\n-                    .map(Version::toString)\n-                    .orElseThrow(BuildToolNotFoundException::new);\n+    /*\n+     * Copies the Android project from the jar resource and stores it in\n+     * a directory. Return that directory\n+     */\n+    private Path prepareAndroidProject() throws IOException {\n+        Path androidProject = getAndroidProjectPath();\n+        if (Files.exists(androidProject)) {\n+            FileOps.deleteDirectory(androidProject);\n         }\n-        throw new BuildToolNotFoundException();\n+        FileOps.copyDirectoryFromResources(\"/native/android/android_project\", androidProject);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02f22bb09f553a9731e54ddff1fa88a8660cb389"}, "originalPosition": 535}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "03375b24e6c11e4f2e147cb67764cc7b122f1ff6", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/03375b24e6c11e4f2e147cb67764cc7b122f1ff6", "committedDate": "2020-05-26T12:06:19Z", "message": "Better android logging, constant for android_project\n\n\nLogcat unused flag"}, "afterCommit": {"oid": "39379e252096a95e6337aeae94f69113f4905ea2", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/39379e252096a95e6337aeae94f69113f4905ea2", "committedDate": "2020-05-26T12:32:32Z", "message": "Use official gradle wrapper for Android building\n\nUse `+UseBionicC` flag\n\nUse ARM64 backend\n\nTools version bump, create missing directories\n\nNewer build tools version\n\nGenerate release signing configuration\n\nUse internal api for backend lookup\n\nKeystore config file, target sdk, generated resources\n\nDetect GraalVM version\n\nassemble/release check\n\nCopy generated apk to gvm folder\n\nKeyStore properties location\n\nBetter android logging, constant for android_project\n\nLogcat unused flag\n\nAndroid platform bump"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NDgyNDYw", "url": "https://github.com/gluonhq/substrate/pull/612#pullrequestreview-418482460", "createdAt": "2020-05-26T16:38:41Z", "commit": {"oid": "39379e252096a95e6337aeae94f69113f4905ea2"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNjozODo0MVrOGam3rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNjo0MzowM1rOGanHEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU1MzAwNg==", "bodyText": "Unused constants, first one can be used in prepareAndroidManifest. Second one can be removed", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r430553006", "createdAt": "2020-05-26T16:38:41Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/Constants.java", "diffHunk": "@@ -138,6 +139,7 @@\n     public static final String DALVIK_PRECOMPILED_CLASSES = \"/precompiled/classes/\";\n     public static final String DALVIK_ACTIVITY_PACKAGE = \"com/gluonhq/helloandroid/\";\n     public static final String DALVIK_JAVAFX_PACKAGE = \"javafx/scene/input/\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39379e252096a95e6337aeae94f69113f4905ea2"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU1Njk0Nw==", "bodyText": "Can you refactor the path /native/android/ to one constant, and then only the name to another one? There are few uses for the former and also for the latter.", "url": "https://github.com/gluonhq/substrate/pull/612#discussion_r430556947", "createdAt": "2020-05-26T16:43:03Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/Constants.java", "diffHunk": "@@ -138,6 +139,7 @@\n     public static final String DALVIK_PRECOMPILED_CLASSES = \"/precompiled/classes/\";\n     public static final String DALVIK_ACTIVITY_PACKAGE = \"com/gluonhq/helloandroid/\";\n     public static final String DALVIK_JAVAFX_PACKAGE = \"javafx/scene/input/\";\n+    public static final String DALVIK_PROJECT_PATH = \"/native/android/android_project\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39379e252096a95e6337aeae94f69113f4905ea2"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NTMwNTY3", "url": "https://github.com/gluonhq/substrate/pull/612#pullrequestreview-418530567", "createdAt": "2020-05-26T17:41:47Z", "commit": {"oid": "d82392d6cf8f868c9719e0a5bbff1499af634f28"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NTY4NjQx", "url": "https://github.com/gluonhq/substrate/pull/612#pullrequestreview-418568641", "createdAt": "2020-05-26T18:31:28Z", "commit": {"oid": "d82392d6cf8f868c9719e0a5bbff1499af634f28"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "779cdab61bdac5cb8f0c53715c5b4549ae3e0df7", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/779cdab61bdac5cb8f0c53715c5b4549ae3e0df7", "committedDate": "2020-05-26T18:41:04Z", "message": "Use official gradle wrapper for Android building\n\nUse `+UseBionicC` flag\n\nUse ARM64 backend\n\nTools version bump, create missing directories\n\nNewer build tools version\n\nGenerate release signing configuration\n\nUse internal api for backend lookup\n\nKeystore config file, target sdk, generated resources\n\nDetect GraalVM version\n\nassemble/release check\n\nCopy generated apk to gvm folder\n\nKeyStore properties location\n\nBetter android logging, constant for android_project\n\nLogcat unused flag\n\nAndroid platform bump\n\n\nAndroid constants\n\n\nBackend fix"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "58e0e093fd0faa8c600c33b55e9fbc54f0e746e7", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/58e0e093fd0faa8c600c33b55e9fbc54f0e746e7", "committedDate": "2020-05-26T18:40:50Z", "message": "Backend fix"}, "afterCommit": {"oid": "779cdab61bdac5cb8f0c53715c5b4549ae3e0df7", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/779cdab61bdac5cb8f0c53715c5b4549ae3e0df7", "committedDate": "2020-05-26T18:41:04Z", "message": "Use official gradle wrapper for Android building\n\nUse `+UseBionicC` flag\n\nUse ARM64 backend\n\nTools version bump, create missing directories\n\nNewer build tools version\n\nGenerate release signing configuration\n\nUse internal api for backend lookup\n\nKeystore config file, target sdk, generated resources\n\nDetect GraalVM version\n\nassemble/release check\n\nCopy generated apk to gvm folder\n\nKeyStore properties location\n\nBetter android logging, constant for android_project\n\nLogcat unused flag\n\nAndroid platform bump\n\n\nAndroid constants\n\n\nBackend fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2052, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}