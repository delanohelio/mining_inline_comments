{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzNzMwMjc4", "number": 404, "title": "Multiple Android / iOS improvements", "bodyText": "These are mostly changes regarding additional libraries needed for GraalVM Polyglot applications, as well as some general QoL improvements.\n\nAdded missing libraries to linker calls\nSplit Android launcher.c and added #define to disable extensive logging by default\nAdded glibc_shim.c which adds missing symbols for linking with aarch64 glibc static libraries on Android\nRemoved Android and iOS stubs which are now deprecated\nAdded usePrecompiledCode option which enables users to opt-out of using precompiled glue code (in case additional native API access is needed)\n\nSorry for pushing all these big changes in one PR, I was too time constrained to split them.", "createdAt": "2020-03-04T17:34:42Z", "url": "https://github.com/gluonhq/substrate/pull/404", "merged": true, "mergeCommit": {"oid": "892500eeb0ceae2cb79928327f3a694028152f94"}, "closed": true, "closedAt": "2020-03-06T13:21:46Z", "author": {"login": "lazar-mitrovic"}, "timelineItems": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIK-K5AH2gAyMzgzNzMwMjc4OjM4ODA4N2VhOGJjZGYxMjBhMGExZGY3YzQ5ZWVlMjkwNzYxMGUyZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKykF4AFqTM2OTkzNDYzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "388087ea8bcdf120a0a1df7c49eee2907610e2fd", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/388087ea8bcdf120a0a1df7c49eee2907610e2fd", "committedDate": "2020-02-26T18:24:26Z", "message": "Add additional libraries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a1beebaab6179e63f3e5e385eb3be829462bbf8", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/7a1beebaab6179e63f3e5e385eb3be829462bbf8", "committedDate": "2020-02-26T18:24:48Z", "message": "Merge remote-tracking branch 'gluonhq/master' into additionalLibs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc826d421ef87b9c803d6a30cd32765aff12810e", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/cc826d421ef87b9c803d6a30cd32765aff12810e", "committedDate": "2020-02-26T22:18:42Z", "message": "Merge remote-tracking branch 'gluonhq/master' into additionalLibs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "290094b52f3eadf8b25dac6a5384a6d0176e0a39", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/290094b52f3eadf8b25dac6a5384a6d0176e0a39", "committedDate": "2020-02-27T13:38:40Z", "message": "Merge branch 'master' into additionalLibs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0146fb519b3a680a511ba2b02a5b3436b57048bf", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/0146fb519b3a680a511ba2b02a5b3436b57048bf", "committedDate": "2020-02-27T18:36:59Z", "message": "Should have fixed r+w+e page problem"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aec0bde5b7e4d8c2ba5e6d9659d5df66f0f4f9f", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/8aec0bde5b7e4d8c2ba5e6d9659d5df66f0f4f9f", "committedDate": "2020-02-27T18:37:09Z", "message": "Merge remote-tracking branch 'gluonhq/master' into additionalLibs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "582e42d0816c0508ae187b442583f2658963d73b", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/582e42d0816c0508ae187b442583f2658963d73b", "committedDate": "2020-02-27T18:44:29Z", "message": "Bumped target sdk back to 28"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b92936e4dac034f8bceaf8d1df4b3b66c67142e", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/3b92936e4dac034f8bceaf8d1df4b3b66c67142e", "committedDate": "2020-02-27T18:50:25Z", "message": "Removed debug"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b824805f76070a0a2045302c7a55b97e70fb8067", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/b824805f76070a0a2045302c7a55b97e70fb8067", "committedDate": "2020-02-27T19:01:19Z", "message": "Reverted location of imports (no idea why it was moved)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "096cbfb4ebaf3cc99ee45ccdf8622c01abb1aa28", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/096cbfb4ebaf3cc99ee45ccdf8622c01abb1aa28", "committedDate": "2020-02-28T08:48:59Z", "message": "Merge remote-tracking branch 'gluonhq/master' into additionalLibs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "683952887fed1b308c2265d3224e1c1b35fd9cb0", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/683952887fed1b308c2265d3224e1c1b35fd9cb0", "committedDate": "2020-02-28T08:51:54Z", "message": "Remove merge artifacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcbcc8b10032cdcff4d8a9e2c06dba9e26ce9ff4", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/dcbcc8b10032cdcff4d8a9e2c06dba9e26ce9ff4", "committedDate": "2020-02-28T14:02:12Z", "message": "Other libs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d9f43a00bacb496943b6f32b0499c954e843a29", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/2d9f43a00bacb496943b6f32b0499c954e843a29", "committedDate": "2020-02-28T16:51:00Z", "message": "Merge remote-tracking branch 'gluonhq/master' into additionalLibs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b53d76def8eefc26a96e249bfbf30df7db4027d1", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/b53d76def8eefc26a96e249bfbf30df7db4027d1", "committedDate": "2020-02-28T21:11:42Z", "message": "Split `.c` code, added glibc_shim (enables linking against graal libs)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb2b8c9b212a040d0050531c7929cc9fa67ccf87", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/cb2b8c9b212a040d0050531c7929cc9fa67ccf87", "committedDate": "2020-03-04T17:00:41Z", "message": "Added opt-out for precompiled classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dcbb861c01eca91fef07a3f397376b779fa8bbf", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/4dcbb861c01eca91fef07a3f397376b779fa8bbf", "committedDate": "2020-03-04T17:01:08Z", "message": "Merge remote-tracking branch 'gluonhq/master' into additionalLibs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98ddf9da143125b74d9834b663077df0f436c4c4", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/98ddf9da143125b74d9834b663077df0f436c4c4", "committedDate": "2020-03-04T17:02:50Z", "message": "Use precompiled classes by default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1954f1b216c373d89823e23a4aa7373aa0a280e", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/c1954f1b216c373d89823e23a4aa7373aa0a280e", "committedDate": "2020-03-04T17:13:17Z", "message": "Removed stub function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "973c6ca7ceb2c6e2ae16b3858965630f6f88dd75", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/973c6ca7ceb2c6e2ae16b3858965630f6f88dd75", "committedDate": "2020-03-04T17:13:27Z", "message": "Merge remote-tracking branch 'gluonhq/master' into additionalLibs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46443ca09587e432300229a19a825e05f048b1ce", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/46443ca09587e432300229a19a825e05f048b1ce", "committedDate": "2020-03-04T21:38:47Z", "message": "Removed duplicate libs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f82bc272681b8b005b53faa1c10ba31408bff0f", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/3f82bc272681b8b005b53faa1c10ba31408bff0f", "committedDate": "2020-03-04T21:51:02Z", "message": "Make Codacy happy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5NDU4MTU0", "url": "https://github.com/gluonhq/substrate/pull/404#pullrequestreview-369458154", "createdAt": "2020-03-05T10:34:49Z", "commit": {"oid": "3f82bc272681b8b005b53faa1c10ba31408bff0f"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMDozNDo0OVrOFyOVDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxMTo1Njo0M1rOFyQyDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIwNzg4Ng==", "bodyText": "New API should have a way to be set from SubstrateDispatcher::main as well (via System property).", "url": "https://github.com/gluonhq/substrate/pull/404#discussion_r388207886", "createdAt": "2020-03-05T10:34:49Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/ProjectConfiguration.java", "diffHunk": "@@ -48,6 +48,7 @@\n \n     private boolean usePrismSW = false;\n     private boolean verbose = false;\n+    private boolean usePrecompiledCode = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f82bc272681b8b005b53faa1c10ba31408bff0f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIzMzI0Mw==", "bodyText": "This means that you copy the sources even for the precompiled case? It is not necessary, is it?", "url": "https://github.com/gluonhq/substrate/pull/404#discussion_r388233243", "createdAt": "2020-03-05T11:24:06Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -152,16 +159,38 @@ public boolean link() throws IOException, InterruptedException {\n         Files.createDirectories(apkLibPath);\n         Files.createDirectories(apkLibArm64Path);\n         Path androidManifestPath = apkPath.resolve(\"AndroidManifest.xml\");\n-        Path dalvikActivityPackage = apkClassPath.resolve(\"com/gluonhq/helloandroid\");\n-        Path dalvikKeyCodePackage = apkClassPath.resolve(\"javafx/scene/input\");\n-        FileOps.copyResource(\"/native/android/dalvik/MainActivity.class\", dalvikActivityPackage.resolve(\"MainActivity.class\"));\n-        FileOps.copyResource(\"/native/android/dalvik/MainActivity$1.class\", dalvikActivityPackage.resolve(\"MainActivity$1.class\"));\n-        FileOps.copyResource(\"/native/android/dalvik/MainActivity$2.class\", dalvikActivityPackage.resolve(\"MainActivity$2.class\"));\n-        FileOps.copyResource(\"/native/android/dalvik/MainActivity$3.class\", dalvikActivityPackage.resolve(\"MainActivity$3.class\"));\n-        FileOps.copyResource(\"/native/android/dalvik/MainActivity$InternalSurfaceView.class\", dalvikActivityPackage.resolve(\"MainActivity$InternalSurfaceView.class\"));\n-        FileOps.copyResource(\"/native/android/dalvik/KeyCode.class\", dalvikKeyCodePackage.resolve(\"KeyCode.class\"));\n-        FileOps.copyResource(\"/native/android/dalvik/KeyCode$KeyCodeClass.class\", dalvikKeyCodePackage.resolve(\"KeyCode$KeyCodeClass.class\"));\n \n+        String androidCodeLocation = \"/native/android/dalvik\";\n+\n+        String androidSrc = androidCodeLocation + \"/source/\";\n+        String androidPrecompiled = androidCodeLocation + \"/precompiled/class/\";\n+\n+        if (!Files.isDirectory(apkAndroidSourcePath)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f82bc272681b8b005b53faa1c10ba31408bff0f"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI0MDk0OA==", "bodyText": "I get these warnings compiling the additional sources for Android:\n[SUB] glibc_shim.c:8:23: warning: incompatible pointer types passing 'struct stat64 *' to parameter of type 'struct stat *' >\n[SUB]     return stat(path, stat_buf);\n[SUB]                       ^~~~~~~~\n[SUB] /home/user/.gluon/substrate/Android/ndk-bundle/toolchains/llvm/prebuil>\n[SUB] int stat(const char* __path, struct stat* __buf);\n[SUB]                                           ^\n[SUB] glibc_shim.c:13:24: warning: incompatible pointer types passing 'struct s>\n[SUB]     return lstat(path, stat_buf);\n[SUB]                        ^~~~~~~~\n[SUB] /home/user/.gluon/substrate/Android/ndk-bundle/toolchains/llvm/prebuil>\n[SUB] int lstat(const char* __path, struct stat* __buf);\n[SUB]                                            ^\n[SUB] glibc_shim.c:18:26: warning: incompatible pointer types passing 'struct s>\n[SUB]     return fstat(fildes, stat_buf);\n[SUB]                          ^~~~~~~~\n[SUB] /home/user/.gluon/substrate/Android/ndk-bundle/toolchains/llvm/prebuil>\n[SUB] int fstat(int __fd, struct stat* __buf);\n[SUB]                                  ^\n[SUB] glibc_shim.c:49:30: warning: incompatible pointer to integer conversion p>\n[SUB]     return mknod(path, mode, dev);\n[SUB]                              ^~~\n[SUB]                              *\n[SUB] /home/user/.gluon/substrate/Android/ndk-bundle/toolchains/llvm/prebuil>\n[SUB] int mknod(const char* __path, mode_t __mode, dev_t __dev);\n[SUB]                                                    ^\n[SUB] 4 warnings generated.", "url": "https://github.com/gluonhq/substrate/pull/404#discussion_r388240948", "createdAt": "2020-03-05T11:40:54Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AbstractTargetConfiguration.java", "diffHunk": "@@ -322,7 +321,7 @@ protected boolean compileAdditionalSources()\n             FileOps.copyResource(getAdditionalSourceFileLocation()  + fileName, workDir.resolve(fileName));\n         }\n   \n-        int result = processRunner.runProcess(\"compile additional sources\", workDir.toFile());\n+        int result = processRunner.runProcess(\"compile-additional-sources\", workDir.toFile());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f82bc272681b8b005b53faa1c10ba31408bff0f"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI0Mjg5Mw==", "bodyText": "Is it me, or is this inverted?", "url": "https://github.com/gluonhq/substrate/pull/404#discussion_r388242893", "createdAt": "2020-03-05T11:45:09Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -152,16 +159,38 @@ public boolean link() throws IOException, InterruptedException {\n         Files.createDirectories(apkLibPath);\n         Files.createDirectories(apkLibArm64Path);\n         Path androidManifestPath = apkPath.resolve(\"AndroidManifest.xml\");\n-        Path dalvikActivityPackage = apkClassPath.resolve(\"com/gluonhq/helloandroid\");\n-        Path dalvikKeyCodePackage = apkClassPath.resolve(\"javafx/scene/input\");\n-        FileOps.copyResource(\"/native/android/dalvik/MainActivity.class\", dalvikActivityPackage.resolve(\"MainActivity.class\"));\n-        FileOps.copyResource(\"/native/android/dalvik/MainActivity$1.class\", dalvikActivityPackage.resolve(\"MainActivity$1.class\"));\n-        FileOps.copyResource(\"/native/android/dalvik/MainActivity$2.class\", dalvikActivityPackage.resolve(\"MainActivity$2.class\"));\n-        FileOps.copyResource(\"/native/android/dalvik/MainActivity$3.class\", dalvikActivityPackage.resolve(\"MainActivity$3.class\"));\n-        FileOps.copyResource(\"/native/android/dalvik/MainActivity$InternalSurfaceView.class\", dalvikActivityPackage.resolve(\"MainActivity$InternalSurfaceView.class\"));\n-        FileOps.copyResource(\"/native/android/dalvik/KeyCode.class\", dalvikKeyCodePackage.resolve(\"KeyCode.class\"));\n-        FileOps.copyResource(\"/native/android/dalvik/KeyCode$KeyCodeClass.class\", dalvikKeyCodePackage.resolve(\"KeyCode$KeyCodeClass.class\"));\n \n+        String androidCodeLocation = \"/native/android/dalvik\";\n+\n+        String androidSrc = androidCodeLocation + \"/source/\";\n+        String androidPrecompiled = androidCodeLocation + \"/precompiled/class/\";\n+\n+        if (!Files.isDirectory(apkAndroidSourcePath)) {\n+            for (String srcFile : sourceGlueCode) {\n+                FileOps.copyResource(androidSrc + srcFile + \".java\", apkAndroidSourcePath.resolve(srcFile + \".java\"));\n+            }\n+        }\n+        \n+        if (!projectConfiguration.isUsePrecompiledCode()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f82bc272681b8b005b53faa1c10ba31408bff0f"}, "originalPosition": 65}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI0ODA3Nw==", "bodyText": "typo", "url": "https://github.com/gluonhq/substrate/pull/404#discussion_r388248077", "createdAt": "2020-03-05T11:56:43Z", "author": {"login": "jperedadnr"}, "path": "src/main/resources/native/android/c/launcher.c", "diffHunk": "@@ -1,221 +1,122 @@\n-#include <jni.h>\n-#include <stdio.h>\n-#include <stdlib.h>\n-#include <string.h>\n-#include <unistd.h>\n-#include <pthread.h>\n-\n-\n-#include <errno.h>\n-#include <android/native_window_jni.h>\n #include \"grandroid.h\"\n \n-#define  LOG_TAG \"GraalGluon\"\n-\n-#define  LOGD(ignore, ...)  __android_log_print(ANDROID_LOG_DEBUG, LOG_TAG, __VA_ARGS__)\n-#define  LOGE(ignore, ...)  __android_log_print(ANDROID_LOG_ERROR, LOG_TAG, __VA_ARGS__)\n-\n-extern int *run_main(int argc, char* argv[]);\n-\n-void __attribute__((weak)) androidJfx_requestGlassToRedraw() {}\n-void __attribute__((weak)) androidJfx_setNativeWindow(ANativeWindow* nativeWindow) {}\n-void __attribute__((weak)) androidJfx_setDensity(float nativeDensity) {}\n-void __attribute__((weak)) androidJfx_gotTouchEvent (int count, int* actions, int* ids, int* xs, int* ys, int primary) {}\n-void __attribute__((weak)) androidJfx_gotKeyEvent (int action, int key, jchar* chars, int count, int mods) {}\n-int  __attribute__((weak)) to_jfx_touch_action(int state) { return 0; }\n+extern int *run_main(int argc, char *argv[]);\n \n jclass activityClass;\n jobject activity;\n jmethodID activity_showIME;\n jmethodID activity_hideIME;\n \n-\n JavaVM *androidVM;\n-JNIEnv* androidEnv;\n+JNIEnv *androidEnv;\n ANativeWindow *window;\n jfloat density;\n-char* appDataDir;\n+char *appDataDir;\n \n int start_logger(const char *app_name);\n static int pfd[2];\n static pthread_t thr;\n static const char *tag = \"myapp\";\n-const char * origargs[] = {\n-        \"myapp\",\n-        \"-Djavafx.platform=android\",\n-        \"-Dmonocle.platform=Android\", // used in com.sun.glass.ui.monocle.NativePlatformFactory\n-        \"-Dembedded=monocle\",\n-        \"-Dglass.platform=Monocle\",\n-        \"-Djavafx.verbose=true\",\n-        \"-Dmonocle.input.traceEvents.verbose=true\",\n-        \"-Dprism.verbose=true\"};\n+const char *origargs[] = {\n+    \"myapp\",\n+    \"-Djavafx.platform=android\",\n+    \"-Dmonocle.platform=Android\", // used in com.sun.glass.ui.monocle.NativePlatformFactory\n+    \"-Dembedded=monocle\",\n+    \"-Dglass.platform=Monocle\",\n+    \"-Djavafx.verbose=true\",\n+    \"-Dmonocle.input.traceEvents.verbose=true\",\n+    \"-Dprism.verbose=true\"};\n \n int argsize = 8;\n \n-char** createArgs() {\n-LOGE(stderr, \"CREATE ARGS\");\n-    int origSize = sizeof(origargs)/sizeof(char*);\n-    char** result = malloc((origSize+2)* sizeof(char*));\n-    for (int i = 0; i < origSize; i++) {\n+char **createArgs()\n+{\n+    LOGE(stderr, \"CREATE ARGS\");\n+    int origSize = sizeof(origargs) / sizeof(char *);\n+    char **result = (char **)malloc((origSize + 2) * sizeof(char *));\n+    for (int i = 0; i < origSize; i++)\n+    {\n         result[i] = (char *)origargs[i];\n     }\n-    int tmpArgSize=18+strnlen(appDataDir, 512);\n-    char* tmpArgs = calloc(sizeof(char), tmpArgSize);\n-    strcpy(tmpArgs,\"-Djava.io.tmpdir=\");\n-    strcat(tmpArgs,appDataDir);\n-    result[origSize]=tmpArgs;\n+    int tmpArgSize = 18 + strnlen(appDataDir, 512);\n+    char *tmpArgs = calloc(sizeof(char), tmpArgSize);\n+    strcpy(tmpArgs, \"-Djava.io.tmpdir=\");\n+    strcat(tmpArgs, appDataDir);\n+    result[origSize] = tmpArgs;\n     argsize++;\n-    int userArgSize=13+strnlen(appDataDir, 512);\n-    char* userArgs = calloc(sizeof(char), userArgSize);\n-    strcpy(userArgs,\"-Duser.home=\");\n-    strcat(userArgs,appDataDir);\n-    result[origSize+1]=userArgs;\n+    int userArgSize = 13 + strnlen(appDataDir, 512);\n+    char *userArgs = calloc(sizeof(char), userArgSize);\n+    strcpy(userArgs, \"-Duser.home=\");\n+    strcat(userArgs, appDataDir);\n+    result[origSize + 1] = userArgs;\n     argsize++;\n-LOGE(stderr, \"CREATE ARGS done\");\n+    LOGE(stderr, \"CREATE ARGS done\");\n     return result;\n }\n \n-void registerMethodHandles (JNIEnv *aenv) {\n-    activityClass = (*aenv)->NewGlobalRef(aenv, \n-          (*aenv)->FindClass(aenv, \"com/gluonhq/helloandroid/MainActivity\"));\n+void registerMethodHandles(JNIEnv *aenv)\n+{\n+    activityClass = (*aenv)->NewGlobalRef(aenv,\n+                                          (*aenv)->FindClass(aenv, \"com/gluonhq/helloandroid/MainActivity\"));\n     activity_showIME = (*aenv)->GetStaticMethodID(aenv, activityClass, \"showIME\", \"()V\");\n     activity_hideIME = (*aenv)->GetStaticMethodID(aenv, activityClass, \"hideIME\", \"()V\");\n }\n \n-int JNI_OnLoad(JavaVM *vm, void *reserved) {\n+int JNI_OnLoad(JavaVM *vm, void *reserved)\n+{\n     androidVM = vm;\n-    (*vm)->GetEnv(vm, (void **) &androidEnv, JNI_VERSION_1_6);\n+    (*vm)->GetEnv(vm, (void **)&androidEnv, JNI_VERSION_1_6);\n     registerMethodHandles(androidEnv);\n-    LOGE(stderr, \"AndroidVM called into native, vm = %p, androidEnv = %p\",androidVM, androidEnv);\n+    LOGE(stderr, \"AndroidVM called into native, vm = %p, androidEnv = %p\", androidVM, androidEnv);\n     return JNI_VERSION_1_6;\n }\n \n-// === called from DALVIK. Minize work/dependencies here === // \n+// === called from DALVIK. Minize work/dependencies here === //", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f82bc272681b8b005b53faa1c10ba31408bff0f"}, "originalPosition": 132}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7064b8e8a72ab3b9efd7b45f7bde0909c20cb434", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/7064b8e8a72ab3b9efd7b45f7bde0909c20cb434", "committedDate": "2020-03-05T14:38:03Z", "message": "Added System property, fixed wrong calls etc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5Njg5MTUy", "url": "https://github.com/gluonhq/substrate/pull/404#pullrequestreview-369689152", "createdAt": "2020-03-05T15:53:49Z", "commit": {"oid": "7064b8e8a72ab3b9efd7b45f7bde0909c20cb434"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1Mzo0OVrOFyZKxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQxNTo1Mzo0OVrOFyZKxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NTQ3Nw==", "bodyText": "Probably we want to keep it true (via client plugin main is not called)", "url": "https://github.com/gluonhq/substrate/pull/404#discussion_r388385477", "createdAt": "2020-03-05T15:53:49Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/ProjectConfiguration.java", "diffHunk": "@@ -48,7 +48,7 @@\n \n     private boolean usePrismSW = false;\n     private boolean verbose = false;\n-    private boolean usePrecompiledCode = true;\n+    private boolean usePrecompiledCode;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7064b8e8a72ab3b9efd7b45f7bde0909c20cb434"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7843972297213dd7bd8c7e4f133de1821ce1313b", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/7843972297213dd7bd8c7e4f133de1821ce1313b", "committedDate": "2020-03-05T16:58:41Z", "message": "Reverted `--no-server` removal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5006420aa4120de1b9e7684a82c51bb76e204d34", "author": {"user": {"login": "lazar-mitrovic", "name": "Lazar Mitrovi\u0107"}}, "url": "https://github.com/gluonhq/substrate/commit/5006420aa4120de1b9e7684a82c51bb76e204d34", "committedDate": "2020-03-05T20:01:37Z", "message": "Fixed where default value is set"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5ODc0ODc4", "url": "https://github.com/gluonhq/substrate/pull/404#pullrequestreview-369874878", "createdAt": "2020-03-05T20:03:47Z", "commit": {"oid": "5006420aa4120de1b9e7684a82c51bb76e204d34"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMDowMzo0N1rOFyiJHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMDowMzo0N1rOFyiJHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUzMjUwOA==", "bodyText": "Issue found: Skipping configuration 'JNI_VERSION_1_8' since the value of 'JNI_VERSION_1_8' is unknown. Use -D if you want to check it. You can use -U to skip it explicitly.", "url": "https://github.com/gluonhq/substrate/pull/404#discussion_r388532508", "createdAt": "2020-03-05T20:03:47Z", "author": {"login": "eugener"}, "path": "src/main/resources/native/android/c/javafx_adapter.c", "diffHunk": "@@ -0,0 +1,96 @@\n+#include \"grandroid.h\"\n+\n+JNIEXPORT void JNICALL Java_com_gluonhq_helloandroid_MainActivity_nativeSetSurface(JNIEnv *env, jobject activity, jobject surface)\n+{\n+    LOGE(stderr, \"nativeSetSurface called, env at %p and size %ld, surface at %p\\n\", env, sizeof(JNIEnv), surface);\n+    window = ANativeWindow_fromSurface(env, surface);\n+    androidJfx_setNativeWindow(window);\n+    LOGE(stderr, \"native setSurface Ready, native window at %p\\n\", window);\n+}\n+\n+JNIEXPORT void JNICALL Java_com_gluonhq_helloandroid_MainActivity_nativeSetDataDir(JNIEnv *env, jobject that, jstring jdir)\n+{\n+    const char *cdir = (*env)->GetStringUTFChars(env, jdir, 0);\n+    int len = strnlen(cdir, 512);\n+    appDataDir = (char *)malloc(len + 1);\n+    strcpy(appDataDir, cdir);\n+    LOGE(stderr, \"appDataDir: %s\", appDataDir);\n+}\n+\n+JNIEXPORT jlong JNICALL Java_com_gluonhq_helloandroid_MainActivity_surfaceReady(JNIEnv *env, jobject activity, jobject surface, jfloat mydensity)\n+{\n+    LOGE(stderr, \"SurfaceReady, surface at %p\\n\", surface);\n+    window = ANativeWindow_fromSurface(env, surface);\n+    androidJfx_setNativeWindow(window);\n+    androidJfx_setDensity(mydensity);\n+    LOGE(stderr, \"SurfaceReady, native window at %p\\n\", window);\n+    density = mydensity;\n+    return (jlong)window;\n+}\n+\n+JNIEXPORT void JNICALL Java_com_gluonhq_helloandroid_MainActivity_nativeSurfaceRedrawNeeded(JNIEnv *env, jobject activity)\n+{\n+    LOGE(stderr, \"launcher, nativeSurfaceRedrawNeeded called. Invoke method on glass_monocle\\n\");\n+    androidJfx_requestGlassToRedraw();\n+}\n+\n+JNIEXPORT jint JNICALL\n+JNI_OnLoad_javafx_font(JavaVM *vm, void *reserved)\n+{\n+    LOGE(stderr, \"In dummy JNI_OnLoad_javafx_font\\n\");\n+#ifdef JNI_VERSION_1_8\n+    //min. returned JNI_VERSION required by JDK8 for builtin libraries\n+    JNIEnv *env;\n+    if ((*vm)->GetEnv(vm, (void **)&env, JNI_VERSION_1_8) != JNI_OK)\n+    {\n+        return JNI_VERSION_1_4;\n+    }\n+    return JNI_VERSION_1_8;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5006420aa4120de1b9e7684a82c51bb76e204d34"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5ODc0ODk2", "url": "https://github.com/gluonhq/substrate/pull/404#pullrequestreview-369874896", "createdAt": "2020-03-05T20:03:48Z", "commit": {"oid": "5006420aa4120de1b9e7684a82c51bb76e204d34"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMDowMzo0OFrOFyiJJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMDowMzo0OFrOFyiJJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUzMjUxNw==", "bodyText": "Issue found: Skipping configuration 'JNI_VERSION_1_8' since the value of 'JNI_VERSION_1_8' is unknown. Use -D if you want to check it. You can use -U to skip it explicitly.", "url": "https://github.com/gluonhq/substrate/pull/404#discussion_r388532517", "createdAt": "2020-03-05T20:03:48Z", "author": {"login": "eugener"}, "path": "src/main/resources/native/android/c/javafx_adapter.c", "diffHunk": "@@ -0,0 +1,96 @@\n+#include \"grandroid.h\"\n+\n+JNIEXPORT void JNICALL Java_com_gluonhq_helloandroid_MainActivity_nativeSetSurface(JNIEnv *env, jobject activity, jobject surface)\n+{\n+    LOGE(stderr, \"nativeSetSurface called, env at %p and size %ld, surface at %p\\n\", env, sizeof(JNIEnv), surface);\n+    window = ANativeWindow_fromSurface(env, surface);\n+    androidJfx_setNativeWindow(window);\n+    LOGE(stderr, \"native setSurface Ready, native window at %p\\n\", window);\n+}\n+\n+JNIEXPORT void JNICALL Java_com_gluonhq_helloandroid_MainActivity_nativeSetDataDir(JNIEnv *env, jobject that, jstring jdir)\n+{\n+    const char *cdir = (*env)->GetStringUTFChars(env, jdir, 0);\n+    int len = strnlen(cdir, 512);\n+    appDataDir = (char *)malloc(len + 1);\n+    strcpy(appDataDir, cdir);\n+    LOGE(stderr, \"appDataDir: %s\", appDataDir);\n+}\n+\n+JNIEXPORT jlong JNICALL Java_com_gluonhq_helloandroid_MainActivity_surfaceReady(JNIEnv *env, jobject activity, jobject surface, jfloat mydensity)\n+{\n+    LOGE(stderr, \"SurfaceReady, surface at %p\\n\", surface);\n+    window = ANativeWindow_fromSurface(env, surface);\n+    androidJfx_setNativeWindow(window);\n+    androidJfx_setDensity(mydensity);\n+    LOGE(stderr, \"SurfaceReady, native window at %p\\n\", window);\n+    density = mydensity;\n+    return (jlong)window;\n+}\n+\n+JNIEXPORT void JNICALL Java_com_gluonhq_helloandroid_MainActivity_nativeSurfaceRedrawNeeded(JNIEnv *env, jobject activity)\n+{\n+    LOGE(stderr, \"launcher, nativeSurfaceRedrawNeeded called. Invoke method on glass_monocle\\n\");\n+    androidJfx_requestGlassToRedraw();\n+}\n+\n+JNIEXPORT jint JNICALL\n+JNI_OnLoad_javafx_font(JavaVM *vm, void *reserved)\n+{\n+    LOGE(stderr, \"In dummy JNI_OnLoad_javafx_font\\n\");\n+#ifdef JNI_VERSION_1_8\n+    //min. returned JNI_VERSION required by JDK8 for builtin libraries\n+    JNIEnv *env;\n+    if ((*vm)->GetEnv(vm, (void **)&env, JNI_VERSION_1_8) != JNI_OK)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5006420aa4120de1b9e7684a82c51bb76e204d34"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5ODc0OTA3", "url": "https://github.com/gluonhq/substrate/pull/404#pullrequestreview-369874907", "createdAt": "2020-03-05T20:03:49Z", "commit": {"oid": "5006420aa4120de1b9e7684a82c51bb76e204d34"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMDowMzo0OVrOFyiJLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQyMDowMzo0OVrOFyiJLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUzMjUyNw==", "bodyText": "Issue found: Check buffer boundaries if used in a loop including recursive loops (CWE-120, CWE-20).", "url": "https://github.com/gluonhq/substrate/pull/404#discussion_r388532527", "createdAt": "2020-03-05T20:03:49Z", "author": {"login": "eugener"}, "path": "src/main/resources/native/android/c/launcher.c", "diffHunk": "@@ -224,9 +125,11 @@ static void *thread_func()\n {\n     ssize_t rdsz;\n     char buf[128];\n-    while((rdsz = read(pfd[0], buf, sizeof buf - 1)) > 0) {\n-        if(buf[rdsz - 1] == '\\n') --rdsz;\n-        buf[rdsz] = 0;  /* add null-terminator */\n+    while ((rdsz = read(pfd[0], buf, sizeof buf - 1)) > 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5006420aa4120de1b9e7684a82c51bb76e204d34"}, "originalPosition": 286}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5OTM0NjM0", "url": "https://github.com/gluonhq/substrate/pull/404#pullrequestreview-369934634", "createdAt": "2020-03-05T21:40:00Z", "commit": {"oid": "5006420aa4120de1b9e7684a82c51bb76e204d34"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2123, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}