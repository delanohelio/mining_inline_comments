{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyMDk3OTA4", "number": 569, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDowNToyN1rOD5ASqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNzo0MTowMVrOD5GAxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMTAwMjAyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/util/ProcessRunner.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDowNToyN1rOGQB7Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNzoyODoxN1rOGQKgUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2MTk0Mg==", "bodyText": "There should be a check for empty passwords. In any case, can't we even skip printing the first character of passwords?", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419461942", "createdAt": "2020-05-04T14:05:27Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/util/ProcessRunner.java", "diffHunk": "@@ -301,7 +316,13 @@ public static Integer executeWithFeedback(String name, String... args) throws IO\n \n     private Process setupProcess(String processName, File directory) throws IOException {\n         ProcessBuilder pb = new ProcessBuilder(args);\n-        Logger.logDebug(\"PB Command for \" +  processName + \": \" + String.join(\" \", pb.command()));\n+        String join = pb.command().stream().map(s -> {\n+            if (passwords.contains(s)) {\n+                return s.substring(0, 1) + \"******\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUzMjEwOA==", "bodyText": "hmm, it doesn't make much sense to call runner.setSecretArgs(\"\"), but that will cause an exception. I'll fix it.", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419532108", "createdAt": "2020-05-04T15:42:01Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/util/ProcessRunner.java", "diffHunk": "@@ -301,7 +316,13 @@ public static Integer executeWithFeedback(String name, String... args) throws IO\n \n     private Process setupProcess(String processName, File directory) throws IOException {\n         ProcessBuilder pb = new ProcessBuilder(args);\n-        Logger.logDebug(\"PB Command for \" +  processName + \": \" + String.join(\" \", pb.command()));\n+        String join = pb.command().stream().map(s -> {\n+            if (passwords.contains(s)) {\n+                return s.substring(0, 1) + \"******\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2MTk0Mg=="}, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTUzODk2OA==", "bodyText": "In fact, the issue affects the regular setArg(\"\") call, as that can lead to errors when processing the command, but this is probably for another issue.", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419538968", "createdAt": "2020-05-04T15:51:52Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/util/ProcessRunner.java", "diffHunk": "@@ -301,7 +316,13 @@ public static Integer executeWithFeedback(String name, String... args) throws IO\n \n     private Process setupProcess(String processName, File directory) throws IOException {\n         ProcessBuilder pb = new ProcessBuilder(args);\n-        Logger.logDebug(\"PB Command for \" +  processName + \": \" + String.join(\" \", pb.command()));\n+        String join = pb.command().stream().map(s -> {\n+            if (passwords.contains(s)) {\n+                return s.substring(0, 1) + \"******\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2MTk0Mg=="}, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYwMjUxMw==", "bodyText": "OK. If you spotted another issue, please file it before it gets forgotten.", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419602513", "createdAt": "2020-05-04T17:28:17Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/util/ProcessRunner.java", "diffHunk": "@@ -301,7 +316,13 @@ public static Integer executeWithFeedback(String name, String... args) throws IO\n \n     private Process setupProcess(String processName, File directory) throws IOException {\n         ProcessBuilder pb = new ProcessBuilder(args);\n-        Logger.logDebug(\"PB Command for \" +  processName + \": \" + String.join(\" \", pb.command()));\n+        String join = pb.command().stream().map(s -> {\n+            if (passwords.contains(s)) {\n+                return s.substring(0, 1) + \"******\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2MTk0Mg=="}, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMTAwNzA1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/ProjectConfiguration.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDowNjoyOVrOGQB-Mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNTo1NDowOVrOGQGucw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2MjcwNw==", "bodyText": "Update javadoc sentence.", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419462707", "createdAt": "2020-05-04T14:06:29Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/ProjectConfiguration.java", "diffHunk": "@@ -269,16 +269,16 @@ public String getClasspath() {\n         return classpath;\n     }\n \n-    public IosSigningConfiguration getIosSigningConfiguration() {\n-        return iosSigningConfiguration;\n+    public ReleaseConfiguration getReleaseConfiguration() {\n+        return releaseConfiguration;\n     }\n \n     /**\n      * Sets some iOS specific parameters", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0MDU5NQ==", "bodyText": "done", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419540595", "createdAt": "2020-05-04T15:54:09Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/ProjectConfiguration.java", "diffHunk": "@@ -269,16 +269,16 @@ public String getClasspath() {\n         return classpath;\n     }\n \n-    public IosSigningConfiguration getIosSigningConfiguration() {\n-        return iosSigningConfiguration;\n+    public ReleaseConfiguration getReleaseConfiguration() {\n+        return releaseConfiguration;\n     }\n \n     /**\n      * Sets some iOS specific parameters", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2MjcwNw=="}, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMTAwOTkwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/ProjectConfiguration.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDowNzowMVrOGQB_0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNTo1NDoyMlrOGQGvFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2MzEyMw==", "bodyText": "Change printed variable name as well.", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419463123", "createdAt": "2020-05-04T14:07:01Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/ProjectConfiguration.java", "diffHunk": "@@ -298,7 +298,7 @@ public String toString() {\n                 \", compilerArgs=\" + compilerArgs +\n                 \", appId='\" + appId + '\\'' +\n                 \", appName='\" + appName + '\\'' +\n-                \", iosConfiguration='\" + iosSigningConfiguration + '\\'' +\n+                \", iosConfiguration='\" + releaseConfiguration + '\\'' +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0MDc1OA==", "bodyText": "done", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419540758", "createdAt": "2020-05-04T15:54:22Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/ProjectConfiguration.java", "diffHunk": "@@ -298,7 +298,7 @@ public String toString() {\n                 \", compilerArgs=\" + compilerArgs +\n                 \", appId='\" + appId + '\\'' +\n                 \", appName='\" + appName + '\\'' +\n-                \", iosConfiguration='\" + iosSigningConfiguration + '\\'' +\n+                \", iosConfiguration='\" + releaseConfiguration + '\\'' +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2MzEyMw=="}, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMTAxMTc2OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/model/InternalProjectConfiguration.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDowNzoyNFrOGQCA5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNTo1NDo0MFrOGQGwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2MzM5OQ==", "bodyText": "Change printed variable name as well.", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419463399", "createdAt": "2020-05-04T14:07:24Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/model/InternalProjectConfiguration.java", "diffHunk": "@@ -498,7 +497,7 @@ public String toString() {\n                 \", runtimeArgsList=\" + runtimeArgsList +\n                 \", releaseSymbolsList=\" + releaseSymbolsList +\n                 \", appName='\" + getAppName() + '\\'' +\n-                \", iosConfiguration='\" + iosSigningConfiguration + '\\'' +\n+                \", iosConfiguration='\" + releaseConfiguration + '\\'' +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0MTA0NQ==", "bodyText": "done", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419541045", "createdAt": "2020-05-04T15:54:40Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/model/InternalProjectConfiguration.java", "diffHunk": "@@ -498,7 +497,7 @@ public String toString() {\n                 \", runtimeArgsList=\" + runtimeArgsList +\n                 \", releaseSymbolsList=\" + releaseSymbolsList +\n                 \", appName='\" + getAppName() + '\\'' +\n-                \", iosConfiguration='\" + iosSigningConfiguration + '\\'' +\n+                \", iosConfiguration='\" + releaseConfiguration + '\\'' +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2MzM5OQ=="}, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMTAyNDgwOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/util/FileOps.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDoxMDoxM1rOGQCJCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNTo1NTozOVrOGQGypg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2NTQ4MA==", "bodyText": "itemName refers to an XML attribute of the XML element tag? Perhaps rename it to attributeName?", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419465480", "createdAt": "2020-05-04T14:10:13Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/util/FileOps.java", "diffHunk": "@@ -311,11 +319,49 @@ public static void writeFileLines(Path file, List<String> lines) throws IOExcept\n     public static void replaceInFile(Path file, String original, String replacement) throws IOException {\n         InputStream inputStream = Files.newInputStream(file);\n         List<String> lines = readFileLines(inputStream);\n-        for (int i=0; i<lines.size(); i++)\n+        for (int i = 0; i < lines.size(); i++) {\n             lines.set(i, lines.get(i).replaceAll(original, replacement));\n+        }\n         writeFileLines(file, lines);\n     }\n \n+    /**\n+     * Parses an xml file, looking for a given item within a given tag, and retrieves\n+     * its value, if found\n+     *\n+     * @param fileName the full path of an xml file\n+     * @param tag the tag name\n+     * @param itemName the item name", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0MTY3MA==", "bodyText": "done", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419541670", "createdAt": "2020-05-04T15:55:39Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/util/FileOps.java", "diffHunk": "@@ -311,11 +319,49 @@ public static void writeFileLines(Path file, List<String> lines) throws IOExcept\n     public static void replaceInFile(Path file, String original, String replacement) throws IOException {\n         InputStream inputStream = Files.newInputStream(file);\n         List<String> lines = readFileLines(inputStream);\n-        for (int i=0; i<lines.size(); i++)\n+        for (int i = 0; i < lines.size(); i++) {\n             lines.set(i, lines.get(i).replaceAll(original, replacement));\n+        }\n         writeFileLines(file, lines);\n     }\n \n+    /**\n+     * Parses an xml file, looking for a given item within a given tag, and retrieves\n+     * its value, if found\n+     *\n+     * @param fileName the full path of an xml file\n+     * @param tag the tag name\n+     * @param itemName the item name", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2NTQ4MA=="}, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMTAyNTg1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/util/FileOps.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDoxMDoyOFrOGQCJrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNTo1NjozNVrOGQG1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2NTY0Nw==", "bodyText": "Did you really mean contains instead of equals? If so, you might want to add this information in the javadoc.", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419465647", "createdAt": "2020-05-04T14:10:28Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/util/FileOps.java", "diffHunk": "@@ -311,11 +319,49 @@ public static void writeFileLines(Path file, List<String> lines) throws IOExcept\n     public static void replaceInFile(Path file, String original, String replacement) throws IOException {\n         InputStream inputStream = Files.newInputStream(file);\n         List<String> lines = readFileLines(inputStream);\n-        for (int i=0; i<lines.size(); i++)\n+        for (int i = 0; i < lines.size(); i++) {\n             lines.set(i, lines.get(i).replaceAll(original, replacement));\n+        }\n         writeFileLines(file, lines);\n     }\n \n+    /**\n+     * Parses an xml file, looking for a given item within a given tag, and retrieves\n+     * its value, if found\n+     *\n+     * @param fileName the full path of an xml file\n+     * @param tag the tag name\n+     * @param itemName the item name\n+     * @return the value if found, null otherwise\n+     * @throws IOException\n+     */\n+    public static String getNodeValue(String fileName, String tag, String itemName) throws IOException {\n+        try {\n+            File xmlFile = new File(Objects.requireNonNull(fileName));\n+            if (!xmlFile.exists() || !fileName.endsWith(\".xml\")) {\n+                throw new IOException(\"Not a valid file: \" + fileName);\n+            }\n+\n+            DocumentBuilder builder = DocumentBuilderFactory.newInstance().newDocumentBuilder();\n+            Document document = builder.parse(xmlFile);\n+\n+            NodeList nodeList = document.getElementsByTagName(tag);\n+            for (int n = 0; n < nodeList.getLength(); n++) {\n+                NamedNodeMap attributes = nodeList.item(n).getAttributes();\n+                for (int i = 0; i < attributes.getLength(); i++) {\n+                    Node item = attributes.item(i);\n+                    String name = item.getNodeName();\n+                    if (name != null && name.contains(itemName)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0MjMyMQ==", "bodyText": "Yes, I meant contains (the reason is we can have different namespaces android:... or a:...)", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419542321", "createdAt": "2020-05-04T15:56:35Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/util/FileOps.java", "diffHunk": "@@ -311,11 +319,49 @@ public static void writeFileLines(Path file, List<String> lines) throws IOExcept\n     public static void replaceInFile(Path file, String original, String replacement) throws IOException {\n         InputStream inputStream = Files.newInputStream(file);\n         List<String> lines = readFileLines(inputStream);\n-        for (int i=0; i<lines.size(); i++)\n+        for (int i = 0; i < lines.size(); i++) {\n             lines.set(i, lines.get(i).replaceAll(original, replacement));\n+        }\n         writeFileLines(file, lines);\n     }\n \n+    /**\n+     * Parses an xml file, looking for a given item within a given tag, and retrieves\n+     * its value, if found\n+     *\n+     * @param fileName the full path of an xml file\n+     * @param tag the tag name\n+     * @param itemName the item name\n+     * @return the value if found, null otherwise\n+     * @throws IOException\n+     */\n+    public static String getNodeValue(String fileName, String tag, String itemName) throws IOException {\n+        try {\n+            File xmlFile = new File(Objects.requireNonNull(fileName));\n+            if (!xmlFile.exists() || !fileName.endsWith(\".xml\")) {\n+                throw new IOException(\"Not a valid file: \" + fileName);\n+            }\n+\n+            DocumentBuilder builder = DocumentBuilderFactory.newInstance().newDocumentBuilder();\n+            Document document = builder.parse(xmlFile);\n+\n+            NodeList nodeList = document.getElementsByTagName(tag);\n+            for (int n = 0; n < nodeList.getLength(); n++) {\n+                NamedNodeMap attributes = nodeList.item(n).getAttributes();\n+                for (int i = 0; i < attributes.getLength(); i++) {\n+                    Node item = attributes.item(i);\n+                    String name = item.getNodeName();\n+                    if (name != null && name.contains(itemName)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2NTY0Nw=="}, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMTA2NzM1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDoxOTo0OVrOGQCjgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNjowNTowNVrOGQHMbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ3MjI1OQ==", "bodyText": "The versionCode variable might be null, in which case the replacement will not work as expected when releaseConfiguration.getVersionCode() is not empty. I would remove the usage of Optional and replace the if check like this:\nString versionCode = FileOps.getNodeValue(userManifest.toString(), \"manifest\", \":versionCode\");\nString newVersionCode = releaseConfiguration.getVersionCode();\nif (versionCode != null && newVersionCode != null) {\n\nThe same pattern can be used on the other two replacements.", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419472259", "createdAt": "2020-05-04T14:19:49Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -563,17 +585,47 @@ private Path prepareAndroidManifest() throws IOException {\n         Path targetSourcePath = paths.getSourcePath().resolve(targetOS);\n \n         Path userManifest = targetSourcePath.resolve(Constants.MANIFEST_FILE);\n+        ReleaseConfiguration releaseConfiguration = projectConfiguration.getReleaseConfiguration();\n+\n         if (!Files.exists(userManifest)) {\n             // copy manifest to gensrc/android\n             Path androidPath = paths.getGenPath().resolve(targetOS);\n             Path genManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n             Logger.logDebug(\"Copy \" + Constants.MANIFEST_FILE + \" to \" + genManifest.toString());\n             FileOps.copyResource(\"/native/android/AndroidManifest.xml\", genManifest);\n             FileOps.replaceInFile(genManifest, \"package='com.gluonhq.helloandroid'\", \"package='\" + getAndroidPackageName() + \"'\");\n-            FileOps.replaceInFile(genManifest, \"A HelloGraal\", projectConfiguration.getAppName());\n+            String newAppLabel = Optional.ofNullable(releaseConfiguration.getAppLabel())\n+                    .orElse(projectConfiguration.getAppName());\n+            FileOps.replaceInFile(genManifest, \"A HelloGraal\", newAppLabel);\n+            String newVersionCode = Optional.ofNullable(releaseConfiguration.getVersionCode())\n+                    .orElse(DEFAULT_CODE_VERSION);\n+            FileOps.replaceInFile(genManifest, \":versionCode='1'\", \":versionCode='\" + newVersionCode + \"'\");\n+            String newVersionName = Optional.ofNullable(releaseConfiguration.getVersionName())\n+                    .orElse(DEFAULT_CODE_NAME);\n+            FileOps.replaceInFile(genManifest, \":versionName='1.0'\", \":versionName='\" + newVersionName + \"'\");\n             Logger.logInfo(\"Default Android manifest generated in \" + genManifest.toString() + \".\\n\" +\n                     \"Consider copying it to \" + targetSourcePath.toString() + \" before performing any modification\");\n             return androidPath;\n+        } else {\n+            // update manifest in src/android\n+            String versionCode = FileOps.getNodeValue(userManifest.toString(), \"manifest\", \":versionCode\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU0ODI2OQ==", "bodyText": "makes sense, done", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419548269", "createdAt": "2020-05-04T16:05:05Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -563,17 +585,47 @@ private Path prepareAndroidManifest() throws IOException {\n         Path targetSourcePath = paths.getSourcePath().resolve(targetOS);\n \n         Path userManifest = targetSourcePath.resolve(Constants.MANIFEST_FILE);\n+        ReleaseConfiguration releaseConfiguration = projectConfiguration.getReleaseConfiguration();\n+\n         if (!Files.exists(userManifest)) {\n             // copy manifest to gensrc/android\n             Path androidPath = paths.getGenPath().resolve(targetOS);\n             Path genManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n             Logger.logDebug(\"Copy \" + Constants.MANIFEST_FILE + \" to \" + genManifest.toString());\n             FileOps.copyResource(\"/native/android/AndroidManifest.xml\", genManifest);\n             FileOps.replaceInFile(genManifest, \"package='com.gluonhq.helloandroid'\", \"package='\" + getAndroidPackageName() + \"'\");\n-            FileOps.replaceInFile(genManifest, \"A HelloGraal\", projectConfiguration.getAppName());\n+            String newAppLabel = Optional.ofNullable(releaseConfiguration.getAppLabel())\n+                    .orElse(projectConfiguration.getAppName());\n+            FileOps.replaceInFile(genManifest, \"A HelloGraal\", newAppLabel);\n+            String newVersionCode = Optional.ofNullable(releaseConfiguration.getVersionCode())\n+                    .orElse(DEFAULT_CODE_VERSION);\n+            FileOps.replaceInFile(genManifest, \":versionCode='1'\", \":versionCode='\" + newVersionCode + \"'\");\n+            String newVersionName = Optional.ofNullable(releaseConfiguration.getVersionName())\n+                    .orElse(DEFAULT_CODE_NAME);\n+            FileOps.replaceInFile(genManifest, \":versionName='1.0'\", \":versionName='\" + newVersionName + \"'\");\n             Logger.logInfo(\"Default Android manifest generated in \" + genManifest.toString() + \".\\n\" +\n                     \"Consider copying it to \" + targetSourcePath.toString() + \" before performing any modification\");\n             return androidPath;\n+        } else {\n+            // update manifest in src/android\n+            String versionCode = FileOps.getNodeValue(userManifest.toString(), \"manifest\", \":versionCode\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ3MjI1OQ=="}, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 121}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMTA4NDI5OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/util/ios/InfoPlist.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDoyMzo0MFrOGQCuSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNjowNzo1M1rOGQHTwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ3NTAxOQ==", "bodyText": "Instead of the Optional pattern, you might want to consider this:\nString bundleName = Objects.requireNonNullElse(releaseConfiguration.getBundleName(), appName);", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419475019", "createdAt": "2020-05-04T14:23:40Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/util/ios/InfoPlist.java", "diffHunk": "@@ -100,6 +105,10 @@ public Path processInfoPlist() throws IOException {\n         String appName = projectConfiguration.getAppName();\n         String executableName = getExecutableName(appName, sourceOS);\n         String bundleIdName = getBundleId(getPlistPath(paths, sourceOS), projectConfiguration.getMainClassName());\n+        ReleaseConfiguration releaseConfiguration = projectConfiguration.getReleaseConfiguration();\n+        String bundleName = Optional.ofNullable(releaseConfiguration.getBundleName()).orElse(appName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU1MDE0NQ==", "bodyText": "Hmm, ok. Done", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419550145", "createdAt": "2020-05-04T16:07:53Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/util/ios/InfoPlist.java", "diffHunk": "@@ -100,6 +105,10 @@ public Path processInfoPlist() throws IOException {\n         String appName = projectConfiguration.getAppName();\n         String executableName = getExecutableName(appName, sourceOS);\n         String bundleIdName = getBundleId(getPlistPath(paths, sourceOS), projectConfiguration.getMainClassName());\n+        ReleaseConfiguration releaseConfiguration = projectConfiguration.getReleaseConfiguration();\n+        String bundleName = Optional.ofNullable(releaseConfiguration.getBundleName()).orElse(appName);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ3NTAxOQ=="}, "originalCommit": {"oid": "aadbc1957b7e53e3582b0c4a10845dbbce489206"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMTkzOTI1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNzo0MTowMVrOGQK-6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxODoyNjoxOVrOGQMrTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYxMDM0NQ==", "bodyText": "Are you sure that keyPass and keyStorePass shouldn't be switched?", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419610345", "createdAt": "2020-05-04T17:41:01Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -487,15 +494,29 @@ private int zipAlign(Path buildToolsPath, String unalignedApk, String alignedApk\n     }\n \n     private int sign(Path buildToolsPath, String alignedApk) throws IOException, InterruptedException {\n-        createDevelopKeystore();\n+        ReleaseConfiguration releaseConfiguration = projectConfiguration.getReleaseConfiguration();\n+        String keyStorePath = releaseConfiguration.getProvidedKeyStorePath();\n+        String keyStorePass = releaseConfiguration.getProvidedKeyStorePassword();\n+        String keyAlias = releaseConfiguration.getProvidedKeyAlias();\n+        String keyPass = releaseConfiguration.getProvidedKeyAliasPassword();\n+        if (keyStorePath == null ||\n+                !keyStorePath.endsWith(\".keystore\") || !Files.exists(Path.of(keyStorePath)) ||\n+                keyAlias == null || keyStorePass == null || keyPass == null) {\n+            // default to debug keystore\n+            keyStorePath = createDevelopKeystore().toString();\n+            keyStorePass = DEFAULT_DEBUG_KEY_STORE_PASSWORD;\n+            keyAlias = DEFAULT_DEBUG_KEY_ALIAS;\n+            keyPass = DEFAULT_DEBUG_KEY_ALIAS_PASSWORD;\n+        }\n \n         String apkSignerCmd = buildToolsPath.resolve(\"apksigner\").toString();\n         ProcessRunner sign =  new ProcessRunner(apkSignerCmd, \"sign\", \"--ks\",\n-                Constants.USER_SUBSTRATE_PATH.resolve(Constants.ANDROID_KEYSTORE).toString(),\n-                \"--ks-key-alias\", \"androiddebugkey\",\n-                \"--ks-pass\", \"pass:android\",\n-                \"--key-pass\", \"pass:android\",\n-                alignedApk);\n+                keyStorePath, \"--ks-key-alias\", keyAlias);\n+        sign.addArg(\"--ks-pass\");\n+        sign.addSecretArg(\"pass:\" + keyPass);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4abd0164f7bc9ee3f67e9024cbd2eaa1a199af63"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYzODA5NQ==", "bodyText": "oh, good catch. Fixed", "url": "https://github.com/gluonhq/substrate/pull/569#discussion_r419638095", "createdAt": "2020-05-04T18:26:19Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -487,15 +494,29 @@ private int zipAlign(Path buildToolsPath, String unalignedApk, String alignedApk\n     }\n \n     private int sign(Path buildToolsPath, String alignedApk) throws IOException, InterruptedException {\n-        createDevelopKeystore();\n+        ReleaseConfiguration releaseConfiguration = projectConfiguration.getReleaseConfiguration();\n+        String keyStorePath = releaseConfiguration.getProvidedKeyStorePath();\n+        String keyStorePass = releaseConfiguration.getProvidedKeyStorePassword();\n+        String keyAlias = releaseConfiguration.getProvidedKeyAlias();\n+        String keyPass = releaseConfiguration.getProvidedKeyAliasPassword();\n+        if (keyStorePath == null ||\n+                !keyStorePath.endsWith(\".keystore\") || !Files.exists(Path.of(keyStorePath)) ||\n+                keyAlias == null || keyStorePass == null || keyPass == null) {\n+            // default to debug keystore\n+            keyStorePath = createDevelopKeystore().toString();\n+            keyStorePass = DEFAULT_DEBUG_KEY_STORE_PASSWORD;\n+            keyAlias = DEFAULT_DEBUG_KEY_ALIAS;\n+            keyPass = DEFAULT_DEBUG_KEY_ALIAS_PASSWORD;\n+        }\n \n         String apkSignerCmd = buildToolsPath.resolve(\"apksigner\").toString();\n         ProcessRunner sign =  new ProcessRunner(apkSignerCmd, \"sign\", \"--ks\",\n-                Constants.USER_SUBSTRATE_PATH.resolve(Constants.ANDROID_KEYSTORE).toString(),\n-                \"--ks-key-alias\", \"androiddebugkey\",\n-                \"--ks-pass\", \"pass:android\",\n-                \"--key-pass\", \"pass:android\",\n-                alignedApk);\n+                keyStorePath, \"--ks-key-alias\", keyAlias);\n+        sign.addArg(\"--ks-pass\");\n+        sign.addSecretArg(\"pass:\" + keyPass);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYxMDM0NQ=="}, "originalCommit": {"oid": "4abd0164f7bc9ee3f67e9024cbd2eaa1a199af63"}, "originalPosition": 57}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2896, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}