{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NTY2OTE1", "number": 356, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoyMTowNVrODgrFLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDowMjowNVrODhdlrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTg2ODYyOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoyMTowNVrOFrASJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzowMjoxOFrOFrBc7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzNzczNQ==", "bodyText": "Is it really critical for an icon image to exist?", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380637735", "createdAt": "2020-02-18T12:21:05Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -150,23 +179,28 @@ public boolean link() throws IOException, InterruptedException {\n         Files.createDirectories(dalvikBinPath);\n         Files.createDirectories(dalvikLibPath);\n         Files.createDirectories(dalvikLibArm64Path);\n-        Path androidManifestPath = dalvikPath.resolve(\"AndroidManifest.xml\");\n+        Path androidManifestDalvikPath = dalvikPath.resolve(Constants.MANIFEST_FILE);\n         Path dalvikActivityPackage = dalvikClassPath.resolve(\"com/gluonhq/helloandroid\");\n         Path dalvikKeyCodePackage = dalvikClassPath.resolve(\"javafx/scene/input\");\n         FileOps.copyResource(\"/native/android/dalvik/MainActivity.class\", dalvikActivityPackage.resolve(\"MainActivity.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/MainActivity$1.class\", dalvikActivityPackage.resolve(\"MainActivity$1.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/MainActivity$InternalSurfaceView.class\", dalvikActivityPackage.resolve(\"MainActivity$InternalSurfaceView.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/KeyCode.class\", dalvikKeyCodePackage.resolve(\"KeyCode.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/KeyCode$KeyCodeClass.class\", dalvikKeyCodePackage.resolve(\"KeyCode$KeyCodeClass.class\"));\n-        FileOps.copyResource(\"/native/android/AndroidManifest.xml\", dalvikPath.resolve(\"AndroidManifest.xml\"));\n-        FileOps.replaceInFile(dalvikPath.resolve(\"AndroidManifest.xml\"), \"package='com.gluonhq.helloandroid'\", \"package='\" + projectConfiguration.getAppId() + \"'\");\n-        FileOps.replaceInFile(dalvikPath.resolve(\"AndroidManifest.xml\"), \"A HelloGraal\", projectConfiguration.getAppName());\n \n-        // resources\n-       for (String iconFolder : iconFolders) {\n+        Path androidManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n+        if (!Files.exists(androidManifest)) {\n+            throw new IOException(\"File \" + androidManifest.toString() + \" not found\");\n+        }\n+        FileOps.copyFile(androidManifest, androidManifestDalvikPath);\n+        for (String iconFolder : iconFolders) {\n+            Path iconPath = androidPath.resolve(\"assets\").resolve(\"res\").resolve(iconFolder).resolve(\"ic_launcher.png\");\n+            if (!Files.exists(iconPath)) {\n+                throw new IOException(\"File \" + iconPath.toString() + \" not found\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8497defcbbc04228c4af2ca859610dcd3d43ba5"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzODU1NQ==", "bodyText": "Yes, aapt package will fail if these icons are not there.", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380638555", "createdAt": "2020-02-18T12:22:46Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -150,23 +179,28 @@ public boolean link() throws IOException, InterruptedException {\n         Files.createDirectories(dalvikBinPath);\n         Files.createDirectories(dalvikLibPath);\n         Files.createDirectories(dalvikLibArm64Path);\n-        Path androidManifestPath = dalvikPath.resolve(\"AndroidManifest.xml\");\n+        Path androidManifestDalvikPath = dalvikPath.resolve(Constants.MANIFEST_FILE);\n         Path dalvikActivityPackage = dalvikClassPath.resolve(\"com/gluonhq/helloandroid\");\n         Path dalvikKeyCodePackage = dalvikClassPath.resolve(\"javafx/scene/input\");\n         FileOps.copyResource(\"/native/android/dalvik/MainActivity.class\", dalvikActivityPackage.resolve(\"MainActivity.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/MainActivity$1.class\", dalvikActivityPackage.resolve(\"MainActivity$1.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/MainActivity$InternalSurfaceView.class\", dalvikActivityPackage.resolve(\"MainActivity$InternalSurfaceView.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/KeyCode.class\", dalvikKeyCodePackage.resolve(\"KeyCode.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/KeyCode$KeyCodeClass.class\", dalvikKeyCodePackage.resolve(\"KeyCode$KeyCodeClass.class\"));\n-        FileOps.copyResource(\"/native/android/AndroidManifest.xml\", dalvikPath.resolve(\"AndroidManifest.xml\"));\n-        FileOps.replaceInFile(dalvikPath.resolve(\"AndroidManifest.xml\"), \"package='com.gluonhq.helloandroid'\", \"package='\" + projectConfiguration.getAppId() + \"'\");\n-        FileOps.replaceInFile(dalvikPath.resolve(\"AndroidManifest.xml\"), \"A HelloGraal\", projectConfiguration.getAppName());\n \n-        // resources\n-       for (String iconFolder : iconFolders) {\n+        Path androidManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n+        if (!Files.exists(androidManifest)) {\n+            throw new IOException(\"File \" + androidManifest.toString() + \" not found\");\n+        }\n+        FileOps.copyFile(androidManifest, androidManifestDalvikPath);\n+        for (String iconFolder : iconFolders) {\n+            Path iconPath = androidPath.resolve(\"assets\").resolve(\"res\").resolve(iconFolder).resolve(\"ic_launcher.png\");\n+            if (!Files.exists(iconPath)) {\n+                throw new IOException(\"File \" + iconPath.toString() + \" not found\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzNzczNQ=="}, "originalCommit": {"oid": "a8497defcbbc04228c4af2ca859610dcd3d43ba5"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY1Njg3OA==", "bodyText": "OK.", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380656878", "createdAt": "2020-02-18T13:02:18Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -150,23 +179,28 @@ public boolean link() throws IOException, InterruptedException {\n         Files.createDirectories(dalvikBinPath);\n         Files.createDirectories(dalvikLibPath);\n         Files.createDirectories(dalvikLibArm64Path);\n-        Path androidManifestPath = dalvikPath.resolve(\"AndroidManifest.xml\");\n+        Path androidManifestDalvikPath = dalvikPath.resolve(Constants.MANIFEST_FILE);\n         Path dalvikActivityPackage = dalvikClassPath.resolve(\"com/gluonhq/helloandroid\");\n         Path dalvikKeyCodePackage = dalvikClassPath.resolve(\"javafx/scene/input\");\n         FileOps.copyResource(\"/native/android/dalvik/MainActivity.class\", dalvikActivityPackage.resolve(\"MainActivity.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/MainActivity$1.class\", dalvikActivityPackage.resolve(\"MainActivity$1.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/MainActivity$InternalSurfaceView.class\", dalvikActivityPackage.resolve(\"MainActivity$InternalSurfaceView.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/KeyCode.class\", dalvikKeyCodePackage.resolve(\"KeyCode.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/KeyCode$KeyCodeClass.class\", dalvikKeyCodePackage.resolve(\"KeyCode$KeyCodeClass.class\"));\n-        FileOps.copyResource(\"/native/android/AndroidManifest.xml\", dalvikPath.resolve(\"AndroidManifest.xml\"));\n-        FileOps.replaceInFile(dalvikPath.resolve(\"AndroidManifest.xml\"), \"package='com.gluonhq.helloandroid'\", \"package='\" + projectConfiguration.getAppId() + \"'\");\n-        FileOps.replaceInFile(dalvikPath.resolve(\"AndroidManifest.xml\"), \"A HelloGraal\", projectConfiguration.getAppName());\n \n-        // resources\n-       for (String iconFolder : iconFolders) {\n+        Path androidManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n+        if (!Files.exists(androidManifest)) {\n+            throw new IOException(\"File \" + androidManifest.toString() + \" not found\");\n+        }\n+        FileOps.copyFile(androidManifest, androidManifestDalvikPath);\n+        for (String iconFolder : iconFolders) {\n+            Path iconPath = androidPath.resolve(\"assets\").resolve(\"res\").resolve(iconFolder).resolve(\"ic_launcher.png\");\n+            if (!Files.exists(iconPath)) {\n+                throw new IOException(\"File \" + iconPath.toString() + \" not found\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzNzczNQ=="}, "originalCommit": {"oid": "a8497defcbbc04228c4af2ca859610dcd3d43ba5"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTg3NDk3OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoyMjo1NlrOFrAVvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDoxMTozN1rOFsNemw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzODY1Mg==", "bodyText": "why is this \"Dalvik\" ?", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380638652", "createdAt": "2020-02-18T12:22:56Z", "author": {"login": "johanvos"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -150,23 +179,28 @@ public boolean link() throws IOException, InterruptedException {\n         Files.createDirectories(dalvikBinPath);\n         Files.createDirectories(dalvikLibPath);\n         Files.createDirectories(dalvikLibArm64Path);\n-        Path androidManifestPath = dalvikPath.resolve(\"AndroidManifest.xml\");\n+        Path androidManifestDalvikPath = dalvikPath.resolve(Constants.MANIFEST_FILE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0MDg3Nw==", "bodyText": "We use an internal folder gvm/dalvik where the files to create the apk are added. Maybe we should rename this to something different?", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380640877", "createdAt": "2020-02-18T12:27:54Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -150,23 +179,28 @@ public boolean link() throws IOException, InterruptedException {\n         Files.createDirectories(dalvikBinPath);\n         Files.createDirectories(dalvikLibPath);\n         Files.createDirectories(dalvikLibArm64Path);\n-        Path androidManifestPath = dalvikPath.resolve(\"AndroidManifest.xml\");\n+        Path androidManifestDalvikPath = dalvikPath.resolve(Constants.MANIFEST_FILE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzODY1Mg=="}, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0Nzk3Mg==", "bodyText": "yes, this has nothing to do with dalvik (the only dalvik-relevant part we have is where the Activity and related ancient Java files are)", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380647972", "createdAt": "2020-02-18T12:43:19Z", "author": {"login": "johanvos"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -150,23 +179,28 @@ public boolean link() throws IOException, InterruptedException {\n         Files.createDirectories(dalvikBinPath);\n         Files.createDirectories(dalvikLibPath);\n         Files.createDirectories(dalvikLibArm64Path);\n-        Path androidManifestPath = dalvikPath.resolve(\"AndroidManifest.xml\");\n+        Path androidManifestDalvikPath = dalvikPath.resolve(Constants.MANIFEST_FILE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzODY1Mg=="}, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0OTczOA==", "bodyText": "OK, filed #359 for that. Any suggestion? apk?", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380649738", "createdAt": "2020-02-18T12:47:04Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -150,23 +179,28 @@ public boolean link() throws IOException, InterruptedException {\n         Files.createDirectories(dalvikBinPath);\n         Files.createDirectories(dalvikLibPath);\n         Files.createDirectories(dalvikLibArm64Path);\n-        Path androidManifestPath = dalvikPath.resolve(\"AndroidManifest.xml\");\n+        Path androidManifestDalvikPath = dalvikPath.resolve(Constants.MANIFEST_FILE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzODY1Mg=="}, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg5Njk4OQ==", "bodyText": "in this part of the code, since we're referring to the Android Manifest path, I think androidManifestPath is the best name.", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r381896989", "createdAt": "2020-02-20T10:01:33Z", "author": {"login": "johanvos"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -150,23 +179,28 @@ public boolean link() throws IOException, InterruptedException {\n         Files.createDirectories(dalvikBinPath);\n         Files.createDirectories(dalvikLibPath);\n         Files.createDirectories(dalvikLibArm64Path);\n-        Path androidManifestPath = dalvikPath.resolve(\"AndroidManifest.xml\");\n+        Path androidManifestDalvikPath = dalvikPath.resolve(Constants.MANIFEST_FILE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzODY1Mg=="}, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkwMjQ5MQ==", "bodyText": "Ok, changed", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r381902491", "createdAt": "2020-02-20T10:11:37Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -150,23 +179,28 @@ public boolean link() throws IOException, InterruptedException {\n         Files.createDirectories(dalvikBinPath);\n         Files.createDirectories(dalvikLibPath);\n         Files.createDirectories(dalvikLibArm64Path);\n-        Path androidManifestPath = dalvikPath.resolve(\"AndroidManifest.xml\");\n+        Path androidManifestDalvikPath = dalvikPath.resolve(Constants.MANIFEST_FILE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzODY1Mg=="}, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTg3NTYzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoyMzoxMlrOFrAWLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjozODoxNVrOFrAwtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzODc2Ng==", "bodyText": "This block can be moved to a separate method.", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380638766", "createdAt": "2020-02-18T12:23:12Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8497defcbbc04228c4af2ca859610dcd3d43ba5"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0NTU1OA==", "bodyText": "Done", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380645558", "createdAt": "2020-02-18T12:38:15Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzODc2Ng=="}, "originalCommit": {"oid": "a8497defcbbc04228c4af2ca859610dcd3d43ba5"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTkyMjMxOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjozOTowMFrOFrAyDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzowMjo0N1rOFrBd2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0NTkwMw==", "bodyText": "Shouldn't this be .resolve(\"assets\").resolve(\"res\")?", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380645903", "createdAt": "2020-02-18T12:39:00Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files\n+        String sourceOS = projectConfiguration.getTargetTriplet().getOs();\n+        Path rootPath = paths.getSourcePath().resolve(sourceOS);\n+        Path userManifest = rootPath.resolve(Constants.MANIFEST_FILE);\n+        Path androidPath;\n+        if (!Files.exists(userManifest)) {\n+            // copy manifest and assets to gensrc/android\n+            androidPath = paths.getGenPath().resolve(sourceOS);\n+            Path genManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n+            Logger.logDebug(\"Copy \" + Constants.MANIFEST_FILE + \" to \" + genManifest.toString());\n+            FileOps.copyResource(\"/native/android/AndroidManifest.xml\", genManifest);\n+            FileOps.replaceInFile(genManifest, \"package='com.gluonhq.helloandroid'\", \"package='\" + projectConfiguration.getAppId() + \"'\");\n+            FileOps.replaceInFile(genManifest, \"A HelloGraal\", projectConfiguration.getAppName());\n+\n+            Path androidResources = androidPath.resolve(\"res\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0ODAwNg==", "bodyText": "No, I've removed that extra assets folder. In fact you can have android/res and android/assets folders (the latter will have to be included in the package command too)", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380648006", "createdAt": "2020-02-18T12:43:23Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files\n+        String sourceOS = projectConfiguration.getTargetTriplet().getOs();\n+        Path rootPath = paths.getSourcePath().resolve(sourceOS);\n+        Path userManifest = rootPath.resolve(Constants.MANIFEST_FILE);\n+        Path androidPath;\n+        if (!Files.exists(userManifest)) {\n+            // copy manifest and assets to gensrc/android\n+            androidPath = paths.getGenPath().resolve(sourceOS);\n+            Path genManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n+            Logger.logDebug(\"Copy \" + Constants.MANIFEST_FILE + \" to \" + genManifest.toString());\n+            FileOps.copyResource(\"/native/android/AndroidManifest.xml\", genManifest);\n+            FileOps.replaceInFile(genManifest, \"package='com.gluonhq.helloandroid'\", \"package='\" + projectConfiguration.getAppId() + \"'\");\n+            FileOps.replaceInFile(genManifest, \"A HelloGraal\", projectConfiguration.getAppName());\n+\n+            Path androidResources = androidPath.resolve(\"res\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0NTkwMw=="}, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY1MDgxOQ==", "bodyText": "With that in mind, the latter will then have a default in substrate as /native/android/assets/assets? Or is this not really mandatory for the default case?", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380650819", "createdAt": "2020-02-18T12:49:25Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files\n+        String sourceOS = projectConfiguration.getTargetTriplet().getOs();\n+        Path rootPath = paths.getSourcePath().resolve(sourceOS);\n+        Path userManifest = rootPath.resolve(Constants.MANIFEST_FILE);\n+        Path androidPath;\n+        if (!Files.exists(userManifest)) {\n+            // copy manifest and assets to gensrc/android\n+            androidPath = paths.getGenPath().resolve(sourceOS);\n+            Path genManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n+            Logger.logDebug(\"Copy \" + Constants.MANIFEST_FILE + \" to \" + genManifest.toString());\n+            FileOps.copyResource(\"/native/android/AndroidManifest.xml\", genManifest);\n+            FileOps.replaceInFile(genManifest, \"package='com.gluonhq.helloandroid'\", \"package='\" + projectConfiguration.getAppId() + \"'\");\n+            FileOps.replaceInFile(genManifest, \"A HelloGraal\", projectConfiguration.getAppName());\n+\n+            Path androidResources = androidPath.resolve(\"res\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0NTkwMw=="}, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY1MjI1MA==", "bodyText": "Yes, we don't need that for the default case.", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380652250", "createdAt": "2020-02-18T12:52:36Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files\n+        String sourceOS = projectConfiguration.getTargetTriplet().getOs();\n+        Path rootPath = paths.getSourcePath().resolve(sourceOS);\n+        Path userManifest = rootPath.resolve(Constants.MANIFEST_FILE);\n+        Path androidPath;\n+        if (!Files.exists(userManifest)) {\n+            // copy manifest and assets to gensrc/android\n+            androidPath = paths.getGenPath().resolve(sourceOS);\n+            Path genManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n+            Logger.logDebug(\"Copy \" + Constants.MANIFEST_FILE + \" to \" + genManifest.toString());\n+            FileOps.copyResource(\"/native/android/AndroidManifest.xml\", genManifest);\n+            FileOps.replaceInFile(genManifest, \"package='com.gluonhq.helloandroid'\", \"package='\" + projectConfiguration.getAppId() + \"'\");\n+            FileOps.replaceInFile(genManifest, \"A HelloGraal\", projectConfiguration.getAppName());\n+\n+            Path androidResources = androidPath.resolve(\"res\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0NTkwMw=="}, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY1NzExNQ==", "bodyText": "Good.", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380657115", "createdAt": "2020-02-18T13:02:47Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files\n+        String sourceOS = projectConfiguration.getTargetTriplet().getOs();\n+        Path rootPath = paths.getSourcePath().resolve(sourceOS);\n+        Path userManifest = rootPath.resolve(Constants.MANIFEST_FILE);\n+        Path androidPath;\n+        if (!Files.exists(userManifest)) {\n+            // copy manifest and assets to gensrc/android\n+            androidPath = paths.getGenPath().resolve(sourceOS);\n+            Path genManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n+            Logger.logDebug(\"Copy \" + Constants.MANIFEST_FILE + \" to \" + genManifest.toString());\n+            FileOps.copyResource(\"/native/android/AndroidManifest.xml\", genManifest);\n+            FileOps.replaceInFile(genManifest, \"package='com.gluonhq.helloandroid'\", \"package='\" + projectConfiguration.getAppId() + \"'\");\n+            FileOps.replaceInFile(genManifest, \"A HelloGraal\", projectConfiguration.getAppName());\n+\n+            Path androidResources = androidPath.resolve(\"res\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0NTkwMw=="}, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTkyODY1OnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjo0MDo1OVrOFrA14g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMzowNDo0M1rOFrBhrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0Njg4Mg==", "bodyText": "What does this directory resolve to, relative to the root directory?", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380646882", "createdAt": "2020-02-18T12:40:59Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files\n+        String sourceOS = projectConfiguration.getTargetTriplet().getOs();\n+        Path rootPath = paths.getSourcePath().resolve(sourceOS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0ODI4OQ==", "bodyText": "that is /path/to/src/android in this case", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380648289", "createdAt": "2020-02-18T12:43:59Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files\n+        String sourceOS = projectConfiguration.getTargetTriplet().getOs();\n+        Path rootPath = paths.getSourcePath().resolve(sourceOS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0Njg4Mg=="}, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY1MTMwMw==", "bodyText": "OK, sounds a bit strange to use sourceOS as variable name. targetOS sounds more clear?", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380651303", "createdAt": "2020-02-18T12:50:31Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files\n+        String sourceOS = projectConfiguration.getTargetTriplet().getOs();\n+        Path rootPath = paths.getSourcePath().resolve(sourceOS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0Njg4Mg=="}, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY1MzE3Mg==", "bodyText": "source comes from src, and OS is for the targetOS, like android or ios(We use the same in utils/ios/InfoPlist).", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380653172", "createdAt": "2020-02-18T12:54:33Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files\n+        String sourceOS = projectConfiguration.getTargetTriplet().getOs();\n+        Path rootPath = paths.getSourcePath().resolve(sourceOS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0Njg4Mg=="}, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY1NTA0NQ==", "bodyText": "Yes, but the thing is, sourceOS is a variable that holds the name of the target OS and has not yet anything to do with src/.... It's only used for determining the rootPath, which should actually be path_to_target_OS_sources:\nString targetOs = projectConfiguration.getTargetTriplet().getOs();\nPath targetSourcePath = paths.getSourcePath().resolve(targetOs);", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380655045", "createdAt": "2020-02-18T12:58:34Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files\n+        String sourceOS = projectConfiguration.getTargetTriplet().getOs();\n+        Path rootPath = paths.getSourcePath().resolve(sourceOS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0Njg4Mg=="}, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY1ODA5Mg==", "bodyText": "Ok, changed it.", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380658092", "createdAt": "2020-02-18T13:04:43Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files\n+        String sourceOS = projectConfiguration.getTargetTriplet().getOs();\n+        Path rootPath = paths.getSourcePath().resolve(sourceOS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0Njg4Mg=="}, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NDE0MzgzOnYy", "diffSide": "RIGHT", "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDowMjowNVrOFsNKOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDowMzoxNFrOFsNMlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg5NzI3Mg==", "bodyText": "probably in a subdir?", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r381897272", "createdAt": "2020-02-20T10:02:05Z", "author": {"login": "johanvos"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -415,6 +423,44 @@ private String findLatestBuildTool(Path sdkPath) throws IOException {\n         //  Currently, sdkmanager doesn't work with JDK 11: https://issuetracker.google.com/issues/67495440\n     }\n \n+    /**\n+     * If android manifest and icons are present in src/android, then, this", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e12f89c4585e5c629ddc5ebd5f0423fa8d8cf7a9"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg5Nzg3Nw==", "bodyText": "AndroidManifest is at src/android, icons at src/android/res", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r381897877", "createdAt": "2020-02-20T10:03:14Z", "author": {"login": "jperedadnr"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -415,6 +423,44 @@ private String findLatestBuildTool(Path sdkPath) throws IOException {\n         //  Currently, sdkmanager doesn't work with JDK 11: https://issuetracker.google.com/issues/67495440\n     }\n \n+    /**\n+     * If android manifest and icons are present in src/android, then, this", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg5NzI3Mg=="}, "originalCommit": {"oid": "e12f89c4585e5c629ddc5ebd5f0423fa8d8cf7a9"}, "originalPosition": 67}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2958, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}