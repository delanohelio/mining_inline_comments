{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NDI1NzUy", "number": 675, "title": "Check that Android required packages are present", "bodyText": "else install them with Android SdkManager\nFixes #674", "createdAt": "2020-06-20T15:31:19Z", "url": "https://github.com/gluonhq/substrate/pull/675", "merged": true, "mergeCommit": {"oid": "61e845422bdbbd5234045158fdf55df53a4e791b"}, "closed": true, "closedAt": "2020-06-30T16:50:36Z", "author": {"login": "jperedadnr"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABctJaUZAH2gAyNDM3NDI1NzUyOmVmY2ZlNTA5YzExYTg3NmNkNzgyODA2YjRlMjI0MmJjOTVjYTc2Yzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABctLtE-AFqTQzNDQ0NDkxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "efcfe509c11a876cd782806b4e2242bc95ca76c9", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/efcfe509c11a876cd782806b4e2242bc95ca76c9", "committedDate": "2020-06-20T15:30:34Z", "message": "Check that Android required packages are present, else install them with Android SdkManager"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDM4NDg4", "url": "https://github.com/gluonhq/substrate/pull/675#pullrequestreview-434438488", "createdAt": "2020-06-20T16:17:24Z", "commit": {"oid": "efcfe509c11a876cd782806b4e2242bc95ca76c9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNjoxNzoyNFrOGmnQSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNjoxNzoyNFrOGmnQSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE0MjIxNg==", "bodyText": "this looks like all packages will be downloaded, not only the missing ones?", "url": "https://github.com/gluonhq/substrate/pull/675#discussion_r443142216", "createdAt": "2020-06-20T16:17:24Z", "author": {"login": "johanvos"}, "path": "src/main/java/com/gluonhq/substrate/util/FileDeps.java", "diffHunk": "@@ -134,6 +137,24 @@ public Path getAndroidNDKPath() throws IOException {\n         return resolvePath(configuration.getAndroidNdkPath(),\"Fatal error, could not install Android NDK \");\n     }\n \n+    /**\n+     * Checks that the required Android packages are present, else proceeds to\n+     * install them\n+     *\n+     * @param androidSdk The path to the Android SDK\n+     * @throws IOException\n+     * @throws InterruptedException\n+     */\n+    public void checkAndroidPackages(String androidSdk) throws IOException, InterruptedException {\n+        if (Stream.of(ANDROID_SDK_PACKAGES)\n+                .filter(s -> !s.contains(\"ndk\"))\n+                .map(s -> Path.of(androidSdk, s.split(\";\")))\n+                .anyMatch(p -> !Files.exists(p))) {\n+            Logger.logInfo(\"Some required Android packages were not found, they will be downloaded.\");\n+            fetchFromSdkManager();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efcfe509c11a876cd782806b4e2242bc95ca76c9"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDQwNjQ1", "url": "https://github.com/gluonhq/substrate/pull/675#pullrequestreview-434440645", "createdAt": "2020-06-20T16:56:14Z", "commit": {"oid": "efcfe509c11a876cd782806b4e2242bc95ca76c9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNjo1NjoxNFrOGmnZ3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMFQxNjo1NjoxNFrOGmnZ3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE0NDY2OA==", "bodyText": "It would be good to print the missing packages here, so that the developer (or we) can verify", "url": "https://github.com/gluonhq/substrate/pull/675#discussion_r443144668", "createdAt": "2020-06-20T16:56:14Z", "author": {"login": "johanvos"}, "path": "src/main/java/com/gluonhq/substrate/util/FileDeps.java", "diffHunk": "@@ -134,6 +137,24 @@ public Path getAndroidNDKPath() throws IOException {\n         return resolvePath(configuration.getAndroidNdkPath(),\"Fatal error, could not install Android NDK \");\n     }\n \n+    /**\n+     * Checks that the required Android packages are present, else proceeds to\n+     * install them\n+     *\n+     * @param androidSdk The path to the Android SDK\n+     * @throws IOException\n+     * @throws InterruptedException\n+     */\n+    public void checkAndroidPackages(String androidSdk) throws IOException, InterruptedException {\n+        if (Stream.of(ANDROID_SDK_PACKAGES)\n+                .filter(s -> !s.contains(\"ndk\"))\n+                .map(s -> Path.of(androidSdk, s.split(\";\")))\n+                .anyMatch(p -> !Files.exists(p))) {\n+            Logger.logInfo(\"Some required Android packages were not found, they will be downloaded.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "efcfe509c11a876cd782806b4e2242bc95ca76c9"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4ab58cfbcdf88ee3680e46f8b1130f42c8dee05", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/e4ab58cfbcdf88ee3680e46f8b1130f42c8dee05", "committedDate": "2020-06-20T17:10:30Z", "message": "Log missing packages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NDQ0OTEz", "url": "https://github.com/gluonhq/substrate/pull/675#pullrequestreview-434444913", "createdAt": "2020-06-20T18:10:52Z", "commit": {"oid": "e4ab58cfbcdf88ee3680e46f8b1130f42c8dee05"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2066, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}