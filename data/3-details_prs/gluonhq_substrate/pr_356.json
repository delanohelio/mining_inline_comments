{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NTY2OTE1", "number": 356, "title": "#354 Use genSrc/android to let the user modify the Android resources", "bodyText": "Fixes #354", "createdAt": "2020-02-18T11:34:49Z", "url": "https://github.com/gluonhq/substrate/pull/356", "merged": true, "mergeCommit": {"oid": "fec27d748dbe056a19f2adaa7dbdeb2c585ac09c"}, "closed": true, "closedAt": "2020-02-26T19:27:00Z", "author": {"login": "jperedadnr"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFfUEigH2gAyMzc2NTY2OTE1OjE2MDNlOGMxYjAzMTdkNjE3YTU5OTNlMTkzNjc5NTc5Zjg2ZmYwNmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcILn-rAFqTM2NTE2NjQyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1603e8c1b0317d617a5993e193679579f86ff06b", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/1603e8c1b0317d617a5993e193679579f86ff06b", "committedDate": "2020-02-18T10:24:41Z", "message": "#354 Use genSrc/android to let the user modify the Android resources"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d82ec6e7a681583a368c68e87e16d897d9bc774", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/0d82ec6e7a681583a368c68e87e16d897d9bc774", "committedDate": "2020-02-18T11:16:50Z", "message": "copy files instead of resources"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8497defcbbc04228c4af2ca859610dcd3d43ba5", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/a8497defcbbc04228c4af2ca859610dcd3d43ba5", "committedDate": "2020-02-18T11:32:52Z", "message": "Fix comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/aaf9611bfd5abadd808a05c5d41caa6044b45325", "committedDate": "2020-02-18T12:20:16Z", "message": "Remove unnecessary assets folder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMjkzNTk5", "url": "https://github.com/gluonhq/substrate/pull/356#pullrequestreview-360293599", "createdAt": "2020-02-18T12:21:05Z", "commit": {"oid": "a8497defcbbc04228c4af2ca859610dcd3d43ba5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoyMTowNVrOFrASJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoyMTowNVrOFrASJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzNzczNQ==", "bodyText": "Is it really critical for an icon image to exist?", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380637735", "createdAt": "2020-02-18T12:21:05Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -150,23 +179,28 @@ public boolean link() throws IOException, InterruptedException {\n         Files.createDirectories(dalvikBinPath);\n         Files.createDirectories(dalvikLibPath);\n         Files.createDirectories(dalvikLibArm64Path);\n-        Path androidManifestPath = dalvikPath.resolve(\"AndroidManifest.xml\");\n+        Path androidManifestDalvikPath = dalvikPath.resolve(Constants.MANIFEST_FILE);\n         Path dalvikActivityPackage = dalvikClassPath.resolve(\"com/gluonhq/helloandroid\");\n         Path dalvikKeyCodePackage = dalvikClassPath.resolve(\"javafx/scene/input\");\n         FileOps.copyResource(\"/native/android/dalvik/MainActivity.class\", dalvikActivityPackage.resolve(\"MainActivity.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/MainActivity$1.class\", dalvikActivityPackage.resolve(\"MainActivity$1.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/MainActivity$InternalSurfaceView.class\", dalvikActivityPackage.resolve(\"MainActivity$InternalSurfaceView.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/KeyCode.class\", dalvikKeyCodePackage.resolve(\"KeyCode.class\"));\n         FileOps.copyResource(\"/native/android/dalvik/KeyCode$KeyCodeClass.class\", dalvikKeyCodePackage.resolve(\"KeyCode$KeyCodeClass.class\"));\n-        FileOps.copyResource(\"/native/android/AndroidManifest.xml\", dalvikPath.resolve(\"AndroidManifest.xml\"));\n-        FileOps.replaceInFile(dalvikPath.resolve(\"AndroidManifest.xml\"), \"package='com.gluonhq.helloandroid'\", \"package='\" + projectConfiguration.getAppId() + \"'\");\n-        FileOps.replaceInFile(dalvikPath.resolve(\"AndroidManifest.xml\"), \"A HelloGraal\", projectConfiguration.getAppName());\n \n-        // resources\n-       for (String iconFolder : iconFolders) {\n+        Path androidManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n+        if (!Files.exists(androidManifest)) {\n+            throw new IOException(\"File \" + androidManifest.toString() + \" not found\");\n+        }\n+        FileOps.copyFile(androidManifest, androidManifestDalvikPath);\n+        for (String iconFolder : iconFolders) {\n+            Path iconPath = androidPath.resolve(\"assets\").resolve(\"res\").resolve(iconFolder).resolve(\"ic_launcher.png\");\n+            if (!Files.exists(iconPath)) {\n+                throw new IOException(\"File \" + iconPath.toString() + \" not found\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8497defcbbc04228c4af2ca859610dcd3d43ba5"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMjk0NjY3", "url": "https://github.com/gluonhq/substrate/pull/356#pullrequestreview-360294667", "createdAt": "2020-02-18T12:22:56Z", "commit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoyMjo1NlrOFrAVvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoyMjo1NlrOFrAVvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzODY1Mg==", "bodyText": "why is this \"Dalvik\" ?", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380638652", "createdAt": "2020-02-18T12:22:56Z", "author": {"login": "johanvos"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -150,23 +179,28 @@ public boolean link() throws IOException, InterruptedException {\n         Files.createDirectories(dalvikBinPath);\n         Files.createDirectories(dalvikLibPath);\n         Files.createDirectories(dalvikLibArm64Path);\n-        Path androidManifestPath = dalvikPath.resolve(\"AndroidManifest.xml\");\n+        Path androidManifestDalvikPath = dalvikPath.resolve(Constants.MANIFEST_FILE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMjk0ODQ0", "url": "https://github.com/gluonhq/substrate/pull/356#pullrequestreview-360294844", "createdAt": "2020-02-18T12:23:12Z", "commit": {"oid": "a8497defcbbc04228c4af2ca859610dcd3d43ba5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoyMzoxMlrOFrAWLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjoyMzoxMlrOFrAWLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDYzODc2Ng==", "bodyText": "This block can be moved to a separate method.", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380638766", "createdAt": "2020-02-18T12:23:12Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8497defcbbc04228c4af2ca859610dcd3d43ba5"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "425f6cf01fc1cbaac3aa5624e661d48fce8845b1", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/425f6cf01fc1cbaac3aa5624e661d48fce8845b1", "committedDate": "2020-02-18T12:38:03Z", "message": "Refactor method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMzAzOTI3", "url": "https://github.com/gluonhq/substrate/pull/356#pullrequestreview-360303927", "createdAt": "2020-02-18T12:39:00Z", "commit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjozOTowMFrOFrAyDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjozOTowMFrOFrAyDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0NTkwMw==", "bodyText": "Shouldn't this be .resolve(\"assets\").resolve(\"res\")?", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380645903", "createdAt": "2020-02-18T12:39:00Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files\n+        String sourceOS = projectConfiguration.getTargetTriplet().getOs();\n+        Path rootPath = paths.getSourcePath().resolve(sourceOS);\n+        Path userManifest = rootPath.resolve(Constants.MANIFEST_FILE);\n+        Path androidPath;\n+        if (!Files.exists(userManifest)) {\n+            // copy manifest and assets to gensrc/android\n+            androidPath = paths.getGenPath().resolve(sourceOS);\n+            Path genManifest = androidPath.resolve(Constants.MANIFEST_FILE);\n+            Logger.logDebug(\"Copy \" + Constants.MANIFEST_FILE + \" to \" + genManifest.toString());\n+            FileOps.copyResource(\"/native/android/AndroidManifest.xml\", genManifest);\n+            FileOps.replaceInFile(genManifest, \"package='com.gluonhq.helloandroid'\", \"package='\" + projectConfiguration.getAppId() + \"'\");\n+            FileOps.replaceInFile(genManifest, \"A HelloGraal\", projectConfiguration.getAppName());\n+\n+            Path androidResources = androidPath.resolve(\"res\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMzA1MTM5", "url": "https://github.com/gluonhq/substrate/pull/356#pullrequestreview-360305139", "createdAt": "2020-02-18T12:40:59Z", "commit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjo0MDo1OVrOFrA14g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxMjo0MDo1OVrOFrA14g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY0Njg4Mg==", "bodyText": "What does this directory resolve to, relative to the root directory?", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r380646882", "createdAt": "2020-02-18T12:40:59Z", "author": {"login": "tiainen"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -128,6 +129,34 @@ public boolean link() throws IOException, InterruptedException {\n             return false;\n         }\n \n+        // Prepare files\n+        String sourceOS = projectConfiguration.getTargetTriplet().getOs();\n+        Path rootPath = paths.getSourcePath().resolve(sourceOS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aaf9611bfd5abadd808a05c5d41caa6044b45325"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e12f89c4585e5c629ddc5ebd5f0423fa8d8cf7a9", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/e12f89c4585e5c629ddc5ebd5f0423fa8d8cf7a9", "committedDate": "2020-02-18T13:03:54Z", "message": "Rename variables"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNTk1NTE4", "url": "https://github.com/gluonhq/substrate/pull/356#pullrequestreview-360595518", "createdAt": "2020-02-18T19:04:31Z", "commit": {"oid": "e12f89c4585e5c629ddc5ebd5f0423fa8d8cf7a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNzcxNDE1", "url": "https://github.com/gluonhq/substrate/pull/356#pullrequestreview-361771415", "createdAt": "2020-02-20T10:02:05Z", "commit": {"oid": "e12f89c4585e5c629ddc5ebd5f0423fa8d8cf7a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDowMjowNVrOFsNKOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDowMjowNVrOFsNKOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg5NzI3Mg==", "bodyText": "probably in a subdir?", "url": "https://github.com/gluonhq/substrate/pull/356#discussion_r381897272", "createdAt": "2020-02-20T10:02:05Z", "author": {"login": "johanvos"}, "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -415,6 +423,44 @@ private String findLatestBuildTool(Path sdkPath) throws IOException {\n         //  Currently, sdkmanager doesn't work with JDK 11: https://issuetracker.google.com/issues/67495440\n     }\n \n+    /**\n+     * If android manifest and icons are present in src/android, then, this", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e12f89c4585e5c629ddc5ebd5f0423fa8d8cf7a9"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38ac8ad8e34cc6254a89cf6ccf602c73cb2dd7dc", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/38ac8ad8e34cc6254a89cf6ccf602c73cb2dd7dc", "committedDate": "2020-02-20T10:08:38Z", "message": "Merge branch 'master' of https://github.com/gluonhq/substrate into 354-gensrc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50ea45f81bc6ab86a79fa2b8c30cd67e57093ca1", "author": {"user": null}, "url": "https://github.com/gluonhq/substrate/commit/50ea45f81bc6ab86a79fa2b8c30cd67e57093ca1", "committedDate": "2020-02-20T10:11:26Z", "message": "Rename variable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MTY2NDI2", "url": "https://github.com/gluonhq/substrate/pull/356#pullrequestreview-365166426", "createdAt": "2020-02-26T19:10:06Z", "commit": {"oid": "50ea45f81bc6ab86a79fa2b8c30cd67e57093ca1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2106, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}