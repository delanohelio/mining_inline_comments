{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyMjkxNTMw", "number": 4826, "title": "[JENKINS-62889] ParameterDefinition check for validity", "bodyText": "Add an API to ParameterDefinition by which a caller can validate a ParameterValue for that specific definition. This provides a mechanism to ensure that users cannot inject unrecognized values. This is particularly useful for things like ChoiceParameterDefinition, which process a value as a string, but should only allow a specific set of choices.\nThis new API is optional in two different ways:\n\nA subclass of ParameterDefinition has to optionally add implementation to participate in the API. The base implementation just accepts everything as valid because it doesn't know any better. I have added implementations for all of the subclasses in core, though most of them are pretty meaningless. Most of them just check that the value is of the correct class.\nA caller has to optionally invoke the new API to determine if a value is valid. The only place I know of that currently does anything like this is pipeline-build-step-plugin. I'm preparing another PR for that project to demonstrate usage of this new API.\n\nJobParameterDefinition and JobParameterValue were never completed. These are only used in tests in MockClassUtils in graphql-server-plugin. These should be removed as part of clean up.\nSee JENKINS-62889.\nProposed changelog entries\nN/A\nProposed upgrade guidelines\nN/A\nSubmitter checklist\n\n (If applicable) Jira issue is well described\n[N/A] Changelog entries and upgrade guidelines are appropriate for the audience affected by the change (users or developer, depending on the change). Examples\n\nFill-in the Proposed changelog entries section only if there are breaking changes or other changes which may require extra steps from users during the upgrade\n\n\n Appropriate autotests or explanation to why this change has no tests\n[N/A] For dependency updates: links to external changelogs and, if possible, full diffs\n\n\nDesired reviewers\n@mention\n\nMaintainer checklist\nBefore the changes are marked as ready-for-merge:\n\n There are at least 2 approvals for the pull request and no outstanding requests for change\n Conversations in the pull request are over OR it is explicit that a reviewer does not block the change\n Changelog entries in the PR title and/or Proposed changelog entries are correct\n Proper changelog labels are set so that the changelog can be generated automatically\n[N/A] If the change needs additional upgrade steps from users, upgrade-guide-needed label is set and there is a Proposed upgrade guidelines section in the PR title. (example)\n[N/A] If it would make sense to backport the change to LTS, a Jira issue must exist, be a Bug or Improvement, and be labeled as lts-candidate to be considered (see query).", "createdAt": "2020-06-30T21:01:16Z", "url": "https://github.com/jenkinsci/jenkins/pull/4826", "merged": true, "mergeCommit": {"oid": "55d1b9e3877a0f12fbe37e1856b598ee513cdead"}, "closed": true, "closedAt": "2020-07-06T06:55:53Z", "author": {"login": "jeffret-b"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwcCsiAH2gAyNDQyMjkxNTMwOjIyZjhhNjgyNDcwZjAyNzhlMjY2YWMyNzAxYWFmZWQ0MTk0N2Q0ZDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxDQhcAH2gAyNDQyMjkxNTMwOmE0MjA1MzY2ZGY5YmEzODNkY2ZkODM1ZjU2ZmU5OWYzZDc0ZWM3MjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "22f8a682470f0278e266ac2701aafed41947d4d1", "author": {"user": {"login": "jeffret-b", "name": "Jeff Thompson"}}, "url": "https://github.com/jenkinsci/jenkins/commit/22f8a682470f0278e266ac2701aafed41947d4d1", "committedDate": "2020-06-30T20:54:44Z", "message": "[JENKINS-62889] ParameterDefinition check for validity\n\nAdd a simple API to ParameterDefinition by which a caller can validate a ParameterValue for that specific definition."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "486ed6b53ccb6374bb5b49a984e410c77fcd2780", "author": {"user": {"login": "jeffret-b", "name": "Jeff Thompson"}}, "url": "https://github.com/jenkinsci/jenkins/commit/486ed6b53ccb6374bb5b49a984e410c77fcd2780", "committedDate": "2020-06-30T21:08:09Z", "message": "Update test issue annotation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwMzkyNjE4", "url": "https://github.com/jenkinsci/jenkins/pull/4826#pullrequestreview-440392618", "createdAt": "2020-06-30T21:17:18Z", "commit": {"oid": "486ed6b53ccb6374bb5b49a984e410c77fcd2780"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNDY3MDgy", "url": "https://github.com/jenkinsci/jenkins/pull/4826#pullrequestreview-441467082", "createdAt": "2020-07-02T08:36:54Z", "commit": {"oid": "486ed6b53ccb6374bb5b49a984e410c77fcd2780"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwODozNjo1NFrOGsDDyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQwODozNjo1NFrOGsDDyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg0MDY1MQ==", "bodyText": "You can extract this piece of code keeping the checkValue method but using the new isValid method. This way you avoid repeating code below in the createValue(String) method.", "url": "https://github.com/jenkinsci/jenkins/pull/4826#discussion_r448840651", "createdAt": "2020-07-02T08:36:54Z", "author": {"login": "MRamonLeon"}, "path": "core/src/main/java/hudson/model/ChoiceParameterDefinition.java", "diffHunk": "@@ -141,21 +141,27 @@ public StringParameterValue getDefaultParameterValue() {\n         return new StringParameterValue(getName(), defaultValue, getDescription());\n     }\n \n-    private StringParameterValue checkValue(StringParameterValue value) {\n-        if (!choices.contains(value.value))\n-            throw new IllegalArgumentException(\"Illegal choice for parameter \" + getName() + \": \" + value.value);\n-        return value;\n+    @Override\n+    public boolean isValid(ParameterValue value) {\n+        return choices.contains(((StringParameterValue) value).getValue());\n     }\n \n     @Override\n     public ParameterValue createValue(StaplerRequest req, JSONObject jo) {\n         StringParameterValue value = req.bindJSON(StringParameterValue.class, jo);\n         value.setDescription(getDescription());\n-        return checkValue(value);\n+        if (!isValid(value)) {\n+            throw new IllegalArgumentException(\"Illegal choice for parameter \" + getName() + \": \" + value.getValue());\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "486ed6b53ccb6374bb5b49a984e410c77fcd2780"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6931538feb79362a9005b143d185d882aea2ecb8", "author": {"user": {"login": "jeffret-b", "name": "Jeff Thompson"}}, "url": "https://github.com/jenkinsci/jenkins/commit/6931538feb79362a9005b143d185d882aea2ecb8", "committedDate": "2020-07-02T16:07:49Z", "message": "Remove duplication."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxODQ0NDAx", "url": "https://github.com/jenkinsci/jenkins/pull/4826#pullrequestreview-441844401", "createdAt": "2020-07-02T16:19:52Z", "commit": {"oid": "6931538feb79362a9005b143d185d882aea2ecb8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxOTI5MTc5", "url": "https://github.com/jenkinsci/jenkins/pull/4826#pullrequestreview-441929179", "createdAt": "2020-07-02T18:24:54Z", "commit": {"oid": "6931538feb79362a9005b143d185d882aea2ecb8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxODoyNDo1NFrOGsYwdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxODoyNDo1NFrOGsYwdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE5NjE0OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 *\n          \n          \n            \n                 * @since TODO", "url": "https://github.com/jenkinsci/jenkins/pull/4826#discussion_r449196148", "createdAt": "2020-07-02T18:24:54Z", "author": {"login": "stellargo"}, "path": "core/src/main/java/hudson/model/ParameterDefinition.java", "diffHunk": "@@ -225,6 +225,17 @@ public ParameterValue getDefaultParameterValue() {\n         return null;\n     }\n \n+    /**\n+     * Checks whether a given value is valid for this definition.\n+     *", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6931538feb79362a9005b143d185d882aea2ecb8"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxOTMwMjA3", "url": "https://github.com/jenkinsci/jenkins/pull/4826#pullrequestreview-441930207", "createdAt": "2020-07-02T18:26:39Z", "commit": {"oid": "6931538feb79362a9005b143d185d882aea2ecb8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4205366df9ba383dcfd835f56fe99f3d74ec724", "author": {"user": {"login": "jeffret-b", "name": "Jeff Thompson"}}, "url": "https://github.com/jenkinsci/jenkins/commit/a4205366df9ba383dcfd835f56fe99f3d74ec724", "committedDate": "2020-07-02T18:36:08Z", "message": "Add since TODO.\n\nCo-authored-by: stellargo <sumitsarinofficial@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2096, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}