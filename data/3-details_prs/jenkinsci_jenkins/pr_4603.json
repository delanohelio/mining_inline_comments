{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0Mjc2NzIw", "number": 4603, "title": "Let ConfidentialKey & Secret do something from unit tests", "bodyText": "Found it frustrating that I could not, for example, call any method on Secret from jshell because ConfidentialStore does not work without Jenkins. Simpler to introduce an in-memory mock for such cases. (DefaultConfidentialStore already has its own test coverage. Leaving ConfidentialStore.TEST to avoid breaking PCT on https://github.com/jenkinsci/credentials-plugin/blob/6f710a7e30156e94aff8a3c6c6799cef04ad35df/src/test/java/jenkins/security/ConfidentialStoreRule.java & https://github.com/jenkinsci/kubernetes-cli-plugin/blob/4f368d86f28a625c8c0c3bf5a4c25304c9d88cfc/src/test/java/jenkins/security/ConfidentialStoreRule.java.)\nProposed changelog entries\n\nDeveloper: Secret and ConfidentialKey implementations can now be used from unit tests without JenkinsRule.", "createdAt": "2020-03-26T16:25:50Z", "url": "https://github.com/jenkinsci/jenkins/pull/4603", "merged": true, "mergeCommit": {"oid": "e76f6a293aa26eeddd6887d43a9087e38f9e103a"}, "closed": true, "closedAt": "2020-03-28T19:13:01Z", "author": {"login": "jglick"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcReZylgH2gAyMzk0Mjc2NzIwOmQ4NDVhYzllOTM3MTEwYzdlN2U4OGQ3NTE1NjI3MWU2MGE3YTFkMmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcR1-cTAFqTM4MzE0ODY5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d845ac9e937110c7e7e88d75156271e60a7a1d2b", "author": {"user": {"login": "jglick", "name": "Jesse Glick"}}, "url": "https://github.com/jenkinsci/jenkins/commit/d845ac9e937110c7e7e88d75156271e60a7a1d2b", "committedDate": "2020-03-26T16:08:07Z", "message": "Delete ConfidentialStoreRule"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2f8515c6c1ab537b6603dbb9385622e9bc68db2", "author": {"user": {"login": "jglick", "name": "Jesse Glick"}}, "url": "https://github.com/jenkinsci/jenkins/commit/d2f8515c6c1ab537b6603dbb9385622e9bc68db2", "committedDate": "2020-03-26T16:25:08Z", "message": "Also delete MockSecretRule so Secret.fromString works"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMzI2MTkx", "url": "https://github.com/jenkinsci/jenkins/pull/4603#pullrequestreview-382326191", "createdAt": "2020-03-26T19:02:02Z", "commit": {"oid": "d2f8515c6c1ab537b6603dbb9385622e9bc68db2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDQxMzc2", "url": "https://github.com/jenkinsci/jenkins/pull/4603#pullrequestreview-382441376", "createdAt": "2020-03-26T21:41:24Z", "commit": {"oid": "d2f8515c6c1ab537b6603dbb9385622e9bc68db2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84118166b8d9250e28c7e8902fcbcf2c21b3bbeb", "author": {"user": {"login": "jglick", "name": "Jesse Glick"}}, "url": "https://github.com/jenkinsci/jenkins/commit/84118166b8d9250e28c7e8902fcbcf2c21b3bbeb", "committedDate": "2020-03-26T22:13:46Z", "message": "Secret.SECRET still referenced by SecretHelper in jenkins-test-harness, used by RekeySecretAdminMonitorTest, also copied in publish-over-*-plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ca122664a1b8bee8952dddbcaaa9ab1f9ffe731", "author": {"user": {"login": "jglick", "name": "Jesse Glick"}}, "url": "https://github.com/jenkinsci/jenkins/commit/4ca122664a1b8bee8952dddbcaaa9ab1f9ffe731", "committedDate": "2020-03-27T12:47:36Z", "message": "Merge branch 'master' of github.com:jenkinsci/jenkins into ConfidentialStoreRule"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8672e47968dd0883921ab1a12d48475dea6ecfba", "author": {"user": {"login": "jglick", "name": "Jesse Glick"}}, "url": "https://github.com/jenkinsci/jenkins/commit/8672e47968dd0883921ab1a12d48475dea6ecfba", "committedDate": "2020-03-27T14:53:45Z", "message": "RSAConfidentialKey ought to use the same SecureRandom as the ConfidentialStore; this also lets the mock use a fixed seed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50034fb8a59387cf38eae88694188f3622d659c2", "author": {"user": {"login": "jglick", "name": "Jesse Glick"}}, "url": "https://github.com/jenkinsci/jenkins/commit/50034fb8a59387cf38eae88694188f3622d659c2", "committedDate": "2020-03-27T15:24:22Z", "message": "For now ConfidentialStore.secureRandom can be abstract"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cacf1c9bc54c1e5a1f226a577128aef8ad4f926", "author": {"user": {"login": "jglick", "name": "Jesse Glick"}}, "url": "https://github.com/jenkinsci/jenkins/commit/4cacf1c9bc54c1e5a1f226a577128aef8ad4f926", "committedDate": "2020-03-27T17:33:02Z", "message": "Some core unit tests can be rather verbose; set maven.test.redirectTestOutputToFile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "244a9c7351cc2dc807d1f3d21810be6465275976", "author": {"user": {"login": "jglick", "name": "Jesse Glick"}}, "url": "https://github.com/jenkinsci/jenkins/commit/244a9c7351cc2dc807d1f3d21810be6465275976", "committedDate": "2020-03-27T17:56:11Z", "message": "Looks like we need a ConfidentialStoreRule after all"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfc5bb9c06d163ee999dc3f15ba2d712e551bc8e", "author": {"user": {"login": "jglick", "name": "Jesse Glick"}}, "url": "https://github.com/jenkinsci/jenkins/commit/dfc5bb9c06d163ee999dc3f15ba2d712e551bc8e", "committedDate": "2020-03-27T17:59:52Z", "message": "Restored another couple of usages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMTQwODQz", "url": "https://github.com/jenkinsci/jenkins/pull/4603#pullrequestreview-383140843", "createdAt": "2020-03-27T19:23:13Z", "commit": {"oid": "dfc5bb9c06d163ee999dc3f15ba2d712e551bc8e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxOToyMzoxM1rOF8-_LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QxOToyMzoxM1rOF8-_LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ5MDg2MA==", "bodyText": "Being a public API, this would sort of break it, though I have no idea if anyone besides me has even tried extending this class besides the default one.", "url": "https://github.com/jenkinsci/jenkins/pull/4603#discussion_r399490860", "createdAt": "2020-03-27T19:23:13Z", "author": {"login": "jvz"}, "path": "core/src/main/java/jenkins/security/ConfidentialStore.java", "diffHunk": "@@ -51,6 +55,9 @@\n      */\n     protected abstract @CheckForNull byte[] load(ConfidentialKey key) throws IOException;\n \n+    // TODO consider promoting to public, and offering a default implementation of randomBytes (via the usual Util.isOverridden binary compat trick)\n+    abstract SecureRandom secureRandom();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfc5bb9c06d163ee999dc3f15ba2d712e551bc8e"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMTQ4Njk3", "url": "https://github.com/jenkinsci/jenkins/pull/4603#pullrequestreview-383148697", "createdAt": "2020-03-27T19:35:58Z", "commit": {"oid": "dfc5bb9c06d163ee999dc3f15ba2d712e551bc8e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1364, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}