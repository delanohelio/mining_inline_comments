{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyMTAxMzkz", "number": 4478, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMjoxNzo1MlrODd2X8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMDowNTo0N1rODio4cA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNjI2MTYyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/model/FingerprintFacet.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQyMjoxNzo1MlrOFmsKPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNlQyMDozOToyOFrOFqVLyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjExMzcyNA==", "bodyText": "Will the tools that discover getters and setters (like Pipeline, Configuration as Code, etc.) recognize the prefix \"block\" and the prefix \"unblock\" as setters?  Are any of them ever expected to need to discover these?", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r376113724", "createdAt": "2020-02-06T22:17:52Z", "author": {"login": "MarkEWaite"}, "path": "core/src/main/java/jenkins/model/FingerprintFacet.java", "diffHunk": "@@ -103,6 +108,27 @@ public long getTimestamp() {\n         return timestamp;\n     }\n \n+    /**\n+     * Returns whether Fingerprint deletion has been blocked by this Facet.\n+     */\n+    public boolean isFingerprintDeletionBlocked() {\n+        return fingerprintDeletionBlocked;\n+    }\n+\n+    /**\n+     * Blocks deletion of Fingerprint associated with this Facet.\n+     */\n+    public void blockFingerprintDeletion() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a0737584adfdf831a1f530114a4c79d05026f39"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI0MDE3MA==", "bodyText": "IIUC, the plugins do need to be able to discover these setters (since they are the ones that create the facets), and would want to block the deletion of the facet.", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r376240170", "createdAt": "2020-02-07T07:03:07Z", "author": {"login": "stellargo"}, "path": "core/src/main/java/jenkins/model/FingerprintFacet.java", "diffHunk": "@@ -103,6 +108,27 @@ public long getTimestamp() {\n         return timestamp;\n     }\n \n+    /**\n+     * Returns whether Fingerprint deletion has been blocked by this Facet.\n+     */\n+    public boolean isFingerprintDeletionBlocked() {\n+        return fingerprintDeletionBlocked;\n+    }\n+\n+    /**\n+     * Blocks deletion of Fingerprint associated with this Facet.\n+     */\n+    public void blockFingerprintDeletion() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjExMzcyNA=="}, "originalCommit": {"oid": "0a0737584adfdf831a1f530114a4c79d05026f39"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODc3NTc0MA==", "bodyText": "I'm with Mark here, better to use well-known names for setters and getter", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r378775740", "createdAt": "2020-02-13T10:32:08Z", "author": {"login": "MRamonLeon"}, "path": "core/src/main/java/jenkins/model/FingerprintFacet.java", "diffHunk": "@@ -103,6 +108,27 @@ public long getTimestamp() {\n         return timestamp;\n     }\n \n+    /**\n+     * Returns whether Fingerprint deletion has been blocked by this Facet.\n+     */\n+    public boolean isFingerprintDeletionBlocked() {\n+        return fingerprintDeletionBlocked;\n+    }\n+\n+    /**\n+     * Blocks deletion of Fingerprint associated with this Facet.\n+     */\n+    public void blockFingerprintDeletion() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjExMzcyNA=="}, "originalCommit": {"oid": "0a0737584adfdf831a1f530114a4c79d05026f39"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODgzNjY1Ng==", "bodyText": "Hi, I had misunderstood. I am happy to convert it to the Jenkins standards. It would be really helpful if you could point me to a code snippet which uses these standards.", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r378836656", "createdAt": "2020-02-13T12:43:27Z", "author": {"login": "stellargo"}, "path": "core/src/main/java/jenkins/model/FingerprintFacet.java", "diffHunk": "@@ -103,6 +108,27 @@ public long getTimestamp() {\n         return timestamp;\n     }\n \n+    /**\n+     * Returns whether Fingerprint deletion has been blocked by this Facet.\n+     */\n+    public boolean isFingerprintDeletionBlocked() {\n+        return fingerprintDeletionBlocked;\n+    }\n+\n+    /**\n+     * Blocks deletion of Fingerprint associated with this Facet.\n+     */\n+    public void blockFingerprintDeletion() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjExMzcyNA=="}, "originalCommit": {"oid": "0a0737584adfdf831a1f530114a4c79d05026f39"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzMTU5NQ==", "bodyText": "It would be a way to go (standard Java setter implemetation)\n    public void setFingerprintDeletionBlocked(boolean value) {", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r379931595", "createdAt": "2020-02-16T20:39:28Z", "author": {"login": "oleg-nenashev"}, "path": "core/src/main/java/jenkins/model/FingerprintFacet.java", "diffHunk": "@@ -103,6 +108,27 @@ public long getTimestamp() {\n         return timestamp;\n     }\n \n+    /**\n+     * Returns whether Fingerprint deletion has been blocked by this Facet.\n+     */\n+    public boolean isFingerprintDeletionBlocked() {\n+        return fingerprintDeletionBlocked;\n+    }\n+\n+    /**\n+     * Blocks deletion of Fingerprint associated with this Facet.\n+     */\n+    public void blockFingerprintDeletion() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjExMzcyNA=="}, "originalCommit": {"oid": "0a0737584adfdf831a1f530114a4c79d05026f39"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MTI1NzQ3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/model/FingerprintFacet.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNlQyMDozOTo1MFrOFqVL5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNlQyMDozOTo1MFrOFqVL5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzMTYyMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Returns whether Fingerprint deletion has been blocked by this Facet.\n          \n          \n            \n                 * Returns whether Fingerprint deletion has been blocked by this Facet.\n          \n          \n            \n                 * @since TODO", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r379931621", "createdAt": "2020-02-16T20:39:50Z", "author": {"login": "oleg-nenashev"}, "path": "core/src/main/java/jenkins/model/FingerprintFacet.java", "diffHunk": "@@ -103,6 +108,27 @@ public long getTimestamp() {\n         return timestamp;\n     }\n \n+    /**\n+     * Returns whether Fingerprint deletion has been blocked by this Facet.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a0737584adfdf831a1f530114a4c79d05026f39"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MTI1NzU0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/model/Fingerprint.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNlQyMDo0MDowNFrOFqVL7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNlQyMDo0MDowNFrOFqVL7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzMTYzMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Checks if any Facet of the Fingerprint is blocking its deletion.\n          \n          \n            \n                 * Checks if any Facet of the Fingerprint is blocking its deletion.\n          \n          \n            \n                 * @since TODO", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r379931631", "createdAt": "2020-02-16T20:40:04Z", "author": {"login": "oleg-nenashev"}, "path": "core/src/main/java/hudson/model/Fingerprint.java", "diffHunk": "@@ -1305,6 +1305,17 @@ void save(File file) throws IOException {\n         }\n     }\n \n+    /**\n+     * Checks if any Facet of the Fingerprint is blocking its deletion.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a0737584adfdf831a1f530114a4c79d05026f39"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MTI1ODA4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/model/FingerprintCleanupThread.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNlQyMDo0MToxMFrOFqVMNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwNTo1NTo1OVrOFqZIqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzMTcwMQ==", "bodyText": "Might be great to add some logging later, but the current chance follows the convention", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r379931701", "createdAt": "2020-02-16T20:41:10Z", "author": {"login": "oleg-nenashev"}, "path": "core/src/main/java/hudson/model/FingerprintCleanupThread.java", "diffHunk": "@@ -107,7 +107,7 @@ private void deleteIfEmpty(File dir) {\n     private boolean check(File fingerprintFile, TaskListener listener) {\n         try {\n             Fingerprint fp = loadFingerprint(fingerprintFile);\n-            if (fp == null || !fp.isAlive()) {\n+            if (fp == null || (!fp.isAlive() && !fp.isFingerprintDeletionBlocked()) ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a0737584adfdf831a1f530114a4c79d05026f39"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTk5NjMzMA==", "bodyText": "Thanks @oleg-nenashev , I added logging, let me know if it is fine.", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r379996330", "createdAt": "2020-02-17T05:55:59Z", "author": {"login": "stellargo"}, "path": "core/src/main/java/hudson/model/FingerprintCleanupThread.java", "diffHunk": "@@ -107,7 +107,7 @@ private void deleteIfEmpty(File dir) {\n     private boolean check(File fingerprintFile, TaskListener listener) {\n         try {\n             Fingerprint fp = loadFingerprint(fingerprintFile);\n-            if (fp == null || !fp.isAlive()) {\n+            if (fp == null || (!fp.isAlive() && !fp.isFingerprintDeletionBlocked()) ) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkzMTcwMQ=="}, "originalCommit": {"oid": "0a0737584adfdf831a1f530114a4c79d05026f39"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MjU2MzUwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/model/FingerprintCleanupThread.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxMTozMToxMlrOFqhRyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNzo0OToyMlrOFrxR8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDEyOTczNw==", "bodyText": "Would be great to reference the facet blocking it", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r380129737", "createdAt": "2020-02-17T11:31:12Z", "author": {"login": "oleg-nenashev"}, "path": "core/src/main/java/hudson/model/FingerprintCleanupThread.java", "diffHunk": "@@ -107,11 +107,13 @@ private void deleteIfEmpty(File dir) {\n     private boolean check(File fingerprintFile, TaskListener listener) {\n         try {\n             Fingerprint fp = loadFingerprint(fingerprintFile);\n-            if (fp == null || !fp.isAlive()) {\n+            if (fp == null || (!fp.isAlive() && !fp.isFingerprintDeletionBlocked()) ) {\n                 listener.getLogger().println(\"deleting obsolete \" + fingerprintFile);\n                 fingerprintFile.delete();\n                 return true;\n             } else {\n+                if (!fp.isAlive() && fp.isFingerprintDeletionBlocked())\n+                    listener.getLogger().println((\"Facet blocked deletion of \" + fingerprintFile));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25c3eb4dcd16248bf5b97de5903df2ade27d3ff5"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDEzNzg5Ng==", "bodyText": "A facet by default IIUC only has timestamp and fingerprint attached with it. How would I reference the facet? Should I do it by timestamp? Or should i write a toString method for the facet class?", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r380137896", "createdAt": "2020-02-17T11:51:20Z", "author": {"login": "stellargo"}, "path": "core/src/main/java/hudson/model/FingerprintCleanupThread.java", "diffHunk": "@@ -107,11 +107,13 @@ private void deleteIfEmpty(File dir) {\n     private boolean check(File fingerprintFile, TaskListener listener) {\n         try {\n             Fingerprint fp = loadFingerprint(fingerprintFile);\n-            if (fp == null || !fp.isAlive()) {\n+            if (fp == null || (!fp.isAlive() && !fp.isFingerprintDeletionBlocked()) ) {\n                 listener.getLogger().println(\"deleting obsolete \" + fingerprintFile);\n                 fingerprintFile.delete();\n                 return true;\n             } else {\n+                if (!fp.isAlive() && fp.isFingerprintDeletionBlocked())\n+                    listener.getLogger().println((\"Facet blocked deletion of \" + fingerprintFile));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDEyOTczNw=="}, "originalCommit": {"oid": "25c3eb4dcd16248bf5b97de5903df2ade27d3ff5"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTE2NzAyOA==", "bodyText": "What about just printing a className? It would at least give the user some idea which facet blocks it", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r381167028", "createdAt": "2020-02-19T09:24:36Z", "author": {"login": "oleg-nenashev"}, "path": "core/src/main/java/hudson/model/FingerprintCleanupThread.java", "diffHunk": "@@ -107,11 +107,13 @@ private void deleteIfEmpty(File dir) {\n     private boolean check(File fingerprintFile, TaskListener listener) {\n         try {\n             Fingerprint fp = loadFingerprint(fingerprintFile);\n-            if (fp == null || !fp.isAlive()) {\n+            if (fp == null || (!fp.isAlive() && !fp.isFingerprintDeletionBlocked()) ) {\n                 listener.getLogger().println(\"deleting obsolete \" + fingerprintFile);\n                 fingerprintFile.delete();\n                 return true;\n             } else {\n+                if (!fp.isAlive() && fp.isFingerprintDeletionBlocked())\n+                    listener.getLogger().println((\"Facet blocked deletion of \" + fingerprintFile));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDEyOTczNw=="}, "originalCommit": {"oid": "25c3eb4dcd16248bf5b97de5903df2ade27d3ff5"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ0MDQ5Nw==", "bodyText": "@oleg-nenashev Done, I also added the timestamp of creation. Let me know if anything more is required", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r381440497", "createdAt": "2020-02-19T17:49:22Z", "author": {"login": "stellargo"}, "path": "core/src/main/java/hudson/model/FingerprintCleanupThread.java", "diffHunk": "@@ -107,11 +107,13 @@ private void deleteIfEmpty(File dir) {\n     private boolean check(File fingerprintFile, TaskListener listener) {\n         try {\n             Fingerprint fp = loadFingerprint(fingerprintFile);\n-            if (fp == null || !fp.isAlive()) {\n+            if (fp == null || (!fp.isAlive() && !fp.isFingerprintDeletionBlocked()) ) {\n                 listener.getLogger().println(\"deleting obsolete \" + fingerprintFile);\n                 fingerprintFile.delete();\n                 return true;\n             } else {\n+                if (!fp.isAlive() && fp.isFingerprintDeletionBlocked())\n+                    listener.getLogger().println((\"Facet blocked deletion of \" + fingerprintFile));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDEyOTczNw=="}, "originalCommit": {"oid": "25c3eb4dcd16248bf5b97de5903df2ade27d3ff5"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NDI0MDMxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/model/FingerprintCleanupThread.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDoyOToxMlrOFsOEuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDoyOToxMlrOFsOEuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkxMjI0OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (fp == null || (!fp.isAlive() && fp.facetBlockingDeletion()==null) ) {\n          \n          \n            \n                        if (fp == null || (!fp.isAlive() && fp.facetBlockingDeletion() == null) ) {", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r381912249", "createdAt": "2020-02-20T10:29:12Z", "author": {"login": "alecharp"}, "path": "core/src/main/java/hudson/model/FingerprintCleanupThread.java", "diffHunk": "@@ -107,11 +111,15 @@ private void deleteIfEmpty(File dir) {\n     private boolean check(File fingerprintFile, TaskListener listener) {\n         try {\n             Fingerprint fp = loadFingerprint(fingerprintFile);\n-            if (fp == null || !fp.isAlive()) {\n+            if (fp == null || (!fp.isAlive() && fp.facetBlockingDeletion()==null) ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50cc8ce315e2e66b2aca3e55fd330f26edd7e778"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NDI0NzU4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/model/FingerprintCleanupThread.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDozMTozMVrOFsOJOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDozMTozMVrOFsOJOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkxMzQwMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                listener.getLogger().println(deletionBlockerFacet.getClass().getName()+\" created on \"+DATE_CONVERTER.toString(deletionBlockerFacet.getTimestamp())+\" blocked deletion of \" + fingerprintFile);\n          \n          \n            \n                                listener.getLogger().println(deletionBlockerFacet.getClass().getName() + \" created on \" + DATE_CONVERTER.toString(deletionBlockerFacet.getTimestamp()) + \" blocked deletion of \" + fingerprintFile);", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r381913402", "createdAt": "2020-02-20T10:31:31Z", "author": {"login": "alecharp"}, "path": "core/src/main/java/hudson/model/FingerprintCleanupThread.java", "diffHunk": "@@ -107,11 +111,15 @@ private void deleteIfEmpty(File dir) {\n     private boolean check(File fingerprintFile, TaskListener listener) {\n         try {\n             Fingerprint fp = loadFingerprint(fingerprintFile);\n-            if (fp == null || !fp.isAlive()) {\n+            if (fp == null || (!fp.isAlive() && fp.facetBlockingDeletion()==null) ) {\n                 listener.getLogger().println(\"deleting obsolete \" + fingerprintFile);\n                 fingerprintFile.delete();\n                 return true;\n             } else {\n+                if (!fp.isAlive()) {\n+                    FingerprintFacet deletionBlockerFacet = fp.facetBlockingDeletion();\n+                    listener.getLogger().println(deletionBlockerFacet.getClass().getName()+\" created on \"+DATE_CONVERTER.toString(deletionBlockerFacet.getTimestamp())+\" blocked deletion of \" + fingerprintFile);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50cc8ce315e2e66b2aca3e55fd330f26edd7e778"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2NDI1NzI5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/model/Fingerprint.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDozNDowMlrOFsOPAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxMDozNDowMlrOFsOPAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTkxNDg4MA==", "bodyText": "Shouldn't it be annotated with @CheckForNull?", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r381914880", "createdAt": "2020-02-20T10:34:02Z", "author": {"login": "alecharp"}, "path": "core/src/main/java/hudson/model/Fingerprint.java", "diffHunk": "@@ -1305,6 +1305,19 @@ void save(File file) throws IOException {\n         }\n     }\n \n+    /**\n+     * Returns a facet that blocks the deletion of the fingerprint.\n+     * Returns null if no such facet.\n+     * @since TODO\n+     */\n+    public FingerprintFacet facetBlockingDeletion() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50cc8ce315e2e66b2aca3e55fd330f26edd7e778"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NjQ3OTg0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/model/Fingerprint.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMDowNTo0N1rOFt_7LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxMDowNTo0N1rOFt_7LQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc3NzU4MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public @CheckForNull FingerprintFacet facetBlockingDeletion() {\n          \n          \n            \n                public @CheckForNull FingerprintFacet getFacetBlockingDeletion() {", "url": "https://github.com/jenkinsci/jenkins/pull/4478#discussion_r383777581", "createdAt": "2020-02-25T10:05:47Z", "author": {"login": "oleg-nenashev"}, "path": "core/src/main/java/hudson/model/Fingerprint.java", "diffHunk": "@@ -1305,6 +1305,19 @@ void save(File file) throws IOException {\n         }\n     }\n \n+    /**\n+     * Returns a facet that blocks the deletion of the fingerprint.\n+     * Returns null if no such facet.\n+     * @since TODO\n+     */\n+    public @CheckForNull FingerprintFacet facetBlockingDeletion() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b77413b0b82d3529145076258fd98b957456dfa"}, "originalPosition": 9}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 766, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}