{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MTM0Njgy", "number": 4552, "title": "JENKINS-56937 JCasC support for admin monitors", "bodyText": "See JENKINS-56937.\nExample config:\njenkins:\n  disabledAdministrativeMonitors:\n    - \"jenkins.security.s2m.MasterKillSwitchWarning\"\n\nProposed changelog entries\n\nEntry 1: JENKINS-56937, configuration-as-code plugin support for disable admin monitors\n...\n\n\nProposed upgrade guidelines\nN/A\nSubmitter checklist\n\n JIRA issue is well described\n Changelog entries and upgrade guidelines are appropriate for the audience affected by the change (users or developer, depending on the change). Examples\n\nFill-in the Proposed changelog entries section only if there are breaking changes or other changes which may require extra steps from users during the upgrade\n\n\n Appropriate autotests or explanation to why this change has no tests\n For dependency updates: links to external changelogs and, if possible, full diffs\n\n\nDesired reviewers\n@mention\n\nMaintainer checklist\nBefore the changes are marked as ready-for-merge:\n\n There are at least 2 approvals for the pull request and no outstanding requests for change\n Conversations in the pull request are over OR it is explicit that a reviewer does not block the change\n Changelog entries in the PR title and/or Proposed changelog entries are correct\n Proper changelog labels are set so that the changelog can be generated automatically\n If the change needs additional upgrade steps from users, upgrade-guide-needed label is set and there is a Proposed upgrade guidelines section in the PR title. (example)\n If it would make sense to backport the change to LTS, a JIRA issue should exist and be labeled as lts-candidate", "createdAt": "2020-03-07T11:19:23Z", "url": "https://github.com/jenkinsci/jenkins/pull/4552", "merged": true, "mergeCommit": {"oid": "1a0f231b066a172e5ad88c633a79c9119e87e853"}, "closed": true, "closedAt": "2020-04-01T19:13:47Z", "author": {"login": "timja"}, "timelineItems": {"totalCount": 29, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLS0JfAH2gAyMzg1MTM0NjgyOjg3YWRjOTA4ODMwZDYwMzI2ODU3ZDhmMjViZTZkZDZiNjc2ODhkNzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRJP8GgFqTM4MTI2MzMzNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "87adc908830d60326857d8f25be6dd6b67688d76", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/87adc908830d60326857d8f25be6dd6b67688d76", "committedDate": "2020-03-07T11:14:30Z", "message": "JENKINS-56937 JCasC support for admin monitors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzM4ODU2", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-370738856", "createdAt": "2020-03-07T11:20:52Z", "commit": {"oid": "87adc908830d60326857d8f25be6dd6b67688d76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QxMToyMDo1M1rOFzNywg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QxMToyMDo1M1rOFzNywg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTI0NzY4Mg==", "bodyText": "https://github.com/search?q=org%3Ajenkinsci+getDisabledAdministrativeMonitors&type=Code", "url": "https://github.com/jenkinsci/jenkins/pull/4552#discussion_r389247682", "createdAt": "2020-03-07T11:20:53Z", "author": {"login": "timja"}, "path": "core/src/main/java/hudson/model/AbstractCIBase.java", "diffHunk": "@@ -93,13 +93,26 @@ protected void killComputer(Computer c) {\n     * Package-protected, but accessed API\n     * ============================================================================================================== */\n \n-    /*package*/ final CopyOnWriteArraySet<String> disabledAdministrativeMonitors = new CopyOnWriteArraySet<>();\n+    private Set<String> disabledAdministrativeMonitors = new HashSet<>();\n \n-    @Restricted(NoExternalUse.class)\n-    public CopyOnWriteArraySet<String> getDisabledAdministrativeMonitors(){\n+    /**\n+     * Get the disabled administrative monitors\n+     *\n+     * @since TODO\n+     */\n+    public Set<String> getDisabledAdministrativeMonitors(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87adc908830d60326857d8f25be6dd6b67688d76"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzM5MTgx", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-370739181", "createdAt": "2020-03-07T11:28:18Z", "commit": {"oid": "87adc908830d60326857d8f25be6dd6b67688d76"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwNzQ5NTM1", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-370749535", "createdAt": "2020-03-07T15:27:34Z", "commit": {"oid": "87adc908830d60326857d8f25be6dd6b67688d76"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QxNToyNzozNVrOFzOq1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wN1QxNTozMDoxOVrOFzOrdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTI2MjAzNg==", "bodyText": "Probably should be cloned here instead of taking a reference to an external object", "url": "https://github.com/jenkinsci/jenkins/pull/4552#discussion_r389262036", "createdAt": "2020-03-07T15:27:35Z", "author": {"login": "res0nance"}, "path": "core/src/main/java/hudson/model/AbstractCIBase.java", "diffHunk": "@@ -93,13 +93,26 @@ protected void killComputer(Computer c) {\n     * Package-protected, but accessed API\n     * ============================================================================================================== */\n \n-    /*package*/ final CopyOnWriteArraySet<String> disabledAdministrativeMonitors = new CopyOnWriteArraySet<>();\n+    private Set<String> disabledAdministrativeMonitors = new HashSet<>();\n \n-    @Restricted(NoExternalUse.class)\n-    public CopyOnWriteArraySet<String> getDisabledAdministrativeMonitors(){\n+    /**\n+     * Get the disabled administrative monitors\n+     *\n+     * @since TODO\n+     */\n+    public Set<String> getDisabledAdministrativeMonitors(){\n     \treturn disabledAdministrativeMonitors;\n     }\n-    \n+\n+    /**\n+     * Set the disabled administrative monitors\n+     *\n+     * @since TODO\n+     */\n+    public void setDisabledAdministrativeMonitors(Set<String> disabledAdministrativeMonitors){\n+        this.disabledAdministrativeMonitors = disabledAdministrativeMonitors;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87adc908830d60326857d8f25be6dd6b67688d76"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTI2MjE5Ng==", "bodyText": "There is a gigantic comment above that you might want to consider removing", "url": "https://github.com/jenkinsci/jenkins/pull/4552#discussion_r389262196", "createdAt": "2020-03-07T15:30:19Z", "author": {"login": "res0nance"}, "path": "core/src/main/java/hudson/model/AbstractCIBase.java", "diffHunk": "@@ -93,13 +93,26 @@ protected void killComputer(Computer c) {\n     * Package-protected, but accessed API\n     * ============================================================================================================== */\n \n-    /*package*/ final CopyOnWriteArraySet<String> disabledAdministrativeMonitors = new CopyOnWriteArraySet<>();\n+    private Set<String> disabledAdministrativeMonitors = new HashSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87adc908830d60326857d8f25be6dd6b67688d76"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNDE5Mjgw", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-373419280", "createdAt": "2020-03-12T10:04:45Z", "commit": {"oid": "87adc908830d60326857d8f25be6dd6b67688d76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMDowNDo0NVrOF1YJJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMDowNDo0NVrOF1YJJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUxNDQwNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void setDisabledAdministrativeMonitors(Set<String> disabledAdministrativeMonitors){\n          \n          \n            \n                public void setDisabledAdministrativeMonitors(Set<String> disabledAdministrativeMonitors) {", "url": "https://github.com/jenkinsci/jenkins/pull/4552#discussion_r391514406", "createdAt": "2020-03-12T10:04:45Z", "author": {"login": "alecharp"}, "path": "core/src/main/java/hudson/model/AbstractCIBase.java", "diffHunk": "@@ -93,13 +93,26 @@ protected void killComputer(Computer c) {\n     * Package-protected, but accessed API\n     * ============================================================================================================== */\n \n-    /*package*/ final CopyOnWriteArraySet<String> disabledAdministrativeMonitors = new CopyOnWriteArraySet<>();\n+    private Set<String> disabledAdministrativeMonitors = new HashSet<>();\n \n-    @Restricted(NoExternalUse.class)\n-    public CopyOnWriteArraySet<String> getDisabledAdministrativeMonitors(){\n+    /**\n+     * Get the disabled administrative monitors\n+     *\n+     * @since TODO\n+     */\n+    public Set<String> getDisabledAdministrativeMonitors(){\n     \treturn disabledAdministrativeMonitors;\n     }\n-    \n+\n+    /**\n+     * Set the disabled administrative monitors\n+     *\n+     * @since TODO\n+     */\n+    public void setDisabledAdministrativeMonitors(Set<String> disabledAdministrativeMonitors){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87adc908830d60326857d8f25be6dd6b67688d76"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNDIxNDI3", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-373421427", "createdAt": "2020-03-12T10:07:43Z", "commit": {"oid": "87adc908830d60326857d8f25be6dd6b67688d76"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f33d76323020021025ea5084a1b779181589dc69", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/f33d76323020021025ea5084a1b779181589dc69", "committedDate": "2020-03-14T16:06:24Z", "message": "Merge branch 'master' into disable-admin-monitors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1083c29e6d0c2880801dbb05df9f06592c0215aa", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/1083c29e6d0c2880801dbb05df9f06592c0215aa", "committedDate": "2020-03-14T16:27:27Z", "message": "Removed out of date comment and small tweaks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cfe46b25fb3d03d095135a1bc77de8c9ecd840b", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/6cfe46b25fb3d03d095135a1bc77de8c9ecd840b", "committedDate": "2020-03-14T16:28:14Z", "message": "Formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a3f01025f53e3cf78d53b508531deb70757fb62", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/1a3f01025f53e3cf78d53b508531deb70757fb62", "committedDate": "2020-03-14T19:39:02Z", "message": "Use copy on write in setter"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzkwNzM5", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-374790739", "createdAt": "2020-03-15T11:25:41Z", "commit": {"oid": "1a3f01025f53e3cf78d53b508531deb70757fb62"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMToyNTo0MVrOF2eVEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMToyNjo1MlrOF2eVdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY2NDMzOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void setDisabledAdministrativeMonitors(Set<String> disabledAdministrativeMonitors) {\n          \n          \n            \n                public synchronized void setDisabledAdministrativeMonitors(Set<String> disabledAdministrativeMonitors) {", "url": "https://github.com/jenkinsci/jenkins/pull/4552#discussion_r392664339", "createdAt": "2020-03-15T11:25:41Z", "author": {"login": "timja"}, "path": "core/src/main/java/hudson/model/AbstractCIBase.java", "diffHunk": "@@ -89,17 +89,26 @@ protected void killComputer(Computer c) {\n         c.kill();\n     }\n \n-    /* =================================================================================================================\n-    * Package-protected, but accessed API\n-    * ============================================================================================================== */\n-\n-    /*package*/ final CopyOnWriteArraySet<String> disabledAdministrativeMonitors = new CopyOnWriteArraySet<>();\n+    private Set<String> disabledAdministrativeMonitors = new CopyOnWriteArraySet<>();\n \n-    @Restricted(NoExternalUse.class)\n-    public CopyOnWriteArraySet<String> getDisabledAdministrativeMonitors(){\n+    /**\n+     * Get the disabled administrative monitors\n+     *\n+     * @since TODO\n+     */\n+    public Set<String> getDisabledAdministrativeMonitors(){\n     \treturn disabledAdministrativeMonitors;\n     }\n-    \n+\n+    /**\n+     * Set the disabled administrative monitors\n+     *\n+     * @since TODO\n+     */\n+    public void setDisabledAdministrativeMonitors(Set<String> disabledAdministrativeMonitors) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a3f01025f53e3cf78d53b508531deb70757fb62"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY2NDQzOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private Set<String> disabledAdministrativeMonitors = new CopyOnWriteArraySet<>();\n          \n          \n            \n                private volatile Set<String> disabledAdministrativeMonitors = new CopyOnWriteArraySet<>();", "url": "https://github.com/jenkinsci/jenkins/pull/4552#discussion_r392664438", "createdAt": "2020-03-15T11:26:52Z", "author": {"login": "timja"}, "path": "core/src/main/java/hudson/model/AbstractCIBase.java", "diffHunk": "@@ -89,17 +89,26 @@ protected void killComputer(Computer c) {\n         c.kill();\n     }\n \n-    /* =================================================================================================================\n-    * Package-protected, but accessed API\n-    * ============================================================================================================== */\n-\n-    /*package*/ final CopyOnWriteArraySet<String> disabledAdministrativeMonitors = new CopyOnWriteArraySet<>();\n+    private Set<String> disabledAdministrativeMonitors = new CopyOnWriteArraySet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a3f01025f53e3cf78d53b508531deb70757fb62"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34ba209f2c219c5a44c845d6cb80e0151ad7e8b0", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/34ba209f2c219c5a44c845d6cb80e0151ad7e8b0", "committedDate": "2020-03-16T16:33:18Z", "message": "synchronized"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NDA3OTU5", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-375407959", "createdAt": "2020-03-16T16:54:59Z", "commit": {"oid": "34ba209f2c219c5a44c845d6cb80e0151ad7e8b0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjo1NDo1OVrOF29K6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxNjo1NDo1OVrOF29K6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE2OTY0Mg==", "bodyText": "My mistake; this will likely still need to be either CopyOnWriteArraySet or use Collections.synchronizedSet() around this. Otherwise, a caller that iterates on the result of getDisabledAdministrativeMonitors() may get a ConcurrentModificationException when another thread calls disable() which modifies the set.\nAlternatively, you can update getDisabledAdministrativeMonitors to wrap the set in a new HashSet to copy the set and prevent the issue entirely.", "url": "https://github.com/jenkinsci/jenkins/pull/4552#discussion_r393169642", "createdAt": "2020-03-16T16:54:59Z", "author": {"login": "jvz"}, "path": "core/src/main/java/hudson/model/AbstractCIBase.java", "diffHunk": "@@ -89,17 +89,26 @@ protected void killComputer(Computer c) {\n         c.kill();\n     }\n \n-    /* =================================================================================================================\n-    * Package-protected, but accessed API\n-    * ============================================================================================================== */\n-\n-    /*package*/ final CopyOnWriteArraySet<String> disabledAdministrativeMonitors = new CopyOnWriteArraySet<>();\n+    private volatile Set<String> disabledAdministrativeMonitors = new HashSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "34ba209f2c219c5a44c845d6cb80e0151ad7e8b0"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57c47ab385ac77cdab76bbba39a3e6a2eaf1a1f7", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/57c47ab385ac77cdab76bbba39a3e6a2eaf1a1f7", "committedDate": "2020-03-16T17:00:00Z", "message": "Back to copyonwrite"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NDIxNzc5", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-375421779", "createdAt": "2020-03-16T17:12:16Z", "commit": {"oid": "57c47ab385ac77cdab76bbba39a3e6a2eaf1a1f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NDI1MDI2", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-375425026", "createdAt": "2020-03-16T17:16:25Z", "commit": {"oid": "57c47ab385ac77cdab76bbba39a3e6a2eaf1a1f7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5301e58ee5c8ecfa1abc4be0c46f2d277233d3df", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/5301e58ee5c8ecfa1abc4be0c46f2d277233d3df", "committedDate": "2020-03-16T18:42:52Z", "message": "Tweaks to thread safety"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NDk1MTU2", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-375495156", "createdAt": "2020-03-16T18:49:31Z", "commit": {"oid": "5301e58ee5c8ecfa1abc4be0c46f2d277233d3df"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODo0OTozMVrOF3BkJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxODo0OTozMVrOF3BkJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI0MTYzOA==", "bodyText": "This can just return the object. The synchronization will happen either implicitly through calls to the Set methods or when we synchronize on the object explicitly in the setter.", "url": "https://github.com/jenkinsci/jenkins/pull/4552#discussion_r393241638", "createdAt": "2020-03-16T18:49:31Z", "author": {"login": "jvz"}, "path": "core/src/main/java/hudson/model/AbstractCIBase.java", "diffHunk": "@@ -89,17 +89,31 @@ protected void killComputer(Computer c) {\n         c.kill();\n     }\n \n-    /* =================================================================================================================\n-    * Package-protected, but accessed API\n-    * ============================================================================================================== */\n+    private final Set<String> disabledAdministrativeMonitors = Collections.synchronizedSet(new HashSet<>());\n \n-    /*package*/ final CopyOnWriteArraySet<String> disabledAdministrativeMonitors = new CopyOnWriteArraySet<>();\n+    /**\n+     * Get the disabled administrative monitors\n+     *\n+     * @since TODO\n+     */\n+    public Set<String> getDisabledAdministrativeMonitors(){\n+        synchronized (disabledAdministrativeMonitors) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5301e58ee5c8ecfa1abc4be0c46f2d277233d3df"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "880d83473df0ad36e3d56e5a7f31fe5e134ce692", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/880d83473df0ad36e3d56e5a7f31fe5e134ce692", "committedDate": "2020-03-16T18:58:05Z", "message": "Last change hopefully"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NTA4MTI3", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-375508127", "createdAt": "2020-03-16T19:05:15Z", "commit": {"oid": "880d83473df0ad36e3d56e5a7f31fe5e134ce692"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NTEwNTAz", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-375510503", "createdAt": "2020-03-16T19:09:07Z", "commit": {"oid": "880d83473df0ad36e3d56e5a7f31fe5e134ce692"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxOTowOTowN1rOF3CSVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxOTowOTowN1rOF3CSVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI1MzQ2Mg==", "bodyText": "Is it really needed to have synchronized method as well as inside the method?", "url": "https://github.com/jenkinsci/jenkins/pull/4552#discussion_r393253462", "createdAt": "2020-03-16T19:09:07Z", "author": {"login": "jetersen"}, "path": "core/src/main/java/hudson/model/AbstractCIBase.java", "diffHunk": "@@ -89,17 +89,29 @@ protected void killComputer(Computer c) {\n         c.kill();\n     }\n \n-    /* =================================================================================================================\n-    * Package-protected, but accessed API\n-    * ============================================================================================================== */\n+    private final Set<String> disabledAdministrativeMonitors = Collections.synchronizedSet(new HashSet<>());\n \n-    /*package*/ final CopyOnWriteArraySet<String> disabledAdministrativeMonitors = new CopyOnWriteArraySet<>();\n+    /**\n+     * Get the disabled administrative monitors\n+     *\n+     * @since TODO\n+     */\n+    public Set<String> getDisabledAdministrativeMonitors(){\n+        return disabledAdministrativeMonitors;\n+    }\n \n-    @Restricted(NoExternalUse.class)\n-    public CopyOnWriteArraySet<String> getDisabledAdministrativeMonitors(){\n-    \treturn disabledAdministrativeMonitors;\n+    /**\n+     * Set the disabled administrative monitors\n+     *\n+     * @since TODO\n+     */\n+    public synchronized void setDisabledAdministrativeMonitors(Set<String> disabledAdministrativeMonitors) {\n+        synchronized (this.disabledAdministrativeMonitors) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "880d83473df0ad36e3d56e5a7f31fe5e134ce692"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc046440df3dbb71345af204829762c54e72c4cf", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/fc046440df3dbb71345af204829762c54e72c4cf", "committedDate": "2020-03-16T20:11:59Z", "message": "Remove synchronized on method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NjYzMTk2", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-375663196", "createdAt": "2020-03-17T00:17:42Z", "commit": {"oid": "fc046440df3dbb71345af204829762c54e72c4cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMDoxNzo0MlrOF3J_Bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMDoxNzo0MlrOF3J_Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3OTU5MA==", "bodyText": "The docs of synchronizedSet says (I've never used this before)\nReturns a synchronized (thread-safe) set backed by the specified set. In order to guarantee serial access, it is critical that all access to the backing set is accomplished through the returned set.\n\nIt is imperative that the user manually synchronize on the returned set when iterating over it:\n\n  Set s = Collections.synchronizedSet(new HashSet());\n      ...\n  synchronized (s) {\n      Iterator i = s.iterator(); // Must be in the synchronized block\n      while (i.hasNext())\n          foo(i.next());\n  }\n \n\nFailure to follow this advice may result in non-deterministic behavior. \n\nI'm not sure what it means by Failure to follow this advice may result in non-deterministic behavior. in here", "url": "https://github.com/jenkinsci/jenkins/pull/4552#discussion_r393379590", "createdAt": "2020-03-17T00:17:42Z", "author": {"login": "res0nance"}, "path": "core/src/main/java/hudson/model/AbstractCIBase.java", "diffHunk": "@@ -89,17 +89,29 @@ protected void killComputer(Computer c) {\n         c.kill();\n     }\n \n-    /* =================================================================================================================\n-    * Package-protected, but accessed API\n-    * ============================================================================================================== */\n+    private final Set<String> disabledAdministrativeMonitors = Collections.synchronizedSet(new HashSet<>());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc046440df3dbb71345af204829762c54e72c4cf"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d53453e67ef1a322f141a3bece0e67e412b7060a", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/d53453e67ef1a322f141a3bece0e67e412b7060a", "committedDate": "2020-03-25T07:58:44Z", "message": "Merge branch 'master' into disable-admin-monitors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51e1883436a839a22360bf78dc84f3f8d03f6899", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/51e1883436a839a22360bf78dc84f3f8d03f6899", "committedDate": "2020-03-25T08:12:00Z", "message": "Simplify code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwOTQ2NzQ1", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-380946745", "createdAt": "2020-03-25T08:43:00Z", "commit": {"oid": "51e1883436a839a22360bf78dc84f3f8d03f6899"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwODo0MzowMFrOF7Q01g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwODo0MzowMFrOF7Q01g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY4NTk3NA==", "bodyText": "This seems dangerous, you should check if value is in the set before trying to add or remove it.", "url": "https://github.com/jenkinsci/jenkins/pull/4552#discussion_r397685974", "createdAt": "2020-03-25T08:43:00Z", "author": {"login": "jetersen"}, "path": "core/src/main/java/hudson/model/AdministrativeMonitor.java", "diffHunk": "@@ -118,8 +118,12 @@ public final String getSearchUrl() {\n     public void disable(boolean value) throws IOException {\n         AbstractCIBase jenkins = Jenkins.get();\n         Set<String> set = jenkins.getDisabledAdministrativeMonitors();\n-        if(value)   set.add(id);\n-        else        set.remove(id);\n+        if (value) {\n+            set.add(id);\n+        } else {\n+            set.remove(id);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51e1883436a839a22360bf78dc84f3f8d03f6899"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwOTcwODE5", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-380970819", "createdAt": "2020-03-25T09:17:57Z", "commit": {"oid": "51e1883436a839a22360bf78dc84f3f8d03f6899"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8bc527dd0e6eb031f387eda9364eae7c6891da5", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/e8bc527dd0e6eb031f387eda9364eae7c6891da5", "committedDate": "2020-03-25T14:24:29Z", "message": "Update sync"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMjYzMzM3", "url": "https://github.com/jenkinsci/jenkins/pull/4552#pullrequestreview-381263337", "createdAt": "2020-03-25T15:29:21Z", "commit": {"oid": "e8bc527dd0e6eb031f387eda9364eae7c6891da5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1258, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}