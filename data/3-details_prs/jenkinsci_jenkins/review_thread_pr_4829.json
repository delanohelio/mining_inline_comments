{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NDAzOTA0", "number": 4829, "reviewThreads": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzoyNjozMlrOELx1uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTo1NTo1NlrOEQYpqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzg2MzYwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzoyNjozMlrOGtgloQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxODoyNjoxMlrOGtiesQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3MzAyNQ==", "bodyText": "This is for developers so should not be a localized message.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450373025", "createdAt": "2020-07-06T17:26:32Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -104,15 +104,51 @@ default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNu\n      */\n     default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNull EnvVars env, @NonNull Launcher launcher,\n                          @NonNull TaskListener listener) throws InterruptedException, IOException {\n-        // If this is called, this must be an implementer of the previous API, in which case we call that, discarding\n+        // If this does not require a workspace, defer to the version that does not take a workspace and launcher.\n+        if (!this.requiresWorkspace()) {\n+            this.perform(run, env, listener);\n+            return;\n+        }\n+        // If we get here, this must be an implementer of the previous API, in which case we call that, discarding\n         // the environment we were given.\n         // But for that to work, that API method must have been implemented.\n         if (Util.isOverridden(SimpleBuildStep.class, this.getClass(),\n                 \"perform\", Run.class, FilePath.class, Launcher.class, TaskListener.class)) {\n             this.perform(run, workspace, launcher, listener);\n         } else {\n-            throw new AbstractMethodError();\n+            throw new AbstractMethodError(Messages.SimpleBuildStep_NeedPerformMethodWithWorkspace());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQwNDAxNw==", "bodyText": "Figured as much; if this path is taken, I'll delocalize them.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450404017", "createdAt": "2020-07-06T18:26:12Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -104,15 +104,51 @@ default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNu\n      */\n     default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNull EnvVars env, @NonNull Launcher launcher,\n                          @NonNull TaskListener listener) throws InterruptedException, IOException {\n-        // If this is called, this must be an implementer of the previous API, in which case we call that, discarding\n+        // If this does not require a workspace, defer to the version that does not take a workspace and launcher.\n+        if (!this.requiresWorkspace()) {\n+            this.perform(run, env, listener);\n+            return;\n+        }\n+        // If we get here, this must be an implementer of the previous API, in which case we call that, discarding\n         // the environment we were given.\n         // But for that to work, that API method must have been implemented.\n         if (Util.isOverridden(SimpleBuildStep.class, this.getClass(),\n                 \"perform\", Run.class, FilePath.class, Launcher.class, TaskListener.class)) {\n             this.perform(run, workspace, launcher, listener);\n         } else {\n-            throw new AbstractMethodError();\n+            throw new AbstractMethodError(Messages.SimpleBuildStep_NeedPerformMethodWithWorkspace());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3MzAyNQ=="}, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzg2NTgwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzoyNzoxMVrOGtgm-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzoyNzoxMVrOGtgm-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3MzM2OA==", "bodyText": "ditto, and should be an IllegalStateException or similar", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450373368", "createdAt": "2020-07-06T17:27:11Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -104,15 +104,51 @@ default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNu\n      */\n     default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNull EnvVars env, @NonNull Launcher launcher,\n                          @NonNull TaskListener listener) throws InterruptedException, IOException {\n-        // If this is called, this must be an implementer of the previous API, in which case we call that, discarding\n+        // If this does not require a workspace, defer to the version that does not take a workspace and launcher.\n+        if (!this.requiresWorkspace()) {\n+            this.perform(run, env, listener);\n+            return;\n+        }\n+        // If we get here, this must be an implementer of the previous API, in which case we call that, discarding\n         // the environment we were given.\n         // But for that to work, that API method must have been implemented.\n         if (Util.isOverridden(SimpleBuildStep.class, this.getClass(),\n                 \"perform\", Run.class, FilePath.class, Launcher.class, TaskListener.class)) {\n             this.perform(run, workspace, launcher, listener);\n         } else {\n-            throw new AbstractMethodError();\n+            throw new AbstractMethodError(Messages.SimpleBuildStep_NeedPerformMethodWithWorkspace());\n+        }\n+    }\n+\n+    /**\n+     * Determines whether or not this step requires a workspace context (working directory and launcher).\n+     * <p>\n+     * When this returns {@code true}, {@link #perform(Run, FilePath, EnvVars, Launcher, TaskListener)} applies.\n+     * Otherwise, {@link #perform(Run, EnvVars, TaskListener)} applies.\n+     *\n+     * @return {@code true} if this step requires a workspace context; {@code false} otherwise.\n+     * @since TODO\n+     */\n+    default boolean requiresWorkspace() {\n+        return true;\n+    }\n+\n+    /**\n+     * Run this step, without a workspace context.\n+     * @param run a build this is running as a part of\n+     * @param env environment variables applicable to this step\n+     * @param listener a place to send output\n+     * @throws InterruptedException if the step is interrupted\n+     * @throws IOException if something goes wrong; use {@link AbortException} for a polite error\n+     * @since TODO\n+     */\n+    default void perform(@NonNull Run<?, ?> run, @NonNull EnvVars env, @NonNull TaskListener listener) throws InterruptedException, IOException {\n+        // If this step requires a workspace, this is the wrong method to call.\n+        if (this.requiresWorkspace()) {\n+            throw new AbortException(Messages.SimpleBuildStep_WorkspaceContextNeeded());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzg2NjA5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzoyNzoxN1rOGtgnHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzoyNzoxN1rOGtgnHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3MzQwNQ==", "bodyText": "ditto", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450373405", "createdAt": "2020-07-06T17:27:17Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -104,15 +104,51 @@ default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNu\n      */\n     default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNull EnvVars env, @NonNull Launcher launcher,\n                          @NonNull TaskListener listener) throws InterruptedException, IOException {\n-        // If this is called, this must be an implementer of the previous API, in which case we call that, discarding\n+        // If this does not require a workspace, defer to the version that does not take a workspace and launcher.\n+        if (!this.requiresWorkspace()) {\n+            this.perform(run, env, listener);\n+            return;\n+        }\n+        // If we get here, this must be an implementer of the previous API, in which case we call that, discarding\n         // the environment we were given.\n         // But for that to work, that API method must have been implemented.\n         if (Util.isOverridden(SimpleBuildStep.class, this.getClass(),\n                 \"perform\", Run.class, FilePath.class, Launcher.class, TaskListener.class)) {\n             this.perform(run, workspace, launcher, listener);\n         } else {\n-            throw new AbstractMethodError();\n+            throw new AbstractMethodError(Messages.SimpleBuildStep_NeedPerformMethodWithWorkspace());\n+        }\n+    }\n+\n+    /**\n+     * Determines whether or not this step requires a workspace context (working directory and launcher).\n+     * <p>\n+     * When this returns {@code true}, {@link #perform(Run, FilePath, EnvVars, Launcher, TaskListener)} applies.\n+     * Otherwise, {@link #perform(Run, EnvVars, TaskListener)} applies.\n+     *\n+     * @return {@code true} if this step requires a workspace context; {@code false} otherwise.\n+     * @since TODO\n+     */\n+    default boolean requiresWorkspace() {\n+        return true;\n+    }\n+\n+    /**\n+     * Run this step, without a workspace context.\n+     * @param run a build this is running as a part of\n+     * @param env environment variables applicable to this step\n+     * @param listener a place to send output\n+     * @throws InterruptedException if the step is interrupted\n+     * @throws IOException if something goes wrong; use {@link AbortException} for a polite error\n+     * @since TODO\n+     */\n+    default void perform(@NonNull Run<?, ?> run, @NonNull EnvVars env, @NonNull TaskListener listener) throws InterruptedException, IOException {\n+        // If this step requires a workspace, this is the wrong method to call.\n+        if (this.requiresWorkspace()) {\n+            throw new AbortException(Messages.SimpleBuildStep_WorkspaceContextNeeded());\n         }\n+        // Otherwise, this method must have an implementation.\n+        throw new AbstractMethodError(Messages.SimpleBuildStep_NeedPerformMethodWithoutWorkspace());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzg3MjIzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzoyOToxOVrOGtgrBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNzo0NzowOVrOGwzKFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDQwNQ==", "bodyText": "Invert the sense of the field since a deserialized Disposer from a Jenkins session prior to upgrade (for Pipeline builds) will have fields set to default values like false unless you implement readResolve.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450374405", "createdAt": "2020-07-06T17:29:19Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,6 +156,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @deprecated Use the constructor that takes a wrapper instance instead.\n+         */\n+        @Deprecated\n+        protected Disposer() {\n+            this.requiresWorkspace = true;\n+        }\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @param wrapper The wrapper for which this is a callback; used to determine whether or not this callback\n+         *                requires a workspace context (working directory and launcher). That choice determines whether\n+         *                {@link #tearDown(Run, FilePath, Launcher, TaskListener)} or\n+         *                {@link #tearDown(Run, TaskListener)} applies.\n+         * @since TODO\n+         */\n+        protected Disposer(@NonNull SimpleBuildWrapper wrapper) {\n+            this.requiresWorkspace = wrapper.requiresWorkspace();\n+        }\n+\n+        private final boolean requiresWorkspace;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQwNTMxMQ==", "bodyText": "Do these actually get persisted? I thought they were only serialized for sending to the agent for execution.\nBut sure, inverting the field's meaning is easy.\nOr, I could just make this a method like on the other objects, avoiding the serialization issue entirely.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450405311", "createdAt": "2020-07-06T18:28:42Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,6 +156,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @deprecated Use the constructor that takes a wrapper instance instead.\n+         */\n+        @Deprecated\n+        protected Disposer() {\n+            this.requiresWorkspace = true;\n+        }\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @param wrapper The wrapper for which this is a callback; used to determine whether or not this callback\n+         *                requires a workspace context (working directory and launcher). That choice determines whether\n+         *                {@link #tearDown(Run, FilePath, Launcher, TaskListener)} or\n+         *                {@link #tearDown(Run, TaskListener)} applies.\n+         * @since TODO\n+         */\n+        protected Disposer(@NonNull SimpleBuildWrapper wrapper) {\n+            this.requiresWorkspace = wrapper.requiresWorkspace();\n+        }\n+\n+        private final boolean requiresWorkspace;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDQwNQ=="}, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQwODAxOQ==", "bodyText": "Disposers are not sent to the agent. They are serialized in a Pipeline build, so that you can write for example\nxvnc {\n  sh 'make world'\n}\nand have Jenkins restart in the middle of the make command but still know what to clean up later.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450408019", "createdAt": "2020-07-06T18:34:10Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,6 +156,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @deprecated Use the constructor that takes a wrapper instance instead.\n+         */\n+        @Deprecated\n+        protected Disposer() {\n+            this.requiresWorkspace = true;\n+        }\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @param wrapper The wrapper for which this is a callback; used to determine whether or not this callback\n+         *                requires a workspace context (working directory and launcher). That choice determines whether\n+         *                {@link #tearDown(Run, FilePath, Launcher, TaskListener)} or\n+         *                {@link #tearDown(Run, TaskListener)} applies.\n+         * @since TODO\n+         */\n+        protected Disposer(@NonNull SimpleBuildWrapper wrapper) {\n+            this.requiresWorkspace = wrapper.requiresWorkspace();\n+        }\n+\n+        private final boolean requiresWorkspace;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDQwNQ=="}, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQwODUyMQ==", "bodyText": "a method like on the other objects\n\nAs noted in the other PR, I would prefer to have a single flag for an implementor that covers both setup and teardown.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450408521", "createdAt": "2020-07-06T18:35:07Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,6 +156,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @deprecated Use the constructor that takes a wrapper instance instead.\n+         */\n+        @Deprecated\n+        protected Disposer() {\n+            this.requiresWorkspace = true;\n+        }\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @param wrapper The wrapper for which this is a callback; used to determine whether or not this callback\n+         *                requires a workspace context (working directory and launcher). That choice determines whether\n+         *                {@link #tearDown(Run, FilePath, Launcher, TaskListener)} or\n+         *                {@link #tearDown(Run, TaskListener)} applies.\n+         * @since TODO\n+         */\n+        protected Disposer(@NonNull SimpleBuildWrapper wrapper) {\n+            this.requiresWorkspace = wrapper.requiresWorkspace();\n+        }\n+\n+        private final boolean requiresWorkspace;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDQwNQ=="}, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUzMzI4OA==", "bodyText": "I know - but unfortunately neither the creation nor the execution of a Disposer is directly tied to a SimpleBuildWrapper.\nUnless it would be acceptable to add a constructor to Disposer that takes a SimpleBuildWrapper; then it could set its internal flag from that.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450533288", "createdAt": "2020-07-06T23:39:06Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,6 +156,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @deprecated Use the constructor that takes a wrapper instance instead.\n+         */\n+        @Deprecated\n+        protected Disposer() {\n+            this.requiresWorkspace = true;\n+        }\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @param wrapper The wrapper for which this is a callback; used to determine whether or not this callback\n+         *                requires a workspace context (working directory and launcher). That choice determines whether\n+         *                {@link #tearDown(Run, FilePath, Launcher, TaskListener)} or\n+         *                {@link #tearDown(Run, TaskListener)} applies.\n+         * @since TODO\n+         */\n+        protected Disposer(@NonNull SimpleBuildWrapper wrapper) {\n+            this.requiresWorkspace = wrapper.requiresWorkspace();\n+        }\n+\n+        private final boolean requiresWorkspace;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDQwNQ=="}, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3NDM4OQ==", "bodyText": "see #4829 (comment)", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453774389", "createdAt": "2020-07-13T16:26:41Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,6 +156,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @deprecated Use the constructor that takes a wrapper instance instead.\n+         */\n+        @Deprecated\n+        protected Disposer() {\n+            this.requiresWorkspace = true;\n+        }\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @param wrapper The wrapper for which this is a callback; used to determine whether or not this callback\n+         *                requires a workspace context (working directory and launcher). That choice determines whether\n+         *                {@link #tearDown(Run, FilePath, Launcher, TaskListener)} or\n+         *                {@link #tearDown(Run, TaskListener)} applies.\n+         * @since TODO\n+         */\n+        protected Disposer(@NonNull SimpleBuildWrapper wrapper) {\n+            this.requiresWorkspace = wrapper.requiresWorkspace();\n+        }\n+\n+        private final boolean requiresWorkspace;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDQwNQ=="}, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgyMjk5OA==", "bodyText": "OK, will look at how to arrange it like that.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453822998", "createdAt": "2020-07-13T17:47:09Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,6 +156,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @deprecated Use the constructor that takes a wrapper instance instead.\n+         */\n+        @Deprecated\n+        protected Disposer() {\n+            this.requiresWorkspace = true;\n+        }\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @param wrapper The wrapper for which this is a callback; used to determine whether or not this callback\n+         *                requires a workspace context (working directory and launcher). That choice determines whether\n+         *                {@link #tearDown(Run, FilePath, Launcher, TaskListener)} or\n+         *                {@link #tearDown(Run, TaskListener)} applies.\n+         * @since TODO\n+         */\n+        protected Disposer(@NonNull SimpleBuildWrapper wrapper) {\n+            this.requiresWorkspace = wrapper.requiresWorkspace();\n+        }\n+\n+        private final boolean requiresWorkspace;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDQwNQ=="}, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzg3NDI1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzoyOTo0OVrOGtgsLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzoyOTo0OVrOGtgsLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDcwMw==", "bodyText": "no i18n", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450374703", "createdAt": "2020-07-06T17:29:49Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -126,7 +191,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n          * @throws IOException if something fails; {@link AbortException} for user errors\n          * @throws InterruptedException if tear down is interrupted\n          */\n-        public abstract void tearDown(Run<?,?> build, FilePath workspace, Launcher launcher, TaskListener listener) throws IOException, InterruptedException;\n+        public void tearDown(Run<?,?> build, FilePath workspace, Launcher launcher, TaskListener listener) throws IOException, InterruptedException {\n+            // If this does not require a workspace, defer to the version that does not take a workspace and launcher.\n+            if (!this.requiresWorkspace) {\n+                this.tearDown(build, listener);\n+                return;\n+            }\n+            throw new AbstractMethodError(Messages.SimpleBuildWrapper_Disposer_NeedTearDownMethodWithWorkspace());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzg3NDY0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzoyOTo1NVrOGtgsaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzoyOTo1NVrOGtgsaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDc2Mw==", "bodyText": "ditto", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450374763", "createdAt": "2020-07-06T17:29:55Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -126,7 +191,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n          * @throws IOException if something fails; {@link AbortException} for user errors\n          * @throws InterruptedException if tear down is interrupted\n          */\n-        public abstract void tearDown(Run<?,?> build, FilePath workspace, Launcher launcher, TaskListener listener) throws IOException, InterruptedException;\n+        public void tearDown(Run<?,?> build, FilePath workspace, Launcher launcher, TaskListener listener) throws IOException, InterruptedException {\n+            // If this does not require a workspace, defer to the version that does not take a workspace and launcher.\n+            if (!this.requiresWorkspace) {\n+                this.tearDown(build, listener);\n+                return;\n+            }\n+            throw new AbstractMethodError(Messages.SimpleBuildWrapper_Disposer_NeedTearDownMethodWithWorkspace());\n+        }\n+\n+        /**\n+         * Attempt to clean up anything that was done in the initial setup.\n+         * @param build a build being run\n+         * @param listener a way to report progress\n+         * @throws IOException if something fails; {@link AbortException} for user errors\n+         * @throws InterruptedException if tear down is interrupted\n+         * @since TODO\n+         */\n+        public void tearDown(Run<?,?> build, TaskListener listener) throws IOException, InterruptedException {\n+            // If this callback requires a workspace, this is the wrong method to call.\n+            if (this.requiresWorkspace) {\n+                throw new AbortException(Messages.SimpleBuildWrapper_Disposer_WorkspaceContextNeeded());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 124}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzg3NDkyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzozMDowMFrOGtgslg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzozMDowMFrOGtgslg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDgwNg==", "bodyText": "ditto", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450374806", "createdAt": "2020-07-06T17:30:00Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -126,7 +191,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n          * @throws IOException if something fails; {@link AbortException} for user errors\n          * @throws InterruptedException if tear down is interrupted\n          */\n-        public abstract void tearDown(Run<?,?> build, FilePath workspace, Launcher launcher, TaskListener listener) throws IOException, InterruptedException;\n+        public void tearDown(Run<?,?> build, FilePath workspace, Launcher launcher, TaskListener listener) throws IOException, InterruptedException {\n+            // If this does not require a workspace, defer to the version that does not take a workspace and launcher.\n+            if (!this.requiresWorkspace) {\n+                this.tearDown(build, listener);\n+                return;\n+            }\n+            throw new AbstractMethodError(Messages.SimpleBuildWrapper_Disposer_NeedTearDownMethodWithWorkspace());\n+        }\n+\n+        /**\n+         * Attempt to clean up anything that was done in the initial setup.\n+         * @param build a build being run\n+         * @param listener a way to report progress\n+         * @throws IOException if something fails; {@link AbortException} for user errors\n+         * @throws InterruptedException if tear down is interrupted\n+         * @since TODO\n+         */\n+        public void tearDown(Run<?,?> build, TaskListener listener) throws IOException, InterruptedException {\n+            // If this callback requires a workspace, this is the wrong method to call.\n+            if (this.requiresWorkspace) {\n+                throw new AbortException(Messages.SimpleBuildWrapper_Disposer_WorkspaceContextNeeded());\n+            }\n+            // Otherwise, this method must have an implementation.\n+            throw new AbstractMethodError(Messages.SimpleBuildWrapper_Disposer_NeedTearDownMethodWithoutWorkspace());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 127}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzg3NTY2OnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/jenkins/tasks/Messages.properties", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzozMDoxMlrOGtgtBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzozMDoxMlrOGtgtBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NDkxNg==", "bodyText": "ditto", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450374916", "createdAt": "2020-07-06T17:30:12Z", "author": {"login": "jglick"}, "path": "core/src/main/resources/jenkins/tasks/Messages.properties", "diffHunk": "@@ -0,0 +1,9 @@\n+SimpleBuildStep.NeedPerformMethodWithWorkspace=Unless a build step is marked as not requiring a workspace context, you must implement the overload of the perform() method that takes both a workspace and a launcher.\n+SimpleBuildStep.NeedPerformMethodWithoutWorkspace=When a build step is marked as not requiring a workspace context, you must implement the overload of the perform() method that does not take a workspace or launcher.\n+SimpleBuildStep.WorkspaceContextNeeded=This build step requires a workspace context, but none was provided.\n+SimpleBuildWrapper.NeedSetUpMethodWithWorkspace=Unless a build wrapper is marked as not requiring a workspace context, you must implement the overload of the setUp() method that takes both a workspace and a launcher.\n+SimpleBuildWrapper.NeedSetUpMethodWithoutWorkspace=When a build wrapper is marked as not requiring a workspace context, you must implement the overload of the setUp() method that does not take a workspace or launcher.\n+SimpleBuildWrapper.WorkspaceContextNeeded=This build wrapper requires a workspace context, but none was provided.\n+SimpleBuildWrapper_Disposer.NeedTearDownMethodWithWorkspace=Unless an end-of-wrapped-block callback is marked as not requiring a workspace context, you must implement the overload of the tearDown() method that takes both a workspace and a launcher.\n+SimpleBuildWrapper_Disposer.NeedTearDownMethodWithoutWorkspace=When an end-of-wrapped-block callback is marked as not requiring a workspace context, you must implement the overload of the tearDown() method that does not take a workspace or launcher.\n+SimpleBuildWrapper_Disposer.WorkspaceContextNeeded=This end-of-wrapped-block callback requires a workspace context, but none was provided.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzg3NjIyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzozMDoyM1rOGtgtZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzozMDoyM1rOGtgtZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NTAxMw==", "bodyText": "ditto", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450375013", "createdAt": "2020-07-06T17:30:23Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -75,7 +75,46 @@\n      * @throws IOException if something fails; {@link AbortException} for user errors\n      * @throws InterruptedException if setup is interrupted\n      */\n-    public abstract void setUp(Context context, Run<?,?> build, FilePath workspace, Launcher launcher, TaskListener listener, EnvVars initialEnvironment) throws IOException, InterruptedException;\n+    public void setUp(Context context, Run<?,?> build, FilePath workspace, Launcher launcher, TaskListener listener, EnvVars initialEnvironment) throws IOException, InterruptedException {\n+        // If this does not require a workspace, defer to the version that does not take a workspace and launcher.\n+        if (!this.requiresWorkspace()) {\n+            this.setUp(context, build, listener, initialEnvironment);\n+            return;\n+        }\n+        throw new AbstractMethodError(Messages.SimpleBuildWrapper_NeedSetUpMethodWithWorkspace());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzg3NjYwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzozMDoyOFrOGtgtng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzozMDoyOFrOGtgtng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NTA3MA==", "bodyText": "ditto", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450375070", "createdAt": "2020-07-06T17:30:28Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -75,7 +75,46 @@\n      * @throws IOException if something fails; {@link AbortException} for user errors\n      * @throws InterruptedException if setup is interrupted\n      */\n-    public abstract void setUp(Context context, Run<?,?> build, FilePath workspace, Launcher launcher, TaskListener listener, EnvVars initialEnvironment) throws IOException, InterruptedException;\n+    public void setUp(Context context, Run<?,?> build, FilePath workspace, Launcher launcher, TaskListener listener, EnvVars initialEnvironment) throws IOException, InterruptedException {\n+        // If this does not require a workspace, defer to the version that does not take a workspace and launcher.\n+        if (!this.requiresWorkspace()) {\n+            this.setUp(context, build, listener, initialEnvironment);\n+            return;\n+        }\n+        throw new AbstractMethodError(Messages.SimpleBuildWrapper_NeedSetUpMethodWithWorkspace());\n+    }\n+\n+    /**\n+     * Determines whether or not this wrapper requires a workspace context (working directory and launcher).\n+     * <p>\n+     * When this returns {@code true}, {@link #setUp(Context, Run, FilePath, Launcher, TaskListener, EnvVars)} applies.\n+     * Otherwise, {@link #setUp(Context, Run, TaskListener, EnvVars)} applies.\n+     *\n+     * @return {@code true} if this step requires a workspace context; {@code false} otherwise.\n+     * @since TODO\n+     */\n+    boolean requiresWorkspace() {\n+        return true;\n+    }\n+\n+    /**\n+     * Called when a segment of a build is started that is to be enhanced with this wrapper.\n+     * @param context a way of collecting modifications to the environment for nested steps\n+     * @param build a build being run\n+     * @param listener a way to report progress\n+     * @param initialEnvironment the environment variables set at the outset\n+     * @throws IOException if something fails; {@link AbortException} for user errors\n+     * @throws InterruptedException if setup is interrupted\n+     * @since TODO\n+     */\n+    public void setUp(Context context, Run<?,?> build, TaskListener listener, EnvVars initialEnvironment) throws IOException, InterruptedException {\n+        // If this wrapper requires a workspace, this is the wrong method to call.\n+        if (this.requiresWorkspace()) {\n+            throw new AbortException(Messages.SimpleBuildWrapper_WorkspaceContextNeeded());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzg3NzQ1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzozMDo0MlrOGtguLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNzozMDo0MlrOGtguLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM3NTIxNQ==", "bodyText": "ditto", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450375215", "createdAt": "2020-07-06T17:30:42Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -75,7 +75,46 @@\n      * @throws IOException if something fails; {@link AbortException} for user errors\n      * @throws InterruptedException if setup is interrupted\n      */\n-    public abstract void setUp(Context context, Run<?,?> build, FilePath workspace, Launcher launcher, TaskListener listener, EnvVars initialEnvironment) throws IOException, InterruptedException;\n+    public void setUp(Context context, Run<?,?> build, FilePath workspace, Launcher launcher, TaskListener listener, EnvVars initialEnvironment) throws IOException, InterruptedException {\n+        // If this does not require a workspace, defer to the version that does not take a workspace and launcher.\n+        if (!this.requiresWorkspace()) {\n+            this.setUp(context, build, listener, initialEnvironment);\n+            return;\n+        }\n+        throw new AbstractMethodError(Messages.SimpleBuildWrapper_NeedSetUpMethodWithWorkspace());\n+    }\n+\n+    /**\n+     * Determines whether or not this wrapper requires a workspace context (working directory and launcher).\n+     * <p>\n+     * When this returns {@code true}, {@link #setUp(Context, Run, FilePath, Launcher, TaskListener, EnvVars)} applies.\n+     * Otherwise, {@link #setUp(Context, Run, TaskListener, EnvVars)} applies.\n+     *\n+     * @return {@code true} if this step requires a workspace context; {@code false} otherwise.\n+     * @since TODO\n+     */\n+    boolean requiresWorkspace() {\n+        return true;\n+    }\n+\n+    /**\n+     * Called when a segment of a build is started that is to be enhanced with this wrapper.\n+     * @param context a way of collecting modifications to the environment for nested steps\n+     * @param build a build being run\n+     * @param listener a way to report progress\n+     * @param initialEnvironment the environment variables set at the outset\n+     * @throws IOException if something fails; {@link AbortException} for user errors\n+     * @throws InterruptedException if setup is interrupted\n+     * @since TODO\n+     */\n+    public void setUp(Context context, Run<?,?> build, TaskListener listener, EnvVars initialEnvironment) throws IOException, InterruptedException {\n+        // If this wrapper requires a workspace, this is the wrong method to call.\n+        if (this.requiresWorkspace()) {\n+            throw new AbortException(Messages.SimpleBuildWrapper_WorkspaceContextNeeded());\n+        }\n+        // Otherwise, this method must have an implementation.\n+        throw new AbstractMethodError(Messages.SimpleBuildWrapper_NeedSetUpMethodWithoutWorkspace());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwOTE3MjIwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QwMjoyMzoxMVrOGts-Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxOToyOToxNlrOGw2ulg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU3NTk0Mw==", "bodyText": "Should not be necessary. Context can be told whether its associated wrapper requests a workspace; then setDisposer can pass this bit of information along to the Disposer.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r450575943", "createdAt": "2020-07-07T02:23:11Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,6 +156,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @deprecated Use the constructor that takes a wrapper instance instead.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0MTgyMg==", "bodyText": "That is possible for non-pipeline cases only. When we're dealing with AbstractBuild, then the final overrides of setUp() and preCheckout() offer a place where I can tell the Context whether or not the wrapper needs a workspace context. Then I can just use a private Boolean field on both Context and Disposer to pass the flag across.\nBut for pipeline use, all methods involved are virtual and non-final, so there does not seem to be any place in code where I can guarantee interaction between the created Context and the SimpleBuildWrapper instance. The equivalent place in CoreWrapperStep would be the doStart() method. But then I would have to add public API to Context to flag the requirement there, which feels worse than simply allowing the Dispatcher to be told at construction time.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453841822", "createdAt": "2020-07-13T18:19:47Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,6 +156,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @deprecated Use the constructor that takes a wrapper instance instead.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU3NTk0Mw=="}, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg0OTg2Ng==", "bodyText": "add public API to Context to flag the requirement there\n\nWhat is the problem with that? Plugin authors would never notice such an API; would be used only from workflow-basic-steps plus core itself.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453849866", "createdAt": "2020-07-13T18:33:01Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,6 +156,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @deprecated Use the constructor that takes a wrapper instance instead.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU3NTk0Mw=="}, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg2OTYwMQ==", "bodyText": "Are there really no use cases supported other than AbstractBuild or pipeline? If not, then I suppose it's fine as long as workflow-basic-steps sets things up correctly.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453869601", "createdAt": "2020-07-13T19:07:47Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,6 +156,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @deprecated Use the constructor that takes a wrapper instance instead.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU3NTk0Mw=="}, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg3MjUzMw==", "bodyText": "Are there really no use cases supported other than AbstractBuild or pipeline?\n\nNo, that is it.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453872533", "createdAt": "2020-07-13T19:13:02Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,6 +156,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @deprecated Use the constructor that takes a wrapper instance instead.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU3NTk0Mw=="}, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg4MTQ5NA==", "bodyText": "OK, I think I have something that works. Note that I think this does mean that when an old version of workflow-basic-steps is used with new core + a plugin with a wrapper marked as no-workspace-required, then any Disposer for that wrapper will require that context and potentially fail (because the Context.setWorkspaceRequirement() won't have been called).", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453881494", "createdAt": "2020-07-13T19:29:16Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,6 +156,32 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        /**\n+         * Creates a new end-of-wrapped-block callback.\n+         *\n+         * @deprecated Use the constructor that takes a wrapper instance instead.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU3NTk0Mw=="}, "originalCommit": {"oid": "d60492d75697b4f911320f6b60abc7fccd078e6d"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDkxMTkwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDoyMzo1OFrOGw4d-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDo1ODo0MFrOGw5n5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxMDAxMQ==", "bodyText": "I do not think we generally try to align Javadoc.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @throws IOException          if something goes wrong; use {@link AbortException} for a polite error\n          \n          \n            \n                 * @throws IOException if something goes wrong; use {@link AbortException} for a polite error", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453910011", "createdAt": "2020-07-13T20:23:58Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -93,28 +93,76 @@ default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNu\n \n     /**\n      * Run this step.\n-     * @param run a build this is running as a part of\n+     * <p>\n+     * This method <strong>must</strong> be overridden when this step requires a workspace context. If such a context is\n+     * <em>not</em> required, it does not need to be overridden; it will then forward to\n+     * {@link #perform(Run, EnvVars, TaskListener)}.\n+     *\n+     * @param run       a build this is running as a part of\n      * @param workspace a workspace to use for any file operations\n-     * @param env environment variables applicable to this step\n-     * @param launcher a way to start processes\n-     * @param listener a place to send output\n+     * @param env       environment variables applicable to this step\n+     * @param launcher  a way to start processes\n+     * @param listener  a place to send output\n+     * @throws AbstractMethodError  if this step requires a workspace context and this method is not overridden\n      * @throws InterruptedException if the step is interrupted\n-     * @throws IOException if something goes wrong; use {@link AbortException} for a polite error\n+     * @throws IOException          if something goes wrong; use {@link AbortException} for a polite error", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f054885d5439f4b9bbb448104e875dfae3264cf9"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkyODkzMw==", "bodyText": "It's something IntelliJ does; I can remove the indents manually if needed.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453928933", "createdAt": "2020-07-13T20:58:40Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -93,28 +93,76 @@ default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNu\n \n     /**\n      * Run this step.\n-     * @param run a build this is running as a part of\n+     * <p>\n+     * This method <strong>must</strong> be overridden when this step requires a workspace context. If such a context is\n+     * <em>not</em> required, it does not need to be overridden; it will then forward to\n+     * {@link #perform(Run, EnvVars, TaskListener)}.\n+     *\n+     * @param run       a build this is running as a part of\n      * @param workspace a workspace to use for any file operations\n-     * @param env environment variables applicable to this step\n-     * @param launcher a way to start processes\n-     * @param listener a place to send output\n+     * @param env       environment variables applicable to this step\n+     * @param launcher  a way to start processes\n+     * @param listener  a place to send output\n+     * @throws AbstractMethodError  if this step requires a workspace context and this method is not overridden\n      * @throws InterruptedException if the step is interrupted\n-     * @throws IOException if something goes wrong; use {@link AbortException} for a polite error\n+     * @throws IOException          if something goes wrong; use {@link AbortException} for a polite error", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxMDAxMQ=="}, "originalCommit": {"oid": "f054885d5439f4b9bbb448104e875dfae3264cf9"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDkxODA5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDoyNToyN1rOGw4hfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMToxNjoyNlrOGw6KyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxMDkxMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                boolean requiresWorkspace() {\n          \n          \n            \n                protected boolean requiresWorkspace() {\n          \n      \n    \n    \n  \n\nas you will see when you try to write a test for this", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453910911", "createdAt": "2020-07-13T20:25:27Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -64,18 +64,69 @@\n @SuppressWarnings(\"rawtypes\") // inherited\n public abstract class SimpleBuildWrapper extends BuildWrapper {\n \n+    /**\n+     * Determines whether or not this wrapper requires a workspace context (working directory and launcher).\n+     * <p>\n+     * When such a context is required (the default), {@link #setUp(Context, Run, FilePath, Launcher, TaskListener, EnvVars)} applies.\n+     * Otherwise, {@link #setUp(Context, Run, TaskListener, EnvVars)} applies.\n+     *\n+     * @return {@code true} if this wrapper requires a workspace context; {@code false} otherwise.\n+     * @since TODO\n+     */\n+    boolean requiresWorkspace() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f054885d5439f4b9bbb448104e875dfae3264cf9"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkzMjU5OA==", "bodyText": "Right.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453932598", "createdAt": "2020-07-13T21:05:52Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -64,18 +64,69 @@\n @SuppressWarnings(\"rawtypes\") // inherited\n public abstract class SimpleBuildWrapper extends BuildWrapper {\n \n+    /**\n+     * Determines whether or not this wrapper requires a workspace context (working directory and launcher).\n+     * <p>\n+     * When such a context is required (the default), {@link #setUp(Context, Run, FilePath, Launcher, TaskListener, EnvVars)} applies.\n+     * Otherwise, {@link #setUp(Context, Run, TaskListener, EnvVars)} applies.\n+     *\n+     * @return {@code true} if this wrapper requires a workspace context; {@code false} otherwise.\n+     * @since TODO\n+     */\n+    boolean requiresWorkspace() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxMDkxMQ=="}, "originalCommit": {"oid": "f054885d5439f4b9bbb448104e875dfae3264cf9"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkzNzg2NA==", "bodyText": "Actually, no. This needs to be public - it's the method you override to show you don't need a workspace context, which is information the caller needs to call the right setUp overload.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453937864", "createdAt": "2020-07-13T21:16:26Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -64,18 +64,69 @@\n @SuppressWarnings(\"rawtypes\") // inherited\n public abstract class SimpleBuildWrapper extends BuildWrapper {\n \n+    /**\n+     * Determines whether or not this wrapper requires a workspace context (working directory and launcher).\n+     * <p>\n+     * When such a context is required (the default), {@link #setUp(Context, Run, FilePath, Launcher, TaskListener, EnvVars)} applies.\n+     * Otherwise, {@link #setUp(Context, Run, TaskListener, EnvVars)} applies.\n+     *\n+     * @return {@code true} if this wrapper requires a workspace context; {@code false} otherwise.\n+     * @since TODO\n+     */\n+    boolean requiresWorkspace() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxMDkxMQ=="}, "originalCommit": {"oid": "f054885d5439f4b9bbb448104e875dfae3264cf9"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDkyMTcwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDoyNjoyNFrOGw4jtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMToyOTozMVrOGw6ksg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxMTQ3Ng==", "bodyText": "Should be either @Restricted(Beta.class) or otherwise make it clear that an implementation of SimpleBuildWrapper can ignore this.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453911476", "createdAt": "2020-07-13T20:26:24Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -97,6 +148,17 @@ public void env(String key, String value) {\n             }\n             env.put(key, value);\n         }\n+        private Boolean wrapperRequiresWorkspace;\n+        /**\n+         * Keeps track of whether or not the specified wrapper requires a workspace context (working directory and\n+         * launcher).\n+         * <p>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f054885d5439f4b9bbb448104e875dfae3264cf9"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkzNjQ3MA==", "bodyText": "Not sure I follow. This is on Context, so an implementation of SimpleBuildWrapper generally does not need to care anyway.\nAnd I'm not sure why the restriction to Beta would make sense; for example, workflow-basic-steps needs to use this.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453936470", "createdAt": "2020-07-13T21:13:41Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -97,6 +148,17 @@ public void env(String key, String value) {\n             }\n             env.put(key, value);\n         }\n+        private Boolean wrapperRequiresWorkspace;\n+        /**\n+         * Keeps track of whether or not the specified wrapper requires a workspace context (working directory and\n+         * launcher).\n+         * <p>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxMTQ3Ng=="}, "originalCommit": {"oid": "f054885d5439f4b9bbb448104e875dfae3264cf9"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk0NDQ5OA==", "bodyText": "This is on Context, so an implementation of SimpleBuildWrapper generally does not need to care anyway.\n\nImplementations would call other methods on Context.\n\nfor example, workflow-basic-steps needs to use this\n\nAnd that is intended to be the only example. Beta would just be a way of reminding other plugins not to use it.\nNot important, just one suggestion to help clarify that this is part of the implementation, not the normal API.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453944498", "createdAt": "2020-07-13T21:29:31Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -97,6 +148,17 @@ public void env(String key, String value) {\n             }\n             env.put(key, value);\n         }\n+        private Boolean wrapperRequiresWorkspace;\n+        /**\n+         * Keeps track of whether or not the specified wrapper requires a workspace context (working directory and\n+         * launcher).\n+         * <p>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxMTQ3Ng=="}, "originalCommit": {"oid": "f054885d5439f4b9bbb448104e875dfae3264cf9"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDkyMjY4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDoyNjozOFrOGw4kSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMTozODozN1rOGw61Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxMTYyNg==", "bodyText": "Similarly here.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453911626", "createdAt": "2020-07-13T20:26:38Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,16 +182,70 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        private Boolean wrapperRequiresWorkspace;\n+\n+        /**\n+         * Determines whether or not this end-of-wrapped-block callback requires a workspace context (working\n+         * directory and launcher).\n+         * <p>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f054885d5439f4b9bbb448104e875dfae3264cf9"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk0MDE5OA==", "bodyText": "Not sure why this would be restricted - the caller needs this info to call the right tearDown overload.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453940198", "createdAt": "2020-07-13T21:21:09Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,16 +182,70 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        private Boolean wrapperRequiresWorkspace;\n+\n+        /**\n+         * Determines whether or not this end-of-wrapped-block callback requires a workspace context (working\n+         * directory and launcher).\n+         * <p>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxMTYyNg=="}, "originalCommit": {"oid": "f054885d5439f4b9bbb448104e875dfae3264cf9"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk0NDc3Ng==", "bodyText": "Again, the only external caller should be in workflow-basic-steps, so this is a reminder that \u201cregular\u201d plugins should not touch it.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453944776", "createdAt": "2020-07-13T21:30:09Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,16 +182,70 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        private Boolean wrapperRequiresWorkspace;\n+\n+        /**\n+         * Determines whether or not this end-of-wrapped-block callback requires a workspace context (working\n+         * directory and launcher).\n+         * <p>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxMTYyNg=="}, "originalCommit": {"oid": "f054885d5439f4b9bbb448104e875dfae3264cf9"}, "originalPosition": 115}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk0ODc0Mg==", "bodyText": "Oh, so workflow-basic-steps is already using a useBeta flag? Fair enough then.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453948742", "createdAt": "2020-07-13T21:38:37Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,16 +182,70 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        private Boolean wrapperRequiresWorkspace;\n+\n+        /**\n+         * Determines whether or not this end-of-wrapped-block callback requires a workspace context (working\n+         * directory and launcher).\n+         * <p>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxMTYyNg=="}, "originalCommit": {"oid": "f054885d5439f4b9bbb448104e875dfae3264cf9"}, "originalPosition": 115}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMDkyNDE2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMDoyNjo1OVrOGw4lHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMToyMToyMFrOGw6UPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxMTgzNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    private Boolean wrapperRequiresWorkspace;\n          \n          \n            \n                    @CheckForNull\n          \n          \n            \n                    private Boolean wrapperRequiresWorkspace;", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453911836", "createdAt": "2020-07-13T20:26:59Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,16 +182,70 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        private Boolean wrapperRequiresWorkspace;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f054885d5439f4b9bbb448104e875dfae3264cf9"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk0MDI4NA==", "bodyText": "Done", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r453940284", "createdAt": "2020-07-13T21:21:20Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -117,16 +182,70 @@ public void setDisposer(@NonNull Disposer disposer) {\n      * Must be safely serializable, so it receives runtime context comparable to that of the original setup.\n      */\n     public static abstract class Disposer implements Serializable {\n+\n+        private Boolean wrapperRequiresWorkspace;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkxMTgzNg=="}, "originalCommit": {"oid": "f054885d5439f4b9bbb448104e875dfae3264cf9"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NzYyMzIwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNTowNDoyNVrOGzWkeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzoxMjo1NVrOG0Xmww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUwMDM0NA==", "bodyText": "this comment doesn't seem right? beta just means that it's a new API and it may change in some way? To me anyway", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r456500344", "createdAt": "2020-07-17T15:04:25Z", "author": {"login": "timja"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -64,18 +66,70 @@\n @SuppressWarnings(\"rawtypes\") // inherited\n public abstract class SimpleBuildWrapper extends BuildWrapper {\n \n+    /**\n+     * Determines whether or not this wrapper requires a workspace context (working directory and launcher).\n+     * <p>\n+     * When such a context is required (the default), {@link #setUp(Context, Run, FilePath, Launcher, TaskListener, EnvVars)} applies.\n+     * Otherwise, {@link #setUp(Context, Run, TaskListener, EnvVars)} applies.\n+     *\n+     * @return {@code true} if this wrapper requires a workspace context; {@code false} otherwise.\n+     * @since TODO\n+     */\n+    @Restricted(Beta.class) // to indicate it is to be called by Jenkins internals only; not part of the normal API", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfe16f60d3ee76e6efc0e2380dc0a7dd4c402e06"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYwMDcyMw==", "bodyText": "jenkinsci/lib-access-modifier#25", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r456600723", "createdAt": "2020-07-17T18:15:52Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -64,18 +66,70 @@\n @SuppressWarnings(\"rawtypes\") // inherited\n public abstract class SimpleBuildWrapper extends BuildWrapper {\n \n+    /**\n+     * Determines whether or not this wrapper requires a workspace context (working directory and launcher).\n+     * <p>\n+     * When such a context is required (the default), {@link #setUp(Context, Run, FilePath, Launcher, TaskListener, EnvVars)} applies.\n+     * Otherwise, {@link #setUp(Context, Run, TaskListener, EnvVars)} applies.\n+     *\n+     * @return {@code true} if this wrapper requires a workspace context; {@code false} otherwise.\n+     * @since TODO\n+     */\n+    @Restricted(Beta.class) // to indicate it is to be called by Jenkins internals only; not part of the normal API", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUwMDM0NA=="}, "originalCommit": {"oid": "cfe16f60d3ee76e6efc0e2380dc0a7dd4c402e06"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY1MjMwOA==", "bodyText": "It's also why I added the comment, to make it clear its not \"regular\" Beta.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r456652308", "createdAt": "2020-07-17T20:10:47Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -64,18 +66,70 @@\n @SuppressWarnings(\"rawtypes\") // inherited\n public abstract class SimpleBuildWrapper extends BuildWrapper {\n \n+    /**\n+     * Determines whether or not this wrapper requires a workspace context (working directory and launcher).\n+     * <p>\n+     * When such a context is required (the default), {@link #setUp(Context, Run, FilePath, Launcher, TaskListener, EnvVars)} applies.\n+     * Otherwise, {@link #setUp(Context, Run, TaskListener, EnvVars)} applies.\n+     *\n+     * @return {@code true} if this wrapper requires a workspace context; {@code false} otherwise.\n+     * @since TODO\n+     */\n+    @Restricted(Beta.class) // to indicate it is to be called by Jenkins internals only; not part of the normal API", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUwMDM0NA=="}, "originalCommit": {"oid": "cfe16f60d3ee76e6efc0e2380dc0a7dd4c402e06"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU2NTg5MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Restricted(Beta.class) // to indicate it is to be called by Jenkins internals only; not part of the normal API\n          \n      \n    \n    \n  \n\nWrong here.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457565891", "createdAt": "2020-07-20T17:12:55Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -64,18 +66,70 @@\n @SuppressWarnings(\"rawtypes\") // inherited\n public abstract class SimpleBuildWrapper extends BuildWrapper {\n \n+    /**\n+     * Determines whether or not this wrapper requires a workspace context (working directory and launcher).\n+     * <p>\n+     * When such a context is required (the default), {@link #setUp(Context, Run, FilePath, Launcher, TaskListener, EnvVars)} applies.\n+     * Otherwise, {@link #setUp(Context, Run, TaskListener, EnvVars)} applies.\n+     *\n+     * @return {@code true} if this wrapper requires a workspace context; {@code false} otherwise.\n+     * @since TODO\n+     */\n+    @Restricted(Beta.class) // to indicate it is to be called by Jenkins internals only; not part of the normal API", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUwMDM0NA=="}, "originalCommit": {"oid": "cfe16f60d3ee76e6efc0e2380dc0a7dd4c402e06"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NTIxODMxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzoxMjowMlrOG0Xksg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzoxMjowMlrOG0Xksg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU2NTM2Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import org.kohsuke.accmod.restrictions.Beta;", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457565362", "createdAt": "2020-07-20T17:12:02Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -54,6 +54,7 @@\n import jenkins.model.RunAction2;\n import jenkins.model.TransientActionFactory;\n import org.kohsuke.accmod.Restricted;\n+import org.kohsuke.accmod.restrictions.Beta;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfe16f60d3ee76e6efc0e2380dc0a7dd4c402e06"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NTIxOTYzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzoxMjoyM1rOG0Xlew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNzoxMjoyM1rOG0Xlew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU2NTU2Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Restricted(Beta.class) // to indicate it is to be called by Jenkins internals only; not part of the normal API\n          \n      \n    \n    \n  \n\nNo, this is key to the public API for plugins implementing build steps.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457565563", "createdAt": "2020-07-20T17:12:23Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -159,6 +160,7 @@ default void perform(@NonNull Run<?, ?> run, @NonNull EnvVars env, @NonNull Task\n      * @return {@code true} if this step requires a workspace context; {@code false} otherwise.\n      * @since TODO\n      */\n+    @Restricted(Beta.class) // to indicate it is to be called by Jenkins internals only; not part of the normal API", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfe16f60d3ee76e6efc0e2380dc0a7dd4c402e06"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NTY5NzM1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxOToyNjo1NlrOG0cK8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTo1MToxMlrOG0gh6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0MDY5MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * <strong>must not</strong> be called when such a context <em>is</em> required.\n          \n          \n            \n                 * will not be called when such a context <em>is</em> required.\n          \n      \n    \n    \n  \n\n(write from the PoV of an implementor)", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457640690", "createdAt": "2020-07-20T19:26:56Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -93,28 +93,76 @@ default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNu\n \n     /**\n      * Run this step.\n+     * <p>\n+     * This method <strong>must</strong> be overridden when this step requires a workspace context. If such a context is\n+     * <em>not</em> required, it does not need to be overridden; it will then forward to\n+     * {@link #perform(Run, EnvVars, TaskListener)}.\n+     *\n      * @param run a build this is running as a part of\n      * @param workspace a workspace to use for any file operations\n      * @param env environment variables applicable to this step\n      * @param launcher a way to start processes\n      * @param listener a place to send output\n+     * @throws AbstractMethodError if this step requires a workspace context and neither this method nor {@link #perform(Run, FilePath, Launcher, TaskListener)} is overridden\n      * @throws InterruptedException if the step is interrupted\n      * @throws IOException if something goes wrong; use {@link AbortException} for a polite error\n      * @since TODO\n      */\n     default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNull EnvVars env, @NonNull Launcher launcher,\n                          @NonNull TaskListener listener) throws InterruptedException, IOException {\n-        // If this is called, this must be an implementer of the previous API, in which case we call that, discarding\n+        // If this does not require a workspace, defer to the version that does not take a workspace and launcher.\n+        if (!this.requiresWorkspace()) {\n+            this.perform(run, env, listener);\n+            return;\n+        }\n+        // If we get here, this must be an implementer of the previous API, in which case we call that, discarding\n         // the environment we were given.\n         // But for that to work, that API method must have been implemented.\n         if (Util.isOverridden(SimpleBuildStep.class, this.getClass(),\n                 \"perform\", Run.class, FilePath.class, Launcher.class, TaskListener.class)) {\n             this.perform(run, workspace, launcher, listener);\n         } else {\n-            throw new AbstractMethodError();\n+            throw new AbstractMethodError(\"Unless a build step is marked as not requiring a workspace context, you must implement the overload of the perform() method that takes both a workspace and a launcher.\");\n         }\n     }\n \n+    /**\n+     * Run this step, without a workspace context.\n+     * <p>\n+     * This method <strong>must</strong> be overridden when this step does not require a workspace context, and\n+     * <strong>must not</strong> be called when such a context <em>is</em> required.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxMTA5NQ==", "bodyText": "OK. I generally always write docs for the user of the method. But this change makes sense, and kind of works for the user/caller too.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457711095", "createdAt": "2020-07-20T21:48:55Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -93,28 +93,76 @@ default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNu\n \n     /**\n      * Run this step.\n+     * <p>\n+     * This method <strong>must</strong> be overridden when this step requires a workspace context. If such a context is\n+     * <em>not</em> required, it does not need to be overridden; it will then forward to\n+     * {@link #perform(Run, EnvVars, TaskListener)}.\n+     *\n      * @param run a build this is running as a part of\n      * @param workspace a workspace to use for any file operations\n      * @param env environment variables applicable to this step\n      * @param launcher a way to start processes\n      * @param listener a place to send output\n+     * @throws AbstractMethodError if this step requires a workspace context and neither this method nor {@link #perform(Run, FilePath, Launcher, TaskListener)} is overridden\n      * @throws InterruptedException if the step is interrupted\n      * @throws IOException if something goes wrong; use {@link AbortException} for a polite error\n      * @since TODO\n      */\n     default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNull EnvVars env, @NonNull Launcher launcher,\n                          @NonNull TaskListener listener) throws InterruptedException, IOException {\n-        // If this is called, this must be an implementer of the previous API, in which case we call that, discarding\n+        // If this does not require a workspace, defer to the version that does not take a workspace and launcher.\n+        if (!this.requiresWorkspace()) {\n+            this.perform(run, env, listener);\n+            return;\n+        }\n+        // If we get here, this must be an implementer of the previous API, in which case we call that, discarding\n         // the environment we were given.\n         // But for that to work, that API method must have been implemented.\n         if (Util.isOverridden(SimpleBuildStep.class, this.getClass(),\n                 \"perform\", Run.class, FilePath.class, Launcher.class, TaskListener.class)) {\n             this.perform(run, workspace, launcher, listener);\n         } else {\n-            throw new AbstractMethodError();\n+            throw new AbstractMethodError(\"Unless a build step is marked as not requiring a workspace context, you must implement the overload of the perform() method that takes both a workspace and a launcher.\");\n         }\n     }\n \n+    /**\n+     * Run this step, without a workspace context.\n+     * <p>\n+     * This method <strong>must</strong> be overridden when this step does not require a workspace context, and\n+     * <strong>must not</strong> be called when such a context <em>is</em> required.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0MDY5MA=="}, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxMjEwNg==", "bodyText": "My point is that the Javadoc is mostly going to read by plugin implementors of build steps/wrappers, and this emphasis was only relevant for the two call sites (in core and workflow-basic-steps).", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457712106", "createdAt": "2020-07-20T21:51:12Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -93,28 +93,76 @@ default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNu\n \n     /**\n      * Run this step.\n+     * <p>\n+     * This method <strong>must</strong> be overridden when this step requires a workspace context. If such a context is\n+     * <em>not</em> required, it does not need to be overridden; it will then forward to\n+     * {@link #perform(Run, EnvVars, TaskListener)}.\n+     *\n      * @param run a build this is running as a part of\n      * @param workspace a workspace to use for any file operations\n      * @param env environment variables applicable to this step\n      * @param launcher a way to start processes\n      * @param listener a place to send output\n+     * @throws AbstractMethodError if this step requires a workspace context and neither this method nor {@link #perform(Run, FilePath, Launcher, TaskListener)} is overridden\n      * @throws InterruptedException if the step is interrupted\n      * @throws IOException if something goes wrong; use {@link AbortException} for a polite error\n      * @since TODO\n      */\n     default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNull EnvVars env, @NonNull Launcher launcher,\n                          @NonNull TaskListener listener) throws InterruptedException, IOException {\n-        // If this is called, this must be an implementer of the previous API, in which case we call that, discarding\n+        // If this does not require a workspace, defer to the version that does not take a workspace and launcher.\n+        if (!this.requiresWorkspace()) {\n+            this.perform(run, env, listener);\n+            return;\n+        }\n+        // If we get here, this must be an implementer of the previous API, in which case we call that, discarding\n         // the environment we were given.\n         // But for that to work, that API method must have been implemented.\n         if (Util.isOverridden(SimpleBuildStep.class, this.getClass(),\n                 \"perform\", Run.class, FilePath.class, Launcher.class, TaskListener.class)) {\n             this.perform(run, workspace, launcher, listener);\n         } else {\n-            throw new AbstractMethodError();\n+            throw new AbstractMethodError(\"Unless a build step is marked as not requiring a workspace context, you must implement the overload of the perform() method that takes both a workspace and a launcher.\");\n         }\n     }\n \n+    /**\n+     * Run this step, without a workspace context.\n+     * <p>\n+     * This method <strong>must</strong> be overridden when this step does not require a workspace context, and\n+     * <strong>must not</strong> be called when such a context <em>is</em> required.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0MDY5MA=="}, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NTcwMDc0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxOToyODowMFrOG0cM7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxOToyODowMFrOG0cM7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0MTE5OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * <strong>must not</strong> be called when such a context <em>is</em> required.\n          \n          \n            \n                 * will not be called when such a context <em>is</em> required.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457641198", "createdAt": "2020-07-20T19:28:00Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -64,18 +66,69 @@\n @SuppressWarnings(\"rawtypes\") // inherited\n public abstract class SimpleBuildWrapper extends BuildWrapper {\n \n+    /**\n+     * Determines whether or not this wrapper requires a workspace context (working directory and launcher).\n+     * <p>\n+     * When such a context is required (the default), {@link #setUp(Context, Run, FilePath, Launcher, TaskListener, EnvVars)} applies.\n+     * Otherwise, {@link #setUp(Context, Run, TaskListener, EnvVars)} applies.\n+     *\n+     * @return {@code true} if this wrapper requires a workspace context; {@code false} otherwise.\n+     * @since TODO\n+     */\n+    public boolean requiresWorkspace() {\n+        return true;\n+    }\n+\n     /**\n      * Called when a segment of a build is started that is to be enhanced with this wrapper.\n+     * <p>\n+     * This method <strong>must</strong> be overridden when this wrapper requires a workspace context. If such a context\n+     * is <em>not</em> required, it does not need to be overridden; it will then forward to\n+     * {@link #setUp(Context, Run, TaskListener, EnvVars)}.\n+     *\n      * @param context a way of collecting modifications to the environment for nested steps\n      * @param build a build being run\n      * @param workspace a workspace of the build\n      * @param launcher a way to start commands\n      * @param listener a way to report progress\n      * @param initialEnvironment the environment variables set at the outset\n+     * @throws AbstractMethodError if this wrapper requires a workspace context, and this method is not overridden\n+     * @throws IOException if something fails; {@link AbortException} for user errors\n+     * @throws InterruptedException if setup is interrupted\n+     */\n+    public void setUp(Context context, Run<?,?> build, FilePath workspace, Launcher launcher, TaskListener listener, EnvVars initialEnvironment) throws IOException, InterruptedException {\n+        // If this does not require a workspace, defer to the version that does not take a workspace and launcher.\n+        if (!this.requiresWorkspace()) {\n+            this.setUp(context, build, listener, initialEnvironment);\n+            return;\n+        }\n+        throw new AbstractMethodError(\"Unless a build wrapper is marked as not requiring a workspace context, you must implement the overload of the setUp() method that takes both a workspace and a launcher.\");\n+    }\n+\n+    /**\n+     * Called when a segment of a build is started that is to be enhanced with this wrapper.\n+     * <p>\n+     * This method <strong>must</strong> be overridden when this wrapper does not require a workspace context, and\n+     * <strong>must not</strong> be called when such a context <em>is</em> required.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NTcyNTI2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxOTozNTo0MFrOG0ccHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjoyNzo0N1rOG0hb7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0NTA4NQ==", "bodyText": "Purely stylistic, but to make all this logic easier to follow:\n\nremove setWorkspaceRequirement\ndeprecate the implicit no-arg Context constructor (by first declaring it explicitly)\nintroduce a private (or package-scope) constructor taking a boolean requiresWorkspace argument\ncall that from a new \u201cbeta\u201d method SimpleBuildWrapper.createContext()\nthen you can\n\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        final Context c = new Context();\n          \n          \n            \n                        c.setWorkspaceRequirement(this);\n          \n          \n            \n                        final Context c = createContext();", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457645085", "createdAt": "2020-07-20T19:35:40Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -143,6 +268,7 @@ protected boolean runPreCheckout() {\n             return new Environment() {};\n         } else {\n             final Context c = new Context();\n+            c.setWorkspaceRequirement(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 188}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxMTEzOA==", "bodyText": "OK", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457711138", "createdAt": "2020-07-20T21:49:02Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -143,6 +268,7 @@ protected boolean runPreCheckout() {\n             return new Environment() {};\n         } else {\n             final Context c = new Context();\n+            c.setWorkspaceRequirement(this);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0NTA4NQ=="}, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 188}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyNjk1Nw==", "bodyText": "Done", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457726957", "createdAt": "2020-07-20T22:27:47Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -143,6 +268,7 @@ protected boolean runPreCheckout() {\n             return new Environment() {};\n         } else {\n             final Context c = new Context();\n+            c.setWorkspaceRequirement(this);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0NTA4NQ=="}, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 188}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NTczNTcyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxOTozODo0OVrOG0cieg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjowMToyOFrOG0gzJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0NjcxNA==", "bodyText": "Note: not actually necessary. Not sure if there is some style guide saying to use this. when not necessary to disambiguate but merely as a reminder that the reference is to a field.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457646714", "createdAt": "2020-07-20T19:38:49Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -172,7 +299,7 @@ protected boolean runPreCheckout() {\n         }\n         @Override public boolean tearDown(AbstractBuild build, BuildListener listener) throws IOException, InterruptedException {\n             if (c.disposer != null) {\n-                c.disposer.tearDown(build, build.getWorkspace(), launcher, listener);\n+                c.disposer.tearDown(build, build.getWorkspace(), this.launcher, listener);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 205}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxMTY2NQ==", "bodyText": "I tend towards always qualifiying with this (or the declaring class for static items) because I find it really helps when reading new codebases. I can drop this diff, no problem.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457711665", "createdAt": "2020-07-20T21:50:09Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -172,7 +299,7 @@ protected boolean runPreCheckout() {\n         }\n         @Override public boolean tearDown(AbstractBuild build, BuildListener listener) throws IOException, InterruptedException {\n             if (c.disposer != null) {\n-                c.disposer.tearDown(build, build.getWorkspace(), launcher, listener);\n+                c.disposer.tearDown(build, build.getWorkspace(), this.launcher, listener);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0NjcxNA=="}, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 205}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxMjM2MQ==", "bodyText": "Whatever you find more legible is fine.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457712361", "createdAt": "2020-07-20T21:51:46Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -172,7 +299,7 @@ protected boolean runPreCheckout() {\n         }\n         @Override public boolean tearDown(AbstractBuild build, BuildListener listener) throws IOException, InterruptedException {\n             if (c.disposer != null) {\n-                c.disposer.tearDown(build, build.getWorkspace(), launcher, listener);\n+                c.disposer.tearDown(build, build.getWorkspace(), this.launcher, listener);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0NjcxNA=="}, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 205}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxNjUxNg==", "bodyText": "Shrug. In this particular case, the class is so small it hardly matters either way, so I'll leave the change out of the PR.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457716516", "createdAt": "2020-07-20T22:01:28Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildWrapper.java", "diffHunk": "@@ -172,7 +299,7 @@ protected boolean runPreCheckout() {\n         }\n         @Override public boolean tearDown(AbstractBuild build, BuildListener listener) throws IOException, InterruptedException {\n             if (c.disposer != null) {\n-                c.disposer.tearDown(build, build.getWorkspace(), launcher, listener);\n+                c.disposer.tearDown(build, build.getWorkspace(), this.launcher, listener);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY0NjcxNA=="}, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 205}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NjE2NTUzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMTo1NTo1NlrOG0gprQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQwMzowNTowNlrOG0mZrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxNDA5Mw==", "bodyText": "Side note: I thought these were supposed to be updated as part of the release process? This particular method was added in 2.241 I think.", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457714093", "createdAt": "2020-07-20T21:55:56Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -93,28 +93,76 @@ default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNu\n \n     /**\n      * Run this step.\n+     * <p>\n+     * This method <strong>must</strong> be overridden when this step requires a workspace context. If such a context is\n+     * <em>not</em> required, it does not need to be overridden; it will then forward to\n+     * {@link #perform(Run, EnvVars, TaskListener)}.\n+     *\n      * @param run a build this is running as a part of\n      * @param workspace a workspace to use for any file operations\n      * @param env environment variables applicable to this step\n      * @param launcher a way to start processes\n      * @param listener a place to send output\n+     * @throws AbstractMethodError if this step requires a workspace context and neither this method nor {@link #perform(Run, FilePath, Launcher, TaskListener)} is overridden\n      * @throws InterruptedException if the step is interrupted\n      * @throws IOException if something goes wrong; use {@link AbortException} for a polite error\n      * @since TODO", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyNjcwOA==", "bodyText": "(This pointed to the @since TODO but apparently a line-based comment like this does not get updated by GH when more commits are added)", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457726708", "createdAt": "2020-07-20T22:27:03Z", "author": {"login": "Zastai"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -93,28 +93,76 @@ default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNu\n \n     /**\n      * Run this step.\n+     * <p>\n+     * This method <strong>must</strong> be overridden when this step requires a workspace context. If such a context is\n+     * <em>not</em> required, it does not need to be overridden; it will then forward to\n+     * {@link #perform(Run, EnvVars, TaskListener)}.\n+     *\n      * @param run a build this is running as a part of\n      * @param workspace a workspace to use for any file operations\n      * @param env environment variables applicable to this step\n      * @param launcher a way to start processes\n      * @param listener a place to send output\n+     * @throws AbstractMethodError if this step requires a workspace context and neither this method nor {@link #perform(Run, FilePath, Launcher, TaskListener)} is overridden\n      * @throws InterruptedException if the step is interrupted\n      * @throws IOException if something goes wrong; use {@link AbortException} for a polite error\n      * @since TODO", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxNDA5Mw=="}, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyNzI2Mw==", "bodyText": "Not sure, @daniel-beck?", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457727263", "createdAt": "2020-07-20T22:28:40Z", "author": {"login": "jglick"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -93,28 +93,76 @@ default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNu\n \n     /**\n      * Run this step.\n+     * <p>\n+     * This method <strong>must</strong> be overridden when this step requires a workspace context. If such a context is\n+     * <em>not</em> required, it does not need to be overridden; it will then forward to\n+     * {@link #perform(Run, EnvVars, TaskListener)}.\n+     *\n      * @param run a build this is running as a part of\n      * @param workspace a workspace to use for any file operations\n      * @param env environment variables applicable to this step\n      * @param launcher a way to start processes\n      * @param listener a place to send output\n+     * @throws AbstractMethodError if this step requires a workspace context and neither this method nor {@link #perform(Run, FilePath, Launcher, TaskListener)} is overridden\n      * @throws InterruptedException if the step is interrupted\n      * @throws IOException if something goes wrong; use {@link AbortException} for a polite error\n      * @since TODO", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxNDA5Mw=="}, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgwODMwMg==", "bodyText": "Contributors update them every now and then, it\u2019s not automated", "url": "https://github.com/jenkinsci/jenkins/pull/4829#discussion_r457808302", "createdAt": "2020-07-21T03:05:06Z", "author": {"login": "timja"}, "path": "core/src/main/java/jenkins/tasks/SimpleBuildStep.java", "diffHunk": "@@ -93,28 +93,76 @@ default void perform(@NonNull Run<?, ?> run, @NonNull FilePath workspace, @NonNu\n \n     /**\n      * Run this step.\n+     * <p>\n+     * This method <strong>must</strong> be overridden when this step requires a workspace context. If such a context is\n+     * <em>not</em> required, it does not need to be overridden; it will then forward to\n+     * {@link #perform(Run, EnvVars, TaskListener)}.\n+     *\n      * @param run a build this is running as a part of\n      * @param workspace a workspace to use for any file operations\n      * @param env environment variables applicable to this step\n      * @param launcher a way to start processes\n      * @param listener a place to send output\n+     * @throws AbstractMethodError if this step requires a workspace context and neither this method nor {@link #perform(Run, FilePath, Launcher, TaskListener)} is overridden\n      * @throws InterruptedException if the step is interrupted\n      * @throws IOException if something goes wrong; use {@link AbortException} for a polite error\n      * @since TODO", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxNDA5Mw=="}, "originalCommit": {"oid": "f1d10ecbbed1343b9b604557405f95b8b2e7f632"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 273, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}