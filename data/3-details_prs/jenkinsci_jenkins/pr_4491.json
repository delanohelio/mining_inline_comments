{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0NjE2Mjgx", "number": 4491, "title": "[JENKINS-61071] Ensure that initialization tasks run as SYSTEM", "bodyText": "See JENKINS-61071. Extends #4320.\nProposed changelog entries\n\nDynamically loading certain plugins could result in permission errors.", "createdAt": "2020-02-13T00:58:25Z", "url": "https://github.com/jenkinsci/jenkins/pull/4491", "merged": true, "mergeCommit": {"oid": "7ff5f097d0b6580045531c0aaa199b7482de9b7b"}, "closed": true, "closedAt": "2020-02-15T11:51:03Z", "author": {"login": "jglick"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDwDRGAH2gAyMzc0NjE2MjgxOmY5ZjhhMTcyOTJjM2FjYzk4NzVjMDc3OWJiODkyMDVhNDUwNTY3ZjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEiksjAH2gAyMzc0NjE2MjgxOjJlZGVjNzBhYjAzZGIwYmNmMDJlYWEzZTM2ZGQ5OTZhOGQ1ZDU5ZmU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f9f8a17292c3acc9875c0779bb89205a450567f1", "author": {"user": {"login": "jglick", "name": "Jesse Glick"}}, "url": "https://github.com/jenkinsci/jenkins/commit/f9f8a17292c3acc9875c0779bb89205a450567f1", "committedDate": "2020-02-13T00:46:52Z", "message": "[JENKINS-61071] Ensure that initialization tasks run as SYSTEM"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3ODk4Nzg5", "url": "https://github.com/jenkinsci/jenkins/pull/4491#pullrequestreview-357898789", "createdAt": "2020-02-13T01:16:29Z", "commit": {"oid": "f9f8a17292c3acc9875c0779bb89205a450567f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3ODk5NDg1", "url": "https://github.com/jenkinsci/jenkins/pull/4491#pullrequestreview-357899485", "createdAt": "2020-02-13T01:18:47Z", "commit": {"oid": "f9f8a17292c3acc9875c0779bb89205a450567f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwMToxODo0N1rOFpEJ-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QwMToxODo0N1rOFpEJ-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODYwNDAyNg==", "bodyText": "Without patch:\njava.io.IOException: Failed to install require-system-in-initializer plugin\n\tat hudson.PluginManager.dynamicLoad(PluginManager.java:942)\n\tat hudson.PluginManager.dynamicLoad(PluginManager.java:876)\n\tat hudson.PluginManagerUtil.dynamicLoad(PluginManagerUtil.java:72)\n\tat hudson.PluginManagerUtil.dynamicLoad(PluginManagerUtil.java:62)\n\tat hudson.PluginManagerTest.dynamicLoad(PluginManagerTest.java:519)\n\tat hudson.PluginManagerTest.requireSystemInInitializer(PluginManagerTest.java:512)\n\tat \u2026\nCaused by: org.jvnet.hudson.reactor.ReactorException: java.lang.Error: java.lang.reflect.InvocationTargetException\n\tat org.jvnet.hudson.reactor.Reactor.execute(Reactor.java:282)\n\tat jenkins.InitReactorRunner.run(InitReactorRunner.java:48)\n\tat hudson.PluginManager.start(PluginManager.java:992)\n\tat hudson.PluginManager.dynamicLoad(PluginManager.java:935)\n\t... 18 more\nCaused by: java.lang.Error: java.lang.reflect.InvocationTargetException\n\tat hudson.init.TaskMethodFinder.invoke(TaskMethodFinder.java:110)\n\tat hudson.init.TaskMethodFinder$TaskImpl.run(TaskMethodFinder.java:175)\n\tat org.jvnet.hudson.reactor.Reactor.runTask(Reactor.java:296)\n\tat org.jvnet.hudson.reactor.Reactor$2.run(Reactor.java:214)\n\tat org.jvnet.hudson.reactor.Reactor$Node.run(Reactor.java:117)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\t... 1 more\nCaused by: java.lang.reflect.InvocationTargetException\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat hudson.init.TaskMethodFinder.invoke(TaskMethodFinder.java:104)\n\t... 7 more\nCaused by: hudson.security.AccessDeniedException2: anonymous is missing the Overall/Administer permission\n\tat hudson.security.ACL.checkPermission(ACL.java:73)\n\tat hudson.security.AccessControlled.checkPermission(AccessControlled.java:47)\n\tat io.jenkins.plugins.require_system_in_initializer.Main.stuff(Main.java:34)\n\t... 12 more", "url": "https://github.com/jenkinsci/jenkins/pull/4491#discussion_r378604026", "createdAt": "2020-02-13T01:18:47Z", "author": {"login": "jglick"}, "path": "test/src/test/java/hudson/PluginManagerTest.java", "diffHunk": "@@ -503,6 +503,18 @@ public void requireSystemDuringStart() throws Exception {\n         }\n     }\n \n+    @Issue(\"JENKINS-61071\")\n+    @Test\n+    public void requireSystemInInitializer() throws Exception {\n+        r.jenkins.setSecurityRealm(r.createDummySecurityRealm());\n+        r.jenkins.setAuthorizationStrategy(new MockAuthorizationStrategy());\n+        String pluginShortName = \"require-system-in-initializer\";\n+        dynamicLoad(pluginShortName + \".jpi\");\n+        try (ACLContext context = ACL.as(User.getById(\"underprivileged\", true).impersonate())) {\n+            r.jenkins.pluginManager.start(Collections.singletonList(r.jenkins.pluginManager.getPlugin(pluginShortName)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9f8a17292c3acc9875c0779bb89205a450567f1"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4MDM2MzI5", "url": "https://github.com/jenkinsci/jenkins/pull/4491#pullrequestreview-358036329", "createdAt": "2020-02-13T08:42:35Z", "commit": {"oid": "f9f8a17292c3acc9875c0779bb89205a450567f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4MjA4NzI3", "url": "https://github.com/jenkinsci/jenkins/pull/4491#pullrequestreview-358208727", "createdAt": "2020-02-13T13:21:16Z", "commit": {"oid": "f9f8a17292c3acc9875c0779bb89205a450567f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2edec70ab03db0bcf02eaa3e36dd996a8d5d59fe", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/2edec70ab03db0bcf02eaa3e36dd996a8d5d59fe", "committedDate": "2020-02-15T11:38:38Z", "message": "Merge branch 'master' into InitReactorRunner-SYSTEM-JENKINS-61071"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1534, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}