{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5MTY4MTQ1", "number": 4522, "title": "[JENKINS-61300] Update search box size on page resize, max width", "bodyText": "To reproduce:\n\nopen Jenkins in a small browser window (small enough for search to be hidden)\nmake the window bigger\ntype in  long text\n\nExpected:\n\nafter resize the search box is reasonably big\nwhen typing, autocompletion size follows search box size\n\nActual:\n\n\nafter resize there is a 60px wide search box\n\n\n\nwhen typing, on key up the autocomplete size syncs with box, but resizes back when autocomplete results are fetched\n\n\nThis PR fixes 1) by adding a resize listener and 2) by applying minWidth instead of width. Also removes extra div that was used for minWidth computation and uses CSS min-width instead.\nProposed changelog entries\n\nEntry 1: Update size of the search box properly when screen is resized.\n\n\nProposed upgrade guidelines\nN/A\nSubmitter checklist\n\n[n/a] JIRA issue is well described\n Changelog entries and upgrade guidelines are appropriate for the audience affected by the change (users or developer, depending on the change). Examples\n\nFill-in the Proposed changelog entries section only if there are breaking changes or other changes which may require extra steps from users during the upgrade\n\n\n[n/a] Appropriate autotests or explanation to why this change has no tests\n[n/a] For dependency updates: links to external changelogs and, if possible, full diffs\n\n\nDesired reviewers\n@fqueiruga\n\nMaintainer checklist\nBefore the changes are marked as ready-for-merge:\n\n There are at least 2 approvals for the pull request and no outstanding requests for change\n Conversations in the pull request are over OR it is explicit that a reviewer does not block the change\n Changelog entries in the PR title and/or Proposed changelog entries are correct\n Proper changelog labels are set so that the changelog can be generated automatically\n If the change needs additional upgrade steps from users, upgrade-guide-needed label is set and there is a Proposed upgrade guidelines section in the PR title. (example)\n If it would make sense to backport the change to LTS, a JIRA issue should exist and be labeled as lts-candidate", "createdAt": "2020-02-24T19:16:24Z", "url": "https://github.com/jenkinsci/jenkins/pull/4522", "merged": true, "mergeCommit": {"oid": "6a275901d07b69461d6613911b770ee8118b48b7"}, "closed": true, "closedAt": "2020-03-06T11:32:49Z", "author": {"login": "zbynek"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHYtiogH2gAyMzc5MTY4MTQ1OjI5NGQwMTFkZWMwNzYzZWY2MGMyNmU4NmNiOGFjYTVhMjk0MDY2YmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKn2aFgFqTM2OTM5ODQ0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "294d011dec0763ef60c26e86cb8aca5a294066bc", "author": {"user": {"login": "zbynek", "name": "Zbynek Konecny"}}, "url": "https://github.com/jenkinsci/jenkins/commit/294d011dec0763ef60c26e86cb8aca5a294066bc", "committedDate": "2020-02-24T07:51:01Z", "message": "Update search box size on page resize, simplify code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NDg1MzA3", "url": "https://github.com/jenkinsci/jenkins/pull/4522#pullrequestreview-364485307", "createdAt": "2020-02-25T22:07:42Z", "commit": {"oid": "294d011dec0763ef60c26e86cb8aca5a294066bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NzExNDQz", "url": "https://github.com/jenkinsci/jenkins/pull/4522#pullrequestreview-364711443", "createdAt": "2020-02-26T08:50:54Z", "commit": {"oid": "294d011dec0763ef60c26e86cb8aca5a294066bc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQwODo1MDo1NVrOFuioTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQwODo1MTo1MlrOFuiqKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM0NjE4OQ==", "bodyText": "In general, I'm very wary of resize listeners, as they can have devastating effects on performance. Have you explored other options?\nIf a resize listener is the way to go, I'd say we need to throttle it. One option could be using window.requestAnimationFrame. That would sort of ensure we can keep 60fps. It's present on all  the supported browsers, and we could just not set this listener on <IE9, as it's not essential.\nWe can also set the listeners just on desktop screens. We can use window.matchMedia for that (https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList/addListener).", "url": "https://github.com/jenkinsci/jenkins/pull/4522#discussion_r384346189", "createdAt": "2020-02-26T08:50:55Z", "author": {"login": "fqueiruga"}, "path": "war/src/main/webapp/scripts/hudson-behavior.js", "diffHunk": "@@ -2408,25 +2407,24 @@ function createSearchBox(searchURL) {\n         }\n \n         copyFontStyle(box,sizer);\n-        copyFontStyle(box,minW);\n     });\n \n     // update positions and sizes of the components relevant to search\n     function updatePos() {\n-        function max(a,b) { if(a>b) return a; else return b; }\n-\n         sizer.innerHTML = box.value.escapeHTML();\n-        var w = max(sizer.offsetWidth,minW.offsetWidth);\n+        var w = sizer.offsetWidth;\n         box.style.width =\n-        comp.style.width = \n-        comp.firstChild.style.width = (w+60)+\"px\";\n+        comp.style.width =\n+        comp.firstChild.style.minWidth = (w+60)+\"px\";\n \n         var pos = YAHOO.util.Dom.getXY(box);\n         pos[1] += YAHOO.util.Dom.get(box).offsetHeight + 2;\n         YAHOO.util.Dom.setXY(comp, pos);\n     }\n \n     updatePos();\n+    // on small screens offsetWith is 0, update when screen gets bigger\n+    window.addEventListener(\"resize\", updatePos);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "294d011dec0763ef60c26e86cb8aca5a294066bc"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM0NjY2Ng==", "bodyText": "I'd suggest we only run the contents of the updatePos function only when the window width changes. We should avoid running this function on vertical resizes.", "url": "https://github.com/jenkinsci/jenkins/pull/4522#discussion_r384346666", "createdAt": "2020-02-26T08:51:52Z", "author": {"login": "fqueiruga"}, "path": "war/src/main/webapp/scripts/hudson-behavior.js", "diffHunk": "@@ -2408,25 +2407,24 @@ function createSearchBox(searchURL) {\n         }\n \n         copyFontStyle(box,sizer);\n-        copyFontStyle(box,minW);\n     });\n \n     // update positions and sizes of the components relevant to search\n     function updatePos() {\n-        function max(a,b) { if(a>b) return a; else return b; }\n-\n         sizer.innerHTML = box.value.escapeHTML();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "294d011dec0763ef60c26e86cb8aca5a294066bc"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8b54a7242eaa8c97c46e0e4e91bb07de278ccdc", "author": {"user": {"login": "zbynek", "name": "Zbynek Konecny"}}, "url": "https://github.com/jenkinsci/jenkins/commit/e8b54a7242eaa8c97c46e0e4e91bb07de278ccdc", "committedDate": "2020-02-28T00:14:39Z", "message": "Use min-width instead of listener, add max-width"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MjcwMDky", "url": "https://github.com/jenkinsci/jenkins/pull/4522#pullrequestreview-366270092", "createdAt": "2020-02-28T09:43:41Z", "commit": {"oid": "e8b54a7242eaa8c97c46e0e4e91bb07de278ccdc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5Mzk4NDQ5", "url": "https://github.com/jenkinsci/jenkins/pull/4522#pullrequestreview-369398449", "createdAt": "2020-03-05T09:11:03Z", "commit": {"oid": "e8b54a7242eaa8c97c46e0e4e91bb07de278ccdc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1622, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}