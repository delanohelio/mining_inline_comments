{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3MjEzODU1", "number": 4681, "title": "[JENKINS-62006] Move getChannelToMaster to a separate class", "bodyText": "This should avoid classloading issues I've seen, such as\nCaused by: java.lang.NoClassDefFoundError:\njavax/servlet/ServletException\n  at hudson.util.ProcessTree.get(ProcessTree.java:432)\n...\n\n\nSee JENKINS-62006.\n\nProposed changelog entries\n\nFix a classloading issue while executing ProcessTree.get()\n\n\nProposed upgrade guidelines\nN/A\nSubmitter checklist\n\n (If applicable) Jira issue is well described\n Changelog entries and upgrade guidelines are appropriate for the audience affected by the change (users or developer, depending on the change). Examples\n\nFill-in the Proposed changelog entries section only if there are breaking changes or other changes which may require extra steps from users during the upgrade\n\n\n Appropriate autotests or explanation to why this change has no tests\n For dependency updates: links to external changelogs and, if possible, full diffs\n\n\nDesired reviewers\n@jenkinsci/core-pr-reviewers\n\nMaintainer checklist\nBefore the changes are marked as ready-for-merge:\n\n There are at least 2 approvals for the pull request and no outstanding requests for change\n Conversations in the pull request are over OR it is explicit that a reviewer does not block the change\n Changelog entries in the PR title and/or Proposed changelog entries are correct\n Proper changelog labels are set so that the changelog can be generated automatically\n If the change needs additional upgrade steps from users, upgrade-guide-needed label is set and there is a Proposed upgrade guidelines section in the PR title. (example)\n If it would make sense to backport the change to LTS, a Jira issue must exist, be a Bug or Improvement, and be labeled as lts-candidate to be considered (see query).", "createdAt": "2020-04-22T10:59:59Z", "url": "https://github.com/jenkinsci/jenkins/pull/4681", "merged": true, "mergeCommit": {"oid": "8f978a960b3faf0a75a4bfa875dfb1a0d2a880ef"}, "closed": true, "closedAt": "2020-05-01T19:40:40Z", "author": {"login": "Vlatombe"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaGJqjAH2gAyNDA3MjEzODU1Ojg1OTc0ZjNlYzVmMjI1MjI4NjFmZTUwNGUzNmRjZDkzZTE4NWMyZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccunZzAFqTQwMzYxOTc4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "85974f3ec5f22522861fe504e36dcd93e185c2dd", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/jenkins/commit/85974f3ec5f22522861fe504e36dcd93e185c2dd", "committedDate": "2020-04-22T10:58:06Z", "message": "[JENKINS-62006] Move getChannelToMaster to a separate class\n\nThis should avoid classloading issues I've seen, such as\n\nCaused by: java.lang.NoClassDefFoundError:\njavax/servlet/ServletException\n  at hudson.util.ProcessTree.get(ProcessTree.java:432)\n..."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MDc3NDE5", "url": "https://github.com/jenkinsci/jenkins/pull/4681#pullrequestreview-398077419", "createdAt": "2020-04-22T11:01:47Z", "commit": {"oid": "85974f3ec5f22522861fe504e36dcd93e185c2dd"}, "state": "DISMISSED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMTowMTo0N1rOGJwclw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMTowMzozNFrOGJwgpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4NDExOQ==", "bodyText": "No new classes in hudson.* please.\nPlease also use agent instead of slave (both package and class name).", "url": "https://github.com/jenkinsci/jenkins/pull/4681#discussion_r412884119", "createdAt": "2020-04-22T11:01:47Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/slaves/SlaveComputerUtil.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package hudson.slaves;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85974f3ec5f22522861fe504e36dcd93e185c2dd"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4NDQzMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @since XXX\n          \n          \n            \n                 * @since TODO\n          \n      \n    \n    \n  \n\nper \n  \n    \n      jenkins/update-since-todo.sh\n    \n    \n         Line 13\n      in\n      3b85c0a\n    \n    \n    \n    \n\n        \n          \n           for todo in $( git grep --line-number '@since TODO' | grep -v \"$me\" )", "url": "https://github.com/jenkinsci/jenkins/pull/4681#discussion_r412884430", "createdAt": "2020-04-22T11:02:20Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/slaves/SlaveComputerUtil.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package hudson.slaves;\n+\n+import hudson.FilePath;\n+import hudson.remoting.Channel;\n+import hudson.remoting.VirtualChannel;\n+import jenkins.model.Jenkins;\n+\n+public final class SlaveComputerUtil {\n+    private SlaveComputerUtil() {}\n+    /**\n+     * Obtains a {@link VirtualChannel} that allows some computation to be performed on the master.\n+     * This method can be called from any thread on the master, or from agent (more precisely,\n+     * it only works from the remoting request-handling thread in agents, which means if you've started\n+     * separate thread on agents, that'll fail.)\n+     *\n+     * @return null if the calling thread doesn't have any trace of where its master is.\n+     * @since XXX", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85974f3ec5f22522861fe504e36dcd93e185c2dd"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4NTE1Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (Jenkins.getInstanceOrNull()!=null) // check if calling thread is on master or on slave\n          \n          \n            \n                        return FilePath.localChannel;\n          \n          \n            \n            \n          \n          \n            \n                    // if this method is called from within the agent computation thread, this should work\n          \n          \n            \n                    Channel c = Channel.current();\n          \n          \n            \n                    if (c!=null && Boolean.TRUE.equals(c.getProperty(\"slave\")))\n          \n          \n            \n                        return c;\n          \n          \n            \n                    if (Jenkins.getInstanceOrNull() != null) { // check if calling thread is on master or on slave\n          \n          \n            \n                        return FilePath.localChannel;\n          \n          \n            \n                    }\n          \n          \n            \n                    // if this method is called from within the agent computation thread, this should work\n          \n          \n            \n                    Channel c = Channel.current();\n          \n          \n            \n                    if (c != null && Boolean.TRUE.equals(c.getProperty(\"slave\"))) {\n          \n          \n            \n                        return c;\n          \n          \n            \n                    }\n          \n      \n    \n    \n  \n\nFix the code formatting if you touch it.", "url": "https://github.com/jenkinsci/jenkins/pull/4681#discussion_r412885156", "createdAt": "2020-04-22T11:03:34Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/slaves/SlaveComputerUtil.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package hudson.slaves;\n+\n+import hudson.FilePath;\n+import hudson.remoting.Channel;\n+import hudson.remoting.VirtualChannel;\n+import jenkins.model.Jenkins;\n+\n+public final class SlaveComputerUtil {\n+    private SlaveComputerUtil() {}\n+    /**\n+     * Obtains a {@link VirtualChannel} that allows some computation to be performed on the master.\n+     * This method can be called from any thread on the master, or from agent (more precisely,\n+     * it only works from the remoting request-handling thread in agents, which means if you've started\n+     * separate thread on agents, that'll fail.)\n+     *\n+     * @return null if the calling thread doesn't have any trace of where its master is.\n+     * @since XXX\n+     */\n+    public static VirtualChannel getChannelToMaster() {\n+        if (Jenkins.getInstanceOrNull()!=null) // check if calling thread is on master or on slave\n+            return FilePath.localChannel;\n+\n+        // if this method is called from within the agent computation thread, this should work\n+        Channel c = Channel.current();\n+        if (c!=null && Boolean.TRUE.equals(c.getProperty(\"slave\")))\n+            return c;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85974f3ec5f22522861fe504e36dcd93e185c2dd"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MDc5MzA3", "url": "https://github.com/jenkinsci/jenkins/pull/4681#pullrequestreview-398079307", "createdAt": "2020-04-22T11:04:27Z", "commit": {"oid": "85974f3ec5f22522861fe504e36dcd93e185c2dd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMTowNDoyN1rOGJwixA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMTowNDoyN1rOGJwixA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4NTcwMA==", "bodyText": "Also lacks license header.", "url": "https://github.com/jenkinsci/jenkins/pull/4681#discussion_r412885700", "createdAt": "2020-04-22T11:04:27Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/slaves/SlaveComputerUtil.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package hudson.slaves;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85974f3ec5f22522861fe504e36dcd93e185c2dd"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MDk0Njk0", "url": "https://github.com/jenkinsci/jenkins/pull/4681#pullrequestreview-398094694", "createdAt": "2020-04-22T11:27:28Z", "commit": {"oid": "85974f3ec5f22522861fe504e36dcd93e185c2dd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMToyNzoyOFrOGJxWyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMToyNzoyOFrOGJxWyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg5OTAxOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static VirtualChannel getChannelToMaster() {\n          \n          \n            \n                @CheckForNull\n          \n          \n            \n                public static VirtualChannel getChannelToMaster() {", "url": "https://github.com/jenkinsci/jenkins/pull/4681#discussion_r412899018", "createdAt": "2020-04-22T11:27:28Z", "author": {"login": "res0nance"}, "path": "core/src/main/java/hudson/slaves/SlaveComputerUtil.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package hudson.slaves;\n+\n+import hudson.FilePath;\n+import hudson.remoting.Channel;\n+import hudson.remoting.VirtualChannel;\n+import jenkins.model.Jenkins;\n+\n+public final class SlaveComputerUtil {\n+    private SlaveComputerUtil() {}\n+    /**\n+     * Obtains a {@link VirtualChannel} that allows some computation to be performed on the master.\n+     * This method can be called from any thread on the master, or from agent (more precisely,\n+     * it only works from the remoting request-handling thread in agents, which means if you've started\n+     * separate thread on agents, that'll fail.)\n+     *\n+     * @return null if the calling thread doesn't have any trace of where its master is.\n+     * @since XXX\n+     */\n+    public static VirtualChannel getChannelToMaster() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85974f3ec5f22522861fe504e36dcd93e185c2dd"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25c8cb6be5f2c14082c0b5619c4136b3d0023816", "author": {"user": {"login": "Vlatombe", "name": "Vincent Latombe"}}, "url": "https://github.com/jenkinsci/jenkins/commit/25c8cb6be5f2c14082c0b5619c4136b3d0023816", "committedDate": "2020-04-22T11:51:20Z", "message": "Fix reviews"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MTU4NzEz", "url": "https://github.com/jenkinsci/jenkins/pull/4681#pullrequestreview-398158713", "createdAt": "2020-04-22T12:53:48Z", "commit": {"oid": "25c8cb6be5f2c14082c0b5619c4136b3d0023816"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMzUyOTE2", "url": "https://github.com/jenkinsci/jenkins/pull/4681#pullrequestreview-403352916", "createdAt": "2020-04-30T09:29:11Z", "commit": {"oid": "25c8cb6be5f2c14082c0b5619c4136b3d0023816"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMzUyOTIw", "url": "https://github.com/jenkinsci/jenkins/pull/4681#pullrequestreview-403352920", "createdAt": "2020-04-30T09:29:12Z", "commit": {"oid": "25c8cb6be5f2c14082c0b5619c4136b3d0023816"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNDE4MDg4", "url": "https://github.com/jenkinsci/jenkins/pull/4681#pullrequestreview-403418088", "createdAt": "2020-04-30T11:05:27Z", "commit": {"oid": "25c8cb6be5f2c14082c0b5619c4136b3d0023816"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzNjE5Nzg0", "url": "https://github.com/jenkinsci/jenkins/pull/4681#pullrequestreview-403619784", "createdAt": "2020-04-30T15:14:38Z", "commit": {"oid": "25c8cb6be5f2c14082c0b5619c4136b3d0023816"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1102, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}