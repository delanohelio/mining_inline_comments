{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2MjE0Mzc5", "number": 4675, "title": "Fix available tab sort order and support popularity outside 0..1 range", "bodyText": "There are two problems with sorting plugins on the Available tab by sort order (#4588):\n\nIt's the wrong direction \ud83e\udd26 (I forgot about #1737 etc. and somehow slipped through in my testing)\nIt doesn't support values outside the 0...1 range.\n\nThe latter wasn't a big problem when popularity was normalized to be within that range. And I did that deliberately due to a weird behavior with sortable tables in Jenkins: It alternates between interpreting values as a string and as a number. Try this with the \"versions\" column: Sometimes 8.x or 9.x is the top value, sometimes double digit major versions. The cycle seems to be something like numeric asc / numeric desc / string asc / string desc.\nWhen all values are in the 0...1 range, never use scientific notation, and have a fixed number of digits, all is well.\nUnfortunately it turned out that there's something off between Jenkins and the update center generator that results in signature check failures when there are numbers with fractions in the JSON file.\nThe way the JSON signature works is that update-center2 first writes the entire rest of the content in a \"canonical\" format, then computes its checksum, and then inserts the signatures block with computed checksums and signatures. Jenkins downloads the file, deserializes it, removes the signatures block, and then it serializes what's left in a \"canonical\" format. If the specified checksum computed by update-center2 matches the one Jenkins determines, it proceeds with the signature check.\nThis means that update-center2 and Jenkins (core) are coupled tightly to this \"canonical\" format -- earlier today, the number of fractional digits between update-center2 and (some) Jenkins instances differed; which made signature checks in Jenkins fail. This is being addressed in jenkins-infra/update-center2#369\nAs a workaround, update-center2 could just publish the popularity as an integer, which can be consumed by Jenkins and doesn't cause problems (both components strip trailing 0 fractional digits, as well as a . separator if it's the last char).\nUnfortunately, in this case, the problem of sort order comes back. 999 installs (or 9999, or 99999) is not the largest value!\nSo this PR formats the number to have a large fixed number of digits, and left pads with spaces. That way, 9 is no longer larger than 10 half the time.\nTesting note\nWhile 2.233 is the latest release, I'm reverting the addition of popularity to the metadata. A recent update-center.json file with the popularity data is https://gist.github.com/daniel-beck/5f8f70725c6f22fd47686359535eed52 and can be used for testing.\nProposed changelog entries\n\nFix sort order in Available tab of the plugin manager\n\n\nProposed upgrade guidelines\nN/A\nSubmitter checklist\n\n (If applicable) Jira issue is well described\n Changelog entries and upgrade guidelines are appropriate for the audience affected by the change (users or developer, depending on the change). Examples\n\nFill-in the Proposed changelog entries section only if there are breaking changes or other changes which may require extra steps from users during the upgrade\n\n\n Appropriate autotests or explanation to why this change has no tests\n For dependency updates: links to external changelogs and, if possible, full diffs\n\n\nDesired reviewers\n@mention\n\nMaintainer checklist\nBefore the changes are marked as ready-for-merge:\n\n There are at least 2 approvals for the pull request and no outstanding requests for change\n Conversations in the pull request are over OR it is explicit that a reviewer does not block the change\n Changelog entries in the PR title and/or Proposed changelog entries are correct\n Proper changelog labels are set so that the changelog can be generated automatically\n If the change needs additional upgrade steps from users, upgrade-guide-needed label is set and there is a Proposed upgrade guidelines section in the PR title. (example)\n If it would make sense to backport the change to LTS, a Jira issue must exist, be a Bug or Improvement, and be labeled as lts-candidate to be considered (see query).", "createdAt": "2020-04-20T18:01:34Z", "url": "https://github.com/jenkinsci/jenkins/pull/4675", "merged": true, "mergeCommit": {"oid": "aa3ad0664abd38652ce6134184915c11fca8633e"}, "closed": true, "closedAt": "2020-04-25T13:25:21Z", "author": {"login": "daniel-beck"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZuTfvgFqTM5NzA0NjA2Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcauB7RgFqTM5OTc4NDU0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MDQ2MDY3", "url": "https://github.com/jenkinsci/jenkins/pull/4675#pullrequestreview-397046067", "createdAt": "2020-04-21T07:11:07Z", "commit": {"oid": "22b588cf7fca9da774deee136028fcfe0f87f246"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a54823769a8ee966099f586d3ef419075d235d77", "author": {"user": {"login": "daniel-beck", "name": "Daniel Beck"}}, "url": "https://github.com/jenkinsci/jenkins/commit/a54823769a8ee966099f586d3ef419075d235d77", "committedDate": "2020-04-21T21:46:45Z", "message": "Fix Available tab sort order and support popularity outside 0..1 range"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22b588cf7fca9da774deee136028fcfe0f87f246", "author": {"user": {"login": "daniel-beck", "name": "Daniel Beck"}}, "url": "https://github.com/jenkinsci/jenkins/commit/22b588cf7fca9da774deee136028fcfe0f87f246", "committedDate": "2020-04-20T17:43:47Z", "message": "Fix available tag sort order and support popularity outside 0..1 range"}, "afterCommit": {"oid": "a54823769a8ee966099f586d3ef419075d235d77", "author": {"user": {"login": "daniel-beck", "name": "Daniel Beck"}}, "url": "https://github.com/jenkinsci/jenkins/commit/a54823769a8ee966099f586d3ef419075d235d77", "committedDate": "2020-04-21T21:46:45Z", "message": "Fix Available tab sort order and support popularity outside 0..1 range"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NTA0MjIw", "url": "https://github.com/jenkinsci/jenkins/pull/4675#pullrequestreview-398504220", "createdAt": "2020-04-22T19:22:41Z", "commit": {"oid": "a54823769a8ee966099f586d3ef419075d235d77"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NTMwNDMy", "url": "https://github.com/jenkinsci/jenkins/pull/4675#pullrequestreview-398530432", "createdAt": "2020-04-22T19:51:08Z", "commit": {"oid": "a54823769a8ee966099f586d3ef419075d235d77"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxOTo1MTowOFrOGKIcZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxOTo1MTowOFrOGKIcZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI3NzI4Nw==", "bodyText": "Supports numbers up to <10 billion: 1234567890.1234 so every human can install the plugin on their personal instance and this will still be fine \ud83d\ude04", "url": "https://github.com/jenkinsci/jenkins/pull/4675#discussion_r413277287", "createdAt": "2020-04-22T19:51:08Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/PluginManager.java", "diffHunk": "@@ -2240,7 +2241,7 @@ private PluginUpdateInfo(String pluginName, String message) {\n \n     @Restricted(DoNotUse.class)\n     public String unscientific(double d) {\n-        return String.format(\"%.4f\", d);\n+        return String.format(Locale.US, \"%15.4f\", d);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a54823769a8ee966099f586d3ef419075d235d77"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5Nzg0NTQx", "url": "https://github.com/jenkinsci/jenkins/pull/4675#pullrequestreview-399784541", "createdAt": "2020-04-24T09:25:51Z", "commit": {"oid": "a54823769a8ee966099f586d3ef419075d235d77"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1088, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}