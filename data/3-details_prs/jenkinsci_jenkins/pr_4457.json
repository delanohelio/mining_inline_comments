{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MjE4MDE5", "number": 4457, "title": "[JENKINS-60866] Un-inline restarts pages", "bodyText": "Un-inline the JavaScript and CSS from the jelly views of the restarts mechanism. Actually the revamp done with login/signup/restart was not applied to the WindowsInstaller one.\n\ncleanup / standardize the jelly namespaces\nremoved the applySafeRedirector function as it was only used by the view that is now also revamped\nI looked for the potential usage of loading.js in the ecosystem, nothing. So changing its behavior is not that terrible\nI tested the restart with a contextPath and without. Side note, when you install the windows service when coming from a contextPath, the service will not have one, as before.\n\u26a0\ufe0f the data-rooturl is actually the context path and not the real root URL that you could expect (compared to the one configured in Jenkins, being absolute)\n\n\nScreenshots of WindowsInstaller restart screen\nBefore\n\nAfter (similar to login/signup/restarts)\n\n\nTesting notes:\n\ndocker run --rm -it -p 8080:8080 -e ID=4457 jenkins/core-pr-tester\nTo see the WindowsInstaller, you need to run the war with java -jar <jenkins.war> and go to /manage and do the service installation. You will see this restart screen only once as you cannot re-install the service. You can uninstall it to re-do the process. More instructions here.\n\n\nSee JENKINS-60866.\n\nProposed changelog entries\n\n(internal) Remove inline resources from restart views\n\n\nProposed upgrade guidelines\nN/A\nSubmitter checklist\n\n JIRA issue is well described\n Changelog entries and upgrade guidelines are appropriate for the audience affected by the change (users or developer, depending on the change). Examples\n\nFill-in the Proposed changelog entries section only if there are breaking changes or other changes which may require extra steps from users during the upgrade\n\n\n[n/a] Appropriate autotests or explanation to why this change has no tests\n[n/a] For dependency updates: links to external changelogs and, if possible, full diffs\n\n\nDesired reviewers\n@scherler as the author of the re-vamp of other page if you want to ensure consistency\n\nMaintainer checklist\nBefore the changes are marked as ready-for-merge:\n\n There are at least 2 approvals for the pull request and no outstanding requests for change\n Conversations in the pull request are over OR it is explicit that a reviewer does not block the change\n Changelog entries in the PR title and/or Proposed changelog entries are correct\n Proper changelog labels are set so that the changelog can be generated automatically\n If the change needs additional upgrade steps from users, upgrade-guide-needed label is set and there is a Proposed upgrade guidelines section in the PR title. (example)\n If it would make sense to backport the change to LTS, a JIRA issue should exist and be labeled as lts-candidate", "createdAt": "2020-01-26T13:32:37Z", "url": "https://github.com/jenkinsci/jenkins/pull/4457", "merged": true, "mergeCommit": {"oid": "d1fbb29781450d04a8151e0ec65e41717f55c783"}, "closed": true, "closedAt": "2020-03-13T12:00:24Z", "author": {"login": "Wadeck"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-IEZygH2gAyMzY3MjE4MDE5OjJmNDgwM2NhZjYxNDQyN2E1ZDcxMzU3NTNjMDY4ZjZjOTJhZDg4MTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGqT0IgFqTM2MzAwMDEwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818", "author": {"user": {"login": "Wadeck", "name": "Wadeck Follonier"}}, "url": "https://github.com/jenkinsci/jenkins/commit/2f4803caf614427a5d7135753c068f6c92ad8818", "committedDate": "2020-01-26T13:22:17Z", "message": "[JENKINS-60866] Un-inline restarts pages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4OTA1MTg0", "url": "https://github.com/jenkinsci/jenkins/pull/4457#pullrequestreview-348905184", "createdAt": "2020-01-27T19:09:05Z", "commit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxOTowOTowNVrOFiOGPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxOToxMDoxMlrOFiOIKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQyNjg3Nw==", "bodyText": "The content-type, initialization of hudson.Functions, and this line, can all be replaced by using <l:view> around this view.", "url": "https://github.com/jenkinsci/jenkins/pull/4457#discussion_r371426877", "createdAt": "2020-01-27T19:09:05Z", "author": {"login": "jvz"}, "path": "core/src/main/resources/hudson/lifecycle/WindowsInstallerLink/_restart.jelly", "diffHunk": "@@ -21,21 +21,44 @@ LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n -->\n-\n <?jelly escape-by-default='true'?>\n-<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\" xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\">\n-  <st:statusCode value=\"503\" /><!-- SERVICE NOT AVAILABLE -->\n-  <l:layout permission=\"${app.ADMINISTER}\">\n-    <st:include it=\"${app}\" page=\"sidepanel.jelly\" />\n-    <l:main-panel>\n-      <h1 style=\"margin-top:4em\">\n-        ${%Please wait while Jenkins is restarting}<span id=\"progress\">...</span>\n-      </h1>\n-      <p style=\"color:gray;\">\n-        ${%blurb}\n-      </p>\n-      \n-      <script>applySafeRedirector('${rootURL}/')</script>\n-    </l:main-panel>\n-  </l:layout>\n-</j:jelly>\n\\ No newline at end of file\n+<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:x=\"jelly:xml\">\n+    <j:new var=\"h\" className=\"hudson.Functions\" />\n+    <st:statusCode value=\"503\" /><!-- SERVICE NOT AVAILABLE -->\n+    <st:header name=\"Expires\" value=\"0\" />\n+    <st:header name=\"Cache-Control\" value=\"no-cache,no-store,must-revalidate\" />\n+    <!-- response contentType header -->\n+    <st:contentType value=\"text/html;charset=UTF-8\" />\n+    <!-- get default/common page variable -->\n+    ${h.initPageVariables(context)}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQyNzI1Ng==", "bodyText": "Same for this page; it should use <l:view> (not sure how this one got missed back when that tag was introduced).", "url": "https://github.com/jenkinsci/jenkins/pull/4457#discussion_r371427256", "createdAt": "2020-01-27T19:09:58Z", "author": {"login": "jvz"}, "path": "core/src/main/resources/hudson/util/HudsonIsLoading/index.jelly", "diffHunk": "@@ -21,26 +21,24 @@ LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n -->\n-\n <?jelly escape-by-default='true'?>\n-\n-<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:x=\"jelly:xml\" xmlns:f=\"/lib/form\">\n+<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:x=\"jelly:xml\">\n     <j:new var=\"h\" className=\"hudson.Functions\" />\n-    <st:statusCode value=\"503\"/><!-- SERVICE NOT AVAILABLE -->\n-    <st:setHeader name=\"Expires\" value=\"0\"/>\n-    <st:setHeader name=\"Cache-Control\" value=\"no-cache,no-store,must-revalidate\"/>\n+    <st:statusCode value=\"503\" /><!-- SERVICE NOT AVAILABLE -->\n+    <st:header name=\"Expires\" value=\"0\" />\n+    <st:header name=\"Cache-Control\" value=\"no-cache,no-store,must-revalidate\" />\n     <!-- response contentType header -->\n-    <st:contentType value=\"text/html;charset=UTF-8\"/>\n+    <st:contentType value=\"text/html;charset=UTF-8\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQyNzM3MA==", "bodyText": "And here.", "url": "https://github.com/jenkinsci/jenkins/pull/4457#discussion_r371427370", "createdAt": "2020-01-27T19:10:12Z", "author": {"login": "jvz"}, "path": "core/src/main/resources/hudson/util/HudsonIsRestarting/index.jelly", "diffHunk": "@@ -21,26 +21,24 @@ LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n -->\n-\n <?jelly escape-by-default='true'?>\n-\n-<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:x=\"jelly:xml\" xmlns:f=\"/lib/form\">\n+<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:x=\"jelly:xml\">\n     <j:new var=\"h\" className=\"hudson.Functions\" />\n-    <st:statusCode value=\"503\"/><!-- SERVICE NOT AVAILABLE -->\n-    <st:setHeader name=\"Expires\" value=\"0\"/>\n-    <st:setHeader name=\"Cache-Control\" value=\"no-cache,no-store,must-revalidate\"/>\n+    <st:statusCode value=\"503\" /><!-- SERVICE NOT AVAILABLE -->\n+    <st:header name=\"Expires\" value=\"0\" />\n+    <st:header name=\"Cache-Control\" value=\"no-cache,no-store,must-revalidate\" />\n     <!-- response contentType header -->\n-    <st:contentType value=\"text/html;charset=UTF-8\"/>\n+    <st:contentType value=\"text/html;charset=UTF-8\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNjk2MDM4", "url": "https://github.com/jenkinsci/jenkins/pull/4457#pullrequestreview-350696038", "createdAt": "2020-01-30T09:52:09Z", "commit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwOTo1MjoxMFrOFjlA8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwOTo1MjoxMFrOFjlA8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg1MDkzMA==", "bodyText": "@Wadeck last time I looked at self-closing script tag, it wasn't supported by all web browsers. I know, makes no sense (html != xml), but just to be sure, did you test it?\nFirst comment about that I can find is from 2013... but basically it would be because script can have a src and code in its body. So the closing tag seems to be mandatory.\nThis might also apply to div you have on line 50 as well.", "url": "https://github.com/jenkinsci/jenkins/pull/4457#discussion_r372850930", "createdAt": "2020-01-30T09:52:10Z", "author": {"login": "alecharp"}, "path": "core/src/main/resources/hudson/util/HudsonIsRestarting/index.jelly", "diffHunk": "@@ -60,8 +58,7 @@ THE SOFTWARE.\n                     </div>\n                 </div>\n             </div>\n-            <script src=\"${resURL}/scripts/loading.js\" type=\"text/javascript\"></script>\n-            <script>safeRedirector(window.location.href);</script>\n+            <script src=\"${resURL}/scripts/loading.js\" type=\"text/javascript\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MzI0MTU1", "url": "https://github.com/jenkinsci/jenkins/pull/4457#pullrequestreview-354324155", "createdAt": "2020-02-06T09:58:21Z", "commit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwOTo1ODoyMVrOFmVRRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwOTo1ODoyMVrOFmVRRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTczODY5NA==", "bodyText": "Checking permissions is not necessary any more?", "url": "https://github.com/jenkinsci/jenkins/pull/4457#discussion_r375738694", "createdAt": "2020-02-06T09:58:21Z", "author": {"login": "varyvol"}, "path": "core/src/main/resources/hudson/lifecycle/WindowsInstallerLink/_restart.jelly", "diffHunk": "@@ -21,21 +21,44 @@ LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n -->\n-\n <?jelly escape-by-default='true'?>\n-<j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\" xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\">\n-  <st:statusCode value=\"503\" /><!-- SERVICE NOT AVAILABLE -->\n-  <l:layout permission=\"${app.ADMINISTER}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzcxMjIz", "url": "https://github.com/jenkinsci/jenkins/pull/4457#pullrequestreview-355771223", "createdAt": "2020-02-10T09:00:09Z", "commit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4MDkxNjU2", "url": "https://github.com/jenkinsci/jenkins/pull/4457#pullrequestreview-358091656", "createdAt": "2020-02-13T10:06:43Z", "commit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4MDk1NjQ5", "url": "https://github.com/jenkinsci/jenkins/pull/4457#pullrequestreview-358095649", "createdAt": "2020-02-13T10:12:41Z", "commit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5Mzc4NDUw", "url": "https://github.com/jenkinsci/jenkins/pull/4457#pullrequestreview-359378450", "createdAt": "2020-02-16T03:45:46Z", "commit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMTAyNTYy", "url": "https://github.com/jenkinsci/jenkins/pull/4457#pullrequestreview-362102562", "createdAt": "2020-02-20T17:41:58Z", "commit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNTE2ODE0", "url": "https://github.com/jenkinsci/jenkins/pull/4457#pullrequestreview-362516814", "createdAt": "2020-02-21T09:59:34Z", "commit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMDAwMTA1", "url": "https://github.com/jenkinsci/jenkins/pull/4457#pullrequestreview-363000105", "createdAt": "2020-02-22T01:47:17Z", "commit": {"oid": "2f4803caf614427a5d7135753c068f6c92ad8818"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1464, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}