{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExMzYwMzQ2", "number": 4700, "title": "[JENKINS-61973] Restyle sidebar tasks", "bodyText": "See JENKINS-61973.\nRevamp of sidebar task list\n\nRefactored and simplified the <l:task> tag. Tasks now only have 1 hyperlink that contains both labels and icon.\nAccessibility of the task list was improved: keyboard navigation is easier now and interactive states have better visual cues.\n\n\nScreenshots\nHomepage tasks\n\nExample of disabled state\n\nActive page, focus and hover states\n\nHover states and on a nested page\n\nFull page:\n\nFull page 2:\n\n\nProposed changelog entries\n\nRevamped the sidebar task list, with improved aesthetics and accessibility.\n\nProposed upgrade guidelines\nN/A\nSubmitter checklist\n\n (If applicable) Jira issue is well described\n Changelog entries and upgrade guidelines are appropriate for the audience affected by the change (users or developer, depending on the change). Examples\n\nFill-in the Proposed changelog entries section only if there are breaking changes or other changes which may require extra steps from users during the upgrade\n\n\n Appropriate autotests or explanation to why this change has no tests\n For dependency updates: links to external changelogs and, if possible, full diffs\n\n\nDesired reviewers\n@timja\n@uhafner\n@daniel-beck\n@Wadeck\n@oleg-nenashev\n\nMaintainer checklist\nBefore the changes are marked as ready-for-merge:\n\n There are at least 2 approvals for the pull request and no outstanding requests for change\n Conversations in the pull request are over OR it is explicit that a reviewer does not block the change\n Changelog entries in the PR title and/or Proposed changelog entries are correct\n Proper changelog labels are set so that the changelog can be generated automatically\n If the change needs additional upgrade steps from users, upgrade-guide-needed label is set and there is a Proposed upgrade guidelines section in the PR title. (example)\n If it would make sense to backport the change to LTS, a Jira issue must exist, be a Bug or Improvement, and be labeled as lts-candidate to be considered (see query).", "createdAt": "2020-04-30T11:16:39Z", "url": "https://github.com/jenkinsci/jenkins/pull/4700", "merged": true, "mergeCommit": {"oid": "6e11d6124bcb7e9e02074da5c55cf74e4ac8bf07"}, "closed": true, "closedAt": "2020-05-23T12:13:59Z", "author": {"login": "fqueiruga"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccprn1gH2gAyNDExMzYwMzQ2OjEwMTI2ODkwMTc2N2RlODNmNmM0MWMzMzVjMmU2OTg5MjI0NzIxNjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABchKbDbgFqTQxMTY0NjIwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "101268901767de83f6c41c335c2e698922472169", "author": {"user": {"login": "fqueiruga", "name": "F\u00e9lix Queiruga"}}, "url": "https://github.com/jenkinsci/jenkins/commit/101268901767de83f6c41c335c2e698922472169", "committedDate": "2020-04-30T09:29:43Z", "message": "Refactor sidebar tasks and change sidebar links"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88600a1a2df55b709a95b7d07ba0c0677869ffc5", "author": {"user": {"login": "fqueiruga", "name": "F\u00e9lix Queiruga"}}, "url": "https://github.com/jenkinsci/jenkins/commit/88600a1a2df55b709a95b7d07ba0c0677869ffc5", "committedDate": "2020-04-30T11:03:15Z", "message": "Revamp sidebar tasks\n\n- Refactored and simplified the <l:task> tag. No tasks have only 1 hyperlink that contains both labels and icon\n    - Link icons now have null alt text because they will always have a label with them\n- Interactive states and current page indicator now have a better and more noticeable style"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MDM3MjAz", "url": "https://github.com/jenkinsci/jenkins/pull/4700#pullrequestreview-404037203", "createdAt": "2020-05-01T06:22:16Z", "commit": {"oid": "88600a1a2df55b709a95b7d07ba0c0677869ffc5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwNjoyMjoxNlrOGPDG7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwNjoyMjoxNlrOGPDG7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQzMjc1MA==", "bodyText": "what's this newDomain check for?", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r418432750", "createdAt": "2020-05-01T06:22:16Z", "author": {"login": "timja"}, "path": "core/src/main/resources/lib/layout/task.jelly", "diffHunk": "@@ -79,19 +79,20 @@ THE SOFTWARE.\n     The semantics is that when one of the nested <task> matches, the parent is also considered as a match\n     and thus gets a highlight.\n   -->\n-  <j:set var=\"match\" value=\"${h.hyperlinkMatchesCurrentPage(href)}\" />\n+  <j:set var=\"isCurrent\" value=\"${h.hyperlinkMatchesCurrentPage(href)}\" />\n   <j:scope>\n-    <j:set var=\"taskMatching\" value=\"${context.parent}\"/>\n+    <j:set var=\"parentTagContext\" value=\"${context.parent}\"/>\n     <d:invokeBody />\n   </j:scope>\n \n-  <j:if test=\"${attrs.permission==null or h.hasPermission(it,attrs.permission)}\">\n+  <j:if test=\"${href != 'newDomain' and attrs.permission==null or h.hasPermission(it,attrs.permission)}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88600a1a2df55b709a95b7d07ba0c0677869ffc5"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5", "author": {"user": {"login": "fqueiruga", "name": "F\u00e9lix Queiruga"}}, "url": "https://github.com/jenkinsci/jenkins/commit/604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5", "committedDate": "2020-05-01T08:42:46Z", "message": "Remove debug code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MDczNTMy", "url": "https://github.com/jenkinsci/jenkins/pull/4700#pullrequestreview-404073532", "createdAt": "2020-05-01T08:48:02Z", "commit": {"oid": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MTA2NDU0", "url": "https://github.com/jenkinsci/jenkins/pull/4700#pullrequestreview-404106454", "createdAt": "2020-05-01T10:36:55Z", "commit": {"oid": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMDozNjo1NVrOGPG4kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMDozNzo1NFrOGPG5YQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5NDYxMA==", "bodyText": "It is unclear what this comment means, could you rephrase? How is Git involved in removing something?", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r418494610", "createdAt": "2020-05-01T10:36:55Z", "author": {"login": "daniel-beck"}, "path": "war/src/main/less/modules/sidebar-tasks.less", "diffHunk": "@@ -0,0 +1,128 @@\n+@import '../abstracts/colors.less';\n+@import '../abstracts/font.less';\n+\n+#tasks {\n+  margin-bottom: 20px;\n+  display: inline-block;\n+\n+  // TODO: investigate this on the git history to see if removing it will\n+  // cause a problem", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5NDY4MQ==", "bodyText": "It's called sidepanel in the rest of Jenkins, should be renamed for consistency.", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r418494681", "createdAt": "2020-05-01T10:37:22Z", "author": {"login": "daniel-beck"}, "path": "war/src/main/less/base-styles-v2.less", "diffHunk": "@@ -26,4 +26,5 @@ html {\n @import './modules/buttons.less';\n @import './modules/page-header.less';\n @import './modules/page-footer.less';\n+@import './modules/sidebar-tasks.less';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5NDgxNw==", "bodyText": "Can this be un-inlined so Wadeck doesn't have to followup here? (Assuming it's straightforward enough to do.)", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r418494817", "createdAt": "2020-05-01T10:37:54Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/lib/layout/task.jelly", "diffHunk": "@@ -119,106 +120,60 @@ THE SOFTWARE.\n       <j:set var=\"icon\" value=\"${rootURL}${icon.startsWith('/images/') || icon.startsWith('/plugin/') ? h.resourcePath : ''}${icon}\"/>\n       <j:when test=\"${enabled==false}\">\n         <div class=\"task disabled\">\n-          <span>\n+          <span class=\"task-link-wrapper\">\n+            <span class=\"task-disabled-link\">\n+              <span class=\"task-icon-link\">\n+                <l:icon alt=\"\" class=\"${iconMetadata != null ? iconMetadata.classSpec : ''}\" src=\"${iconMetadata ?: icon}\" />\n+              </span>\n+              <span class=\"task-link-text\">${title}</span>\n+            </span>\n+          </span>\n+        </div>\n+      </j:when>\n+\n+      <j:otherwise>\n+        <div class=\"task \">\n+          <span class=\"task-link-wrapper ${watch ? 'task--active' : ''}\">\n             <j:choose>\n               <j:when test=\"${iconMetadata != null}\">\n-                <l:icon class=\"${iconMetadata.classSpec}\" style=\"width: 24px; height: 24px; margin: 2px;\" />\n+                ${taskTags!=null and attrs.contextMenu!='false' ? taskTags.add(href, iconMetadata.getQualifiedUrl(context), title, post == 'true', requiresConfirmation == 'true') : null}\n               </j:when>\n               <j:otherwise>\n-                <l:icon alt=\"\" src=\"${icon}\" style=\"width: 24px; height: 24px; margin: 2px;\" />\n+                ${taskTags!=null and attrs.contextMenu!='false' ? taskTags.add(href, icon, title, post == 'true', requiresConfirmation == 'true') : null}\n               </j:otherwise>\n             </j:choose>\n-          </span>\n-          <st:nbsp />\n \n-          <span>\n+            <j:set var=\"id\" value=\"${h.generateId()}\"/>\n+            <j:if test=\"${attrs.onclick == null and post and not requiresConfirmation}\">\n+                <script>\n+                    function postRequest_${id}(a) {\n+                        new Ajax.Request(a.href);\n+                        hoverNotification('${%Done.}', a.parentNode);\n+                        return false;\n+                    }\n+                </script>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0ODA1ODIy", "url": "https://github.com/jenkinsci/jenkins/pull/4700#pullrequestreview-404805822", "createdAt": "2020-05-04T08:48:43Z", "commit": {"oid": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODo0ODo0M1rOGP3l7g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODo0OTozMVrOGP3n-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5MjY1NA==", "bodyText": "Shouldn't this be in the colors file?", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r419292654", "createdAt": "2020-05-04T08:48:43Z", "author": {"login": "varyvol"}, "path": "war/src/main/less/modules/sidebar-tasks.less", "diffHunk": "@@ -0,0 +1,128 @@\n+@import '../abstracts/colors.less';\n+@import '../abstracts/font.less';\n+\n+#tasks {\n+  margin-bottom: 20px;\n+  display: inline-block;\n+\n+  // TODO: investigate this on the git history to see if removing it will\n+  // cause a problem\n+  max-width: 325px;\n+\n+  // The task list is touching the side of the screen. This should be removed\n+  // once .side-panel loses it's padding.\n+  width: calc(100% + 15px);\n+  margin-left: -15px;\n+}\n+\n+#tasks .task {\n+  display: flex;\n+  align-items: center;\n+  flex-wrap: wrap;\n+  overflow: hidden;\n+  white-space: nowrap;\n+  text-overflow: ellipsis;\n+  position: relative;\n+  font-size: @font-size-sm;\n+  font-weight: 500;\n+}\n+.task.disabled {\n+  opacity: 0.5;\n+  background-color: transparent;\n+}\n+\n+.task-link-wrapper {\n+  display: flex;\n+  align-items: center;\n+  width: 100%;\n+  padding: 2px 0;\n+}\n+\n+.task-link,\n+.task-disabled-link {\n+  display: inline-flex;\n+  flex: 1;\n+  align-items: center;\n+  padding: 0.5rem 0 0.5rem 1.25rem;\n+  max-width: 100%;\n+}\n+.task-link:link,\n+.task-link:visited {\n+  color: @text-color;\n+  text-decoration: none;\n+\n+  &:hover,\n+  &:focus {\n+    background-color: #F8F8F8;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI5MzE3Ng==", "bodyText": "Ditto.", "url": "https://github.com/jenkinsci/jenkins/pull/4700#discussion_r419293176", "createdAt": "2020-05-04T08:49:31Z", "author": {"login": "varyvol"}, "path": "war/src/main/less/modules/sidebar-tasks.less", "diffHunk": "@@ -0,0 +1,128 @@\n+@import '../abstracts/colors.less';\n+@import '../abstracts/font.less';\n+\n+#tasks {\n+  margin-bottom: 20px;\n+  display: inline-block;\n+\n+  // TODO: investigate this on the git history to see if removing it will\n+  // cause a problem\n+  max-width: 325px;\n+\n+  // The task list is touching the side of the screen. This should be removed\n+  // once .side-panel loses it's padding.\n+  width: calc(100% + 15px);\n+  margin-left: -15px;\n+}\n+\n+#tasks .task {\n+  display: flex;\n+  align-items: center;\n+  flex-wrap: wrap;\n+  overflow: hidden;\n+  white-space: nowrap;\n+  text-overflow: ellipsis;\n+  position: relative;\n+  font-size: @font-size-sm;\n+  font-weight: 500;\n+}\n+.task.disabled {\n+  opacity: 0.5;\n+  background-color: transparent;\n+}\n+\n+.task-link-wrapper {\n+  display: flex;\n+  align-items: center;\n+  width: 100%;\n+  padding: 2px 0;\n+}\n+\n+.task-link,\n+.task-disabled-link {\n+  display: inline-flex;\n+  flex: 1;\n+  align-items: center;\n+  padding: 0.5rem 0 0.5rem 1.25rem;\n+  max-width: 100%;\n+}\n+.task-link:link,\n+.task-link:visited {\n+  color: @text-color;\n+  text-decoration: none;\n+\n+  &:hover,\n+  &:focus {\n+    background-color: #F8F8F8;\n+  }\n+\n+  &:active {\n+    background-color: #EAEFF2;\n+  }\n+\n+  &:focus {\n+    outline: 0;\n+    // Use a box-shadow instead of an outline or a border because the alternatives\n+    // are hidden behind the parent container\n+    box-shadow: inset 0 0 0 3px @focus;\n+  }\n+}\n+.task-link--active {\n+  background-color: #EAEFF2;\n+  position: relative;\n+\n+  &:before {\n+    position: absolute;\n+    left: 0;\n+    height: 100%;\n+    content: '';\n+    border-left: 4px solid @primary;\n+  }\n+}\n+.task-link--active:link,\n+.task-link--active:visited {\n+  &:hover,\n+  &:focus {\n+    background-color: #EAEFF2;\n+  }\n+}\n+\n+// Target only icons withink task link in order to keep backwards compatibility\n+.task .task-icon-link {\n+  display: inline-block;\n+  margin: 0;\n+  margin-right: 0.5rem;\n+}\n+// Reset the margin for the icon links\n+.task .task-icon-link img,\n+.task img.task-icon-link {\n+  margin: 0;\n+  // Dimensions have !important to override inline styles set by <l:icon>\n+  height: 1.5rem !important;\n+  width: 1.5rem !important;\n+}\n+\n+.task-link-text {\n+  overflow: hidden;\n+  white-space: nowrap;\n+  text-overflow: ellipsis;\n+  display: inline-block;\n+}\n+\n+.subtasks {\n+  padding-left: 1.25rem;\n+  width: 100%;\n+}\n+.subtasks .task {\n+  &:first-of-type {\n+    border-top: 2px solid #EAEFF2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "604697b41fee9a1fa12c52d57a7d7bf4cf6a74b5"}, "originalPosition": 118}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "413bb8a98d9e61fbc050ebe40f242ba38c920cd2", "author": {"user": {"login": "fqueiruga", "name": "F\u00e9lix Queiruga"}}, "url": "https://github.com/jenkinsci/jenkins/commit/413bb8a98d9e61fbc050ebe40f242ba38c920cd2", "committedDate": "2020-05-04T08:58:09Z", "message": "Rename css module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9421db250e97351e3b6585aa3f06dd9c65b1c35b", "author": {"user": {"login": "fqueiruga", "name": "F\u00e9lix Queiruga"}}, "url": "https://github.com/jenkinsci/jenkins/commit/9421db250e97351e3b6585aa3f06dd9c65b1c35b", "committedDate": "2020-05-05T15:05:37Z", "message": "Rework layout so that body is a flex container\n\n- This enables both sidepanel and main panel to stretch vertically till the bottom of the page\n- The footer is properly positioned and now longer uses a position: absolute hack"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c019594097f81e94146c4a0e11e9690d95ac0ff3", "author": {"user": {"login": "fqueiruga", "name": "F\u00e9lix Queiruga"}}, "url": "https://github.com/jenkinsci/jenkins/commit/c019594097f81e94146c4a0e11e9690d95ac0ff3", "committedDate": "2020-05-05T15:11:20Z", "message": "Adds a border to the side panel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba3e274c684049cce410ad8141d17f9a0a39e14a", "author": {"user": {"login": "fqueiruga", "name": "F\u00e9lix Queiruga"}}, "url": "https://github.com/jenkinsci/jenkins/commit/ba3e274c684049cce410ad8141d17f9a0a39e14a", "committedDate": "2020-05-05T15:21:43Z", "message": "Merge branch 'master' into jenkins-61973_restyle-sidebar-tasks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MTE0Njkx", "url": "https://github.com/jenkinsci/jenkins/pull/4700#pullrequestreview-408114691", "createdAt": "2020-05-08T09:23:35Z", "commit": {"oid": "ba3e274c684049cce410ad8141d17f9a0a39e14a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4OTY3Mzc4", "url": "https://github.com/jenkinsci/jenkins/pull/4700#pullrequestreview-408967378", "createdAt": "2020-05-11T08:32:29Z", "commit": {"oid": "ba3e274c684049cce410ad8141d17f9a0a39e14a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNzkyNDQx", "url": "https://github.com/jenkinsci/jenkins/pull/4700#pullrequestreview-410792441", "createdAt": "2020-05-13T10:27:23Z", "commit": {"oid": "ba3e274c684049cce410ad8141d17f9a0a39e14a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNjQ2MjA1", "url": "https://github.com/jenkinsci/jenkins/pull/4700#pullrequestreview-411646205", "createdAt": "2020-05-14T09:54:11Z", "commit": {"oid": "ba3e274c684049cce410ad8141d17f9a0a39e14a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1137, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}