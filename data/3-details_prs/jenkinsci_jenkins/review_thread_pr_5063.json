{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MDY4ODE3", "number": 5063, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzozOToxMFrOE7KvTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwOToyNDozMVrOE8md-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNDc3MzkwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApiData.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzozOToxMFrOH2qILA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzozOToxMFrOH2qILA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3NTM3Mg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final ArrayList<AdministrativeMonitor> monitorsList = new ArrayList<AdministrativeMonitor>();\n          \n          \n            \n                private final List<AdministrativeMonitor> monitorsList = new ArrayList<AdministrativeMonitor>();", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r527075372", "createdAt": "2020-11-19T17:39:10Z", "author": {"login": "timja"}, "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApiData.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package jenkins.management;\n+\n+import hudson.model.AdministrativeMonitor;\n+import org.kohsuke.accmod.Restricted;\n+import org.kohsuke.accmod.restrictions.NoExternalUse;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+@Restricted(NoExternalUse.class)\n+public class AdministrativeMonitorsApiData {\n+    private final ArrayList<AdministrativeMonitor> monitorsList = new ArrayList<AdministrativeMonitor>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f98ad85bc852d81c8d58de602cb9bf4ad8e1342d"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNDc3NDIzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApiData.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzozOToxN1rOH2qIfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzozOToxN1rOH2qIfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3NTQ1NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public ArrayList<AdministrativeMonitor> getMonitorsList() {\n          \n          \n            \n                public List<AdministrativeMonitor> getMonitorsList() {", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r527075454", "createdAt": "2020-11-19T17:39:17Z", "author": {"login": "timja"}, "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApiData.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package jenkins.management;\n+\n+import hudson.model.AdministrativeMonitor;\n+import org.kohsuke.accmod.Restricted;\n+import org.kohsuke.accmod.restrictions.NoExternalUse;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+@Restricted(NoExternalUse.class)\n+public class AdministrativeMonitorsApiData {\n+    private final ArrayList<AdministrativeMonitor> monitorsList = new ArrayList<AdministrativeMonitor>();\n+\n+    AdministrativeMonitorsApiData(List<AdministrativeMonitor> monitors) {\n+        monitorsList.addAll(monitors);\n+    }\n+\n+    public ArrayList<AdministrativeMonitor> getMonitorsList() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f98ad85bc852d81c8d58de602cb9bf4ad8e1342d"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNDc3NTQ4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApiData.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzozOTozMlrOH2qJNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzozOTozMlrOH2qJNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA3NTYzOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return  this.monitorsList.size() > 0;\n          \n          \n            \n                    return !this.monitorsList.isEmpty();", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r527075639", "createdAt": "2020-11-19T17:39:32Z", "author": {"login": "timja"}, "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApiData.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package jenkins.management;\n+\n+import hudson.model.AdministrativeMonitor;\n+import org.kohsuke.accmod.Restricted;\n+import org.kohsuke.accmod.restrictions.NoExternalUse;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+@Restricted(NoExternalUse.class)\n+public class AdministrativeMonitorsApiData {\n+    private final ArrayList<AdministrativeMonitor> monitorsList = new ArrayList<AdministrativeMonitor>();\n+\n+    AdministrativeMonitorsApiData(List<AdministrativeMonitor> monitors) {\n+        monitorsList.addAll(monitors);\n+    }\n+\n+    public ArrayList<AdministrativeMonitor> getMonitorsList() {\n+        return this.monitorsList;\n+    }\n+\n+    public boolean hasActiveMonitors() {\n+        return  this.monitorsList.size() > 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f98ad85bc852d81c8d58de602cb9bf4ad8e1342d"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNTI2Njc0OnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/footer.jelly", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxOTo0NjowM1rOH2u5xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwOToxMjo0M1rOH3HNRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE1MzYwNA==", "bodyText": "looks like the indent change should be reverted here?", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r527153604", "createdAt": "2020-11-19T19:46:03Z", "author": {"login": "timja"}, "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/footer.jelly", "diffHunk": "@@ -23,73 +23,65 @@ THE SOFTWARE.\n -->\n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:l=\"/lib/layout\">\n-    <j:set var=\"activeMonitors\" value=\"${it.getMonitorsToDisplay()}\" />\n-    \n+    <j:set var=\"activeMonitors\" value=\"${it.getMonitorsToDisplay()}\"/>\n+\n     <j:if test=\"${activeMonitors != null and activeMonitors.size() > 0}\">\n         <st:adjunct includes=\"jenkins.management.AdministrativeMonitorsDecorator.resources\"/>\n \n-        <j:set var=\"activeNonSecurityAM\" value=\"${it.filterNonSecurityAdministrativeMonitors(activeMonitors)}\" />\n-        <j:set var=\"activeNonSecurityAMCount\" value=\"${activeNonSecurityAM.size()}\" />\n-        <j:set var=\"activeSecurityAM\" value=\"${it.filterSecurityAdministrativeMonitors(activeMonitors)}\" />\n-        <j:set var=\"activeSecurityAMCount\" value=\"${activeSecurityAM.size()}\" />\n+        <j:set var=\"activeNonSecurityAMCount\" value=\"${it.nonSecurityAdministrativeMonitorsCount}\"/>\n+        <j:set var=\"activeSecurityAMCount\" value=\"${it.securityAdministrativeMonitorsCount  }\"/>\n \n         <div id=\"visible-am-container\" class=\"am-container\">\n             <j:if test=\"${activeNonSecurityAMCount > 0}\">\n-                <a id=\"visible-am-button\" class=\"am-button\" href=\"#\" onclick=\"toggleVisibleAmList(event)\" title=\"${%tooltip(activeNonSecurityAMCount)}\">\n-                    <l:svgIcon href=\"${resURL}/images/material-icons/svg-sprite-social-symbol.svg#ic_notifications_24px\" />\n-                    <div class=\"am-monitor__indicator-mobile\" />\n+                <a id=\"visible-am-button\"\n+                   class=\"am-button\"\n+                   href=\"#\"\n+                   data-href=\"${rootURL}/administrativeMonitors/nonSecurityPopupContent\"\n+                   title=\"${%tooltip(activeNonSecurityAMCount)}\">\n+                    <l:svgIcon\n+                            href=\"${resURL}/images/material-icons/svg-sprite-social-symbol.svg#ic_notifications_24px\"/>\n+                    <div class=\"am-monitor__indicator-mobile\"/>\n                     <span class=\"am-monitor__count\">\n                         ${activeNonSecurityAMCount}\n                     </span>\n                 </a>\n                 <div id=\"visible-am-list\" class=\"am-list\">\n-                    <j:forEach var=\"am\" items=\"${activeNonSecurityAM}\">\n-                        <div class=\"am-message\">\n-                            <st:include page=\"message.jelly\" it=\"${am}\" />\n-                        </div>\n-                    </j:forEach>\n-                    <p style=\"text-align: center; margin: 10px 0 0 0;\">\n-                        <a href=\"${rootURL}/manage\" onclick=\"document.location.href='${rootURL}/manage';\">${%Manage Jenkins}</a>\n-                    </p>\n                 </div>\n             </j:if>\n         </div>\n         <div id=\"visible-sec-am-container\" class=\"am-container\">\n             <j:if test=\"${activeSecurityAMCount > 0}\">\n-                <a id=\"visible-sec-am-button\" class=\"am-button security-am\" href=\"#\" onclick=\"toggleVisibleSecAmList(event)\" title=\"${%tooltipSec(activeSecurityAMCount)}\">\n-                    <l:svgIcon href=\"${resURL}/images/material-icons/svg-sprite-action-symbol.svg#ic_warning_shield_24px\" />\n-                    <div class=\"am-monitor__indicator-mobile\" />\n+                <a id=\"visible-sec-am-button\"\n+                   class=\"am-button security-am\"\n+                   href=\"#\"\n+                   data-href=\"${rootURL}/administrativeMonitors/securityPopupContent\"\n+                   title=\"${%tooltipSec(activeSecurityAMCount)}\">\n+                    <l:svgIcon\n+                            href=\"${resURL}/images/material-icons/svg-sprite-action-symbol.svg#ic_warning_shield_24px\"/>\n+                    <div class=\"am-monitor__indicator-mobile\"/>\n                     <span class=\"am-monitor__count\">\n                         ${activeSecurityAMCount}\n                     </span>\n                 </a>\n                 <div id=\"visible-sec-am-list\" class=\"am-list\">\n-                    <j:forEach var=\"am\" items=\"${activeSecurityAM}\">\n-                        <div class=\"am-message\">\n-                            <st:include page=\"message.jelly\" it=\"${am}\" />\n-                        </div>\n-                    </j:forEach>\n-                    <p style=\"text-align: center; margin: 10px 0 0 0;\">\n-                        <a href=\"${rootURL}/manage\" onclick=\"document.location.href='${rootURL}/manage';\">${%Manage Jenkins}</a>\n-                    </p>\n                 </div>\n             </j:if>\n         </div>\n         <script type=\"text/javascript\">\n             (function() {\n-                var amContainer = document.getElementById(\"visible-am-container\");\n-                var amInsertion = document.getElementById(\"visible-am-insertion\");\n+            var amContainer = document.getElementById(\"visible-am-container\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f98ad85bc852d81c8d58de602cb9bf4ad8e1342d"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU1MTgxMg==", "bodyText": "Yes", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r527551812", "createdAt": "2020-11-20T09:12:43Z", "author": {"login": "fqueiruga"}, "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/footer.jelly", "diffHunk": "@@ -23,73 +23,65 @@ THE SOFTWARE.\n -->\n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:l=\"/lib/layout\">\n-    <j:set var=\"activeMonitors\" value=\"${it.getMonitorsToDisplay()}\" />\n-    \n+    <j:set var=\"activeMonitors\" value=\"${it.getMonitorsToDisplay()}\"/>\n+\n     <j:if test=\"${activeMonitors != null and activeMonitors.size() > 0}\">\n         <st:adjunct includes=\"jenkins.management.AdministrativeMonitorsDecorator.resources\"/>\n \n-        <j:set var=\"activeNonSecurityAM\" value=\"${it.filterNonSecurityAdministrativeMonitors(activeMonitors)}\" />\n-        <j:set var=\"activeNonSecurityAMCount\" value=\"${activeNonSecurityAM.size()}\" />\n-        <j:set var=\"activeSecurityAM\" value=\"${it.filterSecurityAdministrativeMonitors(activeMonitors)}\" />\n-        <j:set var=\"activeSecurityAMCount\" value=\"${activeSecurityAM.size()}\" />\n+        <j:set var=\"activeNonSecurityAMCount\" value=\"${it.nonSecurityAdministrativeMonitorsCount}\"/>\n+        <j:set var=\"activeSecurityAMCount\" value=\"${it.securityAdministrativeMonitorsCount  }\"/>\n \n         <div id=\"visible-am-container\" class=\"am-container\">\n             <j:if test=\"${activeNonSecurityAMCount > 0}\">\n-                <a id=\"visible-am-button\" class=\"am-button\" href=\"#\" onclick=\"toggleVisibleAmList(event)\" title=\"${%tooltip(activeNonSecurityAMCount)}\">\n-                    <l:svgIcon href=\"${resURL}/images/material-icons/svg-sprite-social-symbol.svg#ic_notifications_24px\" />\n-                    <div class=\"am-monitor__indicator-mobile\" />\n+                <a id=\"visible-am-button\"\n+                   class=\"am-button\"\n+                   href=\"#\"\n+                   data-href=\"${rootURL}/administrativeMonitors/nonSecurityPopupContent\"\n+                   title=\"${%tooltip(activeNonSecurityAMCount)}\">\n+                    <l:svgIcon\n+                            href=\"${resURL}/images/material-icons/svg-sprite-social-symbol.svg#ic_notifications_24px\"/>\n+                    <div class=\"am-monitor__indicator-mobile\"/>\n                     <span class=\"am-monitor__count\">\n                         ${activeNonSecurityAMCount}\n                     </span>\n                 </a>\n                 <div id=\"visible-am-list\" class=\"am-list\">\n-                    <j:forEach var=\"am\" items=\"${activeNonSecurityAM}\">\n-                        <div class=\"am-message\">\n-                            <st:include page=\"message.jelly\" it=\"${am}\" />\n-                        </div>\n-                    </j:forEach>\n-                    <p style=\"text-align: center; margin: 10px 0 0 0;\">\n-                        <a href=\"${rootURL}/manage\" onclick=\"document.location.href='${rootURL}/manage';\">${%Manage Jenkins}</a>\n-                    </p>\n                 </div>\n             </j:if>\n         </div>\n         <div id=\"visible-sec-am-container\" class=\"am-container\">\n             <j:if test=\"${activeSecurityAMCount > 0}\">\n-                <a id=\"visible-sec-am-button\" class=\"am-button security-am\" href=\"#\" onclick=\"toggleVisibleSecAmList(event)\" title=\"${%tooltipSec(activeSecurityAMCount)}\">\n-                    <l:svgIcon href=\"${resURL}/images/material-icons/svg-sprite-action-symbol.svg#ic_warning_shield_24px\" />\n-                    <div class=\"am-monitor__indicator-mobile\" />\n+                <a id=\"visible-sec-am-button\"\n+                   class=\"am-button security-am\"\n+                   href=\"#\"\n+                   data-href=\"${rootURL}/administrativeMonitors/securityPopupContent\"\n+                   title=\"${%tooltipSec(activeSecurityAMCount)}\">\n+                    <l:svgIcon\n+                            href=\"${resURL}/images/material-icons/svg-sprite-action-symbol.svg#ic_warning_shield_24px\"/>\n+                    <div class=\"am-monitor__indicator-mobile\"/>\n                     <span class=\"am-monitor__count\">\n                         ${activeSecurityAMCount}\n                     </span>\n                 </a>\n                 <div id=\"visible-sec-am-list\" class=\"am-list\">\n-                    <j:forEach var=\"am\" items=\"${activeSecurityAM}\">\n-                        <div class=\"am-message\">\n-                            <st:include page=\"message.jelly\" it=\"${am}\" />\n-                        </div>\n-                    </j:forEach>\n-                    <p style=\"text-align: center; margin: 10px 0 0 0;\">\n-                        <a href=\"${rootURL}/manage\" onclick=\"document.location.href='${rootURL}/manage';\">${%Manage Jenkins}</a>\n-                    </p>\n                 </div>\n             </j:if>\n         </div>\n         <script type=\"text/javascript\">\n             (function() {\n-                var amContainer = document.getElementById(\"visible-am-container\");\n-                var amInsertion = document.getElementById(\"visible-am-insertion\");\n+            var amContainer = document.getElementById(\"visible-am-container\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE1MzYwNA=="}, "originalCommit": {"oid": "f98ad85bc852d81c8d58de602cb9bf4ad8e1342d"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNTMxMTY4OnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/resources.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxOTo1ODowOFrOH2vVaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwOToxNDozMVrOH3HRIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2MDY4MA==", "bodyText": "would be good to extract this to a variable so that people who don't know keycodes know what this is", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r527160680", "createdAt": "2020-11-19T19:58:08Z", "author": {"login": "timja"}, "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/resources.js", "diffHunk": "@@ -1,78 +1,90 @@\n-function amCloser(e) {\n-    var list = document.getElementById('visible-am-list');\n-    var el = e.target;\n-    while (el) {\n-        if (el === list) {\n-            return; // clicked in the list\n+(function () {\n+    function initializeAmMonitor(amMonitorRoot, options) {\n+        var button = amMonitorRoot.querySelector('.am-button');\n+        var url = button.getAttribute('data-href');\n+        var amList = amMonitorRoot.querySelector('.am-list');\n+\n+        function onClose(e) {\n+            var list = amList;\n+            var el = e.target;\n+            while (el) {\n+                if (el === list) {\n+                    return; // clicked in the list\n+                }\n+                el = el.parentElement;\n+            }\n+            close();\n         }\n-        el = el.parentElement;\n-    }\n-    hideVisibleAmList();\n-}\n-function secAmCloser(e) {\n-    var list = document.getElementById('visible-sec-am-list');\n-    var el = e.target;\n-    while (el) {\n-        if (el === list) {\n-            return; // clicked in the list\n+        function onEscClose(e) {\n+            if (e.keyCode === 27) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f98ad85bc852d81c8d58de602cb9bf4ad8e1342d"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU1MjgwMg==", "bodyText": "I put a comment next to it to clarify, if that's OK.", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r527552802", "createdAt": "2020-11-20T09:14:31Z", "author": {"login": "fqueiruga"}, "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/resources.js", "diffHunk": "@@ -1,78 +1,90 @@\n-function amCloser(e) {\n-    var list = document.getElementById('visible-am-list');\n-    var el = e.target;\n-    while (el) {\n-        if (el === list) {\n-            return; // clicked in the list\n+(function () {\n+    function initializeAmMonitor(amMonitorRoot, options) {\n+        var button = amMonitorRoot.querySelector('.am-button');\n+        var url = button.getAttribute('data-href');\n+        var amList = amMonitorRoot.querySelector('.am-list');\n+\n+        function onClose(e) {\n+            var list = amList;\n+            var el = e.target;\n+            while (el) {\n+                if (el === list) {\n+                    return; // clicked in the list\n+                }\n+                el = el.parentElement;\n+            }\n+            close();\n         }\n-        el = el.parentElement;\n-    }\n-    hideVisibleAmList();\n-}\n-function secAmCloser(e) {\n-    var list = document.getElementById('visible-sec-am-list');\n-    var el = e.target;\n-    while (el) {\n-        if (el === list) {\n-            return; // clicked in the list\n+        function onEscClose(e) {\n+            if (e.keyCode === 27) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2MDY4MA=="}, "originalCommit": {"oid": "f98ad85bc852d81c8d58de602cb9bf4ad8e1342d"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNTMyNjI0OnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsApiData/monitorsList.properties", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDowMjoyNlrOH2vetA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQyMDowMjoyNlrOH2vetA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE2MzA2MA==", "bodyText": "what about this? not the best wording imo but no point spending much time on it as users shouldn't see it\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            no_active_monitors=There are currently no active monitors\n          \n          \n            \n            no_active_monitors=There are currently no warnings", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r527163060", "createdAt": "2020-11-19T20:02:26Z", "author": {"login": "timja"}, "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsApiData/monitorsList.properties", "diffHunk": "@@ -0,0 +1 @@\n+no_active_monitors=There are currently no active monitors", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f98ad85bc852d81c8d58de602cb9bf4ad8e1342d"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNzgwNDM2OnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/resources.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwOToxOTo1MFrOH3HdAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMFQwOToxOTo1MFrOH3HdAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU1NTg0Mw==", "bodyText": "I meant something like this, what do you think?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (e.keyCode === 27) { // If the key press is ESCAPE...\n          \n          \n            \n                        var escapeKeyCode = 27;\n          \n          \n            \n                        if (e.keyCode === escapeKeyCode) {", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r527555843", "createdAt": "2020-11-20T09:19:50Z", "author": {"login": "timja"}, "path": "core/src/main/resources/jenkins/management/AdministrativeMonitorsDecorator/resources.js", "diffHunk": "@@ -1,78 +1,94 @@\n-function amCloser(e) {\n-    var list = document.getElementById('visible-am-list');\n-    var el = e.target;\n-    while (el) {\n-        if (el === list) {\n-            return; // clicked in the list\n+(function () {\n+    function initializeAmMonitor(amMonitorRoot, options) {\n+        var button = amMonitorRoot.querySelector('.am-button');\n+        var amList = amMonitorRoot.querySelector('.am-list');\n+        if (button === null || amList === null) return null;\n+\n+        var url = button.getAttribute('data-href');\n+\n+        function onClose(e) {\n+            var list = amList;\n+            var el = e.target;\n+            while (el) {\n+                if (el === list) {\n+                    return; // clicked in the list\n+                }\n+                el = el.parentElement;\n+            }\n+            close();\n         }\n-        el = el.parentElement;\n-    }\n-    hideVisibleAmList();\n-}\n-function secAmCloser(e) {\n-    var list = document.getElementById('visible-sec-am-list');\n-    var el = e.target;\n-    while (el) {\n-        if (el === list) {\n-            return; // clicked in the list\n+        function onEscClose(e) {\n+            if (e.keyCode === 27) { // If the key press is ESCAPE...", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de58052ca0ae56ad2c472e67c9b0308441804dda"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxMjkxNTY0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApi.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMlQwODo0OTozOVrOH31E6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwODo0Njo0NFrOH4x1hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODMwMzMzOA==", "bodyText": "Should these calls have explicit permission checks?", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r528303338", "createdAt": "2020-11-22T08:49:39Z", "author": {"login": "oleg-nenashev"}, "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApi.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package jenkins.management;\n+\n+import hudson.Extension;\n+import hudson.model.AdministrativeMonitor;\n+import hudson.model.PageDecorator;\n+import hudson.model.RootAction;\n+import jenkins.model.Jenkins;\n+import org.kohsuke.accmod.Restricted;\n+import org.kohsuke.accmod.restrictions.NoExternalUse;\n+import org.kohsuke.stapler.StaplerRequest;\n+import org.kohsuke.stapler.StaplerResponse;\n+import org.kohsuke.stapler.verb.GET;\n+\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Collections;\n+\n+@Extension\n+@Restricted(NoExternalUse.class)\n+public class AdministrativeMonitorsApi implements RootAction {\n+    @GET", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c8f403a87bd58d4a8cd7683ec5e50b4a0f2c230"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU1Njc3OA==", "bodyText": "The authorization is implicit through the decorator. That said I think it would make sense to have more explicit auth. I have no idea how to got about this. If anyone wants to commit straight to my branch please go ahead :D", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r528556778", "createdAt": "2020-11-23T09:13:00Z", "author": {"login": "fqueiruga"}, "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApi.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package jenkins.management;\n+\n+import hudson.Extension;\n+import hudson.model.AdministrativeMonitor;\n+import hudson.model.PageDecorator;\n+import hudson.model.RootAction;\n+import jenkins.model.Jenkins;\n+import org.kohsuke.accmod.Restricted;\n+import org.kohsuke.accmod.restrictions.NoExternalUse;\n+import org.kohsuke.stapler.StaplerRequest;\n+import org.kohsuke.stapler.StaplerResponse;\n+import org.kohsuke.stapler.verb.GET;\n+\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Collections;\n+\n+@Extension\n+@Restricted(NoExternalUse.class)\n+public class AdministrativeMonitorsApi implements RootAction {\n+    @GET", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODMwMzMzOA=="}, "originalCommit": {"oid": "8c8f403a87bd58d4a8cd7683ec5e50b4a0f2c230"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODYyNTg1NQ==", "bodyText": "@daniel-beck @Wadeck  how would you go about this?", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r528625855", "createdAt": "2020-11-23T11:09:40Z", "author": {"login": "fqueiruga"}, "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApi.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package jenkins.management;\n+\n+import hudson.Extension;\n+import hudson.model.AdministrativeMonitor;\n+import hudson.model.PageDecorator;\n+import hudson.model.RootAction;\n+import jenkins.model.Jenkins;\n+import org.kohsuke.accmod.Restricted;\n+import org.kohsuke.accmod.restrictions.NoExternalUse;\n+import org.kohsuke.stapler.StaplerRequest;\n+import org.kohsuke.stapler.StaplerResponse;\n+import org.kohsuke.stapler.verb.GET;\n+\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Collections;\n+\n+@Extension\n+@Restricted(NoExternalUse.class)\n+public class AdministrativeMonitorsApi implements RootAction {\n+    @GET", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODMwMzMzOA=="}, "originalCommit": {"oid": "8c8f403a87bd58d4a8cd7683ec5e50b4a0f2c230"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODYzMTE5Ng==", "bodyText": "it's quite common to rely on permission checks in this way as far as I know", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r528631196", "createdAt": "2020-11-23T11:19:44Z", "author": {"login": "timja"}, "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApi.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package jenkins.management;\n+\n+import hudson.Extension;\n+import hudson.model.AdministrativeMonitor;\n+import hudson.model.PageDecorator;\n+import hudson.model.RootAction;\n+import jenkins.model.Jenkins;\n+import org.kohsuke.accmod.Restricted;\n+import org.kohsuke.accmod.restrictions.NoExternalUse;\n+import org.kohsuke.stapler.StaplerRequest;\n+import org.kohsuke.stapler.StaplerResponse;\n+import org.kohsuke.stapler.verb.GET;\n+\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Collections;\n+\n+@Extension\n+@Restricted(NoExternalUse.class)\n+public class AdministrativeMonitorsApi implements RootAction {\n+    @GET", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODMwMzMzOA=="}, "originalCommit": {"oid": "8c8f403a87bd58d4a8cd7683ec5e50b4a0f2c230"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTI5ODgyMA==", "bodyText": "In this case it's a bit special because the permission is checked deeper in the code. It was recently changed from Admin to SystemRead. It means that if we have an additional check here, it's a bit a duplicate code, so I am fine with the current approach.\nOf course if the method is starting to do something else, the explicit permission will be required, but we should not be future-proof without good rational.", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r529298820", "createdAt": "2020-11-24T08:46:44Z", "author": {"login": "Wadeck"}, "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApi.java", "diffHunk": "@@ -0,0 +1,62 @@\n+package jenkins.management;\n+\n+import hudson.Extension;\n+import hudson.model.AdministrativeMonitor;\n+import hudson.model.PageDecorator;\n+import hudson.model.RootAction;\n+import jenkins.model.Jenkins;\n+import org.kohsuke.accmod.Restricted;\n+import org.kohsuke.accmod.restrictions.NoExternalUse;\n+import org.kohsuke.stapler.StaplerRequest;\n+import org.kohsuke.stapler.StaplerResponse;\n+import org.kohsuke.stapler.verb.GET;\n+\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Collections;\n+\n+@Extension\n+@Restricted(NoExternalUse.class)\n+public class AdministrativeMonitorsApi implements RootAction {\n+    @GET", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODMwMzMzOA=="}, "originalCommit": {"oid": "8c8f403a87bd58d4a8cd7683ec5e50b4a0f2c230"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxOTgwMjgyOnYy", "diffSide": "LEFT", "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApi.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwOToyNDozMVrOH40TTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQwOToyNzo0NlrOH40j4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMzOTIxMg==", "bodyText": "why aren't this needed?", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r529339212", "createdAt": "2020-11-24T09:24:31Z", "author": {"login": "fqueiruga"}, "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApi.java", "diffHunk": "@@ -12,28 +11,19 @@\n import org.kohsuke.stapler.verb.GET;\n \n import javax.servlet.ServletException;\n-import javax.servlet.http.HttpServletResponse;\n import java.io.IOException;\n-import java.util.Collection;\n-import java.util.Collections;\n \n @Extension\n @Restricted(NoExternalUse.class)\n public class AdministrativeMonitorsApi implements RootAction {\n     @GET\n     public void doNonSecurityPopupContent(StaplerRequest req, StaplerResponse resp) throws IOException, ServletException {\n-        resp.setStatus(HttpServletResponse.SC_OK);\n-        resp.setContentType(\"text/html\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40a28adf55ad9dff91be9ded5b99d323bac1a793"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTM0MzQ1Nw==", "bodyText": "It's done automatically by the JellyFacet (need to find exactly the code, inside Stapler, digging...)\n=> https://github.com/fqueiruga/jenkins/blob/279d8109eddb7a494428baf25af9756c2e33576b/core/src/main/resources/lib/layout/ajax.jelly#L54\nIt's from the j:ajax tag \ud83c\udf89", "url": "https://github.com/jenkinsci/jenkins/pull/5063#discussion_r529343457", "createdAt": "2020-11-24T09:27:46Z", "author": {"login": "Wadeck"}, "path": "core/src/main/java/jenkins/management/AdministrativeMonitorsApi.java", "diffHunk": "@@ -12,28 +11,19 @@\n import org.kohsuke.stapler.verb.GET;\n \n import javax.servlet.ServletException;\n-import javax.servlet.http.HttpServletResponse;\n import java.io.IOException;\n-import java.util.Collection;\n-import java.util.Collections;\n \n @Extension\n @Restricted(NoExternalUse.class)\n public class AdministrativeMonitorsApi implements RootAction {\n     @GET\n     public void doNonSecurityPopupContent(StaplerRequest req, StaplerResponse resp) throws IOException, ServletException {\n-        resp.setStatus(HttpServletResponse.SC_OK);\n-        resp.setContentType(\"text/html\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMzOTIxMg=="}, "originalCommit": {"oid": "40a28adf55ad9dff91be9ded5b99d323bac1a793"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 104, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}