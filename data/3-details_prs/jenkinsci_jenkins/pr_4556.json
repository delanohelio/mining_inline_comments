{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MjgzODY4", "number": 4556, "title": "Fix: Jelly 'enum' tag 'default' attribute not working", "bodyText": "See JENKINS-61385.\nProposed changelog entries\n\nFix support of the default attribute in the Jelly 'enum' form control\n\nProposed upgrade guidelines\nN/A\nSubmitter checklist\n\n JIRA issue is well described\n Created complete autotests for the enum field\n\nDesired reviewers\nN/A\nMaintainer checklist\nBefore the changes are marked as ready-for-merge:\n\n There are at least 2 approvals for the pull request and no outstanding requests for change\n Conversations in the pull request are over OR it is explicit that a reviewer does not block the change\n Changelog entries in the PR title and/or Proposed changelog entries are correct\n Proper changelog labels are set so that the changelog can be generated automatically\n If the change needs additional upgrade steps from users, upgrade-guide-needed label is set and there is a Proposed upgrade guidelines section in the PR title. (example)\n If it would make sense to backport the change to LTS, a JIRA issue should exist and be labeled as lts-candidate", "createdAt": "2020-03-08T16:10:49Z", "url": "https://github.com/jenkinsci/jenkins/pull/4556", "merged": true, "mergeCommit": {"oid": "58c52dfe4945e75e501becb9e7e524f2bdac35ea"}, "closed": true, "closedAt": "2020-03-14T09:26:32Z", "author": {"login": "knapsu"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLGCuDgH2gAyMzg1MjgzODY4Ojc5MzhiMGM4MTY0ZGFkMWM1NTY4MzU2ZjY4OTA3YmY1MjljN2UwNmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcM4tEWgFqTM3MzQxMzY5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7938b0c8164dad1c5568356f68907bf529c7e06d", "author": {"user": {"login": "knapsu", "name": "Krzysztof Knapik"}}, "url": "https://github.com/jenkinsci/jenkins/commit/7938b0c8164dad1c5568356f68907bf529c7e06d", "committedDate": "2020-03-06T20:21:39Z", "message": "Fix Jelly form not setting default value for enum when field is empty"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODYwODIz", "url": "https://github.com/jenkinsci/jenkins/pull/4556#pullrequestreview-370860823", "createdAt": "2020-03-08T21:55:39Z", "commit": {"oid": "7938b0c8164dad1c5568356f68907bf529c7e06d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyNjA5MzQ1", "url": "https://github.com/jenkinsci/jenkins/pull/4556#pullrequestreview-372609345", "createdAt": "2020-03-11T09:52:25Z", "commit": {"oid": "7938b0c8164dad1c5568356f68907bf529c7e06d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwOTo1MjoyNVrOF0v3Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQwOTo1Mzo1MFrOF0v6dQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg1NDQzMA==", "bodyText": "It would be better to introduce a new local variable. Overriding attribute fields might be working now, but I was unable to find Jelly documentation about whether it is a supported behavior. It may stop working eventually.", "url": "https://github.com/jenkinsci/jenkins/pull/4556#discussion_r390854430", "createdAt": "2020-03-11T09:52:25Z", "author": {"login": "oleg-nenashev"}, "path": "core/src/main/resources/lib/form/enum.jelly", "diffHunk": "@@ -36,9 +36,14 @@ THE SOFTWARE.\n       The name of the enum to set as default value for the first configuration.\n     </st:attribute>\n   </st:documentation>\n-  <select class=\"setting-input\" name=\"${field}\">\n-    <j:forEach var=\"it\" items=\"${descriptor.getPropertyType(instance,field).enumConstants}\">\n-      <f:option value=\"${it.name()}\" selected=\"${instance != null ? it==instance[field] : it.name()==default}\">\n+\n+  <j:if test=\"${attrs.field==null}\">\n+    <j:set target=\"${attrs}\" property=\"field\" value=\"${entry.field}\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7938b0c8164dad1c5568356f68907bf529c7e06d"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg1NTI4NQ==", "bodyText": "${entry.field} always puts null here. As designed, right?", "url": "https://github.com/jenkinsci/jenkins/pull/4556#discussion_r390855285", "createdAt": "2020-03-11T09:53:50Z", "author": {"login": "oleg-nenashev"}, "path": "core/src/main/resources/lib/form/enum.jelly", "diffHunk": "@@ -36,9 +36,14 @@ THE SOFTWARE.\n       The name of the enum to set as default value for the first configuration.\n     </st:attribute>\n   </st:documentation>\n-  <select class=\"setting-input\" name=\"${field}\">\n-    <j:forEach var=\"it\" items=\"${descriptor.getPropertyType(instance,field).enumConstants}\">\n-      <f:option value=\"${it.name()}\" selected=\"${instance != null ? it==instance[field] : it.name()==default}\">\n+\n+  <j:if test=\"${attrs.field==null}\">\n+    <j:set target=\"${attrs}\" property=\"field\" value=\"${entry.field}\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7938b0c8164dad1c5568356f68907bf529c7e06d"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMzg1NzUz", "url": "https://github.com/jenkinsci/jenkins/pull/4556#pullrequestreview-373385753", "createdAt": "2020-03-12T09:17:20Z", "commit": {"oid": "7938b0c8164dad1c5568356f68907bf529c7e06d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNDEzNDE4", "url": "https://github.com/jenkinsci/jenkins/pull/4556#pullrequestreview-373413418", "createdAt": "2020-03-12T09:56:44Z", "commit": {"oid": "7938b0c8164dad1c5568356f68907bf529c7e06d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNDEzNjk0", "url": "https://github.com/jenkinsci/jenkins/pull/4556#pullrequestreview-373413694", "createdAt": "2020-03-12T09:57:05Z", "commit": {"oid": "7938b0c8164dad1c5568356f68907bf529c7e06d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1277, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}