{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4ODE1MTE3", "number": 4413, "title": "[JENKINS-60625] Prevent Jenkins page rendering from being blocked when the update center data parsing is in progress", "bodyText": "See JENKINS-60625.\nProposed changelog entries\n\nParsing update center metadata could be slow; Jenkins no longer blocks page rendering just to do so from administrative monitors.", "createdAt": "2020-01-02T22:25:43Z", "url": "https://github.com/jenkinsci/jenkins/pull/4413", "merged": true, "mergeCommit": {"oid": "9640790fe1de96331b4aafe6fc6608b35e776663"}, "closed": true, "closedAt": "2020-01-04T13:16:02Z", "author": {"login": "jglick"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2ha1YgH2gAyMzU4ODE1MTE3OmFmN2M0YmVjZTI0MjE2ZmU0N2YxMGU4M2UzNDg4ZmZkYmI1ZjE1NjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb22FQJgFqTMzODMwMTM1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "af7c4bece24216fe47f10e83e3488ffdbb5f1565", "author": {"user": {"login": "jglick", "name": "Jesse Glick"}}, "url": "https://github.com/jenkinsci/jenkins/commit/af7c4bece24216fe47f10e83e3488ffdbb5f1565", "committedDate": "2020-01-02T22:23:01Z", "message": "[JENKINS-60625] Introduced UpdateCenter.isSiteDataReady for use from administrative monitors."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3OTAzMjI1", "url": "https://github.com/jenkinsci/jenkins/pull/4413#pullrequestreview-337903225", "createdAt": "2020-01-02T23:21:35Z", "commit": {"oid": "af7c4bece24216fe47f10e83e3488ffdbb5f1565"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQyMzoyMTozNVrOFZ3ZQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQyMzoyMTozNVrOFZ3ZQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY2NjMwNw==", "bodyText": "INFO? Really? Is this so notable?", "url": "https://github.com/jenkinsci/jenkins/pull/4413#discussion_r362666307", "createdAt": "2020-01-02T23:21:35Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/model/UpdateSite.java", "diffHunk": "@@ -315,14 +315,24 @@ public Data getData() {\n         return data;\n     }\n \n+    /**\n+     * Whether {@link #getData} might be blocking.\n+     */\n+    boolean hasUnparsedData() {\n+        return data == null && getDataFile().exists();\n+    }\n+\n     /**\n      * Gets the raw update center JSON data.\n      */\n     public JSONObject getJSONObject() {\n         TextFile df = getDataFile();\n         if(df.exists()) {\n+            long start = System.nanoTime();\n             try {\n-                return JSONObject.fromObject(df.read());\n+                JSONObject o = JSONObject.fromObject(df.read());\n+                LOGGER.info(() -> String.format(\"Loaded and parsed %s in %.01fs\", df, (System.nanoTime() - start) / 1_000_000_000.0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af7c4bece24216fe47f10e83e3488ffdbb5f1565"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3OTA0MDY4", "url": "https://github.com/jenkinsci/jenkins/pull/4413#pullrequestreview-337904068", "createdAt": "2020-01-02T23:24:59Z", "commit": {"oid": "af7c4bece24216fe47f10e83e3488ffdbb5f1565"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQyMzoyNDo1OVrOFZ3b-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQyMzoyNDo1OVrOFZ3b-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY2NzAwMw==", "bodyText": "It's not public but an explicit @Restricted might be a useful marker anyway. This looks like something we'd rather not expose unless there's a use case?", "url": "https://github.com/jenkinsci/jenkins/pull/4413#discussion_r362667003", "createdAt": "2020-01-02T23:24:59Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/model/UpdateSite.java", "diffHunk": "@@ -315,14 +315,24 @@ public Data getData() {\n         return data;\n     }\n \n+    /**\n+     * Whether {@link #getData} might be blocking.\n+     */\n+    boolean hasUnparsedData() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af7c4bece24216fe47f10e83e3488ffdbb5f1565"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3OTA0NTU3", "url": "https://github.com/jenkinsci/jenkins/pull/4413#pullrequestreview-337904557", "createdAt": "2020-01-02T23:27:06Z", "commit": {"oid": "af7c4bece24216fe47f10e83e3488ffdbb5f1565"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQyMzoyNzowNlrOFZ3duA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQyMzoyNzowNlrOFZ3duA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY2NzQ0OA==", "bodyText": "Note to self: I missed this change in the original version of the previous review.", "url": "https://github.com/jenkinsci/jenkins/pull/4413#discussion_r362667448", "createdAt": "2020-01-02T23:27:06Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/model/UpdateCenter.java", "diffHunk": "@@ -1061,7 +1087,12 @@ public String getDisplayName() {\n             return Messages.UpdateCenter_CoreUpdateMonitor_DisplayName();\n         }\n \n+        @Override\n         public boolean isActivated() {\n+            if (!Jenkins.get().getUpdateCenter().isSiteDataReady()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af7c4bece24216fe47f10e83e3488ffdbb5f1565"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3OTA4NjM1", "url": "https://github.com/jenkinsci/jenkins/pull/4413#pullrequestreview-337908635", "createdAt": "2020-01-02T23:45:13Z", "commit": {"oid": "af7c4bece24216fe47f10e83e3488ffdbb5f1565"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29fbc9c451aea8e53db10855a359a31dbbbbe0cf", "author": {"user": {"login": "jglick", "name": "Jesse Glick"}}, "url": "https://github.com/jenkinsci/jenkins/commit/29fbc9c451aea8e53db10855a359a31dbbbbe0cf", "committedDate": "2020-01-03T02:29:35Z", "message": "Quiet down log message about parsing JSON. (Though it is kind of interesting just how slow it is.)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MjM3ODAz", "url": "https://github.com/jenkinsci/jenkins/pull/4413#pullrequestreview-338237803", "createdAt": "2020-01-03T19:30:32Z", "commit": {"oid": "29fbc9c451aea8e53db10855a359a31dbbbbe0cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e621b6e0cd6ab103b819ade99240908897677057", "author": {"user": {"login": "jglick", "name": "Jesse Glick"}}, "url": "https://github.com/jenkinsci/jenkins/commit/e621b6e0cd6ab103b819ade99240908897677057", "committedDate": "2020-01-03T21:49:04Z", "message": "Be explicit that UpdateSite.hasUnparsedData is not intended as an API.\n\nCo-Authored-By: Daniel Beck <1831569+daniel-beck@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzAxMzU2", "url": "https://github.com/jenkinsci/jenkins/pull/4413#pullrequestreview-338301356", "createdAt": "2020-01-03T22:27:27Z", "commit": {"oid": "e621b6e0cd6ab103b819ade99240908897677057"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1681, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}