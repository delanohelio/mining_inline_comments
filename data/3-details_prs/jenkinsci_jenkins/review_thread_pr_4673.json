{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NzM3MTM5", "number": 4673, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMTowMzowNVrOD1Odug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxODoyNDo0NVrOD-s9FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3MTM4MTA2OnYy", "diffSide": "RIGHT", "path": "cli/src/main/java/hudson/cli/CLIConnectionFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMTowMzowNlrOGKjj3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNjozODowOFrOGKxl9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMTU2Ng==", "bodyText": "Is it possible that the bearer token here is empty ?", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r413721566", "createdAt": "2020-04-23T11:03:06Z", "author": {"login": "sladyn98"}, "path": "cli/src/main/java/hudson/cli/CLIConnectionFactory.java", "diffHunk": "@@ -36,4 +36,19 @@ public CLIConnectionFactory basicAuth(String userInfo) {\n         return authorization(\"Basic \" + Base64.getEncoder().encodeToString(userInfo.getBytes()));\n     }\n \n+    /**\n+     * Convenience method to call {@link #authorization} with the HTTP bearer authentication.\n+     * Cf. {@code BasicHeaderApiTokenAuthenticator}.\n+     */\n+    public CLIConnectionFactory bearerAuth(String bearerToken) {\n+        return authorization(\"Bearer \" + bearerToken);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df34c19eac41125ee65b7976cd4f496f7e2b39d6"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk1MTQ3OA==", "bodyText": "From my understanding of CLI class, it can be an empty string but not null -- follows the semantics of basicAuth", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r413951478", "createdAt": "2020-04-23T16:38:08Z", "author": {"login": "sorend"}, "path": "cli/src/main/java/hudson/cli/CLIConnectionFactory.java", "diffHunk": "@@ -36,4 +36,19 @@ public CLIConnectionFactory basicAuth(String userInfo) {\n         return authorization(\"Basic \" + Base64.getEncoder().encodeToString(userInfo.getBytes()));\n     }\n \n+    /**\n+     * Convenience method to call {@link #authorization} with the HTTP bearer authentication.\n+     * Cf. {@code BasicHeaderApiTokenAuthenticator}.\n+     */\n+    public CLIConnectionFactory bearerAuth(String bearerToken) {\n+        return authorization(\"Bearer \" + bearerToken);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMTU2Ng=="}, "originalCommit": {"oid": "df34c19eac41125ee65b7976cd4f496f7e2b39d6"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3MTM4NTI5OnYy", "diffSide": "RIGHT", "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMTowNDoxN1rOGKjmaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMTowNDoxN1rOGKjmaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMjIxNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                CLIConnectionFactory sut;\n          \n          \n            \n                CLIConnectionFactory cliFactory;", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r413722216", "createdAt": "2020-04-23T11:04:17Z", "author": {"login": "sladyn98"}, "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package hudson.cli;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+class CLIConnectionFactoryTest {\n+\n+    CLIConnectionFactory sut;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df34c19eac41125ee65b7976cd4f496f7e2b39d6"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3MTM4NzIyOnYy", "diffSide": "RIGHT", "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMTowNDo1MFrOGKjnhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQwNzo0NTo1MlrOGPhRZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMjUwMA==", "bodyText": "Would it be better if we also include  an Empty Bearer Token test ?", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r413722500", "createdAt": "2020-04-23T11:04:50Z", "author": {"login": "sladyn98"}, "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package hudson.cli;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+class CLIConnectionFactoryTest {\n+\n+    CLIConnectionFactory sut;\n+\n+    @BeforeEach\n+    void setUp() {\n+        sut = new CLIConnectionFactory();\n+    }\n+\n+    @Test\n+    void testBearerFromToken() {\n+        Assert.assertEquals(\"Bearer some-token\", sut.of(\"some-token\").authorization);\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df34c19eac41125ee65b7976cd4f496f7e2b39d6"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk1MjM2NA==", "bodyText": "I can add the test, but the cli will behave in the same was as if empty auth is passed to basicAuth, semantics are the same. Suggest not to implement test, but open to your suggestion :-)", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r413952364", "createdAt": "2020-04-23T16:39:25Z", "author": {"login": "sorend"}, "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package hudson.cli;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+class CLIConnectionFactoryTest {\n+\n+    CLIConnectionFactory sut;\n+\n+    @BeforeEach\n+    void setUp() {\n+        sut = new CLIConnectionFactory();\n+    }\n+\n+    @Test\n+    void testBearerFromToken() {\n+        Assert.assertEquals(\"Bearer some-token\", sut.of(\"some-token\").authorization);\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMjUwMA=="}, "originalCommit": {"oid": "df34c19eac41125ee65b7976cd4f496f7e2b39d6"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyNjk0OA==", "bodyText": "Okay, I do not have a deep understanding of basicAuth here, if I understand correctly if empty token is passed it will be handled normally and therefore we do not need to test it. Might need some additional review\nCC @daniel-beck", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r418926948", "createdAt": "2020-05-02T07:45:52Z", "author": {"login": "sladyn98"}, "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package hudson.cli;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+class CLIConnectionFactoryTest {\n+\n+    CLIConnectionFactory sut;\n+\n+    @BeforeEach\n+    void setUp() {\n+        sut = new CLIConnectionFactory();\n+    }\n+\n+    @Test\n+    void testBearerFromToken() {\n+        Assert.assertEquals(\"Bearer some-token\", sut.of(\"some-token\").authorization);\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMjUwMA=="}, "originalCommit": {"oid": "df34c19eac41125ee65b7976cd4f496f7e2b39d6"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMDExNDMzOnYy", "diffSide": "RIGHT", "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwOTozMjo0NVrOGOhZLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQxMjo1NToyMlrOGPI_0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg4MDM2Nw==", "bodyText": "This is not empty when the test name suggests so?", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r417880367", "createdAt": "2020-04-30T09:32:45Z", "author": {"login": "varyvol"}, "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package hudson.cli;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+class CLIConnectionFactoryTest {\n+\n+    CLIConnectionFactory cliFactory;\n+\n+    @BeforeEach\n+    void setUp() {\n+        cliFactory = new CLIConnectionFactory();\n+    }\n+\n+    @Test\n+    void testBearerFromToken() {\n+        Assert.assertEquals(\"Bearer some-token\", cliFactory.of(\"some-token\").authorization);\n+    }\n+\n+    @Test\n+    void testBearerFromEmptyToken() {\n+        Assert.assertEquals(\"Bearer some-token\", cliFactory.of(\"some-token\").authorization);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ecafd520a7df7c7b0e0cd8c2f5fa0faaf08c42a"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUyOTIzMw==", "bodyText": "Sorry a missing cleanup.", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r418529233", "createdAt": "2020-05-01T12:55:22Z", "author": {"login": "sorend"}, "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package hudson.cli;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+class CLIConnectionFactoryTest {\n+\n+    CLIConnectionFactory cliFactory;\n+\n+    @BeforeEach\n+    void setUp() {\n+        cliFactory = new CLIConnectionFactory();\n+    }\n+\n+    @Test\n+    void testBearerFromToken() {\n+        Assert.assertEquals(\"Bearer some-token\", cliFactory.of(\"some-token\").authorization);\n+    }\n+\n+    @Test\n+    void testBearerFromEmptyToken() {\n+        Assert.assertEquals(\"Bearer some-token\", cliFactory.of(\"some-token\").authorization);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg4MDM2Nw=="}, "originalCommit": {"oid": "1ecafd520a7df7c7b0e0cd8c2f5fa0faaf08c42a"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwNzA5MzcwOnYy", "diffSide": "RIGHT", "path": "cli/src/main/resources/hudson/cli/client/Messages.properties", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQwNzo0MzoyOFrOGPhQZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQwODoxMDoyNVrOGPhZ8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyNjY5NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              \\                     : specify username and either password or API token (or load from them both from a file);\\n\\\n          \n          \n            \n              \\                     : specify username and  password or API token (or load from them both from a file);\\n\\", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r418926695", "createdAt": "2020-05-02T07:43:28Z", "author": {"login": "sladyn98"}, "path": "cli/src/main/resources/hudson/cli/client/Messages.properties", "diffHunk": "@@ -11,10 +11,12 @@ CLI.Usage=Jenkins CLI\\n\\\n   \\ -user               : specify user (for use with -ssh)\\n\\\n   \\ -strictHostKey      : request strict host key checking (for use with -ssh)\\n\\\n   \\ -logger FINE        : enable detailed logging from the client\\n\\\n-  \\ -auth [ USER:SECRET | @FILE ] : specify username and either password or API token (or load from them both from a file);\\n\\\n-  \\                                 for use with -http.\\n\\\n-  \\                                 Passing credentials by file is recommended.\\n\\\n-  \\                                 See https://jenkins.io/redirect/cli-http-connection-mode for more info and options.\\n\\\n+  \\ -auth [ USER:SECRET | TOKEN | @FILE ]\\n\\\n+  \\                     : specify username and either password or API token (or load from them both from a file);\\n\\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c56db437c09d9e80c55da7e98b3fea36193a62"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyNzYxMw==", "bodyText": "I think this changes the meaning. I added the next line about bearer token. This is about that you can provide Jenkins API token or Jenkins password, so I think it should be left as is.", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r418927613", "createdAt": "2020-05-02T07:53:45Z", "author": {"login": "sorend"}, "path": "cli/src/main/resources/hudson/cli/client/Messages.properties", "diffHunk": "@@ -11,10 +11,12 @@ CLI.Usage=Jenkins CLI\\n\\\n   \\ -user               : specify user (for use with -ssh)\\n\\\n   \\ -strictHostKey      : request strict host key checking (for use with -ssh)\\n\\\n   \\ -logger FINE        : enable detailed logging from the client\\n\\\n-  \\ -auth [ USER:SECRET | @FILE ] : specify username and either password or API token (or load from them both from a file);\\n\\\n-  \\                                 for use with -http.\\n\\\n-  \\                                 Passing credentials by file is recommended.\\n\\\n-  \\                                 See https://jenkins.io/redirect/cli-http-connection-mode for more info and options.\\n\\\n+  \\ -auth [ USER:SECRET | TOKEN | @FILE ]\\n\\\n+  \\                     : specify username and either password or API token (or load from them both from a file);\\n\\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyNjY5NQ=="}, "originalCommit": {"oid": "21c56db437c09d9e80c55da7e98b3fea36193a62"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyOTEzOA==", "bodyText": "Okay thanks \ud83d\udc4d", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r418929138", "createdAt": "2020-05-02T08:10:25Z", "author": {"login": "sladyn98"}, "path": "cli/src/main/resources/hudson/cli/client/Messages.properties", "diffHunk": "@@ -11,10 +11,12 @@ CLI.Usage=Jenkins CLI\\n\\\n   \\ -user               : specify user (for use with -ssh)\\n\\\n   \\ -strictHostKey      : request strict host key checking (for use with -ssh)\\n\\\n   \\ -logger FINE        : enable detailed logging from the client\\n\\\n-  \\ -auth [ USER:SECRET | @FILE ] : specify username and either password or API token (or load from them both from a file);\\n\\\n-  \\                                 for use with -http.\\n\\\n-  \\                                 Passing credentials by file is recommended.\\n\\\n-  \\                                 See https://jenkins.io/redirect/cli-http-connection-mode for more info and options.\\n\\\n+  \\ -auth [ USER:SECRET | TOKEN | @FILE ]\\n\\\n+  \\                     : specify username and either password or API token (or load from them both from a file);\\n\\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyNjY5NQ=="}, "originalCommit": {"oid": "21c56db437c09d9e80c55da7e98b3fea36193a62"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MDc0ODM3OnYy", "diffSide": "RIGHT", "path": "cli/src/main/resources/hudson/cli/client/Messages.properties", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxODoyNDo0NVrOGY94BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwNjowNToxN1rOGZLpTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgzMjc3Mw==", "bodyText": "it is exclusive to -auth. Can we check it and say it explicitly on the help. Also -bearer is for -http I guess, and passing it with a file also applies.\nSorry for being picky, I was about to approve when you said it cannot have a \ud83d\ude04 but with the new way, I believe is worth to document it well.", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r428832773", "createdAt": "2020-05-21T18:24:45Z", "author": {"login": "MRamonLeon"}, "path": "cli/src/main/resources/hudson/cli/client/Messages.properties", "diffHunk": "@@ -15,6 +15,7 @@ CLI.Usage=Jenkins CLI\\n\\\n   \\                                 for use with -http.\\n\\\n   \\                                 Passing credentials by file is recommended.\\n\\\n   \\                                 See https://jenkins.io/redirect/cli-http-connection-mode for more info and options.\\n\\\n+  \\ -bearer [ TOKEN | @FILE ]     : specify authentication using a bearer token (or load the token from file)\\n\\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eef34bb1e99cbc48551c1ff7a620e9a0836d1490"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1ODM4Mw==", "bodyText": "@MRamonLeon Thank you for the review \ud83d\udc4d  I have updated the message and added a warning when both are used (this is how -user and -auth exclusivity was handled already)", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r429058383", "createdAt": "2020-05-22T06:05:17Z", "author": {"login": "sorend"}, "path": "cli/src/main/resources/hudson/cli/client/Messages.properties", "diffHunk": "@@ -15,6 +15,7 @@ CLI.Usage=Jenkins CLI\\n\\\n   \\                                 for use with -http.\\n\\\n   \\                                 Passing credentials by file is recommended.\\n\\\n   \\                                 See https://jenkins.io/redirect/cli-http-connection-mode for more info and options.\\n\\\n+  \\ -bearer [ TOKEN | @FILE ]     : specify authentication using a bearer token (or load the token from file)\\n\\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgzMjc3Mw=="}, "originalCommit": {"oid": "eef34bb1e99cbc48551c1ff7a620e9a0836d1490"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 490, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}