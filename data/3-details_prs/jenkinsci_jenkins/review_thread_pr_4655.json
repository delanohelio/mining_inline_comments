{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzNDMzMzg0", "number": 4655, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo1NDo1MlrODx1k8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMDozNDowNVrODycP9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTg0NjI0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo1NDo1MlrOGFiYQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo1NDo1MlrOGFiYQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1OTMyOA==", "bodyText": "Not strictly necessary, but seemed better to be safe than sorry in case someone makes a change that affects the auto-computed serialVersionUID in the future.", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r408459328", "createdAt": "2020-04-14T21:54:52Z", "author": {"login": "dwnusbaum"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTg0Nzg1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo1NToyNlrOGFiZOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxMzo0MDoyNlrOGF6Mzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1OTU3OQ==", "bodyText": "Not sure about naming, maybe EXCEPTIONS_LIMIT or MAX_REPORTED_EXCEPTIONS would be better. Same with the limit, maybe 15 or 20 would be a better default?", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r408459579", "createdAt": "2020-04-14T21:55:26Z", "author": {"login": "dwnusbaum"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.\n+     * For example, if the number of exceptions was unlimited, a call to\n+     * {@code Util.deleteRecursive} could fail with a\n+     * {@code CompositeIOException} that contains an exception for every\n+     * single file inside of the directory.\n+     */\n+    public static final int EXCEPTION_LIMIT = 10;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MzUzMg==", "bodyText": "Unclear why this is public. And if it's final, Groovy cannot change it.", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r408463532", "createdAt": "2020-04-14T22:04:36Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.\n+     * For example, if the number of exceptions was unlimited, a call to\n+     * {@code Util.deleteRecursive} could fail with a\n+     * {@code CompositeIOException} that contains an exception for every\n+     * single file inside of the directory.\n+     */\n+    public static final int EXCEPTION_LIMIT = 10;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1OTU3OQ=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODUyMDI1NA==", "bodyText": "I think its because its used in tests", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r408520254", "createdAt": "2020-04-15T00:58:06Z", "author": {"login": "res0nance"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.\n+     * For example, if the number of exceptions was unlimited, a call to\n+     * {@code Util.deleteRecursive} could fail with a\n+     * {@code CompositeIOException} that contains an exception for every\n+     * single file inside of the directory.\n+     */\n+    public static final int EXCEPTION_LIMIT = 10;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1OTU3OQ=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg0OTYxNA==", "bodyText": "Yes, it is public because it is used in tests. The class itself is annotated with @Restricted(NoExternalUse.class). I made it final because it does not seem to me like something that would be useful for users to change, but like I mentioned in the PR description, if anyone thinks it is important to make it configurable I can make it non-final and allow it to be initialized via system property.", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r408849614", "createdAt": "2020-04-15T13:40:26Z", "author": {"login": "dwnusbaum"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.\n+     * For example, if the number of exceptions was unlimited, a call to\n+     * {@code Util.deleteRecursive} could fail with a\n+     * {@code CompositeIOException} that contains an exception for every\n+     * single file inside of the directory.\n+     */\n+    public static final int EXCEPTION_LIMIT = 10;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ1OTU3OQ=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTg1MDc5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "isResolved": false, "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo1NjozNlrOGFibLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMTowMzo1NFrOGG3E0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MDA3Ng==", "bodyText": "I think that it is important to show users that there were more errors that are not being reported, but IDK if this is the best way to do it. We could also append a message to the message of the CompositeIOException itself.", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r408460076", "createdAt": "2020-04-14T21:56:36Z", "author": {"login": "dwnusbaum"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.\n+     * For example, if the number of exceptions was unlimited, a call to\n+     * {@code Util.deleteRecursive} could fail with a\n+     * {@code CompositeIOException} that contains an exception for every\n+     * single file inside of the directory.\n+     */\n+    public static final int EXCEPTION_LIMIT = 10;\n+\n     private final List<IOException> exceptions;\n \n+    /**\n+     * Construct a new {@code CompositeIOException} where the given list of\n+     * exceptions are added as suppressed exceptions to the new exception.\n+     * <p>\n+     * If the given list of exceptions is longer than {@link #EXCEPTION_LIMIT},\n+     * the list will be truncated to that length, and an exception whose message\n+     * contains the number of exceptions that were removed will be added as a\n+     * suppressed exception to the new exception.\n+     */\n     public CompositeIOException(String message, @NonNull List<IOException> exceptions) {\n         super(message);\n-        this.exceptions = exceptions;\n-        exceptions.forEach(this::addSuppressed);\n+        if (exceptions.size() > EXCEPTION_LIMIT) {\n+            this.exceptions = new ArrayList<>(exceptions.subList(0, EXCEPTION_LIMIT));\n+            this.exceptions.add(new ExceptionLimitReached(exceptions.size() - EXCEPTION_LIMIT));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA2NDY4Mg==", "bodyText": "better to add to the message imo, seems weird to have another object for this", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r409064682", "createdAt": "2020-04-15T18:57:12Z", "author": {"login": "timja"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.\n+     * For example, if the number of exceptions was unlimited, a call to\n+     * {@code Util.deleteRecursive} could fail with a\n+     * {@code CompositeIOException} that contains an exception for every\n+     * single file inside of the directory.\n+     */\n+    public static final int EXCEPTION_LIMIT = 10;\n+\n     private final List<IOException> exceptions;\n \n+    /**\n+     * Construct a new {@code CompositeIOException} where the given list of\n+     * exceptions are added as suppressed exceptions to the new exception.\n+     * <p>\n+     * If the given list of exceptions is longer than {@link #EXCEPTION_LIMIT},\n+     * the list will be truncated to that length, and an exception whose message\n+     * contains the number of exceptions that were removed will be added as a\n+     * suppressed exception to the new exception.\n+     */\n     public CompositeIOException(String message, @NonNull List<IOException> exceptions) {\n         super(message);\n-        this.exceptions = exceptions;\n-        exceptions.forEach(this::addSuppressed);\n+        if (exceptions.size() > EXCEPTION_LIMIT) {\n+            this.exceptions = new ArrayList<>(exceptions.subList(0, EXCEPTION_LIMIT));\n+            this.exceptions.add(new ExceptionLimitReached(exceptions.size() - EXCEPTION_LIMIT));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MDA3Ng=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTExNjk3Nw==", "bodyText": "Yeah, my thought was just that it seems kind of random to have the outer error message include the number of exceptions that were removed, and this way you only see that there are unreported errors in contexts were you are looking at a full stack trace, which seems like the only time you would care, but maybe that doesn't really matter.\nAny thoughts on the phrasing of the message? Maybe something like \"... ($EXCEPTION_LIMIT of $TOTAL suppressed exceptions were recorded)\"?", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r409116977", "createdAt": "2020-04-15T20:34:03Z", "author": {"login": "dwnusbaum"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.\n+     * For example, if the number of exceptions was unlimited, a call to\n+     * {@code Util.deleteRecursive} could fail with a\n+     * {@code CompositeIOException} that contains an exception for every\n+     * single file inside of the directory.\n+     */\n+    public static final int EXCEPTION_LIMIT = 10;\n+\n     private final List<IOException> exceptions;\n \n+    /**\n+     * Construct a new {@code CompositeIOException} where the given list of\n+     * exceptions are added as suppressed exceptions to the new exception.\n+     * <p>\n+     * If the given list of exceptions is longer than {@link #EXCEPTION_LIMIT},\n+     * the list will be truncated to that length, and an exception whose message\n+     * contains the number of exceptions that were removed will be added as a\n+     * suppressed exception to the new exception.\n+     */\n     public CompositeIOException(String message, @NonNull List<IOException> exceptions) {\n         super(message);\n-        this.exceptions = exceptions;\n-        exceptions.forEach(this::addSuppressed);\n+        if (exceptions.size() > EXCEPTION_LIMIT) {\n+            this.exceptions = new ArrayList<>(exceptions.subList(0, EXCEPTION_LIMIT));\n+            this.exceptions.add(new ExceptionLimitReached(exceptions.size() - EXCEPTION_LIMIT));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MDA3Ng=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTExODA4OA==", "bodyText": "what about?\n\nSuppressed <#> exceptions", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r409118088", "createdAt": "2020-04-15T20:36:26Z", "author": {"login": "timja"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.\n+     * For example, if the number of exceptions was unlimited, a call to\n+     * {@code Util.deleteRecursive} could fail with a\n+     * {@code CompositeIOException} that contains an exception for every\n+     * single file inside of the directory.\n+     */\n+    public static final int EXCEPTION_LIMIT = 10;\n+\n     private final List<IOException> exceptions;\n \n+    /**\n+     * Construct a new {@code CompositeIOException} where the given list of\n+     * exceptions are added as suppressed exceptions to the new exception.\n+     * <p>\n+     * If the given list of exceptions is longer than {@link #EXCEPTION_LIMIT},\n+     * the list will be truncated to that length, and an exception whose message\n+     * contains the number of exceptions that were removed will be added as a\n+     * suppressed exception to the new exception.\n+     */\n     public CompositeIOException(String message, @NonNull List<IOException> exceptions) {\n         super(message);\n-        this.exceptions = exceptions;\n-        exceptions.forEach(this::addSuppressed);\n+        if (exceptions.size() > EXCEPTION_LIMIT) {\n+            this.exceptions = new ArrayList<>(exceptions.subList(0, EXCEPTION_LIMIT));\n+            this.exceptions.add(new ExceptionLimitReached(exceptions.size() - EXCEPTION_LIMIT));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MDA3Ng=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEyMTE1MA==", "bodyText": "Would that number be the total number of exceptions passed to CompositeIOException (of which EXCEPTION_LIMIT are recorded as suppressed exceptions), or the number that were removed?", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r409121150", "createdAt": "2020-04-15T20:42:16Z", "author": {"login": "dwnusbaum"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.\n+     * For example, if the number of exceptions was unlimited, a call to\n+     * {@code Util.deleteRecursive} could fail with a\n+     * {@code CompositeIOException} that contains an exception for every\n+     * single file inside of the directory.\n+     */\n+    public static final int EXCEPTION_LIMIT = 10;\n+\n     private final List<IOException> exceptions;\n \n+    /**\n+     * Construct a new {@code CompositeIOException} where the given list of\n+     * exceptions are added as suppressed exceptions to the new exception.\n+     * <p>\n+     * If the given list of exceptions is longer than {@link #EXCEPTION_LIMIT},\n+     * the list will be truncated to that length, and an exception whose message\n+     * contains the number of exceptions that were removed will be added as a\n+     * suppressed exception to the new exception.\n+     */\n     public CompositeIOException(String message, @NonNull List<IOException> exceptions) {\n         super(message);\n-        this.exceptions = exceptions;\n-        exceptions.forEach(this::addSuppressed);\n+        if (exceptions.size() > EXCEPTION_LIMIT) {\n+            this.exceptions = new ArrayList<>(exceptions.subList(0, EXCEPTION_LIMIT));\n+            this.exceptions.add(new ExceptionLimitReached(exceptions.size() - EXCEPTION_LIMIT));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MDA3Ng=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEyMzkxNQ==", "bodyText": "I would show the # of exceptions that the stacktrace has been discarded for total - exception limit if > 0", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r409123915", "createdAt": "2020-04-15T20:47:17Z", "author": {"login": "timja"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.\n+     * For example, if the number of exceptions was unlimited, a call to\n+     * {@code Util.deleteRecursive} could fail with a\n+     * {@code CompositeIOException} that contains an exception for every\n+     * single file inside of the directory.\n+     */\n+    public static final int EXCEPTION_LIMIT = 10;\n+\n     private final List<IOException> exceptions;\n \n+    /**\n+     * Construct a new {@code CompositeIOException} where the given list of\n+     * exceptions are added as suppressed exceptions to the new exception.\n+     * <p>\n+     * If the given list of exceptions is longer than {@link #EXCEPTION_LIMIT},\n+     * the list will be truncated to that length, and an exception whose message\n+     * contains the number of exceptions that were removed will be added as a\n+     * suppressed exception to the new exception.\n+     */\n     public CompositeIOException(String message, @NonNull List<IOException> exceptions) {\n         super(message);\n-        this.exceptions = exceptions;\n-        exceptions.forEach(this::addSuppressed);\n+        if (exceptions.size() > EXCEPTION_LIMIT) {\n+            this.exceptions = new ArrayList<>(exceptions.subList(0, EXCEPTION_LIMIT));\n+            this.exceptions.add(new ExceptionLimitReached(exceptions.size() - EXCEPTION_LIMIT));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MDA3Ng=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEyNTczOA==", "bodyText": "How about using \"discarded\" to avoid ambiguity with what \"suppressed\" refers to?\n\nDiscarded (TOTAL - EXCEPTION_LIMIT) additional exceptions.", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r409125738", "createdAt": "2020-04-15T20:50:29Z", "author": {"login": "dwnusbaum"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.\n+     * For example, if the number of exceptions was unlimited, a call to\n+     * {@code Util.deleteRecursive} could fail with a\n+     * {@code CompositeIOException} that contains an exception for every\n+     * single file inside of the directory.\n+     */\n+    public static final int EXCEPTION_LIMIT = 10;\n+\n     private final List<IOException> exceptions;\n \n+    /**\n+     * Construct a new {@code CompositeIOException} where the given list of\n+     * exceptions are added as suppressed exceptions to the new exception.\n+     * <p>\n+     * If the given list of exceptions is longer than {@link #EXCEPTION_LIMIT},\n+     * the list will be truncated to that length, and an exception whose message\n+     * contains the number of exceptions that were removed will be added as a\n+     * suppressed exception to the new exception.\n+     */\n     public CompositeIOException(String message, @NonNull List<IOException> exceptions) {\n         super(message);\n-        this.exceptions = exceptions;\n-        exceptions.forEach(this::addSuppressed);\n+        if (exceptions.size() > EXCEPTION_LIMIT) {\n+            this.exceptions = new ArrayList<>(exceptions.subList(0, EXCEPTION_LIMIT));\n+            this.exceptions.add(new ExceptionLimitReached(exceptions.size() - EXCEPTION_LIMIT));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MDA3Ng=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTEyNzA2NA==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r409127064", "createdAt": "2020-04-15T20:52:57Z", "author": {"login": "timja"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.\n+     * For example, if the number of exceptions was unlimited, a call to\n+     * {@code Util.deleteRecursive} could fail with a\n+     * {@code CompositeIOException} that contains an exception for every\n+     * single file inside of the directory.\n+     */\n+    public static final int EXCEPTION_LIMIT = 10;\n+\n     private final List<IOException> exceptions;\n \n+    /**\n+     * Construct a new {@code CompositeIOException} where the given list of\n+     * exceptions are added as suppressed exceptions to the new exception.\n+     * <p>\n+     * If the given list of exceptions is longer than {@link #EXCEPTION_LIMIT},\n+     * the list will be truncated to that length, and an exception whose message\n+     * contains the number of exceptions that were removed will be added as a\n+     * suppressed exception to the new exception.\n+     */\n     public CompositeIOException(String message, @NonNull List<IOException> exceptions) {\n         super(message);\n-        this.exceptions = exceptions;\n-        exceptions.forEach(this::addSuppressed);\n+        if (exceptions.size() > EXCEPTION_LIMIT) {\n+            this.exceptions = new ArrayList<>(exceptions.subList(0, EXCEPTION_LIMIT));\n+            this.exceptions.add(new ExceptionLimitReached(exceptions.size() - EXCEPTION_LIMIT));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MDA3Ng=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ1NDU5MA==", "bodyText": "Seems reasonable!", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r409454590", "createdAt": "2020-04-16T10:34:46Z", "author": {"login": "varyvol"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.\n+     * For example, if the number of exceptions was unlimited, a call to\n+     * {@code Util.deleteRecursive} could fail with a\n+     * {@code CompositeIOException} that contains an exception for every\n+     * single file inside of the directory.\n+     */\n+    public static final int EXCEPTION_LIMIT = 10;\n+\n     private final List<IOException> exceptions;\n \n+    /**\n+     * Construct a new {@code CompositeIOException} where the given list of\n+     * exceptions are added as suppressed exceptions to the new exception.\n+     * <p>\n+     * If the given list of exceptions is longer than {@link #EXCEPTION_LIMIT},\n+     * the list will be truncated to that length, and an exception whose message\n+     * contains the number of exceptions that were removed will be added as a\n+     * suppressed exception to the new exception.\n+     */\n     public CompositeIOException(String message, @NonNull List<IOException> exceptions) {\n         super(message);\n-        this.exceptions = exceptions;\n-        exceptions.forEach(this::addSuppressed);\n+        if (exceptions.size() > EXCEPTION_LIMIT) {\n+            this.exceptions = new ArrayList<>(exceptions.subList(0, EXCEPTION_LIMIT));\n+            this.exceptions.add(new ExceptionLimitReached(exceptions.size() - EXCEPTION_LIMIT));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MDA3Ng=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg0Njk5NQ==", "bodyText": "I changed to modifying the outer exception's message in 341ffa9.", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r409846995", "createdAt": "2020-04-16T21:03:54Z", "author": {"login": "dwnusbaum"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.\n+     * For example, if the number of exceptions was unlimited, a call to\n+     * {@code Util.deleteRecursive} could fail with a\n+     * {@code CompositeIOException} that contains an exception for every\n+     * single file inside of the directory.\n+     */\n+    public static final int EXCEPTION_LIMIT = 10;\n+\n     private final List<IOException> exceptions;\n \n+    /**\n+     * Construct a new {@code CompositeIOException} where the given list of\n+     * exceptions are added as suppressed exceptions to the new exception.\n+     * <p>\n+     * If the given list of exceptions is longer than {@link #EXCEPTION_LIMIT},\n+     * the list will be truncated to that length, and an exception whose message\n+     * contains the number of exceptions that were removed will be added as a\n+     * suppressed exception to the new exception.\n+     */\n     public CompositeIOException(String message, @NonNull List<IOException> exceptions) {\n         super(message);\n-        this.exceptions = exceptions;\n-        exceptions.forEach(this::addSuppressed);\n+        if (exceptions.size() > EXCEPTION_LIMIT) {\n+            this.exceptions = new ArrayList<>(exceptions.subList(0, EXCEPTION_LIMIT));\n+            this.exceptions.add(new ExceptionLimitReached(exceptions.size() - EXCEPTION_LIMIT));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MDA3Ng=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTg1MjE4OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/jenkins/util/io/PathRemoverTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo1NzowNVrOGFib_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo1NzowNVrOGFib_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MDI4NQ==", "bodyText": "Not sure how to test this on other platforms without a ton of mocking, which I wanted to avoid.", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r408460285", "createdAt": "2020-04-14T21:57:05Z", "author": {"login": "dwnusbaum"}, "path": "core/src/test/java/jenkins/util/io/PathRemoverTest.java", "diffHunk": "@@ -418,6 +424,34 @@ public void testForceRemoveRecursive_ParentIsSymbolicLink() throws IOException {\n         assertFalse(d1.exists());\n     }\n \n+    @Test\n+    @Issue(\"JENKINS-55448\")\n+    public void testForceRemoveRecursive_TruncatesNumberOfExceptions() throws IOException {\n+        assumeTrue(Functions.isWindows());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTg1OTQwOnYy", "diffSide": "LEFT", "path": "core/src/test/java/jenkins/util/io/PathRemoverTest.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMTo1OTozMlrOGFigew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNToxNDowM1rOGF-msg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MTQzNQ==", "bodyText": "Now that org.junit.Assert.assertThat is deprecated, we have to import all of the methods individually so that we can import and use org.hamcrest.MatcherAssert.assertThat to avoid deprecation warnings without having to write that out fully-qualified every time.", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r408461435", "createdAt": "2020-04-14T21:59:32Z", "author": {"login": "dwnusbaum"}, "path": "core/src/test/java/jenkins/util/io/PathRemoverTest.java", "diffHunk": "@@ -51,10 +51,16 @@\n import java.util.concurrent.atomic.AtomicBoolean;\n import java.util.concurrent.atomic.AtomicReference;\n \n+import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.allOf;\n+import static org.hamcrest.Matchers.arrayWithSize;\n import static org.hamcrest.Matchers.containsString;\n+import static org.hamcrest.Matchers.equalTo;\n import static org.hamcrest.Matchers.hasItem;\n-import static org.junit.Assert.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4MTg2Mw==", "bodyText": "Wildcard import of org.hamcrest.MatcherAssert.* has been the preferred technique for me thus far.  That prepares for JUnit 5 (a long ways away for us because we need JenkinsRule).\nCan you help me understand why the wildcard import of org.hamcrest.MatcherAssert.* won't work in this case?", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r408481863", "createdAt": "2020-04-14T22:52:36Z", "author": {"login": "MarkEWaite"}, "path": "core/src/test/java/jenkins/util/io/PathRemoverTest.java", "diffHunk": "@@ -51,10 +51,16 @@\n import java.util.concurrent.atomic.AtomicBoolean;\n import java.util.concurrent.atomic.AtomicReference;\n \n+import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.allOf;\n+import static org.hamcrest.Matchers.arrayWithSize;\n import static org.hamcrest.Matchers.containsString;\n+import static org.hamcrest.Matchers.equalTo;\n import static org.hamcrest.Matchers.hasItem;\n-import static org.junit.Assert.*;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MTQzNQ=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg1NTU3Ng==", "bodyText": "It looks like MatcherAssert  only provides assertThat, but existing tests in this file are using assertTrue, assertFalse, etc. from org.junit.Assert, so we still need to pull in those methods somehow. org.junit.Assert also provides assertThat, but that method is deprecated, so we can't do a wildcard import of org.junit.Assert.* if we want to use assertThat from MatcherAssert without having to fully-qualify it at every call site.\nWe could convert all of the tests in this file to use assertThat so we could just import org.hamcrest.MatcherAssert.* and not anything in the org.junit.Assert package, but that seems like something best left for a different PR.", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r408855576", "createdAt": "2020-04-15T13:48:21Z", "author": {"login": "dwnusbaum"}, "path": "core/src/test/java/jenkins/util/io/PathRemoverTest.java", "diffHunk": "@@ -51,10 +51,16 @@\n import java.util.concurrent.atomic.AtomicBoolean;\n import java.util.concurrent.atomic.AtomicReference;\n \n+import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.allOf;\n+import static org.hamcrest.Matchers.arrayWithSize;\n import static org.hamcrest.Matchers.containsString;\n+import static org.hamcrest.Matchers.equalTo;\n import static org.hamcrest.Matchers.hasItem;\n-import static org.junit.Assert.*;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MTQzNQ=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODkyMTc3OA==", "bodyText": "Very good point.  I've used the deprecation of org.junit.Assert assertions as a good excuse to replace assertTrue and assertFalse with assertThat.  The resulting failure messages tend to be better with assertThat than they were with assertFalse and assertTrue..\nAgreed wholeheartedly that changing the assertions in tests is for a separate PR, unrelated to this PR.", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r408921778", "createdAt": "2020-04-15T15:14:03Z", "author": {"login": "MarkEWaite"}, "path": "core/src/test/java/jenkins/util/io/PathRemoverTest.java", "diffHunk": "@@ -51,10 +51,16 @@\n import java.util.concurrent.atomic.AtomicBoolean;\n import java.util.concurrent.atomic.AtomicReference;\n \n+import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.allOf;\n+import static org.hamcrest.Matchers.arrayWithSize;\n import static org.hamcrest.Matchers.containsString;\n+import static org.hamcrest.Matchers.equalTo;\n import static org.hamcrest.Matchers.hasItem;\n-import static org.junit.Assert.*;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ2MTQzNQ=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzODQ1NTI4OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/jenkins/util/io/PathRemoverTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDowMTowMlrOGF7Kng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDowMTowMlrOGF7Kng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2NTQzOA==", "bodyText": "Notably in this case, the suppressed exceptions in the outer CompositeIOException are actually instances of CompositeIOException themselves because of the fallback behavior in PathRemover.removeOrMakeRemovableThenRemove, each with two suppressed instances of FileSystemException. That means that the worst-case number of exceptions in a single CompositeIOException for the deletion operations in PathRemover with this patch is actually CompositeIOException.EXCEPTION_LIMIT * 3.", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r408865438", "createdAt": "2020-04-15T14:01:02Z", "author": {"login": "dwnusbaum"}, "path": "core/src/test/java/jenkins/util/io/PathRemoverTest.java", "diffHunk": "@@ -418,6 +424,34 @@ public void testForceRemoveRecursive_ParentIsSymbolicLink() throws IOException {\n         assertFalse(d1.exists());\n     }\n \n+    @Test\n+    @Issue(\"JENKINS-55448\")\n+    public void testForceRemoveRecursive_TruncatesNumberOfExceptions() throws IOException {\n+        assumeTrue(Functions.isWindows());\n+        final int maxExceptions = CompositeIOException.EXCEPTION_LIMIT;\n+        final int lockedFiles = maxExceptions + 5;\n+        final int totalFiles = lockedFiles + 5;\n+        File dir = tmp.newFolder();\n+        File[] files = new File[totalFiles];\n+        for (int i = 0; i < totalFiles; i++) {\n+            files[i] = new File(dir, \"f\" + i);\n+        }\n+        touchWithFileName(files);\n+        for (int i = 0; i < lockedFiles; i++) {\n+            locker.acquireLock(files[i]);\n+        }\n+        try {\n+            PathRemover.newSimpleRemover().forceRemoveRecursive(dir.toPath());\n+            fail(\"Deletion should have failed\");\n+        } catch (CompositeIOException e) {\n+            assertThat(e.getSuppressed(), arrayWithSize(maxExceptions + 1));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MjE3Mzg0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMDozMTo1MlrOGGfA_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMTowNDowNFrOGG3FLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ1Mjc5OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * where a huge number of exceptions could lead to excessive memory usage.\n          \n          \n            \n                 * a huge number of exceptions could lead to excessive memory usage.", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r409452798", "createdAt": "2020-04-16T10:31:52Z", "author": {"login": "varyvol"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg0NzA4NQ==", "bodyText": "Fixed in 341ffa9, thanks!", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r409847085", "createdAt": "2020-04-16T21:04:04Z", "author": {"login": "dwnusbaum"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ1Mjc5OA=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU0MjE4MjI4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMDozNDowNVrOGGfGJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMTowNDoxNFrOGG3Fng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ1NDExNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * where a huge number of exceptions could lead to excessive memory usage.\n          \n          \n            \n                 * a huge number of exceptions could lead to excessive memory usage.", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r409454117", "createdAt": "2020-04-16T10:34:05Z", "author": {"login": "MRamonLeon"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg0NzE5OA==", "bodyText": "Fixed in 341ffa9, thanks!", "url": "https://github.com/jenkinsci/jenkins/pull/4655#discussion_r409847198", "createdAt": "2020-04-16T21:04:14Z", "author": {"login": "dwnusbaum"}, "path": "core/src/main/java/jenkins/util/io/CompositeIOException.java", "diffHunk": "@@ -30,19 +30,52 @@\n import edu.umd.cs.findbugs.annotations.NonNull;\n import java.io.IOException;\n import java.io.UncheckedIOException;\n+import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.List;\n \n @Restricted(NoExternalUse.class)\n public class CompositeIOException extends IOException {\n+    private static final long serialVersionUID = 121943141387608148L;\n+\n+    /**\n+     * The maximum number of exceptions that can be reported by a single\n+     * {@code CompositeIOException}.\n+     * <p>\n+     * The number of exceptions is limited to avoid pathological cases where\n+     * where a huge number of exceptions could lead to excessive memory usage.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ1NDExNw=="}, "originalCommit": {"oid": "acb2ff00de50f4e2ad7c9cfe5a9b5297aa64e8d7"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 472, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}