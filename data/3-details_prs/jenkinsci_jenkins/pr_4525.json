{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NTcxNzI0", "number": 4525, "title": "[JENKINS-55070, 59992, 60454, 61192] Correct symptom of missing instance", "bodyText": "See JENKINS-55070, JENKINS-59992, JENKINS-60454 and JENKINS-61192.\nFor a detailed explanation of the (suspected?) root cause, see this comment.\nThis PR only solves the reported symptom, not the root cause.\n\u26a0\ufe0f Any code called during a Jenkins restart cannot yet rely on Jenkins.get().\n\nProposed changelog entries\n\nPrevents one occurence of \"Jenkins.instance is missing\"\n\n\nProposed upgrade guidelines\nN/A\nSubmitter checklist\n\n JIRA issue is well described\n Changelog entries and upgrade guidelines are appropriate for the audience affected by the change (users or developer, depending on the change). Examples\n\nFill-in the Proposed changelog entries section only if there are breaking changes or other changes which may require extra steps from users during the upgrade\n\n\n[n/a] Appropriate autotests or explanation to why this change has no tests\n[n/a] For dependency updates: links to external changelogs and, if possible, full diffs\n\n\nDesired reviewers\n@mention\n\nMaintainer checklist\nBefore the changes are marked as ready-for-merge:\n\n There are at least 2 approvals for the pull request and no outstanding requests for change\n Conversations in the pull request are over OR it is explicit that a reviewer does not block the change\n Changelog entries in the PR title and/or Proposed changelog entries are correct\n Proper changelog labels are set so that the changelog can be generated automatically\n If the change needs additional upgrade steps from users, upgrade-guide-needed label is set and there is a Proposed upgrade guidelines section in the PR title. (example)\n If it would make sense to backport the change to LTS, a JIRA issue should exist and be labeled as lts-candidate", "createdAt": "2020-02-25T13:10:19Z", "url": "https://github.com/jenkinsci/jenkins/pull/4525", "merged": true, "mergeCommit": {"oid": "ae99586fd048b8f4cf7faa9cdf9e82ff5283abf9"}, "closed": true, "closedAt": "2020-03-01T06:25:00Z", "author": {"login": "Wadeck"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHx1YAAH2gAyMzc5NTcxNzI0OmZjM2E1MDUyNDVjZDBkN2ZjOGU0YTRmOTM3MjMzZDkyMDRjYjVmN2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIp0VkgFqTM2NjE4MDQ5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fc3a505245cd0d7fc8e4a4f937233d9204cb5f7c", "author": {"user": {"login": "Wadeck", "name": "Wadeck Follonier"}}, "url": "https://github.com/jenkinsci/jenkins/commit/fc3a505245cd0d7fc8e4a4f937233d9204cb5f7c", "committedDate": "2020-02-25T13:07:12Z", "message": "[JENKINS-55070] Correct symptom of missing instance"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MTM4MjQ3", "url": "https://github.com/jenkinsci/jenkins/pull/4525#pullrequestreview-364138247", "createdAt": "2020-02-25T13:28:39Z", "commit": {"oid": "fc3a505245cd0d7fc8e4a4f937233d9204cb5f7c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MTQ0MDc0", "url": "https://github.com/jenkinsci/jenkins/pull/4525#pullrequestreview-364144074", "createdAt": "2020-02-25T13:37:05Z", "commit": {"oid": "fc3a505245cd0d7fc8e4a4f937233d9204cb5f7c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MzcyNzQ5", "url": "https://github.com/jenkinsci/jenkins/pull/4525#pullrequestreview-364372749", "createdAt": "2020-02-25T19:06:16Z", "commit": {"oid": "fc3a505245cd0d7fc8e4a4f937233d9204cb5f7c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0Mzg1MTE5", "url": "https://github.com/jenkinsci/jenkins/pull/4525#pullrequestreview-364385119", "createdAt": "2020-02-25T19:25:00Z", "commit": {"oid": "fc3a505245cd0d7fc8e4a4f937233d9204cb5f7c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOToyNTowMFrOFuSF4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOToyNTowMFrOFuSF4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3NTIzMw==", "bodyText": "It seems doubtful that without the Jenkins singleton, we have enough working that ending up in retrieveAuthFromCookie will ultimately be successful (User#getById?).\nJust return null when jenkins == null, and return?", "url": "https://github.com/jenkinsci/jenkins/pull/4525#discussion_r384075233", "createdAt": "2020-02-25T19:25:00Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/security/TokenBasedRememberMeServices2.java", "diffHunk": "@@ -161,10 +161,12 @@ public void loginSuccess(HttpServletRequest request, HttpServletResponse respons\n \n     @Override\n     public Authentication autoLogin(HttpServletRequest request, HttpServletResponse response) {\n-        if(Jenkins.get().isDisableRememberMe()){\n+        // as this filter could be called during restart, this corrects at least the symptoms\n+        Jenkins j = Jenkins.getInstanceOrNull();\n+        if (j != null && j.isDisableRememberMe()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc3a505245cd0d7fc8e4a4f937233d9204cb5f7c"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "457d62cb2f6281ae49978398fedcd48e605cf26e", "author": {"user": {"login": "daniel-beck", "name": "Daniel Beck"}}, "url": "https://github.com/jenkinsci/jenkins/commit/457d62cb2f6281ae49978398fedcd48e605cf26e", "committedDate": "2020-02-27T14:44:08Z", "message": "Apply Daniel's proposal"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1Nzg4OTcz", "url": "https://github.com/jenkinsci/jenkins/pull/4525#pullrequestreview-365788973", "createdAt": "2020-02-27T16:09:24Z", "commit": {"oid": "457d62cb2f6281ae49978398fedcd48e605cf26e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2MTgwNDk0", "url": "https://github.com/jenkinsci/jenkins/pull/4525#pullrequestreview-366180494", "createdAt": "2020-02-28T06:20:45Z", "commit": {"oid": "457d62cb2f6281ae49978398fedcd48e605cf26e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1634, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}