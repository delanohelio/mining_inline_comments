{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxODQxNjYw", "number": 4531, "title": "JENKINS-61206 - Support System Read / Extended read permissions for agent configurations", "bodyText": "See JENKINS-61206.\nAdds system read / extended read support for agents / clouds.\nThe rule I applied was anything that was previously checking for administer for viewing is now system read, anything checking for connect or configure is Agent/ExtendedRead\n\nManual testing notes\nWhen using the core-pr-tester (docker run --rm -ti -p 8080:8080 -e ID=4531 jenkins/core-pr-tester), you can use script console to enable the permissions:\nJenkins.SYSTEM_READ.enabled = true\nComputer.EXTENDED_READ.enabled = true\n\nProposed changelog entries\n\nEntry 1: JENKINS-61206, Add system read support for 'Node Monitoring Configuration' and configuring clouds\nEntry 2: JENKINS-61206, Add Agent/ExtendedRead support for viewing agent configuration, system information and logs\nEntry 3: JENKINS-61206, Add support for the permissions attribute to task.jelly\nEntry 4: JENKINS-61206, Add hasAnyPermissions API to Functions to allow it to be called by views\n...\n\n\nProposed upgrade guidelines\nN/A\nSubmitter checklist\n\n JIRA issue is well described\n Changelog entries and upgrade guidelines are appropriate for the audience affected by the change (users or developer, depending on the change). Examples\n\nFill-in the Proposed changelog entries section only if there are breaking changes or other changes which may require extra steps from users during the upgrade\n\n\n Appropriate autotests or explanation to why this change has no tests\n For dependency updates: links to external changelogs and, if possible, full diffs\n\n\nDesired reviewers\n@mention\n\nMaintainer checklist\nBefore the changes are marked as ready-for-merge:\n\n There are at least 2 approvals for the pull request and no outstanding requests for change\n Conversations in the pull request are over OR it is explicit that a reviewer does not block the change\n Changelog entries in the PR title and/or Proposed changelog entries are correct\n Proper changelog labels are set so that the changelog can be generated automatically\n If the change needs additional upgrade steps from users, upgrade-guide-needed label is set and there is a Proposed upgrade guidelines section in the PR title. (example)\n If it would make sense to backport the change to LTS, a JIRA issue should exist and be labeled as lts-candidate", "createdAt": "2020-02-29T12:08:20Z", "url": "https://github.com/jenkinsci/jenkins/pull/4531", "merged": true, "mergeCommit": {"oid": "634004a648c5f0b1e6ba76b3fba286c04a3cc00d"}, "closed": true, "closedAt": "2020-05-24T05:58:28Z", "author": {"login": "timja"}, "timelineItems": {"totalCount": 43, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJDQwUgH2gAyMzgxODQxNjYwOmNmODY2MDlmYTUyNTYwMzNhMmZmMzUyZmM2Mzc5ZThiZmMxYmQzZDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcj5emxgFqTQxNzIwMTg2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cf86609fa5256033a2ff352fc6379e8bfc1bd3d8", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/cf86609fa5256033a2ff352fc6379e8bfc1bd3d8", "committedDate": "2020-02-29T11:59:25Z", "message": "JENKINS-61206 System read / Extended read for agents"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2Nzk2OTM0", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-366796934", "createdAt": "2020-02-29T12:58:11Z", "commit": {"oid": "cf86609fa5256033a2ff352fc6379e8bfc1bd3d8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQxMjo1ODoxMVrOFwJM9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQxMjo1ODoxMVrOFwJM9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAyNjc0MQ==", "bodyText": "Just throw in that case? The assumption that object is an ancestor isn't necessarily true. For example, in upstream cause related UI, you would show information about another job / build.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r386026741", "createdAt": "2020-02-29T12:58:11Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/Functions.java", "diffHunk": "@@ -1128,6 +1128,43 @@ public static String getFooterURL() {\n                 Jenkins.get().hasPermission(d.getRequiredGlobalConfigPagePermission()) || Jenkins.get().hasPermission(Jenkins.SYSTEM_READ)));\n     }\n \n+    /**\n+     * Checks if the current security principal has one of the supplied permissions.\n+     *\n+     * @since TODO\n+     */\n+    public static boolean hasAnyPermission(AccessControlled ac, Permission[] permissions) {\n+        if (permissions == null || permissions.length == 0) {\n+            return true;\n+        }\n+\n+        return ac.hasAnyPermission(permissions);\n+    }\n+\n+    /**\n+     * This version is so that the 'hasAnyPermission'\n+     * degrades gracefully if \"it\" is not an {@link AccessControlled} object.\n+     * Otherwise it will perform no check and that problem is hard to notice.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf86609fa5256033a2ff352fc6379e8bfc1bd3d8"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODQ0MTQy", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-366844142", "createdAt": "2020-03-01T08:54:31Z", "commit": {"oid": "cf86609fa5256033a2ff352fc6379e8bfc1bd3d8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQwODo1NDozMVrOFwNB5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQwODo1NDozMVrOFwNB5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA4OTQ0Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Otherwise it will perform no check and that problem is hard to notice.\n          \n          \n            \n                 * Otherwise it will perform no check and that problem is hard to notice.\n          \n          \n            \n                 *\n          \n          \n            \n                 * @since TODO", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r386089446", "createdAt": "2020-03-01T08:54:31Z", "author": {"login": "timja"}, "path": "core/src/main/java/hudson/Functions.java", "diffHunk": "@@ -1128,6 +1128,43 @@ public static String getFooterURL() {\n                 Jenkins.get().hasPermission(d.getRequiredGlobalConfigPagePermission()) || Jenkins.get().hasPermission(Jenkins.SYSTEM_READ)));\n     }\n \n+    /**\n+     * Checks if the current security principal has one of the supplied permissions.\n+     *\n+     * @since TODO\n+     */\n+    public static boolean hasAnyPermission(AccessControlled ac, Permission[] permissions) {\n+        if (permissions == null || permissions.length == 0) {\n+            return true;\n+        }\n+\n+        return ac.hasAnyPermission(permissions);\n+    }\n+\n+    /**\n+     * This version is so that the 'hasAnyPermission'\n+     * degrades gracefully if \"it\" is not an {@link AccessControlled} object.\n+     * Otherwise it will perform no check and that problem is hard to notice.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf86609fa5256033a2ff352fc6379e8bfc1bd3d8"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35dba6f231dc0c38419a166b8ba3f8423d49bbb9", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/35dba6f231dc0c38419a166b8ba3f8423d49bbb9", "committedDate": "2020-03-01T08:54:39Z", "message": "Update core/src/main/java/hudson/Functions.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e00fa4f0060fd07253472b15aae8904fc8c83974", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/e00fa4f0060fd07253472b15aae8904fc8c83974", "committedDate": "2020-03-06T21:04:28Z", "message": "Set permission to false explicitly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0a574dee81e30cfe625aadfae4333a6514aac11", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/b0a574dee81e30cfe625aadfae4333a6514aac11", "committedDate": "2020-03-06T21:05:12Z", "message": "Merge branch 'master' into systemRead-agents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ffa5fc259c391b5575cc8d165b0b3e3021d5e8d", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/0ffa5fc259c391b5575cc8d165b0b3e3021d5e8d", "committedDate": "2020-03-06T21:16:25Z", "message": "Add message when no configured clouds\n\nOtherwise there was a white page and it looked weird"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e8bb9be7fd5c9c12009f67d94bcf9ac54b703d7", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/7e8bb9be7fd5c9c12009f67d94bcf9ac54b703d7", "committedDate": "2020-04-25T07:29:03Z", "message": "Merge branch 'master' into systemRead-agents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7dd14234c67b51020178afb32606d7ef4dbf9e1", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/b7dd14234c67b51020178afb32606d7ef4dbf9e1", "committedDate": "2020-04-25T08:46:30Z", "message": "Hide password for Computer.EXTENDED_READ"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e1eeaf69dc120b8ec1afe01f0a3a1f22d6e232c", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/6e1eeaf69dc120b8ec1afe01f0a3a1f22d6e232c", "committedDate": "2020-04-28T18:50:18Z", "message": "Merge branch 'master' into systemRead-agents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/393ad7f6cb8050c70f4793ba194e909fb07d2888", "committedDate": "2020-04-28T20:41:17Z", "message": "Add test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMjg5MjAy", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-402289202", "createdAt": "2020-04-28T23:50:16Z", "commit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1MDoxN1rOGNrJuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1MDoxN1rOGNrJuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MTY3Mg==", "bodyText": "Weird, that looks like an oversight in your initial PR; CLI and Nodes links can be shown to anyone as they're not permission gated anyway.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416991672", "createdAt": "2020-04-28T23:50:17Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/jenkins/management/NodesLink.java", "diffHunk": "@@ -55,7 +55,7 @@ public String getDescription() {\n     @NonNull\n     @Override\n     public Permission getRequiredPermission() {\n-        return Jenkins.MANAGE;\n+        return Jenkins.READ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMjkwMTI5", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-402290129", "createdAt": "2020-04-28T23:52:56Z", "commit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1Mjo1N1rOGNrNLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1Mjo1N1rOGNrNLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MjU1Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        List<Ancestor> ancs = Stapler.getCurrentRequest().getAncestors();\n          \n          \n            \n                        AccessControlled ac = Stapler.getCurrentRequest().findAncestorObject(AccessControlled.class);\n          \n      \n    \n    \n  \n\netc.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416992557", "createdAt": "2020-04-28T23:52:57Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/Functions.java", "diffHunk": "@@ -1156,6 +1157,45 @@ public static String getFooterURL() {\n                 Jenkins.get().hasPermission(d.getRequiredGlobalConfigPagePermission()) || Jenkins.get().hasPermission(Jenkins.SYSTEM_READ)));\n     }\n \n+    /**\n+     * Checks if the current security principal has one of the supplied permissions.\n+     *\n+     * @since TODO\n+     */\n+    public static boolean hasAnyPermission(AccessControlled ac, Permission[] permissions) {\n+        if (permissions == null || permissions.length == 0) {\n+            return true;\n+        }\n+\n+        return ac.hasAnyPermission(permissions);\n+    }\n+\n+    /**\n+     * This version is so that the 'hasAnyPermission'\n+     * degrades gracefully if \"it\" is not an {@link AccessControlled} object.\n+     * Otherwise it will perform no check and that problem is hard to notice.\n+     *\n+     * @since TODO\n+     */\n+    public static boolean hasAnyPermission(Object object, Permission[] permissions) throws IOException, ServletException {\n+        if (permissions == null || permissions.length == 0) {\n+            return true;\n+        }\n+\n+        if (object instanceof AccessControlled)\n+            return hasAnyPermission((AccessControlled) object, permissions);\n+        else {\n+            List<Ancestor> ancs = Stapler.getCurrentRequest().getAncestors();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMjkwNDgx", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-402290481", "createdAt": "2020-04-28T23:53:53Z", "commit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1Mzo1M1rOGNrOgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1Mzo1M1rOGNrOgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5Mjg5Ng==", "bodyText": "\u2764\ufe0f", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416992896", "createdAt": "2020-04-28T23:53:53Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/Functions.java", "diffHunk": "@@ -2021,6 +2061,10 @@ public String getPasswordValue(Object o) {\n                 if (item != null && !item.hasPermission(Item.CONFIGURE)) {\n                     return \"********\";\n                 }\n+                Computer computer = req.findAncestorObject(Computer.class);\n+                if (computer != null && !computer.hasPermission(Computer.CONFIGURE)) {\n+                    return \"********\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMjkwOTYw", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-402290960", "createdAt": "2020-04-28T23:55:12Z", "commit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1NToxM1rOGNrQKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1OToxN1rOGNrVZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MzMyMA==", "bodyText": "Extended Read is implied by Configure, so all of this is unnecessary.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416993320", "createdAt": "2020-04-28T23:55:13Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/model/Computer.java", "diffHunk": "@@ -1804,6 +1804,14 @@ public long getWhen() {\n     public static final Permission CONNECT = new Permission(PERMISSIONS,\"Connect\", Messages._Computer_ConnectPermission_Description(), DISCONNECT, PermissionScope.COMPUTER);\n     public static final Permission BUILD = new Permission(PERMISSIONS, \"Build\", Messages._Computer_BuildPermission_Description(),  Permission.WRITE, PermissionScope.COMPUTER);\n \n+    @Restricted(NoExternalUse.class) // called by jelly\n+    public static final Permission[] EXTENDED_READ_AND_CONFIGURE =\n+            new Permission[] { EXTENDED_READ, CONFIGURE };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MzM2MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        new Permission[] { EXTENDED_READ, CONFIGURE };\n          \n          \n            \n                        new Permission[] { EXTENDED_READ, CONNECT };", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416993360", "createdAt": "2020-04-28T23:55:21Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/model/Computer.java", "diffHunk": "@@ -1804,6 +1804,14 @@ public long getWhen() {\n     public static final Permission CONNECT = new Permission(PERMISSIONS,\"Connect\", Messages._Computer_ConnectPermission_Description(), DISCONNECT, PermissionScope.COMPUTER);\n     public static final Permission BUILD = new Permission(PERMISSIONS, \"Build\", Messages._Computer_BuildPermission_Description(),  Permission.WRITE, PermissionScope.COMPUTER);\n \n+    @Restricted(NoExternalUse.class) // called by jelly\n+    public static final Permission[] EXTENDED_READ_AND_CONFIGURE =\n+            new Permission[] { EXTENDED_READ, CONFIGURE };\n+\n+    @Restricted(NoExternalUse.class) // called by jelly\n+    public static final Permission[] EXTENDED_READ_AND_CONNECT =\n+            new Permission[] { EXTENDED_READ, CONFIGURE };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MzQ0Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <l:layout permissions=\"${it.EXTENDED_READ_AND_CONFIGURE}\" title=\"${%title(it.displayName)}\">\n          \n          \n            \n              <l:layout permissions=\"${it.EXTENDED_READ}\" title=\"${%title(it.displayName)}\">\n          \n      \n    \n    \n  \n\nShould be good enough given the implication.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416993443", "createdAt": "2020-04-28T23:55:41Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/Computer/configure.jelly", "diffHunk": "@@ -28,7 +28,15 @@ THE SOFTWARE.\n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\"\n          xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\">\n-  <l:layout permission=\"${it.CONFIGURE}\" title=\"${%title(it.displayName)}\">\n+  <l:layout permissions=\"${it.EXTENDED_READ_AND_CONFIGURE}\" title=\"${%title(it.displayName)}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MzU4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permissions=\"${it.EXTENDED_READ_AND_CONFIGURE}\" title=\"${%Configure}\"/>\n          \n          \n            \n                  <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permissions=\"${it.EXTENDED_READ}\" title=\"${%Configure}\"/>", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416993581", "createdAt": "2020-04-28T23:56:03Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/Computer/sidepanel.jelly", "diffHunk": "@@ -33,7 +33,7 @@ THE SOFTWARE.\n       <l:task contextMenu=\"false\" href=\"${rootURL}/computer\" icon=\"icon-up icon-md\" title=\"${%Back to List}\"/>\n       <l:task contextMenu=\"false\" href=\"${rootURL}/${it.url}\" icon=\"icon-search icon-md\" title=\"${%Status}\"/>\n       <l:task href=\"${rootURL}/${it.url}delete\" icon=\"icon-edit-delete icon-md\" permission=\"${it.DELETE}\" title=\"${%Delete Agent}\"/>\n-      <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permission=\"${it.CONFIGURE}\" title=\"${%Configure}\"/>\n+      <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permissions=\"${it.EXTENDED_READ_AND_CONFIGURE}\" title=\"${%Configure}\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5Mzk4Ng==", "bodyText": "FYI @EstherAF This is probably something to open up to users with Overall/Manage permission.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416993986", "createdAt": "2020-04-28T23:57:06Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/ComputerSet/configure.jelly", "diffHunk": "@@ -27,7 +27,15 @@ THE SOFTWARE.\n -->\n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\" xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\" xmlns:i=\"jelly:fmt\">\n-  <l:layout permission=\"${app.ADMINISTER}\" title=\"${%Node Monitoring Configuration}\">\n+  <l:layout permission=\"${app.SYSTEM_READ}\" title=\"${%Node Monitoring Configuration}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5NDY2Mg==", "bodyText": "\ud83d\ude15", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416994662", "createdAt": "2020-04-28T23:59:17Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/slaves/SlaveComputer/log.jelly", "diffHunk": "@@ -24,23 +24,21 @@ THE SOFTWARE.\n \n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\" xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\" xmlns:i=\"jelly:fmt\">\n-  <l:layout title=\"${it.displayName} log\" secured=\"true\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb85534ac19eb176dbd03f4814f7ad1fc8ca1372", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/bb85534ac19eb176dbd03f4814f7ad1fc8ca1372", "committedDate": "2020-04-29T07:49:10Z", "message": "Access controlled simplification"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c074b104f8ee45d7a3c7a6d0e9fe3d066fbcc387", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/c074b104f8ee45d7a3c7a6d0e9fe3d066fbcc387", "committedDate": "2020-04-29T08:09:48Z", "message": "Fix typoes  / simplify code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MDQ4Mzk4", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-404048398", "createdAt": "2020-05-01T07:14:52Z", "commit": {"oid": "c074b104f8ee45d7a3c7a6d0e9fe3d066fbcc387"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwNzoxNDo1MlrOGPDwfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwNzoxODoxN1rOGPDzXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ0MzM4OA==", "bodyText": "I do not know a plugin which would be wrongly affected by that.\nI can imagine a Computer action which has a form with credentials, but it is much more likely for Jobs which has been added 4 years ago", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r418443388", "createdAt": "2020-05-01T07:14:52Z", "author": {"login": "oleg-nenashev"}, "path": "core/src/main/java/hudson/Functions.java", "diffHunk": "@@ -2021,6 +2061,10 @@ public String getPasswordValue(Object o) {\n                 if (item != null && !item.hasPermission(Item.CONFIGURE)) {\n                     return \"********\";\n                 }\n+                Computer computer = req.findAncestorObject(Computer.class);\n+                if (computer != null && !computer.hasPermission(Computer.CONFIGURE)) {\n+                    return \"********\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5Mjg5Ng=="}, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ0NDEyNQ==", "bodyText": "We should probably generalize common sidepanel controls to avoid different behavior on screens. It will likely also help @fqueiruga with the sidepanel restructuring proposal. Not required for this PR", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r418444125", "createdAt": "2020-05-01T07:18:17Z", "author": {"login": "oleg-nenashev"}, "path": "core/src/main/resources/hudson/model/ComputerSet/sidepanel.jelly", "diffHunk": "@@ -32,10 +32,10 @@ THE SOFTWARE.\n     <j:getStatic var=\"createPermission\" className=\"hudson.model.Computer\" field=\"CREATE\"/>\n     <l:tasks>\n       <l:task href=\"${rootURL}/\" icon=\"icon-up icon-md\" title=\"${%Back to Dashboard}\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c074b104f8ee45d7a3c7a6d0e9fe3d066fbcc387"}, "originalPosition": 3}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjExMzMz", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-404611333", "createdAt": "2020-05-03T12:02:45Z", "commit": {"oid": "c074b104f8ee45d7a3c7a6d0e9fe3d066fbcc387"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxMjowMjo0NlrOGPrceg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxMjoxMjoxNFrOGPrhBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA5MzYyNg==", "bodyText": "I wonder whether this could be simplified to\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    <j:set var=\"readOnlyMode\" value=\"true\" />\n          \n          \n            \n                    <j:set var=\"readOnlyMode\" value=\"${app.hasPermission(app.ADMINISTER)}\" />\n          \n      \n    \n    \n  \n\nIf so, perhaps in a followup cleanup PR.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419093626", "createdAt": "2020-05-03T12:02:46Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/ComputerSet/configure.jelly", "diffHunk": "@@ -27,7 +27,15 @@ THE SOFTWARE.\n -->\n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\" xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\" xmlns:i=\"jelly:fmt\">\n-  <l:layout permission=\"${app.ADMINISTER}\" title=\"${%Node Monitoring Configuration}\">\n+  <l:layout permission=\"${app.SYSTEM_READ}\" title=\"${%Node Monitoring Configuration}\">\n+    <j:choose>\n+      <j:when test=\"${app.hasPermission(app.ADMINISTER)}\">\n+        <j:set var=\"readOnlyMode\" value=\"false\" />\n+      </j:when>\n+      <j:otherwise>\n+        <j:set var=\"readOnlyMode\" value=\"true\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c074b104f8ee45d7a3c7a6d0e9fe3d066fbcc387"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA5Mzg5NA==", "bodyText": "This behavior is shitty and broken, but if we're going to address it in #hasPermission, we can also fix up this.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419093894", "createdAt": "2020-05-03T12:04:40Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/Functions.java", "diffHunk": "@@ -1156,6 +1157,43 @@ public static String getFooterURL() {\n                 Jenkins.get().hasPermission(d.getRequiredGlobalConfigPagePermission()) || Jenkins.get().hasPermission(Jenkins.SYSTEM_READ)));\n     }\n \n+    /**\n+     * Checks if the current security principal has one of the supplied permissions.\n+     *\n+     * @since TODO\n+     */\n+    public static boolean hasAnyPermission(AccessControlled ac, Permission[] permissions) {\n+        if (permissions == null || permissions.length == 0) {\n+            return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c074b104f8ee45d7a3c7a6d0e9fe3d066fbcc387"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA5NDAyNA==", "bodyText": "IOW, you should change \n  \n    \n      jenkins/core/src/main/java/jenkins/management/CliLink.java\n    \n    \n         Line 58\n      in\n      6fb8b93\n    \n    \n    \n    \n\n        \n          \n           return Jenkins.MANAGE; \n        \n    \n  \n\n \ud83d\ude03", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419094024", "createdAt": "2020-05-03T12:05:52Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/jenkins/management/NodesLink.java", "diffHunk": "@@ -55,7 +55,7 @@ public String getDescription() {\n     @NonNull\n     @Override\n     public Permission getRequiredPermission() {\n-        return Jenkins.MANAGE;\n+        return Jenkins.READ;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MTY3Mg=="}, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA5NDc4OQ==", "bodyText": "Questionable semantics when both attributes are specified? Unsure. Should be documented what happens when you do both, and it should be consistent with /lib/layout.jelly.\nPlus I wonder as before whether this could be simplified to\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    <j:set var=\"hasPermission\" value=\"false\" />\n          \n          \n            \n                    <j:set var=\"hasPermission\" value=\"${h.hasAnyPermission(it, attrs.permissions)}\" />\n          \n      \n    \n    \n  \n\nplus delete a bunch of surrounding lines (obviously only if we're OK with the current behavior).", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419094789", "createdAt": "2020-05-03T12:12:14Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/lib/layout/task.jelly", "diffHunk": "@@ -84,8 +88,33 @@ THE SOFTWARE.\n     <j:set var=\"taskMatching\" value=\"${context.parent}\"/>\n     <d:invokeBody />\n   </j:scope>\n+  <j:if test=\"${attrs.permission != null}\">\n+    <j:choose>\n+      <j:when test=\"${h.hasPermission(it, attrs.permission)}\">\n+        <j:set var=\"hasPermission\" value=\"true\" />\n+      </j:when>\n+      <j:otherwise>\n+        <j:set var=\"hasPermission\" value=\"false\" />\n+      </j:otherwise>\n+    </j:choose>\n+  </j:if>\n+\n+  <j:if test=\"${attrs.permissions != null}\">\n+    <j:choose>\n+      <j:when test=\"${h.hasAnyPermission(it, attrs.permissions)}\">\n+        <j:set var=\"hasPermission\" value=\"true\" />\n+      </j:when>\n+      <j:otherwise>\n+        <j:set var=\"hasPermission\" value=\"false\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c074b104f8ee45d7a3c7a6d0e9fe3d066fbcc387"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e22c9ce0083d7e7dd01510d3e3736f456213af5a", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/e22c9ce0083d7e7dd01510d3e3736f456213af5a", "committedDate": "2020-05-03T14:18:20Z", "message": "Simplify task.jelly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1962ae6c320ca462227d69b6990ed53e8e1b2ae", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/f1962ae6c320ca462227d69b6990ed53e8e1b2ae", "committedDate": "2020-05-03T14:22:01Z", "message": "Allow filtering system info extensions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a17aec26ae26daa547b66543e119ea33405bee0", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/6a17aec26ae26daa547b66543e119ea33405bee0", "committedDate": "2020-05-03T14:31:56Z", "message": "Show link that should be present"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "244e4674b19f6dee895a4019a78f09ef8a604a91", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/244e4674b19f6dee895a4019a78f09ef8a604a91", "committedDate": "2020-05-03T14:42:43Z", "message": "Adjust MasterComputer access"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjI2MTE5", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-404626119", "createdAt": "2020-05-03T14:48:03Z", "commit": {"oid": "e22c9ce0083d7e7dd01510d3e3736f456213af5a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxNDo0ODowM1rOGPsrcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxNDo0ODowM1rOGPsrcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTExMzg0Mg==", "bodyText": "Same simplification can be applied to permission above (again, not necessary, just nice to have).", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419113842", "createdAt": "2020-05-03T14:48:03Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/lib/layout/task.jelly", "diffHunk": "@@ -100,14 +104,7 @@ THE SOFTWARE.\n   </j:if>\n \n   <j:if test=\"${attrs.permissions != null}\">\n-    <j:choose>\n-      <j:when test=\"${h.hasAnyPermission(it, attrs.permissions)}\">\n-        <j:set var=\"hasPermission\" value=\"true\" />\n-      </j:when>\n-      <j:otherwise>\n-        <j:set var=\"hasPermission\" value=\"false\" />\n-      </j:otherwise>\n-    </j:choose>\n+    <j:set var=\"hasPermission\" value=\"${h.hasAnyPermission(it, attrs.permissions)}\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e22c9ce0083d7e7dd01510d3e3736f456213af5a"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjI3NTMx", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-404627531", "createdAt": "2020-05-03T15:03:37Z", "commit": {"oid": "f1962ae6c320ca462227d69b6990ed53e8e1b2ae"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxNTowMzozN1rOGPszoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxNTowNTowOVrOGPs0cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTExNTkzNw==", "bodyText": "This approach looks reasonable. \ud83d\udc4d", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419115937", "createdAt": "2020-05-03T15:03:37Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/jenkins/slaves/systemInfo/SlaveSystemInfo.java", "diffHunk": "@@ -24,4 +27,14 @@\n     public static ExtensionList<SlaveSystemInfo> all() {\n         return ExtensionList.lookup(SlaveSystemInfo.class);\n     }\n+\n+    /**\n+     * Returns the permission required for user to see this system info extension on the \"System Information\" page for the Agent\n+     *\n+     *\n+     * @return the permission required for the extension to be shown on \"System Information\".\n+     */\n+    public Permission getRequiredPermission() {\n+        return Computer.CONNECT;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1962ae6c320ca462227d69b6990ed53e8e1b2ae"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTExNjE0Nw==", "bodyText": "I would like to see more than the bare minimum of Javadoc here, see e.g. \n  \n    \n      jenkins/core/src/main/java/hudson/model/AdministrativeMonitor.java\n    \n    \n        Lines 170 to 185\n      in\n      7b654b2\n    \n    \n    \n    \n\n        \n          \n               /** \n        \n\n        \n          \n                * Required permission to view this admin monitor. \n        \n\n        \n          \n                * By default {@link Jenkins#ADMINISTER}, but {@link Jenkins#SYSTEM_READ} is also supported. \n        \n\n        \n          \n                * <p> \n        \n\n        \n          \n                *     Changing this permission check to return {@link Jenkins#SYSTEM_READ} will make the active \n        \n\n        \n          \n                *     administrative monitor appear on {@code manage.jelly} and on the globally visible \n        \n\n        \n          \n                *     {@link jenkins.management.AdministrativeMonitorsDecorator} to users without Administer permission. \n        \n\n        \n          \n                *     {@link #doDisable(StaplerRequest, StaplerResponse)} will still always require Administer permission. \n        \n\n        \n          \n                * </p> \n        \n\n        \n          \n                * <p> \n        \n\n        \n          \n                *     Implementers need to ensure that {@code doAct} and other web methods perform necessary permission checks: \n        \n\n        \n          \n                *     Users with System Read permissions are expected to be limited to read-only access. \n        \n\n        \n          \n                *     Form UI elements that change system state, e.g. toggling a feature on or off, need to be hidden from users \n        \n\n        \n          \n                *     lacking Administer permission. \n        \n\n        \n          \n                * </p> \n        \n\n        \n          \n                */ \n        \n    \n  \n\n for comparison. Of course, this is a far simpler extension point, but at least supported (useful) values would make sense, and what the default is.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419116147", "createdAt": "2020-05-03T15:05:09Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/jenkins/slaves/systemInfo/SlaveSystemInfo.java", "diffHunk": "@@ -24,4 +27,14 @@\n     public static ExtensionList<SlaveSystemInfo> all() {\n         return ExtensionList.lookup(SlaveSystemInfo.class);\n     }\n+\n+    /**\n+     * Returns the permission required for user to see this system info extension on the \"System Information\" page for the Agent", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1962ae6c320ca462227d69b6990ed53e8e1b2ae"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df660ffe250b5e6d5bc29f92c34bbd3c76817aee", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/df660ffe250b5e6d5bc29f92c34bbd3c76817aee", "committedDate": "2020-05-03T15:23:18Z", "message": "Adjust javadoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37fc83bbd9b38204759ee032f5d47279f8925dbb", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/37fc83bbd9b38204759ee032f5d47279f8925dbb", "committedDate": "2020-05-03T15:37:55Z", "message": "Adjust MasterComputer#configure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "221ed0f30c0d8a956a4c09d03091a1d2c97da340", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/221ed0f30c0d8a956a4c09d03091a1d2c97da340", "committedDate": "2020-05-08T08:02:30Z", "message": "Merge branch 'master' into systemRead-agents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7146b7ac40c9ba1974f41e8029215419e496ac81", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/7146b7ac40c9ba1974f41e8029215419e496ac81", "committedDate": "2020-05-08T10:04:23Z", "message": "Change links when read only access"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MTQxNDU3", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-408141457", "createdAt": "2020-05-08T10:16:08Z", "commit": {"oid": "7146b7ac40c9ba1974f41e8029215419e496ac81"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMDoxNjowOFrOGSgt-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMDoxNjowOFrOGSgt-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA2MzYwOA==", "bodyText": "Looks like the same mistake that made all job configurations read-only?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    <j:when test=\"${app.hasPermission(it.CONFIGURE)}\">\n          \n          \n            \n                    <j:when test=\"${it.hasPermission(it.CONFIGURE)}\">", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r422063608", "createdAt": "2020-05-08T10:16:08Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/Computer/sidepanel.jelly", "diffHunk": "@@ -33,7 +33,17 @@ THE SOFTWARE.\n       <l:task contextMenu=\"false\" href=\"${rootURL}/computer\" icon=\"icon-up icon-md\" title=\"${%Back to List}\"/>\n       <l:task contextMenu=\"false\" href=\"${rootURL}/${it.url}\" icon=\"icon-search icon-md\" title=\"${%Status}\"/>\n       <l:task href=\"${rootURL}/${it.url}delete\" icon=\"icon-edit-delete icon-md\" permission=\"${it.DELETE}\" title=\"${%Delete Agent}\"/>\n-      <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permission=\"${it.EXTENDED_READ}\" title=\"${%Configure}\"/>\n+\n+      <j:choose>\n+        <j:when test=\"${app.hasPermission(it.CONFIGURE)}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7146b7ac40c9ba1974f41e8029215419e496ac81"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86de15b24ec3cee9af607108ed4f7a65ba8692e5", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/86de15b24ec3cee9af607108ed4f7a65ba8692e5", "committedDate": "2020-05-08T10:23:38Z", "message": "Use it instead of app"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MjgzMDQ0", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-408283044", "createdAt": "2020-05-08T14:34:08Z", "commit": {"oid": "86de15b24ec3cee9af607108ed4f7a65ba8692e5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNDozNDowOVrOGSnvfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNDozNDowOVrOGSnvfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE3ODY4Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  <j:when test=\"${app.hasPermission(it.CONFIGURE)}\">\n          \n          \n            \n                  <j:when test=\"${it.hasPermission(it.CONFIGURE)}\">\n          \n      \n    \n    \n  \n\nSame as #4531 (comment), this is basically https://issues.jenkins-ci.org/browse/JENKINS-61321 all over, just for agents.\nSee jenkinsci/matrix-auth-plugin@827c538#diff-127b3ccbc7bfa4e2588688b2ea4107b1R108-R122 for a test making the difference clear (I hope).", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r422178687", "createdAt": "2020-05-08T14:34:09Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/Computer/configure.jelly", "diffHunk": "@@ -28,7 +28,15 @@ THE SOFTWARE.\n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\"\n          xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\">\n-  <l:layout permission=\"${it.CONFIGURE}\" title=\"${%title(it.displayName)}\">\n+  <l:layout permission=\"${it.EXTENDED_READ}\" title=\"${%title(it.displayName)}\">\n+    <j:choose>\n+      <j:when test=\"${app.hasPermission(it.CONFIGURE)}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86de15b24ec3cee9af607108ed4f7a65ba8692e5"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06d8455d3311030f7bc94dc2829be37e112ab3c9", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/06d8455d3311030f7bc94dc2829be37e112ab3c9", "committedDate": "2020-05-08T16:30:43Z", "message": "Update core/src/main/resources/hudson/model/Computer/configure.jelly\n\nCo-authored-by: Daniel Beck <1831569+daniel-beck@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0783af2c52420bb40440ac263b493f0248e81ef", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/c0783af2c52420bb40440ac263b493f0248e81ef", "committedDate": "2020-05-11T20:09:50Z", "message": "Merge branch 'master' into systemRead-agents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47e31f514cab14e314f6ab7f404de8ef9dd659c8", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/47e31f514cab14e314f6ab7f404de8ef9dd659c8", "committedDate": "2020-05-11T20:10:06Z", "message": "Merge branch 'systemRead-agents' of github.com:timja/jenkins into systemRead-agents"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31c35d6ba6999e9ea316fff3222b405c96e5ac47", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/31c35d6ba6999e9ea316fff3222b405c96e5ac47", "committedDate": "2020-05-11T20:31:55Z", "message": "Code simplification"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0Mjg5NTIw", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-414289520", "createdAt": "2020-05-19T09:58:54Z", "commit": {"oid": "31c35d6ba6999e9ea316fff3222b405c96e5ac47"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOTo1ODo1NFrOGXY-2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMDowMzo0OVrOGXZKbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE3OTczOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      <j:set var=\"configureCloudsTitle\" value=\"${%Configure Clouds}\"/>\n          \n          \n            \n                      <j:set var=\"configureCloudsTitle\" value=\"${app.hasPermission(app.ADMINISTER) ? '%Configure Clouds' : '%View Clouds'}\"/>\n          \n      \n    \n    \n  \n\nPlus corresponding changes to surrounding lines.\nThis should work too. Often not really readable, and annoying to find occurrences of, but FYI. (Not a real suggestion.)", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r427179738", "createdAt": "2020-05-19T09:58:54Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/ComputerSet/sidepanel.jelly", "diffHunk": "@@ -32,12 +32,20 @@ THE SOFTWARE.\n     <j:getStatic var=\"createPermission\" className=\"hudson.model.Computer\" field=\"CREATE\"/>\n     <l:tasks>\n       <l:task href=\"${rootURL}/\" icon=\"icon-up icon-md\" title=\"${%Back to Dashboard}\"/>\n-      <l:task href=\"${rootURL}/manage\" icon=\"icon-gear2 icon-md\" permission=\"${app.MANAGE}\" title=\"${%Manage Jenkins}\"/>\n+      <l:task href=\"${rootURL}/manage\" icon=\"icon-gear2 icon-md\" permissions=\"${app.MANAGE_AND_SYSTEM_READ}\" title=\"${%Manage Jenkins}\"/>\n       <l:task href=\"new\" icon=\"icon-new-computer icon-md\" permission=\"${createPermission}\" title=\"${%New Node}\"/>\n-      <l:task href=\"${rootURL}/configureClouds\" icon=\"icon-health-40to59 icon-md\" permission=\"${app.ADMINISTER}\" title=\"${%Configure Clouds}\"/>\n-      <l:task href=\"configure\" icon=\"icon-gear2 icon-md\" permission=\"${app.ADMINISTER}\" title=\"${%Node Monitoring}\"/>\n+      <j:choose>\n+        <j:when test=\"${app.hasPermission(app.ADMINISTER)}\">\n+          <j:set var=\"configureCloudsTitle\" value=\"${%Configure Clouds}\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31c35d6ba6999e9ea316fff3222b405c96e5ac47"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE4MjcwMQ==", "bodyText": "The link to the plugin manager two lines below should probably be conditional on having Administer? While the link isn't broken, it's not that useful. OTOH it would inform which plugins need installing out of band. Unsure.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r427182701", "createdAt": "2020-05-19T10:03:49Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/jenkins/model/GlobalCloudConfiguration/index.groovy", "diffHunk": "@@ -21,25 +22,31 @@ l.layout(norefresh:true, permission:app.ADMINISTER, title:my.displayName) {\n             // TODO more appropriate icon\n             text(my.displayName)\n         }\n-\n         def clouds = Cloud.all()\n-\n         if (!clouds.isEmpty()) {\n             p()\n             div(class:\"behavior-loading\", _(\"LOADING\"))\n \n             f.form(method:\"post\",name:\"config\",action:\"configure\") {\n                 f.block {\n+                    if (app.clouds.size() == 0 && !h.hasPermission(app.ADMINISTER)) {\n+                        p(_(\"No clouds have been configured.\"))\n+                    }\n+\n                     f.hetero_list(name:\"cloud\", hasHeader:true, descriptors:Cloud.all(), items:app.clouds,\n                             addCaption:_(\"Add a new cloud\"), deleteCaption:_(\"Delete cloud\"))\n                 }\n \n-                f.bottomButtonBar {\n-                    f.submit(value:_(\"Save\"))\n-                    f.apply(value:_(\"Apply\"))\n+                l.isAdmin {\n+                    f.bottomButtonBar {\n+                        f.submit(value: _(\"Save\"))\n+                        f.apply(value: _(\"Apply\"))\n+                    }\n                 }\n             }\n-            st.adjunct(includes: \"lib.form.confirm\")\n+            l.isAdmin {\n+                st.adjunct(includes: \"lib.form.confirm\")\n+            }\n         } else {\n             String label = Jenkins.get().updateCenter.getCategoryDisplayName(\"cloud\")\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31c35d6ba6999e9ea316fff3222b405c96e5ac47"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbe611c893aaef0a05ae2bb869a92a61f372e59e", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/bbe611c893aaef0a05ae2bb869a92a61f372e59e", "committedDate": "2020-05-19T15:07:06Z", "message": "Inline jelly text customisation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37c712bb218162e9955a70ca86a3a6318a4af194", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/37c712bb218162e9955a70ca86a3a6318a4af194", "committedDate": "2020-05-19T15:30:33Z", "message": "Allow system read to see cloud move blurb"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NTc1MDQw", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-414575040", "createdAt": "2020-05-19T15:37:33Z", "commit": {"oid": "37c712bb218162e9955a70ca86a3a6318a4af194"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNTozNzozM1rOGXmdNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNTozODo1M1rOGXmgpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQwMDUwMQ==", "bodyText": "Different tooltip based on permission?", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r427400501", "createdAt": "2020-05-19T15:37:33Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/ComputerSet/index.jelly", "diffHunk": "@@ -66,7 +66,7 @@ THE SOFTWARE.\n           </j:forEach>\n \n           <td><!-- config link -->\n-            <j:if test=\"${c.hasPermission(c.CONFIGURE)}\">\n+            <j:if test=\"${c.hasPermission(c.EXTENDED_READ)}\">\n               <a href=\"${rootURL}/${c.url}configure\">\n                 <l:icon class=\"icon-gear2 icon-lg\" tooltip=\"${%Configure}\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37c712bb218162e9955a70ca86a3a6318a4af194"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQwMTM4Mg==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r427401382", "createdAt": "2020-05-19T15:38:53Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/jenkins/model/Jenkins/configure.jelly", "diffHunk": "@@ -54,9 +54,9 @@ THE SOFTWARE.\n         </f:rowSet>\n       </j:forEach>\n \n-      <l:isAdmin>\n+      <l:hasPermission permission=\"${app.SYSTEM_READ}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37c712bb218162e9955a70ca86a3a6318a4af194"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1beda157bb46ea0f877d7436fe5d403594dfceb8", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/1beda157bb46ea0f877d7436fe5d403594dfceb8", "committedDate": "2020-05-19T15:50:27Z", "message": "Tooltip based on permission"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NjIxMzc0", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-414621374", "createdAt": "2020-05-19T16:29:14Z", "commit": {"oid": "1beda157bb46ea0f877d7436fe5d403594dfceb8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MjAxODY2", "url": "https://github.com/jenkinsci/jenkins/pull/4531#pullrequestreview-417201866", "createdAt": "2020-05-22T21:51:27Z", "commit": {"oid": "1beda157bb46ea0f877d7436fe5d403594dfceb8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1655, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}