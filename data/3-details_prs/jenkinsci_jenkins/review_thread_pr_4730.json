{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NDYwNjYy", "number": 4730, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMjowMjo0NFrOD9_QHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxODozNzoxMVrOD-tMuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MzI2MDQ1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/model/Computer.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQyMjowMjo0NFrOGX0Puw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMjoyMTowNFrOGYI2dA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzYyNjQyNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final Object logDirLock = new Object();\n          \n          \n            \n                private final Object logDirLock = new String(\"logDirLock);\n          \n      \n    \n    \n  \n\nsince a future version of Java may not support synchronizing on Object", "url": "https://github.com/jenkinsci/jenkins/pull/4730#discussion_r427626427", "createdAt": "2020-05-19T22:02:44Z", "author": {"login": "jglick"}, "path": "core/src/main/java/hudson/model/Computer.java", "diffHunk": "@@ -195,6 +195,8 @@\n \n     protected final Object statusChangeLock = new Object();\n \n+    private final Object logDirLock = new Object();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c42b789df628078ad646fb682d250cb176cf9bf6"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc4Njk1Mg==", "bodyText": "Ah? Didn't know. Any reference?", "url": "https://github.com/jenkinsci/jenkins/pull/4730#discussion_r427786952", "createdAt": "2020-05-20T07:09:02Z", "author": {"login": "Vlatombe"}, "path": "core/src/main/java/hudson/model/Computer.java", "diffHunk": "@@ -195,6 +195,8 @@\n \n     protected final Object statusChangeLock = new Object();\n \n+    private final Object logDirLock = new Object();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzYyNjQyNw=="}, "originalCommit": {"oid": "c42b789df628078ad646fb682d250cb176cf9bf6"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0NTkxOA==", "bodyText": "At least that is my reading of: http://cr.openjdk.java.net/~briangoetz/valhalla/sov/02-object-model.html", "url": "https://github.com/jenkinsci/jenkins/pull/4730#discussion_r427945918", "createdAt": "2020-05-20T11:48:22Z", "author": {"login": "jglick"}, "path": "core/src/main/java/hudson/model/Computer.java", "diffHunk": "@@ -195,6 +195,8 @@\n \n     protected final Object statusChangeLock = new Object();\n \n+    private final Object logDirLock = new Object();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzYyNjQyNw=="}, "originalCommit": {"oid": "c42b789df628078ad646fb682d250cb176cf9bf6"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk1NjM0NA==", "bodyText": "As I understand it would depend on whether the Object class is treated as an inline class or not.", "url": "https://github.com/jenkinsci/jenkins/pull/4730#discussion_r427956344", "createdAt": "2020-05-20T12:08:27Z", "author": {"login": "Vlatombe"}, "path": "core/src/main/java/hudson/model/Computer.java", "diffHunk": "@@ -195,6 +195,8 @@\n \n     protected final Object statusChangeLock = new Object();\n \n+    private final Object logDirLock = new Object();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzYyNjQyNw=="}, "originalCommit": {"oid": "c42b789df628078ad646fb682d250cb176cf9bf6"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk2NDAyMA==", "bodyText": "I thought I had seen some explicit discussion about this idiom, whereby code would need to be migrated to using a Lock, a better monitor, or at least\nfinal Object lock = Object.newIdentityObject();\n// ..\nsynchronized (lock) {\n    // \u2026\n}\nbut maybe I am reading more into it than was really there.", "url": "https://github.com/jenkinsci/jenkins/pull/4730#discussion_r427964020", "createdAt": "2020-05-20T12:21:04Z", "author": {"login": "jglick"}, "path": "core/src/main/java/hudson/model/Computer.java", "diffHunk": "@@ -195,6 +195,8 @@\n \n     protected final Object statusChangeLock = new Object();\n \n+    private final Object logDirLock = new Object();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzYyNjQyNw=="}, "originalCommit": {"oid": "c42b789df628078ad646fb682d250cb176cf9bf6"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NTI1MTc2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/model/Computer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMTo0OTowM1rOGYHw-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxMTo0OTowM1rOGYHw-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0NjIzNA==", "bodyText": "Note that thread dumps will unfortunately not show the text. Maybe a future JVM could be enhanced to do that.", "url": "https://github.com/jenkinsci/jenkins/pull/4730#discussion_r427946234", "createdAt": "2020-05-20T11:49:03Z", "author": {"login": "jglick"}, "path": "core/src/main/java/hudson/model/Computer.java", "diffHunk": "@@ -195,6 +195,8 @@\n \n     protected final Object statusChangeLock = new Object();\n \n+    private final Object logDirLock = new String(\"logDirLock);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4da038a31a6e6f77f014016cbfacc759a3028d69"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2OTg1NzU1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/model/Computer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNDoyNzoxN1rOGY06_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNDoyNzoxN1rOGY06_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY4NjA3Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final Object logDirLock = new String(\"logDirLock);\n          \n          \n            \n                private final Object logDirLock = new String(\"logDirLock\");", "url": "https://github.com/jenkinsci/jenkins/pull/4730#discussion_r428686077", "createdAt": "2020-05-21T14:27:17Z", "author": {"login": "MRamonLeon"}, "path": "core/src/main/java/hudson/model/Computer.java", "diffHunk": "@@ -195,6 +195,8 @@\n \n     protected final Object statusChangeLock = new Object();\n \n+    private final Object logDirLock = new String(\"logDirLock);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4da038a31a6e6f77f014016cbfacc759a3028d69"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MDc4ODQzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/model/Computer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxODozNzoxMVrOGY-Rxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxOToxNjozMlrOGY_g8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgzOTM2Nw==", "bodyText": "Out of curiosity: why not just a synchronized method? The time saved is superfluous and it is cleaner. WDYT?", "url": "https://github.com/jenkinsci/jenkins/pull/4730#discussion_r428839367", "createdAt": "2020-05-21T18:37:11Z", "author": {"login": "MRamonLeon"}, "path": "core/src/main/java/hudson/model/Computer.java", "diffHunk": "@@ -303,10 +305,12 @@ public void addAction(@NonNull Action a) {\n      */\n     protected @NonNull File getLogDir() {\n         File dir = new File(Jenkins.get().getRootDir(),\"logs/slaves/\"+nodeName);\n-        try {\n-            IOUtils.mkdirs(dir);\n-        } catch (IOException x) {\n-            LOGGER.log(Level.SEVERE, \"Failed to create agent log directory \" + dir, x);\n+        synchronized (logDirLock) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5659c4fc77f16189fe0e3b2e91c7e6c6fbbf212"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg1OTYzMg==", "bodyText": "To avoid reusing the Computer monitor which might already be used for other purposes, and possibly introducing deadlocks or contention.", "url": "https://github.com/jenkinsci/jenkins/pull/4730#discussion_r428859632", "createdAt": "2020-05-21T19:16:32Z", "author": {"login": "jglick"}, "path": "core/src/main/java/hudson/model/Computer.java", "diffHunk": "@@ -303,10 +305,12 @@ public void addAction(@NonNull Action a) {\n      */\n     protected @NonNull File getLogDir() {\n         File dir = new File(Jenkins.get().getRootDir(),\"logs/slaves/\"+nodeName);\n-        try {\n-            IOUtils.mkdirs(dir);\n-        } catch (IOException x) {\n-            LOGGER.log(Level.SEVERE, \"Failed to create agent log directory \" + dir, x);\n+        synchronized (logDirLock) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgzOTM2Nw=="}, "originalCommit": {"oid": "a5659c4fc77f16189fe0e3b2e91c7e6c6fbbf212"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 561, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}