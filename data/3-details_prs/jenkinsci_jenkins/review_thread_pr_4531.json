{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxODQxNjYw", "number": 4531, "reviewThreads": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQxMjo1ODoxMVrODkBYFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNTozODo1M1rOD92ypw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5MDk3ODc2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/Functions.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQxMjo1ODoxMVrOFwJM9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQxMzowMDo0MVrOFwJNYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAyNjc0MQ==", "bodyText": "Just throw in that case? The assumption that object is an ancestor isn't necessarily true. For example, in upstream cause related UI, you would show information about another job / build.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r386026741", "createdAt": "2020-02-29T12:58:11Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/Functions.java", "diffHunk": "@@ -1128,6 +1128,43 @@ public static String getFooterURL() {\n                 Jenkins.get().hasPermission(d.getRequiredGlobalConfigPagePermission()) || Jenkins.get().hasPermission(Jenkins.SYSTEM_READ)));\n     }\n \n+    /**\n+     * Checks if the current security principal has one of the supplied permissions.\n+     *\n+     * @since TODO\n+     */\n+    public static boolean hasAnyPermission(AccessControlled ac, Permission[] permissions) {\n+        if (permissions == null || permissions.length == 0) {\n+            return true;\n+        }\n+\n+        return ac.hasAnyPermission(permissions);\n+    }\n+\n+    /**\n+     * This version is so that the 'hasAnyPermission'\n+     * degrades gracefully if \"it\" is not an {@link AccessControlled} object.\n+     * Otherwise it will perform no check and that problem is hard to notice.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf86609fa5256033a2ff352fc6379e8bfc1bd3d8"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAyNjg1MA==", "bodyText": "It\u2019s consistent with hasPermission and wasn\u2019t working without this for the l:task it was just silently doing nothing", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r386026850", "createdAt": "2020-02-29T13:00:41Z", "author": {"login": "timja"}, "path": "core/src/main/java/hudson/Functions.java", "diffHunk": "@@ -1128,6 +1128,43 @@ public static String getFooterURL() {\n                 Jenkins.get().hasPermission(d.getRequiredGlobalConfigPagePermission()) || Jenkins.get().hasPermission(Jenkins.SYSTEM_READ)));\n     }\n \n+    /**\n+     * Checks if the current security principal has one of the supplied permissions.\n+     *\n+     * @since TODO\n+     */\n+    public static boolean hasAnyPermission(AccessControlled ac, Permission[] permissions) {\n+        if (permissions == null || permissions.length == 0) {\n+            return true;\n+        }\n+\n+        return ac.hasAnyPermission(permissions);\n+    }\n+\n+    /**\n+     * This version is so that the 'hasAnyPermission'\n+     * degrades gracefully if \"it\" is not an {@link AccessControlled} object.\n+     * Otherwise it will perform no check and that problem is hard to notice.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjAyNjc0MQ=="}, "originalCommit": {"oid": "cf86609fa5256033a2ff352fc6379e8bfc1bd3d8"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5MTQ4MzU1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/Functions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQwODo1NDozMVrOFwNB5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMVQwODo1NDozMVrOFwNB5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA4OTQ0Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Otherwise it will perform no check and that problem is hard to notice.\n          \n          \n            \n                 * Otherwise it will perform no check and that problem is hard to notice.\n          \n          \n            \n                 *\n          \n          \n            \n                 * @since TODO", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r386089446", "createdAt": "2020-03-01T08:54:31Z", "author": {"login": "timja"}, "path": "core/src/main/java/hudson/Functions.java", "diffHunk": "@@ -1128,6 +1128,43 @@ public static String getFooterURL() {\n                 Jenkins.get().hasPermission(d.getRequiredGlobalConfigPagePermission()) || Jenkins.get().hasPermission(Jenkins.SYSTEM_READ)));\n     }\n \n+    /**\n+     * Checks if the current security principal has one of the supplied permissions.\n+     *\n+     * @since TODO\n+     */\n+    public static boolean hasAnyPermission(AccessControlled ac, Permission[] permissions) {\n+        if (permissions == null || permissions.length == 0) {\n+            return true;\n+        }\n+\n+        return ac.hasAnyPermission(permissions);\n+    }\n+\n+    /**\n+     * This version is so that the 'hasAnyPermission'\n+     * degrades gracefully if \"it\" is not an {@link AccessControlled} object.\n+     * Otherwise it will perform no check and that problem is hard to notice.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf86609fa5256033a2ff352fc6379e8bfc1bd3d8"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NDQzMjQyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/management/NodesLink.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1MDoxN1rOGNrJuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxMjowNTo1MlrOGPreCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MTY3Mg==", "bodyText": "Weird, that looks like an oversight in your initial PR; CLI and Nodes links can be shown to anyone as they're not permission gated anyway.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416991672", "createdAt": "2020-04-28T23:50:17Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/jenkins/management/NodesLink.java", "diffHunk": "@@ -55,7 +55,7 @@ public String getDescription() {\n     @NonNull\n     @Override\n     public Permission getRequiredPermission() {\n-        return Jenkins.MANAGE;\n+        return Jenkins.READ;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEzMjg3NQ==", "bodyText": "initial PR? this is the management link from /manage, I haven't touched nodes / agents for system read before this PR", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r417132875", "createdAt": "2020-04-29T07:58:43Z", "author": {"login": "timja"}, "path": "core/src/main/java/jenkins/management/NodesLink.java", "diffHunk": "@@ -55,7 +55,7 @@ public String getDescription() {\n     @NonNull\n     @Override\n     public Permission getRequiredPermission() {\n-        return Jenkins.MANAGE;\n+        return Jenkins.READ;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MTY3Mg=="}, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE3NjgyMw==", "bodyText": "I mean the PR that introduce the SYSTEM_READ permission.\nCLI and Nodes pages are available to any user, so no need to hide them on Manage from any user who can access that page.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r417176823", "createdAt": "2020-04-29T09:17:43Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/jenkins/management/NodesLink.java", "diffHunk": "@@ -55,7 +55,7 @@ public String getDescription() {\n     @NonNull\n     @Override\n     public Permission getRequiredPermission() {\n-        return Jenkins.MANAGE;\n+        return Jenkins.READ;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MTY3Mg=="}, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA5NDAyNA==", "bodyText": "IOW, you should change \n  \n    \n      jenkins/core/src/main/java/jenkins/management/CliLink.java\n    \n    \n         Line 58\n      in\n      6fb8b93\n    \n    \n    \n    \n\n        \n          \n           return Jenkins.MANAGE; \n        \n    \n  \n\n \ud83d\ude03", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419094024", "createdAt": "2020-05-03T12:05:52Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/jenkins/management/NodesLink.java", "diffHunk": "@@ -55,7 +55,7 @@ public String getDescription() {\n     @NonNull\n     @Override\n     public Permission getRequiredPermission() {\n-        return Jenkins.MANAGE;\n+        return Jenkins.READ;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MTY3Mg=="}, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NDQzODI0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/Functions.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1Mjo1N1rOGNrNLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwODoxMToxMFrOGN0LKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MjU1Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        List<Ancestor> ancs = Stapler.getCurrentRequest().getAncestors();\n          \n          \n            \n                        AccessControlled ac = Stapler.getCurrentRequest().findAncestorObject(AccessControlled.class);\n          \n      \n    \n    \n  \n\netc.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416992557", "createdAt": "2020-04-28T23:52:57Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/Functions.java", "diffHunk": "@@ -1156,6 +1157,45 @@ public static String getFooterURL() {\n                 Jenkins.get().hasPermission(d.getRequiredGlobalConfigPagePermission()) || Jenkins.get().hasPermission(Jenkins.SYSTEM_READ)));\n     }\n \n+    /**\n+     * Checks if the current security principal has one of the supplied permissions.\n+     *\n+     * @since TODO\n+     */\n+    public static boolean hasAnyPermission(AccessControlled ac, Permission[] permissions) {\n+        if (permissions == null || permissions.length == 0) {\n+            return true;\n+        }\n+\n+        return ac.hasAnyPermission(permissions);\n+    }\n+\n+    /**\n+     * This version is so that the 'hasAnyPermission'\n+     * degrades gracefully if \"it\" is not an {@link AccessControlled} object.\n+     * Otherwise it will perform no check and that problem is hard to notice.\n+     *\n+     * @since TODO\n+     */\n+    public static boolean hasAnyPermission(Object object, Permission[] permissions) throws IOException, ServletException {\n+        if (permissions == null || permissions.length == 0) {\n+            return true;\n+        }\n+\n+        if (object instanceof AccessControlled)\n+            return hasAnyPermission((AccessControlled) object, permissions);\n+        else {\n+            List<Ancestor> ancs = Stapler.getCurrentRequest().getAncestors();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEzOTQ5OA==", "bodyText": "bb85534", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r417139498", "createdAt": "2020-04-29T08:11:10Z", "author": {"login": "timja"}, "path": "core/src/main/java/hudson/Functions.java", "diffHunk": "@@ -1156,6 +1157,45 @@ public static String getFooterURL() {\n                 Jenkins.get().hasPermission(d.getRequiredGlobalConfigPagePermission()) || Jenkins.get().hasPermission(Jenkins.SYSTEM_READ)));\n     }\n \n+    /**\n+     * Checks if the current security principal has one of the supplied permissions.\n+     *\n+     * @since TODO\n+     */\n+    public static boolean hasAnyPermission(AccessControlled ac, Permission[] permissions) {\n+        if (permissions == null || permissions.length == 0) {\n+            return true;\n+        }\n+\n+        return ac.hasAnyPermission(permissions);\n+    }\n+\n+    /**\n+     * This version is so that the 'hasAnyPermission'\n+     * degrades gracefully if \"it\" is not an {@link AccessControlled} object.\n+     * Otherwise it will perform no check and that problem is hard to notice.\n+     *\n+     * @since TODO\n+     */\n+    public static boolean hasAnyPermission(Object object, Permission[] permissions) throws IOException, ServletException {\n+        if (permissions == null || permissions.length == 0) {\n+            return true;\n+        }\n+\n+        if (object instanceof AccessControlled)\n+            return hasAnyPermission((AccessControlled) object, permissions);\n+        else {\n+            List<Ancestor> ancs = Stapler.getCurrentRequest().getAncestors();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MjU1Nw=="}, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NDQ0MDQ5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/Functions.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1Mzo1M1rOGNrOgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwNzoxNDo1MlrOGPDwfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5Mjg5Ng==", "bodyText": "\u2764\ufe0f", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416992896", "createdAt": "2020-04-28T23:53:53Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/Functions.java", "diffHunk": "@@ -2021,6 +2061,10 @@ public String getPasswordValue(Object o) {\n                 if (item != null && !item.hasPermission(Item.CONFIGURE)) {\n                     return \"********\";\n                 }\n+                Computer computer = req.findAncestorObject(Computer.class);\n+                if (computer != null && !computer.hasPermission(Computer.CONFIGURE)) {\n+                    return \"********\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ0MzM4OA==", "bodyText": "I do not know a plugin which would be wrongly affected by that.\nI can imagine a Computer action which has a form with credentials, but it is much more likely for Jobs which has been added 4 years ago", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r418443388", "createdAt": "2020-05-01T07:14:52Z", "author": {"login": "oleg-nenashev"}, "path": "core/src/main/java/hudson/Functions.java", "diffHunk": "@@ -2021,6 +2061,10 @@ public String getPasswordValue(Object o) {\n                 if (item != null && !item.hasPermission(Item.CONFIGURE)) {\n                     return \"********\";\n                 }\n+                Computer computer = req.findAncestorObject(Computer.class);\n+                if (computer != null && !computer.hasPermission(Computer.CONFIGURE)) {\n+                    return \"********\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5Mjg5Ng=="}, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NDQ0MzI2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/model/Computer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1NToxM1rOGNrQKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1NToxM1rOGNrQKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MzMyMA==", "bodyText": "Extended Read is implied by Configure, so all of this is unnecessary.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416993320", "createdAt": "2020-04-28T23:55:13Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/model/Computer.java", "diffHunk": "@@ -1804,6 +1804,14 @@ public long getWhen() {\n     public static final Permission CONNECT = new Permission(PERMISSIONS,\"Connect\", Messages._Computer_ConnectPermission_Description(), DISCONNECT, PermissionScope.COMPUTER);\n     public static final Permission BUILD = new Permission(PERMISSIONS, \"Build\", Messages._Computer_BuildPermission_Description(),  Permission.WRITE, PermissionScope.COMPUTER);\n \n+    @Restricted(NoExternalUse.class) // called by jelly\n+    public static final Permission[] EXTENDED_READ_AND_CONFIGURE =\n+            new Permission[] { EXTENDED_READ, CONFIGURE };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NDQ0MzUwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/model/Computer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1NToyMVrOGNrQUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1NToyMVrOGNrQUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MzM2MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        new Permission[] { EXTENDED_READ, CONFIGURE };\n          \n          \n            \n                        new Permission[] { EXTENDED_READ, CONNECT };", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416993360", "createdAt": "2020-04-28T23:55:21Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/model/Computer.java", "diffHunk": "@@ -1804,6 +1804,14 @@ public long getWhen() {\n     public static final Permission CONNECT = new Permission(PERMISSIONS,\"Connect\", Messages._Computer_ConnectPermission_Description(), DISCONNECT, PermissionScope.COMPUTER);\n     public static final Permission BUILD = new Permission(PERMISSIONS, \"Build\", Messages._Computer_BuildPermission_Description(),  Permission.WRITE, PermissionScope.COMPUTER);\n \n+    @Restricted(NoExternalUse.class) // called by jelly\n+    public static final Permission[] EXTENDED_READ_AND_CONFIGURE =\n+            new Permission[] { EXTENDED_READ, CONFIGURE };\n+\n+    @Restricted(NoExternalUse.class) // called by jelly\n+    public static final Permission[] EXTENDED_READ_AND_CONNECT =\n+            new Permission[] { EXTENDED_READ, CONFIGURE };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NDQ0NDAwOnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/hudson/model/Computer/configure.jelly", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1NTo0MVrOGNrQow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1NTo0MVrOGNrQow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MzQ0Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              <l:layout permissions=\"${it.EXTENDED_READ_AND_CONFIGURE}\" title=\"${%title(it.displayName)}\">\n          \n          \n            \n              <l:layout permissions=\"${it.EXTENDED_READ}\" title=\"${%title(it.displayName)}\">\n          \n      \n    \n    \n  \n\nShould be good enough given the implication.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416993443", "createdAt": "2020-04-28T23:55:41Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/Computer/configure.jelly", "diffHunk": "@@ -28,7 +28,15 @@ THE SOFTWARE.\n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\"\n          xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\">\n-  <l:layout permission=\"${it.CONFIGURE}\" title=\"${%title(it.displayName)}\">\n+  <l:layout permissions=\"${it.EXTENDED_READ_AND_CONFIGURE}\" title=\"${%title(it.displayName)}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NDQ0NTA3OnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/hudson/model/Computer/sidepanel.jelly", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1NjowM1rOGNrRLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1NjowM1rOGNrRLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5MzU4MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permissions=\"${it.EXTENDED_READ_AND_CONFIGURE}\" title=\"${%Configure}\"/>\n          \n          \n            \n                  <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permissions=\"${it.EXTENDED_READ}\" title=\"${%Configure}\"/>", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416993581", "createdAt": "2020-04-28T23:56:03Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/Computer/sidepanel.jelly", "diffHunk": "@@ -33,7 +33,7 @@ THE SOFTWARE.\n       <l:task contextMenu=\"false\" href=\"${rootURL}/computer\" icon=\"icon-up icon-md\" title=\"${%Back to List}\"/>\n       <l:task contextMenu=\"false\" href=\"${rootURL}/${it.url}\" icon=\"icon-search icon-md\" title=\"${%Status}\"/>\n       <l:task href=\"${rootURL}/${it.url}delete\" icon=\"icon-edit-delete icon-md\" permission=\"${it.DELETE}\" title=\"${%Delete Agent}\"/>\n-      <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permission=\"${it.CONFIGURE}\" title=\"${%Configure}\"/>\n+      <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permissions=\"${it.EXTENDED_READ_AND_CONFIGURE}\" title=\"${%Configure}\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NDQ0Nzg3OnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/hudson/model/ComputerSet/configure.jelly", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1NzowNlrOGNrSwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1NzowNlrOGNrSwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5Mzk4Ng==", "bodyText": "FYI @EstherAF This is probably something to open up to users with Overall/Manage permission.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416993986", "createdAt": "2020-04-28T23:57:06Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/ComputerSet/configure.jelly", "diffHunk": "@@ -27,7 +27,15 @@ THE SOFTWARE.\n -->\n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\" xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\" xmlns:i=\"jelly:fmt\">\n-  <l:layout permission=\"${app.ADMINISTER}\" title=\"${%Node Monitoring Configuration}\">\n+  <l:layout permission=\"${app.SYSTEM_READ}\" title=\"${%Node Monitoring Configuration}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NDQ1MjM1OnYy", "diffSide": "LEFT", "path": "core/src/main/resources/hudson/slaves/SlaveComputer/log.jelly", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMzo1OToxN1rOGNrVZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQwOToxODoxMVrOGN2d4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5NDY2Mg==", "bodyText": "\ud83d\ude15", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r416994662", "createdAt": "2020-04-28T23:59:17Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/slaves/SlaveComputer/log.jelly", "diffHunk": "@@ -24,23 +24,21 @@ THE SOFTWARE.\n \n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\" xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\" xmlns:i=\"jelly:fmt\">\n-  <l:layout title=\"${it.displayName} log\" secured=\"true\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEyNjY4Mg==", "bodyText": "? secured does nothing, the permission check was done further down before", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r417126682", "createdAt": "2020-04-29T07:47:10Z", "author": {"login": "timja"}, "path": "core/src/main/resources/hudson/slaves/SlaveComputer/log.jelly", "diffHunk": "@@ -24,23 +24,21 @@ THE SOFTWARE.\n \n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\" xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\" xmlns:i=\"jelly:fmt\">\n-  <l:layout title=\"${it.displayName} log\" secured=\"true\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5NDY2Mg=="}, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE3NzA1OA==", "bodyText": "Yeah just confusing, old, dead code \ud83d\ude2d", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r417177058", "createdAt": "2020-04-29T09:18:11Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/slaves/SlaveComputer/log.jelly", "diffHunk": "@@ -24,23 +24,21 @@ THE SOFTWARE.\n \n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\" xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\" xmlns:i=\"jelly:fmt\">\n-  <l:layout title=\"${it.displayName} log\" secured=\"true\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk5NDY2Mg=="}, "originalCommit": {"oid": "393ad7f6cb8050c70f4793ba194e909fb07d2888"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwMzY3MzIyOnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/hudson/model/ComputerSet/sidepanel.jelly", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMVQwNzoxODoxN1rOGPDzXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQwODoxOToxMlrOGP2qOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ0NDEyNQ==", "bodyText": "We should probably generalize common sidepanel controls to avoid different behavior on screens. It will likely also help @fqueiruga with the sidepanel restructuring proposal. Not required for this PR", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r418444125", "createdAt": "2020-05-01T07:18:17Z", "author": {"login": "oleg-nenashev"}, "path": "core/src/main/resources/hudson/model/ComputerSet/sidepanel.jelly", "diffHunk": "@@ -32,10 +32,10 @@ THE SOFTWARE.\n     <j:getStatic var=\"createPermission\" className=\"hudson.model.Computer\" field=\"CREATE\"/>\n     <l:tasks>\n       <l:task href=\"${rootURL}/\" icon=\"icon-up icon-md\" title=\"${%Back to Dashboard}\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c074b104f8ee45d7a3c7a6d0e9fe3d066fbcc387"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3NzM3MQ==", "bodyText": "I agree. I have no idea how to go about it though", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419277371", "createdAt": "2020-05-04T08:19:12Z", "author": {"login": "fqueiruga"}, "path": "core/src/main/resources/hudson/model/ComputerSet/sidepanel.jelly", "diffHunk": "@@ -32,10 +32,10 @@ THE SOFTWARE.\n     <j:getStatic var=\"createPermission\" className=\"hudson.model.Computer\" field=\"CREATE\"/>\n     <l:tasks>\n       <l:task href=\"${rootURL}/\" icon=\"icon-up icon-md\" title=\"${%Back to Dashboard}\"/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ0NDEyNQ=="}, "originalCommit": {"oid": "c074b104f8ee45d7a3c7a6d0e9fe3d066fbcc387"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwODQ4NTI4OnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/hudson/model/ComputerSet/configure.jelly", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxMjowMjo0NlrOGPrceg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxMjowMjo0NlrOGPrceg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA5MzYyNg==", "bodyText": "I wonder whether this could be simplified to\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    <j:set var=\"readOnlyMode\" value=\"true\" />\n          \n          \n            \n                    <j:set var=\"readOnlyMode\" value=\"${app.hasPermission(app.ADMINISTER)}\" />\n          \n      \n    \n    \n  \n\nIf so, perhaps in a followup cleanup PR.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419093626", "createdAt": "2020-05-03T12:02:46Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/ComputerSet/configure.jelly", "diffHunk": "@@ -27,7 +27,15 @@ THE SOFTWARE.\n -->\n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\" xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\" xmlns:i=\"jelly:fmt\">\n-  <l:layout permission=\"${app.ADMINISTER}\" title=\"${%Node Monitoring Configuration}\">\n+  <l:layout permission=\"${app.SYSTEM_READ}\" title=\"${%Node Monitoring Configuration}\">\n+    <j:choose>\n+      <j:when test=\"${app.hasPermission(app.ADMINISTER)}\">\n+        <j:set var=\"readOnlyMode\" value=\"false\" />\n+      </j:when>\n+      <j:otherwise>\n+        <j:set var=\"readOnlyMode\" value=\"true\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c074b104f8ee45d7a3c7a6d0e9fe3d066fbcc387"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwODQ4NzU0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/hudson/Functions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxMjowNDo0MFrOGPrdhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxMjowNDo0MFrOGPrdhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA5Mzg5NA==", "bodyText": "This behavior is shitty and broken, but if we're going to address it in #hasPermission, we can also fix up this.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419093894", "createdAt": "2020-05-03T12:04:40Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/hudson/Functions.java", "diffHunk": "@@ -1156,6 +1157,43 @@ public static String getFooterURL() {\n                 Jenkins.get().hasPermission(d.getRequiredGlobalConfigPagePermission()) || Jenkins.get().hasPermission(Jenkins.SYSTEM_READ)));\n     }\n \n+    /**\n+     * Checks if the current security principal has one of the supplied permissions.\n+     *\n+     * @since TODO\n+     */\n+    public static boolean hasAnyPermission(AccessControlled ac, Permission[] permissions) {\n+        if (permissions == null || permissions.length == 0) {\n+            return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c074b104f8ee45d7a3c7a6d0e9fe3d066fbcc387"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwODQ5NDU2OnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/lib/layout/task.jelly", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxMjoxMjoxNFrOGPrhBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxMjoxMjoxNFrOGPrhBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA5NDc4OQ==", "bodyText": "Questionable semantics when both attributes are specified? Unsure. Should be documented what happens when you do both, and it should be consistent with /lib/layout.jelly.\nPlus I wonder as before whether this could be simplified to\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    <j:set var=\"hasPermission\" value=\"false\" />\n          \n          \n            \n                    <j:set var=\"hasPermission\" value=\"${h.hasAnyPermission(it, attrs.permissions)}\" />\n          \n      \n    \n    \n  \n\nplus delete a bunch of surrounding lines (obviously only if we're OK with the current behavior).", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419094789", "createdAt": "2020-05-03T12:12:14Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/lib/layout/task.jelly", "diffHunk": "@@ -84,8 +88,33 @@ THE SOFTWARE.\n     <j:set var=\"taskMatching\" value=\"${context.parent}\"/>\n     <d:invokeBody />\n   </j:scope>\n+  <j:if test=\"${attrs.permission != null}\">\n+    <j:choose>\n+      <j:when test=\"${h.hasPermission(it, attrs.permission)}\">\n+        <j:set var=\"hasPermission\" value=\"true\" />\n+      </j:when>\n+      <j:otherwise>\n+        <j:set var=\"hasPermission\" value=\"false\" />\n+      </j:otherwise>\n+    </j:choose>\n+  </j:if>\n+\n+  <j:if test=\"${attrs.permissions != null}\">\n+    <j:choose>\n+      <j:when test=\"${h.hasAnyPermission(it, attrs.permissions)}\">\n+        <j:set var=\"hasPermission\" value=\"true\" />\n+      </j:when>\n+      <j:otherwise>\n+        <j:set var=\"hasPermission\" value=\"false\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c074b104f8ee45d7a3c7a6d0e9fe3d066fbcc387"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwODY0MTQyOnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/lib/layout/task.jelly", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxNDo0ODowM1rOGPsrcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxNDo0ODowM1rOGPsrcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTExMzg0Mg==", "bodyText": "Same simplification can be applied to permission above (again, not necessary, just nice to have).", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419113842", "createdAt": "2020-05-03T14:48:03Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/lib/layout/task.jelly", "diffHunk": "@@ -100,14 +104,7 @@ THE SOFTWARE.\n   </j:if>\n \n   <j:if test=\"${attrs.permissions != null}\">\n-    <j:choose>\n-      <j:when test=\"${h.hasAnyPermission(it, attrs.permissions)}\">\n-        <j:set var=\"hasPermission\" value=\"true\" />\n-      </j:when>\n-      <j:otherwise>\n-        <j:set var=\"hasPermission\" value=\"false\" />\n-      </j:otherwise>\n-    </j:choose>\n+    <j:set var=\"hasPermission\" value=\"${h.hasAnyPermission(it, attrs.permissions)}\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e22c9ce0083d7e7dd01510d3e3736f456213af5a"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwODY1ODAxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/slaves/systemInfo/SlaveSystemInfo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxNTowMzozN1rOGPszoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxNTowMzozN1rOGPszoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTExNTkzNw==", "bodyText": "This approach looks reasonable. \ud83d\udc4d", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419115937", "createdAt": "2020-05-03T15:03:37Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/jenkins/slaves/systemInfo/SlaveSystemInfo.java", "diffHunk": "@@ -24,4 +27,14 @@\n     public static ExtensionList<SlaveSystemInfo> all() {\n         return ExtensionList.lookup(SlaveSystemInfo.class);\n     }\n+\n+    /**\n+     * Returns the permission required for user to see this system info extension on the \"System Information\" page for the Agent\n+     *\n+     *\n+     * @return the permission required for the extension to be shown on \"System Information\".\n+     */\n+    public Permission getRequiredPermission() {\n+        return Computer.CONNECT;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1962ae6c320ca462227d69b6990ed53e8e1b2ae"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYwODY1OTY3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/jenkins/slaves/systemInfo/SlaveSystemInfo.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxNTowNTowOVrOGPs0cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QxNTowNTowOVrOGPs0cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTExNjE0Nw==", "bodyText": "I would like to see more than the bare minimum of Javadoc here, see e.g. \n  \n    \n      jenkins/core/src/main/java/hudson/model/AdministrativeMonitor.java\n    \n    \n        Lines 170 to 185\n      in\n      7b654b2\n    \n    \n    \n    \n\n        \n          \n               /** \n        \n\n        \n          \n                * Required permission to view this admin monitor. \n        \n\n        \n          \n                * By default {@link Jenkins#ADMINISTER}, but {@link Jenkins#SYSTEM_READ} is also supported. \n        \n\n        \n          \n                * <p> \n        \n\n        \n          \n                *     Changing this permission check to return {@link Jenkins#SYSTEM_READ} will make the active \n        \n\n        \n          \n                *     administrative monitor appear on {@code manage.jelly} and on the globally visible \n        \n\n        \n          \n                *     {@link jenkins.management.AdministrativeMonitorsDecorator} to users without Administer permission. \n        \n\n        \n          \n                *     {@link #doDisable(StaplerRequest, StaplerResponse)} will still always require Administer permission. \n        \n\n        \n          \n                * </p> \n        \n\n        \n          \n                * <p> \n        \n\n        \n          \n                *     Implementers need to ensure that {@code doAct} and other web methods perform necessary permission checks: \n        \n\n        \n          \n                *     Users with System Read permissions are expected to be limited to read-only access. \n        \n\n        \n          \n                *     Form UI elements that change system state, e.g. toggling a feature on or off, need to be hidden from users \n        \n\n        \n          \n                *     lacking Administer permission. \n        \n\n        \n          \n                * </p> \n        \n\n        \n          \n                */ \n        \n    \n  \n\n for comparison. Of course, this is a far simpler extension point, but at least supported (useful) values would make sense, and what the default is.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r419116147", "createdAt": "2020-05-03T15:05:09Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/java/jenkins/slaves/systemInfo/SlaveSystemInfo.java", "diffHunk": "@@ -24,4 +27,14 @@\n     public static ExtensionList<SlaveSystemInfo> all() {\n         return ExtensionList.lookup(SlaveSystemInfo.class);\n     }\n+\n+    /**\n+     * Returns the permission required for user to see this system info extension on the \"System Information\" page for the Agent", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1962ae6c320ca462227d69b6990ed53e8e1b2ae"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyNzYzNDM4OnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/hudson/model/Computer/sidepanel.jelly", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMDoxNjowOFrOGSgt-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxMzo1ODowMFrOGSmf-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA2MzYwOA==", "bodyText": "Looks like the same mistake that made all job configurations read-only?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    <j:when test=\"${app.hasPermission(it.CONFIGURE)}\">\n          \n          \n            \n                    <j:when test=\"${it.hasPermission(it.CONFIGURE)}\">", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r422063608", "createdAt": "2020-05-08T10:16:08Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/Computer/sidepanel.jelly", "diffHunk": "@@ -33,7 +33,17 @@ THE SOFTWARE.\n       <l:task contextMenu=\"false\" href=\"${rootURL}/computer\" icon=\"icon-up icon-md\" title=\"${%Back to List}\"/>\n       <l:task contextMenu=\"false\" href=\"${rootURL}/${it.url}\" icon=\"icon-search icon-md\" title=\"${%Status}\"/>\n       <l:task href=\"${rootURL}/${it.url}delete\" icon=\"icon-edit-delete icon-md\" permission=\"${it.DELETE}\" title=\"${%Delete Agent}\"/>\n-      <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permission=\"${it.EXTENDED_READ}\" title=\"${%Configure}\"/>\n+\n+      <j:choose>\n+        <j:when test=\"${app.hasPermission(it.CONFIGURE)}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7146b7ac40c9ba1974f41e8029215419e496ac81"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA2NTgyMg==", "bodyText": "seems to work though, =/", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r422065822", "createdAt": "2020-05-08T10:21:50Z", "author": {"login": "timja"}, "path": "core/src/main/resources/hudson/model/Computer/sidepanel.jelly", "diffHunk": "@@ -33,7 +33,17 @@ THE SOFTWARE.\n       <l:task contextMenu=\"false\" href=\"${rootURL}/computer\" icon=\"icon-up icon-md\" title=\"${%Back to List}\"/>\n       <l:task contextMenu=\"false\" href=\"${rootURL}/${it.url}\" icon=\"icon-search icon-md\" title=\"${%Status}\"/>\n       <l:task href=\"${rootURL}/${it.url}delete\" icon=\"icon-edit-delete icon-md\" permission=\"${it.DELETE}\" title=\"${%Delete Agent}\"/>\n-      <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permission=\"${it.EXTENDED_READ}\" title=\"${%Configure}\"/>\n+\n+      <j:choose>\n+        <j:when test=\"${app.hasPermission(it.CONFIGURE)}\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA2MzYwOA=="}, "originalCommit": {"oid": "7146b7ac40c9ba1974f41e8029215419e496ac81"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA2Njc2NQ==", "bodyText": "I've committed it but both seem to work in this case from what I can see", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r422066765", "createdAt": "2020-05-08T10:24:16Z", "author": {"login": "timja"}, "path": "core/src/main/resources/hudson/model/Computer/sidepanel.jelly", "diffHunk": "@@ -33,7 +33,17 @@ THE SOFTWARE.\n       <l:task contextMenu=\"false\" href=\"${rootURL}/computer\" icon=\"icon-up icon-md\" title=\"${%Back to List}\"/>\n       <l:task contextMenu=\"false\" href=\"${rootURL}/${it.url}\" icon=\"icon-search icon-md\" title=\"${%Status}\"/>\n       <l:task href=\"${rootURL}/${it.url}delete\" icon=\"icon-edit-delete icon-md\" permission=\"${it.DELETE}\" title=\"${%Delete Agent}\"/>\n-      <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permission=\"${it.EXTENDED_READ}\" title=\"${%Configure}\"/>\n+\n+      <j:choose>\n+        <j:when test=\"${app.hasPermission(it.CONFIGURE)}\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA2MzYwOA=="}, "originalCommit": {"oid": "7146b7ac40c9ba1974f41e8029215419e496ac81"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE0OTE2NA==", "bodyText": "Don't grant the permission globally, use project-specific matrix auth and grant it on the specific agent only.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r422149164", "createdAt": "2020-05-08T13:41:00Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/Computer/sidepanel.jelly", "diffHunk": "@@ -33,7 +33,17 @@ THE SOFTWARE.\n       <l:task contextMenu=\"false\" href=\"${rootURL}/computer\" icon=\"icon-up icon-md\" title=\"${%Back to List}\"/>\n       <l:task contextMenu=\"false\" href=\"${rootURL}/${it.url}\" icon=\"icon-search icon-md\" title=\"${%Status}\"/>\n       <l:task href=\"${rootURL}/${it.url}delete\" icon=\"icon-edit-delete icon-md\" permission=\"${it.DELETE}\" title=\"${%Delete Agent}\"/>\n-      <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permission=\"${it.EXTENDED_READ}\" title=\"${%Configure}\"/>\n+\n+      <j:choose>\n+        <j:when test=\"${app.hasPermission(it.CONFIGURE)}\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA2MzYwOA=="}, "originalCommit": {"oid": "7146b7ac40c9ba1974f41e8029215419e496ac81"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE1ODExNw==", "bodyText": "Hmm ? That\u2019s what\u2019s there now isn\u2019t it?", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r422158117", "createdAt": "2020-05-08T13:57:37Z", "author": {"login": "timja"}, "path": "core/src/main/resources/hudson/model/Computer/sidepanel.jelly", "diffHunk": "@@ -33,7 +33,17 @@ THE SOFTWARE.\n       <l:task contextMenu=\"false\" href=\"${rootURL}/computer\" icon=\"icon-up icon-md\" title=\"${%Back to List}\"/>\n       <l:task contextMenu=\"false\" href=\"${rootURL}/${it.url}\" icon=\"icon-search icon-md\" title=\"${%Status}\"/>\n       <l:task href=\"${rootURL}/${it.url}delete\" icon=\"icon-edit-delete icon-md\" permission=\"${it.DELETE}\" title=\"${%Delete Agent}\"/>\n-      <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permission=\"${it.EXTENDED_READ}\" title=\"${%Configure}\"/>\n+\n+      <j:choose>\n+        <j:when test=\"${app.hasPermission(it.CONFIGURE)}\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA2MzYwOA=="}, "originalCommit": {"oid": "7146b7ac40c9ba1974f41e8029215419e496ac81"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE1ODMzMQ==", "bodyText": "Ah you mean when I was testing before sure", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r422158331", "createdAt": "2020-05-08T13:58:00Z", "author": {"login": "timja"}, "path": "core/src/main/resources/hudson/model/Computer/sidepanel.jelly", "diffHunk": "@@ -33,7 +33,17 @@ THE SOFTWARE.\n       <l:task contextMenu=\"false\" href=\"${rootURL}/computer\" icon=\"icon-up icon-md\" title=\"${%Back to List}\"/>\n       <l:task contextMenu=\"false\" href=\"${rootURL}/${it.url}\" icon=\"icon-search icon-md\" title=\"${%Status}\"/>\n       <l:task href=\"${rootURL}/${it.url}delete\" icon=\"icon-edit-delete icon-md\" permission=\"${it.DELETE}\" title=\"${%Delete Agent}\"/>\n-      <l:task href=\"${rootURL}/${it.url}configure\" icon=\"icon-setting icon-md\" permission=\"${it.EXTENDED_READ}\" title=\"${%Configure}\"/>\n+\n+      <j:choose>\n+        <j:when test=\"${app.hasPermission(it.CONFIGURE)}\">", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjA2MzYwOA=="}, "originalCommit": {"oid": "7146b7ac40c9ba1974f41e8029215419e496ac81"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYyODM4NTA5OnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/hudson/model/Computer/configure.jelly", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNDozNDowOVrOGSnvfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNDozNDowOVrOGSnvfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE3ODY4Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  <j:when test=\"${app.hasPermission(it.CONFIGURE)}\">\n          \n          \n            \n                  <j:when test=\"${it.hasPermission(it.CONFIGURE)}\">\n          \n      \n    \n    \n  \n\nSame as #4531 (comment), this is basically https://issues.jenkins-ci.org/browse/JENKINS-61321 all over, just for agents.\nSee jenkinsci/matrix-auth-plugin@827c538#diff-127b3ccbc7bfa4e2588688b2ea4107b1R108-R122 for a test making the difference clear (I hope).", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r422178687", "createdAt": "2020-05-08T14:34:09Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/Computer/configure.jelly", "diffHunk": "@@ -28,7 +28,15 @@ THE SOFTWARE.\n <?jelly escape-by-default='true'?>\n <j:jelly xmlns:j=\"jelly:core\" xmlns:st=\"jelly:stapler\" xmlns:d=\"jelly:define\" xmlns:l=\"/lib/layout\"\n          xmlns:t=\"/lib/hudson\" xmlns:f=\"/lib/form\">\n-  <l:layout permission=\"${it.CONFIGURE}\" title=\"${%title(it.displayName)}\">\n+  <l:layout permission=\"${it.EXTENDED_READ}\" title=\"${%title(it.displayName)}\">\n+    <j:choose>\n+      <j:when test=\"${app.hasPermission(it.CONFIGURE)}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86de15b24ec3cee9af607108ed4f7a65ba8692e5"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDUxMDA4OnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/hudson/model/ComputerSet/sidepanel.jelly", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwOTo1ODo1NFrOGXY-2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNTozNTowMlrOGXmWnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE3OTczOA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      <j:set var=\"configureCloudsTitle\" value=\"${%Configure Clouds}\"/>\n          \n          \n            \n                      <j:set var=\"configureCloudsTitle\" value=\"${app.hasPermission(app.ADMINISTER) ? '%Configure Clouds' : '%View Clouds'}\"/>\n          \n      \n    \n    \n  \n\nPlus corresponding changes to surrounding lines.\nThis should work too. Often not really readable, and annoying to find occurrences of, but FYI. (Not a real suggestion.)", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r427179738", "createdAt": "2020-05-19T09:58:54Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/ComputerSet/sidepanel.jelly", "diffHunk": "@@ -32,12 +32,20 @@ THE SOFTWARE.\n     <j:getStatic var=\"createPermission\" className=\"hudson.model.Computer\" field=\"CREATE\"/>\n     <l:tasks>\n       <l:task href=\"${rootURL}/\" icon=\"icon-up icon-md\" title=\"${%Back to Dashboard}\"/>\n-      <l:task href=\"${rootURL}/manage\" icon=\"icon-gear2 icon-md\" permission=\"${app.MANAGE}\" title=\"${%Manage Jenkins}\"/>\n+      <l:task href=\"${rootURL}/manage\" icon=\"icon-gear2 icon-md\" permissions=\"${app.MANAGE_AND_SYSTEM_READ}\" title=\"${%Manage Jenkins}\"/>\n       <l:task href=\"new\" icon=\"icon-new-computer icon-md\" permission=\"${createPermission}\" title=\"${%New Node}\"/>\n-      <l:task href=\"${rootURL}/configureClouds\" icon=\"icon-health-40to59 icon-md\" permission=\"${app.ADMINISTER}\" title=\"${%Configure Clouds}\"/>\n-      <l:task href=\"configure\" icon=\"icon-gear2 icon-md\" permission=\"${app.ADMINISTER}\" title=\"${%Node Monitoring}\"/>\n+      <j:choose>\n+        <j:when test=\"${app.hasPermission(app.ADMINISTER)}\">\n+          <j:set var=\"configureCloudsTitle\" value=\"${%Configure Clouds}\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31c35d6ba6999e9ea316fff3222b405c96e5ac47"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM5ODgxMg==", "bodyText": "@timja You're a monster \ud83d\ude04", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r427398812", "createdAt": "2020-05-19T15:35:02Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/ComputerSet/sidepanel.jelly", "diffHunk": "@@ -32,12 +32,20 @@ THE SOFTWARE.\n     <j:getStatic var=\"createPermission\" className=\"hudson.model.Computer\" field=\"CREATE\"/>\n     <l:tasks>\n       <l:task href=\"${rootURL}/\" icon=\"icon-up icon-md\" title=\"${%Back to Dashboard}\"/>\n-      <l:task href=\"${rootURL}/manage\" icon=\"icon-gear2 icon-md\" permission=\"${app.MANAGE}\" title=\"${%Manage Jenkins}\"/>\n+      <l:task href=\"${rootURL}/manage\" icon=\"icon-gear2 icon-md\" permissions=\"${app.MANAGE_AND_SYSTEM_READ}\" title=\"${%Manage Jenkins}\"/>\n       <l:task href=\"new\" icon=\"icon-new-computer icon-md\" permission=\"${createPermission}\" title=\"${%New Node}\"/>\n-      <l:task href=\"${rootURL}/configureClouds\" icon=\"icon-health-40to59 icon-md\" permission=\"${app.ADMINISTER}\" title=\"${%Configure Clouds}\"/>\n-      <l:task href=\"configure\" icon=\"icon-gear2 icon-md\" permission=\"${app.ADMINISTER}\" title=\"${%Node Monitoring}\"/>\n+      <j:choose>\n+        <j:when test=\"${app.hasPermission(app.ADMINISTER)}\">\n+          <j:set var=\"configureCloudsTitle\" value=\"${%Configure Clouds}\"/>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE3OTczOA=="}, "originalCommit": {"oid": "31c35d6ba6999e9ea316fff3222b405c96e5ac47"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MDUyOTA1OnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/jenkins/model/GlobalCloudConfiguration/index.groovy", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMDowMzo0OVrOGXZKbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxMDo1ODoxOVrOGXa_1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE4MjcwMQ==", "bodyText": "The link to the plugin manager two lines below should probably be conditional on having Administer? While the link isn't broken, it's not that useful. OTOH it would inform which plugins need installing out of band. Unsure.", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r427182701", "createdAt": "2020-05-19T10:03:49Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/jenkins/model/GlobalCloudConfiguration/index.groovy", "diffHunk": "@@ -21,25 +22,31 @@ l.layout(norefresh:true, permission:app.ADMINISTER, title:my.displayName) {\n             // TODO more appropriate icon\n             text(my.displayName)\n         }\n-\n         def clouds = Cloud.all()\n-\n         if (!clouds.isEmpty()) {\n             p()\n             div(class:\"behavior-loading\", _(\"LOADING\"))\n \n             f.form(method:\"post\",name:\"config\",action:\"configure\") {\n                 f.block {\n+                    if (app.clouds.size() == 0 && !h.hasPermission(app.ADMINISTER)) {\n+                        p(_(\"No clouds have been configured.\"))\n+                    }\n+\n                     f.hetero_list(name:\"cloud\", hasHeader:true, descriptors:Cloud.all(), items:app.clouds,\n                             addCaption:_(\"Add a new cloud\"), deleteCaption:_(\"Delete cloud\"))\n                 }\n \n-                f.bottomButtonBar {\n-                    f.submit(value:_(\"Save\"))\n-                    f.apply(value:_(\"Apply\"))\n+                l.isAdmin {\n+                    f.bottomButtonBar {\n+                        f.submit(value: _(\"Save\"))\n+                        f.apply(value: _(\"Apply\"))\n+                    }\n                 }\n             }\n-            st.adjunct(includes: \"lib.form.confirm\")\n+            l.isAdmin {\n+                st.adjunct(includes: \"lib.form.confirm\")\n+            }\n         } else {\n             String label = Jenkins.get().updateCenter.getCategoryDisplayName(\"cloud\")\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "31c35d6ba6999e9ea316fff3222b405c96e5ac47"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzIxMjc1Ng==", "bodyText": "I think it's fine as it allows the user to find the plugins they could get installed", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r427212756", "createdAt": "2020-05-19T10:58:19Z", "author": {"login": "timja"}, "path": "core/src/main/resources/jenkins/model/GlobalCloudConfiguration/index.groovy", "diffHunk": "@@ -21,25 +22,31 @@ l.layout(norefresh:true, permission:app.ADMINISTER, title:my.displayName) {\n             // TODO more appropriate icon\n             text(my.displayName)\n         }\n-\n         def clouds = Cloud.all()\n-\n         if (!clouds.isEmpty()) {\n             p()\n             div(class:\"behavior-loading\", _(\"LOADING\"))\n \n             f.form(method:\"post\",name:\"config\",action:\"configure\") {\n                 f.block {\n+                    if (app.clouds.size() == 0 && !h.hasPermission(app.ADMINISTER)) {\n+                        p(_(\"No clouds have been configured.\"))\n+                    }\n+\n                     f.hetero_list(name:\"cloud\", hasHeader:true, descriptors:Cloud.all(), items:app.clouds,\n                             addCaption:_(\"Add a new cloud\"), deleteCaption:_(\"Delete cloud\"))\n                 }\n \n-                f.bottomButtonBar {\n-                    f.submit(value:_(\"Save\"))\n-                    f.apply(value:_(\"Apply\"))\n+                l.isAdmin {\n+                    f.bottomButtonBar {\n+                        f.submit(value: _(\"Save\"))\n+                        f.apply(value: _(\"Apply\"))\n+                    }\n                 }\n             }\n-            st.adjunct(includes: \"lib.form.confirm\")\n+            l.isAdmin {\n+                st.adjunct(includes: \"lib.form.confirm\")\n+            }\n         } else {\n             String label = Jenkins.get().updateCenter.getCategoryDisplayName(\"cloud\")\n ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE4MjcwMQ=="}, "originalCommit": {"oid": "31c35d6ba6999e9ea316fff3222b405c96e5ac47"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MTg2ODg5OnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/hudson/model/ComputerSet/index.jelly", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNTozNzozM1rOGXmdNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNTozNzozM1rOGXmdNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQwMDUwMQ==", "bodyText": "Different tooltip based on permission?", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r427400501", "createdAt": "2020-05-19T15:37:33Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/hudson/model/ComputerSet/index.jelly", "diffHunk": "@@ -66,7 +66,7 @@ THE SOFTWARE.\n           </j:forEach>\n \n           <td><!-- config link -->\n-            <j:if test=\"${c.hasPermission(c.CONFIGURE)}\">\n+            <j:if test=\"${c.hasPermission(c.EXTENDED_READ)}\">\n               <a href=\"${rootURL}/${c.url}configure\">\n                 <l:icon class=\"icon-gear2 icon-lg\" tooltip=\"${%Configure}\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37c712bb218162e9955a70ca86a3a6318a4af194"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2MTg3NDMxOnYy", "diffSide": "RIGHT", "path": "core/src/main/resources/jenkins/model/Jenkins/configure.jelly", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNTozODo1M1rOGXmgpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNTozODo1M1rOGXmgpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQwMTM4Mg==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/jenkinsci/jenkins/pull/4531#discussion_r427401382", "createdAt": "2020-05-19T15:38:53Z", "author": {"login": "daniel-beck"}, "path": "core/src/main/resources/jenkins/model/Jenkins/configure.jelly", "diffHunk": "@@ -54,9 +54,9 @@ THE SOFTWARE.\n         </f:rowSet>\n       </j:forEach>\n \n-      <l:isAdmin>\n+      <l:hasPermission permission=\"${app.SYSTEM_READ}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37c712bb218162e9955a70ca86a3a6318a4af194"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 857, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}