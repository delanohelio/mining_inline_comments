{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NzM3MTM5", "number": 4673, "title": "Add support for bearer tokens in Jenkins CLI", "bodyText": "See JENKINS-61965.\nProposed changelog entries\n\nSupport for Bearer tokens in Jenkins-CLI -auth parameter.\n\nProposed upgrade guidelines\nN/A", "createdAt": "2020-04-19T21:25:52Z", "url": "https://github.com/jenkinsci/jenkins/pull/4673", "merged": true, "mergeCommit": {"oid": "90f3047483b2e4184c04895d140dec28ecf3ba00"}, "closed": true, "closedAt": "2020-05-24T15:13:24Z", "author": {"login": "sorend"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaa2U3gFqTM5ODk5MDI1NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABckc-s1gFqTQxNzM2NzI5Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4OTkwMjU1", "url": "https://github.com/jenkinsci/jenkins/pull/4673#pullrequestreview-398990255", "createdAt": "2020-04-23T11:03:05Z", "commit": {"oid": "df34c19eac41125ee65b7976cd4f496f7e2b39d6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMTowMzowNlrOGKjj3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMTowNDo1MFrOGKjnhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMTU2Ng==", "bodyText": "Is it possible that the bearer token here is empty ?", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r413721566", "createdAt": "2020-04-23T11:03:06Z", "author": {"login": "sladyn98"}, "path": "cli/src/main/java/hudson/cli/CLIConnectionFactory.java", "diffHunk": "@@ -36,4 +36,19 @@ public CLIConnectionFactory basicAuth(String userInfo) {\n         return authorization(\"Basic \" + Base64.getEncoder().encodeToString(userInfo.getBytes()));\n     }\n \n+    /**\n+     * Convenience method to call {@link #authorization} with the HTTP bearer authentication.\n+     * Cf. {@code BasicHeaderApiTokenAuthenticator}.\n+     */\n+    public CLIConnectionFactory bearerAuth(String bearerToken) {\n+        return authorization(\"Bearer \" + bearerToken);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df34c19eac41125ee65b7976cd4f496f7e2b39d6"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMjIxNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                CLIConnectionFactory sut;\n          \n          \n            \n                CLIConnectionFactory cliFactory;", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r413722216", "createdAt": "2020-04-23T11:04:17Z", "author": {"login": "sladyn98"}, "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package hudson.cli;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+class CLIConnectionFactoryTest {\n+\n+    CLIConnectionFactory sut;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df34c19eac41125ee65b7976cd4f496f7e2b39d6"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMjUwMA==", "bodyText": "Would it be better if we also include  an Empty Bearer Token test ?", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r413722500", "createdAt": "2020-04-23T11:04:50Z", "author": {"login": "sladyn98"}, "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package hudson.cli;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+class CLIConnectionFactoryTest {\n+\n+    CLIConnectionFactory sut;\n+\n+    @BeforeEach\n+    void setUp() {\n+        sut = new CLIConnectionFactory();\n+    }\n+\n+    @Test\n+    void testBearerFromToken() {\n+        Assert.assertEquals(\"Bearer some-token\", sut.of(\"some-token\").authorization);\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df34c19eac41125ee65b7976cd4f496f7e2b39d6"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMzU1NDA3", "url": "https://github.com/jenkinsci/jenkins/pull/4673#pullrequestreview-403355407", "createdAt": "2020-04-30T09:32:44Z", "commit": {"oid": "1ecafd520a7df7c7b0e0cd8c2f5fa0faaf08c42a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwOTozMjo0NVrOGOhZLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwOTozMjo0NVrOGOhZLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg4MDM2Nw==", "bodyText": "This is not empty when the test name suggests so?", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r417880367", "createdAt": "2020-04-30T09:32:45Z", "author": {"login": "varyvol"}, "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package hudson.cli;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+class CLIConnectionFactoryTest {\n+\n+    CLIConnectionFactory cliFactory;\n+\n+    @BeforeEach\n+    void setUp() {\n+        cliFactory = new CLIConnectionFactory();\n+    }\n+\n+    @Test\n+    void testBearerFromToken() {\n+        Assert.assertEquals(\"Bearer some-token\", cliFactory.of(\"some-token\").authorization);\n+    }\n+\n+    @Test\n+    void testBearerFromEmptyToken() {\n+        Assert.assertEquals(\"Bearer some-token\", cliFactory.of(\"some-token\").authorization);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ecafd520a7df7c7b0e0cd8c2f5fa0faaf08c42a"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NTA4Mzc3", "url": "https://github.com/jenkinsci/jenkins/pull/4673#pullrequestreview-404508377", "createdAt": "2020-05-02T07:43:28Z", "commit": {"oid": "21c56db437c09d9e80c55da7e98b3fea36193a62"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQwNzo0MzoyOFrOGPhQZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQwNzo0NTo1MlrOGPhRZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyNjY5NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              \\                     : specify username and either password or API token (or load from them both from a file);\\n\\\n          \n          \n            \n              \\                     : specify username and  password or API token (or load from them both from a file);\\n\\", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r418926695", "createdAt": "2020-05-02T07:43:28Z", "author": {"login": "sladyn98"}, "path": "cli/src/main/resources/hudson/cli/client/Messages.properties", "diffHunk": "@@ -11,10 +11,12 @@ CLI.Usage=Jenkins CLI\\n\\\n   \\ -user               : specify user (for use with -ssh)\\n\\\n   \\ -strictHostKey      : request strict host key checking (for use with -ssh)\\n\\\n   \\ -logger FINE        : enable detailed logging from the client\\n\\\n-  \\ -auth [ USER:SECRET | @FILE ] : specify username and either password or API token (or load from them both from a file);\\n\\\n-  \\                                 for use with -http.\\n\\\n-  \\                                 Passing credentials by file is recommended.\\n\\\n-  \\                                 See https://jenkins.io/redirect/cli-http-connection-mode for more info and options.\\n\\\n+  \\ -auth [ USER:SECRET | TOKEN | @FILE ]\\n\\\n+  \\                     : specify username and either password or API token (or load from them both from a file);\\n\\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21c56db437c09d9e80c55da7e98b3fea36193a62"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyNjk0OA==", "bodyText": "Okay, I do not have a deep understanding of basicAuth here, if I understand correctly if empty token is passed it will be handled normally and therefore we do not need to test it. Might need some additional review\nCC @daniel-beck", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r418926948", "createdAt": "2020-05-02T07:45:52Z", "author": {"login": "sladyn98"}, "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package hudson.cli;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+class CLIConnectionFactoryTest {\n+\n+    CLIConnectionFactory sut;\n+\n+    @BeforeEach\n+    void setUp() {\n+        sut = new CLIConnectionFactory();\n+    }\n+\n+    @Test\n+    void testBearerFromToken() {\n+        Assert.assertEquals(\"Bearer some-token\", sut.of(\"some-token\").authorization);\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMjUwMA=="}, "originalCommit": {"oid": "df34c19eac41125ee65b7976cd4f496f7e2b39d6"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NzcyMzQ1", "url": "https://github.com/jenkinsci/jenkins/pull/4673#pullrequestreview-404772345", "createdAt": "2020-05-04T07:54:53Z", "commit": {"oid": "21c56db437c09d9e80c55da7e98b3fea36193a62"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNjMxMTAy", "url": "https://github.com/jenkinsci/jenkins/pull/4673#pullrequestreview-411631102", "createdAt": "2020-05-14T09:35:15Z", "commit": {"oid": "21c56db437c09d9e80c55da7e98b3fea36193a62"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNjMxMTA2", "url": "https://github.com/jenkinsci/jenkins/pull/4673#pullrequestreview-411631106", "createdAt": "2020-05-14T09:35:16Z", "commit": {"oid": "21c56db437c09d9e80c55da7e98b3fea36193a62"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eef34bb1e99cbc48551c1ff7a620e9a0836d1490", "author": {"user": {"login": "sorend", "name": "S\u00f8ren A D"}}, "url": "https://github.com/jenkinsci/jenkins/commit/eef34bb1e99cbc48551c1ff7a620e9a0836d1490", "committedDate": "2020-05-21T18:11:39Z", "message": "added -bearer argument to jenkins-cli"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cf88e4037b137bcf0d95d7a02e31cac3dd9b2b62", "author": {"user": {"login": "sorend", "name": "S\u00f8ren A D"}}, "url": "https://github.com/jenkinsci/jenkins/commit/cf88e4037b137bcf0d95d7a02e31cac3dd9b2b62", "committedDate": "2020-05-21T18:08:37Z", "message": "changed to bearer"}, "afterCommit": {"oid": "eef34bb1e99cbc48551c1ff7a620e9a0836d1490", "author": {"user": {"login": "sorend", "name": "S\u00f8ren A D"}}, "url": "https://github.com/jenkinsci/jenkins/commit/eef34bb1e99cbc48551c1ff7a620e9a0836d1490", "committedDate": "2020-05-21T18:11:39Z", "message": "added -bearer argument to jenkins-cli"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2Mzg2Mzkw", "url": "https://github.com/jenkinsci/jenkins/pull/4673#pullrequestreview-416386390", "createdAt": "2020-05-21T18:24:45Z", "commit": {"oid": "eef34bb1e99cbc48551c1ff7a620e9a0836d1490"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxODoyNDo0NVrOGY94BQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxODoyNDo0NVrOGY94BQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgzMjc3Mw==", "bodyText": "it is exclusive to -auth. Can we check it and say it explicitly on the help. Also -bearer is for -http I guess, and passing it with a file also applies.\nSorry for being picky, I was about to approve when you said it cannot have a \ud83d\ude04 but with the new way, I believe is worth to document it well.", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r428832773", "createdAt": "2020-05-21T18:24:45Z", "author": {"login": "MRamonLeon"}, "path": "cli/src/main/resources/hudson/cli/client/Messages.properties", "diffHunk": "@@ -15,6 +15,7 @@ CLI.Usage=Jenkins CLI\\n\\\n   \\                                 for use with -http.\\n\\\n   \\                                 Passing credentials by file is recommended.\\n\\\n   \\                                 See https://jenkins.io/redirect/cli-http-connection-mode for more info and options.\\n\\\n+  \\ -bearer [ TOKEN | @FILE ]     : specify authentication using a bearer token (or load the token from file)\\n\\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eef34bb1e99cbc48551c1ff7a620e9a0836d1490"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81412e2c648d9c6eaa5a5be2ae845d1b1ba728cb", "author": {"user": {"login": "sorend", "name": "S\u00f8ren A D"}}, "url": "https://github.com/jenkinsci/jenkins/commit/81412e2c648d9c6eaa5a5be2ae845d1b1ba728cb", "committedDate": "2020-05-22T06:04:06Z", "message": "updated message related to bearer/auth. added warning when both are used anyway."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2OTMzNzg1", "url": "https://github.com/jenkinsci/jenkins/pull/4673#pullrequestreview-416933785", "createdAt": "2020-05-22T14:01:15Z", "commit": {"oid": "81412e2c648d9c6eaa5a5be2ae845d1b1ba728cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzY3Mjky", "url": "https://github.com/jenkinsci/jenkins/pull/4673#pullrequestreview-417367292", "createdAt": "2020-05-24T15:13:11Z", "commit": {"oid": "81412e2c648d9c6eaa5a5be2ae845d1b1ba728cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1084, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}