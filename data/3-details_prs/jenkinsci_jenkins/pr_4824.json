{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMzA0NzQ3", "number": 4824, "title": "JENKINS-41805 Cleanup workspace suffixes", "bodyText": "See JENKINS-41805 and JENKINS-44909\n(JENKINS-44909 description is more specific to this fix but it's closed as a duplicate of JENKINS-41805)\n#2066 added cleanup of @tmp workspace folders, but there's other folders, @libs for pipeline libraries and @script(@tmp)? not sure where it's from but likely pipeline libraries as well.\n@libs for every workspace has a copy of all pipeline libraries loaded during a build. These are never cleaned up currently and add up over time. On our instance it's at nearly 10GB.\nI don't know if this is the best fix, possibly the plugins should cleanup their directories they create but it seems ideal to me that this is managed centrally\n\nProposed changelog entries\n\nEntry 1: JENKINS-41805, Cleanup more workspace related directories, e.g. @libs from Pipeline libraries\nEntry 2: JENKINS-41805, Developer: Add API for getting the separator for workspace related directories WorkspaceList.COMBINATOR\n...\n\n\nProposed upgrade guidelines\nN/A\nSubmitter checklist\n\n (If applicable) Jira issue is well described\n Changelog entries and upgrade guidelines are appropriate for the audience affected by the change (users or developer, depending on the change). Examples\n\nFill-in the Proposed changelog entries section only if there are breaking changes or other changes which may require extra steps from users during the upgrade\n\n\n Appropriate autotests or explanation to why this change has no tests\n For dependency updates: links to external changelogs and, if possible, full diffs\n\n\nDesired reviewers\n@mention\n\nMaintainer checklist\nBefore the changes are marked as ready-for-merge:\n\n There are at least 2 approvals for the pull request and no outstanding requests for change\n Conversations in the pull request are over OR it is explicit that a reviewer does not block the change\n Changelog entries in the PR title and/or Proposed changelog entries are correct\n Proper changelog labels are set so that the changelog can be generated automatically\n If the change needs additional upgrade steps from users, upgrade-guide-needed label is set and there is a Proposed upgrade guidelines section in the PR title. (example)\n If it would make sense to backport the change to LTS, a Jira issue must exist, be a Bug or Improvement, and be labeled as lts-candidate to be considered (see query).", "createdAt": "2020-06-29T09:46:09Z", "url": "https://github.com/jenkinsci/jenkins/pull/4824", "merged": true, "mergeCommit": {"oid": "e9dc2694db07d687d35b02d96c212c671808ec49"}, "closed": true, "closedAt": "2020-07-06T18:37:31Z", "author": {"login": "timja"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcv9mpugH2gAyNDQxMzA0NzQ3OjI4ZGFhN2Y5YTM0YTdlMjBkY2ZhMjAyMzYwNzFiY2ZjZGIxMjA0NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcw7uZ-AFqTQ0MTUyMzU5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "28daa7f9a34a7e20dcfa20236071bcfcdb120449", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/28daa7f9a34a7e20dcfa20236071bcfcdb120449", "committedDate": "2020-06-29T09:26:57Z", "message": "JENKINS-41805 Cleanup workspace suffixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MDE5NzMz", "url": "https://github.com/jenkinsci/jenkins/pull/4824#pullrequestreview-439019733", "createdAt": "2020-06-29T09:48:02Z", "commit": {"oid": "28daa7f9a34a7e20dcfa20236071bcfcdb120449"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwOTo0ODowMlrOGqLeqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwOTo0ODowMlrOGqLeqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg4MTQ0OQ==", "bodyText": "this change is covered by https://github.com/jenkinsci/jenkins/blob/master/test/src/test/java/hudson/model/WorkspaceCleanupThreadTest.java#L181", "url": "https://github.com/jenkinsci/jenkins/pull/4824#discussion_r446881449", "createdAt": "2020-06-29T09:48:02Z", "author": {"login": "timja"}, "path": "core/src/main/java/hudson/model/WorkspaceCleanupThread.java", "diffHunk": "@@ -89,11 +89,8 @@ public static void invoke() {\n                 if (check) {\n                     listener.getLogger().println(\"Deleting \" + ws + \" on \" + node.getDisplayName());\n                     try {\n+                        ws.deleteSuffixesRecursive();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28daa7f9a34a7e20dcfa20236071bcfcdb120449"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MDIwMjYw", "url": "https://github.com/jenkinsci/jenkins/pull/4824#pullrequestreview-439020260", "createdAt": "2020-06-29T09:48:42Z", "commit": {"oid": "28daa7f9a34a7e20dcfa20236071bcfcdb120449"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwOTo0ODo0M1rOGqLf3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwOTo0ODo0M1rOGqLf3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg4MTc1OQ==", "bodyText": "no longer needed as it's a suffix and will be automatically deleted, test proves it still works https://github.com/jenkinsci/jenkins/blob/master/test/src/test/java/hudson/model/WorkspaceCleanupThreadTest.java#L181", "url": "https://github.com/jenkinsci/jenkins/pull/4824#discussion_r446881759", "createdAt": "2020-06-29T09:48:43Z", "author": {"login": "timja"}, "path": "core/src/main/java/hudson/model/WorkspaceCleanupThread.java", "diffHunk": "@@ -89,11 +89,8 @@ public static void invoke() {\n                 if (check) {\n                     listener.getLogger().println(\"Deleting \" + ws + \" on \" + node.getDisplayName());\n                     try {\n+                        ws.deleteSuffixesRecursive();\n                         ws.deleteRecursive();\n-                        FilePath tempDir = WorkspaceList.tempDir(ws);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28daa7f9a34a7e20dcfa20236071bcfcdb120449"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MDI2MzE5", "url": "https://github.com/jenkinsci/jenkins/pull/4824#pullrequestreview-439026319", "createdAt": "2020-06-29T11:01:46Z", "commit": {"oid": "28daa7f9a34a7e20dcfa20236071bcfcdb120449"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMTowMTo0NlrOGqLuLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxMTowMTo0NlrOGqLuLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg4NTQyMA==", "bodyText": "used here: https://github.com/jenkinsci/workflow-cps-global-lib-plugin/blob/3e5a08f079fc371119fcf1b76a60369724c2eb70/src/main/java/org/jenkinsci/plugins/workflow/libs/SCMSourceRetriever.java#L173, would be nice if it's an API so that everything uses the same separator.", "url": "https://github.com/jenkinsci/jenkins/pull/4824#discussion_r446885420", "createdAt": "2020-06-29T11:01:46Z", "author": {"login": "timja"}, "path": "core/src/main/java/hudson/slaves/WorkspaceList.java", "diffHunk": "@@ -312,6 +312,7 @@ public static FilePath tempDir(FilePath ws) {\n \n     /**\n      * The token that combines the project name and unique number to create unique workspace directory.\n+     * @since TODO\n      */\n-    private static final String COMBINATOR = SystemProperties.getString(WorkspaceList.class.getName(),\"@\");\n+    public static final String COMBINATOR = SystemProperties.getString(WorkspaceList.class.getName(),\"@\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "28daa7f9a34a7e20dcfa20236071bcfcdb120449"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa59039c383d5376586ed0d3050a282b30ea1ace", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/fa59039c383d5376586ed0d3050a282b30ea1ace", "committedDate": "2020-07-01T07:30:05Z", "message": "Fix syntax"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b79b7f30387f491e4bbce958b77207b6857e1118", "author": {"user": {"login": "timja", "name": "Tim Jacomb"}}, "url": "https://github.com/jenkinsci/jenkins/commit/b79b7f30387f491e4bbce958b77207b6857e1118", "committedDate": "2020-07-01T08:28:38Z", "message": "Fix whitespace"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNjYyNTI4", "url": "https://github.com/jenkinsci/jenkins/pull/4824#pullrequestreview-440662528", "createdAt": "2020-07-01T08:37:29Z", "commit": {"oid": "b79b7f30387f491e4bbce958b77207b6857e1118"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwNjY0MTc4", "url": "https://github.com/jenkinsci/jenkins/pull/4824#pullrequestreview-440664178", "createdAt": "2020-07-01T08:39:44Z", "commit": {"oid": "b79b7f30387f491e4bbce958b77207b6857e1118"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxNTIzNTk5", "url": "https://github.com/jenkinsci/jenkins/pull/4824#pullrequestreview-441523599", "createdAt": "2020-07-02T09:49:33Z", "commit": {"oid": "b79b7f30387f491e4bbce958b77207b6857e1118"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2091, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}