{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0MzQ0OTIw", "number": 899, "title": "BXC-2526 - Generate content structure", "bodyText": "https://jira.lib.unc.edu/browse/BXC-2526\n\nAdds command to transform a content tree into a bxc5 deposit structure in jena-tdb\nIncludes progress display\nAdds some supporting commands\n\nexport file paths for a set of object ids, for generating pull lists to make test deposit sets\ncommand display a deposit structure\n\n\nAdds a transformation manager which tracks progress and constructs new transform jobs\nAdds utility for managing concurrent access to tdb deposit dataset\nReintroduces some bxc3 constants useful for the migration\nPath index can now retrieve all versions of a datastream if asked for, and by default only returns the most recent\nAdds test utility for generating foxml files", "createdAt": "2020-02-12T14:39:50Z", "url": "https://github.com/UNC-Libraries/box-c/pull/899", "merged": true, "mergeCommit": {"oid": "63273adcb94a676d48f39566b0ae1408aa1d0915"}, "closed": true, "closedAt": "2020-02-14T20:19:24Z", "author": {"login": "bbpennel"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcB_uVTAH2gAyMzc0MzQ0OTIwOmRkMjk2Y2EyOTY3ZjgzNDI4NzdiNThmNmQ2YmEyNGQ1NGU4YmM2OTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEVbBXAFqTM1OTE5NjI3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dd296ca2967f8342877b58f6d6ba24d54e8bc694", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/dd296ca2967f8342877b58f6d6ba24d54e8bc694", "committedDate": "2020-02-07T13:54:38Z", "message": "Basic structure for content object migration transformer and deposit model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffd2701c0925f5a22d14a45a1e3b5dd5792be73e", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/ffd2701c0925f5a22d14a45a1e3b5dd5792be73e", "committedDate": "2020-02-10T20:03:17Z", "message": "Add helper utility for extract information from foxml documents, including datastream versions. Restore some of ContentModelHelper to provide constants for bxc3 constants during the migration."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b122ff91f96e619180321f6a29c064a4eea1cf8", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/5b122ff91f96e619180321f6a29c064a4eea1cf8", "committedDate": "2020-02-10T20:31:18Z", "message": "If multiple paths exist for a datastream on a pid, then return the one with the highest index. Add helper method to return all paths for versions of a datastream"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "347a66efd8496d7fbeb1f88eacde188b14ed964e", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/347a66efd8496d7fbeb1f88eacde188b14ed964e", "committedDate": "2020-02-11T19:13:35Z", "message": "Implement content object transformer, which currently supports basic structure for most object types"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7796c81215e29cfabe77026ed08ac7cb4c99b9e", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/d7796c81215e29cfabe77026ed08ac7cb4c99b9e", "committedDate": "2020-02-11T21:30:30Z", "message": "Add command for performing content transformation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68d07e2cf82d29c0f755a02dcc2e382b7d919e10", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/68d07e2cf82d29c0f755a02dcc2e382b7d919e10", "committedDate": "2020-02-12T14:19:03Z", "message": "Add utility for rendering progress info to the cli, display progress for content transformation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9be9d9a1cbcc76de78be038d92df7fcbb3b33e4", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/b9be9d9a1cbcc76de78be038d92df7fcbb3b33e4", "committedDate": "2020-02-12T14:19:24Z", "message": "Add commands to help load test sets.\nAdded command to retrieve file paths for multiple objects.\nAdded command to retrieve a deposit model.\nMade tdb and path index db url parameters global."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d261bf9a209f9695ea1aee12d15d84ab539cc5c0", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/d261bf9a209f9695ea1aee12d15d84ab539cc5c0", "committedDate": "2020-02-12T15:13:11Z", "message": "Remove catch"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5a5e809880be7e3f192ccbbf7bd2f7fc3f6f047", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/d5a5e809880be7e3f192ccbbf7bd2f7fc3f6f047", "committedDate": "2020-02-13T14:41:53Z", "message": "Add readme about transform_content"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MTUwOTAz", "url": "https://github.com/UNC-Libraries/box-c/pull/899#pullrequestreview-359150903", "createdAt": "2020-02-14T18:56:30Z", "commit": {"oid": "d5a5e809880be7e3f192ccbbf7bd2f7fc3f6f047"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxODo1NjozMVrOFqAcZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxODo1NjozMVrOFqAcZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTU5MTc4Mw==", "bodyText": "remove this", "url": "https://github.com/UNC-Libraries/box-c/pull/899#discussion_r379591783", "createdAt": "2020-02-14T18:56:31Z", "author": {"login": "bbpennel"}, "path": "migration-util/src/main/java/edu/unc/lib/dcr/migration/ViewDepositModelCommand.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/**\n+ * Copyright 2008 The University of North Carolina at Chapel Hill\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *         http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package edu.unc.lib.dcr.migration;\n+\n+import static edu.unc.lib.dcr.migration.MigrationConstants.OUTPUT_LOGGER;\n+import static edu.unc.lib.dl.fcrepo4.RepositoryPathConstants.DEPOSIT_RECORD_BASE;\n+import static edu.unc.lib.dl.util.RDFModelUtil.streamModel;\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static org.apache.jena.riot.RDFFormat.NTRIPLES;\n+import static org.apache.jena.riot.RDFFormat.TURTLE;\n+import static org.slf4j.LoggerFactory.getLogger;\n+\n+import java.util.concurrent.Callable;\n+\n+import org.apache.commons.io.IOUtils;\n+import org.apache.jena.riot.RDFFormat;\n+import org.slf4j.Logger;\n+\n+import edu.unc.lib.dcr.migration.deposit.DepositModelManager;\n+import edu.unc.lib.dl.fcrepo4.PIDs;\n+import edu.unc.lib.dl.fedora.PID;\n+import picocli.CommandLine.Command;\n+import picocli.CommandLine.Option;\n+import picocli.CommandLine.Parameters;\n+import picocli.CommandLine.ParentCommand;\n+\n+/**\n+ * View deposit model command\n+ *\n+ * @author bbpennel\n+ */\n+@Command(name = \"view_deposit_model\", aliases = {\"vdm\"},\n+        description = \"Display the stored RDF for a deposit\")\n+public class ViewDepositModelCommand implements Callable<Integer> {\n+\n+    private static final Logger output = getLogger(OUTPUT_LOGGER);\n+\n+    @ParentCommand\n+    private MigrationCLI parentCommand;\n+\n+    @Parameters(index = \"0\",\n+            description = \"ID of the deposit to retrieve\")\n+    private String depositId;\n+\n+    @Option(names = {\"-t\", \"--turtle\"},\n+            description = \"Serialize the RDF as turtle instead of n-triples\")\n+    private boolean asTurtle;\n+\n+    @Override\n+    public Integer call() throws Exception {\n+        PID depositPid = PIDs.get(DEPOSIT_RECORD_BASE, depositId);\n+\n+        DepositModelManager depositModelManager = new DepositModelManager(depositPid, parentCommand.tdbDir);\n+\n+        depositModelManager.commit();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5a5e809880be7e3f192ccbbf7bd2f7fc3f6f047"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90977e3da5956cf78a96db65c4a0a4292798a8e0", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/90977e3da5956cf78a96db65c4a0a4292798a8e0", "committedDate": "2020-02-14T19:46:33Z", "message": "Update ViewDepositModelCommand.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MTk2Mjc5", "url": "https://github.com/UNC-Libraries/box-c/pull/899#pullrequestreview-359196279", "createdAt": "2020-02-14T20:19:18Z", "commit": {"oid": "90977e3da5956cf78a96db65c4a0a4292798a8e0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2292, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}