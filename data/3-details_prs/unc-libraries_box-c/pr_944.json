{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0OTIzMjgy", "number": 944, "title": "Check if download is a work. If so, use its primary object's PID", "bodyText": "https://jira.lib.unc.edu/browse/BXC-2519", "createdAt": "2020-03-27T19:04:19Z", "url": "https://github.com/UNC-Libraries/box-c/pull/944", "merged": true, "mergeCommit": {"oid": "5e31f34e9160e3f2a843b81fb20177d5d0ba616b"}, "closed": true, "closedAt": "2020-04-02T19:26:25Z", "author": {"login": "lfarrell"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcR1cQzAH2gAyMzk0OTIzMjgyOmUwZTBiNGM4OWQwMzA1YjQ4NDc2NzI0NDVkMmY3MGU1NWZlMWY1YmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTLXNagFqTM4NTE2NDIzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e0e0b4c89d0305b4847672445d2f70e55fe1f5bf", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/e0e0b4c89d0305b4847672445d2f70e55fe1f5bf", "committedDate": "2020-03-27T18:58:38Z", "message": "Check if download is a work. If so, use its primary object's PID"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NzY3Nzc2", "url": "https://github.com/UNC-Libraries/box-c/pull/944#pullrequestreview-384767776", "createdAt": "2020-03-31T14:05:47Z", "commit": {"oid": "e0e0b4c89d0305b4847672445d2f70e55fe1f5bf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNDowNTo0N1rOF-Xf4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNDowNzoyNFrOF-XklA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk0MTAyNA==", "bodyText": "use instanceof", "url": "https://github.com/UNC-Libraries/box-c/pull/944#discussion_r400941024", "createdAt": "2020-03-31T14:05:47Z", "author": {"login": "bbpennel"}, "path": "access/src/main/java/edu/unc/lib/dl/ui/controller/FedoraContentController.java", "diffHunk": "@@ -87,6 +92,11 @@ private void streamData(String pidString, String datastream, boolean asAttachmen\n         PID pid = PIDs.get(pidString);\n         AccessGroupSet principals = getAgentPrincipals().getPrincipals();\n \n+        RepositoryObject updatedPid = repoObjLoader.getRepositoryObject(pid);\n+        if (updatedPid.getClass() == WorkObject.class) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0e0b4c89d0305b4847672445d2f70e55fe1f5bf"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk0MTY3NA==", "bodyText": "since this isn't really a pid object, i'd suggest a different variable name", "url": "https://github.com/UNC-Libraries/box-c/pull/944#discussion_r400941674", "createdAt": "2020-03-31T14:06:41Z", "author": {"login": "bbpennel"}, "path": "access/src/main/java/edu/unc/lib/dl/ui/controller/FedoraContentController.java", "diffHunk": "@@ -87,6 +92,11 @@ private void streamData(String pidString, String datastream, boolean asAttachmen\n         PID pid = PIDs.get(pidString);\n         AccessGroupSet principals = getAgentPrincipals().getPrincipals();\n \n+        RepositoryObject updatedPid = repoObjLoader.getRepositoryObject(pid);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0e0b4c89d0305b4847672445d2f70e55fe1f5bf"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk0MjIyOA==", "bodyText": "not all works are guaranteed to have a primary object, so you should check that its null before getting the pid", "url": "https://github.com/UNC-Libraries/box-c/pull/944#discussion_r400942228", "createdAt": "2020-03-31T14:07:24Z", "author": {"login": "bbpennel"}, "path": "access/src/main/java/edu/unc/lib/dl/ui/controller/FedoraContentController.java", "diffHunk": "@@ -87,6 +92,11 @@ private void streamData(String pidString, String datastream, boolean asAttachmen\n         PID pid = PIDs.get(pidString);\n         AccessGroupSet principals = getAgentPrincipals().getPrincipals();\n \n+        RepositoryObject updatedPid = repoObjLoader.getRepositoryObject(pid);\n+        if (updatedPid.getClass() == WorkObject.class) {\n+            pid = ((WorkObject) updatedPid).getPrimaryObject().getPid();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0e0b4c89d0305b4847672445d2f70e55fe1f5bf"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eda7cdd2f7983bf636c4056bba87e8eea1813021", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/eda7cdd2f7983bf636c4056bba87e8eea1813021", "committedDate": "2020-03-31T17:32:42Z", "message": "Update to check for no primary object"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1MTY0MjMz", "url": "https://github.com/UNC-Libraries/box-c/pull/944#pullrequestreview-385164233", "createdAt": "2020-03-31T23:04:57Z", "commit": {"oid": "eda7cdd2f7983bf636c4056bba87e8eea1813021"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2318, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}