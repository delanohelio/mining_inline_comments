{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMTYzNzI0", "number": 1029, "title": "BXC-2718 - Generate missing migrated deposit records", "bodyText": "https://jira.lib.unc.edu/browse/BXC-2718\n\nTransformation option to generate referenced deposit records which don't exist as fedora objects\nOption for performing dry run of transformation\nIntegration tests\nMinor updates for fedora fault resolution and new packaging type for migrations", "createdAt": "2020-06-25T17:36:25Z", "url": "https://github.com/UNC-Libraries/box-c/pull/1029", "merged": true, "mergeCommit": {"oid": "f2da684ed2464defbd011eccd7f59674b557795f"}, "closed": true, "closedAt": "2020-06-29T18:42:13Z", "author": {"login": "bbpennel"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuyFM6AH2gAyNDQwMTYzNzI0OmE1ZGQ1YzE2NTFhM2RjNWFlZWJlNmE2M2IxMTA5M2M5MDJhOWM5YzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcuzkwJAH2gAyNDQwMTYzNzI0OjI1ZmZmNGFiMDYwMzg3NTI3YzlhYTQyMjZlNGY0MTUwNzIxODU1MjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a5dd5c1651a3dc5aeebe6a63b11093c902a9c9c4", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/a5dd5c1651a3dc5aeebe6a63b11093c902a9c9c4", "committedDate": "2020-06-25T17:27:32Z", "message": "Add options for content transformation to generate missing deposit records and do a dry run by undoing changes. Add integration tests for transform content command. Fedora fault resolver returns conflict exceptions now. Add packaging type for migrated deposits"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NzUxMTgy", "url": "https://github.com/UNC-Libraries/box-c/pull/1029#pullrequestreview-437751182", "createdAt": "2020-06-25T18:26:24Z", "commit": {"oid": "a5dd5c1651a3dc5aeebe6a63b11093c902a9c9c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxODoyNjoyNFrOGpGqzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxODoyNjoyNFrOGpGqzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc1NDA2Mw==", "bodyText": "Why are context files used?", "url": "https://github.com/UNC-Libraries/box-c/pull/1029#discussion_r445754063", "createdAt": "2020-06-25T18:26:24Z", "author": {"login": "lfarrell"}, "path": "migration-util/src/main/java/edu/unc/lib/dcr/migration/TransformContentCommand.java", "diffHunk": "@@ -71,27 +74,39 @@\n             description = \"Submits the transformed content for deposit to the provided container UUID\")\n     private String depositInto;\n \n+    @Option(names = {\"-m\", \"--missing-deposit-records\"},\n+            description = \"Create referenced deposit records which do not have their own bxc3 object\")\n+    private boolean createMissingDepositRecords;\n+\n+    @Option(names = {\"-n\", \"--dry-run\"},\n+            description = \"Perform the transformation but do not save the results\")\n+    private boolean dryRun;\n+\n+    private String applicationContextPath = \"spring/service-context.xml\";\n+\n     @Override\n     public Integer call() throws Exception {\n         long start = System.currentTimeMillis();\n \n         output.info(\"Transforming content tree starting from {}\", startingId);\n         output.info(\"===========================================\");\n-        RepositoryPIDMinter pidMinter = new RepositoryPIDMinter();\n+\n+        ConfigurableApplicationContext context = new ClassPathXmlApplicationContext(applicationContextPath);\n+\n+        RepositoryPIDMinter pidMinter = (RepositoryPIDMinter) context.getBean(\"repositoryPIDMinter\");\n         PID depositPid = pidMinter.mintDepositRecordPid();\n \n-        output.info(\"Populating deposit:\");\n-        output.info(depositPid.getId());\n+        output.info(\"Populating deposit: \" + depositPid.getId());\n \n         DepositModelManager depositModelManager = new DepositModelManager(depositPid, parentCommand.tdbDir);\n         DepositDirectoryManager depositDirectoryManager = new DepositDirectoryManager(\n                 depositPid, parentCommand.depositBaseDir, hashNesting);\n \n-        PathIndex pathIndex = new PathIndex();\n+        PathIndex pathIndex = (PathIndex) context.getBean(\"pathIndex\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5dd5c1651a3dc5aeebe6a63b11093c902a9c9c4"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25fff4ab060387527c9aa4226e4f415072185524", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/25fff4ab060387527c9aa4226e4f415072185524", "committedDate": "2020-06-25T19:11:54Z", "message": "Add generated deposit record record id to list, add logging"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2233, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}