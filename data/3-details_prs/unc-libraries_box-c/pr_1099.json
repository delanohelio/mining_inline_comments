{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyNTgzMTYy", "number": 1099, "title": "Add delay before retrying ingests due to checksum failure", "bodyText": "", "createdAt": "2020-10-13T17:05:57Z", "url": "https://github.com/UNC-Libraries/box-c/pull/1099", "merged": true, "mergeCommit": {"oid": "df065ea8339de89d43c5369845701b051fa786ec"}, "closed": true, "closedAt": "2020-10-14T12:45:50Z", "author": {"login": "lfarrell"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSLitCAH2gAyNTAyNTgzMTYyOjZmNzVjYWY0ZWU4YmJjNDJhMGYxNWY3N2FjYWJmMTgzMTY0NjRjMjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSck8bAFqTUwODMwNTEzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6f75caf4ee8bbc42a0f15f77acabf18316464c26", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/6f75caf4ee8bbc42a0f15f77acabf18316464c26", "committedDate": "2020-10-13T16:54:44Z", "message": "Add delay before retrying ingest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NjkyMjAw", "url": "https://github.com/UNC-Libraries/box-c/pull/1099#pullrequestreview-507692200", "createdAt": "2020-10-13T17:53:35Z", "commit": {"oid": "6f75caf4ee8bbc42a0f15f77acabf18316464c26"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1MzozNlrOHgywEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNzo1NTozMlrOHgy0iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE0Nzk4Nw==", "bodyText": "might be simpler to perform the delay in the ChecksumMismatchException catch, it already has a block to check if retries are remaining and the automatic result would be there wouldn't be a delay until after the first try.", "url": "https://github.com/UNC-Libraries/box-c/pull/1099#discussion_r504147987", "createdAt": "2020-10-13T17:53:36Z", "author": {"login": "bbpennel"}, "path": "deposit/src/main/java/edu/unc/lib/deposit/fcrepo4/IngestContentObjectsJob.java", "diffHunk": "@@ -396,6 +396,15 @@ private FileObject addFileToWork(WorkObject work, Resource childResc)\n         // Retry if there are checksum failures\n         for (int retryCnt = 1; retryCnt <= CHECKSUM_RETRIES; retryCnt++) {\n             try {\n+                if (retryCnt > 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f75caf4ee8bbc42a0f15f77acabf18316464c26"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE0OTEyOQ==", "bodyText": "rather than eating the interrupt, could you rethrow it as a JobInterruptedException? Shouldn't need an extra log statement in that case.", "url": "https://github.com/UNC-Libraries/box-c/pull/1099#discussion_r504149129", "createdAt": "2020-10-13T17:55:32Z", "author": {"login": "bbpennel"}, "path": "deposit/src/main/java/edu/unc/lib/deposit/fcrepo4/IngestContentObjectsJob.java", "diffHunk": "@@ -396,6 +396,15 @@ private FileObject addFileToWork(WorkObject work, Resource childResc)\n         // Retry if there are checksum failures\n         for (int retryCnt = 1; retryCnt <= CHECKSUM_RETRIES; retryCnt++) {\n             try {\n+                if (retryCnt > 1) {\n+                    try {\n+                        Thread.sleep(retryCnt * 1000);\n+                    } catch (InterruptedException e) {\n+                        log.debug(\"Retry ingest pause for {} due to a checksum mismatch, {} retries remaining: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f75caf4ee8bbc42a0f15f77acabf18316464c26"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b2b972fbc24d294288cf185d5ca6e200d0ed232", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/3b2b972fbc24d294288cf185d5ca6e200d0ed232", "committedDate": "2020-10-13T20:22:51Z", "message": "Move retry delay"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "87bd26c48319bd1c00962081248a2016ba3138f2", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/87bd26c48319bd1c00962081248a2016ba3138f2", "committedDate": "2020-10-13T19:27:45Z", "message": "Move retry delay"}, "afterCommit": {"oid": "3b2b972fbc24d294288cf185d5ca6e200d0ed232", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/3b2b972fbc24d294288cf185d5ca6e200d0ed232", "committedDate": "2020-10-13T20:22:51Z", "message": "Move retry delay"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4MzA1MTMw", "url": "https://github.com/UNC-Libraries/box-c/pull/1099#pullrequestreview-508305130", "createdAt": "2020-10-14T12:45:34Z", "commit": {"oid": "3b2b972fbc24d294288cf185d5ca6e200d0ed232"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2169, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}