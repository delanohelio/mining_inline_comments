{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5ODQ3MjYx", "number": 932, "title": "Update display of items marked for deletion in public UI", "bodyText": "https://jira.lib.unc.edu/browse/BXC-2563", "createdAt": "2020-03-17T13:47:45Z", "url": "https://github.com/UNC-Libraries/box-c/pull/932", "merged": true, "mergeCommit": {"oid": "3835c8b4b7aa1ef8ac8c1f3957f316794440fb55"}, "closed": true, "closedAt": "2020-04-02T17:39:26Z", "author": {"login": "lfarrell"}, "timelineItems": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOkQWoAFqTM3NjEzMTg5NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTv49oAFqTM4NjY1MjU2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTMxODk0", "url": "https://github.com/UNC-Libraries/box-c/pull/932#pullrequestreview-376131894", "createdAt": "2020-03-17T15:15:27Z", "commit": {"oid": "46e5d59c48bde7288c6c80f348d6480ce86cada5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNToxNToyOFrOF3g4VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNToxNToyOFrOF3g4VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc1NDcwOA==", "bodyText": "there are still existing styles for deleted items, they are over in here:\nhttps://github.com/UNC-Libraries/Carolina-Digital-Repository/blob/46e5d59c48bde7288c6c80f348d6480ce86cada5/static/css/cdrui_styles.css#L200-L218\nhttps://github.com/UNC-Libraries/Carolina-Digital-Repository/blob/46e5d59c48bde7288c6c80f348d6480ce86cada5/static/css/cdrui_styles.css#L971-L986\nthe class name is deleted. I don't know if these are still helpful or not, but there seems to be a bit more happening there than in this rule, so its worth comparing. It covers record and result pages. We should probably consider if there are more styles there that we want to retain, and cleanup the old rules once we have everything we want in here.\nAlso, marked-delete reads a little weird to me, maybe because its an adjective plus verb. Maybe deleted or marked-deleted?\nOne other thing, in bxc3 we get a trash icon over the thumbnail when something is deleted. I haven't deployed this branch yet, but i don't see anything in the PR that would add that in.\nFor an example of a deleted resource, see:\nhttps://dcr-qa.lib.unc.edu/search?anywhere=doomed_from_the_start\nyou might have to spoof yourself some credentials, I can't remember your permission setup.", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r393754708", "createdAt": "2020-03-17T15:15:28Z", "author": {"login": "bbpennel"}, "path": "static/css/sass/cdr-ui.scss", "diffHunk": "@@ -457,6 +457,19 @@ $border-style: 1px solid $light-gray;\n $box-shadow-color: rgba(211,211,211,0.5);\n $box-shadow: inset 3px 3px 10px -1px $box-shadow-color, 0px 16px 22px -15px $box-shadow-color;\n \n+/* Items marked for deletion */\n+.marked-delete {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "46e5d59c48bde7288c6c80f348d6480ce86cada5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTMyNDkx", "url": "https://github.com/UNC-Libraries/box-c/pull/932#pullrequestreview-376132491", "createdAt": "2020-03-17T15:16:05Z", "commit": {"oid": "46e5d59c48bde7288c6c80f348d6480ce86cada5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5202355b3dfad779425d4c5714ddfe99502a635b", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/5202355b3dfad779425d4c5714ddfe99502a635b", "committedDate": "2020-03-17T17:18:04Z", "message": "Move deleted styles into one place"}, "afterCommit": {"oid": "6308781cd648eb33ba041948f03d65ae1e58d991", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/6308781cd648eb33ba041948f03d65ae1e58d991", "committedDate": "2020-03-17T17:24:47Z", "message": "Move deleted styles into one place"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "78780b0aed062c3c8b173e958277f81e96476de4", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/78780b0aed062c3c8b173e958277f81e96476de4", "committedDate": "2020-03-18T12:07:30Z", "message": "Add trash icon"}, "afterCommit": {"oid": "7dac9d57b66c3b009f79969273fd6916ec67858a", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/7dac9d57b66c3b009f79969273fd6916ec67858a", "committedDate": "2020-03-18T12:09:42Z", "message": "Add trash icon"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "996be2427093d23eb7f416727ee34675efb6e129", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/996be2427093d23eb7f416727ee34675efb6e129", "committedDate": "2020-03-18T13:19:58Z", "message": "Update display of items marked for deletion in public UI"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73682217079703de18d6903491749d84940f9a00", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/73682217079703de18d6903491749d84940f9a00", "committedDate": "2020-03-18T13:19:58Z", "message": "Move deleted styles into one place"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c9dd534099575be6f33b8346f083a68a5bf075a", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/5c9dd534099575be6f33b8346f083a68a5bf075a", "committedDate": "2020-03-18T13:19:58Z", "message": "Add trash icon"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7dac9d57b66c3b009f79969273fd6916ec67858a", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/7dac9d57b66c3b009f79969273fd6916ec67858a", "committedDate": "2020-03-18T12:09:42Z", "message": "Add trash icon"}, "afterCommit": {"oid": "5c9dd534099575be6f33b8346f083a68a5bf075a", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/5c9dd534099575be6f33b8346f083a68a5bf075a", "committedDate": "2020-03-18T13:19:58Z", "message": "Add trash icon"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60b2209771723de4c222472af758120b1a218103", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/60b2209771723de4c222472af758120b1a218103", "committedDate": "2020-03-18T19:41:19Z", "message": "Mark file/aggregate pages and related items as marked for deletion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bae16b20824ccf020cd62bc17a6583147e2d4d71", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/bae16b20824ccf020cd62bc17a6583147e2d4d71", "committedDate": "2020-03-19T20:11:36Z", "message": "* Fix icons not showing up\n* Update icon placement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c86b06130e7580b53d231f9ae7cc6778d133bb6", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/9c86b06130e7580b53d231f9ae7cc6778d133bb6", "committedDate": "2020-03-20T12:19:25Z", "message": "Fix icons for images"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2a58c116fba681ed10d612696f6ec36d032b3cfa", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/2a58c116fba681ed10d612696f6ec36d032b3cfa", "committedDate": "2020-03-20T12:08:53Z", "message": "Fix icons for images"}, "afterCommit": {"oid": "9c86b06130e7580b53d231f9ae7cc6778d133bb6", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/9c86b06130e7580b53d231f9ae7cc6778d133bb6", "committedDate": "2020-03-20T12:19:25Z", "message": "Fix icons for images"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f84cc6a899223acc5e05af0ae8000bf3d2e666f", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/6f84cc6a899223acc5e05af0ae8000bf3d2e666f", "committedDate": "2020-03-20T14:01:56Z", "message": "Fix layout of table rows with badges"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "666b9d523328b73bda48f28ac538c559f7581d49", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/666b9d523328b73bda48f28ac538c559f7581d49", "committedDate": "2020-03-20T15:39:31Z", "message": "Fix row display for rows with badges"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "146527f8832f7e2577f1ad685be1e5bfdb96dffc", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/146527f8832f7e2577f1ad685be1e5bfdb96dffc", "committedDate": "2020-03-20T15:28:25Z", "message": "Fix row display for rows with badges"}, "afterCommit": {"oid": "666b9d523328b73bda48f28ac538c559f7581d49", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/666b9d523328b73bda48f28ac538c559f7581d49", "committedDate": "2020-03-20T15:39:31Z", "message": "Fix row display for rows with badges"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b49d454c33dd172eddbc96da14fafe4385bcd55d", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/b49d454c33dd172eddbc96da14fafe4385bcd55d", "committedDate": "2020-03-23T17:33:59Z", "message": "Don't hardcode badge value"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNTQxMjI4", "url": "https://github.com/UNC-Libraries/box-c/pull/932#pullrequestreview-381541228", "createdAt": "2020-03-25T21:14:00Z", "commit": {"oid": "b49d454c33dd172eddbc96da14fafe4385bcd55d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMToxNDowMVrOF7uk2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQwMDo0NTozMlrOF7zjng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE3MzQwMQ==", "bodyText": "there's a constant for this, might as well use it edu.unc.lib.dl.search.solr.util.FacetConstants.MARKED_FOR_DELETION", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398173401", "createdAt": "2020-03-25T21:14:01Z", "author": {"login": "bbpennel"}, "path": "access/src/main/java/edu/unc/lib/dl/ui/controller/FullRecordController.java", "diffHunk": "@@ -234,6 +234,14 @@ public String getFullRecord(String pidString, Model model, HttpServletRequest re\n             model.addAttribute(\"neighborList\", neighbors);\n         }\n \n+        List<String> objectStatus = briefObject.getStatus();\n+        boolean isMarkedForDeletion = false;\n+\n+        if (objectStatus != null) {\n+            isMarkedForDeletion = objectStatus.contains(\"Marked For Deletion\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b49d454c33dd172eddbc96da14fafe4385bcd55d"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE3NTYzNg==", "bodyText": "Unindent this line once", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398175636", "createdAt": "2020-03-25T21:17:57Z", "author": {"login": "bbpennel"}, "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/collectionRecord.jsp", "diffHunk": "@@ -45,7 +45,12 @@\n     <div id=\"is-collection\" class=\"columns browse-header\">\n         <div class=\"column is-12\">\n             <c:import url=\"fullRecord/navigationBar.jsp\" />\n-            <h2><i class=\"fa fa-archive\" aria-hidden=\"true\"></i> <c:out value=\"${briefObject.title}\"/> <span class=\"item-count\">(<c:out value=\"${childCount}\" /> items)</span></h2>\n+            <c:choose>\n+                <c:when test=\"${markedForDeletion}\"><h2 class=\"deleted\"></c:when>\n+                <c:otherwise><h2></c:otherwise>\n+                </c:choose>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b49d454c33dd172eddbc96da14fafe4385bcd55d"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE4MjAyNQ==", "bodyText": "Mostly up to you, but it looks like adding the deleted class was previously handled by setting a variable with the name of the class here:\nhttps://github.com/UNC-Libraries/Carolina-Digital-Repository/blob/fcrepo4/access/src/main/webapp/WEB-INF/jsp/fullRecord.jsp#L23-L25\nYou could update that conditional (its still there) to use the variable you are setting in the controller, and then you'd do class=\"column is-narrow-tablet <%= isDeleted %>\" instead of choose statements all over the place.\nI guess that block below it was how it was deciding whether or not to show the lock icon.\nIf you want to stick with the choose statements, we should probably clean up the stuff in fullRecord.jsp\nThese same flags are being set for browseResultEntry.jsp and searchResultEntry.jsp as well. Wonder if those files can be deleted at this point.", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398182025", "createdAt": "2020-03-25T21:30:09Z", "author": {"login": "bbpennel"}, "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/fileRecord.jsp", "diffHunk": "@@ -64,7 +69,12 @@\n             </div>\n         </div>\n         <div class=\"columns columns-resize file-info\">\n-            <div class=\"column is-narrow-tablet\">\n+            <c:choose>\n+                <c:when test=\"${markedForDeletion}\">\n+                    <div class=\"column is-narrow-tablet deleted\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b49d454c33dd172eddbc96da14fafe4385bcd55d"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI0OTQ2Ng==", "bodyText": "can remove this", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398249466", "createdAt": "2020-03-26T00:25:22Z", "author": {"login": "bbpennel"}, "path": "static/js/public/fullRecord.js", "diffHunk": "@@ -156,6 +182,19 @@ define('fullRecord', ['module', 'jquery', 'JP2Viewer', 'StructureView', 'dataTab\n \t\t\treturn \"\";\n \t\t}\n \n+\t\tfunction showBadge(data) {\n+\t\t\tvar markedForDeletion = false;\n+\t\t\tvar restrictedAccess = false;\n+\n+\t\t\tif (data.status !== undefined) {\n+\t\t\t\tvar restrictions = data.status.join(',').toLowerCase();\n+\t\t\t\tmarkedForDeletion = /marked.*?deletion/.test(restrictions);\n+\t\t\t\trestrictedAccess = /embargoed|staff-only/.test(restrictions);\n+\t\t\t}\n+console.log({ markDeleted: markedForDeletion, restricted: restrictedAccess })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b49d454c33dd172eddbc96da14fafe4385bcd55d"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MDc4NA==", "bodyText": "status is an array of known values, feels a little weird/roundabout to transform it into a string for searching", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398250784", "createdAt": "2020-03-26T00:30:04Z", "author": {"login": "bbpennel"}, "path": "static/js/public/fullRecord.js", "diffHunk": "@@ -156,6 +182,19 @@ define('fullRecord', ['module', 'jquery', 'JP2Viewer', 'StructureView', 'dataTab\n \t\t\treturn \"\";\n \t\t}\n \n+\t\tfunction showBadge(data) {\n+\t\t\tvar markedForDeletion = false;\n+\t\t\tvar restrictedAccess = false;\n+\n+\t\t\tif (data.status !== undefined) {\n+\t\t\t\tvar restrictions = data.status.join(',').toLowerCase();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b49d454c33dd172eddbc96da14fafe4385bcd55d"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MjE5OA==", "bodyText": "is this the right class for something that is restricted rather than deleted?", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398252198", "createdAt": "2020-03-26T00:35:17Z", "author": {"login": "bbpennel"}, "path": "static/js/vue-cdr-access/src/components/browseDisplay.vue", "diffHunk": "@@ -4,9 +4,25 @@\n             <div class=\"column is-12\" >\n                 <ul class=\"column is-12\" v-for=\"records in chunkedRecords\">\n                     <li v-for=\"record in records\" class=\"column\" :class=\"column_size\">\n-                        <a :href=\"recordUrl(record.id, 'gallery-display')\">\n-                            <img v-if=\"thumbnailPresent(record.thumbnail_url)\" :src=\"record.thumbnail_url\" :alt=\"altText(record.title)\" class=\"thumbnail thumbnail-size-large\">\n+                        <a :href=\"recordUrl(record.id, 'gallery-display')\" :class=\"{deleted: markedForDeletion(record)}\">\n+                            <img v-if=\"thumbnailPresent(record.thumbnail_url)\" :src=\"record.thumbnail_url\"\n+                                 :alt=\"altText(record.title)\" class=\"thumbnail thumbnail-size-large\"\n+                                 :class=\"{restricted: markedForDeletion(record) || isRestricted(record)}\">\n                             <i v-else class=\"fa\" :class=\"recordType(record.type)\"></i>\n+                            <div v-if=\"markedForDeletion(record)\" class=\"thumbnail-badge-trash\"\n+                                 :class=\"{'deleted-image-icon': thumbnailPresent(record.thumbnail_url)}\">\n+                                <div class=\"fa-stack\">\n+                                    <i class=\"fa fa-circle fa-stack-2x background\"></i>\n+                                    <i class=\"fa fa-trash fa-stack-1x foreground\"></i>\n+                                </div>\n+                            </div>\n+                            <div v-else-if=\"isRestricted(record)\" class=\"thumbnail-badge-lock\"\n+                                 :class=\"{'deleted-image-icon': thumbnailPresent(record.thumbnail_url)}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b49d454c33dd172eddbc96da14fafe4385bcd55d"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MjMyOQ==", "bodyText": "same question as in the previous file", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398252329", "createdAt": "2020-03-26T00:35:51Z", "author": {"login": "bbpennel"}, "path": "static/js/vue-cdr-access/src/components/listDisplay.vue", "diffHunk": "@@ -5,14 +5,31 @@\n                 <ul :class=\"{'margin-offset': isRecordBrowse}\">\n                     <li v-for=\"(record, index) in recordList\" class=\"columns browseitem\" :class=\"{stripe: index % 2 === 0}\">\n                         <div class=\"column is-2\">\n-                            <a :href=\"recordUrl(record.id, linkBrowseType)\">\n-                                <img v-if=\"thumbnailPresent(record.thumbnail_url)\" :src=\"record.thumbnail_url\" :alt=\"altText(record.title)\" class=\"thumbnail thumbnail-size-large\">\n+                            <a :href=\"recordUrl(record.id, linkBrowseType)\" :class=\"{deleted: markedForDeletion(record)}\">\n+                                <img v-if=\"thumbnailPresent(record.thumbnail_url)\" :src=\"record.thumbnail_url\"\n+                                     :alt=\"altText(record.title)\" class=\"thumbnail thumbnail-size-large\">\n                                 <i v-else class=\"fa\" :class=\"recordType(record.type)\"></i>\n+                                <div v-if=\"markedForDeletion(record)\" class=\"thumbnail-badge-trash\"\n+                                     :class=\"{'deleted-image-icon': thumbnailPresent(record.thumbnail_url),\n+                                     'thumbnail-badge-trash-search ': !isRecordBrowse}\">\n+                                    <div class=\"fa-stack\">\n+                                        <i class=\"fa fa-circle fa-stack-2x background\"></i>\n+                                        <i class=\"fa fa-trash fa-stack-1x foreground\"></i>\n+                                    </div>\n+                                </div>\n+                                <div v-else-if=\"isRestricted(record)\" class=\"thumbnail-badge-lock\"\n+                                     :class=\"{'deleted-image-icon': thumbnailPresent(record.thumbnail_url),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b49d454c33dd172eddbc96da14fafe4385bcd55d"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MzU3Mg==", "bodyText": "Wouldn't this mark all the neighbors as deleted if the current record is deleted, even if they aren't deleted?", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398253572", "createdAt": "2020-03-26T00:40:11Z", "author": {"login": "bbpennel"}, "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/neighborList.jsp", "diffHunk": "@@ -29,7 +29,12 @@\n \t\t\t<c:set var=\"currentItemClass\" scope=\"page\">\n \t\t\t\t<c:if test=\"${briefObject.id == neighbor.id}\"> current_item</c:if>\n \t\t\t</c:set>\n-\t\t\t<div class=\"relateditem ${currentItemClass}\">\n+\t\t\t<c:choose>\n+\t\t\t\t<c:when test=\"${markedForDeletion}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b49d454c33dd172eddbc96da14fafe4385bcd55d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1NTAwNg==", "bodyText": "guess I have the same question here about searching as an array", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398255006", "createdAt": "2020-03-26T00:45:32Z", "author": {"login": "bbpennel"}, "path": "static/js/vue-cdr-access/src/mixins/displayUtils.js", "diffHunk": "@@ -22,6 +22,22 @@ export default {\n \n         altText(title) {\n             return `Thumbnail for ${title}`;\n+        },\n+\n+        markedForDeletion(record) {\n+            return /marked.*?deletion/.test(this.restrictions(record));\n+        },\n+\n+        isRestricted(record) {\n+            return /embargoed|staff-only/.test(this.restrictions(record));\n+        },\n+\n+        restrictions(record) {\n+            if (record.status === undefined) {\n+                return '';\n+            }\n+\n+            return record.status.join(',').toLowerCase();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b49d454c33dd172eddbc96da14fafe4385bcd55d"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a831181673d3e11b0cc423cb2c4b4cd8774d9eac", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/a831181673d3e11b0cc423cb2c4b4cd8774d9eac", "committedDate": "2020-03-26T16:54:17Z", "message": "* Move to using existing page variable\n* Remove unused code"}, "afterCommit": {"oid": "bb5448935360d9b5f4d6464e7d7904606257b202", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/bb5448935360d9b5f4d6464e7d7904606257b202", "committedDate": "2020-03-26T16:57:18Z", "message": "* Move to using existing page variable\n* Remove unused code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ae0e500cb65cfa3907b9fc20ed23596f4c1d765", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/9ae0e500cb65cfa3907b9fc20ed23596f4c1d765", "committedDate": "2020-03-26T16:58:42Z", "message": "Cleanup files\n\n* Move to using existing page variable\n* Remove unused code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb5448935360d9b5f4d6464e7d7904606257b202", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/bb5448935360d9b5f4d6464e7d7904606257b202", "committedDate": "2020-03-26T16:57:18Z", "message": "* Move to using existing page variable\n* Remove unused code"}, "afterCommit": {"oid": "9ae0e500cb65cfa3907b9fc20ed23596f4c1d765", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/9ae0e500cb65cfa3907b9fc20ed23596f4c1d765", "committedDate": "2020-03-26T16:58:42Z", "message": "Cleanup files\n\n* Move to using existing page variable\n* Remove unused code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMjIwMzE5", "url": "https://github.com/UNC-Libraries/box-c/pull/932#pullrequestreview-382220319", "createdAt": "2020-03-26T17:05:09Z", "commit": {"oid": "9ae0e500cb65cfa3907b9fc20ed23596f4c1d765"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNzowNToxMFrOF8RJyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNzoxMToyOVrOF8RbkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODczOTkxNA==", "bodyText": "i think \"session\" will stick around past the current request. If you need a broader scope than \"page\", i think you can use \"request\" to avoid some potentially weird interference", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398739914", "createdAt": "2020-03-26T17:05:10Z", "author": {"login": "bbpennel"}, "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord.jsp", "diffHunk": "@@ -20,9 +20,10 @@\n <%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\n <%@ taglib prefix=\"cdr\" uri=\"http://cdr.lib.unc.edu/cdrUI\" %>\n \n-<c:if test=\"${not empty briefObject && cdr:contains(briefObject.status, 'Deleted') || cdr:contains(briefObject.status, 'Parent Deleted')}\">\n-\t<c:set var=\"isDeleted\" value=\"deleted\" scope=\"page\"/>\n+<c:if test=\"${markedForDeletion}\">\n+\t<c:set var=\"isDeleted\" value=\"deleted\" scope=\"session\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ae0e500cb65cfa3907b9fc20ed23596f4c1d765"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc0MTg0NQ==", "bodyText": "Why is currentItemClass being added in here now? It doesn't look like anything has changed with the class. Was there a bug?", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398741845", "createdAt": "2020-03-26T17:07:55Z", "author": {"login": "bbpennel"}, "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/neighborList.jsp", "diffHunk": "@@ -30,7 +30,7 @@\n \t\t\t\t<c:if test=\"${briefObject.id == neighbor.id}\"> current_item</c:if>\n \t\t\t</c:set>\n \t\t\t<div class=\"relateditem ${currentItemClass}\">\n-\t\t\t\t<div class=\"relatedthumb\">\n+\t\t\t\t<div class=\"relatedthumb ${isDeleted} ${currentItemClass}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ae0e500cb65cfa3907b9fc20ed23596f4c1d765"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc0NDQ2NQ==", "bodyText": "okay, we'll just have to be careful to make sure the regexes can't match across statuses in the future, since they aren't paying attention to the commas at present.", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398744465", "createdAt": "2020-03-26T17:11:29Z", "author": {"login": "bbpennel"}, "path": "static/js/public/fullRecord.js", "diffHunk": "@@ -156,6 +182,19 @@ define('fullRecord', ['module', 'jquery', 'JP2Viewer', 'StructureView', 'dataTab\n \t\t\treturn \"\";\n \t\t}\n \n+\t\tfunction showBadge(data) {\n+\t\t\tvar markedForDeletion = false;\n+\t\t\tvar restrictedAccess = false;\n+\n+\t\t\tif (data.status !== undefined) {\n+\t\t\t\tvar restrictions = data.status.join(',').toLowerCase();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MDc4NA=="}, "originalCommit": {"oid": "b49d454c33dd172eddbc96da14fafe4385bcd55d"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMjI5Mzky", "url": "https://github.com/UNC-Libraries/box-c/pull/932#pullrequestreview-382229392", "createdAt": "2020-03-26T17:15:22Z", "commit": {"oid": "9ae0e500cb65cfa3907b9fc20ed23596f4c1d765"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcbace932c6138155d70cc3af4d313b831fa500a", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/dcbace932c6138155d70cc3af4d313b831fa500a", "committedDate": "2020-03-26T18:54:34Z", "message": "Change page scope and get rid of class."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDA4NTkw", "url": "https://github.com/UNC-Libraries/box-c/pull/932#pullrequestreview-382408590", "createdAt": "2020-03-26T20:53:04Z", "commit": {"oid": "dcbace932c6138155d70cc3af4d313b831fa500a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMDo1MzowNFrOF8Z-pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMDo1MzowNFrOF8Z-pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg4NDUxOQ==", "bodyText": "This is causing all neighbors to appear marked as deleted if the current record is, or all to appear as not marked for deletion if the current record is not marked for deletion. You need to evaluate this state per object.", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r398884519", "createdAt": "2020-03-26T20:53:04Z", "author": {"login": "bbpennel"}, "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/neighborList.jsp", "diffHunk": "@@ -30,7 +30,7 @@\n \t\t\t\t<c:if test=\"${briefObject.id == neighbor.id}\"> current_item</c:if>\n \t\t\t</c:set>\n \t\t\t<div class=\"relateditem ${currentItemClass}\">\n-\t\t\t\t<div class=\"relatedthumb\">\n+\t\t\t\t<div class=\"relatedthumb ${isDeleted}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dcbace932c6138155d70cc3af4d313b831fa500a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b29f605b8eb98b73e35f77237d7763f06def692d", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/b29f605b8eb98b73e35f77237d7763f06def692d", "committedDate": "2020-03-27T15:56:47Z", "message": "Style and badge fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4ad7a698fb4766788f0269b3a923485f5d727dd", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/b4ad7a698fb4766788f0269b3a923485f5d727dd", "committedDate": "2020-03-27T17:12:59Z", "message": "badge and style updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5751b62573dcdb8f51c87de0b6fe2d0bde287a7b", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/5751b62573dcdb8f51c87de0b6fe2d0bde287a7b", "committedDate": "2020-03-27T17:38:06Z", "message": "Fix badges for record pages"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91414a5a354e0bea9beb5d7549200747c6f50290", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/91414a5a354e0bea9beb5d7549200747c6f50290", "committedDate": "2020-03-30T13:22:25Z", "message": "Move icon location"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "829a5b8c9bbb469689c06b9140afdf265b7f45af", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/829a5b8c9bbb469689c06b9140afdf265b7f45af", "committedDate": "2020-03-30T15:55:38Z", "message": "* gray out deleted items in browse view\n* update neighbor list display"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1ODc1ODQy", "url": "https://github.com/UNC-Libraries/box-c/pull/932#pullrequestreview-385875842", "createdAt": "2020-04-01T19:15:01Z", "commit": {"oid": "829a5b8c9bbb469689c06b9140afdf265b7f45af"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxOToxNTowMVrOF_O8Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMDo1MToyMFrOF_SHgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg0OTM3OA==", "bodyText": "Do you need to set this both here and in thumbnail.jsp? Is it for areas where there aren't thumbnails but we still need the trashcan, like at the top of the collection record page?", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r401849378", "createdAt": "2020-04-01T19:15:01Z", "author": {"login": "bbpennel"}, "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord.jsp", "diffHunk": "@@ -20,14 +20,26 @@\n <%@ taglib prefix=\"c\" uri=\"http://java.sun.com/jsp/jstl/core\" %>\n <%@ taglib prefix=\"cdr\" uri=\"http://cdr.lib.unc.edu/cdrUI\" %>\n \n-<c:if test=\"${not empty briefObject && cdr:contains(briefObject.status, 'Deleted') || cdr:contains(briefObject.status, 'Parent Deleted')}\">\n-\t<c:set var=\"isDeleted\" value=\"deleted\" scope=\"page\"/>\n+<c:if test=\"${markedForDeletion}\">\n+\t<c:set var=\"isDeleted\" value=\"deleted\" scope=\"request\"/>\n </c:if>\n+\n <c:set var=\"allowsPublicAccess\" value=\"${permsHelper.allowsPublicAccess(briefObject)}\" />\n <c:if test=\"${not empty briefObject && (not allowsPublicAccess || not empty briefObject.activeEmbargo)}\">\n \t<c:set var=\"isProtected\" value=\"protected\" scope=\"page\"/>\n </c:if>\n \n+<c:set var=\"badgeIcon\" scope=\"request\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "829a5b8c9bbb469689c06b9140afdf265b7f45af"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg5NzUzMQ==", "bodyText": "can't you use the isDeleted variable here? I don't think having any empty class attribute is against any rules", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r401897531", "createdAt": "2020-04-01T20:43:45Z", "author": {"login": "bbpennel"}, "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/adminUnit.jsp", "diffHunk": "@@ -45,7 +45,21 @@\n     <div id=\"is-admin-unit\" class=\"columns browse-header\">\n         <div class=\"column is-12\">\n             <c:import url=\"fullRecord/navigationBar.jsp\" />\n-            <h2><i class=\"fa fa-university\" aria-hidden=\"true\"></i> <c:out value=\"${briefObject.title}\" /></h2>\n+            \t<c:choose>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "829a5b8c9bbb469689c06b9140afdf265b7f45af"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkwMDc2Mg==", "bodyText": "i think you can use the default page scope for this, you don't need the variable past this point", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r401900762", "createdAt": "2020-04-01T20:49:56Z", "author": {"login": "bbpennel"}, "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/neighborList.jsp", "diffHunk": "@@ -29,8 +29,18 @@\n \t\t\t<c:set var=\"currentItemClass\" scope=\"page\">\n \t\t\t\t<c:if test=\"${briefObject.id == neighbor.id}\"> current_item</c:if>\n \t\t\t</c:set>\n+\t\t\t<c:set var=\"markedForDeletion\"  value=\"${cdr:contains(neighbor.status, 'Marked For Deletion')}\" scope=\"request\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "829a5b8c9bbb469689c06b9140afdf265b7f45af"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkwMTQ0MA==", "bodyText": "this is overriding the other isDeleted value, I'd suggest using a different variable name, like neighborIsDeleted so we don't end up with unintended side effects. Also you can use the page scope for this variable.", "url": "https://github.com/UNC-Libraries/box-c/pull/932#discussion_r401901440", "createdAt": "2020-04-01T20:51:20Z", "author": {"login": "bbpennel"}, "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/neighborList.jsp", "diffHunk": "@@ -29,8 +29,18 @@\n \t\t\t<c:set var=\"currentItemClass\" scope=\"page\">\n \t\t\t\t<c:if test=\"${briefObject.id == neighbor.id}\"> current_item</c:if>\n \t\t\t</c:set>\n+\t\t\t<c:set var=\"markedForDeletion\"  value=\"${cdr:contains(neighbor.status, 'Marked For Deletion')}\" scope=\"request\"/>\n+\t\t\t<c:choose>\n+\t\t\t\t<c:when test=\"${markedForDeletion}\">\n+\t\t\t\t\t<c:set var=\"isDeleted\" value=\"deleted\" scope=\"request\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "829a5b8c9bbb469689c06b9140afdf265b7f45af"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d79f79adf4e11d8eebb4fd2b51a5d3a04e1913b", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/1d79f79adf4e11d8eebb4fd2b51a5d3a04e1913b", "committedDate": "2020-04-02T13:31:08Z", "message": "Update variable names and file cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NjUyNTYw", "url": "https://github.com/UNC-Libraries/box-c/pull/932#pullrequestreview-386652560", "createdAt": "2020-04-02T17:38:24Z", "commit": {"oid": "1d79f79adf4e11d8eebb4fd2b51a5d3a04e1913b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2309, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}