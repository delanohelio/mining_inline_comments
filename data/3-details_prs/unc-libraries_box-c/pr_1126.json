{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwMDI0NTQ1", "number": 1126, "title": "BXC-2856 - Fix user based permissions issues", "bodyText": "https://jira.lib.unc.edu/browse/BXC-2856\n\nMake sure that the user principal is provided for most ACL checks by using getAgentPrincipal instead of getGroups.\nStore agent principals in the group thread store rather than regenerating on each method call.\nFix NPE when accessing structure browse in admin interface with no permissions to the content root", "createdAt": "2020-11-12T17:01:51Z", "url": "https://github.com/UNC-Libraries/box-c/pull/1126", "merged": true, "mergeCommit": {"oid": "27a3b354ba5a0423bedbc98f59b144f3ee076fe3"}, "closed": true, "closedAt": "2020-11-13T13:11:19Z", "author": {"login": "bbpennel"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdb1jEmAH2gAyNTIwMDI0NTQ1OjY1OWJkOTQzYzg0ZTQyODc2MDRkOGQxNmQ1NDQxMzdiNjE0OGUwMDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdb47LpgH2gAyNTIwMDI0NTQ1OjFhNjMzNmJmMTM0NjlmODFhYTA3NDE4OTk1Yzg2ZjYxNWY2N2YxNDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "659bd943c84e4287604d8d16d544137b6148e001", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/659bd943c84e4287604d8d16d544137b6148e001", "committedDate": "2020-11-12T16:56:28Z", "message": "Make sure that the user principal is provided for most ACL checks by using getAgentPrincipal instead of getGroups. Store agent principals in the group thread store rather than regenerating on each method call. Fix NPE when accessing structure browse in admin interface with no permissions to the content root"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5Mzc5MTEy", "url": "https://github.com/UNC-Libraries/box-c/pull/1126#pullrequestreview-529379112", "createdAt": "2020-11-12T18:37:31Z", "commit": {"oid": "659bd943c84e4287604d8d16d544137b6148e001"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxODozNzozMVrOHyIeIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxODozNzozMVrOHyIeIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjMyOTYzMw==", "bodyText": "Not a big issue, but would a wrapper method be useful for all of these GroupsThreadStore.getAgentPrincipals().getPrincipals() calls?", "url": "https://github.com/UNC-Libraries/box-c/pull/1126#discussion_r522329633", "createdAt": "2020-11-12T18:37:31Z", "author": {"login": "lfarrell"}, "path": "access-common/src/main/java/edu/unc/lib/dl/ui/access/StoreAccessLevelFilter.java", "diffHunk": "@@ -73,17 +73,17 @@ public void doFilterInternal(HttpServletRequest request, HttpServletResponse res\n                 session.removeAttribute(\"accessLevel\");\n                 accessLevel = new AccessLevel(username);\n                 session.setAttribute(\"accessLevel\", accessLevel);\n-                AccessGroupSet groups = GroupsThreadStore.getGroups();\n-                if (globalPermissionEvaluator.hasGlobalPrincipal(groups)) {\n-                    Set<UserRole> roles = globalPermissionEvaluator.getGlobalUserRoles(groups);\n+                AccessGroupSet principals = GroupsThreadStore.getAgentPrincipals().getPrincipals();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "659bd943c84e4287604d8d16d544137b6148e001"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a6336bf13469f81aa07418995c86f615f67f140", "author": {"user": {"login": "bbpennel", "name": "Ben Pennell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/1a6336bf13469f81aa07418995c86f615f67f140", "committedDate": "2020-11-12T20:52:31Z", "message": "Use wrapper for getting principals"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2184, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}