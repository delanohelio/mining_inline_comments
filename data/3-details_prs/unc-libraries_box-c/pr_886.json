{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1OTg1ODU4", "number": 886, "title": "Index collection id", "bodyText": "https://jira.lib.unc.edu/browse/BXC-2455\nDepends on https://gitlab.lib.unc.edu/cdr/boxc-ansible/merge_requests/28", "createdAt": "2020-01-22T17:52:46Z", "url": "https://github.com/UNC-Libraries/box-c/pull/886", "merged": true, "mergeCommit": {"oid": "fdb9030e881b82be35d97663f50948998651c1db"}, "closed": true, "closedAt": "2020-01-31T19:27:05Z", "author": {"login": "lfarrell"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-ij-ZAH2gAyMzY1OTg1ODU4OjI3YWRiYjA3YTM5MDE4MTBmMmNjZWU5ODYxZWVjM2U0Y2QyYmMzNzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_0Re3gFqTM1MTcyNDg2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "27adbb07a3901810f2ccee9861eec3e4cd2bc374", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/27adbb07a3901810f2ccee9861eec3e4cd2bc374", "committedDate": "2020-01-27T20:14:18Z", "message": "Index collection id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51a13193b2358c9e878d331bf4bc1f60984df75f", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/51a13193b2358c9e878d331bf4bc1f60984df75f", "committedDate": "2020-01-27T20:14:18Z", "message": "Display collection id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4c59af17c077625482e97e2c229ac12b3c1071c", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/c4c59af17c077625482e97e2c229ac12b3c1071c", "committedDate": "2020-01-27T20:14:18Z", "message": "Display collection id in search results"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17da831009c12c3f1283573cfd489386cfd18aa1", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/17da831009c12c3f1283573cfd489386cfd18aa1", "committedDate": "2020-01-27T21:19:39Z", "message": "* Index collection id\n* Don't display collection id if there isn't one, or any coll info if record is a collection"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "214227d9efd48681bc61c73d2b57643de4f23793", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/214227d9efd48681bc61c73d2b57643de4f23793", "committedDate": "2020-01-23T14:15:06Z", "message": "Display collection id in search results"}, "afterCommit": {"oid": "17da831009c12c3f1283573cfd489386cfd18aa1", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/17da831009c12c3f1283573cfd489386cfd18aa1", "committedDate": "2020-01-27T21:19:39Z", "message": "* Index collection id\n* Don't display collection id if there isn't one, or any coll info if record is a collection"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxMDk5MzYw", "url": "https://github.com/UNC-Libraries/box-c/pull/886#pullrequestreview-351099360", "createdAt": "2020-01-30T19:53:23Z", "commit": {"oid": "17da831009c12c3f1283573cfd489386cfd18aa1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxOTo1MzoyNFrOFj36oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMDowMTo1OFrOFj4LcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE2MDYwOQ==", "bodyText": "You could keep using resourceType instead of going back to briefObject.getResourceType()", "url": "https://github.com/UNC-Libraries/box-c/pull/886#discussion_r373160609", "createdAt": "2020-01-30T19:53:24Z", "author": {"login": "bbpennel"}, "path": "access/src/main/java/edu/unc/lib/dl/ui/controller/FullRecordController.java", "diffHunk": "@@ -214,7 +214,9 @@ public String getFullRecord(String pidString, Model model, HttpServletRequest re\n             model.addAttribute(\"facetFields\", resultResponse.getFacetFields());\n         }\n \n-        if (resourceType.equals(searchSettings.resourceTypeFolder)) {\n+        if (resourceType.equals(searchSettings.resourceTypeFolder) ||\n+                briefObject.getResourceType().equals(searchSettings.resourceTypeFile) ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17da831009c12c3f1283573cfd489386cfd18aa1"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE2MjAwMg==", "bodyText": "I don't see <h1> being used on the other record pages for the title, they seem to be doing h2. Also, I think this should be briefObject.title? Unless briefObject is actually just the title in this case unlike the others", "url": "https://github.com/UNC-Libraries/box-c/pull/886#discussion_r373162002", "createdAt": "2020-01-30T19:56:00Z", "author": {"login": "bbpennel"}, "path": "access/src/main/webapp/WEB-INF/jsp/fullRecord/fileRecord.jsp", "diffHunk": "@@ -22,6 +22,7 @@\n <%@ taglib uri=\"http://java.sun.com/jsp/jstl/functions\" prefix=\"fn\" %> \n <%@ taglib prefix=\"cdr\" uri=\"http://cdr.lib.unc.edu/cdrUI\"%>\n <div class=\"full_record_top\">\n+    <h1>${briefObject}</h1>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17da831009c12c3f1283573cfd489386cfd18aa1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE2MzkxOA==", "bodyText": "I think a bunch of the processing in this class was written against any older version of jdom. These days you can store List<Element> directly from getChildren rather than having to cast things below. Same could be said for almost all the other extract methods in this class though.", "url": "https://github.com/UNC-Libraries/box-c/pull/886#discussion_r373163918", "createdAt": "2020-01-30T19:59:52Z", "author": {"login": "bbpennel"}, "path": "solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java", "diffHunk": "@@ -253,6 +255,33 @@ private void extractAbstract(Element mods, IndexDocumentBean idb) {\n         }\n     }\n \n+    private void extractCollectionId(Element mods, IndexDocumentBean idb) {\n+        List<?> identifiers = mods.getChildren(\"identifier\", JDOMNamespaceUtil.MODS_V3_NS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17da831009c12c3f1283573cfd489386cfd18aa1"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE2NDkxMw==", "bodyText": "if you only care about the first one, you could break out of the loop when it finds the collection number rather than continuing to look. In that case you wouldn't need a List either.", "url": "https://github.com/UNC-Libraries/box-c/pull/886#discussion_r373164913", "createdAt": "2020-01-30T20:01:58Z", "author": {"login": "bbpennel"}, "path": "solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java", "diffHunk": "@@ -253,6 +255,33 @@ private void extractAbstract(Element mods, IndexDocumentBean idb) {\n         }\n     }\n \n+    private void extractCollectionId(Element mods, IndexDocumentBean idb) {\n+        List<?> identifiers = mods.getChildren(\"identifier\", JDOMNamespaceUtil.MODS_V3_NS);\n+        List<String> collectionId = new ArrayList<>();\n+\n+        if (identifiers != null && identifiers.size() > 0) {\n+            for (Object id: identifiers) {\n+                Element aid = (Element) id;\n+                Attribute type = aid.getAttribute(\"type\");\n+                Attribute collection = aid.getAttribute(\"displayLabel\");\n+\n+                if (type == null || collection == null) {\n+                    continue;\n+                }\n+\n+                if (collection.getValue().equals(\"Collection Number\") && type.getValue().equals(\"local\")) {\n+                    collectionId.add(aid.getValue());\n+                }\n+            }\n+        }\n+\n+        if (collectionId.size() > 0) {\n+            idb.setCollectionId(collectionId.get(0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17da831009c12c3f1283573cfd489386cfd18aa1"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e7b9c556fc539412190d9b2e8e6b9e3ccd3ca95", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/5e7b9c556fc539412190d9b2e8e6b9e3ccd3ca95", "committedDate": "2020-01-30T21:14:41Z", "message": "* Clean up view page\n* Remove list for finding collectionId"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNzI0ODY3", "url": "https://github.com/UNC-Libraries/box-c/pull/886#pullrequestreview-351724867", "createdAt": "2020-01-31T19:26:19Z", "commit": {"oid": "5e7b9c556fc539412190d9b2e8e6b9e3ccd3ca95"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2400, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}