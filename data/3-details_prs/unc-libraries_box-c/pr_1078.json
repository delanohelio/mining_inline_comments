{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4ODE0OTI5", "number": 1078, "title": "Add bxc version to software agent", "bodyText": "https://jira.lib.unc.edu/browse/BXC-2783", "createdAt": "2020-08-17T12:57:00Z", "url": "https://github.com/UNC-Libraries/box-c/pull/1078", "merged": true, "mergeCommit": {"oid": "b1f1e822fdde726d3eb1634ec7b2233204f681e4"}, "closed": true, "closedAt": "2020-08-24T14:19:30Z", "author": {"login": "lfarrell"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_x9HkgH2gAyNDY4ODE0OTI5OjY4ZWRhYjI5ODg3NzJjZDhjMGM0MDMwNDU1YjJkZmQ4MWI4NTMwMGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAgNlTABqjM2NzIxNzMxNDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "68edab2988772cd8c0c4030455b2dfd81b85300d", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/68edab2988772cd8c0c4030455b2dfd81b85300d", "committedDate": "2020-08-17T12:55:25Z", "message": "Add bxc version to software agent"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NDQwNDM5", "url": "https://github.com/UNC-Libraries/box-c/pull/1078#pullrequestreview-469440439", "createdAt": "2020-08-18T13:12:24Z", "commit": {"oid": "68edab2988772cd8c0c4030455b2dfd81b85300d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62bb3e95ebe2d13f78595410f969e3eadf7ba5e8", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/62bb3e95ebe2d13f78595410f969e3eadf7ba5e8", "committedDate": "2020-08-18T15:23:00Z", "message": "* Add bxc5 version to the spring context\n* Move bxc3 version to an enum\n* Bump default deposit version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NTY4MjU2", "url": "https://github.com/UNC-Libraries/box-c/pull/1078#pullrequestreview-469568256", "createdAt": "2020-08-18T15:26:10Z", "commit": {"oid": "62bb3e95ebe2d13f78595410f969e3eadf7ba5e8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNToyNjoxMFrOHCZ3rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNTozNDowNlrOHCaPAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4MzA1NQ==", "bodyText": "if its a new work, then it was generated in bxc5, so you should need to override here", "url": "https://github.com/UNC-Libraries/box-c/pull/1078#discussion_r472283055", "createdAt": "2020-08-18T15:26:10Z", "author": {"login": "bbpennel"}, "path": "migration-util/src/main/java/edu/unc/lib/dcr/migration/content/ContentObjectTransformer.java", "diffHunk": "@@ -363,7 +364,7 @@ private void populateFileObject(Resource bxc3Resc, Model depositModel) {\n         // transform existing PREMIS as the events for the file object, rather than work\n         transformPremis(originalPid, filePid);\n         if (isNewWork) {\n-            addMigrationEvent(getPremisLogger(newPid));\n+            addMigrationEvent(getPremisLogger(newPid), depositBxc3.getFullname());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62bb3e95ebe2d13f78595410f969e3eadf7ba5e8"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4Mzc1Mg==", "bodyText": "this event describes the migration of the object from boxc3 to 5, so it should have the migration-util 5.0 agent.", "url": "https://github.com/UNC-Libraries/box-c/pull/1078#discussion_r472283752", "createdAt": "2020-08-18T15:27:04Z", "author": {"login": "bbpennel"}, "path": "migration-util/src/main/java/edu/unc/lib/dcr/migration/content/ContentObjectTransformer.java", "diffHunk": "@@ -381,18 +382,20 @@ private void transformPremis(PID bxc3Pid, PID bxc5Pid) {\n         premisTransformer.compute();\n \n         // Add migration event\n-        addMigrationEvent(premisLogger);\n+        addMigrationEvent(premisLogger, depositBxc3.getFullname());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62bb3e95ebe2d13f78595410f969e3eadf7ba5e8"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjI4OTAyNw==", "bodyText": "I think you can remove this. It looks like TransformContentCommand uses service-context.xml now as well, so cdrVersion should be getting set that way already.", "url": "https://github.com/UNC-Libraries/box-c/pull/1078#discussion_r472289027", "createdAt": "2020-08-18T15:34:06Z", "author": {"login": "bbpennel"}, "path": "migration-util/src/main/java/edu/unc/lib/dcr/migration/content/ContentObjectTransformer.java", "diffHunk": "@@ -381,18 +382,20 @@ private void transformPremis(PID bxc3Pid, PID bxc5Pid) {\n         premisTransformer.compute();\n \n         // Add migration event\n-        addMigrationEvent(premisLogger);\n+        addMigrationEvent(premisLogger, depositBxc3.getFullname());\n     }\n \n     private PremisLogger getPremisLogger(PID bxc5Pid) {\n         Path transformedPremisPath = directoryManager.getPremisPath(bxc5Pid);\n         return premisLoggerFactory.createPremisLogger(bxc5Pid, transformedPremisPath.toFile());\n     }\n \n-    private void addMigrationEvent(PremisLogger premisLogger) {\n+    private void addMigrationEvent(PremisLogger premisLogger, String version) {\n+        SoftwareAgentConstants.setCdrVersion(version);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62bb3e95ebe2d13f78595410f969e3eadf7ba5e8"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "70c21cddc5271759fcbea680f075d1ce38c9bf16", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/70c21cddc5271759fcbea680f075d1ce38c9bf16", "committedDate": "2020-08-18T17:54:58Z", "message": "Move version update to premis transformers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNDI5MjU5", "url": "https://github.com/UNC-Libraries/box-c/pull/1078#pullrequestreview-470429259", "createdAt": "2020-08-19T12:58:04Z", "commit": {"oid": "70c21cddc5271759fcbea680f075d1ce38c9bf16"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMjo1ODowNFrOHDGI1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMzowMToyNVrOHDGRrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAwODM0MA==", "bodyText": "Once you make the change to the definition of \"depositBxc3\" suggested above, I think you'll be able to remove this method since the regular getFullname() method should be adding in 3.0 already since version is defined.", "url": "https://github.com/UNC-Libraries/box-c/pull/1078#discussion_r473008340", "createdAt": "2020-08-19T12:58:04Z", "author": {"login": "bbpennel"}, "path": "metadata/src/main/java/edu/unc/lib/dl/util/SoftwareAgentConstants.java", "diffHunk": "@@ -60,6 +61,10 @@ private SoftwareAgent(String value, String version) {\n             this.version = version;\n         }\n \n+        public String getFullname(String bxcVersion) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70c21cddc5271759fcbea680f075d1ce38c9bf16"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAwOTE1MA==", "bodyText": "you need to add the name of the service, depositBxc3(\"deposit\", \"3.0\"), right now you're setting the version as the name of the service.", "url": "https://github.com/UNC-Libraries/box-c/pull/1078#discussion_r473009150", "createdAt": "2020-08-19T12:59:13Z", "author": {"login": "bbpennel"}, "path": "metadata/src/main/java/edu/unc/lib/dl/util/SoftwareAgentConstants.java", "diffHunk": "@@ -44,6 +44,7 @@ public static String getCdrVersion() {\n         embargoUpdateService(\"embargo-update\"),\n         migrationUtil(\"bxc-migration-util\"),\n         clamav(\"clamav\", \"0.99\"),\n+        depositBxc3(\"3.0\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70c21cddc5271759fcbea680f075d1ce38c9bf16"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzAxMDYwNA==", "bodyText": "i'm guessing these changes won't be necessary after updating depositBxc3 to have the name of the service, so you should be able to roll them back", "url": "https://github.com/UNC-Libraries/box-c/pull/1078#discussion_r473010604", "createdAt": "2020-08-19T13:01:25Z", "author": {"login": "bbpennel"}, "path": "migration-util/src/main/java/edu/unc/lib/dcr/migration/premis/ContentPremisToRdfTransformer.java", "diffHunk": "@@ -307,7 +308,11 @@ private void addFixityEvent(Element eventEl, String eventOutcome) {\n     }\n \n     private void addEvent(Element eventEl, Resource eventType, String eventDetail, SoftwareAgent agent) {\n-        addEvent(eventEl, eventType, eventDetail, true, agent.getFullname());\n+        String agentFullname = agent.getFullname();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70c21cddc5271759fcbea680f075d1ce38c9bf16"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16cb27f789dc6be3057e6b7cf251dac19b1a8ab2", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/16cb27f789dc6be3057e6b7cf251dac19b1a8ab2", "committedDate": "2020-08-19T18:48:46Z", "message": "Add \"name\" for depositBxc3"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "40f8c3112ef7f25da02b01eb05a7827989d2be7b", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/40f8c3112ef7f25da02b01eb05a7827989d2be7b", "committedDate": "2020-08-19T17:22:04Z", "message": "Add \"name\" for depositBxc3"}, "afterCommit": {"oid": "16cb27f789dc6be3057e6b7cf251dac19b1a8ab2", "author": {"user": {"login": "lfarrell", "name": "Dean Farrell"}}, "url": "https://github.com/UNC-Libraries/box-c/commit/16cb27f789dc6be3057e6b7cf251dac19b1a8ab2", "committedDate": "2020-08-19T18:48:46Z", "message": "Add \"name\" for depositBxc3"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2269, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}