{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MTk3NjQy", "number": 1456, "reviewThreads": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMToyNjoxOFrODjP2KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMzo0MDoyMFrOEQL60A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4Mjg2Mzc3OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQyMToyNjoxOFrOFu82rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNjozOTo1NFrOGCMbtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc3NTg1Mw==", "bodyText": "Would be nice to expose to the command line the option to not concatenate all the merged interval names.  In the use case which prompted this, a TON of sites (think whole genome gvcf with bp resolution) are often merged into a single interval, which then has an outrageously long concatenated name.  These concatenated names often don't carry any useful information, and can make the resulting interval list extremely large.", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r384775853", "createdAt": "2020-02-26T21:26:18Z", "author": {"login": "kachulis"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -84,10 +91,23 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        final IntervalList intervalList = VCFFileReader.fromVcf(INPUT, INCLUDE_FILTERED);\n+        try (VCFFileReader vcfReader = new VCFFileReader(INPUT.toPath(), false)) {\n+            final Iterator<Interval> samFileIterator = VCFFileReader.toIntervals(vcfReader, INCLUDE_FILTERED);\n+            try (IntervalListWriter writer = new IntervalListWriter(OUTPUT.toPath(), new SAMFileHeader(vcfReader.getFileHeader().getSequenceDictionary()))) {\n+                final IntervalList.IntervalMergerIterator mergingIterator =\n+                        new IntervalList.IntervalMergerIterator(samFileIterator, true, false, true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68fe8bea94b403d64f47d456831629b684776e07"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkwNDkzMg==", "bodyText": "Yeah, \ud83d\udc4d", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r389904932", "createdAt": "2020-03-09T19:14:12Z", "author": {"login": "skwalker"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -84,10 +91,23 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        final IntervalList intervalList = VCFFileReader.fromVcf(INPUT, INCLUDE_FILTERED);\n+        try (VCFFileReader vcfReader = new VCFFileReader(INPUT.toPath(), false)) {\n+            final Iterator<Interval> samFileIterator = VCFFileReader.toIntervals(vcfReader, INCLUDE_FILTERED);\n+            try (IntervalListWriter writer = new IntervalListWriter(OUTPUT.toPath(), new SAMFileHeader(vcfReader.getFileHeader().getSequenceDictionary()))) {\n+                final IntervalList.IntervalMergerIterator mergingIterator =\n+                        new IntervalList.IntervalMergerIterator(samFileIterator, true, false, true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc3NTg1Mw=="}, "originalCommit": {"oid": "68fe8bea94b403d64f47d456831629b684776e07"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQwMDczMg==", "bodyText": "like so?", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r395400732", "createdAt": "2020-03-20T01:16:55Z", "author": {"login": "yfarjoun"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -84,10 +91,23 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        final IntervalList intervalList = VCFFileReader.fromVcf(INPUT, INCLUDE_FILTERED);\n+        try (VCFFileReader vcfReader = new VCFFileReader(INPUT.toPath(), false)) {\n+            final Iterator<Interval> samFileIterator = VCFFileReader.toIntervals(vcfReader, INCLUDE_FILTERED);\n+            try (IntervalListWriter writer = new IntervalListWriter(OUTPUT.toPath(), new SAMFileHeader(vcfReader.getFileHeader().getSequenceDictionary()))) {\n+                final IntervalList.IntervalMergerIterator mergingIterator =\n+                        new IntervalList.IntervalMergerIterator(samFileIterator, true, false, true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc3NTg1Mw=="}, "originalCommit": {"oid": "68fe8bea94b403d64f47d456831629b684776e07"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYxNzUwNw==", "bodyText": "yep!", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r395617507", "createdAt": "2020-03-20T12:56:42Z", "author": {"login": "kachulis"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -84,10 +91,23 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        final IntervalList intervalList = VCFFileReader.fromVcf(INPUT, INCLUDE_FILTERED);\n+        try (VCFFileReader vcfReader = new VCFFileReader(INPUT.toPath(), false)) {\n+            final Iterator<Interval> samFileIterator = VCFFileReader.toIntervals(vcfReader, INCLUDE_FILTERED);\n+            try (IntervalListWriter writer = new IntervalListWriter(OUTPUT.toPath(), new SAMFileHeader(vcfReader.getFileHeader().getSequenceDictionary()))) {\n+                final IntervalList.IntervalMergerIterator mergingIterator =\n+                        new IntervalList.IntervalMergerIterator(samFileIterator, true, false, true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc3NTg1Mw=="}, "originalCommit": {"oid": "68fe8bea94b403d64f47d456831629b684776e07"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNzc1Nw==", "bodyText": "@skwalker can you try this on your VCF that was causing all the trouble and see if it helps?", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r395707757", "createdAt": "2020-03-20T15:19:08Z", "author": {"login": "yfarjoun"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -84,10 +91,23 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        final IntervalList intervalList = VCFFileReader.fromVcf(INPUT, INCLUDE_FILTERED);\n+        try (VCFFileReader vcfReader = new VCFFileReader(INPUT.toPath(), false)) {\n+            final Iterator<Interval> samFileIterator = VCFFileReader.toIntervals(vcfReader, INCLUDE_FILTERED);\n+            try (IntervalListWriter writer = new IntervalListWriter(OUTPUT.toPath(), new SAMFileHeader(vcfReader.getFileHeader().getSequenceDictionary()))) {\n+                final IntervalList.IntervalMergerIterator mergingIterator =\n+                        new IntervalList.IntervalMergerIterator(samFileIterator, true, false, true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc3NTg1Mw=="}, "originalCommit": {"oid": "68fe8bea94b403d64f47d456831629b684776e07"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk1NDAzNg==", "bodyText": "It works! Thank you (the output interval list went from almost 10G to less than 1 with that change)", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r404954036", "createdAt": "2020-04-07T16:39:54Z", "author": {"login": "skwalker"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -84,10 +91,23 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        final IntervalList intervalList = VCFFileReader.fromVcf(INPUT, INCLUDE_FILTERED);\n+        try (VCFFileReader vcfReader = new VCFFileReader(INPUT.toPath(), false)) {\n+            final Iterator<Interval> samFileIterator = VCFFileReader.toIntervals(vcfReader, INCLUDE_FILTERED);\n+            try (IntervalListWriter writer = new IntervalListWriter(OUTPUT.toPath(), new SAMFileHeader(vcfReader.getFileHeader().getSequenceDictionary()))) {\n+                final IntervalList.IntervalMergerIterator mergingIterator =\n+                        new IntervalList.IntervalMergerIterator(samFileIterator, true, false, true);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc3NTg1Mw=="}, "originalCommit": {"oid": "68fe8bea94b403d64f47d456831629b684776e07"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMjg4Nzg5OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxNjo0MDo0OFrOGCMeAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMToxNTo1MlrOGCWbeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk1NDYyNA==", "bodyText": "Don't we usually want boolean argument defaults to be false?", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r404954624", "createdAt": "2020-04-07T16:40:48Z", "author": {"login": "skwalker"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -74,6 +81,11 @@\n     @Argument(shortName = StandardOptionDefinitions.OUTPUT_SHORT_NAME, doc = \"The output Picard Interval List.\")\n     public File OUTPUT;\n \n+    @Argument(doc=\"Controls the naming of the resulting intervals. When true, each resulting interval will be named the concatenation of \" +\n+            \"the variant ID fields (if present), or 'interval-<number>' (if not) with a pipe '|' separator. \" +\n+            \"When false, only the first name will be used.\")\n+    public boolean CONCATENATE_IDS = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ed64955b878e90b44037156f14c504334368114"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTExNzgxNg==", "bodyText": "good point.", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r405117816", "createdAt": "2020-04-07T21:15:52Z", "author": {"login": "yfarjoun"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -74,6 +81,11 @@\n     @Argument(shortName = StandardOptionDefinitions.OUTPUT_SHORT_NAME, doc = \"The output Picard Interval List.\")\n     public File OUTPUT;\n \n+    @Argument(doc=\"Controls the naming of the resulting intervals. When true, each resulting interval will be named the concatenation of \" +\n+            \"the variant ID fields (if present), or 'interval-<number>' (if not) with a pipe '|' separator. \" +\n+            \"When false, only the first name will be used.\")\n+    public boolean CONCATENATE_IDS = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk1NDYyNA=="}, "originalCommit": {"oid": "8ed64955b878e90b44037156f14c504334368114"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUxMzgwMzQ5OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMDo0NjozN1rOGCVdsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QyMToxNjoxNVrOGCWcKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEwMjAwMA==", "bodyText": "does this need to be \".incomplete\" ?", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r405102000", "createdAt": "2020-04-07T20:46:37Z", "author": {"login": "skwalker"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -84,10 +96,23 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        final IntervalList intervalList = VCFFileReader.fromVcf(INPUT, INCLUDE_FILTERED);\n+        try (VCFFileReader vcfReader = new VCFFileReader(INPUT.toPath(), false)) {\n+            final Iterator<Interval> samFileIterator = VCFFileReader.toIntervals(vcfReader, INCLUDE_FILTERED);\n+            try (IntervalListWriter writer = new IntervalListWriter(OUTPUT.toPath(), new SAMFileHeader(vcfReader.getFileHeader().getSequenceDictionary()))) {\n+                final IntervalList.IntervalMergerIterator mergingIterator =\n+                        new IntervalList.IntervalMergerIterator(samFileIterator, true, false, CONCATENATE_IDS);\n+                for (final Interval interval : new IterableAdapter<>(mergingIterator)){\n+                    writer.write(interval);\n+                }\n+            } catch (IOException e) {\n+                if(!OUTPUT.renameTo(new File(OUTPUT.getAbsolutePath() + \"incomplete\"))){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ed64955b878e90b44037156f14c504334368114"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTExNzk5NQ==", "bodyText": "ah, yes. I'll add the period. thanks.", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r405117995", "createdAt": "2020-04-07T21:16:15Z", "author": {"login": "yfarjoun"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -84,10 +96,23 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        final IntervalList intervalList = VCFFileReader.fromVcf(INPUT, INCLUDE_FILTERED);\n+        try (VCFFileReader vcfReader = new VCFFileReader(INPUT.toPath(), false)) {\n+            final Iterator<Interval> samFileIterator = VCFFileReader.toIntervals(vcfReader, INCLUDE_FILTERED);\n+            try (IntervalListWriter writer = new IntervalListWriter(OUTPUT.toPath(), new SAMFileHeader(vcfReader.getFileHeader().getSequenceDictionary()))) {\n+                final IntervalList.IntervalMergerIterator mergingIterator =\n+                        new IntervalList.IntervalMergerIterator(samFileIterator, true, false, CONCATENATE_IDS);\n+                for (final Interval interval : new IterableAdapter<>(mergingIterator)){\n+                    writer.write(interval);\n+                }\n+            } catch (IOException e) {\n+                if(!OUTPUT.renameTo(new File(OUTPUT.getAbsolutePath() + \"incomplete\"))){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEwMjAwMA=="}, "originalCommit": {"oid": "8ed64955b878e90b44037156f14c504334368114"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0ODE4MDkxOnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/util/IntervalListToBed.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTo1NTowM1rOGkq7VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo1NTo1MlrOGvhfSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwNTIzNw==", "bodyText": "no need to close out since it's inside the T-W-R loop.", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r441105237", "createdAt": "2020-06-16T19:55:03Z", "author": {"login": "yfarjoun"}, "path": "src/main/java/picard/util/IntervalListToBed.java", "diffHunk": "@@ -69,24 +69,37 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        IntervalList intervals = IntervalList.fromFile(INPUT);\n-        if (SORT) intervals = intervals.sorted();\n+        try (final AbstractFeatureReader<Interval, LineIterator> intervalsReader = AbstractFeatureReader.getFeatureReader(INPUT.getPath(), new IntervalListCodec(), false);\n+             final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT)) {\n \n-        try {\n-            final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT);\n-            for (final Interval i : intervals) {\n+            Iterable<Interval> intervalIterable = intervalsReader.iterator();\n+            if (SORT) {\n+\n+                final SortingCollection<Interval> sortedIntervals =\n+                        SortingCollection.newInstance(Interval.class, new IntervalCodec(((SAMFileHeader)intervalsReader.getHeader()).getSequenceDictionary()),\n+                                Interval::compareTo, 500000, OUTPUT.toPath());\n+\n+                for (final Interval i: intervalsReader.iterator()) {\n+                    sortedIntervals.add(i);\n+                }\n+\n+                intervalIterable = sortedIntervals;\n+            }\n+\n+            for (final Interval i : intervalIterable) {\n                 final String strand = i.isNegativeStrand() ? \"-\" : \"+\";\n                 final List<?> fields = CollectionUtil.makeList(i.getContig(), i.getStart()-1, i.getEnd(), i.getName(), SCORE, strand);\n                 out.append(fields.stream().map(String::valueOf).collect(Collectors.joining(\"\\t\")));\n                 out.newLine();\n-            }\n \n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2822b6f816c279fd32c6f1688011de720e89c7f"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NDkzNw==", "bodyText": "still no need to close", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r452484937", "createdAt": "2020-07-09T20:55:52Z", "author": {"login": "yfarjoun"}, "path": "src/main/java/picard/util/IntervalListToBed.java", "diffHunk": "@@ -69,24 +69,37 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        IntervalList intervals = IntervalList.fromFile(INPUT);\n-        if (SORT) intervals = intervals.sorted();\n+        try (final AbstractFeatureReader<Interval, LineIterator> intervalsReader = AbstractFeatureReader.getFeatureReader(INPUT.getPath(), new IntervalListCodec(), false);\n+             final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT)) {\n \n-        try {\n-            final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT);\n-            for (final Interval i : intervals) {\n+            Iterable<Interval> intervalIterable = intervalsReader.iterator();\n+            if (SORT) {\n+\n+                final SortingCollection<Interval> sortedIntervals =\n+                        SortingCollection.newInstance(Interval.class, new IntervalCodec(((SAMFileHeader)intervalsReader.getHeader()).getSequenceDictionary()),\n+                                Interval::compareTo, 500000, OUTPUT.toPath());\n+\n+                for (final Interval i: intervalsReader.iterator()) {\n+                    sortedIntervals.add(i);\n+                }\n+\n+                intervalIterable = sortedIntervals;\n+            }\n+\n+            for (final Interval i : intervalIterable) {\n                 final String strand = i.isNegativeStrand() ? \"-\" : \"+\";\n                 final List<?> fields = CollectionUtil.makeList(i.getContig(), i.getStart()-1, i.getEnd(), i.getName(), SCORE, strand);\n                 out.append(fields.stream().map(String::valueOf).collect(Collectors.joining(\"\\t\")));\n                 out.newLine();\n-            }\n \n+            }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwNTIzNw=="}, "originalCommit": {"oid": "f2822b6f816c279fd32c6f1688011de720e89c7f"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0ODE4NTkzOnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/util/IntervalListToBed.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTo1NjozM1rOGkq-aA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo1NzozNFrOGvhi1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwNjAyNA==", "bodyText": "this is actually a closable iterator, so you can put it inside the try clause above as well", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r441106024", "createdAt": "2020-06-16T19:56:33Z", "author": {"login": "yfarjoun"}, "path": "src/main/java/picard/util/IntervalListToBed.java", "diffHunk": "@@ -69,24 +69,37 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        IntervalList intervals = IntervalList.fromFile(INPUT);\n-        if (SORT) intervals = intervals.sorted();\n+        try (final AbstractFeatureReader<Interval, LineIterator> intervalsReader = AbstractFeatureReader.getFeatureReader(INPUT.getPath(), new IntervalListCodec(), false);\n+             final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT)) {\n \n-        try {\n-            final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT);\n-            for (final Interval i : intervals) {\n+            Iterable<Interval> intervalIterable = intervalsReader.iterator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2822b6f816c279fd32c6f1688011de720e89c7f"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY4MzM4Ng==", "bodyText": "it is in the try clause, I think maybe it looks confusing in the side by side view ?", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r441683386", "createdAt": "2020-06-17T16:44:24Z", "author": {"login": "skwalker"}, "path": "src/main/java/picard/util/IntervalListToBed.java", "diffHunk": "@@ -69,24 +69,37 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        IntervalList intervals = IntervalList.fromFile(INPUT);\n-        if (SORT) intervals = intervals.sorted();\n+        try (final AbstractFeatureReader<Interval, LineIterator> intervalsReader = AbstractFeatureReader.getFeatureReader(INPUT.getPath(), new IntervalListCodec(), false);\n+             final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT)) {\n \n-        try {\n-            final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT);\n-            for (final Interval i : intervals) {\n+            Iterable<Interval> intervalIterable = intervalsReader.iterator();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwNjAyNA=="}, "originalCommit": {"oid": "f2822b6f816c279fd32c6f1688011de720e89c7f"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NTg0Ng==", "bodyText": "I meant that intervalIterable can be instantiated inside the parens:\ntry (AbstractFeatureReader<Interval, LineIterator> intervalsReader = AbstractFeatureReader.getFeatureReader(INPUT.getPath(), new IntervalListCodec(), false);\n       Iterable<Interval> intervalIterable = intervalsReader.iterator();\n       BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT)){", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r452485846", "createdAt": "2020-07-09T20:57:34Z", "author": {"login": "yfarjoun"}, "path": "src/main/java/picard/util/IntervalListToBed.java", "diffHunk": "@@ -69,24 +69,37 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        IntervalList intervals = IntervalList.fromFile(INPUT);\n-        if (SORT) intervals = intervals.sorted();\n+        try (final AbstractFeatureReader<Interval, LineIterator> intervalsReader = AbstractFeatureReader.getFeatureReader(INPUT.getPath(), new IntervalListCodec(), false);\n+             final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT)) {\n \n-        try {\n-            final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT);\n-            for (final Interval i : intervals) {\n+            Iterable<Interval> intervalIterable = intervalsReader.iterator();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwNjAyNA=="}, "originalCommit": {"oid": "f2822b6f816c279fd32c6f1688011de720e89c7f"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0ODE5MjY1OnYy", "diffSide": "LEFT", "path": "src/main/java/picard/util/IntervalListToBed.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTo1ODozNlrOGkrClw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNjo0MzoyMFrOGlOLIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwNzA5NQ==", "bodyText": "why was this bad? perhaps you can explain in a comment since the code below seems needlessly complicated....", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r441107095", "createdAt": "2020-06-16T19:58:36Z", "author": {"login": "yfarjoun"}, "path": "src/main/java/picard/util/IntervalListToBed.java", "diffHunk": "@@ -69,24 +69,37 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        IntervalList intervals = IntervalList.fromFile(INPUT);\n-        if (SORT) intervals = intervals.sorted();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2822b6f816c279fd32c6f1688011de720e89c7f"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY4MjcyMQ==", "bodyText": "It's causing it to hold everything in place which takes forever to load (I was running on an intervallist from a  <1 G vcf and it was running for over 3 hours...) and now it takes 3 minutes", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r441682721", "createdAt": "2020-06-17T16:43:20Z", "author": {"login": "skwalker"}, "path": "src/main/java/picard/util/IntervalListToBed.java", "diffHunk": "@@ -69,24 +69,37 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        IntervalList intervals = IntervalList.fromFile(INPUT);\n-        if (SORT) intervals = intervals.sorted();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwNzA5NQ=="}, "originalCommit": {"oid": "f2822b6f816c279fd32c6f1688011de720e89c7f"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0ODIwNDY5OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/util/IntervalListToBed.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDowMjozMVrOGkrKcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMzoyNDo0N1rOG0MORw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwOTEwNQ==", "bodyText": "unneeded empty new lines.", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r441109105", "createdAt": "2020-06-16T20:02:31Z", "author": {"login": "yfarjoun"}, "path": "src/main/java/picard/util/IntervalListToBed.java", "diffHunk": "@@ -69,24 +69,37 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        IntervalList intervals = IntervalList.fromFile(INPUT);\n-        if (SORT) intervals = intervals.sorted();\n+        try (final AbstractFeatureReader<Interval, LineIterator> intervalsReader = AbstractFeatureReader.getFeatureReader(INPUT.getPath(), new IntervalListCodec(), false);\n+             final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT)) {\n \n-        try {\n-            final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT);\n-            for (final Interval i : intervals) {\n+            Iterable<Interval> intervalIterable = intervalsReader.iterator();\n+            if (SORT) {\n+\n+                final SortingCollection<Interval> sortedIntervals =\n+                        SortingCollection.newInstance(Interval.class, new IntervalCodec(((SAMFileHeader)intervalsReader.getHeader()).getSequenceDictionary()),\n+                                Interval::compareTo, 500000, OUTPUT.toPath());\n+\n+                for (final Interval i: intervalsReader.iterator()) {\n+                    sortedIntervals.add(i);\n+                }\n+\n+                intervalIterable = sortedIntervals;\n+            }\n+\n+            for (final Interval i : intervalIterable) {\n                 final String strand = i.isNegativeStrand() ? \"-\" : \"+\";\n                 final List<?> fields = CollectionUtil.makeList(i.getContig(), i.getStart()-1, i.getEnd(), i.getName(), SCORE, strand);\n                 out.append(fields.stream().map(String::valueOf).collect(Collectors.joining(\"\\t\")));\n                 out.newLine();\n-            }\n \n+            }\n             out.close();\n-        }\n-        catch (IOException ioe) {\n+            return 0;\n+        } catch (IOException ioe) {\n             throw new RuntimeIOException(ioe);\n         }\n \n-        return 0;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2822b6f816c279fd32c6f1688011de720e89c7f"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM3OTM5OQ==", "bodyText": "empty new line still here", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r457379399", "createdAt": "2020-07-20T13:24:47Z", "author": {"login": "kachulis"}, "path": "src/main/java/picard/util/IntervalListToBed.java", "diffHunk": "@@ -69,24 +69,37 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        IntervalList intervals = IntervalList.fromFile(INPUT);\n-        if (SORT) intervals = intervals.sorted();\n+        try (final AbstractFeatureReader<Interval, LineIterator> intervalsReader = AbstractFeatureReader.getFeatureReader(INPUT.getPath(), new IntervalListCodec(), false);\n+             final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT)) {\n \n-        try {\n-            final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT);\n-            for (final Interval i : intervals) {\n+            Iterable<Interval> intervalIterable = intervalsReader.iterator();\n+            if (SORT) {\n+\n+                final SortingCollection<Interval> sortedIntervals =\n+                        SortingCollection.newInstance(Interval.class, new IntervalCodec(((SAMFileHeader)intervalsReader.getHeader()).getSequenceDictionary()),\n+                                Interval::compareTo, 500000, OUTPUT.toPath());\n+\n+                for (final Interval i: intervalsReader.iterator()) {\n+                    sortedIntervals.add(i);\n+                }\n+\n+                intervalIterable = sortedIntervals;\n+            }\n+\n+            for (final Interval i : intervalIterable) {\n                 final String strand = i.isNegativeStrand() ? \"-\" : \"+\";\n                 final List<?> fields = CollectionUtil.makeList(i.getContig(), i.getStart()-1, i.getEnd(), i.getName(), SCORE, strand);\n                 out.append(fields.stream().map(String::valueOf).collect(Collectors.joining(\"\\t\")));\n                 out.newLine();\n-            }\n \n+            }\n             out.close();\n-        }\n-        catch (IOException ioe) {\n+            return 0;\n+        } catch (IOException ioe) {\n             throw new RuntimeIOException(ioe);\n         }\n \n-        return 0;\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwOTEwNQ=="}, "originalCommit": {"oid": "f2822b6f816c279fd32c6f1688011de720e89c7f"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0ODIwOTgzOnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDowNDoyMFrOGkrNqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDoyNjo1NVrOGmWwYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwOTkzMA==", "bodyText": "Hmmm. The reason that this was default true was that that was the behavior prior to making this an option....we didn't want to change the default behavior....why does the default need to change?", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r441109930", "createdAt": "2020-06-16T20:04:20Z", "author": {"login": "yfarjoun"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -84,7 +84,7 @@\n     @Argument(doc=\"Controls the naming of the resulting intervals. When true, each resulting interval will be named the concatenation of \" +\n             \"the variant ID fields (if present), or 'interval-<number>' (if not) with a pipe '|' separator. \" +\n             \"When false, only the first name will be used.\")\n-    public boolean CONCATENATE_IDS = true;\n+    public boolean CONCATENATE_IDS = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2822b6f816c279fd32c6f1688011de720e89c7f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY3MDkxMg==", "bodyText": "I thought boolean arguments are supposed to default to false? I could make it\nDONT_ CONCATENATE_IDS or something or maybe it doesn't matter enough", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r441670912", "createdAt": "2020-06-17T16:24:08Z", "author": {"login": "skwalker"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -84,7 +84,7 @@\n     @Argument(doc=\"Controls the naming of the resulting intervals. When true, each resulting interval will be named the concatenation of \" +\n             \"the variant ID fields (if present), or 'interval-<number>' (if not) with a pipe '|' separator. \" +\n             \"When false, only the first name will be used.\")\n-    public boolean CONCATENATE_IDS = true;\n+    public boolean CONCATENATE_IDS = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwOTkzMA=="}, "originalCommit": {"oid": "f2822b6f816c279fd32c6f1688011de720e89c7f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgwMzg2OA==", "bodyText": "yeah, make the default value false, but keep the default behavior the same...or define an enum \"CONCAT_ALL\" & \"USE_FIRST\" to control the behaviour (with the default value being CONCAT_ALL)", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r441803868", "createdAt": "2020-06-17T20:08:51Z", "author": {"login": "yfarjoun"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -84,7 +84,7 @@\n     @Argument(doc=\"Controls the naming of the resulting intervals. When true, each resulting interval will be named the concatenation of \" +\n             \"the variant ID fields (if present), or 'interval-<number>' (if not) with a pipe '|' separator. \" +\n             \"When false, only the first name will be used.\")\n-    public boolean CONCATENATE_IDS = true;\n+    public boolean CONCATENATE_IDS = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwOTkzMA=="}, "originalCommit": {"oid": "f2822b6f816c279fd32c6f1688011de720e89c7f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg3MTkwNg==", "bodyText": "Yeah, I like the enum idea better than a double negative (too confusing) \ud83d\udc4d", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r442871906", "createdAt": "2020-06-19T14:26:55Z", "author": {"login": "skwalker"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -84,7 +84,7 @@\n     @Argument(doc=\"Controls the naming of the resulting intervals. When true, each resulting interval will be named the concatenation of \" +\n             \"the variant ID fields (if present), or 'interval-<number>' (if not) with a pipe '|' separator. \" +\n             \"When false, only the first name will be used.\")\n-    public boolean CONCATENATE_IDS = true;\n+    public boolean CONCATENATE_IDS = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTEwOTkzMA=="}, "originalCommit": {"oid": "f2822b6f816c279fd32c6f1688011de720e89c7f"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0ODIxMTgxOnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/util/IntervalListToBed.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDowNTowNVrOGkrO7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQyMDowNTowNVrOGkrO7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTExMDI1Mg==", "bodyText": "there is a preference for explicit imports...can you ask IntelliJ to use explicit imports?", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r441110252", "createdAt": "2020-06-16T20:05:05Z", "author": {"login": "yfarjoun"}, "path": "src/main/java/picard/util/IntervalListToBed.java", "diffHunk": "@@ -23,11 +23,11 @@\n  */\n package picard.util;\n \n-import htsjdk.samtools.util.CollectionUtil;\n-import htsjdk.samtools.util.IOUtil;\n-import htsjdk.samtools.util.Interval;\n-import htsjdk.samtools.util.IntervalList;\n-import htsjdk.samtools.util.RuntimeIOException;\n+import htsjdk.samtools.SAMFileHeader;\n+import htsjdk.samtools.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f2822b6f816c279fd32c6f1688011de720e89c7f"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4ODUzNjU4OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNToyNToxNlrOGqsL4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwNToyNToxNlrOGqsL4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQxNzMxMg==", "bodyText": "this cannot work...the @argument value is modified after the class is instantiated...so concatenate_ids will always be true. move this line into doWork()", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r447417312", "createdAt": "2020-06-30T05:25:16Z", "author": {"login": "yfarjoun"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -81,10 +81,17 @@\n     @Argument(shortName = StandardOptionDefinitions.OUTPUT_SHORT_NAME, doc = \"The output Picard Interval List.\")\n     public File OUTPUT;\n \n-    @Argument(doc=\"Controls the naming of the resulting intervals. When true, each resulting interval will be named the concatenation of \" +\n-            \"the variant ID fields (if present), or 'interval-<number>' (if not) with a pipe '|' separator. \" +\n-            \"When false, only the first name will be used.\")\n-    public boolean CONCATENATE_IDS = false;\n+\n+    public enum VARIANT_ID_TYPES {\n+        CONCAT_ALL,\n+        USE_FIRST\n+    }\n+\n+    @Argument(doc=\"Controls the naming of the resulting intervals. When set to CONCAT_ALL (the default), each resulting \" +\n+            \"interval will be named the concatenation of the variant ID fields (if present), or 'interval-<number>' \" +\n+            \"(if not) with a pipe '|' separator. If set to USE_FIRST, only the first name will be used.\")\n+    public VARIANT_ID_TYPES VARIANT_ID_METHOD = VARIANT_ID_TYPES.CONCAT_ALL;\n+    public final boolean concatenate_ids = (VARIANT_ID_METHOD == VARIANT_ID_TYPES.CONCAT_ALL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd351944bde1a83c757616ee9ecb1e151caa83e3"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTIzNDMyOnYy", "diffSide": "RIGHT", "path": "src/test/java/picard/vcf/VcfToIntervalListTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo1ODoyMlrOGvhkew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMzozNjoxMVrOG0M2ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NjI2Nw==", "bodyText": "too many new lines", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r452486267", "createdAt": "2020-07-09T20:58:22Z", "author": {"login": "yfarjoun"}, "path": "src/test/java/picard/vcf/VcfToIntervalListTest.java", "diffHunk": "@@ -48,12 +49,33 @@ public void testExcludingFiltered(\n         if (includeFiltered) {\n             arguments.add(VcfToIntervalList.INCLUDE_FILTERED_SHORT_NAME + \"=true\");\n         }\n+        if (useFirstID) {\n+            arguments.add(\"VARIANT_ID_METHOD=USE_FIRST\");\n+        } else {\n+            arguments.add(\"VARIANT_ID_METHOD=CONCAT_ALL\"); // this should be the default and unnecessary\n+        }\n         runPicardCommandLine(arguments);\n \n         Assert.assertTrue(outputFile.exists());\n \n         final List<Interval> intervals = IntervalList.fromFile(outputFile).getIntervals();\n \n         Assert.assertEquals(intervals.size(), expectedIntervalsSize);\n+\n+        if (useFirstID) {\n+            for (Interval interval : intervals) {\n+                Assert.assertFalse(interval.getName().contains(\"|\"));\n+            }\n+        } else {\n+            // make sure the one where two sites that should be concatenated into one interval were actually concatenated\n+            Assert.assertTrue(intervals.get(5).getName().contains(\"|\"));\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4193e26c0e539bae219ea5af4bc2715bdd800da4"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM4OTY5MQ==", "bodyText": "still too many new lines", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r457389691", "createdAt": "2020-07-20T13:36:11Z", "author": {"login": "kachulis"}, "path": "src/test/java/picard/vcf/VcfToIntervalListTest.java", "diffHunk": "@@ -48,12 +49,33 @@ public void testExcludingFiltered(\n         if (includeFiltered) {\n             arguments.add(VcfToIntervalList.INCLUDE_FILTERED_SHORT_NAME + \"=true\");\n         }\n+        if (useFirstID) {\n+            arguments.add(\"VARIANT_ID_METHOD=USE_FIRST\");\n+        } else {\n+            arguments.add(\"VARIANT_ID_METHOD=CONCAT_ALL\"); // this should be the default and unnecessary\n+        }\n         runPicardCommandLine(arguments);\n \n         Assert.assertTrue(outputFile.exists());\n \n         final List<Interval> intervals = IntervalList.fromFile(outputFile).getIntervals();\n \n         Assert.assertEquals(intervals.size(), expectedIntervalsSize);\n+\n+        if (useFirstID) {\n+            for (Interval interval : intervals) {\n+                Assert.assertFalse(interval.getName().contains(\"|\"));\n+            }\n+        } else {\n+            // make sure the one where two sites that should be concatenated into one interval were actually concatenated\n+            Assert.assertTrue(intervals.get(5).getName().contains(\"|\"));\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NjI2Nw=="}, "originalCommit": {"oid": "4193e26c0e539bae219ea5af4bc2715bdd800da4"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyMTIzNDk4OnYy", "diffSide": "RIGHT", "path": "src/test/java/picard/vcf/VcfToIntervalListTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo1ODozNVrOGvhk5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQyMDo1ODozNVrOGvhk5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NjM3Mw==", "bodyText": "remove comment?", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r452486373", "createdAt": "2020-07-09T20:58:35Z", "author": {"login": "yfarjoun"}, "path": "src/test/java/picard/vcf/VcfToIntervalListTest.java", "diffHunk": "@@ -48,12 +49,33 @@ public void testExcludingFiltered(\n         if (includeFiltered) {\n             arguments.add(VcfToIntervalList.INCLUDE_FILTERED_SHORT_NAME + \"=true\");\n         }\n+        if (useFirstID) {\n+            arguments.add(\"VARIANT_ID_METHOD=USE_FIRST\");\n+        } else {\n+            arguments.add(\"VARIANT_ID_METHOD=CONCAT_ALL\"); // this should be the default and unnecessary\n+        }\n         runPicardCommandLine(arguments);\n \n         Assert.assertTrue(outputFile.exists());\n \n         final List<Interval> intervals = IntervalList.fromFile(outputFile).getIntervals();\n \n         Assert.assertEquals(intervals.size(), expectedIntervalsSize);\n+\n+        if (useFirstID) {\n+            for (Interval interval : intervals) {\n+                Assert.assertFalse(interval.getName().contains(\"|\"));\n+            }\n+        } else {\n+            // make sure the one where two sites that should be concatenated into one interval were actually concatenated\n+            Assert.assertTrue(intervals.get(5).getName().contains(\"|\"));\n+\n+\n+        }\n+\n+\n+\n     }\n }\n+\n+// USE_FIRST", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4193e26c0e539bae219ea5af4bc2715bdd800da4"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0ODU4NjQ0OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/util/IntervalListToBed.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QyMDoxMToyNFrOGzf3EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QyMDoxMToyNFrOGzf3EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY1MjU2MQ==", "bodyText": "No longer need to close out because try-with-resources", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r456652561", "createdAt": "2020-07-17T20:11:24Z", "author": {"login": "kachulis"}, "path": "src/main/java/picard/util/IntervalListToBed.java", "diffHunk": "@@ -69,24 +75,45 @@ protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n \n-        IntervalList intervals = IntervalList.fromFile(INPUT);\n-        if (SORT) intervals = intervals.sorted();\n-\n-        try {\n-            final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT);\n-            for (final Interval i : intervals) {\n-                final String strand = i.isNegativeStrand() ? \"-\" : \"+\";\n-                final List<?> fields = CollectionUtil.makeList(i.getContig(), i.getStart()-1, i.getEnd(), i.getName(), SCORE, strand);\n-                out.append(fields.stream().map(String::valueOf).collect(Collectors.joining(\"\\t\")));\n-                out.newLine();\n-            }\n+        try (final AbstractFeatureReader<Interval, LineIterator> intervalsReader = AbstractFeatureReader.getFeatureReader(INPUT.getPath(), new IntervalListCodec(), false);\n+             CloseableIterator<Interval> intervalsToUse = getSortedIntervals(intervalsReader);\n+             final BufferedWriter out = IOUtil.openFileForBufferedWriting(OUTPUT)) {\n+            intervalsToUse.stream().forEach(i -> generateOutput(i, out));\n \n             out.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd108292a7c3d4c06d068fb2d1285dc1ee94c37f"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1Mzk5MDc4OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMzoyNjowOVrOG0MS2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMzoyNjowOVrOG0MS2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM4MDU2OA==", "bodyText": "no longer needs \"TODO\" comment", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r457380568", "createdAt": "2020-07-20T13:26:09Z", "author": {"login": "kachulis"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -83,11 +101,25 @@\n     protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n+        final boolean concatenate_ids = (VARIANT_ID_METHOD == VARIANT_ID_TYPES.CONCAT_ALL); // TODO: move to doWork() section\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd108292a7c3d4c06d068fb2d1285dc1ee94c37f"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NDAyMzUyOnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMzozMTozMVrOG0Mlug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMzozMTozMVrOG0Mlug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM4NTQwMg==", "bodyText": "unnecessary semicolon", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r457385402", "createdAt": "2020-07-20T13:31:31Z", "author": {"login": "kachulis"}, "path": "src/main/java/picard/vcf/VcfToIntervalList.java", "diffHunk": "@@ -83,11 +101,25 @@\n     protected int doWork() {\n         IOUtil.assertFileIsReadable(INPUT);\n         IOUtil.assertFileIsWritable(OUTPUT);\n+        final boolean concatenate_ids = (VARIANT_ID_METHOD == VARIANT_ID_TYPES.CONCAT_ALL); // TODO: move to doWork() section\n \n-        final IntervalList intervalList = VCFFileReader.fromVcf(INPUT, INCLUDE_FILTERED);\n+        try (VCFFileReader vcfReader = new VCFFileReader(INPUT.toPath(), false)) {\n+            final Iterator<Interval> samFileIterator = VCFFileReader.toIntervals(vcfReader, INCLUDE_FILTERED);\n+            try (IntervalListWriter writer = new IntervalListWriter(OUTPUT.toPath(), new SAMFileHeader(vcfReader.getFileHeader().getSequenceDictionary()))) {\n+                final IntervalList.IntervalMergerIterator mergingIterator =\n+                        new IntervalList.IntervalMergerIterator(samFileIterator, true, false, concatenate_ids);\n+                for (final Interval interval : new IterableAdapter<>(mergingIterator)){\n+                    writer.write(interval);\n+                }\n+            } catch (IOException e) {\n+                if(!OUTPUT.renameTo(new File(OUTPUT.getAbsolutePath() + \".incomplete\"))){\n+                    OUTPUT.delete();\n+                };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd108292a7c3d4c06d068fb2d1285dc1ee94c37f"}, "originalPosition": 61}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1NDA3OTUyOnYy", "diffSide": "RIGHT", "path": "src/test/java/picard/util/IntervalListToBedTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxMzo0MDoyMFrOG0NFhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQyMjozMTo1MlrOG0hhzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM5MzU0Mg==", "bodyText": "need to add this file, tests fail currently because doesn't exist in repo", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r457393542", "createdAt": "2020-07-20T13:40:20Z", "author": {"login": "kachulis"}, "path": "src/test/java/picard/util/IntervalListToBedTest.java", "diffHunk": "@@ -13,6 +13,7 @@\n public class IntervalListToBedTest {\n     private static final String TEST_DATA_DIR = \"testdata/picard/util/\";\n     private final File INTERVAL_LIST = new File(TEST_DATA_DIR, \"interval_list_to_bed_test.interval_list\");\n+    private final File UNSORTED_INTERVAL_LIST = new File(TEST_DATA_DIR, \"unsorted_interval_list_to_bed_test.interval_list\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd108292a7c3d4c06d068fb2d1285dc1ee94c37f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcyODQ2MQ==", "bodyText": "\ud83e\udd26\u200d\u2640\ufe0f", "url": "https://github.com/broadinstitute/picard/pull/1456#discussion_r457728461", "createdAt": "2020-07-20T22:31:52Z", "author": {"login": "skwalker"}, "path": "src/test/java/picard/util/IntervalListToBedTest.java", "diffHunk": "@@ -13,6 +13,7 @@\n public class IntervalListToBedTest {\n     private static final String TEST_DATA_DIR = \"testdata/picard/util/\";\n     private final File INTERVAL_LIST = new File(TEST_DATA_DIR, \"interval_list_to_bed_test.interval_list\");\n+    private final File UNSORTED_INTERVAL_LIST = new File(TEST_DATA_DIR, \"unsorted_interval_list_to_bed_test.interval_list\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzM5MzU0Mg=="}, "originalCommit": {"oid": "fd108292a7c3d4c06d068fb2d1285dc1ee94c37f"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 691, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}