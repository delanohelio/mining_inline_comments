{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzOTE2MzMy", "number": 1517, "reviewThreads": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOToxNjo0MFrOEAPdWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDozMToyNVrOEB6Pnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4Njg4NzMxOnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/BpmToNormalizationManifestCsv.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOToxNjo0MVrOGbZouA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOToxNjo0MVrOGbZouA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM4NDc2MA==", "bodyText": "final\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    InfiniumEGTFile infiniumEGTFile;\n          \n          \n            \n                    final InfiniumEGTFile infiniumEGTFile;", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431384760", "createdAt": "2020-05-27T19:16:41Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/BpmToNormalizationManifestCsv.java", "diffHunk": "@@ -0,0 +1,101 @@\n+package picard.arrays.illumina;\n+\n+import htsjdk.samtools.util.IOUtil;\n+import org.broadinstitute.barclay.argparser.Argument;\n+import org.broadinstitute.barclay.argparser.CommandLineProgramProperties;\n+import org.broadinstitute.barclay.help.DocumentedFeature;\n+import picard.PicardException;\n+import picard.cmdline.CommandLineProgram;\n+import picard.cmdline.StandardOptionDefinitions;\n+\n+import java.io.BufferedWriter;\n+import java.io.DataInputStream;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.OutputStreamWriter;\n+import java.nio.charset.StandardCharsets;\n+import java.text.DecimalFormat;\n+import java.util.StringJoiner;\n+\n+/**\n+ * A simple program to convert an Illumina bpm (bead pool manifest file) into a normalization manifest (bpm.csv) file\n+ * The normalization manifest (bpm.csv) is a simple text file generated by Illumina tools - it has a specific format\n+ * and is used by ZCall .\n+ */\n+@CommandLineProgramProperties(\n+        summary = BpmToNormalizationManifestCsv.USAGE_DETAILS,\n+        oneLineSummary = \"Program to convert an Illumina bpm file into a bpm.csv file.\",\n+        programGroup = picard.cmdline.programgroups.GenotypingArraysProgramGroup.class\n+)\n+@DocumentedFeature\n+public class BpmToNormalizationManifestCsv extends CommandLineProgram {\n+    static final String USAGE_DETAILS =\n+            \"BpmToNormalizationManifestCsv takes an Illumina BPM (Bead Pool Manifest) file and generates an Illumina-formatted bpm.csv file from it. \" +\n+                    \"A bpm.csv is a file that was generated by an old version of Illumina's Autocall software. \" +\n+                    \"Since it contained normalization IDs (needed to calculate normalized intensities), it came into use in several programs \" +\n+                    \"notably zCall (https://github.com/jigold/zCall).\" +\n+                    \"<h4>Usage example:</h4>\" +\n+                    \"<pre>\" +\n+                    \"java -jar picard.jar BpmToNormalizationManifestCsv \\\\<br />\" +\n+                    \"      INPUT=input.bpm \\\\<br />\" +\n+                    \"      CLUSTER_FILE=input.egt \\\\<br />\" +\n+                    \"      OUTPUT=output.bpm.csv\" +\n+                    \"</pre>\";\n+\n+    @Argument(shortName = StandardOptionDefinitions.INPUT_SHORT_NAME, doc = \"The Illumina Bead Pool Manifest (.bpm) file\")\n+    public File INPUT;\n+\n+    @Argument(shortName = \"CF\", doc = \"An Illumina cluster file (egt)\")\n+    public File CLUSTER_FILE;\n+\n+    @Argument(shortName = StandardOptionDefinitions.OUTPUT_SHORT_NAME, doc = \"The output (bpm.csv) file to write.\")\n+    public File OUTPUT;\n+\n+    @Override\n+    protected int doWork() {\n+        IOUtil.assertFileIsReadable(INPUT);\n+        IOUtil.assertFileIsReadable(CLUSTER_FILE);\n+        IOUtil.assertFileIsWritable(OUTPUT);\n+\n+        InfiniumEGTFile infiniumEGTFile;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4Njg5MDQ2OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/BpmToNormalizationManifestCsv.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOToxNzoxNVrOGbZqiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMDo0Mzo0NlrOGbcaRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM4NTIyNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    IlluminaBPMFile bpmFile;\n          \n          \n            \n                    final IlluminaBPMFile bpmFile;", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431385227", "createdAt": "2020-05-27T19:17:15Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/BpmToNormalizationManifestCsv.java", "diffHunk": "@@ -0,0 +1,101 @@\n+package picard.arrays.illumina;\n+\n+import htsjdk.samtools.util.IOUtil;\n+import org.broadinstitute.barclay.argparser.Argument;\n+import org.broadinstitute.barclay.argparser.CommandLineProgramProperties;\n+import org.broadinstitute.barclay.help.DocumentedFeature;\n+import picard.PicardException;\n+import picard.cmdline.CommandLineProgram;\n+import picard.cmdline.StandardOptionDefinitions;\n+\n+import java.io.BufferedWriter;\n+import java.io.DataInputStream;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.OutputStreamWriter;\n+import java.nio.charset.StandardCharsets;\n+import java.text.DecimalFormat;\n+import java.util.StringJoiner;\n+\n+/**\n+ * A simple program to convert an Illumina bpm (bead pool manifest file) into a normalization manifest (bpm.csv) file\n+ * The normalization manifest (bpm.csv) is a simple text file generated by Illumina tools - it has a specific format\n+ * and is used by ZCall .\n+ */\n+@CommandLineProgramProperties(\n+        summary = BpmToNormalizationManifestCsv.USAGE_DETAILS,\n+        oneLineSummary = \"Program to convert an Illumina bpm file into a bpm.csv file.\",\n+        programGroup = picard.cmdline.programgroups.GenotypingArraysProgramGroup.class\n+)\n+@DocumentedFeature\n+public class BpmToNormalizationManifestCsv extends CommandLineProgram {\n+    static final String USAGE_DETAILS =\n+            \"BpmToNormalizationManifestCsv takes an Illumina BPM (Bead Pool Manifest) file and generates an Illumina-formatted bpm.csv file from it. \" +\n+                    \"A bpm.csv is a file that was generated by an old version of Illumina's Autocall software. \" +\n+                    \"Since it contained normalization IDs (needed to calculate normalized intensities), it came into use in several programs \" +\n+                    \"notably zCall (https://github.com/jigold/zCall).\" +\n+                    \"<h4>Usage example:</h4>\" +\n+                    \"<pre>\" +\n+                    \"java -jar picard.jar BpmToNormalizationManifestCsv \\\\<br />\" +\n+                    \"      INPUT=input.bpm \\\\<br />\" +\n+                    \"      CLUSTER_FILE=input.egt \\\\<br />\" +\n+                    \"      OUTPUT=output.bpm.csv\" +\n+                    \"</pre>\";\n+\n+    @Argument(shortName = StandardOptionDefinitions.INPUT_SHORT_NAME, doc = \"The Illumina Bead Pool Manifest (.bpm) file\")\n+    public File INPUT;\n+\n+    @Argument(shortName = \"CF\", doc = \"An Illumina cluster file (egt)\")\n+    public File CLUSTER_FILE;\n+\n+    @Argument(shortName = StandardOptionDefinitions.OUTPUT_SHORT_NAME, doc = \"The output (bpm.csv) file to write.\")\n+    public File OUTPUT;\n+\n+    @Override\n+    protected int doWork() {\n+        IOUtil.assertFileIsReadable(INPUT);\n+        IOUtil.assertFileIsReadable(CLUSTER_FILE);\n+        IOUtil.assertFileIsWritable(OUTPUT);\n+\n+        InfiniumEGTFile infiniumEGTFile;\n+        try {\n+            infiniumEGTFile = new InfiniumEGTFile(CLUSTER_FILE);\n+        } catch (IOException e) {\n+            throw new PicardException(\"Error reading cluster file '\" + CLUSTER_FILE.getAbsolutePath() + \"'\", e);\n+        }\n+\n+        IlluminaBPMFile bpmFile;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzMDIxMg==", "bodyText": "done", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431430212", "createdAt": "2020-05-27T20:43:46Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/BpmToNormalizationManifestCsv.java", "diffHunk": "@@ -0,0 +1,101 @@\n+package picard.arrays.illumina;\n+\n+import htsjdk.samtools.util.IOUtil;\n+import org.broadinstitute.barclay.argparser.Argument;\n+import org.broadinstitute.barclay.argparser.CommandLineProgramProperties;\n+import org.broadinstitute.barclay.help.DocumentedFeature;\n+import picard.PicardException;\n+import picard.cmdline.CommandLineProgram;\n+import picard.cmdline.StandardOptionDefinitions;\n+\n+import java.io.BufferedWriter;\n+import java.io.DataInputStream;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.OutputStreamWriter;\n+import java.nio.charset.StandardCharsets;\n+import java.text.DecimalFormat;\n+import java.util.StringJoiner;\n+\n+/**\n+ * A simple program to convert an Illumina bpm (bead pool manifest file) into a normalization manifest (bpm.csv) file\n+ * The normalization manifest (bpm.csv) is a simple text file generated by Illumina tools - it has a specific format\n+ * and is used by ZCall .\n+ */\n+@CommandLineProgramProperties(\n+        summary = BpmToNormalizationManifestCsv.USAGE_DETAILS,\n+        oneLineSummary = \"Program to convert an Illumina bpm file into a bpm.csv file.\",\n+        programGroup = picard.cmdline.programgroups.GenotypingArraysProgramGroup.class\n+)\n+@DocumentedFeature\n+public class BpmToNormalizationManifestCsv extends CommandLineProgram {\n+    static final String USAGE_DETAILS =\n+            \"BpmToNormalizationManifestCsv takes an Illumina BPM (Bead Pool Manifest) file and generates an Illumina-formatted bpm.csv file from it. \" +\n+                    \"A bpm.csv is a file that was generated by an old version of Illumina's Autocall software. \" +\n+                    \"Since it contained normalization IDs (needed to calculate normalized intensities), it came into use in several programs \" +\n+                    \"notably zCall (https://github.com/jigold/zCall).\" +\n+                    \"<h4>Usage example:</h4>\" +\n+                    \"<pre>\" +\n+                    \"java -jar picard.jar BpmToNormalizationManifestCsv \\\\<br />\" +\n+                    \"      INPUT=input.bpm \\\\<br />\" +\n+                    \"      CLUSTER_FILE=input.egt \\\\<br />\" +\n+                    \"      OUTPUT=output.bpm.csv\" +\n+                    \"</pre>\";\n+\n+    @Argument(shortName = StandardOptionDefinitions.INPUT_SHORT_NAME, doc = \"The Illumina Bead Pool Manifest (.bpm) file\")\n+    public File INPUT;\n+\n+    @Argument(shortName = \"CF\", doc = \"An Illumina cluster file (egt)\")\n+    public File CLUSTER_FILE;\n+\n+    @Argument(shortName = StandardOptionDefinitions.OUTPUT_SHORT_NAME, doc = \"The output (bpm.csv) file to write.\")\n+    public File OUTPUT;\n+\n+    @Override\n+    protected int doWork() {\n+        IOUtil.assertFileIsReadable(INPUT);\n+        IOUtil.assertFileIsReadable(CLUSTER_FILE);\n+        IOUtil.assertFileIsWritable(OUTPUT);\n+\n+        InfiniumEGTFile infiniumEGTFile;\n+        try {\n+            infiniumEGTFile = new InfiniumEGTFile(CLUSTER_FILE);\n+        } catch (IOException e) {\n+            throw new PicardException(\"Error reading cluster file '\" + CLUSTER_FILE.getAbsolutePath() + \"'\", e);\n+        }\n+\n+        IlluminaBPMFile bpmFile;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM4NTIyNw=="}, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4Njg5Njk3OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/BpmToNormalizationManifestCsv.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOToxODowNVrOGbZuSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOToxODowNVrOGbZuSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM4NjE4Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    DecimalFormat df = new DecimalFormat((\"0.0000\"));\n          \n          \n            \n                    final DecimalFormat df = new DecimalFormat((\"0.0000\"));", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431386186", "createdAt": "2020-05-27T19:18:05Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/BpmToNormalizationManifestCsv.java", "diffHunk": "@@ -0,0 +1,101 @@\n+package picard.arrays.illumina;\n+\n+import htsjdk.samtools.util.IOUtil;\n+import org.broadinstitute.barclay.argparser.Argument;\n+import org.broadinstitute.barclay.argparser.CommandLineProgramProperties;\n+import org.broadinstitute.barclay.help.DocumentedFeature;\n+import picard.PicardException;\n+import picard.cmdline.CommandLineProgram;\n+import picard.cmdline.StandardOptionDefinitions;\n+\n+import java.io.BufferedWriter;\n+import java.io.DataInputStream;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.OutputStreamWriter;\n+import java.nio.charset.StandardCharsets;\n+import java.text.DecimalFormat;\n+import java.util.StringJoiner;\n+\n+/**\n+ * A simple program to convert an Illumina bpm (bead pool manifest file) into a normalization manifest (bpm.csv) file\n+ * The normalization manifest (bpm.csv) is a simple text file generated by Illumina tools - it has a specific format\n+ * and is used by ZCall .\n+ */\n+@CommandLineProgramProperties(\n+        summary = BpmToNormalizationManifestCsv.USAGE_DETAILS,\n+        oneLineSummary = \"Program to convert an Illumina bpm file into a bpm.csv file.\",\n+        programGroup = picard.cmdline.programgroups.GenotypingArraysProgramGroup.class\n+)\n+@DocumentedFeature\n+public class BpmToNormalizationManifestCsv extends CommandLineProgram {\n+    static final String USAGE_DETAILS =\n+            \"BpmToNormalizationManifestCsv takes an Illumina BPM (Bead Pool Manifest) file and generates an Illumina-formatted bpm.csv file from it. \" +\n+                    \"A bpm.csv is a file that was generated by an old version of Illumina's Autocall software. \" +\n+                    \"Since it contained normalization IDs (needed to calculate normalized intensities), it came into use in several programs \" +\n+                    \"notably zCall (https://github.com/jigold/zCall).\" +\n+                    \"<h4>Usage example:</h4>\" +\n+                    \"<pre>\" +\n+                    \"java -jar picard.jar BpmToNormalizationManifestCsv \\\\<br />\" +\n+                    \"      INPUT=input.bpm \\\\<br />\" +\n+                    \"      CLUSTER_FILE=input.egt \\\\<br />\" +\n+                    \"      OUTPUT=output.bpm.csv\" +\n+                    \"</pre>\";\n+\n+    @Argument(shortName = StandardOptionDefinitions.INPUT_SHORT_NAME, doc = \"The Illumina Bead Pool Manifest (.bpm) file\")\n+    public File INPUT;\n+\n+    @Argument(shortName = \"CF\", doc = \"An Illumina cluster file (egt)\")\n+    public File CLUSTER_FILE;\n+\n+    @Argument(shortName = StandardOptionDefinitions.OUTPUT_SHORT_NAME, doc = \"The output (bpm.csv) file to write.\")\n+    public File OUTPUT;\n+\n+    @Override\n+    protected int doWork() {\n+        IOUtil.assertFileIsReadable(INPUT);\n+        IOUtil.assertFileIsReadable(CLUSTER_FILE);\n+        IOUtil.assertFileIsWritable(OUTPUT);\n+\n+        InfiniumEGTFile infiniumEGTFile;\n+        try {\n+            infiniumEGTFile = new InfiniumEGTFile(CLUSTER_FILE);\n+        } catch (IOException e) {\n+            throw new PicardException(\"Error reading cluster file '\" + CLUSTER_FILE.getAbsolutePath() + \"'\", e);\n+        }\n+\n+        IlluminaBPMFile bpmFile;\n+        try (final DataInputStream inputStream = new DataInputStream(new FileInputStream(INPUT))) {\n+            bpmFile = new IlluminaBPMFile(inputStream);\n+        } catch (IOException e) {\n+            throw new PicardException(\"Error reading bpm file '\" + INPUT.getAbsolutePath() + \"'\", e);\n+        }\n+\n+        DecimalFormat df = new DecimalFormat((\"0.0000\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NjkyMzI5OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOToyNTowMVrOGbZ-vA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNToxMjoxOFrOGdOKaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5MDM5Ng==", "bodyText": "Is this necessary?", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431390396", "createdAt": "2020-05-27T19:25:01Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "diffHunk": "@@ -0,0 +1,181 @@\n+package picard.arrays.illumina;\n+\n+import picard.PicardException;\n+\n+import java.io.DataInputStream;\n+import java.io.IOException;\n+import java.util.Set;\n+import java.util.TreeSet;\n+\n+/**\n+ * A class to parse the contents of an Illumina Bead Pool Manifest (BPM) file\n+ *\n+ * A BPM file contains metadata (including the alleles, mapping and normalization information) on an Illumina Genotyping Array\n+ * Each type of genotyping array has a specific BPM .\n+ *\n+ */\n+public class IlluminaBPMFile extends InfiniumDataFile {\n+    private static final String BPM_IDENTIFIER = \"BPM\";\n+\n+    private String manifestName = null;\n+    private String controlConfig = null;\n+    private int numLoci = 0;\n+    private IlluminaBPMLocusEntry[] locusEntries = null;\n+\n+    private int[] allNormalizationIds = null;\n+    private Integer[] uniqueNormalizationIds = null;\n+\n+    public IlluminaBPMFile(DataInputStream stream) throws IOException {\n+        super(stream, true);\n+        parse();\n+    }\n+\n+    /**\n+     * Main parsing method.\n+     *\n+     * @throws IOException thrown when there is a problem reading the Bead Pool Manifest\n+     */\n+    private void parse() throws IOException {\n+\n+        stream.mark(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5MzkzMQ==", "bodyText": "Nope - getting rid of it.", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r433293931", "createdAt": "2020-06-01T15:12:18Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "diffHunk": "@@ -0,0 +1,181 @@\n+package picard.arrays.illumina;\n+\n+import picard.PicardException;\n+\n+import java.io.DataInputStream;\n+import java.io.IOException;\n+import java.util.Set;\n+import java.util.TreeSet;\n+\n+/**\n+ * A class to parse the contents of an Illumina Bead Pool Manifest (BPM) file\n+ *\n+ * A BPM file contains metadata (including the alleles, mapping and normalization information) on an Illumina Genotyping Array\n+ * Each type of genotyping array has a specific BPM .\n+ *\n+ */\n+public class IlluminaBPMFile extends InfiniumDataFile {\n+    private static final String BPM_IDENTIFIER = \"BPM\";\n+\n+    private String manifestName = null;\n+    private String controlConfig = null;\n+    private int numLoci = 0;\n+    private IlluminaBPMLocusEntry[] locusEntries = null;\n+\n+    private int[] allNormalizationIds = null;\n+    private Integer[] uniqueNormalizationIds = null;\n+\n+    public IlluminaBPMFile(DataInputStream stream) throws IOException {\n+        super(stream, true);\n+        parse();\n+    }\n+\n+    /**\n+     * Main parsing method.\n+     *\n+     * @throws IOException thrown when there is a problem reading the Bead Pool Manifest\n+     */\n+    private void parse() throws IOException {\n+\n+        stream.mark(0);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5MDM5Ng=="}, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NjkyODA4OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOToyNjozNFrOGbaB2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNToxMjo1N1rOGdOL5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5MTE5Mw==", "bodyText": "true", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431391193", "createdAt": "2020-05-27T19:26:34Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "diffHunk": "@@ -0,0 +1,181 @@\n+package picard.arrays.illumina;\n+\n+import picard.PicardException;\n+\n+import java.io.DataInputStream;\n+import java.io.IOException;\n+import java.util.Set;\n+import java.util.TreeSet;\n+\n+/**\n+ * A class to parse the contents of an Illumina Bead Pool Manifest (BPM) file\n+ *\n+ * A BPM file contains metadata (including the alleles, mapping and normalization information) on an Illumina Genotyping Array\n+ * Each type of genotyping array has a specific BPM .\n+ *\n+ */\n+public class IlluminaBPMFile extends InfiniumDataFile {\n+    private static final String BPM_IDENTIFIER = \"BPM\";\n+\n+    private String manifestName = null;\n+    private String controlConfig = null;\n+    private int numLoci = 0;\n+    private IlluminaBPMLocusEntry[] locusEntries = null;\n+\n+    private int[] allNormalizationIds = null;\n+    private Integer[] uniqueNormalizationIds = null;\n+\n+    public IlluminaBPMFile(DataInputStream stream) throws IOException {\n+        super(stream, true);\n+        parse();\n+    }\n+\n+    /**\n+     * Main parsing method.\n+     *\n+     * @throws IOException thrown when there is a problem reading the Bead Pool Manifest\n+     */\n+    private void parse() throws IOException {\n+\n+        stream.mark(0);\n+\n+        try {\n+            final byte[] formatIdentifier = new byte[BPM_IDENTIFIER.length()];\n+            for (int i = 0; i < formatIdentifier.length; i++) {\n+                formatIdentifier[i] = parseByte();\n+            }\n+\n+            final String identifier = new String(formatIdentifier);\n+            setIdentifier(identifier);\n+            if (!identifier.equals(BPM_IDENTIFIER)) {\n+                throw new PicardException(\"Invalid identifier '\" + identifier + \"' for BPM file\");\n+            }\n+            setFileVersion(parseByte());\n+            if (getFileVersion() != 1) {\n+                throw new PicardException(\"Unknown BPM version (\" + getFileVersion() + \")\");\n+            }\n+            int version = parseInt();\n+            final int versionFlag = 0x1000;\n+            if ((version & versionFlag) == versionFlag) {\n+                version ^= versionFlag;\n+            }\n+            if (version > 5 || version < 3) {\n+                throw new PicardException(\"Unsupported BPM version (\" + version + \")\");\n+            }\n+            manifestName = parseString();\n+            if (version > 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzMTUwOQ==", "bodyText": "Thanks.", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431431509", "createdAt": "2020-05-27T20:46:15Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "diffHunk": "@@ -0,0 +1,181 @@\n+package picard.arrays.illumina;\n+\n+import picard.PicardException;\n+\n+import java.io.DataInputStream;\n+import java.io.IOException;\n+import java.util.Set;\n+import java.util.TreeSet;\n+\n+/**\n+ * A class to parse the contents of an Illumina Bead Pool Manifest (BPM) file\n+ *\n+ * A BPM file contains metadata (including the alleles, mapping and normalization information) on an Illumina Genotyping Array\n+ * Each type of genotyping array has a specific BPM .\n+ *\n+ */\n+public class IlluminaBPMFile extends InfiniumDataFile {\n+    private static final String BPM_IDENTIFIER = \"BPM\";\n+\n+    private String manifestName = null;\n+    private String controlConfig = null;\n+    private int numLoci = 0;\n+    private IlluminaBPMLocusEntry[] locusEntries = null;\n+\n+    private int[] allNormalizationIds = null;\n+    private Integer[] uniqueNormalizationIds = null;\n+\n+    public IlluminaBPMFile(DataInputStream stream) throws IOException {\n+        super(stream, true);\n+        parse();\n+    }\n+\n+    /**\n+     * Main parsing method.\n+     *\n+     * @throws IOException thrown when there is a problem reading the Bead Pool Manifest\n+     */\n+    private void parse() throws IOException {\n+\n+        stream.mark(0);\n+\n+        try {\n+            final byte[] formatIdentifier = new byte[BPM_IDENTIFIER.length()];\n+            for (int i = 0; i < formatIdentifier.length; i++) {\n+                formatIdentifier[i] = parseByte();\n+            }\n+\n+            final String identifier = new String(formatIdentifier);\n+            setIdentifier(identifier);\n+            if (!identifier.equals(BPM_IDENTIFIER)) {\n+                throw new PicardException(\"Invalid identifier '\" + identifier + \"' for BPM file\");\n+            }\n+            setFileVersion(parseByte());\n+            if (getFileVersion() != 1) {\n+                throw new PicardException(\"Unknown BPM version (\" + getFileVersion() + \")\");\n+            }\n+            int version = parseInt();\n+            final int versionFlag = 0x1000;\n+            if ((version & versionFlag) == versionFlag) {\n+                version ^= versionFlag;\n+            }\n+            if (version > 5 || version < 3) {\n+                throw new PicardException(\"Unsupported BPM version (\" + version + \")\");\n+            }\n+            manifestName = parseString();\n+            if (version > 1) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5MTE5Mw=="}, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5NDMwOA==", "bodyText": "Done", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r433294308", "createdAt": "2020-06-01T15:12:57Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "diffHunk": "@@ -0,0 +1,181 @@\n+package picard.arrays.illumina;\n+\n+import picard.PicardException;\n+\n+import java.io.DataInputStream;\n+import java.io.IOException;\n+import java.util.Set;\n+import java.util.TreeSet;\n+\n+/**\n+ * A class to parse the contents of an Illumina Bead Pool Manifest (BPM) file\n+ *\n+ * A BPM file contains metadata (including the alleles, mapping and normalization information) on an Illumina Genotyping Array\n+ * Each type of genotyping array has a specific BPM .\n+ *\n+ */\n+public class IlluminaBPMFile extends InfiniumDataFile {\n+    private static final String BPM_IDENTIFIER = \"BPM\";\n+\n+    private String manifestName = null;\n+    private String controlConfig = null;\n+    private int numLoci = 0;\n+    private IlluminaBPMLocusEntry[] locusEntries = null;\n+\n+    private int[] allNormalizationIds = null;\n+    private Integer[] uniqueNormalizationIds = null;\n+\n+    public IlluminaBPMFile(DataInputStream stream) throws IOException {\n+        super(stream, true);\n+        parse();\n+    }\n+\n+    /**\n+     * Main parsing method.\n+     *\n+     * @throws IOException thrown when there is a problem reading the Bead Pool Manifest\n+     */\n+    private void parse() throws IOException {\n+\n+        stream.mark(0);\n+\n+        try {\n+            final byte[] formatIdentifier = new byte[BPM_IDENTIFIER.length()];\n+            for (int i = 0; i < formatIdentifier.length; i++) {\n+                formatIdentifier[i] = parseByte();\n+            }\n+\n+            final String identifier = new String(formatIdentifier);\n+            setIdentifier(identifier);\n+            if (!identifier.equals(BPM_IDENTIFIER)) {\n+                throw new PicardException(\"Invalid identifier '\" + identifier + \"' for BPM file\");\n+            }\n+            setFileVersion(parseByte());\n+            if (getFileVersion() != 1) {\n+                throw new PicardException(\"Unknown BPM version (\" + getFileVersion() + \")\");\n+            }\n+            int version = parseInt();\n+            final int versionFlag = 0x1000;\n+            if ((version & versionFlag) == versionFlag) {\n+                version ^= versionFlag;\n+            }\n+            if (version > 5 || version < 3) {\n+                throw new PicardException(\"Unsupported BPM version (\" + version + \")\");\n+            }\n+            manifestName = parseString();\n+            if (version > 1) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5MTE5Mw=="}, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 66}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4Njk0MDc2OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOTozMDoxOVrOGbaJ_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOTozMDoxOVrOGbaJ_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5MzI3Ng==", "bodyText": "Could probably use a hashset here\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Set<Integer> uniqueNormalizationIdsSet = new TreeSet<>();\n          \n          \n            \n                    final Set<Integer> uniqueNormalizationIdsSet = new HashSet<>();", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431393276", "createdAt": "2020-05-27T19:30:19Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "diffHunk": "@@ -0,0 +1,181 @@\n+package picard.arrays.illumina;\n+\n+import picard.PicardException;\n+\n+import java.io.DataInputStream;\n+import java.io.IOException;\n+import java.util.Set;\n+import java.util.TreeSet;\n+\n+/**\n+ * A class to parse the contents of an Illumina Bead Pool Manifest (BPM) file\n+ *\n+ * A BPM file contains metadata (including the alleles, mapping and normalization information) on an Illumina Genotyping Array\n+ * Each type of genotyping array has a specific BPM .\n+ *\n+ */\n+public class IlluminaBPMFile extends InfiniumDataFile {\n+    private static final String BPM_IDENTIFIER = \"BPM\";\n+\n+    private String manifestName = null;\n+    private String controlConfig = null;\n+    private int numLoci = 0;\n+    private IlluminaBPMLocusEntry[] locusEntries = null;\n+\n+    private int[] allNormalizationIds = null;\n+    private Integer[] uniqueNormalizationIds = null;\n+\n+    public IlluminaBPMFile(DataInputStream stream) throws IOException {\n+        super(stream, true);\n+        parse();\n+    }\n+\n+    /**\n+     * Main parsing method.\n+     *\n+     * @throws IOException thrown when there is a problem reading the Bead Pool Manifest\n+     */\n+    private void parse() throws IOException {\n+\n+        stream.mark(0);\n+\n+        try {\n+            final byte[] formatIdentifier = new byte[BPM_IDENTIFIER.length()];\n+            for (int i = 0; i < formatIdentifier.length; i++) {\n+                formatIdentifier[i] = parseByte();\n+            }\n+\n+            final String identifier = new String(formatIdentifier);\n+            setIdentifier(identifier);\n+            if (!identifier.equals(BPM_IDENTIFIER)) {\n+                throw new PicardException(\"Invalid identifier '\" + identifier + \"' for BPM file\");\n+            }\n+            setFileVersion(parseByte());\n+            if (getFileVersion() != 1) {\n+                throw new PicardException(\"Unknown BPM version (\" + getFileVersion() + \")\");\n+            }\n+            int version = parseInt();\n+            final int versionFlag = 0x1000;\n+            if ((version & versionFlag) == versionFlag) {\n+                version ^= versionFlag;\n+            }\n+            if (version > 5 || version < 3) {\n+                throw new PicardException(\"Unsupported BPM version (\" + version + \")\");\n+            }\n+            manifestName = parseString();\n+            if (version > 1) {\n+                controlConfig = parseString();\n+            }\n+            numLoci = parseInt();\n+\n+            readData();\n+        } finally {\n+            stream.close();\n+        }\n+    }\n+\n+    private void readData() throws IOException {\n+        // Skip the index block\n+        stream.skipBytes(4 * numLoci);\n+\n+        // Read the names\n+        String[] names = new String[numLoci];\n+        for (int i = 0; i < numLoci; i++) {\n+            names[i] = parseString();\n+        }\n+\n+        // Read the normalization ids.\n+        allNormalizationIds = parseByteArrayAsInts(numLoci);\n+        Set<Integer> uniqueNormalizationIdsSet = new TreeSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4Njk0Njc0OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOTozMTo1OVrOGbaNlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNToxMzoxOVrOGdOMvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5NDE5Ng==", "bodyText": "may not need to initialize as null", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431394196", "createdAt": "2020-05-27T19:31:59Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "diffHunk": "@@ -0,0 +1,181 @@\n+package picard.arrays.illumina;\n+\n+import picard.PicardException;\n+\n+import java.io.DataInputStream;\n+import java.io.IOException;\n+import java.util.Set;\n+import java.util.TreeSet;\n+\n+/**\n+ * A class to parse the contents of an Illumina Bead Pool Manifest (BPM) file\n+ *\n+ * A BPM file contains metadata (including the alleles, mapping and normalization information) on an Illumina Genotyping Array\n+ * Each type of genotyping array has a specific BPM .\n+ *\n+ */\n+public class IlluminaBPMFile extends InfiniumDataFile {\n+    private static final String BPM_IDENTIFIER = \"BPM\";\n+\n+    private String manifestName = null;\n+    private String controlConfig = null;\n+    private int numLoci = 0;\n+    private IlluminaBPMLocusEntry[] locusEntries = null;\n+\n+    private int[] allNormalizationIds = null;\n+    private Integer[] uniqueNormalizationIds = null;\n+\n+    public IlluminaBPMFile(DataInputStream stream) throws IOException {\n+        super(stream, true);\n+        parse();\n+    }\n+\n+    /**\n+     * Main parsing method.\n+     *\n+     * @throws IOException thrown when there is a problem reading the Bead Pool Manifest\n+     */\n+    private void parse() throws IOException {\n+\n+        stream.mark(0);\n+\n+        try {\n+            final byte[] formatIdentifier = new byte[BPM_IDENTIFIER.length()];\n+            for (int i = 0; i < formatIdentifier.length; i++) {\n+                formatIdentifier[i] = parseByte();\n+            }\n+\n+            final String identifier = new String(formatIdentifier);\n+            setIdentifier(identifier);\n+            if (!identifier.equals(BPM_IDENTIFIER)) {\n+                throw new PicardException(\"Invalid identifier '\" + identifier + \"' for BPM file\");\n+            }\n+            setFileVersion(parseByte());\n+            if (getFileVersion() != 1) {\n+                throw new PicardException(\"Unknown BPM version (\" + getFileVersion() + \")\");\n+            }\n+            int version = parseInt();\n+            final int versionFlag = 0x1000;\n+            if ((version & versionFlag) == versionFlag) {\n+                version ^= versionFlag;\n+            }\n+            if (version > 5 || version < 3) {\n+                throw new PicardException(\"Unsupported BPM version (\" + version + \")\");\n+            }\n+            manifestName = parseString();\n+            if (version > 1) {\n+                controlConfig = parseString();\n+            }\n+            numLoci = parseInt();\n+\n+            readData();\n+        } finally {\n+            stream.close();\n+        }\n+    }\n+\n+    private void readData() throws IOException {\n+        // Skip the index block\n+        stream.skipBytes(4 * numLoci);\n+\n+        // Read the names\n+        String[] names = new String[numLoci];\n+        for (int i = 0; i < numLoci; i++) {\n+            names[i] = parseString();\n+        }\n+\n+        // Read the normalization ids.\n+        allNormalizationIds = parseByteArrayAsInts(numLoci);\n+        Set<Integer> uniqueNormalizationIdsSet = new TreeSet<>();\n+\n+        // Initialize the locus entries\n+        locusEntries = new IlluminaBPMLocusEntry[numLoci];\n+        for (int i = 0; i < numLoci; i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzMjU4NQ==", "bodyText": "that is true.", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431432585", "createdAt": "2020-05-27T20:48:14Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "diffHunk": "@@ -0,0 +1,181 @@\n+package picard.arrays.illumina;\n+\n+import picard.PicardException;\n+\n+import java.io.DataInputStream;\n+import java.io.IOException;\n+import java.util.Set;\n+import java.util.TreeSet;\n+\n+/**\n+ * A class to parse the contents of an Illumina Bead Pool Manifest (BPM) file\n+ *\n+ * A BPM file contains metadata (including the alleles, mapping and normalization information) on an Illumina Genotyping Array\n+ * Each type of genotyping array has a specific BPM .\n+ *\n+ */\n+public class IlluminaBPMFile extends InfiniumDataFile {\n+    private static final String BPM_IDENTIFIER = \"BPM\";\n+\n+    private String manifestName = null;\n+    private String controlConfig = null;\n+    private int numLoci = 0;\n+    private IlluminaBPMLocusEntry[] locusEntries = null;\n+\n+    private int[] allNormalizationIds = null;\n+    private Integer[] uniqueNormalizationIds = null;\n+\n+    public IlluminaBPMFile(DataInputStream stream) throws IOException {\n+        super(stream, true);\n+        parse();\n+    }\n+\n+    /**\n+     * Main parsing method.\n+     *\n+     * @throws IOException thrown when there is a problem reading the Bead Pool Manifest\n+     */\n+    private void parse() throws IOException {\n+\n+        stream.mark(0);\n+\n+        try {\n+            final byte[] formatIdentifier = new byte[BPM_IDENTIFIER.length()];\n+            for (int i = 0; i < formatIdentifier.length; i++) {\n+                formatIdentifier[i] = parseByte();\n+            }\n+\n+            final String identifier = new String(formatIdentifier);\n+            setIdentifier(identifier);\n+            if (!identifier.equals(BPM_IDENTIFIER)) {\n+                throw new PicardException(\"Invalid identifier '\" + identifier + \"' for BPM file\");\n+            }\n+            setFileVersion(parseByte());\n+            if (getFileVersion() != 1) {\n+                throw new PicardException(\"Unknown BPM version (\" + getFileVersion() + \")\");\n+            }\n+            int version = parseInt();\n+            final int versionFlag = 0x1000;\n+            if ((version & versionFlag) == versionFlag) {\n+                version ^= versionFlag;\n+            }\n+            if (version > 5 || version < 3) {\n+                throw new PicardException(\"Unsupported BPM version (\" + version + \")\");\n+            }\n+            manifestName = parseString();\n+            if (version > 1) {\n+                controlConfig = parseString();\n+            }\n+            numLoci = parseInt();\n+\n+            readData();\n+        } finally {\n+            stream.close();\n+        }\n+    }\n+\n+    private void readData() throws IOException {\n+        // Skip the index block\n+        stream.skipBytes(4 * numLoci);\n+\n+        // Read the names\n+        String[] names = new String[numLoci];\n+        for (int i = 0; i < numLoci; i++) {\n+            names[i] = parseString();\n+        }\n+\n+        // Read the normalization ids.\n+        allNormalizationIds = parseByteArrayAsInts(numLoci);\n+        Set<Integer> uniqueNormalizationIdsSet = new TreeSet<>();\n+\n+        // Initialize the locus entries\n+        locusEntries = new IlluminaBPMLocusEntry[numLoci];\n+        for (int i = 0; i < numLoci; i++) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5NDE5Ng=="}, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5NDUyNw==", "bodyText": "Done", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r433294527", "createdAt": "2020-06-01T15:13:19Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "diffHunk": "@@ -0,0 +1,181 @@\n+package picard.arrays.illumina;\n+\n+import picard.PicardException;\n+\n+import java.io.DataInputStream;\n+import java.io.IOException;\n+import java.util.Set;\n+import java.util.TreeSet;\n+\n+/**\n+ * A class to parse the contents of an Illumina Bead Pool Manifest (BPM) file\n+ *\n+ * A BPM file contains metadata (including the alleles, mapping and normalization information) on an Illumina Genotyping Array\n+ * Each type of genotyping array has a specific BPM .\n+ *\n+ */\n+public class IlluminaBPMFile extends InfiniumDataFile {\n+    private static final String BPM_IDENTIFIER = \"BPM\";\n+\n+    private String manifestName = null;\n+    private String controlConfig = null;\n+    private int numLoci = 0;\n+    private IlluminaBPMLocusEntry[] locusEntries = null;\n+\n+    private int[] allNormalizationIds = null;\n+    private Integer[] uniqueNormalizationIds = null;\n+\n+    public IlluminaBPMFile(DataInputStream stream) throws IOException {\n+        super(stream, true);\n+        parse();\n+    }\n+\n+    /**\n+     * Main parsing method.\n+     *\n+     * @throws IOException thrown when there is a problem reading the Bead Pool Manifest\n+     */\n+    private void parse() throws IOException {\n+\n+        stream.mark(0);\n+\n+        try {\n+            final byte[] formatIdentifier = new byte[BPM_IDENTIFIER.length()];\n+            for (int i = 0; i < formatIdentifier.length; i++) {\n+                formatIdentifier[i] = parseByte();\n+            }\n+\n+            final String identifier = new String(formatIdentifier);\n+            setIdentifier(identifier);\n+            if (!identifier.equals(BPM_IDENTIFIER)) {\n+                throw new PicardException(\"Invalid identifier '\" + identifier + \"' for BPM file\");\n+            }\n+            setFileVersion(parseByte());\n+            if (getFileVersion() != 1) {\n+                throw new PicardException(\"Unknown BPM version (\" + getFileVersion() + \")\");\n+            }\n+            int version = parseInt();\n+            final int versionFlag = 0x1000;\n+            if ((version & versionFlag) == versionFlag) {\n+                version ^= versionFlag;\n+            }\n+            if (version > 5 || version < 3) {\n+                throw new PicardException(\"Unsupported BPM version (\" + version + \")\");\n+            }\n+            manifestName = parseString();\n+            if (version > 1) {\n+                controlConfig = parseString();\n+            }\n+            numLoci = parseInt();\n+\n+            readData();\n+        } finally {\n+            stream.close();\n+        }\n+    }\n+\n+    private void readData() throws IOException {\n+        // Skip the index block\n+        stream.skipBytes(4 * numLoci);\n+\n+        // Read the names\n+        String[] names = new String[numLoci];\n+        for (int i = 0; i < numLoci; i++) {\n+            names[i] = parseString();\n+        }\n+\n+        // Read the normalization ids.\n+        allNormalizationIds = parseByteArrayAsInts(numLoci);\n+        Set<Integer> uniqueNormalizationIdsSet = new TreeSet<>();\n+\n+        // Initialize the locus entries\n+        locusEntries = new IlluminaBPMLocusEntry[numLoci];\n+        for (int i = 0; i < numLoci; i++) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5NDE5Ng=="}, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4Njk1MjQ3OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOTozMzo0MVrOGbaRGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNTo0MTo0MlrOGd3rcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5NTA5Nw==", "bodyText": "Consider refactoring into a separate method", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431395097", "createdAt": "2020-05-27T19:33:41Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "diffHunk": "@@ -0,0 +1,181 @@\n+package picard.arrays.illumina;\n+\n+import picard.PicardException;\n+\n+import java.io.DataInputStream;\n+import java.io.IOException;\n+import java.util.Set;\n+import java.util.TreeSet;\n+\n+/**\n+ * A class to parse the contents of an Illumina Bead Pool Manifest (BPM) file\n+ *\n+ * A BPM file contains metadata (including the alleles, mapping and normalization information) on an Illumina Genotyping Array\n+ * Each type of genotyping array has a specific BPM .\n+ *\n+ */\n+public class IlluminaBPMFile extends InfiniumDataFile {\n+    private static final String BPM_IDENTIFIER = \"BPM\";\n+\n+    private String manifestName = null;\n+    private String controlConfig = null;\n+    private int numLoci = 0;\n+    private IlluminaBPMLocusEntry[] locusEntries = null;\n+\n+    private int[] allNormalizationIds = null;\n+    private Integer[] uniqueNormalizationIds = null;\n+\n+    public IlluminaBPMFile(DataInputStream stream) throws IOException {\n+        super(stream, true);\n+        parse();\n+    }\n+\n+    /**\n+     * Main parsing method.\n+     *\n+     * @throws IOException thrown when there is a problem reading the Bead Pool Manifest\n+     */\n+    private void parse() throws IOException {\n+\n+        stream.mark(0);\n+\n+        try {\n+            final byte[] formatIdentifier = new byte[BPM_IDENTIFIER.length()];\n+            for (int i = 0; i < formatIdentifier.length; i++) {\n+                formatIdentifier[i] = parseByte();\n+            }\n+\n+            final String identifier = new String(formatIdentifier);\n+            setIdentifier(identifier);\n+            if (!identifier.equals(BPM_IDENTIFIER)) {\n+                throw new PicardException(\"Invalid identifier '\" + identifier + \"' for BPM file\");\n+            }\n+            setFileVersion(parseByte());\n+            if (getFileVersion() != 1) {\n+                throw new PicardException(\"Unknown BPM version (\" + getFileVersion() + \")\");\n+            }\n+            int version = parseInt();\n+            final int versionFlag = 0x1000;\n+            if ((version & versionFlag) == versionFlag) {\n+                version ^= versionFlag;\n+            }\n+            if (version > 5 || version < 3) {\n+                throw new PicardException(\"Unsupported BPM version (\" + version + \")\");\n+            }\n+            manifestName = parseString();\n+            if (version > 1) {\n+                controlConfig = parseString();\n+            }\n+            numLoci = parseInt();\n+\n+            readData();\n+        } finally {\n+            stream.close();\n+        }\n+    }\n+\n+    private void readData() throws IOException {\n+        // Skip the index block\n+        stream.skipBytes(4 * numLoci);\n+\n+        // Read the names\n+        String[] names = new String[numLoci];\n+        for (int i = 0; i < numLoci; i++) {\n+            names[i] = parseString();\n+        }\n+\n+        // Read the normalization ids.\n+        allNormalizationIds = parseByteArrayAsInts(numLoci);\n+        Set<Integer> uniqueNormalizationIdsSet = new TreeSet<>();\n+\n+        // Initialize the locus entries\n+        locusEntries = new IlluminaBPMLocusEntry[numLoci];\n+        for (int i = 0; i < numLoci; i++) {\n+            locusEntries[i] = null;\n+        }\n+\n+        // Read the locus entries.\n+        for (int i = 0; i < numLoci; i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk3NDEzMQ==", "bodyText": "I've refactored it into a separate method.", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r433974131", "createdAt": "2020-06-02T15:41:42Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMFile.java", "diffHunk": "@@ -0,0 +1,181 @@\n+package picard.arrays.illumina;\n+\n+import picard.PicardException;\n+\n+import java.io.DataInputStream;\n+import java.io.IOException;\n+import java.util.Set;\n+import java.util.TreeSet;\n+\n+/**\n+ * A class to parse the contents of an Illumina Bead Pool Manifest (BPM) file\n+ *\n+ * A BPM file contains metadata (including the alleles, mapping and normalization information) on an Illumina Genotyping Array\n+ * Each type of genotyping array has a specific BPM .\n+ *\n+ */\n+public class IlluminaBPMFile extends InfiniumDataFile {\n+    private static final String BPM_IDENTIFIER = \"BPM\";\n+\n+    private String manifestName = null;\n+    private String controlConfig = null;\n+    private int numLoci = 0;\n+    private IlluminaBPMLocusEntry[] locusEntries = null;\n+\n+    private int[] allNormalizationIds = null;\n+    private Integer[] uniqueNormalizationIds = null;\n+\n+    public IlluminaBPMFile(DataInputStream stream) throws IOException {\n+        super(stream, true);\n+        parse();\n+    }\n+\n+    /**\n+     * Main parsing method.\n+     *\n+     * @throws IOException thrown when there is a problem reading the Bead Pool Manifest\n+     */\n+    private void parse() throws IOException {\n+\n+        stream.mark(0);\n+\n+        try {\n+            final byte[] formatIdentifier = new byte[BPM_IDENTIFIER.length()];\n+            for (int i = 0; i < formatIdentifier.length; i++) {\n+                formatIdentifier[i] = parseByte();\n+            }\n+\n+            final String identifier = new String(formatIdentifier);\n+            setIdentifier(identifier);\n+            if (!identifier.equals(BPM_IDENTIFIER)) {\n+                throw new PicardException(\"Invalid identifier '\" + identifier + \"' for BPM file\");\n+            }\n+            setFileVersion(parseByte());\n+            if (getFileVersion() != 1) {\n+                throw new PicardException(\"Unknown BPM version (\" + getFileVersion() + \")\");\n+            }\n+            int version = parseInt();\n+            final int versionFlag = 0x1000;\n+            if ((version & versionFlag) == versionFlag) {\n+                version ^= versionFlag;\n+            }\n+            if (version > 5 || version < 3) {\n+                throw new PicardException(\"Unsupported BPM version (\" + version + \")\");\n+            }\n+            manifestName = parseString();\n+            if (version > 1) {\n+                controlConfig = parseString();\n+            }\n+            numLoci = parseInt();\n+\n+            readData();\n+        } finally {\n+            stream.close();\n+        }\n+    }\n+\n+    private void readData() throws IOException {\n+        // Skip the index block\n+        stream.skipBytes(4 * numLoci);\n+\n+        // Read the names\n+        String[] names = new String[numLoci];\n+        for (int i = 0; i < numLoci; i++) {\n+            names[i] = parseString();\n+        }\n+\n+        // Read the normalization ids.\n+        allNormalizationIds = parseByteArrayAsInts(numLoci);\n+        Set<Integer> uniqueNormalizationIdsSet = new TreeSet<>();\n+\n+        // Initialize the locus entries\n+        locusEntries = new IlluminaBPMLocusEntry[numLoci];\n+        for (int i = 0; i < numLoci; i++) {\n+            locusEntries[i] = null;\n+        }\n+\n+        // Read the locus entries.\n+        for (int i = 0; i < numLoci; i++) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5NTA5Nw=="}, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 98}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4Njk3MjE0OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/IlluminaBPMLocusEntry.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOTozOTo1MVrOGbadjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNTo0MjowOVrOGd3tRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5ODI4Nw==", "bodyText": "Consider passing the InfiniumDataFile into the constructor and parsing there", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431398287", "createdAt": "2020-05-27T19:39:51Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMLocusEntry.java", "diffHunk": "@@ -0,0 +1,79 @@\n+package picard.arrays.illumina;\n+\n+/**\n+ * A simple class to represent a locus entry in an Illumina Bead Pool Manifest (BPM) file\n+ */\n+public class IlluminaBPMLocusEntry {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk3NDU5OA==", "bodyText": "I'm going to hold off on that for now.  Maybe in another PR", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r433974598", "createdAt": "2020-06-02T15:42:09Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMLocusEntry.java", "diffHunk": "@@ -0,0 +1,79 @@\n+package picard.arrays.illumina;\n+\n+/**\n+ * A simple class to represent a locus entry in an Illumina Bead Pool Manifest (BPM) file\n+ */\n+public class IlluminaBPMLocusEntry {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5ODI4Nw=="}, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4Njk3NTQ5OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/IlluminaBPMLocusEntry.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOTo0MDo1OVrOGbafsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOTo0MDo1OVrOGbafsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM5ODgzNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                int assayType;              // Identifies type of assay (0 - Infinium II , 1 - Infinium I (A/T), 2 - Infinium I (G/C)\n          \n          \n            \n               // Identifies type of assay (0 - Infinium II , 1 - Infinium I (A/T), 2 - Infinium I (G/C)\n          \n          \n            \n                int assayType;", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431398834", "createdAt": "2020-05-27T19:40:59Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMLocusEntry.java", "diffHunk": "@@ -0,0 +1,79 @@\n+package picard.arrays.illumina;\n+\n+/**\n+ * A simple class to represent a locus entry in an Illumina Bead Pool Manifest (BPM) file\n+ */\n+public class IlluminaBPMLocusEntry {\n+    String ilmnId;              // IlmnID (probe identifier) of locus\n+    String name;                // Name (variant identifier) of locus\n+    int index;                  // Index of this entry.\n+    String ilmnStrand;          // Illumina Strand value\n+    String snp;                 // SNP value for locus (e.g., [A/C])\n+    String chrom;               // Chromosome for the locus (e.g., XY)\n+    String ploidy;              // Ploidy\n+    String species;\n+    int mapInfo;                // Mapping location of locus\n+    String customerStrand;      // Customer Strand\n+    int addressA;               // AddressA ID of locus\n+    String alleleAProbeSeq;     // CSV files or BPM files with version 4 data block\n+    int addressB;               // AddressB ID of locus (0 if none)\n+    String alleleBProbeSeq;     // CSV files or BPM files with version 4 data block (empty if none)\n+\n+    String genomeBuild;\n+    String source;\n+    String sourceVersion;\n+    String sourceStrand;\n+    String sourceSeq;           // CSV files or BPM files with version 4 data block\n+    String topGenomicSeq;       // CSV files or BPM files with version 4 data block\n+\n+    int expClusters;\n+    int intensityOnly;\n+    int assayType;              // Identifies type of assay (0 - Infinium II , 1 - Infinium I (A/T), 2 - Infinium I (G/C)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4Njk5NDI2OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/InfiniumEGTFile.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOTo0NzowNFrOGbar8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMDo1MTo1OVrOGbcreg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQwMTk3MQ==", "bodyText": "parseBoolean() ?", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431401971", "createdAt": "2020-05-27T19:47:04Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/InfiniumEGTFile.java", "diffHunk": "@@ -151,16 +157,11 @@ private void parseFloats(float[] array) throws IOException {\n \n     private void readHeaderData() throws IOException {\n         setFileVersion(parseInt());\n-        // skip gcVersion\n-        skipString();\n-        // skip clusterVersion\n-        skipString();\n-        // skip callVersion\n-        skipString();\n-        // skip normalizationVersion\n-        skipString();\n-        // skip dataCreated\n-        skipString();\n+        gencallVersion = parseString();\n+        clusterVersion = parseString();\n+        callVersion = parseString();\n+        normalizationVersion = parseString();\n+        dateCreated = parseString();\n         // skip isWGT\n         skipBoolean();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzNDYxOA==", "bodyText": "yup", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431434618", "createdAt": "2020-05-27T20:51:59Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/InfiniumEGTFile.java", "diffHunk": "@@ -151,16 +157,11 @@ private void parseFloats(float[] array) throws IOException {\n \n     private void readHeaderData() throws IOException {\n         setFileVersion(parseInt());\n-        // skip gcVersion\n-        skipString();\n-        // skip clusterVersion\n-        skipString();\n-        // skip callVersion\n-        skipString();\n-        // skip normalizationVersion\n-        skipString();\n-        // skip dataCreated\n-        skipString();\n+        gencallVersion = parseString();\n+        clusterVersion = parseString();\n+        callVersion = parseString();\n+        normalizationVersion = parseString();\n+        dateCreated = parseString();\n         // skip isWGT\n         skipBoolean();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQwMTk3MQ=="}, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4Njk5ODMzOnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOTo0ODoxM1rOGbaueQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMTowMDowOFrOGbc8fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQwMjYxNw==", "bodyText": "null is default", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431402617", "createdAt": "2020-05-27T19:48:13Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "diffHunk": "@@ -82,7 +84,10 @@\n     public static final byte AB_CALL = 2;\n     public static final byte BB_CALL = 3;\n \n-    private final InfiniumNormalizationManifest normalizationManifest;\n+    // Normalization Ids as pulled from the BPM file\n+    private int[] allNormalizationIds = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzODk3Mg==", "bodyText": "Yup", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431438972", "createdAt": "2020-05-27T21:00:08Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "diffHunk": "@@ -82,7 +84,10 @@\n     public static final byte AB_CALL = 2;\n     public static final byte BB_CALL = 3;\n \n-    private final InfiniumNormalizationManifest normalizationManifest;\n+    // Normalization Ids as pulled from the BPM file\n+    private int[] allNormalizationIds = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQwMjYxNw=="}, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NzAxMjk4OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOTo1MzoxNVrOGba4PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMTowNjo0M1rOGbdJeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQwNTExNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        illuminaBPMFile = new IlluminaBPMFile(inputStream);\n          \n          \n            \n                        illuminaBPMFile = new IlluminaBPMFile(bpmFile);\n          \n      \n    \n    \n  \n\nAnd make IlluminaBPMFile autocloseable", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431405117", "createdAt": "2020-05-27T19:53:15Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "diffHunk": "@@ -163,12 +169,17 @@ public void close() throws IOException {\n         stream.close();\n     }\n \n-    InfiniumGTCFile(final DataInputStream gtcStream) throws IOException {\n-        super(gtcStream, true);\n-        this.normalizationManifest = null;\n-        parse();\n-    }\n+    private void loadNormalizationIds(final File bpmFile) {\n+        IlluminaBPMFile illuminaBPMFile;\n+        try (final DataInputStream inputStream = new DataInputStream(new FileInputStream(bpmFile))) {\n+            illuminaBPMFile = new IlluminaBPMFile(inputStream);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ0MjI5Nw==", "bodyText": "yup", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431442297", "createdAt": "2020-05-27T21:06:43Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "diffHunk": "@@ -163,12 +169,17 @@ public void close() throws IOException {\n         stream.close();\n     }\n \n-    InfiniumGTCFile(final DataInputStream gtcStream) throws IOException {\n-        super(gtcStream, true);\n-        this.normalizationManifest = null;\n-        parse();\n-    }\n+    private void loadNormalizationIds(final File bpmFile) {\n+        IlluminaBPMFile illuminaBPMFile;\n+        try (final DataInputStream inputStream = new DataInputStream(new FileInputStream(bpmFile))) {\n+            illuminaBPMFile = new IlluminaBPMFile(inputStream);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQwNTExNw=="}, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NzAxOTAyOnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOTo1NToxM1rOGba8Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNToxMzo0OVrOGdON1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQwNjExNQ==", "bodyText": "always true", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431406115", "createdAt": "2020-05-27T19:55:13Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "diffHunk": "@@ -221,7 +232,7 @@ private void parse() throws IOException {\n             stream.close();\n         }\n \n-        if ((normalizationManifest != null) && (normalizationManifest.getNormIds() != null)) {\n+        if (allNormalizationIds != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5NDgwNQ==", "bodyText": "Done", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r433294805", "createdAt": "2020-06-01T15:13:49Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "diffHunk": "@@ -221,7 +232,7 @@ private void parse() throws IOException {\n             stream.close();\n         }\n \n-        if ((normalizationManifest != null) && (normalizationManifest.getNormIds() != null)) {\n+        if (allNormalizationIds != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQwNjExNQ=="}, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 100}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NzAyMTU2OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOTo1NjowMVrOGba9xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNToxNDowMFrOGdOOaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQwNjUzMw==", "bodyText": "simplify\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if ((allNormalizationIds != null) && (allNormalizationIds.length > i)) {\n          \n          \n            \n                        if (allNormalizationIds.length > i) {", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431406533", "createdAt": "2020-05-27T19:56:01Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "diffHunk": "@@ -230,15 +241,14 @@ private void normalizeIntensities() {\n         normalizedXIntensities = new float[numberOfSnps];\n         normalizedYIntensities = new float[numberOfSnps];\n \n-        final int[] normIds = normalizationManifest.getNormIds();\n         for (int i = 0; i < rawXIntensities.length; i++) {\n             final int rawX = rawXIntensities[i];\n             final int rawY = rawYIntensities[i];\n \n             final int normId;\n             int normIndex = -1;\n-            if ((normIds != null) && (normIds.length > i)) {\n-                normId = normIds[i];\n+            if ((allNormalizationIds != null) && (allNormalizationIds.length > i)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 117}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5NDk1Mw==", "bodyText": "Done.", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r433294953", "createdAt": "2020-06-01T15:14:00Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "diffHunk": "@@ -230,15 +241,14 @@ private void normalizeIntensities() {\n         normalizedXIntensities = new float[numberOfSnps];\n         normalizedYIntensities = new float[numberOfSnps];\n \n-        final int[] normIds = normalizationManifest.getNormIds();\n         for (int i = 0; i < rawXIntensities.length; i++) {\n             final int rawX = rawXIntensities[i];\n             final int rawY = rawYIntensities[i];\n \n             final int normId;\n             int normIndex = -1;\n-            if ((normIds != null) && (normIds.length > i)) {\n-                normId = normIds[i];\n+            if ((allNormalizationIds != null) && (allNormalizationIds.length > i)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQwNjUzMw=="}, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 117}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NzAyNDA1OnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxOTo1Njo1NVrOGba_bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNToxNToyMVrOGdOR0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQwNjk1Nw==", "bodyText": "always true", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r431406957", "createdAt": "2020-05-27T19:56:55Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "diffHunk": "@@ -495,7 +505,7 @@ private void parseTransformations(final InfiniumFileTOC toc) throws IOException\n     }\n \n     private void normalizeAndCalculateStatistics() {\n-        if (normalizationManifest.getNormIds() != null) {\n+        if (allNormalizationIds != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5NTgyNw==", "bodyText": "Done", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r433295827", "createdAt": "2020-06-01T15:15:21Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/InfiniumGTCFile.java", "diffHunk": "@@ -495,7 +505,7 @@ private void parseTransformations(final InfiniumFileTOC toc) throws IOException\n     }\n \n     private void normalizeAndCalculateStatistics() {\n-        if (normalizationManifest.getNormIds() != null) {\n+        if (allNormalizationIds != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQwNjk1Nw=="}, "originalCommit": {"oid": "1ed3c8120d44ef9e0f14005a748fcc2ea2879259"}, "originalPosition": 149}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwNDM4MzAzOnYy", "diffSide": "RIGHT", "path": "src/main/java/picard/arrays/illumina/IlluminaBPMLocusEntry.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMDozMToyNVrOGeC5mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQyMTozNjo1OVrOGeE1eA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE1Nzk3OQ==", "bodyText": "generally prefer comments on separate lines", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r434157979", "createdAt": "2020-06-02T20:31:25Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMLocusEntry.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package picard.arrays.illumina;\n+\n+/**\n+ * A simple class to represent a locus entry in an Illumina Bead Pool Manifest (BPM) file\n+ */\n+public class IlluminaBPMLocusEntry {\n+    String ilmnId;              // IlmnID (probe identifier) of locus", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1ebffd5845faa4b06c146ae99aa90a4699bf63b"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE4OTY4OA==", "bodyText": "Thanks.  Forgot to get them all", "url": "https://github.com/broadinstitute/picard/pull/1517#discussion_r434189688", "createdAt": "2020-06-02T21:36:59Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/arrays/illumina/IlluminaBPMLocusEntry.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package picard.arrays.illumina;\n+\n+/**\n+ * A simple class to represent a locus entry in an Illumina Bead Pool Manifest (BPM) file\n+ */\n+public class IlluminaBPMLocusEntry {\n+    String ilmnId;              // IlmnID (probe identifier) of locus", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE1Nzk3OQ=="}, "originalCommit": {"oid": "c1ebffd5845faa4b06c146ae99aa90a4699bf63b"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 610, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}