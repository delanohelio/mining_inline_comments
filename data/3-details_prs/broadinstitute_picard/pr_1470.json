{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1ODczMTQ4", "number": 1470, "title": "GL-853 Modify VcfToAdpc to handle multiple samples.", "bodyText": "Description\nModify VcfToAdpc to handle multiple samples.\nPut NaN in the adc.bin file if normalized intensity is null.\nOutput files containing number of samples and markers (useful for running VerifyIDIntensity itself).\nAdded tests\nChecklist (never delete this)\nNever delete this, it is our record that procedure was followed. If you find that for whatever reason one of the checklist points doesn't apply to your PR, you can leave it unchecked but please add an explanation below.\nContent\n\n Added or modified tests to cover changes and any new functionality\n Edited the README / documentation (if applicable)\n All tests passing on Travis\n\nReview\n\n Final thumbs-up from reviewer\n Rebase, squash and reword as applicable\n\nFor more detailed guidelines, see https://github.com/broadinstitute/picard/wiki/Guidelines-for-pull-requests", "createdAt": "2020-02-16T21:08:47Z", "url": "https://github.com/broadinstitute/picard/pull/1470", "merged": true, "mergeCommit": {"oid": "81bef8d8d29c1586d751558b94619fca296bb6ef"}, "closed": true, "closedAt": "2020-02-26T18:38:14Z", "author": {"login": "gbggrant"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHeoXwABqjMwNjU2MzYzODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIJLk6ABqjMwNzQ0MzgxNTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1101a79e2d5072277841bdcf4df052586328ef17", "author": {"user": {"login": "gbggrant", "name": "George Grant"}}, "url": "https://github.com/broadinstitute/picard/commit/1101a79e2d5072277841bdcf4df052586328ef17", "committedDate": "2020-02-24T14:41:44Z", "message": "Update to use NaN if either normalized intensity is null in the VCF."}, "afterCommit": {"oid": "a229b85c3370924cbb1c8988fceb88b00505ebba", "author": {"user": {"login": "gbggrant", "name": "George Grant"}}, "url": "https://github.com/broadinstitute/picard/commit/a229b85c3370924cbb1c8988fceb88b00505ebba", "committedDate": "2020-02-24T14:42:44Z", "message": "Modify VcfToAdpc to handle multiple samples.\nPut NaN in the adc.bin file if normalized intensity is null.\nOutput files containing number of samples and markers (useful for running VerifyIDIntensity itself).\nAdded tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MzU5MTM0", "url": "https://github.com/broadinstitute/picard/pull/1470#pullrequestreview-364359134", "createdAt": "2020-02-25T18:46:38Z", "commit": {"oid": "a229b85c3370924cbb1c8988fceb88b00505ebba"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODo0NjozOFrOFuQ0YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODo0NjozOFrOFuQ0YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1NDM2OA==", "bodyText": "Should this also check the NUM_MARKERS_FILE?", "url": "https://github.com/broadinstitute/picard/pull/1470#discussion_r384054368", "createdAt": "2020-02-25T18:46:38Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/VcfToAdpc.java", "diffHunk": "@@ -62,55 +68,85 @@\n                     \"An adpc.bin file is a binary file containing genotyping array intensity data that can be exported \" +\n                     \"by Illumina's GenomeStudio and Beadstudio analysis tools. The adpc.bin file is used as an input to \" +\n                     \"<a href='https://genome.sph.umich.edu/wiki/VerifyIDintensity'>VerifyIDintensity</a> a tool for \" +\n-                    \"detecting and estimating sample contamination of Illumina genotyping array data.\" +\n+                    \"detecting and estimating sample contamination of Illumina genotyping array data. \" +\n+                    \"If more than one VCF is used, they must all have the same number of loci.\" +\n                     \"<h4>Usage example:</h4>\" +\n                     \"<pre>\" +\n                     \"java -jar picard.jar VcfToAdpc \\\\<br />\" +\n                     \"      VCF=input.vcf \\\\<br />\" +\n-                    \"      OUTPUT=output.adpc.bin\" +\n+                    \"      OUTPUT=output.adpc.bin \\\\<br />\" +\n+                    \"      SAMPLES_FILE=output.samples.txt \\\\<br />\" +\n+                    \"      NUM_MARKERS_FILE=output.num_markers.txt \\\\<br />\" +\n                     \"</pre>\";\n \n \n     private final Log log = Log.getInstance(VcfToAdpc.class);\n \n-    @Argument(doc = \"The Input VCF\")\n-    public File VCF;\n+    @Argument(doc = \"One or more VCF files containing array intensity data.\")\n+    public List<File> VCF;\n \n     @Argument(shortName = StandardOptionDefinitions.OUTPUT_SHORT_NAME, doc = \"The output (adpc.bin) file to write.\")\n     public File OUTPUT;\n \n+    @Argument(shortName = \"SF\", doc = \"A text file into which the names of the samples will be written. \" +\n+            \"These will be in the same order as the data in the adpc.bin file.\")\n+    public File SAMPLES_FILE;\n+\n+    @Argument(shortName = \"NMF\", doc = \"A text file into which the number of loci in the VCF will be written. \" +\n+            \"This is useful for calling verifyIDIntensity.\")\n+    public File NUM_MARKERS_FILE;\n+\n     @Override\n     protected int doWork() {\n-        IOUtil.assertFileIsReadable(VCF);\n+        final List<File> inputs = IOUtil.unrollFiles(VCF, IOUtil.VCF_EXTENSIONS);\n+        IOUtil.assertFilesAreWritable(inputs);\n+        IOUtil.assertFileIsWritable(SAMPLES_FILE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a229b85c3370924cbb1c8988fceb88b00505ebba"}, "originalPosition": 62}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0MzYwMTA3", "url": "https://github.com/broadinstitute/picard/pull/1470#pullrequestreview-364360107", "createdAt": "2020-02-25T18:47:59Z", "commit": {"oid": "a229b85c3370924cbb1c8988fceb88b00505ebba"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODo0Nzo1OVrOFuQ3nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODo0Nzo1OVrOFuQ3nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1NTE5Nw==", "bodyText": "Do we need to check writeable? The previous check was for readable", "url": "https://github.com/broadinstitute/picard/pull/1470#discussion_r384055197", "createdAt": "2020-02-25T18:47:59Z", "author": {"login": "jessicaway"}, "path": "src/main/java/picard/arrays/VcfToAdpc.java", "diffHunk": "@@ -62,55 +68,85 @@\n                     \"An adpc.bin file is a binary file containing genotyping array intensity data that can be exported \" +\n                     \"by Illumina's GenomeStudio and Beadstudio analysis tools. The adpc.bin file is used as an input to \" +\n                     \"<a href='https://genome.sph.umich.edu/wiki/VerifyIDintensity'>VerifyIDintensity</a> a tool for \" +\n-                    \"detecting and estimating sample contamination of Illumina genotyping array data.\" +\n+                    \"detecting and estimating sample contamination of Illumina genotyping array data. \" +\n+                    \"If more than one VCF is used, they must all have the same number of loci.\" +\n                     \"<h4>Usage example:</h4>\" +\n                     \"<pre>\" +\n                     \"java -jar picard.jar VcfToAdpc \\\\<br />\" +\n                     \"      VCF=input.vcf \\\\<br />\" +\n-                    \"      OUTPUT=output.adpc.bin\" +\n+                    \"      OUTPUT=output.adpc.bin \\\\<br />\" +\n+                    \"      SAMPLES_FILE=output.samples.txt \\\\<br />\" +\n+                    \"      NUM_MARKERS_FILE=output.num_markers.txt \\\\<br />\" +\n                     \"</pre>\";\n \n \n     private final Log log = Log.getInstance(VcfToAdpc.class);\n \n-    @Argument(doc = \"The Input VCF\")\n-    public File VCF;\n+    @Argument(doc = \"One or more VCF files containing array intensity data.\")\n+    public List<File> VCF;\n \n     @Argument(shortName = StandardOptionDefinitions.OUTPUT_SHORT_NAME, doc = \"The output (adpc.bin) file to write.\")\n     public File OUTPUT;\n \n+    @Argument(shortName = \"SF\", doc = \"A text file into which the names of the samples will be written. \" +\n+            \"These will be in the same order as the data in the adpc.bin file.\")\n+    public File SAMPLES_FILE;\n+\n+    @Argument(shortName = \"NMF\", doc = \"A text file into which the number of loci in the VCF will be written. \" +\n+            \"This is useful for calling verifyIDIntensity.\")\n+    public File NUM_MARKERS_FILE;\n+\n     @Override\n     protected int doWork() {\n-        IOUtil.assertFileIsReadable(VCF);\n+        final List<File> inputs = IOUtil.unrollFiles(VCF, IOUtil.VCF_EXTENSIONS);\n+        IOUtil.assertFilesAreWritable(inputs);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a229b85c3370924cbb1c8988fceb88b00505ebba"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY0NDMzOTQ2", "url": "https://github.com/broadinstitute/picard/pull/1470#pullrequestreview-364433946", "createdAt": "2020-02-25T20:43:36Z", "commit": {"oid": "f3fccead973a62646381f9b9952bf5cca5775bfb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53834b374e21dd61dc3d54f9604ff7a1585af234", "author": {"user": {"login": "gbggrant", "name": "George Grant"}}, "url": "https://github.com/broadinstitute/picard/commit/53834b374e21dd61dc3d54f9604ff7a1585af234", "committedDate": "2020-02-26T16:18:49Z", "message": "Modify VcfToAdpc to handle multiple samples.\nPut NaN in the adc.bin file if normalized intensity is null.\nOutput files containing number of samples and markers (useful for running VerifyIDIntensity itself).\nAdded tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f3fccead973a62646381f9b9952bf5cca5775bfb", "author": {"user": {"login": "gbggrant", "name": "George Grant"}}, "url": "https://github.com/broadinstitute/picard/commit/f3fccead973a62646381f9b9952bf5cca5775bfb", "committedDate": "2020-02-25T19:07:01Z", "message": "Code review fixes."}, "afterCommit": {"oid": "53834b374e21dd61dc3d54f9604ff7a1585af234", "author": {"user": {"login": "gbggrant", "name": "George Grant"}}, "url": "https://github.com/broadinstitute/picard/commit/53834b374e21dd61dc3d54f9604ff7a1585af234", "committedDate": "2020-02-26T16:18:49Z", "message": "Modify VcfToAdpc to handle multiple samples.\nPut NaN in the adc.bin file if normalized intensity is null.\nOutput files containing number of samples and markers (useful for running VerifyIDIntensity itself).\nAdded tests"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2398, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}