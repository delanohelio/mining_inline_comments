{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3NzA3Njgw", "number": 1613, "title": "Fast fail if R is not installed in tools that use R", "bodyText": "Description\nMany metrics collectors in Picard rely on R to generate a plot at the end of the tool. Unfortunately, if a user does not have R installed, a tool could fail hours after running as mentioned in this issue: #1290. This PR throws an error at the beginning of a run, if R is not installed and the tool uses an R script.\nChanges Made:\nCreate a method in CommandLineProgram that checks if R is installed when a chart is expected as an output\nCall the method in customCommandLineValidation for every tool that uses an R script\n\nChecklist (never delete this)\nNever delete this, it is our record that procedure was followed. If you find that for whatever reason one of the checklist points doesn't apply to your PR, you can leave it unchecked but please add an explanation below.\nContent\n\n Added or modified tests to cover changes and any new functionality\n Edited the README / documentation (if applicable)\n All tests passing on Travis\n\nReview\n\n Final thumbs-up from reviewer\n Rebase, squash and reword as applicable\n\nFor more detailed guidelines, see https://github.com/broadinstitute/picard/wiki/Guidelines-for-pull-requests", "createdAt": "2020-11-25T21:48:16Z", "url": "https://github.com/broadinstitute/picard/pull/1613", "merged": true, "mergeCommit": {"oid": "028ecc24fb2a4092003d02a988a3516a6abcb891"}, "closed": true, "closedAt": "2020-12-02T15:35:35Z", "author": {"login": "sophiacrennan"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdgFKwQgH2gAyNTI3NzA3NjgwOmUzYzAwNzIyZDIzMjA3YzVjOTFjZjZkYWJiNTA5NDQ1ZWYyYWQ0NTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiP8PTAH2gAyNTI3NzA3NjgwOjQ2MzQyZTk5NzMyNjI0N2FkNmI5MWY4OGE0MWUwYWY0NTlhNDU1MWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e3c00722d23207c5c91cf6dabb509445ef2ad451", "author": {"user": {"login": "sophiacrennan", "name": "Sophie Crennan"}}, "url": "https://github.com/broadinstitute/picard/commit/e3c00722d23207c5c91cf6dabb509445ef2ad451", "committedDate": "2020-11-25T21:24:05Z", "message": "Check if R is installed if a tool outputs a chart"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b16648a9ba443b136449f6e2bd1a7c2df978d88", "author": {"user": {"login": "sophiacrennan", "name": "Sophie Crennan"}}, "url": "https://github.com/broadinstitute/picard/commit/5b16648a9ba443b136449f6e2bd1a7c2df978d88", "committedDate": "2020-11-25T21:53:32Z", "message": "Merge branch 'master' into sc_gl-1290_check_R_installed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "230cbe0376fff4c947feeeb8350b29f334bb1f3a", "author": {"user": {"login": "sophiacrennan", "name": "Sophie Crennan"}}, "url": "https://github.com/broadinstitute/picard/commit/230cbe0376fff4c947feeeb8350b29f334bb1f3a", "committedDate": "2020-11-30T19:59:19Z", "message": "Create a simple R script to check R is installed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "405abceb7b7d60e9b5c3b72902b043601aa42fdd", "author": {"user": {"login": "sophiacrennan", "name": "Sophie Crennan"}}, "url": "https://github.com/broadinstitute/picard/commit/405abceb7b7d60e9b5c3b72902b043601aa42fdd", "committedDate": "2020-11-30T19:59:51Z", "message": "Merge remote-tracking branch 'origin/sc_gl-1290_check_R_installed' into sc_gl-1290_check_R_installed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMjc0NTMy", "url": "https://github.com/broadinstitute/picard/pull/1613#pullrequestreview-542274532", "createdAt": "2020-12-01T20:35:24Z", "commit": {"oid": "405abceb7b7d60e9b5c3b72902b043601aa42fdd"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMDozNToyNVrOH8-vYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMDozNToyNVrOH8-vYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwNDU0Nw==", "bodyText": "Why is this true?", "url": "https://github.com/broadinstitute/picard/pull/1613#discussion_r533704547", "createdAt": "2020-12-01T20:35:25Z", "author": {"login": "khajoue2"}, "path": "src/main/java/picard/analysis/CollectMultipleMetrics.java", "diffHunk": "@@ -669,6 +669,8 @@ public String getHelpDoc() {\n         }\n         programsToRun = new LinkedHashSet<>(PROGRAM);\n \n+        checkRInstallation(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "405abceb7b7d60e9b5c3b72902b043601aa42fdd"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMjc4NjE0", "url": "https://github.com/broadinstitute/picard/pull/1613#pullrequestreview-542278614", "createdAt": "2020-12-01T20:41:23Z", "commit": {"oid": "405abceb7b7d60e9b5c3b72902b043601aa42fdd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMDo0MToyM1rOH8-78A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMDo0OTozMFrOH8_NQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwNzc2MA==", "bodyText": "space between if and (", "url": "https://github.com/broadinstitute/picard/pull/1613#discussion_r533707760", "createdAt": "2020-12-01T20:41:23Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/cmdline/CommandLineProgram.java", "diffHunk": "@@ -497,4 +498,18 @@ public static boolean hasWebDocumentation(final Class<?> clazz){\n     public static String getFaqLink() {\n         return \"To get help, see http://broadinstitute.github.io/picard/index.html#GettingHelp\";\n     }\n+\n+    /**\n+     * Check if R is installed\n+     * @param has_chart_output\n+     */\n+    public static void checkRInstallation(final boolean has_chart_output) {\n+        if(has_chart_output) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "405abceb7b7d60e9b5c3b72902b043601aa42fdd"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcxMjE5Mw==", "bodyText": "Rather than throwing an exception here, could you return the error string (or just a true / false) from this class if R is not installed?\nAnd then in the calling program's CustomCommandLineValidator code you could just check if checkRInstallation failed and return a string array like:\n         if (!checkRInstallation(CHART_OUTPUT != null)) { return new String[]{\"R is not installed on this machine. It is required for creating the chart.\"}; }\nThis is more in line with how CustomCommandLine validation should work.\nI think the usage in CollectInsertSizeMetrics.java is more correct than that in CollectRnaSeqMetrics.java", "url": "https://github.com/broadinstitute/picard/pull/1613#discussion_r533712193", "createdAt": "2020-12-01T20:49:30Z", "author": {"login": "gbggrant"}, "path": "src/main/java/picard/cmdline/CommandLineProgram.java", "diffHunk": "@@ -497,4 +498,18 @@ public static boolean hasWebDocumentation(final Class<?> clazz){\n     public static String getFaqLink() {\n         return \"To get help, see http://broadinstitute.github.io/picard/index.html#GettingHelp\";\n     }\n+\n+    /**\n+     * Check if R is installed\n+     * @param has_chart_output\n+     */\n+    public static void checkRInstallation(final boolean has_chart_output) {\n+        if(has_chart_output) {\n+            try {\n+                RExecutor.executeFromClasspath(\"picard/analysis/checkRInstallation.R\");\n+            } catch (htsjdk.samtools.SAMException e) {\n+                throw new PicardException(\"R is not installed on this machine. It is required for creating the chart.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "405abceb7b7d60e9b5c3b72902b043601aa42fdd"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c8cd2626ea47eb65d656b4621f1d3f3289e6769", "author": {"user": {"login": "sophiacrennan", "name": "Sophie Crennan"}}, "url": "https://github.com/broadinstitute/picard/commit/0c8cd2626ea47eb65d656b4621f1d3f3289e6769", "committedDate": "2020-12-01T22:32:56Z", "message": "instead of throwing an exception, return an error string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3578fc05b4e079bcf2e34ecc6f42e75b57bcddbb", "author": {"user": {"login": "sophiacrennan", "name": "Sophie Crennan"}}, "url": "https://github.com/broadinstitute/picard/commit/3578fc05b4e079bcf2e34ecc6f42e75b57bcddbb", "committedDate": "2020-12-01T22:42:15Z", "message": "fix a few if statements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMzczODA3", "url": "https://github.com/broadinstitute/picard/pull/1613#pullrequestreview-542373807", "createdAt": "2020-12-01T23:10:46Z", "commit": {"oid": "3578fc05b4e079bcf2e34ecc6f42e75b57bcddbb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46342e997326247ad6b91f88a41e0af459a4551e", "author": {"user": {"login": "sophiacrennan", "name": "Sophie Crennan"}}, "url": "https://github.com/broadinstitute/picard/commit/46342e997326247ad6b91f88a41e0af459a4551e", "committedDate": "2020-12-02T15:05:02Z", "message": "Merge branch 'master' into sc_gl-1290_check_R_installed"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2349, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}