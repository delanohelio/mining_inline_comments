{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNjkxOTkz", "number": 1497, "title": "GL-970.  Have CompareMetrics consider two NaN metrics equal", "bodyText": "Description\nHave CompareMetrics consider two NaN metrics equal\n\nChecklist (never delete this)\nNever delete this, it is our record that procedure was followed. If you find that for whatever reason one of the checklist points doesn't apply to your PR, you can leave it unchecked but please add an explanation below.\nContent\n\n Added or modified tests to cover changes and any new functionality\n Edited the README / documentation (if applicable)\n All tests passing on Travis\n\nReview\n\n Final thumbs-up from reviewer\n Rebase, squash and reword as applicable\n\nFor more detailed guidelines, see https://github.com/broadinstitute/picard/wiki/Guidelines-for-pull-requests", "createdAt": "2020-04-13T15:17:25Z", "url": "https://github.com/broadinstitute/picard/pull/1497", "merged": true, "mergeCommit": {"oid": "55e8a2ea7e01e4ffdf1de6b1cf62926c3c52305c"}, "closed": true, "closedAt": "2020-04-14T01:21:00Z", "author": {"login": "gbggrant"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXRHh2gFqTM5MjI0MTM1Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXW8GlABqjMyMjg4MzI3MDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMjQxMzUy", "url": "https://github.com/broadinstitute/picard/pull/1497#pullrequestreview-392241352", "createdAt": "2020-04-13T16:02:57Z", "commit": {"oid": "0d514a2f666c44744d11588db578f375e8986c67"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNjowMjo1N1rOGErULw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNjowMjo1N1rOGErULw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU1NzE2Nw==", "bodyText": "Can use fewer parens\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if ((!Double.isNaN(numValue1)) || (!Double.isNaN(numValue2))) {\n          \n          \n            \n                            if (!Double.isNaN(numValue1) || !Double.isNaN(numValue2)) {", "url": "https://github.com/broadinstitute/picard/pull/1497#discussion_r407557167", "createdAt": "2020-04-13T16:02:57Z", "author": {"login": "pshapiro4broad"}, "path": "src/main/java/picard/analysis/CompareMetrics.java", "diffHunk": "@@ -267,7 +267,11 @@ protected SimpleResult compareMetricValues(final Object value1, final Object val\n             if (value1 instanceof Number) {\n                 double numValue1 = ((Number) value1).doubleValue();\n                 double numValue2 = ((Number) value2).doubleValue();\n-                double relativeChange = (numValue1 == 0 && numValue2 == 0) ? 0 : (numValue1 == 0) ? Double.MAX_VALUE : (numValue1 - numValue2) / numValue2;\n+                double relativeChange = 0;\n+                if ((!Double.isNaN(numValue1)) || (!Double.isNaN(numValue2))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0d514a2f666c44744d11588db578f375e8986c67"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMjQyMTU4", "url": "https://github.com/broadinstitute/picard/pull/1497#pullrequestreview-392242158", "createdAt": "2020-04-13T16:04:16Z", "commit": {"oid": "0d514a2f666c44744d11588db578f375e8986c67"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMjUwMDA1", "url": "https://github.com/broadinstitute/picard/pull/1497#pullrequestreview-392250005", "createdAt": "2020-04-13T16:16:11Z", "commit": {"oid": "0d514a2f666c44744d11588db578f375e8986c67"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMjg1MTUz", "url": "https://github.com/broadinstitute/picard/pull/1497#pullrequestreview-392285153", "createdAt": "2020-04-13T17:09:47Z", "commit": {"oid": "5ed9f9f671fdfbb90261f80818e6ae13caf36e31"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNzowOTo0OFrOGEtiIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxNzowOTo0OFrOGEtiIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU5MzUwNA==", "bodyText": "Under what conditions is it possible for absoluteChange to be non-zero and for (numValue1 == 0 && numValue2 == 0) to be true? Are this trying to avoid dividing by zero?\nAlso this code now divides by numValue1 and before it divided by numValue2, is that a fix?", "url": "https://github.com/broadinstitute/picard/pull/1497#discussion_r407593504", "createdAt": "2020-04-13T17:09:48Z", "author": {"login": "pshapiro4broad"}, "path": "src/main/java/picard/analysis/CompareMetrics.java", "diffHunk": "@@ -267,22 +267,26 @@ protected SimpleResult compareMetricValues(final Object value1, final Object val\n             if (value1 instanceof Number) {\n                 double numValue1 = ((Number) value1).doubleValue();\n                 double numValue2 = ((Number) value2).doubleValue();\n-                double relativeChange = (numValue1 == 0 && numValue2 == 0) ? 0 : (numValue1 == 0) ? Double.MAX_VALUE : (numValue1 - numValue2) / numValue2;\n-                if (relativeChange != 0) {\n+                double absoluteChange = 0;\n+                if (!Double.isNaN(numValue1) || !Double.isNaN(numValue2)) {\n+                    absoluteChange = numValue2 - numValue1;\n+                }\n+                if (absoluteChange != 0) {\n+                    double relativeChange = (numValue1 == 0 && numValue2 == 0) ? 0 : (numValue1 == 0) ? Double.MAX_VALUE : absoluteChange / numValue1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ed9f9f671fdfbb90261f80818e6ae13caf36e31"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21b9ee87061372502d1f4d6cf5e438bad8a67737", "author": {"user": {"login": "gbggrant", "name": "George Grant"}}, "url": "https://github.com/broadinstitute/picard/commit/21b9ee87061372502d1f4d6cf5e438bad8a67737", "committedDate": "2020-04-13T22:49:09Z", "message": "GL-970.\nHave CompareMetrics consider two NaN metrics equal\nAdded absolute difference"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0576d8799612c776d8a3e9c8295ff2cca41119f3", "author": {"user": {"login": "gbggrant", "name": "George Grant"}}, "url": "https://github.com/broadinstitute/picard/commit/0576d8799612c776d8a3e9c8295ff2cca41119f3", "committedDate": "2020-04-13T19:23:23Z", "message": "More code review feedback"}, "afterCommit": {"oid": "21b9ee87061372502d1f4d6cf5e438bad8a67737", "author": {"user": {"login": "gbggrant", "name": "George Grant"}}, "url": "https://github.com/broadinstitute/picard/commit/21b9ee87061372502d1f4d6cf5e438bad8a67737", "committedDate": "2020-04-13T22:49:09Z", "message": "GL-970.\nHave CompareMetrics consider two NaN metrics equal\nAdded absolute difference"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2435, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}