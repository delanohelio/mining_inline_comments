{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2Mzk2Nzg2", "number": 1586, "title": "Added a metric to CollectAlignmentSummaryMetrics for the mean length of 3' softclips", "bodyText": "... considering only those reads that have clipping on that end. This metric might provide an estimate for how much the mean insert-size should change for the number of bases lost to soft-clipping (that which is due to the insert ending) to change significantly.\n\n\nI'm not especially happy with the name of the metric. if someone can come up with a  better name I'd be happy to change.\n\n\nincluded tests\n\n\nDescription\nGive your PR a concise yet descriptive title\nPlease explain the changes you made here.\nExplain the motivation for making this change. What existing problem does the pull request solve?\nMention any issues fixed, addressed or otherwise related to this pull request, including issue numbers or hard links for issues in other repos.\nYou can delete these instructions once you have written your PR description.\n\nChecklist (never delete this)\nNever delete this, it is our record that procedure was followed. If you find that for whatever reason one of the checklist points doesn't apply to your PR, you can leave it unchecked but please add an explanation below.\nContent\n\n Added or modified tests to cover changes and any new functionality\n Edited the README / documentation (if applicable)\n All tests passing on Travis\n\nReview\n\n Final thumbs-up from reviewer\n Rebase, squash and reword as applicable\n\nFor more detailed guidelines, see https://github.com/broadinstitute/picard/wiki/Guidelines-for-pull-requests", "createdAt": "2020-10-01T16:40:56Z", "url": "https://github.com/broadinstitute/picard/pull/1586", "merged": true, "mergeCommit": {"oid": "f020c9d0b827cbc5bdb46171d58d2166314630b9"}, "closed": true, "closedAt": "2020-12-11T23:23:15Z", "author": {"login": "yfarjoun"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOUKpFABqjM4MzA0NTgzNTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlPKAGAFqTU1MDYwMTcyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7f012d2b26da14c9ea38334f30882b25b650bd38", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/picard/commit/7f012d2b26da14c9ea38334f30882b25b650bd38", "committedDate": "2020-10-01T16:37:12Z", "message": "- spaces"}, "afterCommit": {"oid": "14a7863636db406fd030ebe648abf431a1d6a753", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/picard/commit/14a7863636db406fd030ebe648abf431a1d6a753", "committedDate": "2020-10-01T16:41:38Z", "message": "- spaces"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNDUyNTk0", "url": "https://github.com/broadinstitute/picard/pull/1586#pullrequestreview-550452594", "createdAt": "2020-12-11T18:41:37Z", "commit": {"oid": "14a7863636db406fd030ebe648abf431a1d6a753"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxODo0MTozN1rOIEFQYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxODo1NjoyM1rOIEFw4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTE1MTMyOA==", "bodyText": "AVG_NON_ZERO_3PRIME_SOFTCLIP_LENGTH? What about the name did you want to improve?", "url": "https://github.com/broadinstitute/picard/pull/1586#discussion_r541151328", "createdAt": "2020-12-11T18:41:37Z", "author": {"login": "meganshand"}, "path": "src/main/java/picard/analysis/AlignmentSummaryMetrics.java", "diffHunk": "@@ -181,4 +185,12 @@\n      * PF_ALIGNED_BASES (even though these are not aligned!)\n      */\n     public double PCT_HARDCLIP;\n+\n+    /**\n+     * The average length of the soft-clipped bases at the 3' end of reads. This could be used as an estimate for\n+     * the amount by which the insert-size must be increased in order to obtain a significant reduction in bases\n+     * lost due to reading off the end of the insert.\n+     */\n+    public double AVERAGE_NON_ZERO_3PRIME_SOFTCLIP;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14a7863636db406fd030ebe648abf431a1d6a753"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTE1MjgyMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * returns The sum of lengths of a particular cigar operator in the provided cigar\n          \n          \n            \n                 * returns the length of the soft clip on the 3' end", "url": "https://github.com/broadinstitute/picard/pull/1586#discussion_r541152820", "createdAt": "2020-12-11T18:44:17Z", "author": {"login": "meganshand"}, "path": "src/main/java/picard/analysis/AlignmentSummaryMetricsCollector.java", "diffHunk": "@@ -91,6 +92,59 @@ public void acceptRecord(final SAMRecord rec, final ReferenceSequence ref) {\n         }\n     }\n \n+    /**\n+     * returns The sum of lengths of a particular cigar operator in the provided cigar\n+     *\n+     * @param cigar The input Cigar of the read\n+     * @param op The operator that is being looked for\n+     * @return Sum of lengths of the Cigar elements in cigar that are of the operator op\n+     */\n+    static private int getTotalCigarOperatorCount(final Cigar cigar, final CigarOperator op) {\n+        return cigar.getCigarElements().stream()\n+                .filter(e -> e.getOperator().equals(op))\n+                .mapToInt(CigarElement::getLength)\n+                .reduce(Integer::sum).orElse(0);\n+    }\n+\n+\n+    /**\n+     * returns The sum of lengths of a particular cigar operator in the provided cigar", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14a7863636db406fd030ebe648abf431a1d6a753"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTE1OTY1MQ==", "bodyText": "Can you add another edge case here with hard and soft clips on the same read: \"2H3S10M4S5H\"?", "url": "https://github.com/broadinstitute/picard/pull/1586#discussion_r541159651", "createdAt": "2020-12-11T18:56:23Z", "author": {"login": "meganshand"}, "path": "src/test/java/picard/analysis/AlignmentSummaryMetricsCollectorTest.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package picard.analysis;\n+\n+import htsjdk.samtools.Cigar;\n+import htsjdk.samtools.TextCigarCodec;\n+import org.testng.Assert;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Test;\n+\n+public class AlignmentSummaryMetricsCollectorTest {\n+\n+    @DataProvider\n+    public Object[][] get3PrimeSoftClipData() {\n+        return new Object[][]{\n+                {\"20M\", true, 0},\n+                {\"20M\", false, 0},\n+\n+                {\"2H20M\", true, 0},\n+                {\"2H20M\", false, 0},\n+\n+                {\"2S20M\", false, 0},\n+                {\"2S20M\", true, 2},\n+                {\"20M2S\", true, 0},\n+                {\"20M2S\", false, 2},\n+\n+                {\"2S20M5S\", false, 5},\n+                {\"2S20M4S\", true, 2},\n+                {\"4S20M2S\", true, 4},\n+                {\"4S20M2S\", false, 2},", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14a7863636db406fd030ebe648abf431a1d6a753"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec38d289b1dd77c9a1aac867f7def9ab0306e077", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/picard/commit/ec38d289b1dd77c9a1aac867f7def9ab0306e077", "committedDate": "2020-12-11T21:06:01Z", "message": "- Added a metric for the mean length of 3' softclips considering only those reads that have clipping on that end. This metric should provide an estimate for how much the mean insert-size should change for the amount of bases lost to soft-clipping (that which is due to the insert ending) to change significantly.\n- I'm not especially happy with the name of the metric. if someone can come up with a  better name I'd be happy to change.\n- included tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcd0d65f0bce7601c96954adb765706287b08667", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/picard/commit/fcd0d65f0bce7601c96954adb765706287b08667", "committedDate": "2020-12-11T21:06:01Z", "message": "- protecting a method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6644d7be083d823869da45048c44d5e2e3db77c3", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/picard/commit/6644d7be083d823869da45048c44d5e2e3db77c3", "committedDate": "2020-12-11T21:06:01Z", "message": "- spaces"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca0f5da710cd105127fa39831a2fea8af32185d5", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/picard/commit/ca0f5da710cd105127fa39831a2fea8af32185d5", "committedDate": "2020-12-11T21:06:01Z", "message": "Update src/main/java/picard/analysis/AlignmentSummaryMetricsCollector.java\n\nCo-authored-by: meganshand <mshand@broadinstitute.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e070b716c04a7ee7ad375acfc3a3b200d2f47b6", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/picard/commit/8e070b716c04a7ee7ad375acfc3a3b200d2f47b6", "committedDate": "2020-12-11T21:06:02Z", "message": "- fix a bug in the definition of PCT_SOFTCLIP, PCT_HARDCLIP where the code would use the _aligned_ bases as denominator rather than the _total_ bases.\n- fixed the tests to reflect this change."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a30b21507a01c03b4ac563df6f9a894b5f0d46f", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/picard/commit/2a30b21507a01c03b4ac563df6f9a894b5f0d46f", "committedDate": "2020-12-11T21:06:02Z", "message": "responding to review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "436554c4ef969d42abc6dfc7c4cac5473d0db62d", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/picard/commit/436554c4ef969d42abc6dfc7c4cac5473d0db62d", "committedDate": "2020-12-11T20:36:11Z", "message": "Update src/main/java/picard/analysis/AlignmentSummaryMetricsCollector.java\n\nCo-authored-by: meganshand <mshand@broadinstitute.org>"}, "afterCommit": {"oid": "2a30b21507a01c03b4ac563df6f9a894b5f0d46f", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/picard/commit/2a30b21507a01c03b4ac563df6f9a894b5f0d46f", "committedDate": "2020-12-11T21:06:02Z", "message": "responding to review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNTg2MDM5", "url": "https://github.com/broadinstitute/picard/pull/1586#pullrequestreview-550586039", "createdAt": "2020-12-11T21:22:04Z", "commit": {"oid": "2a30b21507a01c03b4ac563df6f9a894b5f0d46f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f343c6b3e71d5f5785fd1b54b7462b4fa78921f", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/picard/commit/7f343c6b3e71d5f5785fd1b54b7462b4fa78921f", "committedDate": "2020-12-11T21:32:47Z", "message": "- added a reverse \"View\" for an immutable (or any) List\n- simplified clipping counting code\n- fixed bug that would appear if there were two softclip operators in a row\n- added tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d67f3be613375c3e6377c1bda78e5ebb09d01cb2", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/picard/commit/d67f3be613375c3e6377c1bda78e5ebb09d01cb2", "committedDate": "2020-12-11T21:42:18Z", "message": "one more test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNjAxNzIx", "url": "https://github.com/broadinstitute/picard/pull/1586#pullrequestreview-550601721", "createdAt": "2020-12-11T21:51:56Z", "commit": {"oid": "d67f3be613375c3e6377c1bda78e5ebb09d01cb2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMTo1MTo1NlrOIEQSrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMTo1MTo1NlrOIEQSrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTMzMjE0MQ==", "bodyText": "Are these legal cigar strings? Doesn't the S operator have to come at the end? I guess it doesn't matter for this test and I agree with 6 for this length (and 0 for the one below).", "url": "https://github.com/broadinstitute/picard/pull/1586#discussion_r541332141", "createdAt": "2020-12-11T21:51:56Z", "author": {"login": "meganshand"}, "path": "src/test/java/picard/analysis/AlignmentSummaryMetricsCollectorTest.java", "diffHunk": "@@ -22,6 +27,9 @@\n                 {\"20M2S\", true, 0},\n                 {\"20M2S\", false, 2},\n \n+                {\"20M2S4S\", false, 6},", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d67f3be613375c3e6377c1bda78e5ebb09d01cb2"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2323, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}