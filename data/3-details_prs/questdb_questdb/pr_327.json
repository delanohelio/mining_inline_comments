{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzMjU2MTky", "number": 327, "title": "Security", "bodyText": "", "createdAt": "2020-05-26T14:52:20Z", "url": "https://github.com/questdb/questdb/pull/327", "merged": true, "mergeCommit": {"oid": "ae43a765707c3da35dfd91eb8ad4cc3c331d0b66"}, "closed": true, "closedAt": "2020-05-26T15:04:00Z", "author": {"login": "patrickSpaceSurfer"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABci7jYSgH2gAyNDIzMjU2MTkyOjExMzJjZTY1MzQzNzY5MGU2YjkzNDhmN2Q5NTA4ZjEzYzQ2ZTg4ZDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclGBSZgFqTQxODM4ODk2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1132ce653437690e6b9348f7d9508f13c46e88d8", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/1132ce653437690e6b9348f7d9508f13c46e88d8", "committedDate": "2020-05-19T21:42:33Z", "message": "chore: questdb can be configured to limit the number of in memory rows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bc9341c23870b6d6a2b8a546831e475bb3940a9", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/1bc9341c23870b6d6a2b8a546831e475bb3940a9", "committedDate": "2020-05-20T08:48:32Z", "message": "chore: Allow queries that fail for certain exceptions (security) to be cached"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3e74c41f8f325316b8283662103c837857f49d4", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/a3e74c41f8f325316b8283662103c837857f49d4", "committedDate": "2020-05-20T10:36:40Z", "message": "chore: Allow queries that fail for certain exceptions (security) to be cached"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2670ca1dbe3d02c94707708e4bdf5ad29e0dc286", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/2670ca1dbe3d02c94707708e4bdf5ad29e0dc286", "committedDate": "2020-05-20T13:30:45Z", "message": "chore: questdb can be configured to limit the number of in memory rows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e46df08a3c5c847e3b5ef542515256f33d7528c3", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/e46df08a3c5c847e3b5ef542515256f33d7528c3", "committedDate": "2020-05-20T15:47:49Z", "message": "chore: Allow queries that fail for certain exceptions (security) to be cached"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0f4d919fd7691c62cf119c330df048fdba6caff", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/f0f4d919fd7691c62cf119c330df048fdba6caff", "committedDate": "2020-05-20T16:07:45Z", "message": "chore: questdb can be configured to limit the number of in memory rows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b3dce73c5599ea46c177023eded6378f03037e6d", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/b3dce73c5599ea46c177023eded6378f03037e6d", "committedDate": "2020-05-20T16:45:19Z", "message": "chore: questdb can be configured to limit the number of in memory rows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45b63cc11c880f8969f6052bff045a41c24a6857", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/45b63cc11c880f8969f6052bff045a41c24a6857", "committedDate": "2020-05-20T21:35:11Z", "message": "chore: questdb can be configured to limit the number of in memory rows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "900655ddb51fbc48f854958fb0ee8125c01f5cdf", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/900655ddb51fbc48f854958fb0ee8125c01f5cdf", "committedDate": "2020-05-20T22:08:41Z", "message": "chore: questdb can be configured to limit the number of in memory rows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9e06b1e8d5e066d503718bb853e79a1d7e2ce08", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/c9e06b1e8d5e066d503718bb853e79a1d7e2ce08", "committedDate": "2020-05-26T10:48:18Z", "message": "chore: questdb can be configured to limit the number of in memory rows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eaadcb463ab0b6fea1e33538c593fae5a3e97ea1", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/eaadcb463ab0b6fea1e33538c593fae5a3e97ea1", "committedDate": "2020-05-26T12:35:34Z", "message": "chore: questdb can be configured to limit the number of in memory rows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe61ffb911cb903dd44cb8550a2e6848e475e673", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/fe61ffb911cb903dd44cb8550a2e6848e475e673", "committedDate": "2020-05-26T13:26:27Z", "message": "Merge branch 'master' into test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58bac4981744402bb683178af10e365483b194da", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/58bac4981744402bb683178af10e365483b194da", "committedDate": "2020-05-26T13:40:16Z", "message": "chore: questdb can be configured to limit the number of in memory rows"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "426e2d7bd347d0b0cfb880fc7eac30e3a620aa3e", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/426e2d7bd347d0b0cfb880fc7eac30e3a620aa3e", "committedDate": "2020-05-26T14:04:34Z", "message": "chore: questdb can be configured to limit the number of in memory rows"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4Mzg0MDc5", "url": "https://github.com/questdb/questdb/pull/327#pullrequestreview-418384079", "createdAt": "2020-05-26T14:57:16Z", "commit": {"oid": "426e2d7bd347d0b0cfb880fc7eac30e3a620aa3e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNDo1NzoxNlrOGaiR0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxNDo1NzoxNlrOGaiR0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ3Nzc3Ng==", "bodyText": "i'm a little dubious how does this work?", "url": "https://github.com/questdb/questdb/pull/327#discussion_r430477776", "createdAt": "2020-05-26T14:57:16Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/griffin/engine/orderby/RecordTreeChain.java", "diffHunk": "@@ -160,43 +164,48 @@ public TreeCursor getCursor(RecordCursor base) {\n     }\n \n     public void put(Record record) {\n-        if (root == -1) {\n-            putParent(record);\n-            return;\n-        }\n+        if (size < maxSize) {\n+            size++;\n+            if (root == -1) {\n+                putParent(record);\n+                return;\n+            }\n+\n+            comparator.setLeft(record);\n+\n+            long p = root;\n+            long parent;\n+            int cmp;\n+            do {\n+                parent = p;\n+                long r = refOf(p);\n+                recordChain.recordAt(recordChainRecord, r);\n+                cmp = comparator.compare(recordChainRecord);\n+                if (cmp < 0) {\n+                    p = leftOf(p);\n+                } else if (cmp > 0) {\n+                    p = rightOf(p);\n+                } else {\n+                    setRef(p, recordChain.put(record, r));\n+                    return;\n+                }\n+            } while (p > -1);\n \n-        comparator.setLeft(record);\n+            p = allocateBlock();\n+            setParent(p, parent);\n+            long r = recordChain.put(record, -1L);\n+            setTop(p, r);\n+            setRef(p, r);\n \n-        long p = root;\n-        long parent;\n-        int cmp;\n-        do {\n-            parent = p;\n-            long r = refOf(p);\n-            recordChain.recordAt(recordChainRecord, r);\n-            cmp = comparator.compare(recordChainRecord);\n             if (cmp < 0) {\n-                p = leftOf(p);\n-            } else if (cmp > 0) {\n-                p = rightOf(p);\n+                setLeft(parent, p);\n             } else {\n-                setRef(p, recordChain.put(record, r));\n-                return;\n+                setRight(parent, p);\n             }\n-        } while (p > -1);\n-\n-        p = allocateBlock();\n-        setParent(p, parent);\n-        long r = recordChain.put(record, -1L);\n-        setTop(p, r);\n-        setRef(p, r);\n-\n-        if (cmp < 0) {\n-            setLeft(parent, p);\n+            fix(p);\n         } else {\n-            setRight(parent, p);\n+            throw LimitOverflowException.instance(maxSize);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "426e2d7bd347d0b0cfb880fc7eac30e3a620aa3e"}, "originalPosition": 113}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4Mzg4OTYx", "url": "https://github.com/questdb/questdb/pull/327#pullrequestreview-418388961", "createdAt": "2020-05-26T15:02:07Z", "commit": {"oid": "426e2d7bd347d0b0cfb880fc7eac30e3a620aa3e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3214, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}