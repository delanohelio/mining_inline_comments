{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMjkwNjM4", "number": 152, "title": "feat(griffin) - Kahan and Neumaier double sum - Vectorised (SIMD) ", "bodyText": "select sum(fare_amount) from trips;\nOld - 19082235123.69902\nKahan - 19082235123.699024\nNeumaier - 19082235123.699028", "createdAt": "2020-04-14T16:31:56Z", "url": "https://github.com/questdb/questdb/pull/152", "merged": true, "mergeCommit": {"oid": "2515106157bd8d245c2462d5fa1a7aec1321cb20"}, "closed": true, "closedAt": "2020-04-17T11:23:41Z", "author": {"login": "jaugsburger"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXmHARgH2gAyNDAzMjkwNjM4Ojk3MjU4OTI0ZGIwZjYxYjI0YzZkNzc1M2Y5YjAwMjMxYzExODRjOGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYfg_CgFqTM5NTM3MjE5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "97258924db0f61b24c6d7753f9b00231c1184c8d", "author": {"user": {"login": "jaugsburger", "name": "Joan Augsburger"}}, "url": "https://github.com/questdb/questdb/commit/97258924db0f61b24c6d7753f9b00231c1184c8d", "committedDate": "2020-04-14T16:30:23Z", "message": "feat(griffin) - Kahan and Neumaier double sum - Vectorised (SIMD) - First commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc830c92fae423f63b075d6bfa836622edd25a00", "author": {"user": {"login": "jaugsburger", "name": "Joan Augsburger"}}, "url": "https://github.com/questdb/questdb/commit/dc830c92fae423f63b075d6bfa836622edd25a00", "committedDate": "2020-04-15T11:36:33Z", "message": "feat(griffin) - Kahan and Neumaier double sum - Vectorised (SIMD) - Vanilla methods and ARM64"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45369aaa2b1752da1cd7a3fbf65e8d49d9f07676", "author": {"user": null}, "url": "https://github.com/questdb/questdb/commit/45369aaa2b1752da1cd7a3fbf65e8d49d9f07676", "committedDate": "2020-04-15T13:35:16Z", "message": "feat(griffin) - Kahan and Neumaier double sum - Vectorised (SIMD) - OSX binary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f171aa7ad498b2f0d85d7823681fca21bc10f1e0", "author": {"user": null}, "url": "https://github.com/questdb/questdb/commit/f171aa7ad498b2f0d85d7823681fca21bc10f1e0", "committedDate": "2020-04-16T16:23:49Z", "message": "feat(griffin) - Kahan and Neumaier double sum - Vectorised (SIMD) - Power function"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MzE3MDkx", "url": "https://github.com/questdb/questdb/pull/152#pullrequestreview-395317091", "createdAt": "2020-04-17T09:51:18Z", "commit": {"oid": "f171aa7ad498b2f0d85d7823681fca21bc10f1e0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwOTo1MToxOFrOGHHkaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwOTo1MTo1NVrOGHHl4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDExNzIyNA==", "bodyText": "could we roll this line back and then we can commit C-level impls that can be integrated into SQL later", "url": "https://github.com/questdb/questdb/pull/152#discussion_r410117224", "createdAt": "2020-04-17T09:51:18Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/cairo/TableReader.java", "diffHunk": "@@ -440,7 +440,7 @@ public double sumDouble(int columnIndex) {\n                 for (int pageIndex = 0, pageCount = column.getPageCount(); pageIndex < pageCount; pageIndex++) {\n                     long a = column.getPageAddress(pageIndex);\n                     long count = column.getPageSize(pageIndex) / Double.BYTES;\n-                    result += Vect.sumDouble(a, count);\n+                    result += Vect.sumDoubleNeumaier(a, count);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f171aa7ad498b2f0d85d7823681fca21bc10f1e0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDExNzYwMQ==", "bodyText": "lets have prefetch just above load. See \"native\" sum", "url": "https://github.com/questdb/questdb/pull/152#discussion_r410117601", "createdAt": "2020-04-17T09:51:55Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/c/share/vect.cpp", "diffHunk": "@@ -404,6 +412,98 @@ double SUM_DOUBLE(double *d, int64_t count) {\n     return NAN;\n }\n \n+double SUM_DOUBLE_KAHAN(double *d, int64_t count) {\n+    Vec8d inputVec;\n+    const int step = 8;\n+    const auto *lim = d + count;\n+    const auto remainder = (int32_t) (count - (count / step) * step);\n+    const auto *lim_vec = lim - remainder;\n+    Vec8d sumVec = 0.;\n+    Vec8d yVec;\n+    Vec8d cVec = 0.;\n+    Vec8db bVec;\n+    Vec8q nancount = 0;\n+    Vec8d tVec;\n+    for (; d < lim_vec; d += step) {\n+        //loading to vector\n+        inputVec.load(d);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f171aa7ad498b2f0d85d7823681fca21bc10f1e0"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dc32130f047474987e9fecd4a3ebbf2b7784344", "author": {"user": null}, "url": "https://github.com/questdb/questdb/commit/9dc32130f047474987e9fecd4a3ebbf2b7784344", "committedDate": "2020-04-17T10:47:03Z", "message": "feat(griffin) - Kahan and Neumaier double sum - Vectorised (SIMD) - PR notes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dba951e6d113a343969b6a0dd3b725ff381922a", "author": {"user": null}, "url": "https://github.com/questdb/questdb/commit/2dba951e6d113a343969b6a0dd3b725ff381922a", "committedDate": "2020-04-17T10:49:33Z", "message": "feat(griffin) - Kahan and Neumaier double sum - Vectorised (SIMD) - OSX binary (2)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MzcyMTkz", "url": "https://github.com/questdb/questdb/pull/152#pullrequestreview-395372193", "createdAt": "2020-04-17T11:23:21Z", "commit": {"oid": "2dba951e6d113a343969b6a0dd3b725ff381922a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3278, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}