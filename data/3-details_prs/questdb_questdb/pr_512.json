{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUyNjAxMDEx", "number": 512, "title": "LIKE implementation #476", "bodyText": "Tested via webUI and automated tests.", "createdAt": "2020-07-19T14:46:56Z", "url": "https://github.com/questdb/questdb/pull/512", "merged": true, "mergeCommit": {"oid": "0cae67fa52dbfa2734d22448a66143b26a3266f2"}, "closed": true, "closedAt": "2020-08-26T10:07:52Z", "author": {"login": "mick2004"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0lDlmgH2gAyNDUyNjAxMDExOjVlYTI4ZDExZWM0NGE5ZDk1ZTFkZDc4ZWFlMGFmZmU5MTRmYWQ5MGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCo8c9gFqTQ3NTM0MzQwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5ea28d11ec44a9d95e1dd78eae0affe914fad90b", "author": {"user": {"login": "mick2004", "name": "Abhishek Pratap Singh"}}, "url": "https://github.com/questdb/questdb/commit/5ea28d11ec44a9d95e1dd78eae0affe914fad90b", "committedDate": "2020-07-13T17:40:33Z", "message": "Error while running JMH benchmark #503"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4e5396921b07c0e0cf61ca27da2e566cf8f80f8", "author": {"user": {"login": "mick2004", "name": "Abhishek Pratap Singh"}}, "url": "https://github.com/questdb/questdb/commit/f4e5396921b07c0e0cf61ca27da2e566cf8f80f8", "committedDate": "2020-07-15T05:54:12Z", "message": "Text Function !~ doesnt work when used with single character #505"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc0ad447bdae15940d1b4926c455482a95a8972e", "author": {"user": {"login": "mick2004", "name": "Abhishek Pratap Singh"}}, "url": "https://github.com/questdb/questdb/commit/fc0ad447bdae15940d1b4926c455482a95a8972e", "committedDate": "2020-07-19T14:40:49Z", "message": "LIKE implementation #476"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b5e6e287a27dcfb62c41b0d96da7db1caabdf6b", "author": {"user": {"login": "mick2004", "name": "Abhishek Pratap Singh"}}, "url": "https://github.com/questdb/questdb/commit/6b5e6e287a27dcfb62c41b0d96da7db1caabdf6b", "committedDate": "2020-07-21T18:31:32Z", "message": "LIKE implementation #476"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMDE1Mzky", "url": "https://github.com/questdb/questdb/pull/512#pullrequestreview-453015392", "createdAt": "2020-07-22T05:58:53Z", "commit": {"oid": "6b5e6e287a27dcfb62c41b0d96da7db1caabdf6b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNTo1ODo1M1rOG1T0uQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNjoyNjoxNlrOG1Ua6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU1MjUwNQ==", "bodyText": "SQL 'like' is case sensitive", "url": "https://github.com/questdb/questdb/pull/512#discussion_r458552505", "createdAt": "2020-07-22T05:58:53Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/griffin/engine/functions/regex/LikeCharFunctionFactory.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*******************************************************************************\n+ *     ___                  _   ____  ____\n+ *    / _ \\ _   _  ___  ___| |_|  _ \\| __ )\n+ *   | | | | | | |/ _ \\/ __| __| | | |  _ \\\n+ *   | |_| | |_| |  __/\\__ \\ |_| |_| | |_) |\n+ *    \\__\\_\\\\__,_|\\___||___/\\__|____/|____/\n+ *\n+ *  Copyright (c) 2014-2019 Appsicle\n+ *  Copyright (c) 2019-2020 QuestDB\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ ******************************************************************************/\n+\n+package io.questdb.griffin.engine.functions.regex;\n+\n+\n+import io.questdb.cairo.CairoConfiguration;\n+import io.questdb.cairo.sql.Function;\n+import io.questdb.cairo.sql.Record;\n+import io.questdb.griffin.FunctionFactory;\n+import io.questdb.griffin.engine.functions.BooleanFunction;\n+import io.questdb.griffin.engine.functions.UnaryFunction;\n+import io.questdb.std.ObjList;\n+\n+public class LikeCharFunctionFactory implements FunctionFactory {\n+    @Override\n+    public String getSignature() {\n+        return \"like(Sa)\";\n+    }\n+\n+    @Override\n+    public Function newInstance(ObjList<Function> args, int position, CairoConfiguration configuration) {\n+        return new MatchFunction(\n+                position,\n+                args.getQuick(0),\n+                args.getQuick(1).getChar(null)\n+        );\n+    }\n+\n+    private static class MatchFunction extends BooleanFunction implements UnaryFunction {\n+        private final Function value;\n+        private final char expected;\n+\n+        public MatchFunction(int position, Function value, char expected) {\n+            super(position);\n+            this.value = value;\n+            this.expected = expected;\n+        }\n+\n+        @Override\n+        public boolean getBool(Record rec) {\n+            CharSequence cs = getArg().getStr(rec);\n+            return cs != null && cs.length()==1 && Character.toLowerCase(cs.charAt(0))==Character.toLowerCase(expected);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b5e6e287a27dcfb62c41b0d96da7db1caabdf6b"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU1MzIwNg==", "bodyText": "This message is shown to user as well as position of the error. User needs to know what to do with this. 'likeString' is not a commonly known term :)", "url": "https://github.com/questdb/questdb/pull/512#discussion_r458553206", "createdAt": "2020-07-22T06:00:57Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/griffin/engine/functions/regex/LikeStrFunctionFactory.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*******************************************************************************\n+ *     ___                  _   ____  ____\n+ *    / _ \\ _   _  ___  ___| |_|  _ \\| __ )\n+ *   | | | | | | |/ _ \\/ __| __| | | |  _ \\\n+ *   | |_| | |_| |  __/\\__ \\ |_| |_| | |_) |\n+ *    \\__\\_\\\\__,_|\\___||___/\\__|____/|____/\n+ *\n+ *  Copyright (c) 2014-2019 Appsicle\n+ *  Copyright (c) 2019-2020 QuestDB\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ ******************************************************************************/\n+\n+package io.questdb.griffin.engine.functions.regex;\n+\n+\n+import io.questdb.cairo.CairoConfiguration;\n+import io.questdb.cairo.sql.Function;\n+import io.questdb.cairo.sql.Record;\n+import io.questdb.griffin.FunctionFactory;\n+import io.questdb.griffin.SqlException;\n+import io.questdb.griffin.engine.functions.BooleanFunction;\n+import io.questdb.griffin.engine.functions.UnaryFunction;\n+import io.questdb.std.ObjList;\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import java.util.regex.PatternSyntaxException;\n+\n+public class LikeStrFunctionFactory implements FunctionFactory {\n+    @Override\n+    public String getSignature() {\n+        return \"like(Ss)\";\n+    }\n+\n+    @Override\n+    public Function newInstance(ObjList<Function> args, int position, CairoConfiguration configuration) throws SqlException {\n+        Function value = args.getQuick(0);\n+\n+        CharSequence likeString=args.getQuick(1).getStr(null);\n+\n+        if (likeString == null) {\n+            throw SqlException.$(args.getQuick(1).getPosition(), \"NULL likeString\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b5e6e287a27dcfb62c41b0d96da7db1caabdf6b"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU1NTA3NA==", "bodyText": "What IDE are you using? Would it be possible to format the code?", "url": "https://github.com/questdb/questdb/pull/512#discussion_r458555074", "createdAt": "2020-07-22T06:06:35Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/griffin/engine/functions/regex/LikeStrFunctionFactory.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*******************************************************************************\n+ *     ___                  _   ____  ____\n+ *    / _ \\ _   _  ___  ___| |_|  _ \\| __ )\n+ *   | | | | | | |/ _ \\/ __| __| | | |  _ \\\n+ *   | |_| | |_| |  __/\\__ \\ |_| |_| | |_) |\n+ *    \\__\\_\\\\__,_|\\___||___/\\__|____/|____/\n+ *\n+ *  Copyright (c) 2014-2019 Appsicle\n+ *  Copyright (c) 2019-2020 QuestDB\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ ******************************************************************************/\n+\n+package io.questdb.griffin.engine.functions.regex;\n+\n+\n+import io.questdb.cairo.CairoConfiguration;\n+import io.questdb.cairo.sql.Function;\n+import io.questdb.cairo.sql.Record;\n+import io.questdb.griffin.FunctionFactory;\n+import io.questdb.griffin.SqlException;\n+import io.questdb.griffin.engine.functions.BooleanFunction;\n+import io.questdb.griffin.engine.functions.UnaryFunction;\n+import io.questdb.std.ObjList;\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import java.util.regex.PatternSyntaxException;\n+\n+public class LikeStrFunctionFactory implements FunctionFactory {\n+    @Override\n+    public String getSignature() {\n+        return \"like(Ss)\";\n+    }\n+\n+    @Override\n+    public Function newInstance(ObjList<Function> args, int position, CairoConfiguration configuration) throws SqlException {\n+        Function value = args.getQuick(0);\n+\n+        CharSequence likeString=args.getQuick(1).getStr(null);\n+\n+        if (likeString == null) {\n+            throw SqlException.$(args.getQuick(1).getPosition(), \"NULL likeString\");\n+        }\n+\n+        String regex = escapeSpecialChars(likeString).\n+                replace('_', '.').replace(\"%\", \".*?\");\n+\n+        try {\n+            Matcher matcher = Pattern.compile(regex,\n+                    Pattern.CASE_INSENSITIVE | Pattern.DOTALL).matcher(\"\");\n+\n+\n+            return new MatchFunction(position, value, matcher);\n+\n+\n+        } catch (PatternSyntaxException e) {\n+            throw SqlException.$(args.getQuick(1).getPosition() + e.getIndex() + 1, e.getMessage());\n+        }\n+    }\n+\n+    public static String escapeSpecialChars(CharSequence s )\n+    {\n+        int len = s.length();\n+        if (len == 0)\n+        {\n+            return \"\";\n+        }\n+\n+        StringBuilder sb = new StringBuilder(s.length() * 2);\n+        for (int i = 0; i < len; i++)\n+        {\n+            char c = s.charAt(i);\n+            if (\"[](){}.*+?$^|#\\\\\".indexOf(c) != -1)\n+            {\n+                sb.append(\"\\\\\");\n+            }\n+            sb.append(c);\n+        }\n+        return sb.toString();\n+    }\n+\n+\n+    private static class MatchFunction extends BooleanFunction implements UnaryFunction {\n+        private final Function value;\n+        private final Matcher matcher;\n+\n+        public MatchFunction(int position, Function value, Matcher matcher) {\n+            super(position);\n+            this.value = value;\n+            this.matcher = matcher;\n+        }\n+\n+        @Override\n+        public boolean getBool(Record rec) {\n+            CharSequence cs = getArg().getStr(rec);\n+            return cs != null && matcher.reset(cs).matches();\n+        }\n+\n+        @Override\n+        public Function getArg() {\n+            return value;\n+        }\n+    }\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b5e6e287a27dcfb62c41b0d96da7db1caabdf6b"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU1NzE3Nw==", "bodyText": "StringBuilder is transient and throw-away instance. Please instead use\nMisc.getThreadLocalBuilder()", "url": "https://github.com/questdb/questdb/pull/512#discussion_r458557177", "createdAt": "2020-07-22T06:12:48Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/griffin/engine/functions/regex/LikeStrFunctionFactory.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*******************************************************************************\n+ *     ___                  _   ____  ____\n+ *    / _ \\ _   _  ___  ___| |_|  _ \\| __ )\n+ *   | | | | | | |/ _ \\/ __| __| | | |  _ \\\n+ *   | |_| | |_| |  __/\\__ \\ |_| |_| | |_) |\n+ *    \\__\\_\\\\__,_|\\___||___/\\__|____/|____/\n+ *\n+ *  Copyright (c) 2014-2019 Appsicle\n+ *  Copyright (c) 2019-2020 QuestDB\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ ******************************************************************************/\n+\n+package io.questdb.griffin.engine.functions.regex;\n+\n+\n+import io.questdb.cairo.CairoConfiguration;\n+import io.questdb.cairo.sql.Function;\n+import io.questdb.cairo.sql.Record;\n+import io.questdb.griffin.FunctionFactory;\n+import io.questdb.griffin.SqlException;\n+import io.questdb.griffin.engine.functions.BooleanFunction;\n+import io.questdb.griffin.engine.functions.UnaryFunction;\n+import io.questdb.std.ObjList;\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import java.util.regex.PatternSyntaxException;\n+\n+public class LikeStrFunctionFactory implements FunctionFactory {\n+    @Override\n+    public String getSignature() {\n+        return \"like(Ss)\";\n+    }\n+\n+    @Override\n+    public Function newInstance(ObjList<Function> args, int position, CairoConfiguration configuration) throws SqlException {\n+        Function value = args.getQuick(0);\n+\n+        CharSequence likeString=args.getQuick(1).getStr(null);\n+\n+        if (likeString == null) {\n+            throw SqlException.$(args.getQuick(1).getPosition(), \"NULL likeString\");\n+        }\n+\n+        String regex = escapeSpecialChars(likeString).\n+                replace('_', '.').replace(\"%\", \".*?\");\n+\n+        try {\n+            Matcher matcher = Pattern.compile(regex,\n+                    Pattern.CASE_INSENSITIVE | Pattern.DOTALL).matcher(\"\");\n+\n+\n+            return new MatchFunction(position, value, matcher);\n+\n+\n+        } catch (PatternSyntaxException e) {\n+            throw SqlException.$(args.getQuick(1).getPosition() + e.getIndex() + 1, e.getMessage());\n+        }\n+    }\n+\n+    public static String escapeSpecialChars(CharSequence s )\n+    {\n+        int len = s.length();\n+        if (len == 0)\n+        {\n+            return \"\";\n+        }\n+\n+        StringBuilder sb = new StringBuilder(s.length() * 2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b5e6e287a27dcfb62c41b0d96da7db1caabdf6b"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU1NzY5OQ==", "bodyText": "this can be done in the same loop as escaping special characters, which would eliminate two extra loops and two string instances.", "url": "https://github.com/questdb/questdb/pull/512#discussion_r458557699", "createdAt": "2020-07-22T06:14:15Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/griffin/engine/functions/regex/LikeStrFunctionFactory.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*******************************************************************************\n+ *     ___                  _   ____  ____\n+ *    / _ \\ _   _  ___  ___| |_|  _ \\| __ )\n+ *   | | | | | | |/ _ \\/ __| __| | | |  _ \\\n+ *   | |_| | |_| |  __/\\__ \\ |_| |_| | |_) |\n+ *    \\__\\_\\\\__,_|\\___||___/\\__|____/|____/\n+ *\n+ *  Copyright (c) 2014-2019 Appsicle\n+ *  Copyright (c) 2019-2020 QuestDB\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ ******************************************************************************/\n+\n+package io.questdb.griffin.engine.functions.regex;\n+\n+\n+import io.questdb.cairo.CairoConfiguration;\n+import io.questdb.cairo.sql.Function;\n+import io.questdb.cairo.sql.Record;\n+import io.questdb.griffin.FunctionFactory;\n+import io.questdb.griffin.SqlException;\n+import io.questdb.griffin.engine.functions.BooleanFunction;\n+import io.questdb.griffin.engine.functions.UnaryFunction;\n+import io.questdb.std.ObjList;\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import java.util.regex.PatternSyntaxException;\n+\n+public class LikeStrFunctionFactory implements FunctionFactory {\n+    @Override\n+    public String getSignature() {\n+        return \"like(Ss)\";\n+    }\n+\n+    @Override\n+    public Function newInstance(ObjList<Function> args, int position, CairoConfiguration configuration) throws SqlException {\n+        Function value = args.getQuick(0);\n+\n+        CharSequence likeString=args.getQuick(1).getStr(null);\n+\n+        if (likeString == null) {\n+            throw SqlException.$(args.getQuick(1).getPosition(), \"NULL likeString\");\n+        }\n+\n+        String regex = escapeSpecialChars(likeString).\n+                replace('_', '.').replace(\"%\", \".*?\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b5e6e287a27dcfb62c41b0d96da7db1caabdf6b"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU1Nzg2OA==", "bodyText": "'like' is case sensitive", "url": "https://github.com/questdb/questdb/pull/512#discussion_r458557868", "createdAt": "2020-07-22T06:14:46Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/griffin/engine/functions/regex/LikeStrFunctionFactory.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*******************************************************************************\n+ *     ___                  _   ____  ____\n+ *    / _ \\ _   _  ___  ___| |_|  _ \\| __ )\n+ *   | | | | | | |/ _ \\/ __| __| | | |  _ \\\n+ *   | |_| | |_| |  __/\\__ \\ |_| |_| | |_) |\n+ *    \\__\\_\\\\__,_|\\___||___/\\__|____/|____/\n+ *\n+ *  Copyright (c) 2014-2019 Appsicle\n+ *  Copyright (c) 2019-2020 QuestDB\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ ******************************************************************************/\n+\n+package io.questdb.griffin.engine.functions.regex;\n+\n+\n+import io.questdb.cairo.CairoConfiguration;\n+import io.questdb.cairo.sql.Function;\n+import io.questdb.cairo.sql.Record;\n+import io.questdb.griffin.FunctionFactory;\n+import io.questdb.griffin.SqlException;\n+import io.questdb.griffin.engine.functions.BooleanFunction;\n+import io.questdb.griffin.engine.functions.UnaryFunction;\n+import io.questdb.std.ObjList;\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import java.util.regex.PatternSyntaxException;\n+\n+public class LikeStrFunctionFactory implements FunctionFactory {\n+    @Override\n+    public String getSignature() {\n+        return \"like(Ss)\";\n+    }\n+\n+    @Override\n+    public Function newInstance(ObjList<Function> args, int position, CairoConfiguration configuration) throws SqlException {\n+        Function value = args.getQuick(0);\n+\n+        CharSequence likeString=args.getQuick(1).getStr(null);\n+\n+        if (likeString == null) {\n+            throw SqlException.$(args.getQuick(1).getPosition(), \"NULL likeString\");\n+        }\n+\n+        String regex = escapeSpecialChars(likeString).\n+                replace('_', '.').replace(\"%\", \".*?\");\n+\n+        try {\n+            Matcher matcher = Pattern.compile(regex,\n+                    Pattern.CASE_INSENSITIVE | Pattern.DOTALL).matcher(\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b5e6e287a27dcfb62c41b0d96da7db1caabdf6b"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU1ODMzMQ==", "bodyText": "please use Chars.toString(). Instances of strings are liable to be cached in the future.", "url": "https://github.com/questdb/questdb/pull/512#discussion_r458558331", "createdAt": "2020-07-22T06:15:55Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/griffin/engine/functions/regex/LikeStrFunctionFactory.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*******************************************************************************\n+ *     ___                  _   ____  ____\n+ *    / _ \\ _   _  ___  ___| |_|  _ \\| __ )\n+ *   | | | | | | |/ _ \\/ __| __| | | |  _ \\\n+ *   | |_| | |_| |  __/\\__ \\ |_| |_| | |_) |\n+ *    \\__\\_\\\\__,_|\\___||___/\\__|____/|____/\n+ *\n+ *  Copyright (c) 2014-2019 Appsicle\n+ *  Copyright (c) 2019-2020 QuestDB\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ ******************************************************************************/\n+\n+package io.questdb.griffin.engine.functions.regex;\n+\n+\n+import io.questdb.cairo.CairoConfiguration;\n+import io.questdb.cairo.sql.Function;\n+import io.questdb.cairo.sql.Record;\n+import io.questdb.griffin.FunctionFactory;\n+import io.questdb.griffin.SqlException;\n+import io.questdb.griffin.engine.functions.BooleanFunction;\n+import io.questdb.griffin.engine.functions.UnaryFunction;\n+import io.questdb.std.ObjList;\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import java.util.regex.PatternSyntaxException;\n+\n+public class LikeStrFunctionFactory implements FunctionFactory {\n+    @Override\n+    public String getSignature() {\n+        return \"like(Ss)\";\n+    }\n+\n+    @Override\n+    public Function newInstance(ObjList<Function> args, int position, CairoConfiguration configuration) throws SqlException {\n+        Function value = args.getQuick(0);\n+\n+        CharSequence likeString=args.getQuick(1).getStr(null);\n+\n+        if (likeString == null) {\n+            throw SqlException.$(args.getQuick(1).getPosition(), \"NULL likeString\");\n+        }\n+\n+        String regex = escapeSpecialChars(likeString).\n+                replace('_', '.').replace(\"%\", \".*?\");\n+\n+        try {\n+            Matcher matcher = Pattern.compile(regex,\n+                    Pattern.CASE_INSENSITIVE | Pattern.DOTALL).matcher(\"\");\n+\n+\n+            return new MatchFunction(position, value, matcher);\n+\n+\n+        } catch (PatternSyntaxException e) {\n+            throw SqlException.$(args.getQuick(1).getPosition() + e.getIndex() + 1, e.getMessage());\n+        }\n+    }\n+\n+    public static String escapeSpecialChars(CharSequence s )\n+    {\n+        int len = s.length();\n+        if (len == 0)\n+        {\n+            return \"\";\n+        }\n+\n+        StringBuilder sb = new StringBuilder(s.length() * 2);\n+        for (int i = 0; i < len; i++)\n+        {\n+            char c = s.charAt(i);\n+            if (\"[](){}.*+?$^|#\\\\\".indexOf(c) != -1)\n+            {\n+                sb.append(\"\\\\\");\n+            }\n+            sb.append(c);\n+        }\n+        return sb.toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b5e6e287a27dcfb62c41b0d96da7db1caabdf6b"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU2MjEzOQ==", "bodyText": "there is no unit test that hits this line", "url": "https://github.com/questdb/questdb/pull/512#discussion_r458562139", "createdAt": "2020-07-22T06:25:52Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/griffin/engine/functions/regex/LikeStrFunctionFactory.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*******************************************************************************\n+ *     ___                  _   ____  ____\n+ *    / _ \\ _   _  ___  ___| |_|  _ \\| __ )\n+ *   | | | | | | |/ _ \\/ __| __| | | |  _ \\\n+ *   | |_| | |_| |  __/\\__ \\ |_| |_| | |_) |\n+ *    \\__\\_\\\\__,_|\\___||___/\\__|____/|____/\n+ *\n+ *  Copyright (c) 2014-2019 Appsicle\n+ *  Copyright (c) 2019-2020 QuestDB\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ ******************************************************************************/\n+\n+package io.questdb.griffin.engine.functions.regex;\n+\n+\n+import io.questdb.cairo.CairoConfiguration;\n+import io.questdb.cairo.sql.Function;\n+import io.questdb.cairo.sql.Record;\n+import io.questdb.griffin.FunctionFactory;\n+import io.questdb.griffin.SqlException;\n+import io.questdb.griffin.engine.functions.BooleanFunction;\n+import io.questdb.griffin.engine.functions.UnaryFunction;\n+import io.questdb.std.ObjList;\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import java.util.regex.PatternSyntaxException;\n+\n+public class LikeStrFunctionFactory implements FunctionFactory {\n+    @Override\n+    public String getSignature() {\n+        return \"like(Ss)\";\n+    }\n+\n+    @Override\n+    public Function newInstance(ObjList<Function> args, int position, CairoConfiguration configuration) throws SqlException {\n+        Function value = args.getQuick(0);\n+\n+        CharSequence likeString=args.getQuick(1).getStr(null);\n+\n+        if (likeString == null) {\n+            throw SqlException.$(args.getQuick(1).getPosition(), \"NULL likeString\");\n+        }\n+\n+        String regex = escapeSpecialChars(likeString).\n+                replace('_', '.').replace(\"%\", \".*?\");\n+\n+        try {\n+            Matcher matcher = Pattern.compile(regex,\n+                    Pattern.CASE_INSENSITIVE | Pattern.DOTALL).matcher(\"\");\n+\n+\n+            return new MatchFunction(position, value, matcher);\n+\n+\n+        } catch (PatternSyntaxException e) {\n+            throw SqlException.$(args.getQuick(1).getPosition() + e.getIndex() + 1, e.getMessage());\n+        }\n+    }\n+\n+    public static String escapeSpecialChars(CharSequence s )\n+    {\n+        int len = s.length();\n+        if (len == 0)\n+        {\n+            return \"\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b5e6e287a27dcfb62c41b0d96da7db1caabdf6b"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU2MjI4MA==", "bodyText": "this code is untested", "url": "https://github.com/questdb/questdb/pull/512#discussion_r458562280", "createdAt": "2020-07-22T06:26:16Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/griffin/engine/functions/regex/LikeStrFunctionFactory.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*******************************************************************************\n+ *     ___                  _   ____  ____\n+ *    / _ \\ _   _  ___  ___| |_|  _ \\| __ )\n+ *   | | | | | | |/ _ \\/ __| __| | | |  _ \\\n+ *   | |_| | |_| |  __/\\__ \\ |_| |_| | |_) |\n+ *    \\__\\_\\\\__,_|\\___||___/\\__|____/|____/\n+ *\n+ *  Copyright (c) 2014-2019 Appsicle\n+ *  Copyright (c) 2019-2020 QuestDB\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *  http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ ******************************************************************************/\n+\n+package io.questdb.griffin.engine.functions.regex;\n+\n+\n+import io.questdb.cairo.CairoConfiguration;\n+import io.questdb.cairo.sql.Function;\n+import io.questdb.cairo.sql.Record;\n+import io.questdb.griffin.FunctionFactory;\n+import io.questdb.griffin.SqlException;\n+import io.questdb.griffin.engine.functions.BooleanFunction;\n+import io.questdb.griffin.engine.functions.UnaryFunction;\n+import io.questdb.std.ObjList;\n+\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import java.util.regex.PatternSyntaxException;\n+\n+public class LikeStrFunctionFactory implements FunctionFactory {\n+    @Override\n+    public String getSignature() {\n+        return \"like(Ss)\";\n+    }\n+\n+    @Override\n+    public Function newInstance(ObjList<Function> args, int position, CairoConfiguration configuration) throws SqlException {\n+        Function value = args.getQuick(0);\n+\n+        CharSequence likeString=args.getQuick(1).getStr(null);\n+\n+        if (likeString == null) {\n+            throw SqlException.$(args.getQuick(1).getPosition(), \"NULL likeString\");\n+        }\n+\n+        String regex = escapeSpecialChars(likeString).\n+                replace('_', '.').replace(\"%\", \".*?\");\n+\n+        try {\n+            Matcher matcher = Pattern.compile(regex,\n+                    Pattern.CASE_INSENSITIVE | Pattern.DOTALL).matcher(\"\");\n+\n+\n+            return new MatchFunction(position, value, matcher);\n+\n+\n+        } catch (PatternSyntaxException e) {\n+            throw SqlException.$(args.getQuick(1).getPosition() + e.getIndex() + 1, e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b5e6e287a27dcfb62c41b0d96da7db1caabdf6b"}, "originalPosition": 69}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMDMxNzU0", "url": "https://github.com/questdb/questdb/pull/512#pullrequestreview-453031754", "createdAt": "2020-07-22T06:36:47Z", "commit": {"oid": "6b5e6e287a27dcfb62c41b0d96da7db1caabdf6b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNjozNjo0N1rOG1UrBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMlQwNjozNjo0N1rOG1UrBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU2NjQwNg==", "bodyText": "'like' must not be a symbol (see 'and', 'not' etc.)\nThe reason is that symbols break up words, for example 'dislike' will be tokenized as 'dis' + 'like' if 'like' was a symbol. When 'like' is not a symbol - 'dislike' will remain whole and 'like' will only be tokenized as such when it is separated with whitespace, e.g.  x like '%a'", "url": "https://github.com/questdb/questdb/pull/512#discussion_r458566406", "createdAt": "2020-07-22T06:36:47Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/griffin/OperatorExpression.java", "diffHunk": "@@ -54,6 +54,7 @@\n         add(new OperatorExpression(\"and\", 11, true, BINARY, false));\n         add(new OperatorExpression(\"or\", 11, true, BINARY, false));\n         add(new OperatorExpression(\"not\", 11, true, UNARY, false));\n+        add(new OperatorExpression(\"like\", 7, true, BINARY));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b5e6e287a27dcfb62c41b0d96da7db1caabdf6b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff96cc92f2fc0bb2268f0681ebe330f48d072a5d", "author": {"user": {"login": "mick2004", "name": "Abhishek Pratap Singh"}}, "url": "https://github.com/questdb/questdb/commit/ff96cc92f2fc0bb2268f0681ebe330f48d072a5d", "committedDate": "2020-08-19T16:00:14Z", "message": "LIKE implementation #476"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e776bc91d249b4e332e27693541238499b2f6156", "author": {"user": {"login": "mick2004", "name": "Abhishek Pratap Singh"}}, "url": "https://github.com/questdb/questdb/commit/e776bc91d249b4e332e27693541238499b2f6156", "committedDate": "2020-08-19T16:43:36Z", "message": "latest sync"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1MzQzNDAz", "url": "https://github.com/questdb/questdb/pull/512#pullrequestreview-475343403", "createdAt": "2020-08-26T10:07:19Z", "commit": {"oid": "e776bc91d249b4e332e27693541238499b2f6156"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3182, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}