{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2MDIxMjYx", "number": 347, "title": "chore(griffin): Limit the number of rows returned in HTTP requests (h\u2026", "bodyText": "\u2026ttp.security.max.response.rows)", "createdAt": "2020-06-01T14:39:54Z", "url": "https://github.com/questdb/questdb/pull/347", "merged": true, "mergeCommit": {"oid": "042fb230559ed4ac65a9b238577dcb2907b4adbe"}, "closed": true, "closedAt": "2020-06-03T10:44:00Z", "author": {"login": "patrickSpaceSurfer"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnDoJtAFqTQyMjAyODE1MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnnHNXAFqTQyMzQzMTE2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMDI4MTUw", "url": "https://github.com/questdb/questdb/pull/347#pullrequestreview-422028150", "createdAt": "2020-06-01T17:13:39Z", "commit": {"oid": "d69da73001e3a2edfd773538b5a25cae30e3f481"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzoxMzo0MFrOGdS62w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxNzoyMjoyNlrOGdTNMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM3MTg2Nw==", "bodyText": "comparison to MAX_VALUE seems redundant", "url": "https://github.com/questdb/questdb/pull/347#discussion_r433371867", "createdAt": "2020-06-01T17:13:40Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/cutlass/http/processors/TextQueryProcessor.java", "diffHunk": "@@ -361,6 +361,10 @@ private boolean parseUrl(\n             skip = 0;\n         }\n \n+        if (configuration.getMaxQueryResponseRowLimit() != Long.MAX_VALUE && (stop - skip) > configuration.getMaxQueryResponseRowLimit()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d69da73001e3a2edfd773538b5a25cae30e3f481"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM3Mjg0OA==", "bodyText": "This is going to be hard to trace in multi-user environment. Compiled model for what SQL? Which FD?", "url": "https://github.com/questdb/questdb/pull/347#discussion_r433372848", "createdAt": "2020-06-01T17:15:28Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/griffin/SqlCompiler.java", "diffHunk": "@@ -1106,6 +1106,7 @@ private CompiledQuery compileUsingModel(SqlExecutionContext executionContext) th\n         ExecutionModel executionModel = compileExecutionModel(executionContext);\n         switch (executionModel.getModelType()) {\n             case ExecutionModel.QUERY:\n+                LOG.info().$(\"Compiled model: \").$((QueryModel) executionModel).$();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d69da73001e3a2edfd773538b5a25cae30e3f481"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM3NTg3MA==", "bodyText": "it would be useful to track network usage per connection to try to find offenders. When total usage goes up, what do we do?\nlog structure is \"action done/doing [context_variable=value, context_variable2=value, ....]\"", "url": "https://github.com/questdb/questdb/pull/347#discussion_r433375870", "createdAt": "2020-06-01T17:21:07Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/cutlass/http/processors/JsonQueryProcessor.java", "diffHunk": "@@ -264,7 +264,7 @@ protected static void header(\n     }\n \n     private static void readyForNextRequest(HttpConnectionContext context) {\n-        LOG.debug().$(\"all sent [fd=\").$(context.getFd()).$(']').$();\n+        LOG.info().$(\"Request complete, \").$(context.getTotalBytesSent()).$(\" bytes sent [fd=\").$(context.getFd()).$(']').$();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d69da73001e3a2edfd773538b5a25cae30e3f481"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM3NjIxOA==", "bodyText": "same, comparison to MAX_VALUE is redundant", "url": "https://github.com/questdb/questdb/pull/347#discussion_r433376218", "createdAt": "2020-06-01T17:21:46Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/cutlass/http/processors/JsonQueryProcessor.java", "diffHunk": "@@ -405,6 +405,10 @@ private boolean parseUrl(\n             skip = 0;\n         }\n \n+        if (configuration.getMaxQueryResponseRowLimit() != Long.MAX_VALUE && (stop - skip) > configuration.getMaxQueryResponseRowLimit()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d69da73001e3a2edfd773538b5a25cae30e3f481"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM3NjU2MA==", "bodyText": "I would also try to use min/max functions, in case Java can JIT those without branches", "url": "https://github.com/questdb/questdb/pull/347#discussion_r433376560", "createdAt": "2020-06-01T17:22:26Z", "author": {"login": "bluestreak01"}, "path": "core/src/main/java/io/questdb/cutlass/http/processors/TextQueryProcessor.java", "diffHunk": "@@ -361,6 +361,10 @@ private boolean parseUrl(\n             skip = 0;\n         }\n \n+        if (configuration.getMaxQueryResponseRowLimit() != Long.MAX_VALUE && (stop - skip) > configuration.getMaxQueryResponseRowLimit()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM3MTg2Nw=="}, "originalCommit": {"oid": "d69da73001e3a2edfd773538b5a25cae30e3f481"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "048da23fffc020d19e39913e2597285f34911fab", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/048da23fffc020d19e39913e2597285f34911fab", "committedDate": "2020-06-02T10:36:30Z", "message": "chore(griffin): Limit the number of rows returned in HTTP requests (http.security.max.response.rows)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a65f45c7501e73abc6d73e588b76f7f8d2f3afc6", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/a65f45c7501e73abc6d73e588b76f7f8d2f3afc6", "committedDate": "2020-06-02T10:36:30Z", "message": "chore(griffin): Add more logging to HTTP queries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22f2a5625d043ac83e81a77b0215ad6da846e1a8", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/22f2a5625d043ac83e81a77b0215ad6da846e1a8", "committedDate": "2020-06-02T10:36:30Z", "message": "chore(griffin): Log QueryModel when SQL is first compiled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e27530968b74f9c9cce522f3080016178aec38d", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/5e27530968b74f9c9cce522f3080016178aec38d", "committedDate": "2020-06-02T13:03:59Z", "message": "chore(griffin): Log QueryModel when SQL is first compiled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ac478b1fa5c54cee90acd0ca2bae2e07f6e9827", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/1ac478b1fa5c54cee90acd0ca2bae2e07f6e9827", "committedDate": "2020-06-02T14:11:14Z", "message": "chore(griffin): Log QueryModel when SQL is first compiled"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d69da73001e3a2edfd773538b5a25cae30e3f481", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/d69da73001e3a2edfd773538b5a25cae30e3f481", "committedDate": "2020-06-01T15:53:45Z", "message": "chore(griffin): Log QueryModel when SQL is first compiled"}, "afterCommit": {"oid": "1ac478b1fa5c54cee90acd0ca2bae2e07f6e9827", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/1ac478b1fa5c54cee90acd0ca2bae2e07f6e9827", "committedDate": "2020-06-02T14:11:14Z", "message": "chore(griffin): Log QueryModel when SQL is first compiled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1563dc59ff923ed9e0a5dedae436ff3ab45856a", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/b1563dc59ff923ed9e0a5dedae436ff3ab45856a", "committedDate": "2020-06-02T14:27:14Z", "message": "chore(griffin): Log more requests information"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1ab6d771e3d415577c05417d00e0153357debb6", "author": {"user": {"login": "patrickSpaceSurfer", "name": "Patrick Mackinlay"}}, "url": "https://github.com/questdb/questdb/commit/c1ab6d771e3d415577c05417d00e0153357debb6", "committedDate": "2020-06-02T15:53:19Z", "message": "chore(griffin): Add tests for security configuration"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNDMxMTY3", "url": "https://github.com/questdb/questdb/pull/347#pullrequestreview-423431167", "createdAt": "2020-06-03T10:43:18Z", "commit": {"oid": "c1ab6d771e3d415577c05417d00e0153357debb6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3217, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}