{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NzAxNDEy", "number": 185, "title": "feat(griffin): ksum() & nsum() compensated summation functions. Fixed\u2026", "bodyText": "\u2026 #171", "createdAt": "2020-04-19T17:22:21Z", "url": "https://github.com/questdb/questdb/pull/185", "merged": true, "mergeCommit": {"oid": "e0f0272f15d2e2fc35eabdd919cca64472070342"}, "closed": true, "closedAt": "2020-04-20T12:29:28Z", "author": {"login": "bluestreak01"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZN1vLgH2gAyNDA1NzAxNDEyOmY5MDdiYjdkOWU2ZWJmZTM3Y2VmMjdlOTUxMzU4MmEzNzk5MDIwYTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZc-uzgFqTM5NjM1MDAwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f907bb7d9e6ebfe37cef27e9513582a3799020a5", "author": {"user": {"login": "bluestreak01", "name": "Vlad Ilyushchenko"}}, "url": "https://github.com/questdb/questdb/commit/f907bb7d9e6ebfe37cef27e9513582a3799020a5", "committedDate": "2020-04-19T17:21:39Z", "message": "feat(griffin): ksum() & nsum() compensated summation functions. Fixed #171"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "771bada6476ba0d1174ce1570ca5d216d2c2e3b4", "author": {"user": {"login": "bluestreak01", "name": "Vlad Ilyushchenko"}}, "url": "https://github.com/questdb/questdb/commit/771bada6476ba0d1174ce1570ca5d216d2c2e3b4", "committedDate": "2020-04-19T22:37:50Z", "message": "fix(griffin): bugfixing new functions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MjAxNzMw", "url": "https://github.com/questdb/questdb/pull/185#pullrequestreview-396201730", "createdAt": "2020-04-20T07:27:12Z", "commit": {"oid": "771bada6476ba0d1174ce1570ca5d216d2c2e3b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNzoyNzoxMlrOGIG1ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNzoyNzoxMlrOGIG1ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE1Mzc2NQ==", "bodyText": "I've been thinking that avg() should have the option of using ksum and nsum.", "url": "https://github.com/questdb/questdb/pull/185#discussion_r411153765", "createdAt": "2020-04-20T07:27:12Z", "author": {"login": "jaugsburger"}, "path": "core/src/main/java/io/questdb/griffin/SqlCodeGenerator.java", "diffHunk": "@@ -427,6 +431,20 @@ private RecordCursorFactory createSpliceJoin(\n                     vafList.add(new SumTimestampVectorAggregateFunction(ast.rhs.position, columnIndex));\n                     continue;\n                 }\n+            } else if (isSingleColumnFunction(ast, \"ksum\")) {\n+                final int columnIndex = metadata.getColumnIndex(ast.rhs.token);\n+                final int type = metadata.getColumnType(columnIndex);\n+                if (type == ColumnType.DOUBLE) {\n+                    vafList.add(new KSumDoubleVectorAggregateFunction(ast.rhs.position, columnIndex, workerCount));\n+                    continue;\n+                }\n+            } else if (isSingleColumnFunction(ast, \"nsum\")) {\n+                final int columnIndex = metadata.getColumnIndex(ast.rhs.token);\n+                final int type = metadata.getColumnType(columnIndex);\n+                if (type == ColumnType.DOUBLE) {\n+                    vafList.add(new NSumDoubleVectorAggregateFunction(ast.rhs.position, columnIndex, workerCount));\n+                    continue;\n+                }\n             } else if (isSingleColumnFunction(ast, \"avg\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "771bada6476ba0d1174ce1570ca5d216d2c2e3b4"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MzUwMDA4", "url": "https://github.com/questdb/questdb/pull/185#pullrequestreview-396350008", "createdAt": "2020-04-20T11:00:03Z", "commit": {"oid": "771bada6476ba0d1174ce1570ca5d216d2c2e3b4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3281, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}