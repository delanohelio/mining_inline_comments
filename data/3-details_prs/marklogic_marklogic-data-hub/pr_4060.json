{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI5NDc5MTMx", "number": 4060, "title": "DHFPROD-5031: Adding load and mapping steps to flows", "bodyText": "Description\nThis PR contains changes for below mentioned tickets.\n\nDHFPROD-5031: Add a load step to a new flow\nDHFPROD-4749: Add a mapping step to a new flow\n\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-06-06T22:28:16Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060", "merged": true, "mergeCommit": {"oid": "3fe7e8ec2ec96a56531cda50e388ec6b0a8edbda"}, "closed": true, "closedAt": "2020-06-08T20:27:07Z", "author": {"login": "xnikhil08"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcovX25gBqjM0MTU0MTUzNzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpVo9FgFqTQyNjU1NTc3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6e557bf98b2fcb822628ad027b219f117706f01a", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/6e557bf98b2fcb822628ad027b219f117706f01a", "committedDate": "2020-06-06T22:19:54Z", "message": "DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Tests for options to add Load and Mapping steps to Flow (+1 squashed commit)\nSquashed commits:\n[9782be6ae] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Added logic to update active keys for flows collapse panels (+1 squashed commit)\nSquashed commits:\n[df78cb329] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Fixed few links between step and flows (+1 squashed commit)\nSquashed commits:\n[67adb6269] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Removing unnecessary comment (+1 squashed commit)\nSquashed commits:\n[40084a866] DHFPROD-5031: Adding step to a new flow logic for load and mapping"}, "afterCommit": {"oid": "f1cad825290206e474044ab747ad07b7299f1da7", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/f1cad825290206e474044ab747ad07b7299f1da7", "committedDate": "2020-06-06T22:53:56Z", "message": "DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031 - Fixing the tileView tests by adding rendering the components with router (+1 squashed commit)\nSquashed commits:\n[6e557bf98] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Tests for options to add Load and Mapping steps to Flow (+1 squashed commit)\nSquashed commits:\n[9782be6ae] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Added logic to update active keys for flows collapse panels (+1 squashed commit)\nSquashed commits:\n[df78cb329] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Fixed few links between step and flows (+1 squashed commit)\nSquashed commits:\n[67adb6269] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Removing unnecessary comment (+1 squashed commit)\nSquashed commits:\n[40084a866] DHFPROD-5031: Adding step to a new flow logic for load and mapping"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2MjI2NDYy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#pullrequestreview-426226462", "createdAt": "2020-06-08T13:21:22Z", "commit": {"oid": "f1cad825290206e474044ab747ad07b7299f1da7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzoyMToyMlrOGgdtrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxMzoyMToyMlrOGgdtrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjY5NDQ0NA==", "bodyText": "Can remove comment", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#discussion_r436694444", "createdAt": "2020-06-08T13:21:22Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub-central/ui/src/pages/Run.tsx", "diffHunk": "@@ -20,8 +20,9 @@ const Statuses = {\n     'FINISHED_WITH_ERRORS': 'finished_with_errors'\n }\n \n-const Run: React.FC = () => {\n-   const { resetSessionTime } = useContext(UserContext)\n+// TODO Rename Bench component to Run", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1cad825290206e474044ab747ad07b7299f1da7"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NDIzMTY3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#pullrequestreview-426423167", "createdAt": "2020-06-08T16:43:50Z", "commit": {"oid": "f1cad825290206e474044ab747ad07b7299f1da7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNjo0Mzo1MVrOGgm-sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNjo0Mzo1MVrOGgm-sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg0NjI1OQ==", "bodyText": "Are we adding a label here purely for testing? We dont allow duplicate step names. So do we need a lebel text.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#discussion_r436846259", "createdAt": "2020-06-08T16:43:51Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/load/load-card.tsx", "diffHunk": "@@ -180,20 +194,27 @@ const LoadCard: React.FC<Props> = (props) => {\n                             size=\"small\"\n                         >\n                             <div className={styles.formatContainer}>\n-                                <div style={sourceFormatStyle(elem.sourceFormat)}>{elem.sourceFormat.toUpperCase()}</div>\n+                                <div style={sourceFormatStyle(elem.sourceFormat)} aria-label={`${elem.name}-sourceFormat`}>{elem.sourceFormat.toUpperCase()}</div>\n                             </div>\n-                            <div className={styles.stepNameStyle}>{getInitialChars(elem.name, 25, '...')}</div>\n+                            <div className={styles.stepNameStyle} aria-label={`${elem.name}-stepName`}>{getInitialChars(elem.name, 25, '...')}</div>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1cad825290206e474044ab747ad07b7299f1da7"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NDI1MTA1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#pullrequestreview-426425105", "createdAt": "2020-06-08T16:46:25Z", "commit": {"oid": "f1cad825290206e474044ab747ad07b7299f1da7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNjo0NjoyNlrOGgnEoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNjo0NjoyNlrOGgnEoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg0Nzc3Nw==", "bodyText": "any particular reason we are waiting for element here, there is no preceding fireEvent.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#discussion_r436847777", "createdAt": "2020-06-08T16:46:26Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/load/load-card.test.tsx", "diffHunk": "@@ -1,10 +1,118 @@\n import React from 'react';\n-import { shallow } from 'enzyme';\n+import { render, fireEvent, wait, cleanup, waitForElement } from '@testing-library/react';\n+import { MemoryRouter } from 'react-router-dom';\n import LoadCard from './load-card';\n+import data from '../../config/test-data.config';\n+import axiosMock from 'axios';\n+import mocks from '../../config/mocks.config';\n+import { AuthoritiesService, AuthoritiesContext } from '../../util/authorities';\n+\n+jest.mock('axios');\n+\n+const mockHistoryPush = jest.fn();\n+\n+jest.mock('react-router-dom', () => ({\n+  ...jest.requireActual('react-router-dom'),\n+  useHistory: () => ({\n+    push: mockHistoryPush,\n+  }),\n+}));\n \n describe('Load Card component', () => {\n-  it('should render correctly', () => {\n-    shallow(<LoadCard data deleteLoadArtifact\n-      createLoadArtifact/>);\n+\n+  beforeEach(() => {\n+    mocks.loadAPI(axiosMock);\n+  })\n+\n+  afterEach(() => {\n+    jest.clearAllMocks();\n+    cleanup();\n+  })\n+\n+  test('Load Card - Add step to an existing Flow', async () => {\n+    const authorityService = new AuthoritiesService();\n+    authorityService.setAuthorities(['readIngestion', 'writeIngestion', 'writeFlow']);\n+    const { getByText, getByLabelText, getByTestId } = render(\n+      <MemoryRouter>\n+        <AuthoritiesContext.Provider value={authorityService}>\n+          <LoadCard \n+            {...data.loadData}\n+            flows={data.flows}\n+            canWriteFlow={true}\n+            addStepToFlow={jest.fn()}\n+            addStepToNew={jest.fn()} />\n+        </AuthoritiesContext.Provider>\n+      </MemoryRouter>\n+    )\n+\n+    //Check if the card is rendered properly\n+    expect(getByText('Add New')).toBeInTheDocument();\n+    expect(getByText('testLoadXML')).toBeInTheDocument();\n+    expect(getByLabelText('testLoadXML-sourceFormat')).toBeInTheDocument();\n+    expect(getByText('Last Updated: 04/15/2020 2:22PM')).toBeInTheDocument();\n+    expect(await (waitForElement(() => getByLabelText('testLoadXML-stepName')))).toBeInTheDocument();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1cad825290206e474044ab747ad07b7299f1da7"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NDI3NTM2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#pullrequestreview-426427536", "createdAt": "2020-06-08T16:49:27Z", "commit": {"oid": "f1cad825290206e474044ab747ad07b7299f1da7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNjo0OToyN1rOGgnMUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxNjo0OToyN1rOGgnMUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg0OTc0NQ==", "bodyText": "At any point only one step could be moused over to display \"Add to New/Existing Flow\" right. Do we need testid. We can just use getByText.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#discussion_r436849745", "createdAt": "2020-06-08T16:49:27Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/load/load-card.test.tsx", "diffHunk": "@@ -1,10 +1,118 @@\n import React from 'react';\n-import { shallow } from 'enzyme';\n+import { render, fireEvent, wait, cleanup, waitForElement } from '@testing-library/react';\n+import { MemoryRouter } from 'react-router-dom';\n import LoadCard from './load-card';\n+import data from '../../config/test-data.config';\n+import axiosMock from 'axios';\n+import mocks from '../../config/mocks.config';\n+import { AuthoritiesService, AuthoritiesContext } from '../../util/authorities';\n+\n+jest.mock('axios');\n+\n+const mockHistoryPush = jest.fn();\n+\n+jest.mock('react-router-dom', () => ({\n+  ...jest.requireActual('react-router-dom'),\n+  useHistory: () => ({\n+    push: mockHistoryPush,\n+  }),\n+}));\n \n describe('Load Card component', () => {\n-  it('should render correctly', () => {\n-    shallow(<LoadCard data deleteLoadArtifact\n-      createLoadArtifact/>);\n+\n+  beforeEach(() => {\n+    mocks.loadAPI(axiosMock);\n+  })\n+\n+  afterEach(() => {\n+    jest.clearAllMocks();\n+    cleanup();\n+  })\n+\n+  test('Load Card - Add step to an existing Flow', async () => {\n+    const authorityService = new AuthoritiesService();\n+    authorityService.setAuthorities(['readIngestion', 'writeIngestion', 'writeFlow']);\n+    const { getByText, getByLabelText, getByTestId } = render(\n+      <MemoryRouter>\n+        <AuthoritiesContext.Provider value={authorityService}>\n+          <LoadCard \n+            {...data.loadData}\n+            flows={data.flows}\n+            canWriteFlow={true}\n+            addStepToFlow={jest.fn()}\n+            addStepToNew={jest.fn()} />\n+        </AuthoritiesContext.Provider>\n+      </MemoryRouter>\n+    )\n+\n+    //Check if the card is rendered properly\n+    expect(getByText('Add New')).toBeInTheDocument();\n+    expect(getByText('testLoadXML')).toBeInTheDocument();\n+    expect(getByLabelText('testLoadXML-sourceFormat')).toBeInTheDocument();\n+    expect(getByText('Last Updated: 04/15/2020 2:22PM')).toBeInTheDocument();\n+    expect(await (waitForElement(() => getByLabelText('testLoadXML-stepName')))).toBeInTheDocument();\n+\n+    fireEvent.mouseOver(getByText('testLoadXML')); // Hover over the Load Card to get more options\n+\n+    //Verify if the flow related options are availble on mouseOver\n+    expect(getByTestId('testLoadXML-toNewFlow')).toBeInTheDocument(); // check if option 'Add to a new Flow' is visible", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1cad825290206e474044ab747ad07b7299f1da7"}, "originalPosition": 62}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1cad825290206e474044ab747ad07b7299f1da7", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/f1cad825290206e474044ab747ad07b7299f1da7", "committedDate": "2020-06-06T22:53:56Z", "message": "DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031 - Fixing the tileView tests by adding rendering the components with router (+1 squashed commit)\nSquashed commits:\n[6e557bf98] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Tests for options to add Load and Mapping steps to Flow (+1 squashed commit)\nSquashed commits:\n[9782be6ae] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Added logic to update active keys for flows collapse panels (+1 squashed commit)\nSquashed commits:\n[df78cb329] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Fixed few links between step and flows (+1 squashed commit)\nSquashed commits:\n[67adb6269] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Removing unnecessary comment (+1 squashed commit)\nSquashed commits:\n[40084a866] DHFPROD-5031: Adding step to a new flow logic for load and mapping"}, "afterCommit": {"oid": "386e2a415f66f8d5bf8ec0746682c83007b510e4", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/386e2a415f66f8d5bf8ec0746682c83007b510e4", "committedDate": "2020-06-08T17:11:52Z", "message": "DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Update the tests based on comments in PR (+1 squashed commit)\nSquashed commits:\n[f1cad8252] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031 - Fixing the tileView tests by adding rendering the components with router (+1 squashed commit)\nSquashed commits:\n[6e557bf98] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Tests for options to add Load and Mapping steps to Flow (+1 squashed commit)\nSquashed commits:\n[9782be6ae] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Added logic to update active keys for flows collapse panels (+1 squashed commit)\nSquashed commits:\n[df78cb329] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Fixed few links between step and flows (+1 squashed commit)\nSquashed commits:\n[67adb6269] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Removing unnecessary comment (+1 squashed commit)\nSquashed commits:\n[40084a866] DHFPROD-5031: Adding step to a new flow logic for load and mapping"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "386e2a415f66f8d5bf8ec0746682c83007b510e4", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/386e2a415f66f8d5bf8ec0746682c83007b510e4", "committedDate": "2020-06-08T17:11:52Z", "message": "DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Update the tests based on comments in PR (+1 squashed commit)\nSquashed commits:\n[f1cad8252] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031 - Fixing the tileView tests by adding rendering the components with router (+1 squashed commit)\nSquashed commits:\n[6e557bf98] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Tests for options to add Load and Mapping steps to Flow (+1 squashed commit)\nSquashed commits:\n[9782be6ae] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Added logic to update active keys for flows collapse panels (+1 squashed commit)\nSquashed commits:\n[df78cb329] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Fixed few links between step and flows (+1 squashed commit)\nSquashed commits:\n[67adb6269] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Removing unnecessary comment (+1 squashed commit)\nSquashed commits:\n[40084a866] DHFPROD-5031: Adding step to a new flow logic for load and mapping"}, "afterCommit": {"oid": "9754234d6f1453b5e70ef320394e0420a67440a7", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/9754234d6f1453b5e70ef320394e0420a67440a7", "committedDate": "2020-06-08T17:12:40Z", "message": "DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Update the tests based on comments in PR (+1 squashed commit)\nSquashed commits:\n[f1cad8252] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031 - Fixing the tileView tests by adding rendering the components with router (+1 squashed commit)\nSquashed commits:\n[6e557bf98] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Tests for options to add Load and Mapping steps to Flow (+1 squashed commit)\nSquashed commits:\n[9782be6ae] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Added logic to update active keys for flows collapse panels (+1 squashed commit)\nSquashed commits:\n[df78cb329] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Fixed few links between step and flows (+1 squashed commit)\nSquashed commits:\n[67adb6269] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Removing unnecessary comment (+1 squashed commit)\nSquashed commits:\n[40084a866] DHFPROD-5031: Adding step to a new flow logic for load and mapping"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9754234d6f1453b5e70ef320394e0420a67440a7", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/9754234d6f1453b5e70ef320394e0420a67440a7", "committedDate": "2020-06-08T17:12:40Z", "message": "DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Update the tests based on comments in PR (+1 squashed commit)\nSquashed commits:\n[f1cad8252] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031 - Fixing the tileView tests by adding rendering the components with router (+1 squashed commit)\nSquashed commits:\n[6e557bf98] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Tests for options to add Load and Mapping steps to Flow (+1 squashed commit)\nSquashed commits:\n[9782be6ae] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Added logic to update active keys for flows collapse panels (+1 squashed commit)\nSquashed commits:\n[df78cb329] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Fixed few links between step and flows (+1 squashed commit)\nSquashed commits:\n[67adb6269] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Removing unnecessary comment (+1 squashed commit)\nSquashed commits:\n[40084a866] DHFPROD-5031: Adding step to a new flow logic for load and mapping"}, "afterCommit": {"oid": "bd1b8c2aee37c86ffd394008fadddaeddcfabdae", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/bd1b8c2aee37c86ffd394008fadddaeddcfabdae", "committedDate": "2020-06-08T17:19:31Z", "message": "DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: More updated to the tests (+1 squashed commit)\nSquashed commits:\n[9754234d6] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Update the tests based on comments in PR (+1 squashed commit)\nSquashed commits:\n[f1cad8252] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031 - Fixing the tileView tests by adding rendering the components with router (+1 squashed commit)\nSquashed commits:\n[6e557bf98] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Tests for options to add Load and Mapping steps to Flow (+1 squashed commit)\nSquashed commits:\n[9782be6ae] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Added logic to update active keys for flows collapse panels (+1 squashed commit)\nSquashed commits:\n[df78cb329] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Fixed few links between step and flows (+1 squashed commit)\nSquashed commits:\n[67adb6269] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Removing unnecessary comment (+1 squashed commit)\nSquashed commits:\n[40084a866] DHFPROD-5031: Adding step to a new flow logic for load and mapping"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NTEzMDY1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#pullrequestreview-426513065", "createdAt": "2020-06-08T18:41:01Z", "commit": {"oid": "bd1b8c2aee37c86ffd394008fadddaeddcfabdae"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NTMzMTgz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#pullrequestreview-426533183", "createdAt": "2020-06-08T19:00:43Z", "commit": {"oid": "bd1b8c2aee37c86ffd394008fadddaeddcfabdae"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7d09cdb42527addedb00e8269264711f8ce6193", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d7d09cdb42527addedb00e8269264711f8ce6193", "committedDate": "2020-06-08T19:10:01Z", "message": "DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: More updated to the tests (+1 squashed commit)\nSquashed commits:\n[9754234d6] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Update the tests based on comments in PR (+1 squashed commit)\nSquashed commits:\n[f1cad8252] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031 - Fixing the tileView tests by adding rendering the components with router (+1 squashed commit)\nSquashed commits:\n[6e557bf98] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Tests for options to add Load and Mapping steps to Flow (+1 squashed commit)\nSquashed commits:\n[9782be6ae] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Added logic to update active keys for flows collapse panels (+1 squashed commit)\nSquashed commits:\n[df78cb329] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Fixed few links between step and flows (+1 squashed commit)\nSquashed commits:\n[67adb6269] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Removing unnecessary comment (+1 squashed commit)\nSquashed commits:\n[40084a866] DHFPROD-5031: Adding step to a new flow logic for load and mapping"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bd1b8c2aee37c86ffd394008fadddaeddcfabdae", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/bd1b8c2aee37c86ffd394008fadddaeddcfabdae", "committedDate": "2020-06-08T17:19:31Z", "message": "DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: More updated to the tests (+1 squashed commit)\nSquashed commits:\n[9754234d6] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Update the tests based on comments in PR (+1 squashed commit)\nSquashed commits:\n[f1cad8252] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031 - Fixing the tileView tests by adding rendering the components with router (+1 squashed commit)\nSquashed commits:\n[6e557bf98] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Tests for options to add Load and Mapping steps to Flow (+1 squashed commit)\nSquashed commits:\n[9782be6ae] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Added logic to update active keys for flows collapse panels (+1 squashed commit)\nSquashed commits:\n[df78cb329] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Fixed few links between step and flows (+1 squashed commit)\nSquashed commits:\n[67adb6269] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Removing unnecessary comment (+1 squashed commit)\nSquashed commits:\n[40084a866] DHFPROD-5031: Adding step to a new flow logic for load and mapping"}, "afterCommit": {"oid": "d7d09cdb42527addedb00e8269264711f8ce6193", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d7d09cdb42527addedb00e8269264711f8ce6193", "committedDate": "2020-06-08T19:10:01Z", "message": "DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: More updated to the tests (+1 squashed commit)\nSquashed commits:\n[9754234d6] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Update the tests based on comments in PR (+1 squashed commit)\nSquashed commits:\n[f1cad8252] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031 - Fixing the tileView tests by adding rendering the components with router (+1 squashed commit)\nSquashed commits:\n[6e557bf98] DHFPROD-5031: Adding step to flows from load and mapping steps\n\nDHFPROD-5031: Tests for options to add Load and Mapping steps to Flow (+1 squashed commit)\nSquashed commits:\n[9782be6ae] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Added logic to update active keys for flows collapse panels (+1 squashed commit)\nSquashed commits:\n[df78cb329] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Fixed few links between step and flows (+1 squashed commit)\nSquashed commits:\n[67adb6269] DHFPROD-5031: Adding step to a new flow logic for load and mapping\n\nDHFPROD-5031: Removing unnecessary comment (+1 squashed commit)\nSquashed commits:\n[40084a866] DHFPROD-5031: Adding step to a new flow logic for load and mapping"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NTQ2Mjg5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#pullrequestreview-426546289", "createdAt": "2020-06-08T19:15:28Z", "commit": {"oid": "d7d09cdb42527addedb00e8269264711f8ce6193"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NTQ2NTU1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#pullrequestreview-426546555", "createdAt": "2020-06-08T19:15:51Z", "commit": {"oid": "d7d09cdb42527addedb00e8269264711f8ce6193"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NTUwNjk2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#pullrequestreview-426550696", "createdAt": "2020-06-08T19:22:12Z", "commit": {"oid": "d7d09cdb42527addedb00e8269264711f8ce6193"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxOToyMjoxMlrOGgtFwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxOToyMjoxMlrOGgtFwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk0NjM2OQ==", "bodyText": "Nice!", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#discussion_r436946369", "createdAt": "2020-06-08T19:22:12Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/mapping-card.test.tsx", "diffHunk": "@@ -153,4 +162,120 @@ describe(\"Entity Tiles component\", () => {\n        });\n        expect(getByText(AdvancedSettingsMessages.targetPermissions.incorrectFormat)).toBeInTheDocument();\n   });\n+\n+  test('Adding the step to an existing flow', async () => {\n+    const authorityService = new AuthoritiesService();\n+    authorityService.setAuthorities(['readMapping', 'writeMapping', 'writeFlow']);\n+    let entityModel = data.primaryEntityTypes.data[0];\n+    let mapping = data.mappings.data[0].artifacts;\n+    const noopFun = () => {};\n+    let getByText, getByLabelText, getByTestId;\n+    await act(async () => {\n+      const renderResults = render(\n+        <MemoryRouter>\n+          <AuthoritiesContext.Provider value={authorityService}>\n+            <MappingCard\n+              data={mapping}\n+              flows={data.flows.data}\n+              entityTypeTitle={entityModel.entityName}\n+              getMappingArtifactByMapName={noopFun}\n+              deleteMappingArtifact={noopFun}\n+              createMappingArtifact={noopFun}\n+              updateMappingArtifact={noopFun}\n+              canReadOnly={false}\n+              canReadWrite={true}\n+              canWriteFlow={true}\n+              entityModel={entityModel}\n+              addStepToFlow={noopFun}\n+              addStepToNew={noopFun} />\n+          </AuthoritiesContext.Provider>\n+        </MemoryRouter>\n+      );\n+      getByText = renderResults.getByText;\n+      getByLabelText = renderResults.getByLabelText;\n+      getByTestId = renderResults.getByTestId\n+    })\n+\n+    //Check if the card is rendered properly\n+    expect(getByText('Add New')).toBeInTheDocument();\n+    expect(getByText('Mapping1')).toBeInTheDocument();\n+    //expect(getByLabelText('testLoadXML-sourceFormat')).toBeInTheDocument();\n+    expect(getByText('Last Updated: 04/24/2020 1:21PM')).toBeInTheDocument();\n+\n+    fireEvent.mouseOver(getByText('Mapping1')); // Hover over the Load Card to get more options\n+\n+    //Verify if the flow related options are availble on mouseOver\n+    expect(getByTestId('Mapping1-toNewFlow')).toBeInTheDocument(); // check if option 'Add to a new Flow' is visible\n+    expect(getByTestId('Mapping1-toExistingFlow')).toBeInTheDocument(); // check if option 'Add to an existing Flow' is visible\n+\n+    //Click on the select field to open the list of existing flows.\n+    fireEvent.click(getByTestId('Mapping1-flowsList')); \n+\n+    //Choose testFlow from the dropdown\n+    fireEvent.click(getByText('testFlow'));\n+    \n+    //Click on 'Yes' button\n+    fireEvent.click(getByTestId('Mapping1-to-testFlow-Confirm'));\n+\n+    //Check if the tiles-run route has been called\n+    wait(() => {\n+      expect(mockHistoryPush).toHaveBeenCalledWith('/tiles-run');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7d09cdb42527addedb00e8269264711f8ce6193"}, "originalPosition": 91}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NTU1Nzc3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4060#pullrequestreview-426555777", "createdAt": "2020-06-08T19:29:43Z", "commit": {"oid": "d7d09cdb42527addedb00e8269264711f8ce6193"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2741, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}