{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDExOTYwNzY1", "number": 3901, "title": "DHFPROD-4216: Collapse All/Expand All buttons for Source and Entity tables in Mapping UI.", "bodyText": "Description\nThis PR enables the Collapse All and Expand All buttons in Source and Entity tables in mapping UI.\nAlso, it fixes the bug where the nested levels used to collapse when navigating between source documents, using the navigation buttons.\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-05-01T03:38:22Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3901", "merged": true, "mergeCommit": {"oid": "8be7a367bc89bd472336507e0c1d2ceaaaf9b055"}, "closed": true, "closedAt": "2020-05-06T19:30:39Z", "author": {"login": "xnikhil08"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcc5VbEgBqjMyOTIxMzk1Mzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcerEaigFqTQwNjc3MjQ4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "406fbe63c196cc4eb7b0ebd3a80d258c3a680db8", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/406fbe63c196cc4eb7b0ebd3a80d258c3a680db8", "committedDate": "2020-05-01T03:42:58Z", "message": "DHFPROD-4216: Removing unnecessary debug statements"}, "afterCommit": {"oid": "e79093577a661399790d5683c46854dfc88d5702", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e79093577a661399790d5683c46854dfc88d5702", "committedDate": "2020-05-01T03:43:43Z", "message": "DHFPROD-4216: Collapse All/Expand All buttons for Source and Entity tables in Mapping UI.\nDHFPROD-4216: Removing unnecessary debug statements (+1 squashed commit)\nSquashed commits:\n[9e93a5f55] DHFPROD-4216: Collapse All/Expand All buttons for Source and Entity tables in Mapping UI.\nDHFPROD-4216: Fixed few tests after updating the unique key in source table (+2 squashed commits)\nSquashed commits:\n[85100b6ac] DHFPROD-4216: Fixing issue sin collapse/expand rows and added unit tests\n[4d8cc289b] DHFPROD-4216: Expand all / Collapse all buttons for Mapping UI tables"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MjU1OTEx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3901#pullrequestreview-404255911", "createdAt": "2020-05-01T16:27:03Z", "commit": {"oid": "e79093577a661399790d5683c46854dfc88d5702"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0MzgyMzQ0", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3901#pullrequestreview-404382344", "createdAt": "2020-05-01T20:25:29Z", "commit": {"oid": "e79093577a661399790d5683c46854dfc88d5702"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjU4NjQ2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3901#pullrequestreview-404658646", "createdAt": "2020-05-03T21:22:08Z", "commit": {"oid": "e79093577a661399790d5683c46854dfc88d5702"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjU5Mjc3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3901#pullrequestreview-404659277", "createdAt": "2020-05-03T21:30:45Z", "commit": {"oid": "e79093577a661399790d5683c46854dfc88d5702"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMTozMDo0NlrOGPvr6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMTozMDo0NlrOGPvr6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MzExMw==", "bodyText": "Can we update the testid to say expandCollapseBtn-source and expandCollapseBtn-entity so its clear than rowKey and key.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3901#discussion_r419163113", "createdAt": "2020-05-03T21:30:46Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/source-entity-map/source-to-entity-map.tsx", "diffHunk": "@@ -954,20 +1072,23 @@ const SourceToEntityMap = (props) => {\n                             </div>\n                             :\n                             <div id=\"dataPresent\">\n-                                <div className={styles.navigationCollapseButtons}>{navigationButtons}</div>\n+                                \n+                                <div className={styles.navigationCollapseButtons}><span><Button data-testid=\"expandCollapseBtn-rowKey\" onClick={() => handleExpandCollapse('rowKey')} className={styles.expandCollapseBtn}>{expandedSourceFlag ? 'Collapse All' : 'Expand All'}</Button></span><span>{navigationButtons}</span></div>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e79093577a661399790d5683c46854dfc88d5702"}, "originalPosition": 184}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjY2Mjc3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3901#pullrequestreview-404666277", "createdAt": "2020-05-03T23:05:50Z", "commit": {"oid": "e79093577a661399790d5683c46854dfc88d5702"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMzowNTo1MFrOGPwQfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMzowNTo1MFrOGPwQfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE3MjQ3OQ==", "bodyText": "can we add an assertion for indentation check. Something similar to this used in this test file:\nexpect(getByText('suffix')).toHaveStyle(\"line-height: 2vh; text-indent: 20px;\"); as applicable", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3901#discussion_r419172479", "createdAt": "2020-05-03T23:05:50Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/source-entity-map/source-to-entity-map.test.tsx", "diffHunk": "@@ -390,6 +398,79 @@ describe('RTL Source-to-entity map tests', () => {\n          */\n     })\n \n+    test('CollapseAll/Expand All feature in JSON Source data table and Entity table', () => {\n+\n+        const { getByTestId, getByText, debug, queryByText } = render(<SourceToEntityMap {...data.mapProps}\n+            mappingVisible={true}\n+        />);\n+\n+        /* Validate collapse-expand in source table */\n+        //Check if the expected source table elements are present in the DOM before hittting the Expan/Collapse button\n+        expect(queryByText('suffix')).not.toBeInTheDocument();\n+        expect(getByText('nutFreeName')).toBeInTheDocument();\n+        expect(getByText('FirstNamePreferred')).toBeInTheDocument();\n+        expect(getByText('LastName')).toBeInTheDocument();\n+\n+        let expandCollapseBtn = getByTestId('expandCollapseBtn-rowKey');\n+\n+        expect(expandCollapseBtn.textContent).toBe('Expand All'); // Validating the button label \n+\n+        fireEvent.click(expandCollapseBtn); //Expanding all nested levels\n+        expect(expandCollapseBtn.textContent).toBe('Collapse All'); // Validating the button label \n+        expect(getByText('suffix')).toBeInTheDocument();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e79093577a661399790d5683c46854dfc88d5702"}, "originalPosition": 138}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjY2NTU1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3901#pullrequestreview-404666555", "createdAt": "2020-05-03T23:09:19Z", "commit": {"oid": "e79093577a661399790d5683c46854dfc88d5702"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMzowOToxOVrOGPwR2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMzowOToxOVrOGPwR2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE3MjgyNQ==", "bodyText": "can you try using onClosestTableRow from the test-util.ts\nexpect(onClosesTableRow(getByText('suffix')).style.display).toBe('none')", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3901#discussion_r419172825", "createdAt": "2020-05-03T23:09:19Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/components/entities/mapping/source-entity-map/source-to-entity-map.test.tsx", "diffHunk": "@@ -390,6 +398,79 @@ describe('RTL Source-to-entity map tests', () => {\n          */\n     })\n \n+    test('CollapseAll/Expand All feature in JSON Source data table and Entity table', () => {\n+\n+        const { getByTestId, getByText, debug, queryByText } = render(<SourceToEntityMap {...data.mapProps}\n+            mappingVisible={true}\n+        />);\n+\n+        /* Validate collapse-expand in source table */\n+        //Check if the expected source table elements are present in the DOM before hittting the Expan/Collapse button\n+        expect(queryByText('suffix')).not.toBeInTheDocument();\n+        expect(getByText('nutFreeName')).toBeInTheDocument();\n+        expect(getByText('FirstNamePreferred')).toBeInTheDocument();\n+        expect(getByText('LastName')).toBeInTheDocument();\n+\n+        let expandCollapseBtn = getByTestId('expandCollapseBtn-rowKey');\n+\n+        expect(expandCollapseBtn.textContent).toBe('Expand All'); // Validating the button label \n+\n+        fireEvent.click(expandCollapseBtn); //Expanding all nested levels\n+        expect(expandCollapseBtn.textContent).toBe('Collapse All'); // Validating the button label \n+        expect(getByText('suffix')).toBeInTheDocument();\n+\n+        fireEvent.click(expandCollapseBtn); //Collapsing back to the default view (root and 1st level)\n+        expect(expandCollapseBtn.textContent).toBe('Expand All'); // Validating the button label \n+        expect(getByText('suffix').closest('tr')?.style.display).toBe('none'); // Checking if the row is marked hidden in DOM. All collapsed rows are marked hidden(display: none) once you click on Collapse All button.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e79093577a661399790d5683c46854dfc88d5702"}, "originalPosition": 142}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "caa017fbd6d9860045460a6c58c6f812dfb4e0e8", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/caa017fbd6d9860045460a6c58c6f812dfb4e0e8", "committedDate": "2020-05-05T18:18:31Z", "message": "DHFPROD-4216: Implement suggestions in unit/functional tests"}, "afterCommit": {"oid": "2d1eb0dccb696d369d1d812f5a47f3081042d50b", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/2d1eb0dccb696d369d1d812f5a47f3081042d50b", "committedDate": "2020-05-05T18:20:25Z", "message": "DHFPROD-4216: Collapse All/Expand All buttons for Source and Entity tables in Mapping UI.\nDHFPROD-4216: Implement suggestions in unit/functional tests (+1 squashed commit)\nSquashed commits:\n[bf888c83e] DHFPROD-4216: Collapse All/Expand All buttons for Source and Entity tables in Mapping UI.\nDHFPROD-4216: Removing unnecessary debug statements (+1 squashed commit)\nSquashed commits:\n[9e93a5f55] DHFPROD-4216: Collapse All/Expand All buttons for Source and Entity tables in Mapping UI.\nDHFPROD-4216: Fixed few tests after updating the unique key in source table (+2 squashed commits)\nSquashed commits:\n[85100b6ac] DHFPROD-4216: Fixing issue sin collapse/expand rows and added unit tests\n[4d8cc289b] DHFPROD-4216: Expand all / Collapse all buttons for Mapping UI tables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "267fb3dc373f4f306ed672c860f715b237684a08", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/267fb3dc373f4f306ed672c860f715b237684a08", "committedDate": "2020-05-05T18:31:33Z", "message": "DHFPROD-4216: Collapse All/Expand All buttons for Source and Entity tables in Mapping UI.\nDHFPROD-4216: Another fix in xml test for collapse expand (+1 squashed commit)\nSquashed commits:\n[2d1eb0dcc] DHFPROD-4216: Collapse All/Expand All buttons for Source and Entity tables in Mapping UI.\nDHFPROD-4216: Implement suggestions in unit/functional tests (+1 squashed commit)\nSquashed commits:\n[bf888c83e] DHFPROD-4216: Collapse All/Expand All buttons for Source and Entity tables in Mapping UI.\nDHFPROD-4216: Removing unnecessary debug statements (+1 squashed commit)\nSquashed commits:\n[9e93a5f55] DHFPROD-4216: Collapse All/Expand All buttons for Source and Entity tables in Mapping UI.\nDHFPROD-4216: Fixed few tests after updating the unique key in source table (+2 squashed commits)\nSquashed commits:\n[85100b6ac] DHFPROD-4216: Fixing issue sin collapse/expand rows and added unit tests\n[4d8cc289b] DHFPROD-4216: Expand all / Collapse all buttons for Mapping UI tables"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aeca6dbe622df62db5f10c3a4df427990462cfdf", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/aeca6dbe622df62db5f10c3a4df427990462cfdf", "committedDate": "2020-05-05T18:31:08Z", "message": "DHFPROD-4216: Another fix in xml test for collapse expand"}, "afterCommit": {"oid": "267fb3dc373f4f306ed672c860f715b237684a08", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/267fb3dc373f4f306ed672c860f715b237684a08", "committedDate": "2020-05-05T18:31:33Z", "message": "DHFPROD-4216: Collapse All/Expand All buttons for Source and Entity tables in Mapping UI.\nDHFPROD-4216: Another fix in xml test for collapse expand (+1 squashed commit)\nSquashed commits:\n[2d1eb0dcc] DHFPROD-4216: Collapse All/Expand All buttons for Source and Entity tables in Mapping UI.\nDHFPROD-4216: Implement suggestions in unit/functional tests (+1 squashed commit)\nSquashed commits:\n[bf888c83e] DHFPROD-4216: Collapse All/Expand All buttons for Source and Entity tables in Mapping UI.\nDHFPROD-4216: Removing unnecessary debug statements (+1 squashed commit)\nSquashed commits:\n[9e93a5f55] DHFPROD-4216: Collapse All/Expand All buttons for Source and Entity tables in Mapping UI.\nDHFPROD-4216: Fixed few tests after updating the unique key in source table (+2 squashed commits)\nSquashed commits:\n[85100b6ac] DHFPROD-4216: Fixing issue sin collapse/expand rows and added unit tests\n[4d8cc289b] DHFPROD-4216: Expand all / Collapse all buttons for Mapping UI tables"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MjY1Njcx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3901#pullrequestreview-406265671", "createdAt": "2020-05-06T02:05:05Z", "commit": {"oid": "267fb3dc373f4f306ed672c860f715b237684a08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MjcyNzYy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3901#pullrequestreview-406272762", "createdAt": "2020-05-06T02:36:19Z", "commit": {"oid": "267fb3dc373f4f306ed672c860f715b237684a08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NzcyNDgw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3901#pullrequestreview-406772480", "createdAt": "2020-05-06T16:14:33Z", "commit": {"oid": "267fb3dc373f4f306ed672c860f715b237684a08"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2832, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}