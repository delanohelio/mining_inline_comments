{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NjgzNDMy", "number": 4095, "title": "DHFPROD-5157: Don't process audit and notification docs through match", "bodyText": "Description\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-06-15T17:46:49Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4095", "merged": true, "mergeCommit": {"oid": "27a59f42e1cdc0b23c9672435d6d28b53337c17c"}, "closed": true, "closedAt": "2020-06-17T23:53:12Z", "author": {"login": "ryanjdew"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrk5UegFqTQzMDg4NjM2Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcr4DKlAFqTQzMTY5ODkyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwODg2MzYz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4095#pullrequestreview-430886363", "createdAt": "2020-06-15T18:21:18Z", "commit": {"oid": "4940782788ff93c1f84a0ac97181d826f950cc96"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxODoyMToxOFrOGj9kAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxODoyMzo0NVrOGj9ouA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM2MTk4NA==", "bodyText": "Couple small typos on auditing and notification here, along with notification below on line 31.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4095#discussion_r440361984", "createdAt": "2020-06-15T18:21:18Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/builtins/steps/mastering/default/matching.sjs", "diffHunk": "@@ -20,28 +20,37 @@ const masteringStepLib = require(\"/data-hub/5/builtins/steps/mastering/default/l\n const requiredOptionProperties = ['matchOptions'];\n const emptySequence = Sequence.from([]);\n \n-function filterContentAlreadyProcessed(content, summaryCollection) {\n+function filterContentAlreadyProcessed(content, summaryCollection, collectionInfo) {\n   const jobID = datahub.flow.globalContext.jobId;\n   const filteredContent = [];\n   const collectionQuery = cts.collectionQuery(summaryCollection);\n   const jobIdQuery = cts.fieldWordQuery('datahubCreatedByJob', jobID);\n+  let auditiingNotifiactionsInSourceQuery = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4940782788ff93c1f84a0ac97181d826f950cc96"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM2MzE5Mg==", "bodyText": "I looked at checkOptions in lib.sjs, and I think it'd be worth documenting here that \"collectionInfo\" is expected to be produced by checkOptions. Otherwise it's difficult to know what this contains - gotta find the client who's calling this and where collectionInfo is coming from.\nIn Intellij, when I asked it to auto-generate comments for the checkOptions function, it produced this, which may be useful to add as well so it's clear what's coming out of that function (as the name to me implies that it will either throw an error if there's a problem with the options or return nothing):\n/**\n * \n * @param content\n * @param options\n * @param filteredContent\n * @param reqOptProperties\n * @returns {{contentCollection: *, mergedCollection: *, notificationCollection: *, archivedCollection: *, auditingCollection: *}}\n */", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4095#discussion_r440363192", "createdAt": "2020-06-15T18:23:45Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/main/resources/ml-modules/root/data-hub/5/builtins/steps/mastering/default/matching.sjs", "diffHunk": "@@ -20,28 +20,37 @@ const masteringStepLib = require(\"/data-hub/5/builtins/steps/mastering/default/l\n const requiredOptionProperties = ['matchOptions'];\n const emptySequence = Sequence.from([]);\n \n-function filterContentAlreadyProcessed(content, summaryCollection) {\n+function filterContentAlreadyProcessed(content, summaryCollection, collectionInfo) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4940782788ff93c1f84a0ac97181d826f950cc96"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4940782788ff93c1f84a0ac97181d826f950cc96", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/4940782788ff93c1f84a0ac97181d826f950cc96", "committedDate": "2020-06-15T17:12:27Z", "message": "DHFPROD-5157: Don't process audit and notification docs through match"}, "afterCommit": {"oid": "0ca2c60e4ad5bc676fcdf06f6bf9bc84adc3a462", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/0ca2c60e4ad5bc676fcdf06f6bf9bc84adc3a462", "committedDate": "2020-06-15T20:02:02Z", "message": "DHFPROD-5157: Don't process audit and notification docs through match"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ca2c60e4ad5bc676fcdf06f6bf9bc84adc3a462", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/0ca2c60e4ad5bc676fcdf06f6bf9bc84adc3a462", "committedDate": "2020-06-15T20:02:02Z", "message": "DHFPROD-5157: Don't process audit and notification docs through match"}, "afterCommit": {"oid": "b869ed5ff4837547490bb57ec006327697a3bd8e", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b869ed5ff4837547490bb57ec006327697a3bd8e", "committedDate": "2020-06-15T20:17:07Z", "message": "DHFPROD-5157: Don't process audit and notification docs through match"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMDExODM1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4095#pullrequestreview-431011835", "createdAt": "2020-06-15T21:38:02Z", "commit": {"oid": "b869ed5ff4837547490bb57ec006327697a3bd8e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fe1d9a2539b70751b5fdf7673764e80a5b9e5b8", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/7fe1d9a2539b70751b5fdf7673764e80a5b9e5b8", "committedDate": "2020-06-15T22:46:36Z", "message": "DHFPROD-5157: Don't process audit and notification docs through match"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b869ed5ff4837547490bb57ec006327697a3bd8e", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/b869ed5ff4837547490bb57ec006327697a3bd8e", "committedDate": "2020-06-15T20:17:07Z", "message": "DHFPROD-5157: Don't process audit and notification docs through match"}, "afterCommit": {"oid": "7fe1d9a2539b70751b5fdf7673764e80a5b9e5b8", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/7fe1d9a2539b70751b5fdf7673764e80a5b9e5b8", "committedDate": "2020-06-15T22:46:36Z", "message": "DHFPROD-5157: Don't process audit and notification docs through match"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNTIxNzYw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4095#pullrequestreview-431521760", "createdAt": "2020-06-16T13:49:16Z", "commit": {"oid": "7fe1d9a2539b70751b5fdf7673764e80a5b9e5b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxNjk4OTIw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4095#pullrequestreview-431698920", "createdAt": "2020-06-16T16:42:58Z", "commit": {"oid": "7fe1d9a2539b70751b5fdf7673764e80a5b9e5b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2791, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}