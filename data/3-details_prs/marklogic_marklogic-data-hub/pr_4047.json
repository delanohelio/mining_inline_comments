{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3MzE2NjI4", "number": 4047, "title": "DHFPROD-4671: Test updates", "bodyText": "Description\nIncludes test updates to load and mapping with reader/writer authorities per test plan\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-06-03T16:22:09Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4047", "merged": true, "mergeCommit": {"oid": "369c5c528d60cb3a8fbc5d27cf59fdd1e48cb074"}, "closed": true, "closedAt": "2020-06-06T00:14:07Z", "author": {"login": "bsrikan"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnsW_mAFqTQyMzc0NzI2MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcobXbogFqTQyNTY4MDExMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNzQ3MjYx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4047#pullrequestreview-423747261", "createdAt": "2020-06-03T16:50:04Z", "commit": {"oid": "a8b2e43313f3a5e6db076e23ccf26aa4279a07c3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNjo1MDowNFrOGekyZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QxNjo1MDowNFrOGekyZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDcxMzE5MQ==", "bodyText": "@xnikhil08 if you get a chance, please try this test out with getByText('Save') and getByText('Cancel') by replacing ByAll.\nFor some reason when I fireEvent.click on 'Save'/'Cancel' with edit alongwith settings it fails with \"found multiple\"", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4047#discussion_r434713191", "createdAt": "2020-06-03T16:50:04Z", "author": {"login": "bsrikan"}, "path": "marklogic-data-hub-central/ui/src/pages/Curate.test.tsx", "diffHunk": "@@ -1,9 +1,98 @@\n-import React from 'react';\n-import { shallow } from 'enzyme';\n-import Curate from './Curate';\n-\n-describe('Install component', () => {\n-  it('should render correctly', () => {\n-    shallow(<Curate />);\n-  });\n-});\n\\ No newline at end of file\n+import React, {useContext} from 'react';\n+import {render, fireEvent, waitForElement, cleanup} from '@testing-library/react'\n+import '@testing-library/jest-dom/extend-expect'\n+import {AuthoritiesContext, AuthoritiesService} from '../util/authorities';\n+import axiosMock from 'axios';\n+import mocks from '../config/mocks.config';\n+import Curate from \"./Curate\";\n+\n+jest.mock('axios');\n+\n+describe('Curate component', () => {\n+\n+    beforeEach(() => {\n+        mocks.curateAPI(axiosMock);\n+    });\n+\n+    afterEach(() => {\n+        jest.clearAllMocks();\n+        cleanup();\n+    })\n+\n+    test('Verify readMapping authority can only view mapping configs and settings', async () => {\n+        const authorityService = new AuthoritiesService();\n+        authorityService.setAuthorities(['readMapping']);\n+\n+        const { getByText, getAllByText, queryByText, getByTestId, queryByTestId, debug } = await render(<AuthoritiesContext.Provider value={authorityService}><Curate/></AuthoritiesContext.Provider>);\n+\n+        expect(await(waitForElement(() => getByText('Customer')))).toBeInTheDocument();\n+\n+        // Check for steps to be populated\n+        expect(axiosMock.get).toBeCalledWith('/api/steps/mapping');\n+        fireEvent.click(getByText('Customer'));\n+        //Mapping tab should show. Match/Merge should not\n+        expect(getByText('Mapping')).toBeInTheDocument();\n+        expect(queryByText('Match')).not.toBeInTheDocument();\n+        expect(queryByText('Merge')).not.toBeInTheDocument();\n+\n+        expect(getByText('Mapping1')).toBeInTheDocument();\n+\n+        // test 'Add New' button\n+        expect(queryByText('Add New')).not.toBeInTheDocument();\n+\n+        // test settings\n+        fireEvent.click(getByTestId('Mapping1-settings'));\n+        expect(await(waitForElement(() => getByText('Target Database:')))).toBeInTheDocument();\n+        expect(getAllByText('Save')[0]).toBeDisabled();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8b2e43313f3a5e6db076e23ccf26aa4279a07c3"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzNzg3ODQ3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4047#pullrequestreview-423787847", "createdAt": "2020-06-03T17:43:26Z", "commit": {"oid": "a8b2e43313f3a5e6db076e23ccf26aa4279a07c3"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzOTk2MzEx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4047#pullrequestreview-423996311", "createdAt": "2020-06-03T23:06:21Z", "commit": {"oid": "a8b2e43313f3a5e6db076e23ccf26aa4279a07c3"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0NjkyMjkw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4047#pullrequestreview-424692290", "createdAt": "2020-06-04T17:55:04Z", "commit": {"oid": "a8b2e43313f3a5e6db076e23ccf26aa4279a07c3"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0ODk1MjU2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4047#pullrequestreview-424895256", "createdAt": "2020-06-04T23:11:15Z", "commit": {"oid": "6b82156426cb8b50464d9645ee8b949c010c7722"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MzQ5MzAx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4047#pullrequestreview-425349301", "createdAt": "2020-06-05T14:24:54Z", "commit": {"oid": "6b82156426cb8b50464d9645ee8b949c010c7722"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NDQyNzky", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4047#pullrequestreview-425442792", "createdAt": "2020-06-05T16:18:48Z", "commit": {"oid": "6b82156426cb8b50464d9645ee8b949c010c7722"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6188ab337c5c69fb4427fb1b4f6a32e36ac17ffc", "author": {"user": {"login": "bsrikan", "name": "Srikanth Balasubramanian"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/6188ab337c5c69fb4427fb1b4f6a32e36ac17ffc", "committedDate": "2020-06-05T19:59:17Z", "message": "DHFPROD-4673: More tests for mapping-reader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c98d72ac0b4ffddf59aaf8214457fcd0ffaf1c2f", "author": {"user": {"login": "bsrikan", "name": "Srikanth Balasubramanian"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/c98d72ac0b4ffddf59aaf8214457fcd0ffaf1c2f", "committedDate": "2020-06-05T20:22:09Z", "message": "DHFPROD-4671,DHFPROD-4672,DHFPROD-4673 and DHFPROD-4674: Test fixes and updates to load and curate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41ff62c4e0642e06a806648c3232946dca6250ab", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/41ff62c4e0642e06a806648c3232946dca6250ab", "committedDate": "2020-06-05T20:22:09Z", "message": "test/mapping: Fixing the curation tests (#5)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6b82156426cb8b50464d9645ee8b949c010c7722", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/6b82156426cb8b50464d9645ee8b949c010c7722", "committedDate": "2020-06-04T22:19:27Z", "message": "test/mapping: Fixing the curation tests (#5)"}, "afterCommit": {"oid": "41ff62c4e0642e06a806648c3232946dca6250ab", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/41ff62c4e0642e06a806648c3232946dca6250ab", "committedDate": "2020-06-05T20:22:09Z", "message": "test/mapping: Fixing the curation tests (#5)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NjMwMzI1", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4047#pullrequestreview-425630325", "createdAt": "2020-06-05T21:16:47Z", "commit": {"oid": "41ff62c4e0642e06a806648c3232946dca6250ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NjgwMTEz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4047#pullrequestreview-425680113", "createdAt": "2020-06-05T23:36:05Z", "commit": {"oid": "41ff62c4e0642e06a806648c3232946dca6250ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2708, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}