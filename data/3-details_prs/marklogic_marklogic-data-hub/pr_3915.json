{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMjg3MjMy", "number": 3915, "title": "DHFPROD-4804: Added hubVersion Gradle task", "bodyText": "Description\nOne note - there's some cleanup I'm aiming to do when we do the story for getting rid of mlDHFVersion - the existing Versions class can be simplified a bit at that point. But I didn't want to touch it now because it has to account for DH not being installed, which of course is not a use case for HC. VersionInfo is intended to be a clean, simple way to get version data when you know you can connect to DH.\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-05-05T03:27:12Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3915", "merged": true, "mergeCommit": {"oid": "25b37b74d1267f34cbb7e94bf80275e88b931363"}, "closed": true, "closedAt": "2020-05-06T21:14:06Z", "author": {"login": "rjrudin"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceLwrSAFqTQwNTQ3NzI2OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcevWATgFqTQwNjk5MTQwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NDc3MjY5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3915#pullrequestreview-405477269", "createdAt": "2020-05-05T03:45:56Z", "commit": {"oid": "71dc89019b4eae7facf4308b4c597b5b476f0a72"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1OTE5NTMx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3915#pullrequestreview-405919531", "createdAt": "2020-05-05T15:47:43Z", "commit": {"oid": "71dc89019b4eae7facf4308b4c597b5b476f0a72"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNTo0Nzo0M1rOGQvxvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxNTo0Nzo0M1rOGQvxvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxMzE4Mg==", "bodyText": "Can we add this file to the updateVersion task that's in root build.gradle?\nThe updateVersion task keeps track of all the hardcoded version locations.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3915#discussion_r420213182", "createdAt": "2020-05-05T15:47:43Z", "author": {"login": "akshaysonvane"}, "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/VersionInfo.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package com.marklogic.hub.impl;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.marklogic.hub.HubClient;\n+import com.marklogic.hub.dataservices.SystemService;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.Properties;\n+\n+/**\n+ * This is intended to replace some of the Versions class with a HubClient-friendly and non-Spring-dependent way of\n+ * accessing version data.\n+ */\n+public class VersionInfo {\n+\n+    private String hubVersion;\n+    private String markLogicVersion;\n+\n+    public static VersionInfo newVersionInfo(HubClient hubClient) {\n+        JsonNode json = SystemService.on(hubClient.getStagingClient()).getVersions();\n+        return new VersionInfo(\n+            json.get(\"hubVersion\").asText(),\n+            json.get(\"markLogicVersion\").asText()\n+        );\n+    }\n+\n+    private VersionInfo(String hubVersion, String markLogicVersion) {\n+        this.hubVersion = hubVersion;\n+        this.markLogicVersion = markLogicVersion;\n+    }\n+\n+    public String getHubVersion() {\n+        return hubVersion;\n+    }\n+\n+    public String getMarkLogicVersion() {\n+        return markLogicVersion;\n+    }\n+\n+    /**\n+     * @return the version of the build containing this class\n+     */\n+    public static String getBuildVersion() {\n+        Properties properties = new Properties();\n+        try (InputStream inputStream = VersionInfo.class.getClassLoader().getResourceAsStream(\"version.properties\")) {\n+            properties.load(inputStream);\n+        } catch (IOException e) {\n+            throw new RuntimeException(\"Unable to get library version from version.properties, cause: \" + e.getMessage(), e);\n+        }\n+\n+        String version = properties.getProperty(\"version\");\n+        return \"${project.version}\".equals(version) ? \"5.3-SNAPSHOT\" : version;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71dc89019b4eae7facf4308b4c597b5b476f0a72"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2MTMzOTgy", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3915#pullrequestreview-406133982", "createdAt": "2020-05-05T20:33:48Z", "commit": {"oid": "71dc89019b4eae7facf4308b4c597b5b476f0a72"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "71dc89019b4eae7facf4308b4c597b5b476f0a72", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/71dc89019b4eae7facf4308b4c597b5b476f0a72", "committedDate": "2020-05-05T03:26:29Z", "message": "DHFPROD-4804: Added hubVersion Gradle task"}, "afterCommit": {"oid": "1905a5375a865da3f373ee713a5b36fb0d0b838c", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1905a5375a865da3f373ee713a5b36fb0d0b838c", "committedDate": "2020-05-06T01:22:01Z", "message": "DHFPROD-4804: Added hubVersion Gradle task"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NzYxNjcw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3915#pullrequestreview-406761670", "createdAt": "2020-05-06T16:02:18Z", "commit": {"oid": "1905a5375a865da3f373ee713a5b36fb0d0b838c"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2Nzg4MTUx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3915#pullrequestreview-406788151", "createdAt": "2020-05-06T16:33:07Z", "commit": {"oid": "1905a5375a865da3f373ee713a5b36fb0d0b838c"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec2ca2e23d427b4545bfed50a31f20a33bad7222", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ec2ca2e23d427b4545bfed50a31f20a33bad7222", "committedDate": "2020-05-06T18:15:47Z", "message": "DHFPROD-4804: Added hubVersion Gradle task"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1905a5375a865da3f373ee713a5b36fb0d0b838c", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/1905a5375a865da3f373ee713a5b36fb0d0b838c", "committedDate": "2020-05-06T01:22:01Z", "message": "DHFPROD-4804: Added hubVersion Gradle task"}, "afterCommit": {"oid": "ec2ca2e23d427b4545bfed50a31f20a33bad7222", "author": {"user": {"login": "rjrudin", "name": null}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/ec2ca2e23d427b4545bfed50a31f20a33bad7222", "committedDate": "2020-05-06T18:15:47Z", "message": "DHFPROD-4804: Added hubVersion Gradle task"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2OTg2OTc2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3915#pullrequestreview-406986976", "createdAt": "2020-05-06T21:06:21Z", "commit": {"oid": "ec2ca2e23d427b4545bfed50a31f20a33bad7222"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2OTkxNDAx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3915#pullrequestreview-406991401", "createdAt": "2020-05-06T21:13:23Z", "commit": {"oid": "ec2ca2e23d427b4545bfed50a31f20a33bad7222"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2856, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}