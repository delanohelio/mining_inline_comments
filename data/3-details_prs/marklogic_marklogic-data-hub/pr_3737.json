{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNTM2MTc0", "number": 3737, "title": "DHFPROD-4504: Not able to persist mapping artifact with same name in another entity", "bodyText": "This PR resolves the bug 4504.\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-03-23T17:35:36Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3737", "merged": true, "mergeCommit": {"oid": "2aee9534d3686f337e4bab67c1d61539f29c270f"}, "closed": true, "closedAt": "2020-03-25T16:49:45Z", "author": {"login": "xnikhil08"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQjNL4gFqTM3OTczODM4Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRG7hFAFqTM4MTExMjg2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzM4Mzgz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3737#pullrequestreview-379738383", "createdAt": "2020-03-23T19:09:57Z", "commit": {"oid": "0c9edeeda2cc689b3c930632d0bd291872c0d085"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzgwNzQ4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3737#pullrequestreview-379780748", "createdAt": "2020-03-23T20:04:16Z", "commit": {"oid": "0c9edeeda2cc689b3c930632d0bd291872c0d085"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDowNDoxNlrOF6WHrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMDowNDoxNlrOF6WHrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcyNDE0MA==", "bodyText": "Is this doing its own form of validation? The server is validating this already, and throwing an error with a message of \"A mapping with the same name but for a different entity type already exists. Please choose a different name.\".\nIf this is doing the validation by comparing the mapping names to the known set of names already - I don't think that's 100% reliable, because a new mapping could have been created between the time that the UI fetches the set of names and the user then tries to create one. That's why the server has to do the validation. The UI should just catch the error from the server and then display it.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3737#discussion_r396724140", "createdAt": "2020-03-23T20:04:16Z", "author": {"login": "rjrudin"}, "path": "one-ui/ui/src/components/entities/mapping/create-edit-mapping-dialog/create-edit-mapping-dialog.tsx", "diffHunk": "@@ -320,8 +321,8 @@ const CreateEditMappingDialog = (props) => {\n           Name:&nbsp;<span className={styles.asterisk}>*</span>\n           &nbsp;\n             </span>} labelAlign=\"left\"\n-          validateStatus={(mapName || !isMapNameTouched) ? '' : 'error'}\n-          help={(mapName || !isMapNameTouched) ? '' : 'Name is required'}\n+          validateStatus={(mapName || !isMapNameTouched) ? (props.title === 'Edit Mapping' ? '' : (!props.mapNames.hasOwnProperty(mapName) ? '' : 'error')) : 'error'}\n+          help={(mapName || !isMapNameTouched) ? (props.title !== 'Edit Mapping'? (props.mapNames.hasOwnProperty(mapName) ? 'A mapping step with the same name already exists. Enter a unique name.':'') : '') : 'Name is required'}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c9edeeda2cc689b3c930632d0bd291872c0d085"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODIyMDkx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3737#pullrequestreview-379822091", "createdAt": "2020-03-23T21:05:55Z", "commit": {"oid": "0c9edeeda2cc689b3c930632d0bd291872c0d085"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTowNTo1NVrOF6YF-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTowNTo1NVrOF6YF-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc1NjQ3NA==", "bodyText": "does this test pass when running locally? The props \"data\" is not right for the mapping card. Try using RTL to render like so and verify if you get back mapping card HTML or an empty div\nimport { render } from \"@testing-library/react\"; \n\ndescribe.... \n\ntest('it renders mapping card div correctly' , () => {\nconst { debug } = render(<MappingCard data />);\ndebug();\n};", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3737#discussion_r396756474", "createdAt": "2020-03-23T21:05:55Z", "author": {"login": "bsrikan"}, "path": "one-ui/ui/src/components/entities/mapping/mapping-card.test.tsx", "diffHunk": "@@ -12,6 +12,7 @@ describe('Mapping cards view component', () => {\n       updateMappingArtifact\n       canReadOnly\n       canReadWrite\n-      entityModel/>);\n+      entityModel\n+      mapNames/>);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c9edeeda2cc689b3c930632d0bd291872c0d085"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c9edeeda2cc689b3c930632d0bd291872c0d085", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/0c9edeeda2cc689b3c930632d0bd291872c0d085", "committedDate": "2020-03-23T17:32:15Z", "message": "DHFPROD-4504: Storing the mapNames to validate duplicate name entries"}, "afterCommit": {"oid": "9e7a7b1824950e3c08fd1133434bff97a891a4e7", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/9e7a7b1824950e3c08fd1133434bff97a891a4e7", "committedDate": "2020-03-24T02:02:08Z", "message": "DHFPROD-4504: Validating Map name based on the response from server"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMjQwOTIx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3737#pullrequestreview-380240921", "createdAt": "2020-03-24T12:00:15Z", "commit": {"oid": "cc62225e1ae6e5f02679541b4e897297313af1a8"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjowMDoxNVrOF6s_rA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxMjowMDoxNVrOF6s_rA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA5ODkyNA==", "bodyText": "This is probably safe for now, but I wanted to note that the UI is making an assumption here - that a 400 status means that the name is a duplicate. That isn't guaranteed to be true, and it could certainly change in the future when some other validation rule is added.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3737#discussion_r397098924", "createdAt": "2020-03-24T12:00:15Z", "author": {"login": "rjrudin"}, "path": "one-ui/ui/src/components/entities/mapping/create-edit-mapping-dialog/create-edit-mapping-dialog.tsx", "diffHunk": "@@ -148,9 +149,11 @@ const CreateEditMappingDialog = (props) => {\n \n     let status = await props.createMappingArtifact(dataPayload);\n \n-    if (status === '200') {\n+    if (status.code === 200) {\n       props.setNewMap(false);\n-    } else if (status === '400') {\n+    } else if (status.code === 400) {\n+      \n+      setErrorMessage(status.message)\n       setIsNameDuplicate(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cc62225e1ae6e5f02679541b4e897297313af1a8"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNjQ0MjQw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3737#pullrequestreview-380644240", "createdAt": "2020-03-24T19:48:10Z", "commit": {"oid": "cc62225e1ae6e5f02679541b4e897297313af1a8"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e179e6991f7fb38bada66ec612db7020e700210e", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e179e6991f7fb38bada66ec612db7020e700210e", "committedDate": "2020-03-24T21:30:45Z", "message": "DHFPROD-4504: Fixing the bug where it was not throwing any error when saving  mapping artifact with same name in another entity.\n (+2 squashed commits)\nSquashed commits:\n[9e7a7b182] DHFPROD-4504: Validating Map name based on the response from server\n[6eb02747b] DHFPROD-4504: Not able to persist mapping artifact with same name in another entity\nAlso fixed the popover issue in one-ui."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cc62225e1ae6e5f02679541b4e897297313af1a8", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/cc62225e1ae6e5f02679541b4e897297313af1a8", "committedDate": "2020-03-24T02:36:10Z", "message": "DHFPROD-4504: Displaying the same error message as coming from the backend server."}, "afterCommit": {"oid": "e179e6991f7fb38bada66ec612db7020e700210e", "author": {"user": {"login": "xnikhil08", "name": "Nikhil Shrivastava"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/e179e6991f7fb38bada66ec612db7020e700210e", "committedDate": "2020-03-24T21:30:45Z", "message": "DHFPROD-4504: Fixing the bug where it was not throwing any error when saving  mapping artifact with same name in another entity.\n (+2 squashed commits)\nSquashed commits:\n[9e7a7b182] DHFPROD-4504: Validating Map name based on the response from server\n[6eb02747b] DHFPROD-4504: Not able to persist mapping artifact with same name in another entity\nAlso fixed the popover issue in one-ui."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzEzNzEx", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3737#pullrequestreview-380713711", "createdAt": "2020-03-24T21:34:20Z", "commit": {"oid": "e179e6991f7fb38bada66ec612db7020e700210e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNzE4MjU5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3737#pullrequestreview-380718259", "createdAt": "2020-03-24T21:42:06Z", "commit": {"oid": "e179e6991f7fb38bada66ec612db7020e700210e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTEyODY3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3737#pullrequestreview-381112867", "createdAt": "2020-03-25T12:47:14Z", "commit": {"oid": "e179e6991f7fb38bada66ec612db7020e700210e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3204, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}