{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNzM3ODU3", "number": 4618, "title": "DHFPROD-5665: Run match step with new schema", "bodyText": "Description\nAdded a test demostrating at a high level the various parts of match schema. Will be adding additional tests for the lower-level functions.\nChecklist:\n- Note: do not change the below\n\n\nOwner:\n\n\n JIRA_ID included in all the commit messages\n\n\n PR title is in the format JIRA_ID:Title\n\n\n Rebase the branch with upstream\n\n\n Squashed all commits into a single commit\n\n\n Added Tests\n\n\nReviewer:\n\n\n Reviewed Tests", "createdAt": "2020-09-24T22:49:05Z", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618", "merged": true, "mergeCommit": {"oid": "1b1dbc863aedd39022be5c3c7df4f936c86ca0de"}, "closed": true, "closedAt": "2020-10-08T17:34:57Z", "author": {"login": "ryanjdew"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMYxDxABqjM4MDg1OTAzNDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQkAJbAFqTUwNDk1MDUzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d9de721d8d944b1729ca98341b69790e5fbbf39e", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/d9de721d8d944b1729ca98341b69790e5fbbf39e", "committedDate": "2020-09-24T22:45:52Z", "message": "DHFPROD-5665: Run match step with new schema"}, "afterCommit": {"oid": "5c94b01d7f5fcdd5b2b880117982432c7c786443", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/5c94b01d7f5fcdd5b2b880117982432c7c786443", "committedDate": "2020-09-25T16:54:50Z", "message": "DHFPROD-5665: Run match step with new schema"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2Nzk0OTU5", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#pullrequestreview-496794959", "createdAt": "2020-09-25T20:13:50Z", "commit": {"oid": "5c94b01d7f5fcdd5b2b880117982432c7c786443"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c94b01d7f5fcdd5b2b880117982432c7c786443", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/5c94b01d7f5fcdd5b2b880117982432c7c786443", "committedDate": "2020-09-25T16:54:50Z", "message": "DHFPROD-5665: Run match step with new schema"}, "afterCommit": {"oid": "bc29d8396d210a67dff969c91f9c154d4f871463", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/bc29d8396d210a67dff969c91f9c154d4f871463", "committedDate": "2020-10-01T23:26:05Z", "message": "DHFPROD-5665: Run match step with new schema"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bc29d8396d210a67dff969c91f9c154d4f871463", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/bc29d8396d210a67dff969c91f9c154d4f871463", "committedDate": "2020-10-01T23:26:05Z", "message": "DHFPROD-5665: Run match step with new schema"}, "afterCommit": {"oid": "576e3e4b3e65e817aad69b619ae2b45bcab562cf", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/576e3e4b3e65e817aad69b619ae2b45bcab562cf", "committedDate": "2020-10-02T17:42:56Z", "message": "DHFPROD-5665: Run match step with new schema"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNDQwOTMz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#pullrequestreview-501440933", "createdAt": "2020-10-02T20:53:00Z", "commit": {"oid": "576e3e4b3e65e817aad69b619ae2b45bcab562cf"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMDc1MjU2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#pullrequestreview-502075256", "createdAt": "2020-10-05T13:49:15Z", "commit": {"oid": "576e3e4b3e65e817aad69b619ae2b45bcab562cf"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzo0OToxNVrOHcd73Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzo1MjoyN1rOHceFMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxMjYzNw==", "bodyText": "I highly recommend slimming down the test data to the bare minimum needed. For example, only include properties used for matching - anything else is just noise that makes the test more difficult to understand. Same thing goes for test data - only insert the documents you need to verify that e.g. 2 docs match, but a 3rd doc does not match.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#discussion_r499612637", "createdAt": "2020-10-05T13:49:15Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/test/ml-modules/root/test/suites/data-hub/5/smart-mastering/entity-driven/test-data/entities/Customer.entity.json", "diffHunk": "@@ -0,0 +1,98 @@\n+{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "576e3e4b3e65e817aad69b619ae2b45bcab562cf"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxMzUzOQ==", "bodyText": "Is inserting data via a match action something we'd encourage? I ask because I'm wondering if we can eventually shift to a model where everything to be written gets stored in-memory first and then is written after all step processing has finished.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#discussion_r499613539", "createdAt": "2020-10-05T13:50:28Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/test/ml-modules/root/test/suites/data-hub/5/smart-mastering/entity-driven/test-data/householdAction.sjs", "diffHunk": "@@ -0,0 +1,15 @@\n+'use strict';\n+\n+const sem = require(\"/MarkLogic/semantics.xqy\");\n+const householdPredicateIRI = sem.iri('http://marklogic.com/datahub/test/household#memberOf');\n+\n+function householdAction(uri, matches, options) {\n+    declareUpdate();\n+    const allURIs = [uri].concat(matches.map((match) => match.uri)).sort();\n+    const householdIRI = sem.iri(`http://marklogic.com/datahub/test/household/${xdmp.md5(allURIs)}`);\n+    sem.rdfInsert(allURIs.map((uri) => sem.triple(sem.iri(uri), householdPredicateIRI, householdIRI)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "576e3e4b3e65e817aad69b619ae2b45bcab562cf"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxNTAyNQ==", "bodyText": "If this test fails, it'll be very helpful to know why 8 matches are expected, and which 8 they are. Otherwise, a developer has to figure out themselves what should match and what should not.", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#discussion_r499615025", "createdAt": "2020-10-05T13:52:27Z", "author": {"login": "rjrudin"}, "path": "marklogic-data-hub/src/test/ml-modules/root/test/suites/data-hub/5/smart-mastering/matching/include-matches.xqy", "diffHunk": "@@ -19,7 +19,7 @@ return (\n     test:assert-equal(1, fn:count($def-match/@threshold[. = \"Definitive Match\"])),\n     test:assert-equal(1, fn:count($def-match/@action[. = $constants:MERGE-ACTION])),\n     test:assert-exists($def-match/matches),\n-    test:assert-equal(7, fn:count($def-match/matches/match))\n+    test:assert-equal(8, fn:count($def-match/matches/match), \"Wrong count of matches: \" || xdmp:describe($def-match, (), ()) )", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "576e3e4b3e65e817aad69b619ae2b45bcab562cf"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "576e3e4b3e65e817aad69b619ae2b45bcab562cf", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/576e3e4b3e65e817aad69b619ae2b45bcab562cf", "committedDate": "2020-10-02T17:42:56Z", "message": "DHFPROD-5665: Run match step with new schema"}, "afterCommit": {"oid": "183da17c35ca8244fbd33a5f7d312ba3bfec4d0a", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/183da17c35ca8244fbd33a5f7d312ba3bfec4d0a", "committedDate": "2020-10-05T22:49:29Z", "message": "DHFPROD-5665: Run match step with new schema"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "183da17c35ca8244fbd33a5f7d312ba3bfec4d0a", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/183da17c35ca8244fbd33a5f7d312ba3bfec4d0a", "committedDate": "2020-10-05T22:49:29Z", "message": "DHFPROD-5665: Run match step with new schema"}, "afterCommit": {"oid": "70bd0a6b919af5eb735547d84c58a5b3963a96d2", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/70bd0a6b919af5eb735547d84c58a5b3963a96d2", "committedDate": "2020-10-05T23:02:43Z", "message": "DHFPROD-5665: Run match step with new schema"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70bd0a6b919af5eb735547d84c58a5b3963a96d2", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/70bd0a6b919af5eb735547d84c58a5b3963a96d2", "committedDate": "2020-10-05T23:02:43Z", "message": "DHFPROD-5665: Run match step with new schema"}, "afterCommit": {"oid": "22bb6413a501071f50911618482d44aaa1258b14", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/22bb6413a501071f50911618482d44aaa1258b14", "committedDate": "2020-10-05T23:03:39Z", "message": "DHFPROD-5665: Run match step with new schema"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "22bb6413a501071f50911618482d44aaa1258b14", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/22bb6413a501071f50911618482d44aaa1258b14", "committedDate": "2020-10-05T23:03:39Z", "message": "DHFPROD-5665: Run match step with new schema"}, "afterCommit": {"oid": "2f93545f05de551d67b010517dfd92b85e259427", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/2f93545f05de551d67b010517dfd92b85e259427", "committedDate": "2020-10-06T16:46:02Z", "message": "DHFPROD-5665: Run match step with new schema"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMTc3MDY4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#pullrequestreview-503177068", "createdAt": "2020-10-06T17:01:16Z", "commit": {"oid": "2f93545f05de551d67b010517dfd92b85e259427"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMzQ3MTcw", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#pullrequestreview-503347170", "createdAt": "2020-10-06T20:49:20Z", "commit": {"oid": "2f93545f05de551d67b010517dfd92b85e259427"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2f93545f05de551d67b010517dfd92b85e259427", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/2f93545f05de551d67b010517dfd92b85e259427", "committedDate": "2020-10-06T16:46:02Z", "message": "DHFPROD-5665: Run match step with new schema"}, "afterCommit": {"oid": "6f9d89429070d828d579a065a349c186f4ef6018", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/6f9d89429070d828d579a065a349c186f4ef6018", "committedDate": "2020-10-07T15:22:00Z", "message": "DHFPROD-5665: Run match step with new schema"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MDA1NjEz", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#pullrequestreview-504005613", "createdAt": "2020-10-07T15:29:09Z", "commit": {"oid": "6f9d89429070d828d579a065a349c186f4ef6018"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f9d89429070d828d579a065a349c186f4ef6018", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/6f9d89429070d828d579a065a349c186f4ef6018", "committedDate": "2020-10-07T15:22:00Z", "message": "DHFPROD-5665: Run match step with new schema"}, "afterCommit": {"oid": "53028044b758d36204f8fdd8aab776f01fe9012b", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/53028044b758d36204f8fdd8aab776f01fe9012b", "committedDate": "2020-10-07T20:19:44Z", "message": "DHFPROD-5665: Run match step with new schema"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MjU1NTE4", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#pullrequestreview-504255518", "createdAt": "2020-10-07T20:48:53Z", "commit": {"oid": "53028044b758d36204f8fdd8aab776f01fe9012b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MjY2Mjk3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#pullrequestreview-504266297", "createdAt": "2020-10-07T21:04:44Z", "commit": {"oid": "53028044b758d36204f8fdd8aab776f01fe9012b"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "517531814d251bd6df0fdcdcdfaa7e6b44c33dee", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/517531814d251bd6df0fdcdcdfaa7e6b44c33dee", "committedDate": "2020-10-08T15:52:06Z", "message": "DHFPROD-5665: Run match step with new schema"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53028044b758d36204f8fdd8aab776f01fe9012b", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/53028044b758d36204f8fdd8aab776f01fe9012b", "committedDate": "2020-10-07T20:19:44Z", "message": "DHFPROD-5665: Run match step with new schema"}, "afterCommit": {"oid": "517531814d251bd6df0fdcdcdfaa7e6b44c33dee", "author": {"user": {"login": "ryanjdew", "name": "Ryan Dew"}}, "url": "https://github.com/marklogic/marklogic-data-hub/commit/517531814d251bd6df0fdcdcdfaa7e6b44c33dee", "committedDate": "2020-10-08T15:52:06Z", "message": "DHFPROD-5665: Run match step with new schema"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0OTQyNDc3", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#pullrequestreview-504942477", "createdAt": "2020-10-08T16:07:24Z", "commit": {"oid": "517531814d251bd6df0fdcdcdfaa7e6b44c33dee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0OTUwNTM2", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4618#pullrequestreview-504950536", "createdAt": "2020-10-08T16:16:46Z", "commit": {"oid": "517531814d251bd6df0fdcdcdfaa7e6b44c33dee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1872, "cost": 1, "resetAt": "2021-10-28T18:54:27Z"}}}